{
  "message": "Document API diagnostic",
  "gcs_disabled": true,
  "session_fix_applied": true,
  "timestamp": "2025-09-02T00:26:37.780Z",
  "environment": "production",
  "version": "v2.1-gcs-disabled",
  "recent_errors": [
    {
      "timestamp": "2025-09-02T00:26:15.968Z",
      "endpoint": "GET /api/documents",
      "error": {
        "message": "Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "stack": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333\n    at NeonHttpPreparedQuery.queryWithCache (file:///home/runner/workspace/node_modules/drizzle-orm/pg-core/session.js:41:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async NeonHttpPreparedQuery.execute (file:///home/runner/workspace/node_modules/drizzle-orm/neon-http/session.js:45:20)\n    at async DatabaseStorage.getDocuments (file:///home/runner/workspace/dist/index.js:3097:16)\n    at async file:///home/runner/workspace/dist/index.js:7667:26",
        "name": "Error",
        "details": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333"
      },
      "user": {
        "id": "222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "role": "admin"
      }
    },
    {
      "timestamp": "2025-09-02T00:26:17.221Z",
      "endpoint": "GET /api/documents",
      "error": {
        "message": "Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "stack": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333\n    at NeonHttpPreparedQuery.queryWithCache (file:///home/runner/workspace/node_modules/drizzle-orm/pg-core/session.js:41:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async NeonHttpPreparedQuery.execute (file:///home/runner/workspace/node_modules/drizzle-orm/neon-http/session.js:45:20)\n    at async DatabaseStorage.getDocuments (file:///home/runner/workspace/dist/index.js:3097:16)\n    at async file:///home/runner/workspace/dist/index.js:7667:26",
        "name": "Error",
        "details": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333"
      },
      "user": {
        "id": "222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "role": "admin"
      }
    },
    {
      "timestamp": "2025-09-02T00:26:19.425Z",
      "endpoint": "GET /api/documents",
      "error": {
        "message": "Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "stack": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333\n    at NeonHttpPreparedQuery.queryWithCache (file:///home/runner/workspace/node_modules/drizzle-orm/pg-core/session.js:41:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async NeonHttpPreparedQuery.execute (file:///home/runner/workspace/node_modules/drizzle-orm/neon-http/session.js:45:20)\n    at async DatabaseStorage.getDocuments (file:///home/runner/workspace/dist/index.js:3097:16)\n    at async file:///home/runner/workspace/dist/index.js:7667:26",
        "name": "Error",
        "details": "Error: Failed query: select \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\" from \"documents\" where (\"documents\".\"residence_id\" = $1 and \"documents\".\"uploaded_by_id\" = $2)\nparams: 5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333"
      },
      "user": {
        "id": "222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "role": "admin"
      }
    },
    {
      "timestamp": "2025-09-02T00:26:26.787Z",
      "endpoint": "POST /api/documents/upload",
      "error": {
        "message": "Failed query: insert into \"documents\" (\"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\") values (default, $1, $2, $3, $4, $5, $6, default, $7, default, default) returning \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\"\nparams: csecs,secsc,other,residences/5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2/91a47d4b-4a64-4327-b437-3fc6cc0a2b6f-fichier texte (5).txt,false,5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "stack": "Error: Failed query: insert into \"documents\" (\"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\") values (default, $1, $2, $3, $4, $5, $6, default, $7, default, default) returning \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\"\nparams: csecs,secsc,other,residences/5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2/91a47d4b-4a64-4327-b437-3fc6cc0a2b6f-fichier texte (5).txt,false,5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333\n    at NeonHttpPreparedQuery.queryWithCache (file:///home/runner/workspace/node_modules/drizzle-orm/pg-core/session.js:41:15)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async NeonHttpPreparedQuery.execute (file:///home/runner/workspace/node_modules/drizzle-orm/neon-http/session.js:45:20)\n    at async DatabaseStorage.createDocument (file:///home/runner/workspace/dist/index.js:3104:24)\n    at async file:///home/runner/workspace/dist/index.js:8295:27",
        "name": "Error",
        "details": "Error: Failed query: insert into \"documents\" (\"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\") values (default, $1, $2, $3, $4, $5, $6, default, $7, default, default) returning \"id\", \"name\", \"description\", \"document_type\", \"gcs_path\", \"is_visible_to_tenants\", \"residence_id\", \"building_id\", \"uploaded_by_id\", \"created_at\", \"updated_at\"\nparams: csecs,secsc,other,residences/5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2/91a47d4b-4a64-4327-b437-3fc6cc0a2b6f-fichier texte (5).txt,false,5d23de5b-ba37-4e5e-9e4b-5fc70b8038f2,222f5a0d-6bc6-4f28-9f4d-32c133eed333"
      },
      "user": {
        "id": "222f5a0d-6bc6-4f28-9f4d-32c133eed333",
        "role": "admin"
      }
    }
  ],
  "storage_status": {
    "exists": true,
    "type": "DatabaseStorage",
    "methods": [
      "constructor",
      "getUsers",
      "getUsersByOrganizations",
      "getUser",
      "getUserByEmail",
      "createUser",
      "updateUser",
      "getUserOrganizations",
      "getUserResidences",
      "getOrganizations",
      "getOrganization",
      "getOrganizationByName",
      "createOrganization",
      "updateOrganization",
      "getBuildingsByOrganization",
      "getBuildings",
      "getBuilding",
      "createBuilding",
      "updateBuilding",
      "deleteBuilding",
      "getResidences",
      "getResidence",
      "getResidencesByBuilding",
      "createResidence",
      "updateResidence",
      "deleteResidence",
      "getPillars",
      "getPillar",
      "createPillar",
      "updatePillar",
      "getWorkspaceStatuses",
      "getWorkspaceStatus",
      "createWorkspaceStatus",
      "updateWorkspaceStatus",
      "getQualityMetrics",
      "createQualityMetric",
      "getFrameworkConfigs",
      "getFrameworkConfig",
      "setFrameworkConfig",
      "getImprovementSuggestions",
      "getTopImprovementSuggestions",
      "createImprovementSuggestion",
      "clearNewSuggestions",
      "updateSuggestionStatus",
      "getFeatures",
      "getFeaturesByStatus",
      "getFeaturesByCategory",
      "getPublicRoadmapFeatures",
      "createFeature",
      "updateFeature",
      "deleteFeature",
      "getFeature",
      "getPermissions",
      "getRolePermissions",
      "getUserPermissions",
      "getContacts",
      "getContactsByEntity",
      "getContactsForResidence",
      "createContact",
      "updateContact",
      "deleteContact",
      "getDocuments",
      "getDocument",
      "createDocument",
      "updateDocument",
      "deleteDocument",
      "getActionableItems",
      "createActionableItem",
      "updateActionableItem",
      "deleteActionableItem",
      "getInvitations",
      "createInvitation",
      "getInvitationByToken",
      "updateInvitation",
      "getInvitationAuditLogs",
      "createInvitationAuditLog",
      "getCommentsByDemand",
      "createDemandComment",
      "getBugs",
      "getBug",
      "createBug",
      "updateBug",
      "getFeatureRequests",
      "getFeatureRequest",
      "createFeatureRequest",
      "updateFeatureRequest",
      "addFeatureRequestUpvote",
      "removeFeatureRequestUpvote"
    ]
  }
}