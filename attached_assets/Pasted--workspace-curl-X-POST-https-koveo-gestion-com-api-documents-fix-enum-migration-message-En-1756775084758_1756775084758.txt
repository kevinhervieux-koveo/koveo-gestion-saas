~/workspace$ curl -X POST https://koveo-gestion.com/api/documents/fix-enum-migration
{"message":"Enum values already in correct order","current_values":["admin","manager","tenant","resident","demo_manager","demo_tenant","demo_resident"],"target_values":["admin","manager","tenant","resident","demo_manager","demo_tenant","demo_resident"],"migration_needed":false}~/workspace$ npm run db:push          npm run db:push

> koveo-gestion@1.0.0 db:push
> npx drizzle-kit push

No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/runner/workspace/drizzle.config.ts'
Using 'pg' driver for database querying
[✓] Pulling schema from database...

+ created_at column will be created
--- all columns conflicts in invitation_audit_log table resolved ---

· You're about to add users_email_unique unique constraint to the table, which contains 58 items. If this statement fails, you will receive an error from the database. Do you want to truncate users table?

· You're about to add permissions_name_unique unique constraint to the table, which contains 9 items. If this statement fails, you will receive an error from the database. Do you want to truncate permissions table?

· You're about to add ssl_certificates_domain_unique unique constraint to the table, which contains 1 items. If this statement fails, you will receive an error from the database. Do you want to truncate ssl_certificates table?

· You're about to add invitations_token_unique unique constraint to the table, which contains 6 items. If this statement fails, you will receive an error from the database. Do you want to truncate invitations table?

· You're about to add password_reset_tokens_token_unique unique constraint to the table, which contains 2 items. If this statement fails, you will receive an error from the database. Do you want to truncate password_reset_tokens table?

· You're about to add bills_bill_number_unique unique constraint to the table, which contains 98 items. If this statement fails, you will receive an error from the database. Do you want to truncate bills table?

· You're about to add documents_gcs_path_unique unique constraint to the table, which contains 7 items. If this statement fails, you will receive an error from the database. Do you want to truncate documents table?

 Warning  Found data-loss statements:
· You're about to delete timestamp column in invitation_audit_log table with 15 items

THIS ACTION WILL CAUSE DATA LOSS AND CANNOT BE REVERTED

Do you still want to push changes?
error: cannot drop type user_role because other objects depend on it
    at /home/runner/workspace/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.query (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:80601:26)
    at async pgPush (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:84411:13)
    at async Object.handler (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:93813:9)
    at async run (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:93059:7) {
  length: 268,
  severity: 'ERROR',
  code: '2BP01',
  detail: 'default value for column role of table invitations depends on type user_role',
  hint: 'Use DROP ... CASCADE to drop the dependent objects too.',
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'dependency.c',
  line: '1204',
  routine: 'reportDependentObjects'
}
~/workspace$ ^C
~/workspace$ npm run db:push --force
npm warn using --force Recommended protections disabled.

> koveo-gestion@1.0.0 db:push
> npx drizzle-kit push

npm warn using --force Recommended protections disabled.
No config path provided, using default 'drizzle.config.ts'
Reading config file '/home/runner/workspace/drizzle.config.ts'
Using 'pg' driver for database querying
[✓] Pulling schema from database...

+ created_at column will be created
--- all columns conflicts in invitation_audit_log table resolved ---

· You're about to add users_email_unique unique constraint to the table, which contains 58 items. If this statement fails, you will receive an error from the database. Do you want to truncate users table?

· You're about to add permissions_name_unique unique constraint to the table, which contains 9 items. If this statement fails, you will receive an error from the database. Do you want to truncate permissions table?

· You're about to add ssl_certificates_domain_unique unique constraint to the table, which contains 1 items. If this statement fails, you will receive an error from the database. Do you want to truncate ssl_certificates table?

· You're about to add invitations_token_unique unique constraint to the table, which contains 6 items. If this statement fails, you will receive an error from the database. Do you want to truncate invitations table?

· You're about to add password_reset_tokens_token_unique unique constraint to the table, which contains 2 items. If this statement fails, you will receive an error from the database. Do you want to truncate password_reset_tokens table?

· You're about to add bills_bill_number_unique unique constraint to the table, which contains 98 items. If this statement fails, you will receive an error from the database. Do you want to truncate bills table?

· You're about to add documents_gcs_path_unique unique constraint to the table, which contains 7 items. If this statement fails, you will receive an error from the database. Do you want to truncate documents table?

 Warning  Found data-loss statements:
· You're about to delete timestamp column in invitation_audit_log table with 15 items

THIS ACTION WILL CAUSE DATA LOSS AND CANNOT BE REVERTED

Do you still want to push changes?
error: cannot drop type user_role because other objects depend on it
    at /home/runner/workspace/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.query (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:80601:26)
    at async pgPush (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:84411:13)
    at async Object.handler (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:93813:9)
    at async run (/home/runner/workspace/node_modules/drizzle-kit/bin.cjs:93059:7) {
  length: 268,
  severity: 'ERROR',
  code: '2BP01',
  detail: 'default value for column role of table invitations depends on type user_role',
  hint: 'Use DROP ... CASCADE to drop the dependent objects too.',
  position: undefined,
  internalPosition: undefined,
  internalQuery: undefined,
  where: undefined,
  schema: undefined,
  table: undefined,
  column: undefined,
  dataType: undefined,
  constraint: undefined,
  file: 'dependency.c',
  line: '1204',
  routine: 'reportDependentObjects'
}