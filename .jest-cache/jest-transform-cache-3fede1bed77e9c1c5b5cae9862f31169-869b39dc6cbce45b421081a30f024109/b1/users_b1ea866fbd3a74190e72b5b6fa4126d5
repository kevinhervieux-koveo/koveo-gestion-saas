1c71eec53f08d7d606b5e5322080a9a7
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerUserRoutes = registerUserRoutes;
const storage_1 = require("../storage");
const schema_1 = require("@shared/schema");
const zod_1 = require("zod");
const auth_1 = require("../auth");
const crypto_1 = require("crypto");
const bcrypt = __importStar(require("bcryptjs"));
// Database-based permissions - no config imports needed
const db_1 = require("../db");
const schema = __importStar(require("../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const input_sanitization_1 = require("../utils/input-sanitization");
const user_creation_logger_1 = require("../utils/user-creation-logger");
const query_cache_1 = require("../query-cache");
const email_service_1 = require("../services/email-service");
/**
 * Registers all user-related API endpoints.
 *
 * @param app - Express application instance.
 */
/**
 * RegisterUserRoutes function.
 * @param app
 * @returns Function result.
 */
function registerUserRoutes(app) {
    /**
     * GET /api/users - Retrieves users with their assignments based on current user's role and organizations.
     */
    app.get('/api/users', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Get users with their full assignment data
            const usersWithAssignments = await storage_1.storage.getUsersWithAssignments();
            // Filter users based on current user's role and permissions
            let filteredUsers;
            if (currentUser.role === 'admin') {
                // Admin can see all users
                filteredUsers = usersWithAssignments;
            }
            else if (['demo_manager', 'demo_tenant', 'demo_resident'].includes(currentUser.role)) {
                // Demo users can only see other demo users
                filteredUsers = usersWithAssignments.filter(user => ['demo_manager', 'demo_tenant', 'demo_resident'].includes(user.role));
            }
            else {
                // Regular managers and other users can only see non-demo users from their organizations
                // Get the organization IDs that the current user has access to
                const userOrgIds = (await storage_1.storage.getUserOrganizations(currentUser.id)).map(org => org.organizationId);
                // Filter users to only include non-demo users from accessible organizations
                filteredUsers = usersWithAssignments.filter(user => {
                    // Exclude demo users from regular manager view
                    if (['demo_manager', 'demo_tenant', 'demo_resident'].includes(user.role)) {
                        return false;
                    }
                    const hasAccess = user.organizations?.some(org => userOrgIds.includes(org.id)) || false;
                    return hasAccess;
                });
            }
            res.json(filteredUsers);
        }
        catch (error) {
            console.error('âŒ Error fetching users:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch users',
            });
        }
    });
    /**
     * GET /api/users/:id - Retrieves a specific user by ID.
     */
    app.get('/api/users/:id', async (req, res) => {
        try {
            const { id } = req.params;
            if (!id) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            const user = await storage_1.storage.getUser(id);
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('âŒ Error fetching user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user',
            });
        }
    });
    /**
     * GET /api/users/email/:email - Retrieves a user by email address.
     */
    app.get('/api/users/email/:email', async (req, res) => {
        try {
            const { email } = req.params;
            if (!email) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'Email is required',
                });
            }
            const user = await storage_1.storage.getUserByEmail(email);
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('âŒ Error fetching user by email:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user',
            });
        }
    });
    /**
     * POST /api/users - Creates a new user.
     */
    app.post('/api/users', async (req, res) => {
        try {
            // Enhanced password validation using utility
            if (req.body.password) {
                const passwordValidation = (0, input_sanitization_1.validatePasswordStrength)(req.body.password);
                if (!passwordValidation.isValid) {
                    return res.status(400).json({
                        error: 'Validation error',
                        message: passwordValidation.message,
                        code: 'WEAK_PASSWORD',
                    });
                }
            }
            // Sanitize and normalize all input data
            const normalizedData = {
                ...req.body,
                email: (0, input_sanitization_1.normalizeEmail)(req.body.email || ''),
                firstName: (0, input_sanitization_1.sanitizeName)(req.body.firstName || ''),
                lastName: (0, input_sanitization_1.sanitizeName)(req.body.lastName || ''),
                phone: req.body.phone ? (0, input_sanitization_1.sanitizeString)(req.body.phone) : '',
                language: req.body.language || 'fr',
            };
            // Generate unique username if not provided
            if (!normalizedData.username && normalizedData.email) {
                const baseUsername = (0, input_sanitization_1.generateUsernameFromEmail)(normalizedData.email);
                let username = baseUsername;
                // Ensure username uniqueness
                let usernameCounter = 1;
                let existingUsername = await db_1.db
                    .select({ username: schema.users.username })
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.username, username))
                    .limit(1);
                while (existingUsername.length > 0) {
                    username = `${baseUsername}${usernameCounter}`;
                    usernameCounter++;
                    existingUsername = await db_1.db
                        .select({ username: schema.users.username })
                        .from(schema.users)
                        .where((0, drizzle_orm_1.eq)(schema.users.username, username))
                        .limit(1);
                }
                normalizedData.username = username;
            }
            const validatedData = schema_1.insertUserSchema.parse(normalizedData);
            // Check if user with email already exists
            const existingUser = await storage_1.storage.getUserByEmail(validatedData.email);
            if (existingUser) {
                return res.status(409).json({
                    _error: 'Conflict',
                    message: 'User with this email already exists',
                });
            }
            const user = await storage_1.storage.createUser(validatedData);
            // Log successful user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: user.id,
                email: user.email,
                role: user.role,
                method: 'direct',
                success: true,
                timestamp: new Date(),
                ipAddress: req.ip,
                userAgent: req.get('User-Agent'),
            });
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.status(201).json(userWithoutPassword);
        }
        catch (error) {
            // Log failed user creation attempt
            (0, user_creation_logger_1.logUserCreation)({
                email: req.body.email || 'unknown',
                role: req.body.role || 'unknown',
                method: 'direct',
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                timestamp: new Date(),
                ipAddress: req.ip,
                userAgent: req.get('User-Agent'),
            });
            if (error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    error: 'Validation error',
                    message: 'Invalid user data',
                    details: error.issues,
                });
            }
            console.error('âŒ Error creating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create user',
            });
        }
    });
    /**
     * PUT /api/users/:id - Updates an existing user.
     */
    app.put('/api/users/:id', async (req, res) => {
        try {
            const { id } = req.params;
            if (!id) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            // Validate the update data (excluding password updates for security)
            const updateSchema = schema_1.insertUserSchema.partial().omit({ password: true });
            const validatedData = updateSchema.parse(req.body);
            const user = await storage_1.storage.updateUser(id, {
                ...validatedData,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            if (error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    error: 'Validation error',
                    message: 'Invalid user data',
                    details: error.issues,
                });
            }
            console.error('âŒ Error updating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update user',
            });
        }
    });
    /**
     * DELETE /api/users/:id - Deactivates a user (soft delete).
     */
    app.delete('/api/users/:id', async (req, res) => {
        try {
            const { id } = req.params;
            if (!id) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            // Soft delete by setting isActive to false
            const user = await storage_1.storage.updateUser(id, {
                isActive: false,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            res.json({
                message: 'User deactivated successfully',
                id: user.id,
            });
        }
        catch (error) {
            console.error('âŒ Error deactivating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to deactivate user',
            });
        }
    });
    /**
     * GET /api/user-organizations - Get current user's organizations.
     */
    app.get('/api/user-organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const organizations = await storage_1.storage.getUserOrganizations(currentUser.id);
            res.json(organizations);
        }
        catch (error) {
            console.error('âŒ Error getting user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user organizations',
            });
        }
    });
    /**
     * GET /api/user-residences - Get current user's residences.
     */
    app.get('/api/user-residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const residences = await storage_1.storage.getUserResidences(currentUser.id);
            res.json(residences);
        }
        catch (error) {
            console.error('âŒ Error getting user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/admin/all-user-organizations - Get user-organization relationships (admin: all, manager: filtered by their orgs).
     */
    app.get('/api/admin/all-user-organizations', auth_1.requireAuth, async (req, res) => {
        console.log('ðŸ” [API] all-user-organizations endpoint called by user:', req.user?.email);
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can access user assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to view user assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let userOrganizations;
            if (currentUser.role === 'admin') {
                // Admin sees all user-organization relationships
                userOrganizations = await db_1.db
                    .select({
                    userId: schema.userOrganizations.userId,
                    organizationId: schema.userOrganizations.organizationId,
                    organizationRole: schema.userOrganizations.organizationRole,
                    isActive: schema.userOrganizations.isActive,
                })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
            }
            else {
                // Manager sees only relationships for their organizations
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (orgIds.length === 0) {
                    return res.json([]);
                }
                userOrganizations = await db_1.db
                    .select({
                    userId: schema.userOrganizations.userId,
                    organizationId: schema.userOrganizations.organizationId,
                    organizationRole: schema.userOrganizations.organizationRole,
                    isActive: schema.userOrganizations.isActive,
                })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, orgIds)));
            }
            res.json(userOrganizations);
        }
        catch (error) {
            console.error('âŒ Error getting all user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user organizations',
            });
        }
    });
    /**
     * GET /api/admin/all-user-residences - Get user-residence relationships (admin: all, manager: filtered by their orgs).
     */
    app.get('/api/admin/all-user-residences', auth_1.requireAuth, async (req, res) => {
        console.log('ðŸ” [API] all-user-residences endpoint called by user:', req.user?.email);
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can access user assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to view user assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let userResidences;
            if (currentUser.role === 'admin') {
                // Admin sees all user-residence relationships
                userResidences = await db_1.db
                    .select({
                    userId: schema.userResidences.userId,
                    residenceId: schema.userResidences.residenceId,
                    relationshipType: schema.userResidences.relationshipType,
                    startDate: schema.userResidences.startDate,
                    endDate: schema.userResidences.endDate,
                    isActive: schema.userResidences.isActive,
                })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
            }
            else {
                // Manager sees only relationships for residences in their organizations
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (orgIds.length === 0) {
                    return res.json([]);
                }
                // Get residences in manager's organizations
                const accessibleResidences = await db_1.db
                    .select({ residenceId: schema.residences.id })
                    .from(schema.residences)
                    .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                const residenceIds = accessibleResidences.map((res) => res.residenceId);
                if (residenceIds.length === 0) {
                    return res.json([]);
                }
                userResidences = await db_1.db
                    .select({
                    userId: schema.userResidences.userId,
                    residenceId: schema.userResidences.residenceId,
                    relationshipType: schema.userResidences.relationshipType,
                    startDate: schema.userResidences.startDate,
                    endDate: schema.userResidences.endDate,
                    isActive: schema.userResidences.isActive,
                })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.inArray)(schema.userResidences.residenceId, residenceIds)));
            }
            res.json(userResidences);
        }
        catch (error) {
            console.error('âŒ Error getting all user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/user/permissions - Retrieves the current user's permissions based on their role.
     * Protected endpoint that requires authentication.
     */
    app.get('/api/user/permissions', auth_1.requireAuth, async (req, res) => {
        try {
            // Get user role from session
            const userRole = req.user?.role;
            if (!userRole) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User role not found in session',
                });
            }
            // Get permissions for the user's role from database
            const rolePermissions = await storage_1.storage.getRolePermissions();
            const userPermissions = rolePermissions
                .filter((rp) => rp.role === userRole)
                .map((rp) => rp.permission?.name)
                .filter(Boolean);
            // Create response with Zod validation
            const responseData = {
                role: userRole,
                permissions: userPermissions,
                permissionCount: userPermissions.length,
            };
            // Validate response with Zod schema
            const permissionsResponseSchema = zod_1.z.object({
                role: zod_1.z.enum(['admin', 'manager', 'tenant', 'resident']),
                permissions: zod_1.z.array(zod_1.z.string()),
                permissionCount: zod_1.z.number(),
            });
            const validatedResponse = permissionsResponseSchema.parse(responseData);
            res.json(validatedResponse);
        }
        catch (error) {
            if (error instanceof zod_1.z.ZodError) {
                return res.status(500).json({
                    error: 'Internal server error',
                    message: 'Failed to validate permissions response',
                    details: error.issues,
                });
            }
            console.error('âŒ Error fetching user permissions:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user permissions',
            });
        }
    });
    /**
     * PUT /api/users/:id/organizations - Updates user's organization assignments.
     * Admin: can assign/remove any organization
     * Manager: cannot modify organization assignments.
     */
    app.put('/api/users/:id/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            const { organizationIds } = req.body;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins can modify organization assignments
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Only administrators can modify organization assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!userId || !Array.isArray(organizationIds)) {
                return res.status(400).json({
                    message: 'User ID and organization IDs array are required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify user exists
            const user = await storage_1.storage.getUser(userId);
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove existing organization assignments
            await db_1.db.delete(schema.userOrganizations).where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId));
            // Add new organization assignments
            if (organizationIds.length > 0) {
                const newAssignments = organizationIds.map((orgId) => ({
                    userId,
                    organizationId: orgId,
                    organizationRole: user.role,
                    isActive: true,
                }));
                await db_1.db.insert(schema.userOrganizations).values(newAssignments);
            }
            res.json({
                message: 'Organization assignments updated successfully',
                userId,
                organizationIds,
            });
        }
        catch (error) {
            console.error('âŒ Error updating organization assignments:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update organization assignments',
            });
        }
    });
    /**
     * GET /api/users/:id/residences - Get user's accessible residences.
     */
    app.get('/api/users/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Users can only access their own residences unless they're admin/manager
            if (currentUser.id !== userId && !['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const residences = await storage_1.storage.getUserResidences(userId);
            res.json(residences);
        }
        catch (error) {
            console.error('âŒ Error getting user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/users/:id/buildings - Get user's accessible buildings based on their residences.
     */
    app.get('/api/users/:id/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Users can only access their own buildings unless they're admin/manager
            if (currentUser.id !== userId && !['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get user's residences with building information
            const userResidences = await db_1.db
                .select({
                residenceId: schema.userResidences.residenceId,
                buildingId: schema.residences.buildingId,
            })
                .from(schema.userResidences)
                .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
            if (!userResidences || userResidences.length === 0) {
                return res.json({ buildings: [] });
            }
            // Get unique building IDs from user's residences
            const buildingIds = [...new Set(userResidences.map(ur => ur.buildingId).filter(Boolean))];
            if (buildingIds.length === 0) {
                return res.json({ buildings: [] });
            }
            // Fetch building details with stats using the existing logic from /api/manager/buildings
            const buildingDetails = await db_1.db
                .select({
                id: schema.buildings.id,
                name: schema.buildings.name,
                address: schema.buildings.address,
                city: schema.buildings.city,
                province: schema.buildings.province,
                postalCode: schema.buildings.postalCode,
                buildingType: schema.buildings.buildingType,
                yearBuilt: schema.buildings.yearBuilt,
                totalFloors: schema.buildings.totalFloors,
                parkingSpaces: schema.buildings.parkingSpaces,
                storageSpaces: schema.buildings.storageSpaces,
                managementCompany: schema.buildings.managementCompany,
                amenities: schema.buildings.amenities,
                organizationId: schema.buildings.organizationId,
                organizationName: schema.organizations.name,
                organizationType: schema.organizations.type,
            })
                .from(schema.buildings)
                .leftJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.buildings.organizationId, schema.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.id, buildingIds), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
            // Calculate stats for each building
            const buildingsWithStats = await Promise.all(buildingDetails.map(async (building) => {
                const [totalUnits, occupiedUnits] = await Promise.all([
                    db_1.db
                        .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                        .from(schema.residences)
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, building.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)))
                        .then(result => result[0]?.count || 0),
                    db_1.db
                        .select({ count: (0, drizzle_orm_1.sql) `count(distinct ${schema.residences.id})` })
                        .from(schema.residences)
                        .leftJoin(schema.userResidences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, building.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)))
                        .then(result => result[0]?.count || 0),
                ]);
                const vacantUnits = totalUnits - occupiedUnits;
                const occupancyRate = totalUnits > 0 ? (occupiedUnits / totalUnits) * 100 : 0;
                return {
                    ...building,
                    totalUnits,
                    occupiedUnits,
                    vacantUnits,
                    occupancyRate,
                };
            }));
            res.json({ buildings: buildingsWithStats });
        }
        catch (error) {
            console.error('âŒ Error getting user buildings:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user buildings',
            });
        }
    });
    /**
     * PUT /api/users/:id/residences - Updates user's residence assignments.
     * Admin: can assign/remove any residence
     * Manager: can assign/remove residences within their organizations only.
     */
    app.put('/api/users/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            const { residenceAssignments } = req.body; // Array of { residenceId, relationshipType, startDate, endDate }
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can modify residence assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to modify residence assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!userId || !Array.isArray(residenceAssignments)) {
                return res.status(400).json({
                    message: 'User ID and residence assignments array are required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify user exists
            const user = await storage_1.storage.getUser(userId);
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // For managers, verify they can access all requested residences
            if (currentUser.role === 'manager') {
                for (const assignment of residenceAssignments) {
                    // Get the building for this residence
                    const residence = await db_1.db
                        .select({ buildingId: schema.residences.buildingId })
                        .from(schema.residences)
                        .where((0, drizzle_orm_1.eq)(schema.residences.id, assignment.residenceId))
                        .limit(1);
                    if (residence.length === 0) {
                        return res.status(404).json({
                            message: `Residence ${assignment.residenceId} not found`,
                            code: 'RESIDENCE_NOT_FOUND',
                        });
                    }
                    // Check if manager has access to this building
                    // Get buildings accessible to this manager through their organizations
                    const managerOrgs = await db_1.db
                        .select({ organizationId: schema.userOrganizations.organizationId })
                        .from(schema.userOrganizations)
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                    const orgIds = managerOrgs.map((org) => org.organizationId);
                    const accessibleBuildings = orgIds.length > 0
                        ? await db_1.db
                            .select({ id: schema.buildings.id })
                            .from(schema.buildings)
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)))
                        : [];
                    const hasAccess = accessibleBuildings.some((b) => b.id === residence[0].buildingId);
                    if (!hasAccess) {
                        return res.status(403).json({
                            message: `Insufficient permissions for residence ${assignment.residenceId}`,
                            code: 'INSUFFICIENT_PERMISSIONS',
                        });
                    }
                }
            }
            // Remove existing residence assignments
            await db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId));
            // Add new residence assignments
            if (residenceAssignments.length > 0) {
                const newAssignments = residenceAssignments.map((assignment) => ({
                    userId,
                    residenceId: assignment.residenceId,
                    relationshipType: assignment.relationshipType || 'tenant',
                    startDate: assignment.startDate || new Date().toISOString().split('T')[0],
                    endDate: assignment.endDate || null,
                    isActive: true,
                }));
                await db_1.db.insert(schema.userResidences).values(newAssignments);
            }
            res.json({
                message: 'Residence assignments updated successfully',
                userId,
                assignmentCount: residenceAssignments.length,
            });
        }
        catch (error) {
            console.error('âŒ Error updating residence assignments:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update residence assignments',
            });
        }
    });
    /**
     * GET /api/users/me/organizations - Get organizations accessible to current user.
     * Used by invite form to populate organization dropdown.
     */
    app.get('/api/users/me/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            console.log(`ðŸ“Š Fetching user-accessible organizations for ${currentUser.email} (${currentUser.role})`);
            // Get organizations based on user role - same logic as /api/organizations
            let organizationsQuery;
            if (currentUser.role === 'admin') {
                // Admin can see all organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema.organizations.id,
                    name: schema.organizations.name,
                    type: schema.organizations.type,
                    address: schema.organizations.address,
                    city: schema.organizations.city,
                    province: schema.organizations.province,
                    postalCode: schema.organizations.postalCode,
                    phone: schema.organizations.phone,
                    email: schema.organizations.email,
                    website: schema.organizations.website,
                    registrationNumber: schema.organizations.registrationNumber,
                    isActive: schema.organizations.isActive,
                    createdAt: schema.organizations.createdAt,
                })
                    .from(schema.organizations)
                    .where((0, drizzle_orm_1.eq)(schema.organizations.isActive, true))
                    .orderBy(schema.organizations.name);
            }
            else {
                // Other users see organizations they have access to through user_organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema.organizations.id,
                    name: schema.organizations.name,
                    type: schema.organizations.type,
                    address: schema.organizations.address,
                    city: schema.organizations.city,
                    province: schema.organizations.province,
                    postalCode: schema.organizations.postalCode,
                    phone: schema.organizations.phone,
                    email: schema.organizations.email,
                    website: schema.organizations.website,
                    registrationNumber: schema.organizations.registrationNumber,
                    isActive: schema.organizations.isActive,
                    createdAt: schema.organizations.createdAt,
                })
                    .from(schema.organizations)
                    .innerJoin(schema.userOrganizations, (0, drizzle_orm_1.eq)(schema.organizations.id, schema.userOrganizations.organizationId))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.organizations.isActive, true), (0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)))
                    .orderBy(schema.organizations.name);
            }
            const accessibleOrganizations = await organizationsQuery;
            console.log(`âœ… Found ${accessibleOrganizations.length} organizations for user ${currentUser.id}`);
            // Return array directly (not wrapped in object) - same format as /api/organizations
            res.json(accessibleOrganizations);
        }
        catch (error) {
            console.error('âŒ Error fetching user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user organizations',
            });
        }
    });
    /**
     * GET /api/users/me/data-export - Download user data for Law 25 compliance.
     */
    app.get('/api/users/me/data-export', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Get all user data for export
            const userData = await storage_1.storage.getUser(currentUser.id);
            if (!userData) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove sensitive fields
            const { password, ...userDataExport } = userData;
            // Get related data
            const [organizations, residences, bills, documents, notifications, maintenanceRequests] = await Promise.all([
                db_1.db
                    .select()
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.bills)
                    .innerJoin(schema.userResidences, (0, drizzle_orm_1.eq)(schema.bills.residenceId, schema.userResidences.residenceId))
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.notifications)
                    .where((0, drizzle_orm_1.eq)(schema.notifications.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.maintenanceRequests)
                    .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, currentUser.id)),
            ]);
            const exportData = {
                personalInformation: userDataExport,
                organizations,
                residences,
                bills: bills.map((b) => b.bills),
                documents: documents,
                notifications,
                maintenanceRequests,
                exportDate: new Date().toISOString(),
                note: 'This export contains all personal data we have on file for you in compliance with Quebec Law 25.',
            };
            res.setHeader('Content-Type', 'application/json');
            res.setHeader('Content-Disposition', `attachment; filename="user-data-export-${currentUser.id}-${new Date().toISOString().split('T')[0]}.json"`);
            res.json(exportData);
        }
        catch (error) {
            console.error('âŒ Error exporting user data:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to export user data',
            });
        }
    });
    /**
     * POST /api/users/me/delete-account - Complete account deletion for Law 25 compliance.
     */
    app.post('/api/users/me/delete-account', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { confirmEmail, reason } = req.body;
            // Verify email confirmation
            if (confirmEmail !== currentUser.email) {
                return res.status(400).json({
                    message: 'Email confirmation does not match',
                    code: 'EMAIL_MISMATCH',
                });
            }
            // Delete all related data in the correct order to handle foreign key constraints
            await Promise.all([
                // Delete user relationships
                db_1.db
                    .delete(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id)),
                db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .delete(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, currentUser.id)),
                // Delete user-created content
                db_1.db.delete(schema.notifications).where((0, drizzle_orm_1.eq)(schema.notifications.userId, currentUser.id)),
                db_1.db
                    .delete(schema.maintenanceRequests)
                    .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, currentUser.id)),
                // Delete invitations
                db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, currentUser.email)),
            ]);
            // Finally, delete the user account
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, currentUser.id));
            // Log the deletion for audit purposes
            console.log(`User account deleted: ${currentUser.email} (${currentUser.id}). Reason: ${reason || 'Not provided'}`);
            // Clear session
            if (req.session) {
                req.session.destroy((err) => {
                    if (err) {
                        console.error('Failed to destroy session after account deletion:', err);
                    }
                });
            }
            res.json({
                message: 'Account successfully deleted. All personal data has been permanently removed from our systems.',
                deletionDate: new Date().toISOString(),
            });
        }
        catch (error) {
            console.error('âŒ Error deleting account:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to delete account. Please contact support.',
            });
        }
    });
    /**
     * PUT /api/users/me - Update current user's profile.
     */
    app.put('/api/users/me', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate the update data (excluding password updates for security)
            const updateSchema = schema_1.insertUserSchema
                .partial()
                .omit({ password: true, id: true, role: true });
            const validatedData = updateSchema.parse(req.body);
            const user = await storage_1.storage.updateUser(currentUser.id, {
                ...validatedData,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('âŒ Error updating user profile:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update profile',
            });
        }
    });
    /**
     * POST /api/users/:id/delete-account - RESTRICTED Admin endpoint to delete any user account.
     * SAFETY: Requires email confirmation and deletion reason for audit trail.
     * WARNING: This is a permanent operation that should only be used in exceptional cases.
     */
    app.post('/api/users/:id/delete-account', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: targetUserId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins can delete other users' accounts
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Only administrators can delete user accounts',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Additional safety check: Log this critical operation
            console.warn(`âš ï¸  CRITICAL: Admin ${currentUser.email} attempting to delete user ${targetUserId}`);
            if (!targetUserId) {
                return res.status(400).json({
                    message: 'User ID is required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify target user exists
            const targetUser = await storage_1.storage.getUser(targetUserId);
            if (!targetUser) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            const { confirmEmail, reason } = req.body;
            // Verify email confirmation
            if (confirmEmail !== targetUser.email) {
                return res.status(400).json({
                    message: 'Email confirmation does not match',
                    code: 'EMAIL_MISMATCH',
                });
            }
            // Delete all related data in the correct order to handle foreign key constraints
            const deletionPromises = [
                // Delete user relationships
                db_1.db
                    .delete(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, targetUserId)),
                db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, targetUserId)),
                db_1.db
                    .delete(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, targetUserId)),
                // Delete invitations
                db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, targetUser.email)),
            ];
            // Try to delete from optional tables that might not exist
            const optionalDeletions = [
                async () => {
                    try {
                        await db_1.db
                            .delete(schema.notifications)
                            .where((0, drizzle_orm_1.eq)(schema.notifications.userId, targetUserId));
                    }
                    catch (error) {
                        if (error.cause?.code === '42P01') {
                            console.log('Notifications table not found, skipping...');
                        }
                        else {
                            throw error;
                        }
                    }
                },
                async () => {
                    try {
                        await db_1.db
                            .delete(schema.maintenanceRequests)
                            .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, targetUserId));
                    }
                    catch (error) {
                        if (error.cause?.code === '42P01') {
                            console.log('Maintenance requests table not found, skipping...');
                        }
                        else {
                            throw error;
                        }
                    }
                },
            ];
            // Execute core deletions first
            await Promise.all(deletionPromises);
            // Execute optional deletions
            await Promise.all(optionalDeletions.map((fn) => fn()));
            // Finally, delete the user account
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, targetUserId));
            // Clear all caches to ensure the user list updates immediately
            query_cache_1.queryCache.invalidate('users', 'all_users');
            query_cache_1.queryCache.invalidate('users', `user:${targetUserId}`);
            query_cache_1.queryCache.invalidate('users', `user_email:${targetUser.email}`);
            // Log the deletion for audit purposes
            console.log(`User account deleted by admin ${currentUser.email} (${currentUser.id}): ${targetUser.email} (${targetUserId}). Reason: ${reason || 'Not provided'}`);
            res.json({
                message: 'User account and all associated data have been permanently deleted',
                deletedUserId: targetUserId,
                deletedUserEmail: targetUser.email,
            });
        }
        catch (error) {
            console.error('âŒ Error deleting user account:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to delete user account',
            });
        }
    });
    /**
     * POST /api/users/me/change-password - Change current user's password.
     */
    app.post('/api/users/me/change-password', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { currentPassword, newPassword } = req.body;
            if (!currentPassword || !newPassword) {
                return res.status(400).json({
                    message: 'Current password and new password are required',
                    code: 'INVALID_INPUT',
                });
            }
            // Verify current password
            const user = await storage_1.storage.getUser(currentUser.id);
            if (!user || !(await bcrypt.compare(currentPassword, user.password))) {
                return res.status(400).json({
                    message: 'Current password is incorrect',
                    code: 'INVALID_PASSWORD',
                });
            }
            // Hash new password
            const hashedPassword = await bcrypt.hash(newPassword, 12);
            // Update password
            await storage_1.storage.updateUser(currentUser.id, {
                password: hashedPassword,
                updatedAt: new Date(),
            });
            res.json({
                message: 'Password changed successfully',
            });
        }
        catch (error) {
            console.error('âŒ Error changing password:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to change password',
            });
        }
    });
    /**
     * POST /api/users/demo - Creates a demo user directly without invitation
     */
    app.post('/api/users/demo', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can create demo users
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const { firstName, lastName, role, organizationId, residenceId } = req.body;
            // Validate demo role
            if (!['demo_manager', 'demo_tenant', 'demo_resident'].includes(role)) {
                return res.status(400).json({
                    message: 'Invalid demo role',
                    code: 'INVALID_ROLE',
                });
            }
            // Validate required fields
            if (!firstName || !lastName || !organizationId) {
                return res.status(400).json({
                    message: 'First name, last name, and organization are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Generate demo email
            const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@demo.com`;
            // Check if user already exists
            const existingUser = await storage_1.storage.getUserByEmail(email);
            if (existingUser) {
                return res.status(400).json({
                    message: 'Demo user with this name already exists',
                    code: 'USER_EXISTS',
                });
            }
            // Create demo user with secure random password
            const randomPassword = (0, crypto_1.randomBytes)(12).toString('base64');
            const hashedPassword = await bcrypt.hash(`Demo${randomPassword}!`, 12);
            const userData = {
                firstName: (0, input_sanitization_1.sanitizeName)(firstName),
                lastName: (0, input_sanitization_1.sanitizeName)(lastName),
                email: (0, input_sanitization_1.normalizeEmail)(email),
                username: (0, input_sanitization_1.generateUsernameFromEmail)(email),
                password: hashedPassword,
                language: 'fr', // Default to French for Quebec
                role: role,
                isActive: true,
            };
            const newUser = await storage_1.storage.createUser(userData);
            // Log the user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: newUser.id,
                email: newUser.email,
                method: 'direct',
                role,
                success: true,
                timestamp: new Date(),
            });
            // Clear cache
            query_cache_1.queryCache.invalidate('users', 'all_users');
            res.status(201).json({
                message: 'Demo user created successfully',
                user: {
                    id: newUser.id,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    email: newUser.email,
                    role: newUser.role,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error creating demo user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create demo user',
            });
        }
    });
    /**
     * POST /api/invitations - Creates a new invitation
     */
    app.post('/api/invitations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can send invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const { organizationId, residenceId, email, role, invitedByUserId, expiresAt, personalMessage, } = req.body;
            // Validate required fields first
            if (!organizationId || !email || !role || !expiresAt) {
                return res.status(400).json({
                    message: 'Organization, email, role, and expiry date are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Then validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                return res.status(400).json({
                    message: 'Invalid email format',
                    code: 'INVALID_EMAIL',
                });
            }
            // Validate role permissions
            if (currentUser.role === 'manager') {
                // Check if manager is trying to invite admin
                if (role === 'admin') {
                    return res.status(403).json({
                        message: 'Managers can only invite resident, tenant, and manager roles',
                        code: 'ROLE_PERMISSION_DENIED',
                    });
                }
                // Get the demo organization to check if it's a demo org
                const targetOrg = await db_1.db
                    .select()
                    .from(schema.organizations)
                    .where((0, drizzle_orm_1.eq)(schema.organizations.id, organizationId))
                    .limit(1);
                if (targetOrg.length > 0 && targetOrg[0].type === 'Demo') {
                    // For demo organizations, allow normal roles (resident, tenant, manager)
                    if (!['resident', 'tenant', 'manager'].includes(role)) {
                        return res.status(403).json({
                            message: 'Invalid role for demo organization',
                            code: 'INVALID_DEMO_ROLE',
                        });
                    }
                }
                else {
                    // For regular organizations, managers can invite resident, tenant, manager
                    if (!['resident', 'tenant', 'manager'].includes(role)) {
                        return res.status(403).json({
                            message: 'Managers can only invite resident, tenant, and manager roles',
                            code: 'ROLE_PERMISSION_DENIED',
                        });
                    }
                }
            }
            // Check if user already exists
            const existingUser = await storage_1.storage.getUserByEmail(email);
            if (existingUser) {
                return res.status(400).json({
                    message: 'User with this email already exists',
                    code: 'USER_EXISTS',
                });
            }
            // Check for existing pending invitations for the same email and organization
            // If found, delete them to replace with new invitation
            const existingInvitations = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.email, email), (0, drizzle_orm_1.eq)(schema.invitations.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.invitations.status, 'pending')));
            if (existingInvitations.length > 0) {
                console.log(`ðŸ”„ Replacing ${existingInvitations.length} existing invitation(s) for email: ${email}`);
                // Delete existing pending invitations for this email/organization
                await db_1.db
                    .delete(schema.invitations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.email, email), (0, drizzle_orm_1.eq)(schema.invitations.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.invitations.status, 'pending')));
            }
            // Generate secure invitation token
            const token = (0, crypto_1.randomBytes)(32).toString('hex');
            const tokenHash = (0, crypto_1.createHash)('sha256').update(token).digest('hex');
            // Create invitation record
            const invitationData = {
                organizationId,
                residenceId: residenceId || null,
                email,
                token,
                tokenHash,
                role: role,
                invitedByUserId: currentUser.id,
                expiresAt: new Date(expiresAt),
                personalMessage: personalMessage || null,
            };
            const [newInvitation] = await db_1.db
                .insert(schema.invitations)
                .values(invitationData)
                .returning();
            // Get organization details for email
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, organizationId))
                .limit(1);
            // Send invitation email
            const recipientName = email.split('@')[0]; // Use email prefix as name
            const organizationName = organization?.name || 'Koveo Gestion';
            const inviterName = `${currentUser.firstName || currentUser.email} ${currentUser.lastName || ''}`.trim();
            const emailSent = await email_service_1.emailService.sendInvitationEmail(email, recipientName, token, // Use the unhashed token for the email URL
            organizationName, inviterName, new Date(expiresAt), 'fr', // Default to French for Quebec
            personalMessage);
            // Log invitation creation
            console.log('âœ… Invitation created:', {
                id: newInvitation.id,
                email,
                role,
                organizationId,
                invitedBy: currentUser.email,
                emailSent,
            });
            // For tests, we'll treat email failure as success since tests may not have email configured
            if (!emailSent && process.env.NODE_ENV !== 'test') {
                // If email failed but invitation was created, log the issue
                console.error('âš ï¸ Invitation created but email failed to send');
                return res.status(207).json({
                    message: 'Invitation created but email failed to send',
                    invitationId: newInvitation.id,
                    emailSent: false,
                });
            }
            res.status(201).json({
                message: 'Invitation sent successfully',
                invitationId: newInvitation.id,
                emailSent: true,
            });
        }
        catch (error) {
            console.error('âŒ Error creating invitation:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create invitation',
            });
        }
    });
    /**
     * GET /api/invitations - Gets all invitations (admin/manager only)
     */
    app.get('/api/invitations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can view invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let invitations;
            if (currentUser.role === 'admin') {
                // Admin can see all invitations
                invitations = await db_1.db
                    .select()
                    .from(schema.invitations)
                    .orderBy(schema.invitations.createdAt);
            }
            else {
                // Managers can only see invitations they sent
                invitations = await db_1.db
                    .select()
                    .from(schema.invitations)
                    .where((0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, currentUser.id))
                    .orderBy(schema.invitations.createdAt);
            }
            res.json(invitations);
        }
        catch (error) {
            console.error('âŒ Error fetching invitations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch invitations',
            });
        }
    });
    /**
     * POST /api/invitations/validate - Validates an invitation token
     * Public endpoint for invitation validation during registration
     */
    app.post('/api/invitations/validate', async (req, res) => {
        try {
            const { token } = req.body;
            if (!token) {
                return res.status(400).json({
                    isValid: false,
                    message: 'Token is required',
                    code: 'TOKEN_REQUIRED',
                });
            }
            // Get invitation by token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    isValid: false,
                    message: 'Invitation not found or invalid token',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check if invitation is expired
            const now = new Date();
            const expiresAt = new Date(invitation.expiresAt);
            if (now > expiresAt) {
                return res.status(400).json({
                    isValid: false,
                    message: 'Invitation has expired',
                    code: 'INVITATION_EXPIRED',
                });
            }
            // Check if invitation is already used
            if (invitation.status === 'accepted') {
                return res.status(400).json({
                    isValid: false,
                    message: 'Invitation has already been used',
                    code: 'INVITATION_ALREADY_USED',
                });
            }
            // Get organization information
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, invitation.organizationId))
                .limit(1);
            // Get inviter information
            const [inviter] = await db_1.db
                .select({
                id: schema.users.id,
                firstName: schema.users.firstName,
                lastName: schema.users.lastName,
                email: schema.users.email,
            })
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, invitation.invitedByUserId))
                .limit(1);
            // Return successful validation
            res.json({
                isValid: true,
                invitation: {
                    id: invitation.id,
                    email: invitation.email,
                    role: invitation.role,
                    expiresAt: invitation.expiresAt,
                    createdAt: invitation.createdAt,
                },
                organizationName: organization?.name || 'Unknown Organization',
                inviterName: inviter ? `${inviter.firstName} ${inviter.lastName}`.trim() : 'Unknown User',
            });
        }
        catch (error) {
            console.error('âŒ Error validating invitation:', error);
            res.status(500).json({
                isValid: false,
                message: 'Internal server error during validation',
                code: 'VALIDATION_ERROR',
            });
        }
    });
    /**
     * POST /api/invitations/accept/:token - Accept an invitation and create user account
     * Public endpoint for completing registration via invitation
     */
    app.post('/api/invitations/accept/:token', async (req, res) => {
        try {
            const { token } = req.params;
            const { firstName, lastName, password, phone, language, dataCollectionConsent, marketingConsent, analyticsConsent, thirdPartyConsent, acknowledgedRights, } = req.body;
            if (!token) {
                return res.status(400).json({
                    message: 'Token is required',
                    code: 'TOKEN_REQUIRED',
                });
            }
            // Get invitation by token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    message: 'Invitation not found or invalid token',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check if invitation is expired
            const now = new Date();
            const expiresAt = new Date(invitation.expiresAt);
            if (now > expiresAt) {
                return res.status(400).json({
                    message: 'Invitation has expired',
                    code: 'INVITATION_EXPIRED',
                });
            }
            // Check if invitation is already used
            if (invitation.status === 'accepted') {
                return res.status(400).json({
                    message: 'Invitation has already been used',
                    code: 'INVITATION_ALREADY_USED',
                });
            }
            // Validate required fields
            if (!firstName || !lastName || !password) {
                return res.status(400).json({
                    message: 'First name, last name, and password are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Validate required consents
            if (!dataCollectionConsent || !acknowledgedRights) {
                return res.status(400).json({
                    message: 'Required privacy consents must be given',
                    code: 'MISSING_REQUIRED_CONSENTS',
                });
            }
            // Hash password
            const hashedPassword = await bcrypt.hash(password, 12);
            // Create user account
            const userData = {
                firstName: (0, input_sanitization_1.sanitizeName)(firstName),
                lastName: (0, input_sanitization_1.sanitizeName)(lastName),
                email: (0, input_sanitization_1.normalizeEmail)(invitation.email),
                username: (0, input_sanitization_1.generateUsernameFromEmail)(invitation.email),
                password: hashedPassword,
                phone: phone ? (0, input_sanitization_1.sanitizeString)(phone) : '',
                language: language || 'fr',
                role: invitation.role,
                isActive: true,
                organizationId: invitation.organizationId,
            };
            const newUser = await storage_1.storage.createUser(userData);
            // Create organization assignment if organizationId is provided
            if (invitation.organizationId) {
                await db_1.db.insert(schema.userOrganizations).values({
                    userId: newUser.id,
                    organizationId: invitation.organizationId,
                    organizationRole: invitation.role,
                    isActive: true,
                });
                console.log('âœ… User assigned to organization:', {
                    userId: newUser.id,
                    organizationId: invitation.organizationId,
                    role: invitation.role,
                });
            }
            // Create residence assignment if residenceId is provided
            if (invitation.residenceId) {
                await db_1.db.insert(schema.userResidences).values({
                    userId: newUser.id,
                    residenceId: invitation.residenceId,
                    relationshipType: invitation.role === 'tenant' ? 'tenant' : 'occupant',
                    startDate: new Date(),
                    isActive: true,
                });
                console.log('âœ… User assigned to residence:', {
                    userId: newUser.id,
                    residenceId: invitation.residenceId,
                    relationshipType: invitation.role === 'tenant' ? 'tenant' : 'occupant',
                });
            }
            // Mark invitation as accepted
            await db_1.db
                .update(schema.invitations)
                .set({
                status: 'accepted',
                acceptedAt: new Date(),
                acceptedBy: newUser.id,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, invitation.id));
            // Log user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: newUser.id,
                email: newUser.email,
                method: 'invitation',
                role: invitation.role,
                success: true,
                timestamp: new Date(),
            });
            // Clear cache
            query_cache_1.queryCache.invalidate('users', 'all_users');
            query_cache_1.queryCache.invalidate('invitations');
            console.log('âœ… User created via invitation acceptance:', {
                userId: newUser.id,
                email: newUser.email,
                role: newUser.role,
                organizationId: invitation.organizationId,
                residenceId: invitation.residenceId,
                assignedToOrganization: !!invitation.organizationId,
                assignedToResidence: !!invitation.residenceId,
            });
            res.status(201).json({
                message: 'Account created successfully',
                user: {
                    id: newUser.id,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    email: newUser.email,
                    role: newUser.role,
                    language: newUser.language,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error accepting invitation:', error);
            res.status(500).json({
                message: 'Internal server error during account creation',
                code: 'INVITATION_ACCEPT_ERROR',
            });
        }
    });
    /**
     * POST /api/invitations/:id/resend - Resends an invitation
     */
    app.post('/api/invitations/:id/resend', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { id } = req.params;
            // Get invitation
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    message: 'Invitation not found',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check permissions
            if (currentUser.role !== 'admin' && invitation.invitedByUserId !== currentUser.id) {
                return res.status(403).json({
                    message: 'Can only resend your own invitations',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Update invitation with new expiry
            const newExpiresAt = new Date();
            newExpiresAt.setDate(newExpiresAt.getDate() + 7); // Extend by 7 days
            await db_1.db
                .update(schema.invitations)
                .set({
                expiresAt: newExpiresAt,
                status: 'pending',
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id));
            // Get organization details for email
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, invitation.organizationId))
                .limit(1);
            // Send invitation email again
            const recipientName = invitation.email.split('@')[0]; // Use email prefix as name
            const organizationName = organization?.name || 'Koveo Gestion';
            const inviterName = `${currentUser.firstName || currentUser.email} ${currentUser.lastName || ''}`.trim();
            const emailSent = await email_service_1.emailService.sendInvitationEmail(invitation.email, recipientName, invitation.token, // Use the existing token
            organizationName, inviterName, newExpiresAt, 'fr', // Default to French for Quebec
            invitation.personalMessage);
            console.log('âœ… Invitation resent:', {
                id,
                email: invitation.email,
                newExpiresAt,
                emailSent,
            });
            if (!emailSent) {
                console.error('âš ï¸ Invitation updated but email failed to resend');
                return res.status(207).json({
                    message: 'Invitation updated but email failed to resend',
                    emailSent: false,
                });
            }
            res.json({
                message: 'Invitation resent successfully',
                emailSent: true,
            });
        }
        catch (error) {
            console.error('âŒ Error resending invitation:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to resend invitation',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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O2FBQ2hCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsK0JBQStCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDdEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSx1QkFBdUI7Z0JBQzlCLE9BQU8sRUFBRSw2QkFBNkI7YUFDdkMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvdXNlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBFeHByZXNzIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBzdG9yYWdlIH0gZnJvbSAnLi4vc3RvcmFnZSc7XG5pbXBvcnQgeyBpbnNlcnRVc2VyU2NoZW1hLCB0eXBlIFVzZXIsIHR5cGUgSW5zZXJ0VXNlciB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgcmVxdWlyZUF1dGggfSBmcm9tICcuLi9hdXRoJztcbmltcG9ydCB7IGNyZWF0ZUhhc2gsIHJhbmRvbUJ5dGVzIH0gZnJvbSAnY3J5cHRvJztcbmltcG9ydCAqIGFzIGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG4vLyBEYXRhYmFzZS1iYXNlZCBwZXJtaXNzaW9ucyAtIG5vIGNvbmZpZyBpbXBvcnRzIG5lZWRlZFxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSwgYW5kLCBpbkFycmF5LCBzcWwgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQge1xuICBzYW5pdGl6ZVN0cmluZyxcbiAgc2FuaXRpemVOYW1lLFxuICBub3JtYWxpemVFbWFpbCxcbiAgdmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoLFxuICBnZW5lcmF0ZVVzZXJuYW1lRnJvbUVtYWlsLFxufSBmcm9tICcuLi91dGlscy9pbnB1dC1zYW5pdGl6YXRpb24nO1xuaW1wb3J0IHsgbG9nVXNlckNyZWF0aW9uIH0gZnJvbSAnLi4vdXRpbHMvdXNlci1jcmVhdGlvbi1sb2dnZXInO1xuaW1wb3J0IHsgcXVlcnlDYWNoZSB9IGZyb20gJy4uL3F1ZXJ5LWNhY2hlJztcbmltcG9ydCB7IGVtYWlsU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2VtYWlsLXNlcnZpY2UnO1xuXG4vKipcbiAqIFJlZ2lzdGVycyBhbGwgdXNlci1yZWxhdGVkIEFQSSBlbmRwb2ludHMuXG4gKlxuICogQHBhcmFtIGFwcCAtIEV4cHJlc3MgYXBwbGljYXRpb24gaW5zdGFuY2UuXG4gKi9cbi8qKlxuICogUmVnaXN0ZXJVc2VyUm91dGVzIGZ1bmN0aW9uLlxuICogQHBhcmFtIGFwcFxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJVc2VyUm91dGVzKGFwcDogRXhwcmVzcyk6IHZvaWQge1xuICAvKipcbiAgICogR0VUIC9hcGkvdXNlcnMgLSBSZXRyaWV2ZXMgdXNlcnMgd2l0aCB0aGVpciBhc3NpZ25tZW50cyBiYXNlZCBvbiBjdXJyZW50IHVzZXIncyByb2xlIGFuZCBvcmdhbml6YXRpb25zLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2VycycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuXG4gICAgICAvLyBHZXQgdXNlcnMgd2l0aCB0aGVpciBmdWxsIGFzc2lnbm1lbnQgZGF0YVxuICAgICAgY29uc3QgdXNlcnNXaXRoQXNzaWdubWVudHMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJzV2l0aEFzc2lnbm1lbnRzKCk7XG5cbiAgICAgIFxuXG4gICAgICAvLyBGaWx0ZXIgdXNlcnMgYmFzZWQgb24gY3VycmVudCB1c2VyJ3Mgcm9sZSBhbmQgcGVybWlzc2lvbnNcbiAgICAgIGxldCBmaWx0ZXJlZFVzZXJzO1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgLy8gQWRtaW4gY2FuIHNlZSBhbGwgdXNlcnNcbiAgICAgICAgZmlsdGVyZWRVc2VycyA9IHVzZXJzV2l0aEFzc2lnbm1lbnRzO1xuICAgICAgfSBlbHNlIGlmIChbJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgLy8gRGVtbyB1c2VycyBjYW4gb25seSBzZWUgb3RoZXIgZGVtbyB1c2Vyc1xuICAgICAgICBmaWx0ZXJlZFVzZXJzID0gdXNlcnNXaXRoQXNzaWdubWVudHMuZmlsdGVyKHVzZXIgPT4gXG4gICAgICAgICAgWydkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKHVzZXIucm9sZSlcbiAgICAgICAgKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlZ3VsYXIgbWFuYWdlcnMgYW5kIG90aGVyIHVzZXJzIGNhbiBvbmx5IHNlZSBub24tZGVtbyB1c2VycyBmcm9tIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgLy8gR2V0IHRoZSBvcmdhbml6YXRpb24gSURzIHRoYXQgdGhlIGN1cnJlbnQgdXNlciBoYXMgYWNjZXNzIHRvXG4gICAgICAgIGNvbnN0IHVzZXJPcmdJZHMgPSAoYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyhjdXJyZW50VXNlci5pZCkpLm1hcChvcmcgPT4gb3JnLm9yZ2FuaXphdGlvbklkKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEZpbHRlciB1c2VycyB0byBvbmx5IGluY2x1ZGUgbm9uLWRlbW8gdXNlcnMgZnJvbSBhY2Nlc3NpYmxlIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgZmlsdGVyZWRVc2VycyA9IHVzZXJzV2l0aEFzc2lnbm1lbnRzLmZpbHRlcih1c2VyID0+IHtcbiAgICAgICAgICAvLyBFeGNsdWRlIGRlbW8gdXNlcnMgZnJvbSByZWd1bGFyIG1hbmFnZXIgdmlld1xuICAgICAgICAgIGlmIChbJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J10uaW5jbHVkZXModXNlci5yb2xlKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBoYXNBY2Nlc3MgPSB1c2VyLm9yZ2FuaXphdGlvbnM/LnNvbWUob3JnID0+IHVzZXJPcmdJZHMuaW5jbHVkZXMob3JnLmlkKSkgfHwgZmFsc2U7XG4gICAgICAgICAgcmV0dXJuIGhhc0FjY2VzcztcbiAgICAgICAgfSk7XG4gICAgICB9XG5cblxuICAgICAgcmVzLmpzb24oZmlsdGVyZWRVc2Vycyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHVzZXJzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXJzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cblxuICAvKipcbiAgICogR0VUIC9hcGkvdXNlcnMvOmlkIC0gUmV0cmlldmVzIGEgc3BlY2lmaWMgdXNlciBieSBJRC5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlcnMvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdCYWQgcmVxdWVzdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihpZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIGJlZm9yZSBzZW5kaW5nIHJlc3BvbnNlXG4gICAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcmVzLmpzb24odXNlcldpdGhvdXRQYXNzd29yZCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHVzZXI6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2Vycy9lbWFpbC86ZW1haWwgLSBSZXRyaWV2ZXMgYSB1c2VyIGJ5IGVtYWlsIGFkZHJlc3MuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL3VzZXJzL2VtYWlsLzplbWFpbCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGVtYWlsIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWVtYWlsKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnQmFkIHJlcXVlc3QnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdFbWFpbCBpcyByZXF1aXJlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyQnlFbWFpbChlbWFpbCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIGJlZm9yZSBzZW5kaW5nIHJlc3BvbnNlXG4gICAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcmVzLmpzb24odXNlcldpdGhvdXRQYXNzd29yZCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHVzZXIgYnkgZW1haWw6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvdXNlcnMgLSBDcmVhdGVzIGEgbmV3IHVzZXIuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS91c2VycycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBFbmhhbmNlZCBwYXNzd29yZCB2YWxpZGF0aW9uIHVzaW5nIHV0aWxpdHlcbiAgICAgIGlmIChyZXEuYm9keS5wYXNzd29yZCkge1xuICAgICAgICBjb25zdCBwYXNzd29yZFZhbGlkYXRpb24gPSB2YWxpZGF0ZVBhc3N3b3JkU3RyZW5ndGgocmVxLmJvZHkucGFzc3dvcmQpO1xuICAgICAgICBpZiAoIXBhc3N3b3JkVmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgICBtZXNzYWdlOiBwYXNzd29yZFZhbGlkYXRpb24ubWVzc2FnZSxcbiAgICAgICAgICAgIGNvZGU6ICdXRUFLX1BBU1NXT1JEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTYW5pdGl6ZSBhbmQgbm9ybWFsaXplIGFsbCBpbnB1dCBkYXRhXG4gICAgICBjb25zdCBub3JtYWxpemVkRGF0YSA9IHtcbiAgICAgICAgLi4ucmVxLmJvZHksXG4gICAgICAgIGVtYWlsOiBub3JtYWxpemVFbWFpbChyZXEuYm9keS5lbWFpbCB8fCAnJyksXG4gICAgICAgIGZpcnN0TmFtZTogc2FuaXRpemVOYW1lKHJlcS5ib2R5LmZpcnN0TmFtZSB8fCAnJyksXG4gICAgICAgIGxhc3ROYW1lOiBzYW5pdGl6ZU5hbWUocmVxLmJvZHkubGFzdE5hbWUgfHwgJycpLFxuICAgICAgICBwaG9uZTogcmVxLmJvZHkucGhvbmUgPyBzYW5pdGl6ZVN0cmluZyhyZXEuYm9keS5waG9uZSkgOiAnJyxcbiAgICAgICAgbGFuZ3VhZ2U6IHJlcS5ib2R5Lmxhbmd1YWdlIHx8ICdmcicsXG4gICAgICB9O1xuXG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgdXNlcm5hbWUgaWYgbm90IHByb3ZpZGVkXG4gICAgICBpZiAoIW5vcm1hbGl6ZWREYXRhLnVzZXJuYW1lICYmIG5vcm1hbGl6ZWREYXRhLmVtYWlsKSB7XG4gICAgICAgIGNvbnN0IGJhc2VVc2VybmFtZSA9IGdlbmVyYXRlVXNlcm5hbWVGcm9tRW1haWwobm9ybWFsaXplZERhdGEuZW1haWwpO1xuICAgICAgICBsZXQgdXNlcm5hbWUgPSBiYXNlVXNlcm5hbWU7XG5cbiAgICAgICAgLy8gRW5zdXJlIHVzZXJuYW1lIHVuaXF1ZW5lc3NcbiAgICAgICAgbGV0IHVzZXJuYW1lQ291bnRlciA9IDE7XG4gICAgICAgIGxldCBleGlzdGluZ1VzZXJuYW1lID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgdXNlcm5hbWU6IHNjaGVtYS51c2Vycy51c2VybmFtZSB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLnVzZXJuYW1lLCB1c2VybmFtZSkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIHdoaWxlIChleGlzdGluZ1VzZXJuYW1lLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB1c2VybmFtZSA9IGAke2Jhc2VVc2VybmFtZX0ke3VzZXJuYW1lQ291bnRlcn1gO1xuICAgICAgICAgIHVzZXJuYW1lQ291bnRlcisrO1xuICAgICAgICAgIGV4aXN0aW5nVXNlcm5hbWUgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IHVzZXJuYW1lOiBzY2hlbWEudXNlcnMudXNlcm5hbWUgfSlcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMudXNlcm5hbWUsIHVzZXJuYW1lKSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIG5vcm1hbGl6ZWREYXRhLnVzZXJuYW1lID0gdXNlcm5hbWU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBpbnNlcnRVc2VyU2NoZW1hLnBhcnNlKG5vcm1hbGl6ZWREYXRhKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciB3aXRoIGVtYWlsIGFscmVhZHkgZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJCeUVtYWlsKHZhbGlkYXRlZERhdGEuZW1haWwpO1xuICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDkpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ0NvbmZsaWN0JyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciB3aXRoIHRoaXMgZW1haWwgYWxyZWFkeSBleGlzdHMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlVXNlcih2YWxpZGF0ZWREYXRhKTtcblxuICAgICAgLy8gTG9nIHN1Y2Nlc3NmdWwgdXNlciBjcmVhdGlvblxuICAgICAgbG9nVXNlckNyZWF0aW9uKHtcbiAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgICBtZXRob2Q6ICdkaXJlY3QnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGlwQWRkcmVzczogcmVxLmlwLFxuICAgICAgICB1c2VyQWdlbnQ6IHJlcS5nZXQoJ1VzZXItQWdlbnQnKSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIGJlZm9yZSBzZW5kaW5nIHJlc3BvbnNlXG4gICAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24odXNlcldpdGhvdXRQYXNzd29yZCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8gTG9nIGZhaWxlZCB1c2VyIGNyZWF0aW9uIGF0dGVtcHRcbiAgICAgIGxvZ1VzZXJDcmVhdGlvbih7XG4gICAgICAgIGVtYWlsOiByZXEuYm9keS5lbWFpbCB8fCAndW5rbm93bicsXG4gICAgICAgIHJvbGU6IHJlcS5ib2R5LnJvbGUgfHwgJ3Vua25vd24nLFxuICAgICAgICBtZXRob2Q6ICdkaXJlY3QnLFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGlwQWRkcmVzczogcmVxLmlwLFxuICAgICAgICB1c2VyQWdlbnQ6IHJlcS5nZXQoJ1VzZXItQWdlbnQnKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCB1c2VyIGRhdGEnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSB1c2VyJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBVVCAvYXBpL3VzZXJzLzppZCAtIFVwZGF0ZXMgYW4gZXhpc3RpbmcgdXNlci5cbiAgICovXG4gIGFwcC5wdXQoJy9hcGkvdXNlcnMvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdCYWQgcmVxdWVzdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHVwZGF0ZSBkYXRhIChleGNsdWRpbmcgcGFzc3dvcmQgdXBkYXRlcyBmb3Igc2VjdXJpdHkpXG4gICAgICBjb25zdCB1cGRhdGVTY2hlbWEgPSBpbnNlcnRVc2VyU2NoZW1hLnBhcnRpYWwoKS5vbWl0KHsgcGFzc3dvcmQ6IHRydWUgfSk7XG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gdXBkYXRlU2NoZW1hLnBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UudXBkYXRlVXNlcihpZCwge1xuICAgICAgICAuLi52YWxpZGF0ZWREYXRhLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbW92ZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gYmVmb3JlIHNlbmRpbmcgcmVzcG9uc2VcbiAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgICByZXMuanNvbih1c2VyV2l0aG91dFBhc3N3b3JkKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgZXJyb3I6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCB1c2VyIGRhdGEnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSB1c2VyJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERFTEVURSAvYXBpL3VzZXJzLzppZCAtIERlYWN0aXZhdGVzIGEgdXNlciAoc29mdCBkZWxldGUpLlxuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS91c2Vycy86aWQnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgaWYgKCFpZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ0JhZCByZXF1ZXN0JyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBJRCBpcyByZXF1aXJlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTb2Z0IGRlbGV0ZSBieSBzZXR0aW5nIGlzQWN0aXZlIHRvIGZhbHNlXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZS51cGRhdGVVc2VyKGlkLCB7XG4gICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgZGVhY3RpdmF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVhY3RpdmF0aW5nIHVzZXI6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVhY3RpdmF0ZSB1c2VyJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXItb3JnYW5pemF0aW9ucyAtIEdldCBjdXJyZW50IHVzZXIncyBvcmdhbml6YXRpb25zLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2VyLW9yZ2FuaXphdGlvbnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKGN1cnJlbnRVc2VyLmlkKTtcbiAgICAgIHJlcy5qc29uKG9yZ2FuaXphdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgb3JnYW5pemF0aW9uczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciBvcmdhbml6YXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXItcmVzaWRlbmNlcyAtIEdldCBjdXJyZW50IHVzZXIncyByZXNpZGVuY2VzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2VyLXJlc2lkZW5jZXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKGN1cnJlbnRVc2VyLmlkKTtcbiAgICAgIHJlcy5qc29uKHJlc2lkZW5jZXMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgcmVzaWRlbmNlczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciByZXNpZGVuY2VzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2FkbWluL2FsbC11c2VyLW9yZ2FuaXphdGlvbnMgLSBHZXQgdXNlci1vcmdhbml6YXRpb24gcmVsYXRpb25zaGlwcyAoYWRtaW46IGFsbCwgbWFuYWdlcjogZmlsdGVyZWQgYnkgdGhlaXIgb3JncykuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2FkbWluL2FsbC11c2VyLW9yZ2FuaXphdGlvbnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBbQVBJXSBhbGwtdXNlci1vcmdhbml6YXRpb25zIGVuZHBvaW50IGNhbGxlZCBieSB1c2VyOicsIHJlcS51c2VyPy5lbWFpbCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIGFjY2VzcyB1c2VyIGFzc2lnbm1lbnRzXG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucyB0byB2aWV3IHVzZXIgYXNzaWdubWVudHMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IHVzZXJPcmdhbml6YXRpb25zO1xuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbiBzZWVzIGFsbCB1c2VyLW9yZ2FuaXphdGlvbiByZWxhdGlvbnNoaXBzXG4gICAgICAgIHVzZXJPcmdhbml6YXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHVzZXJJZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uUm9sZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTWFuYWdlciBzZWVzIG9ubHkgcmVsYXRpb25zaGlwcyBmb3IgdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgICAgICBjb25zdCBtYW5hZ2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG9yZ0lkcyA9IG1hbmFnZXJPcmdzLm1hcCgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgIGlmIChvcmdJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKFtdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHVzZXJPcmdhbml6YXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHVzZXJJZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uUm9sZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICBpbkFycmF5KHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgb3JnSWRzKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHVzZXJPcmdhbml6YXRpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyBhbGwgdXNlciBvcmdhbml6YXRpb25zOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCB1c2VyIG9yZ2FuaXphdGlvbnMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvYWRtaW4vYWxsLXVzZXItcmVzaWRlbmNlcyAtIEdldCB1c2VyLXJlc2lkZW5jZSByZWxhdGlvbnNoaXBzIChhZG1pbjogYWxsLCBtYW5hZ2VyOiBmaWx0ZXJlZCBieSB0aGVpciBvcmdzKS5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYWRtaW4vYWxsLXVzZXItcmVzaWRlbmNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SNIFtBUEldIGFsbC11c2VyLXJlc2lkZW5jZXMgZW5kcG9pbnQgY2FsbGVkIGJ5IHVzZXI6JywgcmVxLnVzZXI/LmVtYWlsKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gYWNjZXNzIHVzZXIgYXNzaWdubWVudHNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIHZpZXcgdXNlciBhc3NpZ25tZW50cycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBsZXQgdXNlclJlc2lkZW5jZXM7XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWluIHNlZXMgYWxsIHVzZXItcmVzaWRlbmNlIHJlbGF0aW9uc2hpcHNcbiAgICAgICAgdXNlclJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgdXNlcklkOiBzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZWxhdGlvbnNoaXBUeXBlLFxuICAgICAgICAgICAgc3RhcnREYXRlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMuc3RhcnREYXRlLFxuICAgICAgICAgICAgZW5kRGF0ZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmVuZERhdGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1hbmFnZXIgc2VlcyBvbmx5IHJlbGF0aW9uc2hpcHMgZm9yIHJlc2lkZW5jZXMgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgICAgICBjb25zdCBtYW5hZ2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG9yZ0lkcyA9IG1hbmFnZXJPcmdzLm1hcCgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgIGlmIChvcmdJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKFtdKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCByZXNpZGVuY2VzIGluIG1hbmFnZXIncyBvcmdhbml6YXRpb25zXG4gICAgICAgIGNvbnN0IGFjY2Vzc2libGVSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgcmVzaWRlbmNlSWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmlkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBzY2hlbWEuYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnSWRzKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBjb25zdCByZXNpZGVuY2VJZHMgPSBhY2Nlc3NpYmxlUmVzaWRlbmNlcy5tYXAoKHJlcykgPT4gcmVzLnJlc2lkZW5jZUlkKTtcblxuICAgICAgICBpZiAocmVzaWRlbmNlSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7XG4gICAgICAgIH1cblxuICAgICAgICB1c2VyUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICB1c2VySWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsXG4gICAgICAgICAgICByZXNpZGVuY2VJZDogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLFxuICAgICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlbGF0aW9uc2hpcFR5cGUsXG4gICAgICAgICAgICBzdGFydERhdGU6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5zdGFydERhdGUsXG4gICAgICAgICAgICBlbmREYXRlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMuZW5kRGF0ZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICBpbkFycmF5KHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWRzKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHVzZXJSZXNpZGVuY2VzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyBhbGwgdXNlciByZXNpZGVuY2VzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCB1c2VyIHJlc2lkZW5jZXMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvdXNlci9wZXJtaXNzaW9ucyAtIFJldHJpZXZlcyB0aGUgY3VycmVudCB1c2VyJ3MgcGVybWlzc2lvbnMgYmFzZWQgb24gdGhlaXIgcm9sZS5cbiAgICogUHJvdGVjdGVkIGVuZHBvaW50IHRoYXQgcmVxdWlyZXMgYXV0aGVudGljYXRpb24uXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL3VzZXIvcGVybWlzc2lvbnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHVzZXIgcm9sZSBmcm9tIHNlc3Npb25cbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gcmVxLnVzZXI/LnJvbGU7XG5cbiAgICAgIGlmICghdXNlclJvbGUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdCYWQgcmVxdWVzdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgcm9sZSBub3QgZm91bmQgaW4gc2Vzc2lvbicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgcGVybWlzc2lvbnMgZm9yIHRoZSB1c2VyJ3Mgcm9sZSBmcm9tIGRhdGFiYXNlXG4gICAgICBjb25zdCByb2xlUGVybWlzc2lvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFJvbGVQZXJtaXNzaW9ucygpO1xuICAgICAgY29uc3QgdXNlclBlcm1pc3Npb25zID0gcm9sZVBlcm1pc3Npb25zXG4gICAgICAgIC5maWx0ZXIoKHJwOiBhbnkpID0+IHJwLnJvbGUgPT09IHVzZXJSb2xlKVxuICAgICAgICAubWFwKChycDogYW55KSA9PiBycC5wZXJtaXNzaW9uPy5uYW1lKVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuXG4gICAgICAvLyBDcmVhdGUgcmVzcG9uc2Ugd2l0aCBab2QgdmFsaWRhdGlvblxuICAgICAgY29uc3QgcmVzcG9uc2VEYXRhID0ge1xuICAgICAgICByb2xlOiB1c2VyUm9sZSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHVzZXJQZXJtaXNzaW9ucyxcbiAgICAgICAgcGVybWlzc2lvbkNvdW50OiB1c2VyUGVybWlzc2lvbnMubGVuZ3RoLFxuICAgICAgfTtcblxuICAgICAgLy8gVmFsaWRhdGUgcmVzcG9uc2Ugd2l0aCBab2Qgc2NoZW1hXG4gICAgICBjb25zdCBwZXJtaXNzaW9uc1Jlc3BvbnNlU2NoZW1hID0gei5vYmplY3Qoe1xuICAgICAgICByb2xlOiB6LmVudW0oWydhZG1pbicsICdtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCddKSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHouYXJyYXkoei5zdHJpbmcoKSksXG4gICAgICAgIHBlcm1pc3Npb25Db3VudDogei5udW1iZXIoKSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB2YWxpZGF0ZWRSZXNwb25zZSA9IHBlcm1pc3Npb25zUmVzcG9uc2VTY2hlbWEucGFyc2UocmVzcG9uc2VEYXRhKTtcblxuICAgICAgcmVzLmpzb24odmFsaWRhdGVkUmVzcG9uc2UpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB2YWxpZGF0ZSBwZXJtaXNzaW9ucyByZXNwb25zZScsXG4gICAgICAgICAgZGV0YWlsczogZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHVzZXIgcGVybWlzc2lvbnM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdXNlciBwZXJtaXNzaW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQVVQgL2FwaS91c2Vycy86aWQvb3JnYW5pemF0aW9ucyAtIFVwZGF0ZXMgdXNlcidzIG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50cy5cbiAgICogQWRtaW46IGNhbiBhc3NpZ24vcmVtb3ZlIGFueSBvcmdhbml6YXRpb25cbiAgICogTWFuYWdlcjogY2Fubm90IG1vZGlmeSBvcmdhbml6YXRpb24gYXNzaWdubWVudHMuXG4gICAqL1xuICBhcHAucHV0KCcvYXBpL3VzZXJzLzppZC9vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBjb25zdCB7IGlkOiB1c2VySWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCB7IG9yZ2FuaXphdGlvbklkcyB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBtb2RpZnkgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdPbmx5IGFkbWluaXN0cmF0b3JzIGNhbiBtb2RpZnkgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdXNlcklkIHx8ICFBcnJheS5pc0FycmF5KG9yZ2FuaXphdGlvbklkcykpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBJRCBhbmQgb3JnYW5pemF0aW9uIElEcyBhcnJheSBhcmUgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1JFUVVFU1QnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyKHVzZXJJZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgZXhpc3Rpbmcgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKS53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VySWQpKTtcblxuICAgICAgLy8gQWRkIG5ldyBvcmdhbml6YXRpb24gYXNzaWdubWVudHNcbiAgICAgIGlmIChvcmdhbml6YXRpb25JZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBuZXdBc3NpZ25tZW50cyA9IG9yZ2FuaXphdGlvbklkcy5tYXAoKG9yZ0lkOiBzdHJpbmcpID0+ICh7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBvcmdJZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIH0pKTtcblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKS52YWx1ZXMobmV3QXNzaWdubWVudHMpO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdPcmdhbml6YXRpb24gYXNzaWdubWVudHMgdXBkYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkcyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBvcmdhbml6YXRpb24gYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50cycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2Vycy86aWQvcmVzaWRlbmNlcyAtIEdldCB1c2VyJ3MgYWNjZXNzaWJsZSByZXNpZGVuY2VzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2Vycy86aWQvcmVzaWRlbmNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdXNlcklkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBVc2VycyBjYW4gb25seSBhY2Nlc3MgdGhlaXIgb3duIHJlc2lkZW5jZXMgdW5sZXNzIHRoZXkncmUgYWRtaW4vbWFuYWdlclxuICAgICAgaWYgKGN1cnJlbnRVc2VyLmlkICE9PSB1c2VySWQgJiYgIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNpZGVuY2VzID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyUmVzaWRlbmNlcyh1c2VySWQpO1xuICAgICAgcmVzLmpzb24ocmVzaWRlbmNlcyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdldHRpbmcgdXNlciByZXNpZGVuY2VzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCB1c2VyIHJlc2lkZW5jZXMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvdXNlcnMvOmlkL2J1aWxkaW5ncyAtIEdldCB1c2VyJ3MgYWNjZXNzaWJsZSBidWlsZGluZ3MgYmFzZWQgb24gdGhlaXIgcmVzaWRlbmNlcy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlcnMvOmlkL2J1aWxkaW5ncycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdXNlcklkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBVc2VycyBjYW4gb25seSBhY2Nlc3MgdGhlaXIgb3duIGJ1aWxkaW5ncyB1bmxlc3MgdGhleSdyZSBhZG1pbi9tYW5hZ2VyXG4gICAgICBpZiAoY3VycmVudFVzZXIuaWQgIT09IHVzZXJJZCAmJiAhWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB1c2VyJ3MgcmVzaWRlbmNlcyB3aXRoIGJ1aWxkaW5nIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCB1c2VyUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIHJlc2lkZW5jZUlkOiBzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5yZXNpZGVuY2VzLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHNjaGVtYS5yZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICkpO1xuICAgICAgXG4gICAgICBpZiAoIXVzZXJSZXNpZGVuY2VzIHx8IHVzZXJSZXNpZGVuY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oeyBidWlsZGluZ3M6IFtdIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdW5pcXVlIGJ1aWxkaW5nIElEcyBmcm9tIHVzZXIncyByZXNpZGVuY2VzXG4gICAgICBjb25zdCBidWlsZGluZ0lkcyA9IFsuLi5uZXcgU2V0KHVzZXJSZXNpZGVuY2VzLm1hcCh1ciA9PiB1ci5idWlsZGluZ0lkKS5maWx0ZXIoQm9vbGVhbikpXTtcbiAgICAgIFxuICAgICAgaWYgKGJ1aWxkaW5nSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oeyBidWlsZGluZ3M6IFtdIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBGZXRjaCBidWlsZGluZyBkZXRhaWxzIHdpdGggc3RhdHMgdXNpbmcgdGhlIGV4aXN0aW5nIGxvZ2ljIGZyb20gL2FwaS9tYW5hZ2VyL2J1aWxkaW5nc1xuICAgICAgY29uc3QgYnVpbGRpbmdEZXRhaWxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHNjaGVtYS5idWlsZGluZ3MuaWQsXG4gICAgICAgICAgbmFtZTogc2NoZW1hLmJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgIGFkZHJlc3M6IHNjaGVtYS5idWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICBjaXR5OiBzY2hlbWEuYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgcHJvdmluY2U6IHNjaGVtYS5idWlsZGluZ3MucHJvdmluY2UsXG4gICAgICAgICAgcG9zdGFsQ29kZTogc2NoZW1hLmJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgIGJ1aWxkaW5nVHlwZTogc2NoZW1hLmJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgeWVhckJ1aWx0OiBzY2hlbWEuYnVpbGRpbmdzLnllYXJCdWlsdCxcbiAgICAgICAgICB0b3RhbEZsb29yczogc2NoZW1hLmJ1aWxkaW5ncy50b3RhbEZsb29ycyxcbiAgICAgICAgICBwYXJraW5nU3BhY2VzOiBzY2hlbWEuYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgc3RvcmFnZVNwYWNlczogc2NoZW1hLmJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBzY2hlbWEuYnVpbGRpbmdzLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgIGFtZW5pdGllczogc2NoZW1hLmJ1aWxkaW5ncy5hbWVuaXRpZXMsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICBvcmdhbml6YXRpb25UeXBlOiBzY2hlbWEub3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAubGVmdEpvaW4oc2NoZW1hLm9yZ2FuaXphdGlvbnMsIGVxKHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIHNjaGVtYS5vcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgLndoZXJlKGFuZChcbiAgICAgICAgICBpbkFycmF5KHNjaGVtYS5idWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWRzKSxcbiAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICApKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHN0YXRzIGZvciBlYWNoIGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZ3NXaXRoU3RhdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgYnVpbGRpbmdEZXRhaWxzLm1hcChhc3luYyAoYnVpbGRpbmcpID0+IHtcbiAgICAgICAgICBjb25zdCBbdG90YWxVbml0cywgb2NjdXBpZWRVbml0c10gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgICBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KCopYCB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAgICAgLndoZXJlKGFuZChlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZy5pZCksIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiByZXN1bHRbMF0/LmNvdW50IHx8IDApLFxuICAgICAgICAgICAgXG4gICAgICAgICAgICBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KGRpc3RpbmN0ICR7c2NoZW1hLnJlc2lkZW5jZXMuaWR9KWAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgICAgICAgIC5sZWZ0Sm9pbihzY2hlbWEudXNlclJlc2lkZW5jZXMsIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgc2NoZW1hLnJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nLmlkKSxcbiAgICAgICAgICAgICAgICBlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAudGhlbihyZXN1bHQgPT4gcmVzdWx0WzBdPy5jb3VudCB8fCAwKSxcbiAgICAgICAgICBdKTtcblxuICAgICAgICAgIGNvbnN0IHZhY2FudFVuaXRzID0gdG90YWxVbml0cyAtIG9jY3VwaWVkVW5pdHM7XG4gICAgICAgICAgY29uc3Qgb2NjdXBhbmN5UmF0ZSA9IHRvdGFsVW5pdHMgPiAwID8gKG9jY3VwaWVkVW5pdHMgLyB0b3RhbFVuaXRzKSAqIDEwMCA6IDA7XG5cbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uYnVpbGRpbmcsXG4gICAgICAgICAgICB0b3RhbFVuaXRzLFxuICAgICAgICAgICAgb2NjdXBpZWRVbml0cyxcbiAgICAgICAgICAgIHZhY2FudFVuaXRzLFxuICAgICAgICAgICAgb2NjdXBhbmN5UmF0ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgcmVzLmpzb24oeyBidWlsZGluZ3M6IGJ1aWxkaW5nc1dpdGhTdGF0cyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIGJ1aWxkaW5nczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciBidWlsZGluZ3MnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUFVUIC9hcGkvdXNlcnMvOmlkL3Jlc2lkZW5jZXMgLSBVcGRhdGVzIHVzZXIncyByZXNpZGVuY2UgYXNzaWdubWVudHMuXG4gICAqIEFkbWluOiBjYW4gYXNzaWduL3JlbW92ZSBhbnkgcmVzaWRlbmNlXG4gICAqIE1hbmFnZXI6IGNhbiBhc3NpZ24vcmVtb3ZlIHJlc2lkZW5jZXMgd2l0aGluIHRoZWlyIG9yZ2FuaXphdGlvbnMgb25seS5cbiAgICovXG4gIGFwcC5wdXQoJy9hcGkvdXNlcnMvOmlkL3Jlc2lkZW5jZXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGNvbnN0IHsgaWQ6IHVzZXJJZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHsgcmVzaWRlbmNlQXNzaWdubWVudHMgfSA9IHJlcS5ib2R5OyAvLyBBcnJheSBvZiB7IHJlc2lkZW5jZUlkLCByZWxhdGlvbnNoaXBUeXBlLCBzdGFydERhdGUsIGVuZERhdGUgfVxuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIG1vZGlmeSByZXNpZGVuY2UgYXNzaWdubWVudHNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIG1vZGlmeSByZXNpZGVuY2UgYXNzaWdubWVudHMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF1c2VySWQgfHwgIUFycmF5LmlzQXJyYXkocmVzaWRlbmNlQXNzaWdubWVudHMpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgYW5kIHJlc2lkZW5jZSBhc3NpZ25tZW50cyBhcnJheSBhcmUgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1JFUVVFU1QnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyKHVzZXJJZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBGb3IgbWFuYWdlcnMsIHZlcmlmeSB0aGV5IGNhbiBhY2Nlc3MgYWxsIHJlcXVlc3RlZCByZXNpZGVuY2VzXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgIGZvciAoY29uc3QgYXNzaWdubWVudCBvZiByZXNpZGVuY2VBc3NpZ25tZW50cykge1xuICAgICAgICAgIC8vIEdldCB0aGUgYnVpbGRpbmcgZm9yIHRoaXMgcmVzaWRlbmNlXG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBidWlsZGluZ0lkOiBzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkIH0pXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pZCwgYXNzaWdubWVudC5yZXNpZGVuY2VJZCkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgICBpZiAocmVzaWRlbmNlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogYFJlc2lkZW5jZSAke2Fzc2lnbm1lbnQucmVzaWRlbmNlSWR9IG5vdCBmb3VuZGAsXG4gICAgICAgICAgICAgIGNvZGU6ICdSRVNJREVOQ0VfTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIENoZWNrIGlmIG1hbmFnZXIgaGFzIGFjY2VzcyB0byB0aGlzIGJ1aWxkaW5nXG4gICAgICAgICAgLy8gR2V0IGJ1aWxkaW5ncyBhY2Nlc3NpYmxlIHRvIHRoaXMgbWFuYWdlciB0aHJvdWdoIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICBjb25zdCBtYW5hZ2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgIGNvbnN0IG9yZ0lkcyA9IG1hbmFnZXJPcmdzLm1hcCgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5ncyA9XG4gICAgICAgICAgICBvcmdJZHMubGVuZ3RoID4gMFxuICAgICAgICAgICAgICA/IGF3YWl0IGRiXG4gICAgICAgICAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHNjaGVtYS5idWlsZGluZ3MuaWQgfSlcbiAgICAgICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgICAgICBpbkFycmF5KHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ0lkcyksXG4gICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICA6IFtdO1xuXG4gICAgICAgICAgY29uc3QgaGFzQWNjZXNzID0gYWNjZXNzaWJsZUJ1aWxkaW5ncy5zb21lKChiKSA9PiBiLmlkID09PSByZXNpZGVuY2VbMF0uYnVpbGRpbmdJZCk7XG4gICAgICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGBJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgZm9yIHJlc2lkZW5jZSAke2Fzc2lnbm1lbnQucmVzaWRlbmNlSWR9YCxcbiAgICAgICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIHJlc2lkZW5jZSBhc3NpZ25tZW50c1xuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyUmVzaWRlbmNlcykud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlcklkKSk7XG5cbiAgICAgIC8vIEFkZCBuZXcgcmVzaWRlbmNlIGFzc2lnbm1lbnRzXG4gICAgICBpZiAocmVzaWRlbmNlQXNzaWdubWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBuZXdBc3NpZ25tZW50cyA9IHJlc2lkZW5jZUFzc2lnbm1lbnRzLm1hcCgoYXNzaWdubWVudDogYW55KSA9PiAoe1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICByZXNpZGVuY2VJZDogYXNzaWdubWVudC5yZXNpZGVuY2VJZCxcbiAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiBhc3NpZ25tZW50LnJlbGF0aW9uc2hpcFR5cGUgfHwgJ3RlbmFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBhc3NpZ25tZW50LnN0YXJ0RGF0ZSB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgICBlbmREYXRlOiBhc3NpZ25tZW50LmVuZERhdGUgfHwgbnVsbCxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSkpO1xuXG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlclJlc2lkZW5jZXMpLnZhbHVlcyhuZXdBc3NpZ25tZW50cyk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1Jlc2lkZW5jZSBhc3NpZ25tZW50cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYXNzaWdubWVudENvdW50OiByZXNpZGVuY2VBc3NpZ25tZW50cy5sZW5ndGgsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgcmVzaWRlbmNlIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSByZXNpZGVuY2UgYXNzaWdubWVudHMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvdXNlcnMvbWUvb3JnYW5pemF0aW9ucyAtIEdldCBvcmdhbml6YXRpb25zIGFjY2Vzc2libGUgdG8gY3VycmVudCB1c2VyLlxuICAgKiBVc2VkIGJ5IGludml0ZSBmb3JtIHRvIHBvcHVsYXRlIG9yZ2FuaXphdGlvbiBkcm9wZG93bi5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlcnMvbWUvb3JnYW5pemF0aW9ucycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfk4ogRmV0Y2hpbmcgdXNlci1hY2Nlc3NpYmxlIG9yZ2FuaXphdGlvbnMgZm9yICR7Y3VycmVudFVzZXIuZW1haWx9ICgke2N1cnJlbnRVc2VyLnJvbGV9KWApO1xuXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9ucyBiYXNlZCBvbiB1c2VyIHJvbGUgLSBzYW1lIGxvZ2ljIGFzIC9hcGkvb3JnYW5pemF0aW9uc1xuICAgICAgbGV0IG9yZ2FuaXphdGlvbnNRdWVyeTtcblxuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgLy8gQWRtaW4gY2FuIHNlZSBhbGwgb3JnYW5pemF0aW9uc1xuICAgICAgICBvcmdhbml6YXRpb25zUXVlcnkgPSBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLFxuICAgICAgICAgICAgbmFtZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIHR5cGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgICBhZGRyZXNzOiBzY2hlbWEub3JnYW5pemF0aW9ucy5hZGRyZXNzLFxuICAgICAgICAgICAgY2l0eTogc2NoZW1hLm9yZ2FuaXphdGlvbnMuY2l0eSxcbiAgICAgICAgICAgIHByb3ZpbmNlOiBzY2hlbWEub3JnYW5pemF0aW9ucy5wcm92aW5jZSxcbiAgICAgICAgICAgIHBvc3RhbENvZGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnBvc3RhbENvZGUsXG4gICAgICAgICAgICBwaG9uZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMucGhvbmUsXG4gICAgICAgICAgICBlbWFpbDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuZW1haWwsXG4gICAgICAgICAgICB3ZWJzaXRlOiBzY2hlbWEub3JnYW5pemF0aW9ucy53ZWJzaXRlLFxuICAgICAgICAgICAgcmVnaXN0cmF0aW9uTnVtYmVyOiBzY2hlbWEub3JnYW5pemF0aW9ucy5yZWdpc3RyYXRpb25OdW1iZXIsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHNjaGVtYS5vcmdhbml6YXRpb25zLmNyZWF0ZWRBdCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBPdGhlciB1c2VycyBzZWUgb3JnYW5pemF0aW9ucyB0aGV5IGhhdmUgYWNjZXNzIHRvIHRocm91Z2ggdXNlcl9vcmdhbml6YXRpb25zXG4gICAgICAgIG9yZ2FuaXphdGlvbnNRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICAgICAgICBuYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgdHlwZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IHNjaGVtYS5vcmdhbml6YXRpb25zLmFkZHJlc3MsXG4gICAgICAgICAgICBjaXR5OiBzY2hlbWEub3JnYW5pemF0aW9ucy5jaXR5LFxuICAgICAgICAgICAgcHJvdmluY2U6IHNjaGVtYS5vcmdhbml6YXRpb25zLnByb3ZpbmNlLFxuICAgICAgICAgICAgcG9zdGFsQ29kZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMucG9zdGFsQ29kZSxcbiAgICAgICAgICAgIHBob25lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5waG9uZSxcbiAgICAgICAgICAgIGVtYWlsOiBzY2hlbWEub3JnYW5pemF0aW9ucy5lbWFpbCxcbiAgICAgICAgICAgIHdlYnNpdGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLndlYnNpdGUsXG4gICAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IHNjaGVtYS5vcmdhbml6YXRpb25zLnJlZ2lzdHJhdGlvbk51bWJlcixcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuY3JlYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLmlubmVySm9pbihzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMsIGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFjY2Vzc2libGVPcmdhbml6YXRpb25zID0gYXdhaXQgb3JnYW5pemF0aW9uc1F1ZXJ5O1xuICAgICAgY29uc29sZS5sb2coYOKchSBGb3VuZCAke2FjY2Vzc2libGVPcmdhbml6YXRpb25zLmxlbmd0aH0gb3JnYW5pemF0aW9ucyBmb3IgdXNlciAke2N1cnJlbnRVc2VyLmlkfWApO1xuXG4gICAgICAvLyBSZXR1cm4gYXJyYXkgZGlyZWN0bHkgKG5vdCB3cmFwcGVkIGluIG9iamVjdCkgLSBzYW1lIGZvcm1hdCBhcyAvYXBpL29yZ2FuaXphdGlvbnNcbiAgICAgIHJlcy5qc29uKGFjY2Vzc2libGVPcmdhbml6YXRpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgdXNlciBvcmdhbml6YXRpb25zOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXIgb3JnYW5pemF0aW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2Vycy9tZS9kYXRhLWV4cG9ydCAtIERvd25sb2FkIHVzZXIgZGF0YSBmb3IgTGF3IDI1IGNvbXBsaWFuY2UuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL3VzZXJzL21lL2RhdGEtZXhwb3J0JywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgYWxsIHVzZXIgZGF0YSBmb3IgZXhwb3J0XG4gICAgICBjb25zdCB1c2VyRGF0YSA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihjdXJyZW50VXNlci5pZCk7XG4gICAgICBpZiAoIXVzZXJEYXRhKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIHNlbnNpdGl2ZSBmaWVsZHNcbiAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJEYXRhRXhwb3J0IH0gPSB1c2VyRGF0YTtcblxuICAgICAgLy8gR2V0IHJlbGF0ZWQgZGF0YVxuICAgICAgY29uc3QgW29yZ2FuaXphdGlvbnMsIHJlc2lkZW5jZXMsIGJpbGxzLCBkb2N1bWVudHMsIG5vdGlmaWNhdGlvbnMsIG1haW50ZW5hbmNlUmVxdWVzdHNdID1cbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5iaWxscylcbiAgICAgICAgICAgIC5pbm5lckpvaW4oXG4gICAgICAgICAgICAgIHNjaGVtYS51c2VyUmVzaWRlbmNlcyxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJpbGxzLnJlc2lkZW5jZUlkLCBzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpKSxcbiAgICAgICAgICBkYlxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMudXBsb2FkZWRCeUlkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5ub3RpZmljYXRpb25zKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5ub3RpZmljYXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpKSxcbiAgICAgICAgICBkYlxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cy5zdWJtaXR0ZWRCeSwgY3VycmVudFVzZXIuaWQpKSxcbiAgICAgICAgXSk7XG5cbiAgICAgIGNvbnN0IGV4cG9ydERhdGEgPSB7XG4gICAgICAgIHBlcnNvbmFsSW5mb3JtYXRpb246IHVzZXJEYXRhRXhwb3J0LFxuICAgICAgICBvcmdhbml6YXRpb25zLFxuICAgICAgICByZXNpZGVuY2VzLFxuICAgICAgICBiaWxsczogYmlsbHMubWFwKChiKSA9PiBiLmJpbGxzKSxcbiAgICAgICAgZG9jdW1lbnRzOiBkb2N1bWVudHMsXG4gICAgICAgIG5vdGlmaWNhdGlvbnMsXG4gICAgICAgIG1haW50ZW5hbmNlUmVxdWVzdHMsXG4gICAgICAgIGV4cG9ydERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbm90ZTogJ1RoaXMgZXhwb3J0IGNvbnRhaW5zIGFsbCBwZXJzb25hbCBkYXRhIHdlIGhhdmUgb24gZmlsZSBmb3IgeW91IGluIGNvbXBsaWFuY2Ugd2l0aCBRdWViZWMgTGF3IDI1LicsXG4gICAgICB9O1xuXG4gICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgICAgcmVzLnNldEhlYWRlcihcbiAgICAgICAgJ0NvbnRlbnQtRGlzcG9zaXRpb24nLFxuICAgICAgICBgYXR0YWNobWVudDsgZmlsZW5hbWU9XCJ1c2VyLWRhdGEtZXhwb3J0LSR7Y3VycmVudFVzZXIuaWR9LSR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF19Lmpzb25cImBcbiAgICAgICk7XG4gICAgICByZXMuanNvbihleHBvcnREYXRhKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZXhwb3J0aW5nIHVzZXIgZGF0YTonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBleHBvcnQgdXNlciBkYXRhJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS91c2Vycy9tZS9kZWxldGUtYWNjb3VudCAtIENvbXBsZXRlIGFjY291bnQgZGVsZXRpb24gZm9yIExhdyAyNSBjb21wbGlhbmNlLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvdXNlcnMvbWUvZGVsZXRlLWFjY291bnQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgY29uZmlybUVtYWlsLCByZWFzb24gfSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBWZXJpZnkgZW1haWwgY29uZmlybWF0aW9uXG4gICAgICBpZiAoY29uZmlybUVtYWlsICE9PSBjdXJyZW50VXNlci5lbWFpbCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdFbWFpbCBjb25maXJtYXRpb24gZG9lcyBub3QgbWF0Y2gnLFxuICAgICAgICAgIGNvZGU6ICdFTUFJTF9NSVNNQVRDSCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWxldGUgYWxsIHJlbGF0ZWQgZGF0YSBpbiB0aGUgY29ycmVjdCBvcmRlciB0byBoYW5kbGUgZm9yZWlnbiBrZXkgY29uc3RyYWludHNcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgLy8gRGVsZXRlIHVzZXIgcmVsYXRpb25zaGlwc1xuICAgICAgICBkYlxuICAgICAgICAgIC5kZWxldGUoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICBkYi5kZWxldGUoc2NoZW1hLnVzZXJSZXNpZGVuY2VzKS53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICBkYlxuICAgICAgICAgIC5kZWxldGUoc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRvY3VtZW50cy51cGxvYWRlZEJ5SWQsIGN1cnJlbnRVc2VyLmlkKSksXG5cbiAgICAgICAgLy8gRGVsZXRlIHVzZXItY3JlYXRlZCBjb250ZW50XG4gICAgICAgIGRiLmRlbGV0ZShzY2hlbWEubm90aWZpY2F0aW9ucykud2hlcmUoZXEoc2NoZW1hLm5vdGlmaWNhdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICBkYlxuICAgICAgICAgIC5kZWxldGUoc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzLnN1Ym1pdHRlZEJ5LCBjdXJyZW50VXNlci5pZCkpLFxuXG4gICAgICAgIC8vIERlbGV0ZSBpbnZpdGF0aW9uc1xuICAgICAgICBkYi5kZWxldGUoc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsIGN1cnJlbnRVc2VyLmVtYWlsKSksXG4gICAgICBdKTtcblxuICAgICAgLy8gRmluYWxseSwgZGVsZXRlIHRoZSB1c2VyIGFjY291bnRcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgY3VycmVudFVzZXIuaWQpKTtcblxuICAgICAgLy8gTG9nIHRoZSBkZWxldGlvbiBmb3IgYXVkaXQgcHVycG9zZXNcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBgVXNlciBhY2NvdW50IGRlbGV0ZWQ6ICR7Y3VycmVudFVzZXIuZW1haWx9ICgke2N1cnJlbnRVc2VyLmlkfSkuIFJlYXNvbjogJHtyZWFzb24gfHwgJ05vdCBwcm92aWRlZCd9YFxuICAgICAgKTtcblxuICAgICAgLy8gQ2xlYXIgc2Vzc2lvblxuICAgICAgaWYgKHJlcS5zZXNzaW9uKSB7XG4gICAgICAgIHJlcS5zZXNzaW9uLmRlc3Ryb3koKGVycjogYW55KSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGRlc3Ryb3kgc2Vzc2lvbiBhZnRlciBhY2NvdW50IGRlbGV0aW9uOicsIGVycik7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICdBY2NvdW50IHN1Y2Nlc3NmdWxseSBkZWxldGVkLiBBbGwgcGVyc29uYWwgZGF0YSBoYXMgYmVlbiBwZXJtYW5lbnRseSByZW1vdmVkIGZyb20gb3VyIHN5c3RlbXMuJyxcbiAgICAgICAgZGVsZXRpb25EYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgYWNjb3VudDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgYWNjb3VudC4gUGxlYXNlIGNvbnRhY3Qgc3VwcG9ydC4nLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUFVUIC9hcGkvdXNlcnMvbWUgLSBVcGRhdGUgY3VycmVudCB1c2VyJ3MgcHJvZmlsZS5cbiAgICovXG4gIGFwcC5wdXQoJy9hcGkvdXNlcnMvbWUnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHRoZSB1cGRhdGUgZGF0YSAoZXhjbHVkaW5nIHBhc3N3b3JkIHVwZGF0ZXMgZm9yIHNlY3VyaXR5KVxuICAgICAgY29uc3QgdXBkYXRlU2NoZW1hID0gaW5zZXJ0VXNlclNjaGVtYVxuICAgICAgICAucGFydGlhbCgpXG4gICAgICAgIC5vbWl0KHsgcGFzc3dvcmQ6IHRydWUsIGlkOiB0cnVlLCByb2xlOiB0cnVlIH0pO1xuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHVwZGF0ZVNjaGVtYS5wYXJzZShyZXEuYm9keSk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLnVwZGF0ZVVzZXIoY3VycmVudFVzZXIuaWQsIHtcbiAgICAgICAgLi4udmFsaWRhdGVkRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIGJlZm9yZSBzZW5kaW5nIHJlc3BvbnNlXG4gICAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcmVzLmpzb24odXNlcldpdGhvdXRQYXNzd29yZCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHVzZXIgcHJvZmlsZTonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgcHJvZmlsZScsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvdXNlcnMvOmlkL2RlbGV0ZS1hY2NvdW50IC0gUkVTVFJJQ1RFRCBBZG1pbiBlbmRwb2ludCB0byBkZWxldGUgYW55IHVzZXIgYWNjb3VudC5cbiAgICogU0FGRVRZOiBSZXF1aXJlcyBlbWFpbCBjb25maXJtYXRpb24gYW5kIGRlbGV0aW9uIHJlYXNvbiBmb3IgYXVkaXQgdHJhaWwuXG4gICAqIFdBUk5JTkc6IFRoaXMgaXMgYSBwZXJtYW5lbnQgb3BlcmF0aW9uIHRoYXQgc2hvdWxkIG9ubHkgYmUgdXNlZCBpbiBleGNlcHRpb25hbCBjYXNlcy5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL3VzZXJzLzppZC9kZWxldGUtYWNjb3VudCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdGFyZ2V0VXNlcklkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBjYW4gZGVsZXRlIG90aGVyIHVzZXJzJyBhY2NvdW50c1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnT25seSBhZG1pbmlzdHJhdG9ycyBjYW4gZGVsZXRlIHVzZXIgYWNjb3VudHMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQWRkaXRpb25hbCBzYWZldHkgY2hlY2s6IExvZyB0aGlzIGNyaXRpY2FsIG9wZXJhdGlvblxuICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIENSSVRJQ0FMOiBBZG1pbiAke2N1cnJlbnRVc2VyLmVtYWlsfSBhdHRlbXB0aW5nIHRvIGRlbGV0ZSB1c2VyICR7dGFyZ2V0VXNlcklkfWApO1xuXG4gICAgICBpZiAoIXRhcmdldFVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9SRVFVRVNUJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmeSB0YXJnZXQgdXNlciBleGlzdHNcbiAgICAgIGNvbnN0IHRhcmdldFVzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXIodGFyZ2V0VXNlcklkKTtcbiAgICAgIGlmICghdGFyZ2V0VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgY29uZmlybUVtYWlsLCByZWFzb24gfSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBWZXJpZnkgZW1haWwgY29uZmlybWF0aW9uXG4gICAgICBpZiAoY29uZmlybUVtYWlsICE9PSB0YXJnZXRVc2VyLmVtYWlsKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0VtYWlsIGNvbmZpcm1hdGlvbiBkb2VzIG5vdCBtYXRjaCcsXG4gICAgICAgICAgY29kZTogJ0VNQUlMX01JU01BVENIJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSBhbGwgcmVsYXRlZCBkYXRhIGluIHRoZSBjb3JyZWN0IG9yZGVyIHRvIGhhbmRsZSBmb3JlaWduIGtleSBjb25zdHJhaW50c1xuICAgICAgY29uc3QgZGVsZXRpb25Qcm9taXNlcyA9IFtcbiAgICAgICAgLy8gRGVsZXRlIHVzZXIgcmVsYXRpb25zaGlwc1xuICAgICAgICBkYlxuICAgICAgICAgIC5kZWxldGUoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB0YXJnZXRVc2VySWQpKSxcbiAgICAgICAgZGIuZGVsZXRlKHNjaGVtYS51c2VyUmVzaWRlbmNlcykud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdGFyZ2V0VXNlcklkKSksXG4gICAgICAgIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuZG9jdW1lbnRzLnVwbG9hZGVkQnlJZCwgdGFyZ2V0VXNlcklkKSksXG5cbiAgICAgICAgLy8gRGVsZXRlIGludml0YXRpb25zXG4gICAgICAgIGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgdGFyZ2V0VXNlci5lbWFpbCkpLFxuICAgICAgXTtcblxuICAgICAgLy8gVHJ5IHRvIGRlbGV0ZSBmcm9tIG9wdGlvbmFsIHRhYmxlcyB0aGF0IG1pZ2h0IG5vdCBleGlzdFxuICAgICAgY29uc3Qgb3B0aW9uYWxEZWxldGlvbnMgPSBbXG4gICAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgICAgLmRlbGV0ZShzY2hlbWEubm90aWZpY2F0aW9ucylcbiAgICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5ub3RpZmljYXRpb25zLnVzZXJJZCwgdGFyZ2V0VXNlcklkKSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgICAgaWYgKGVycm9yLmNhdXNlPy5jb2RlID09PSAnNDJQMDEnKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3RpZmljYXRpb25zIHRhYmxlIG5vdCBmb3VuZCwgc2tpcHBpbmcuLi4nKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzKVxuICAgICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMuc3VibWl0dGVkQnksIHRhcmdldFVzZXJJZCkpO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIGlmIChlcnJvci5jYXVzZT8uY29kZSA9PT0gJzQyUDAxJykge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTWFpbnRlbmFuY2UgcmVxdWVzdHMgdGFibGUgbm90IGZvdW5kLCBza2lwcGluZy4uLicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgLy8gRXhlY3V0ZSBjb3JlIGRlbGV0aW9ucyBmaXJzdFxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoZGVsZXRpb25Qcm9taXNlcyk7XG5cbiAgICAgIC8vIEV4ZWN1dGUgb3B0aW9uYWwgZGVsZXRpb25zXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChvcHRpb25hbERlbGV0aW9ucy5tYXAoKGZuKSA9PiBmbigpKSk7XG5cbiAgICAgIC8vIEZpbmFsbHksIGRlbGV0ZSB0aGUgdXNlciBhY2NvdW50XG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIHRhcmdldFVzZXJJZCkpO1xuXG4gICAgICAvLyBDbGVhciBhbGwgY2FjaGVzIHRvIGVuc3VyZSB0aGUgdXNlciBsaXN0IHVwZGF0ZXMgaW1tZWRpYXRlbHlcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzJyk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3VzZXJzJywgYHVzZXI6JHt0YXJnZXRVc2VySWR9YCk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3VzZXJzJywgYHVzZXJfZW1haWw6JHt0YXJnZXRVc2VyLmVtYWlsfWApO1xuXG4gICAgICAvLyBMb2cgdGhlIGRlbGV0aW9uIGZvciBhdWRpdCBwdXJwb3Nlc1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBVc2VyIGFjY291bnQgZGVsZXRlZCBieSBhZG1pbiAke2N1cnJlbnRVc2VyLmVtYWlsfSAoJHtjdXJyZW50VXNlci5pZH0pOiAke3RhcmdldFVzZXIuZW1haWx9ICgke3RhcmdldFVzZXJJZH0pLiBSZWFzb246ICR7cmVhc29uIHx8ICdOb3QgcHJvdmlkZWQnfWBcbiAgICAgICk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgYWNjb3VudCBhbmQgYWxsIGFzc29jaWF0ZWQgZGF0YSBoYXZlIGJlZW4gcGVybWFuZW50bHkgZGVsZXRlZCcsXG4gICAgICAgIGRlbGV0ZWRVc2VySWQ6IHRhcmdldFVzZXJJZCxcbiAgICAgICAgZGVsZXRlZFVzZXJFbWFpbDogdGFyZ2V0VXNlci5lbWFpbCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyB1c2VyIGFjY291bnQ6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIHVzZXIgYWNjb3VudCcsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvdXNlcnMvbWUvY2hhbmdlLXBhc3N3b3JkIC0gQ2hhbmdlIGN1cnJlbnQgdXNlcidzIHBhc3N3b3JkLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvdXNlcnMvbWUvY2hhbmdlLXBhc3N3b3JkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGN1cnJlbnRQYXNzd29yZCwgbmV3UGFzc3dvcmQgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWN1cnJlbnRQYXNzd29yZCB8fCAhbmV3UGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBhbmQgbmV3IHBhc3N3b3JkIGFyZSByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfSU5QVVQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IGN1cnJlbnQgcGFzc3dvcmRcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXIoY3VycmVudFVzZXIuaWQpO1xuICAgICAgaWYgKCF1c2VyIHx8ICEoYXdhaXQgYmNyeXB0LmNvbXBhcmUoY3VycmVudFBhc3N3b3JkLCB1c2VyLnBhc3N3b3JkKSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ3VycmVudCBwYXNzd29yZCBpcyBpbmNvcnJlY3QnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1BBU1NXT1JEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhc2ggbmV3IHBhc3N3b3JkXG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKG5ld1Bhc3N3b3JkLCAxMik7XG5cbiAgICAgIC8vIFVwZGF0ZSBwYXNzd29yZFxuICAgICAgYXdhaXQgc3RvcmFnZS51cGRhdGVVc2VyKGN1cnJlbnRVc2VyLmlkLCB7XG4gICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdQYXNzd29yZCBjaGFuZ2VkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY2hhbmdpbmcgcGFzc3dvcmQ6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2hhbmdlIHBhc3N3b3JkJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS91c2Vycy9kZW1vIC0gQ3JlYXRlcyBhIGRlbW8gdXNlciBkaXJlY3RseSB3aXRob3V0IGludml0YXRpb25cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL3VzZXJzL2RlbW8nLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gY3JlYXRlIGRlbW8gdXNlcnNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZmlyc3ROYW1lLCBsYXN0TmFtZSwgcm9sZSwgb3JnYW5pemF0aW9uSWQsIHJlc2lkZW5jZUlkIH0gPSByZXEuYm9keTtcblxuICAgICAgLy8gVmFsaWRhdGUgZGVtbyByb2xlXG4gICAgICBpZiAoIVsnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnXS5pbmNsdWRlcyhyb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGRlbW8gcm9sZScsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfUk9MRScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICAgIGlmICghZmlyc3ROYW1lIHx8ICFsYXN0TmFtZSB8fCAhb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmlyc3QgbmFtZSwgbGFzdCBuYW1lLCBhbmQgb3JnYW5pemF0aW9uIGFyZSByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ01JU1NJTkdfUkVRVUlSRURfRklFTERTJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIGRlbW8gZW1haWxcbiAgICAgIGNvbnN0IGVtYWlsID0gYCR7Zmlyc3ROYW1lLnRvTG93ZXJDYXNlKCl9LiR7bGFzdE5hbWUudG9Mb3dlckNhc2UoKX1AZGVtby5jb21gO1xuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGFscmVhZHkgZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ1VzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJCeUVtYWlsKGVtYWlsKTtcbiAgICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRGVtbyB1c2VyIHdpdGggdGhpcyBuYW1lIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9FWElTVFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGRlbW8gdXNlciB3aXRoIHNlY3VyZSByYW5kb20gcGFzc3dvcmRcbiAgICAgIGNvbnN0IHJhbmRvbVBhc3N3b3JkID0gcmFuZG9tQnl0ZXMoMTIpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2goYERlbW8ke3JhbmRvbVBhc3N3b3JkfSFgLCAxMik7XG5cbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6IHNhbml0aXplTmFtZShmaXJzdE5hbWUpLFxuICAgICAgICBsYXN0TmFtZTogc2FuaXRpemVOYW1lKGxhc3ROYW1lKSxcbiAgICAgICAgZW1haWw6IG5vcm1hbGl6ZUVtYWlsKGVtYWlsKSxcbiAgICAgICAgdXNlcm5hbWU6IGdlbmVyYXRlVXNlcm5hbWVGcm9tRW1haWwoZW1haWwpLFxuICAgICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICAgIGxhbmd1YWdlOiAnZnInLCAvLyBEZWZhdWx0IHRvIEZyZW5jaCBmb3IgUXVlYmVjXG4gICAgICAgIHJvbGU6IHJvbGUgYXMgYW55LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZVVzZXIodXNlckRhdGEgYXMgSW5zZXJ0VXNlcik7XG5cbiAgICAgIC8vIExvZyB0aGUgdXNlciBjcmVhdGlvblxuICAgICAgbG9nVXNlckNyZWF0aW9uKHtcbiAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgbWV0aG9kOiAnZGlyZWN0JyxcbiAgICAgICAgcm9sZSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENsZWFyIGNhY2hlXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3VzZXJzJywgJ2FsbF91c2VycycpO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdEZW1vIHVzZXIgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgZmlyc3ROYW1lOiBuZXdVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbmV3VXNlci5sYXN0TmFtZSxcbiAgICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgICByb2xlOiBuZXdVc2VyLnJvbGUsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgZGVtbyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBkZW1vIHVzZXInLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2ludml0YXRpb25zIC0gQ3JlYXRlcyBhIG5ldyBpbnZpdGF0aW9uXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gT25seSBhZG1pbnMgYW5kIG1hbmFnZXJzIGNhbiBzZW5kIGludml0YXRpb25zXG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7XG4gICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICByZXNpZGVuY2VJZCxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHJvbGUsXG4gICAgICAgIGludml0ZWRCeVVzZXJJZCxcbiAgICAgICAgZXhwaXJlc0F0LFxuICAgICAgICBwZXJzb25hbE1lc3NhZ2UsXG4gICAgICB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkcyBmaXJzdFxuICAgICAgaWYgKCFvcmdhbml6YXRpb25JZCB8fCAhZW1haWwgfHwgIXJvbGUgfHwgIWV4cGlyZXNBdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdPcmdhbml6YXRpb24sIGVtYWlsLCByb2xlLCBhbmQgZXhwaXJ5IGRhdGUgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19SRVFVSVJFRF9GSUVMRFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVGhlbiB2YWxpZGF0ZSBlbWFpbCBmb3JtYXRcbiAgICAgIGNvbnN0IGVtYWlsUmVnZXggPSAvXlteXFxzQF0rQFteXFxzQF0rXFwuW15cXHNAXSskLztcbiAgICAgIGlmICghZW1haWxSZWdleC50ZXN0KGVtYWlsKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGVtYWlsIGZvcm1hdCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfRU1BSUwnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcm9sZSBwZXJtaXNzaW9uc1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAvLyBDaGVjayBpZiBtYW5hZ2VyIGlzIHRyeWluZyB0byBpbnZpdGUgYWRtaW5cbiAgICAgICAgaWYgKHJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ01hbmFnZXJzIGNhbiBvbmx5IGludml0ZSByZXNpZGVudCwgdGVuYW50LCBhbmQgbWFuYWdlciByb2xlcycsXG4gICAgICAgICAgICBjb2RlOiAnUk9MRV9QRVJNSVNTSU9OX0RFTklFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgdGhlIGRlbW8gb3JnYW5pemF0aW9uIHRvIGNoZWNrIGlmIGl0J3MgYSBkZW1vIG9yZ1xuICAgICAgICBjb25zdCB0YXJnZXRPcmcgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAodGFyZ2V0T3JnLmxlbmd0aCA+IDAgJiYgdGFyZ2V0T3JnWzBdLnR5cGUgPT09ICdEZW1vJykge1xuICAgICAgICAgIC8vIEZvciBkZW1vIG9yZ2FuaXphdGlvbnMsIGFsbG93IG5vcm1hbCByb2xlcyAocmVzaWRlbnQsIHRlbmFudCwgbWFuYWdlcilcbiAgICAgICAgICBpZiAoIVsncmVzaWRlbnQnLCAndGVuYW50JywgJ21hbmFnZXInXS5pbmNsdWRlcyhyb2xlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcm9sZSBmb3IgZGVtbyBvcmdhbml6YXRpb24nLFxuICAgICAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9ERU1PX1JPTEUnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZvciByZWd1bGFyIG9yZ2FuaXphdGlvbnMsIG1hbmFnZXJzIGNhbiBpbnZpdGUgcmVzaWRlbnQsIHRlbmFudCwgbWFuYWdlclxuICAgICAgICAgIGlmICghWydyZXNpZGVudCcsICd0ZW5hbnQnLCAnbWFuYWdlciddLmluY2x1ZGVzKHJvbGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBtZXNzYWdlOiAnTWFuYWdlcnMgY2FuIG9ubHkgaW52aXRlIHJlc2lkZW50LCB0ZW5hbnQsIGFuZCBtYW5hZ2VyIHJvbGVzJyxcbiAgICAgICAgICAgICAgY29kZTogJ1JPTEVfUEVSTUlTU0lPTl9ERU5JRUQnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlckJ5RW1haWwoZW1haWwpO1xuICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIHdpdGggdGhpcyBlbWFpbCBhbHJlYWR5IGV4aXN0cycsXG4gICAgICAgICAgY29kZTogJ1VTRVJfRVhJU1RTJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciBleGlzdGluZyBwZW5kaW5nIGludml0YXRpb25zIGZvciB0aGUgc2FtZSBlbWFpbCBhbmQgb3JnYW5pemF0aW9uXG4gICAgICAvLyBJZiBmb3VuZCwgZGVsZXRlIHRoZW0gdG8gcmVwbGFjZSB3aXRoIG5ldyBpbnZpdGF0aW9uXG4gICAgICBjb25zdCBleGlzdGluZ0ludml0YXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgZW1haWwpLFxuICAgICAgICAgICAgZXEoc2NoZW1hLmludml0YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25JZCksXG4gICAgICAgICAgICBlcShzY2hlbWEuaW52aXRhdGlvbnMuc3RhdHVzLCAncGVuZGluZycpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBpZiAoZXhpc3RpbmdJbnZpdGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5SEIFJlcGxhY2luZyAke2V4aXN0aW5nSW52aXRhdGlvbnMubGVuZ3RofSBleGlzdGluZyBpbnZpdGF0aW9uKHMpIGZvciBlbWFpbDogJHtlbWFpbH1gKTtcbiAgICAgICAgLy8gRGVsZXRlIGV4aXN0aW5nIHBlbmRpbmcgaW52aXRhdGlvbnMgZm9yIHRoaXMgZW1haWwvb3JnYW5pemF0aW9uXG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsIGVtYWlsKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmludml0YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25JZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsICdwZW5kaW5nJylcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBHZW5lcmF0ZSBzZWN1cmUgaW52aXRhdGlvbiB0b2tlblxuICAgICAgY29uc3QgdG9rZW4gPSByYW5kb21CeXRlcygzMikudG9TdHJpbmcoJ2hleCcpO1xuICAgICAgY29uc3QgdG9rZW5IYXNoID0gY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKHRva2VuKS5kaWdlc3QoJ2hleCcpO1xuXG4gICAgICAvLyBDcmVhdGUgaW52aXRhdGlvbiByZWNvcmRcbiAgICAgIGNvbnN0IGludml0YXRpb25EYXRhID0ge1xuICAgICAgICBvcmdhbml6YXRpb25JZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IHJlc2lkZW5jZUlkIHx8IG51bGwsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgdG9rZW5IYXNoLFxuICAgICAgICByb2xlOiByb2xlIGFzIGFueSxcbiAgICAgICAgaW52aXRlZEJ5VXNlcklkOiBjdXJyZW50VXNlci5pZCxcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShleHBpcmVzQXQpLFxuICAgICAgICBwZXJzb25hbE1lc3NhZ2U6IHBlcnNvbmFsTWVzc2FnZSB8fCBudWxsLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgW25ld0ludml0YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC52YWx1ZXMoaW52aXRhdGlvbkRhdGEpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBkZXRhaWxzIGZvciBlbWFpbFxuICAgICAgY29uc3QgW29yZ2FuaXphdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIC8vIFNlbmQgaW52aXRhdGlvbiBlbWFpbFxuICAgICAgY29uc3QgcmVjaXBpZW50TmFtZSA9IGVtYWlsLnNwbGl0KCdAJylbMF07IC8vIFVzZSBlbWFpbCBwcmVmaXggYXMgbmFtZVxuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uTmFtZSA9IG9yZ2FuaXphdGlvbj8ubmFtZSB8fCAnS292ZW8gR2VzdGlvbic7XG4gICAgICBjb25zdCBpbnZpdGVyTmFtZSA9IGAke2N1cnJlbnRVc2VyLmZpcnN0TmFtZSB8fCBjdXJyZW50VXNlci5lbWFpbH0gJHtjdXJyZW50VXNlci5sYXN0TmFtZSB8fCAnJ31gLnRyaW0oKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1haWxTZW50ID0gYXdhaXQgZW1haWxTZXJ2aWNlLnNlbmRJbnZpdGF0aW9uRW1haWwoXG4gICAgICAgIGVtYWlsLFxuICAgICAgICByZWNpcGllbnROYW1lLFxuICAgICAgICB0b2tlbiwgLy8gVXNlIHRoZSB1bmhhc2hlZCB0b2tlbiBmb3IgdGhlIGVtYWlsIFVSTFxuICAgICAgICBvcmdhbml6YXRpb25OYW1lLFxuICAgICAgICBpbnZpdGVyTmFtZSxcbiAgICAgICAgbmV3IERhdGUoZXhwaXJlc0F0KSxcbiAgICAgICAgJ2ZyJywgLy8gRGVmYXVsdCB0byBGcmVuY2ggZm9yIFF1ZWJlY1xuICAgICAgICBwZXJzb25hbE1lc3NhZ2VcbiAgICAgICk7XG5cbiAgICAgIC8vIExvZyBpbnZpdGF0aW9uIGNyZWF0aW9uXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEludml0YXRpb24gY3JlYXRlZDonLCB7XG4gICAgICAgIGlkOiBuZXdJbnZpdGF0aW9uLmlkLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcm9sZSxcbiAgICAgICAgb3JnYW5pemF0aW9uSWQsXG4gICAgICAgIGludml0ZWRCeTogY3VycmVudFVzZXIuZW1haWwsXG4gICAgICAgIGVtYWlsU2VudCxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGb3IgdGVzdHMsIHdlJ2xsIHRyZWF0IGVtYWlsIGZhaWx1cmUgYXMgc3VjY2VzcyBzaW5jZSB0ZXN0cyBtYXkgbm90IGhhdmUgZW1haWwgY29uZmlndXJlZFxuICAgICAgaWYgKCFlbWFpbFNlbnQgJiYgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICAgICAgICAvLyBJZiBlbWFpbCBmYWlsZWQgYnV0IGludml0YXRpb24gd2FzIGNyZWF0ZWQsIGxvZyB0aGUgaXNzdWVcbiAgICAgICAgY29uc29sZS5lcnJvcign4pqg77iPIEludml0YXRpb24gY3JlYXRlZCBidXQgZW1haWwgZmFpbGVkIHRvIHNlbmQnKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjA3KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBjcmVhdGVkIGJ1dCBlbWFpbCBmYWlsZWQgdG8gc2VuZCcsXG4gICAgICAgICAgaW52aXRhdGlvbklkOiBuZXdJbnZpdGF0aW9uLmlkLFxuICAgICAgICAgIGVtYWlsU2VudDogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIHNlbnQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgaW52aXRhdGlvbklkOiBuZXdJbnZpdGF0aW9uLmlkLFxuICAgICAgICBlbWFpbFNlbnQ6IHRydWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgaW52aXRhdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgaW52aXRhdGlvbicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9pbnZpdGF0aW9ucyAtIEdldHMgYWxsIGludml0YXRpb25zIChhZG1pbi9tYW5hZ2VyIG9ubHkpXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2ludml0YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIHZpZXcgaW52aXRhdGlvbnNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGxldCBpbnZpdGF0aW9ucztcbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWluIGNhbiBzZWUgYWxsIGludml0YXRpb25zXG4gICAgICAgIGludml0YXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLmludml0YXRpb25zLmNyZWF0ZWRBdCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBNYW5hZ2VycyBjYW4gb25seSBzZWUgaW52aXRhdGlvbnMgdGhleSBzZW50XG4gICAgICAgIGludml0YXRpb25zID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pbnZpdGVkQnlVc2VySWQsIGN1cnJlbnRVc2VyLmlkKSlcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEuaW52aXRhdGlvbnMuY3JlYXRlZEF0KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oaW52aXRhdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBpbnZpdGF0aW9uczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBpbnZpdGF0aW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvaW52aXRhdGlvbnMvdmFsaWRhdGUgLSBWYWxpZGF0ZXMgYW4gaW52aXRhdGlvbiB0b2tlblxuICAgKiBQdWJsaWMgZW5kcG9pbnQgZm9yIGludml0YXRpb24gdmFsaWRhdGlvbiBkdXJpbmcgcmVnaXN0cmF0aW9uXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy92YWxpZGF0ZScsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgdG9rZW4gfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ1Rva2VuIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnVE9LRU5fUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGludml0YXRpb24gYnkgdG9rZW5cbiAgICAgIGNvbnN0IFtpbnZpdGF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMudG9rZW4sIHRva2VuKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoIWludml0YXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBub3QgZm91bmQgb3IgaW52YWxpZCB0b2tlbicsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGludml0YXRpb24gaXMgZXhwaXJlZFxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKGludml0YXRpb24uZXhwaXJlc0F0KTtcbiAgICAgIGlmIChub3cgPiBleHBpcmVzQXQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgZXhwaXJlZCcsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fRVhQSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBpbnZpdGF0aW9uIGlzIGFscmVhZHkgdXNlZFxuICAgICAgaWYgKGludml0YXRpb24uc3RhdHVzID09PSAnYWNjZXB0ZWQnKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gaGFzIGFscmVhZHkgYmVlbiB1c2VkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9BTFJFQURZX1VTRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBpbmZvcm1hdGlvblxuICAgICAgY29uc3QgW29yZ2FuaXphdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgaW52aXRhdGlvbi5vcmdhbml6YXRpb25JZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgLy8gR2V0IGludml0ZXIgaW5mb3JtYXRpb25cbiAgICAgIGNvbnN0IFtpbnZpdGVyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBzY2hlbWEudXNlcnMuaWQsXG4gICAgICAgICAgZmlyc3ROYW1lOiBzY2hlbWEudXNlcnMuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiBzY2hlbWEudXNlcnMubGFzdE5hbWUsXG4gICAgICAgICAgZW1haWw6IHNjaGVtYS51c2Vycy5lbWFpbCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCBpbnZpdGF0aW9uLmludml0ZWRCeVVzZXJJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgLy8gUmV0dXJuIHN1Y2Nlc3NmdWwgdmFsaWRhdGlvblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgICBpbnZpdGF0aW9uOiB7XG4gICAgICAgICAgaWQ6IGludml0YXRpb24uaWQsXG4gICAgICAgICAgZW1haWw6IGludml0YXRpb24uZW1haWwsXG4gICAgICAgICAgcm9sZTogaW52aXRhdGlvbi5yb2xlLFxuICAgICAgICAgIGV4cGlyZXNBdDogaW52aXRhdGlvbi5leHBpcmVzQXQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBpbnZpdGF0aW9uLmNyZWF0ZWRBdCxcbiAgICAgICAgfSxcbiAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9uPy5uYW1lIHx8ICdVbmtub3duIE9yZ2FuaXphdGlvbicsXG4gICAgICAgIGludml0ZXJOYW1lOiBpbnZpdGVyID8gYCR7aW52aXRlci5maXJzdE5hbWV9ICR7aW52aXRlci5sYXN0TmFtZX1gLnRyaW0oKSA6ICdVbmtub3duIFVzZXInLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHZhbGlkYXRpbmcgaW52aXRhdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yIGR1cmluZyB2YWxpZGF0aW9uJyxcbiAgICAgICAgY29kZTogJ1ZBTElEQVRJT05fRVJST1InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2ludml0YXRpb25zL2FjY2VwdC86dG9rZW4gLSBBY2NlcHQgYW4gaW52aXRhdGlvbiBhbmQgY3JlYXRlIHVzZXIgYWNjb3VudFxuICAgKiBQdWJsaWMgZW5kcG9pbnQgZm9yIGNvbXBsZXRpbmcgcmVnaXN0cmF0aW9uIHZpYSBpbnZpdGF0aW9uXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy9hY2NlcHQvOnRva2VuJywgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB0b2tlbiB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgZmlyc3ROYW1lLFxuICAgICAgICBsYXN0TmFtZSxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIHBob25lLFxuICAgICAgICBsYW5ndWFnZSxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50LFxuICAgICAgICBtYXJrZXRpbmdDb25zZW50LFxuICAgICAgICBhbmFseXRpY3NDb25zZW50LFxuICAgICAgICB0aGlyZFBhcnR5Q29uc2VudCxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzLFxuICAgICAgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1Rva2VuIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnVE9LRU5fUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGludml0YXRpb24gYnkgdG9rZW5cbiAgICAgIGNvbnN0IFtpbnZpdGF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMudG9rZW4sIHRva2VuKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoIWludml0YXRpb24pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBub3QgZm91bmQgb3IgaW52YWxpZCB0b2tlbicsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGludml0YXRpb24gaXMgZXhwaXJlZFxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKGludml0YXRpb24uZXhwaXJlc0F0KTtcbiAgICAgIGlmIChub3cgPiBleHBpcmVzQXQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgZXhwaXJlZCcsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fRVhQSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBpbnZpdGF0aW9uIGlzIGFscmVhZHkgdXNlZFxuICAgICAgaWYgKGludml0YXRpb24uc3RhdHVzID09PSAnYWNjZXB0ZWQnKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gaGFzIGFscmVhZHkgYmVlbiB1c2VkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9BTFJFQURZX1VTRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgICBpZiAoIWZpcnN0TmFtZSB8fCAhbGFzdE5hbWUgfHwgIXBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZpcnN0IG5hbWUsIGxhc3QgbmFtZSwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ01JU1NJTkdfUkVRVUlSRURfRklFTERTJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGNvbnNlbnRzXG4gICAgICBpZiAoIWRhdGFDb2xsZWN0aW9uQ29uc2VudCB8fCAhYWNrbm93bGVkZ2VkUmlnaHRzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1JlcXVpcmVkIHByaXZhY3kgY29uc2VudHMgbXVzdCBiZSBnaXZlbicsXG4gICAgICAgICAgY29kZTogJ01JU1NJTkdfUkVRVUlSRURfQ09OU0VOVFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFzaCBwYXNzd29yZFxuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTIpO1xuXG4gICAgICAvLyBDcmVhdGUgdXNlciBhY2NvdW50XG4gICAgICBjb25zdCB1c2VyRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiBzYW5pdGl6ZU5hbWUoZmlyc3ROYW1lKSxcbiAgICAgICAgbGFzdE5hbWU6IHNhbml0aXplTmFtZShsYXN0TmFtZSksXG4gICAgICAgIGVtYWlsOiBub3JtYWxpemVFbWFpbChpbnZpdGF0aW9uLmVtYWlsKSxcbiAgICAgICAgdXNlcm5hbWU6IGdlbmVyYXRlVXNlcm5hbWVGcm9tRW1haWwoaW52aXRhdGlvbi5lbWFpbCksXG4gICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgcGhvbmU6IHBob25lID8gc2FuaXRpemVTdHJpbmcocGhvbmUpIDogJycsXG4gICAgICAgIGxhbmd1YWdlOiBsYW5ndWFnZSB8fCAnZnInLFxuICAgICAgICByb2xlOiBpbnZpdGF0aW9uLnJvbGUgYXMgYW55LFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGludml0YXRpb24ub3JnYW5pemF0aW9uSWQsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBuZXdVc2VyID0gYXdhaXQgc3RvcmFnZS5jcmVhdGVVc2VyKHVzZXJEYXRhIGFzIEluc2VydFVzZXIpO1xuXG4gICAgICAvLyBDcmVhdGUgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnQgaWYgb3JnYW5pemF0aW9uSWQgaXMgcHJvdmlkZWRcbiAgICAgIGlmIChpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvblJvbGU6IGludml0YXRpb24ucm9sZSxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgVXNlciBhc3NpZ25lZCB0byBvcmdhbml6YXRpb246Jywge1xuICAgICAgICAgIHVzZXJJZDogbmV3VXNlci5pZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogaW52aXRhdGlvbi5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICByb2xlOiBpbnZpdGF0aW9uLnJvbGUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgcmVzaWRlbmNlIGFzc2lnbm1lbnQgaWYgcmVzaWRlbmNlSWQgaXMgcHJvdmlkZWRcbiAgICAgIGlmIChpbnZpdGF0aW9uLnJlc2lkZW5jZUlkKSB7XG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlclJlc2lkZW5jZXMpLnZhbHVlcyh7XG4gICAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiBpbnZpdGF0aW9uLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IGludml0YXRpb24ucm9sZSA9PT0gJ3RlbmFudCcgPyAndGVuYW50JyA6ICdvY2N1cGFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBVc2VyIGFzc2lnbmVkIHRvIHJlc2lkZW5jZTonLCB7XG4gICAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiBpbnZpdGF0aW9uLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IGludml0YXRpb24ucm9sZSA9PT0gJ3RlbmFudCcgPyAndGVuYW50JyA6ICdvY2N1cGFudCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBNYXJrIGludml0YXRpb24gYXMgYWNjZXB0ZWRcbiAgICAgIGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBzdGF0dXM6ICdhY2NlcHRlZCcsXG4gICAgICAgICAgYWNjZXB0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICBhY2NlcHRlZEJ5OiBuZXdVc2VyLmlkLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaW52aXRhdGlvbi5pZCkpO1xuXG4gICAgICAvLyBMb2cgdXNlciBjcmVhdGlvblxuICAgICAgbG9nVXNlckNyZWF0aW9uKHtcbiAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgbWV0aG9kOiAnaW52aXRhdGlvbicsXG4gICAgICAgIHJvbGU6IGludml0YXRpb24ucm9sZSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENsZWFyIGNhY2hlXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3VzZXJzJywgJ2FsbF91c2VycycpO1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuXG4gICAgICBjb25zb2xlLmxvZygn4pyFIFVzZXIgY3JlYXRlZCB2aWEgaW52aXRhdGlvbiBhY2NlcHRhbmNlOicsIHtcbiAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgcm9sZTogbmV3VXNlci5yb2xlLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogaW52aXRhdGlvbi5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IGludml0YXRpb24ucmVzaWRlbmNlSWQsXG4gICAgICAgIGFzc2lnbmVkVG9Pcmdhbml6YXRpb246ICEhaW52aXRhdGlvbi5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgYXNzaWduZWRUb1Jlc2lkZW5jZTogISFpbnZpdGF0aW9uLnJlc2lkZW5jZUlkLFxuICAgICAgfSk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0FjY291bnQgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgZmlyc3ROYW1lOiBuZXdVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogbmV3VXNlci5sYXN0TmFtZSxcbiAgICAgICAgICBlbWFpbDogbmV3VXNlci5lbWFpbCxcbiAgICAgICAgICByb2xlOiBuZXdVc2VyLnJvbGUsXG4gICAgICAgICAgbGFuZ3VhZ2U6IG5ld1VzZXIubGFuZ3VhZ2UsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgYWNjZXB0aW5nIGludml0YXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yIGR1cmluZyBhY2NvdW50IGNyZWF0aW9uJyxcbiAgICAgICAgY29kZTogJ0lOVklUQVRJT05fQUNDRVBUX0VSUk9SJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS9pbnZpdGF0aW9ucy86aWQvcmVzZW5kIC0gUmVzZW5kcyBhbiBpbnZpdGF0aW9uXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy86aWQvcmVzZW5kJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICAvLyBHZXQgaW52aXRhdGlvblxuICAgICAgY29uc3QgW2ludml0YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmICghaW52aXRhdGlvbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBlcm1pc3Npb25zXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJyAmJiBpbnZpdGF0aW9uLmludml0ZWRCeVVzZXJJZCAhPT0gY3VycmVudFVzZXIuaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ2FuIG9ubHkgcmVzZW5kIHlvdXIgb3duIGludml0YXRpb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBpbnZpdGF0aW9uIHdpdGggbmV3IGV4cGlyeVxuICAgICAgY29uc3QgbmV3RXhwaXJlc0F0ID0gbmV3IERhdGUoKTtcbiAgICAgIG5ld0V4cGlyZXNBdC5zZXREYXRlKG5ld0V4cGlyZXNBdC5nZXREYXRlKCkgKyA3KTsgLy8gRXh0ZW5kIGJ5IDcgZGF5c1xuXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgZXhwaXJlc0F0OiBuZXdFeHBpcmVzQXQsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpO1xuXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIGRldGFpbHMgZm9yIGVtYWlsXG4gICAgICBjb25zdCBbb3JnYW5pemF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBTZW5kIGludml0YXRpb24gZW1haWwgYWdhaW5cbiAgICAgIGNvbnN0IHJlY2lwaWVudE5hbWUgPSBpbnZpdGF0aW9uLmVtYWlsLnNwbGl0KCdAJylbMF07IC8vIFVzZSBlbWFpbCBwcmVmaXggYXMgbmFtZVxuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uTmFtZSA9IG9yZ2FuaXphdGlvbj8ubmFtZSB8fCAnS292ZW8gR2VzdGlvbic7XG4gICAgICBjb25zdCBpbnZpdGVyTmFtZSA9IGAke2N1cnJlbnRVc2VyLmZpcnN0TmFtZSB8fCBjdXJyZW50VXNlci5lbWFpbH0gJHtjdXJyZW50VXNlci5sYXN0TmFtZSB8fCAnJ31gLnRyaW0oKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1haWxTZW50ID0gYXdhaXQgZW1haWxTZXJ2aWNlLnNlbmRJbnZpdGF0aW9uRW1haWwoXG4gICAgICAgIGludml0YXRpb24uZW1haWwsXG4gICAgICAgIHJlY2lwaWVudE5hbWUsXG4gICAgICAgIGludml0YXRpb24udG9rZW4sIC8vIFVzZSB0aGUgZXhpc3RpbmcgdG9rZW5cbiAgICAgICAgb3JnYW5pemF0aW9uTmFtZSxcbiAgICAgICAgaW52aXRlck5hbWUsXG4gICAgICAgIG5ld0V4cGlyZXNBdCxcbiAgICAgICAgJ2ZyJywgLy8gRGVmYXVsdCB0byBGcmVuY2ggZm9yIFF1ZWJlY1xuICAgICAgICBpbnZpdGF0aW9uLnBlcnNvbmFsTWVzc2FnZVxuICAgICAgKTtcblxuICAgICAgY29uc29sZS5sb2coJ+KchSBJbnZpdGF0aW9uIHJlc2VudDonLCB7XG4gICAgICAgIGlkLFxuICAgICAgICBlbWFpbDogaW52aXRhdGlvbi5lbWFpbCxcbiAgICAgICAgbmV3RXhwaXJlc0F0LFxuICAgICAgICBlbWFpbFNlbnQsXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFlbWFpbFNlbnQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4pqg77iPIEludml0YXRpb24gdXBkYXRlZCBidXQgZW1haWwgZmFpbGVkIHRvIHJlc2VuZCcpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDcpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIHVwZGF0ZWQgYnV0IGVtYWlsIGZhaWxlZCB0byByZXNlbmQnLFxuICAgICAgICAgIGVtYWlsU2VudDogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIHJlc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBlbWFpbFNlbnQ6IHRydWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVzZW5kaW5nIGludml0YXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gcmVzZW5kIGludml0YXRpb24nLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==