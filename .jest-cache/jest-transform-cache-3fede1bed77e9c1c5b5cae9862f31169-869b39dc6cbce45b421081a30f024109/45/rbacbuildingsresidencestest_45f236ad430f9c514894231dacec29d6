cd5de059e4bd3be3a995b9d703f0f6f2
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const routes_1 = require("../../server/routes");
const db_1 = require("../../server/db");
const schema = __importStar(require("../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
// Create test app similar to existing tests
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Add test authentication middleware that bypasses real auth
    app.use(async (req, res, next) => {
        const testUserId = req.headers['x-test-user-id'];
        if (testUserId) {
            const [user] = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, testUserId)).limit(1);
            if (user) {
                req.session = {
                    userId: testUserId,
                    isAuthenticated: true,
                    role: user.role
                };
                req.user = user;
            }
        }
        next();
    });
    (0, routes_1.registerRoutes)(app);
    return app;
};
(0, globals_1.describe)('RBAC Buildings and Residences Actions', () => {
    let app;
    let adminUser;
    let managerUser;
    let tenantUser;
    let residentUser;
    let demoManagerUser;
    let testOrganization;
    let otherOrganization;
    let testBuilding;
    let otherBuilding;
    let testResidence;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Clean test data
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.organizations);
        // Create test organizations
        const organizations = await db_1.db
            .insert(schema.organizations)
            .values([
            {
                name: 'Test Organization',
                type: 'Standard',
                address: '123 Test St',
                city: 'Test City',
                province: 'QC',
                postalCode: 'H1H 1H1',
                phone: '514-555-0123',
                email: 'test@org.com',
            },
            {
                name: 'Other Organization',
                type: 'Standard',
                address: '456 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H2H 2H2',
                phone: '514-555-0456',
                email: 'other@org.com',
            }
        ])
            .returning();
        testOrganization = organizations[0];
        otherOrganization = organizations[1];
        // Create test buildings
        const buildings = await db_1.db
            .insert(schema.buildings)
            .values([
            {
                organizationId: testOrganization.id,
                name: 'Test Building',
                address: '123 Test St',
                city: 'Test City',
                province: 'QC',
                postalCode: 'H1H 1H1',
                totalUnits: 10,
                buildingType: 'apartment',
            },
            {
                organizationId: otherOrganization.id,
                name: 'Other Building',
                address: '456 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H2H 2H2',
                totalUnits: 5,
                buildingType: 'apartment',
            }
        ])
            .returning();
        testBuilding = buildings[0];
        otherBuilding = buildings[1];
        // Create test residence
        const [residence] = await db_1.db
            .insert(schema.residences)
            .values({
            buildingId: testBuilding.id,
            unitNumber: '101',
            squareFootage: 1000,
            bedrooms: 2,
            bathrooms: 1,
        })
            .returning();
        testResidence = residence;
        // Create test users
        const users = await db_1.db
            .insert(schema.users)
            .values([
            {
                email: 'admin@test.com',
                username: 'admin',
                password: 'hashedpass',
                firstName: 'Admin',
                lastName: 'User',
                role: 'admin',
                isActive: true,
                phone: '514-555-0001',
            },
            {
                email: 'manager@test.com',
                username: 'manager',
                password: 'hashedpass',
                firstName: 'Manager',
                lastName: 'User',
                role: 'manager',
                isActive: true,
                phone: '514-555-0002',
            },
            {
                email: 'tenant@test.com',
                username: 'tenant',
                password: 'hashedpass',
                firstName: 'Tenant',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0003',
            },
            {
                email: 'resident@test.com',
                username: 'resident',
                password: 'hashedpass',
                firstName: 'Resident',
                lastName: 'User',
                role: 'resident',
                isActive: true,
                phone: '514-555-0004',
            },
            {
                email: 'demo.manager@test.com',
                username: 'demo_manager',
                password: 'hashedpass',
                firstName: 'Demo',
                lastName: 'Manager',
                role: 'demo_manager',
                isActive: true,
                phone: '514-555-0005',
            }
        ])
            .returning();
        adminUser = users.find(u => u.email === 'admin@test.com');
        managerUser = users.find(u => u.email === 'manager@test.com');
        tenantUser = users.find(u => u.email === 'tenant@test.com');
        residentUser = users.find(u => u.email === 'resident@test.com');
        demoManagerUser = users.find(u => u.email === 'demo.manager@test.com');
        // Assign manager to test organization
        await db_1.db
            .insert(schema.userOrganizations)
            .values({
            userId: managerUser.id,
            organizationId: testOrganization.id,
            organizationRole: 'manager',
            isActive: true,
        });
        // Assign tenant and resident to test organization and residence
        await db_1.db
            .insert(schema.userOrganizations)
            .values([
            {
                userId: tenantUser.id,
                organizationId: testOrganization.id,
                organizationRole: 'tenant',
                isActive: true,
            },
            {
                userId: residentUser.id,
                organizationId: testOrganization.id,
                organizationRole: 'resident',
                isActive: true,
            }
        ]);
        await db_1.db
            .insert(schema.userResidences)
            .values([
            {
                userId: tenantUser.id,
                residenceId: testResidence.id,
                relationshipType: 'tenant',
                isActive: true,
            },
            {
                userId: residentUser.id,
                residenceId: testResidence.id,
                relationshipType: 'occupant',
                isActive: true,
            }
        ]);
    });
    (0, globals_1.afterEach)(async () => {
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.organizations);
    });
    (0, globals_1.describe)('Building Field Editing by Role', () => {
        const buildingUpdateData = {
            name: 'Updated Building Name',
            address: '999 Updated St',
            city: 'Updated City',
            province: 'QC',
            postalCode: 'H9H 9H9',
            totalUnits: 15,
            buildingType: 'condo',
            description: 'Updated building description',
        };
        (0, globals_1.it)('should allow admin to edit all building fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', adminUser.id)
                .send(buildingUpdateData)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Building updated successfully');
            // Verify the building was actually updated
            const [updatedBuilding] = await db_1.db
                .select()
                .from(schema.buildings)
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, testBuilding.id));
            (0, globals_1.expect)(updatedBuilding.name).toBe(buildingUpdateData.name);
            (0, globals_1.expect)(updatedBuilding.address).toBe(buildingUpdateData.address);
            (0, globals_1.expect)(updatedBuilding.totalUnits).toBe(buildingUpdateData.totalUnits);
        });
        (0, globals_1.it)('should allow manager to edit buildings in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', managerUser.id)
                .send(buildingUpdateData)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Building updated successfully');
            // Verify the building was updated
            const [updatedBuilding] = await db_1.db
                .select()
                .from(schema.buildings)
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, testBuilding.id));
            (0, globals_1.expect)(updatedBuilding.name).toBe(buildingUpdateData.name);
        });
        (0, globals_1.it)('should prevent manager from editing buildings outside their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${otherBuilding.id}`)
                .set('x-test-user-id', managerUser.id)
                .send(buildingUpdateData);
            // Should fail with 403 or 404 (depending on implementation)
            (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(400);
        });
        (0, globals_1.it)('should prevent tenant from editing building fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', tenantUser.id)
                .send(buildingUpdateData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
        (0, globals_1.it)('should prevent resident from editing building fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', residentUser.id)
                .send(buildingUpdateData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
        (0, globals_1.it)('should allow demo_manager to edit buildings (demo functionality)', async () => {
            // Demo managers should have similar permissions to regular managers
            const response = await (0, supertest_1.default)(app)
                .put(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', demoManagerUser.id)
                .send(buildingUpdateData);
            // Demo managers might have restricted access depending on implementation
            // This test validates the current behavior
            if (response.status === 200) {
                (0, globals_1.expect)(response.body.message).toBe('Building updated successfully');
            }
            else {
                (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(403);
            }
        });
    });
    (0, globals_1.describe)('Building Creation by Role', () => {
        const newBuildingData = {
            organizationId: testOrganization.id,
            name: 'New Test Building',
            address: '789 New St',
            city: 'New City',
            province: 'QC',
            postalCode: 'H3H 3H3',
            totalUnits: 20,
            buildingType: 'townhouse',
        };
        (0, globals_1.it)('should allow admin to create buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/buildings')
                .set('x-test-user-id', adminUser.id)
                .send(newBuildingData)
                .expect(201);
            (0, globals_1.expect)(response.body.message).toBe('Building created successfully');
            (0, globals_1.expect)(response.body.building.name).toBe(newBuildingData.name);
        });
        (0, globals_1.it)('should allow manager to create buildings in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/buildings')
                .set('x-test-user-id', managerUser.id)
                .send(newBuildingData)
                .expect(201);
            (0, globals_1.expect)(response.body.message).toBe('Building created successfully');
        });
        (0, globals_1.it)('should prevent manager from creating buildings in other organizations', async () => {
            const otherOrgBuildingData = {
                ...newBuildingData,
                organizationId: otherOrganization.id,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/buildings')
                .set('x-test-user-id', managerUser.id)
                .send(otherOrgBuildingData);
            (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(400);
        });
        (0, globals_1.it)('should prevent tenant from creating buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/buildings')
                .set('x-test-user-id', tenantUser.id)
                .send(newBuildingData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
        (0, globals_1.it)('should prevent resident from creating buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/buildings')
                .set('x-test-user-id', residentUser.id)
                .send(newBuildingData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
    });
    (0, globals_1.describe)('Residence Field Editing by Role', () => {
        const residenceUpdateData = {
            unitNumber: '102',
            squareFootage: 1200,
            bedrooms: 3,
            bathrooms: 2,
            description: 'Updated residence description',
            parkingSpaces: 1,
            storageSpaces: 1,
        };
        (0, globals_1.it)('should allow admin to edit all residence fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', adminUser.id)
                .send(residenceUpdateData)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Residence updated successfully');
            // Verify the residence was updated
            const [updatedResidence] = await db_1.db
                .select()
                .from(schema.residences)
                .where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence.id));
            (0, globals_1.expect)(updatedResidence.unitNumber).toBe(residenceUpdateData.unitNumber);
            (0, globals_1.expect)(updatedResidence.squareFootage).toBe(residenceUpdateData.squareFootage);
            (0, globals_1.expect)(updatedResidence.bedrooms).toBe(residenceUpdateData.bedrooms);
        });
        (0, globals_1.it)('should allow manager to edit residences in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', managerUser.id)
                .send(residenceUpdateData)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Residence updated successfully');
            // Verify the residence was updated
            const [updatedResidence] = await db_1.db
                .select()
                .from(schema.residences)
                .where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence.id));
            (0, globals_1.expect)(updatedResidence.unitNumber).toBe(residenceUpdateData.unitNumber);
        });
        (0, globals_1.it)('should prevent tenant from editing residence structural fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', tenantUser.id)
                .send(residenceUpdateData);
            // Tenants typically cannot edit structural information
            // Should fail with 403 or only allow limited fields
            if (response.status === 403) {
                (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
            }
            else if (response.status === 200) {
                // If allowed, verify only certain fields can be updated by tenants
                const [updatedResidence] = await db_1.db
                    .select()
                    .from(schema.residences)
                    .where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence.id));
                // Structural fields should not be changed by tenants
                (0, globals_1.expect)(updatedResidence.squareFootage).toBe(1000); // Original value
                (0, globals_1.expect)(updatedResidence.bedrooms).toBe(2); // Original value
            }
        });
        (0, globals_1.it)('should prevent resident from editing residence structural fields', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', residentUser.id)
                .send(residenceUpdateData);
            // Residents typically cannot edit structural information
            if (response.status === 403) {
                (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
            }
            else if (response.status === 200) {
                // If allowed, verify only certain fields can be updated by residents
                const [updatedResidence] = await db_1.db
                    .select()
                    .from(schema.residences)
                    .where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence.id));
                // Structural fields should not be changed by residents
                (0, globals_1.expect)(updatedResidence.squareFootage).toBe(1000); // Original value
                (0, globals_1.expect)(updatedResidence.bedrooms).toBe(2); // Original value
            }
        });
        (0, globals_1.it)('should allow demo_manager to edit residences (demo functionality)', async () => {
            const response = await (0, supertest_1.default)(app)
                .put(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', demoManagerUser.id)
                .send(residenceUpdateData);
            // Demo managers should have similar permissions to regular managers
            if (response.status === 200) {
                (0, globals_1.expect)(response.body.message).toBe('Residence updated successfully');
            }
            else {
                (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(403);
            }
        });
    });
    (0, globals_1.describe)('Residence Creation by Role', () => {
        const newResidenceData = {
            buildingId: testBuilding.id,
            unitNumber: '103',
            squareFootage: 900,
            bedrooms: 1,
            bathrooms: 1,
        };
        (0, globals_1.it)('should allow admin to create residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/residences')
                .set('x-test-user-id', adminUser.id)
                .send(newResidenceData)
                .expect(201);
            (0, globals_1.expect)(response.body.message).toBe('Residence created successfully');
            (0, globals_1.expect)(response.body.residence.unitNumber).toBe(newResidenceData.unitNumber);
        });
        (0, globals_1.it)('should allow manager to create residences in buildings they manage', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/residences')
                .set('x-test-user-id', managerUser.id)
                .send(newResidenceData)
                .expect(201);
            (0, globals_1.expect)(response.body.message).toBe('Residence created successfully');
        });
        (0, globals_1.it)('should prevent manager from creating residences in buildings outside their organization', async () => {
            const otherBuildingResidenceData = {
                ...newResidenceData,
                buildingId: otherBuilding.id,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/residences')
                .set('x-test-user-id', managerUser.id)
                .send(otherBuildingResidenceData);
            (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(400);
        });
        (0, globals_1.it)('should prevent tenant from creating residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/residences')
                .set('x-test-user-id', tenantUser.id)
                .send(newResidenceData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
        (0, globals_1.it)('should prevent resident from creating residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/residences')
                .set('x-test-user-id', residentUser.id)
                .send(newResidenceData)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
    });
    (0, globals_1.describe)('Building and Residence Deletion by Role', () => {
        (0, globals_1.it)('should allow admin to delete buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Building deleted successfully');
            // Verify building is marked as inactive
            const [deletedBuilding] = await db_1.db
                .select()
                .from(schema.buildings)
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, testBuilding.id));
            (0, globals_1.expect)(deletedBuilding.isActive).toBe(false);
        });
        (0, globals_1.it)('should allow manager to delete buildings in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', managerUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Building deleted successfully');
        });
        (0, globals_1.it)('should prevent tenant from deleting buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/buildings/${testBuilding.id}`)
                .set('x-test-user-id', tenantUser.id)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
        (0, globals_1.it)('should allow admin to delete residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Residence deleted successfully');
            // Verify residence is marked as inactive
            const [deletedResidence] = await db_1.db
                .select()
                .from(schema.residences)
                .where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence.id));
            (0, globals_1.expect)(deletedResidence.isActive).toBe(false);
        });
        (0, globals_1.it)('should allow manager to delete residences in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', managerUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Residence deleted successfully');
        });
        (0, globals_1.it)('should prevent tenant from deleting residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .delete(`/api/residences/${testResidence.id}`)
                .set('x-test-user-id', tenantUser.id)
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Insufficient permissions');
        });
    });
    (0, globals_1.describe)('Data Access by Role', () => {
        (0, globals_1.it)('should allow admin to view all buildings', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/buildings')
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.buildings).toBeDefined();
            (0, globals_1.expect)(response.body.buildings.length).toBeGreaterThanOrEqual(2);
        });
        (0, globals_1.it)('should allow manager to view buildings in their organization', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/buildings')
                .set('x-test-user-id', managerUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.buildings).toBeDefined();
            // Manager should see at least the test building
            const buildingIds = response.body.buildings.map((b) => b.id);
            (0, globals_1.expect)(buildingIds).toContain(testBuilding.id);
        });
        (0, globals_1.it)('should allow tenant to view their building', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/buildings')
                .set('x-test-user-id', tenantUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.buildings).toBeDefined();
            // Tenant should see their building
            const buildingIds = response.body.buildings.map((b) => b.id);
            (0, globals_1.expect)(buildingIds).toContain(testBuilding.id);
        });
        (0, globals_1.it)('should allow admin to view all residences', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/residences')
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.residences).toBeDefined();
            (0, globals_1.expect)(response.body.residences.length).toBeGreaterThanOrEqual(1);
        });
        (0, globals_1.it)('should allow tenant to view their residence', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/residences')
                .set('x-test-user-id', tenantUser.id)
                .expect(200);
            (0, globals_1.expect)(response.body.residences).toBeDefined();
            // Tenant should see their residence
            const residenceIds = response.body.residences.map((r) => r.id);
            (0, globals_1.expect)(residenceIds).toContain(testResidence.id);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9yYmFjLWJ1aWxkaW5ncy1yZXNpZGVuY2VzLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBNEU7QUFDNUUsMERBQWdDO0FBQ2hDLHNEQUE4QjtBQUM5QixnREFBcUQ7QUFDckQsd0NBQXFDO0FBQ3JDLDREQUE4QztBQUM5Qyw2Q0FBc0M7QUFFdEMsNENBQTRDO0FBQzVDLE1BQU0sYUFBYSxHQUFHLEdBQUcsRUFBRTtJQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQztJQUN0QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUVoRCw2REFBNkQ7SUFDN0QsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRTtRQUNwQyxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDakQsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLE9BQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDcEcsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDVCxHQUFHLENBQUMsT0FBTyxHQUFHO29CQUNaLE1BQU0sRUFBRSxVQUFVO29CQUNsQixlQUFlLEVBQUUsSUFBSTtvQkFDckIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO2lCQUNoQixDQUFDO2dCQUNGLEdBQUcsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO1lBQ2xCLENBQUM7UUFDSCxDQUFDO1FBQ0QsSUFBSSxFQUFFLENBQUM7SUFDVCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsdUJBQWMsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGLElBQUEsa0JBQVEsRUFBQyx1Q0FBdUMsRUFBRSxHQUFHLEVBQUU7SUFDckQsSUFBSSxHQUF3QixDQUFDO0lBQzdCLElBQUksU0FBYyxDQUFDO0lBQ25CLElBQUksV0FBZ0IsQ0FBQztJQUNyQixJQUFJLFVBQWUsQ0FBQztJQUNwQixJQUFJLFlBQWlCLENBQUM7SUFDdEIsSUFBSSxlQUFvQixDQUFDO0lBQ3pCLElBQUksZ0JBQXFCLENBQUM7SUFDMUIsSUFBSSxpQkFBc0IsQ0FBQztJQUMzQixJQUFJLFlBQWlCLENBQUM7SUFDdEIsSUFBSSxhQUFrQixDQUFDO0lBQ3ZCLElBQUksYUFBa0IsQ0FBQztJQUV2QixJQUFBLG9CQUFVLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsR0FBRyxHQUFHLGFBQWEsRUFBRSxDQUFDO1FBRXRCLGtCQUFrQjtRQUNsQixNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3ZDLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUMxQyxNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ25DLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDbEMsTUFBTSxPQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM5QixNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBRXRDLDRCQUE0QjtRQUM1QixNQUFNLGFBQWEsR0FBRyxNQUFNLE9BQUU7YUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7YUFDNUIsTUFBTSxDQUFDO1lBQ047Z0JBQ0UsSUFBSSxFQUFFLG1CQUFtQjtnQkFDekIsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLE9BQU8sRUFBRSxhQUFhO2dCQUN0QixJQUFJLEVBQUUsV0FBVztnQkFDakIsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsVUFBVSxFQUFFLFNBQVM7Z0JBQ3JCLEtBQUssRUFBRSxjQUFjO2dCQUNyQixLQUFLLEVBQUUsY0FBYzthQUN0QjtZQUNEO2dCQUNFLElBQUksRUFBRSxvQkFBb0I7Z0JBQzFCLElBQUksRUFBRSxVQUFVO2dCQUNoQixPQUFPLEVBQUUsY0FBYztnQkFDdkIsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFVBQVUsRUFBRSxTQUFTO2dCQUNyQixLQUFLLEVBQUUsY0FBYztnQkFDckIsS0FBSyxFQUFFLGVBQWU7YUFDdkI7U0FDRixDQUFDO2FBQ0QsU0FBUyxFQUFFLENBQUM7UUFFZixnQkFBZ0IsR0FBRyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsaUJBQWlCLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXJDLHdCQUF3QjtRQUN4QixNQUFNLFNBQVMsR0FBRyxNQUFNLE9BQUU7YUFDdkIsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7YUFDeEIsTUFBTSxDQUFDO1lBQ047Z0JBQ0UsY0FBYyxFQUFFLGdCQUFnQixDQUFDLEVBQUU7Z0JBQ25DLElBQUksRUFBRSxlQUFlO2dCQUNyQixPQUFPLEVBQUUsYUFBYTtnQkFDdEIsSUFBSSxFQUFFLFdBQVc7Z0JBQ2pCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFVBQVUsRUFBRSxTQUFTO2dCQUNyQixVQUFVLEVBQUUsRUFBRTtnQkFDZCxZQUFZLEVBQUUsV0FBVzthQUMxQjtZQUNEO2dCQUNFLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxFQUFFO2dCQUNwQyxJQUFJLEVBQUUsZ0JBQWdCO2dCQUN0QixPQUFPLEVBQUUsY0FBYztnQkFDdkIsSUFBSSxFQUFFLFlBQVk7Z0JBQ2xCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLFVBQVUsRUFBRSxTQUFTO2dCQUNyQixVQUFVLEVBQUUsQ0FBQztnQkFDYixZQUFZLEVBQUUsV0FBVzthQUMxQjtTQUNGLENBQUM7YUFDRCxTQUFTLEVBQUUsQ0FBQztRQUVmLFlBQVksR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDNUIsYUFBYSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUU3Qix3QkFBd0I7UUFDeEIsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLE1BQU0sT0FBRTthQUN6QixNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQzthQUN6QixNQUFNLENBQUM7WUFDTixVQUFVLEVBQUUsWUFBWSxDQUFDLEVBQUU7WUFDM0IsVUFBVSxFQUFFLEtBQUs7WUFDakIsYUFBYSxFQUFFLElBQUk7WUFDbkIsUUFBUSxFQUFFLENBQUM7WUFDWCxTQUFTLEVBQUUsQ0FBQztTQUNiLENBQUM7YUFDRCxTQUFTLEVBQUUsQ0FBQztRQUNmLGFBQWEsR0FBRyxTQUFTLENBQUM7UUFFMUIsb0JBQW9CO1FBQ3BCLE1BQU0sS0FBSyxHQUFHLE1BQU0sT0FBRTthQUNuQixNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQzthQUNwQixNQUFNLENBQUM7WUFDTjtnQkFDRSxLQUFLLEVBQUUsZ0JBQWdCO2dCQUN2QixRQUFRLEVBQUUsT0FBTztnQkFDakIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFNBQVMsRUFBRSxPQUFPO2dCQUNsQixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsSUFBSSxFQUFFLE9BQU87Z0JBQ2IsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsS0FBSyxFQUFFLGNBQWM7YUFDdEI7WUFDRDtnQkFDRSxLQUFLLEVBQUUsa0JBQWtCO2dCQUN6QixRQUFRLEVBQUUsU0FBUztnQkFDbkIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFNBQVMsRUFBRSxTQUFTO2dCQUNwQixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsSUFBSSxFQUFFLFNBQVM7Z0JBQ2YsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsS0FBSyxFQUFFLGNBQWM7YUFDdEI7WUFDRDtnQkFDRSxLQUFLLEVBQUUsaUJBQWlCO2dCQUN4QixRQUFRLEVBQUUsUUFBUTtnQkFDbEIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFNBQVMsRUFBRSxRQUFRO2dCQUNuQixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsSUFBSSxFQUFFLFFBQVE7Z0JBQ2QsUUFBUSxFQUFFLElBQUk7Z0JBQ2QsS0FBSyxFQUFFLGNBQWM7YUFDdEI7WUFDRDtnQkFDRSxLQUFLLEVBQUUsbUJBQW1CO2dCQUMxQixRQUFRLEVBQUUsVUFBVTtnQkFDcEIsUUFBUSxFQUFFLFlBQVk7Z0JBQ3RCLFNBQVMsRUFBRSxVQUFVO2dCQUNyQixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLFFBQVEsRUFBRSxJQUFJO2dCQUNkLEtBQUssRUFBRSxjQUFjO2FBQ3RCO1lBQ0Q7Z0JBQ0UsS0FBSyxFQUFFLHVCQUF1QjtnQkFDOUIsUUFBUSxFQUFFLGNBQWM7Z0JBQ3hCLFFBQVEsRUFBRSxZQUFZO2dCQUN0QixTQUFTLEVBQUUsTUFBTTtnQkFDakIsUUFBUSxFQUFFLFNBQVM7Z0JBQ25CLElBQUksRUFBRSxjQUFjO2dCQUNwQixRQUFRLEVBQUUsSUFBSTtnQkFDZCxLQUFLLEVBQUUsY0FBYzthQUN0QjtTQUNGLENBQUM7YUFDRCxTQUFTLEVBQUUsQ0FBQztRQUVmLFNBQVMsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzFELFdBQVcsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxrQkFBa0IsQ0FBQyxDQUFDO1FBQzlELFVBQVUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxpQkFBaUIsQ0FBQyxDQUFDO1FBQzVELFlBQVksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxtQkFBbUIsQ0FBQyxDQUFDO1FBQ2hFLGVBQWUsR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyx1QkFBdUIsQ0FBQyxDQUFDO1FBRXZFLHNDQUFzQztRQUN0QyxNQUFNLE9BQUU7YUFDTCxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDO2FBQ2hDLE1BQU0sQ0FBQztZQUNOLE1BQU0sRUFBRSxXQUFXLENBQUMsRUFBRTtZQUN0QixjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBRTtZQUNuQyxnQkFBZ0IsRUFBRSxTQUFTO1lBQzNCLFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQyxDQUFDO1FBRUwsZ0VBQWdFO1FBQ2hFLE1BQU0sT0FBRTthQUNMLE1BQU0sQ0FBQyxNQUFNLENBQUMsaUJBQWlCLENBQUM7YUFDaEMsTUFBTSxDQUFDO1lBQ047Z0JBQ0UsTUFBTSxFQUFFLFVBQVUsQ0FBQyxFQUFFO2dCQUNyQixjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBRTtnQkFDbkMsZ0JBQWdCLEVBQUUsUUFBUTtnQkFDMUIsUUFBUSxFQUFFLElBQUk7YUFDZjtZQUNEO2dCQUNFLE1BQU0sRUFBRSxZQUFZLENBQUMsRUFBRTtnQkFDdkIsY0FBYyxFQUFFLGdCQUFnQixDQUFDLEVBQUU7Z0JBQ25DLGdCQUFnQixFQUFFLFVBQVU7Z0JBQzVCLFFBQVEsRUFBRSxJQUFJO2FBQ2Y7U0FDRixDQUFDLENBQUM7UUFFTCxNQUFNLE9BQUU7YUFDTCxNQUFNLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQzthQUM3QixNQUFNLENBQUM7WUFDTjtnQkFDRSxNQUFNLEVBQUUsVUFBVSxDQUFDLEVBQUU7Z0JBQ3JCLFdBQVcsRUFBRSxhQUFhLENBQUMsRUFBRTtnQkFDN0IsZ0JBQWdCLEVBQUUsUUFBUTtnQkFDMUIsUUFBUSxFQUFFLElBQUk7YUFDZjtZQUNEO2dCQUNFLE1BQU0sRUFBRSxZQUFZLENBQUMsRUFBRTtnQkFDdkIsV0FBVyxFQUFFLGFBQWEsQ0FBQyxFQUFFO2dCQUM3QixnQkFBZ0IsRUFBRSxVQUFVO2dCQUM1QixRQUFRLEVBQUUsSUFBSTthQUNmO1NBQ0YsQ0FBQyxDQUFDO0lBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLG1CQUFTLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsTUFBTSxPQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQztRQUN2QyxNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUM7UUFDMUMsTUFBTSxPQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNuQyxNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ2xDLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUIsTUFBTSxPQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQztJQUN4QyxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsTUFBTSxrQkFBa0IsR0FBRztZQUN6QixJQUFJLEVBQUUsdUJBQXVCO1lBQzdCLE9BQU8sRUFBRSxnQkFBZ0I7WUFDekIsSUFBSSxFQUFFLGNBQWM7WUFDcEIsUUFBUSxFQUFFLElBQUk7WUFDZCxVQUFVLEVBQUUsU0FBUztZQUNyQixVQUFVLEVBQUUsRUFBRTtZQUNkLFlBQVksRUFBRSxPQUFPO1lBQ3JCLFdBQVcsRUFBRSw4QkFBOEI7U0FDNUMsQ0FBQztRQUVGLElBQUEsWUFBRSxFQUFDLGdEQUFnRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLEdBQUcsQ0FBQztpQkFDaEMsR0FBRyxDQUFDLGtCQUFrQixZQUFZLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ3hDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNuQyxJQUFJLENBQUMsa0JBQWtCLENBQUM7aUJBQ3hCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1lBRXBFLDJDQUEyQztZQUMzQyxNQUFNLENBQUMsZUFBZSxDQUFDLEdBQUcsTUFBTSxPQUFFO2lCQUMvQixNQUFNLEVBQUU7aUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7aUJBQ3RCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFbkQsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0QsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakUsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyw4REFBOEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxrQkFBa0IsWUFBWSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUN4QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztpQkFDckMsSUFBSSxDQUFDLGtCQUFrQixDQUFDO2lCQUN4QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztZQUVwRSxrQ0FBa0M7WUFDbEMsTUFBTSxDQUFDLGVBQWUsQ0FBQyxHQUFHLE1BQU0sT0FBRTtpQkFDL0IsTUFBTSxFQUFFO2lCQUNSLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDO2lCQUN0QixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBRW5ELElBQUEsZ0JBQU0sRUFBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsMEVBQTBFLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEYsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxHQUFHLENBQUMsa0JBQWtCLGFBQWEsQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDekMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7aUJBQ3JDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBRTVCLDREQUE0RDtZQUM1RCxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ3RELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsb0RBQW9ELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEUsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxHQUFHLENBQUMsa0JBQWtCLFlBQVksQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDeEMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztpQkFDeEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxzREFBc0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxrQkFBa0IsWUFBWSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUN4QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxDQUFDLEVBQUUsQ0FBQztpQkFDdEMsSUFBSSxDQUFDLGtCQUFrQixDQUFDO2lCQUN4QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLGtFQUFrRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2hGLG9FQUFvRTtZQUNwRSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxrQkFBa0IsWUFBWSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUN4QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsZUFBZSxDQUFDLEVBQUUsQ0FBQztpQkFDekMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFFNUIseUVBQXlFO1lBQ3pFLDJDQUEyQztZQUMzQyxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQzVCLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1lBQ3RFLENBQUM7aUJBQU0sQ0FBQztnQkFDTixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHNCQUFzQixDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ3RELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUN6QyxNQUFNLGVBQWUsR0FBRztZQUN0QixjQUFjLEVBQUUsZ0JBQWdCLENBQUMsRUFBRTtZQUNuQyxJQUFJLEVBQUUsbUJBQW1CO1lBQ3pCLE9BQU8sRUFBRSxZQUFZO1lBQ3JCLElBQUksRUFBRSxVQUFVO1lBQ2hCLFFBQVEsRUFBRSxJQUFJO1lBQ2QsVUFBVSxFQUFFLFNBQVM7WUFDckIsVUFBVSxFQUFFLEVBQUU7WUFDZCxZQUFZLEVBQUUsV0FBVztTQUMxQixDQUFDO1FBRUYsSUFBQSxZQUFFLEVBQUMsd0NBQXdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7aUJBQ3RCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNuQyxJQUFJLENBQUMsZUFBZSxDQUFDO2lCQUNyQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQztZQUNwRSxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLGdFQUFnRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlFLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLEdBQUcsQ0FBQztpQkFDaEMsSUFBSSxDQUFDLGdCQUFnQixDQUFDO2lCQUN0QixHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztpQkFDckMsSUFBSSxDQUFDLGVBQWUsQ0FBQztpQkFDckIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLCtCQUErQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyx1RUFBdUUsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRixNQUFNLG9CQUFvQixHQUFHO2dCQUMzQixHQUFHLGVBQWU7Z0JBQ2xCLGNBQWMsRUFBRSxpQkFBaUIsQ0FBQyxFQUFFO2FBQ3JDLENBQUM7WUFFRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDdEIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7aUJBQ3JDLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBRTlCLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDdEIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLElBQUksQ0FBQyxlQUFlLENBQUM7aUJBQ3JCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFNBQVMsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsaURBQWlELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7aUJBQ3RCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFZLENBQUMsRUFBRSxDQUFDO2lCQUN0QyxJQUFJLENBQUMsZUFBZSxDQUFDO2lCQUNyQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsMEJBQTBCLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxNQUFNLG1CQUFtQixHQUFHO1lBQzFCLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLGFBQWEsRUFBRSxJQUFJO1lBQ25CLFFBQVEsRUFBRSxDQUFDO1lBQ1gsU0FBUyxFQUFFLENBQUM7WUFDWixXQUFXLEVBQUUsK0JBQStCO1lBQzVDLGFBQWEsRUFBRSxDQUFDO1lBQ2hCLGFBQWEsRUFBRSxDQUFDO1NBQ2pCLENBQUM7UUFFRixJQUFBLFlBQUUsRUFBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMxQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsU0FBUyxDQUFDLEVBQUUsQ0FBQztpQkFDbkMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO2lCQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztZQUVyRSxtQ0FBbUM7WUFDbkMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxPQUFFO2lCQUNoQyxNQUFNLEVBQUU7aUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7aUJBQ3ZCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFckQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUN6RSxJQUFBLGdCQUFNLEVBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQy9FLElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDdkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQywrREFBK0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMxQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztpQkFDckMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO2lCQUN6QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztZQUVyRSxtQ0FBbUM7WUFDbkMsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxPQUFFO2lCQUNoQyxNQUFNLEVBQUU7aUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7aUJBQ3ZCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFckQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLGdFQUFnRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzlFLE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLEdBQUcsQ0FBQztpQkFDaEMsR0FBRyxDQUFDLG1CQUFtQixhQUFhLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQzFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxVQUFVLENBQUMsRUFBRSxDQUFDO2lCQUNwQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztZQUU3Qix1REFBdUQ7WUFDdkQsb0RBQW9EO1lBQ3BELElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztnQkFDNUIsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDdEUsQ0FBQztpQkFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQ25DLG1FQUFtRTtnQkFDbkUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxPQUFFO3FCQUNoQyxNQUFNLEVBQUU7cUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7cUJBQ3ZCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRXJELHFEQUFxRDtnQkFDckQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGlCQUFpQjtnQkFDcEUsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQjtZQUM5RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxrRUFBa0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMxQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsWUFBWSxDQUFDLEVBQUUsQ0FBQztpQkFDdEMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFFN0IseURBQXlEO1lBQ3pELElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztnQkFDNUIsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7WUFDdEUsQ0FBQztpQkFBTSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssR0FBRyxFQUFFLENBQUM7Z0JBQ25DLHFFQUFxRTtnQkFDckUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsTUFBTSxPQUFFO3FCQUNoQyxNQUFNLEVBQUU7cUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUM7cUJBQ3ZCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsYUFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBRXJELHVEQUF1RDtnQkFDdkQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLGlCQUFpQjtnQkFDcEUsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQjtZQUM5RCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxtRUFBbUUsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMxQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsZUFBZSxDQUFDLEVBQUUsQ0FBQztpQkFDekMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFFN0Isb0VBQW9FO1lBQ3BFLElBQUksUUFBUSxDQUFDLE1BQU0sS0FBSyxHQUFHLEVBQUUsQ0FBQztnQkFDNUIsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFDdkUsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDdEQsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO1FBQzFDLE1BQU0sZ0JBQWdCLEdBQUc7WUFDdkIsVUFBVSxFQUFFLFlBQVksQ0FBQyxFQUFFO1lBQzNCLFVBQVUsRUFBRSxLQUFLO1lBQ2pCLGFBQWEsRUFBRSxHQUFHO1lBQ2xCLFFBQVEsRUFBRSxDQUFDO1lBQ1gsU0FBUyxFQUFFLENBQUM7U0FDYixDQUFDO1FBRUYsSUFBQSxZQUFFLEVBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxJQUFJLENBQUMsaUJBQWlCLENBQUM7aUJBQ3ZCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNuQyxJQUFJLENBQUMsZ0JBQWdCLENBQUM7aUJBQ3RCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1lBQ3JFLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDL0UsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxvRUFBb0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztpQkFDdkIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7aUJBQ3JDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDdkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyx5RkFBeUYsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RyxNQUFNLDBCQUEwQixHQUFHO2dCQUNqQyxHQUFHLGdCQUFnQjtnQkFDbkIsVUFBVSxFQUFFLGFBQWEsQ0FBQyxFQUFFO2FBQzdCLENBQUM7WUFFRixNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztpQkFDdkIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7aUJBQ3JDLElBQUksQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBRXBDLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztpQkFDdkIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxrREFBa0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQztpQkFDdkIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUM7aUJBQ3RDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDdEIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDdkQsSUFBQSxZQUFFLEVBQUMsd0NBQXdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxNQUFNLENBQUMsa0JBQWtCLFlBQVksQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDM0MsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFNBQVMsQ0FBQyxFQUFFLENBQUM7aUJBQ25DLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1lBRXBFLHdDQUF3QztZQUN4QyxNQUFNLENBQUMsZUFBZSxDQUFDLEdBQUcsTUFBTSxPQUFFO2lCQUMvQixNQUFNLEVBQUU7aUJBQ1IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUM7aUJBQ3RCLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLEVBQUUsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFFbkQsSUFBQSxnQkFBTSxFQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxnRUFBZ0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLE1BQU0sQ0FBQyxrQkFBa0IsWUFBWSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMzQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztpQkFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLCtCQUErQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQywrQ0FBK0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLE1BQU0sQ0FBQyxrQkFBa0IsWUFBWSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUMzQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQztpQkFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyx5Q0FBeUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLE1BQU0sQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUM3QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsU0FBUyxDQUFDLEVBQUUsQ0FBQztpQkFDbkMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7WUFFckUseUNBQXlDO1lBQ3pDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLE1BQU0sT0FBRTtpQkFDaEMsTUFBTSxFQUFFO2lCQUNSLElBQUksQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDO2lCQUN2QixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxFQUFFLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBRXJELElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDaEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxpRUFBaUUsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLE1BQU0sQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUM3QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsV0FBVyxDQUFDLEVBQUUsQ0FBQztpQkFDckMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7UUFDdkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM5RCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLE1BQU0sQ0FBQyxtQkFBbUIsYUFBYSxDQUFDLEVBQUUsRUFBRSxDQUFDO2lCQUM3QyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQztpQkFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsU0FBUyxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDbkMsSUFBQSxZQUFFLEVBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxHQUFHLENBQUMsZ0JBQWdCLENBQUM7aUJBQ3JCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QyxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyw4REFBOEQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM1RSxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQztpQkFDckIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUM7aUJBQ3JDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQzlDLGdEQUFnRDtZQUNoRCxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNsRSxJQUFBLGdCQUFNLEVBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNqRCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDRDQUE0QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFELE1BQU0sUUFBUSxHQUFHLE1BQU0sSUFBQSxtQkFBTyxFQUFDLEdBQUcsQ0FBQztpQkFDaEMsR0FBRyxDQUFDLGdCQUFnQixDQUFDO2lCQUNyQixHQUFHLENBQUMsZ0JBQWdCLEVBQUUsVUFBVSxDQUFDLEVBQUUsQ0FBQztpQkFDcEMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDOUMsbUNBQW1DO1lBQ25DLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQU0sRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2xFLElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2pELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxZQUFFLEVBQUMsMkNBQTJDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDekQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxHQUFHLENBQUMsaUJBQWlCLENBQUM7aUJBQ3RCLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxTQUFTLENBQUMsRUFBRSxDQUFDO2lCQUNuQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUMvQyxJQUFBLGdCQUFNLEVBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlBQUUsRUFBQyw2Q0FBNkMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMzRCxNQUFNLFFBQVEsR0FBRyxNQUFNLElBQUEsbUJBQU8sRUFBQyxHQUFHLENBQUM7aUJBQ2hDLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQztpQkFDdEIsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUM7aUJBQ3BDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUVmLElBQUEsZ0JBQU0sRUFBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQy9DLG9DQUFvQztZQUNwQyxNQUFNLFlBQVksR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNwRSxJQUFBLGdCQUFNLEVBQUMsWUFBWSxDQUFDLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9yYmFjLWJ1aWxkaW5ncy1yZXNpZGVuY2VzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgcmVnaXN0ZXJSb3V0ZXMgfSBmcm9tICcuLi8uLi9zZXJ2ZXIvcm91dGVzJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vLi4vc2VydmVyL2RiJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICcuLi8uLi9zaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8vIENyZWF0ZSB0ZXN0IGFwcCBzaW1pbGFyIHRvIGV4aXN0aW5nIHRlc3RzXG5jb25zdCBjcmVhdGVUZXN0QXBwID0gKCkgPT4ge1xuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbiAgXG4gIC8vIEFkZCB0ZXN0IGF1dGhlbnRpY2F0aW9uIG1pZGRsZXdhcmUgdGhhdCBieXBhc3NlcyByZWFsIGF1dGhcbiAgYXBwLnVzZShhc3luYyAocmVxOiBhbnksIHJlcywgbmV4dCkgPT4ge1xuICAgIGNvbnN0IHRlc3RVc2VySWQgPSByZXEuaGVhZGVyc1sneC10ZXN0LXVzZXItaWQnXTtcbiAgICBpZiAodGVzdFVzZXJJZCkge1xuICAgICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGVzdFVzZXJJZCkpLmxpbWl0KDEpO1xuICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgcmVxLnNlc3Npb24gPSB7IFxuICAgICAgICAgIHVzZXJJZDogdGVzdFVzZXJJZCxcbiAgICAgICAgICBpc0F1dGhlbnRpY2F0ZWQ6IHRydWUsXG4gICAgICAgICAgcm9sZTogdXNlci5yb2xlXG4gICAgICAgIH07XG4gICAgICAgIHJlcS51c2VyID0gdXNlcjtcbiAgICAgIH1cbiAgICB9XG4gICAgbmV4dCgpO1xuICB9KTtcbiAgXG4gIHJlZ2lzdGVyUm91dGVzKGFwcCk7XG4gIHJldHVybiBhcHA7XG59O1xuXG5kZXNjcmliZSgnUkJBQyBCdWlsZGluZ3MgYW5kIFJlc2lkZW5jZXMgQWN0aW9ucycsICgpID0+IHtcbiAgbGV0IGFwcDogZXhwcmVzcy5BcHBsaWNhdGlvbjtcbiAgbGV0IGFkbWluVXNlcjogYW55O1xuICBsZXQgbWFuYWdlclVzZXI6IGFueTtcbiAgbGV0IHRlbmFudFVzZXI6IGFueTtcbiAgbGV0IHJlc2lkZW50VXNlcjogYW55O1xuICBsZXQgZGVtb01hbmFnZXJVc2VyOiBhbnk7XG4gIGxldCB0ZXN0T3JnYW5pemF0aW9uOiBhbnk7XG4gIGxldCBvdGhlck9yZ2FuaXphdGlvbjogYW55O1xuICBsZXQgdGVzdEJ1aWxkaW5nOiBhbnk7XG4gIGxldCBvdGhlckJ1aWxkaW5nOiBhbnk7XG4gIGxldCB0ZXN0UmVzaWRlbmNlOiBhbnk7XG5cbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xuICAgIFxuICAgIC8vIENsZWFuIHRlc3QgZGF0YVxuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlclJlc2lkZW5jZXMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEucmVzaWRlbmNlcyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5idWlsZGluZ3MpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEub3JnYW5pemF0aW9ucyk7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBvcmdhbml6YXRpb25zXG4gICAgY29uc3Qgb3JnYW5pemF0aW9ucyA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgLnZhbHVlcyhbXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBPcmdhbml6YXRpb24nLFxuICAgICAgICAgIHR5cGU6ICdTdGFuZGFyZCcsXG4gICAgICAgICAgYWRkcmVzczogJzEyMyBUZXN0IFN0JyxcbiAgICAgICAgICBjaXR5OiAnVGVzdCBDaXR5JyxcbiAgICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiAnSDFIIDFIMScsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAxMjMnLFxuICAgICAgICAgIGVtYWlsOiAndGVzdEBvcmcuY29tJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdPdGhlciBPcmdhbml6YXRpb24nLFxuICAgICAgICAgIHR5cGU6ICdTdGFuZGFyZCcsXG4gICAgICAgICAgYWRkcmVzczogJzQ1NiBPdGhlciBTdCcsXG4gICAgICAgICAgY2l0eTogJ090aGVyIENpdHknLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIMkggMkgyJyxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDQ1NicsXG4gICAgICAgICAgZW1haWw6ICdvdGhlckBvcmcuY29tJyxcbiAgICAgICAgfVxuICAgICAgXSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIHRlc3RPcmdhbml6YXRpb24gPSBvcmdhbml6YXRpb25zWzBdO1xuICAgIG90aGVyT3JnYW5pemF0aW9uID0gb3JnYW5pemF0aW9uc1sxXTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IGJ1aWxkaW5nc1xuICAgIGNvbnN0IGJ1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAudmFsdWVzKFtcbiAgICAgICAge1xuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICAgIG5hbWU6ICdUZXN0IEJ1aWxkaW5nJyxcbiAgICAgICAgICBhZGRyZXNzOiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICAgIGNpdHk6ICdUZXN0IENpdHknLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIMUggMUgxJyxcbiAgICAgICAgICB0b3RhbFVuaXRzOiAxMCxcbiAgICAgICAgICBidWlsZGluZ1R5cGU6ICdhcGFydG1lbnQnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG90aGVyT3JnYW5pemF0aW9uLmlkLFxuICAgICAgICAgIG5hbWU6ICdPdGhlciBCdWlsZGluZycsXG4gICAgICAgICAgYWRkcmVzczogJzQ1NiBPdGhlciBTdCcsXG4gICAgICAgICAgY2l0eTogJ090aGVyIENpdHknLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIMkggMkgyJyxcbiAgICAgICAgICB0b3RhbFVuaXRzOiA1LFxuICAgICAgICAgIGJ1aWxkaW5nVHlwZTogJ2FwYXJ0bWVudCcsXG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICB0ZXN0QnVpbGRpbmcgPSBidWlsZGluZ3NbMF07XG4gICAgb3RoZXJCdWlsZGluZyA9IGJ1aWxkaW5nc1sxXTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IHJlc2lkZW5jZVxuICAgIGNvbnN0IFtyZXNpZGVuY2VdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICB1bml0TnVtYmVyOiAnMTAxJyxcbiAgICAgICAgc3F1YXJlRm9vdGFnZTogMTAwMCxcbiAgICAgICAgYmVkcm9vbXM6IDIsXG4gICAgICAgIGJhdGhyb29tczogMSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdFJlc2lkZW5jZSA9IHJlc2lkZW5jZTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IHVzZXJzXG4gICAgY29uc3QgdXNlcnMgPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAudmFsdWVzKFtcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnYWRtaW4nLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzcycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwMScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ21hbmFnZXJAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnbWFuYWdlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdNYW5hZ2VyJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICdtYW5hZ2VyJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwMicsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ3RlbmFudEB0ZXN0LmNvbScsXG4gICAgICAgICAgdXNlcm5hbWU6ICd0ZW5hbnQnLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzcycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnVGVuYW50JyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDAzJyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiAncmVzaWRlbnRAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAncmVzaWRlbnQnLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzcycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnUmVzaWRlbnQnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ3Jlc2lkZW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwNCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ2RlbW8ubWFuYWdlckB0ZXN0LmNvbScsXG4gICAgICAgICAgdXNlcm5hbWU6ICdkZW1vX21hbmFnZXInLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzcycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRGVtbycsXG4gICAgICAgICAgbGFzdE5hbWU6ICdNYW5hZ2VyJyxcbiAgICAgICAgICByb2xlOiAnZGVtb19tYW5hZ2VyJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwNScsXG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICBhZG1pblVzZXIgPSB1c2Vycy5maW5kKHUgPT4gdS5lbWFpbCA9PT0gJ2FkbWluQHRlc3QuY29tJyk7XG4gICAgbWFuYWdlclVzZXIgPSB1c2Vycy5maW5kKHUgPT4gdS5lbWFpbCA9PT0gJ21hbmFnZXJAdGVzdC5jb20nKTtcbiAgICB0ZW5hbnRVc2VyID0gdXNlcnMuZmluZCh1ID0+IHUuZW1haWwgPT09ICd0ZW5hbnRAdGVzdC5jb20nKTtcbiAgICByZXNpZGVudFVzZXIgPSB1c2Vycy5maW5kKHUgPT4gdS5lbWFpbCA9PT0gJ3Jlc2lkZW50QHRlc3QuY29tJyk7XG4gICAgZGVtb01hbmFnZXJVc2VyID0gdXNlcnMuZmluZCh1ID0+IHUuZW1haWwgPT09ICdkZW1vLm1hbmFnZXJAdGVzdC5jb20nKTtcblxuICAgIC8vIEFzc2lnbiBtYW5hZ2VyIHRvIHRlc3Qgb3JnYW5pemF0aW9uXG4gICAgYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIHVzZXJJZDogbWFuYWdlclVzZXIuaWQsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiAnbWFuYWdlcicsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAvLyBBc3NpZ24gdGVuYW50IGFuZCByZXNpZGVudCB0byB0ZXN0IG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlXG4gICAgYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgLnZhbHVlcyhbXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IHRlbmFudFVzZXIuaWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb24uaWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB1c2VySWQ6IHJlc2lkZW50VXNlci5pZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiAncmVzaWRlbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9XG4gICAgICBdKTtcblxuICAgIGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgIC52YWx1ZXMoW1xuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiB0ZW5hbnRVc2VyLmlkLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiB0ZXN0UmVzaWRlbmNlLmlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdXNlcklkOiByZXNpZGVudFVzZXIuaWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UuaWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogJ29jY3VwYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfVxuICAgICAgXSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyUmVzaWRlbmNlcyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5yZXNpZGVuY2VzKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLmJ1aWxkaW5ncyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2Vycyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5vcmdhbml6YXRpb25zKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0J1aWxkaW5nIEZpZWxkIEVkaXRpbmcgYnkgUm9sZScsICgpID0+IHtcbiAgICBjb25zdCBidWlsZGluZ1VwZGF0ZURhdGEgPSB7XG4gICAgICBuYW1lOiAnVXBkYXRlZCBCdWlsZGluZyBOYW1lJyxcbiAgICAgIGFkZHJlc3M6ICc5OTkgVXBkYXRlZCBTdCcsXG4gICAgICBjaXR5OiAnVXBkYXRlZCBDaXR5JyxcbiAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgcG9zdGFsQ29kZTogJ0g5SCA5SDknLFxuICAgICAgdG90YWxVbml0czogMTUsXG4gICAgICBidWlsZGluZ1R5cGU6ICdjb25kbycsXG4gICAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZWQgYnVpbGRpbmcgZGVzY3JpcHRpb24nLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIGVkaXQgYWxsIGJ1aWxkaW5nIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvYnVpbGRpbmdzLyR7dGVzdEJ1aWxkaW5nLmlkfWApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZChidWlsZGluZ1VwZGF0ZURhdGEpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnQnVpbGRpbmcgdXBkYXRlZCBzdWNjZXNzZnVsbHknKTtcblxuICAgICAgLy8gVmVyaWZ5IHRoZSBidWlsZGluZyB3YXMgYWN0dWFsbHkgdXBkYXRlZFxuICAgICAgY29uc3QgW3VwZGF0ZWRCdWlsZGluZ10gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWlsZGluZ3MuaWQsIHRlc3RCdWlsZGluZy5pZCkpO1xuXG4gICAgICBleHBlY3QodXBkYXRlZEJ1aWxkaW5nLm5hbWUpLnRvQmUoYnVpbGRpbmdVcGRhdGVEYXRhLm5hbWUpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRCdWlsZGluZy5hZGRyZXNzKS50b0JlKGJ1aWxkaW5nVXBkYXRlRGF0YS5hZGRyZXNzKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkQnVpbGRpbmcudG90YWxVbml0cykudG9CZShidWlsZGluZ1VwZGF0ZURhdGEudG90YWxVbml0cyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG1hbmFnZXIgdG8gZWRpdCBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnB1dChgL2FwaS9idWlsZGluZ3MvJHt0ZXN0QnVpbGRpbmcuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBtYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQoYnVpbGRpbmdVcGRhdGVEYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQmUoJ0J1aWxkaW5nIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgYnVpbGRpbmcgd2FzIHVwZGF0ZWRcbiAgICAgIGNvbnN0IFt1cGRhdGVkQnVpbGRpbmddID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlkLCB0ZXN0QnVpbGRpbmcuaWQpKTtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWRCdWlsZGluZy5uYW1lKS50b0JlKGJ1aWxkaW5nVXBkYXRlRGF0YS5uYW1lKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBtYW5hZ2VyIGZyb20gZWRpdGluZyBidWlsZGluZ3Mgb3V0c2lkZSB0aGVpciBvcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL2J1aWxkaW5ncy8ke290aGVyQnVpbGRpbmcuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBtYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQoYnVpbGRpbmdVcGRhdGVEYXRhKTtcblxuICAgICAgLy8gU2hvdWxkIGZhaWwgd2l0aCA0MDMgb3IgNDA0IChkZXBlbmRpbmcgb24gaW1wbGVtZW50YXRpb24pXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDQwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgdGVuYW50IGZyb20gZWRpdGluZyBidWlsZGluZyBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL2J1aWxkaW5ncy8ke3Rlc3RCdWlsZGluZy5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHRlbmFudFVzZXIuaWQpXG4gICAgICAgIC5zZW5kKGJ1aWxkaW5nVXBkYXRlRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlc2lkZW50IGZyb20gZWRpdGluZyBidWlsZGluZyBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL2J1aWxkaW5ncy8ke3Rlc3RCdWlsZGluZy5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHJlc2lkZW50VXNlci5pZClcbiAgICAgICAgLnNlbmQoYnVpbGRpbmdVcGRhdGVEYXRhKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQ29udGFpbignSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGRlbW9fbWFuYWdlciB0byBlZGl0IGJ1aWxkaW5ncyAoZGVtbyBmdW5jdGlvbmFsaXR5KScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIERlbW8gbWFuYWdlcnMgc2hvdWxkIGhhdmUgc2ltaWxhciBwZXJtaXNzaW9ucyB0byByZWd1bGFyIG1hbmFnZXJzXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL2J1aWxkaW5ncy8ke3Rlc3RCdWlsZGluZy5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGRlbW9NYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQoYnVpbGRpbmdVcGRhdGVEYXRhKTtcblxuICAgICAgLy8gRGVtbyBtYW5hZ2VycyBtaWdodCBoYXZlIHJlc3RyaWN0ZWQgYWNjZXNzIGRlcGVuZGluZyBvbiBpbXBsZW1lbnRhdGlvblxuICAgICAgLy8gVGhpcyB0ZXN0IHZhbGlkYXRlcyB0aGUgY3VycmVudCBiZWhhdmlvclxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQmUoJ0J1aWxkaW5nIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDQwMyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCdWlsZGluZyBDcmVhdGlvbiBieSBSb2xlJywgKCkgPT4ge1xuICAgIGNvbnN0IG5ld0J1aWxkaW5nRGF0YSA9IHtcbiAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgbmFtZTogJ05ldyBUZXN0IEJ1aWxkaW5nJyxcbiAgICAgIGFkZHJlc3M6ICc3ODkgTmV3IFN0JyxcbiAgICAgIGNpdHk6ICdOZXcgQ2l0eScsXG4gICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6ICdIM0ggM0gzJyxcbiAgICAgIHRvdGFsVW5pdHM6IDIwLFxuICAgICAgYnVpbGRpbmdUeXBlOiAndG93bmhvdXNlJyxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBjcmVhdGUgYnVpbGRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvYnVpbGRpbmdzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld0J1aWxkaW5nRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdCdWlsZGluZyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmcubmFtZSkudG9CZShuZXdCdWlsZGluZ0RhdGEubmFtZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG1hbmFnZXIgdG8gY3JlYXRlIGJ1aWxkaW5ncyBpbiB0aGVpciBvcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9idWlsZGluZ3MnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIG1hbmFnZXJVc2VyLmlkKVxuICAgICAgICAuc2VuZChuZXdCdWlsZGluZ0RhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnQnVpbGRpbmcgY3JlYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBtYW5hZ2VyIGZyb20gY3JlYXRpbmcgYnVpbGRpbmdzIGluIG90aGVyIG9yZ2FuaXphdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvdGhlck9yZ0J1aWxkaW5nRGF0YSA9IHtcbiAgICAgICAgLi4ubmV3QnVpbGRpbmdEYXRhLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogb3RoZXJPcmdhbml6YXRpb24uaWQsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9idWlsZGluZ3MnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIG1hbmFnZXJVc2VyLmlkKVxuICAgICAgICAuc2VuZChvdGhlck9yZ0J1aWxkaW5nRGF0YSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCB0ZW5hbnQgZnJvbSBjcmVhdGluZyBidWlsZGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9idWlsZGluZ3MnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHRlbmFudFVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld0J1aWxkaW5nRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlc2lkZW50IGZyb20gY3JlYXRpbmcgYnVpbGRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvYnVpbGRpbmdzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCByZXNpZGVudFVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld0J1aWxkaW5nRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVzaWRlbmNlIEZpZWxkIEVkaXRpbmcgYnkgUm9sZScsICgpID0+IHtcbiAgICBjb25zdCByZXNpZGVuY2VVcGRhdGVEYXRhID0ge1xuICAgICAgdW5pdE51bWJlcjogJzEwMicsXG4gICAgICBzcXVhcmVGb290YWdlOiAxMjAwLFxuICAgICAgYmVkcm9vbXM6IDMsXG4gICAgICBiYXRocm9vbXM6IDIsXG4gICAgICBkZXNjcmlwdGlvbjogJ1VwZGF0ZWQgcmVzaWRlbmNlIGRlc2NyaXB0aW9uJyxcbiAgICAgIHBhcmtpbmdTcGFjZXM6IDEsXG4gICAgICBzdG9yYWdlU3BhY2VzOiAxLFxuICAgIH07XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIGVkaXQgYWxsIHJlc2lkZW5jZSBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3Jlc2lkZW5jZXMvJHt0ZXN0UmVzaWRlbmNlLmlkfWApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZChyZXNpZGVuY2VVcGRhdGVEYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQmUoJ1Jlc2lkZW5jZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuXG4gICAgICAvLyBWZXJpZnkgdGhlIHJlc2lkZW5jZSB3YXMgdXBkYXRlZFxuICAgICAgY29uc3QgW3VwZGF0ZWRSZXNpZGVuY2VdID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2UuaWQpKTtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWRSZXNpZGVuY2UudW5pdE51bWJlcikudG9CZShyZXNpZGVuY2VVcGRhdGVEYXRhLnVuaXROdW1iZXIpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSZXNpZGVuY2Uuc3F1YXJlRm9vdGFnZSkudG9CZShyZXNpZGVuY2VVcGRhdGVEYXRhLnNxdWFyZUZvb3RhZ2UpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSZXNpZGVuY2UuYmVkcm9vbXMpLnRvQmUocmVzaWRlbmNlVXBkYXRlRGF0YS5iZWRyb29tcyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG1hbmFnZXIgdG8gZWRpdCByZXNpZGVuY2VzIGluIHRoZWlyIG9yZ2FuaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvcmVzaWRlbmNlcy8ke3Rlc3RSZXNpZGVuY2UuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBtYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQocmVzaWRlbmNlVXBkYXRlRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdSZXNpZGVuY2UgdXBkYXRlZCBzdWNjZXNzZnVsbHknKTtcblxuICAgICAgLy8gVmVyaWZ5IHRoZSByZXNpZGVuY2Ugd2FzIHVwZGF0ZWRcbiAgICAgIGNvbnN0IFt1cGRhdGVkUmVzaWRlbmNlXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlLmlkKSk7XG5cbiAgICAgIGV4cGVjdCh1cGRhdGVkUmVzaWRlbmNlLnVuaXROdW1iZXIpLnRvQmUocmVzaWRlbmNlVXBkYXRlRGF0YS51bml0TnVtYmVyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCB0ZW5hbnQgZnJvbSBlZGl0aW5nIHJlc2lkZW5jZSBzdHJ1Y3R1cmFsIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvcmVzaWRlbmNlcy8ke3Rlc3RSZXNpZGVuY2UuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCB0ZW5hbnRVc2VyLmlkKVxuICAgICAgICAuc2VuZChyZXNpZGVuY2VVcGRhdGVEYXRhKTtcblxuICAgICAgLy8gVGVuYW50cyB0eXBpY2FsbHkgY2Fubm90IGVkaXQgc3RydWN0dXJhbCBpbmZvcm1hdGlvblxuICAgICAgLy8gU2hvdWxkIGZhaWwgd2l0aCA0MDMgb3Igb25seSBhbGxvdyBsaW1pdGVkIGZpZWxkc1xuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQ29udGFpbignSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyk7XG4gICAgICB9IGVsc2UgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIC8vIElmIGFsbG93ZWQsIHZlcmlmeSBvbmx5IGNlcnRhaW4gZmllbGRzIGNhbiBiZSB1cGRhdGVkIGJ5IHRlbmFudHNcbiAgICAgICAgY29uc3QgW3VwZGF0ZWRSZXNpZGVuY2VdID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2UuaWQpKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFN0cnVjdHVyYWwgZmllbGRzIHNob3VsZCBub3QgYmUgY2hhbmdlZCBieSB0ZW5hbnRzXG4gICAgICAgIGV4cGVjdCh1cGRhdGVkUmVzaWRlbmNlLnNxdWFyZUZvb3RhZ2UpLnRvQmUoMTAwMCk7IC8vIE9yaWdpbmFsIHZhbHVlXG4gICAgICAgIGV4cGVjdCh1cGRhdGVkUmVzaWRlbmNlLmJlZHJvb21zKS50b0JlKDIpOyAvLyBPcmlnaW5hbCB2YWx1ZVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlc2lkZW50IGZyb20gZWRpdGluZyByZXNpZGVuY2Ugc3RydWN0dXJhbCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3Jlc2lkZW5jZXMvJHt0ZXN0UmVzaWRlbmNlLmlkfWApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgcmVzaWRlbnRVc2VyLmlkKVxuICAgICAgICAuc2VuZChyZXNpZGVuY2VVcGRhdGVEYXRhKTtcblxuICAgICAgLy8gUmVzaWRlbnRzIHR5cGljYWxseSBjYW5ub3QgZWRpdCBzdHJ1Y3R1cmFsIGluZm9ybWF0aW9uXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSA0MDMpIHtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgLy8gSWYgYWxsb3dlZCwgdmVyaWZ5IG9ubHkgY2VydGFpbiBmaWVsZHMgY2FuIGJlIHVwZGF0ZWQgYnkgcmVzaWRlbnRzXG4gICAgICAgIGNvbnN0IFt1cGRhdGVkUmVzaWRlbmNlXSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlLmlkKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBTdHJ1Y3R1cmFsIGZpZWxkcyBzaG91bGQgbm90IGJlIGNoYW5nZWQgYnkgcmVzaWRlbnRzXG4gICAgICAgIGV4cGVjdCh1cGRhdGVkUmVzaWRlbmNlLnNxdWFyZUZvb3RhZ2UpLnRvQmUoMTAwMCk7IC8vIE9yaWdpbmFsIHZhbHVlXG4gICAgICAgIGV4cGVjdCh1cGRhdGVkUmVzaWRlbmNlLmJlZHJvb21zKS50b0JlKDIpOyAvLyBPcmlnaW5hbCB2YWx1ZVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBkZW1vX21hbmFnZXIgdG8gZWRpdCByZXNpZGVuY2VzIChkZW1vIGZ1bmN0aW9uYWxpdHkpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnB1dChgL2FwaS9yZXNpZGVuY2VzLyR7dGVzdFJlc2lkZW5jZS5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGRlbW9NYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQocmVzaWRlbmNlVXBkYXRlRGF0YSk7XG5cbiAgICAgIC8vIERlbW8gbWFuYWdlcnMgc2hvdWxkIGhhdmUgc2ltaWxhciBwZXJtaXNzaW9ucyB0byByZWd1bGFyIG1hbmFnZXJzXG4gICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnUmVzaWRlbmNlIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDQwMyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZXNpZGVuY2UgQ3JlYXRpb24gYnkgUm9sZScsICgpID0+IHtcbiAgICBjb25zdCBuZXdSZXNpZGVuY2VEYXRhID0ge1xuICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgdW5pdE51bWJlcjogJzEwMycsXG4gICAgICBzcXVhcmVGb290YWdlOiA5MDAsXG4gICAgICBiZWRyb29tczogMSxcbiAgICAgIGJhdGhyb29tczogMSxcbiAgICB9O1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBjcmVhdGUgcmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3Jlc2lkZW5jZXMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLnNlbmQobmV3UmVzaWRlbmNlRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdSZXNpZGVuY2UgY3JlYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnJlc2lkZW5jZS51bml0TnVtYmVyKS50b0JlKG5ld1Jlc2lkZW5jZURhdGEudW5pdE51bWJlcik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG1hbmFnZXIgdG8gY3JlYXRlIHJlc2lkZW5jZXMgaW4gYnVpbGRpbmdzIHRoZXkgbWFuYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvcmVzaWRlbmNlcycpXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgbWFuYWdlclVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld1Jlc2lkZW5jZURhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnUmVzaWRlbmNlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgbWFuYWdlciBmcm9tIGNyZWF0aW5nIHJlc2lkZW5jZXMgaW4gYnVpbGRpbmdzIG91dHNpZGUgdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgb3RoZXJCdWlsZGluZ1Jlc2lkZW5jZURhdGEgPSB7XG4gICAgICAgIC4uLm5ld1Jlc2lkZW5jZURhdGEsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IG90aGVyQnVpbGRpbmcuaWQsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9yZXNpZGVuY2VzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBtYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLnNlbmQob3RoZXJCdWlsZGluZ1Jlc2lkZW5jZURhdGEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDQwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgdGVuYW50IGZyb20gY3JlYXRpbmcgcmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3Jlc2lkZW5jZXMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHRlbmFudFVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld1Jlc2lkZW5jZURhdGEpXG4gICAgICAgIC5leHBlY3QoNDAzKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCByZXNpZGVudCBmcm9tIGNyZWF0aW5nIHJlc2lkZW5jZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9yZXNpZGVuY2VzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCByZXNpZGVudFVzZXIuaWQpXG4gICAgICAgIC5zZW5kKG5ld1Jlc2lkZW5jZURhdGEpXG4gICAgICAgIC5leHBlY3QoNDAzKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0J1aWxkaW5nIGFuZCBSZXNpZGVuY2UgRGVsZXRpb24gYnkgUm9sZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIGRlbGV0ZSBidWlsZGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZGVsZXRlKGAvYXBpL2J1aWxkaW5ncy8ke3Rlc3RCdWlsZGluZy5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdCdWlsZGluZyBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xuXG4gICAgICAvLyBWZXJpZnkgYnVpbGRpbmcgaXMgbWFya2VkIGFzIGluYWN0aXZlXG4gICAgICBjb25zdCBbZGVsZXRlZEJ1aWxkaW5nXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1aWxkaW5ncy5pZCwgdGVzdEJ1aWxkaW5nLmlkKSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkQnVpbGRpbmcuaXNBY3RpdmUpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBtYW5hZ2VyIHRvIGRlbGV0ZSBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9idWlsZGluZ3MvJHt0ZXN0QnVpbGRpbmcuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBtYW5hZ2VyVXNlci5pZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdCdWlsZGluZyBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHRlbmFudCBmcm9tIGRlbGV0aW5nIGJ1aWxkaW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5kZWxldGUoYC9hcGkvYnVpbGRpbmdzLyR7dGVzdEJ1aWxkaW5nLmlkfWApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgdGVuYW50VXNlci5pZClcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBkZWxldGUgcmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5kZWxldGUoYC9hcGkvcmVzaWRlbmNlcy8ke3Rlc3RSZXNpZGVuY2UuaWR9YClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnUmVzaWRlbmNlIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgIC8vIFZlcmlmeSByZXNpZGVuY2UgaXMgbWFya2VkIGFzIGluYWN0aXZlXG4gICAgICBjb25zdCBbZGVsZXRlZFJlc2lkZW5jZV0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pZCwgdGVzdFJlc2lkZW5jZS5pZCkpO1xuXG4gICAgICBleHBlY3QoZGVsZXRlZFJlc2lkZW5jZS5pc0FjdGl2ZSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IG1hbmFnZXIgdG8gZGVsZXRlIHJlc2lkZW5jZXMgaW4gdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9yZXNpZGVuY2VzLyR7dGVzdFJlc2lkZW5jZS5pZH1gKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIG1hbmFnZXJVc2VyLmlkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQmUoJ1Jlc2lkZW5jZSBkZWxldGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHRlbmFudCBmcm9tIGRlbGV0aW5nIHJlc2lkZW5jZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZGVsZXRlKGAvYXBpL3Jlc2lkZW5jZXMvJHt0ZXN0UmVzaWRlbmNlLmlkfWApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgdGVuYW50VXNlci5pZClcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YSBBY2Nlc3MgYnkgUm9sZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIHZpZXcgYWxsIGJ1aWxkaW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvYnVpbGRpbmdzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgbWFuYWdlciB0byB2aWV3IGJ1aWxkaW5ncyBpbiB0aGVpciBvcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2J1aWxkaW5ncycpXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgbWFuYWdlclVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgLy8gTWFuYWdlciBzaG91bGQgc2VlIGF0IGxlYXN0IHRoZSB0ZXN0IGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZ0lkcyA9IHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdzLm1hcCgoYjogYW55KSA9PiBiLmlkKTtcbiAgICAgIGV4cGVjdChidWlsZGluZ0lkcykudG9Db250YWluKHRlc3RCdWlsZGluZy5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHRlbmFudCB0byB2aWV3IHRoZWlyIGJ1aWxkaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9idWlsZGluZ3MnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHRlbmFudFVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgLy8gVGVuYW50IHNob3VsZCBzZWUgdGhlaXIgYnVpbGRpbmdcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWRzID0gcmVzcG9uc2UuYm9keS5idWlsZGluZ3MubWFwKChiOiBhbnkpID0+IGIuaWQpO1xuICAgICAgZXhwZWN0KGJ1aWxkaW5nSWRzKS50b0NvbnRhaW4odGVzdEJ1aWxkaW5nLmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgYWRtaW4gdG8gdmlldyBhbGwgcmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvcmVzaWRlbmNlcycpXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnJlc2lkZW5jZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5yZXNpZGVuY2VzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgdGVuYW50IHRvIHZpZXcgdGhlaXIgcmVzaWRlbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9yZXNpZGVuY2VzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCB0ZW5hbnRVc2VyLmlkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnJlc2lkZW5jZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAvLyBUZW5hbnQgc2hvdWxkIHNlZSB0aGVpciByZXNpZGVuY2VcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUlkcyA9IHJlc3BvbnNlLmJvZHkucmVzaWRlbmNlcy5tYXAoKHI6IGFueSkgPT4gci5pZCk7XG4gICAgICBleHBlY3QocmVzaWRlbmNlSWRzKS50b0NvbnRhaW4odGVzdFJlc2lkZW5jZS5pZCk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9