fe2c2d3c930a56ad37bd3367e6b6179b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StandardForm = StandardForm;
exports.useStandardForm = useStandardForm;
exports.FormValidationSummary = FormValidationSummary;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importDefault(require("react"));
const form_1 = require("@/components/ui/form");
const card_1 = require("@/components/ui/card");
const alert_1 = require("@/components/ui/alert");
const lucide_react_1 = require("lucide-react");
const utils_1 = require("@/lib/utils");
const StandardFormField_1 = require("./StandardFormField");
/**
 * Standardized form wrapper that provides consistent styling, layout,
 * error handling, and accessibility features for all forms in the application.
 *
 * Features:
 * - Consistent form layout and styling
 * - Quebec compliance standards
 * - Built-in error and success messaging
 * - Responsive design
 * - Automatic test ID generation
 * - Loading states with proper UX
 * - Optional card wrapper for better visual hierarchy
 *
 * @param props - Configuration for the form wrapper
 */
function StandardForm({ form, onSubmit, title, description, children, isLoading = false, submitText = 'Submit', loadingText = 'Submitting...', className = '', formName = 'standard-form', showCard = true, errorMessage, successMessage, resetOnSuccess = false, maxWidth = 'md', }) {
    // Handle form submission with error boundary
    const handleSubmit = async (data) => {
        try {
            await onSubmit(data);
            if (resetOnSuccess) {
                form.reset();
            }
        }
        catch (error) {
            console.error('Form submission error:', error);
            // Error is handled by parent component through errorMessage prop
        }
    };
    // Get max-width classes based on prop
    const maxWidthClasses = {
        sm: 'max-w-sm',
        md: 'max-w-md',
        lg: 'max-w-lg',
        xl: 'max-w-xl',
        '2xl': 'max-w-2xl',
        full: 'max-w-full',
    };
    const FormContent = () => ((0, jsx_runtime_1.jsx)(form_1.Form, { ...form, children: (0, jsx_runtime_1.jsxs)("form", { onSubmit: form.handleSubmit(handleSubmit), className: (0, utils_1.cn)('space-y-6', className), "data-testid": `${formName}-form`, noValidate // We handle validation with Zod
            : true, children: [errorMessage && ((0, jsx_runtime_1.jsxs)(alert_1.Alert, { variant: "destructive", "data-testid": `${formName}-error-alert`, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.AlertCircle, { className: "h-4 w-4" }), (0, jsx_runtime_1.jsx)(alert_1.AlertDescription, { children: errorMessage })] })), successMessage && ((0, jsx_runtime_1.jsxs)(alert_1.Alert, { variant: "default", className: "border-green-500 text-green-700", "data-testid": `${formName}-success-alert`, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.CheckCircle, { className: "h-4 w-4" }), (0, jsx_runtime_1.jsx)(alert_1.AlertDescription, { children: successMessage })] })), (0, jsx_runtime_1.jsx)("div", { className: "space-y-4", children: children }), (0, jsx_runtime_1.jsx)("div", { className: "flex justify-end pt-4", children: (0, jsx_runtime_1.jsx)(StandardFormField_1.StandardSubmitButton, { isLoading: isLoading, loadingText: loadingText, formName: formName, disabled: isLoading, children: submitText }) })] }) }));
    if (!showCard) {
        return ((0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)('w-full mx-auto', maxWidthClasses[maxWidth]), children: (0, jsx_runtime_1.jsx)(FormContent, {}) }));
    }
    return ((0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)('w-full mx-auto', maxWidthClasses[maxWidth]), children: (0, jsx_runtime_1.jsxs)(card_1.Card, { "data-testid": `${formName}-card`, children: [(title || description) && ((0, jsx_runtime_1.jsxs)(card_1.CardHeader, { children: [title && ((0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: "text-xl font-semibold text-gray-900", children: title })), description && ((0, jsx_runtime_1.jsx)(card_1.CardDescription, { className: "text-gray-600", children: description }))] })), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)(FormContent, {}) })] }) }));
}
function useStandardForm(options = {}) {
    const [isLoading, setIsLoading] = react_1.default.useState(false);
    const [errorMessage, setErrorMessage] = react_1.default.useState('');
    const [successMessage, setSuccessMessage] = react_1.default.useState('');
    const { resetOnSuccess = false, showSuccessMessage = true, successMessageDuration = 3000, } = options;
    // Clear success message after duration
    react_1.default.useEffect(() => {
        if (successMessage && successMessageDuration > 0) {
            const timer = setTimeout(() => {
                setSuccessMessage('');
            }, successMessageDuration);
            return () => clearTimeout(timer);
        }
    }, [successMessage, successMessageDuration]);
    const handleSubmit = react_1.default.useCallback(async (submitFn, form, successMsg = 'Operation completed successfully') => {
        return async (data) => {
            setIsLoading(true);
            setErrorMessage('');
            setSuccessMessage('');
            try {
                await submitFn(data);
                if (showSuccessMessage) {
                    setSuccessMessage(successMsg);
                }
                if (resetOnSuccess) {
                    form.reset();
                }
            }
            catch (error) {
                console.error('Form submission error:', error);
                setErrorMessage(error.response?.data?.message ||
                    error.message ||
                    'An unexpected error occurred. Please try again.');
            }
            finally {
                setIsLoading(false);
            }
        };
    }, [resetOnSuccess, showSuccessMessage]);
    const clearMessages = react_1.default.useCallback(() => {
        setErrorMessage('');
        setSuccessMessage('');
    }, []);
    return {
        isLoading,
        errorMessage,
        successMessage,
        handleSubmit,
        clearMessages,
        setIsLoading,
        setErrorMessage,
        setSuccessMessage,
    };
}
function FormValidationSummary({ errors, formName = 'form', className = '', }) {
    const errorEntries = Object.entries(errors).filter(([, error]) => error?.message);
    if (errorEntries.length === 0) {
        return null;
    }
    return ((0, jsx_runtime_1.jsxs)(alert_1.Alert, { variant: "destructive", className: className, "data-testid": `${formName}-validation-summary`, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.AlertCircle, { className: "h-4 w-4" }), (0, jsx_runtime_1.jsx)(alert_1.AlertDescription, { children: (0, jsx_runtime_1.jsxs)("div", { className: "space-y-1", children: [(0, jsx_runtime_1.jsx)("p", { className: "font-medium", children: "Please correct the following errors:" }), (0, jsx_runtime_1.jsx)("ul", { className: "list-disc list-inside space-y-1 text-sm", children: errorEntries.map(([field, error]) => ((0, jsx_runtime_1.jsxs)("li", { children: [(0, jsx_runtime_1.jsxs)("strong", { children: [field.charAt(0).toUpperCase() + field.slice(1), ":"] }), " ", error.message] }, field))) })] }) })] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvZm9ybXMvU3RhbmRhcmRGb3JtLnRzeCIsIm1hcHBpbmdzIjoiOzs7OztBQTZDQSxvQ0FtSEM7QUFXRCwwQ0F3RUM7QUFXRCxzREE0QkM7O0FBMVJELGtEQUEwQjtBQUUxQiwrQ0FBNEM7QUFDNUMsK0NBQWlHO0FBQ2pHLGlEQUFnRTtBQUNoRSwrQ0FBd0Q7QUFDeEQsdUNBQWlDO0FBQ2pDLDJEQUF3RTtBQXVCeEU7Ozs7Ozs7Ozs7Ozs7O0dBY0c7QUFDSCxTQUFnQixZQUFZLENBQXdCLEVBQ2xELElBQUksRUFDSixRQUFRLEVBQ1IsS0FBSyxFQUNMLFdBQVcsRUFDWCxRQUFRLEVBQ1IsU0FBUyxHQUFHLEtBQUssRUFDakIsVUFBVSxHQUFHLFFBQVEsRUFDckIsV0FBVyxHQUFHLGVBQWUsRUFDN0IsU0FBUyxHQUFHLEVBQUUsRUFDZCxRQUFRLEdBQUcsZUFBZSxFQUMxQixRQUFRLEdBQUcsSUFBSSxFQUNmLFlBQVksRUFDWixjQUFjLEVBQ2QsY0FBYyxHQUFHLEtBQUssRUFDdEIsUUFBUSxHQUFHLElBQUksR0FDTTtJQUNyQiw2Q0FBNkM7SUFDN0MsTUFBTSxZQUFZLEdBQUcsS0FBSyxFQUFFLElBQU8sRUFBRSxFQUFFO1FBQ3JDLElBQUksQ0FBQztZQUNILE1BQU0sUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JCLElBQUksY0FBYyxFQUFFLENBQUM7Z0JBQ25CLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUNmLENBQUM7UUFDSCxDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU8sQ0FBQyxLQUFLLENBQUMsd0JBQXdCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0MsaUVBQWlFO1FBQ25FLENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRixzQ0FBc0M7SUFDdEMsTUFBTSxlQUFlLEdBQUc7UUFDdEIsRUFBRSxFQUFFLFVBQVU7UUFDZCxFQUFFLEVBQUUsVUFBVTtRQUNkLEVBQUUs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LEVBQ25FLCtCQUFJLFNBQVMsRUFBQyx5Q0FBeUMsWUFDcEQsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUNwQywyQ0FDRSwrQ0FBUyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLFNBQVcsT0FBRSxLQUFLLENBQUMsT0FBTyxLQUQxRSxLQUFLLENBRVQsQ0FDTixDQUFDLEdBQ0MsSUFDRCxHQUNXLElBQ2IsQ0FDVCxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvY29tcG9uZW50cy9mb3Jtcy9TdGFuZGFyZEZvcm0udHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBVc2VGb3JtUmV0dXJuLCBGaWVsZFZhbHVlcyB9IGZyb20gJ3JlYWN0LWhvb2stZm9ybSc7XG5pbXBvcnQgeyBGb3JtIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2Zvcm0nO1xuaW1wb3J0IHsgQ2FyZCwgQ2FyZENvbnRlbnQsIENhcmREZXNjcmlwdGlvbiwgQ2FyZEhlYWRlciwgQ2FyZFRpdGxlIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2NhcmQnO1xuaW1wb3J0IHsgQWxlcnQsIEFsZXJ0RGVzY3JpcHRpb24gfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvYWxlcnQnO1xuaW1wb3J0IHsgQWxlcnRDaXJjbGUsIENoZWNrQ2lyY2xlIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IGNuIH0gZnJvbSAnQC9saWIvdXRpbHMnO1xuaW1wb3J0IHsgU3RhbmRhcmRTdWJtaXRCdXR0b24sIEZvcm1TZWN0aW9uIH0gZnJvbSAnLi9TdGFuZGFyZEZvcm1GaWVsZCc7XG5cbi8qKlxuICogUHJvcHMgZm9yIHRoZSBzdGFuZGFyZGl6ZWQgZm9ybSB3cmFwcGVyXG4gKi9cbmludGVyZmFjZSBTdGFuZGFyZEZvcm1Qcm9wczxUIGV4dGVuZHMgRmllbGRWYWx1ZXM+IHtcbiAgZm9ybTogVXNlRm9ybVJldHVybjxUPjtcbiAgb25TdWJtaXQ6IChkYXRhOiBUKSA9PiB2b2lkIHwgUHJvbWlzZTx2b2lkPjtcbiAgdGl0bGU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlO1xuICBpc0xvYWRpbmc/OiBib29sZWFuO1xuICBzdWJtaXRUZXh0Pzogc3RyaW5nO1xuICBsb2FkaW5nVGV4dD86IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBmb3JtTmFtZT86IHN0cmluZztcbiAgc2hvd0NhcmQ/OiBib29sZWFuO1xuICBlcnJvck1lc3NhZ2U/OiBzdHJpbmc7XG4gIHN1Y2Nlc3NNZXNzYWdlPzogc3RyaW5nO1xuICByZXNldE9uU3VjY2Vzcz86IGJvb2xlYW47XG4gIG1heFdpZHRoPzogJ3NtJyB8ICdtZCcgfCAnbGcnIHwgJ3hsJyB8ICcyeGwnIHwgJ2Z1bGwnO1xufVxuXG4vKipcbiAqIFN0YW5kYXJkaXplZCBmb3JtIHdyYXBwZXIgdGhhdCBwcm92aWRlcyBjb25zaXN0ZW50IHN0eWxpbmcsIGxheW91dCxcbiAqIGVycm9yIGhhbmRsaW5nLCBhbmQgYWNjZXNzaWJpbGl0eSBmZWF0dXJlcyBmb3IgYWxsIGZvcm1zIGluIHRoZSBhcHBsaWNhdGlvbi5cbiAqIFxuICogRmVhdHVyZXM6XG4gKiAtIENvbnNpc3RlbnQgZm9ybSBsYXlvdXQgYW5kIHN0eWxpbmdcbiAqIC0gUXVlYmVjIGNvbXBsaWFuY2Ugc3RhbmRhcmRzXG4gKiAtIEJ1aWx0LWluIGVycm9yIGFuZCBzdWNjZXNzIG1lc3NhZ2luZ1xuICogLSBSZXNwb25zaXZlIGRlc2lnblxuICogLSBBdXRvbWF0aWMgdGVzdCBJRCBnZW5lcmF0aW9uXG4gKiAtIExvYWRpbmcgc3RhdGVzIHdpdGggcHJvcGVyIFVYXG4gKiAtIE9wdGlvbmFsIGNhcmQgd3JhcHBlciBmb3IgYmV0dGVyIHZpc3VhbCBoaWVyYXJjaHlcbiAqIFxuICogQHBhcmFtIHByb3BzIC0gQ29uZmlndXJhdGlvbiBmb3IgdGhlIGZvcm0gd3JhcHBlclxuICovXG5leHBvcnQgZnVuY3Rpb24gU3RhbmRhcmRGb3JtPFQgZXh0ZW5kcyBGaWVsZFZhbHVlcz4oe1xuICBmb3JtLFxuICBvblN1Ym1pdCxcbiAgdGl0bGUsXG4gIGRlc2NyaXB0aW9uLFxuICBjaGlsZHJlbixcbiAgaXNMb2FkaW5nID0gZmFsc2UsXG4gIHN1Ym1pdFRleHQgPSAnU3VibWl0JyxcbiAgbG9hZGluZ1RleHQgPSAnU3VibWl0dGluZy4uLicsXG4gIGNsYXNzTmFtZSA9ICcnLFxuICBmb3JtTmFtZSA9ICdzdGFuZGFyZC1mb3JtJyxcbiAgc2hvd0NhcmQgPSB0cnVlLFxuICBlcnJvck1lc3NhZ2UsXG4gIHN1Y2Nlc3NNZXNzYWdlLFxuICByZXNldE9uU3VjY2VzcyA9IGZhbHNlLFxuICBtYXhXaWR0aCA9ICdtZCcsXG59OiBTdGFuZGFyZEZvcm1Qcm9wczxUPikge1xuICAvLyBIYW5kbGUgZm9ybSBzdWJtaXNzaW9uIHdpdGggZXJyb3IgYm91bmRhcnlcbiAgY29uc3QgaGFuZGxlU3VibWl0ID0gYXN5bmMgKGRhdGE6IFQpID0+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgb25TdWJtaXQoZGF0YSk7XG4gICAgICBpZiAocmVzZXRPblN1Y2Nlc3MpIHtcbiAgICAgICAgZm9ybS5yZXNldCgpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGb3JtIHN1Ym1pc3Npb24gZXJyb3I6JywgZXJyb3IpO1xuICAgICAgLy8gRXJyb3IgaXMgaGFuZGxlZCBieSBwYXJlbnQgY29tcG9uZW50IHRocm91Z2ggZXJyb3JNZXNzYWdlIHByb3BcbiAgICB9XG4gIH07XG5cbiAgLy8gR2V0IG1heC13aWR0aCBjbGFzc2VzIGJhc2VkIG9uIHByb3BcbiAgY29uc3QgbWF4V2lkdGhDbGFzc2VzID0ge1xuICAgIHNtOiAnbWF4LXctc20nLFxuICAgIG1kOiAnbWF4LXctbWQnLFxuICAgIGxnOiAnbWF4LXctbGcnLFxuICAgIHhsOiAnbWF4LXcteGwnLFxuICAgICcyeGwnOiAnbWF4LXctMnhsJyxcbiAgICBmdWxsOiAnbWF4LXctZnVsbCcsXG4gIH07XG5cbiAgY29uc3QgRm9ybUNvbnRlbnQgPSAoKSA9PiAoXG4gICAgPEZvcm0gey4uLmZvcm19PlxuICAgICAgPGZvcm1cbiAgICAgICAgb25TdWJtaXQ9e2Zvcm0uaGFuZGxlU3VibWl0KGhhbmRsZVN1Ym1pdCl9XG4gICAgICAgIGNsYXNzTmFtZT17Y24oJ3NwYWNlLXktNicsIGNsYXNzTmFtZSl9XG4gICAgICAgIGRhdGEtdGVzdGlkPXtgJHtmb3JtTmFtZX0tZm9ybWB9XG4gICAgICAgIG5vVmFsaWRhdGUgLy8gV2UgaGFuZGxlIHZhbGlkYXRpb24gd2l0aCBab2RcbiAgICAgID5cbiAgICAgICAgey8qIEVycm9yIEFsZXJ0ICovfVxuICAgICAgICB7ZXJyb3JNZXNzYWdlICYmIChcbiAgICAgICAgICA8QWxlcnQgdmFyaWFudD1cImRlc3RydWN0aXZlXCIgZGF0YS10ZXN0aWQ9e2Ake2Zvcm1OYW1lfS1lcnJvci1hbGVydGB9PlxuICAgICAgICAgICAgPEFsZXJ0Q2lyY2xlIGNsYXNzTmFtZT1cImgtNCB3LTRcIiAvPlxuICAgICAgICAgICAgPEFsZXJ0RGVzY3JpcHRpb24+e2Vycm9yTWVzc2FnZX08L0FsZXJ0RGVzY3JpcHRpb24+XG4gICAgICAgICAgPC9BbGVydD5cbiAgICAgICAgKX1cblxuICAgICAgICB7LyogU3VjY2VzcyBBbGVydCAqL31cbiAgICAgICAge3N1Y2Nlc3NNZXNzYWdlICYmIChcbiAgICAgICAgICA8QWxlcnQgdmFyaWFudD1cImRlZmF1bHRcIiBjbGFzc05hbWU9XCJib3JkZXItZ3JlZW4tNTAwIHRleHQtZ3JlZW4tNzAwXCIgZGF0YS10ZXN0aWQ9e2Ake2Zvcm1OYW1lfS1zdWNjZXNzLWFsZXJ0YH0+XG4gICAgICAgICAgICA8Q2hlY2tDaXJjbGUgY2xhc3NOYW1lPVwiaC00IHctNFwiIC8+XG4gICAgICAgICAgICA8QWxlcnREZXNjcmlwdGlvbj57c3VjY2Vzc01lc3NhZ2V9PC9BbGVydERlc2NyaXB0aW9uPlxuICAgICAgICAgIDwvQWxlcnQ+XG4gICAgICAgICl9XG5cbiAgICAgICAgey8qIEZvcm0gRmllbGRzICovfVxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktNFwiPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgey8qIFN1Ym1pdCBCdXR0b24gKi99XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBqdXN0aWZ5LWVuZCBwdC00XCI+XG4gICAgICAgICAgPFN0YW5kYXJkU3VibWl0QnV0dG9uXG4gICAgICAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ31cbiAgICAgICAgICAgIGxvYWRpbmdUZXh0PXtsb2FkaW5nVGV4dH1cbiAgICAgICAgICAgIGZvcm1OYW1lPXtmb3JtTmFtZX1cbiAgICAgICAgICAgIGRpc2FibGVkPXtpc0xvYWRpbmd9XG4gICAgICAgICAgPlxuICAgICAgICAgICAge3N1Ym1pdFRleHR9XG4gICAgICAgICAgPC9TdGFuZGFyZFN1Ym1pdEJ1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Zvcm0+XG4gICAgPC9Gb3JtPlxuICApO1xuXG4gIGlmICghc2hvd0NhcmQpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9e2NuKCd3LWZ1bGwgbXgtYXV0bycsIG1heFdpZHRoQ2xhc3Nlc1ttYXhXaWR0aF0pfT5cbiAgICAgICAgPEZvcm1Db250ZW50IC8+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT17Y24oJ3ctZnVsbCBteC1hdXRvJywgbWF4V2lkdGhDbGFzc2VzW21heFdpZHRoXSl9PlxuICAgICAgPENhcmQgZGF0YS10ZXN0aWQ9e2Ake2Zvcm1OYW1lfS1jYXJkYH0+XG4gICAgICAgIHsodGl0bGUgfHwgZGVzY3JpcHRpb24pICYmIChcbiAgICAgICAgICA8Q2FyZEhlYWRlcj5cbiAgICAgICAgICAgIHt0aXRsZSAmJiAoXG4gICAgICAgICAgICAgIDxDYXJkVGl0bGUgY2xhc3NOYW1lPVwidGV4dC14bCBmb250LXNlbWlib2xkIHRleHQtZ3JheS05MDBcIj5cbiAgICAgICAgICAgICAgICB7dGl0bGV9XG4gICAgICAgICAgICAgIDwvQ2FyZFRpdGxlPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIHtkZXNjcmlwdGlvbiAmJiAoXG4gICAgICAgICAgICAgIDxDYXJkRGVzY3JpcHRpb24gY2xhc3NOYW1lPVwidGV4dC1ncmF5LTYwMFwiPlxuICAgICAgICAgICAgICAgIHtkZXNjcmlwdGlvbn1cbiAgICAgICAgICAgICAgPC9DYXJkRGVzY3JpcHRpb24+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvQ2FyZEhlYWRlcj5cbiAgICAgICAgKX1cbiAgICAgICAgPENhcmRDb250ZW50PlxuICAgICAgICAgIDxGb3JtQ29udGVudCAvPlxuICAgICAgICA8L0NhcmRDb250ZW50PlxuICAgICAgPC9DYXJkPlxuICAgIDwvZGl2PlxuICApO1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIG1hbmFnaW5nIGZvcm0gc3RhdGUgd2l0aCBzdGFuZGFyZGl6ZWQgZXJyb3IgaGFuZGxpbmdcbiAqL1xuaW50ZXJmYWNlIFVzZVN0YW5kYXJkRm9ybU9wdGlvbnMge1xuICByZXNldE9uU3VjY2Vzcz86IGJvb2xlYW47XG4gIHNob3dTdWNjZXNzTWVzc2FnZT86IGJvb2xlYW47XG4gIHN1Y2Nlc3NNZXNzYWdlRHVyYXRpb24/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1c2VTdGFuZGFyZEZvcm0ob3B0aW9uczogVXNlU3RhbmRhcmRGb3JtT3B0aW9ucyA9IHt9KSB7XG4gIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSBSZWFjdC51c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtlcnJvck1lc3NhZ2UsIHNldEVycm9yTWVzc2FnZV0gPSBSZWFjdC51c2VTdGF0ZTxzdHJpbmc+KCcnKTtcbiAgY29uc3QgW3N1Y2Nlc3NNZXNzYWdlLCBzZXRTdWNjZXNzTWVzc2FnZV0gPSBSZWFjdC51c2VTdGF0ZTxzdHJpbmc+KCcnKTtcblxuICBjb25zdCB7XG4gICAgcmVzZXRPblN1Y2Nlc3MgPSBmYWxzZSxcbiAgICBzaG93U3VjY2Vzc01lc3NhZ2UgPSB0cnVlLFxuICAgIHN1Y2Nlc3NNZXNzYWdlRHVyYXRpb24gPSAzMDAwLFxuICB9ID0gb3B0aW9ucztcblxuICAvLyBDbGVhciBzdWNjZXNzIG1lc3NhZ2UgYWZ0ZXIgZHVyYXRpb25cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoc3VjY2Vzc01lc3NhZ2UgJiYgc3VjY2Vzc01lc3NhZ2VEdXJhdGlvbiA+IDApIHtcbiAgICAgIGNvbnN0IHRpbWVyID0gc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIHNldFN1Y2Nlc3NNZXNzYWdlKCcnKTtcbiAgICAgIH0sIHN1Y2Nlc3NNZXNzYWdlRHVyYXRpb24pO1xuICAgICAgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0aW1lcik7XG4gICAgfVxuICB9LCBbc3VjY2Vzc01lc3NhZ2UsIHN1Y2Nlc3NNZXNzYWdlRHVyYXRpb25dKTtcblxuICBjb25zdCBoYW5kbGVTdWJtaXQgPSBSZWFjdC51c2VDYWxsYmFjayhcbiAgICBhc3luYyA8VCBleHRlbmRzIEZpZWxkVmFsdWVzPihcbiAgICAgIHN1Ym1pdEZuOiAoZGF0YTogVCkgPT4gUHJvbWlzZTx2b2lkPixcbiAgICAgIGZvcm06IFVzZUZvcm1SZXR1cm48VD4sXG4gICAgICBzdWNjZXNzTXNnOiBzdHJpbmcgPSAnT3BlcmF0aW9uIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknXG4gICAgKSA9PiB7XG4gICAgICByZXR1cm4gYXN5bmMgKGRhdGE6IFQpID0+IHtcbiAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgICBzZXRFcnJvck1lc3NhZ2UoJycpO1xuICAgICAgICBzZXRTdWNjZXNzTWVzc2FnZSgnJyk7XG5cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBzdWJtaXRGbihkYXRhKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoc2hvd1N1Y2Nlc3NNZXNzYWdlKSB7XG4gICAgICAgICAgICBzZXRTdWNjZXNzTWVzc2FnZShzdWNjZXNzTXNnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKHJlc2V0T25TdWNjZXNzKSB7XG4gICAgICAgICAgICBmb3JtLnJlc2V0KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRm9ybSBzdWJtaXNzaW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgICAgICBzZXRFcnJvck1lc3NhZ2UoXG4gICAgICAgICAgICBlcnJvci5yZXNwb25zZT8uZGF0YT8ubWVzc2FnZSB8fCBcbiAgICAgICAgICAgIGVycm9yLm1lc3NhZ2UgfHwgXG4gICAgICAgICAgICAnQW4gdW5leHBlY3RlZCBlcnJvciBvY2N1cnJlZC4gUGxlYXNlIHRyeSBhZ2Fpbi4nXG4gICAgICAgICAgKTtcbiAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgIH0sXG4gICAgW3Jlc2V0T25TdWNjZXNzLCBzaG93U3VjY2Vzc01lc3NhZ2VdXG4gICk7XG5cbiAgY29uc3QgY2xlYXJNZXNzYWdlcyA9IFJlYWN0LnVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRFcnJvck1lc3NhZ2UoJycpO1xuICAgIHNldFN1Y2Nlc3NNZXNzYWdlKCcnKTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB7XG4gICAgaXNMb2FkaW5nLFxuICAgIGVycm9yTWVzc2FnZSxcbiAgICBzdWNjZXNzTWVzc2FnZSxcbiAgICBoYW5kbGVTdWJtaXQsXG4gICAgY2xlYXJNZXNzYWdlcyxcbiAgICBzZXRJc0xvYWRpbmcsXG4gICAgc2V0RXJyb3JNZXNzYWdlLFxuICAgIHNldFN1Y2Nlc3NNZXNzYWdlLFxuICB9O1xufVxuXG4vKipcbiAqIFN0YW5kYXJkaXplZCBmb3JtIHZhbGlkYXRpb24gZXJyb3IgZGlzcGxheSBjb21wb25lbnRcbiAqL1xuaW50ZXJmYWNlIEZvcm1WYWxpZGF0aW9uU3VtbWFyeVByb3BzIHtcbiAgZXJyb3JzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBmb3JtTmFtZT86IHN0cmluZztcbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gRm9ybVZhbGlkYXRpb25TdW1tYXJ5KHtcbiAgZXJyb3JzLFxuICBmb3JtTmFtZSA9ICdmb3JtJyxcbiAgY2xhc3NOYW1lID0gJycsXG59OiBGb3JtVmFsaWRhdGlvblN1bW1hcnlQcm9wcykge1xuICBjb25zdCBlcnJvckVudHJpZXMgPSBPYmplY3QuZW50cmllcyhlcnJvcnMpLmZpbHRlcigoWywgZXJyb3JdKSA9PiBlcnJvcj8ubWVzc2FnZSk7XG5cbiAgaWYgKGVycm9yRW50cmllcy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPEFsZXJ0IHZhcmlhbnQ9XCJkZXN0cnVjdGl2ZVwiIGNsYXNzTmFtZT17Y2xhc3NOYW1lfSBkYXRhLXRlc3RpZD17YCR7Zm9ybU5hbWV9LXZhbGlkYXRpb24tc3VtbWFyeWB9PlxuICAgICAgPEFsZXJ0Q2lyY2xlIGNsYXNzTmFtZT1cImgtNCB3LTRcIiAvPlxuICAgICAgPEFsZXJ0RGVzY3JpcHRpb24+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS0xXCI+XG4gICAgICAgICAgPHAgY2xhc3NOYW1lPVwiZm9udC1tZWRpdW1cIj5QbGVhc2UgY29ycmVjdCB0aGUgZm9sbG93aW5nIGVycm9yczo8L3A+XG4gICAgICAgICAgPHVsIGNsYXNzTmFtZT1cImxpc3QtZGlzYyBsaXN0LWluc2lkZSBzcGFjZS15LTEgdGV4dC1zbVwiPlxuICAgICAgICAgICAge2Vycm9yRW50cmllcy5tYXAoKFtmaWVsZCwgZXJyb3JdKSA9PiAoXG4gICAgICAgICAgICAgIDxsaSBrZXk9e2ZpZWxkfT5cbiAgICAgICAgICAgICAgICA8c3Ryb25nPntmaWVsZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGZpZWxkLnNsaWNlKDEpfTo8L3N0cm9uZz4ge2Vycm9yLm1lc3NhZ2V9XG4gICAgICAgICAgICAgIDwvbGk+XG4gICAgICAgICAgICApKX1cbiAgICAgICAgICA8L3VsPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvQWxlcnREZXNjcmlwdGlvbj5cbiAgICA8L0FsZXJ0PlxuICApO1xufSJdLCJ2ZXJzaW9uIjozfQ==