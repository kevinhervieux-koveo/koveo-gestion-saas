bc434deff971ee2e5c32f13a971be624
"use strict";
/**
 * Integration Tests for Bug Reports Role-Based Access Control
 *
 * Tests cover the fix for redundant client-side filtering that prevented
 * admins from seeing all bugs. Now properly tests:
 * - Admin users can see all bug reports
 * - Regular users can only see their own bug reports
 * - Server-side access control works correctly
 * - Client-side filtering only applies to search/status/priority
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const express_session_1 = __importDefault(require("express-session"));
const bugs_1 = require("../../server/api/bugs");
const storage_1 = require("../../server/storage");
const test_utils_1 = require("../utils/test-utils");
// Mock storage
let mockStorage;
// Create test Express app
const createTestApp = () => {
    const app = (0, express_1.default)();
    // Setup middleware
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Session middleware for authentication
    app.use((0, express_session_1.default)({
        secret: 'test-secret',
        resave: false,
        saveUninitialized: false,
        cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 },
    }));
    // Mock auth middleware
    app.use((req, res, next) => {
        if (req.session?.user) {
            req.user = req.session.user;
        }
        next();
    });
    // Register bug routes
    (0, bugs_1.registerBugRoutes)(app);
    return app;
};
(0, globals_1.describe)('Bug Reports Role-Based Access Control', () => {
    let app;
    let adminUser;
    let user1;
    let user2;
    let adminAgent;
    let user1Agent;
    let user2Agent;
    let createdBugs = [];
    (0, globals_1.beforeEach)(async () => {
        // Initialize mock storage
        mockStorage = new storage_1.MemStorage();
        // Mock the storage module
        globals_1.jest.doMock('../../server/storage', () => ({
            storage: mockStorage
        }));
        app = createTestApp();
        // Create test users
        adminUser = await (0, test_utils_1.createTestUser)({
            email: 'admin@test.com',
            role: 'admin',
            firstName: 'Admin',
            lastName: 'User'
        });
        user1 = await (0, test_utils_1.createTestUser)({
            email: 'user1@test.com',
            role: 'resident',
            firstName: 'User',
            lastName: 'One'
        });
        user2 = await (0, test_utils_1.createTestUser)({
            email: 'user2@test.com',
            role: 'resident',
            firstName: 'User',
            lastName: 'Two'
        });
        // Create authenticated agents
        adminAgent = supertest_1.default.agent(app);
        user1Agent = supertest_1.default.agent(app);
        user2Agent = supertest_1.default.agent(app);
        // Mock sessions for each agent
        await adminAgent
            .post('/mock-login')
            .send(adminUser);
        await user1Agent
            .post('/mock-login')
            .send(user1);
        await user2Agent
            .post('/mock-login')
            .send(user2);
        // Create test bugs
        const bugs = [
            {
                title: 'Admin Bug 1',
                description: 'Bug created by admin',
                category: 'functionality',
                page: '/admin/dashboard',
                priority: 'high',
                createdBy: adminUser.id,
                reproductionSteps: 'Step 1, Step 2',
            },
            {
                title: 'User1 Bug 1',
                description: 'Bug created by user1',
                category: 'ui_ux',
                page: '/dashboard',
                priority: 'medium',
                createdBy: user1.id,
                reproductionSteps: 'User1 steps',
            },
            {
                title: 'User1 Bug 2',
                description: 'Another bug by user1',
                category: 'performance',
                page: '/documents',
                priority: 'low',
                createdBy: user1.id,
                reproductionSteps: 'Performance issue steps',
            },
            {
                title: 'User2 Bug 1',
                description: 'Bug created by user2',
                category: 'security',
                page: '/settings',
                priority: 'critical',
                createdBy: user2.id,
                reproductionSteps: 'Security bug steps',
            },
        ];
        // Create bugs in storage
        for (const bugData of bugs) {
            const created = await mockStorage.createBug(bugData);
            createdBugs.push(created);
        }
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.clearAllMocks();
        globals_1.jest.resetModules();
        createdBugs = [];
    });
    (0, globals_1.describe)('Admin Access Control', () => {
        (0, globals_1.it)('should allow admin to see all bugs from all users', async () => {
            const response = await adminAgent
                .get('/api/bugs')
                .expect(200);
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
            (0, globals_1.expect)(response.body).toHaveLength(4); // All 4 bugs
            // Verify admin can see bugs from all users
            const creatorIds = response.body.map((bug) => bug.createdBy);
            (0, globals_1.expect)(creatorIds).toContain(adminUser.id);
            (0, globals_1.expect)(creatorIds).toContain(user1.id);
            (0, globals_1.expect)(creatorIds).toContain(user2.id);
        });
        (0, globals_1.it)('should allow admin to access any specific bug', async () => {
            // Test accessing user1's bug
            const user1Bug = createdBugs.find(bug => bug.createdBy === user1.id);
            const response = await adminAgent
                .get(`/api/bugs/${user1Bug.id}`)
                .expect(200);
            (0, globals_1.expect)(response.body.id).toBe(user1Bug.id);
            (0, globals_1.expect)(response.body.createdBy).toBe(user1.id);
        });
        (0, globals_1.it)('should allow admin to update any bug', async () => {
            const user2Bug = createdBugs.find(bug => bug.createdBy === user2.id);
            const response = await adminAgent
                .patch(`/api/bugs/${user2Bug.id}`)
                .send({
                status: 'in_progress',
                assignedTo: adminUser.id
            })
                .expect(200);
            (0, globals_1.expect)(response.body.status).toBe('in_progress');
            (0, globals_1.expect)(response.body.assignedTo).toBe(adminUser.id);
        });
        (0, globals_1.it)('should allow admin to delete any bug', async () => {
            const adminBug = createdBugs.find(bug => bug.createdBy === adminUser.id);
            await adminAgent
                .delete(`/api/bugs/${adminBug.id}`)
                .expect(204);
            // Verify bug is deleted
            await adminAgent
                .get(`/api/bugs/${adminBug.id}`)
                .expect(404);
        });
    });
    (0, globals_1.describe)('Regular User Access Control', () => {
        (0, globals_1.it)('should only show user1 their own bugs', async () => {
            const response = await user1Agent
                .get('/api/bugs')
                .expect(200);
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
            (0, globals_1.expect)(response.body).toHaveLength(2); // Only user1's 2 bugs
            // Verify all returned bugs belong to user1
            response.body.forEach((bug) => {
                (0, globals_1.expect)(bug.createdBy).toBe(user1.id);
            });
        });
        (0, globals_1.it)('should only show user2 their own bugs', async () => {
            const response = await user2Agent
                .get('/api/bugs')
                .expect(200);
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
            (0, globals_1.expect)(response.body).toHaveLength(1); // Only user2's 1 bug
            // Verify returned bug belongs to user2
            (0, globals_1.expect)(response.body[0].createdBy).toBe(user2.id);
        });
        (0, globals_1.it)('should deny user1 access to user2 bugs', async () => {
            const user2Bug = createdBugs.find(bug => bug.createdBy === user2.id);
            await user1Agent
                .get(`/api/bugs/${user2Bug.id}`)
                .expect(404); // Returns 404 for access denied
        });
        (0, globals_1.it)('should deny user2 access to user1 bugs', async () => {
            const user1Bug = createdBugs.find(bug => bug.createdBy === user1.id);
            await user2Agent
                .get(`/api/bugs/${user1Bug.id}`)
                .expect(404); // Returns 404 for access denied
        });
        (0, globals_1.it)('should allow users to update their own bugs', async () => {
            const user1Bug = createdBugs.find(bug => bug.createdBy === user1.id);
            const response = await user1Agent
                .patch(`/api/bugs/${user1Bug.id}`)
                .send({
                priority: 'high',
                reproductionSteps: 'Updated steps'
            })
                .expect(200);
            (0, globals_1.expect)(response.body.priority).toBe('high');
            (0, globals_1.expect)(response.body.reproductionSteps).toBe('Updated steps');
        });
        (0, globals_1.it)('should deny users access to update other users bugs', async () => {
            const user2Bug = createdBugs.find(bug => bug.createdBy === user2.id);
            await user1Agent
                .patch(`/api/bugs/${user2Bug.id}`)
                .send({
                priority: 'high'
            })
                .expect(404); // Access denied
        });
    });
    (0, globals_1.describe)('Server-Side Filtering Logic', () => {
        (0, globals_1.it)('should properly filter bugs based on user role in storage layer', async () => {
            // Test the actual storage method directly
            const adminBugs = await mockStorage.getBugsForUser(adminUser.id, 'admin');
            const user1Bugs = await mockStorage.getBugsForUser(user1.id, 'resident');
            const user2Bugs = await mockStorage.getBugsForUser(user2.id, 'resident');
            (0, globals_1.expect)(adminBugs).toHaveLength(4); // Admin sees all
            (0, globals_1.expect)(user1Bugs).toHaveLength(2); // User1 sees only their own
            (0, globals_1.expect)(user2Bugs).toHaveLength(1); // User2 sees only their own
            // Verify content
            user1Bugs.forEach(bug => (0, globals_1.expect)(bug.createdBy).toBe(user1.id));
            user2Bugs.forEach(bug => (0, globals_1.expect)(bug.createdBy).toBe(user2.id));
        });
        (0, globals_1.it)('should handle manager role appropriately', async () => {
            const managerUser = await (0, test_utils_1.createTestUser)({
                email: 'manager@test.com',
                role: 'manager',
                firstName: 'Manager',
                lastName: 'User',
                organizationId: 'test-org'
            });
            const managerBugs = await mockStorage.getBugsForUser(managerUser.id, 'manager', 'test-org');
            // Managers can see all bugs (or organization-specific based on implementation)
            (0, globals_1.expect)(managerBugs.length).toBeGreaterThanOrEqual(0);
        });
    });
    (0, globals_1.describe)('Bug Creation Access Control', () => {
        (0, globals_1.it)('should allow any authenticated user to create bugs', async () => {
            const newBug = {
                title: 'New User Bug',
                description: 'New bug description',
                category: 'functionality',
                page: '/new-page',
                priority: 'medium',
                reproductionSteps: 'Steps to reproduce'
            };
            const response = await user1Agent
                .post('/api/bugs')
                .send(newBug)
                .expect(201);
            (0, globals_1.expect)(response.body.title).toBe(newBug.title);
            (0, globals_1.expect)(response.body.createdBy).toBe(user1.id);
            (0, globals_1.expect)(response.body.status).toBe('new');
        });
        (0, globals_1.it)('should deny unauthenticated users from creating bugs', async () => {
            const newBug = {
                title: 'Unauthorized Bug',
                description: 'Should not be created',
                category: 'functionality',
                page: '/page',
                priority: 'medium'
            };
            await (0, supertest_1.default)(app)
                .post('/api/bugs')
                .send(newBug)
                .expect(401);
        });
    });
    (0, globals_1.describe)('Authentication Requirements', () => {
        (0, globals_1.it)('should require authentication for all bug endpoints', async () => {
            const endpoints = [
                { method: 'get', path: '/api/bugs' },
                { method: 'post', path: '/api/bugs' },
                { method: 'get', path: `/api/bugs/${createdBugs[0].id}` },
                { method: 'patch', path: `/api/bugs/${createdBugs[0].id}` },
                { method: 'delete', path: `/api/bugs/${createdBugs[0].id}` },
            ];
            for (const endpoint of endpoints) {
                await (0, supertest_1.default)(app)[endpoint.method](endpoint.path)
                    .expect(401);
            }
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should handle invalid bug IDs gracefully', async () => {
            await adminAgent
                .get('/api/bugs/invalid-id')
                .expect(404);
        });
        (0, globals_1.it)('should handle malformed bug data gracefully', async () => {
            const response = await user1Agent
                .post('/api/bugs')
                .send({
                // Missing required fields
                title: '',
                description: 'short' // Too short
            })
                .expect(400);
            (0, globals_1.expect)(response.body.error).toBe('Validation failed');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9idWctcmVwb3J0cy1yYmFjLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7R0FTRzs7Ozs7QUFFSCwyQ0FBa0Y7QUFDbEYsMERBQWdDO0FBQ2hDLHNEQUE4QjtBQUM5QixzRUFBc0M7QUFDdEMsZ0RBQTBEO0FBQzFELGtEQUFrRDtBQUNsRCxvREFBcUQ7QUFHckQsZUFBZTtBQUNmLElBQUksV0FBdUIsQ0FBQztBQUU1QiwwQkFBMEI7QUFDMUIsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFO0lBQ3pCLE1BQU0sR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO0lBRXRCLG1CQUFtQjtJQUNuQixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUVoRCx3Q0FBd0M7SUFDeEMsR0FBRyxDQUFDLEdBQUcsQ0FDTCxJQUFBLHlCQUFPLEVBQUM7UUFDTixNQUFNLEVBQUUsYUFBYTtRQUNyQixNQUFNLEVBQUUsS0FBSztRQUNiLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxFQUFFO0tBQ3ZELENBQUMsQ0FDSCxDQUFDO0lBRUYsdUJBQXVCO0lBQ3ZCLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFRLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO1FBQzlCLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUN0QixHQUFHLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1FBQzlCLENBQUM7UUFD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SUFBQSxtQkFBTyxFQUFDLEdBQUcsQ0FBQyxDQUNmLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDO3FCQUMvQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDakIsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLElBQUEsWUFBRSxFQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hELE1BQU0sVUFBVTtpQkFDYixHQUFHLENBQUMsc0JBQXNCLENBQUM7aUJBQzNCLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNqQixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLDZDQUE2QyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzNELE1BQU0sUUFBUSxHQUFHLE1BQU0sVUFBVTtpQkFDOUIsSUFBSSxDQUFDLFdBQVcsQ0FBQztpQkFDakIsSUFBSSxDQUFDO2dCQUNKLDBCQUEwQjtnQkFDMUIsS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsV0FBVyxFQUFFLE9BQU8sQ0FBQyxZQUFZO2FBQ2xDLENBQUM7aUJBQ0QsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBRWYsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvaW50ZWdyYXRpb24vYnVnLXJlcG9ydHMtcmJhYy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW50ZWdyYXRpb24gVGVzdHMgZm9yIEJ1ZyBSZXBvcnRzIFJvbGUtQmFzZWQgQWNjZXNzIENvbnRyb2xcbiAqIFxuICogVGVzdHMgY292ZXIgdGhlIGZpeCBmb3IgcmVkdW5kYW50IGNsaWVudC1zaWRlIGZpbHRlcmluZyB0aGF0IHByZXZlbnRlZFxuICogYWRtaW5zIGZyb20gc2VlaW5nIGFsbCBidWdzLiBOb3cgcHJvcGVybHkgdGVzdHM6XG4gKiAtIEFkbWluIHVzZXJzIGNhbiBzZWUgYWxsIGJ1ZyByZXBvcnRzXG4gKiAtIFJlZ3VsYXIgdXNlcnMgY2FuIG9ubHkgc2VlIHRoZWlyIG93biBidWcgcmVwb3J0c1xuICogLSBTZXJ2ZXItc2lkZSBhY2Nlc3MgY29udHJvbCB3b3JrcyBjb3JyZWN0bHlcbiAqIC0gQ2xpZW50LXNpZGUgZmlsdGVyaW5nIG9ubHkgYXBwbGllcyB0byBzZWFyY2gvc3RhdHVzL3ByaW9yaXR5XG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCwgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHNlc3Npb24gZnJvbSAnZXhwcmVzcy1zZXNzaW9uJztcbmltcG9ydCB7IHJlZ2lzdGVyQnVnUm91dGVzIH0gZnJvbSAnLi4vLi4vc2VydmVyL2FwaS9idWdzJztcbmltcG9ydCB7IE1lbVN0b3JhZ2UgfSBmcm9tICcuLi8uLi9zZXJ2ZXIvc3RvcmFnZSc7XG5pbXBvcnQgeyBjcmVhdGVUZXN0VXNlciB9IGZyb20gJy4uL3V0aWxzL3Rlc3QtdXRpbHMnO1xuaW1wb3J0IHR5cGUgeyBCdWcsIEluc2VydEJ1ZyB9IGZyb20gJy4uLy4uL3NoYXJlZC9zY2hlbWEnO1xuXG4vLyBNb2NrIHN0b3JhZ2VcbmxldCBtb2NrU3RvcmFnZTogTWVtU3RvcmFnZTtcblxuLy8gQ3JlYXRlIHRlc3QgRXhwcmVzcyBhcHBcbmNvbnN0IGNyZWF0ZVRlc3RBcHAgPSAoKSA9PiB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgXG4gIC8vIFNldHVwIG1pZGRsZXdhcmVcbiAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gIGFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuICBcbiAgLy8gU2Vzc2lvbiBtaWRkbGV3YXJlIGZvciBhdXRoZW50aWNhdGlvblxuICBhcHAudXNlKFxuICAgIHNlc3Npb24oe1xuICAgICAgc2VjcmV0OiAndGVzdC1zZWNyZXQnLFxuICAgICAgcmVzYXZlOiBmYWxzZSxcbiAgICAgIHNhdmVVbmluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgIGNvb2tpZTogeyBzZWN1cmU6IGZhbHNlLCBtYXhBZ2U6IDI0ICogNjAgKiA2MCAqIDEwMDAgfSxcbiAgICB9KVxuICApO1xuICBcbiAgLy8gTW9jayBhdXRoIG1pZGRsZXdhcmVcbiAgYXBwLnVzZSgocmVxOiBhbnksIHJlcywgbmV4dCkgPT4ge1xuICAgIGlmIChyZXEuc2Vzc2lvbj8udXNlcikge1xuICAgICAgcmVxLnVzZXIgPSByZXEuc2Vzc2lvbi51c2VyO1xuICAgIH1cbiAgICBuZXh0KCk7XG4gIH0pO1xuICBcbiAgLy8gUmVnaXN0ZXIgYnVnIHJvdXRlc1xuICByZWdpc3RlckJ1Z1JvdXRlcyhhcHApO1xuICBcbiAgcmV0dXJuIGFwcDtcbn07XG5cbmRlc2NyaWJlKCdCdWcgUmVwb3J0cyBSb2xlLUJhc2VkIEFjY2VzcyBDb250cm9sJywgKCkgPT4ge1xuICBsZXQgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uO1xuICBsZXQgYWRtaW5Vc2VyOiBhbnk7XG4gIGxldCB1c2VyMTogYW55O1xuICBsZXQgdXNlcjI6IGFueTtcbiAgbGV0IGFkbWluQWdlbnQ6IHJlcXVlc3QuU3VwZXJBZ2VudFRlc3Q7XG4gIGxldCB1c2VyMUFnZW50OiByZXF1ZXN0LlN1cGVyQWdlbnRUZXN0O1xuICBsZXQgdXNlcjJBZ2VudDogcmVxdWVzdC5TdXBlckFnZW50VGVzdDtcbiAgbGV0IGNyZWF0ZWRCdWdzOiBCdWdbXSA9IFtdO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIEluaXRpYWxpemUgbW9jayBzdG9yYWdlXG4gICAgbW9ja1N0b3JhZ2UgPSBuZXcgTWVtU3RvcmFnZSgpO1xuICAgIFxuICAgIC8vIE1vY2sgdGhlIHN0b3JhZ2UgbW9kdWxlXG4gICAgamVzdC5kb01vY2soJy4uLy4uL3NlcnZlci9zdG9yYWdlJywgKCkgPT4gKHtcbiAgICAgIHN0b3JhZ2U6IG1vY2tTdG9yYWdlXG4gICAgfSkpO1xuICAgIFxuICAgIGFwcCA9IGNyZWF0ZVRlc3RBcHAoKTtcbiAgICBcbiAgICAvLyBDcmVhdGUgdGVzdCB1c2Vyc1xuICAgIGFkbWluVXNlciA9IGF3YWl0IGNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgIGZpcnN0TmFtZTogJ0FkbWluJyxcbiAgICAgIGxhc3ROYW1lOiAnVXNlcidcbiAgICB9KTtcbiAgICBcbiAgICB1c2VyMSA9IGF3YWl0IGNyZWF0ZVRlc3RVc2VyKHtcbiAgICAgIGVtYWlsOiAndXNlcjFAdGVzdC5jb20nLFxuICAgICAgcm9sZTogJ3Jlc2lkZW50JyxcbiAgICAgIGZpcnN0TmFtZTogJ1VzZXInLFxuICAgICAgbGFzdE5hbWU6ICdPbmUnXG4gICAgfSk7XG4gICAgXG4gICAgdXNlcjIgPSBhd2FpdCBjcmVhdGVUZXN0VXNlcih7XG4gICAgICBlbWFpbDogJ3VzZXIyQHRlc3QuY29tJyxcbiAgICAgIHJvbGU6ICdyZXNpZGVudCcsXG4gICAgICBmaXJzdE5hbWU6ICdVc2VyJyxcbiAgICAgIGxhc3ROYW1lOiAnVHdvJ1xuICAgIH0pO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhdXRoZW50aWNhdGVkIGFnZW50c1xuICAgIGFkbWluQWdlbnQgPSByZXF1ZXN0LmFnZW50KGFwcCk7XG4gICAgdXNlcjFBZ2VudCA9IHJlcXVlc3QuYWdlbnQoYXBwKTtcbiAgICB1c2VyMkFnZW50ID0gcmVxdWVzdC5hZ2VudChhcHApO1xuICAgIFxuICAgIC8vIE1vY2sgc2Vzc2lvbnMgZm9yIGVhY2ggYWdlbnRcbiAgICBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAucG9zdCgnL21vY2stbG9naW4nKVxuICAgICAgLnNlbmQoYWRtaW5Vc2VyKTtcbiAgICAgIFxuICAgIGF3YWl0IHVzZXIxQWdlbnRcbiAgICAgIC5wb3N0KCcvbW9jay1sb2dpbicpXG4gICAgICAuc2VuZCh1c2VyMSk7XG4gICAgICBcbiAgICBhd2FpdCB1c2VyMkFnZW50XG4gICAgICAucG9zdCgnL21vY2stbG9naW4nKVxuICAgICAgLnNlbmQodXNlcjIpO1xuICAgICAgXG4gICAgLy8gQ3JlYXRlIHRlc3QgYnVnc1xuICAgIGNvbnN0IGJ1Z3MgPSBbXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnQWRtaW4gQnVnIDEnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0J1ZyBjcmVhdGVkIGJ5IGFkbWluJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdmdW5jdGlvbmFsaXR5JyBhcyBjb25zdCxcbiAgICAgICAgcGFnZTogJy9hZG1pbi9kYXNoYm9hcmQnLFxuICAgICAgICBwcmlvcml0eTogJ2hpZ2gnIGFzIGNvbnN0LFxuICAgICAgICBjcmVhdGVkQnk6IGFkbWluVXNlci5pZCxcbiAgICAgICAgcmVwcm9kdWN0aW9uU3RlcHM6ICdTdGVwIDEsIFN0ZXAgMicsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ1VzZXIxIEJ1ZyAxJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdCdWcgY3JlYXRlZCBieSB1c2VyMScsXG4gICAgICAgIGNhdGVnb3J5OiAndWlfdXgnIGFzIGNvbnN0LFxuICAgICAgICBwYWdlOiAnL2Rhc2hib2FyZCcsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyBhcyBjb25zdCxcbiAgICAgICAgY3JlYXRlZEJ5OiB1c2VyMS5pZCxcbiAgICAgICAgcmVwcm9kdWN0aW9uU3RlcHM6ICdVc2VyMSBzdGVwcycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ1VzZXIxIEJ1ZyAyJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdBbm90aGVyIGJ1ZyBieSB1c2VyMScsXG4gICAgICAgIGNhdGVnb3J5OiAncGVyZm9ybWFuY2UnIGFzIGNvbnN0LFxuICAgICAgICBwYWdlOiAnL2RvY3VtZW50cycsXG4gICAgICAgIHByaW9yaXR5OiAnbG93JyBhcyBjb25zdCxcbiAgICAgICAgY3JlYXRlZEJ5OiB1c2VyMS5pZCxcbiAgICAgICAgcmVwcm9kdWN0aW9uU3RlcHM6ICdQZXJmb3JtYW5jZSBpc3N1ZSBzdGVwcycsXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ1VzZXIyIEJ1ZyAxJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdCdWcgY3JlYXRlZCBieSB1c2VyMicsXG4gICAgICAgIGNhdGVnb3J5OiAnc2VjdXJpdHknIGFzIGNvbnN0LFxuICAgICAgICBwYWdlOiAnL3NldHRpbmdzJyxcbiAgICAgICAgcHJpb3JpdHk6ICdjcml0aWNhbCcgYXMgY29uc3QsXG4gICAgICAgIGNyZWF0ZWRCeTogdXNlcjIuaWQsXG4gICAgICAgIHJlcHJvZHVjdGlvblN0ZXBzOiAnU2VjdXJpdHkgYnVnIHN0ZXBzJyxcbiAgICAgIH0sXG4gICAgXTtcbiAgICBcbiAgICAvLyBDcmVhdGUgYnVncyBpbiBzdG9yYWdlXG4gICAgZm9yIChjb25zdCBidWdEYXRhIG9mIGJ1Z3MpIHtcbiAgICAgIGNvbnN0IGNyZWF0ZWQgPSBhd2FpdCBtb2NrU3RvcmFnZS5jcmVhdGVCdWcoYnVnRGF0YSBhcyBJbnNlcnRCdWcpO1xuICAgICAgY3JlYXRlZEJ1Z3MucHVzaChjcmVhdGVkKTtcbiAgICB9XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC5yZXNldE1vZHVsZXMoKTtcbiAgICBjcmVhdGVkQnVncyA9IFtdO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWRtaW4gQWNjZXNzIENvbnRyb2wnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBzZWUgYWxsIGJ1Z3MgZnJvbSBhbGwgdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9idWdzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZUxlbmd0aCg0KTsgLy8gQWxsIDQgYnVnc1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgYWRtaW4gY2FuIHNlZSBidWdzIGZyb20gYWxsIHVzZXJzXG4gICAgICBjb25zdCBjcmVhdG9ySWRzID0gcmVzcG9uc2UuYm9keS5tYXAoKGJ1ZzogQnVnKSA9PiBidWcuY3JlYXRlZEJ5KTtcbiAgICAgIGV4cGVjdChjcmVhdG9ySWRzKS50b0NvbnRhaW4oYWRtaW5Vc2VyLmlkKTtcbiAgICAgIGV4cGVjdChjcmVhdG9ySWRzKS50b0NvbnRhaW4odXNlcjEuaWQpO1xuICAgICAgZXhwZWN0KGNyZWF0b3JJZHMpLnRvQ29udGFpbih1c2VyMi5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIGFjY2VzcyBhbnkgc3BlY2lmaWMgYnVnJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCBhY2Nlc3NpbmcgdXNlcjEncyBidWdcbiAgICAgIGNvbnN0IHVzZXIxQnVnID0gY3JlYXRlZEJ1Z3MuZmluZChidWcgPT4gYnVnLmNyZWF0ZWRCeSA9PT0gdXNlcjEuaWQpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoYC9hcGkvYnVncy8ke3VzZXIxQnVnIS5pZH1gKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG4gICAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuaWQpLnRvQmUodXNlcjFCdWchLmlkKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmNyZWF0ZWRCeSkudG9CZSh1c2VyMS5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIHVwZGF0ZSBhbnkgYnVnJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcjJCdWcgPSBjcmVhdGVkQnVncy5maW5kKGJ1ZyA9PiBidWcuY3JlYXRlZEJ5ID09PSB1c2VyMi5pZCk7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLnBhdGNoKGAvYXBpL2J1Z3MvJHt1c2VyMkJ1ZyEuaWR9YClcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIHN0YXR1czogJ2luX3Byb2dyZXNzJyxcbiAgICAgICAgICBhc3NpZ25lZFRvOiBhZG1pblVzZXIuaWRcbiAgICAgICAgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN0YXR1cykudG9CZSgnaW5fcHJvZ3Jlc3MnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmFzc2lnbmVkVG8pLnRvQmUoYWRtaW5Vc2VyLmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgYWRtaW4gdG8gZGVsZXRlIGFueSBidWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBhZG1pbkJ1ZyA9IGNyZWF0ZWRCdWdzLmZpbmQoYnVnID0+IGJ1Zy5jcmVhdGVkQnkgPT09IGFkbWluVXNlci5pZCk7XG4gICAgICBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5kZWxldGUoYC9hcGkvYnVncy8ke2FkbWluQnVnIS5pZH1gKVxuICAgICAgICAuZXhwZWN0KDIwNCk7XG4gICAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGJ1ZyBpcyBkZWxldGVkXG4gICAgICBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoYC9hcGkvYnVncy8ke2FkbWluQnVnIS5pZH1gKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdSZWd1bGFyIFVzZXIgQWNjZXNzIENvbnRyb2wnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBvbmx5IHNob3cgdXNlcjEgdGhlaXIgb3duIGJ1Z3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHVzZXIxQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9idWdzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZUxlbmd0aCgyKTsgLy8gT25seSB1c2VyMSdzIDIgYnVnc1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgYWxsIHJldHVybmVkIGJ1Z3MgYmVsb25nIHRvIHVzZXIxXG4gICAgICByZXNwb25zZS5ib2R5LmZvckVhY2goKGJ1ZzogQnVnKSA9PiB7XG4gICAgICAgIGV4cGVjdChidWcuY3JlYXRlZEJ5KS50b0JlKHVzZXIxLmlkKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBvbmx5IHNob3cgdXNlcjIgdGhlaXIgb3duIGJ1Z3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHVzZXIyQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9idWdzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZUxlbmd0aCgxKTsgLy8gT25seSB1c2VyMidzIDEgYnVnXG4gICAgICBcbiAgICAgIC8vIFZlcmlmeSByZXR1cm5lZCBidWcgYmVsb25ncyB0byB1c2VyMlxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHlbMF0uY3JlYXRlZEJ5KS50b0JlKHVzZXIyLmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSB1c2VyMSBhY2Nlc3MgdG8gdXNlcjIgYnVncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIyQnVnID0gY3JlYXRlZEJ1Z3MuZmluZChidWcgPT4gYnVnLmNyZWF0ZWRCeSA9PT0gdXNlcjIuaWQpO1xuICAgICAgYXdhaXQgdXNlcjFBZ2VudFxuICAgICAgICAuZ2V0KGAvYXBpL2J1Z3MvJHt1c2VyMkJ1ZyEuaWR9YClcbiAgICAgICAgLmV4cGVjdCg0MDQpOyAvLyBSZXR1cm5zIDQwNCBmb3IgYWNjZXNzIGRlbmllZFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IHVzZXIyIGFjY2VzcyB0byB1c2VyMSBidWdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdXNlcjFCdWcgPSBjcmVhdGVkQnVncy5maW5kKGJ1ZyA9PiBidWcuY3JlYXRlZEJ5ID09PSB1c2VyMS5pZCk7XG4gICAgICBhd2FpdCB1c2VyMkFnZW50XG4gICAgICAgIC5nZXQoYC9hcGkvYnVncy8ke3VzZXIxQnVnIS5pZH1gKVxuICAgICAgICAuZXhwZWN0KDQwNCk7IC8vIFJldHVybnMgNDA0IGZvciBhY2Nlc3MgZGVuaWVkXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHVzZXJzIHRvIHVwZGF0ZSB0aGVpciBvd24gYnVncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIxQnVnID0gY3JlYXRlZEJ1Z3MuZmluZChidWcgPT4gYnVnLmNyZWF0ZWRCeSA9PT0gdXNlcjEuaWQpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCB1c2VyMUFnZW50XG4gICAgICAgIC5wYXRjaChgL2FwaS9idWdzLyR7dXNlcjFCdWchLmlkfWApXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgICAgIHJlcHJvZHVjdGlvblN0ZXBzOiAnVXBkYXRlZCBzdGVwcydcbiAgICAgICAgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnByaW9yaXR5KS50b0JlKCdoaWdoJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5yZXByb2R1Y3Rpb25TdGVwcykudG9CZSgnVXBkYXRlZCBzdGVwcycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IHVzZXJzIGFjY2VzcyB0byB1cGRhdGUgb3RoZXIgdXNlcnMgYnVncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXIyQnVnID0gY3JlYXRlZEJ1Z3MuZmluZChidWcgPT4gYnVnLmNyZWF0ZWRCeSA9PT0gdXNlcjIuaWQpO1xuICAgICAgYXdhaXQgdXNlcjFBZ2VudFxuICAgICAgICAucGF0Y2goYC9hcGkvYnVncy8ke3VzZXIyQnVnIS5pZH1gKVxuICAgICAgICAuc2VuZCh7XG4gICAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgICB9KVxuICAgICAgICAuZXhwZWN0KDQwNCk7IC8vIEFjY2VzcyBkZW5pZWRcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlcnZlci1TaWRlIEZpbHRlcmluZyBMb2dpYycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGZpbHRlciBidWdzIGJhc2VkIG9uIHVzZXIgcm9sZSBpbiBzdG9yYWdlIGxheWVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGUgYWN0dWFsIHN0b3JhZ2UgbWV0aG9kIGRpcmVjdGx5XG4gICAgICBjb25zdCBhZG1pbkJ1Z3MgPSBhd2FpdCBtb2NrU3RvcmFnZS5nZXRCdWdzRm9yVXNlcihhZG1pblVzZXIuaWQsICdhZG1pbicpO1xuICAgICAgY29uc3QgdXNlcjFCdWdzID0gYXdhaXQgbW9ja1N0b3JhZ2UuZ2V0QnVnc0ZvclVzZXIodXNlcjEuaWQsICdyZXNpZGVudCcpO1xuICAgICAgY29uc3QgdXNlcjJCdWdzID0gYXdhaXQgbW9ja1N0b3JhZ2UuZ2V0QnVnc0ZvclVzZXIodXNlcjIuaWQsICdyZXNpZGVudCcpO1xuICAgICAgXG4gICAgICBleHBlY3QoYWRtaW5CdWdzKS50b0hhdmVMZW5ndGgoNCk7IC8vIEFkbWluIHNlZXMgYWxsXG4gICAgICBleHBlY3QodXNlcjFCdWdzKS50b0hhdmVMZW5ndGgoMik7IC8vIFVzZXIxIHNlZXMgb25seSB0aGVpciBvd25cbiAgICAgIGV4cGVjdCh1c2VyMkJ1Z3MpLnRvSGF2ZUxlbmd0aCgxKTsgLy8gVXNlcjIgc2VlcyBvbmx5IHRoZWlyIG93blxuICAgICAgXG4gICAgICAvLyBWZXJpZnkgY29udGVudFxuICAgICAgdXNlcjFCdWdzLmZvckVhY2goYnVnID0+IGV4cGVjdChidWcuY3JlYXRlZEJ5KS50b0JlKHVzZXIxLmlkKSk7XG4gICAgICB1c2VyMkJ1Z3MuZm9yRWFjaChidWcgPT4gZXhwZWN0KGJ1Zy5jcmVhdGVkQnkpLnRvQmUodXNlcjIuaWQpKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1hbmFnZXIgcm9sZSBhcHByb3ByaWF0ZWx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbWFuYWdlclVzZXIgPSBhd2FpdCBjcmVhdGVUZXN0VXNlcih7XG4gICAgICAgIGVtYWlsOiAnbWFuYWdlckB0ZXN0LmNvbScsXG4gICAgICAgIHJvbGU6ICdtYW5hZ2VyJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnTWFuYWdlcicsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiAndGVzdC1vcmcnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgbWFuYWdlckJ1Z3MgPSBhd2FpdCBtb2NrU3RvcmFnZS5nZXRCdWdzRm9yVXNlcihcbiAgICAgICAgbWFuYWdlclVzZXIuaWQsIFxuICAgICAgICAnbWFuYWdlcicsIFxuICAgICAgICAndGVzdC1vcmcnXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBNYW5hZ2VycyBjYW4gc2VlIGFsbCBidWdzIChvciBvcmdhbml6YXRpb24tc3BlY2lmaWMgYmFzZWQgb24gaW1wbGVtZW50YXRpb24pXG4gICAgICBleHBlY3QobWFuYWdlckJ1Z3MubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQnVnIENyZWF0aW9uIEFjY2VzcyBDb250cm9sJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxsb3cgYW55IGF1dGhlbnRpY2F0ZWQgdXNlciB0byBjcmVhdGUgYnVncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5ld0J1ZyA9IHtcbiAgICAgICAgdGl0bGU6ICdOZXcgVXNlciBCdWcnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ05ldyBidWcgZGVzY3JpcHRpb24nLFxuICAgICAgICBjYXRlZ29yeTogJ2Z1bmN0aW9uYWxpdHknLFxuICAgICAgICBwYWdlOiAnL25ldy1wYWdlJyxcbiAgICAgICAgcHJpb3JpdHk6ICdtZWRpdW0nLFxuICAgICAgICByZXByb2R1Y3Rpb25TdGVwczogJ1N0ZXBzIHRvIHJlcHJvZHVjZSdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdXNlcjFBZ2VudFxuICAgICAgICAucG9zdCgnL2FwaS9idWdzJylcbiAgICAgICAgLnNlbmQobmV3QnVnKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG4gICAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkudGl0bGUpLnRvQmUobmV3QnVnLnRpdGxlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmNyZWF0ZWRCeSkudG9CZSh1c2VyMS5pZCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ25ldycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IHVuYXV0aGVudGljYXRlZCB1c2VycyBmcm9tIGNyZWF0aW5nIGJ1Z3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBuZXdCdWcgPSB7XG4gICAgICAgIHRpdGxlOiAnVW5hdXRob3JpemVkIEJ1ZycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnU2hvdWxkIG5vdCBiZSBjcmVhdGVkJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdmdW5jdGlvbmFsaXR5JyxcbiAgICAgICAgcGFnZTogJy9wYWdlJyxcbiAgICAgICAgcHJpb3JpdHk6ICdtZWRpdW0nXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvYnVncycpXG4gICAgICAgIC5zZW5kKG5ld0J1ZylcbiAgICAgICAgLmV4cGVjdCg0MDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQXV0aGVudGljYXRpb24gUmVxdWlyZW1lbnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiBmb3IgYWxsIGJ1ZyBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBbXG4gICAgICAgIHsgbWV0aG9kOiAnZ2V0JywgcGF0aDogJy9hcGkvYnVncycgfSxcbiAgICAgICAgeyBtZXRob2Q6ICdwb3N0JywgcGF0aDogJy9hcGkvYnVncycgfSxcbiAgICAgICAgeyBtZXRob2Q6ICdnZXQnLCBwYXRoOiBgL2FwaS9idWdzLyR7Y3JlYXRlZEJ1Z3NbMF0uaWR9YCB9LFxuICAgICAgICB7IG1ldGhvZDogJ3BhdGNoJywgcGF0aDogYC9hcGkvYnVncy8ke2NyZWF0ZWRCdWdzWzBdLmlkfWAgfSxcbiAgICAgICAgeyBtZXRob2Q6ICdkZWxldGUnLCBwYXRoOiBgL2FwaS9idWdzLyR7Y3JlYXRlZEJ1Z3NbMF0uaWR9YCB9LFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBlbmRwb2ludCBvZiBlbmRwb2ludHMpIHtcbiAgICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgICAgW2VuZHBvaW50Lm1ldGhvZF0oZW5kcG9pbnQucGF0aClcbiAgICAgICAgICAuZXhwZWN0KDQwMSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZhbGlkIGJ1ZyBJRHMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9idWdzL2ludmFsaWQtaWQnKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBtYWxmb3JtZWQgYnVnIGRhdGEgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdXNlcjFBZ2VudFxuICAgICAgICAucG9zdCgnL2FwaS9idWdzJylcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIC8vIE1pc3NpbmcgcmVxdWlyZWQgZmllbGRzXG4gICAgICAgICAgdGl0bGU6ICcnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnc2hvcnQnIC8vIFRvbyBzaG9ydFxuICAgICAgICB9KVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmUoJ1ZhbGlkYXRpb24gZmFpbGVkJyk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9