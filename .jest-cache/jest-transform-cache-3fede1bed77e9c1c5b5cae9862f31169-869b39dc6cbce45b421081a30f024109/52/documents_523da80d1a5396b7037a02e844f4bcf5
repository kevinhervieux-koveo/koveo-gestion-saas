200b29785b177e0ebd13458cbcf6e99b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerDocumentRoutes = registerDocumentRoutes;
const auth_1 = require("../auth");
const storage_1 = require("../storage");
const schema_1 = require("../../shared/schema");
const zod_1 = require("zod");
const multer_1 = __importDefault(require("multer"));
const path_1 = __importDefault(require("path"));
const fs_1 = __importDefault(require("fs"));
const crypto_1 = __importDefault(require("crypto"));
const uuid_1 = require("uuid");
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
// Enhanced security configuration for file uploads
const SECURITY_CONFIG = {
    MAX_FILE_SIZE: 25 * 1024 * 1024, // Reduced to 25MB for better security
    MAX_FILES_PER_USER_PER_HOUR: 10, // Rate limiting
    ALLOWED_MIME_TYPES: [
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-excel',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'text/plain',
        'image/jpeg',
        'image/png',
        'image/gif'
    ],
    ALLOWED_EXTENSIONS: ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'jpg', 'jpeg', 'png', 'gif']
};
// Rate limiting storage for uploads
const uploadRateTracker = new Map();
// Enhanced file validation function
function validateFile(file) {
    if (!file)
        return { isValid: false, error: 'No file provided' };
    // Check file size
    if (file.size > SECURITY_CONFIG.MAX_FILE_SIZE) {
        return { isValid: false, error: `File size exceeds ${SECURITY_CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB limit` };
    }
    // Check MIME type
    if (!SECURITY_CONFIG.ALLOWED_MIME_TYPES.includes(file.mimetype)) {
        return { isValid: false, error: `File type ${file.mimetype} not allowed` };
    }
    // Check file extension
    const extension = path_1.default.extname(file.originalname).toLowerCase().substring(1);
    if (!SECURITY_CONFIG.ALLOWED_EXTENSIONS.includes(extension)) {
        return { isValid: false, error: `File extension .${extension} not allowed` };
    }
    // Check filename for path traversal attempts
    if (file.originalname.includes('..') || file.originalname.includes('/') || file.originalname.includes('\\')) {
        return { isValid: false, error: 'Invalid filename detected' };
    }
    return { isValid: true };
}
// Rate limiting function
function checkUploadRateLimit(userId) {
    const now = Date.now();
    const userUploads = uploadRateTracker.get(userId) || [];
    // Clean old uploads (older than 1 hour)
    const recentUploads = userUploads.filter((timestamp) => now - timestamp < 60 * 60 * 1000);
    if (recentUploads.length >= SECURITY_CONFIG.MAX_FILES_PER_USER_PER_HOUR) {
        return { allowed: false, error: 'Upload rate limit exceeded. Please try again later.' };
    }
    // Update tracker
    recentUploads.push(now);
    uploadRateTracker.set(userId, recentUploads);
    return { allowed: true };
}
// Configure multer for file uploads with enhanced security
const upload = (0, multer_1.default)({
    dest: '/tmp/uploads/',
    limits: {
        fileSize: SECURITY_CONFIG.MAX_FILE_SIZE,
        files: 1, // Only allow one file at a time
    },
    fileFilter: (req, file, cb) => {
        const validation = validateFile(file);
        if (validation.isValid) {
            cb(null, true);
        }
        else {
            cb(new Error(validation.error));
        }
    },
});
// DocumentRecord categories for validation - synchronized with frontend
const DOCUMENT_CATEGORIES = [
    'bylaw',
    'financial',
    'maintenance',
    'legal',
    'meeting_minutes',
    'insurance',
    'contracts',
    'permits',
    'inspection',
    'lease',
    'correspondence',
    'utilities',
    'other',
];
// Enhanced schemas for different document types
const createDocumentSchema = schema_1.insertDocumentSchema.extend({
    category: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255),
    description: zod_1.z.string().optional(),
    isVisibleToTenants: zod_1.z.boolean().default(false),
});
const createBuildingDocumentSchema = schema_1.insertDocumentSchema.extend({
    type: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255).optional(),
    description: zod_1.z.string().optional(),
});
const createResidentDocumentSchema = schema_1.insertDocumentSchema.extend({
    type: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255).optional(),
    description: zod_1.z.string().optional(),
});
// Schema for unified document upload
const uploadDocumentRecordSchema = zod_1.z.object({
    name: zod_1.z.string().min(1).max(255),
    description: zod_1.z.string().optional(),
    documentType: zod_1.z.enum(DOCUMENT_CATEGORIES),
    isVisibleToTenants: zod_1.z.boolean().default(false),
    residenceId: zod_1.z.string().uuid().optional(),
    buildingId: zod_1.z.string().uuid().optional(),
    attachedToType: zod_1.z.string().optional(),
    attachedToId: zod_1.z.string().optional(),
});
/**
 *
 * @param app
 */
/**
 * RegisterDocumentRecordRoutes function.
 * @param app
 * @returns Function result.
 */
function registerDocumentRoutes(app) {
    console.log(`[${new Date().toISOString()}] ðŸ”§ Registering document routes...`);
    // Security audit logging
    const auditLog = [];
    // Error tracking for production debugging
    const errorLog = [];
    // Enhanced security audit logging function with debug levels
    const logSecurityEvent = (action, user, success, documentId, details) => {
        const event = {
            timestamp: new Date().toISOString(),
            action,
            userId: user.id,
            userRole: user.role,
            documentId,
            success,
            details
        };
        auditLog.push(event);
        if (auditLog.length > 1000)
            auditLog.shift(); // Keep last 1000 events
        console.log(`[SECURITY AUDIT] ${action}:`, event);
        return event;
    };
    // Enhanced debug logging function for document operations
    const logDocumentOperation = (operation, data, level = 'INFO') => {
        const timestamp = new Date().toISOString();
        const logEntry = {
            timestamp,
            operation,
            level,
            data: typeof data === 'object' ? JSON.stringify(data, null, 2) : data
        };
        const emoji = {
            INFO: 'ðŸ“‹',
            ERROR: 'âŒ',
            DEBUG: 'ðŸ”',
            WARN: 'âš ï¸'
        }[level];
        console.log(`[${timestamp}] ${emoji} [DOCUMENT ${operation.toUpperCase()}] ${level}:`, data);
        return logEntry;
    };
    // Database connection testing functions
    const testDatabaseConnection = async () => {
        try {
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT 1 as test`);
            return {
                success: true,
                result: result.rows[0],
                url_truncated: process.env.DATABASE_URL?.substring(0, 50) + '...'
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message,
                url_truncated: process.env.DATABASE_URL?.substring(0, 50) + '...'
            };
        }
    };
    const testSampleQuery = async () => {
        try {
            // Test the exact query that's failing
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT COUNT(*) as document_count 
        FROM documents 
        LIMIT 1
      `);
            return {
                success: true,
                document_count: result.rows[0]?.document_count || 0
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message,
                stack: error.stack?.substring(0, 200) + '...'
            };
        }
    };
    const checkEnumValues = async () => {
        try {
            // Check current enum values in production
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT enumlabel 
        FROM pg_enum 
        WHERE enumtypid = (
          SELECT oid 
          FROM pg_type 
          WHERE typname = 'user_role'
        )
        ORDER BY enumsortorder
      `);
            return {
                success: true,
                production_enum_values: result.rows.map(row => row.enumlabel)
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    };
    const checkUserOrganizationLinks = async () => {
        try {
            // Check user-organization relationships
            const userCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM users WHERE is_active = true`);
            const orgCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM organizations WHERE is_active = true`);
            const linkCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM user_organizations WHERE is_active = true`);
            // Check users without organization links
            const orphanUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.id, u.email, u.role 
        FROM users u 
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true
        WHERE u.is_active = true AND uo.user_id IS NULL
        LIMIT 10
      `);
            // Check current test user specifically (from error logs)
            const testUser = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.email, u.role, uo.organization_id, o.name as org_name
        FROM users u
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true  
        LEFT JOIN organizations o ON uo.organization_id = o.id
        WHERE u.id = '222f5a0d-6bc6-4f28-9f4d-32c133eed333'
      `);
            return {
                success: true,
                stats: {
                    total_users: userCount.rows[0]?.total || 0,
                    total_organizations: orgCount.rows[0]?.total || 0,
                    total_links: linkCount.rows[0]?.total || 0,
                    orphan_user_count: orphanUsers.rows.length
                },
                orphan_users: orphanUsers.rows,
                test_user_status: testUser.rows[0] || null
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    };
    // Enum cleanup endpoint for safe schema migration  
    app.post('/api/documents/cleanup-enum', async (req, res) => {
        try {
            // First, verify no users have the 'owner' role
            const userCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT COUNT(*) as owner_count 
        FROM users 
        WHERE role = 'owner'
      `);
            const ownerCount = Number(userCheck.rows[0]?.owner_count) || 0;
            if (ownerCount > 0) {
                return res.status(400).json({
                    error: 'Cannot remove owner role - users still assigned to it',
                    owner_count: ownerCount
                });
            }
            // Safe to remove - no users have 'owner' role
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TYPE user_role DROP VALUE IF EXISTS 'owner'
      `);
            res.json({
                message: 'Successfully removed unused owner role',
                safe_to_push_schema: true,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error during enum cleanup:', error);
            res.status(500).json({
                error: 'Enum cleanup failed',
                message: error.message,
                suggestion: 'Try running npm run db:push --force instead'
            });
        }
    });
    // Fix user-organization relationships
    app.post('/api/documents/fix-user-links', async (req, res) => {
        try {
            // Step 1: Find users without organization links
            const orphanUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.id, u.email, u.role 
        FROM users u 
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true
        WHERE u.is_active = true AND uo.user_id IS NULL
      `);
            if (orphanUsers.rows.length === 0) {
                return res.json({
                    message: 'All users already have organization links',
                    action_taken: 'none',
                    timestamp: new Date().toISOString()
                });
            }
            // Step 2: Get the first available organization (or create default one)
            let defaultOrg = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT id, name FROM organizations WHERE is_active = true LIMIT 1
      `);
            let organizationId;
            let organizationName;
            if (defaultOrg.rows.length === 0) {
                // Create a default organization if none exists
                organizationId = crypto_1.default.randomUUID();
                organizationName = 'Default Organization';
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          INSERT INTO organizations (id, name, type, address, phone, email, is_active, created_at, updated_at)
          VALUES (${organizationId}, ${organizationName}, 'condominium', '123 Main St', '514-555-0100', 'admin@koveo.ca', true, NOW(), NOW())
        `);
            }
            else {
                organizationId = defaultOrg.rows[0].id;
                organizationName = defaultOrg.rows[0].name;
            }
            // Step 3: Link all orphan users to the default organization
            const linkPromises = orphanUsers.rows.map(user => {
                const linkId = crypto_1.default.randomUUID();
                return db_1.db.execute((0, drizzle_orm_1.sql) `
          INSERT INTO user_organizations (id, user_id, organization_id, role, is_active, created_at, updated_at)
          VALUES (${linkId}, ${user.id}, ${organizationId}, ${user.role}, true, NOW(), NOW())
        `);
            });
            await Promise.all(linkPromises);
            res.json({
                message: 'Successfully linked users to organizations',
                users_linked: orphanUsers.rows.length,
                organization_id: organizationId,
                organization_name: organizationName,
                linked_users: orphanUsers.rows.map(u => ({ id: u.id, email: u.email, role: u.role })),
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error fixing user-organization links:', error);
            res.status(500).json({
                error: 'Failed to fix user-organization links',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Safe enum migration endpoint
    app.post('/api/documents/fix-enum-migration', async (req, res) => {
        try {
            // Step 1: Check current enum values and usage
            const enumCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT enumlabel, enumsortorder 
        FROM pg_enum 
        WHERE enumtypid = (SELECT oid FROM pg_type WHERE typname = 'user_role')
        ORDER BY enumsortorder
      `);
            const currentEnumValues = enumCheck.rows.map(row => row.enumlabel);
            // Step 2: Check if we have any data that would prevent migration
            const userRoleUsage = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT role, COUNT(*) as count 
        FROM users 
        GROUP BY role
      `);
            // Step 3: Since enum reordering is the issue, let's use a different approach
            // We'll create a new enum with correct order, migrate data, then swap
            const targetEnumValues = ['admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident'];
            // Check if current order matches target
            const orderMatches = JSON.stringify(currentEnumValues) === JSON.stringify(targetEnumValues);
            if (orderMatches) {
                return res.json({
                    message: 'Enum values already in correct order',
                    current_values: currentEnumValues,
                    target_values: targetEnumValues,
                    migration_needed: false
                });
            }
            // Step 4: Create new enum with correct order
            await db_1.db.execute((0, drizzle_orm_1.sql) `CREATE TYPE user_role_new AS ENUM ('admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident')`);
            // Step 5: Update all tables to use new enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE users 
        ALTER COLUMN role TYPE user_role_new 
        USING role::text::user_role_new
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE user_organizations 
        ALTER COLUMN organization_role TYPE user_role_new 
        USING organization_role::text::user_role_new
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE role_permissions 
        ALTER COLUMN role TYPE user_role_new 
        USING role::text::user_role_new
      `);
            // Step 6: Drop old enum and rename new one
            await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role`);
            await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TYPE user_role_new RENAME TO user_role`);
            res.json({
                message: 'Successfully migrated user_role enum',
                old_values: currentEnumValues,
                new_values: targetEnumValues,
                user_role_usage: userRoleUsage.rows,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error during enum migration:', error);
            res.status(500).json({
                error: 'Enum migration failed',
                message: error.message,
                suggestion: 'This is a complex migration - may need manual intervention',
                timestamp: new Date().toISOString()
            });
        }
    });
    // Fix invitations table enum dependency
    app.post('/api/documents/fix-invitations-dependency', async (req, res) => {
        try {
            // Step 1: Check current invitations table structure
            const invitationsSchema = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT column_name, data_type, column_default
        FROM information_schema.columns 
        WHERE table_name = 'invitations' AND column_name = 'role'
      `);
            // Step 2: Remove default value from invitations.role column temporarily
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE invitations 
        ALTER COLUMN role DROP DEFAULT
      `);
            // Step 3: Check what other tables might have enum dependencies
            const enumDependencies = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT 
          t.table_name,
          c.column_name,
          c.column_default
        FROM information_schema.tables t
        JOIN information_schema.columns c ON t.table_name = c.table_name
        WHERE c.data_type = 'USER-DEFINED' 
        AND c.udt_name = 'user_role'
        AND c.column_default IS NOT NULL
      `);
            res.json({
                message: 'Successfully removed invitations table enum dependency',
                removed_defaults: invitationsSchema.rows,
                remaining_dependencies: enumDependencies.rows,
                next_step: 'Run npm run db:push now, then call /api/documents/restore-invitations-default',
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error fixing invitations dependency:', error);
            res.status(500).json({
                error: 'Failed to fix invitations dependency',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Restore invitations default value after schema sync
    app.post('/api/documents/restore-invitations-default', async (req, res) => {
        try {
            // Restore default value to 'tenant' for invitations.role column
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE invitations 
        ALTER COLUMN role SET DEFAULT 'tenant'
      `);
            // Verify the change
            const verification = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT column_name, column_default
        FROM information_schema.columns 
        WHERE table_name = 'invitations' AND column_name = 'role'
      `);
            res.json({
                message: 'Successfully restored invitations role default to tenant',
                current_default: verification.rows[0]?.column_default,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error restoring invitations default:', error);
            res.status(500).json({
                error: 'Failed to restore invitations default',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Migrate owner users to admin before enum cleanup
    app.post('/api/documents/migrate-owner-to-admin', async (req, res) => {
        try {
            // Step 1: Check how many users have 'owner' role
            const ownerUsersCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT id, email, first_name, last_name 
        FROM users 
        WHERE role = 'owner'
      `);
            const ownerCount = ownerUsersCheck.rows.length;
            if (ownerCount === 0) {
                return res.json({
                    message: 'No owner users found - migration not needed',
                    owner_count: 0,
                    timestamp: new Date().toISOString()
                });
            }
            // Step 2: Update all owner users to admin
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        UPDATE users 
        SET role = 'admin' 
        WHERE role = 'owner'
      `);
            // Step 3: Update user_organizations table if it exists
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          UPDATE user_organizations 
          SET organization_role = 'admin' 
          WHERE organization_role = 'owner'
        `);
            }
            catch (e) {
                // Table might not exist, that's OK
            }
            // Step 4: Remove 'owner' from enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TYPE user_role RENAME TO user_role_old
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        CREATE TYPE user_role AS ENUM ('admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident')
      `);
            // Step 5: Update all tables to use new enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE users 
        ALTER COLUMN role TYPE user_role 
        USING role::text::user_role
      `);
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role TYPE user_role 
          USING organization_role::text::user_role
        `);
            }
            catch (e) {
                // Table might not exist
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE role_permissions 
          ALTER COLUMN role TYPE user_role 
          USING role::text::user_role
        `);
            }
            catch (e) {
                // Table might not exist
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitations 
          ALTER COLUMN role TYPE user_role 
          USING role::text::user_role
        `);
            }
            catch (e) {
                // Column might not exist
            }
            // Step 6: Drop old enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role_old`);
            res.json({
                message: 'Successfully migrated owner users to admin',
                migrated_users: ownerUsersCheck.rows,
                owner_count: ownerCount,
                new_enum_values: ['admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident'],
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error migrating owner users to admin:', error);
            res.status(500).json({
                error: 'Owner to admin migration failed',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Remove all remaining enum dependencies
    app.post('/api/documents/remove-all-enum-dependencies', async (req, res) => {
        try {
            const results = [];
            // Remove default from users.role
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE users 
          ALTER COLUMN role DROP DEFAULT
        `);
                results.push('users.role default removed');
            }
            catch (e) {
                results.push(`users.role: ${e.message}`);
            }
            // Remove default from user_organizations.organization_role
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role DROP DEFAULT
        `);
                results.push('user_organizations.organization_role default removed');
            }
            catch (e) {
                results.push(`user_organizations.organization_role: ${e.message}`);
            }
            // Check remaining dependencies
            const remainingDeps = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT 
          t.table_name,
          c.column_name,
          c.column_default
        FROM information_schema.tables t
        JOIN information_schema.columns c ON t.table_name = c.table_name
        WHERE c.data_type = 'USER-DEFINED' 
        AND c.udt_name = 'user_role'
        AND c.column_default IS NOT NULL
      `);
            res.json({
                message: 'Removed all enum dependencies',
                operations: results,
                remaining_dependencies: remainingDeps.rows,
                next_step: 'Run npm run db:push now',
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error removing enum dependencies:', error);
            res.status(500).json({
                error: 'Failed to remove enum dependencies',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Restore all default values after schema sync
    app.post('/api/documents/restore-all-defaults', async (req, res) => {
        try {
            const results = [];
            // Restore users.role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE users 
          ALTER COLUMN role SET DEFAULT 'tenant'
        `);
                results.push('users.role default restored to tenant');
            }
            catch (e) {
                results.push(`users.role restore failed: ${e.message}`);
            }
            // Restore user_organizations.organization_role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role SET DEFAULT 'tenant'
        `);
                results.push('user_organizations.organization_role default restored to tenant');
            }
            catch (e) {
                results.push(`user_organizations.organization_role restore failed: ${e.message}`);
            }
            // Restore invitations.role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitations 
          ALTER COLUMN role SET DEFAULT 'tenant'
        `);
                results.push('invitations.role default restored to tenant');
            }
            catch (e) {
                results.push(`invitations.role restore failed: ${e.message}`);
            }
            res.json({
                message: 'Restored all default values',
                operations: results,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error restoring defaults:', error);
            res.status(500).json({
                error: 'Failed to restore defaults',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Complete database schema sync endpoint
    app.post('/api/documents/complete-schema-sync', async (req, res) => {
        try {
            const results = [];
            // Step 1: Remove all enum dependencies temporarily
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role DROP DEFAULT`);
                results.push('âœ“ Removed users.role default');
            }
            catch (e) {
                results.push(`users.role: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role DROP DEFAULT`);
                results.push('âœ“ Removed user_organizations.organization_role default');
            }
            catch (e) {
                results.push(`user_organizations.organization_role: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role DROP DEFAULT`);
                results.push('âœ“ Removed invitations.role default');
            }
            catch (e) {
                results.push(`invitations.role: ${e.message}`);
            }
            // Step 2: Migrate any 'owner' users to 'admin'
            const ownerUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT count(*) as count FROM users WHERE role = 'owner'`);
            const ownerCount = Number(ownerUsers.rows[0]?.count || 0);
            if (ownerCount > 0) {
                await db_1.db.execute((0, drizzle_orm_1.sql) `UPDATE users SET role = 'admin' WHERE role = 'owner'`);
                results.push(`âœ“ Migrated ${ownerCount} owner users to admin`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `UPDATE user_organizations SET organization_role = 'admin' WHERE organization_role = 'owner'`);
                results.push('âœ“ Updated user_organizations owner roles to admin');
            }
            catch (e) {
                results.push(`user_organizations owner update: ${e.message}`);
            }
            // Step 3: Fix the enum to match development schema
            try {
                // Rename current enum
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TYPE user_role RENAME TO user_role_old`);
                // Create new enum with correct values
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          CREATE TYPE user_role AS ENUM (
            'admin', 'manager', 'tenant', 'resident', 
            'demo_manager', 'demo_tenant', 'demo_resident'
          )
        `);
                // Update all tables
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role TYPE user_role USING organization_role::text::user_role`);
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                try {
                    await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE role_permissions ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                    results.push('âœ“ Updated role_permissions enum');
                }
                catch (e) {
                    results.push(`role_permissions: ${e.message}`);
                }
                // Drop old enum
                await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role_old`);
                results.push('âœ“ Successfully updated user_role enum');
            }
            catch (e) {
                results.push(`Enum update failed: ${e.message}`);
            }
            // Step 4: Restore default values
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored users.role default to tenant');
            }
            catch (e) {
                results.push(`users.role default restore: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored user_organizations.organization_role default to tenant');
            }
            catch (e) {
                results.push(`user_organizations.organization_role default restore: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored invitations.role default to tenant');
            }
            catch (e) {
                results.push(`invitations.role default restore: ${e.message}`);
            }
            // Step 5: Add missing columns that exist in production but not development
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitation_audit_log 
          ADD COLUMN IF NOT EXISTS created_at TIMESTAMP DEFAULT NOW()
        `);
                results.push('âœ“ Added created_at to invitation_audit_log');
            }
            catch (e) {
                results.push(`invitation_audit_log.created_at: ${e.message}`);
            }
            res.json({
                message: 'Database schema synchronization complete',
                operations: results,
                timestamp: new Date().toISOString(),
                success: true
            });
        }
        catch (error) {
            console.error('âŒ Error during schema synchronization:', error);
            res.status(500).json({
                error: 'Schema synchronization failed',
                message: error.message,
                timestamp: new Date().toISOString(),
                success: false
            });
        }
    });
    // Enhanced diagnostic endpoint with database schema check
    app.get('/api/documents/diagnostic', async (req, res) => {
        try {
            // Check if documents table exists
            let tableExists = false;
            let tableSchema = null;
            try {
                const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
          SELECT column_name, data_type, is_nullable, column_default 
          FROM information_schema.columns 
          WHERE table_name = 'documents' 
          ORDER BY ordinal_position
        `);
                tableExists = result.rows.length > 0;
                tableSchema = result.rows;
            }
            catch (schemaError) {
                console.error('Schema check error:', schemaError);
            }
            res.json({
                message: 'Document API diagnostic',
                gcs_disabled: true,
                session_fix_applied: true,
                timestamp: new Date().toISOString(),
                environment: process.env.NODE_ENV,
                version: 'v2.1-gcs-disabled',
                recent_errors: errorLog.slice(-5), // Last 5 errors
                storage_status: {
                    exists: !!storage_1.storage,
                    type: storage_1.storage?.constructor?.name,
                    methods: Object.getOwnPropertyNames(Object.getPrototypeOf(storage_1.storage || {}))
                },
                database_status: {
                    documents_table_exists: tableExists,
                    documents_table_schema: tableSchema,
                    schema_columns_count: tableSchema?.length || 0,
                    connection_test: await testDatabaseConnection(),
                    sample_query_test: await testSampleQuery(),
                    enum_check: await checkEnumValues(),
                    user_organization_links: await checkUserOrganizationLinks()
                }
            });
        }
        catch (error) {
            console.error('âŒ Error running diagnostic:', error);
            res.status(500).json({
                error: 'Diagnostic failed',
                message: error.message
            });
        }
    });
    // Error logging helper
    const logError = (endpoint, error, user) => {
        const errorEntry = {
            timestamp: new Date().toISOString(),
            endpoint,
            error: {
                message: error.message,
                stack: error.stack,
                name: error.name,
                details: error.toString()
            },
            user: user ? { id: user.id, role: user.role } : null
        };
        errorLog.push(errorEntry);
        if (errorLog.length > 50)
            errorLog.shift(); // Keep only last 50 errors
        console.error(`[${errorEntry.timestamp}] ðŸš¨ ERROR in ${endpoint}:`, errorEntry);
        return errorEntry;
    };
    // Get all documents for the authenticated user
    app.get('/api/documents', auth_1.requireAuth, async (req, res) => {
        const timestamp = new Date().toISOString();
        logDocumentOperation('LIST_REQUEST', {
            userId: req.user?.id,
            userRole: req.user?.role,
            query: req.query,
            url: req.url,
            method: req.method,
            headers: {
                contentType: req.headers['content-type'],
                userAgent: req.headers['user-agent'],
                referer: req.headers.referer
            }
        }, 'INFO');
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            // Enhanced user data logging
            logDocumentOperation('USER_VALIDATION', {
                userId,
                userRole,
                hasValidUser: !!user,
                sessionInfo: {
                    sessionExists: !!req.session,
                    isAuthenticated: !!req.user
                }
            }, 'DEBUG');
            // Critical storage validation with enhanced debugging
            logDocumentOperation('STORAGE_VALIDATION', {
                storageExists: !!storage_1.storage,
                storageType: storage_1.storage?.constructor?.name,
                storageMethod: typeof storage_1.storage?.getDocuments,
                databaseConnection: {
                    hasDb: !!db_1.db,
                    connectionString: process.env.DATABASE_URL?.substring(0, 30) + '...'
                }
            }, 'DEBUG');
            const documentType = req.query.type; // 'building', 'resident', or undefined for both
            const specificResidenceId = req.query.residenceId; // Filter by specific residence
            const specificBuildingId = req.query.buildingId; // Filter by specific building
            const attachedToType = req.query.attachedToType; // Filter by attached entity type
            const attachedToId = req.query.attachedToId; // Filter by attached entity ID
            // Get user's organization and residences for filtering
            logDocumentOperation('USER_DATA_FETCH_START', { userId }, 'DEBUG');
            logDocumentOperation('CALL_getUserOrganizations', { userId }, 'DEBUG');
            const organizationsStart = performance.now();
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const organizationsTime = performance.now() - organizationsStart;
            logDocumentOperation('getUserOrganizations_SUCCESS', {
                count: organizations.length,
                executionTime: `${organizationsTime.toFixed(2)}ms`,
                organizations: organizations.map((org) => ({ id: org.organizationId, role: org.organizationRole }))
            }, 'DEBUG');
            logDocumentOperation('CALL_getUserResidences', { userId }, 'DEBUG');
            const residencesStart = performance.now();
            const userResidences = await storage_1.storage.getUserResidences(userId);
            const residencesTime = performance.now() - residencesStart;
            logDocumentOperation('getUserResidences_SUCCESS', {
                count: userResidences.length,
                executionTime: `${residencesTime.toFixed(2)}ms`,
                residenceIds: userResidences.map((ur) => ur.residenceId).filter(Boolean)
            }, 'DEBUG');
            logDocumentOperation('CALL_getBuildings', {}, 'DEBUG');
            const buildingsStart = performance.now();
            const buildings = await storage_1.storage.getBuildings();
            const buildingsTime = performance.now() - buildingsStart;
            logDocumentOperation('getBuildings_SUCCESS', {
                count: buildings.length,
                executionTime: `${buildingsTime.toFixed(2)}ms`,
                buildingIds: buildings.map(b => b.id)
            }, 'DEBUG');
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            console.log(`[${timestamp}] ðŸ¢ Organization ID determined:`, organizationId);
            // If specific residence ID provided, filter to only that residence
            let residenceIds;
            if (specificResidenceId) {
                // Admin users have access to all residences
                if (userRole === 'admin' || userRole === 'manager') {
                    residenceIds = [specificResidenceId];
                }
                else {
                    // Verify user has access to this specific residence
                    // Handle both simple {residenceId: string} and complex nested structures
                    const hasAccess = userResidences.some((ur) => {
                        // Handle simple structure
                        if (ur.residenceId === specificResidenceId) {
                            return true;
                        }
                        // Handle complex nested structure
                        if (ur.userResidence?.residenceId === specificResidenceId) {
                            return true;
                        }
                        // Handle residence nested structure
                        if (ur.residence?.id === specificResidenceId) {
                            return true;
                        }
                        return false;
                    });
                    if (!hasAccess) {
                        return res.status(403).json({ message: 'Access denied to this residence' });
                    }
                    residenceIds = [specificResidenceId];
                }
            }
            else {
                // Extract residence IDs from both simple and complex structures
                residenceIds = userResidences
                    .map((ur) => {
                    // Handle simple structure
                    if (ur.residenceId) {
                        return ur.residenceId;
                    }
                    // Handle complex nested structure
                    if (ur.userResidence?.residenceId) {
                        return ur.userResidence.residenceId;
                    }
                    // Handle residence nested structure
                    if (ur.residence?.id) {
                        return ur.residence.id;
                    }
                    return null;
                })
                    .filter((id) => id !== null);
            }
            const buildingIds = buildings.map((b) => b.id);
            const allDocumentRecords = [];
            // Use unified documents system
            const filters = {
                userId,
                userRole,
            };
            // Filter by specific residence if provided
            if (specificResidenceId) {
                filters.residenceId = specificResidenceId;
            }
            // Filter by specific building if provided
            if (specificBuildingId) {
                filters.buildingId = specificBuildingId;
            }
            else if (documentType === 'building') {
                // For building documents, search in buildings user has access to
                if (buildingIds.length > 0) {
                    // Get all documents for buildings, will filter later to show only building-level documents
                }
            }
            else if (documentType === 'resident') {
                // For resident documents, search in residences user has access to
                if (residenceIds.length > 0) {
                    // Get all documents for residences, will filter later
                }
            }
            // CRITICAL: Enhanced document fetching with performance tracking
            logDocumentOperation('STORAGE_getDocuments_CALL', {
                filters,
                storageInstance: storage_1.storage.constructor.name,
                filtersStringified: JSON.stringify(filters, null, 2)
            }, 'DEBUG');
            const documentsStart = performance.now();
            let documents;
            try {
                documents = await storage_1.storage.getDocuments(filters);
                const documentsTime = performance.now() - documentsStart;
                logDocumentOperation('STORAGE_getDocuments_SUCCESS', {
                    documentCount: documents?.length || 0,
                    executionTime: `${documentsTime.toFixed(2)}ms`,
                    filters: filters
                }, 'DEBUG');
            }
            catch (documentsError) {
                const documentsTime = performance.now() - documentsStart;
                logDocumentOperation('STORAGE_getDocuments_ERROR', {
                    error: documentsError.message,
                    stack: documentsError.stack?.substring(0, 200),
                    executionTime: `${documentsTime.toFixed(2)}ms`,
                    filters: filters
                }, 'ERROR');
                throw documentsError;
            }
            // Enhanced document response logging
            logDocumentOperation('DOCUMENTS_RESPONSE_ANALYSIS', {
                totalDocuments: documents?.length || 0,
                documentPreview: documents?.slice(0, 3)?.map(d => ({
                    id: d.id,
                    name: d.name,
                    documentType: d.documentType,
                    uploadedById: d.uploadedById,
                    buildingId: d.buildingId,
                    residenceId: d.residenceId,
                    filePath: d.filePath,
                    isVisibleToTenants: d.isVisibleToTenants,
                    createdAt: d.createdAt
                })),
                documentTypes: documents?.reduce((acc, doc) => {
                    acc[doc.documentType] = (acc[doc.documentType] || 0) + 1;
                    return acc;
                }, {})
            }, 'DEBUG');
            // Debug logging
            console.log('ðŸ” [DOCUMENTS API DEBUG]:', {
                filters,
                documentsFound: documents?.length || 0,
                specificResidenceId,
                attachedToType,
                attachedToId,
                userRole,
                userId,
            });
            // Apply role-based filtering with tenant visibility rules
            const filteredDocumentRecords = documents.filter((doc) => {
                // If filtering by attached entity, only show documents attached to that entity
                if (attachedToType && attachedToId) {
                    if (doc.attachedToType !== attachedToType || doc.attachedToId !== attachedToId) {
                        return false;
                    }
                }
                // If filtering by specific building, only show documents for that building
                if (specificBuildingId) {
                    if (doc.buildingId !== specificBuildingId) {
                        return false;
                    }
                    // When viewing Building Documents, only show building-level documents (not residence-level)
                    if (documentType === 'building' && doc.filePath && doc.filePath.includes('residences/')) {
                        return false;
                    }
                }
                // When viewing Building Documents (documentType === 'building'), filter out residence-level documents
                if (documentType === 'building' && doc.filePath && doc.filePath.includes('residences/')) {
                    return false;
                }
                // Admin can see all documents
                if (userRole === 'admin') {
                    return true;
                }
                // Manager (including demo_manager) can see all documents in their organization
                if ((userRole === 'manager' || userRole === 'demo_manager') && organizationId) {
                    if (doc.buildingId && buildingIds.includes(doc.buildingId)) {
                        return true;
                    }
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                }
                // Resident (including demo_resident) access rules
                if (userRole === 'resident' || userRole === 'demo_resident') {
                    // Residents can see documents in their residence
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                    // Residents can see building documents related to their residences
                    if (doc.buildingId) {
                        // Check if any of user's residences belong to this building
                        const userBuildingIds = userResidences
                            .map((ur) => ur.residence?.buildingId || ur.userResidence?.residence?.buildingId)
                            .filter(Boolean);
                        return userBuildingIds.includes(doc.buildingId);
                    }
                }
                // Tenant (including demo_tenant) access rules - more restrictive
                if (userRole === 'tenant' || userRole === 'demo_tenant') {
                    // Tenants can only see documents marked as visible to tenants
                    if (!doc.isVisibleToTenants) {
                        return false;
                    }
                    // Tenants can see visible documents in their residence
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                    // Tenants can see visible building documents related to their residences
                    if (doc.buildingId) {
                        // Check if any of user's residences belong to this building
                        const userBuildingIds = userResidences
                            .map((ur) => ur.residence?.buildingId || ur.userResidence?.residence?.buildingId)
                            .filter(Boolean);
                        return userBuildingIds.includes(doc.buildingId);
                    }
                }
                return false;
            });
            // Add document type indicators for frontend compatibility and field mapping
            const enhancedDocumentRecords = filteredDocumentRecords.map((doc) => ({
                ...doc,
                title: doc.name, // Map database 'name' field to frontend 'title' field
                category: doc.documentType, // Map database 'documentType' to frontend 'category'
                documentCategory: doc.buildingId ? 'building' : 'resident',
                entityType: doc.buildingId ? 'building' : 'residence',
                entityId: doc.buildingId || doc.residenceId,
                uploadDate: doc.createdAt, // For backward compatibility
                fileUrl: doc.filePath ? `/api/documents/${doc.id}/file` : undefined, // Generate file URL if file exists
            }));
            allDocumentRecords.push(...enhancedDocumentRecords);
            // Sort by upload date, most recent first
            allDocumentRecords.sort((a, b) => new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime());
            const response = {
                documents: allDocumentRecords,
                total: allDocumentRecords.length,
                buildingCount: allDocumentRecords.filter((d) => d.documentCategory === 'building').length,
                residentCount: allDocumentRecords.filter((d) => d.documentCategory === 'resident').length,
                legacyCount: allDocumentRecords.filter((d) => d.documentCategory === 'legacy').length,
            };
            // Log successful document access
            logSecurityEvent('DOCUMENT_LIST_ACCESS', user, true, undefined, {
                documentsReturned: allDocumentRecords.length,
                filters: { documentType, specificResidenceId, specificBuildingId }
            });
            // Keep useful logging for bill documents
            if (attachedToType === 'bill' && enhancedDocumentRecords.length > 0) {
                console.log(`[${timestamp}] ðŸ“„ Bill documents found:`, enhancedDocumentRecords.length);
            }
            res.json(response);
        }
        catch (_error) {
            const errorEntry = logError('GET /api/documents', _error, req.user);
            res.status(500).json({
                message: 'Failed to fetch documents',
                error_id: errorEntry.timestamp,
                debug_info: process.env.NODE_ENV === 'development' ? _error.message : undefined
            });
        }
    });
    // Get a specific document by ID
    app.get('/api/documents/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const documentType = req.query.type; // Optional type hint
            // Get user's organization and residences for filtering
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const residences = await storage_1.storage.getUserResidences(userId);
            const buildings = await storage_1.storage.getBuildings();
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            const residenceIds = residences.map((ur) => ur.residenceId);
            const buildingIds = buildings.map((b) => b.id);
            let document = null;
            // Try to find the document in the appropriate table(s)
            const hasNewDocumentRecordMethods = 'getBuildingDocumentRecord' in storage_1.storage;
            if (hasNewDocumentRecordMethods) {
                if (!documentType || documentType === 'building') {
                    try {
                        document = await storage_1.storage.getBuildingDocumentRecord(documentId, userId, userRole, organizationId, buildingIds);
                        if (document) {
                            document.documentCategory = 'building';
                            document.entityType = 'building';
                            document.entityId = document.buildingId;
                        }
                    }
                    catch (e) {
                        console.warn('âš ï¸ Error fetching building document:', e);
                    }
                }
                if (!document && (!documentType || documentType === 'resident')) {
                    try {
                        document = await storage_1.storage.getResidentDocumentRecord(documentId, userId, userRole, organizationId, residenceIds);
                        if (document) {
                            document.documentCategory = 'resident';
                            document.entityType = 'residence';
                            document.entityId = document.residenceId;
                        }
                    }
                    catch (e) {
                        console.warn('âš ï¸ Error fetching resident document:', e);
                    }
                }
            }
            // Fallback to legacy documents if not found and no type specified
            if (!document && !documentType) {
                try {
                    document = await storage_1.storage.getDocument(documentId);
                    if (document) {
                        document.documentCategory = 'legacy';
                        document.entityType = 'legacy';
                        document.entityId = null;
                    }
                }
                catch (e) {
                    console.warn('âš ï¸ Error fetching legacy document:', e);
                }
            }
            if (!document) {
                return res.status(404).json({ message: 'DocumentRecord not found or access denied' });
            }
            res.json(document);
        }
        catch (error) {
            console.error('âŒ Error fetching document:', error);
            res.status(500).json({ message: 'Failed to fetch document' });
        }
    });
    // Create a new document (supports both file upload and text-only documents)
    app.post('/api/documents', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        const operationId = crypto_1.default.randomUUID();
        const startTime = performance.now();
        logDocumentOperation('UPLOAD_START', {
            operationId,
            userId: req.user.id,
            userRole: req.user.role,
            endpoint: 'POST /api/documents'
        }, 'INFO');
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const { documentType, buildingId, residenceId, textContent, type, ...otherData } = req.body;
            // Enhanced request analysis
            logDocumentOperation('UPLOAD_REQUEST_ANALYSIS', {
                operationId,
                requestDetails: {
                    documentType,
                    type,
                    buildingId,
                    residenceId,
                    hasFile: !!req.file,
                    hasTextContent: !!textContent,
                    textContentLength: textContent?.length,
                    otherDataKeys: Object.keys(otherData),
                    contentType: req.headers['content-type']
                },
                fileDetails: req.file ? {
                    originalname: req.file.originalname,
                    mimetype: req.file.mimetype,
                    size: req.file.size,
                    encoding: req.file.encoding,
                    fieldname: req.file.fieldname,
                    tempPath: req.file.path
                } : null
            }, 'DEBUG');
            if (req.file) {
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] File details:`, {
                    originalName: req.file.originalname,
                    mimeType: req.file.mimetype,
                    size: req.file.size,
                    tempPath: req.file.path,
                    encoding: req.file.encoding
                });
            }
            // Enhanced rate limiting with detailed tracking
            logDocumentOperation('RATE_LIMIT_CHECK', {
                operationId,
                userId,
                currentUploads: uploadRateTracker.get(userId)?.length || 0,
                maxAllowed: SECURITY_CONFIG.MAX_FILES_PER_USER_PER_HOUR
            }, 'DEBUG');
            const rateLimitCheck = checkUploadRateLimit(userId);
            if (!rateLimitCheck.allowed) {
                logDocumentOperation('RATE_LIMIT_EXCEEDED', {
                    operationId,
                    userId,
                    error: rateLimitCheck.error,
                    currentCount: uploadRateTracker.get(userId)?.length || 0
                }, 'WARN');
                logSecurityEvent('UPLOAD_RATE_LIMIT_EXCEEDED', user, false, undefined, { operationId, error: rateLimitCheck.error });
                return res.status(429).json({ message: rateLimitCheck.error });
            }
            logDocumentOperation('RATE_LIMIT_PASSED', {
                operationId,
                userId,
                remainingUploads: SECURITY_CONFIG.MAX_FILES_PER_USER_PER_HOUR - (uploadRateTracker.get(userId)?.length || 0)
            }, 'DEBUG');
            // Enhanced permission validation
            logDocumentOperation('PERMISSION_CHECK', {
                operationId,
                userRole,
                allowedRoles: ['admin', 'manager', 'resident'],
                isAuthorized: ['admin', 'manager', 'resident'].includes(userRole)
            }, 'DEBUG');
            if (!['admin', 'manager', 'resident'].includes(userRole)) {
                logDocumentOperation('PERMISSION_DENIED', {
                    operationId,
                    userRole,
                    requiredRoles: ['admin', 'manager', 'resident'],
                    userId
                }, 'WARN');
                logSecurityEvent('UNAUTHORIZED_UPLOAD_ATTEMPT', user, false, undefined, {
                    operationId,
                    requiredRoles: ['admin', 'manager', 'resident']
                });
                return res.status(403).json({ message: 'Insufficient permissions to create documents' });
            }
            logDocumentOperation('PERMISSION_GRANTED', {
                operationId,
                userRole,
                userId
            }, 'DEBUG');
            // Enhanced document type classification
            const isTextDocumentRecord = !req.file && textContent;
            const isFileDocumentRecord = !!req.file;
            const isMetadataDocumentRecord = !req.file && !textContent && (otherData.title || otherData.name);
            logDocumentOperation('DOCUMENT_TYPE_CLASSIFICATION', {
                operationId,
                classification: {
                    isTextDocument: isTextDocumentRecord,
                    isFileDocument: isFileDocumentRecord,
                    isMetadataDocument: isMetadataDocumentRecord
                },
                analysisDetails: {
                    hasFile: !!req.file,
                    hasTextContent: !!textContent,
                    textContentLength: textContent?.length,
                    hasTitle: !!otherData.title,
                    hasName: !!otherData.name,
                    fileSize: req.file?.size,
                    fileName: req.file?.originalname
                }
            }, 'DEBUG');
            if (!isTextDocumentRecord && !isFileDocumentRecord && !isMetadataDocumentRecord) {
                logDocumentOperation('INVALID_DOCUMENT_REQUEST', {
                    operationId,
                    reason: 'No file, text content, or metadata provided',
                    providedData: {
                        hasFile: !!req.file,
                        hasTextContent: !!textContent,
                        hasTitle: !!otherData.title,
                        hasName: !!otherData.name
                    }
                }, 'ERROR');
                return res.status(400).json({ message: 'Either a file, text content, or document title/name is required' });
            }
            // For text documents, create unified document directly
            if (isTextDocumentRecord) {
                // Create text document without file storage
                const documentData = {
                    name: otherData.name || 'Untitled DocumentRecord',
                    description: otherData.description || textContent.substring(0, 200) + (textContent.length > 200 ? '...' : ''),
                    documentType: documentType || 'other',
                    filePath: `text-documents/${userId}/${(0, uuid_1.v4)()}.txt`, // Virtual path for text documents
                    isVisibleToTenants: otherData.isVisibleToTenants === 'true' || otherData.isVisibleToTenants === true,
                    residenceId: residenceId || undefined,
                    buildingId: buildingId || undefined,
                    uploadedById: userId,
                };
                // Permission checks
                if (buildingId && userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const building = await storage_1.storage.getBuilding(buildingId);
                    if (!building || building.organizationId !== organizationId) {
                        return res.status(403).json({ message: 'Cannot assign document to building outside your organization' });
                    }
                }
                if (residenceId && userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res.status(403).json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Determine document record type for directory structure
                let documentRecordType;
                if (buildingId && !residenceId) {
                    documentRecordType = 'building';
                }
                else if (residenceId && !buildingId) {
                    documentRecordType = 'resident';
                }
                else {
                    return res.status(400).json({
                        message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                    });
                }
                // Save text content to local file system with proper directory structure
                let fileName;
                try {
                    const textFilePath = path_1.default.join(process.cwd(), 'uploads', documentRecordType);
                    if (!fs_1.default.existsSync(textFilePath)) {
                        fs_1.default.mkdirSync(textFilePath, { recursive: true });
                    }
                    fileName = `${(0, uuid_1.v4)()}-text-document.txt`;
                    const fullPath = path_1.default.join(textFilePath, fileName);
                    fs_1.default.writeFileSync(fullPath, textContent, 'utf8');
                }
                catch (fsError) {
                    console.error('Error saving text document to filesystem:', fsError);
                    return res.status(500).json({ message: 'Failed to save text document' });
                }
                // Update file path to match regular document uploads
                documentData.filePath = `${documentRecordType}/${fileName}`;
                // Create document record in database
                const document = await storage_1.storage.createDocument(documentData);
                return res.status(201).json({
                    message: 'Text document created successfully',
                    document: {
                        ...document,
                        title: document.name, // Map name to title for frontend compatibility
                        category: document.documentType, // Map documentType to category for frontend compatibility
                        documentCategory: buildingId ? 'building' : 'resident',
                        entityType: buildingId ? 'building' : 'residence',
                        entityId: buildingId || residenceId,
                    },
                });
            }
            // Handle metadata-only documents (create document record without file)
            if (isMetadataDocumentRecord) {
                // Map frontend 'title' field to database 'name' field and 'category' to 'documentType'
                const documentData = {
                    name: otherData.title || otherData.name || 'Untitled Document',
                    description: otherData.description || '',
                    documentType: otherData.category || documentType || 'other',
                    filePath: `metadata-documents/${userId}/${(0, uuid_1.v4)()}`, // Placeholder path for metadata-only documents
                    isVisibleToTenants: otherData.isVisibleToTenants === 'true' || otherData.isVisibleToTenants === true || false,
                    residenceId: residenceId || undefined,
                    buildingId: buildingId || undefined,
                    uploadedById: userId,
                };
                // Validate building/residence requirement
                if (!buildingId && !residenceId) {
                    return res.status(400).json({
                        message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                    });
                }
                if (buildingId && residenceId) {
                    return res.status(400).json({
                        message: 'Cannot provide both buildingId and residenceId',
                    });
                }
                // Permission checks
                if (buildingId && userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const building = await storage_1.storage.getBuilding(buildingId);
                    if (!building || building.organizationId !== organizationId) {
                        return res.status(403).json({ message: 'Cannot assign document to building outside your organization' });
                    }
                }
                if (residenceId && userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res.status(403).json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Create document record in database
                const document = await storage_1.storage.createDocument(documentData);
                return res.status(201).json({
                    message: 'Document created successfully',
                    document: {
                        ...document,
                        title: document.name, // Map name to title for frontend compatibility
                        category: document.documentType, // Map documentType to category for frontend compatibility
                        documentCategory: buildingId ? 'building' : 'resident',
                        entityType: buildingId ? 'building' : 'residence',
                        entityId: buildingId || residenceId,
                        fileUrl: undefined, // No file URL for metadata-only documents
                    },
                });
            }
            // Handle file uploads (existing logic)
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Starting file document processing`);
            // Determine document record type based on buildingId/residenceId (not from documentType field)
            let finalDocumentRecordType;
            if (buildingId && !residenceId) {
                finalDocumentRecordType = 'building';
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Determined document type: BUILDING (ID: ${buildingId})`);
            }
            else if (residenceId && !buildingId) {
                finalDocumentRecordType = 'resident';
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Determined document type: RESIDENCE (ID: ${residenceId})`);
            }
            else if (buildingId && residenceId) {
                console.log(`âŒ [DOCUMENTS UPLOAD] Both buildingId and residenceId provided: ${buildingId}, ${residenceId}`);
                return res.status(400).json({
                    message: 'Cannot provide both buildingId and residenceId',
                });
            }
            else {
                console.log(`âŒ [DOCUMENTS UPLOAD] No buildingId or residenceId provided`);
                return res.status(400).json({
                    message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                });
            }
            if (finalDocumentRecordType === 'building') {
                console.log(`ðŸ¢ [BUILDING UPLOAD] Processing building document for building ID: ${buildingId}`);
                // Validate and create building document
                if (!buildingId) {
                    console.log(`âŒ [BUILDING UPLOAD] Missing buildingId`);
                    return res.status(400).json({ message: 'buildingId is required for building documents' });
                }
                // Prepare the permanent file path and move file if needed
                let filePath;
                let fileName;
                if (req.file) {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Processing file upload for building ${buildingId}`);
                    // Generate unique filename and move to permanent location
                    fileName = `${(0, uuid_1.v4)()}-${req.file.originalname}`;
                    const permanentDir = path_1.default.join(process.cwd(), 'uploads', 'buildings', buildingId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] File paths:`, {
                        originalName: req.file.originalname,
                        newFileName: fileName,
                        tempPath: req.file.path,
                        permanentDir,
                        directoryExists: fs_1.default.existsSync(permanentDir)
                    });
                    // Ensure directory exists
                    if (!fs_1.default.existsSync(permanentDir)) {
                        console.log(`ðŸ¢ [BUILDING UPLOAD] Creating directory: ${permanentDir}`);
                        fs_1.default.mkdirSync(permanentDir, { recursive: true });
                    }
                    // Move file from temporary to permanent location (copy + delete for cross-filesystem)
                    const permanentPath = path_1.default.join(permanentDir, fileName);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Copying file from ${req.file.path} to ${permanentPath}`);
                    fs_1.default.copyFileSync(req.file.path, permanentPath);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Cleaning up temporary file: ${req.file.path}`);
                    fs_1.default.unlinkSync(req.file.path); // Clean up temporary file
                    filePath = `buildings/${buildingId}/${fileName}`;
                    console.log(`ðŸ¢ [BUILDING UPLOAD] File successfully moved to: ${filePath}`);
                }
                else {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] No file provided, creating placeholder path`);
                    filePath = `temp-path-${Date.now()}`;
                }
                const dataToValidate = {
                    ...otherData,
                    buildingId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other', // Default to 'other' if not provided
                };
                console.log(`ðŸ¢ [BUILDING UPLOAD] Data to validate:`, {
                    buildingId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other',
                    otherDataKeys: Object.keys(otherData)
                });
                let validatedData;
                try {
                    validatedData = schema_1.insertDocumentSchema.parse(dataToValidate);
                    console.log(`âœ… [BUILDING UPLOAD] Document validation successful for building ${buildingId}`);
                }
                catch (validationError) {
                    console.log(`âŒ [BUILDING UPLOAD] Document validation failed for building ${buildingId}:`, validationError);
                    return res.status(400).json({
                        message: 'Validation failed',
                        error: validationError.message || 'Invalid data',
                        details: validationError.issues || validationError
                    });
                }
                // Permission checks for building documents
                console.log(`ðŸ¢ [BUILDING UPLOAD] Checking permissions for role: ${userRole}`);
                if (userRole === 'manager') {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Manager permission check for building ${buildingId}`);
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Manager organization: ${organizationId}`);
                    const building = await storage_1.storage.getBuilding(buildingId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Building organization: ${building?.organizationId}`);
                    if (!building || building.organizationId !== organizationId) {
                        console.log(`âŒ [BUILDING UPLOAD] Manager permission denied - organization mismatch`);
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to building outside your organization' });
                    }
                    console.log(`âœ… [BUILDING UPLOAD] Manager permission check passed`);
                }
                if (userRole === 'resident') {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Resident permission check for building ${buildingId}`);
                    const residences = await storage_1.storage.getUserResidences(userId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] User residences count: ${residences.length}`);
                    const hasResidenceInBuilding = await Promise.all(residences.map(async (ur) => {
                        const residence = await storage_1.storage.getResidence(ur.residenceId);
                        const isInBuilding = residence && residence.buildingId === buildingId;
                        console.log(`ðŸ¢ [BUILDING UPLOAD] Residence ${ur.residenceId} in building ${buildingId}: ${isInBuilding}`);
                        return isInBuilding;
                    }));
                    if (!hasResidenceInBuilding.some(Boolean)) {
                        console.log(`âŒ [BUILDING UPLOAD] Resident permission denied - no residence in building`);
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to building where you have no residence' });
                    }
                    console.log(`âœ… [BUILDING UPLOAD] Resident permission check passed`);
                }
                // Create unified document instead of separate building document
                const unifiedDocument = {
                    name: validatedData.name || 'Untitled',
                    description: validatedData.description,
                    documentType: validatedData.documentType,
                    filePath: validatedData.filePath || `temp-path-${Date.now()}`,
                    isVisibleToTenants: validatedData.isVisibleToTenants || false,
                    residenceId: undefined,
                    buildingId: validatedData.buildingId,
                    uploadedById: validatedData.uploadedById,
                };
                console.log(`ðŸ¢ [BUILDING UPLOAD] Creating document in database:`, {
                    name: unifiedDocument.name,
                    documentType: unifiedDocument.documentType,
                    filePath: unifiedDocument.filePath,
                    buildingId: unifiedDocument.buildingId,
                    uploadedById: unifiedDocument.uploadedById
                });
                const document = await storage_1.storage.createDocument(unifiedDocument);
                console.log(`âœ… [BUILDING UPLOAD] Document created successfully with ID: ${document.id}`);
                // File has been moved to permanent location, no cleanup needed
                res.status(201).json({
                    ...document,
                    documentCategory: 'building',
                    entityType: 'building',
                    entityId: document.buildingId,
                });
            }
            else if (finalDocumentRecordType === 'resident') {
                console.log(`ðŸ  [RESIDENCE UPLOAD] Processing residence document for residence ID: ${residenceId}`);
                // Validate and create resident document
                if (!residenceId) {
                    console.log(`âŒ [RESIDENCE UPLOAD] Missing residenceId`);
                    return res
                        .status(400)
                        .json({ message: 'residenceId is required for resident documents' });
                }
                // Prepare the permanent file path and move file if needed
                let filePath;
                let fileName;
                if (req.file) {
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Processing file upload for residence ${residenceId}`);
                    // Generate unique filename and move to permanent location
                    fileName = `${(0, uuid_1.v4)()}-${req.file.originalname}`;
                    const permanentDir = path_1.default.join(process.cwd(), 'uploads', 'residences', residenceId);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] File paths:`, {
                        originalName: req.file.originalname,
                        newFileName: fileName,
                        tempPath: req.file.path,
                        permanentDir,
                        directoryExists: fs_1.default.existsSync(permanentDir)
                    });
                    // Ensure directory exists
                    if (!fs_1.default.existsSync(permanentDir)) {
                        console.log(`ðŸ  [RESIDENCE UPLOAD] Creating directory: ${permanentDir}`);
                        fs_1.default.mkdirSync(permanentDir, { recursive: true });
                    }
                    // Move file from temporary to permanent location (copy + delete for cross-filesystem)
                    const permanentPath = path_1.default.join(permanentDir, fileName);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Copying file from ${req.file.path} to ${permanentPath}`);
                    fs_1.default.copyFileSync(req.file.path, permanentPath);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Cleaning up temporary file: ${req.file.path}`);
                    fs_1.default.unlinkSync(req.file.path); // Clean up temporary file
                    filePath = `residences/${residenceId}/${fileName}`;
                    console.log(`ðŸ  [RESIDENCE UPLOAD] File successfully moved to: ${filePath}`);
                }
                else {
                    console.log(`ðŸ  [RESIDENCE UPLOAD] No file provided, creating placeholder path`);
                    filePath = `temp-path-${Date.now()}`;
                }
                const dataToValidate = {
                    ...otherData,
                    residenceId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other', // Default to 'other' if not provided
                };
                console.log('ðŸ” Residence document validation debug:', {
                    dataToValidate,
                    documentType,
                    otherDataKeys: Object.keys(otherData),
                    hasFile: !!req.file
                });
                let validatedData;
                try {
                    validatedData = schema_1.insertDocumentSchema.parse(dataToValidate);
                    console.log('âœ… Residence document validation SUCCESS');
                }
                catch (validationError) {
                    console.log('âŒ Residence document validation ERROR:', validationError);
                    return res.status(400).json({
                        message: 'Validation failed',
                        error: validationError.message || 'Invalid data',
                        details: validationError.issues || validationError
                    });
                }
                // Permission checks for resident documents
                if (userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const residence = await storage_1.storage.getResidence(residenceId);
                    if (residence) {
                        const building = await storage_1.storage.getBuilding(residence.buildingId);
                        if (!building || building.organizationId !== organizationId) {
                            return res
                                .status(403)
                                .json({ message: 'Cannot assign document to residence outside your organization' });
                        }
                    }
                    else {
                        return res.status(404).json({ message: 'Residence not found' });
                    }
                }
                if (userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Convert to unified document format
                const unifiedDocument = {
                    name: validatedData.name || 'Untitled',
                    description: validatedData.description,
                    documentType: validatedData.documentType,
                    filePath: validatedData.filePath || `temp-path-${Date.now()}`,
                    isVisibleToTenants: validatedData.isVisibleToTenants || false,
                    residenceId: validatedData.residenceId,
                    buildingId: undefined,
                    uploadedById: validatedData.uploadedById,
                };
                const document = await storage_1.storage.createDocument(unifiedDocument);
                console.log('ðŸ“ Created resident document:', document);
                console.log('ðŸ“ DocumentRecord ID:', document.id);
                const response = {
                    ...document,
                    documentCategory: 'resident',
                    entityType: 'residence',
                    entityId: document.residenceId,
                };
                console.log('ðŸ“¤ Sending response:', response);
                res.status(201).json(response);
            }
            else {
                return res.status(400).json({
                    message: 'Invalid documentType. Must be either \"building\" or \"resident\"',
                });
            }
        }
        catch (_error) {
            // Clean up temporary file on error
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.warn('âš ï¸ Failed to cleanup temporary file:', cleanupError);
                }
            }
            console.error('âŒ Error creating document:', _error);
            if (_error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    message: 'Invalid document data',
                    errors: _error.issues,
                });
            }
            res.status(500).json({ message: 'Failed to create document' });
        }
    });
    // Update a document
    app.put('/api/documents/:id', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        console.log(`ðŸ“ [DOCUMENT UPDATE] Starting update for document ID: ${req.params.id}`);
        console.log(`ðŸ“ [DOCUMENT UPDATE] User: ${req.user.id} (${req.user.role})`);
        console.log(`ðŸ“ [DOCUMENT UPDATE] Body:`, req.body);
        console.log(`ðŸ“ [DOCUMENT UPDATE] File provided:`, !!req.file);
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            // Get existing document first to check permissions and get current file path
            const existingDocument = await storage_1.storage.getDocuments().then(docs => docs.find(doc => doc.id === documentId));
            if (!existingDocument) {
                console.log(`âŒ [DOCUMENT UPDATE] Document not found: ${documentId}`);
                return res.status(404).json({ message: 'Document not found' });
            }
            console.log(`ðŸ“ [DOCUMENT UPDATE] Existing document:`, {
                id: existingDocument.id,
                name: existingDocument.name,
                filePath: existingDocument.filePath,
                buildingId: existingDocument.buildingId,
                residenceId: existingDocument.residenceId
            });
            // Check permissions (similar to view permissions)
            let hasAccess = false;
            if (userRole === 'admin') {
                hasAccess = true;
                console.log(`âœ… [DOCUMENT UPDATE] Admin access granted`);
            }
            else if (userRole === 'manager') {
                // Manager should have access to documents in their organization
                const organizations = await storage_1.storage.getUserOrganizations(userId);
                const buildings = await storage_1.storage.getBuildings();
                const userOrganizations = organizations.map(org => org.organizationId);
                if (existingDocument.buildingId) {
                    const orgBuildings = buildings.filter(building => userOrganizations.includes(building.organizationId || ''));
                    const orgBuildingIds = orgBuildings.map(b => b.id);
                    hasAccess = orgBuildingIds.includes(existingDocument.buildingId);
                }
                console.log(`ðŸ“ [DOCUMENT UPDATE] Manager access: ${hasAccess}`);
            }
            if (!hasAccess) {
                console.log(`âŒ [DOCUMENT UPDATE] Access denied for user ${userId}`);
                return res.status(403).json({ message: 'Access denied' });
            }
            // Prepare update data
            const updateData = {};
            if (req.body.name)
                updateData.name = req.body.name;
            if (req.body.description !== undefined)
                updateData.description = req.body.description;
            if (req.body.documentType)
                updateData.documentType = req.body.documentType;
            if (req.body.isVisibleToTenants !== undefined) {
                updateData.isVisibleToTenants = req.body.isVisibleToTenants === 'true';
            }
            console.log(`ðŸ“ [DOCUMENT UPDATE] Update data:`, updateData);
            // Handle file replacement if provided
            if (req.file) {
                console.log(`ðŸ“ [DOCUMENT UPDATE] Processing file replacement:`, {
                    originalname: req.file.originalname,
                    size: req.file.size,
                    mimetype: req.file.mimetype,
                    tempPath: req.file.path
                });
                // Validate the file
                const fileValidation = validateFile(req.file);
                if (!fileValidation.isValid) {
                    // Clean up temp file
                    try {
                        fs_1.default.unlinkSync(req.file.path);
                    }
                    catch (cleanupError) {
                        console.warn('âš ï¸ Failed to cleanup temp file:', cleanupError);
                    }
                    return res.status(400).json({ message: fileValidation.error });
                }
                // Generate unique file path
                const fileExtension = path_1.default.extname(req.file.originalname);
                const baseFileName = path_1.default.basename(req.file.originalname, fileExtension);
                const uniqueId = crypto_1.default.randomBytes(16).toString('hex');
                const entityType = existingDocument.buildingId ? 'buildings' : 'residences';
                const entityId = existingDocument.buildingId || existingDocument.residenceId;
                const documentsDir = path_1.default.join(process.cwd(), 'uploads', entityType, entityId || 'general');
                const uniqueFileName = `${uniqueId}-${baseFileName}${fileExtension}`;
                const finalPath = path_1.default.join(documentsDir, uniqueFileName);
                const relativePath = path_1.default.join(entityType, entityId || 'general', uniqueFileName);
                // Ensure directory exists
                if (!fs_1.default.existsSync(documentsDir)) {
                    fs_1.default.mkdirSync(documentsDir, { recursive: true });
                }
                // Move file from temp to final location
                fs_1.default.renameSync(req.file.path, finalPath);
                // Update file-related fields
                updateData.filePath = relativePath;
                updateData.fileName = req.file.originalname;
                updateData.fileSize = req.file.size;
                updateData.mimeType = req.file.mimetype;
                console.log(`âœ… [DOCUMENT UPDATE] File stored at: ${finalPath}`);
                // Clean up old file if it exists
                if (existingDocument.filePath) {
                    const oldFilePath = path_1.default.isAbsolute(existingDocument.filePath)
                        ? existingDocument.filePath
                        : path_1.default.join(process.cwd(), 'uploads', existingDocument.filePath);
                    try {
                        if (fs_1.default.existsSync(oldFilePath)) {
                            fs_1.default.unlinkSync(oldFilePath);
                            console.log(`ðŸ—‘ï¸ [DOCUMENT UPDATE] Cleaned up old file: ${oldFilePath}`);
                        }
                    }
                    catch (cleanupError) {
                        console.warn('âš ï¸ Failed to cleanup old file:', cleanupError);
                    }
                }
            }
            // Update the document
            const updatedDocument = await storage_1.storage.updateDocument(documentId, updateData);
            if (!updatedDocument) {
                console.log(`âŒ [DOCUMENT UPDATE] Failed to update document: ${documentId}`);
                return res.status(404).json({ message: 'Failed to update document' });
            }
            console.log(`âœ… [DOCUMENT UPDATE] Document updated successfully:`, {
                id: updatedDocument.id,
                name: updatedDocument.name
            });
            // Add compatibility fields for frontend
            updatedDocument.documentCategory = updatedDocument.buildingId ? 'building' : 'resident';
            updatedDocument.entityType = updatedDocument.buildingId ? 'building' : 'residence';
            updatedDocument.entityId = updatedDocument.buildingId || updatedDocument.residenceId;
            res.json(updatedDocument);
        }
        catch (_error) {
            // Clean up temporary file on error
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                    console.log(`ðŸ—‘ï¸ [DOCUMENT UPDATE] Cleaned up temp file on error: ${req.file.path}`);
                }
                catch (cleanupError) {
                    console.warn('âš ï¸ Failed to cleanup temporary file:', cleanupError);
                }
            }
            console.error('âŒ Error updating document:', _error);
            if (_error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    message: 'Invalid document data',
                    errors: _error.issues,
                });
            }
            res.status(500).json({ message: 'Failed to update document' });
        }
    });
    // Security audit endpoint - admin only
    app.get('/api/documents/security/audit-log', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            // Only admins can access audit logs
            if (user.role !== 'admin') {
                logSecurityEvent('UNAUTHORIZED_AUDIT_ACCESS', user, false);
                return res.status(403).json({ message: 'Access denied. Admin privileges required.' });
            }
            // Get last 100 audit events with pagination support
            const limit = Math.min(parseInt(req.query.limit) || 50, 100);
            const offset = parseInt(req.query.offset) || 0;
            const paginatedLogs = auditLog.slice(offset, offset + limit);
            logSecurityEvent('AUDIT_LOG_ACCESS', user, true, undefined, { limit, offset });
            res.json({
                events: paginatedLogs,
                total: auditLog.length,
                limit,
                offset
            });
        }
        catch (error) {
            console.error('Error accessing audit log:', error);
            res.status(500).json({ message: 'Failed to retrieve audit log' });
        }
    });
    // Delete document with enhanced security logging
    app.delete('/api/documents/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const documentType = req.query.type; // Optional type hint
            // Get user's organization for permission checking
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            // Use unified documents system for deletion
            let deleted = false;
            try {
                deleted = await storage_1.storage.deleteDocument(documentId);
            }
            catch (e) {
                console.warn('âš ï¸ Error deleting document:', e);
            }
            if (!deleted) {
                return res.status(404).json({ message: 'DocumentRecord not found or access denied' });
            }
            res.status(204).send();
        }
        catch (error) {
            console.error('âŒ Error in document deletion:', error);
            res.status(500).json({ message: 'Failed to delete document' });
        }
    });
    // Upload endpoint that matches frontend expectation: /api/documents/:id/upload
    app.post('/api/documents/:id/upload', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id; // The :id in the URL is the document ID (from frontend)
            const { documentType = 'resident', residenceId, ...otherData } = req.body;
            console.log('ðŸ“¤ Upload request received:', {
                documentId,
                userId,
                userRole,
                hasFile: !!req.file,
                fileInfo: req.file
                    ? {
                        fieldname: req.file.fieldname,
                        originalname: req.file.originalname,
                        encoding: req.file.encoding,
                        mimetype: req.file.mimetype,
                        size: req.file.size,
                        path: req.file.path,
                    }
                    : null,
                bodyKeys: Object.keys(req.body),
                contentType: req.headers['content-type'],
            });
            // Validate permissions - only admin, manager, and resident can create documents
            if (!['admin', 'manager', 'resident'].includes(userRole)) {
                return res.status(403).json({ message: 'Insufficient permissions to create documents' });
            }
            if (!req.file) {
                console.error('âŒ No file received in upload request');
                return res.status(400).json({ message: 'File is required for upload' });
            }
            // Get the existing document to determine where to store the file
            const documents = await storage_1.storage.getDocuments({
                userId,
                userRole,
            });
            const existingDocument = documents.find((doc) => doc.id === documentId);
            if (!existingDocument) {
                return res.status(404).json({ message: 'DocumentRecord not found' });
            }
            // File validation passed - file exists and is ready for upload
            // Determine organization ID based on document context
            let organizationId;
            if (existingDocument.buildingId) {
                const building = await storage_1.storage.getBuilding(existingDocument.buildingId);
                if (!building) {
                    return res.status(404).json({ message: 'Building not found' });
                }
                organizationId = building.organizationId;
            }
            else if (existingDocument.residenceId) {
                const residence = await storage_1.storage.getResidence(existingDocument.residenceId);
                if (!residence) {
                    return res.status(404).json({ message: 'Residence not found' });
                }
                const building = await storage_1.storage.getBuilding(residence.buildingId);
                if (!building) {
                    return res.status(404).json({ message: 'Building not found' });
                }
                organizationId = building.organizationId;
            }
            else {
                return res
                    .status(400)
                    .json({ message: 'DocumentRecord must be associated with a building or residence' });
            }
            // Note: File upload to external storage removed
            // Update document with file information
            const updatedDocument = await storage_1.storage.updateDocument(documentId, {
                filePath: `prod_org_${organizationId}/${req.file.originalname}`,
                name: req.file.originalname,
                // Remove mimeType as it's not in schema
            });
            // Clean up temporary file
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                fs_1.default.unlinkSync(req.file.path);
            }
            res.status(200).json({
                document: updatedDocument,
                message: 'File uploaded successfully',
            });
        }
        catch (error) {
            const errorTimestamp = new Date().toISOString();
            console.error(`[${errorTimestamp}] Error type:`, error.constructor.name);
            console.error(`[${errorTimestamp}] Error message:`, error.message);
            console.error(`[${errorTimestamp}] Error stack:`, error.stack);
            // Clean up temporary file on error
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.error(`[${errorTimestamp}] Error cleaning up file:`, cleanupError);
                }
            }
            if (error.name === 'ZodError') {
                return res.status(400).json({
                    message: 'Validation error',
                    errors: error.errors,
                });
            }
            res.status(500).json({ message: 'Failed to upload document' });
        }
    });
    // POST /api/documents/upload - Upload file to GCS and create unified document record
    app.post('/api/documents/upload', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        const timestamp = new Date().toISOString();
        console.log(`[${timestamp}] ðŸ“‹ POST /api/documents/upload - Starting upload`, {
            hasFile: !!req.file,
            fileName: req.file?.originalname,
            fileSize: req.file?.size,
            body: req.body,
            userId: req.user?.id
        });
        try {
            // Check if file was uploaded
            if (!req.file) {
                return res.status(400).json({ message: 'No file uploaded' });
            }
            // Parse form data
            const formData = {
                name: req.body.name,
                description: req.body.description || '',
                documentType: req.body.documentType || req.body.type, // Handle both field names
                isVisibleToTenants: req.body.isVisibleToTenants === 'true',
                residenceId: req.body.residenceId || undefined,
                buildingId: req.body.buildingId || undefined,
                attachedToType: req.body.attachedToType || undefined,
                attachedToId: req.body.attachedToId || undefined,
            };
            // Production debugging: Log form data before validation
            if (process.env.NODE_ENV === 'production') {
                console.log('[PROD DEBUG] Form data before validation:', formData);
            }
            // Validate form data
            const validatedData = uploadDocumentRecordSchema.parse(formData);
            // DEBUG: Log validated data to see what's being passed
            console.log(`[${timestamp}] ðŸ” VALIDATION DEBUG: Form data before validation:`, formData);
            console.log(`[${timestamp}] ðŸ” VALIDATION DEBUG: Validated data:`, {
                ...validatedData,
                hasAttachedToType: !!validatedData.attachedToType,
                hasAttachedToId: !!validatedData.attachedToId
            });
            // Production debugging: Log after validation
            if (process.env.NODE_ENV === 'production') {
                console.log('[PROD DEBUG] Form data validation passed:', validatedData);
            }
            // Get user info from auth middleware
            const userId = req.user?.id;
            if (!userId) {
                return res.status(401).json({ message: 'User not authenticated' });
            }
            // GCS DISABLED: Skip bucket configuration (using local storage only)
            console.log('ðŸ“ GCS disabled - skipping bucket configuration check');
            // Generate unique GCS path
            const fileExtension = path_1.default.extname(req.file.originalname);
            const baseFileName = path_1.default.basename(req.file.originalname, fileExtension);
            const uniqueFileName = `${(0, uuid_1.v4)()}-${baseFileName}${fileExtension}`;
            let filePath;
            if (validatedData.residenceId) {
                filePath = `residences/${validatedData.residenceId}/${uniqueFileName}`;
            }
            else if (validatedData.buildingId) {
                filePath = `buildings/${validatedData.buildingId}/${uniqueFileName}`;
            }
            else {
                filePath = `general/${uniqueFileName}`;
            }
            // DISABLED GCS: Force local storage for all environments
            console.log('ðŸ“ GCS disabled - using local storage for all document operations');
            // Always use local storage (GCS disabled)
            try {
                // Use local storage with robust error handling
                const localStoragePath = path_1.default.join(process.cwd(), 'uploads');
                // Ensure uploads directory exists
                try {
                    if (!fs_1.default.existsSync(localStoragePath)) {
                        fs_1.default.mkdirSync(localStoragePath, { recursive: true });
                        console.log(`ðŸ“ Created uploads directory: ${localStoragePath}`);
                    }
                }
                catch (dirError) {
                    console.error('Failed to create uploads directory:', dirError);
                    throw new Error('Cannot create uploads directory - check permissions');
                }
                // Create directory structure for file
                const localFilePath = path_1.default.join(localStoragePath, filePath);
                const localFileDir = path_1.default.dirname(localFilePath);
                try {
                    if (!fs_1.default.existsSync(localFileDir)) {
                        fs_1.default.mkdirSync(localFileDir, { recursive: true });
                        console.log(`ðŸ“ Created subdirectory: ${localFileDir}`);
                    }
                }
                catch (subdirError) {
                    console.error('Failed to create file subdirectory:', subdirError);
                    throw new Error('Cannot create file directory - check permissions');
                }
                // Copy uploaded file to local storage
                try {
                    fs_1.default.copyFileSync(req.file.path, localFilePath);
                    // File saved successfully
                }
                catch (copyError) {
                    console.error('Failed to copy file:', copyError);
                    throw new Error('Cannot save file - check disk space and permissions');
                }
            }
            catch (localError) {
                console.error('Local storage error:', localError);
                throw new Error('Failed to save file locally');
            }
            // Create document record in database
            const documentData = {
                name: validatedData.name,
                description: validatedData.description,
                documentType: validatedData.documentType,
                filePath: filePath,
                isVisibleToTenants: validatedData.isVisibleToTenants,
                residenceId: validatedData.residenceId,
                buildingId: validatedData.buildingId,
                uploadedById: userId,
                attachedToType: validatedData.attachedToType,
                attachedToId: validatedData.attachedToId,
            };
            // Create document record in database
            // Create document record in database  
            const newDocument = await storage_1.storage.createDocument(documentData);
            // Document record created successfully
            // Clean up temporary file
            if (fs_1.default.existsSync(req.file.path)) {
                fs_1.default.unlinkSync(req.file.path);
            }
            // Return success response
            res.status(201).json({
                message: 'DocumentRecord uploaded successfully',
                document: newDocument,
            });
        }
        catch (error) {
            const errorEntry = logError('POST /api/documents/upload', error, req.user);
            // Clean up temporary file on error
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.error('Error cleaning up temporary file:', cleanupError);
                }
            }
            // Handle validation errors
            if (error.name === 'ZodError') {
                return res.status(400).json({
                    message: 'Validation error',
                    errors: error.errors,
                    error_id: errorEntry.timestamp
                });
            }
            // Handle GCS errors
            if (error.message && error.message.includes('Google Cloud Storage')) {
                return res.status(500).json({
                    message: 'File upload failed',
                    error: 'Storage service error',
                    error_id: errorEntry.timestamp
                });
            }
            // Handle unique constraint violations (path conflicts)
            if (error?.message?.includes('unique constraint') || error?.code === '23505') {
                return res.status(409).json({
                    message: 'DocumentRecord path conflict - please try uploading again',
                    error: 'Path already exists',
                    error_id: errorEntry.timestamp
                });
            }
            // Handle database errors
            if (error.message && error.message.includes('database')) {
                return res.status(500).json({
                    message: 'Failed to save document record',
                    error: 'Database error',
                    error_id: errorEntry.timestamp
                });
            }
            // Generic error response
            res.status(500).json({
                message: 'Internal server error',
                error: 'DocumentRecord upload failed',
                error_id: errorEntry.timestamp,
                debug_info: process.env.NODE_ENV === 'development' ? error.message : undefined
            });
        }
    });
    // Serve document files
    // Serve document files with proper role-based access control
    app.get('/api/documents/:id/file', auth_1.requireAuth, async (req, res) => {
        const operationId = crypto_1.default.randomUUID();
        const startTime = performance.now();
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const isDownload = req.query.download === 'true';
            logDocumentOperation('FILE_SERVE_REQUEST', {
                operationId,
                documentId,
                userId,
                userRole,
                isDownload,
                requestInfo: {
                    url: req.url,
                    method: req.method,
                    userAgent: req.headers['user-agent'],
                    referer: req.headers.referer,
                    clientIP: req.ip || req.connection.remoteAddress
                }
            }, 'INFO');
            // Enhanced permission data loading with timing
            const permissionLoadStart = performance.now();
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const residences = await storage_1.storage.getUserResidences(userId);
            const buildings = await storage_1.storage.getBuildings();
            const permissionLoadTime = performance.now() - permissionLoadStart;
            logDocumentOperation('PERMISSION_DATA_LOADED', {
                operationId,
                loadTime: `${permissionLoadTime.toFixed(2)}ms`,
                dataStats: {
                    organizationsCount: organizations.length,
                    residencesCount: residences.length,
                    buildingsCount: buildings.length
                }
            }, 'DEBUG');
            // Enhanced security audit for file access
            logSecurityEvent('DOCUMENT_FILE_ACCESS_ATTEMPT', user, false, documentId, {
                operationId,
                userRole,
                documentId,
                isDownload,
                requestContext: {
                    timestamp: new Date().toISOString(),
                    clientIP: req.ip || req.connection.remoteAddress,
                    userAgent: req.headers['user-agent']
                }
            });
            // Enhanced document lookup with performance tracking
            const documentLookupStart = performance.now();
            const allDocuments = await storage_1.storage.getDocuments({});
            const document = allDocuments.find((doc) => doc.id === documentId);
            const documentLookupTime = performance.now() - documentLookupStart;
            logDocumentOperation('DOCUMENT_LOOKUP', {
                operationId,
                documentId,
                lookupTime: `${documentLookupTime.toFixed(2)}ms`,
                totalDocumentsSearched: allDocuments.length,
                documentFound: !!document
            }, 'DEBUG');
            if (!document) {
                logDocumentOperation('DOCUMENT_NOT_FOUND', {
                    operationId,
                    documentId,
                    totalDocumentsInDatabase: allDocuments.length
                }, 'WARN');
                logSecurityEvent('DOCUMENT_FILE_ACCESS_NOT_FOUND', user, false, documentId, { operationId });
                return res.status(404).json({ message: 'Document not found' });
            }
            // Document found in database
            // Get user's organization info
            const userOrganizations = organizations.map(org => org.organizationId);
            const userResidenceIds = residences
                .map((ur) => ur.residenceId || ur.userResidence?.residenceId || ur.residence?.id)
                .filter(Boolean);
            // Get building IDs that user's residences belong to
            const userBuildingIds = [];
            for (const userResidence of residences) {
                // Handle different residence data structures
                const residenceId = userResidence.residenceId;
                if (residenceId) {
                    // Find the actual residence to get building ID
                    const allResidences = await storage_1.storage.getResidences();
                    const residence = allResidences.find(r => r.id === residenceId);
                    if (residence?.buildingId) {
                        userBuildingIds.push(residence.buildingId);
                    }
                }
            }
            // Check permissions based on the specified rules
            let hasAccess = false;
            let accessReason = '';
            if (userRole === 'admin') {
                hasAccess = true;
                accessReason = 'Admin has global access';
                // Admin access granted
            }
            else if (userRole === 'manager' || userRole === 'demo_manager') {
                // Checking manager permissions
                // Manager should have access to buildings they are assigned to
                if (document.buildingId) {
                    // Checking building-level access
                    // Get buildings for the manager's organization
                    const orgBuildings = buildings.filter(building => userOrganizations.includes(building.organizationId || ''));
                    const orgBuildingIds = orgBuildings.map(b => b.id);
                    // Checking organization buildings
                    if (orgBuildingIds.includes(document.buildingId)) {
                        hasAccess = true;
                        accessReason = 'Manager has access to organization buildings';
                        // Manager building access granted
                    }
                    else {
                        // Manager building access denied
                    }
                }
                // Manager has access to all residences in their organization
                if (document.residenceId) {
                    // Check if residence belongs to manager's organization
                    const allResidences = await storage_1.storage.getResidences();
                    const residence = allResidences.find(r => r.id === document.residenceId);
                    if (residence) {
                        // Check if residence building belongs to manager's organization
                        const residenceBuilding = buildings.find(b => b.id === residence.buildingId);
                        if (residenceBuilding && userOrganizations.includes(residenceBuilding.organizationId || '')) {
                            hasAccess = true;
                            accessReason = 'Manager has access to organization residences';
                        }
                    }
                }
            }
            else if (userRole === 'resident' || userRole === 'demo_resident') {
                // Resident has access to building files they are assigned to
                if (document.buildingId && userBuildingIds.includes(document.buildingId)) {
                    hasAccess = true;
                    accessReason = 'Resident has access to assigned building documents';
                }
                // Resident has access to residence files they are assigned to
                if (document.residenceId && userResidenceIds.includes(document.residenceId)) {
                    hasAccess = true;
                    accessReason = 'Resident has access to assigned residence documents';
                }
            }
            else if (userRole === 'tenant' || userRole === 'demo_tenant') {
                // Tenants can only access documents marked as visible to tenants
                if (document.isVisibleToTenants) {
                    // Tenant has access to building files they are assigned to and marked for tenant
                    if (document.buildingId && userBuildingIds.includes(document.buildingId)) {
                        hasAccess = true;
                        accessReason = 'Tenant has access to assigned building documents marked for tenants';
                    }
                    // Tenant has access to residence files they are assigned to and marked for tenant
                    if (document.residenceId && userResidenceIds.includes(document.residenceId)) {
                        hasAccess = true;
                        accessReason = 'Tenant has access to assigned residence documents marked for tenants';
                    }
                }
            }
            if (!hasAccess) {
                logDocumentOperation('FILE_ACCESS_DENIED', {
                    operationId,
                    documentId,
                    userId,
                    userRole,
                    accessAnalysis: {
                        documentBuildingId: document.buildingId,
                        documentResidenceId: document.residenceId,
                        userBuildingIds,
                        userResidenceIds,
                        isVisibleToTenants: document.isVisibleToTenants,
                        documentType: document.documentType
                    }
                }, 'WARN');
                logSecurityEvent('DOCUMENT_FILE_ACCESS_DENIED', user, false, documentId, {
                    operationId,
                    userRole,
                    documentBuildingId: document.buildingId,
                    documentResidenceId: document.residenceId,
                    userBuildingIds,
                    userResidenceIds,
                    isVisibleToTenants: document.isVisibleToTenants
                });
                return res.status(403).json({ message: 'Access denied' });
            }
            logDocumentOperation('FILE_ACCESS_GRANTED', {
                operationId,
                documentId,
                userId,
                userRole,
                accessReason,
                documentInfo: {
                    name: document.name,
                    documentType: document.documentType,
                    filePath: document.filePath,
                    buildingId: document.buildingId,
                    residenceId: document.residenceId
                }
            }, 'INFO');
            logSecurityEvent('DOCUMENT_FILE_ACCESS_GRANTED', user, true, documentId, {
                operationId,
                accessReason,
                userRole,
                documentType: document.documentType
            });
            // Serve from local storage
            if (document.filePath) {
                // Serving file from local storage
                try {
                    // Always serve from local storage (GCS disabled)
                    let filePathToServe = document.filePath;
                    // Resolving file path
                    // Check if it's an absolute path
                    if (document.filePath.startsWith('/')) {
                        filePathToServe = document.filePath;
                        // Using absolute path
                    }
                    // Check if it's a relative file path
                    else if (document.filePath.includes('residences/') ||
                        document.filePath.includes('buildings/') ||
                        document.filePath.includes('text-documents/') ||
                        document.filePath.includes('general/') ||
                        document.filePath.includes('bills/')) {
                        // Checking common file locations
                        // For development, try to find the file in common upload directories
                        const possiblePaths = [
                            path_1.default.join(process.cwd(), document.filePath), // Direct path (PRIORITY - user directory structure)
                            path_1.default.join(process.cwd(), 'uploads', document.filePath), // Fallback location
                            `/tmp/uploads/${document.filePath}`,
                            `/uploads/${document.filePath}`,
                            `./uploads/${document.filePath}`,
                            path_1.default.join('/tmp', document.filePath),
                        ];
                        // Checking multiple possible paths
                        // Try to find the file in any of these locations
                        for (const possiblePath of possiblePaths) {
                            // Checking file path
                            if (fs_1.default.existsSync(possiblePath)) {
                                filePathToServe = possiblePath;
                                // File found
                                break;
                            }
                        }
                    }
                    // Check if it's a temp file path
                    else if (document.filePath.includes('tmp')) {
                        filePathToServe = document.filePath;
                        // Using temp file path
                    }
                    // Try to serve the file
                    if (fs_1.default.existsSync(filePathToServe)) {
                        // Preparing to serve file
                        // Get the original filename with extension, or construct one from the document name
                        let fileName = document.fileName || document.name || path_1.default.basename(document.filePath);
                        // If the fileName doesn't have an extension, add it from the original file path
                        if (!path_1.default.extname(fileName) && document.filePath) {
                            const originalExt = path_1.default.extname(document.filePath);
                            if (originalExt) {
                                fileName += originalExt;
                            }
                        }
                        // Setting file details for download
                        if (isDownload) {
                            res.setHeader('Content-Disposition', `attachment; filename="${fileName}"`);
                        }
                        else {
                            res.setHeader('Content-Disposition', `inline; filename="${fileName}"`);
                        }
                        // Set appropriate content type based on file extension
                        const ext = path_1.default.extname(fileName).toLowerCase();
                        // Setting content type
                        if (ext === '.pdf') {
                            res.setHeader('Content-Type', 'application/pdf');
                        }
                        else if (ext === '.jpg' || ext === '.jpeg') {
                            res.setHeader('Content-Type', 'image/jpeg');
                        }
                        else if (ext === '.png') {
                            res.setHeader('Content-Type', 'image/png');
                        }
                        else if (ext === '.gif') {
                            res.setHeader('Content-Type', 'image/gif');
                        }
                        else if (ext === '.doc' || ext === '.docx') {
                            res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');
                        }
                        else if (ext === '.txt') {
                            res.setHeader('Content-Type', 'text/plain; charset=utf-8');
                        }
                        else {
                            res.setHeader('Content-Type', 'application/octet-stream');
                        }
                        // Production cache busting for documents
                        if (process.env.NODE_ENV === 'production') {
                            const fileStats = fs_1.default.statSync(filePathToServe);
                            res.set({
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0',
                                'ETag': `"${document.id}-${fileStats.mtime.getTime()}"`,
                                'Last-Modified': fileStats.mtime.toUTCString(),
                            });
                        }
                        const totalTime = performance.now() - startTime;
                        logDocumentOperation('FILE_SERVE_SUCCESS', {
                            operationId,
                            documentId,
                            filePath: filePathToServe,
                            fileName,
                            totalRequestTime: `${totalTime.toFixed(2)}ms`,
                            isDownload,
                            fileDetails: {
                                exists: true,
                                resolvedPath: path_1.default.resolve(filePathToServe)
                            }
                        }, 'INFO');
                        return res.sendFile(path_1.default.resolve(filePathToServe));
                    }
                    const totalTime = performance.now() - startTime;
                    logDocumentOperation('FILE_NOT_FOUND_ON_DISK', {
                        operationId,
                        documentId,
                        originalFilePath: document.filePath,
                        attemptedFilePath: filePathToServe,
                        totalRequestTime: `${totalTime.toFixed(2)}ms`,
                        searchedPaths: [
                            path_1.default.join(process.cwd(), 'uploads', document.filePath),
                            path_1.default.join(process.cwd(), document.filePath),
                            `/tmp/uploads/${document.filePath}`
                        ]
                    }, 'ERROR');
                    return res.status(404).json({ message: 'File not found on server' });
                }
                catch (fileError) {
                    console.error('âŒ [DOCUMENT DOWNLOAD] Error serving file:', fileError);
                    return res.status(500).json({ message: 'Failed to serve file' });
                }
            }
            console.log(`âŒ [DOCUMENT DOWNLOAD] No file associated with document ${documentId}`);
            return res.status(404).json({ message: 'No file associated with this document' });
        }
        catch (error) {
            console.error('âŒ [DOCUMENT DOWNLOAD] Error serving document file:', error);
            res.status(500).json({ message: 'Failed to serve document file' });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2RvY3VtZW50cy50cyIsIm1hcHBpbmdzIjoiOzs7OztBQW9LQSx3REF1ekZDO0FBMTlGRCxrQ0FBbUQ7QUFDbkQsd0NBQXFDO0FBQ3JDLGdEQUs2QjtBQUk3Qiw2QkFBd0I7QUFDeEIsb0RBQTRCO0FBQzVCLGdEQUF3QjtBQUN4Qiw0Q0FBb0I7QUFDcEIsb0RBQTRCO0FBQzVCLCtCQUFvQztBQUNwQyw2Q0FBa0M7QUFDbEMsOEJBQTJCO0FBRTNCLG1EQUFtRDtBQUNuRCxNQUFNLGVBQWUsR0FBRztJQUN0QixhQUFhLEVBQUUsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJLEVBQUUsc0NBQXNDO0lBQ3ZFLDJCQUEyQixFQUFFLEVBQUUsRUFBRSxnQkFBZ0I7SUFDakQsa0JBQWtCLEVBQUU7UUFDbEIsaUJBQWlCO1FBQ2pCLG9CQUFvQjtRQUNwQix5RUFBeUU7UUFDekUsMEJBQTBCO1FBQzFCLG1FQUFtRTtRQUNuRSxZQUFZO1FBQ1osWUFBWTtRQUNaLFdBQVc7UUFDWCxXQUFXO0tBQ1o7SUFDRCxrQkFBa0IsRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssQ0FBQztDQUM5RixDQUFDO0FBRUYsb0NBQW9DO0FBQ3BDLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztBQUVwQyxvQ0FBb0M7QUFDcEMsU0FBUyxZQUFZLENBQUMsSUFBUztJQUM3QixJQUFJLENBQUMsSUFBSTtRQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxrQkFBa0IsRUFBRSxDQUFDO0lBRWhFLGtCQUFrQjtJQUNsQixJQUFJLElBQUksQ0FBQyxJQUFJLEdBQUcsZUFBZSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQzlDLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxxQkFBcUIsZUFBZSxDQUFDLGFBQWEsR0FBRyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDakgsQ0FBQztJQUVELGtCQUFrQjtJQUNsQixJQUFJLENBQUMsZUFBZSxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQztRQUNoRSxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsYUFBYSxJQUFJLENBQUMsUUFBUSxjQUFjLEVBQUUsQ0FBQztJQUM3RSxDQUFDO0lBRUQsdUJBQXVCO0lBQ3ZCLE1BQU0sU0FBUyxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM3RSxJQUFJLENBQUMsZUFBZSxDQUFDLGtCQUFrQixDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1FBQzVELE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxtQkFBbUIsU0FBUyxjQUFjLEVBQUUsQ0FBQztJQUMvRSxDQUFDO0lBRUQsNkNBQTZDO0lBQzdDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUM1RyxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQztJQUNoRSxDQUFDO0lBRUQsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztBQUMzQixDQUFDO0FBRUQseUJBQXlCO0FBQ3pCLFNBQVMsb0JBQW9CLENBQUMsTUFBYztJQUMxQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7SUFDdkIsTUFBTSxXQUFXLEdBQUcsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUV4RCx3Q0FBd0M7SUFDeEMsTUFBTSxhQUFhLEdBQUcsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFNBQWlCLEVBQUUsRUFBRSxDQUFDLEdBQUcsR0FBRyxTQUFTLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztJQUVsRyxJQUFJLGFBQWEsQ0FBQyxNQUFNLElBQUksZUFBZSxDQUFDLDJCQUEyQixFQUFFLENBQUM7UUFDeEUsT0FBTyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLHFEQUFxRCxFQUFFLENBQUM7SUFDMUYsQ0FBQztJQUVELGlCQUFpQjtJQUNqQixhQUFhLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3hCLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsYUFBYSxDQUFDLENBQUM7SUFFN0MsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztBQUMzQixDQUFDO0FBRUQsMkRBQTJEO0FBQzNELE1BQU0sTUFBTSxHQUFHLElBQUEsZ0JBQU0sRUFBQztJQUNwQixJQUFJLEVBQUUsZUFBZTtJQUNyQixNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsZUFBZSxDQUFDLGFBQWE7UUFDdkMsS0FBSyxFQUFFLENBQUMsRUFBRSxnQ0FBZ0M7S0FDM0M7SUFDRCxVQUFVLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFO1FBQzVCLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN0QyxJQUFJLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUN2QixFQUFFLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ2pCLENBQUM7YUFBTSxDQUFDO1lBQ04sRUFBRSxDQUFDLElBQUksS0FBSyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLENBQUM7SUFDSCxDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsd0VBQXdFO0FBQ3hFLE1BQU0sbUJBQW1CLEdBQUc7SUFDMUIsT0FBTztJQUNQLFdBQVc7SUFDWCxhQUFhO0lBQ2IsT0FBTztJQUNQLGlCQUFpQjtJQUNqQixXQUFXO0lBQ1gsV0FBVztJQUNYLFNBQVM7SUFDVCxZQUFZO0lBQ1osT0FBTztJQUNQLGdCQUFnQjtJQUNoQixXQUFXO0lBQ1gsT0FBTztDQUNDLENBQUM7QUFFWCxnREFBZ0Q7QUFDaEQsTUFBTSxvQkFBb0IsR0FBRyw2QkFBb0IsQ0FBQyxNQUFNLENBQUM7SUFDdkQsUUFBUSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUM7SUFDckMsS0FBSyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQztJQUNqQyxXQUFXLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUNsQyxrQkFBa0IsRUFBRSxPQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztDQUMvQyxDQUFDLENBQUM7QUFFSCxNQUFNLDRCQUE0QixHQUFHLDZCQUFvQixDQUFDLE1BQU0sQ0FBQztJQUMvRCxJQUFJLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztJQUNqQyxLQUFLLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQzVDLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ25DLENBQUMsQ0FBQztBQUVILE1BQU0sNEJBQTRCLEdBQUcsNkJBQW9CLENBQUMsTUFBTSxDQUFDO0lBQy9ELElBQUksRUFBRSxPQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQ2pDLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDNUMsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7Q0FDbkMsQ0FBQyxDQUFDO0FBRUgscUNBQXFDO0FBQ3JDLE1BQU0sMEJBQTBCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUMxQyxJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDO0lBQ2hDLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ2xDLFlBQVksRUFBRSxPQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDO0lBQ3pDLGtCQUFrQixFQUFFLE9BQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDO0lBQzlDLFdBQVcsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ3pDLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ3hDLGNBQWMsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQ3JDLFlBQVksRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQ3BDLENBQUMsQ0FBQztBQUVIOzs7R0FHRztBQUNIOzs7O0dBSUc7QUFDSCxTQUFnQixzQkFBc0IsQ0FBQyxHQUFZO0lBQ2pELE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxxQ0FBcUMsQ0FBQyxDQUFDO0lBRS9FLHlCQUF5QjtJQUN6QixNQUFNLFFBQVEsR0FRVCxFQUFFLENBQUM7SUFFUiwwQ0FBMEM7SUFDMUMsTUFBTSxRQUFRLEdBQXlFLEVBQUUsQ0FBQztJQUUxRiw2REFBNkQ7SUFDN0QsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLE1BQWMsRUFBRSxJQUFTLEVBQUUsT0FBZ0IsRUFBRSxVQUFtQixFQUFFLE9BQWEsRUFBRSxFQUFFO1FBQzNHLE1BQU0sS0FBSyxHQUFHO1lBQ1osU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO1lBQ25DLE1BQU07WUFDTixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUU7WUFDZixRQUFRLEVBQUUsSUFBSSxDQUFDLElBQUk7WUFDbkIsVUFBVTtZQUNWLE9BQU87WUFDUCxPQUFPO1NBQ1IsQ0FBQztRQUVGLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckIsSUFBSSxRQUFRLENBQUMsTUFBTSxHQUFHLElBQUk7WUFBRSxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUMsQ0FBQyx3QkFBd0I7UUFFdEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsTUFBTSxHQUFHLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbEQsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDLENBQUM7SUFFRiwwREFBMEQ7SUFDMUQsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLFNBQWlCLEVBQUUsSUFBUyxFQUFFLFFBQTZDLE1BQU0sRUFBRSxFQUFFO1FBQ2pILE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0MsTUFBTSxRQUFRLEdBQUc7WUFDZixTQUFTO1lBQ1QsU0FBUztZQUNULEtBQUs7WUFDTCxJQUFJLEVBQUUsT0FBTyxJQUFJLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7U0FDdEUsQ0FBQztRQUVGLE1BQU0sS0FBSyxHQUFHO1lBQ1osSUFBSSxFQUFFLElBQUk7WUFDVixLQUFLLEVBQUUsR0FBRztZQUNWLEtBQUssRUFBRSxJQUFJO1lBQ1gsSUFBSSxFQUFFLElBQUk7U0FDWCxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRVQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFNBQVMsS0FBSyxLQUFLLGNBQWMsU0FBUyxDQUFDLFdBQVcsRUFBRSxLQUFLLEtBQUssR0FBRyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQzdGLE9BQU8sUUFBUSxDQUFDO0lBQ2xCLENBQUMsQ0FBQztJQUVGLHdDQUF3QztJQUN4QyxNQUFNLHNCQUFzQixHQUFHLEtBQUssSUFBSSxFQUFFO1FBQ3hDLElBQUksQ0FBQztZQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsa0JBQWtCLENBQUMsQ0FBQztZQUN2RCxPQUFPO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLE1BQU0sRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztnQkFDdEIsYUFBYSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSzthQUNsRSxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTztnQkFDTCxPQUFPLEVBQUUsS0FBSztnQkFDZCxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3BCLGFBQWEsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEtBQUs7YUFDbEUsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRixNQUFNLGVBQWUsR0FBRyxLQUFLLElBQUksRUFBRTtRQUNqQyxJQUFJLENBQUM7WUFDSCxzQ0FBc0M7WUFDdEMsTUFBTSxNQUFNLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7OztPQUlsQyxDQUFDLENBQUM7WUFDSCxPQUFPO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLGNBQWMsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLGNBQWMsSUFBSSxDQUFDO2FBQ3BELENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPO2dCQUNMLE9BQU8sRUFBRSxLQUFLO2dCQUNkLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDcEIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLLEVBQUUsU0FBUyxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsR0FBRyxLQUFLO2FBQzlDLENBQUM7UUFDSixDQUFDO0lBQ0gsQ0FBQyxDQUFDO0lBRUYsTUFBTSxlQUFlLEdBQUcsS0FBSyxJQUFJLEVBQUU7UUFDakMsSUFBSSxDQUFDO1lBQ0gsMENBQTBDO1lBQzFDLE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7Ozs7OztPQVNsQyxDQUFDLENBQUM7WUFDSCxPQUFPO2dCQUNMLE9BQU8sRUFBRSxJQUFJO2dCQUNiLHNCQUFzQixFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQzthQUM5RCxDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTztnQkFDTCxPQUFPLEVBQUUsS0FBSztnQkFDZCxLQUFLLEVBQUUsS0FBSyxDQUFDLE9BQU87YUFDckIsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDLENBQUM7SUFFRixNQUFNLDBCQUEwQixHQUFHLEtBQUssSUFBSSxFQUFFO1FBQzVDLElBQUksQ0FBQztZQUNILHdDQUF3QztZQUN4QyxNQUFNLFNBQVMsR0FBRyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLDREQUE0RCxDQUFDLENBQUM7WUFDcEcsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSxvRUFBb0UsQ0FBQyxDQUFDO1lBQzNHLE1BQU0sU0FBUyxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEseUVBQXlFLENBQUMsQ0FBQztZQUVqSCx5Q0FBeUM7WUFDekMsTUFBTSxXQUFXLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7Ozs7O09BTXZDLENBQUMsQ0FBQztZQUVILHlEQUF5RDtZQUN6RCxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7Ozs7T0FNcEMsQ0FBQyxDQUFDO1lBRUgsT0FBTztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixLQUFLLEVBQUU7b0JBQ0wsV0FBVyxFQUFFLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUM7b0JBQzFDLG1CQUFtQixFQUFFLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUM7b0JBQ2pELFdBQVcsRUFBRSxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDO29CQUMxQyxpQkFBaUIsRUFBRSxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU07aUJBQzNDO2dCQUNELFlBQVksRUFBRSxXQUFXLENBQUMsSUFBSTtnQkFDOUIsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsSUFBSSxJQUFJO2FBQzNDLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPO2dCQUNMLE9BQU8sRUFBRSxLQUFLO2dCQUNkLEtBQUssRUFBRSxLQUFLLENBQUMsT0FBTzthQUNyQixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUMsQ0FBQztJQUVGLG9EQUFvRDtJQUNwRCxHQUFHLENBQUMsSUFBSSxDQUFDLDZCQUE2QixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDekQsSUFBSSxDQUFDO1lBQ0gsK0NBQStDO1lBQy9DLE1BQU0sU0FBUyxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7T0FJckMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRS9ELElBQUksVUFBVSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNuQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixLQUFLLEVBQUUsdURBQXVEO29CQUM5RCxXQUFXLEVBQUUsVUFBVTtpQkFDeEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDhDQUE4QztZQUM5QyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOztPQUVuQixDQUFDLENBQUM7WUFFSCxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSx3Q0FBd0M7Z0JBQ2pELG1CQUFtQixFQUFFLElBQUk7Z0JBQ3pCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDhCQUE4QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3JELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixLQUFLLEVBQUUscUJBQXFCO2dCQUM1QixPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3RCLFVBQVUsRUFBRSw2Q0FBNkM7YUFDMUQsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsc0NBQXNDO0lBQ3RDLEdBQUcsQ0FBQyxJQUFJLENBQUMsK0JBQStCLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUMzRCxJQUFJLENBQUM7WUFDSCxnREFBZ0Q7WUFDaEQsTUFBTSxXQUFXLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7Ozs7T0FLdkMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxXQUFXLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDbEMsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDO29CQUNkLE9BQU8sRUFBRSwyQ0FBMkM7b0JBQ3BELFlBQVksRUFBRSxNQUFNO29CQUNwQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7aUJBQ3BDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCx1RUFBdUU7WUFDdkUsSUFBSSxVQUFVLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7T0FFcEMsQ0FBQyxDQUFDO1lBRUgsSUFBSSxjQUFzQixDQUFDO1lBQzNCLElBQUksZ0JBQXdCLENBQUM7WUFFN0IsSUFBSSxVQUFVLENBQUMsSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDakMsK0NBQStDO2dCQUMvQyxjQUFjLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDckMsZ0JBQWdCLEdBQUcsc0JBQXNCLENBQUM7Z0JBQzFDLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7O29CQUVSLGNBQWMsS0FBSyxnQkFBZ0I7U0FDOUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLGNBQWMsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQVksQ0FBQztnQkFDakQsZ0JBQWdCLEdBQUcsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFjLENBQUM7WUFDdkQsQ0FBQztZQUVELDREQUE0RDtZQUM1RCxNQUFNLFlBQVksR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRTtnQkFDL0MsTUFBTSxNQUFNLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDbkMsT0FBTyxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7b0JBRVQsTUFBTSxLQUFLLElBQUksQ0FBQyxFQUFFLEtBQUssY0FBYyxLQUFLLElBQUksQ0FBQyxJQUFJO1NBQzlELENBQUMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRWhDLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLDRDQUE0QztnQkFDckQsWUFBWSxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsTUFBTTtnQkFDckMsZUFBZSxFQUFFLGNBQWM7Z0JBQy9CLGlCQUFpQixFQUFFLGdCQUFnQjtnQkFDbkMsWUFBWSxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDckYsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMseUNBQXlDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSx1Q0FBdUM7Z0JBQzlDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILCtCQUErQjtJQUMvQixHQUFHLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDL0QsSUFBSSxDQUFDO1lBQ0gsOENBQThDO1lBQzlDLE1BQU0sU0FBUyxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7O09BS3JDLENBQUMsQ0FBQztZQUVILE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFbkUsaUVBQWlFO1lBQ2pFLE1BQU0sYUFBYSxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7T0FJekMsQ0FBQyxDQUFDO1lBRUgsNkVBQTZFO1lBQzdFLHNFQUFzRTtZQUN0RSxNQUFNLGdCQUFnQixHQUFHLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLGNBQWMsRUFBRSxhQUFhLEVBQUUsZUFBZSxDQUFDLENBQUM7WUFFcEgsd0NBQXdDO1lBQ3hDLE1BQU0sWUFBWSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsaUJBQWlCLENBQUMsS0FBSyxJQUFJLENBQUMsU0FBUyxDQUFDLGdCQUFnQixDQUFDLENBQUM7WUFFNUYsSUFBSSxZQUFZLEVBQUUsQ0FBQztnQkFDakIsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDO29CQUNkLE9BQU8sRUFBRSxzQ0FBc0M7b0JBQy9DLGNBQWMsRUFBRSxpQkFBaUI7b0JBQ2pDLGFBQWEsRUFBRSxnQkFBZ0I7b0JBQy9CLGdCQUFnQixFQUFFLEtBQUs7aUJBQ3hCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCw2Q0FBNkM7WUFDN0MsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSw4SEFBOEgsQ0FBQyxDQUFDO1lBRXBKLDRDQUE0QztZQUM1QyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7O09BSW5CLENBQUMsQ0FBQztZQUVILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7T0FJbkIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7OztPQUluQixDQUFDLENBQUM7WUFFSCwyQ0FBMkM7WUFDM0MsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSxxQkFBcUIsQ0FBQyxDQUFDO1lBQzNDLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsOENBQThDLENBQUMsQ0FBQztZQUVwRSxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxzQ0FBc0M7Z0JBQy9DLFVBQVUsRUFBRSxpQkFBaUI7Z0JBQzdCLFVBQVUsRUFBRSxnQkFBZ0I7Z0JBQzVCLGVBQWUsRUFBRSxhQUFhLENBQUMsSUFBSTtnQkFDbkMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDdkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSx1QkFBdUI7Z0JBQzlCLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsVUFBVSxFQUFFLDREQUE0RDtnQkFDeEUsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILHdDQUF3QztJQUN4QyxHQUFHLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDdkUsSUFBSSxDQUFDO1lBQ0gsb0RBQW9EO1lBQ3BELE1BQU0saUJBQWlCLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7OztPQUk3QyxDQUFDLENBQUM7WUFFSCx3RUFBd0U7WUFDeEUsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O09BR25CLENBQUMsQ0FBQztZQUVILCtEQUErRDtZQUMvRCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7Ozs7Ozs7T0FVNUMsQ0FBQyxDQUFDO1lBRUgsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxPQUFPLEVBQUUsd0RBQXdEO2dCQUNqRSxnQkFBZ0IsRUFBRSxpQkFBaUIsQ0FBQyxJQUFJO2dCQUN4QyxzQkFBc0IsRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJO2dCQUM3QyxTQUFTLEVBQUUsK0VBQStFO2dCQUMxRixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDcEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyx3Q0FBd0MsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUMvRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsS0FBSyxFQUFFLHNDQUFzQztnQkFDN0MsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO2dCQUN0QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDcEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsc0RBQXNEO0lBQ3RELEdBQUcsQ0FBQyxJQUFJLENBQUMsNENBQTRDLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN4RSxJQUFJLENBQUM7WUFDSCxnRUFBZ0U7WUFDaEUsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O09BR25CLENBQUMsQ0FBQztZQUVILG9CQUFvQjtZQUNwQixNQUFNLFlBQVksR0FBRyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7O09BSXhDLENBQUMsQ0FBQztZQUVILEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLDBEQUEwRDtnQkFDbkUsZUFBZSxFQUFFLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsY0FBYztnQkFDckQsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsd0NBQXdDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSx1Q0FBdUM7Z0JBQzlDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILG1EQUFtRDtJQUNuRCxHQUFHLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDbkUsSUFBSSxDQUFDO1lBQ0gsaURBQWlEO1lBQ2pELE1BQU0sZUFBZSxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7T0FJM0MsQ0FBQyxDQUFDO1lBRUgsTUFBTSxVQUFVLEdBQUcsZUFBZSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFFL0MsSUFBSSxVQUFVLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ3JCLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQztvQkFDZCxPQUFPLEVBQUUsNkNBQTZDO29CQUN0RCxXQUFXLEVBQUUsQ0FBQztvQkFDZCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7aUJBQ3BDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCwwQ0FBMEM7WUFDMUMsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7OztPQUluQixDQUFDLENBQUM7WUFFSCx1REFBdUQ7WUFDdkQsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7U0FJbkIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsbUNBQW1DO1lBQ3JDLENBQUM7WUFFRCxtQ0FBbUM7WUFDbkMsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7T0FFbkIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7T0FFbkIsQ0FBQyxDQUFDO1lBRUgsNENBQTRDO1lBQzVDLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7T0FJbkIsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7U0FJbkIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsd0JBQXdCO1lBQzFCLENBQUM7WUFFRCxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7OztTQUluQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDWCx3QkFBd0I7WUFDMUIsQ0FBQztZQUVELElBQUksQ0FBQztnQkFDSCxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7O1NBSW5CLENBQUMsQ0FBQztZQUNMLENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLHlCQUF5QjtZQUMzQixDQUFDO1lBRUQsd0JBQXdCO1lBQ3hCLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEseUJBQXlCLENBQUMsQ0FBQztZQUUvQyxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSw0Q0FBNEM7Z0JBQ3JELGNBQWMsRUFBRSxlQUFlLENBQUMsSUFBSTtnQkFDcEMsV0FBVyxFQUFFLFVBQVU7Z0JBQ3ZCLGVBQWUsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxjQUFjLEVBQUUsYUFBYSxFQUFFLGVBQWUsQ0FBQztnQkFDM0csU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMseUNBQXlDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDaEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSxpQ0FBaUM7Z0JBQ3hDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILHlDQUF5QztJQUN6QyxHQUFHLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDekUsSUFBSSxDQUFDO1lBQ0gsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBRW5CLGlDQUFpQztZQUNqQyxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O1NBR25CLENBQUMsQ0FBQztnQkFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDN0MsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQzNDLENBQUM7WUFFRCwyREFBMkQ7WUFDM0QsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7OztTQUduQixDQUFDLENBQUM7Z0JBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1lBQ3ZFLENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMseUNBQXlDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLENBQUM7WUFFRCwrQkFBK0I7WUFDL0IsTUFBTSxhQUFhLEdBQUcsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7Ozs7Ozs7OztPQVV6QyxDQUFDLENBQUM7WUFFSCxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSwrQkFBK0I7Z0JBQ3hDLFVBQVUsRUFBRSxPQUFPO2dCQUNuQixzQkFBc0IsRUFBRSxhQUFhLENBQUMsSUFBSTtnQkFDMUMsU0FBUyxFQUFFLHlCQUF5QjtnQkFDcEMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDNUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSxvQ0FBb0M7Z0JBQzNDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2FBQ3BDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILCtDQUErQztJQUMvQyxHQUFHLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDakUsSUFBSSxDQUFDO1lBQ0gsTUFBTSxPQUFPLEdBQUcsRUFBRSxDQUFDO1lBRW5CLDZCQUE2QjtZQUM3QixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O1NBR25CLENBQUMsQ0FBQztnQkFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxDQUFDLENBQUM7WUFDeEQsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDMUQsQ0FBQztZQUVELHVEQUF1RDtZQUN2RCxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O1NBR25CLENBQUMsQ0FBQztnQkFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLGlFQUFpRSxDQUFDLENBQUM7WUFDbEYsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyx3REFBd0QsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDcEYsQ0FBQztZQUVELG1DQUFtQztZQUNuQyxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQTs7O1NBR25CLENBQUMsQ0FBQztnQkFDSCxPQUFPLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7WUFDOUQsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDaEUsQ0FBQztZQUVELEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLDZCQUE2QjtnQkFDdEMsVUFBVSxFQUFFLE9BQU87Z0JBQ25CLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDZCQUE2QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3BELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixLQUFLLEVBQUUsNEJBQTRCO2dCQUNuQyxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3RCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTthQUNwQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCx5Q0FBeUM7SUFDekMsR0FBRyxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ2pFLElBQUksQ0FBQztZQUNILE1BQU0sT0FBTyxHQUFHLEVBQUUsQ0FBQztZQUVuQixtREFBbUQ7WUFDbkQsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsa0RBQWtELENBQUMsQ0FBQztnQkFDeEUsT0FBTyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUMzQyxDQUFDO1lBRUQsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsNEVBQTRFLENBQUMsQ0FBQztnQkFDbEcsT0FBTyxDQUFDLElBQUksQ0FBQyx3REFBd0QsQ0FBQyxDQUFDO1lBQ3pFLENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMseUNBQXlDLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLENBQUM7WUFFRCxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSx3REFBd0QsQ0FBQyxDQUFDO2dCQUM5RSxPQUFPLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUM7WUFDckQsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDakQsQ0FBQztZQUVELCtDQUErQztZQUMvQyxNQUFNLFVBQVUsR0FBRyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLDBEQUEwRCxDQUFDLENBQUM7WUFDbkcsTUFBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQzFELElBQUksVUFBVSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNuQixNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLHNEQUFzRCxDQUFDLENBQUM7Z0JBQzVFLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxVQUFVLHVCQUF1QixDQUFDLENBQUM7WUFDaEUsQ0FBQztZQUVELElBQUksQ0FBQztnQkFDSCxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLDZGQUE2RixDQUFDLENBQUM7Z0JBQ25ILE9BQU8sQ0FBQyxJQUFJLENBQUMsbURBQW1ELENBQUMsQ0FBQztZQUNwRSxDQUFDO1lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBRUQsbURBQW1EO1lBQ25ELElBQUksQ0FBQztnQkFDSCxzQkFBc0I7Z0JBQ3RCLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsOENBQThDLENBQUMsQ0FBQztnQkFFcEUsc0NBQXNDO2dCQUN0QyxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7OztTQUtuQixDQUFDLENBQUM7Z0JBRUgsb0JBQW9CO2dCQUNwQixNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLGdGQUFnRixDQUFDLENBQUM7Z0JBQ3RHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsdUhBQXVILENBQUMsQ0FBQztnQkFDN0ksTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSxzRkFBc0YsQ0FBQyxDQUFDO2dCQUU1RyxJQUFJLENBQUM7b0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSwyRkFBMkYsQ0FBQyxDQUFDO29CQUNqSCxPQUFPLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7Z0JBQ2xELENBQUM7Z0JBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztvQkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztnQkFDakQsQ0FBQztnQkFFRCxnQkFBZ0I7Z0JBQ2hCLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEseUJBQXlCLENBQUMsQ0FBQztnQkFFL0MsT0FBTyxDQUFDLElBQUksQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO1lBQ3hELENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQ25ELENBQUM7WUFFRCxpQ0FBaUM7WUFDakMsSUFBSSxDQUFDO2dCQUNILE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUEsMERBQTBELENBQUMsQ0FBQztnQkFDaEYsT0FBTyxDQUFDLElBQUksQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1lBQzFELENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsK0JBQStCLENBQUMsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDO1lBQzNELENBQUM7WUFFRCxJQUFJLENBQUM7Z0JBQ0gsTUFBTSxPQUFFLENBQUMsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSxvRkFBb0YsQ0FBQyxDQUFDO2dCQUMxRyxPQUFPLENBQUMsSUFBSSxDQUFDLG1FQUFtRSxDQUFDLENBQUM7WUFDcEYsQ0FBQztZQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7Z0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyx5REFBeUQsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDckYsQ0FBQztZQUVELElBQUksQ0FBQztnQkFDSCxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBLGdFQUFnRSxDQUFDLENBQUM7Z0JBQ3RGLE9BQU8sQ0FBQyxJQUFJLENBQUMsK0NBQStDLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUNqRSxDQUFDO1lBRUQsMkVBQTJFO1lBQzNFLElBQUksQ0FBQztnQkFDSCxNQUFNLE9BQUUsQ0FBQyxPQUFPLENBQUMsSUFBQSxpQkFBRyxFQUFBOzs7U0FHbkIsQ0FBQyxDQUFDO2dCQUNILE9BQU8sQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztZQUM3RCxDQUFDO1lBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztnQkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLG9DQUFvQyxDQUFDLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUNoRSxDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxPQUFPLEVBQUUsMENBQTBDO2dCQUNuRCxVQUFVLEVBQUUsT0FBTztnQkFDbkIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2dCQUNuQyxPQUFPLEVBQUUsSUFBSTthQUNkLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsd0NBQXdDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSwrQkFBK0I7Z0JBQ3RDLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2dCQUNuQyxPQUFPLEVBQUUsS0FBSzthQUNmLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILDBEQUEwRDtJQUMxRCxHQUFHLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDdEQsSUFBSSxDQUFDO1lBQ0gsa0NBQWtDO1lBQ2xDLElBQUksV0FBVyxHQUFHLEtBQUssQ0FBQztZQUN4QixJQUFJLFdBQVcsR0FBRyxJQUFJLENBQUM7WUFFdkIsSUFBSSxDQUFDO2dCQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sT0FBRSxDQUFDLE9BQU8sQ0FBQyxJQUFBLGlCQUFHLEVBQUE7Ozs7O1NBS2xDLENBQUMsQ0FBQztnQkFDSCxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO2dCQUNyQyxXQUFXLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQztZQUM1QixDQUFDO1lBQUMsT0FBTyxXQUFXLEVBQUUsQ0FBQztnQkFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQkFBcUIsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUNwRCxDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxPQUFPLEVBQUUseUJBQXlCO2dCQUNsQyxZQUFZLEVBQUUsSUFBSTtnQkFDbEIsbUJBQW1CLEVBQUUsSUFBSTtnQkFDekIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO2dCQUNuQyxXQUFXLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRO2dCQUNqQyxPQUFPLEVBQUUsbUJBQW1CO2dCQUM1QixhQUFhLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLGdCQUFnQjtnQkFDbkQsY0FBYyxFQUFFO29CQUNkLE1BQU0sRUFBRSxDQUFDLENBQUMsaUJBQU87b0JBQ2pCLElBQUksRUFBRSxpQkFBTyxFQUFFLFdBQVcsRUFBRSxJQUFJO29CQUNoQyxPQUFPLEVBQUUsTUFBTSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsaUJBQU8sSUFBSSxFQUFFLENBQUMsQ0FBQztpQkFDMUU7Z0JBQ0QsZUFBZSxFQUFFO29CQUNmLHNCQUFzQixFQUFFLFdBQVc7b0JBQ25DLHNCQUFzQixFQUFFLFdBQVc7b0JBQ25DLG9CQUFvQixFQUFFLFdBQVcsRUFBRSxNQUFNLElBQUksQ0FBQztvQkFDOUMsZUFBZSxFQUFFLE1BQU0sc0JBQXNCLEVBQUU7b0JBQy9DLGlCQUFpQixFQUFFLE1BQU0sZUFBZSxFQUFFO29CQUMxQyxVQUFVLEVBQUUsTUFBTSxlQUFlLEVBQUU7b0JBQ25DLHVCQUF1QixFQUFFLE1BQU0sMEJBQTBCLEVBQUU7aUJBQzVEO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNwRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO2FBQ3ZCLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILHVCQUF1QjtJQUN2QixNQUFNLFFBQVEsR0FBRyxDQUFDLFFBQWdCLEVBQUUsS0FBVSxFQUFFLElBQVUsRUFBRSxFQUFFO1FBQzVELE1BQU0sVUFBVSxHQUFHO1lBQ2pCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTtZQUNuQyxRQUFRO1lBQ1IsS0FBSyxFQUFFO2dCQUNMLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7Z0JBQ2hCLE9BQU8sRUFBRSxLQUFLLENBQUMsUUFBUSxFQUFFO2FBQzFCO1lBQ0QsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJO1NBQ3JELENBQUM7UUFFRixRQUFRLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzFCLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxFQUFFO1lBQUUsUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsMkJBQTJCO1FBRXZFLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxVQUFVLENBQUMsU0FBUyxpQkFBaUIsUUFBUSxHQUFHLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDaEYsT0FBTyxVQUFVLENBQUM7SUFDcEIsQ0FBQyxDQUFDO0lBRUYsK0NBQStDO0lBQy9DLEdBQUcsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQzdELE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0Msb0JBQW9CLENBQUMsY0FBYyxFQUFFO1lBQ25DLE1BQU0sRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDcEIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSTtZQUN4QixLQUFLLEVBQUUsR0FBRyxDQUFDLEtBQUs7WUFDaEIsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHO1lBQ1osTUFBTSxFQUFFLEdBQUcsQ0FBQyxNQUFNO1lBQ2xCLE9BQU8sRUFBRTtnQkFDUCxXQUFXLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxjQUFjLENBQUM7Z0JBQ3hDLFNBQVMsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztnQkFDcEMsT0FBTyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsT0FBTzthQUM3QjtTQUNGLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFFWCxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ3RCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDM0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUV2Qiw2QkFBNkI7WUFDN0Isb0JBQW9CLENBQUMsaUJBQWlCLEVBQUU7Z0JBQ3RDLE1BQU07Z0JBQ04sUUFBUTtnQkFDUixZQUFZLEVBQUUsQ0FBQyxDQUFDLElBQUk7Z0JBQ3BCLFdBQVcsRUFBRTtvQkFDWCxhQUFhLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxPQUFPO29CQUM1QixlQUFlLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJO2lCQUM1QjthQUNGLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixzREFBc0Q7WUFDdEQsb0JBQW9CLENBQUMsb0JBQW9CLEVBQUU7Z0JBQ3pDLGFBQWEsRUFBRSxDQUFDLENBQUMsaUJBQU87Z0JBQ3hCLFdBQVcsRUFBRSxpQkFBTyxFQUFFLFdBQVcsRUFBRSxJQUFJO2dCQUN2QyxhQUFhLEVBQUUsT0FBTyxpQkFBTyxFQUFFLFlBQVk7Z0JBQzNDLGtCQUFrQixFQUFFO29CQUNsQixLQUFLLEVBQUUsQ0FBQyxDQUFDLE9BQUU7b0JBQ1gsZ0JBQWdCLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsR0FBRyxLQUFLO2lCQUNyRTthQUNGLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDWixNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLElBQWMsQ0FBQyxDQUFDLGdEQUFnRDtZQUMvRixNQUFNLG1CQUFtQixHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsV0FBcUIsQ0FBQyxDQUFDLCtCQUErQjtZQUM1RixNQUFNLGtCQUFrQixHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsVUFBb0IsQ0FBQyxDQUFDLDhCQUE4QjtZQUN6RixNQUFNLGNBQWMsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLGNBQXdCLENBQUMsQ0FBQyxpQ0FBaUM7WUFDNUYsTUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxZQUFzQixDQUFDLENBQUMsK0JBQStCO1lBRXRGLHVEQUF1RDtZQUN2RCxvQkFBb0IsQ0FBQyx1QkFBdUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRW5FLG9CQUFvQixDQUFDLDJCQUEyQixFQUFFLEVBQUUsTUFBTSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDdkUsTUFBTSxrQkFBa0IsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDN0MsTUFBTSxhQUFhLEdBQUcsTUFBTSxpQkFBTyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pFLE1BQU0saUJBQWlCLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLGtCQUFrQixDQUFDO1lBQ2pFLG9CQUFvQixDQUFDLDhCQUE4QixFQUFFO2dCQUNuRCxLQUFLLEVBQUUsYUFBYSxDQUFDLE1BQU07Z0JBQzNCLGFBQWEsRUFBRSxHQUFHLGlCQUFpQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSTtnQkFDbEQsYUFBYSxFQUFFLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFRLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsR0FBRyxDQUFDLGNBQWMsRUFBRSxJQUFJLEVBQUUsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQzthQUN6RyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRVosb0JBQW9CLENBQUMsd0JBQXdCLEVBQUUsRUFBRSxNQUFNLEVBQUUsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUNwRSxNQUFNLGVBQWUsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDMUMsTUFBTSxjQUFjLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9ELE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxlQUFlLENBQUM7WUFDM0Qsb0JBQW9CLENBQUMsMkJBQTJCLEVBQUU7Z0JBQ2hELEtBQUssRUFBRSxjQUFjLENBQUMsTUFBTTtnQkFDNUIsYUFBYSxFQUFFLEdBQUcsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSTtnQkFDL0MsWUFBWSxFQUFFLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFPLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO2FBQzlFLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixvQkFBb0IsQ0FBQyxtQkFBbUIsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDdkQsTUFBTSxjQUFjLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sU0FBUyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUMvQyxNQUFNLGFBQWEsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsY0FBYyxDQUFDO1lBQ3pELG9CQUFvQixDQUFDLHNCQUFzQixFQUFFO2dCQUMzQyxLQUFLLEVBQUUsU0FBUyxDQUFDLE1BQU07Z0JBQ3ZCLGFBQWEsRUFBRSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQzlDLFdBQVcsRUFBRSxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQzthQUN0QyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRVosTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUM5RixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksU0FBUyxrQ0FBa0MsRUFBRSxjQUFjLENBQUMsQ0FBQztZQUU3RSxtRUFBbUU7WUFDbkUsSUFBSSxZQUFzQixDQUFDO1lBQzNCLElBQUksbUJBQW1CLEVBQUUsQ0FBQztnQkFDeEIsNENBQTRDO2dCQUM1QyxJQUFJLFFBQVEsS0FBSyxPQUFPLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRSxDQUFDO29CQUNuRCxZQUFZLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO2dCQUN2QyxDQUFDO3FCQUFNLENBQUM7b0JBQ04sb0RBQW9EO29CQUNwRCx5RUFBeUU7b0JBQ3pFLE1BQU0sU0FBUyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFPLEVBQUUsRUFBRTt3QkFDaEQsMEJBQTBCO3dCQUMxQixJQUFJLEVBQUUsQ0FBQyxXQUFXLEtBQUssbUJBQW1CLEVBQUUsQ0FBQzs0QkFDM0MsT0FBTyxJQUFJLENBQUM7d0JBQ2QsQ0FBQzt3QkFDRCxrQ0FBa0M7d0JBQ2xDLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBRSxXQUFXLEtBQUssbUJBQW1CLEVBQUUsQ0FBQzs0QkFDMUQsT0FBTyxJQUFJLENBQUM7d0JBQ2QsQ0FBQzt3QkFDRCxvQ0FBb0M7d0JBQ3BDLElBQUksRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFLEtBQUssbUJBQW1CLEVBQUUsQ0FBQzs0QkFDN0MsT0FBTyxJQUFJLENBQUM7d0JBQ2QsQ0FBQzt3QkFDRCxPQUFPLEtBQUssQ0FBQztvQkFDZixDQUFDLENBQUMsQ0FBQztvQkFDSCxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7d0JBQ2YsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxpQ0FBaUMsRUFBRSxDQUFDLENBQUM7b0JBQzlFLENBQUM7b0JBQ0QsWUFBWSxHQUFHLENBQUMsbUJBQW1CLENBQUMsQ0FBQztnQkFDdkMsQ0FBQztZQUNILENBQUM7aUJBQU0sQ0FBQztnQkFDTixnRUFBZ0U7Z0JBQ2hFLFlBQVksR0FBRyxjQUFjO3FCQUMxQixHQUFHLENBQUMsQ0FBQyxFQUFPLEVBQUUsRUFBRTtvQkFDZiwwQkFBMEI7b0JBQzFCLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRSxDQUFDO3dCQUNuQixPQUFPLEVBQUUsQ0FBQyxXQUFXLENBQUM7b0JBQ3hCLENBQUM7b0JBQ0Qsa0NBQWtDO29CQUNsQyxJQUFJLEVBQUUsQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLENBQUM7d0JBQ2xDLE9BQU8sRUFBRSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUM7b0JBQ3RDLENBQUM7b0JBQ0Qsb0NBQW9DO29CQUNwQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRSxFQUFFLENBQUM7d0JBQ3JCLE9BQU8sRUFBRSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7b0JBQ3pCLENBQUM7b0JBQ0QsT0FBTyxJQUFJLENBQUM7Z0JBQ2QsQ0FBQyxDQUFDO3FCQUNELE1BQU0sQ0FBQyxDQUFDLEVBQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxDQUFDO1lBQ3RDLENBQUM7WUFFRCxNQUFNLFdBQVcsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFL0MsTUFBTSxrQkFBa0IsR0FBVSxFQUFFLENBQUM7WUFFckMsK0JBQStCO1lBQy9CLE1BQU0sT0FBTyxHQUFRO2dCQUNuQixNQUFNO2dCQUNOLFFBQVE7YUFDVCxDQUFDO1lBRUYsMkNBQTJDO1lBQzNDLElBQUksbUJBQW1CLEVBQUUsQ0FBQztnQkFDeEIsT0FBTyxDQUFDLFdBQVcsR0FBRyxtQkFBbUIsQ0FBQztZQUM1QyxDQUFDO1lBRUQsMENBQTBDO1lBQzFDLElBQUksa0JBQWtCLEVBQUUsQ0FBQztnQkFDdkIsT0FBTyxDQUFDLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQztZQUMxQyxDQUFDO2lCQUFNLElBQUksWUFBWSxLQUFLLFVBQVUsRUFBRSxDQUFDO2dCQUN2QyxpRUFBaUU7Z0JBQ2pFLElBQUksV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDM0IsMkZBQTJGO2dCQUM3RixDQUFDO1lBQ0gsQ0FBQztpQkFBTSxJQUFJLFlBQVksS0FBSyxVQUFVLEVBQUUsQ0FBQztnQkFDdkMsa0VBQWtFO2dCQUNsRSxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQzVCLHNEQUFzRDtnQkFDeEQsQ0FBQztZQUNILENBQUM7WUFFRCxpRUFBaUU7WUFDakUsb0JBQW9CLENBQUMsMkJBQTJCLEVBQUU7Z0JBQ2hELE9BQU87Z0JBQ1AsZUFBZSxFQUFFLGlCQUFPLENBQUMsV0FBVyxDQUFDLElBQUk7Z0JBQ3pDLGtCQUFrQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7YUFDckQsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVaLE1BQU0sY0FBYyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUN6QyxJQUFJLFNBQVMsQ0FBQztZQUNkLElBQUksQ0FBQztnQkFDSCxTQUFTLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQztnQkFDaEQsTUFBTSxhQUFhLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLGNBQWMsQ0FBQztnQkFDekQsb0JBQW9CLENBQUMsOEJBQThCLEVBQUU7b0JBQ25ELGFBQWEsRUFBRSxTQUFTLEVBQUUsTUFBTSxJQUFJLENBQUM7b0JBQ3JDLGFBQWEsRUFBRSxHQUFHLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7b0JBQzlDLE9BQU8sRUFBRSxPQUFPO2lCQUNqQixFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ2QsQ0FBQztZQUFDLE9BQU8sY0FBYyxFQUFFLENBQUM7Z0JBQ3hCLE1BQU0sYUFBYSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxjQUFjLENBQUM7Z0JBQ3pELG9CQUFvQixDQUFDLDRCQUE0QixFQUFFO29CQUNqRCxLQUFLLEVBQUUsY0FBYyxDQUFDLE9BQU87b0JBQzdCLEtBQUssRUFBRSxjQUFjLENBQUMsS0FBSyxFQUFFLFNBQVMsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDO29CQUM5QyxhQUFhLEVBQUUsR0FBRyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJO29CQUM5QyxPQUFPLEVBQUUsT0FBTztpQkFDakIsRUFBRSxPQUFPLENBQUMsQ0FBQztnQkFDWixNQUFNLGNBQWMsQ0FBQztZQUN2QixDQUFDO1lBRUQscUNBQXFDO1lBQ3JDLG9CQUFvQixDQUFDLDZCQUE2QixFQUFFO2dCQUNsRCxjQUFjLEVBQUUsU0FBUyxFQUFFLE1BQU0sSUFBSSxDQUFDO2dCQUN0QyxlQUFlLEVBQUUsU0FBUyxFQUFFLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDakQsRUFBRSxFQUFFLENBQUMsQ0FBQyxFQUFFO29CQUNSLElBQUksRUFBRSxDQUFDLENBQUMsSUFBSTtvQkFDWixZQUFZLEVBQUUsQ0FBQyxDQUFDLFlBQVk7b0JBQzVCLFlBQVksRUFBRSxDQUFDLENBQUMsWUFBWTtvQkFDNUIsVUFBVSxFQUFFLENBQUMsQ0FBQyxVQUFVO29CQUN4QixXQUFXLEVBQUUsQ0FBQyxDQUFDLFdBQVc7b0JBQzFCLFFBQVEsRUFBRSxDQUFDLENBQUMsUUFBUTtvQkFDcEIsa0JBQWtCLEVBQUUsQ0FBQyxDQUFDLGtCQUFrQjtvQkFDeEMsU0FBUyxFQUFFLENBQUMsQ0FBQyxTQUFTO2lCQUN2QixDQUFDLENBQUM7Z0JBQ0gsYUFBYSxFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEVBQUU7b0JBQzVDLEdBQUcsQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztvQkFDekQsT0FBTyxHQUFHLENBQUM7Z0JBQ2IsQ0FBQyxFQUFFLEVBQTRCLENBQUM7YUFDakMsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVaLGdCQUFnQjtZQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLDJCQUEyQixFQUFFO2dCQUN2QyxPQUFPO2dCQUNQLGNBQWMsRUFBRSxTQUFTLEVBQUUsTUFBTSxJQUFJLENBQUM7Z0JBQ3RDLG1CQUFtQjtnQkFDbkIsY0FBYztnQkFDZCxZQUFZO2dCQUNaLFFBQVE7Z0JBQ1IsTUFBTTthQUNQLENBQUMsQ0FBQztZQUVILDBEQUEwRDtZQUMxRCxNQUFNLHVCQUF1QixHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDdkQsK0VBQStFO2dCQUMvRSxJQUFJLGNBQWMsSUFBSSxZQUFZLEVBQUUsQ0FBQztvQkFDbkMsSUFBSSxHQUFHLENBQUMsY0FBYyxLQUFLLGNBQWMsSUFBSSxHQUFHLENBQUMsWUFBWSxLQUFLLFlBQVksRUFBRSxDQUFDO3dCQUMvRSxPQUFPLEtBQUssQ0FBQztvQkFDZixDQUFDO2dCQUNILENBQUM7Z0JBRUQsMkVBQTJFO2dCQUMzRSxJQUFJLGtCQUFrQixFQUFFLENBQUM7b0JBQ3ZCLElBQUksR0FBRyxDQUFDLFVBQVUsS0FBSyxrQkFBa0IsRUFBRSxDQUFDO3dCQUMxQyxPQUFPLEtBQUssQ0FBQztvQkFDZixDQUFDO29CQUVELDRGQUE0RjtvQkFDNUYsSUFBSSxZQUFZLEtBQUssVUFBVSxJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQzt3QkFDeEYsT0FBTyxLQUFLLENBQUM7b0JBQ2YsQ0FBQztnQkFDSCxDQUFDO2dCQUVELHNHQUFzRztnQkFDdEcsSUFBSSxZQUFZLEtBQUssVUFBVSxJQUFJLEdBQUcsQ0FBQyxRQUFRLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUUsQ0FBQztvQkFDeEYsT0FBTyxLQUFLLENBQUM7Z0JBQ2YsQ0FBQztnQkFFRCw4QkFBOEI7Z0JBQzlCLElBQUksUUFBUSxLQUFLLE9BQU8sRUFBRSxDQUFDO29CQUN6QixPQUFPLElBQUksQ0FBQztnQkFDZCxDQUFDO2dCQUVELCtFQUErRTtnQkFDL0UsSUFBSSxDQUFDLFFBQVEsS0FBSyxTQUFTLElBQUksUUFBUSxLQUFLLGNBQWMsQ0FBQyxJQUFJLGNBQWMsRUFBRSxDQUFDO29CQUM5RSxJQUFJLEdBQUcsQ0FBQyxVQUFVLElBQUksV0FBVyxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQzt3QkFDM0QsT0FBTyxJQUFJLENBQUM7b0JBQ2QsQ0FBQztvQkFDRCxJQUFJLEdBQUcsQ0FBQyxXQUFXLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQzt3QkFDOUQsT0FBTyxJQUFJLENBQUM7b0JBQ2QsQ0FBQztnQkFDSCxDQUFDO2dCQUVELGtEQUFrRDtnQkFDbEQsSUFBSSxRQUFRLEtBQUssVUFBVSxJQUFJLFFBQVEsS0FBSyxlQUFlLEVBQUUsQ0FBQztvQkFDNUQsaURBQWlEO29CQUNqRCxJQUFJLEdBQUcsQ0FBQyxXQUFXLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQzt3QkFDOUQsT0FBTyxJQUFJLENBQUM7b0JBQ2QsQ0FBQztvQkFDRCxtRUFBbUU7b0JBQ25FLElBQUksR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO3dCQUNuQiw0REFBNEQ7d0JBQzVELE1BQU0sZUFBZSxHQUFHLGNBQWM7NkJBQ25DLEdBQUcsQ0FBQyxDQUFDLEVBQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxVQUFVLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBRSxTQUFTLEVBQUUsVUFBVSxDQUFDOzZCQUNyRixNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7d0JBQ25CLE9BQU8sZUFBZSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7b0JBQ2xELENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxpRUFBaUU7Z0JBQ2pFLElBQUksUUFBUSxLQUFLLFFBQVEsSUFBSSxRQUFRLEtBQUssYUFBYSxFQUFFLENBQUM7b0JBQ3hELDhEQUE4RDtvQkFDOUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO3dCQUM1QixPQUFPLEtBQUssQ0FBQztvQkFDZixDQUFDO29CQUVELHVEQUF1RDtvQkFDdkQsSUFBSSxHQUFHLENBQUMsV0FBVyxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7d0JBQzlELE9BQU8sSUFBSSxDQUFDO29CQUNkLENBQUM7b0JBRUQseUVBQXlFO29CQUN6RSxJQUFJLEdBQUcsQ0FBQyxVQUFVLEVBQUUsQ0FBQzt3QkFDbkIsNERBQTREO3dCQUM1RCxNQUFNLGVBQWUsR0FBRyxjQUFjOzZCQUNuQyxHQUFHLENBQUMsQ0FBQyxFQUFPLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxTQUFTLEVBQUUsVUFBVSxJQUFJLEVBQUUsQ0FBQyxhQUFhLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQzs2QkFDckYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO3dCQUNuQixPQUFPLGVBQWUsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUNsRCxDQUFDO2dCQUNILENBQUM7Z0JBRUQsT0FBTyxLQUFLLENBQUM7WUFDZixDQUFDLENBQUMsQ0FBQztZQUVILDRFQUE0RTtZQUM1RSxNQUFNLHVCQUF1QixHQUFHLHVCQUF1QixDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDcEUsR0FBRyxHQUFHO2dCQUNOLEtBQUssRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLHNEQUFzRDtnQkFDdkUsUUFBUSxFQUFFLEdBQUcsQ0FBQyxZQUFZLEVBQUUscURBQXFEO2dCQUNqRixnQkFBZ0IsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVU7Z0JBQzFELFVBQVUsRUFBRSxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVc7Z0JBQ3JELFFBQVEsRUFBRSxHQUFHLENBQUMsVUFBVSxJQUFJLEdBQUcsQ0FBQyxXQUFXO2dCQUMzQyxVQUFVLEVBQUUsR0FBRyxDQUFDLFNBQVMsRUFBRSw2QkFBNkI7Z0JBQ3hELE9BQU8sRUFBRSxHQUFHLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsR0FBRyxDQUFDLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsbUNBQW1DO2FBQ3pHLENBQUMsQ0FBQyxDQUFDO1lBRUosa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsdUJBQXVCLENBQUMsQ0FBQztZQUVwRCx5Q0FBeUM7WUFDekMsa0JBQWtCLENBQUMsSUFBSSxDQUNyQixDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLElBQUksQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxFQUFFLENBQzlFLENBQUM7WUFFRixNQUFNLFFBQVEsR0FBRztnQkFDZixTQUFTLEVBQUUsa0JBQWtCO2dCQUM3QixLQUFLLEVBQUUsa0JBQWtCLENBQUMsTUFBTTtnQkFDaEMsYUFBYSxFQUFFLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixLQUFLLFVBQVUsQ0FBQyxDQUFDLE1BQU07Z0JBQ3pGLGFBQWEsRUFBRSxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0IsS0FBSyxVQUFVLENBQUMsQ0FBQyxNQUFNO2dCQUN6RixXQUFXLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsZ0JBQWdCLEtBQUssUUFBUSxDQUFDLENBQUMsTUFBTTthQUN0RixDQUFDO1lBQ0YsaUNBQWlDO1lBQ2pDLGdCQUFnQixDQUFDLHNCQUFzQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFO2dCQUM5RCxpQkFBaUIsRUFBRSxrQkFBa0IsQ0FBQyxNQUFNO2dCQUM1QyxPQUFPLEVBQUUsRUFBRSxZQUFZLEVBQUUsbUJBQW1CLEVBQUUsa0JBQWtCLEVBQUU7YUFDbkUsQ0FBQyxDQUFDO1lBRUgseUNBQXlDO1lBQ3pDLElBQUksY0FBYyxLQUFLLE1BQU0sSUFBSSx1QkFBdUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxTQUFTLDRCQUE0QixFQUFFLHVCQUF1QixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3pGLENBQUM7WUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3JCLENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxNQUFNLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3BFLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsMkJBQTJCO2dCQUNwQyxRQUFRLEVBQUUsVUFBVSxDQUFDLFNBQVM7Z0JBQzlCLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVM7YUFDaEYsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsZ0NBQWdDO0lBQ2hDLEdBQUcsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ2pFLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDdEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMzQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ2pDLE1BQU0sWUFBWSxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsSUFBYyxDQUFDLENBQUMscUJBQXFCO1lBRXBFLHVEQUF1RDtZQUN2RCxNQUFNLGFBQWEsR0FBRyxNQUFNLGlCQUFPLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakUsTUFBTSxVQUFVLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELE1BQU0sU0FBUyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUUvQyxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBQzlGLE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUM1RCxNQUFNLFdBQVcsR0FBRyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7WUFFL0MsSUFBSSxRQUFRLEdBQTBCLElBQUksQ0FBQztZQUUzQyx1REFBdUQ7WUFDdkQsTUFBTSwyQkFBMkIsR0FBRywyQkFBMkIsSUFBSSxpQkFBTyxDQUFDO1lBRTNFLElBQUksMkJBQTJCLEVBQUUsQ0FBQztnQkFDaEMsSUFBSSxDQUFDLFlBQVksSUFBSSxZQUFZLEtBQUssVUFBVSxFQUFFLENBQUM7b0JBQ2pELElBQUksQ0FBQzt3QkFDSCxRQUFRLEdBQUcsTUFBTyxpQkFBZSxDQUFDLHlCQUF5QixDQUN6RCxVQUFVLEVBQ1YsTUFBTSxFQUNOLFFBQVEsRUFDUixjQUFjLEVBQ2QsV0FBVyxDQUNaLENBQUM7d0JBQ0YsSUFBSSxRQUFRLEVBQUUsQ0FBQzs0QkFDWixRQUFnQixDQUFDLGdCQUFnQixHQUFHLFVBQVUsQ0FBQzs0QkFDL0MsUUFBZ0IsQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDOzRCQUN6QyxRQUFnQixDQUFDLFFBQVEsR0FBSSxRQUFnQixDQUFDLFVBQVUsQ0FBQzt3QkFDNUQsQ0FBQztvQkFDSCxDQUFDO29CQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7d0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxzQ0FBc0MsRUFBRSxDQUFDLENBQUMsQ0FBQztvQkFDMUQsQ0FBQztnQkFDSCxDQUFDO2dCQUVELElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLFlBQVksSUFBSSxZQUFZLEtBQUssVUFBVSxDQUFDLEVBQUUsQ0FBQztvQkFDaEUsSUFBSSxDQUFDO3dCQUNILFFBQVEsR0FBRyxNQUFPLGlCQUFlLENBQUMseUJBQXlCLENBQ3pELFVBQVUsRUFDVixNQUFNLEVBQ04sUUFBUSxFQUNSLGNBQWMsRUFDZCxZQUFZLENBQ2IsQ0FBQzt3QkFDRixJQUFJLFFBQVEsRUFBRSxDQUFDOzRCQUNaLFFBQWdCLENBQUMsZ0JBQWdCLEdBQUcsVUFBVSxDQUFDOzRCQUMvQyxRQUFnQixDQUFDLFVBQVUsR0FBRyxXQUFXLENBQUM7NEJBQzFDLFFBQWdCLENBQUMsUUFBUSxHQUFJLFFBQWdCLENBQUMsV0FBVyxDQUFDO3dCQUM3RCxDQUFDO29CQUNILENBQUM7b0JBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQzt3QkFDWCxPQUFPLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLENBQUMsQ0FBQyxDQUFDO29CQUMxRCxDQUFDO2dCQUNILENBQUM7WUFDSCxDQUFDO1lBRUQsa0VBQWtFO1lBQ2xFLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztnQkFDL0IsSUFBSSxDQUFDO29CQUNILFFBQVEsR0FBRyxNQUFNLGlCQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUNqRCxJQUFJLFFBQVEsRUFBRSxDQUFDO3dCQUNaLFFBQWdCLENBQUMsZ0JBQWdCLEdBQUcsUUFBUSxDQUFDO3dCQUM3QyxRQUFnQixDQUFDLFVBQVUsR0FBRyxRQUFRLENBQUM7d0JBQ3ZDLFFBQWdCLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQztvQkFDcEMsQ0FBQztnQkFDSCxDQUFDO2dCQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7b0JBQ1gsT0FBTyxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxDQUFDLENBQUMsQ0FBQztnQkFDeEQsQ0FBQztZQUNILENBQUM7WUFFRCxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ2QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSwyQ0FBMkMsRUFBRSxDQUFDLENBQUM7WUFDeEYsQ0FBQztZQUVELEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNuRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxDQUFDLENBQUM7UUFDaEUsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsNEVBQTRFO0lBQzVFLEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsa0JBQVcsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDckYsTUFBTSxXQUFXLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN4QyxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFcEMsb0JBQW9CLENBQUMsY0FBYyxFQUFFO1lBQ25DLFdBQVc7WUFDWCxNQUFNLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ25CLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7WUFDdkIsUUFBUSxFQUFFLHFCQUFxQjtTQUNoQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRVgsSUFBSSxDQUFDO1lBQ0gsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDdkIsTUFBTSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsR0FBRyxTQUFTLEVBQUUsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBRTVGLDRCQUE0QjtZQUM1QixvQkFBb0IsQ0FBQyx5QkFBeUIsRUFBRTtnQkFDOUMsV0FBVztnQkFDWCxjQUFjLEVBQUU7b0JBQ2QsWUFBWTtvQkFDWixJQUFJO29CQUNKLFVBQVU7b0JBQ1YsV0FBVztvQkFDWCxPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJO29CQUNuQixjQUFjLEVBQUUsQ0FBQyxDQUFDLFdBQVc7b0JBQzdCLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxNQUFNO29CQUN0QyxhQUFhLEVBQUUsTUFBTSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUM7b0JBQ3JDLFdBQVcsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQztpQkFDekM7Z0JBQ0QsV0FBVyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO29CQUN0QixZQUFZLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZO29CQUNuQyxRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRO29CQUMzQixJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJO29CQUNuQixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRO29CQUMzQixTQUFTLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTO29CQUM3QixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJO2lCQUN4QixDQUFDLENBQUMsQ0FBQyxJQUFJO2FBQ1QsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVaLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMscUNBQXFDLEVBQUU7b0JBQ2pELFlBQVksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVk7b0JBQ25DLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7b0JBQzNCLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7b0JBQ25CLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7b0JBQ3ZCLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7aUJBQzVCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxnREFBZ0Q7WUFDaEQsb0JBQW9CLENBQUMsa0JBQWtCLEVBQUU7Z0JBQ3ZDLFdBQVc7Z0JBQ1gsTUFBTTtnQkFDTixjQUFjLEVBQUUsaUJBQWlCLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLE1BQU0sSUFBSSxDQUFDO2dCQUMxRCxVQUFVLEVBQUUsZUFBZSxDQUFDLDJCQUEyQjthQUN4RCxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBRVosTUFBTSxjQUFjLEdBQUcsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDcEQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDNUIsb0JBQW9CLENBQUMscUJBQXFCLEVBQUU7b0JBQzFDLFdBQVc7b0JBQ1gsTUFBTTtvQkFDTixLQUFLLEVBQUUsY0FBYyxDQUFDLEtBQUs7b0JBQzNCLFlBQVksRUFBRSxpQkFBaUIsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsTUFBTSxJQUFJLENBQUM7aUJBQ3pELEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ1gsZ0JBQWdCLENBQUMsNEJBQTRCLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO2dCQUNySCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGNBQWMsQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2pFLENBQUM7WUFFRCxvQkFBb0IsQ0FBQyxtQkFBbUIsRUFBRTtnQkFDeEMsV0FBVztnQkFDWCxNQUFNO2dCQUNOLGdCQUFnQixFQUFFLGVBQWUsQ0FBQywyQkFBMkIsR0FBRyxDQUFDLGlCQUFpQixDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxNQUFNLElBQUksQ0FBQyxDQUFDO2FBQzdHLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixpQ0FBaUM7WUFDakMsb0JBQW9CLENBQUMsa0JBQWtCLEVBQUU7Z0JBQ3ZDLFdBQVc7Z0JBQ1gsUUFBUTtnQkFDUixZQUFZLEVBQUUsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQztnQkFDOUMsWUFBWSxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDO2FBQ2xFLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO2dCQUN6RCxvQkFBb0IsQ0FBQyxtQkFBbUIsRUFBRTtvQkFDeEMsV0FBVztvQkFDWCxRQUFRO29CQUNSLGFBQWEsRUFBRSxDQUFDLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxDQUFDO29CQUMvQyxNQUFNO2lCQUNQLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ1gsZ0JBQWdCLENBQUMsNkJBQTZCLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUU7b0JBQ3RFLFdBQVc7b0JBQ1gsYUFBYSxFQUFFLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLENBQUM7aUJBQ2hELENBQUMsQ0FBQztnQkFDSCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDhDQUE4QyxFQUFFLENBQUMsQ0FBQztZQUMzRixDQUFDO1lBRUQsb0JBQW9CLENBQUMsb0JBQW9CLEVBQUU7Z0JBQ3pDLFdBQVc7Z0JBQ1gsUUFBUTtnQkFDUixNQUFNO2FBQ1AsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVaLHdDQUF3QztZQUN4QyxNQUFNLG9CQUFvQixHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxXQUFXLENBQUM7WUFDdEQsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQztZQUN4QyxNQUFNLHdCQUF3QixHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksSUFBSSxDQUFDLFdBQVcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLElBQUksU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRWxHLG9CQUFvQixDQUFDLDhCQUE4QixFQUFFO2dCQUNuRCxXQUFXO2dCQUNYLGNBQWMsRUFBRTtvQkFDZCxjQUFjLEVBQUUsb0JBQW9CO29CQUNwQyxjQUFjLEVBQUUsb0JBQW9CO29CQUNwQyxrQkFBa0IsRUFBRSx3QkFBd0I7aUJBQzdDO2dCQUNELGVBQWUsRUFBRTtvQkFDZixPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJO29CQUNuQixjQUFjLEVBQUUsQ0FBQyxDQUFDLFdBQVc7b0JBQzdCLGlCQUFpQixFQUFFLFdBQVcsRUFBRSxNQUFNO29CQUN0QyxRQUFRLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxLQUFLO29CQUMzQixPQUFPLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJO29CQUN6QixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxJQUFJO29CQUN4QixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxZQUFZO2lCQUNqQzthQUNGLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixJQUFJLENBQUMsb0JBQW9CLElBQUksQ0FBQyxvQkFBb0IsSUFBSSxDQUFDLHdCQUF3QixFQUFFLENBQUM7Z0JBQ2hGLG9CQUFvQixDQUFDLDBCQUEwQixFQUFFO29CQUMvQyxXQUFXO29CQUNYLE1BQU0sRUFBRSw2Q0FBNkM7b0JBQ3JELFlBQVksRUFBRTt3QkFDWixPQUFPLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJO3dCQUNuQixjQUFjLEVBQUUsQ0FBQyxDQUFDLFdBQVc7d0JBQzdCLFFBQVEsRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLEtBQUs7d0JBQzNCLE9BQU8sRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUk7cUJBQzFCO2lCQUNGLEVBQUUsT0FBTyxDQUFDLENBQUM7Z0JBQ1osT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxpRUFBaUUsRUFBRSxDQUFDLENBQUM7WUFDOUcsQ0FBQztZQUVELHVEQUF1RDtZQUN2RCxJQUFJLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3pCLDRDQUE0QztnQkFDNUMsTUFBTSxZQUFZLEdBQW1CO29CQUNuQyxJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUksSUFBSSx5QkFBeUI7b0JBQ2pELFdBQVcsRUFBRSxTQUFTLENBQUMsV0FBVyxJQUFJLFdBQVcsQ0FBQyxTQUFTLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO29CQUM3RyxZQUFZLEVBQUUsWUFBWSxJQUFJLE9BQU87b0JBQ3JDLFFBQVEsRUFBRSxrQkFBa0IsTUFBTSxJQUFJLElBQUEsU0FBTSxHQUFFLE1BQU0sRUFBRSxrQ0FBa0M7b0JBQ3hGLGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxrQkFBa0IsS0FBSyxNQUFNLElBQUksU0FBUyxDQUFDLGtCQUFrQixLQUFLLElBQUk7b0JBQ3BHLFdBQVcsRUFBRSxXQUFXLElBQUksU0FBUztvQkFDckMsVUFBVSxFQUFFLFVBQVUsSUFBSSxTQUFTO29CQUNuQyxZQUFZLEVBQUUsTUFBTTtpQkFDckIsQ0FBQztnQkFFRixvQkFBb0I7Z0JBQ3BCLElBQUksVUFBVSxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUUsQ0FBQztvQkFDekMsTUFBTSxhQUFhLEdBQUcsTUFBTSxpQkFBTyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNqRSxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUM5RixNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUN2RCxJQUFJLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxjQUFjLEtBQUssY0FBYyxFQUFFLENBQUM7d0JBQzVELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsOERBQThELEVBQUUsQ0FBQyxDQUFDO29CQUMzRyxDQUFDO2dCQUNILENBQUM7Z0JBRUQsSUFBSSxXQUFXLElBQUksUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUMzQyxNQUFNLFVBQVUsR0FBRyxNQUFNLGlCQUFPLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQzNELE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDNUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQzt3QkFDeEMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxvREFBb0QsRUFBRSxDQUFDLENBQUM7b0JBQ2pHLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCx5REFBeUQ7Z0JBQ3pELElBQUksa0JBQWtCLENBQUM7Z0JBQ3ZCLElBQUksVUFBVSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQy9CLGtCQUFrQixHQUFHLFVBQVUsQ0FBQztnQkFDbEMsQ0FBQztxQkFBTSxJQUFJLFdBQVcsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO29CQUN0QyxrQkFBa0IsR0FBRyxVQUFVLENBQUM7Z0JBQ2xDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUMxQixPQUFPLEVBQUUsaUdBQWlHO3FCQUMzRyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCx5RUFBeUU7Z0JBQ3pFLElBQUksUUFBZ0IsQ0FBQztnQkFDckIsSUFBSSxDQUFDO29CQUNILE1BQU0sWUFBWSxHQUFHLGNBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO29CQUM3RSxJQUFJLENBQUMsWUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO3dCQUNqQyxZQUFFLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO29CQUNsRCxDQUFDO29CQUNELFFBQVEsR0FBRyxHQUFHLElBQUEsU0FBTSxHQUFFLG9CQUFvQixDQUFDO29CQUMzQyxNQUFNLFFBQVEsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDbkQsWUFBRSxDQUFDLGFBQWEsQ0FBQyxRQUFRLEVBQUUsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUNsRCxDQUFDO2dCQUFDLE9BQU8sT0FBTyxFQUFFLENBQUM7b0JBQ2pCLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkNBQTJDLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBQ3BFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsOEJBQThCLEVBQUUsQ0FBQyxDQUFDO2dCQUMzRSxDQUFDO2dCQUVELHFEQUFxRDtnQkFDckQsWUFBWSxDQUFDLFFBQVEsR0FBRyxHQUFHLGtCQUFrQixJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUU1RCxxQ0FBcUM7Z0JBQ3JDLE1BQU0sUUFBUSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBRTVELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxvQ0FBb0M7b0JBQzdDLFFBQVEsRUFBRTt3QkFDUixHQUFHLFFBQVE7d0JBQ1gsS0FBSyxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsK0NBQStDO3dCQUNyRSxRQUFRLEVBQUUsUUFBUSxDQUFDLFlBQVksRUFBRSwwREFBMEQ7d0JBQzNGLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVO3dCQUN0RCxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVc7d0JBQ2pELFFBQVEsRUFBRSxVQUFVLElBQUksV0FBVztxQkFDcEM7aUJBQ0YsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHVFQUF1RTtZQUN2RSxJQUFJLHdCQUF3QixFQUFFLENBQUM7Z0JBQzdCLHVGQUF1RjtnQkFDdkYsTUFBTSxZQUFZLEdBQW1CO29CQUNuQyxJQUFJLEVBQUUsU0FBUyxDQUFDLEtBQUssSUFBSSxTQUFTLENBQUMsSUFBSSxJQUFJLG1CQUFtQjtvQkFDOUQsV0FBVyxFQUFFLFNBQVMsQ0FBQyxXQUFXLElBQUksRUFBRTtvQkFDeEMsWUFBWSxFQUFFLFNBQVMsQ0FBQyxRQUFRLElBQUksWUFBWSxJQUFJLE9BQU87b0JBQzNELFFBQVEsRUFBRSxzQkFBc0IsTUFBTSxJQUFJLElBQUEsU0FBTSxHQUFFLEVBQUUsRUFBRSwrQ0FBK0M7b0JBQ3JHLGtCQUFrQixFQUFFLFNBQVMsQ0FBQyxrQkFBa0IsS0FBSyxNQUFNLElBQUksU0FBUyxDQUFDLGtCQUFrQixLQUFLLElBQUksSUFBSSxLQUFLO29CQUM3RyxXQUFXLEVBQUUsV0FBVyxJQUFJLFNBQVM7b0JBQ3JDLFVBQVUsRUFBRSxVQUFVLElBQUksU0FBUztvQkFDbkMsWUFBWSxFQUFFLE1BQU07aUJBQ3JCLENBQUM7Z0JBRUYsMENBQTBDO2dCQUMxQyxJQUFJLENBQUMsVUFBVSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQ2hDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7d0JBQzFCLE9BQU8sRUFBRSxpR0FBaUc7cUJBQzNHLENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUVELElBQUksVUFBVSxJQUFJLFdBQVcsRUFBRSxDQUFDO29CQUM5QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUMxQixPQUFPLEVBQUUsZ0RBQWdEO3FCQUMxRCxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCxvQkFBb0I7Z0JBQ3BCLElBQUksVUFBVSxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUUsQ0FBQztvQkFDekMsTUFBTSxhQUFhLEdBQUcsTUFBTSxpQkFBTyxDQUFDLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNqRSxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUM5RixNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUN2RCxJQUFJLENBQUMsUUFBUSxJQUFJLFFBQVEsQ0FBQyxjQUFjLEtBQUssY0FBYyxFQUFFLENBQUM7d0JBQzVELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsOERBQThELEVBQUUsQ0FBQyxDQUFDO29CQUMzRyxDQUFDO2dCQUNILENBQUM7Z0JBRUQsSUFBSSxXQUFXLElBQUksUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUMzQyxNQUFNLFVBQVUsR0FBRyxNQUFNLGlCQUFPLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQzNELE1BQU0sWUFBWSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDNUQsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQzt3QkFDeEMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxvREFBb0QsRUFBRSxDQUFDLENBQUM7b0JBQ2pHLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxxQ0FBcUM7Z0JBQ3JDLE1BQU0sUUFBUSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBRTVELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSwrQkFBK0I7b0JBQ3hDLFFBQVEsRUFBRTt3QkFDUixHQUFHLFFBQVE7d0JBQ1gsS0FBSyxFQUFFLFFBQVEsQ0FBQyxJQUFJLEVBQUUsK0NBQStDO3dCQUNyRSxRQUFRLEVBQUUsUUFBUSxDQUFDLFlBQVksRUFBRSwwREFBMEQ7d0JBQzNGLGdCQUFnQixFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVO3dCQUN0RCxVQUFVLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVc7d0JBQ2pELFFBQVEsRUFBRSxVQUFVLElBQUksV0FBVzt3QkFDbkMsT0FBTyxFQUFFLFNBQVMsRUFBRSwwQ0FBMEM7cUJBQy9EO2lCQUNGLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCx1Q0FBdUM7WUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO1lBRXZFLCtGQUErRjtZQUMvRixJQUFJLHVCQUF1QixDQUFDO1lBQzVCLElBQUksVUFBVSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQy9CLHVCQUF1QixHQUFHLFVBQVUsQ0FBQztnQkFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpRUFBaUUsVUFBVSxHQUFHLENBQUMsQ0FBQztZQUM5RixDQUFDO2lCQUFNLElBQUksV0FBVyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7Z0JBQ3RDLHVCQUF1QixHQUFHLFVBQVUsQ0FBQztnQkFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrRUFBa0UsV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNoRyxDQUFDO2lCQUFNLElBQUksVUFBVSxJQUFJLFdBQVcsRUFBRSxDQUFDO2dCQUNyQyxPQUFPLENBQUMsR0FBRyxDQUFDLGtFQUFrRSxVQUFVLEtBQUssV0FBVyxFQUFFLENBQUMsQ0FBQztnQkFDNUcsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLGdEQUFnRDtpQkFDMUQsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsNERBQTRELENBQUMsQ0FBQztnQkFDMUUsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUNMLGlHQUFpRztpQkFDcEcsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksdUJBQXVCLEtBQUssVUFBVSxFQUFFLENBQUM7Z0JBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0VBQXNFLFVBQVUsRUFBRSxDQUFDLENBQUM7Z0JBRWhHLHdDQUF3QztnQkFDeEMsSUFBSSxDQUFDLFVBQVUsRUFBRSxDQUFDO29CQUNoQixPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7b0JBQ3RELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsK0NBQStDLEVBQUUsQ0FBQyxDQUFDO2dCQUM1RixDQUFDO2dCQUVELDBEQUEwRDtnQkFDMUQsSUFBSSxRQUFnQixDQUFDO2dCQUNyQixJQUFJLFFBQTRCLENBQUM7Z0JBRWpDLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO29CQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsNERBQTRELFVBQVUsRUFBRSxDQUFDLENBQUM7b0JBRXRGLDBEQUEwRDtvQkFDMUQsUUFBUSxHQUFHLEdBQUcsSUFBQSxTQUFNLEdBQUUsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO29CQUNsRCxNQUFNLFlBQVksR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFVBQVUsQ0FBQyxDQUFDO29CQUVsRixPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxFQUFFO3dCQUM5QyxZQUFZLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZO3dCQUNuQyxXQUFXLEVBQUUsUUFBUTt3QkFDckIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTt3QkFDdkIsWUFBWTt3QkFDWixlQUFlLEVBQUUsWUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUM7cUJBQzdDLENBQUMsQ0FBQztvQkFFSCwwQkFBMEI7b0JBQzFCLElBQUksQ0FBQyxZQUFFLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7d0JBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLFlBQVksRUFBRSxDQUFDLENBQUM7d0JBQ3hFLFlBQUUsQ0FBQyxTQUFTLENBQUMsWUFBWSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7b0JBQ2xELENBQUM7b0JBRUQsc0ZBQXNGO29CQUN0RixNQUFNLGFBQWEsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxRQUFRLENBQUMsQ0FBQztvQkFDeEQsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLE9BQU8sYUFBYSxFQUFFLENBQUMsQ0FBQztvQkFDM0YsWUFBRSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxhQUFhLENBQUMsQ0FBQztvQkFDOUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvREFBb0QsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO29CQUNqRixZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQywwQkFBMEI7b0JBQ3hELFFBQVEsR0FBRyxhQUFhLFVBQVUsSUFBSSxRQUFRLEVBQUUsQ0FBQztvQkFDakQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvREFBb0QsUUFBUSxFQUFFLENBQUMsQ0FBQztnQkFDOUUsQ0FBQztxQkFBTSxDQUFDO29CQUNOLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0VBQWtFLENBQUMsQ0FBQztvQkFDaEYsUUFBUSxHQUFHLGFBQWEsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUM7Z0JBQ3ZDLENBQUM7Z0JBRUQsTUFBTSxjQUFjLEdBQUc7b0JBQ3JCLEdBQUcsU0FBUztvQkFDWixVQUFVO29CQUNWLFlBQVksRUFBRSxNQUFNO29CQUNwQixRQUFRO29CQUNSLFFBQVE7b0JBQ1IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSTtvQkFDeEIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUTtvQkFDNUIsWUFBWSxFQUFFLFlBQVksSUFBSSxJQUFJLElBQUksT0FBTyxFQUFFLHFDQUFxQztpQkFDckYsQ0FBQztnQkFFRixPQUFPLENBQUMsR0FBRyxDQUFDLHdDQUF3QyxFQUFFO29CQUNwRCxVQUFVO29CQUNWLFlBQVksRUFBRSxNQUFNO29CQUNwQixRQUFRO29CQUNSLFFBQVE7b0JBQ1IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSTtvQkFDeEIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsUUFBUTtvQkFDNUIsWUFBWSxFQUFFLFlBQVksSUFBSSxJQUFJLElBQUksT0FBTztvQkFDN0MsYUFBYSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO2lCQUN0QyxDQUFDLENBQUM7Z0JBRUgsSUFBSSxhQUFhLENBQUM7Z0JBQ2xCLElBQUksQ0FBQztvQkFDSCxhQUFhLEdBQUcsNkJBQW9CLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO29CQUMzRCxPQUFPLENBQUMsR0FBRyxDQUFDLG1FQUFtRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO2dCQUMvRixDQUFDO2dCQUFDLE9BQU8sZUFBZSxFQUFFLENBQUM7b0JBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0RBQStELFVBQVUsR0FBRyxFQUFFLGVBQWUsQ0FBQyxDQUFDO29CQUMzRyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO3dCQUMxQixPQUFPLEVBQUUsbUJBQW1CO3dCQUM1QixLQUFLLEVBQUUsZUFBZSxDQUFDLE9BQU8sSUFBSSxjQUFjO3dCQUNoRCxPQUFPLEVBQUUsZUFBZSxDQUFDLE1BQU0sSUFBSSxlQUFlO3FCQUNuRCxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFFRCwyQ0FBMkM7Z0JBQzNDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdURBQXVELFFBQVEsRUFBRSxDQUFDLENBQUM7Z0JBRS9FLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRSxDQUFDO29CQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLDhEQUE4RCxVQUFVLEVBQUUsQ0FBQyxDQUFDO29CQUN4RixNQUFNLGFBQWEsR0FBRyxNQUFNLGlCQUFPLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ2pFLE1BQU0sY0FBYyxHQUNsQixhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO29CQUN6RSxPQUFPLENBQUMsR0FBRyxDQUFDLDhDQUE4QyxjQUFjLEVBQUUsQ0FBQyxDQUFDO29CQUU1RSxNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFPLENBQUMsV0FBVyxDQUFDLFVBQVUsQ0FBQyxDQUFDO29CQUN2RCxPQUFPLENBQUMsR0FBRyxDQUFDLCtDQUErQyxRQUFRLEVBQUUsY0FBYyxFQUFFLENBQUMsQ0FBQztvQkFFdkYsSUFBSSxDQUFDLFFBQVEsSUFBSSxRQUFRLENBQUMsY0FBYyxLQUFLLGNBQWMsRUFBRSxDQUFDO3dCQUM1RCxPQUFPLENBQUMsR0FBRyxDQUFDLHVFQUF1RSxDQUFDLENBQUM7d0JBQ3JGLE9BQU8sR0FBRzs2QkFDUCxNQUFNLENBQUMsR0FBRyxDQUFDOzZCQUNYLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSw4REFBOEQsRUFBRSxDQUFDLENBQUM7b0JBQ3ZGLENBQUM7b0JBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxREFBcUQsQ0FBQyxDQUFDO2dCQUNyRSxDQUFDO2dCQUVELElBQUksUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDO29CQUM1QixPQUFPLENBQUMsR0FBRyxDQUFDLCtEQUErRCxVQUFVLEVBQUUsQ0FBQyxDQUFDO29CQUN6RixNQUFNLFVBQVUsR0FBRyxNQUFNLGlCQUFPLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLFVBQVUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO29CQUVoRixNQUFNLHNCQUFzQixHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FDOUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUU7d0JBQzFCLE1BQU0sU0FBUyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLFdBQVcsQ0FBQyxDQUFDO3dCQUM3RCxNQUFNLFlBQVksR0FBRyxTQUFTLElBQUksU0FBUyxDQUFDLFVBQVUsS0FBSyxVQUFVLENBQUM7d0JBQ3RFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0NBQWtDLEVBQUUsQ0FBQyxXQUFXLGdCQUFnQixVQUFVLEtBQUssWUFBWSxFQUFFLENBQUMsQ0FBQzt3QkFDM0csT0FBTyxZQUFZLENBQUM7b0JBQ3RCLENBQUMsQ0FBQyxDQUNILENBQUM7b0JBRUYsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO3dCQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJFQUEyRSxDQUFDLENBQUM7d0JBQ3pGLE9BQU8sR0FBRzs2QkFDUCxNQUFNLENBQUMsR0FBRyxDQUFDOzZCQUNYLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxnRUFBZ0UsRUFBRSxDQUFDLENBQUM7b0JBQ3pGLENBQUM7b0JBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO2dCQUN0RSxDQUFDO2dCQUVELGdFQUFnRTtnQkFDaEUsTUFBTSxlQUFlLEdBQW1CO29CQUN0QyxJQUFJLEVBQUUsYUFBYSxDQUFDLElBQUksSUFBSSxVQUFVO29CQUN0QyxXQUFXLEVBQUUsYUFBYSxDQUFDLFdBQVc7b0JBQ3RDLFlBQVksRUFBRSxhQUFhLENBQUMsWUFBWTtvQkFDeEMsUUFBUSxFQUFFLGFBQWEsQ0FBQyxRQUFRLElBQUksYUFBYSxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7b0JBQzdELGtCQUFrQixFQUFFLGFBQWEsQ0FBQyxrQkFBa0IsSUFBSSxLQUFLO29CQUM3RCxXQUFXLEVBQUUsU0FBUztvQkFDdEIsVUFBVSxFQUFFLGFBQWEsQ0FBQyxVQUFVO29CQUNwQyxZQUFZLEVBQUUsYUFBYSxDQUFDLFlBQVk7aUJBQ3pDLENBQUM7Z0JBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxREFBcUQsRUFBRTtvQkFDakUsSUFBSSxFQUFFLGVBQWUsQ0FBQyxJQUFJO29CQUMxQixZQUFZLEVBQUUsZUFBZSxDQUFDLFlBQVk7b0JBQzFDLFFBQVEsRUFBRSxlQUFlLENBQUMsUUFBUTtvQkFDbEMsVUFBVSxFQUFFLGVBQWUsQ0FBQyxVQUFVO29CQUN0QyxZQUFZLEVBQUUsZUFBZSxDQUFDLFlBQVk7aUJBQzNDLENBQUMsQ0FBQztnQkFFSCxNQUFNLFFBQVEsR0FBRyxNQUFNLGlCQUFPLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDO2dCQUMvRCxPQUFPLENBQUMsR0FBRyxDQUFDLDhEQUE4RCxRQUFRLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFFekYsK0RBQStEO2dCQUUvRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDbkIsR0FBRyxRQUFRO29CQUNYLGdCQUFnQixFQUFFLFVBQVU7b0JBQzVCLFVBQVUsRUFBRSxVQUFVO29CQUN0QixRQUFRLEVBQUUsUUFBUSxDQUFDLFVBQVU7aUJBQzlCLENBQUMsQ0FBQztZQUNMLENBQUM7aUJBQU0sSUFBSSx1QkFBdUIsS0FBSyxVQUFVLEVBQUUsQ0FBQztnQkFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5RUFBeUUsV0FBVyxFQUFFLENBQUMsQ0FBQztnQkFFcEcsd0NBQXdDO2dCQUN4QyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7b0JBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztvQkFDeEQsT0FBTyxHQUFHO3lCQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7eUJBQ1gsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGdEQUFnRCxFQUFFLENBQUMsQ0FBQztnQkFDekUsQ0FBQztnQkFFRCwwREFBMEQ7Z0JBQzFELElBQUksUUFBZ0IsQ0FBQztnQkFDckIsSUFBSSxRQUE0QixDQUFDO2dCQUVqQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztvQkFDYixPQUFPLENBQUMsR0FBRyxDQUFDLDhEQUE4RCxXQUFXLEVBQUUsQ0FBQyxDQUFDO29CQUV6RiwwREFBMEQ7b0JBQzFELFFBQVEsR0FBRyxHQUFHLElBQUEsU0FBTSxHQUFFLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztvQkFDbEQsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQztvQkFFcEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsRUFBRTt3QkFDL0MsWUFBWSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTt3QkFDbkMsV0FBVyxFQUFFLFFBQVE7d0JBQ3JCLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7d0JBQ3ZCLFlBQVk7d0JBQ1osZUFBZSxFQUFFLFlBQUUsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDO3FCQUM3QyxDQUFDLENBQUM7b0JBRUgsMEJBQTBCO29CQUMxQixJQUFJLENBQUMsWUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO3dCQUNqQyxPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxZQUFZLEVBQUUsQ0FBQyxDQUFDO3dCQUN6RSxZQUFFLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO29CQUNsRCxDQUFDO29CQUVELHNGQUFzRjtvQkFDdEYsTUFBTSxhQUFhLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQ3hELE9BQU8sQ0FBQyxHQUFHLENBQUMsMkNBQTJDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLGFBQWEsRUFBRSxDQUFDLENBQUM7b0JBQzVGLFlBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7b0JBQzlDLE9BQU8sQ0FBQyxHQUFHLENBQUMscURBQXFELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztvQkFDbEYsWUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsMEJBQTBCO29CQUN4RCxRQUFRLEdBQUcsY0FBYyxXQUFXLElBQUksUUFBUSxFQUFFLENBQUM7b0JBQ25ELE9BQU8sQ0FBQyxHQUFHLENBQUMscURBQXFELFFBQVEsRUFBRSxDQUFDLENBQUM7Z0JBQy9FLENBQUM7cUJBQU0sQ0FBQztvQkFDTixPQUFPLENBQUMsR0FBRyxDQUFDLG1FQUFtRSxDQUFDLENBQUM7b0JBQ2pGLFFBQVEsR0FBRyxhQUFhLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO2dCQUN2QyxDQUFDO2dCQUVELE1BQU0sY0FBYyxHQUFHO29CQUNyQixHQUFHLFNBQVM7b0JBQ1osV0FBVztvQkFDWCxZQUFZLEVBQUUsTUFBTTtvQkFDcEIsUUFBUTtvQkFDUixRQUFRO29CQUNSLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUk7b0JBQ3hCLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLFFBQVE7b0JBQzVCLFlBQVksRUFBRSxZQUFZLElBQUksSUFBSSxJQUFJLE9BQU8sRUFBRSxxQ0FBcUM7aUJBQ3JGLENBQUM7Z0JBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsRUFBRTtvQkFDckQsY0FBYztvQkFDZCxZQUFZO29CQUNaLGFBQWEsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQztvQkFDckMsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSTtpQkFDcEIsQ0FBQyxDQUFDO2dCQUVILElBQUksYUFBYSxDQUFDO2dCQUNsQixJQUFJLENBQUM7b0JBQ0gsYUFBYSxHQUFHLDZCQUFvQixDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsQ0FBQztvQkFDM0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO2dCQUN6RCxDQUFDO2dCQUFDLE9BQU8sZUFBZSxFQUFFLENBQUM7b0JBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQXdDLEVBQUUsZUFBZSxDQUFDLENBQUM7b0JBQ3ZFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7d0JBQzFCLE9BQU8sRUFBRSxtQkFBbUI7d0JBQzVCLEtBQUssRUFBRSxlQUFlLENBQUMsT0FBTyxJQUFJLGNBQWM7d0JBQ2hELE9BQU8sRUFBRSxlQUFlLENBQUMsTUFBTSxJQUFJLGVBQWU7cUJBQ25ELENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUVELDJDQUEyQztnQkFDM0MsSUFBSSxRQUFRLEtBQUssU0FBUyxFQUFFLENBQUM7b0JBQzNCLE1BQU0sYUFBYSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDakUsTUFBTSxjQUFjLEdBQ2xCLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7b0JBQ3pFLE1BQU0sU0FBUyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLENBQUMsV0FBVyxDQUFDLENBQUM7b0JBQzFELElBQUksU0FBUyxFQUFFLENBQUM7d0JBQ2QsTUFBTSxRQUFRLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFdBQVcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7d0JBQ2pFLElBQUksQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLGNBQWMsS0FBSyxjQUFjLEVBQUUsQ0FBQzs0QkFDNUQsT0FBTyxHQUFHO2lDQUNQLE1BQU0sQ0FBQyxHQUFHLENBQUM7aUNBQ1gsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLCtEQUErRCxFQUFFLENBQUMsQ0FBQzt3QkFDeEYsQ0FBQztvQkFDSCxDQUFDO3lCQUFNLENBQUM7d0JBQ04sT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxDQUFDLENBQUM7b0JBQ2xFLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxJQUFJLFFBQVEsS0FBSyxVQUFVLEVBQUUsQ0FBQztvQkFDNUIsTUFBTSxVQUFVLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUMzRCxNQUFNLFlBQVksR0FBRyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7b0JBRTVELElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7d0JBQ3hDLE9BQU8sR0FBRzs2QkFDUCxNQUFNLENBQUMsR0FBRyxDQUFDOzZCQUNYLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxvREFBb0QsRUFBRSxDQUFDLENBQUM7b0JBQzdFLENBQUM7Z0JBQ0gsQ0FBQztnQkFFRCxxQ0FBcUM7Z0JBQ3JDLE1BQU0sZUFBZSxHQUFtQjtvQkFDdEMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxJQUFJLElBQUksVUFBVTtvQkFDdEMsV0FBVyxFQUFFLGFBQWEsQ0FBQyxXQUFXO29CQUN0QyxZQUFZLEVBQUUsYUFBYSxDQUFDLFlBQVk7b0JBQ3hDLFFBQVEsRUFBRSxhQUFhLENBQUMsUUFBUSxJQUFJLGFBQWEsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO29CQUM3RCxrQkFBa0IsRUFBRSxhQUFhLENBQUMsa0JBQWtCLElBQUksS0FBSztvQkFDN0QsV0FBVyxFQUFFLGFBQWEsQ0FBQyxXQUFXO29CQUN0QyxVQUFVLEVBQUUsU0FBUztvQkFDckIsWUFBWSxFQUFFLGFBQWEsQ0FBQyxZQUFZO2lCQUN6QyxDQUFDO2dCQUVGLE1BQU0sUUFBUSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxjQUFjLENBQUMsZUFBZSxDQUFDLENBQUU7Z0JBRWhFLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXVCLEVBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUVsRCxNQUFNLFFBQVEsR0FBRztvQkFDZixHQUFHLFFBQVE7b0JBQ1gsZ0JBQWdCLEVBQUUsVUFBVTtvQkFDNUIsVUFBVSxFQUFFLFdBQVc7b0JBQ3ZCLFFBQVEsRUFBRSxRQUFRLENBQUMsV0FBVztpQkFDL0IsQ0FBQztnQkFFRixPQUFPLENBQUMsR0FBRyxDQUFDLHNCQUFzQixFQUFFLFFBQVEsQ0FBQyxDQUFDO2dCQUM5QyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUNqQyxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLG1FQUFtRTtpQkFDN0UsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztRQUNILENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLG1DQUFtQztZQUNuQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7Z0JBQ25CLElBQUksQ0FBQztvQkFDSCxZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQUMsT0FBTyxZQUFZLEVBQUUsQ0FBQztvQkFDdEIsT0FBTyxDQUFDLElBQUksQ0FBQyxzQ0FBc0MsRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDckUsQ0FBQztZQUNILENBQUM7WUFFRCxPQUFPLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXBELElBQUksTUFBTSxZQUFZLE9BQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLHVCQUF1QjtvQkFDaEMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxNQUFNO2lCQUN0QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQyxDQUFDO1FBQ2pFLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILG9CQUFvQjtJQUNwQixHQUFHLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLGtCQUFXLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3hGLE9BQU8sQ0FBQyxHQUFHLENBQUMseURBQXlELEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUN0RixPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUM7UUFDNUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDcEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQ0FBcUMsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBRS9ELElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDdEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMzQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBRWpDLDZFQUE2RTtZQUM3RSxNQUFNLGdCQUFnQixHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBRTVHLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN0QixPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO2dCQUNyRSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLG9CQUFvQixFQUFFLENBQUMsQ0FBQztZQUNqRSxDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsRUFBRTtnQkFDckQsRUFBRSxFQUFFLGdCQUFnQixDQUFDLEVBQUU7Z0JBQ3ZCLElBQUksRUFBRSxnQkFBZ0IsQ0FBQyxJQUFJO2dCQUMzQixRQUFRLEVBQUUsZ0JBQWdCLENBQUMsUUFBUTtnQkFDbkMsVUFBVSxFQUFFLGdCQUFnQixDQUFDLFVBQVU7Z0JBQ3ZDLFdBQVcsRUFBRSxnQkFBZ0IsQ0FBQyxXQUFXO2FBQzFDLENBQUMsQ0FBQztZQUVILGtEQUFrRDtZQUNsRCxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDdEIsSUFBSSxRQUFRLEtBQUssT0FBTyxFQUFFLENBQUM7Z0JBQ3pCLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztZQUMxRCxDQUFDO2lCQUFNLElBQUksUUFBUSxLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUNsQyxnRUFBZ0U7Z0JBQ2hFLE1BQU0sYUFBYSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDakUsTUFBTSxTQUFTLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksRUFBRSxDQUFDO2dCQUMvQyxNQUFNLGlCQUFpQixHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsY0FBYyxDQUFDLENBQUM7Z0JBRXZFLElBQUksZ0JBQWdCLENBQUMsVUFBVSxFQUFFLENBQUM7b0JBQ2hDLE1BQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDL0MsaUJBQWlCLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDLENBQzFELENBQUM7b0JBQ0YsTUFBTSxjQUFjLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFDbkQsU0FBUyxHQUFHLGNBQWMsQ0FBQyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUM7Z0JBQ25FLENBQUM7Z0JBQ0QsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsU0FBUyxFQUFFLENBQUMsQ0FBQztZQUNuRSxDQUFDO1lBRUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUNmLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLE1BQU0sRUFBRSxDQUFDLENBQUM7Z0JBQ3BFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztZQUM1RCxDQUFDO1lBRUQsc0JBQXNCO1lBQ3RCLE1BQU0sVUFBVSxHQUFRLEVBQUUsQ0FBQztZQUUzQixJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtnQkFBRSxVQUFVLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ25ELElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLEtBQUssU0FBUztnQkFBRSxVQUFVLENBQUMsV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO1lBQ3RGLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZO2dCQUFFLFVBQVUsQ0FBQyxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7WUFDM0UsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixLQUFLLFNBQVMsRUFBRSxDQUFDO2dCQUM5QyxVQUFVLENBQUMsa0JBQWtCLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsS0FBSyxNQUFNLENBQUM7WUFDekUsQ0FBQztZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsbUNBQW1DLEVBQUUsVUFBVSxDQUFDLENBQUM7WUFFN0Qsc0NBQXNDO1lBQ3RDLElBQUksR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNiLE9BQU8sQ0FBQyxHQUFHLENBQUMsbURBQW1ELEVBQUU7b0JBQy9ELFlBQVksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVk7b0JBQ25DLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7b0JBQ25CLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVE7b0JBQzNCLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7aUJBQ3hCLENBQUMsQ0FBQztnQkFFSCxvQkFBb0I7Z0JBQ3BCLE1BQU0sY0FBYyxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlDLElBQUksQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLENBQUM7b0JBQzVCLHFCQUFxQjtvQkFDckIsSUFBSSxDQUFDO3dCQUNILFlBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztvQkFDL0IsQ0FBQztvQkFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO3dCQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLGlDQUFpQyxFQUFFLFlBQVksQ0FBQyxDQUFDO29CQUNoRSxDQUFDO29CQUNELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsY0FBYyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQ2pFLENBQUM7Z0JBRUQsNEJBQTRCO2dCQUM1QixNQUFNLGFBQWEsR0FBRyxjQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzFELE1BQU0sWUFBWSxHQUFHLGNBQUksQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsYUFBYSxDQUFDLENBQUM7Z0JBQ3pFLE1BQU0sUUFBUSxHQUFHLGdCQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDeEQsTUFBTSxVQUFVLEdBQUcsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQztnQkFDNUUsTUFBTSxRQUFRLEdBQUcsZ0JBQWdCLENBQUMsVUFBVSxJQUFJLGdCQUFnQixDQUFDLFdBQVcsQ0FBQztnQkFFN0UsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxRQUFRLElBQUksU0FBUyxDQUFDLENBQUM7Z0JBQzVGLE1BQU0sY0FBYyxHQUFHLEdBQUcsUUFBUSxJQUFJLFlBQVksR0FBRyxhQUFhLEVBQUUsQ0FBQztnQkFDckUsTUFBTSxTQUFTLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsY0FBYyxDQUFDLENBQUM7Z0JBQzFELE1BQU0sWUFBWSxHQUFHLGNBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsSUFBSSxTQUFTLEVBQUUsY0FBYyxDQUFDLENBQUM7Z0JBRWxGLDBCQUEwQjtnQkFDMUIsSUFBSSxDQUFDLFlBQUUsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztvQkFDakMsWUFBRSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDbEQsQ0FBQztnQkFFRCx3Q0FBd0M7Z0JBQ3hDLFlBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUM7Z0JBRXhDLDZCQUE2QjtnQkFDN0IsVUFBVSxDQUFDLFFBQVEsR0FBRyxZQUFZLENBQUM7Z0JBQ25DLFVBQVUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUM7Z0JBQzVDLFVBQVUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ3BDLFVBQVUsQ0FBQyxRQUFRLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7Z0JBRXhDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLFNBQVMsRUFBRSxDQUFDLENBQUM7Z0JBRWhFLGlDQUFpQztnQkFDakMsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsQ0FBQztvQkFDOUIsTUFBTSxXQUFXLEdBQUcsY0FBSSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUM7d0JBQzVELENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRO3dCQUMzQixDQUFDLENBQUMsY0FBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO29CQUVuRSxJQUFJLENBQUM7d0JBQ0gsSUFBSSxZQUFFLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7NEJBQy9CLFlBQUUsQ0FBQyxVQUFVLENBQUMsV0FBVyxDQUFDLENBQUM7NEJBQzNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLFdBQVcsRUFBRSxDQUFDLENBQUM7d0JBQzNFLENBQUM7b0JBQ0gsQ0FBQztvQkFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO3dCQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLFlBQVksQ0FBQyxDQUFDO29CQUMvRCxDQUFDO2dCQUNILENBQUM7WUFDSCxDQUFDO1lBRUQsc0JBQXNCO1lBQ3RCLE1BQU0sZUFBZSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxjQUFjLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDO1lBRTdFLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztnQkFDckIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsVUFBVSxFQUFFLENBQUMsQ0FBQztnQkFDNUUsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxDQUFDLENBQUM7WUFDeEUsQ0FBQztZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsb0RBQW9ELEVBQUU7Z0JBQ2hFLEVBQUUsRUFBRyxlQUF1QixDQUFDLEVBQUU7Z0JBQy9CLElBQUksRUFBRyxlQUF1QixDQUFDLElBQUk7YUFDcEMsQ0FBQyxDQUFDO1lBRUgsd0NBQXdDO1lBQ3ZDLGVBQXVCLENBQUMsZ0JBQWdCLEdBQUksZUFBdUIsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDO1lBQ3pHLGVBQXVCLENBQUMsVUFBVSxHQUFJLGVBQXVCLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQztZQUNwRyxlQUF1QixDQUFDLFFBQVEsR0FBSSxlQUF1QixDQUFDLFVBQVUsSUFBSyxlQUF1QixDQUFDLFdBQVcsQ0FBQztZQUVoSCxHQUFHLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQzVCLENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLG1DQUFtQztZQUNuQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7Z0JBQ25CLElBQUksQ0FBQztvQkFDSCxZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7b0JBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0RBQXdELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDdkYsQ0FBQztnQkFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO29CQUN0QixPQUFPLENBQUMsSUFBSSxDQUFDLHNDQUFzQyxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUNyRSxDQUFDO1lBQ0gsQ0FBQztZQUVELE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFcEQsSUFBSSxNQUFNLFlBQVksT0FBQyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUNqQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsdUJBQXVCO29CQUNoQyxNQUFNLEVBQUUsTUFBTSxDQUFDLE1BQU07aUJBQ3RCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSwyQkFBMkIsRUFBRSxDQUFDLENBQUM7UUFDakUsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsdUNBQXVDO0lBQ3ZDLEdBQUcsQ0FBQyxHQUFHLENBQUMsbUNBQW1DLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ2hGLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFFdEIsb0NBQW9DO1lBQ3BDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUUsQ0FBQztnQkFDMUIsZ0JBQWdCLENBQUMsMkJBQTJCLEVBQUUsSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUMzRCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDJDQUEyQyxFQUFFLENBQUMsQ0FBQztZQUN4RixDQUFDO1lBRUQsb0RBQW9EO1lBQ3BELE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsS0FBZSxDQUFDLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZFLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFekQsTUFBTSxhQUFhLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsTUFBTSxHQUFHLEtBQUssQ0FBQyxDQUFDO1lBRTdELGdCQUFnQixDQUFDLGtCQUFrQixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFFL0UsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxNQUFNLEVBQUUsYUFBYTtnQkFDckIsS0FBSyxFQUFFLFFBQVEsQ0FBQyxNQUFNO2dCQUN0QixLQUFLO2dCQUNMLE1BQU07YUFDUCxDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ25ELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDhCQUE4QixFQUFFLENBQUMsQ0FBQztRQUNwRSxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxpREFBaUQ7SUFDakQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxvQkFBb0IsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDcEUsSUFBSSxDQUFDO1lBQ0gsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUN0QixNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDdkIsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDakMsTUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxJQUFjLENBQUMsQ0FBQyxxQkFBcUI7WUFFcEUsa0RBQWtEO1lBQ2xELE1BQU0sYUFBYSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUNqRSxNQUFNLGNBQWMsR0FBRyxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDO1lBRTlGLDRDQUE0QztZQUM1QyxJQUFJLE9BQU8sR0FBRyxLQUFLLENBQUM7WUFFcEIsSUFBSSxDQUFDO2dCQUNILE9BQU8sR0FBRyxNQUFNLGlCQUFPLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3JELENBQUM7WUFBQyxPQUFPLENBQUMsRUFBRSxDQUFDO2dCQUNYLE9BQU8sQ0FBQyxJQUFJLENBQUMsNkJBQTZCLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDakQsQ0FBQztZQUVELElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDYixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDJDQUEyQyxFQUFFLENBQUMsQ0FBQztZQUN4RixDQUFDO1lBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN6QixDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3RELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDJCQUEyQixFQUFFLENBQUMsQ0FBQztRQUNqRSxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCwrRUFBK0U7SUFDL0UsR0FBRyxDQUFDLElBQUksQ0FDTiwyQkFBMkIsRUFDM0Isa0JBQVcsRUFDWCxNQUFNLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUNyQixLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3RCLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDdEIsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQztZQUMzQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDLENBQUMsd0RBQXdEO1lBQzFGLE1BQU0sRUFBRSxZQUFZLEdBQUcsVUFBVSxFQUFFLFdBQVcsRUFBRSxHQUFHLFNBQVMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFFMUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsRUFBRTtnQkFDekMsVUFBVTtnQkFDVixNQUFNO2dCQUNOLFFBQVE7Z0JBQ1IsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSTtnQkFDbkIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJO29CQUNoQixDQUFDLENBQUM7d0JBQ0UsU0FBUyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUzt3QkFDN0IsWUFBWSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTt3QkFDbkMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUTt3QkFDM0IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUTt3QkFDM0IsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTt3QkFDbkIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtxQkFDcEI7b0JBQ0gsQ0FBQyxDQUFDLElBQUk7Z0JBQ1IsUUFBUSxFQUFFLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDL0IsV0FBVyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDO2FBQ3pDLENBQUMsQ0FBQztZQUVILGdGQUFnRjtZQUNoRixJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO2dCQUN6RCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDhDQUE4QyxFQUFFLENBQUMsQ0FBQztZQUMzRixDQUFDO1lBRUQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7Z0JBQ3RELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsNkJBQTZCLEVBQUUsQ0FBQyxDQUFDO1lBQzFFLENBQUM7WUFFRCxpRUFBaUU7WUFDakUsTUFBTSxTQUFTLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQztnQkFDM0MsTUFBTTtnQkFDTixRQUFRO2FBQ1QsQ0FBQyxDQUFDO1lBRUgsTUFBTSxnQkFBZ0IsR0FBRyxTQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLFVBQVUsQ0FBQyxDQUFDO1lBRXhFLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUN0QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDBCQUEwQixFQUFFLENBQUMsQ0FBQztZQUN2RSxDQUFDO1lBRUQsK0RBQStEO1lBRS9ELHNEQUFzRDtZQUN0RCxJQUFJLGNBQXNCLENBQUM7WUFFM0IsSUFBSSxnQkFBZ0IsQ0FBQyxVQUFVLEVBQUUsQ0FBQztnQkFDaEMsTUFBTSxRQUFRLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDeEUsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDO29CQUNkLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO2dCQUNqRSxDQUFDO2dCQUNELGNBQWMsR0FBRyxRQUFRLENBQUMsY0FBYyxDQUFDO1lBQzNDLENBQUM7aUJBQU0sSUFBSSxnQkFBZ0IsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDeEMsTUFBTSxTQUFTLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDM0UsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO29CQUNmLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsQ0FBQyxDQUFDO2dCQUNsRSxDQUFDO2dCQUNELE1BQU0sUUFBUSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO2dCQUNqRSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7b0JBQ2QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxDQUFDLENBQUM7Z0JBQ2pFLENBQUM7Z0JBQ0QsY0FBYyxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUM7WUFDM0MsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLE9BQU8sR0FBRztxQkFDUCxNQUFNLENBQUMsR0FBRyxDQUFDO3FCQUNYLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxnRUFBZ0UsRUFBRSxDQUFDLENBQUM7WUFDekYsQ0FBQztZQUVELGdEQUFnRDtZQUVoRCx3Q0FBd0M7WUFDeEMsTUFBTSxlQUFlLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGNBQWMsQ0FBQyxVQUFVLEVBQUU7Z0JBQy9ELFFBQVEsRUFBRSxZQUFZLGNBQWMsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRTtnQkFDL0QsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTtnQkFDM0Isd0NBQXdDO2FBQ3pDLENBQUMsQ0FBQztZQUVILDBCQUEwQjtZQUMxQixJQUFJLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksWUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQzlELFlBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUMvQixDQUFDO1lBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLFFBQVEsRUFBRSxlQUFlO2dCQUN6QixPQUFPLEVBQUUsNEJBQTRCO2FBQ3RDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE1BQU0sY0FBYyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDaEQsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLGNBQWMsZUFBZSxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDekUsT0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLGNBQWMsa0JBQWtCLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBQ25FLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxjQUFjLGdCQUFnQixFQUFFLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUUvRCxtQ0FBbUM7WUFDbkMsSUFBSSxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxJQUFJLFlBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO2dCQUM5RCxJQUFJLENBQUM7b0JBQ0gsWUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUMvQixDQUFDO2dCQUFDLE9BQU8sWUFBWSxFQUFFLENBQUM7b0JBQ3RCLE9BQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxjQUFjLDJCQUEyQixFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUM3RSxDQUFDO1lBQ0gsQ0FBQztZQUVELElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxVQUFVLEVBQUUsQ0FBQztnQkFDOUIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLGtCQUFrQjtvQkFDM0IsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2lCQUNyQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsQ0FBQyxDQUFDO1FBQ2pFLENBQUM7SUFDSCxDQUFDLENBQ0YsQ0FBQztJQUVGLHFGQUFxRjtJQUNyRixHQUFHLENBQUMsSUFBSSxDQUFDLHVCQUF1QixFQUFFLGtCQUFXLEVBQUUsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQzVGLE1BQU0sU0FBUyxHQUFHLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFNBQVMsbURBQW1ELEVBQUU7WUFDNUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSTtZQUNuQixRQUFRLEVBQUUsR0FBRyxDQUFDLElBQUksRUFBRSxZQUFZO1lBQ2hDLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxFQUFFLElBQUk7WUFDeEIsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJO1lBQ2QsTUFBTSxFQUFFLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRTtTQUNyQixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUM7WUFFSCw2QkFBNkI7WUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDZCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztZQUMvRCxDQUFDO1lBRUQsa0JBQWtCO1lBQ2xCLE1BQU0sUUFBUSxHQUFHO2dCQUNmLElBQUksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7Z0JBQ25CLFdBQVcsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxFQUFFO2dCQUN2QyxZQUFZLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsMEJBQTBCO2dCQUNoRixrQkFBa0IsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGtCQUFrQixLQUFLLE1BQU07Z0JBQzFELFdBQVcsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxTQUFTO2dCQUM5QyxVQUFVLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLElBQUksU0FBUztnQkFDNUMsY0FBYyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsY0FBYyxJQUFJLFNBQVM7Z0JBQ3BELFlBQVksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksSUFBSSxTQUFTO2FBQ2pELENBQUM7WUFFRix3REFBd0Q7WUFDeEQsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZLEVBQUUsQ0FBQztnQkFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQ0FBMkMsRUFBRSxRQUFRLENBQUMsQ0FBQztZQUNyRSxDQUFDO1lBRUQscUJBQXFCO1lBQ3JCLE1BQU0sYUFBYSxHQUFHLDBCQUEwQixDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUVqRSx1REFBdUQ7WUFDdkQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFNBQVMscURBQXFELEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDMUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLFNBQVMsd0NBQXdDLEVBQUU7Z0JBQ2pFLEdBQUcsYUFBYTtnQkFDaEIsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxjQUFjO2dCQUNqRCxlQUFlLEVBQUUsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxZQUFZO2FBQzlDLENBQUMsQ0FBQztZQUVILDZDQUE2QztZQUM3QyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVksRUFBRSxDQUFDO2dCQUMxQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxFQUFFLGFBQWEsQ0FBQyxDQUFDO1lBQzFFLENBQUM7WUFFRCxxQ0FBcUM7WUFDckMsTUFBTSxNQUFNLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUM7WUFDNUIsSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNaLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsd0JBQXdCLEVBQUUsQ0FBQyxDQUFDO1lBQ3JFLENBQUM7WUFFRCxxRUFBcUU7WUFDckUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO1lBRXJFLDJCQUEyQjtZQUMzQixNQUFNLGFBQWEsR0FBRyxjQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDMUQsTUFBTSxZQUFZLEdBQUcsY0FBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxhQUFhLENBQUMsQ0FBQztZQUN6RSxNQUFNLGNBQWMsR0FBRyxHQUFHLElBQUEsU0FBTSxHQUFFLElBQUksWUFBWSxHQUFHLGFBQWEsRUFBRSxDQUFDO1lBRXJFLElBQUksUUFBZ0IsQ0FBQztZQUNyQixJQUFJLGFBQWEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDOUIsUUFBUSxHQUFHLGNBQWMsYUFBYSxDQUFDLFdBQVcsSUFBSSxjQUFjLEVBQUUsQ0FBQztZQUN6RSxDQUFDO2lCQUFNLElBQUksYUFBYSxDQUFDLFVBQVUsRUFBRSxDQUFDO2dCQUNwQyxRQUFRLEdBQUcsYUFBYSxhQUFhLENBQUMsVUFBVSxJQUFJLGNBQWMsRUFBRSxDQUFDO1lBQ3ZFLENBQUM7aUJBQU0sQ0FBQztnQkFDTixRQUFRLEdBQUcsV0FBVyxjQUFjLEVBQUUsQ0FBQztZQUN6QyxDQUFDO1lBRUQseURBQXlEO1lBQ3pELE9BQU8sQ0FBQyxHQUFHLENBQUMsbUVBQW1FLENBQUMsQ0FBQztZQUVqRiwwQ0FBMEM7WUFDMUMsSUFBSSxDQUFDO2dCQUNILCtDQUErQztnQkFDL0MsTUFBTSxnQkFBZ0IsR0FBRyxjQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLENBQUMsQ0FBQztnQkFFN0Qsa0NBQWtDO2dCQUNsQyxJQUFJLENBQUM7b0JBQ0gsSUFBSSxDQUFDLFlBQUUsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsRUFBRSxDQUFDO3dCQUNyQyxZQUFFLENBQUMsU0FBUyxDQUFDLGdCQUFnQixFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7d0JBQ3BELE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztvQkFDbkUsQ0FBQztnQkFDSCxDQUFDO2dCQUFDLE9BQU8sUUFBUSxFQUFFLENBQUM7b0JBQ2xCLE9BQU8sQ0FBQyxLQUFLLENBQUMscUNBQXFDLEVBQUUsUUFBUSxDQUFDLENBQUM7b0JBQy9ELE1BQU0sSUFBSSxLQUFLLENBQUMscURBQXFELENBQUMsQ0FBQztnQkFDekUsQ0FBQztnQkFFRCxzQ0FBc0M7Z0JBQ3RDLE1BQU0sYUFBYSxHQUFHLGNBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQzVELE1BQU0sWUFBWSxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBRWpELElBQUksQ0FBQztvQkFDSCxJQUFJLENBQUMsWUFBRSxDQUFDLFVBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO3dCQUNqQyxZQUFFLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO3dCQUNoRCxPQUFPLENBQUMsR0FBRyxDQUFDLDRCQUE0QixZQUFZLEVBQUUsQ0FBQyxDQUFDO29CQUMxRCxDQUFDO2dCQUNILENBQUM7Z0JBQUMsT0FBTyxXQUFXLEVBQUUsQ0FBQztvQkFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsRUFBRSxXQUFXLENBQUMsQ0FBQztvQkFDbEUsTUFBTSxJQUFJLEtBQUssQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO2dCQUN0RSxDQUFDO2dCQUVELHNDQUFzQztnQkFDdEMsSUFBSSxDQUFDO29CQUNILFlBQUUsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLElBQUssQ0FBQyxJQUFJLEVBQUUsYUFBYSxDQUFDLENBQUM7b0JBQy9DLDBCQUEwQjtnQkFDNUIsQ0FBQztnQkFBQyxPQUFPLFNBQVMsRUFBRSxDQUFDO29CQUNuQixPQUFPLENBQUMsS0FBSyxDQUFDLHNCQUFzQixFQUFFLFNBQVMsQ0FBQyxDQUFDO29CQUNqRCxNQUFNLElBQUksS0FBSyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7Z0JBQ3pFLENBQUM7WUFDSCxDQUFDO1lBQUMsT0FBTyxVQUFVLEVBQUUsQ0FBQztnQkFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsRUFBRSxVQUFVLENBQUMsQ0FBQztnQkFDbEQsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBQ2pELENBQUM7WUFFRCxxQ0FBcUM7WUFDckMsTUFBTSxZQUFZLEdBQW1CO2dCQUNuQyxJQUFJLEVBQUUsYUFBYSxDQUFDLElBQUk7Z0JBQ3hCLFdBQVcsRUFBRSxhQUFhLENBQUMsV0FBVztnQkFDdEMsWUFBWSxFQUFFLGFBQWEsQ0FBQyxZQUFZO2dCQUN4QyxRQUFRLEVBQUUsUUFBUTtnQkFDbEIsa0JBQWtCLEVBQUUsYUFBYSxDQUFDLGtCQUFrQjtnQkFDcEQsV0FBVyxFQUFFLGFBQWEsQ0FBQyxXQUFXO2dCQUN0QyxVQUFVLEVBQUUsYUFBYSxDQUFDLFVBQVU7Z0JBQ3BDLFlBQVksRUFBRSxNQUFNO2dCQUNwQixjQUFjLEVBQUUsYUFBYSxDQUFDLGNBQWM7Z0JBQzVDLFlBQVksRUFBRSxhQUFhLENBQUMsWUFBWTthQUN6QyxDQUFDO1lBRUYscUNBQXFDO1lBRXJDLHVDQUF1QztZQUN2QyxNQUFNLFdBQVcsR0FBRyxNQUFNLGlCQUFPLENBQUMsY0FBYyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRS9ELHVDQUF1QztZQUV2QywwQkFBMEI7WUFDMUIsSUFBSSxZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDakMsWUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQy9CLENBQUM7WUFFRCwwQkFBMEI7WUFDMUIsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE9BQU8sRUFBRSxzQ0FBc0M7Z0JBQy9DLFFBQVEsRUFBRSxXQUFXO2FBQ3RCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE1BQU0sVUFBVSxHQUFHLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTNFLG1DQUFtQztZQUNuQyxJQUFJLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksWUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7Z0JBQzlELElBQUksQ0FBQztvQkFDSCxZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQUMsT0FBTyxZQUFZLEVBQUUsQ0FBQztvQkFDdEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsRUFBRSxZQUFZLENBQUMsQ0FBQztnQkFDbkUsQ0FBQztZQUNILENBQUM7WUFFRCwyQkFBMkI7WUFDM0IsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRSxDQUFDO2dCQUM5QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsa0JBQWtCO29CQUMzQixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07b0JBQ3BCLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUztpQkFDL0IsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELG9CQUFvQjtZQUNwQixJQUFJLEtBQUssQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsc0JBQXNCLENBQUMsRUFBRSxDQUFDO2dCQUNwRSxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsb0JBQW9CO29CQUM3QixLQUFLLEVBQUUsdUJBQXVCO29CQUM5QixRQUFRLEVBQUUsVUFBVSxDQUFDLFNBQVM7aUJBQy9CLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCx1REFBdUQ7WUFDdkQsSUFBSSxLQUFLLEVBQUUsT0FBTyxFQUFFLFFBQVEsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLEtBQUssRUFBRSxJQUFJLEtBQUssT0FBTyxFQUFFLENBQUM7Z0JBQzdFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSwyREFBMkQ7b0JBQ3BFLEtBQUssRUFBRSxxQkFBcUI7b0JBQzVCLFFBQVEsRUFBRSxVQUFVLENBQUMsU0FBUztpQkFDL0IsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHlCQUF5QjtZQUN6QixJQUFJLEtBQUssQ0FBQyxPQUFPLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztnQkFDeEQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLGdDQUFnQztvQkFDekMsS0FBSyxFQUFFLGdCQUFnQjtvQkFDdkIsUUFBUSxFQUFFLFVBQVUsQ0FBQyxTQUFTO2lCQUMvQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQseUJBQXlCO1lBQ3pCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsdUJBQXVCO2dCQUNoQyxLQUFLLEVBQUUsOEJBQThCO2dCQUNyQyxRQUFRLEVBQUUsVUFBVSxDQUFDLFNBQVM7Z0JBQzlCLFVBQVUsRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVM7YUFDL0UsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsdUJBQXVCO0lBQ3ZCLDZEQUE2RDtJQUM3RCxHQUFHLENBQUMsR0FBRyxDQUFDLHlCQUF5QixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN0RSxNQUFNLFdBQVcsR0FBRyxnQkFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBQ3hDLE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUVwQyxJQUFJLENBQUM7WUFDSCxNQUFNLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQ3RCLE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDM0IsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUN2QixNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNqQyxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsS0FBSyxDQUFDLFFBQVEsS0FBSyxNQUFNLENBQUM7WUFFakQsb0JBQW9CLENBQUMsb0JBQW9CLEVBQUU7Z0JBQ3pDLFdBQVc7Z0JBQ1gsVUFBVTtnQkFDVixNQUFNO2dCQUNOLFFBQVE7Z0JBQ1IsVUFBVTtnQkFDVixXQUFXLEVBQUU7b0JBQ1gsR0FBRyxFQUFFLEdBQUcsQ0FBQyxHQUFHO29CQUNaLE1BQU0sRUFBRSxHQUFHLENBQUMsTUFBTTtvQkFDbEIsU0FBUyxFQUFFLEdBQUcsQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDO29CQUNwQyxPQUFPLEVBQUUsR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPO29CQUM1QixRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLGFBQWE7aUJBQ2pEO2FBQ0YsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVYLCtDQUErQztZQUMvQyxNQUFNLG1CQUFtQixHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUM5QyxNQUFNLGFBQWEsR0FBRyxNQUFNLGlCQUFPLENBQUMsb0JBQW9CLENBQUMsTUFBTSxDQUFDLENBQUM7WUFDakUsTUFBTSxVQUFVLEdBQUcsTUFBTSxpQkFBTyxDQUFDLGlCQUFpQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzNELE1BQU0sU0FBUyxHQUFHLE1BQU0saUJBQU8sQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUMvQyxNQUFNLGtCQUFrQixHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxtQkFBbUIsQ0FBQztZQUVuRSxvQkFBb0IsQ0FBQyx3QkFBd0IsRUFBRTtnQkFDN0MsV0FBVztnQkFDWCxRQUFRLEVBQUUsR0FBRyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQzlDLFNBQVMsRUFBRTtvQkFDVCxrQkFBa0IsRUFBRSxhQUFhLENBQUMsTUFBTTtvQkFDeEMsZUFBZSxFQUFFLFVBQVUsQ0FBQyxNQUFNO29CQUNsQyxjQUFjLEVBQUUsU0FBUyxDQUFDLE1BQU07aUJBQ2pDO2FBQ0YsRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVaLDBDQUEwQztZQUMxQyxnQkFBZ0IsQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRTtnQkFDeEUsV0FBVztnQkFDWCxRQUFRO2dCQUNSLFVBQVU7Z0JBQ1YsVUFBVTtnQkFDVixjQUFjLEVBQUU7b0JBQ2QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO29CQUNuQyxRQUFRLEVBQUUsR0FBRyxDQUFDLEVBQUUsSUFBSSxHQUFHLENBQUMsVUFBVSxDQUFDLGFBQWE7b0JBQ2hELFNBQVMsRUFBRSxHQUFHLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQztpQkFDckM7YUFDRixDQUFDLENBQUM7WUFFSCxxREFBcUQ7WUFDckQsTUFBTSxtQkFBbUIsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDOUMsTUFBTSxZQUFZLEdBQUcsTUFBTSxpQkFBTyxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNwRCxNQUFNLFFBQVEsR0FBRyxZQUFZLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxLQUFLLFVBQVUsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sa0JBQWtCLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxHQUFHLG1CQUFtQixDQUFDO1lBRW5FLG9CQUFvQixDQUFDLGlCQUFpQixFQUFFO2dCQUN0QyxXQUFXO2dCQUNYLFVBQVU7Z0JBQ1YsVUFBVSxFQUFFLEdBQUcsa0JBQWtCLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJO2dCQUNoRCxzQkFBc0IsRUFBRSxZQUFZLENBQUMsTUFBTTtnQkFDM0MsYUFBYSxFQUFFLENBQUMsQ0FBQyxRQUFRO2FBQzFCLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFWixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQ2Qsb0JBQW9CLENBQUMsb0JBQW9CLEVBQUU7b0JBQ3pDLFdBQVc7b0JBQ1gsVUFBVTtvQkFDVix3QkFBd0IsRUFBRSxZQUFZLENBQUMsTUFBTTtpQkFDOUMsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDWCxnQkFBZ0IsQ0FBQyxnQ0FBZ0MsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxFQUFFLFdBQVcsRUFBRSxDQUFDLENBQUM7Z0JBQzdGLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsQ0FBQyxDQUFDO1lBQ2pFLENBQUM7WUFFRCw2QkFBNkI7WUFFN0IsK0JBQStCO1lBQy9CLE1BQU0saUJBQWlCLEdBQUcsYUFBYSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUN2RSxNQUFNLGdCQUFnQixHQUFHLFVBQVU7aUJBQ2hDLEdBQUcsQ0FBQyxDQUFDLEVBQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLFdBQVcsSUFBSSxFQUFFLENBQUMsYUFBYSxFQUFFLFdBQVcsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLEVBQUUsQ0FBQztpQkFDckYsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRW5CLG9EQUFvRDtZQUNwRCxNQUFNLGVBQWUsR0FBRyxFQUFFLENBQUM7WUFDM0IsS0FBSyxNQUFNLGFBQWEsSUFBSSxVQUFVLEVBQUUsQ0FBQztnQkFDdkMsNkNBQTZDO2dCQUM3QyxNQUFNLFdBQVcsR0FBRyxhQUFhLENBQUMsV0FBVyxDQUFDO2dCQUM5QyxJQUFJLFdBQVcsRUFBRSxDQUFDO29CQUNoQiwrQ0FBK0M7b0JBQy9DLE1BQU0sYUFBYSxHQUFHLE1BQU0saUJBQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQztvQkFDcEQsTUFBTSxTQUFTLEdBQUcsYUFBYSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssV0FBVyxDQUFDLENBQUM7b0JBQ2hFLElBQUksU0FBUyxFQUFFLFVBQVUsRUFBRSxDQUFDO3dCQUMxQixlQUFlLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQztvQkFDN0MsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztZQUVELGlEQUFpRDtZQUNqRCxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDdEIsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFDO1lBRXRCLElBQUksUUFBUSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUN6QixTQUFTLEdBQUcsSUFBSSxDQUFDO2dCQUNqQixZQUFZLEdBQUcseUJBQXlCLENBQUM7Z0JBQ3pDLHVCQUF1QjtZQUN6QixDQUFDO2lCQUFNLElBQUksUUFBUSxLQUFLLFNBQVMsSUFBSSxRQUFRLEtBQUssY0FBYyxFQUFFLENBQUM7Z0JBQ2pFLCtCQUErQjtnQkFFL0IsK0RBQStEO2dCQUMvRCxJQUFJLFFBQVEsQ0FBQyxVQUFVLEVBQUUsQ0FBQztvQkFDeEIsaUNBQWlDO29CQUNqQywrQ0FBK0M7b0JBQy9DLE1BQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FDL0MsaUJBQWlCLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDLENBQzFELENBQUM7b0JBQ0YsTUFBTSxjQUFjLEdBQUcsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztvQkFFbkQsa0NBQWtDO29CQUVsQyxJQUFJLGNBQWMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7d0JBQ2pELFNBQVMsR0FBRyxJQUFJLENBQUM7d0JBQ2pCLFlBQVksR0FBRyw4Q0FBOEMsQ0FBQzt3QkFDOUQsa0NBQWtDO29CQUNwQyxDQUFDO3lCQUFNLENBQUM7d0JBQ04saUNBQWlDO29CQUNuQyxDQUFDO2dCQUNILENBQUM7Z0JBRUQsNkRBQTZEO2dCQUM3RCxJQUFJLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztvQkFDekIsdURBQXVEO29CQUN2RCxNQUFNLGFBQWEsR0FBRyxNQUFNLGlCQUFPLENBQUMsYUFBYSxFQUFFLENBQUM7b0JBQ3BELE1BQU0sU0FBUyxHQUFHLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztvQkFDekUsSUFBSSxTQUFTLEVBQUUsQ0FBQzt3QkFDZCxnRUFBZ0U7d0JBQ2hFLE1BQU0saUJBQWlCLEdBQUcsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO3dCQUM3RSxJQUFJLGlCQUFpQixJQUFJLGlCQUFpQixDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQyxjQUFjLElBQUksRUFBRSxDQUFDLEVBQUUsQ0FBQzs0QkFDNUYsU0FBUyxHQUFHLElBQUksQ0FBQzs0QkFDakIsWUFBWSxHQUFHLCtDQUErQyxDQUFDO3dCQUNqRSxDQUFDO29CQUNILENBQUM7Z0JBQ0gsQ0FBQztZQUNILENBQUM7aUJBQU0sSUFBSSxRQUFRLEtBQUssVUFBVSxJQUFJLFFBQVEsS0FBSyxlQUFlLEVBQUUsQ0FBQztnQkFDbkUsNkRBQTZEO2dCQUM3RCxJQUFJLFFBQVEsQ0FBQyxVQUFVLElBQUksZUFBZSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUUsQ0FBQztvQkFDekUsU0FBUyxHQUFHLElBQUksQ0FBQztvQkFDakIsWUFBWSxHQUFHLG9EQUFvRCxDQUFDO2dCQUN0RSxDQUFDO2dCQUVELDhEQUE4RDtnQkFDOUQsSUFBSSxRQUFRLENBQUMsV0FBVyxJQUFJLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztvQkFDNUUsU0FBUyxHQUFHLElBQUksQ0FBQztvQkFDakIsWUFBWSxHQUFHLHFEQUFxRCxDQUFDO2dCQUN2RSxDQUFDO1lBQ0gsQ0FBQztpQkFBTSxJQUFJLFFBQVEsS0FBSyxRQUFRLElBQUksUUFBUSxLQUFLLGFBQWEsRUFBRSxDQUFDO2dCQUMvRCxpRUFBaUU7Z0JBQ2pFLElBQUksUUFBUSxDQUFDLGtCQUFrQixFQUFFLENBQUM7b0JBQ2hDLGlGQUFpRjtvQkFDakYsSUFBSSxRQUFRLENBQUMsVUFBVSxJQUFJLGVBQWUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7d0JBQ3pFLFNBQVMsR0FBRyxJQUFJLENBQUM7d0JBQ2pCLFlBQVksR0FBRyxxRUFBcUUsQ0FBQztvQkFDdkYsQ0FBQztvQkFFRCxrRkFBa0Y7b0JBQ2xGLElBQUksUUFBUSxDQUFDLFdBQVcsSUFBSSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7d0JBQzVFLFNBQVMsR0FBRyxJQUFJLENBQUM7d0JBQ2pCLFlBQVksR0FBRyxzRUFBc0UsQ0FBQztvQkFDeEYsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztZQUVELElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztnQkFDZixvQkFBb0IsQ0FBQyxvQkFBb0IsRUFBRTtvQkFDekMsV0FBVztvQkFDWCxVQUFVO29CQUNWLE1BQU07b0JBQ04sUUFBUTtvQkFDUixjQUFjLEVBQUU7d0JBQ2Qsa0JBQWtCLEVBQUUsUUFBUSxDQUFDLFVBQVU7d0JBQ3ZDLG1CQUFtQixFQUFFLFFBQVEsQ0FBQyxXQUFXO3dCQUN6QyxlQUFlO3dCQUNmLGdCQUFnQjt3QkFDaEIsa0JBQWtCLEVBQUUsUUFBUSxDQUFDLGtCQUFrQjt3QkFDL0MsWUFBWSxFQUFFLFFBQVEsQ0FBQyxZQUFZO3FCQUNwQztpQkFDRixFQUFFLE1BQU0sQ0FBQyxDQUFDO2dCQUVYLGdCQUFnQixDQUFDLDZCQUE2QixFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFO29CQUN2RSxXQUFXO29CQUNYLFFBQVE7b0JBQ1Isa0JBQWtCLEVBQUUsUUFBUSxDQUFDLFVBQVU7b0JBQ3ZDLG1CQUFtQixFQUFFLFFBQVEsQ0FBQyxXQUFXO29CQUN6QyxlQUFlO29CQUNmLGdCQUFnQjtvQkFDaEIsa0JBQWtCLEVBQUUsUUFBUSxDQUFDLGtCQUFrQjtpQkFDaEQsQ0FBQyxDQUFDO2dCQUNILE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsZUFBZSxFQUFFLENBQUMsQ0FBQztZQUM1RCxDQUFDO1lBRUQsb0JBQW9CLENBQUMscUJBQXFCLEVBQUU7Z0JBQzFDLFdBQVc7Z0JBQ1gsVUFBVTtnQkFDVixNQUFNO2dCQUNOLFFBQVE7Z0JBQ1IsWUFBWTtnQkFDWixZQUFZLEVBQUU7b0JBQ1osSUFBSSxFQUFFLFFBQVEsQ0FBQyxJQUFJO29CQUNuQixZQUFZLEVBQUUsUUFBUSxDQUFDLFlBQVk7b0JBQ25DLFFBQVEsRUFBRSxRQUFRLENBQUMsUUFBUTtvQkFDM0IsVUFBVSxFQUFFLFFBQVEsQ0FBQyxVQUFVO29CQUMvQixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7aUJBQ2xDO2FBQ0YsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVYLGdCQUFnQixDQUFDLDhCQUE4QixFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO2dCQUN2RSxXQUFXO2dCQUNYLFlBQVk7Z0JBQ1osUUFBUTtnQkFDUixZQUFZLEVBQUUsUUFBUSxDQUFDLFlBQVk7YUFDcEMsQ0FBQyxDQUFDO1lBRUgsMkJBQTJCO1lBQzNCLElBQUksUUFBUSxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUN0QixrQ0FBa0M7Z0JBQ2xDLElBQUksQ0FBQztvQkFDSCxpREFBaUQ7b0JBQ2pELElBQUksZUFBZSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUM7b0JBRXhDLHNCQUFzQjtvQkFFdEIsaUNBQWlDO29CQUNqQyxJQUFJLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUM7d0JBQ3RDLGVBQWUsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO3dCQUNwQyxzQkFBc0I7b0JBQ3hCLENBQUM7b0JBQ0QscUNBQXFDO3lCQUNoQyxJQUNILFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLGFBQWEsQ0FBQzt3QkFDekMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDO3dCQUN4QyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsQ0FBQzt3QkFDN0MsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDO3dCQUN0QyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFDcEMsQ0FBQzt3QkFDRCxpQ0FBaUM7d0JBRWpDLHFFQUFxRTt3QkFDckUsTUFBTSxhQUFhLEdBQUc7NEJBQ3BCLGNBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsRUFBRSxvREFBb0Q7NEJBQ2pHLGNBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLFNBQVMsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQUUsb0JBQW9COzRCQUM1RSxnQkFBZ0IsUUFBUSxDQUFDLFFBQVEsRUFBRTs0QkFDbkMsWUFBWSxRQUFRLENBQUMsUUFBUSxFQUFFOzRCQUMvQixhQUFhLFFBQVEsQ0FBQyxRQUFRLEVBQUU7NEJBQ2hDLGNBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUM7eUJBQ3JDLENBQUM7d0JBRUYsbUNBQW1DO3dCQUVuQyxpREFBaUQ7d0JBQ2pELEtBQUssTUFBTSxZQUFZLElBQUksYUFBYSxFQUFFLENBQUM7NEJBQ3pDLHFCQUFxQjs0QkFDckIsSUFBSSxZQUFFLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7Z0NBQ2hDLGVBQWUsR0FBRyxZQUFZLENBQUM7Z0NBQy9CLGFBQWE7Z0NBQ2IsTUFBTTs0QkFDUixDQUFDO3dCQUNILENBQUM7b0JBQ0gsQ0FBQztvQkFDRCxpQ0FBaUM7eUJBQzVCLElBQUksUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQzt3QkFDM0MsZUFBZSxHQUFHLFFBQVEsQ0FBQyxRQUFRLENBQUM7d0JBQ3BDLHVCQUF1QjtvQkFDekIsQ0FBQztvQkFFRCx3QkFBd0I7b0JBQ3hCLElBQUksWUFBRSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsRUFBRSxDQUFDO3dCQUNuQywwQkFBMEI7d0JBRTFCLG9GQUFvRjt3QkFDcEYsSUFBSSxRQUFRLEdBQUksUUFBZ0IsQ0FBQyxRQUFRLElBQUksUUFBUSxDQUFDLElBQUksSUFBSSxjQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQzt3QkFFL0YsZ0ZBQWdGO3dCQUNoRixJQUFJLENBQUMsY0FBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsSUFBSSxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7NEJBQ2pELE1BQU0sV0FBVyxHQUFHLGNBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDOzRCQUNwRCxJQUFJLFdBQVcsRUFBRSxDQUFDO2dDQUNoQixRQUFRLElBQUksV0FBVyxDQUFDOzRCQUMxQixDQUFDO3dCQUNILENBQUM7d0JBRUQsb0NBQW9DO3dCQUVwQyxJQUFJLFVBQVUsRUFBRSxDQUFDOzRCQUNmLEdBQUcsQ0FBQyxTQUFTLENBQUMscUJBQXFCLEVBQUUseUJBQXlCLFFBQVEsR0FBRyxDQUFDLENBQUM7d0JBQzdFLENBQUM7NkJBQU0sQ0FBQzs0QkFDTixHQUFHLENBQUMsU0FBUyxDQUFDLHFCQUFxQixFQUFFLHFCQUFxQixRQUFRLEdBQUcsQ0FBQyxDQUFDO3dCQUN6RSxDQUFDO3dCQUVELHVEQUF1RDt3QkFDdkQsTUFBTSxHQUFHLEdBQUcsY0FBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQzt3QkFDakQsdUJBQXVCO3dCQUV2QixJQUFJLEdBQUcsS0FBSyxNQUFNLEVBQUUsQ0FBQzs0QkFDbkIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsaUJBQWlCLENBQUMsQ0FBQzt3QkFDbkQsQ0FBQzs2QkFBTSxJQUFJLEdBQUcsS0FBSyxNQUFNLElBQUksR0FBRyxLQUFLLE9BQU8sRUFBRSxDQUFDOzRCQUM3QyxHQUFHLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSxZQUFZLENBQUMsQ0FBQzt3QkFDOUMsQ0FBQzs2QkFBTSxJQUFJLEdBQUcsS0FBSyxNQUFNLEVBQUUsQ0FBQzs0QkFDMUIsR0FBRyxDQUFDLFNBQVMsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUM7d0JBQzdDLENBQUM7NkJBQU0sSUFBSSxHQUFHLEtBQUssTUFBTSxFQUFFLENBQUM7NEJBQzFCLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFDO3dCQUM3QyxDQUFDOzZCQUFNLElBQUksR0FBRyxLQUFLLE1BQU0sSUFBSSxHQUFHLEtBQUssT0FBTyxFQUFFLENBQUM7NEJBQzdDLEdBQUcsQ0FBQyxTQUFTLENBQ1gsY0FBYyxFQUNkLHlFQUF5RSxDQUMxRSxDQUFDO3dCQUNKLENBQUM7NkJBQU0sSUFBSSxHQUFHLEtBQUssTUFBTSxFQUFFLENBQUM7NEJBQzFCLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLDJCQUEyQixDQUFDLENBQUM7d0JBQzdELENBQUM7NkJBQU0sQ0FBQzs0QkFDTixHQUFHLENBQUMsU0FBUyxDQUFDLGNBQWMsRUFBRSwwQkFBMEIsQ0FBQyxDQUFDO3dCQUM1RCxDQUFDO3dCQUVELHlDQUF5Qzt3QkFDekMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxZQUFZLEVBQUUsQ0FBQzs0QkFDMUMsTUFBTSxTQUFTLEdBQUcsWUFBRSxDQUFDLFFBQVEsQ0FBQyxlQUFlLENBQUMsQ0FBQzs0QkFDL0MsR0FBRyxDQUFDLEdBQUcsQ0FBQztnQ0FDTixlQUFlLEVBQUUscUNBQXFDO2dDQUN0RCxRQUFRLEVBQUUsVUFBVTtnQ0FDcEIsU0FBUyxFQUFFLEdBQUc7Z0NBQ2QsTUFBTSxFQUFFLElBQUksUUFBUSxDQUFDLEVBQUUsSUFBSSxTQUFTLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHO2dDQUN2RCxlQUFlLEVBQUUsU0FBUyxDQUFDLEtBQUssQ0FBQyxXQUFXLEVBQUU7NkJBQy9DLENBQUMsQ0FBQzt3QkFDTCxDQUFDO3dCQUVELE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7d0JBQ2xELG9CQUFvQixDQUFDLG9CQUFvQixFQUFFOzRCQUN6QyxXQUFXOzRCQUNYLFVBQVU7NEJBQ1YsUUFBUSxFQUFFLGVBQWU7NEJBQ3pCLFFBQVE7NEJBQ1IsZ0JBQWdCLEVBQUUsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJOzRCQUM3QyxVQUFVOzRCQUNWLFdBQVcsRUFBRTtnQ0FDWCxNQUFNLEVBQUUsSUFBSTtnQ0FDWixZQUFZLEVBQUUsY0FBSSxDQUFDLE9BQU8sQ0FBQyxlQUFlLENBQUM7NkJBQzVDO3lCQUNGLEVBQUUsTUFBTSxDQUFDLENBQUM7d0JBRVgsT0FBTyxHQUFHLENBQUMsUUFBUSxDQUFDLGNBQUksQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQztvQkFDbkQsQ0FBQztvQkFFRCxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDO29CQUNoRCxvQkFBb0IsQ0FBQyx3QkFBd0IsRUFBRTt3QkFDN0MsV0FBVzt3QkFDWCxVQUFVO3dCQUNWLGdCQUFnQixFQUFFLFFBQVEsQ0FBQyxRQUFRO3dCQUNuQyxpQkFBaUIsRUFBRSxlQUFlO3dCQUNsQyxnQkFBZ0IsRUFBRSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUk7d0JBQzdDLGFBQWEsRUFBRTs0QkFDYixjQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQzs0QkFDdEQsY0FBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQzs0QkFDM0MsZ0JBQWdCLFFBQVEsQ0FBQyxRQUFRLEVBQUU7eUJBQ3BDO3FCQUNGLEVBQUUsT0FBTyxDQUFDLENBQUM7b0JBRVosT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxDQUFDLENBQUM7Z0JBQ3ZFLENBQUM7Z0JBQUMsT0FBTyxTQUFjLEVBQUUsQ0FBQztvQkFDeEIsT0FBTyxDQUFDLEtBQUssQ0FBQywyQ0FBMkMsRUFBRSxTQUFTLENBQUMsQ0FBQztvQkFDdEUsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxzQkFBc0IsRUFBRSxDQUFDLENBQUM7Z0JBQ25FLENBQUM7WUFDSCxDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQywwREFBMEQsVUFBVSxFQUFFLENBQUMsQ0FBQztZQUNwRixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHVDQUF1QyxFQUFFLENBQUMsQ0FBQztRQUNwRixDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLG9EQUFvRCxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQzNFLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLCtCQUErQixFQUFFLENBQUMsQ0FBQztRQUNyRSxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFFTCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvc2VydmVyL2FwaS9kb2N1bWVudHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBFeHByZXNzIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyByZXF1aXJlQXV0aCwgcmVxdWlyZVJvbGUgfSBmcm9tICcuLi9hdXRoJztcbmltcG9ydCB7IHN0b3JhZ2UgfSBmcm9tICcuLi9zdG9yYWdlJztcbmltcG9ydCB7XG4gIGRvY3VtZW50cyxcbiAgaW5zZXJ0RG9jdW1lbnRTY2hlbWEsXG4gIHR5cGUgSW5zZXJ0RG9jdW1lbnQsXG4gIHR5cGUgRG9jdW1lbnQsXG59IGZyb20gJy4uLy4uL3NoYXJlZC9zY2hlbWEnO1xuXG4vLyBVc2UgdGhlIGdlbmVyYXRlZCBEb2N1bWVudCB0eXBlIGZyb20gc2NoZW1hIHRvIGF2b2lkIERPTSBEb2N1bWVudCBjb2xsaXNpb25cbnR5cGUgRG9jdW1lbnRSZWNvcmQgPSBEb2N1bWVudDtcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IG11bHRlciBmcm9tICdtdWx0ZXInO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IGNyeXB0byBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgdjQgYXMgdXVpZHY0IH0gZnJvbSAndXVpZCc7XG5pbXBvcnQgeyBzcWwgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uL2RiJztcblxuLy8gRW5oYW5jZWQgc2VjdXJpdHkgY29uZmlndXJhdGlvbiBmb3IgZmlsZSB1cGxvYWRzXG5jb25zdCBTRUNVUklUWV9DT05GSUcgPSB7XG4gIE1BWF9GSUxFX1NJWkU6IDI1ICogMTAyNCAqIDEwMjQsIC8vIFJlZHVjZWQgdG8gMjVNQiBmb3IgYmV0dGVyIHNlY3VyaXR5XG4gIE1BWF9GSUxFU19QRVJfVVNFUl9QRVJfSE9VUjogMTAsIC8vIFJhdGUgbGltaXRpbmdcbiAgQUxMT1dFRF9NSU1FX1RZUEVTOiBbXG4gICAgJ2FwcGxpY2F0aW9uL3BkZicsXG4gICAgJ2FwcGxpY2F0aW9uL21zd29yZCcsXG4gICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JyxcbiAgICAnYXBwbGljYXRpb24vdm5kLm1zLWV4Y2VsJyxcbiAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LnNwcmVhZHNoZWV0bWwuc2hlZXQnLFxuICAgICd0ZXh0L3BsYWluJyxcbiAgICAnaW1hZ2UvanBlZycsXG4gICAgJ2ltYWdlL3BuZycsXG4gICAgJ2ltYWdlL2dpZidcbiAgXSxcbiAgQUxMT1dFRF9FWFRFTlNJT05TOiBbJ3BkZicsICdkb2MnLCAnZG9jeCcsICd4bHMnLCAneGxzeCcsICd0eHQnLCAnanBnJywgJ2pwZWcnLCAncG5nJywgJ2dpZiddXG59O1xuXG4vLyBSYXRlIGxpbWl0aW5nIHN0b3JhZ2UgZm9yIHVwbG9hZHNcbmNvbnN0IHVwbG9hZFJhdGVUcmFja2VyID0gbmV3IE1hcCgpO1xuXG4vLyBFbmhhbmNlZCBmaWxlIHZhbGlkYXRpb24gZnVuY3Rpb25cbmZ1bmN0aW9uIHZhbGlkYXRlRmlsZShmaWxlOiBhbnkpOiB7IGlzVmFsaWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0ge1xuICBpZiAoIWZpbGUpIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogJ05vIGZpbGUgcHJvdmlkZWQnIH07XG4gIFxuICAvLyBDaGVjayBmaWxlIHNpemVcbiAgaWYgKGZpbGUuc2l6ZSA+IFNFQ1VSSVRZX0NPTkZJRy5NQVhfRklMRV9TSVpFKSB7XG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiBgRmlsZSBzaXplIGV4Y2VlZHMgJHtTRUNVUklUWV9DT05GSUcuTUFYX0ZJTEVfU0laRSAvICgxMDI0ICogMTAyNCl9TUIgbGltaXRgIH07XG4gIH1cbiAgXG4gIC8vIENoZWNrIE1JTUUgdHlwZVxuICBpZiAoIVNFQ1VSSVRZX0NPTkZJRy5BTExPV0VEX01JTUVfVFlQRVMuaW5jbHVkZXMoZmlsZS5taW1ldHlwZSkpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IGBGaWxlIHR5cGUgJHtmaWxlLm1pbWV0eXBlfSBub3QgYWxsb3dlZGAgfTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgZmlsZSBleHRlbnNpb25cbiAgY29uc3QgZXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKGZpbGUub3JpZ2luYWxuYW1lKS50b0xvd2VyQ2FzZSgpLnN1YnN0cmluZygxKTtcbiAgaWYgKCFTRUNVUklUWV9DT05GSUcuQUxMT1dFRF9FWFRFTlNJT05TLmluY2x1ZGVzKGV4dGVuc2lvbikpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IGBGaWxlIGV4dGVuc2lvbiAuJHtleHRlbnNpb259IG5vdCBhbGxvd2VkYCB9O1xuICB9XG4gIFxuICAvLyBDaGVjayBmaWxlbmFtZSBmb3IgcGF0aCB0cmF2ZXJzYWwgYXR0ZW1wdHNcbiAgaWYgKGZpbGUub3JpZ2luYWxuYW1lLmluY2x1ZGVzKCcuLicpIHx8IGZpbGUub3JpZ2luYWxuYW1lLmluY2x1ZGVzKCcvJykgfHwgZmlsZS5vcmlnaW5hbG5hbWUuaW5jbHVkZXMoJ1xcXFwnKSkge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogJ0ludmFsaWQgZmlsZW5hbWUgZGV0ZWN0ZWQnIH07XG4gIH1cbiAgXG4gIHJldHVybiB7IGlzVmFsaWQ6IHRydWUgfTtcbn1cblxuLy8gUmF0ZSBsaW1pdGluZyBmdW5jdGlvblxuZnVuY3Rpb24gY2hlY2tVcGxvYWRSYXRlTGltaXQodXNlcklkOiBzdHJpbmcpOiB7IGFsbG93ZWQ6IGJvb2xlYW47IGVycm9yPzogc3RyaW5nIH0ge1xuICBjb25zdCBub3cgPSBEYXRlLm5vdygpO1xuICBjb25zdCB1c2VyVXBsb2FkcyA9IHVwbG9hZFJhdGVUcmFja2VyLmdldCh1c2VySWQpIHx8IFtdO1xuICBcbiAgLy8gQ2xlYW4gb2xkIHVwbG9hZHMgKG9sZGVyIHRoYW4gMSBob3VyKVxuICBjb25zdCByZWNlbnRVcGxvYWRzID0gdXNlclVwbG9hZHMuZmlsdGVyKCh0aW1lc3RhbXA6IG51bWJlcikgPT4gbm93IC0gdGltZXN0YW1wIDwgNjAgKiA2MCAqIDEwMDApO1xuICBcbiAgaWYgKHJlY2VudFVwbG9hZHMubGVuZ3RoID49IFNFQ1VSSVRZX0NPTkZJRy5NQVhfRklMRVNfUEVSX1VTRVJfUEVSX0hPVVIpIHtcbiAgICByZXR1cm4geyBhbGxvd2VkOiBmYWxzZSwgZXJyb3I6ICdVcGxvYWQgcmF0ZSBsaW1pdCBleGNlZWRlZC4gUGxlYXNlIHRyeSBhZ2FpbiBsYXRlci4nIH07XG4gIH1cbiAgXG4gIC8vIFVwZGF0ZSB0cmFja2VyXG4gIHJlY2VudFVwbG9hZHMucHVzaChub3cpO1xuICB1cGxvYWRSYXRlVHJhY2tlci5zZXQodXNlcklkLCByZWNlbnRVcGxvYWRzKTtcbiAgXG4gIHJldHVybiB7IGFsbG93ZWQ6IHRydWUgfTtcbn1cblxuLy8gQ29uZmlndXJlIG11bHRlciBmb3IgZmlsZSB1cGxvYWRzIHdpdGggZW5oYW5jZWQgc2VjdXJpdHlcbmNvbnN0IHVwbG9hZCA9IG11bHRlcih7XG4gIGRlc3Q6ICcvdG1wL3VwbG9hZHMvJyxcbiAgbGltaXRzOiB7XG4gICAgZmlsZVNpemU6IFNFQ1VSSVRZX0NPTkZJRy5NQVhfRklMRV9TSVpFLFxuICAgIGZpbGVzOiAxLCAvLyBPbmx5IGFsbG93IG9uZSBmaWxlIGF0IGEgdGltZVxuICB9LFxuICBmaWxlRmlsdGVyOiAocmVxLCBmaWxlLCBjYikgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUZpbGUoZmlsZSk7XG4gICAgaWYgKHZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgY2IobnVsbCwgdHJ1ZSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNiKG5ldyBFcnJvcih2YWxpZGF0aW9uLmVycm9yKSk7XG4gICAgfVxuICB9LFxufSk7XG5cbi8vIERvY3VtZW50UmVjb3JkIGNhdGVnb3JpZXMgZm9yIHZhbGlkYXRpb24gLSBzeW5jaHJvbml6ZWQgd2l0aCBmcm9udGVuZFxuY29uc3QgRE9DVU1FTlRfQ0FURUdPUklFUyA9IFtcbiAgJ2J5bGF3JyxcbiAgJ2ZpbmFuY2lhbCcsXG4gICdtYWludGVuYW5jZScsXG4gICdsZWdhbCcsXG4gICdtZWV0aW5nX21pbnV0ZXMnLFxuICAnaW5zdXJhbmNlJyxcbiAgJ2NvbnRyYWN0cycsXG4gICdwZXJtaXRzJyxcbiAgJ2luc3BlY3Rpb24nLFxuICAnbGVhc2UnLFxuICAnY29ycmVzcG9uZGVuY2UnLFxuICAndXRpbGl0aWVzJyxcbiAgJ290aGVyJyxcbl0gYXMgY29uc3Q7XG5cbi8vIEVuaGFuY2VkIHNjaGVtYXMgZm9yIGRpZmZlcmVudCBkb2N1bWVudCB0eXBlc1xuY29uc3QgY3JlYXRlRG9jdW1lbnRTY2hlbWEgPSBpbnNlcnREb2N1bWVudFNjaGVtYS5leHRlbmQoe1xuICBjYXRlZ29yeTogei5lbnVtKERPQ1VNRU5UX0NBVEVHT1JJRVMpLFxuICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGlzVmlzaWJsZVRvVGVuYW50czogei5ib29sZWFuKCkuZGVmYXVsdChmYWxzZSksXG59KTtcblxuY29uc3QgY3JlYXRlQnVpbGRpbmdEb2N1bWVudFNjaGVtYSA9IGluc2VydERvY3VtZW50U2NoZW1hLmV4dGVuZCh7XG4gIHR5cGU6IHouZW51bShET0NVTUVOVF9DQVRFR09SSUVTKSxcbiAgdGl0bGU6IHouc3RyaW5nKCkubWluKDEpLm1heCgyNTUpLm9wdGlvbmFsKCksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG59KTtcblxuY29uc3QgY3JlYXRlUmVzaWRlbnREb2N1bWVudFNjaGVtYSA9IGluc2VydERvY3VtZW50U2NoZW1hLmV4dGVuZCh7XG4gIHR5cGU6IHouZW51bShET0NVTUVOVF9DQVRFR09SSUVTKSxcbiAgdGl0bGU6IHouc3RyaW5nKCkubWluKDEpLm1heCgyNTUpLm9wdGlvbmFsKCksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG59KTtcblxuLy8gU2NoZW1hIGZvciB1bmlmaWVkIGRvY3VtZW50IHVwbG9hZFxuY29uc3QgdXBsb2FkRG9jdW1lbnRSZWNvcmRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIG5hbWU6IHouc3RyaW5nKCkubWluKDEpLm1heCgyNTUpLFxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBkb2N1bWVudFR5cGU6IHouZW51bShET0NVTUVOVF9DQVRFR09SSUVTKSxcbiAgaXNWaXNpYmxlVG9UZW5hbnRzOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbiAgcmVzaWRlbmNlSWQ6IHouc3RyaW5nKCkudXVpZCgpLm9wdGlvbmFsKCksXG4gIGJ1aWxkaW5nSWQ6IHouc3RyaW5nKCkudXVpZCgpLm9wdGlvbmFsKCksXG4gIGF0dGFjaGVkVG9UeXBlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGF0dGFjaGVkVG9JZDogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBhcHBcbiAqL1xuLyoqXG4gKiBSZWdpc3RlckRvY3VtZW50UmVjb3JkUm91dGVzIGZ1bmN0aW9uLlxuICogQHBhcmFtIGFwcFxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEb2N1bWVudFJvdXRlcyhhcHA6IEV4cHJlc3MpOiB2b2lkIHtcbiAgY29uc29sZS5sb2coYFske25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1dIPCflKcgUmVnaXN0ZXJpbmcgZG9jdW1lbnQgcm91dGVzLi4uYCk7XG4gIFxuICAvLyBTZWN1cml0eSBhdWRpdCBsb2dnaW5nXG4gIGNvbnN0IGF1ZGl0TG9nOiBBcnJheTx7XG4gICAgdGltZXN0YW1wOiBzdHJpbmc7XG4gICAgYWN0aW9uOiBzdHJpbmc7XG4gICAgdXNlcklkOiBzdHJpbmc7XG4gICAgdXNlclJvbGU6IHN0cmluZztcbiAgICBkb2N1bWVudElkPzogc3RyaW5nO1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgZGV0YWlscz86IGFueTtcbiAgfT4gPSBbXTtcbiAgXG4gIC8vIEVycm9yIHRyYWNraW5nIGZvciBwcm9kdWN0aW9uIGRlYnVnZ2luZ1xuICBjb25zdCBlcnJvckxvZzogQXJyYXk8e3RpbWVzdGFtcDogc3RyaW5nLCBlcnJvcjogYW55LCBlbmRwb2ludDogc3RyaW5nLCB1c2VyPzogYW55fT4gPSBbXTtcbiAgXG4gIC8vIEVuaGFuY2VkIHNlY3VyaXR5IGF1ZGl0IGxvZ2dpbmcgZnVuY3Rpb24gd2l0aCBkZWJ1ZyBsZXZlbHNcbiAgY29uc3QgbG9nU2VjdXJpdHlFdmVudCA9IChhY3Rpb246IHN0cmluZywgdXNlcjogYW55LCBzdWNjZXNzOiBib29sZWFuLCBkb2N1bWVudElkPzogc3RyaW5nLCBkZXRhaWxzPzogYW55KSA9PiB7XG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGFjdGlvbixcbiAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgIHVzZXJSb2xlOiB1c2VyLnJvbGUsXG4gICAgICBkb2N1bWVudElkLFxuICAgICAgc3VjY2VzcyxcbiAgICAgIGRldGFpbHNcbiAgICB9O1xuICAgIFxuICAgIGF1ZGl0TG9nLnB1c2goZXZlbnQpO1xuICAgIGlmIChhdWRpdExvZy5sZW5ndGggPiAxMDAwKSBhdWRpdExvZy5zaGlmdCgpOyAvLyBLZWVwIGxhc3QgMTAwMCBldmVudHNcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgW1NFQ1VSSVRZIEFVRElUXSAke2FjdGlvbn06YCwgZXZlbnQpO1xuICAgIHJldHVybiBldmVudDtcbiAgfTtcblxuICAvLyBFbmhhbmNlZCBkZWJ1ZyBsb2dnaW5nIGZ1bmN0aW9uIGZvciBkb2N1bWVudCBvcGVyYXRpb25zXG4gIGNvbnN0IGxvZ0RvY3VtZW50T3BlcmF0aW9uID0gKG9wZXJhdGlvbjogc3RyaW5nLCBkYXRhOiBhbnksIGxldmVsOiAnSU5GTycgfCAnRVJST1InIHwgJ0RFQlVHJyB8ICdXQVJOJyA9ICdJTkZPJykgPT4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBsb2dFbnRyeSA9IHtcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIG9wZXJhdGlvbixcbiAgICAgIGxldmVsLFxuICAgICAgZGF0YTogdHlwZW9mIGRhdGEgPT09ICdvYmplY3QnID8gSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMikgOiBkYXRhXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBlbW9qaSA9IHtcbiAgICAgIElORk86ICfwn5OLJyxcbiAgICAgIEVSUk9SOiAn4p2MJywgXG4gICAgICBERUJVRzogJ/CflI0nLFxuICAgICAgV0FSTjogJ+KaoO+4jydcbiAgICB9W2xldmVsXTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0gJHtlbW9qaX0gW0RPQ1VNRU5UICR7b3BlcmF0aW9uLnRvVXBwZXJDYXNlKCl9XSAke2xldmVsfTpgLCBkYXRhKTtcbiAgICByZXR1cm4gbG9nRW50cnk7XG4gIH07XG5cbiAgLy8gRGF0YWJhc2UgY29ubmVjdGlvbiB0ZXN0aW5nIGZ1bmN0aW9uc1xuICBjb25zdCB0ZXN0RGF0YWJhc2VDb25uZWN0aW9uID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBTRUxFQ1QgMSBhcyB0ZXN0YCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICByZXN1bHQ6IHJlc3VsdC5yb3dzWzBdLFxuICAgICAgICB1cmxfdHJ1bmNhdGVkOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw/LnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJ1xuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHVybF90cnVuY2F0ZWQ6IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTD8uc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nXG4gICAgICB9O1xuICAgIH1cbiAgfTtcblxuICBjb25zdCB0ZXN0U2FtcGxlUXVlcnkgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFRlc3QgdGhlIGV4YWN0IHF1ZXJ5IHRoYXQncyBmYWlsaW5nXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIENPVU5UKCopIGFzIGRvY3VtZW50X2NvdW50IFxuICAgICAgICBGUk9NIGRvY3VtZW50cyBcbiAgICAgICAgTElNSVQgMVxuICAgICAgYCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkb2N1bWVudF9jb3VudDogcmVzdWx0LnJvd3NbMF0/LmRvY3VtZW50X2NvdW50IHx8IDBcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBzdGFjazogZXJyb3Iuc3RhY2s/LnN1YnN0cmluZygwLCAyMDApICsgJy4uLidcbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNoZWNrRW51bVZhbHVlcyA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgY3VycmVudCBlbnVtIHZhbHVlcyBpbiBwcm9kdWN0aW9uXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIGVudW1sYWJlbCBcbiAgICAgICAgRlJPTSBwZ19lbnVtIFxuICAgICAgICBXSEVSRSBlbnVtdHlwaWQgPSAoXG4gICAgICAgICAgU0VMRUNUIG9pZCBcbiAgICAgICAgICBGUk9NIHBnX3R5cGUgXG4gICAgICAgICAgV0hFUkUgdHlwbmFtZSA9ICd1c2VyX3JvbGUnXG4gICAgICAgIClcbiAgICAgICAgT1JERVIgQlkgZW51bXNvcnRvcmRlclxuICAgICAgYCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBwcm9kdWN0aW9uX2VudW1fdmFsdWVzOiByZXN1bHQucm93cy5tYXAocm93ID0+IHJvdy5lbnVtbGFiZWwpXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgY2hlY2tVc2VyT3JnYW5pemF0aW9uTGlua3MgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHNcbiAgICAgIGNvbnN0IHVzZXJDb3VudCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFNFTEVDVCBDT1VOVCgqKSBhcyB0b3RhbCBGUk9NIHVzZXJzIFdIRVJFIGlzX2FjdGl2ZSA9IHRydWVgKTtcbiAgICAgIGNvbnN0IG9yZ0NvdW50ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgU0VMRUNUIENPVU5UKCopIGFzIHRvdGFsIEZST00gb3JnYW5pemF0aW9ucyBXSEVSRSBpc19hY3RpdmUgPSB0cnVlYCk7XG4gICAgICBjb25zdCBsaW5rQ291bnQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBTRUxFQ1QgQ09VTlQoKikgYXMgdG90YWwgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZWApO1xuICAgICAgXG4gICAgICAvLyBDaGVjayB1c2VycyB3aXRob3V0IG9yZ2FuaXphdGlvbiBsaW5rc1xuICAgICAgY29uc3Qgb3JwaGFuVXNlcnMgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIHUuaWQsIHUuZW1haWwsIHUucm9sZSBcbiAgICAgICAgRlJPTSB1c2VycyB1IFxuICAgICAgICBMRUZUIEpPSU4gdXNlcl9vcmdhbml6YXRpb25zIHVvIE9OIHUuaWQgPSB1by51c2VyX2lkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZSBBTkQgdW8udXNlcl9pZCBJUyBOVUxMXG4gICAgICAgIExJTUlUIDEwXG4gICAgICBgKTtcblxuICAgICAgLy8gQ2hlY2sgY3VycmVudCB0ZXN0IHVzZXIgc3BlY2lmaWNhbGx5IChmcm9tIGVycm9yIGxvZ3MpXG4gICAgICBjb25zdCB0ZXN0VXNlciA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgdS5lbWFpbCwgdS5yb2xlLCB1by5vcmdhbml6YXRpb25faWQsIG8ubmFtZSBhcyBvcmdfbmFtZVxuICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgTEVGVCBKT0lOIHVzZXJfb3JnYW5pemF0aW9ucyB1byBPTiB1LmlkID0gdW8udXNlcl9pZCBBTkQgdW8uaXNfYWN0aXZlID0gdHJ1ZSAgXG4gICAgICAgIExFRlQgSk9JTiBvcmdhbml6YXRpb25zIG8gT04gdW8ub3JnYW5pemF0aW9uX2lkID0gby5pZFxuICAgICAgICBXSEVSRSB1LmlkID0gJzIyMmY1YTBkLTZiYzYtNGYyOC05ZjRkLTMyYzEzM2VlZDMzMydcbiAgICAgIGApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBzdGF0czoge1xuICAgICAgICAgIHRvdGFsX3VzZXJzOiB1c2VyQ291bnQucm93c1swXT8udG90YWwgfHwgMCxcbiAgICAgICAgICB0b3RhbF9vcmdhbml6YXRpb25zOiBvcmdDb3VudC5yb3dzWzBdPy50b3RhbCB8fCAwLFxuICAgICAgICAgIHRvdGFsX2xpbmtzOiBsaW5rQ291bnQucm93c1swXT8udG90YWwgfHwgMCxcbiAgICAgICAgICBvcnBoYW5fdXNlcl9jb3VudDogb3JwaGFuVXNlcnMucm93cy5sZW5ndGhcbiAgICAgICAgfSxcbiAgICAgICAgb3JwaGFuX3VzZXJzOiBvcnBoYW5Vc2Vycy5yb3dzLFxuICAgICAgICB0ZXN0X3VzZXJfc3RhdHVzOiB0ZXN0VXNlci5yb3dzWzBdIHx8IG51bGxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlXG4gICAgICB9O1xuICAgIH1cbiAgfTtcbiAgXG4gIC8vIEVudW0gY2xlYW51cCBlbmRwb2ludCBmb3Igc2FmZSBzY2hlbWEgbWlncmF0aW9uICBcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL2NsZWFudXAtZW51bScsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCwgdmVyaWZ5IG5vIHVzZXJzIGhhdmUgdGhlICdvd25lcicgcm9sZVxuICAgICAgY29uc3QgdXNlckNoZWNrID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyBvd25lcl9jb3VudCBcbiAgICAgICAgRlJPTSB1c2VycyBcbiAgICAgICAgV0hFUkUgcm9sZSA9ICdvd25lcidcbiAgICAgIGApO1xuICAgICAgXG4gICAgICBjb25zdCBvd25lckNvdW50ID0gTnVtYmVyKHVzZXJDaGVjay5yb3dzWzBdPy5vd25lcl9jb3VudCkgfHwgMDtcbiAgICAgIFxuICAgICAgaWYgKG93bmVyQ291bnQgPiAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgZXJyb3I6ICdDYW5ub3QgcmVtb3ZlIG93bmVyIHJvbGUgLSB1c2VycyBzdGlsbCBhc3NpZ25lZCB0byBpdCcsXG4gICAgICAgICAgb3duZXJfY291bnQ6IG93bmVyQ291bnRcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNhZmUgdG8gcmVtb3ZlIC0gbm8gdXNlcnMgaGF2ZSAnb3duZXInIHJvbGVcbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUWVBFIHVzZXJfcm9sZSBEUk9QIFZBTFVFIElGIEVYSVNUUyAnb3duZXInXG4gICAgICBgKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgdW51c2VkIG93bmVyIHJvbGUnLFxuICAgICAgICBzYWZlX3RvX3B1c2hfc2NoZW1hOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGR1cmluZyBlbnVtIGNsZWFudXA6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0VudW0gY2xlYW51cCBmYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBzdWdnZXN0aW9uOiAnVHJ5IHJ1bm5pbmcgbnBtIHJ1biBkYjpwdXNoIC0tZm9yY2UgaW5zdGVhZCdcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gRml4IHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHNcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL2ZpeC11c2VyLWxpbmtzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogRmluZCB1c2VycyB3aXRob3V0IG9yZ2FuaXphdGlvbiBsaW5rc1xuICAgICAgY29uc3Qgb3JwaGFuVXNlcnMgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIHUuaWQsIHUuZW1haWwsIHUucm9sZSBcbiAgICAgICAgRlJPTSB1c2VycyB1IFxuICAgICAgICBMRUZUIEpPSU4gdXNlcl9vcmdhbml6YXRpb25zIHVvIE9OIHUuaWQgPSB1by51c2VyX2lkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZSBBTkQgdW8udXNlcl9pZCBJUyBOVUxMXG4gICAgICBgKTtcblxuICAgICAgaWYgKG9ycGhhblVzZXJzLnJvd3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FsbCB1c2VycyBhbHJlYWR5IGhhdmUgb3JnYW5pemF0aW9uIGxpbmtzJyxcbiAgICAgICAgICBhY3Rpb25fdGFrZW46ICdub25lJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAyOiBHZXQgdGhlIGZpcnN0IGF2YWlsYWJsZSBvcmdhbml6YXRpb24gKG9yIGNyZWF0ZSBkZWZhdWx0IG9uZSlcbiAgICAgIGxldCBkZWZhdWx0T3JnID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBpZCwgbmFtZSBGUk9NIG9yZ2FuaXphdGlvbnMgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZSBMSU1JVCAxXG4gICAgICBgKTtcblxuICAgICAgbGV0IG9yZ2FuaXphdGlvbklkOiBzdHJpbmc7XG4gICAgICBsZXQgb3JnYW5pemF0aW9uTmFtZTogc3RyaW5nO1xuXG4gICAgICBpZiAoZGVmYXVsdE9yZy5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAvLyBDcmVhdGUgYSBkZWZhdWx0IG9yZ2FuaXphdGlvbiBpZiBub25lIGV4aXN0c1xuICAgICAgICBvcmdhbml6YXRpb25JZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG4gICAgICAgIG9yZ2FuaXphdGlvbk5hbWUgPSAnRGVmYXVsdCBPcmdhbml6YXRpb24nO1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBJTlNFUlQgSU5UTyBvcmdhbml6YXRpb25zIChpZCwgbmFtZSwgdHlwZSwgYWRkcmVzcywgcGhvbmUsIGVtYWlsLCBpc19hY3RpdmUsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQpXG4gICAgICAgICAgVkFMVUVTICgke29yZ2FuaXphdGlvbklkfSwgJHtvcmdhbml6YXRpb25OYW1lfSwgJ2NvbmRvbWluaXVtJywgJzEyMyBNYWluIFN0JywgJzUxNC01NTUtMDEwMCcsICdhZG1pbkBrb3Zlby5jYScsIHRydWUsIE5PVygpLCBOT1coKSlcbiAgICAgICAgYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvcmdhbml6YXRpb25JZCA9IGRlZmF1bHRPcmcucm93c1swXS5pZCBhcyBzdHJpbmc7XG4gICAgICAgIG9yZ2FuaXphdGlvbk5hbWUgPSBkZWZhdWx0T3JnLnJvd3NbMF0ubmFtZSBhcyBzdHJpbmc7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMzogTGluayBhbGwgb3JwaGFuIHVzZXJzIHRvIHRoZSBkZWZhdWx0IG9yZ2FuaXphdGlvblxuICAgICAgY29uc3QgbGlua1Byb21pc2VzID0gb3JwaGFuVXNlcnMucm93cy5tYXAodXNlciA9PiB7XG4gICAgICAgIGNvbnN0IGxpbmtJZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG4gICAgICAgIHJldHVybiBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBJTlNFUlQgSU5UTyB1c2VyX29yZ2FuaXphdGlvbnMgKGlkLCB1c2VyX2lkLCBvcmdhbml6YXRpb25faWQsIHJvbGUsIGlzX2FjdGl2ZSwgY3JlYXRlZF9hdCwgdXBkYXRlZF9hdClcbiAgICAgICAgICBWQUxVRVMgKCR7bGlua0lkfSwgJHt1c2VyLmlkfSwgJHtvcmdhbml6YXRpb25JZH0sICR7dXNlci5yb2xlfSwgdHJ1ZSwgTk9XKCksIE5PVygpKVxuICAgICAgICBgKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChsaW5rUHJvbWlzZXMpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgbGlua2VkIHVzZXJzIHRvIG9yZ2FuaXphdGlvbnMnLFxuICAgICAgICB1c2Vyc19saW5rZWQ6IG9ycGhhblVzZXJzLnJvd3MubGVuZ3RoLFxuICAgICAgICBvcmdhbml6YXRpb25faWQ6IG9yZ2FuaXphdGlvbklkLFxuICAgICAgICBvcmdhbml6YXRpb25fbmFtZTogb3JnYW5pemF0aW9uTmFtZSxcbiAgICAgICAgbGlua2VkX3VzZXJzOiBvcnBoYW5Vc2Vycy5yb3dzLm1hcCh1ID0+ICh7IGlkOiB1LmlkLCBlbWFpbDogdS5lbWFpbCwgcm9sZTogdS5yb2xlIH0pKSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmaXhpbmcgdXNlci1vcmdhbml6YXRpb24gbGlua3M6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmaXggdXNlci1vcmdhbml6YXRpb24gbGlua3MnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBTYWZlIGVudW0gbWlncmF0aW9uIGVuZHBvaW50XG4gIGFwcC5wb3N0KCcvYXBpL2RvY3VtZW50cy9maXgtZW51bS1taWdyYXRpb24nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU3RlcCAxOiBDaGVjayBjdXJyZW50IGVudW0gdmFsdWVzIGFuZCB1c2FnZVxuICAgICAgY29uc3QgZW51bUNoZWNrID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBlbnVtbGFiZWwsIGVudW1zb3J0b3JkZXIgXG4gICAgICAgIEZST00gcGdfZW51bSBcbiAgICAgICAgV0hFUkUgZW51bXR5cGlkID0gKFNFTEVDVCBvaWQgRlJPTSBwZ190eXBlIFdIRVJFIHR5cG5hbWUgPSAndXNlcl9yb2xlJylcbiAgICAgICAgT1JERVIgQlkgZW51bXNvcnRvcmRlclxuICAgICAgYCk7XG5cbiAgICAgIGNvbnN0IGN1cnJlbnRFbnVtVmFsdWVzID0gZW51bUNoZWNrLnJvd3MubWFwKHJvdyA9PiByb3cuZW51bWxhYmVsKTtcbiAgICAgIFxuICAgICAgLy8gU3RlcCAyOiBDaGVjayBpZiB3ZSBoYXZlIGFueSBkYXRhIHRoYXQgd291bGQgcHJldmVudCBtaWdyYXRpb25cbiAgICAgIGNvbnN0IHVzZXJSb2xlVXNhZ2UgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIHJvbGUsIENPVU5UKCopIGFzIGNvdW50IFxuICAgICAgICBGUk9NIHVzZXJzIFxuICAgICAgICBHUk9VUCBCWSByb2xlXG4gICAgICBgKTtcblxuICAgICAgLy8gU3RlcCAzOiBTaW5jZSBlbnVtIHJlb3JkZXJpbmcgaXMgdGhlIGlzc3VlLCBsZXQncyB1c2UgYSBkaWZmZXJlbnQgYXBwcm9hY2hcbiAgICAgIC8vIFdlJ2xsIGNyZWF0ZSBhIG5ldyBlbnVtIHdpdGggY29ycmVjdCBvcmRlciwgbWlncmF0ZSBkYXRhLCB0aGVuIHN3YXBcbiAgICAgIGNvbnN0IHRhcmdldEVudW1WYWx1ZXMgPSBbJ2FkbWluJywgJ21hbmFnZXInLCAndGVuYW50JywgJ3Jlc2lkZW50JywgJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J107XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgb3JkZXIgbWF0Y2hlcyB0YXJnZXRcbiAgICAgIGNvbnN0IG9yZGVyTWF0Y2hlcyA9IEpTT04uc3RyaW5naWZ5KGN1cnJlbnRFbnVtVmFsdWVzKSA9PT0gSlNPTi5zdHJpbmdpZnkodGFyZ2V0RW51bVZhbHVlcyk7XG4gICAgICBcbiAgICAgIGlmIChvcmRlck1hdGNoZXMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRW51bSB2YWx1ZXMgYWxyZWFkeSBpbiBjb3JyZWN0IG9yZGVyJyxcbiAgICAgICAgICBjdXJyZW50X3ZhbHVlczogY3VycmVudEVudW1WYWx1ZXMsXG4gICAgICAgICAgdGFyZ2V0X3ZhbHVlczogdGFyZ2V0RW51bVZhbHVlcyxcbiAgICAgICAgICBtaWdyYXRpb25fbmVlZGVkOiBmYWxzZVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBDcmVhdGUgbmV3IGVudW0gd2l0aCBjb3JyZWN0IG9yZGVyXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBDUkVBVEUgVFlQRSB1c2VyX3JvbGVfbmV3IEFTIEVOVU0gKCdhZG1pbicsICdtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCcsICdkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCcpYCk7XG5cbiAgICAgIC8vIFN0ZXAgNTogVXBkYXRlIGFsbCB0YWJsZXMgdG8gdXNlIG5ldyBlbnVtXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgQUxURVIgVEFCTEUgdXNlcnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlX25ldyBcbiAgICAgICAgVVNJTkcgcm9sZTo6dGV4dDo6dXNlcl9yb2xlX25ld1xuICAgICAgYCk7XG5cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiBvcmdhbml6YXRpb25fcm9sZSBUWVBFIHVzZXJfcm9sZV9uZXcgXG4gICAgICAgIFVTSU5HIG9yZ2FuaXphdGlvbl9yb2xlOjp0ZXh0Ojp1c2VyX3JvbGVfbmV3XG4gICAgICBgKTtcblxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIEFMVEVSIFRBQkxFIHJvbGVfcGVybWlzc2lvbnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlX25ldyBcbiAgICAgICAgVVNJTkcgcm9sZTo6dGV4dDo6dXNlcl9yb2xlX25ld1xuICAgICAgYCk7XG5cbiAgICAgIC8vIFN0ZXAgNjogRHJvcCBvbGQgZW51bSBhbmQgcmVuYW1lIG5ldyBvbmVcbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYERST1AgVFlQRSB1c2VyX3JvbGVgKTtcbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRZUEUgdXNlcl9yb2xlX25ldyBSRU5BTUUgVE8gdXNlcl9yb2xlYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBtaWdyYXRlZCB1c2VyX3JvbGUgZW51bScsXG4gICAgICAgIG9sZF92YWx1ZXM6IGN1cnJlbnRFbnVtVmFsdWVzLFxuICAgICAgICBuZXdfdmFsdWVzOiB0YXJnZXRFbnVtVmFsdWVzLFxuICAgICAgICB1c2VyX3JvbGVfdXNhZ2U6IHVzZXJSb2xlVXNhZ2Uucm93cyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkdXJpbmcgZW51bSBtaWdyYXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0VudW0gbWlncmF0aW9uIGZhaWxlZCcsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN1Z2dlc3Rpb246ICdUaGlzIGlzIGEgY29tcGxleCBtaWdyYXRpb24gLSBtYXkgbmVlZCBtYW51YWwgaW50ZXJ2ZW50aW9uJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gRml4IGludml0YXRpb25zIHRhYmxlIGVudW0gZGVwZW5kZW5jeVxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvZml4LWludml0YXRpb25zLWRlcGVuZGVuY3knLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU3RlcCAxOiBDaGVjayBjdXJyZW50IGludml0YXRpb25zIHRhYmxlIHN0cnVjdHVyZVxuICAgICAgY29uc3QgaW52aXRhdGlvbnNTY2hlbWEgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIGNvbHVtbl9uYW1lLCBkYXRhX3R5cGUsIGNvbHVtbl9kZWZhdWx0XG4gICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgXG4gICAgICAgIFdIRVJFIHRhYmxlX25hbWUgPSAnaW52aXRhdGlvbnMnIEFORCBjb2x1bW5fbmFtZSA9ICdyb2xlJ1xuICAgICAgYCk7XG5cbiAgICAgIC8vIFN0ZXAgMjogUmVtb3ZlIGRlZmF1bHQgdmFsdWUgZnJvbSBpbnZpdGF0aW9ucy5yb2xlIGNvbHVtbiB0ZW1wb3JhcmlseVxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIEFMVEVSIFRBQkxFIGludml0YXRpb25zIFxuICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBEUk9QIERFRkFVTFRcbiAgICAgIGApO1xuXG4gICAgICAvLyBTdGVwIDM6IENoZWNrIHdoYXQgb3RoZXIgdGFibGVzIG1pZ2h0IGhhdmUgZW51bSBkZXBlbmRlbmNpZXNcbiAgICAgIGNvbnN0IGVudW1EZXBlbmRlbmNpZXMgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgIHQudGFibGVfbmFtZSxcbiAgICAgICAgICBjLmNvbHVtbl9uYW1lLFxuICAgICAgICAgIGMuY29sdW1uX2RlZmF1bHRcbiAgICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEudGFibGVzIHRcbiAgICAgICAgSk9JTiBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1ucyBjIE9OIHQudGFibGVfbmFtZSA9IGMudGFibGVfbmFtZVxuICAgICAgICBXSEVSRSBjLmRhdGFfdHlwZSA9ICdVU0VSLURFRklORUQnIFxuICAgICAgICBBTkQgYy51ZHRfbmFtZSA9ICd1c2VyX3JvbGUnXG4gICAgICAgIEFORCBjLmNvbHVtbl9kZWZhdWx0IElTIE5PVCBOVUxMXG4gICAgICBgKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IHJlbW92ZWQgaW52aXRhdGlvbnMgdGFibGUgZW51bSBkZXBlbmRlbmN5JyxcbiAgICAgICAgcmVtb3ZlZF9kZWZhdWx0czogaW52aXRhdGlvbnNTY2hlbWEucm93cyxcbiAgICAgICAgcmVtYWluaW5nX2RlcGVuZGVuY2llczogZW51bURlcGVuZGVuY2llcy5yb3dzLFxuICAgICAgICBuZXh0X3N0ZXA6ICdSdW4gbnBtIHJ1biBkYjpwdXNoIG5vdywgdGhlbiBjYWxsIC9hcGkvZG9jdW1lbnRzL3Jlc3RvcmUtaW52aXRhdGlvbnMtZGVmYXVsdCcsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZml4aW5nIGludml0YXRpb25zIGRlcGVuZGVuY3k6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byBmaXggaW52aXRhdGlvbnMgZGVwZW5kZW5jeScsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFJlc3RvcmUgaW52aXRhdGlvbnMgZGVmYXVsdCB2YWx1ZSBhZnRlciBzY2hlbWEgc3luY1xuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvcmVzdG9yZS1pbnZpdGF0aW9ucy1kZWZhdWx0JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJlc3RvcmUgZGVmYXVsdCB2YWx1ZSB0byAndGVuYW50JyBmb3IgaW52aXRhdGlvbnMucm9sZSBjb2x1bW5cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBcbiAgICAgICAgQUxURVIgQ09MVU1OIHJvbGUgU0VUIERFRkFVTFQgJ3RlbmFudCdcbiAgICAgIGApO1xuXG4gICAgICAvLyBWZXJpZnkgdGhlIGNoYW5nZVxuICAgICAgY29uc3QgdmVyaWZpY2F0aW9uID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBjb2x1bW5fbmFtZSwgY29sdW1uX2RlZmF1bHRcbiAgICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1ucyBcbiAgICAgICAgV0hFUkUgdGFibGVfbmFtZSA9ICdpbnZpdGF0aW9ucycgQU5EIGNvbHVtbl9uYW1lID0gJ3JvbGUnXG4gICAgICBgKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkIGludml0YXRpb25zIHJvbGUgZGVmYXVsdCB0byB0ZW5hbnQnLFxuICAgICAgICBjdXJyZW50X2RlZmF1bHQ6IHZlcmlmaWNhdGlvbi5yb3dzWzBdPy5jb2x1bW5fZGVmYXVsdCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciByZXN0b3JpbmcgaW52aXRhdGlvbnMgZGVmYXVsdDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHJlc3RvcmUgaW52aXRhdGlvbnMgZGVmYXVsdCcsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIE1pZ3JhdGUgb3duZXIgdXNlcnMgdG8gYWRtaW4gYmVmb3JlIGVudW0gY2xlYW51cFxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvbWlncmF0ZS1vd25lci10by1hZG1pbicsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBTdGVwIDE6IENoZWNrIGhvdyBtYW55IHVzZXJzIGhhdmUgJ293bmVyJyByb2xlXG4gICAgICBjb25zdCBvd25lclVzZXJzQ2hlY2sgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIGlkLCBlbWFpbCwgZmlyc3RfbmFtZSwgbGFzdF9uYW1lIFxuICAgICAgICBGUk9NIHVzZXJzIFxuICAgICAgICBXSEVSRSByb2xlID0gJ293bmVyJ1xuICAgICAgYCk7XG5cbiAgICAgIGNvbnN0IG93bmVyQ291bnQgPSBvd25lclVzZXJzQ2hlY2sucm93cy5sZW5ndGg7XG5cbiAgICAgIGlmIChvd25lckNvdW50ID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ05vIG93bmVyIHVzZXJzIGZvdW5kIC0gbWlncmF0aW9uIG5vdCBuZWVkZWQnLFxuICAgICAgICAgIG93bmVyX2NvdW50OiAwLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDI6IFVwZGF0ZSBhbGwgb3duZXIgdXNlcnMgdG8gYWRtaW5cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBVUERBVEUgdXNlcnMgXG4gICAgICAgIFNFVCByb2xlID0gJ2FkbWluJyBcbiAgICAgICAgV0hFUkUgcm9sZSA9ICdvd25lcidcbiAgICAgIGApO1xuXG4gICAgICAvLyBTdGVwIDM6IFVwZGF0ZSB1c2VyX29yZ2FuaXphdGlvbnMgdGFibGUgaWYgaXQgZXhpc3RzXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBVUERBVEUgdXNlcl9vcmdhbml6YXRpb25zIFxuICAgICAgICAgIFNFVCBvcmdhbml6YXRpb25fcm9sZSA9ICdhZG1pbicgXG4gICAgICAgICAgV0hFUkUgb3JnYW5pemF0aW9uX3JvbGUgPSAnb3duZXInXG4gICAgICAgIGApO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBUYWJsZSBtaWdodCBub3QgZXhpc3QsIHRoYXQncyBPS1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDQ6IFJlbW92ZSAnb3duZXInIGZyb20gZW51bVxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIEFMVEVSIFRZUEUgdXNlcl9yb2xlIFJFTkFNRSBUTyB1c2VyX3JvbGVfb2xkXG4gICAgICBgKTtcblxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIENSRUFURSBUWVBFIHVzZXJfcm9sZSBBUyBFTlVNICgnYWRtaW4nLCAnbWFuYWdlcicsICd0ZW5hbnQnLCAncmVzaWRlbnQnLCAnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnKVxuICAgICAgYCk7XG5cbiAgICAgIC8vIFN0ZXAgNTogVXBkYXRlIGFsbCB0YWJsZXMgdG8gdXNlIG5ldyBlbnVtXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgQUxURVIgVEFCTEUgdXNlcnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlIFxuICAgICAgICBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVcbiAgICAgIGApO1xuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIG9yZ2FuaXphdGlvbl9yb2xlIFRZUEUgdXNlcl9yb2xlIFxuICAgICAgICAgIFVTSU5HIG9yZ2FuaXphdGlvbl9yb2xlOjp0ZXh0Ojp1c2VyX3JvbGVcbiAgICAgICAgYCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIFRhYmxlIG1pZ2h0IG5vdCBleGlzdFxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSByb2xlX3Blcm1pc3Npb25zIFxuICAgICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlIFxuICAgICAgICAgIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZVxuICAgICAgICBgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gVGFibGUgbWlnaHQgbm90IGV4aXN0XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIEFMVEVSIFRBQkxFIGludml0YXRpb25zIFxuICAgICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlIFxuICAgICAgICAgIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZVxuICAgICAgICBgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gQ29sdW1uIG1pZ2h0IG5vdCBleGlzdFxuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDY6IERyb3Agb2xkIGVudW1cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYERST1AgVFlQRSB1c2VyX3JvbGVfb2xkYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSBtaWdyYXRlZCBvd25lciB1c2VycyB0byBhZG1pbicsXG4gICAgICAgIG1pZ3JhdGVkX3VzZXJzOiBvd25lclVzZXJzQ2hlY2sucm93cyxcbiAgICAgICAgb3duZXJfY291bnQ6IG93bmVyQ291bnQsXG4gICAgICAgIG5ld19lbnVtX3ZhbHVlczogWydhZG1pbicsICdtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCcsICdkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIG1pZ3JhdGluZyBvd25lciB1c2VycyB0byBhZG1pbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnT3duZXIgdG8gYWRtaW4gbWlncmF0aW9uIGZhaWxlZCcsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFJlbW92ZSBhbGwgcmVtYWluaW5nIGVudW0gZGVwZW5kZW5jaWVzXG4gIGFwcC5wb3N0KCcvYXBpL2RvY3VtZW50cy9yZW1vdmUtYWxsLWVudW0tZGVwZW5kZW5jaWVzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcblxuICAgICAgLy8gUmVtb3ZlIGRlZmF1bHQgZnJvbSB1c2Vycy5yb2xlXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSB1c2VycyBcbiAgICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBEUk9QIERFRkFVTFRcbiAgICAgICAgYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgndXNlcnMucm9sZSBkZWZhdWx0IHJlbW92ZWQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2Vycy5yb2xlOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIGRlZmF1bHQgZnJvbSB1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGVcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIEFMVEVSIFRBQkxFIHVzZXJfb3JnYW5pemF0aW9ucyBcbiAgICAgICAgICBBTFRFUiBDT0xVTU4gb3JnYW5pemF0aW9uX3JvbGUgRFJPUCBERUZBVUxUXG4gICAgICAgIGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ3VzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0IHJlbW92ZWQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayByZW1haW5pbmcgZGVwZW5kZW5jaWVzXG4gICAgICBjb25zdCByZW1haW5pbmdEZXBzID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICB0LnRhYmxlX25hbWUsXG4gICAgICAgICAgYy5jb2x1bW5fbmFtZSxcbiAgICAgICAgICBjLmNvbHVtbl9kZWZhdWx0XG4gICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyB0XG4gICAgICAgIEpPSU4gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgYyBPTiB0LnRhYmxlX25hbWUgPSBjLnRhYmxlX25hbWVcbiAgICAgICAgV0hFUkUgYy5kYXRhX3R5cGUgPSAnVVNFUi1ERUZJTkVEJyBcbiAgICAgICAgQU5EIGMudWR0X25hbWUgPSAndXNlcl9yb2xlJ1xuICAgICAgICBBTkQgYy5jb2x1bW5fZGVmYXVsdCBJUyBOT1QgTlVMTFxuICAgICAgYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1JlbW92ZWQgYWxsIGVudW0gZGVwZW5kZW5jaWVzJyxcbiAgICAgICAgb3BlcmF0aW9uczogcmVzdWx0cyxcbiAgICAgICAgcmVtYWluaW5nX2RlcGVuZGVuY2llczogcmVtYWluaW5nRGVwcy5yb3dzLFxuICAgICAgICBuZXh0X3N0ZXA6ICdSdW4gbnBtIHJ1biBkYjpwdXNoIG5vdycsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVtb3ZpbmcgZW51bSBkZXBlbmRlbmNpZXM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZW1vdmUgZW51bSBkZXBlbmRlbmNpZXMnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBSZXN0b3JlIGFsbCBkZWZhdWx0IHZhbHVlcyBhZnRlciBzY2hlbWEgc3luY1xuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvcmVzdG9yZS1hbGwtZGVmYXVsdHMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuXG4gICAgICAvLyBSZXN0b3JlIHVzZXJzLnJvbGUgZGVmYXVsdFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgdXNlcnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIHJvbGUgU0VUIERFRkFVTFQgJ3RlbmFudCdcbiAgICAgICAgYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgndXNlcnMucm9sZSBkZWZhdWx0IHJlc3RvcmVkIHRvIHRlbmFudCcpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYHVzZXJzLnJvbGUgcmVzdG9yZSBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXN0b3JlIHVzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIG9yZ2FuaXphdGlvbl9yb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnXG4gICAgICAgIGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ3VzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0IHJlc3RvcmVkIHRvIHRlbmFudCcpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYHVzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSByZXN0b3JlIGZhaWxlZDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc3RvcmUgaW52aXRhdGlvbnMucm9sZSBkZWZhdWx0XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBcbiAgICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBTRVQgREVGQVVMVCAndGVuYW50J1xuICAgICAgICBgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKCdpbnZpdGF0aW9ucy5yb2xlIGRlZmF1bHQgcmVzdG9yZWQgdG8gdGVuYW50Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgaW52aXRhdGlvbnMucm9sZSByZXN0b3JlIGZhaWxlZDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1Jlc3RvcmVkIGFsbCBkZWZhdWx0IHZhbHVlcycsXG4gICAgICAgIG9wZXJhdGlvbnM6IHJlc3VsdHMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVzdG9yaW5nIGRlZmF1bHRzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcmVzdG9yZSBkZWZhdWx0cycsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIENvbXBsZXRlIGRhdGFiYXNlIHNjaGVtYSBzeW5jIGVuZHBvaW50XG4gIGFwcC5wb3N0KCcvYXBpL2RvY3VtZW50cy9jb21wbGV0ZS1zY2hlbWEtc3luYycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRzID0gW107XG5cbiAgICAgIC8vIFN0ZXAgMTogUmVtb3ZlIGFsbCBlbnVtIGRlcGVuZGVuY2llcyB0ZW1wb3JhcmlseVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVEFCTEUgdXNlcnMgQUxURVIgQ09MVU1OIHJvbGUgRFJPUCBERUZBVUxUYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlbW92ZWQgdXNlcnMucm9sZSBkZWZhdWx0Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcnMucm9sZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIHVzZXJfb3JnYW5pemF0aW9ucyBBTFRFUiBDT0xVTU4gb3JnYW5pemF0aW9uX3JvbGUgRFJPUCBERUZBVUxUYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlbW92ZWQgdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlIGRlZmF1bHQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBBTFRFUiBDT0xVTU4gcm9sZSBEUk9QIERFRkFVTFRgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKCfinJMgUmVtb3ZlZCBpbnZpdGF0aW9ucy5yb2xlIGRlZmF1bHQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGBpbnZpdGF0aW9ucy5yb2xlOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAyOiBNaWdyYXRlIGFueSAnb3duZXInIHVzZXJzIHRvICdhZG1pbidcbiAgICAgIGNvbnN0IG93bmVyVXNlcnMgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBTRUxFQ1QgY291bnQoKikgYXMgY291bnQgRlJPTSB1c2VycyBXSEVSRSByb2xlID0gJ293bmVyJ2ApO1xuICAgICAgY29uc3Qgb3duZXJDb3VudCA9IE51bWJlcihvd25lclVzZXJzLnJvd3NbMF0/LmNvdW50IHx8IDApO1xuICAgICAgaWYgKG93bmVyQ291bnQgPiAwKSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFVQREFURSB1c2VycyBTRVQgcm9sZSA9ICdhZG1pbicgV0hFUkUgcm9sZSA9ICdvd25lcidgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGDinJMgTWlncmF0ZWQgJHtvd25lckNvdW50fSBvd25lciB1c2VycyB0byBhZG1pbmApO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBVUERBVEUgdXNlcl9vcmdhbml6YXRpb25zIFNFVCBvcmdhbml6YXRpb25fcm9sZSA9ICdhZG1pbicgV0hFUkUgb3JnYW5pemF0aW9uX3JvbGUgPSAnb3duZXInYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFVwZGF0ZWQgdXNlcl9vcmdhbml6YXRpb25zIG93bmVyIHJvbGVzIHRvIGFkbWluJyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcl9vcmdhbml6YXRpb25zIG93bmVyIHVwZGF0ZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMzogRml4IHRoZSBlbnVtIHRvIG1hdGNoIGRldmVsb3BtZW50IHNjaGVtYVxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gUmVuYW1lIGN1cnJlbnQgZW51bVxuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUWVBFIHVzZXJfcm9sZSBSRU5BTUUgVE8gdXNlcl9yb2xlX29sZGApO1xuICAgICAgICBcbiAgICAgICAgLy8gQ3JlYXRlIG5ldyBlbnVtIHdpdGggY29ycmVjdCB2YWx1ZXNcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQ1JFQVRFIFRZUEUgdXNlcl9yb2xlIEFTIEVOVU0gKFxuICAgICAgICAgICAgJ2FkbWluJywgJ21hbmFnZXInLCAndGVuYW50JywgJ3Jlc2lkZW50JywgXG4gICAgICAgICAgICAnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnXG4gICAgICAgICAgKVxuICAgICAgICBgKTtcblxuICAgICAgICAvLyBVcGRhdGUgYWxsIHRhYmxlc1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSB1c2VycyBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVgKTtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVEFCTEUgdXNlcl9vcmdhbml6YXRpb25zIEFMVEVSIENPTFVNTiBvcmdhbml6YXRpb25fcm9sZSBUWVBFIHVzZXJfcm9sZSBVU0lORyBvcmdhbml6YXRpb25fcm9sZTo6dGV4dDo6dXNlcl9yb2xlYCk7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIGludml0YXRpb25zIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZWApO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSByb2xlX3Blcm1pc3Npb25zIEFMVEVSIENPTFVNTiByb2xlIFRZUEUgdXNlcl9yb2xlIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZWApO1xuICAgICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFVwZGF0ZWQgcm9sZV9wZXJtaXNzaW9ucyBlbnVtJyk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICByZXN1bHRzLnB1c2goYHJvbGVfcGVybWlzc2lvbnM6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRHJvcCBvbGQgZW51bVxuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBEUk9QIFRZUEUgdXNlcl9yb2xlX29sZGApO1xuICAgICAgICBcbiAgICAgICAgcmVzdWx0cy5wdXNoKCfinJMgU3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgdXNlcl9yb2xlIGVudW0nKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGBFbnVtIHVwZGF0ZSBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDQ6IFJlc3RvcmUgZGVmYXVsdCB2YWx1ZXNcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIHVzZXJzIEFMVEVSIENPTFVNTiByb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlc3RvcmVkIHVzZXJzLnJvbGUgZGVmYXVsdCB0byB0ZW5hbnQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2Vycy5yb2xlIGRlZmF1bHQgcmVzdG9yZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIHVzZXJfb3JnYW5pemF0aW9ucyBBTFRFUiBDT0xVTU4gb3JnYW5pemF0aW9uX3JvbGUgU0VUIERFRkFVTFQgJ3RlbmFudCdgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKCfinJMgUmVzdG9yZWQgdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlIGRlZmF1bHQgdG8gdGVuYW50Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlIGRlZmF1bHQgcmVzdG9yZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIGludml0YXRpb25zIEFMVEVSIENPTFVNTiByb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlc3RvcmVkIGludml0YXRpb25zLnJvbGUgZGVmYXVsdCB0byB0ZW5hbnQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGBpbnZpdGF0aW9ucy5yb2xlIGRlZmF1bHQgcmVzdG9yZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNTogQWRkIG1pc3NpbmcgY29sdW1ucyB0aGF0IGV4aXN0IGluIHByb2R1Y3Rpb24gYnV0IG5vdCBkZXZlbG9wbWVudFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgaW52aXRhdGlvbl9hdWRpdF9sb2cgXG4gICAgICAgICAgQUREIENPTFVNTiBJRiBOT1QgRVhJU1RTIGNyZWF0ZWRfYXQgVElNRVNUQU1QIERFRkFVTFQgTk9XKClcbiAgICAgICAgYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIEFkZGVkIGNyZWF0ZWRfYXQgdG8gaW52aXRhdGlvbl9hdWRpdF9sb2cnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGBpbnZpdGF0aW9uX2F1ZGl0X2xvZy5jcmVhdGVkX2F0OiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRGF0YWJhc2Ugc2NoZW1hIHN5bmNocm9uaXphdGlvbiBjb21wbGV0ZScsXG4gICAgICAgIG9wZXJhdGlvbnM6IHJlc3VsdHMsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBzdWNjZXNzOiB0cnVlXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZHVyaW5nIHNjaGVtYSBzeW5jaHJvbml6YXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ1NjaGVtYSBzeW5jaHJvbml6YXRpb24gZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEVuaGFuY2VkIGRpYWdub3N0aWMgZW5kcG9pbnQgd2l0aCBkYXRhYmFzZSBzY2hlbWEgY2hlY2tcbiAgYXBwLmdldCgnL2FwaS9kb2N1bWVudHMvZGlhZ25vc3RpYycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBkb2N1bWVudHMgdGFibGUgZXhpc3RzXG4gICAgICBsZXQgdGFibGVFeGlzdHMgPSBmYWxzZTtcbiAgICAgIGxldCB0YWJsZVNjaGVtYSA9IG51bGw7XG4gICAgICBcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIFNFTEVDVCBjb2x1bW5fbmFtZSwgZGF0YV90eXBlLCBpc19udWxsYWJsZSwgY29sdW1uX2RlZmF1bHQgXG4gICAgICAgICAgRlJPTSBpbmZvcm1hdGlvbl9zY2hlbWEuY29sdW1ucyBcbiAgICAgICAgICBXSEVSRSB0YWJsZV9uYW1lID0gJ2RvY3VtZW50cycgXG4gICAgICAgICAgT1JERVIgQlkgb3JkaW5hbF9wb3NpdGlvblxuICAgICAgICBgKTtcbiAgICAgICAgdGFibGVFeGlzdHMgPSByZXN1bHQucm93cy5sZW5ndGggPiAwO1xuICAgICAgICB0YWJsZVNjaGVtYSA9IHJlc3VsdC5yb3dzO1xuICAgICAgfSBjYXRjaCAoc2NoZW1hRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignU2NoZW1hIGNoZWNrIGVycm9yOicsIHNjaGVtYUVycm9yKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnQgQVBJIGRpYWdub3N0aWMnLFxuICAgICAgICBnY3NfZGlzYWJsZWQ6IHRydWUsXG4gICAgICAgIHNlc3Npb25fZml4X2FwcGxpZWQ6IHRydWUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBlbnZpcm9ubWVudDogcHJvY2Vzcy5lbnYuTk9ERV9FTlYsXG4gICAgICAgIHZlcnNpb246ICd2Mi4xLWdjcy1kaXNhYmxlZCcsXG4gICAgICAgIHJlY2VudF9lcnJvcnM6IGVycm9yTG9nLnNsaWNlKC01KSwgLy8gTGFzdCA1IGVycm9yc1xuICAgICAgICBzdG9yYWdlX3N0YXR1czoge1xuICAgICAgICAgIGV4aXN0czogISFzdG9yYWdlLFxuICAgICAgICAgIHR5cGU6IHN0b3JhZ2U/LmNvbnN0cnVjdG9yPy5uYW1lLFxuICAgICAgICAgIG1ldGhvZHM6IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKE9iamVjdC5nZXRQcm90b3R5cGVPZihzdG9yYWdlIHx8IHt9KSlcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YWJhc2Vfc3RhdHVzOiB7XG4gICAgICAgICAgZG9jdW1lbnRzX3RhYmxlX2V4aXN0czogdGFibGVFeGlzdHMsXG4gICAgICAgICAgZG9jdW1lbnRzX3RhYmxlX3NjaGVtYTogdGFibGVTY2hlbWEsXG4gICAgICAgICAgc2NoZW1hX2NvbHVtbnNfY291bnQ6IHRhYmxlU2NoZW1hPy5sZW5ndGggfHwgMCxcbiAgICAgICAgICBjb25uZWN0aW9uX3Rlc3Q6IGF3YWl0IHRlc3REYXRhYmFzZUNvbm5lY3Rpb24oKSxcbiAgICAgICAgICBzYW1wbGVfcXVlcnlfdGVzdDogYXdhaXQgdGVzdFNhbXBsZVF1ZXJ5KCksXG4gICAgICAgICAgZW51bV9jaGVjazogYXdhaXQgY2hlY2tFbnVtVmFsdWVzKCksXG4gICAgICAgICAgdXNlcl9vcmdhbml6YXRpb25fbGlua3M6IGF3YWl0IGNoZWNrVXNlck9yZ2FuaXphdGlvbkxpbmtzKClcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHJ1bm5pbmcgZGlhZ25vc3RpYzonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnRGlhZ25vc3RpYyBmYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuICBcbiAgLy8gRXJyb3IgbG9nZ2luZyBoZWxwZXJcbiAgY29uc3QgbG9nRXJyb3IgPSAoZW5kcG9pbnQ6IHN0cmluZywgZXJyb3I6IGFueSwgdXNlcj86IGFueSkgPT4ge1xuICAgIGNvbnN0IGVycm9yRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGVuZHBvaW50LFxuICAgICAgZXJyb3I6IHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgICBkZXRhaWxzOiBlcnJvci50b1N0cmluZygpXG4gICAgICB9LFxuICAgICAgdXNlcjogdXNlciA/IHsgaWQ6IHVzZXIuaWQsIHJvbGU6IHVzZXIucm9sZSB9IDogbnVsbFxuICAgIH07XG4gICAgXG4gICAgZXJyb3JMb2cucHVzaChlcnJvckVudHJ5KTtcbiAgICBpZiAoZXJyb3JMb2cubGVuZ3RoID4gNTApIGVycm9yTG9nLnNoaWZ0KCk7IC8vIEtlZXAgb25seSBsYXN0IDUwIGVycm9yc1xuICAgIFxuICAgIGNvbnNvbGUuZXJyb3IoYFske2Vycm9yRW50cnkudGltZXN0YW1wfV0g8J+aqCBFUlJPUiBpbiAke2VuZHBvaW50fTpgLCBlcnJvckVudHJ5KTtcbiAgICByZXR1cm4gZXJyb3JFbnRyeTtcbiAgfTtcbiAgXG4gIC8vIEdldCBhbGwgZG9jdW1lbnRzIGZvciB0aGUgYXV0aGVudGljYXRlZCB1c2VyXG4gIGFwcC5nZXQoJy9hcGkvZG9jdW1lbnRzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdMSVNUX1JFUVVFU1QnLCB7XG4gICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZCxcbiAgICAgIHVzZXJSb2xlOiByZXEudXNlcj8ucm9sZSxcbiAgICAgIHF1ZXJ5OiByZXEucXVlcnksXG4gICAgICB1cmw6IHJlcS51cmwsXG4gICAgICBtZXRob2Q6IHJlcS5tZXRob2QsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIGNvbnRlbnRUeXBlOiByZXEuaGVhZGVyc1snY29udGVudC10eXBlJ10sXG4gICAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcbiAgICAgICAgcmVmZXJlcjogcmVxLmhlYWRlcnMucmVmZXJlclxuICAgICAgfVxuICAgIH0sICdJTkZPJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIFxuICAgICAgLy8gRW5oYW5jZWQgdXNlciBkYXRhIGxvZ2dpbmdcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdVU0VSX1ZBTElEQVRJT04nLCB7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICAgIGhhc1ZhbGlkVXNlcjogISF1c2VyLFxuICAgICAgICBzZXNzaW9uSW5mbzoge1xuICAgICAgICAgIHNlc3Npb25FeGlzdHM6ICEhcmVxLnNlc3Npb24sXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiAhIXJlcS51c2VyXG4gICAgICAgIH1cbiAgICAgIH0sICdERUJVRycpO1xuICAgICAgXG4gICAgICAvLyBDcml0aWNhbCBzdG9yYWdlIHZhbGlkYXRpb24gd2l0aCBlbmhhbmNlZCBkZWJ1Z2dpbmdcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdTVE9SQUdFX1ZBTElEQVRJT04nLCB7XG4gICAgICAgIHN0b3JhZ2VFeGlzdHM6ICEhc3RvcmFnZSxcbiAgICAgICAgc3RvcmFnZVR5cGU6IHN0b3JhZ2U/LmNvbnN0cnVjdG9yPy5uYW1lLFxuICAgICAgICBzdG9yYWdlTWV0aG9kOiB0eXBlb2Ygc3RvcmFnZT8uZ2V0RG9jdW1lbnRzLFxuICAgICAgICBkYXRhYmFzZUNvbm5lY3Rpb246IHtcbiAgICAgICAgICBoYXNEYjogISFkYixcbiAgICAgICAgICBjb25uZWN0aW9uU3RyaW5nOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw/LnN1YnN0cmluZygwLCAzMCkgKyAnLi4uJ1xuICAgICAgICB9XG4gICAgICB9LCAnREVCVUcnKTtcbiAgICAgIGNvbnN0IGRvY3VtZW50VHlwZSA9IHJlcS5xdWVyeS50eXBlIGFzIHN0cmluZzsgLy8gJ2J1aWxkaW5nJywgJ3Jlc2lkZW50Jywgb3IgdW5kZWZpbmVkIGZvciBib3RoXG4gICAgICBjb25zdCBzcGVjaWZpY1Jlc2lkZW5jZUlkID0gcmVxLnF1ZXJ5LnJlc2lkZW5jZUlkIGFzIHN0cmluZzsgLy8gRmlsdGVyIGJ5IHNwZWNpZmljIHJlc2lkZW5jZVxuICAgICAgY29uc3Qgc3BlY2lmaWNCdWlsZGluZ0lkID0gcmVxLnF1ZXJ5LmJ1aWxkaW5nSWQgYXMgc3RyaW5nOyAvLyBGaWx0ZXIgYnkgc3BlY2lmaWMgYnVpbGRpbmdcbiAgICAgIGNvbnN0IGF0dGFjaGVkVG9UeXBlID0gcmVxLnF1ZXJ5LmF0dGFjaGVkVG9UeXBlIGFzIHN0cmluZzsgLy8gRmlsdGVyIGJ5IGF0dGFjaGVkIGVudGl0eSB0eXBlXG4gICAgICBjb25zdCBhdHRhY2hlZFRvSWQgPSByZXEucXVlcnkuYXR0YWNoZWRUb0lkIGFzIHN0cmluZzsgLy8gRmlsdGVyIGJ5IGF0dGFjaGVkIGVudGl0eSBJRFxuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlcyBmb3IgZmlsdGVyaW5nXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignVVNFUl9EQVRBX0ZFVENIX1NUQVJUJywgeyB1c2VySWQgfSwgJ0RFQlVHJyk7XG4gICAgICBcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdDQUxMX2dldFVzZXJPcmdhbml6YXRpb25zJywgeyB1c2VySWQgfSwgJ0RFQlVHJyk7XG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gb3JnYW5pemF0aW9uc1N0YXJ0O1xuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ2dldFVzZXJPcmdhbml6YXRpb25zX1NVQ0NFU1MnLCB7XG4gICAgICAgIGNvdW50OiBvcmdhbml6YXRpb25zLmxlbmd0aCxcbiAgICAgICAgZXhlY3V0aW9uVGltZTogYCR7b3JnYW5pemF0aW9uc1RpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgIG9yZ2FuaXphdGlvbnM6IG9yZ2FuaXphdGlvbnMubWFwKChvcmc6IGFueSkgPT4gKHsgaWQ6IG9yZy5vcmdhbml6YXRpb25JZCwgcm9sZTogb3JnLm9yZ2FuaXphdGlvblJvbGUgfSkpXG4gICAgICB9LCAnREVCVUcnKTtcbiAgICAgIFxuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ0NBTExfZ2V0VXNlclJlc2lkZW5jZXMnLCB7IHVzZXJJZCB9LCAnREVCVUcnKTtcbiAgICAgIGNvbnN0IHJlc2lkZW5jZXNTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgdXNlclJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICBjb25zdCByZXNpZGVuY2VzVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcmVzaWRlbmNlc1N0YXJ0O1xuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ2dldFVzZXJSZXNpZGVuY2VzX1NVQ0NFU1MnLCB7XG4gICAgICAgIGNvdW50OiB1c2VyUmVzaWRlbmNlcy5sZW5ndGgsXG4gICAgICAgIGV4ZWN1dGlvblRpbWU6IGAke3Jlc2lkZW5jZXNUaW1lLnRvRml4ZWQoMil9bXNgLFxuICAgICAgICByZXNpZGVuY2VJZHM6IHVzZXJSZXNpZGVuY2VzLm1hcCgodXI6IGFueSkgPT4gdXIucmVzaWRlbmNlSWQpLmZpbHRlcihCb29sZWFuKVxuICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICBcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdDQUxMX2dldEJ1aWxkaW5ncycsIHt9LCAnREVCVUcnKTtcbiAgICAgIGNvbnN0IGJ1aWxkaW5nc1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBjb25zdCBidWlsZGluZ3MgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5ncygpO1xuICAgICAgY29uc3QgYnVpbGRpbmdzVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gYnVpbGRpbmdzU3RhcnQ7XG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignZ2V0QnVpbGRpbmdzX1NVQ0NFU1MnLCB7XG4gICAgICAgIGNvdW50OiBidWlsZGluZ3MubGVuZ3RoLFxuICAgICAgICBleGVjdXRpb25UaW1lOiBgJHtidWlsZGluZ3NUaW1lLnRvRml4ZWQoMil9bXNgLFxuICAgICAgICBidWlsZGluZ0lkczogYnVpbGRpbmdzLm1hcChiID0+IGIuaWQpXG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSBvcmdhbml6YXRpb25zLmxlbmd0aCA+IDAgPyBvcmdhbml6YXRpb25zWzBdLm9yZ2FuaXphdGlvbklkIDogdW5kZWZpbmVkO1xuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCfj6IgT3JnYW5pemF0aW9uIElEIGRldGVybWluZWQ6YCwgb3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAvLyBJZiBzcGVjaWZpYyByZXNpZGVuY2UgSUQgcHJvdmlkZWQsIGZpbHRlciB0byBvbmx5IHRoYXQgcmVzaWRlbmNlXG4gICAgICBsZXQgcmVzaWRlbmNlSWRzOiBzdHJpbmdbXTtcbiAgICAgIGlmIChzcGVjaWZpY1Jlc2lkZW5jZUlkKSB7XG4gICAgICAgIC8vIEFkbWluIHVzZXJzIGhhdmUgYWNjZXNzIHRvIGFsbCByZXNpZGVuY2VzXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyUm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgICAgcmVzaWRlbmNlSWRzID0gW3NwZWNpZmljUmVzaWRlbmNlSWRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFZlcmlmeSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBzcGVjaWZpYyByZXNpZGVuY2VcbiAgICAgICAgICAvLyBIYW5kbGUgYm90aCBzaW1wbGUge3Jlc2lkZW5jZUlkOiBzdHJpbmd9IGFuZCBjb21wbGV4IG5lc3RlZCBzdHJ1Y3R1cmVzXG4gICAgICAgICAgY29uc3QgaGFzQWNjZXNzID0gdXNlclJlc2lkZW5jZXMuc29tZSgodXI6IGFueSkgPT4ge1xuICAgICAgICAgICAgLy8gSGFuZGxlIHNpbXBsZSBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2VJZCA9PT0gc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEhhbmRsZSBjb21wbGV4IG5lc3RlZCBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci51c2VyUmVzaWRlbmNlPy5yZXNpZGVuY2VJZCA9PT0gc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEhhbmRsZSByZXNpZGVuY2UgbmVzdGVkIHN0cnVjdHVyZVxuICAgICAgICAgICAgaWYgKHVyLnJlc2lkZW5jZT8uaWQgPT09IHNwZWNpZmljUmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgcmVzaWRlbmNlJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzaWRlbmNlSWRzID0gW3NwZWNpZmljUmVzaWRlbmNlSWRdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFeHRyYWN0IHJlc2lkZW5jZSBJRHMgZnJvbSBib3RoIHNpbXBsZSBhbmQgY29tcGxleCBzdHJ1Y3R1cmVzXG4gICAgICAgIHJlc2lkZW5jZUlkcyA9IHVzZXJSZXNpZGVuY2VzXG4gICAgICAgICAgLm1hcCgodXI6IGFueSkgPT4ge1xuICAgICAgICAgICAgLy8gSGFuZGxlIHNpbXBsZSBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdXIucmVzaWRlbmNlSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBIYW5kbGUgY29tcGxleCBuZXN0ZWQgc3RydWN0dXJlXG4gICAgICAgICAgICBpZiAodXIudXNlclJlc2lkZW5jZT8ucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHVyLnVzZXJSZXNpZGVuY2UucmVzaWRlbmNlSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBIYW5kbGUgcmVzaWRlbmNlIG5lc3RlZCBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2U/LmlkKSB7XG4gICAgICAgICAgICAgIHJldHVybiB1ci5yZXNpZGVuY2UuaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5maWx0ZXIoKGlkOiBhbnkpID0+IGlkICE9PSBudWxsKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBidWlsZGluZ3MubWFwKChiKSA9PiBiLmlkKTtcblxuICAgICAgY29uc3QgYWxsRG9jdW1lbnRSZWNvcmRzOiBhbnlbXSA9IFtdO1xuXG4gICAgICAvLyBVc2UgdW5pZmllZCBkb2N1bWVudHMgc3lzdGVtXG4gICAgICBjb25zdCBmaWx0ZXJzOiBhbnkgPSB7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICB9O1xuXG4gICAgICAvLyBGaWx0ZXIgYnkgc3BlY2lmaWMgcmVzaWRlbmNlIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICBmaWx0ZXJzLnJlc2lkZW5jZUlkID0gc3BlY2lmaWNSZXNpZGVuY2VJZDtcbiAgICAgIH1cblxuICAgICAgLy8gRmlsdGVyIGJ5IHNwZWNpZmljIGJ1aWxkaW5nIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoc3BlY2lmaWNCdWlsZGluZ0lkKSB7XG4gICAgICAgIGZpbHRlcnMuYnVpbGRpbmdJZCA9IHNwZWNpZmljQnVpbGRpbmdJZDtcbiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnRUeXBlID09PSAnYnVpbGRpbmcnKSB7XG4gICAgICAgIC8vIEZvciBidWlsZGluZyBkb2N1bWVudHMsIHNlYXJjaCBpbiBidWlsZGluZ3MgdXNlciBoYXMgYWNjZXNzIHRvXG4gICAgICAgIGlmIChidWlsZGluZ0lkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBkb2N1bWVudHMgZm9yIGJ1aWxkaW5ncywgd2lsbCBmaWx0ZXIgbGF0ZXIgdG8gc2hvdyBvbmx5IGJ1aWxkaW5nLWxldmVsIGRvY3VtZW50c1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKGRvY3VtZW50VHlwZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICAvLyBGb3IgcmVzaWRlbnQgZG9jdW1lbnRzLCBzZWFyY2ggaW4gcmVzaWRlbmNlcyB1c2VyIGhhcyBhY2Nlc3MgdG9cbiAgICAgICAgaWYgKHJlc2lkZW5jZUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBkb2N1bWVudHMgZm9yIHJlc2lkZW5jZXMsIHdpbGwgZmlsdGVyIGxhdGVyXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ1JJVElDQUw6IEVuaGFuY2VkIGRvY3VtZW50IGZldGNoaW5nIHdpdGggcGVyZm9ybWFuY2UgdHJhY2tpbmdcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdTVE9SQUdFX2dldERvY3VtZW50c19DQUxMJywge1xuICAgICAgICBmaWx0ZXJzLFxuICAgICAgICBzdG9yYWdlSW5zdGFuY2U6IHN0b3JhZ2UuY29uc3RydWN0b3IubmFtZSxcbiAgICAgICAgZmlsdGVyc1N0cmluZ2lmaWVkOiBKU09OLnN0cmluZ2lmeShmaWx0ZXJzLCBudWxsLCAyKVxuICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRvY3VtZW50c1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBsZXQgZG9jdW1lbnRzO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZG9jdW1lbnRzID0gYXdhaXQgc3RvcmFnZS5nZXREb2N1bWVudHMoZmlsdGVycyk7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50c1RpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGRvY3VtZW50c1N0YXJ0O1xuICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignU1RPUkFHRV9nZXREb2N1bWVudHNfU1VDQ0VTUycsIHtcbiAgICAgICAgICBkb2N1bWVudENvdW50OiBkb2N1bWVudHM/Lmxlbmd0aCB8fCAwLFxuICAgICAgICAgIGV4ZWN1dGlvblRpbWU6IGAke2RvY3VtZW50c1RpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgICAgZmlsdGVyczogZmlsdGVyc1xuICAgICAgICB9LCAnREVCVUcnKTtcbiAgICAgIH0gY2F0Y2ggKGRvY3VtZW50c0Vycm9yKSB7XG4gICAgICAgIGNvbnN0IGRvY3VtZW50c1RpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGRvY3VtZW50c1N0YXJ0O1xuICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignU1RPUkFHRV9nZXREb2N1bWVudHNfRVJST1InLCB7XG4gICAgICAgICAgZXJyb3I6IGRvY3VtZW50c0Vycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgc3RhY2s6IGRvY3VtZW50c0Vycm9yLnN0YWNrPy5zdWJzdHJpbmcoMCwgMjAwKSxcbiAgICAgICAgICBleGVjdXRpb25UaW1lOiBgJHtkb2N1bWVudHNUaW1lLnRvRml4ZWQoMil9bXNgLFxuICAgICAgICAgIGZpbHRlcnM6IGZpbHRlcnNcbiAgICAgICAgfSwgJ0VSUk9SJyk7XG4gICAgICAgIHRocm93IGRvY3VtZW50c0Vycm9yO1xuICAgICAgfVxuXG4gICAgICAvLyBFbmhhbmNlZCBkb2N1bWVudCByZXNwb25zZSBsb2dnaW5nXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignRE9DVU1FTlRTX1JFU1BPTlNFX0FOQUxZU0lTJywge1xuICAgICAgICB0b3RhbERvY3VtZW50czogZG9jdW1lbnRzPy5sZW5ndGggfHwgMCxcbiAgICAgICAgZG9jdW1lbnRQcmV2aWV3OiBkb2N1bWVudHM/LnNsaWNlKDAsIDMpPy5tYXAoZCA9PiAoe1xuICAgICAgICAgIGlkOiBkLmlkLFxuICAgICAgICAgIG5hbWU6IGQubmFtZSxcbiAgICAgICAgICBkb2N1bWVudFR5cGU6IGQuZG9jdW1lbnRUeXBlLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogZC51cGxvYWRlZEJ5SWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogZC5idWlsZGluZ0lkLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiBkLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIGZpbGVQYXRoOiBkLmZpbGVQYXRoLFxuICAgICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogZC5pc1Zpc2libGVUb1RlbmFudHMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBkLmNyZWF0ZWRBdFxuICAgICAgICB9KSksXG4gICAgICAgIGRvY3VtZW50VHlwZXM6IGRvY3VtZW50cz8ucmVkdWNlKChhY2MsIGRvYykgPT4ge1xuICAgICAgICAgIGFjY1tkb2MuZG9jdW1lbnRUeXBlXSA9IChhY2NbZG9jLmRvY3VtZW50VHlwZV0gfHwgMCkgKyAxO1xuICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgIH0sIHt9IGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj4pXG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgLy8gRGVidWcgbG9nZ2luZ1xuICAgICAgY29uc29sZS5sb2coJ/CflI0gW0RPQ1VNRU5UUyBBUEkgREVCVUddOicsIHtcbiAgICAgICAgZmlsdGVycyxcbiAgICAgICAgZG9jdW1lbnRzRm91bmQ6IGRvY3VtZW50cz8ubGVuZ3RoIHx8IDAsXG4gICAgICAgIHNwZWNpZmljUmVzaWRlbmNlSWQsXG4gICAgICAgIGF0dGFjaGVkVG9UeXBlLFxuICAgICAgICBhdHRhY2hlZFRvSWQsXG4gICAgICAgIHVzZXJSb2xlLFxuICAgICAgICB1c2VySWQsXG4gICAgICB9KTtcblxuICAgICAgLy8gQXBwbHkgcm9sZS1iYXNlZCBmaWx0ZXJpbmcgd2l0aCB0ZW5hbnQgdmlzaWJpbGl0eSBydWxlc1xuICAgICAgY29uc3QgZmlsdGVyZWREb2N1bWVudFJlY29yZHMgPSBkb2N1bWVudHMuZmlsdGVyKChkb2MpID0+IHtcbiAgICAgICAgLy8gSWYgZmlsdGVyaW5nIGJ5IGF0dGFjaGVkIGVudGl0eSwgb25seSBzaG93IGRvY3VtZW50cyBhdHRhY2hlZCB0byB0aGF0IGVudGl0eVxuICAgICAgICBpZiAoYXR0YWNoZWRUb1R5cGUgJiYgYXR0YWNoZWRUb0lkKSB7XG4gICAgICAgICAgaWYgKGRvYy5hdHRhY2hlZFRvVHlwZSAhPT0gYXR0YWNoZWRUb1R5cGUgfHwgZG9jLmF0dGFjaGVkVG9JZCAhPT0gYXR0YWNoZWRUb0lkKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gSWYgZmlsdGVyaW5nIGJ5IHNwZWNpZmljIGJ1aWxkaW5nLCBvbmx5IHNob3cgZG9jdW1lbnRzIGZvciB0aGF0IGJ1aWxkaW5nXG4gICAgICAgIGlmIChzcGVjaWZpY0J1aWxkaW5nSWQpIHtcbiAgICAgICAgICBpZiAoZG9jLmJ1aWxkaW5nSWQgIT09IHNwZWNpZmljQnVpbGRpbmdJZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBXaGVuIHZpZXdpbmcgQnVpbGRpbmcgRG9jdW1lbnRzLCBvbmx5IHNob3cgYnVpbGRpbmctbGV2ZWwgZG9jdW1lbnRzIChub3QgcmVzaWRlbmNlLWxldmVsKVxuICAgICAgICAgIGlmIChkb2N1bWVudFR5cGUgPT09ICdidWlsZGluZycgJiYgZG9jLmZpbGVQYXRoICYmIGRvYy5maWxlUGF0aC5pbmNsdWRlcygncmVzaWRlbmNlcy8nKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFdoZW4gdmlld2luZyBCdWlsZGluZyBEb2N1bWVudHMgKGRvY3VtZW50VHlwZSA9PT0gJ2J1aWxkaW5nJyksIGZpbHRlciBvdXQgcmVzaWRlbmNlLWxldmVsIGRvY3VtZW50c1xuICAgICAgICBpZiAoZG9jdW1lbnRUeXBlID09PSAnYnVpbGRpbmcnICYmIGRvYy5maWxlUGF0aCAmJiBkb2MuZmlsZVBhdGguaW5jbHVkZXMoJ3Jlc2lkZW5jZXMvJykpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBZG1pbiBjYW4gc2VlIGFsbCBkb2N1bWVudHNcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNYW5hZ2VyIChpbmNsdWRpbmcgZGVtb19tYW5hZ2VyKSBjYW4gc2VlIGFsbCBkb2N1bWVudHMgaW4gdGhlaXIgb3JnYW5pemF0aW9uXG4gICAgICAgIGlmICgodXNlclJvbGUgPT09ICdtYW5hZ2VyJyB8fCB1c2VyUm9sZSA9PT0gJ2RlbW9fbWFuYWdlcicpICYmIG9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgICAgaWYgKGRvYy5idWlsZGluZ0lkICYmIGJ1aWxkaW5nSWRzLmluY2x1ZGVzKGRvYy5idWlsZGluZ0lkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChkb2MucmVzaWRlbmNlSWQgJiYgcmVzaWRlbmNlSWRzLmluY2x1ZGVzKGRvYy5yZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFJlc2lkZW50IChpbmNsdWRpbmcgZGVtb19yZXNpZGVudCkgYWNjZXNzIHJ1bGVzXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ3Jlc2lkZW50JyB8fCB1c2VyUm9sZSA9PT0gJ2RlbW9fcmVzaWRlbnQnKSB7XG4gICAgICAgICAgLy8gUmVzaWRlbnRzIGNhbiBzZWUgZG9jdW1lbnRzIGluIHRoZWlyIHJlc2lkZW5jZVxuICAgICAgICAgIGlmIChkb2MucmVzaWRlbmNlSWQgJiYgcmVzaWRlbmNlSWRzLmluY2x1ZGVzKGRvYy5yZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBSZXNpZGVudHMgY2FuIHNlZSBidWlsZGluZyBkb2N1bWVudHMgcmVsYXRlZCB0byB0aGVpciByZXNpZGVuY2VzXG4gICAgICAgICAgaWYgKGRvYy5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBhbnkgb2YgdXNlcidzIHJlc2lkZW5jZXMgYmVsb25nIHRvIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgICAgIGNvbnN0IHVzZXJCdWlsZGluZ0lkcyA9IHVzZXJSZXNpZGVuY2VzXG4gICAgICAgICAgICAgIC5tYXAoKHVyOiBhbnkpID0+IHVyLnJlc2lkZW5jZT8uYnVpbGRpbmdJZCB8fCB1ci51c2VyUmVzaWRlbmNlPy5yZXNpZGVuY2U/LmJ1aWxkaW5nSWQpXG4gICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICByZXR1cm4gdXNlckJ1aWxkaW5nSWRzLmluY2x1ZGVzKGRvYy5idWlsZGluZ0lkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUZW5hbnQgKGluY2x1ZGluZyBkZW1vX3RlbmFudCkgYWNjZXNzIHJ1bGVzIC0gbW9yZSByZXN0cmljdGl2ZVxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICd0ZW5hbnQnIHx8IHVzZXJSb2xlID09PSAnZGVtb190ZW5hbnQnKSB7XG4gICAgICAgICAgLy8gVGVuYW50cyBjYW4gb25seSBzZWUgZG9jdW1lbnRzIG1hcmtlZCBhcyB2aXNpYmxlIHRvIHRlbmFudHNcbiAgICAgICAgICBpZiAoIWRvYy5pc1Zpc2libGVUb1RlbmFudHMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUZW5hbnRzIGNhbiBzZWUgdmlzaWJsZSBkb2N1bWVudHMgaW4gdGhlaXIgcmVzaWRlbmNlXG4gICAgICAgICAgaWYgKGRvYy5yZXNpZGVuY2VJZCAmJiByZXNpZGVuY2VJZHMuaW5jbHVkZXMoZG9jLnJlc2lkZW5jZUlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVGVuYW50cyBjYW4gc2VlIHZpc2libGUgYnVpbGRpbmcgZG9jdW1lbnRzIHJlbGF0ZWQgdG8gdGhlaXIgcmVzaWRlbmNlc1xuICAgICAgICAgIGlmIChkb2MuYnVpbGRpbmdJZCkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW55IG9mIHVzZXIncyByZXNpZGVuY2VzIGJlbG9uZyB0byB0aGlzIGJ1aWxkaW5nXG4gICAgICAgICAgICBjb25zdCB1c2VyQnVpbGRpbmdJZHMgPSB1c2VyUmVzaWRlbmNlc1xuICAgICAgICAgICAgICAubWFwKCh1cjogYW55KSA9PiB1ci5yZXNpZGVuY2U/LmJ1aWxkaW5nSWQgfHwgdXIudXNlclJlc2lkZW5jZT8ucmVzaWRlbmNlPy5idWlsZGluZ0lkKVxuICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgcmV0dXJuIHVzZXJCdWlsZGluZ0lkcy5pbmNsdWRlcyhkb2MuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBkb2N1bWVudCB0eXBlIGluZGljYXRvcnMgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHkgYW5kIGZpZWxkIG1hcHBpbmdcbiAgICAgIGNvbnN0IGVuaGFuY2VkRG9jdW1lbnRSZWNvcmRzID0gZmlsdGVyZWREb2N1bWVudFJlY29yZHMubWFwKChkb2MpID0+ICh7XG4gICAgICAgIC4uLmRvYyxcbiAgICAgICAgdGl0bGU6IGRvYy5uYW1lLCAvLyBNYXAgZGF0YWJhc2UgJ25hbWUnIGZpZWxkIHRvIGZyb250ZW5kICd0aXRsZScgZmllbGRcbiAgICAgICAgY2F0ZWdvcnk6IGRvYy5kb2N1bWVudFR5cGUsIC8vIE1hcCBkYXRhYmFzZSAnZG9jdW1lbnRUeXBlJyB0byBmcm9udGVuZCAnY2F0ZWdvcnknXG4gICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6IGRvYy5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVudCcsXG4gICAgICAgIGVudGl0eVR5cGU6IGRvYy5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVuY2UnLFxuICAgICAgICBlbnRpdHlJZDogZG9jLmJ1aWxkaW5nSWQgfHwgZG9jLnJlc2lkZW5jZUlkLFxuICAgICAgICB1cGxvYWREYXRlOiBkb2MuY3JlYXRlZEF0LCAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgICBmaWxlVXJsOiBkb2MuZmlsZVBhdGggPyBgL2FwaS9kb2N1bWVudHMvJHtkb2MuaWR9L2ZpbGVgIDogdW5kZWZpbmVkLCAvLyBHZW5lcmF0ZSBmaWxlIFVSTCBpZiBmaWxlIGV4aXN0c1xuICAgICAgfSkpO1xuXG4gICAgICBhbGxEb2N1bWVudFJlY29yZHMucHVzaCguLi5lbmhhbmNlZERvY3VtZW50UmVjb3Jkcyk7XG5cbiAgICAgIC8vIFNvcnQgYnkgdXBsb2FkIGRhdGUsIG1vc3QgcmVjZW50IGZpcnN0XG4gICAgICBhbGxEb2N1bWVudFJlY29yZHMuc29ydChcbiAgICAgICAgKGEsIGIpID0+IG5ldyBEYXRlKGIudXBsb2FkRGF0ZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS51cGxvYWREYXRlKS5nZXRUaW1lKClcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgICBkb2N1bWVudHM6IGFsbERvY3VtZW50UmVjb3JkcyxcbiAgICAgICAgdG90YWw6IGFsbERvY3VtZW50UmVjb3Jkcy5sZW5ndGgsXG4gICAgICAgIGJ1aWxkaW5nQ291bnQ6IGFsbERvY3VtZW50UmVjb3Jkcy5maWx0ZXIoKGQpID0+IGQuZG9jdW1lbnRDYXRlZ29yeSA9PT0gJ2J1aWxkaW5nJykubGVuZ3RoLFxuICAgICAgICByZXNpZGVudENvdW50OiBhbGxEb2N1bWVudFJlY29yZHMuZmlsdGVyKChkKSA9PiBkLmRvY3VtZW50Q2F0ZWdvcnkgPT09ICdyZXNpZGVudCcpLmxlbmd0aCxcbiAgICAgICAgbGVnYWN5Q291bnQ6IGFsbERvY3VtZW50UmVjb3Jkcy5maWx0ZXIoKGQpID0+IGQuZG9jdW1lbnRDYXRlZ29yeSA9PT0gJ2xlZ2FjeScpLmxlbmd0aCxcbiAgICAgIH07XG4gICAgICAvLyBMb2cgc3VjY2Vzc2Z1bCBkb2N1bWVudCBhY2Nlc3NcbiAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ0RPQ1VNRU5UX0xJU1RfQUNDRVNTJywgdXNlciwgdHJ1ZSwgdW5kZWZpbmVkLCB7XG4gICAgICAgIGRvY3VtZW50c1JldHVybmVkOiBhbGxEb2N1bWVudFJlY29yZHMubGVuZ3RoLFxuICAgICAgICBmaWx0ZXJzOiB7IGRvY3VtZW50VHlwZSwgc3BlY2lmaWNSZXNpZGVuY2VJZCwgc3BlY2lmaWNCdWlsZGluZ0lkIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBLZWVwIHVzZWZ1bCBsb2dnaW5nIGZvciBiaWxsIGRvY3VtZW50c1xuICAgICAgaWYgKGF0dGFjaGVkVG9UeXBlID09PSAnYmlsbCcgJiYgZW5oYW5jZWREb2N1bWVudFJlY29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+ThCBCaWxsIGRvY3VtZW50cyBmb3VuZDpgLCBlbmhhbmNlZERvY3VtZW50UmVjb3Jkcy5sZW5ndGgpO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXMuanNvbihyZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnN0IGVycm9yRW50cnkgPSBsb2dFcnJvcignR0VUIC9hcGkvZG9jdW1lbnRzJywgX2Vycm9yLCByZXEudXNlcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGRvY3VtZW50cycsXG4gICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcCxcbiAgICAgICAgZGVidWdfaW5mbzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBfZXJyb3IubWVzc2FnZSA6IHVuZGVmaW5lZFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBHZXQgYSBzcGVjaWZpYyBkb2N1bWVudCBieSBJRFxuICBhcHAuZ2V0KCcvYXBpL2RvY3VtZW50cy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCBkb2N1bWVudFR5cGUgPSByZXEucXVlcnkudHlwZSBhcyBzdHJpbmc7IC8vIE9wdGlvbmFsIHR5cGUgaGludFxuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlcyBmb3IgZmlsdGVyaW5nXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgY29uc3QgcmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlclJlc2lkZW5jZXModXNlcklkKTtcbiAgICAgIGNvbnN0IGJ1aWxkaW5ncyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmdzKCk7XG5cbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUlkcyA9IHJlc2lkZW5jZXMubWFwKCh1cikgPT4gdXIucmVzaWRlbmNlSWQpO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBidWlsZGluZ3MubWFwKChiKSA9PiBiLmlkKTtcblxuICAgICAgbGV0IGRvY3VtZW50OiBEb2N1bWVudFJlY29yZCB8IG51bGwgPSBudWxsO1xuXG4gICAgICAvLyBUcnkgdG8gZmluZCB0aGUgZG9jdW1lbnQgaW4gdGhlIGFwcHJvcHJpYXRlIHRhYmxlKHMpXG4gICAgICBjb25zdCBoYXNOZXdEb2N1bWVudFJlY29yZE1ldGhvZHMgPSAnZ2V0QnVpbGRpbmdEb2N1bWVudFJlY29yZCcgaW4gc3RvcmFnZTtcblxuICAgICAgaWYgKGhhc05ld0RvY3VtZW50UmVjb3JkTWV0aG9kcykge1xuICAgICAgICBpZiAoIWRvY3VtZW50VHlwZSB8fCBkb2N1bWVudFR5cGUgPT09ICdidWlsZGluZycpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG9jdW1lbnQgPSBhd2FpdCAoc3RvcmFnZSBhcyBhbnkpLmdldEJ1aWxkaW5nRG9jdW1lbnRSZWNvcmQoXG4gICAgICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICBidWlsZGluZ0lkc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudCkge1xuICAgICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5kb2N1bWVudENhdGVnb3J5ID0gJ2J1aWxkaW5nJztcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZW50aXR5VHlwZSA9ICdidWlsZGluZyc7XG4gICAgICAgICAgICAgIChkb2N1bWVudCBhcyBhbnkpLmVudGl0eUlkID0gKGRvY3VtZW50IGFzIGFueSkuYnVpbGRpbmdJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBmZXRjaGluZyBidWlsZGluZyBkb2N1bWVudDonLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRvY3VtZW50ICYmICghZG9jdW1lbnRUeXBlIHx8IGRvY3VtZW50VHlwZSA9PT0gJ3Jlc2lkZW50JykpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG9jdW1lbnQgPSBhd2FpdCAoc3RvcmFnZSBhcyBhbnkpLmdldFJlc2lkZW50RG9jdW1lbnRSZWNvcmQoXG4gICAgICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICByZXNpZGVuY2VJZHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQpIHtcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZG9jdW1lbnRDYXRlZ29yeSA9ICdyZXNpZGVudCc7XG4gICAgICAgICAgICAgIChkb2N1bWVudCBhcyBhbnkpLmVudGl0eVR5cGUgPSAncmVzaWRlbmNlJztcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZW50aXR5SWQgPSAoZG9jdW1lbnQgYXMgYW55KS5yZXNpZGVuY2VJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBmZXRjaGluZyByZXNpZGVudCBkb2N1bWVudDonLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRmFsbGJhY2sgdG8gbGVnYWN5IGRvY3VtZW50cyBpZiBub3QgZm91bmQgYW5kIG5vIHR5cGUgc3BlY2lmaWVkXG4gICAgICBpZiAoIWRvY3VtZW50ICYmICFkb2N1bWVudFR5cGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuZ2V0RG9jdW1lbnQoZG9jdW1lbnRJZCk7XG4gICAgICAgICAgaWYgKGRvY3VtZW50KSB7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5kb2N1bWVudENhdGVnb3J5ID0gJ2xlZ2FjeSc7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5lbnRpdHlUeXBlID0gJ2xlZ2FjeSc7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5lbnRpdHlJZCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJyb3IgZmV0Y2hpbmcgbGVnYWN5IGRvY3VtZW50OicsIGUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0RvY3VtZW50UmVjb3JkIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oZG9jdW1lbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBkb2N1bWVudDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggZG9jdW1lbnQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgbmV3IGRvY3VtZW50IChzdXBwb3J0cyBib3RoIGZpbGUgdXBsb2FkIGFuZCB0ZXh0LW9ubHkgZG9jdW1lbnRzKVxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMnLCByZXF1aXJlQXV0aCwgdXBsb2FkLnNpbmdsZSgnZmlsZScpLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnN0IG9wZXJhdGlvbklkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBcbiAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignVVBMT0FEX1NUQVJUJywge1xuICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICB1c2VySWQ6IHJlcS51c2VyLmlkLFxuICAgICAgdXNlclJvbGU6IHJlcS51c2VyLnJvbGUsXG4gICAgICBlbmRwb2ludDogJ1BPU1QgL2FwaS9kb2N1bWVudHMnXG4gICAgfSwgJ0lORk8nKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgY29uc3QgeyBkb2N1bWVudFR5cGUsIGJ1aWxkaW5nSWQsIHJlc2lkZW5jZUlkLCB0ZXh0Q29udGVudCwgdHlwZSwgLi4ub3RoZXJEYXRhIH0gPSByZXEuYm9keTtcbiAgICAgIFxuICAgICAgLy8gRW5oYW5jZWQgcmVxdWVzdCBhbmFseXNpc1xuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ1VQTE9BRF9SRVFVRVNUX0FOQUxZU0lTJywge1xuICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgcmVxdWVzdERldGFpbHM6IHtcbiAgICAgICAgICBkb2N1bWVudFR5cGUsXG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICBidWlsZGluZ0lkLCBcbiAgICAgICAgICByZXNpZGVuY2VJZCxcbiAgICAgICAgICBoYXNGaWxlOiAhIXJlcS5maWxlLFxuICAgICAgICAgIGhhc1RleHRDb250ZW50OiAhIXRleHRDb250ZW50LFxuICAgICAgICAgIHRleHRDb250ZW50TGVuZ3RoOiB0ZXh0Q29udGVudD8ubGVuZ3RoLFxuICAgICAgICAgIG90aGVyRGF0YUtleXM6IE9iamVjdC5rZXlzKG90aGVyRGF0YSksXG4gICAgICAgICAgY29udGVudFR5cGU6IHJlcS5oZWFkZXJzWydjb250ZW50LXR5cGUnXVxuICAgICAgICB9LFxuICAgICAgICBmaWxlRGV0YWlsczogcmVxLmZpbGUgPyB7XG4gICAgICAgICAgb3JpZ2luYWxuYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgbWltZXR5cGU6IHJlcS5maWxlLm1pbWV0eXBlLFxuICAgICAgICAgIHNpemU6IHJlcS5maWxlLnNpemUsXG4gICAgICAgICAgZW5jb2Rpbmc6IHJlcS5maWxlLmVuY29kaW5nLFxuICAgICAgICAgIGZpZWxkbmFtZTogcmVxLmZpbGUuZmllbGRuYW1lLFxuICAgICAgICAgIHRlbXBQYXRoOiByZXEuZmlsZS5wYXRoXG4gICAgICAgIH0gOiBudWxsXG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgaWYgKHJlcS5maWxlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBGaWxlIGRldGFpbHM6YCwge1xuICAgICAgICAgIG9yaWdpbmFsTmFtZTogcmVxLmZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICAgIG1pbWVUeXBlOiByZXEuZmlsZS5taW1ldHlwZSxcbiAgICAgICAgICBzaXplOiByZXEuZmlsZS5zaXplLFxuICAgICAgICAgIHRlbXBQYXRoOiByZXEuZmlsZS5wYXRoLFxuICAgICAgICAgIGVuY29kaW5nOiByZXEuZmlsZS5lbmNvZGluZ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRW5oYW5jZWQgcmF0ZSBsaW1pdGluZyB3aXRoIGRldGFpbGVkIHRyYWNraW5nXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignUkFURV9MSU1JVF9DSEVDSycsIHtcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgY3VycmVudFVwbG9hZHM6IHVwbG9hZFJhdGVUcmFja2VyLmdldCh1c2VySWQpPy5sZW5ndGggfHwgMCxcbiAgICAgICAgbWF4QWxsb3dlZDogU0VDVVJJVFlfQ09ORklHLk1BWF9GSUxFU19QRVJfVVNFUl9QRVJfSE9VUlxuICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJhdGVMaW1pdENoZWNrID0gY2hlY2tVcGxvYWRSYXRlTGltaXQodXNlcklkKTtcbiAgICAgIGlmICghcmF0ZUxpbWl0Q2hlY2suYWxsb3dlZCkge1xuICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignUkFURV9MSU1JVF9FWENFRURFRCcsIHtcbiAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgZXJyb3I6IHJhdGVMaW1pdENoZWNrLmVycm9yLFxuICAgICAgICAgIGN1cnJlbnRDb3VudDogdXBsb2FkUmF0ZVRyYWNrZXIuZ2V0KHVzZXJJZCk/Lmxlbmd0aCB8fCAwXG4gICAgICAgIH0sICdXQVJOJyk7XG4gICAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ1VQTE9BRF9SQVRFX0xJTUlUX0VYQ0VFREVEJywgdXNlciwgZmFsc2UsIHVuZGVmaW5lZCwgeyBvcGVyYXRpb25JZCwgZXJyb3I6IHJhdGVMaW1pdENoZWNrLmVycm9yIH0pO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MjkpLmpzb24oeyBtZXNzYWdlOiByYXRlTGltaXRDaGVjay5lcnJvciB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ1JBVEVfTElNSVRfUEFTU0VEJywge1xuICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICByZW1haW5pbmdVcGxvYWRzOiBTRUNVUklUWV9DT05GSUcuTUFYX0ZJTEVTX1BFUl9VU0VSX1BFUl9IT1VSIC0gKHVwbG9hZFJhdGVUcmFja2VyLmdldCh1c2VySWQpPy5sZW5ndGggfHwgMClcbiAgICAgIH0sICdERUJVRycpO1xuICAgICAgXG4gICAgICAvLyBFbmhhbmNlZCBwZXJtaXNzaW9uIHZhbGlkYXRpb25cbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdQRVJNSVNTSU9OX0NIRUNLJywge1xuICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICAgIGFsbG93ZWRSb2xlczogWydhZG1pbicsICdtYW5hZ2VyJywgJ3Jlc2lkZW50J10sXG4gICAgICAgIGlzQXV0aG9yaXplZDogWydhZG1pbicsICdtYW5hZ2VyJywgJ3Jlc2lkZW50J10uaW5jbHVkZXModXNlclJvbGUpXG4gICAgICB9LCAnREVCVUcnKTtcbiAgICAgIFxuICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInLCAncmVzaWRlbnQnXS5pbmNsdWRlcyh1c2VyUm9sZSkpIHtcbiAgICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ1BFUk1JU1NJT05fREVOSUVEJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIHVzZXJSb2xlLFxuICAgICAgICAgIHJlcXVpcmVkUm9sZXM6IFsnYWRtaW4nLCAnbWFuYWdlcicsICdyZXNpZGVudCddLFxuICAgICAgICAgIHVzZXJJZFxuICAgICAgICB9LCAnV0FSTicpO1xuICAgICAgICBsb2dTZWN1cml0eUV2ZW50KCdVTkFVVEhPUklaRURfVVBMT0FEX0FUVEVNUFQnLCB1c2VyLCBmYWxzZSwgdW5kZWZpbmVkLCB7IFxuICAgICAgICAgIG9wZXJhdGlvbklkLCBcbiAgICAgICAgICByZXF1aXJlZFJvbGVzOiBbJ2FkbWluJywgJ21hbmFnZXInLCAncmVzaWRlbnQnXSBcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gY3JlYXRlIGRvY3VtZW50cycgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdQRVJNSVNTSU9OX0dSQU5URUQnLCB7XG4gICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgdXNlcklkXG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgLy8gRW5oYW5jZWQgZG9jdW1lbnQgdHlwZSBjbGFzc2lmaWNhdGlvblxuICAgICAgY29uc3QgaXNUZXh0RG9jdW1lbnRSZWNvcmQgPSAhcmVxLmZpbGUgJiYgdGV4dENvbnRlbnQ7XG4gICAgICBjb25zdCBpc0ZpbGVEb2N1bWVudFJlY29yZCA9ICEhcmVxLmZpbGU7XG4gICAgICBjb25zdCBpc01ldGFkYXRhRG9jdW1lbnRSZWNvcmQgPSAhcmVxLmZpbGUgJiYgIXRleHRDb250ZW50ICYmIChvdGhlckRhdGEudGl0bGUgfHwgb3RoZXJEYXRhLm5hbWUpO1xuXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignRE9DVU1FTlRfVFlQRV9DTEFTU0lGSUNBVElPTicsIHtcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uOiB7XG4gICAgICAgICAgaXNUZXh0RG9jdW1lbnQ6IGlzVGV4dERvY3VtZW50UmVjb3JkLFxuICAgICAgICAgIGlzRmlsZURvY3VtZW50OiBpc0ZpbGVEb2N1bWVudFJlY29yZCxcbiAgICAgICAgICBpc01ldGFkYXRhRG9jdW1lbnQ6IGlzTWV0YWRhdGFEb2N1bWVudFJlY29yZFxuICAgICAgICB9LFxuICAgICAgICBhbmFseXNpc0RldGFpbHM6IHtcbiAgICAgICAgICBoYXNGaWxlOiAhIXJlcS5maWxlLFxuICAgICAgICAgIGhhc1RleHRDb250ZW50OiAhIXRleHRDb250ZW50LFxuICAgICAgICAgIHRleHRDb250ZW50TGVuZ3RoOiB0ZXh0Q29udGVudD8ubGVuZ3RoLFxuICAgICAgICAgIGhhc1RpdGxlOiAhIW90aGVyRGF0YS50aXRsZSxcbiAgICAgICAgICBoYXNOYW1lOiAhIW90aGVyRGF0YS5uYW1lLFxuICAgICAgICAgIGZpbGVTaXplOiByZXEuZmlsZT8uc2l6ZSxcbiAgICAgICAgICBmaWxlTmFtZTogcmVxLmZpbGU/Lm9yaWdpbmFsbmFtZVxuICAgICAgICB9XG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgaWYgKCFpc1RleHREb2N1bWVudFJlY29yZCAmJiAhaXNGaWxlRG9jdW1lbnRSZWNvcmQgJiYgIWlzTWV0YWRhdGFEb2N1bWVudFJlY29yZCkge1xuICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignSU5WQUxJRF9ET0NVTUVOVF9SRVFVRVNUJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIHJlYXNvbjogJ05vIGZpbGUsIHRleHQgY29udGVudCwgb3IgbWV0YWRhdGEgcHJvdmlkZWQnLFxuICAgICAgICAgIHByb3ZpZGVkRGF0YToge1xuICAgICAgICAgICAgaGFzRmlsZTogISFyZXEuZmlsZSxcbiAgICAgICAgICAgIGhhc1RleHRDb250ZW50OiAhIXRleHRDb250ZW50LFxuICAgICAgICAgICAgaGFzVGl0bGU6ICEhb3RoZXJEYXRhLnRpdGxlLFxuICAgICAgICAgICAgaGFzTmFtZTogISFvdGhlckRhdGEubmFtZVxuICAgICAgICAgIH1cbiAgICAgICAgfSwgJ0VSUk9SJyk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdFaXRoZXIgYSBmaWxlLCB0ZXh0IGNvbnRlbnQsIG9yIGRvY3VtZW50IHRpdGxlL25hbWUgaXMgcmVxdWlyZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBGb3IgdGV4dCBkb2N1bWVudHMsIGNyZWF0ZSB1bmlmaWVkIGRvY3VtZW50IGRpcmVjdGx5XG4gICAgICBpZiAoaXNUZXh0RG9jdW1lbnRSZWNvcmQpIHtcbiAgICAgICAgLy8gQ3JlYXRlIHRleHQgZG9jdW1lbnQgd2l0aG91dCBmaWxlIHN0b3JhZ2VcbiAgICAgICAgY29uc3QgZG9jdW1lbnREYXRhOiBJbnNlcnREb2N1bWVudCA9IHtcbiAgICAgICAgICBuYW1lOiBvdGhlckRhdGEubmFtZSB8fCAnVW50aXRsZWQgRG9jdW1lbnRSZWNvcmQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBvdGhlckRhdGEuZGVzY3JpcHRpb24gfHwgdGV4dENvbnRlbnQuc3Vic3RyaW5nKDAsIDIwMCkgKyAodGV4dENvbnRlbnQubGVuZ3RoID4gMjAwID8gJy4uLicgOiAnJyksXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudFR5cGUgfHwgJ290aGVyJyxcbiAgICAgICAgICBmaWxlUGF0aDogYHRleHQtZG9jdW1lbnRzLyR7dXNlcklkfS8ke3V1aWR2NCgpfS50eHRgLCAvLyBWaXJ0dWFsIHBhdGggZm9yIHRleHQgZG9jdW1lbnRzXG4gICAgICAgICAgaXNWaXNpYmxlVG9UZW5hbnRzOiBvdGhlckRhdGEuaXNWaXNpYmxlVG9UZW5hbnRzID09PSAndHJ1ZScgfHwgb3RoZXJEYXRhLmlzVmlzaWJsZVRvVGVuYW50cyA9PT0gdHJ1ZSxcbiAgICAgICAgICByZXNpZGVuY2VJZDogcmVzaWRlbmNlSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJ1aWxkaW5nSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdXNlcklkLFxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFBlcm1pc3Npb24gY2hlY2tzXG4gICAgICAgIGlmIChidWlsZGluZ0lkICYmIHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcbiAgICAgICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmcoYnVpbGRpbmdJZCk7XG4gICAgICAgICAgaWYgKCFidWlsZGluZyB8fCBidWlsZGluZy5vcmdhbml6YXRpb25JZCAhPT0gb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIGJ1aWxkaW5nIG91dHNpZGUgeW91ciBvcmdhbml6YXRpb24nIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXNpZGVuY2VJZCAmJiB1c2VyUm9sZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gcmVzaWRlbmNlcy5tYXAoKHVyKSA9PiB1ci5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKCFyZXNpZGVuY2VJZHMuaW5jbHVkZXMocmVzaWRlbmNlSWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGFzc2lnbiBkb2N1bWVudCB0byByZXNpZGVuY2UgeW91IGRvIG5vdCBvd24nIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERldGVybWluZSBkb2N1bWVudCByZWNvcmQgdHlwZSBmb3IgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgICBsZXQgZG9jdW1lbnRSZWNvcmRUeXBlO1xuICAgICAgICBpZiAoYnVpbGRpbmdJZCAmJiAhcmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICBkb2N1bWVudFJlY29yZFR5cGUgPSAnYnVpbGRpbmcnO1xuICAgICAgICB9IGVsc2UgaWYgKHJlc2lkZW5jZUlkICYmICFidWlsZGluZ0lkKSB7XG4gICAgICAgICAgZG9jdW1lbnRSZWNvcmRUeXBlID0gJ3Jlc2lkZW50JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ011c3QgcHJvdmlkZSBlaXRoZXIgYnVpbGRpbmdJZCAoZm9yIGJ1aWxkaW5nIGRvY3VtZW50cykgb3IgcmVzaWRlbmNlSWQgKGZvciByZXNpZGVudCBkb2N1bWVudHMpJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNhdmUgdGV4dCBjb250ZW50IHRvIGxvY2FsIGZpbGUgc3lzdGVtIHdpdGggcHJvcGVyIGRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgICAgbGV0IGZpbGVOYW1lOiBzdHJpbmc7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgdGV4dEZpbGVQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgZG9jdW1lbnRSZWNvcmRUeXBlKTtcbiAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmModGV4dEZpbGVQYXRoKSkge1xuICAgICAgICAgICAgZnMubWtkaXJTeW5jKHRleHRGaWxlUGF0aCwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZpbGVOYW1lID0gYCR7dXVpZHY0KCl9LXRleHQtZG9jdW1lbnQudHh0YDtcbiAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IHBhdGguam9pbih0ZXh0RmlsZVBhdGgsIGZpbGVOYW1lKTtcbiAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZ1bGxQYXRoLCB0ZXh0Q29udGVudCwgJ3V0ZjgnKTtcbiAgICAgICAgfSBjYXRjaCAoZnNFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyB0ZXh0IGRvY3VtZW50IHRvIGZpbGVzeXN0ZW06JywgZnNFcnJvcik7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBzYXZlIHRleHQgZG9jdW1lbnQnIH0pO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgZmlsZSBwYXRoIHRvIG1hdGNoIHJlZ3VsYXIgZG9jdW1lbnQgdXBsb2Fkc1xuICAgICAgICBkb2N1bWVudERhdGEuZmlsZVBhdGggPSBgJHtkb2N1bWVudFJlY29yZFR5cGV9LyR7ZmlsZU5hbWV9YDtcblxuICAgICAgICAvLyBDcmVhdGUgZG9jdW1lbnQgcmVjb3JkIGluIGRhdGFiYXNlXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS5jcmVhdGVEb2N1bWVudChkb2N1bWVudERhdGEpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVGV4dCBkb2N1bWVudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgZG9jdW1lbnQ6IHtcbiAgICAgICAgICAgIC4uLmRvY3VtZW50LFxuICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50Lm5hbWUsIC8vIE1hcCBuYW1lIHRvIHRpdGxlIGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBjYXRlZ29yeTogZG9jdW1lbnQuZG9jdW1lbnRUeXBlLCAvLyBNYXAgZG9jdW1lbnRUeXBlIHRvIGNhdGVnb3J5IGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBkb2N1bWVudENhdGVnb3J5OiBidWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVudCcsXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiBidWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVuY2UnLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGJ1aWxkaW5nSWQgfHwgcmVzaWRlbmNlSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBtZXRhZGF0YS1vbmx5IGRvY3VtZW50cyAoY3JlYXRlIGRvY3VtZW50IHJlY29yZCB3aXRob3V0IGZpbGUpXG4gICAgICBpZiAoaXNNZXRhZGF0YURvY3VtZW50UmVjb3JkKSB7XG4gICAgICAgIC8vIE1hcCBmcm9udGVuZCAndGl0bGUnIGZpZWxkIHRvIGRhdGFiYXNlICduYW1lJyBmaWVsZCBhbmQgJ2NhdGVnb3J5JyB0byAnZG9jdW1lbnRUeXBlJ1xuICAgICAgICBjb25zdCBkb2N1bWVudERhdGE6IEluc2VydERvY3VtZW50ID0ge1xuICAgICAgICAgIG5hbWU6IG90aGVyRGF0YS50aXRsZSB8fCBvdGhlckRhdGEubmFtZSB8fCAnVW50aXRsZWQgRG9jdW1lbnQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBvdGhlckRhdGEuZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBvdGhlckRhdGEuY2F0ZWdvcnkgfHwgZG9jdW1lbnRUeXBlIHx8ICdvdGhlcicsXG4gICAgICAgICAgZmlsZVBhdGg6IGBtZXRhZGF0YS1kb2N1bWVudHMvJHt1c2VySWR9LyR7dXVpZHY0KCl9YCwgLy8gUGxhY2Vob2xkZXIgcGF0aCBmb3IgbWV0YWRhdGEtb25seSBkb2N1bWVudHNcbiAgICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IG90aGVyRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgPT09ICd0cnVlJyB8fCBvdGhlckRhdGEuaXNWaXNpYmxlVG9UZW5hbnRzID09PSB0cnVlIHx8IGZhbHNlLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiByZXNpZGVuY2VJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogYnVpbGRpbmdJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB1c2VySWQsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgYnVpbGRpbmcvcmVzaWRlbmNlIHJlcXVpcmVtZW50XG4gICAgICAgIGlmICghYnVpbGRpbmdJZCAmJiAhcmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ011c3QgcHJvdmlkZSBlaXRoZXIgYnVpbGRpbmdJZCAoZm9yIGJ1aWxkaW5nIGRvY3VtZW50cykgb3IgcmVzaWRlbmNlSWQgKGZvciByZXNpZGVudCBkb2N1bWVudHMpJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChidWlsZGluZ0lkICYmIHJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgcHJvdmlkZSBib3RoIGJ1aWxkaW5nSWQgYW5kIHJlc2lkZW5jZUlkJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBlcm1pc3Npb24gY2hlY2tzXG4gICAgICAgIGlmIChidWlsZGluZ0lkICYmIHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcbiAgICAgICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmcoYnVpbGRpbmdJZCk7XG4gICAgICAgICAgaWYgKCFidWlsZGluZyB8fCBidWlsZGluZy5vcmdhbml6YXRpb25JZCAhPT0gb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIGJ1aWxkaW5nIG91dHNpZGUgeW91ciBvcmdhbml6YXRpb24nIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChyZXNpZGVuY2VJZCAmJiB1c2VyUm9sZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gcmVzaWRlbmNlcy5tYXAoKHVyKSA9PiB1ci5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKCFyZXNpZGVuY2VJZHMuaW5jbHVkZXMocmVzaWRlbmNlSWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGFzc2lnbiBkb2N1bWVudCB0byByZXNpZGVuY2UgeW91IGRvIG5vdCBvd24nIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBkb2N1bWVudCByZWNvcmQgaW4gZGF0YWJhc2VcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZURvY3VtZW50KGRvY3VtZW50RGF0YSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdEb2N1bWVudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgZG9jdW1lbnQ6IHtcbiAgICAgICAgICAgIC4uLmRvY3VtZW50LFxuICAgICAgICAgICAgdGl0bGU6IGRvY3VtZW50Lm5hbWUsIC8vIE1hcCBuYW1lIHRvIHRpdGxlIGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBjYXRlZ29yeTogZG9jdW1lbnQuZG9jdW1lbnRUeXBlLCAvLyBNYXAgZG9jdW1lbnRUeXBlIHRvIGNhdGVnb3J5IGZvciBmcm9udGVuZCBjb21wYXRpYmlsaXR5XG4gICAgICAgICAgICBkb2N1bWVudENhdGVnb3J5OiBidWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVudCcsXG4gICAgICAgICAgICBlbnRpdHlUeXBlOiBidWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVuY2UnLFxuICAgICAgICAgICAgZW50aXR5SWQ6IGJ1aWxkaW5nSWQgfHwgcmVzaWRlbmNlSWQsXG4gICAgICAgICAgICBmaWxlVXJsOiB1bmRlZmluZWQsIC8vIE5vIGZpbGUgVVJMIGZvciBtZXRhZGF0YS1vbmx5IGRvY3VtZW50c1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgZmlsZSB1cGxvYWRzIChleGlzdGluZyBsb2dpYylcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBTdGFydGluZyBmaWxlIGRvY3VtZW50IHByb2Nlc3NpbmdgKTtcbiAgICAgIFxuICAgICAgLy8gRGV0ZXJtaW5lIGRvY3VtZW50IHJlY29yZCB0eXBlIGJhc2VkIG9uIGJ1aWxkaW5nSWQvcmVzaWRlbmNlSWQgKG5vdCBmcm9tIGRvY3VtZW50VHlwZSBmaWVsZClcbiAgICAgIGxldCBmaW5hbERvY3VtZW50UmVjb3JkVHlwZTtcbiAgICAgIGlmIChidWlsZGluZ0lkICYmICFyZXNpZGVuY2VJZCkge1xuICAgICAgICBmaW5hbERvY3VtZW50UmVjb3JkVHlwZSA9ICdidWlsZGluZyc7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBEZXRlcm1pbmVkIGRvY3VtZW50IHR5cGU6IEJVSUxESU5HIChJRDogJHtidWlsZGluZ0lkfSlgKTtcbiAgICAgIH0gZWxzZSBpZiAocmVzaWRlbmNlSWQgJiYgIWJ1aWxkaW5nSWQpIHtcbiAgICAgICAgZmluYWxEb2N1bWVudFJlY29yZFR5cGUgPSAncmVzaWRlbnQnO1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbRE9DVU1FTlRTIFVQTE9BRF0gRGV0ZXJtaW5lZCBkb2N1bWVudCB0eXBlOiBSRVNJREVOQ0UgKElEOiAke3Jlc2lkZW5jZUlkfSlgKTtcbiAgICAgIH0gZWxzZSBpZiAoYnVpbGRpbmdJZCAmJiByZXNpZGVuY2VJZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVFMgVVBMT0FEXSBCb3RoIGJ1aWxkaW5nSWQgYW5kIHJlc2lkZW5jZUlkIHByb3ZpZGVkOiAke2J1aWxkaW5nSWR9LCAke3Jlc2lkZW5jZUlkfWApO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgcHJvdmlkZSBib3RoIGJ1aWxkaW5nSWQgYW5kIHJlc2lkZW5jZUlkJyxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVFMgVVBMT0FEXSBObyBidWlsZGluZ0lkIG9yIHJlc2lkZW5jZUlkIHByb3ZpZGVkYCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTpcbiAgICAgICAgICAgICdNdXN0IHByb3ZpZGUgZWl0aGVyIGJ1aWxkaW5nSWQgKGZvciBidWlsZGluZyBkb2N1bWVudHMpIG9yIHJlc2lkZW5jZUlkIChmb3IgcmVzaWRlbnQgZG9jdW1lbnRzKScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoZmluYWxEb2N1bWVudFJlY29yZFR5cGUgPT09ICdidWlsZGluZycpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gUHJvY2Vzc2luZyBidWlsZGluZyBkb2N1bWVudCBmb3IgYnVpbGRpbmcgSUQ6ICR7YnVpbGRpbmdJZH1gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIGFuZCBjcmVhdGUgYnVpbGRpbmcgZG9jdW1lbnRcbiAgICAgICAgaWYgKCFidWlsZGluZ0lkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKdjCBbQlVJTERJTkcgVVBMT0FEXSBNaXNzaW5nIGJ1aWxkaW5nSWRgKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnYnVpbGRpbmdJZCBpcyByZXF1aXJlZCBmb3IgYnVpbGRpbmcgZG9jdW1lbnRzJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByZXBhcmUgdGhlIHBlcm1hbmVudCBmaWxlIHBhdGggYW5kIG1vdmUgZmlsZSBpZiBuZWVkZWRcbiAgICAgICAgbGV0IGZpbGVQYXRoOiBzdHJpbmc7XG4gICAgICAgIGxldCBmaWxlTmFtZTogc3RyaW5nIHwgdW5kZWZpbmVkO1xuICAgICAgICBcbiAgICAgICAgaWYgKHJlcS5maWxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gUHJvY2Vzc2luZyBmaWxlIHVwbG9hZCBmb3IgYnVpbGRpbmcgJHtidWlsZGluZ0lkfWApO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlbmFtZSBhbmQgbW92ZSB0byBwZXJtYW5lbnQgbG9jYXRpb25cbiAgICAgICAgICBmaWxlTmFtZSA9IGAke3V1aWR2NCgpfS0ke3JlcS5maWxlLm9yaWdpbmFsbmFtZX1gO1xuICAgICAgICAgIGNvbnN0IHBlcm1hbmVudERpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycsICdidWlsZGluZ3MnLCBidWlsZGluZ0lkKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBGaWxlIHBhdGhzOmAsIHtcbiAgICAgICAgICAgIG9yaWdpbmFsTmFtZTogcmVxLmZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICAgICAgbmV3RmlsZU5hbWU6IGZpbGVOYW1lLFxuICAgICAgICAgICAgdGVtcFBhdGg6IHJlcS5maWxlLnBhdGgsXG4gICAgICAgICAgICBwZXJtYW5lbnREaXIsXG4gICAgICAgICAgICBkaXJlY3RvcnlFeGlzdHM6IGZzLmV4aXN0c1N5bmMocGVybWFuZW50RGlyKVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKHBlcm1hbmVudERpcikpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIENyZWF0aW5nIGRpcmVjdG9yeTogJHtwZXJtYW5lbnREaXJ9YCk7XG4gICAgICAgICAgICBmcy5ta2RpclN5bmMocGVybWFuZW50RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gTW92ZSBmaWxlIGZyb20gdGVtcG9yYXJ5IHRvIHBlcm1hbmVudCBsb2NhdGlvbiAoY29weSArIGRlbGV0ZSBmb3IgY3Jvc3MtZmlsZXN5c3RlbSlcbiAgICAgICAgICBjb25zdCBwZXJtYW5lbnRQYXRoID0gcGF0aC5qb2luKHBlcm1hbmVudERpciwgZmlsZU5hbWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIENvcHlpbmcgZmlsZSBmcm9tICR7cmVxLmZpbGUucGF0aH0gdG8gJHtwZXJtYW5lbnRQYXRofWApO1xuICAgICAgICAgIGZzLmNvcHlGaWxlU3luYyhyZXEuZmlsZS5wYXRoLCBwZXJtYW5lbnRQYXRoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBDbGVhbmluZyB1cCB0ZW1wb3JhcnkgZmlsZTogJHtyZXEuZmlsZS5wYXRofWApO1xuICAgICAgICAgIGZzLnVubGlua1N5bmMocmVxLmZpbGUucGF0aCk7IC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlXG4gICAgICAgICAgZmlsZVBhdGggPSBgYnVpbGRpbmdzLyR7YnVpbGRpbmdJZH0vJHtmaWxlTmFtZX1gO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIEZpbGUgc3VjY2Vzc2Z1bGx5IG1vdmVkIHRvOiAke2ZpbGVQYXRofWApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIE5vIGZpbGUgcHJvdmlkZWQsIGNyZWF0aW5nIHBsYWNlaG9sZGVyIHBhdGhgKTtcbiAgICAgICAgICBmaWxlUGF0aCA9IGB0ZW1wLXBhdGgtJHtEYXRlLm5vdygpfWA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRhdGFUb1ZhbGlkYXRlID0ge1xuICAgICAgICAgIC4uLm90aGVyRGF0YSxcbiAgICAgICAgICBidWlsZGluZ0lkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdXNlcklkLFxuICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgIGZpbGVOYW1lLFxuICAgICAgICAgIGZpbGVTaXplOiByZXEuZmlsZT8uc2l6ZSxcbiAgICAgICAgICBtaW1lVHlwZTogcmVxLmZpbGU/Lm1pbWV0eXBlLFxuICAgICAgICAgIGRvY3VtZW50VHlwZTogZG9jdW1lbnRUeXBlIHx8IHR5cGUgfHwgJ290aGVyJywgLy8gRGVmYXVsdCB0byAnb3RoZXInIGlmIG5vdCBwcm92aWRlZFxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gRGF0YSB0byB2YWxpZGF0ZTpgLCB7XG4gICAgICAgICAgYnVpbGRpbmdJZCxcbiAgICAgICAgICB1cGxvYWRlZEJ5SWQ6IHVzZXJJZCxcbiAgICAgICAgICBmaWxlUGF0aCxcbiAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICBmaWxlU2l6ZTogcmVxLmZpbGU/LnNpemUsXG4gICAgICAgICAgbWltZVR5cGU6IHJlcS5maWxlPy5taW1ldHlwZSxcbiAgICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50VHlwZSB8fCB0eXBlIHx8ICdvdGhlcicsXG4gICAgICAgICAgb3RoZXJEYXRhS2V5czogT2JqZWN0LmtleXMob3RoZXJEYXRhKVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGxldCB2YWxpZGF0ZWREYXRhO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhbGlkYXRlZERhdGEgPSBpbnNlcnREb2N1bWVudFNjaGVtYS5wYXJzZShkYXRhVG9WYWxpZGF0ZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBbQlVJTERJTkcgVVBMT0FEXSBEb2N1bWVudCB2YWxpZGF0aW9uIHN1Y2Nlc3NmdWwgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gKTtcbiAgICAgICAgfSBjYXRjaCAodmFsaWRhdGlvbkVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKdjCBbQlVJTERJTkcgVVBMT0FEXSBEb2N1bWVudCB2YWxpZGF0aW9uIGZhaWxlZCBmb3IgYnVpbGRpbmcgJHtidWlsZGluZ0lkfTpgLCB2YWxpZGF0aW9uRXJyb3IpO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZmFpbGVkJywgXG4gICAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbkVycm9yLm1lc3NhZ2UgfHwgJ0ludmFsaWQgZGF0YScsXG4gICAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uRXJyb3IuaXNzdWVzIHx8IHZhbGlkYXRpb25FcnJvclxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGVybWlzc2lvbiBjaGVja3MgZm9yIGJ1aWxkaW5nIGRvY3VtZW50c1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBDaGVja2luZyBwZXJtaXNzaW9ucyBmb3Igcm9sZTogJHt1c2VyUm9sZX1gKTtcbiAgICAgICAgXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gTWFuYWdlciBwZXJtaXNzaW9uIGNoZWNrIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YCk7XG4gICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9ucyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnModXNlcklkKTtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9XG4gICAgICAgICAgICBvcmdhbml6YXRpb25zLmxlbmd0aCA+IDAgPyBvcmdhbml6YXRpb25zWzBdLm9yZ2FuaXphdGlvbklkIDogdW5kZWZpbmVkO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIE1hbmFnZXIgb3JnYW5pemF0aW9uOiAke29yZ2FuaXphdGlvbklkfWApO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZyhidWlsZGluZ0lkKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBCdWlsZGluZyBvcmdhbml6YXRpb246ICR7YnVpbGRpbmc/Lm9yZ2FuaXphdGlvbklkfWApO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmICghYnVpbGRpbmcgfHwgYnVpbGRpbmcub3JnYW5pemF0aW9uSWQgIT09IG9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtCVUlMRElORyBVUExPQURdIE1hbmFnZXIgcGVybWlzc2lvbiBkZW5pZWQgLSBvcmdhbml6YXRpb24gbWlzbWF0Y2hgKTtcbiAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgICAgLnN0YXR1cyg0MDMpXG4gICAgICAgICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhc3NpZ24gZG9jdW1lbnQgdG8gYnVpbGRpbmcgb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgW0JVSUxESU5HIFVQTE9BRF0gTWFuYWdlciBwZXJtaXNzaW9uIGNoZWNrIHBhc3NlZGApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gUmVzaWRlbnQgcGVybWlzc2lvbiBjaGVjayBmb3IgYnVpbGRpbmcgJHtidWlsZGluZ0lkfWApO1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gVXNlciByZXNpZGVuY2VzIGNvdW50OiAke3Jlc2lkZW5jZXMubGVuZ3RofWApO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IGhhc1Jlc2lkZW5jZUluQnVpbGRpbmcgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICAgIHJlc2lkZW5jZXMubWFwKGFzeW5jICh1cikgPT4ge1xuICAgICAgICAgICAgICBjb25zdCByZXNpZGVuY2UgPSBhd2FpdCBzdG9yYWdlLmdldFJlc2lkZW5jZSh1ci5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgICAgIGNvbnN0IGlzSW5CdWlsZGluZyA9IHJlc2lkZW5jZSAmJiByZXNpZGVuY2UuYnVpbGRpbmdJZCA9PT0gYnVpbGRpbmdJZDtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gUmVzaWRlbmNlICR7dXIucmVzaWRlbmNlSWR9IGluIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH06ICR7aXNJbkJ1aWxkaW5nfWApO1xuICAgICAgICAgICAgICByZXR1cm4gaXNJbkJ1aWxkaW5nO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgaWYgKCFoYXNSZXNpZGVuY2VJbkJ1aWxkaW5nLnNvbWUoQm9vbGVhbikpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0JVSUxESU5HIFVQTE9BRF0gUmVzaWRlbnQgcGVybWlzc2lvbiBkZW5pZWQgLSBubyByZXNpZGVuY2UgaW4gYnVpbGRpbmdgKTtcbiAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgICAgLnN0YXR1cyg0MDMpXG4gICAgICAgICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhc3NpZ24gZG9jdW1lbnQgdG8gYnVpbGRpbmcgd2hlcmUgeW91IGhhdmUgbm8gcmVzaWRlbmNlJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBbQlVJTERJTkcgVVBMT0FEXSBSZXNpZGVudCBwZXJtaXNzaW9uIGNoZWNrIHBhc3NlZGApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIHVuaWZpZWQgZG9jdW1lbnQgaW5zdGVhZCBvZiBzZXBhcmF0ZSBidWlsZGluZyBkb2N1bWVudFxuICAgICAgICBjb25zdCB1bmlmaWVkRG9jdW1lbnQ6IEluc2VydERvY3VtZW50ID0ge1xuICAgICAgICAgIG5hbWU6IHZhbGlkYXRlZERhdGEubmFtZSB8fCAnVW50aXRsZWQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiB2YWxpZGF0ZWREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGRvY3VtZW50VHlwZTogdmFsaWRhdGVkRGF0YS5kb2N1bWVudFR5cGUsXG4gICAgICAgICAgZmlsZVBhdGg6IHZhbGlkYXRlZERhdGEuZmlsZVBhdGggfHwgYHRlbXAtcGF0aC0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IHZhbGlkYXRlZERhdGEuaXNWaXNpYmxlVG9UZW5hbnRzIHx8IGZhbHNlLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiB1bmRlZmluZWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogdmFsaWRhdGVkRGF0YS5idWlsZGluZ0lkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdmFsaWRhdGVkRGF0YS51cGxvYWRlZEJ5SWQsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gQ3JlYXRpbmcgZG9jdW1lbnQgaW4gZGF0YWJhc2U6YCwge1xuICAgICAgICAgIG5hbWU6IHVuaWZpZWREb2N1bWVudC5uYW1lLFxuICAgICAgICAgIGRvY3VtZW50VHlwZTogdW5pZmllZERvY3VtZW50LmRvY3VtZW50VHlwZSxcbiAgICAgICAgICBmaWxlUGF0aDogdW5pZmllZERvY3VtZW50LmZpbGVQYXRoLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IHVuaWZpZWREb2N1bWVudC5idWlsZGluZ0lkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdW5pZmllZERvY3VtZW50LnVwbG9hZGVkQnlJZFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlRG9jdW1lbnQodW5pZmllZERvY3VtZW50KTtcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBbQlVJTERJTkcgVVBMT0FEXSBEb2N1bWVudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseSB3aXRoIElEOiAke2RvY3VtZW50LmlkfWApO1xuXG4gICAgICAgIC8vIEZpbGUgaGFzIGJlZW4gbW92ZWQgdG8gcGVybWFuZW50IGxvY2F0aW9uLCBubyBjbGVhbnVwIG5lZWRlZFxuXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgICAuLi5kb2N1bWVudCxcbiAgICAgICAgICBkb2N1bWVudENhdGVnb3J5OiAnYnVpbGRpbmcnLFxuICAgICAgICAgIGVudGl0eVR5cGU6ICdidWlsZGluZycsXG4gICAgICAgICAgZW50aXR5SWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIGlmIChmaW5hbERvY3VtZW50UmVjb3JkVHlwZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gUHJvY2Vzc2luZyByZXNpZGVuY2UgZG9jdW1lbnQgZm9yIHJlc2lkZW5jZSBJRDogJHtyZXNpZGVuY2VJZH1gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIGFuZCBjcmVhdGUgcmVzaWRlbnQgZG9jdW1lbnRcbiAgICAgICAgaWYgKCFyZXNpZGVuY2VJZCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDinYwgW1JFU0lERU5DRSBVUExPQURdIE1pc3NpbmcgcmVzaWRlbmNlSWRgKTtcbiAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ3Jlc2lkZW5jZUlkIGlzIHJlcXVpcmVkIGZvciByZXNpZGVudCBkb2N1bWVudHMnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgcGVybWFuZW50IGZpbGUgcGF0aCBhbmQgbW92ZSBmaWxlIGlmIG5lZWRlZFxuICAgICAgICBsZXQgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgICAgbGV0IGZpbGVOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVxLmZpbGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gUHJvY2Vzc2luZyBmaWxlIHVwbG9hZCBmb3IgcmVzaWRlbmNlICR7cmVzaWRlbmNlSWR9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIGFuZCBtb3ZlIHRvIHBlcm1hbmVudCBsb2NhdGlvblxuICAgICAgICAgIGZpbGVOYW1lID0gYCR7dXVpZHY0KCl9LSR7cmVxLmZpbGUub3JpZ2luYWxuYW1lfWA7XG4gICAgICAgICAgY29uc3QgcGVybWFuZW50RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgJ3Jlc2lkZW5jZXMnLCByZXNpZGVuY2VJZCk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6AgW1JFU0lERU5DRSBVUExPQURdIEZpbGUgcGF0aHM6YCwge1xuICAgICAgICAgICAgb3JpZ2luYWxOYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgICBuZXdGaWxlTmFtZTogZmlsZU5hbWUsXG4gICAgICAgICAgICB0ZW1wUGF0aDogcmVxLmZpbGUucGF0aCxcbiAgICAgICAgICAgIHBlcm1hbmVudERpcixcbiAgICAgICAgICAgIGRpcmVjdG9yeUV4aXN0czogZnMuZXhpc3RzU3luYyhwZXJtYW5lbnREaXIpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHNcbiAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMocGVybWFuZW50RGlyKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfj6AgW1JFU0lERU5DRSBVUExPQURdIENyZWF0aW5nIGRpcmVjdG9yeTogJHtwZXJtYW5lbnREaXJ9YCk7XG4gICAgICAgICAgICBmcy5ta2RpclN5bmMocGVybWFuZW50RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gTW92ZSBmaWxlIGZyb20gdGVtcG9yYXJ5IHRvIHBlcm1hbmVudCBsb2NhdGlvbiAoY29weSArIGRlbGV0ZSBmb3IgY3Jvc3MtZmlsZXN5c3RlbSlcbiAgICAgICAgICBjb25zdCBwZXJtYW5lbnRQYXRoID0gcGF0aC5qb2luKHBlcm1hbmVudERpciwgZmlsZU5hbWUpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+gIFtSRVNJREVOQ0UgVVBMT0FEXSBDb3B5aW5nIGZpbGUgZnJvbSAke3JlcS5maWxlLnBhdGh9IHRvICR7cGVybWFuZW50UGF0aH1gKTtcbiAgICAgICAgICBmcy5jb3B5RmlsZVN5bmMocmVxLmZpbGUucGF0aCwgcGVybWFuZW50UGF0aCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6AgW1JFU0lERU5DRSBVUExPQURdIENsZWFuaW5nIHVwIHRlbXBvcmFyeSBmaWxlOiAke3JlcS5maWxlLnBhdGh9YCk7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTsgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGVcbiAgICAgICAgICBmaWxlUGF0aCA9IGByZXNpZGVuY2VzLyR7cmVzaWRlbmNlSWR9LyR7ZmlsZU5hbWV9YDtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gRmlsZSBzdWNjZXNzZnVsbHkgbW92ZWQgdG86ICR7ZmlsZVBhdGh9YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6AgW1JFU0lERU5DRSBVUExPQURdIE5vIGZpbGUgcHJvdmlkZWQsIGNyZWF0aW5nIHBsYWNlaG9sZGVyIHBhdGhgKTtcbiAgICAgICAgICBmaWxlUGF0aCA9IGB0ZW1wLXBhdGgtJHtEYXRlLm5vdygpfWA7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkYXRhVG9WYWxpZGF0ZSA9IHtcbiAgICAgICAgICAuLi5vdGhlckRhdGEsXG4gICAgICAgICAgcmVzaWRlbmNlSWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB1c2VySWQsXG4gICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgZmlsZU5hbWUsXG4gICAgICAgICAgZmlsZVNpemU6IHJlcS5maWxlPy5zaXplLFxuICAgICAgICAgIG1pbWVUeXBlOiByZXEuZmlsZT8ubWltZXR5cGUsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudFR5cGUgfHwgdHlwZSB8fCAnb3RoZXInLCAvLyBEZWZhdWx0IHRvICdvdGhlcicgaWYgbm90IHByb3ZpZGVkXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBSZXNpZGVuY2UgZG9jdW1lbnQgdmFsaWRhdGlvbiBkZWJ1ZzonLCB7XG4gICAgICAgICAgZGF0YVRvVmFsaWRhdGUsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlLFxuICAgICAgICAgIG90aGVyRGF0YUtleXM6IE9iamVjdC5rZXlzKG90aGVyRGF0YSksXG4gICAgICAgICAgaGFzRmlsZTogISFyZXEuZmlsZVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGxldCB2YWxpZGF0ZWREYXRhO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHZhbGlkYXRlZERhdGEgPSBpbnNlcnREb2N1bWVudFNjaGVtYS5wYXJzZShkYXRhVG9WYWxpZGF0ZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBSZXNpZGVuY2UgZG9jdW1lbnQgdmFsaWRhdGlvbiBTVUNDRVNTJyk7XG4gICAgICAgIH0gY2F0Y2ggKHZhbGlkYXRpb25FcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfinYwgUmVzaWRlbmNlIGRvY3VtZW50IHZhbGlkYXRpb24gRVJST1I6JywgdmFsaWRhdGlvbkVycm9yKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGZhaWxlZCcsIFxuICAgICAgICAgICAgZXJyb3I6IHZhbGlkYXRpb25FcnJvci5tZXNzYWdlIHx8ICdJbnZhbGlkIGRhdGEnLFxuICAgICAgICAgICAgZGV0YWlsczogdmFsaWRhdGlvbkVycm9yLmlzc3VlcyB8fCB2YWxpZGF0aW9uRXJyb3JcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFBlcm1pc3Npb24gY2hlY2tzIGZvciByZXNpZGVudCBkb2N1bWVudHNcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID1cbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbnMubGVuZ3RoID4gMCA/IG9yZ2FuaXphdGlvbnNbMF0ub3JnYW5pemF0aW9uSWQgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlID0gYXdhaXQgc3RvcmFnZS5nZXRSZXNpZGVuY2UocmVzaWRlbmNlSWQpO1xuICAgICAgICAgIGlmIChyZXNpZGVuY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZyhyZXNpZGVuY2UuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgICBpZiAoIWJ1aWxkaW5nIHx8IGJ1aWxkaW5nLm9yZ2FuaXphdGlvbklkICE9PSBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICAgICAgLnN0YXR1cyg0MDMpXG4gICAgICAgICAgICAgICAgLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGFzc2lnbiBkb2N1bWVudCB0byByZXNpZGVuY2Ugb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbicgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdSZXNpZGVuY2Ugbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdyZXNpZGVudCcpIHtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2VzID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyUmVzaWRlbmNlcyh1c2VySWQpO1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZUlkcyA9IHJlc2lkZW5jZXMubWFwKCh1cikgPT4gdXIucmVzaWRlbmNlSWQpO1xuXG4gICAgICAgICAgaWYgKCFyZXNpZGVuY2VJZHMuaW5jbHVkZXMocmVzaWRlbmNlSWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICAgIC5zdGF0dXMoNDAzKVxuICAgICAgICAgICAgICAuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIHJlc2lkZW5jZSB5b3UgZG8gbm90IG93bicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29udmVydCB0byB1bmlmaWVkIGRvY3VtZW50IGZvcm1hdFxuICAgICAgICBjb25zdCB1bmlmaWVkRG9jdW1lbnQ6IEluc2VydERvY3VtZW50ID0ge1xuICAgICAgICAgIG5hbWU6IHZhbGlkYXRlZERhdGEubmFtZSB8fCAnVW50aXRsZWQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiB2YWxpZGF0ZWREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGRvY3VtZW50VHlwZTogdmFsaWRhdGVkRGF0YS5kb2N1bWVudFR5cGUsXG4gICAgICAgICAgZmlsZVBhdGg6IHZhbGlkYXRlZERhdGEuZmlsZVBhdGggfHwgYHRlbXAtcGF0aC0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IHZhbGlkYXRlZERhdGEuaXNWaXNpYmxlVG9UZW5hbnRzIHx8IGZhbHNlLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiB2YWxpZGF0ZWREYXRhLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICB1cGxvYWRlZEJ5SWQ6IHZhbGlkYXRlZERhdGEudXBsb2FkZWRCeUlkLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS5jcmVhdGVEb2N1bWVudCh1bmlmaWVkRG9jdW1lbnQpIDtcblxuICAgICAgICBjb25zb2xlLmxvZygn8J+TnSBDcmVhdGVkIHJlc2lkZW50IGRvY3VtZW50OicsIGRvY3VtZW50KTtcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk50gRG9jdW1lbnRSZWNvcmQgSUQ6JywgZG9jdW1lbnQuaWQpO1xuXG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgICAgIC4uLmRvY3VtZW50LFxuICAgICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6ICdyZXNpZGVudCcsXG4gICAgICAgICAgZW50aXR5VHlwZTogJ3Jlc2lkZW5jZScsXG4gICAgICAgICAgZW50aXR5SWQ6IGRvY3VtZW50LnJlc2lkZW5jZUlkLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5OkIFNlbmRpbmcgcmVzcG9uc2U6JywgcmVzcG9uc2UpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihyZXNwb25zZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGRvY3VtZW50VHlwZS4gTXVzdCBiZSBlaXRoZXIgXFxcImJ1aWxkaW5nXFxcIiBvciBcXFwicmVzaWRlbnRcXFwiJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlIG9uIGVycm9yXG4gICAgICBpZiAocmVxLmZpbGU/LnBhdGgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBGYWlsZWQgdG8gY2xlYW51cCB0ZW1wb3JhcnkgZmlsZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBkb2N1bWVudDonLCBfZXJyb3IpO1xuICAgICAgXG4gICAgICBpZiAoX2Vycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGRvY3VtZW50IGRhdGEnLFxuICAgICAgICAgIGVycm9yczogX2Vycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgZG9jdW1lbnQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gVXBkYXRlIGEgZG9jdW1lbnRcbiAgYXBwLnB1dCgnL2FwaS9kb2N1bWVudHMvOmlkJywgcmVxdWlyZUF1dGgsIHVwbG9hZC5zaW5nbGUoJ2ZpbGUnKSwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBTdGFydGluZyB1cGRhdGUgZm9yIGRvY3VtZW50IElEOiAke3JlcS5wYXJhbXMuaWR9YCk7XG4gICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gVXNlcjogJHtyZXEudXNlci5pZH0gKCR7cmVxLnVzZXIucm9sZX0pYCk7XG4gICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gQm9keTpgLCByZXEuYm9keSk7XG4gICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gRmlsZSBwcm92aWRlZDpgLCAhIXJlcS5maWxlKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IHJlcS5wYXJhbXMuaWQ7XG5cbiAgICAgIC8vIEdldCBleGlzdGluZyBkb2N1bWVudCBmaXJzdCB0byBjaGVjayBwZXJtaXNzaW9ucyBhbmQgZ2V0IGN1cnJlbnQgZmlsZSBwYXRoXG4gICAgICBjb25zdCBleGlzdGluZ0RvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS5nZXREb2N1bWVudHMoKS50aGVuKGRvY3MgPT4gZG9jcy5maW5kKGRvYyA9PiBkb2MuaWQgPT09IGRvY3VtZW50SWQpKTtcbiAgICAgIFxuICAgICAgaWYgKCFleGlzdGluZ0RvY3VtZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIFVQREFURV0gRG9jdW1lbnQgbm90IGZvdW5kOiAke2RvY3VtZW50SWR9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBFeGlzdGluZyBkb2N1bWVudDpgLCB7XG4gICAgICAgIGlkOiBleGlzdGluZ0RvY3VtZW50LmlkLFxuICAgICAgICBuYW1lOiBleGlzdGluZ0RvY3VtZW50Lm5hbWUsXG4gICAgICAgIGZpbGVQYXRoOiBleGlzdGluZ0RvY3VtZW50LmZpbGVQYXRoLFxuICAgICAgICBidWlsZGluZ0lkOiBleGlzdGluZ0RvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkOiBleGlzdGluZ0RvY3VtZW50LnJlc2lkZW5jZUlkXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2hlY2sgcGVybWlzc2lvbnMgKHNpbWlsYXIgdG8gdmlldyBwZXJtaXNzaW9ucylcbiAgICAgIGxldCBoYXNBY2Nlc3MgPSBmYWxzZTtcbiAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtET0NVTUVOVCBVUERBVEVdIEFkbWluIGFjY2VzcyBncmFudGVkYCk7XG4gICAgICB9IGVsc2UgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgLy8gTWFuYWdlciBzaG91bGQgaGF2ZSBhY2Nlc3MgdG8gZG9jdW1lbnRzIGluIHRoZWlyIG9yZ2FuaXphdGlvblxuICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgICBjb25zdCBidWlsZGluZ3MgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5ncygpO1xuICAgICAgICBjb25zdCB1c2VyT3JnYW5pemF0aW9ucyA9IG9yZ2FuaXphdGlvbnMubWFwKG9yZyA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuICAgICAgICBcbiAgICAgICAgaWYgKGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCkge1xuICAgICAgICAgIGNvbnN0IG9yZ0J1aWxkaW5ncyA9IGJ1aWxkaW5ncy5maWx0ZXIoYnVpbGRpbmcgPT4gXG4gICAgICAgICAgICB1c2VyT3JnYW5pemF0aW9ucy5pbmNsdWRlcyhidWlsZGluZy5vcmdhbml6YXRpb25JZCB8fCAnJylcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IG9yZ0J1aWxkaW5nSWRzID0gb3JnQnVpbGRpbmdzLm1hcChiID0+IGIuaWQpO1xuICAgICAgICAgIGhhc0FjY2VzcyA9IG9yZ0J1aWxkaW5nSWRzLmluY2x1ZGVzKGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gTWFuYWdlciBhY2Nlc3M6ICR7aGFzQWNjZXNzfWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWhhc0FjY2Vzcykge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVCBVUERBVEVdIEFjY2VzcyBkZW5pZWQgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJlcGFyZSB1cGRhdGUgZGF0YVxuICAgICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge307XG4gICAgICBcbiAgICAgIGlmIChyZXEuYm9keS5uYW1lKSB1cGRhdGVEYXRhLm5hbWUgPSByZXEuYm9keS5uYW1lO1xuICAgICAgaWYgKHJlcS5ib2R5LmRlc2NyaXB0aW9uICE9PSB1bmRlZmluZWQpIHVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSByZXEuYm9keS5kZXNjcmlwdGlvbjtcbiAgICAgIGlmIChyZXEuYm9keS5kb2N1bWVudFR5cGUpIHVwZGF0ZURhdGEuZG9jdW1lbnRUeXBlID0gcmVxLmJvZHkuZG9jdW1lbnRUeXBlO1xuICAgICAgaWYgKHJlcS5ib2R5LmlzVmlzaWJsZVRvVGVuYW50cyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuaXNWaXNpYmxlVG9UZW5hbnRzID0gcmVxLmJvZHkuaXNWaXNpYmxlVG9UZW5hbnRzID09PSAndHJ1ZSc7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn5OdIFtET0NVTUVOVCBVUERBVEVdIFVwZGF0ZSBkYXRhOmAsIHVwZGF0ZURhdGEpO1xuXG4gICAgICAvLyBIYW5kbGUgZmlsZSByZXBsYWNlbWVudCBpZiBwcm92aWRlZFxuICAgICAgaWYgKHJlcS5maWxlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OdIFtET0NVTUVOVCBVUERBVEVdIFByb2Nlc3NpbmcgZmlsZSByZXBsYWNlbWVudDpgLCB7XG4gICAgICAgICAgb3JpZ2luYWxuYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgc2l6ZTogcmVxLmZpbGUuc2l6ZSxcbiAgICAgICAgICBtaW1ldHlwZTogcmVxLmZpbGUubWltZXR5cGUsXG4gICAgICAgICAgdGVtcFBhdGg6IHJlcS5maWxlLnBhdGhcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgdGhlIGZpbGVcbiAgICAgICAgY29uc3QgZmlsZVZhbGlkYXRpb24gPSB2YWxpZGF0ZUZpbGUocmVxLmZpbGUpO1xuICAgICAgICBpZiAoIWZpbGVWYWxpZGF0aW9uLmlzVmFsaWQpIHtcbiAgICAgICAgICAvLyBDbGVhbiB1cCB0ZW1wIGZpbGVcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBjbGVhbnVwIHRlbXAgZmlsZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiBmaWxlVmFsaWRhdGlvbi5lcnJvciB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyYXRlIHVuaXF1ZSBmaWxlIHBhdGhcbiAgICAgICAgY29uc3QgZmlsZUV4dGVuc2lvbiA9IHBhdGguZXh0bmFtZShyZXEuZmlsZS5vcmlnaW5hbG5hbWUpO1xuICAgICAgICBjb25zdCBiYXNlRmlsZU5hbWUgPSBwYXRoLmJhc2VuYW1lKHJlcS5maWxlLm9yaWdpbmFsbmFtZSwgZmlsZUV4dGVuc2lvbik7XG4gICAgICAgIGNvbnN0IHVuaXF1ZUlkID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDE2KS50b1N0cmluZygnaGV4Jyk7XG4gICAgICAgIGNvbnN0IGVudGl0eVR5cGUgPSBleGlzdGluZ0RvY3VtZW50LmJ1aWxkaW5nSWQgPyAnYnVpbGRpbmdzJyA6ICdyZXNpZGVuY2VzJztcbiAgICAgICAgY29uc3QgZW50aXR5SWQgPSBleGlzdGluZ0RvY3VtZW50LmJ1aWxkaW5nSWQgfHwgZXhpc3RpbmdEb2N1bWVudC5yZXNpZGVuY2VJZDtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGRvY3VtZW50c0RpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycsIGVudGl0eVR5cGUsIGVudGl0eUlkIHx8ICdnZW5lcmFsJyk7XG4gICAgICAgIGNvbnN0IHVuaXF1ZUZpbGVOYW1lID0gYCR7dW5pcXVlSWR9LSR7YmFzZUZpbGVOYW1lfSR7ZmlsZUV4dGVuc2lvbn1gO1xuICAgICAgICBjb25zdCBmaW5hbFBhdGggPSBwYXRoLmpvaW4oZG9jdW1lbnRzRGlyLCB1bmlxdWVGaWxlTmFtZSk7XG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGguam9pbihlbnRpdHlUeXBlLCBlbnRpdHlJZCB8fCAnZ2VuZXJhbCcsIHVuaXF1ZUZpbGVOYW1lKTtcblxuICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZG9jdW1lbnRzRGlyKSkge1xuICAgICAgICAgIGZzLm1rZGlyU3luYyhkb2N1bWVudHNEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gTW92ZSBmaWxlIGZyb20gdGVtcCB0byBmaW5hbCBsb2NhdGlvblxuICAgICAgICBmcy5yZW5hbWVTeW5jKHJlcS5maWxlLnBhdGgsIGZpbmFsUGF0aCk7XG4gICAgICAgIFxuICAgICAgICAvLyBVcGRhdGUgZmlsZS1yZWxhdGVkIGZpZWxkc1xuICAgICAgICB1cGRhdGVEYXRhLmZpbGVQYXRoID0gcmVsYXRpdmVQYXRoO1xuICAgICAgICB1cGRhdGVEYXRhLmZpbGVOYW1lID0gcmVxLmZpbGUub3JpZ2luYWxuYW1lO1xuICAgICAgICB1cGRhdGVEYXRhLmZpbGVTaXplID0gcmVxLmZpbGUuc2l6ZTtcbiAgICAgICAgdXBkYXRlRGF0YS5taW1lVHlwZSA9IHJlcS5maWxlLm1pbWV0eXBlO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgW0RPQ1VNRU5UIFVQREFURV0gRmlsZSBzdG9yZWQgYXQ6ICR7ZmluYWxQYXRofWApO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIG9sZCBmaWxlIGlmIGl0IGV4aXN0c1xuICAgICAgICBpZiAoZXhpc3RpbmdEb2N1bWVudC5maWxlUGF0aCkge1xuICAgICAgICAgIGNvbnN0IG9sZEZpbGVQYXRoID0gcGF0aC5pc0Fic29sdXRlKGV4aXN0aW5nRG9jdW1lbnQuZmlsZVBhdGgpIFxuICAgICAgICAgICAgPyBleGlzdGluZ0RvY3VtZW50LmZpbGVQYXRoIFxuICAgICAgICAgICAgOiBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnLCBleGlzdGluZ0RvY3VtZW50LmZpbGVQYXRoKTtcbiAgICAgICAgICBcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMob2xkRmlsZVBhdGgpKSB7XG4gICAgICAgICAgICAgIGZzLnVubGlua1N5bmMob2xkRmlsZVBhdGgpO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+Xke+4jyBbRE9DVU1FTlQgVVBEQVRFXSBDbGVhbmVkIHVwIG9sZCBmaWxlOiAke29sZEZpbGVQYXRofWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRmFpbGVkIHRvIGNsZWFudXAgb2xkIGZpbGU6JywgY2xlYW51cEVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIHRoZSBkb2N1bWVudFxuICAgICAgY29uc3QgdXBkYXRlZERvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS51cGRhdGVEb2N1bWVudChkb2N1bWVudElkLCB1cGRhdGVEYXRhKTtcblxuICAgICAgaWYgKCF1cGRhdGVkRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlQgVVBEQVRFXSBGYWlsZWQgdG8gdXBkYXRlIGRvY3VtZW50OiAke2RvY3VtZW50SWR9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIGRvY3VtZW50JyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlQgVVBEQVRFXSBEb2N1bWVudCB1cGRhdGVkIHN1Y2Nlc3NmdWxseTpgLCB7XG4gICAgICAgIGlkOiAodXBkYXRlZERvY3VtZW50IGFzIGFueSkuaWQsXG4gICAgICAgIG5hbWU6ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5uYW1lXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRkIGNvbXBhdGliaWxpdHkgZmllbGRzIGZvciBmcm9udGVuZFxuICAgICAgKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLmRvY3VtZW50Q2F0ZWdvcnkgPSAodXBkYXRlZERvY3VtZW50IGFzIGFueSkuYnVpbGRpbmdJZCA/ICdidWlsZGluZycgOiAncmVzaWRlbnQnO1xuICAgICAgKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLmVudGl0eVR5cGUgPSAodXBkYXRlZERvY3VtZW50IGFzIGFueSkuYnVpbGRpbmdJZCA/ICdidWlsZGluZycgOiAncmVzaWRlbmNlJztcbiAgICAgICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5lbnRpdHlJZCA9ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5idWlsZGluZ0lkIHx8ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5yZXNpZGVuY2VJZDtcblxuICAgICAgcmVzLmpzb24odXBkYXRlZERvY3VtZW50KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGUgb24gZXJyb3JcbiAgICAgIGlmIChyZXEuZmlsZT8ucGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGZzLnVubGlua1N5bmMocmVxLmZpbGUucGF0aCk7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfl5HvuI8gW0RPQ1VNRU5UIFVQREFURV0gQ2xlYW5lZCB1cCB0ZW1wIGZpbGUgb24gZXJyb3I6ICR7cmVxLmZpbGUucGF0aH1gKTtcbiAgICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRmFpbGVkIHRvIGNsZWFudXAgdGVtcG9yYXJ5IGZpbGU6JywgY2xlYW51cEVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgZG9jdW1lbnQ6JywgX2Vycm9yKTtcbiAgICAgIFxuICAgICAgaWYgKF9lcnJvciBpbnN0YW5jZW9mIHouWm9kRXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBkb2N1bWVudCBkYXRhJyxcbiAgICAgICAgICBlcnJvcnM6IF9lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIGRvY3VtZW50JyB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFNlY3VyaXR5IGF1ZGl0IGVuZHBvaW50IC0gYWRtaW4gb25seVxuICBhcHAuZ2V0KCcvYXBpL2RvY3VtZW50cy9zZWN1cml0eS9hdWRpdC1sb2cnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgXG4gICAgICAvLyBPbmx5IGFkbWlucyBjYW4gYWNjZXNzIGF1ZGl0IGxvZ3NcbiAgICAgIGlmICh1c2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgbG9nU2VjdXJpdHlFdmVudCgnVU5BVVRIT1JJWkVEX0FVRElUX0FDQ0VTUycsIHVzZXIsIGZhbHNlKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQuIEFkbWluIHByaXZpbGVnZXMgcmVxdWlyZWQuJyB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gR2V0IGxhc3QgMTAwIGF1ZGl0IGV2ZW50cyB3aXRoIHBhZ2luYXRpb24gc3VwcG9ydFxuICAgICAgY29uc3QgbGltaXQgPSBNYXRoLm1pbihwYXJzZUludChyZXEucXVlcnkubGltaXQgYXMgc3RyaW5nKSB8fCA1MCwgMTAwKTtcbiAgICAgIGNvbnN0IG9mZnNldCA9IHBhcnNlSW50KHJlcS5xdWVyeS5vZmZzZXQgYXMgc3RyaW5nKSB8fCAwO1xuICAgICAgXG4gICAgICBjb25zdCBwYWdpbmF0ZWRMb2dzID0gYXVkaXRMb2cuc2xpY2Uob2Zmc2V0LCBvZmZzZXQgKyBsaW1pdCk7XG4gICAgICBcbiAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ0FVRElUX0xPR19BQ0NFU1MnLCB1c2VyLCB0cnVlLCB1bmRlZmluZWQsIHsgbGltaXQsIG9mZnNldCB9KTtcbiAgICAgIFxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBldmVudHM6IHBhZ2luYXRlZExvZ3MsXG4gICAgICAgIHRvdGFsOiBhdWRpdExvZy5sZW5ndGgsXG4gICAgICAgIGxpbWl0LFxuICAgICAgICBvZmZzZXRcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFjY2Vzc2luZyBhdWRpdCBsb2c6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHJldHJpZXZlIGF1ZGl0IGxvZycgfSk7XG4gICAgfVxuICB9KTtcbiAgXG4gIC8vIERlbGV0ZSBkb2N1bWVudCB3aXRoIGVuaGFuY2VkIHNlY3VyaXR5IGxvZ2dpbmdcbiAgYXBwLmRlbGV0ZSgnL2FwaS9kb2N1bWVudHMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIGNvbnN0IGRvY3VtZW50SWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgZG9jdW1lbnRUeXBlID0gcmVxLnF1ZXJ5LnR5cGUgYXMgc3RyaW5nOyAvLyBPcHRpb25hbCB0eXBlIGhpbnRcblxuICAgICAgLy8gR2V0IHVzZXIncyBvcmdhbml6YXRpb24gZm9yIHBlcm1pc3Npb24gY2hlY2tpbmdcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IG9yZ2FuaXphdGlvbnMubGVuZ3RoID4gMCA/IG9yZ2FuaXphdGlvbnNbMF0ub3JnYW5pemF0aW9uSWQgOiB1bmRlZmluZWQ7XG5cbiAgICAgIC8vIFVzZSB1bmlmaWVkIGRvY3VtZW50cyBzeXN0ZW0gZm9yIGRlbGV0aW9uXG4gICAgICBsZXQgZGVsZXRlZCA9IGZhbHNlO1xuXG4gICAgICB0cnkge1xuICAgICAgICBkZWxldGVkID0gYXdhaXQgc3RvcmFnZS5kZWxldGVEb2N1bWVudChkb2N1bWVudElkKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJyb3IgZGVsZXRpbmcgZG9jdW1lbnQ6JywgZSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghZGVsZXRlZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnRG9jdW1lbnRSZWNvcmQgbm90IGZvdW5kIG9yIGFjY2VzcyBkZW5pZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuc3RhdHVzKDIwNCkuc2VuZCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBkb2N1bWVudCBkZWxldGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIGRvY3VtZW50JyB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFVwbG9hZCBlbmRwb2ludCB0aGF0IG1hdGNoZXMgZnJvbnRlbmQgZXhwZWN0YXRpb246IC9hcGkvZG9jdW1lbnRzLzppZC91cGxvYWRcbiAgYXBwLnBvc3QoXG4gICAgJy9hcGkvZG9jdW1lbnRzLzppZC91cGxvYWQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHVwbG9hZC5zaW5nbGUoJ2ZpbGUnKSxcbiAgICBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgICBjb25zdCB1c2VyUm9sZSA9IHVzZXIucm9sZTtcbiAgICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IHJlcS5wYXJhbXMuaWQ7IC8vIFRoZSA6aWQgaW4gdGhlIFVSTCBpcyB0aGUgZG9jdW1lbnQgSUQgKGZyb20gZnJvbnRlbmQpXG4gICAgICAgIGNvbnN0IHsgZG9jdW1lbnRUeXBlID0gJ3Jlc2lkZW50JywgcmVzaWRlbmNlSWQsIC4uLm90aGVyRGF0YSB9ID0gcmVxLmJvZHk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk6QgVXBsb2FkIHJlcXVlc3QgcmVjZWl2ZWQ6Jywge1xuICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHVzZXJSb2xlLFxuICAgICAgICAgIGhhc0ZpbGU6ICEhcmVxLmZpbGUsXG4gICAgICAgICAgZmlsZUluZm86IHJlcS5maWxlXG4gICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICBmaWVsZG5hbWU6IHJlcS5maWxlLmZpZWxkbmFtZSxcbiAgICAgICAgICAgICAgICBvcmlnaW5hbG5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICAgICAgICBlbmNvZGluZzogcmVxLmZpbGUuZW5jb2RpbmcsXG4gICAgICAgICAgICAgICAgbWltZXR5cGU6IHJlcS5maWxlLm1pbWV0eXBlLFxuICAgICAgICAgICAgICAgIHNpemU6IHJlcS5maWxlLnNpemUsXG4gICAgICAgICAgICAgICAgcGF0aDogcmVxLmZpbGUucGF0aCxcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgOiBudWxsLFxuICAgICAgICAgIGJvZHlLZXlzOiBPYmplY3Qua2V5cyhyZXEuYm9keSksXG4gICAgICAgICAgY29udGVudFR5cGU6IHJlcS5oZWFkZXJzWydjb250ZW50LXR5cGUnXSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgcGVybWlzc2lvbnMgLSBvbmx5IGFkbWluLCBtYW5hZ2VyLCBhbmQgcmVzaWRlbnQgY2FuIGNyZWF0ZSBkb2N1bWVudHNcbiAgICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInLCAncmVzaWRlbnQnXS5pbmNsdWRlcyh1c2VyUm9sZSkpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIGNyZWF0ZSBkb2N1bWVudHMnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXEuZmlsZSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBObyBmaWxlIHJlY2VpdmVkIGluIHVwbG9hZCByZXF1ZXN0Jyk7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0ZpbGUgaXMgcmVxdWlyZWQgZm9yIHVwbG9hZCcgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgdGhlIGV4aXN0aW5nIGRvY3VtZW50IHRvIGRldGVybWluZSB3aGVyZSB0byBzdG9yZSB0aGUgZmlsZVxuICAgICAgICBjb25zdCBkb2N1bWVudHMgPSBhd2FpdCBzdG9yYWdlLmdldERvY3VtZW50cyh7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHVzZXJSb2xlLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBleGlzdGluZ0RvY3VtZW50ID0gZG9jdW1lbnRzLmZpbmQoKGRvYykgPT4gZG9jLmlkID09PSBkb2N1bWVudElkKTtcblxuICAgICAgICBpZiAoIWV4aXN0aW5nRG9jdW1lbnQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnRG9jdW1lbnRSZWNvcmQgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZpbGUgdmFsaWRhdGlvbiBwYXNzZWQgLSBmaWxlIGV4aXN0cyBhbmQgaXMgcmVhZHkgZm9yIHVwbG9hZFxuXG4gICAgICAgIC8vIERldGVybWluZSBvcmdhbml6YXRpb24gSUQgYmFzZWQgb24gZG9jdW1lbnQgY29udGV4dFxuICAgICAgICBsZXQgb3JnYW5pemF0aW9uSWQ6IHN0cmluZztcblxuICAgICAgICBpZiAoZXhpc3RpbmdEb2N1bWVudC5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5nKGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgaWYgKCFidWlsZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkID0gYnVpbGRpbmcub3JnYW5pemF0aW9uSWQ7XG4gICAgICAgIH0gZWxzZSBpZiAoZXhpc3RpbmdEb2N1bWVudC5yZXNpZGVuY2VJZCkge1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZSA9IGF3YWl0IHN0b3JhZ2UuZ2V0UmVzaWRlbmNlKGV4aXN0aW5nRG9jdW1lbnQucmVzaWRlbmNlSWQpO1xuICAgICAgICAgIGlmICghcmVzaWRlbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnUmVzaWRlbmNlIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZyhyZXNpZGVuY2UuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgaWYgKCFidWlsZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkID0gYnVpbGRpbmcub3JnYW5pemF0aW9uSWQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAgICAgLnN0YXR1cyg0MDApXG4gICAgICAgICAgICAuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudFJlY29yZCBtdXN0IGJlIGFzc29jaWF0ZWQgd2l0aCBhIGJ1aWxkaW5nIG9yIHJlc2lkZW5jZScgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBOb3RlOiBGaWxlIHVwbG9hZCB0byBleHRlcm5hbCBzdG9yYWdlIHJlbW92ZWRcblxuICAgICAgICAvLyBVcGRhdGUgZG9jdW1lbnQgd2l0aCBmaWxlIGluZm9ybWF0aW9uXG4gICAgICAgIGNvbnN0IHVwZGF0ZWREb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UudXBkYXRlRG9jdW1lbnQoZG9jdW1lbnRJZCwge1xuICAgICAgICAgIGZpbGVQYXRoOiBgcHJvZF9vcmdfJHtvcmdhbml6YXRpb25JZH0vJHtyZXEuZmlsZS5vcmlnaW5hbG5hbWV9YCxcbiAgICAgICAgICBuYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgLy8gUmVtb3ZlIG1pbWVUeXBlIGFzIGl0J3Mgbm90IGluIHNjaGVtYVxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBDbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZVxuICAgICAgICBpZiAocmVxLmZpbGUgJiYgcmVxLmZpbGUucGF0aCAmJiBmcy5leGlzdHNTeW5jKHJlcS5maWxlLnBhdGgpKSB7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICBkb2N1bWVudDogdXBkYXRlZERvY3VtZW50LFxuICAgICAgICAgIG1lc3NhZ2U6ICdGaWxlIHVwbG9hZGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zdCBlcnJvclRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7ZXJyb3JUaW1lc3RhbXB9XSBFcnJvciB0eXBlOmAsIGVycm9yLmNvbnN0cnVjdG9yLm5hbWUpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtlcnJvclRpbWVzdGFtcH1dIEVycm9yIG1lc3NhZ2U6YCwgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2Vycm9yVGltZXN0YW1wfV0gRXJyb3Igc3RhY2s6YCwgZXJyb3Iuc3RhY2spO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlIG9uIGVycm9yXG4gICAgICAgIGlmIChyZXEuZmlsZSAmJiByZXEuZmlsZS5wYXRoICYmIGZzLmV4aXN0c1N5bmMocmVxLmZpbGUucGF0aCkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2Vycm9yVGltZXN0YW1wfV0gRXJyb3IgY2xlYW5pbmcgdXAgZmlsZTpgLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChlcnJvci5uYW1lID09PSAnWm9kRXJyb3InKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwbG9hZCBkb2N1bWVudCcgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8vIFBPU1QgL2FwaS9kb2N1bWVudHMvdXBsb2FkIC0gVXBsb2FkIGZpbGUgdG8gR0NTIGFuZCBjcmVhdGUgdW5pZmllZCBkb2N1bWVudCByZWNvcmRcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL3VwbG9hZCcsIHJlcXVpcmVBdXRoLCB1cGxvYWQuc2luZ2xlKCdmaWxlJyksIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDwn5OLIFBPU1QgL2FwaS9kb2N1bWVudHMvdXBsb2FkIC0gU3RhcnRpbmcgdXBsb2FkYCwge1xuICAgICAgaGFzRmlsZTogISFyZXEuZmlsZSxcbiAgICAgIGZpbGVOYW1lOiByZXEuZmlsZT8ub3JpZ2luYWxuYW1lLFxuICAgICAgZmlsZVNpemU6IHJlcS5maWxlPy5zaXplLFxuICAgICAgYm9keTogcmVxLmJvZHksXG4gICAgICB1c2VySWQ6IHJlcS51c2VyPy5pZFxuICAgIH0pO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGZpbGUgd2FzIHVwbG9hZGVkXG4gICAgICBpZiAoIXJlcS5maWxlKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdObyBmaWxlIHVwbG9hZGVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUGFyc2UgZm9ybSBkYXRhXG4gICAgICBjb25zdCBmb3JtRGF0YSA9IHtcbiAgICAgICAgbmFtZTogcmVxLmJvZHkubmFtZSxcbiAgICAgICAgZGVzY3JpcHRpb246IHJlcS5ib2R5LmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgICBkb2N1bWVudFR5cGU6IHJlcS5ib2R5LmRvY3VtZW50VHlwZSB8fCByZXEuYm9keS50eXBlLCAvLyBIYW5kbGUgYm90aCBmaWVsZCBuYW1lc1xuICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IHJlcS5ib2R5LmlzVmlzaWJsZVRvVGVuYW50cyA9PT0gJ3RydWUnLFxuICAgICAgICByZXNpZGVuY2VJZDogcmVxLmJvZHkucmVzaWRlbmNlSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICBidWlsZGluZ0lkOiByZXEuYm9keS5idWlsZGluZ0lkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgYXR0YWNoZWRUb1R5cGU6IHJlcS5ib2R5LmF0dGFjaGVkVG9UeXBlIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgYXR0YWNoZWRUb0lkOiByZXEuYm9keS5hdHRhY2hlZFRvSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgfTtcblxuICAgICAgLy8gUHJvZHVjdGlvbiBkZWJ1Z2dpbmc6IExvZyBmb3JtIGRhdGEgYmVmb3JlIHZhbGlkYXRpb25cbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbUFJPRCBERUJVR10gRm9ybSBkYXRhIGJlZm9yZSB2YWxpZGF0aW9uOicsIGZvcm1EYXRhKTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgZm9ybSBkYXRhXG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gdXBsb2FkRG9jdW1lbnRSZWNvcmRTY2hlbWEucGFyc2UoZm9ybURhdGEpO1xuICAgICAgXG4gICAgICAvLyBERUJVRzogTG9nIHZhbGlkYXRlZCBkYXRhIHRvIHNlZSB3aGF0J3MgYmVpbmcgcGFzc2VkXG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+UjSBWQUxJREFUSU9OIERFQlVHOiBGb3JtIGRhdGEgYmVmb3JlIHZhbGlkYXRpb246YCwgZm9ybURhdGEpO1xuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCflI0gVkFMSURBVElPTiBERUJVRzogVmFsaWRhdGVkIGRhdGE6YCwge1xuICAgICAgICAuLi52YWxpZGF0ZWREYXRhLFxuICAgICAgICBoYXNBdHRhY2hlZFRvVHlwZTogISF2YWxpZGF0ZWREYXRhLmF0dGFjaGVkVG9UeXBlLFxuICAgICAgICBoYXNBdHRhY2hlZFRvSWQ6ICEhdmFsaWRhdGVkRGF0YS5hdHRhY2hlZFRvSWRcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBQcm9kdWN0aW9uIGRlYnVnZ2luZzogTG9nIGFmdGVyIHZhbGlkYXRpb25cbiAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbUFJPRCBERUJVR10gRm9ybSBkYXRhIHZhbGlkYXRpb24gcGFzc2VkOicsIHZhbGlkYXRlZERhdGEpO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdXNlciBpbmZvIGZyb20gYXV0aCBtaWRkbGV3YXJlXG4gICAgICBjb25zdCB1c2VySWQgPSByZXEudXNlcj8uaWQ7XG4gICAgICBpZiAoIXVzZXJJZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnVXNlciBub3QgYXV0aGVudGljYXRlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdDUyBESVNBQkxFRDogU2tpcCBidWNrZXQgY29uZmlndXJhdGlvbiAodXNpbmcgbG9jYWwgc3RvcmFnZSBvbmx5KVxuICAgICAgY29uc29sZS5sb2coJ/Cfk4EgR0NTIGRpc2FibGVkIC0gc2tpcHBpbmcgYnVja2V0IGNvbmZpZ3VyYXRpb24gY2hlY2snKTtcblxuICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIEdDUyBwYXRoXG4gICAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKHJlcS5maWxlLm9yaWdpbmFsbmFtZSk7XG4gICAgICBjb25zdCBiYXNlRmlsZU5hbWUgPSBwYXRoLmJhc2VuYW1lKHJlcS5maWxlLm9yaWdpbmFsbmFtZSwgZmlsZUV4dGVuc2lvbik7XG4gICAgICBjb25zdCB1bmlxdWVGaWxlTmFtZSA9IGAke3V1aWR2NCgpfS0ke2Jhc2VGaWxlTmFtZX0ke2ZpbGVFeHRlbnNpb259YDtcblxuICAgICAgbGV0IGZpbGVQYXRoOiBzdHJpbmc7XG4gICAgICBpZiAodmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZCkge1xuICAgICAgICBmaWxlUGF0aCA9IGByZXNpZGVuY2VzLyR7dmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZH0vJHt1bmlxdWVGaWxlTmFtZX1gO1xuICAgICAgfSBlbHNlIGlmICh2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgZmlsZVBhdGggPSBgYnVpbGRpbmdzLyR7dmFsaWRhdGVkRGF0YS5idWlsZGluZ0lkfS8ke3VuaXF1ZUZpbGVOYW1lfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaWxlUGF0aCA9IGBnZW5lcmFsLyR7dW5pcXVlRmlsZU5hbWV9YDtcbiAgICAgIH1cblxuICAgICAgLy8gRElTQUJMRUQgR0NTOiBGb3JjZSBsb2NhbCBzdG9yYWdlIGZvciBhbGwgZW52aXJvbm1lbnRzXG4gICAgICBjb25zb2xlLmxvZygn8J+TgSBHQ1MgZGlzYWJsZWQgLSB1c2luZyBsb2NhbCBzdG9yYWdlIGZvciBhbGwgZG9jdW1lbnQgb3BlcmF0aW9ucycpO1xuICAgICAgXG4gICAgICAvLyBBbHdheXMgdXNlIGxvY2FsIHN0b3JhZ2UgKEdDUyBkaXNhYmxlZClcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFVzZSBsb2NhbCBzdG9yYWdlIHdpdGggcm9idXN0IGVycm9yIGhhbmRsaW5nXG4gICAgICAgIGNvbnN0IGxvY2FsU3RvcmFnZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIEVuc3VyZSB1cGxvYWRzIGRpcmVjdG9yeSBleGlzdHNcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMobG9jYWxTdG9yYWdlUGF0aCkpIHtcbiAgICAgICAgICAgIGZzLm1rZGlyU3luYyhsb2NhbFN0b3JhZ2VQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OBIENyZWF0ZWQgdXBsb2FkcyBkaXJlY3Rvcnk6ICR7bG9jYWxTdG9yYWdlUGF0aH1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGRpckVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSB1cGxvYWRzIGRpcmVjdG9yeTonLCBkaXJFcnJvcik7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY3JlYXRlIHVwbG9hZHMgZGlyZWN0b3J5IC0gY2hlY2sgcGVybWlzc2lvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENyZWF0ZSBkaXJlY3Rvcnkgc3RydWN0dXJlIGZvciBmaWxlXG4gICAgICAgIGNvbnN0IGxvY2FsRmlsZVBhdGggPSBwYXRoLmpvaW4obG9jYWxTdG9yYWdlUGF0aCwgZmlsZVBhdGgpO1xuICAgICAgICBjb25zdCBsb2NhbEZpbGVEaXIgPSBwYXRoLmRpcm5hbWUobG9jYWxGaWxlUGF0aCk7XG4gICAgICAgIFxuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhsb2NhbEZpbGVEaXIpKSB7XG4gICAgICAgICAgICBmcy5ta2RpclN5bmMobG9jYWxGaWxlRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OBIENyZWF0ZWQgc3ViZGlyZWN0b3J5OiAke2xvY2FsRmlsZURpcn1gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKHN1YmRpckVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNyZWF0ZSBmaWxlIHN1YmRpcmVjdG9yeTonLCBzdWJkaXJFcnJvcik7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY3JlYXRlIGZpbGUgZGlyZWN0b3J5IC0gY2hlY2sgcGVybWlzc2lvbnMnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENvcHkgdXBsb2FkZWQgZmlsZSB0byBsb2NhbCBzdG9yYWdlXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZnMuY29weUZpbGVTeW5jKHJlcS5maWxlIS5wYXRoLCBsb2NhbEZpbGVQYXRoKTtcbiAgICAgICAgICAvLyBGaWxlIHNhdmVkIHN1Y2Nlc3NmdWxseVxuICAgICAgICB9IGNhdGNoIChjb3B5RXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY29weSBmaWxlOicsIGNvcHlFcnJvcik7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3Qgc2F2ZSBmaWxlIC0gY2hlY2sgZGlzayBzcGFjZSBhbmQgcGVybWlzc2lvbnMnKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAobG9jYWxFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdMb2NhbCBzdG9yYWdlIGVycm9yOicsIGxvY2FsRXJyb3IpO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBzYXZlIGZpbGUgbG9jYWxseScpO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgZG9jdW1lbnQgcmVjb3JkIGluIGRhdGFiYXNlXG4gICAgICBjb25zdCBkb2N1bWVudERhdGE6IEluc2VydERvY3VtZW50ID0ge1xuICAgICAgICBuYW1lOiB2YWxpZGF0ZWREYXRhLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB2YWxpZGF0ZWREYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBkb2N1bWVudFR5cGU6IHZhbGlkYXRlZERhdGEuZG9jdW1lbnRUeXBlLFxuICAgICAgICBmaWxlUGF0aDogZmlsZVBhdGgsXG4gICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogdmFsaWRhdGVkRGF0YS5pc1Zpc2libGVUb1RlbmFudHMsXG4gICAgICAgIHJlc2lkZW5jZUlkOiB2YWxpZGF0ZWREYXRhLnJlc2lkZW5jZUlkLFxuICAgICAgICBidWlsZGluZ0lkOiB2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWQsXG4gICAgICAgIHVwbG9hZGVkQnlJZDogdXNlcklkLFxuICAgICAgICBhdHRhY2hlZFRvVHlwZTogdmFsaWRhdGVkRGF0YS5hdHRhY2hlZFRvVHlwZSxcbiAgICAgICAgYXR0YWNoZWRUb0lkOiB2YWxpZGF0ZWREYXRhLmF0dGFjaGVkVG9JZCxcbiAgICAgIH07XG5cbiAgICAgIC8vIENyZWF0ZSBkb2N1bWVudCByZWNvcmQgaW4gZGF0YWJhc2VcblxuICAgICAgLy8gQ3JlYXRlIGRvY3VtZW50IHJlY29yZCBpbiBkYXRhYmFzZSAgXG4gICAgICBjb25zdCBuZXdEb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlRG9jdW1lbnQoZG9jdW1lbnREYXRhKTtcbiAgICAgIFxuICAgICAgLy8gRG9jdW1lbnQgcmVjb3JkIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XG5cbiAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlXG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhyZXEuZmlsZS5wYXRoKSkge1xuICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXR1cm4gc3VjY2VzcyByZXNwb25zZVxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnRSZWNvcmQgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgZG9jdW1lbnQ6IG5ld0RvY3VtZW50LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc3QgZXJyb3JFbnRyeSA9IGxvZ0Vycm9yKCdQT1NUIC9hcGkvZG9jdW1lbnRzL3VwbG9hZCcsIGVycm9yLCByZXEudXNlcik7XG5cbiAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlIG9uIGVycm9yXG4gICAgICBpZiAocmVxLmZpbGUgJiYgcmVxLmZpbGUucGF0aCAmJiBmcy5leGlzdHNTeW5jKHJlcS5maWxlLnBhdGgpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgY2xlYW5pbmcgdXAgdGVtcG9yYXJ5IGZpbGU6JywgY2xlYW51cEVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgdmFsaWRhdGlvbiBlcnJvcnNcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnWm9kRXJyb3InKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgIGVycm9yczogZXJyb3IuZXJyb3JzLFxuICAgICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIEdDUyBlcnJvcnNcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ0dvb2dsZSBDbG91ZCBTdG9yYWdlJykpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmlsZSB1cGxvYWQgZmFpbGVkJyxcbiAgICAgICAgICBlcnJvcjogJ1N0b3JhZ2Ugc2VydmljZSBlcnJvcicsXG4gICAgICAgICAgZXJyb3JfaWQ6IGVycm9yRW50cnkudGltZXN0YW1wXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgdW5pcXVlIGNvbnN0cmFpbnQgdmlvbGF0aW9ucyAocGF0aCBjb25mbGljdHMpXG4gICAgICBpZiAoZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCd1bmlxdWUgY29uc3RyYWludCcpIHx8IGVycm9yPy5jb2RlID09PSAnMjM1MDUnKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwOSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50UmVjb3JkIHBhdGggY29uZmxpY3QgLSBwbGVhc2UgdHJ5IHVwbG9hZGluZyBhZ2FpbicsXG4gICAgICAgICAgZXJyb3I6ICdQYXRoIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgICBlcnJvcl9pZDogZXJyb3JFbnRyeS50aW1lc3RhbXBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBkYXRhYmFzZSBlcnJvcnNcbiAgICAgIGlmIChlcnJvci5tZXNzYWdlICYmIGVycm9yLm1lc3NhZ2UuaW5jbHVkZXMoJ2RhdGFiYXNlJykpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHNhdmUgZG9jdW1lbnQgcmVjb3JkJyxcbiAgICAgICAgICBlcnJvcjogJ0RhdGFiYXNlIGVycm9yJyxcbiAgICAgICAgICBlcnJvcl9pZDogZXJyb3JFbnRyeS50aW1lc3RhbXBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyaWMgZXJyb3IgcmVzcG9uc2VcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIGVycm9yOiAnRG9jdW1lbnRSZWNvcmQgdXBsb2FkIGZhaWxlZCcsXG4gICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcCxcbiAgICAgICAgZGVidWdfaW5mbzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBlcnJvci5tZXNzYWdlIDogdW5kZWZpbmVkXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIFNlcnZlIGRvY3VtZW50IGZpbGVzXG4gIC8vIFNlcnZlIGRvY3VtZW50IGZpbGVzIHdpdGggcHJvcGVyIHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2xcbiAgYXBwLmdldCgnL2FwaS9kb2N1bWVudHMvOmlkL2ZpbGUnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIGNvbnN0IGRvY3VtZW50SWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgaXNEb3dubG9hZCA9IHJlcS5xdWVyeS5kb3dubG9hZCA9PT0gJ3RydWUnO1xuXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignRklMRV9TRVJWRV9SRVFVRVNUJywge1xuICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgZG9jdW1lbnRJZCxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgaXNEb3dubG9hZCxcbiAgICAgICAgcmVxdWVzdEluZm86IHtcbiAgICAgICAgICB1cmw6IHJlcS51cmwsXG4gICAgICAgICAgbWV0aG9kOiByZXEubWV0aG9kLFxuICAgICAgICAgIHVzZXJBZ2VudDogcmVxLmhlYWRlcnNbJ3VzZXItYWdlbnQnXSxcbiAgICAgICAgICByZWZlcmVyOiByZXEuaGVhZGVycy5yZWZlcmVyLFxuICAgICAgICAgIGNsaWVudElQOiByZXEuaXAgfHwgcmVxLmNvbm5lY3Rpb24ucmVtb3RlQWRkcmVzc1xuICAgICAgICB9XG4gICAgICB9LCAnSU5GTycpO1xuXG4gICAgICAvLyBFbmhhbmNlZCBwZXJtaXNzaW9uIGRhdGEgbG9hZGluZyB3aXRoIHRpbWluZ1xuICAgICAgY29uc3QgcGVybWlzc2lvbkxvYWRTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3Qgb3JnYW5pemF0aW9ucyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnModXNlcklkKTtcbiAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICBjb25zdCBidWlsZGluZ3MgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5ncygpO1xuICAgICAgY29uc3QgcGVybWlzc2lvbkxvYWRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwZXJtaXNzaW9uTG9hZFN0YXJ0O1xuICAgICAgXG4gICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignUEVSTUlTU0lPTl9EQVRBX0xPQURFRCcsIHtcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgIGxvYWRUaW1lOiBgJHtwZXJtaXNzaW9uTG9hZFRpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgIGRhdGFTdGF0czoge1xuICAgICAgICAgIG9yZ2FuaXphdGlvbnNDb3VudDogb3JnYW5pemF0aW9ucy5sZW5ndGgsXG4gICAgICAgICAgcmVzaWRlbmNlc0NvdW50OiByZXNpZGVuY2VzLmxlbmd0aCxcbiAgICAgICAgICBidWlsZGluZ3NDb3VudDogYnVpbGRpbmdzLmxlbmd0aFxuICAgICAgICB9XG4gICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgLy8gRW5oYW5jZWQgc2VjdXJpdHkgYXVkaXQgZm9yIGZpbGUgYWNjZXNzXG4gICAgICBsb2dTZWN1cml0eUV2ZW50KCdET0NVTUVOVF9GSUxFX0FDQ0VTU19BVFRFTVBUJywgdXNlciwgZmFsc2UsIGRvY3VtZW50SWQsIHtcbiAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgIHVzZXJSb2xlLFxuICAgICAgICBkb2N1bWVudElkLFxuICAgICAgICBpc0Rvd25sb2FkLFxuICAgICAgICByZXF1ZXN0Q29udGV4dDoge1xuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGNsaWVudElQOiByZXEuaXAgfHwgcmVxLmNvbm5lY3Rpb24ucmVtb3RlQWRkcmVzcyxcbiAgICAgICAgICB1c2VyQWdlbnQ6IHJlcS5oZWFkZXJzWyd1c2VyLWFnZW50J11cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIEVuaGFuY2VkIGRvY3VtZW50IGxvb2t1cCB3aXRoIHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gICAgICBjb25zdCBkb2N1bWVudExvb2t1cFN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBjb25zdCBhbGxEb2N1bWVudHMgPSBhd2FpdCBzdG9yYWdlLmdldERvY3VtZW50cyh7fSk7XG4gICAgICBjb25zdCBkb2N1bWVudCA9IGFsbERvY3VtZW50cy5maW5kKChkb2MpID0+IGRvYy5pZCA9PT0gZG9jdW1lbnRJZCk7XG4gICAgICBjb25zdCBkb2N1bWVudExvb2t1cFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGRvY3VtZW50TG9va3VwU3RhcnQ7XG4gICAgICBcbiAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdET0NVTUVOVF9MT09LVVAnLCB7XG4gICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICBkb2N1bWVudElkLFxuICAgICAgICBsb29rdXBUaW1lOiBgJHtkb2N1bWVudExvb2t1cFRpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgIHRvdGFsRG9jdW1lbnRzU2VhcmNoZWQ6IGFsbERvY3VtZW50cy5sZW5ndGgsXG4gICAgICAgIGRvY3VtZW50Rm91bmQ6ICEhZG9jdW1lbnRcbiAgICAgIH0sICdERUJVRycpO1xuXG4gICAgICBpZiAoIWRvY3VtZW50KSB7XG4gICAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdET0NVTUVOVF9OT1RfRk9VTkQnLCB7XG4gICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgZG9jdW1lbnRJZCxcbiAgICAgICAgICB0b3RhbERvY3VtZW50c0luRGF0YWJhc2U6IGFsbERvY3VtZW50cy5sZW5ndGhcbiAgICAgICAgfSwgJ1dBUk4nKTtcbiAgICAgICAgbG9nU2VjdXJpdHlFdmVudCgnRE9DVU1FTlRfRklMRV9BQ0NFU1NfTk9UX0ZPVU5EJywgdXNlciwgZmFsc2UsIGRvY3VtZW50SWQsIHsgb3BlcmF0aW9uSWQgfSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEb2N1bWVudCBmb3VuZCBpbiBkYXRhYmFzZVxuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBpbmZvXG4gICAgICBjb25zdCB1c2VyT3JnYW5pemF0aW9ucyA9IG9yZ2FuaXphdGlvbnMubWFwKG9yZyA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuICAgICAgY29uc3QgdXNlclJlc2lkZW5jZUlkcyA9IHJlc2lkZW5jZXNcbiAgICAgICAgLm1hcCgodXI6IGFueSkgPT4gdXIucmVzaWRlbmNlSWQgfHwgdXIudXNlclJlc2lkZW5jZT8ucmVzaWRlbmNlSWQgfHwgdXIucmVzaWRlbmNlPy5pZClcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcblxuICAgICAgLy8gR2V0IGJ1aWxkaW5nIElEcyB0aGF0IHVzZXIncyByZXNpZGVuY2VzIGJlbG9uZyB0b1xuICAgICAgY29uc3QgdXNlckJ1aWxkaW5nSWRzID0gW107XG4gICAgICBmb3IgKGNvbnN0IHVzZXJSZXNpZGVuY2Ugb2YgcmVzaWRlbmNlcykge1xuICAgICAgICAvLyBIYW5kbGUgZGlmZmVyZW50IHJlc2lkZW5jZSBkYXRhIHN0cnVjdHVyZXNcbiAgICAgICAgY29uc3QgcmVzaWRlbmNlSWQgPSB1c2VyUmVzaWRlbmNlLnJlc2lkZW5jZUlkO1xuICAgICAgICBpZiAocmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICAvLyBGaW5kIHRoZSBhY3R1YWwgcmVzaWRlbmNlIHRvIGdldCBidWlsZGluZyBJRFxuICAgICAgICAgIGNvbnN0IGFsbFJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFJlc2lkZW5jZXMoKTtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2UgPSBhbGxSZXNpZGVuY2VzLmZpbmQociA9PiByLmlkID09PSByZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKHJlc2lkZW5jZT8uYnVpbGRpbmdJZCkge1xuICAgICAgICAgICAgdXNlckJ1aWxkaW5nSWRzLnB1c2gocmVzaWRlbmNlLmJ1aWxkaW5nSWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBwZXJtaXNzaW9ucyBiYXNlZCBvbiB0aGUgc3BlY2lmaWVkIHJ1bGVzXG4gICAgICBsZXQgaGFzQWNjZXNzID0gZmFsc2U7XG4gICAgICBsZXQgYWNjZXNzUmVhc29uID0gJyc7XG5cbiAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICBhY2Nlc3NSZWFzb24gPSAnQWRtaW4gaGFzIGdsb2JhbCBhY2Nlc3MnO1xuICAgICAgICAvLyBBZG1pbiBhY2Nlc3MgZ3JhbnRlZFxuICAgICAgfSBlbHNlIGlmICh1c2VyUm9sZSA9PT0gJ21hbmFnZXInIHx8IHVzZXJSb2xlID09PSAnZGVtb19tYW5hZ2VyJykge1xuICAgICAgICAvLyBDaGVja2luZyBtYW5hZ2VyIHBlcm1pc3Npb25zXG4gICAgICAgIFxuICAgICAgICAvLyBNYW5hZ2VyIHNob3VsZCBoYXZlIGFjY2VzcyB0byBidWlsZGluZ3MgdGhleSBhcmUgYXNzaWduZWQgdG9cbiAgICAgICAgaWYgKGRvY3VtZW50LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICAvLyBDaGVja2luZyBidWlsZGluZy1sZXZlbCBhY2Nlc3NcbiAgICAgICAgICAvLyBHZXQgYnVpbGRpbmdzIGZvciB0aGUgbWFuYWdlcidzIG9yZ2FuaXphdGlvblxuICAgICAgICAgIGNvbnN0IG9yZ0J1aWxkaW5ncyA9IGJ1aWxkaW5ncy5maWx0ZXIoYnVpbGRpbmcgPT4gXG4gICAgICAgICAgICB1c2VyT3JnYW5pemF0aW9ucy5pbmNsdWRlcyhidWlsZGluZy5vcmdhbml6YXRpb25JZCB8fCAnJylcbiAgICAgICAgICApO1xuICAgICAgICAgIGNvbnN0IG9yZ0J1aWxkaW5nSWRzID0gb3JnQnVpbGRpbmdzLm1hcChiID0+IGIuaWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNraW5nIG9yZ2FuaXphdGlvbiBidWlsZGluZ3NcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAob3JnQnVpbGRpbmdJZHMuaW5jbHVkZXMoZG9jdW1lbnQuYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBhY2Nlc3NSZWFzb24gPSAnTWFuYWdlciBoYXMgYWNjZXNzIHRvIG9yZ2FuaXphdGlvbiBidWlsZGluZ3MnO1xuICAgICAgICAgICAgLy8gTWFuYWdlciBidWlsZGluZyBhY2Nlc3MgZ3JhbnRlZFxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBNYW5hZ2VyIGJ1aWxkaW5nIGFjY2VzcyBkZW5pZWRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIE1hbmFnZXIgaGFzIGFjY2VzcyB0byBhbGwgcmVzaWRlbmNlcyBpbiB0aGVpciBvcmdhbml6YXRpb25cbiAgICAgICAgaWYgKGRvY3VtZW50LnJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgLy8gQ2hlY2sgaWYgcmVzaWRlbmNlIGJlbG9uZ3MgdG8gbWFuYWdlcidzIG9yZ2FuaXphdGlvblxuICAgICAgICAgIGNvbnN0IGFsbFJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFJlc2lkZW5jZXMoKTtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2UgPSBhbGxSZXNpZGVuY2VzLmZpbmQociA9PiByLmlkID09PSBkb2N1bWVudC5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKHJlc2lkZW5jZSkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgcmVzaWRlbmNlIGJ1aWxkaW5nIGJlbG9uZ3MgdG8gbWFuYWdlcidzIG9yZ2FuaXphdGlvblxuICAgICAgICAgICAgY29uc3QgcmVzaWRlbmNlQnVpbGRpbmcgPSBidWlsZGluZ3MuZmluZChiID0+IGIuaWQgPT09IHJlc2lkZW5jZS5idWlsZGluZ0lkKTtcbiAgICAgICAgICAgIGlmIChyZXNpZGVuY2VCdWlsZGluZyAmJiB1c2VyT3JnYW5pemF0aW9ucy5pbmNsdWRlcyhyZXNpZGVuY2VCdWlsZGluZy5vcmdhbml6YXRpb25JZCB8fCAnJykpIHtcbiAgICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgYWNjZXNzUmVhc29uID0gJ01hbmFnZXIgaGFzIGFjY2VzcyB0byBvcmdhbml6YXRpb24gcmVzaWRlbmNlcyc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHVzZXJSb2xlID09PSAncmVzaWRlbnQnIHx8IHVzZXJSb2xlID09PSAnZGVtb19yZXNpZGVudCcpIHtcbiAgICAgICAgLy8gUmVzaWRlbnQgaGFzIGFjY2VzcyB0byBidWlsZGluZyBmaWxlcyB0aGV5IGFyZSBhc3NpZ25lZCB0b1xuICAgICAgICBpZiAoZG9jdW1lbnQuYnVpbGRpbmdJZCAmJiB1c2VyQnVpbGRpbmdJZHMuaW5jbHVkZXMoZG9jdW1lbnQuYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgIGFjY2Vzc1JlYXNvbiA9ICdSZXNpZGVudCBoYXMgYWNjZXNzIHRvIGFzc2lnbmVkIGJ1aWxkaW5nIGRvY3VtZW50cyc7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFJlc2lkZW50IGhhcyBhY2Nlc3MgdG8gcmVzaWRlbmNlIGZpbGVzIHRoZXkgYXJlIGFzc2lnbmVkIHRvXG4gICAgICAgIGlmIChkb2N1bWVudC5yZXNpZGVuY2VJZCAmJiB1c2VyUmVzaWRlbmNlSWRzLmluY2x1ZGVzKGRvY3VtZW50LnJlc2lkZW5jZUlkKSkge1xuICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgYWNjZXNzUmVhc29uID0gJ1Jlc2lkZW50IGhhcyBhY2Nlc3MgdG8gYXNzaWduZWQgcmVzaWRlbmNlIGRvY3VtZW50cyc7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodXNlclJvbGUgPT09ICd0ZW5hbnQnIHx8IHVzZXJSb2xlID09PSAnZGVtb190ZW5hbnQnKSB7XG4gICAgICAgIC8vIFRlbmFudHMgY2FuIG9ubHkgYWNjZXNzIGRvY3VtZW50cyBtYXJrZWQgYXMgdmlzaWJsZSB0byB0ZW5hbnRzXG4gICAgICAgIGlmIChkb2N1bWVudC5pc1Zpc2libGVUb1RlbmFudHMpIHtcbiAgICAgICAgICAvLyBUZW5hbnQgaGFzIGFjY2VzcyB0byBidWlsZGluZyBmaWxlcyB0aGV5IGFyZSBhc3NpZ25lZCB0byBhbmQgbWFya2VkIGZvciB0ZW5hbnRcbiAgICAgICAgICBpZiAoZG9jdW1lbnQuYnVpbGRpbmdJZCAmJiB1c2VyQnVpbGRpbmdJZHMuaW5jbHVkZXMoZG9jdW1lbnQuYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBhY2Nlc3NSZWFzb24gPSAnVGVuYW50IGhhcyBhY2Nlc3MgdG8gYXNzaWduZWQgYnVpbGRpbmcgZG9jdW1lbnRzIG1hcmtlZCBmb3IgdGVuYW50cyc7XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIC8vIFRlbmFudCBoYXMgYWNjZXNzIHRvIHJlc2lkZW5jZSBmaWxlcyB0aGV5IGFyZSBhc3NpZ25lZCB0byBhbmQgbWFya2VkIGZvciB0ZW5hbnRcbiAgICAgICAgICBpZiAoZG9jdW1lbnQucmVzaWRlbmNlSWQgJiYgdXNlclJlc2lkZW5jZUlkcy5pbmNsdWRlcyhkb2N1bWVudC5yZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICBhY2Nlc3NSZWFzb24gPSAnVGVuYW50IGhhcyBhY2Nlc3MgdG8gYXNzaWduZWQgcmVzaWRlbmNlIGRvY3VtZW50cyBtYXJrZWQgZm9yIHRlbmFudHMnO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAoIWhhc0FjY2Vzcykge1xuICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignRklMRV9BQ0NFU1NfREVOSUVEJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHVzZXJSb2xlLFxuICAgICAgICAgIGFjY2Vzc0FuYWx5c2lzOiB7XG4gICAgICAgICAgICBkb2N1bWVudEJ1aWxkaW5nSWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICBkb2N1bWVudFJlc2lkZW5jZUlkOiBkb2N1bWVudC5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIHVzZXJCdWlsZGluZ0lkcyxcbiAgICAgICAgICAgIHVzZXJSZXNpZGVuY2VJZHMsXG4gICAgICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IGRvY3VtZW50LmlzVmlzaWJsZVRvVGVuYW50cyxcbiAgICAgICAgICAgIGRvY3VtZW50VHlwZTogZG9jdW1lbnQuZG9jdW1lbnRUeXBlXG4gICAgICAgICAgfVxuICAgICAgICB9LCAnV0FSTicpO1xuICAgICAgICBcbiAgICAgICAgbG9nU2VjdXJpdHlFdmVudCgnRE9DVU1FTlRfRklMRV9BQ0NFU1NfREVOSUVEJywgdXNlciwgZmFsc2UsIGRvY3VtZW50SWQsIHtcbiAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgICBkb2N1bWVudEJ1aWxkaW5nSWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgICAgZG9jdW1lbnRSZXNpZGVuY2VJZDogZG9jdW1lbnQucmVzaWRlbmNlSWQsXG4gICAgICAgICAgdXNlckJ1aWxkaW5nSWRzLFxuICAgICAgICAgIHVzZXJSZXNpZGVuY2VJZHMsXG4gICAgICAgICAgaXNWaXNpYmxlVG9UZW5hbnRzOiBkb2N1bWVudC5pc1Zpc2libGVUb1RlbmFudHNcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgbG9nRG9jdW1lbnRPcGVyYXRpb24oJ0ZJTEVfQUNDRVNTX0dSQU5URUQnLCB7XG4gICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICBkb2N1bWVudElkLFxuICAgICAgICB1c2VySWQsXG4gICAgICAgIHVzZXJSb2xlLFxuICAgICAgICBhY2Nlc3NSZWFzb24sXG4gICAgICAgIGRvY3VtZW50SW5mbzoge1xuICAgICAgICAgIG5hbWU6IGRvY3VtZW50Lm5hbWUsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudC5kb2N1bWVudFR5cGUsXG4gICAgICAgICAgZmlsZVBhdGg6IGRvY3VtZW50LmZpbGVQYXRoLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IGRvY3VtZW50LnJlc2lkZW5jZUlkXG4gICAgICAgIH1cbiAgICAgIH0sICdJTkZPJyk7XG5cbiAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ0RPQ1VNRU5UX0ZJTEVfQUNDRVNTX0dSQU5URUQnLCB1c2VyLCB0cnVlLCBkb2N1bWVudElkLCB7XG4gICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICBhY2Nlc3NSZWFzb24sXG4gICAgICAgIHVzZXJSb2xlLFxuICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50LmRvY3VtZW50VHlwZVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFNlcnZlIGZyb20gbG9jYWwgc3RvcmFnZVxuICAgICAgaWYgKGRvY3VtZW50LmZpbGVQYXRoKSB7XG4gICAgICAgIC8vIFNlcnZpbmcgZmlsZSBmcm9tIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBBbHdheXMgc2VydmUgZnJvbSBsb2NhbCBzdG9yYWdlIChHQ1MgZGlzYWJsZWQpXG4gICAgICAgICAgbGV0IGZpbGVQYXRoVG9TZXJ2ZSA9IGRvY3VtZW50LmZpbGVQYXRoO1xuXG4gICAgICAgICAgLy8gUmVzb2x2aW5nIGZpbGUgcGF0aFxuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBhYnNvbHV0ZSBwYXRoXG4gICAgICAgICAgaWYgKGRvY3VtZW50LmZpbGVQYXRoLnN0YXJ0c1dpdGgoJy8nKSkge1xuICAgICAgICAgICAgZmlsZVBhdGhUb1NlcnZlID0gZG9jdW1lbnQuZmlsZVBhdGg7XG4gICAgICAgICAgICAvLyBVc2luZyBhYnNvbHV0ZSBwYXRoXG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSByZWxhdGl2ZSBmaWxlIHBhdGhcbiAgICAgICAgICBlbHNlIGlmIChcbiAgICAgICAgICAgIGRvY3VtZW50LmZpbGVQYXRoLmluY2x1ZGVzKCdyZXNpZGVuY2VzLycpIHx8XG4gICAgICAgICAgICBkb2N1bWVudC5maWxlUGF0aC5pbmNsdWRlcygnYnVpbGRpbmdzLycpIHx8XG4gICAgICAgICAgICBkb2N1bWVudC5maWxlUGF0aC5pbmNsdWRlcygndGV4dC1kb2N1bWVudHMvJykgfHxcbiAgICAgICAgICAgIGRvY3VtZW50LmZpbGVQYXRoLmluY2x1ZGVzKCdnZW5lcmFsLycpIHx8XG4gICAgICAgICAgICBkb2N1bWVudC5maWxlUGF0aC5pbmNsdWRlcygnYmlsbHMvJylcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIC8vIENoZWNraW5nIGNvbW1vbiBmaWxlIGxvY2F0aW9uc1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBGb3IgZGV2ZWxvcG1lbnQsIHRyeSB0byBmaW5kIHRoZSBmaWxlIGluIGNvbW1vbiB1cGxvYWQgZGlyZWN0b3JpZXNcbiAgICAgICAgICAgIGNvbnN0IHBvc3NpYmxlUGF0aHMgPSBbXG4gICAgICAgICAgICAgIHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCBkb2N1bWVudC5maWxlUGF0aCksIC8vIERpcmVjdCBwYXRoIChQUklPUklUWSAtIHVzZXIgZGlyZWN0b3J5IHN0cnVjdHVyZSlcbiAgICAgICAgICAgICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgZG9jdW1lbnQuZmlsZVBhdGgpLCAvLyBGYWxsYmFjayBsb2NhdGlvblxuICAgICAgICAgICAgICBgL3RtcC91cGxvYWRzLyR7ZG9jdW1lbnQuZmlsZVBhdGh9YCxcbiAgICAgICAgICAgICAgYC91cGxvYWRzLyR7ZG9jdW1lbnQuZmlsZVBhdGh9YCxcbiAgICAgICAgICAgICAgYC4vdXBsb2Fkcy8ke2RvY3VtZW50LmZpbGVQYXRofWAsXG4gICAgICAgICAgICAgIHBhdGguam9pbignL3RtcCcsIGRvY3VtZW50LmZpbGVQYXRoKSxcbiAgICAgICAgICAgIF07XG5cbiAgICAgICAgICAgIC8vIENoZWNraW5nIG11bHRpcGxlIHBvc3NpYmxlIHBhdGhzXG5cbiAgICAgICAgICAgIC8vIFRyeSB0byBmaW5kIHRoZSBmaWxlIGluIGFueSBvZiB0aGVzZSBsb2NhdGlvbnNcbiAgICAgICAgICAgIGZvciAoY29uc3QgcG9zc2libGVQYXRoIG9mIHBvc3NpYmxlUGF0aHMpIHtcbiAgICAgICAgICAgICAgLy8gQ2hlY2tpbmcgZmlsZSBwYXRoXG4gICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKHBvc3NpYmxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aFRvU2VydmUgPSBwb3NzaWJsZVBhdGg7XG4gICAgICAgICAgICAgICAgLy8gRmlsZSBmb3VuZFxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSB0ZW1wIGZpbGUgcGF0aFxuICAgICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LmZpbGVQYXRoLmluY2x1ZGVzKCd0bXAnKSkge1xuICAgICAgICAgICAgZmlsZVBhdGhUb1NlcnZlID0gZG9jdW1lbnQuZmlsZVBhdGg7XG4gICAgICAgICAgICAvLyBVc2luZyB0ZW1wIGZpbGUgcGF0aFxuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRyeSB0byBzZXJ2ZSB0aGUgZmlsZVxuICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGZpbGVQYXRoVG9TZXJ2ZSkpIHtcbiAgICAgICAgICAgIC8vIFByZXBhcmluZyB0byBzZXJ2ZSBmaWxlXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEdldCB0aGUgb3JpZ2luYWwgZmlsZW5hbWUgd2l0aCBleHRlbnNpb24sIG9yIGNvbnN0cnVjdCBvbmUgZnJvbSB0aGUgZG9jdW1lbnQgbmFtZVxuICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gKGRvY3VtZW50IGFzIGFueSkuZmlsZU5hbWUgfHwgZG9jdW1lbnQubmFtZSB8fCBwYXRoLmJhc2VuYW1lKGRvY3VtZW50LmZpbGVQYXRoKTtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIGZpbGVOYW1lIGRvZXNuJ3QgaGF2ZSBhbiBleHRlbnNpb24sIGFkZCBpdCBmcm9tIHRoZSBvcmlnaW5hbCBmaWxlIHBhdGhcbiAgICAgICAgICAgIGlmICghcGF0aC5leHRuYW1lKGZpbGVOYW1lKSAmJiBkb2N1bWVudC5maWxlUGF0aCkge1xuICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEV4dCA9IHBhdGguZXh0bmFtZShkb2N1bWVudC5maWxlUGF0aCk7XG4gICAgICAgICAgICAgIGlmIChvcmlnaW5hbEV4dCkge1xuICAgICAgICAgICAgICAgIGZpbGVOYW1lICs9IG9yaWdpbmFsRXh0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNldHRpbmcgZmlsZSBkZXRhaWxzIGZvciBkb3dubG9hZFxuXG4gICAgICAgICAgICBpZiAoaXNEb3dubG9hZCkge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uJywgYGF0dGFjaG1lbnQ7IGZpbGVuYW1lPVwiJHtmaWxlTmFtZX1cImApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbicsIGBpbmxpbmU7IGZpbGVuYW1lPVwiJHtmaWxlTmFtZX1cImApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBTZXQgYXBwcm9wcmlhdGUgY29udGVudCB0eXBlIGJhc2VkIG9uIGZpbGUgZXh0ZW5zaW9uXG4gICAgICAgICAgICBjb25zdCBleHQgPSBwYXRoLmV4dG5hbWUoZmlsZU5hbWUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgICAvLyBTZXR0aW5nIGNvbnRlbnQgdHlwZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZXh0ID09PSAnLnBkZicpIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3BkZicpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleHQgPT09ICcuanBnJyB8fCBleHQgPT09ICcuanBlZycpIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2ltYWdlL2pwZWcnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ID09PSAnLnBuZycpIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2ltYWdlL3BuZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleHQgPT09ICcuZ2lmJykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnaW1hZ2UvZ2lmJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4dCA9PT0gJy5kb2MnIHx8IGV4dCA9PT0gJy5kb2N4Jykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKFxuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnLFxuICAgICAgICAgICAgICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQud29yZHByb2Nlc3NpbmdtbC5kb2N1bWVudCdcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ID09PSAnLnR4dCcpIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ3RleHQvcGxhaW47IGNoYXJzZXQ9dXRmLTgnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gUHJvZHVjdGlvbiBjYWNoZSBidXN0aW5nIGZvciBkb2N1bWVudHNcbiAgICAgICAgICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGZpbGVTdGF0cyA9IGZzLnN0YXRTeW5jKGZpbGVQYXRoVG9TZXJ2ZSk7XG4gICAgICAgICAgICAgIHJlcy5zZXQoe1xuICAgICAgICAgICAgICAgICdDYWNoZS1Db250cm9sJzogJ25vLWNhY2hlLCBuby1zdG9yZSwgbXVzdC1yZXZhbGlkYXRlJyxcbiAgICAgICAgICAgICAgICAnUHJhZ21hJzogJ25vLWNhY2hlJyxcbiAgICAgICAgICAgICAgICAnRXhwaXJlcyc6ICcwJyxcbiAgICAgICAgICAgICAgICAnRVRhZyc6IGBcIiR7ZG9jdW1lbnQuaWR9LSR7ZmlsZVN0YXRzLm10aW1lLmdldFRpbWUoKX1cImAsXG4gICAgICAgICAgICAgICAgJ0xhc3QtTW9kaWZpZWQnOiBmaWxlU3RhdHMubXRpbWUudG9VVENTdHJpbmcoKSxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IHRvdGFsVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgICAgIGxvZ0RvY3VtZW50T3BlcmF0aW9uKCdGSUxFX1NFUlZFX1NVQ0NFU1MnLCB7XG4gICAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgICBmaWxlUGF0aDogZmlsZVBhdGhUb1NlcnZlLFxuICAgICAgICAgICAgZmlsZU5hbWUsXG4gICAgICAgICAgICB0b3RhbFJlcXVlc3RUaW1lOiBgJHt0b3RhbFRpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgICAgICBpc0Rvd25sb2FkLFxuICAgICAgICAgICAgZmlsZURldGFpbHM6IHtcbiAgICAgICAgICAgICAgZXhpc3RzOiB0cnVlLFxuICAgICAgICAgICAgICByZXNvbHZlZFBhdGg6IHBhdGgucmVzb2x2ZShmaWxlUGF0aFRvU2VydmUpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgJ0lORk8nKTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4gcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShmaWxlUGF0aFRvU2VydmUpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjb25zdCB0b3RhbFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgICAgICBsb2dEb2N1bWVudE9wZXJhdGlvbignRklMRV9OT1RfRk9VTkRfT05fRElTSycsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgZG9jdW1lbnRJZCxcbiAgICAgICAgICAgIG9yaWdpbmFsRmlsZVBhdGg6IGRvY3VtZW50LmZpbGVQYXRoLFxuICAgICAgICAgICAgYXR0ZW1wdGVkRmlsZVBhdGg6IGZpbGVQYXRoVG9TZXJ2ZSxcbiAgICAgICAgICAgIHRvdGFsUmVxdWVzdFRpbWU6IGAke3RvdGFsVGltZS50b0ZpeGVkKDIpfW1zYCxcbiAgICAgICAgICAgIHNlYXJjaGVkUGF0aHM6IFtcbiAgICAgICAgICAgICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgZG9jdW1lbnQuZmlsZVBhdGgpLFxuICAgICAgICAgICAgICBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgZG9jdW1lbnQuZmlsZVBhdGgpLFxuICAgICAgICAgICAgICBgL3RtcC91cGxvYWRzLyR7ZG9jdW1lbnQuZmlsZVBhdGh9YFxuICAgICAgICAgICAgXVxuICAgICAgICAgIH0sICdFUlJPUicpO1xuICAgICAgICAgIFxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIG5vdCBmb3VuZCBvbiBzZXJ2ZXInIH0pO1xuICAgICAgICB9IGNhdGNoIChmaWxlRXJyb3I6IGFueSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRE9DVU1FTlQgRE9XTkxPQURdIEVycm9yIHNlcnZpbmcgZmlsZTonLCBmaWxlRXJyb3IpO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VydmUgZmlsZScgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlQgRE9XTkxPQURdIE5vIGZpbGUgYXNzb2NpYXRlZCB3aXRoIGRvY3VtZW50ICR7ZG9jdW1lbnRJZH1gKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdObyBmaWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRvY3VtZW50JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBFcnJvciBzZXJ2aW5nIGRvY3VtZW50IGZpbGU6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHNlcnZlIGRvY3VtZW50IGZpbGUnIH0pO1xuICAgIH1cbiAgfSk7XG5cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==