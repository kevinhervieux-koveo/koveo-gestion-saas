d5d918d41d42705f384375c3aa37f225
/**
 * Mock for file system operations to prevent hanging during tests
 */
const mockStats = {
    isFile: jest.fn().mockReturnValue(true),
    isDirectory: jest.fn().mockReturnValue(false),
    size: 1024,
    mtime: new Date(),
    ctime: new Date(),
    atime: new Date()
};
const mockFs = {
    // File operations
    readFileSync: jest.fn().mockReturnValue('mock file content'),
    writeFileSync: jest.fn(),
    readFile: jest.fn().mockImplementation((path, callback) => {
        if (typeof callback === 'function') {
            callback(null, 'mock file content');
        }
    }),
    writeFile: jest.fn().mockImplementation((path, data, callback) => {
        if (typeof callback === 'function') {
            callback(null);
        }
    }),
    // Directory operations
    mkdirSync: jest.fn(),
    mkdir: jest.fn().mockImplementation((path, options, callback) => {
        if (typeof options === 'function') {
            callback = options;
        }
        if (typeof callback === 'function') {
            callback(null);
        }
    }),
    readdirSync: jest.fn().mockReturnValue(['file1.txt', 'file2.txt']),
    readdir: jest.fn().mockImplementation((path, callback) => {
        callback(null, ['file1.txt', 'file2.txt']);
    }),
    // File existence and stats
    existsSync: jest.fn().mockReturnValue(true),
    exists: jest.fn().mockImplementation((path, callback) => {
        callback(true);
    }),
    statSync: jest.fn().mockReturnValue(mockStats),
    stat: jest.fn().mockImplementation((path, callback) => {
        callback(null, mockStats);
    }),
    lstatSync: jest.fn().mockReturnValue(mockStats),
    lstat: jest.fn().mockImplementation((path, callback) => {
        callback(null, mockStats);
    }),
    // File removal
    unlinkSync: jest.fn(),
    unlink: jest.fn().mockImplementation((path, callback) => {
        if (typeof callback === 'function') {
            callback(null);
        }
    }),
    rmSync: jest.fn(),
    rmdirSync: jest.fn(),
    rmdir: jest.fn().mockImplementation((path, callback) => {
        callback(null);
    }),
    // File access
    accessSync: jest.fn(),
    access: jest.fn().mockImplementation((path, mode, callback) => {
        if (typeof mode === 'function') {
            callback = mode;
        }
        callback(null);
    }),
    // Copy operations
    copyFileSync: jest.fn(),
    copyFile: jest.fn().mockImplementation((src, dest, callback) => {
        callback(null);
    }),
    // Constants
    constants: {
        F_OK: 0,
        R_OK: 4,
        W_OK: 2,
        X_OK: 1
    },
    // Streams
    createReadStream: jest.fn().mockReturnValue({
        pipe: jest.fn(),
        on: jest.fn(),
        once: jest.fn(),
        emit: jest.fn(),
        read: jest.fn(),
        destroy: jest.fn()
    }),
    createWriteStream: jest.fn().mockReturnValue({
        write: jest.fn(),
        end: jest.fn(),
        on: jest.fn(),
        once: jest.fn(),
        emit: jest.fn(),
        destroy: jest.fn()
    })
};
// Import real path to avoid breaking Jest internals
const realPath = require.cache[require.resolve('path')] ? require.cache[require.resolve('path')].exports : require('path');
// Create a more robust path mock that preserves core functionality
const mockPath = {
    // Use real implementations for core functions to avoid breaking Jest
    join: realPath.join,
    resolve: realPath.resolve,
    dirname: realPath.dirname,
    basename: realPath.basename,
    extname: realPath.extname,
    parse: realPath.parse,
    sep: realPath.sep,
    delimiter: realPath.delimiter,
    posix: realPath.posix,
    win32: realPath.win32,
    // Add any additional mock functionality if needed
    _isMocked: true
};
// Mock multer for file uploads
const mockMulter = jest.fn().mockImplementation((options = {}) => {
    const storage = options.storage || {};
    return {
        single: jest.fn().mockImplementation((fieldName) => (req, res, next) => {
            req.file = {
                fieldname: fieldName,
                originalname: 'test-file.txt',
                encoding: '7bit',
                mimetype: 'text/plain',
                buffer: Buffer.from('test content'),
                size: 12,
                filename: 'test-file.txt',
                path: '/mock/uploads/test-file.txt'
            };
            next();
        }),
        array: jest.fn().mockImplementation((fieldName, maxCount) => (req, res, next) => {
            req.files = [
                {
                    fieldname: fieldName,
                    originalname: 'test-file-1.txt',
                    encoding: '7bit',
                    mimetype: 'text/plain',
                    buffer: Buffer.from('test content 1'),
                    size: 14,
                    filename: 'test-file-1.txt',
                    path: '/mock/uploads/test-file-1.txt'
                }
            ];
            next();
        }),
        fields: jest.fn().mockImplementation((fields) => (req, res, next) => {
            req.files = {};
            fields.forEach(field => {
                req.files[field.name] = [{
                        fieldname: field.name,
                        originalname: `test-${field.name}.txt`,
                        encoding: '7bit',
                        mimetype: 'text/plain',
                        buffer: Buffer.from(`test content for ${field.name}`),
                        size: 20,
                        filename: `test-${field.name}.txt`,
                        path: `/mock/uploads/test-${field.name}.txt`
                    }];
            });
            next();
        }),
        any: jest.fn().mockImplementation(() => (req, res, next) => {
            req.files = [
                {
                    fieldname: 'files',
                    originalname: 'test-any.txt',
                    encoding: '7bit',
                    mimetype: 'text/plain',
                    buffer: Buffer.from('test any content'),
                    size: 16,
                    filename: 'test-any.txt',
                    path: '/mock/uploads/test-any.txt'
                }
            ];
            next();
        })
    };
});
// Mock multer storage engines
mockMulter.diskStorage = jest.fn().mockImplementation((options = {}) => ({
    _handleFile: jest.fn(),
    _removeFile: jest.fn()
}));
mockMulter.memoryStorage = jest.fn().mockImplementation(() => ({
    _handleFile: jest.fn(),
    _removeFile: jest.fn()
}));
module.exports = {
    fs: mockFs,
    path: mockPath,
    multer: mockMulter,
    default: mockFs
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9tb2Nrcy9maWxlU3lzdGVtTW9jay5qcyIsIm1hcHBpbmdzIjoiQUFBQTs7R0FFRztBQUVILE1BQU0sU0FBUyxHQUFHO0lBQ2hCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQztJQUN2QyxXQUFXLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUM7SUFDN0MsSUFBSSxFQUFFLElBQUk7SUFDVixLQUFLLEVBQUUsSUFBSSxJQUFJLEVBQUU7SUFDakIsS0FBSyxFQUFFLElBQUksSUFBSSxFQUFFO0lBQ2pCLEtBQUssRUFBRSxJQUFJLElBQUksRUFBRTtDQUNsQixDQUFDO0FBRUYsTUFBTSxNQUFNLEdBQUc7SUFDYixrQkFBa0I7SUFDbEIsWUFBWSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxlQUFlLENBQUMsbUJBQW1CLENBQUM7SUFDNUQsYUFBYSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDeEIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRTtRQUN4RCxJQUFJLE9BQU8sUUFBUSxLQUFLLFVBQVUsRUFBRSxDQUFDO1lBQ25DLFFBQVEsQ0FBQyxJQUFJLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUN0QyxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0lBQ0YsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLEVBQUU7UUFDL0QsSUFBSSxPQUFPLFFBQVEsS0FBSyxVQUFVLEVBQUUsQ0FBQztZQUNuQyxRQUFRLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDakIsQ0FBQztJQUNILENBQUMsQ0FBQztJQUVGLHVCQUF1QjtJQUN2QixTQUFTLEVBQUUsSUFBSSxD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RUFBRSxDQUFDLENBQUM7SUFDdkUsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDdEIsV0FBVyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDdkIsQ0FBQyxDQUFDLENBQUM7QUFFSixVQUFVLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdELFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQ3RCLFdBQVcsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0NBQ3ZCLENBQUMsQ0FBQyxDQUFDO0FBRUosTUFBTSxDQUFDLE9BQU8sR0FBRztJQUNmLEVBQUUsRUFBRSxNQUFNO0lBQ1YsSUFBSSxFQUFFLFFBQVE7SUFDZCxNQUFNLEVBQUUsVUFBVTtJQUNsQixPQUFPLEVBQUUsTUFBTTtDQUNoQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvbW9ja3MvZmlsZVN5c3RlbU1vY2suanMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNb2NrIGZvciBmaWxlIHN5c3RlbSBvcGVyYXRpb25zIHRvIHByZXZlbnQgaGFuZ2luZyBkdXJpbmcgdGVzdHNcbiAqL1xuXG5jb25zdCBtb2NrU3RhdHMgPSB7XG4gIGlzRmlsZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgaXNEaXJlY3Rvcnk6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpLFxuICBzaXplOiAxMDI0LFxuICBtdGltZTogbmV3IERhdGUoKSxcbiAgY3RpbWU6IG5ldyBEYXRlKCksXG4gIGF0aW1lOiBuZXcgRGF0ZSgpXG59O1xuXG5jb25zdCBtb2NrRnMgPSB7XG4gIC8vIEZpbGUgb3BlcmF0aW9uc1xuICByZWFkRmlsZVN5bmM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoJ21vY2sgZmlsZSBjb250ZW50JyksXG4gIHdyaXRlRmlsZVN5bmM6IGplc3QuZm4oKSxcbiAgcmVhZEZpbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGgsIGNhbGxiYWNrKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2FsbGJhY2sobnVsbCwgJ21vY2sgZmlsZSBjb250ZW50Jyk7XG4gICAgfVxuICB9KSxcbiAgd3JpdGVGaWxlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoLCBkYXRhLCBjYWxsYmFjaykgPT4ge1xuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgIH1cbiAgfSksXG4gIFxuICAvLyBEaXJlY3Rvcnkgb3BlcmF0aW9uc1xuICBta2RpclN5bmM6IGplc3QuZm4oKSxcbiAgbWtkaXI6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGgsIG9wdGlvbnMsIGNhbGxiYWNrKSA9PiB7XG4gICAgaWYgKHR5cGVvZiBvcHRpb25zID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYWxsYmFjayA9IG9wdGlvbnM7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FsbGJhY2sgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIGNhbGxiYWNrKG51bGwpO1xuICAgIH1cbiAgfSksXG4gIHJlYWRkaXJTeW5jOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKFsnZmlsZTEudHh0JywgJ2ZpbGUyLnR4dCddKSxcbiAgcmVhZGRpcjogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCwgY2FsbGJhY2spID0+IHtcbiAgICBjYWxsYmFjayhudWxsLCBbJ2ZpbGUxLnR4dCcsICdmaWxlMi50eHQnXSk7XG4gIH0pLFxuICBcbiAgLy8gRmlsZSBleGlzdGVuY2UgYW5kIHN0YXRzXG4gIGV4aXN0c1N5bmM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUodHJ1ZSksXG4gIGV4aXN0czogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCwgY2FsbGJhY2spID0+IHtcbiAgICBjYWxsYmFjayh0cnVlKTtcbiAgfSksXG4gIHN0YXRTeW5jOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKG1vY2tTdGF0cyksXG4gIHN0YXQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGgsIGNhbGxiYWNrKSA9PiB7XG4gICAgY2FsbGJhY2sobnVsbCwgbW9ja1N0YXRzKTtcbiAgfSksXG4gIGxzdGF0U3luYzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZShtb2NrU3RhdHMpLFxuICBsc3RhdDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCwgY2FsbGJhY2spID0+IHtcbiAgICBjYWxsYmFjayhudWxsLCBtb2NrU3RhdHMpO1xuICB9KSxcbiAgXG4gIC8vIEZpbGUgcmVtb3ZhbFxuICB1bmxpbmtTeW5jOiBqZXN0LmZuKCksXG4gIHVubGluazogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aCwgY2FsbGJhY2spID0+IHtcbiAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBjYWxsYmFjayhudWxsKTtcbiAgICB9XG4gIH0pLFxuICBybVN5bmM6IGplc3QuZm4oKSxcbiAgcm1kaXJTeW5jOiBqZXN0LmZuKCksXG4gIHJtZGlyOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoLCBjYWxsYmFjaykgPT4ge1xuICAgIGNhbGxiYWNrKG51bGwpO1xuICB9KSxcbiAgXG4gIC8vIEZpbGUgYWNjZXNzXG4gIGFjY2Vzc1N5bmM6IGplc3QuZm4oKSxcbiAgYWNjZXNzOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoLCBtb2RlLCBjYWxsYmFjaykgPT4ge1xuICAgIGlmICh0eXBlb2YgbW9kZSA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgY2FsbGJhY2sgPSBtb2RlO1xuICAgIH1cbiAgICBjYWxsYmFjayhudWxsKTtcbiAgfSksXG4gIFxuICAvLyBDb3B5IG9wZXJhdGlvbnNcbiAgY29weUZpbGVTeW5jOiBqZXN0LmZuKCksXG4gIGNvcHlGaWxlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChzcmMsIGRlc3QsIGNhbGxiYWNrKSA9PiB7XG4gICAgY2FsbGJhY2sobnVsbCk7XG4gIH0pLFxuICBcbiAgLy8gQ29uc3RhbnRzXG4gIGNvbnN0YW50czoge1xuICAgIEZfT0s6IDAsXG4gICAgUl9PSzogNCxcbiAgICBXX09LOiAyLFxuICAgIFhfT0s6IDFcbiAgfSxcbiAgXG4gIC8vIFN0cmVhbXNcbiAgY3JlYXRlUmVhZFN0cmVhbTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgcGlwZTogamVzdC5mbigpLFxuICAgIG9uOiBqZXN0LmZuKCksXG4gICAgb25jZTogamVzdC5mbigpLFxuICAgIGVtaXQ6IGplc3QuZm4oKSxcbiAgICByZWFkOiBqZXN0LmZuKCksXG4gICAgZGVzdHJveTogamVzdC5mbigpXG4gIH0pLFxuICBjcmVhdGVXcml0ZVN0cmVhbTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgd3JpdGU6IGplc3QuZm4oKSxcbiAgICBlbmQ6IGplc3QuZm4oKSxcbiAgICBvbjogamVzdC5mbigpLFxuICAgIG9uY2U6IGplc3QuZm4oKSxcbiAgICBlbWl0OiBqZXN0LmZuKCksXG4gICAgZGVzdHJveTogamVzdC5mbigpXG4gIH0pXG59O1xuXG4vLyBJbXBvcnQgcmVhbCBwYXRoIHRvIGF2b2lkIGJyZWFraW5nIEplc3QgaW50ZXJuYWxzXG5jb25zdCByZWFsUGF0aCA9IHJlcXVpcmUuY2FjaGVbcmVxdWlyZS5yZXNvbHZlKCdwYXRoJyldID8gcmVxdWlyZS5jYWNoZVtyZXF1aXJlLnJlc29sdmUoJ3BhdGgnKV0uZXhwb3J0cyA6IHJlcXVpcmUoJ3BhdGgnKTtcblxuLy8gQ3JlYXRlIGEgbW9yZSByb2J1c3QgcGF0aCBtb2NrIHRoYXQgcHJlc2VydmVzIGNvcmUgZnVuY3Rpb25hbGl0eVxuY29uc3QgbW9ja1BhdGggPSB7XG4gIC8vIFVzZSByZWFsIGltcGxlbWVudGF0aW9ucyBmb3IgY29yZSBmdW5jdGlvbnMgdG8gYXZvaWQgYnJlYWtpbmcgSmVzdFxuICBqb2luOiByZWFsUGF0aC5qb2luLFxuICByZXNvbHZlOiByZWFsUGF0aC5yZXNvbHZlLFxuICBkaXJuYW1lOiByZWFsUGF0aC5kaXJuYW1lLFxuICBiYXNlbmFtZTogcmVhbFBhdGguYmFzZW5hbWUsXG4gIGV4dG5hbWU6IHJlYWxQYXRoLmV4dG5hbWUsXG4gIHBhcnNlOiByZWFsUGF0aC5wYXJzZSxcbiAgc2VwOiByZWFsUGF0aC5zZXAsXG4gIGRlbGltaXRlcjogcmVhbFBhdGguZGVsaW1pdGVyLFxuICBwb3NpeDogcmVhbFBhdGgucG9zaXgsXG4gIHdpbjMyOiByZWFsUGF0aC53aW4zMixcbiAgXG4gIC8vIEFkZCBhbnkgYWRkaXRpb25hbCBtb2NrIGZ1bmN0aW9uYWxpdHkgaWYgbmVlZGVkXG4gIF9pc01vY2tlZDogdHJ1ZVxufTtcblxuLy8gTW9jayBtdWx0ZXIgZm9yIGZpbGUgdXBsb2Fkc1xuY29uc3QgbW9ja011bHRlciA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCBzdG9yYWdlID0gb3B0aW9ucy5zdG9yYWdlIHx8IHt9O1xuICBcbiAgcmV0dXJuIHtcbiAgICBzaW5nbGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGZpZWxkTmFtZSkgPT4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXEuZmlsZSA9IHtcbiAgICAgICAgZmllbGRuYW1lOiBmaWVsZE5hbWUsXG4gICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QtZmlsZS50eHQnLFxuICAgICAgICBlbmNvZGluZzogJzdiaXQnLFxuICAgICAgICBtaW1ldHlwZTogJ3RleHQvcGxhaW4nLFxuICAgICAgICBidWZmZXI6IEJ1ZmZlci5mcm9tKCd0ZXN0IGNvbnRlbnQnKSxcbiAgICAgICAgc2l6ZTogMTIsXG4gICAgICAgIGZpbGVuYW1lOiAndGVzdC1maWxlLnR4dCcsXG4gICAgICAgIHBhdGg6ICcvbW9jay91cGxvYWRzL3Rlc3QtZmlsZS50eHQnXG4gICAgICB9O1xuICAgICAgbmV4dCgpO1xuICAgIH0pLFxuICAgIFxuICAgIGFycmF5OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChmaWVsZE5hbWUsIG1heENvdW50KSA9PiAocmVxLCByZXMsIG5leHQpID0+IHtcbiAgICAgIHJlcS5maWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGZpZWxkbmFtZTogZmllbGROYW1lLFxuICAgICAgICAgIG9yaWdpbmFsbmFtZTogJ3Rlc3QtZmlsZS0xLnR4dCcsXG4gICAgICAgICAgZW5jb2Rpbmc6ICc3Yml0JyxcbiAgICAgICAgICBtaW1ldHlwZTogJ3RleHQvcGxhaW4nLFxuICAgICAgICAgIGJ1ZmZlcjogQnVmZmVyLmZyb20oJ3Rlc3QgY29udGVudCAxJyksXG4gICAgICAgICAgc2l6ZTogMTQsXG4gICAgICAgICAgZmlsZW5hbWU6ICd0ZXN0LWZpbGUtMS50eHQnLFxuICAgICAgICAgIHBhdGg6ICcvbW9jay91cGxvYWRzL3Rlc3QtZmlsZS0xLnR4dCdcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIG5leHQoKTtcbiAgICB9KSxcbiAgICBcbiAgICBmaWVsZHM6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKGZpZWxkcykgPT4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXEuZmlsZXMgPSB7fTtcbiAgICAgIGZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgcmVxLmZpbGVzW2ZpZWxkLm5hbWVdID0gW3tcbiAgICAgICAgICBmaWVsZG5hbWU6IGZpZWxkLm5hbWUsXG4gICAgICAgICAgb3JpZ2luYWxuYW1lOiBgdGVzdC0ke2ZpZWxkLm5hbWV9LnR4dGAsXG4gICAgICAgICAgZW5jb2Rpbmc6ICc3Yml0JyxcbiAgICAgICAgICBtaW1ldHlwZTogJ3RleHQvcGxhaW4nLFxuICAgICAgICAgIGJ1ZmZlcjogQnVmZmVyLmZyb20oYHRlc3QgY29udGVudCBmb3IgJHtmaWVsZC5uYW1lfWApLFxuICAgICAgICAgIHNpemU6IDIwLFxuICAgICAgICAgIGZpbGVuYW1lOiBgdGVzdC0ke2ZpZWxkLm5hbWV9LnR4dGAsXG4gICAgICAgICAgcGF0aDogYC9tb2NrL3VwbG9hZHMvdGVzdC0ke2ZpZWxkLm5hbWV9LnR4dGBcbiAgICAgICAgfV07XG4gICAgICB9KTtcbiAgICAgIG5leHQoKTtcbiAgICB9KSxcbiAgICBcbiAgICBhbnk6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHJlcSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgICByZXEuZmlsZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBmaWVsZG5hbWU6ICdmaWxlcycsXG4gICAgICAgICAgb3JpZ2luYWxuYW1lOiAndGVzdC1hbnkudHh0JyxcbiAgICAgICAgICBlbmNvZGluZzogJzdiaXQnLFxuICAgICAgICAgIG1pbWV0eXBlOiAndGV4dC9wbGFpbicsXG4gICAgICAgICAgYnVmZmVyOiBCdWZmZXIuZnJvbSgndGVzdCBhbnkgY29udGVudCcpLFxuICAgICAgICAgIHNpemU6IDE2LFxuICAgICAgICAgIGZpbGVuYW1lOiAndGVzdC1hbnkudHh0JyxcbiAgICAgICAgICBwYXRoOiAnL21vY2svdXBsb2Fkcy90ZXN0LWFueS50eHQnXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICBuZXh0KCk7XG4gICAgfSlcbiAgfTtcbn0pO1xuXG4vLyBNb2NrIG11bHRlciBzdG9yYWdlIGVuZ2luZXNcbm1vY2tNdWx0ZXIuZGlza1N0b3JhZ2UgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKChvcHRpb25zID0ge30pID0+ICh7XG4gIF9oYW5kbGVGaWxlOiBqZXN0LmZuKCksXG4gIF9yZW1vdmVGaWxlOiBqZXN0LmZuKClcbn0pKTtcblxubW9ja011bHRlci5tZW1vcnlTdG9yYWdlID0gamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICBfaGFuZGxlRmlsZTogamVzdC5mbigpLFxuICBfcmVtb3ZlRmlsZTogamVzdC5mbigpXG59KSk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBmczogbW9ja0ZzLFxuICBwYXRoOiBtb2NrUGF0aCxcbiAgbXVsdGVyOiBtb2NrTXVsdGVyLFxuICBkZWZhdWx0OiBtb2NrRnNcbn07Il0sInZlcnNpb24iOjN9