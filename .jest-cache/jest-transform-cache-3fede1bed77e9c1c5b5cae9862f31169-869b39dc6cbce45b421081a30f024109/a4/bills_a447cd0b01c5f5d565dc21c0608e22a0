76ae1d8c08beb7061c4648a2ee906537
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerBillRoutes = registerBillRoutes;
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
const auth_1 = require("../auth");
const storage_1 = require("../storage");
const zod_1 = require("zod");
const bill_generation_service_1 = require("../services/bill-generation-service");
const delayed_update_service_1 = require("../services/delayed-update-service");
const gemini_bill_analyzer_1 = require("../services/gemini-bill-analyzer");
const geminiService_1 = require("../services/geminiService");
const fileUpload_1 = require("../middleware/fileUpload");
const express_rate_limit_1 = __importStar(require("express-rate-limit"));
const multer_1 = __importDefault(require("multer"));
const fs_1 = __importDefault(require("fs"));
const schema = __importStar(require("@shared/schema"));
const { buildings, bills } = schema;
// Database-driven bills - no more mock data
// Validation schemas
const billFilterSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
    category: zod_1.z.string().optional(),
    year: zod_1.z.string().optional(),
    status: zod_1.z.enum(['all', 'draft', 'sent', 'overdue', 'paid', 'cancelled']).optional(),
    months: zod_1.z.string().optional(), // Comma-separated month numbers (e.g., "1,3,6,12")
});
const createBillSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
    title: zod_1.z.string().min(1),
    description: zod_1.z.string().optional(),
    category: zod_1.z.enum([
        'insurance',
        'maintenance',
        'salary',
        'utilities',
        'cleaning',
        'security',
        'landscaping',
        'professional_services',
        'administration',
        'repairs',
        'supplies',
        'taxes',
        'technology',
        'reserves',
        'other',
    ]),
    vendor: zod_1.z.string().optional(),
    paymentType: zod_1.z.enum(['unique', 'recurrent']),
    schedulePayment: zod_1.z.enum(['weekly', 'monthly', 'quarterly', 'yearly', 'custom']).optional(),
    scheduleCustom: zod_1.z.array(zod_1.z.string()).optional(),
    costs: zod_1.z.array(zod_1.z.string()),
    totalAmount: zod_1.z.string(),
    startDate: zod_1.z.string(),
    endDate: zod_1.z.string().optional(),
    status: zod_1.z.enum(['draft', 'sent', 'overdue', 'paid', 'cancelled']),
    notes: zod_1.z.string().optional(),
});
const updateBillSchema = createBillSchema.partial();
// Rate limiting for AI extraction endpoint (expensive operation)
const extractionRateLimit = (0, express_rate_limit_1.default)({
    windowMs: 15 * 60 * 1000, // 15 minutes
    max: 10, // Limit each user to 10 extraction requests per windowMs
    message: {
        error: 'Too many extraction requests',
        message: 'Please wait before making another extraction request',
        code: 'RATE_LIMIT_EXCEEDED'
    },
    standardHeaders: true, // Return rate limit info in the `RateLimit-*` headers
    legacyHeaders: false, // Disable the `X-RateLimit-*` headers
    keyGenerator: (req) => {
        // Rate limit per authenticated user ID (preferred) or use IP as fallback with IPv6 support
        return req.user?.id || (0, express_rate_limit_1.ipKeyGenerator)(req);
    },
    skip: (req) => {
        // Skip rate limiting if user is not authenticated (handled by requireAuth)
        return !req.user?.id;
    }
});
// Configure multer for file uploads
const upload = (0, multer_1.default)({
    dest: '/tmp/uploads/',
    fileFilter: (req, file, cb) => {
        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
        if (allowedTypes.includes(file.mimetype)) {
            cb(null, true);
        }
        else {
            cb(new Error('Only image and PDF files are allowed'));
        }
    },
    limits: {
        fileSize: 10 * 1024 * 1024, // 10MB limit
    },
});
/**
 *
 * @param app
 */
/**
 * RegisterBillRoutes function.
 * @param app
 * @returns Function result.
 */
function registerBillRoutes(app) {
    /**
     * POST /api/bills/extract-data
     * Extract bill data from uploaded file using Gemini AI.
     *
     * Security: Requires authentication, rate limiting, and file validation.
     * File Types: PDF, JPEG, PNG, WebP, HEIC, HEIF
     * Max Size: 25MB
     */
    app.post('/api/bills/extract-data', auth_1.requireAuth, extractionRateLimit, fileUpload_1.uploadInvoiceFile, fileUpload_1.handleUploadError, async (req, res) => {
        const startTime = Date.now();
        const userId = req.user.id;
        const userRole = req.user.role;
        console.log(`[BILL EXTRACTION] Starting extraction for user ${userId} (${userRole})`);
        try {
            // Validate file upload
            if (!req.file) {
                console.log(`[BILL EXTRACTION] No file uploaded by user ${userId}`);
                return res.status(400).json({
                    error: 'No file uploaded',
                    message: 'Please upload a bill file',
                    code: 'NO_FILE'
                });
            }
            const { buffer, mimetype, originalname, size } = req.file;
            console.log(`[BILL EXTRACTION] Processing file for user ${userId}:`, {
                filename: originalname,
                mimetype,
                size: `${Math.round(size / 1024)}KB`
            });
            // Call Gemini service for bill extraction
            const extractedData = await geminiService_1.geminiService.extractBillData(buffer, mimetype);
            console.log(`[BILL EXTRACTION] Extraction completed for user ${userId} in ${Date.now() - startTime}ms`);
            // Return successful response
            res.status(200).json({
                success: true,
                data: extractedData,
                metadata: {
                    confidence: 0.9, // Could be calculated based on field completeness
                    processingTime: Date.now() - startTime,
                    filename: originalname,
                    fileSize: size
                }
            });
        }
        catch (error) {
            console.error(`[BILL EXTRACTION] Error for user ${userId}:`, error);
            // Handle different error types
            if (error.message?.includes('Unsupported file type')) {
                return res.status(400).json({
                    error: 'Unsupported file type',
                    message: 'Please upload a PDF or image file (JPEG, PNG, WebP, HEIC, HEIF)',
                    code: 'UNSUPPORTED_FILE_TYPE'
                });
            }
            else if (error.message?.includes('FILE_TOO_LARGE')) {
                return res.status(400).json({
                    error: 'File too large',
                    message: 'Please upload a file smaller than 25MB',
                    code: 'FILE_TOO_LARGE'
                });
            }
            else if (error.message?.includes('GEMINI_API_KEY')) {
                return res.status(500).json({
                    error: 'AI service configuration error',
                    message: 'AI extraction service is temporarily unavailable',
                    code: 'GEMINI_API_ERROR'
                });
            }
            // Generic error response
            res.status(500).json({
                error: 'Extraction failed',
                message: 'Failed to extract bill data. Please try again.',
                code: 'EXTRACTION_ERROR'
            });
        }
    });
    /**
     * Get all bills with optional filtering
     * GET /api/bills?buildingId=uuid&category=insurance&year=2024&status=draft&months=1,3,6.
     */
    app.get('/api/bills', auth_1.requireAuth, async (req, res) => {
        try {
            const { buildingId, category, year, status = 'all', months } = req.query;
            // Build the WHERE conditions
            const conditions = [];
            if (buildingId && buildingId !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.buildingId, buildingId));
            }
            if (category && category !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.category, category));
            }
            if (year) {
                conditions.push((0, drizzle_orm_1.sql) `EXTRACT(YEAR FROM ${bills.startDate}) = ${year}`);
            }
            if (status && status !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.status, status));
            }
            if (months) {
                const monthNumbers = months.split(',').map((m) => parseInt(m.trim()));
                const monthConditions = monthNumbers.map((month) => (0, drizzle_orm_1.sql) `EXTRACT(MONTH FROM ${bills.startDate}) = ${month}`);
                conditions.push((0, drizzle_orm_1.sql) `(${drizzle_orm_1.sql.join(monthConditions, (0, drizzle_orm_1.sql) ` OR `)})`);
            }
            const whereClause = conditions.length > 0 ? (0, drizzle_orm_1.and)(...conditions) : undefined;
            const billsList = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where(whereClause)
                .orderBy((0, drizzle_orm_1.desc)(bills.startDate));
            res.json(billsList);
        }
        catch (_error) {
            console.error('❌ Error fetching bills:', _error);
            res.status(500).json({
                message: 'Failed to fetch bills',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get a specific bill by ID
     * GET /api/bills/:id.
     */
    app.get('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                filePath: bills.filePath,
                fileName: bills.fileName,
                fileSize: bills.fileSize,
                isAiAnalyzed: bills.isAiAnalyzed,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json(bill[0]);
        }
        catch (_error) {
            console.error('❌ Error fetching bill:', _error);
            res.status(500).json({
                message: 'Failed to fetch bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Create a new bill
     * POST /api/bills.
     */
    app.post('/api/bills', auth_1.requireAuth, async (req, res) => {
        try {
            const validation = createBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const newBill = await db_1.db
                .insert(bills)
                .values({
                buildingId: billData.buildingId,
                billNumber: `BILL-${Date.now()}`,
                title: billData.title,
                description: billData.description,
                category: billData.category,
                vendor: billData.vendor,
                paymentType: billData.paymentType,
                schedulePayment: billData.schedulePayment,
                scheduleCustom: billData.scheduleCustom,
                costs: billData.costs.map((cost) => parseFloat(cost)),
                totalAmount: parseFloat(billData.totalAmount),
                startDate: billData.startDate,
                endDate: billData.endDate || null,
                status: billData.status,
                notes: billData.notes,
                createdBy: req.user.id,
            })
                .returning();
            // Schedule delayed money flow and budget update for the new bill
            try {
                delayed_update_service_1.delayedUpdateService.scheduleBillUpdate(newBill[0].id);
            }
            catch (schedulingError) {
                console.warn('⚠️ Failed to schedule bill update:', schedulingError);
                // Don't fail the bill creation if scheduling fails
            }
            res.status(201).json(newBill[0]);
        }
        catch (_error) {
            console.error('❌ Error creating bill:', _error);
            res.status(500).json({
                message: 'Failed to create bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Update a bill (PATCH)
     * PATCH /api/bills/:id.
     */
    app.patch('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const validation = updateBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const updateData = {};
            if (billData.title) {
                updateData.title = billData.title;
            }
            if (billData.description) {
                updateData.description = billData.description;
            }
            if (billData.category) {
                updateData.category = billData.category;
            }
            if (billData.vendor) {
                updateData.vendor = billData.vendor;
            }
            if (billData.paymentType) {
                updateData.paymentType = billData.paymentType;
            }
            if (billData.costs) {
                updateData.costs = billData.costs.map((cost) => parseFloat(cost));
            }
            if (billData.totalAmount) {
                updateData.totalAmount = parseFloat(billData.totalAmount);
            }
            if (billData.startDate) {
                updateData.startDate = billData.startDate;
            }
            if (billData.endDate) {
                updateData.endDate = billData.endDate;
            }
            if (billData.status) {
                updateData.status = billData.status;
            }
            if (billData.notes) {
                updateData.notes = billData.notes;
            }
            updateData.updatedAt = new Date();
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            if (updatedBill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json(updatedBill[0]);
        }
        catch (_error) {
            console.error('❌ Error updating bill (PATCH):', _error);
            res.status(500).json({
                message: 'Failed to update bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Update a bill (PUT)
     * PUT /api/bills/:id.
     */
    app.put('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const validation = updateBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const updateData = {};
            if (billData.title) {
                updateData.title = billData.title;
            }
            if (billData.description) {
                updateData.description = billData.description;
            }
            if (billData.category) {
                updateData.category = billData.category;
            }
            if (billData.vendor) {
                updateData.vendor = billData.vendor;
            }
            if (billData.paymentType) {
                updateData.paymentType = billData.paymentType;
            }
            if (billData.costs) {
                updateData.costs = billData.costs.map((cost) => parseFloat(cost));
            }
            if (billData.totalAmount) {
                updateData.totalAmount = parseFloat(billData.totalAmount);
            }
            if (billData.startDate) {
                updateData.startDate = billData.startDate;
            }
            if (billData.status) {
                updateData.status = billData.status;
            }
            if (billData.notes) {
                updateData.notes = billData.notes;
            }
            updateData.updatedAt = new Date();
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            if (updatedBill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Schedule delayed money flow and budget update for the updated bill
            try {
                delayed_update_service_1.delayedUpdateService.scheduleBillUpdate(id);
            }
            catch (schedulingError) {
                console.warn('⚠️ Failed to schedule bill update:', schedulingError);
                // Don't fail the bill update if scheduling fails
            }
            res.json(updatedBill[0]);
        }
        catch (_error) {
            console.error('❌ Error updating bill (PUT):', _error);
            res.status(500).json({
                message: 'Failed to update bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Delete a bill
     * DELETE /api/bills/:id.
     */
    app.delete('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const deletedBill = await db_1.db.delete(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).returning();
            if (!deletedBill || (Array.isArray(deletedBill) && deletedBill.length === 0)) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json({
                message: 'Bill deleted successfully',
                bill: deletedBill[0],
            });
        }
        catch (_error) {
            console.error('❌ Error deleting bill:', _error);
            res.status(500).json({
                message: 'Failed to delete bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Upload and analyze bill document with Gemini AI
     * POST /api/bills/:id/upload-document.
     */
    app.post('/api/bills/:id/upload-document', auth_1.requireAuth, upload.single('document'), async (req, res) => {
        console.log(`📄 [BILLS UPLOAD] Starting document upload for bill ID: ${req.params.id}`);
        console.log(`📄 [BILLS UPLOAD] User: ${req.user.id} (${req.user.role})`);
        try {
            const { id } = req.params;
            if (!req.file) {
                console.log('❌ [BILLS UPLOAD] No file provided in request');
                return res.status(400).json({ message: 'No file uploaded' });
            }
            console.log(`📄 [BILLS UPLOAD] File received:`, {
                originalName: req.file.originalname,
                mimeType: req.file.mimetype,
                size: req.file.size,
                tempPath: req.file.path
            });
            // Get organization ID for document organization
            const organizations = await storage_1.storage.getUserOrganizations(req.user.id);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : 'default';
            console.log(`📄 [BILLS UPLOAD] Organization ID determined: ${organizationId}`);
            // Create document path in the expected format
            const filePath = `prod_org_${organizationId}/${req.file.originalname}`;
            console.log(`📄 [BILLS UPLOAD] File path determined: ${filePath}`);
            // Create uploads directory structure if it doesn't exist
            const path = await Promise.resolve().then(() => __importStar(require('path')));
            const uploadsDir = path.join(process.cwd(), 'uploads');
            const orgDir = path.join(uploadsDir, `prod_org_${organizationId}`);
            console.log(`📄 [BILLS UPLOAD] Directory paths:`, {
                uploadsDir,
                orgDir,
                uploadsExists: fs_1.default.existsSync(uploadsDir),
                orgDirExists: fs_1.default.existsSync(orgDir)
            });
            if (!fs_1.default.existsSync(uploadsDir)) {
                fs_1.default.mkdirSync(uploadsDir, { recursive: true });
                console.log(`📄 [BILLS UPLOAD] Created uploads directory: ${uploadsDir}`);
            }
            if (!fs_1.default.existsSync(orgDir)) {
                fs_1.default.mkdirSync(orgDir, { recursive: true });
                console.log(`📄 [BILLS UPLOAD] Created organization directory: ${orgDir}`);
            }
            // Save file to permanent storage
            const permanentFilePath = path.join(uploadsDir, filePath);
            console.log(`📄 [BILLS UPLOAD] Copying file from ${req.file.path} to ${permanentFilePath}`);
            fs_1.default.copyFileSync(req.file.path, permanentFilePath);
            console.log(`📄 [BILLS UPLOAD] File successfully saved to permanent storage`);
            // Analyze document with Gemini AI (images and PDFs)
            let analysisResult = null;
            if (req.file.mimetype.startsWith('image/') || req.file.mimetype === 'application/pdf') {
                console.log(`🤖 [BILLS UPLOAD] Starting AI analysis for ${req.file.mimetype} file`);
                try {
                    analysisResult = await gemini_bill_analyzer_1.geminiBillAnalyzer.analyzeBillDocument(req.file.path, req.file.mimetype);
                    console.log(`🤖 [BILLS UPLOAD] AI analysis successful:`, {
                        hasResult: !!analysisResult,
                        analysisKeys: analysisResult ? Object.keys(analysisResult) : []
                    });
                }
                catch (aiError) {
                    console.warn('🤖 [BILLS UPLOAD] AI analysis failed, continuing without analysis:', aiError);
                    // Continue without AI analysis
                }
            }
            else {
                console.log(`🤖 [BILLS UPLOAD] Skipping AI analysis for unsupported file type: ${req.file.mimetype}`);
            }
            // Update bill with document info and AI analysis
            const updateData = {
                filePath,
                fileName: req.file.originalname,
                fileSize: req.file.size,
                isAiAnalyzed: !!analysisResult,
                aiAnalysisData: analysisResult,
                updatedAt: new Date(),
            };
            console.log(`📄 [BILLS UPLOAD] Updating bill ${id} in database with:`, {
                filePath,
                fileName: req.file.originalname,
                fileSize: req.file.size,
                hasAiAnalysis: !!analysisResult
            });
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            console.log(`📄 [BILLS UPLOAD] Database update successful for bill ${id}`);
            // Clean up temporary file
            console.log(`📄 [BILLS UPLOAD] Cleaning up temporary file: ${req.file.path}`);
            fs_1.default.unlinkSync(req.file.path);
            console.log(`✅ [BILLS UPLOAD] Upload process completed successfully for bill ${id}`);
            res.json({
                message: 'Document uploaded and analyzed successfully',
                bill: updatedBill[0],
                analysisResult,
            });
        }
        catch (_error) {
            console.error('❌ Error uploading document:', _error);
            // Clean up temporary file if it exists
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (___cleanupError) {
                    console.error('Error cleaning up temp file:', ___cleanupError);
                }
            }
            res.status(500).json({
                message: 'Failed to upload document',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Download bill document using secure signed URL
     * GET /api/bills/:id/download-document.
     */
    app.get('/api/bills/:id/download-document', auth_1.requireAuth, async (req, res) => {
        console.log(`📥 [BILLS DOWNLOAD] Document download request for bill ID: ${req.params.id}`);
        console.log(`📥 [BILLS DOWNLOAD] User: ${req.user.id} (${req.user.role})`);
        try {
            const { id } = req.params;
            // Get the bill to check if it has a document
            console.log(`📥 [BILLS DOWNLOAD] Querying database for bill: ${id}`);
            const bill = await db_1.db.select().from(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).limit(1);
            if (bill.length === 0) {
                console.log(`❌ [BILLS DOWNLOAD] Bill not found: ${id}`);
                return res.status(404).json({ message: 'Bill not found' });
            }
            const billData = bill[0];
            console.log(`📥 [BILLS DOWNLOAD] Bill found:`, {
                id: billData.id,
                hasFilePath: !!billData.filePath,
                hasFileName: !!billData.fileName,
                filePath: billData.filePath,
                fileName: billData.fileName
            });
            if (!billData.filePath || !billData.fileName) {
                console.log(`❌ [BILLS DOWNLOAD] No document associated with bill ${id}`);
                return res.status(404).json({ message: 'No document associated with this bill' });
            }
            // Get organization ID for document access
            const organizations = await storage_1.storage.getUserOrganizations(req.user.id);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : 'default';
            // Serve the file directly from local storage
            const path = await Promise.resolve().then(() => __importStar(require('path')));
            const uploadsDir = path.join(process.cwd(), 'uploads');
            const fileFullPath = path.join(uploadsDir, billData.filePath);
            console.log(`📥 [BILLS DOWNLOAD] File paths:`, {
                uploadsDir,
                filePath: billData.filePath,
                fullFilePath: fileFullPath,
                fileName: billData.fileName,
                organizationId
            });
            // Check if file exists
            if (!fs_1.default.existsSync(fileFullPath)) {
                console.log(`❌ [BILLS DOWNLOAD] File not found at path: ${fileFullPath}`);
                return res.status(404).json({ message: 'Document file not found on server' });
            }
            console.log(`📥 [BILLS DOWNLOAD] File found, setting headers and sending...`);
            // Set appropriate headers for file download
            res.setHeader('Content-Disposition', `attachment; filename="${billData.fileName}"`);
            res.setHeader('Content-Type', 'application/octet-stream');
            // Stream the file
            console.log(`📥 [BILLS DOWNLOAD] Streaming file to client`);
            res.sendFile(fileFullPath);
            console.log(`✅ [BILLS DOWNLOAD] File download initiated successfully for bill ${id}`);
        }
        catch (_error) {
            console.error('❌ Error downloading document:', _error);
            res.status(500).json({
                message: 'Failed to download document',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Apply AI analysis to bill form data
     * POST /api/bills/:id/apply-ai-analysis.
     */
    app.post('/api/bills/:id/apply-ai-analysis', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            // Get the bill with AI analysis data
            const bill = await db_1.db.select().from(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).limit(1);
            if (bill.length === 0) {
                return res.status(404).json({ message: 'Bill not found' });
            }
            const billData = bill[0];
            if (!billData.isAiAnalyzed || !billData.aiAnalysisData) {
                return res.status(400).json({ message: 'No AI analysis data available for this bill' });
            }
            const analysis = billData.aiAnalysisData;
            // Get payment schedule suggestion
            const scheduleSignestion = await gemini_bill_analyzer_1.geminiBillAnalyzer.suggestPaymentSchedule(analysis.category, parseFloat(analysis.totalAmount));
            // Update bill with AI-extracted data
            const updateData = {
                title: analysis.title,
                vendor: analysis.vendor,
                totalAmount: parseFloat(analysis.totalAmount),
                category: analysis.category,
                description: analysis.description,
                paymentType: scheduleSignestion.paymentType,
                schedulePayment: scheduleSignestion.schedulePayment,
                costs: [parseFloat(analysis.totalAmount)],
                startDate: analysis.issueDate || analysis.dueDate || billData.startDate,
                notes: `AI-analyzed document. Original bill number: ${analysis.billNumber || 'N/A'}. Confidence: ${(analysis.confidence * 100).toFixed(1)}%. ${scheduleSignestion.reasoning}`,
                updatedAt: new Date(),
            };
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            res.json({
                message: 'AI analysis applied successfully',
                bill: updatedBill[0],
                analysis,
                scheduleSignestion,
            });
        }
        catch (_error) {
            console.error('❌ Error applying AI analysis:', _error);
            res.status(500).json({
                message: 'Failed to apply AI analysis',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Generate future bill instances for a recurrent bill
     * POST /api/bills/:id/generate-future.
     */
    app.post('/api/bills/:id/generate-future', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Check if user has access to this bill's building
            const building = await db_1.db
                .select({
                id: buildings.id,
                name: buildings.name,
                organizationId: buildings.organizationId,
            })
                .from(buildings)
                .where((0, drizzle_orm_1.eq)(buildings.id, bill[0].buildingId))
                .limit(1);
            if (building.length === 0) {
                return res.status(403).json({
                    message: 'Access denied to generate future bills',
                    code: 'ACCESS_DENIED',
                });
            }
            if (bill[0].paymentType !== 'recurrent') {
                return res.status(400).json({
                    message: 'Only recurrent bills can generate future instances',
                });
            }
            // Generate future bills
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(bill[0]);
            res.json({
                message: 'Future bills generated successfully',
                billsCreated: result.billsCreated,
                generatedUntil: result.generatedUntil,
            });
        }
        catch (_error) {
            console.error('❌ Error generating future bills:', _error);
            res.status(500).json({
                message: 'Failed to generate future bills',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get bill categories for filter dropdown
     * GET /api/bills/categories.
     */
    app.get('/api/bills/categories', auth_1.requireAuth, async (req, res) => {
        try {
            const categories = [
                'insurance',
                'maintenance',
                'salary',
                'utilities',
                'cleaning',
                'security',
                'landscaping',
                'professional_services',
                'administration',
                'repairs',
                'supplies',
                'taxes',
                'technology',
                'reserves',
                'other',
            ];
            res.json(categories);
        }
        catch (_error) {
            console.error('❌ Error fetching bill categories:', _error);
            res.status(500).json({
                message: 'Failed to fetch bill categories',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get statistics for auto-generated bills from a parent bill
     * GET /api/bills/:id/generated-stats.
     */
    app.get('/api/bills/:id/generated-stats', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Find all bills generated from this parent bill (look for auto-generated bills)
            const generatedBills = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.sql) `bills.notes LIKE '%Auto-generated from:%'`)
                .orderBy(bills.startDate);
            const stats = generatedBills.map((genBill) => ({
                id: genBill.id,
                title: genBill.title,
                amount: genBill.totalAmount,
                startDate: genBill.startDate,
                status: genBill.status,
                billNumber: genBill.billNumber,
            }));
            res.json({
                parentBill: bill[0],
                generatedBills: stats,
            });
        }
        catch (_error) {
            console.error('❌ Error getting generated bills statistics:', _error);
            res.status(500).json({
                message: 'Failed to get generated bills statistics',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Analyze document without creating a bill
     * POST /api/bills/analyze-document
     */
    app.post('/api/bills/analyze-document', auth_1.requireAuth, upload.single('document'), async (req, res) => {
        try {
            if (!req.file) {
                return res.status(400).json({
                    message: 'No document file provided',
                });
            }
            const analysis = await gemini_bill_analyzer_1.geminiBillAnalyzer.analyzeBillDocument(req.file.path);
            res.json(analysis);
        }
        catch (_error) {
            console.error('Error analyzing document:', _error);
            res.status(500).json({
                message: 'Failed to analyze document',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2JpbGxzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBZ0hBLGdEQTA3QkM7QUF6aUNELDZDQUF5RDtBQUN6RCw4QkFBMkI7QUFDM0Isa0NBQXNDO0FBQ3RDLHdDQUFxQztBQUNyQyw2QkFBd0I7QUFFeEIsaUZBQTRFO0FBQzVFLCtFQUEwRTtBQUMxRSwyRUFBc0U7QUFDdEUsNkRBQTBEO0FBQzFELHlEQUFnRjtBQUNoRix5RUFBK0Q7QUFDL0Qsb0RBQTRCO0FBRTVCLDRDQUFvQjtBQUNwQix1REFBeUM7QUFFekMsTUFBTSxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsR0FBRyxNQUFNLENBQUM7QUFFcEMsNENBQTRDO0FBRTVDLHFCQUFxQjtBQUNyQixNQUFNLGdCQUFnQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDaEMsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUU7SUFDN0IsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDL0IsSUFBSSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDM0IsTUFBTSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQ25GLE1BQU0sRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLEVBQUUsbURBQW1EO0NBQ25GLENBQUMsQ0FBQztBQUVILE1BQU0sZ0JBQWdCLEdBQUcsT0FBQyxDQUFDLE1BQU0sQ0FBQztJQUNoQyxVQUFVLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksRUFBRTtJQUM3QixLQUFLLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDeEIsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDbEMsUUFBUSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUM7UUFDZixXQUFXO1FBQ1gsYUFBYTtRQUNiLFFBQVE7UUFDUixXQUFXO1FBQ1gsVUFBVTtRQUNWLFVBQVU7UUFDVixhQUFhO1FBQ2IsdUJBQXVCO1FBQ3ZCLGdCQUFnQjtRQUNoQixTQUFTO1FBQ1QsVUFBVTtRQUNWLE9BQU87UUFDUCxZQUFZO1FBQ1osVUFBVTtRQUNWLE9BQU87S0FDUixDQUFDO0lBQ0YsTUFBTSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDN0IsV0FBVyxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7SUFDNUMsZUFBZSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUU7SUFDMUYsY0FBYyxFQUFFLE9BQUMsQ0FBQyxLQUFLLENBQUMsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUMsUUFBUSxFQUFFO0lBQzlDLEtBQUssRUFBRSxPQUFDLENBQUMsS0FBSyxDQUFDLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUMxQixXQUFXLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUN2QixTQUFTLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRTtJQUNyQixPQUFPLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtJQUM5QixNQUFNLEVBQUUsT0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztJQUNqRSxLQUFLLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsRUFBRTtDQUM3QixDQUFDLENBQUM7QUFFSCxNQUFNLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDLE9BQU8sRUFBRSxDQUFDO0FBRXBELGlFQUFpRTtBQUNqRSxNQUFNLG1CQUFtQixHQUFHLElBQUEsNEJBQVMsRUFBQztJQUNwQyxRQUFRLEVBQUUsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLEVBQUUsYUFBYTtJQUN2QyxHQUFHLEVBQUUsRUFBRSxFQUFFLHlEQUF5RDtJQUNsRSxPQUFPLEVBQUU7UUFDUCxLQUFLLEVBQUUsOEJBQThCO1FBQ3JDLE9BQU8sRUFBRSxzREFBc0Q7UUFDL0QsSUFBSSxFQUFFLHFCQUFxQjtLQUM1QjtJQUNELGVBQWUsRUFBRSxJQUFJLEVBQUUsc0RBQXNEO0lBQzdFLGFBQWEsRUFBRSxLQUFLLEVBQUUsc0NBQXNDO0lBQzVELFlBQVksRUFBRSxDQUFDLEdBQVEsRUFBRSxFQUFFO1FBQ3pCLDJGQUEyRjtRQUMzRixPQUFPLEdBQUcsQ0FBQyxJQUFJLEVBQUUsRUFBRSxJQUFJLElBQUEsbUNBQWMsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBQ0QsSUFBSSxFQUFFLENBQUMsR0FBUSxFQUFFLEVBQUU7UUFDakIsMkVBQTJFO1FBQzNFLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQztJQUN2QixDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsb0NBQW9DO0FBQ3BDLE1BQU0sTUFBTSxHQUFHLElBQUEsZ0JBQU0sRUFBQztJQUNwQixJQUFJLEVBQUUsZUFBZTtJQUNyQixVQUFVLEVBQUUsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFO1FBQzVCLE1BQU0sWUFBWSxHQUFHLENBQUMsWUFBWSxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztRQUNqRixJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDekMsRUFBRSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsQ0FBQztRQUNqQixDQUFDO2FBQU0sQ0FBQztZQUNOLEVBQUUsQ0FBQyxJQUFJLEtBQUssQ0FBQyxzQ0FBc0MsQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQztJQUNILENBQUM7SUFDRCxNQUFNLEVBQUU7UUFDTixRQUFRLEVBQUUsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJLEVBQUUsYUFBYTtLQUMxQztDQUNGLENBQUMsQ0FBQztBQUVIOzs7R0FHRztBQUNIOzs7O0dBSUc7QUFDSCxTQUFnQixrQkFBa0IsQ0FBQyxHQUFZO0lBQzdDOzs7Ozs7O09BT0c7SUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUNoQyxrQkFBVyxFQUNYLG1CQUFtQixFQUNuQiw4QkFBaUIsRUFDakIsOEJBQWlCLEVBQ2pCLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBYSxFQUFFLEVBQUU7UUFDaEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQzdCLE1BQU0sTUFBTSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQzNCLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDO1FBRS9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0RBQWtELE1BQU0sS0FBSyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1FBRXRGLElBQUksQ0FBQztZQUNILHVCQUF1QjtZQUN2QixJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNkLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLE1BQU0sRUFBRSxDQUFDLENBQUM7Z0JBQ3BFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLEtBQUssRUFBRSxrQkFBa0I7b0JBQ3pCLE9BQU8sRUFBRSwyQkFBMkI7b0JBQ3BDLElBQUksRUFBRSxTQUFTO2lCQUNoQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFFMUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsTUFBTSxHQUFHLEVBQUU7Z0JBQ25FLFFBQVEsRUFBRSxZQUFZO2dCQUN0QixRQUFRO2dCQUNSLElBQUksRUFBRSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJO2FBQ3JDLENBQUMsQ0FBQztZQUVILDBDQUEwQztZQUMxQyxNQUFNLGFBQWEsR0FBRyxNQUFNLDZCQUFhLENBQUMsZUFBZSxDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsQ0FBQztZQUU1RSxPQUFPLENBQUMsR0FBRyxDQUFDLG1EQUFtRCxNQUFNLE9BQU8sSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFNBQVMsSUFBSSxDQUFDLENBQUM7WUFFeEcsNkJBQTZCO1lBQzdCLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsSUFBSTtnQkFDYixJQUFJLEVBQUUsYUFBYTtnQkFDbkIsUUFBUSxFQUFFO29CQUNSLFVBQVUsRUFBRSxHQUFHLEVBQUUsa0RBQWtEO29CQUNuRSxjQUFjLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFNBQVM7b0JBQ3RDLFFBQVEsRUFBRSxZQUFZO29CQUN0QixRQUFRLEVBQUUsSUFBSTtpQkFDZjthQUNGLENBQUMsQ0FBQztRQUVMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLE1BQU0sR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBRXBFLCtCQUErQjtZQUMvQixJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLHVCQUF1QixDQUFDLEVBQUUsQ0FBQztnQkFDckQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsS0FBSyxFQUFFLHVCQUF1QjtvQkFDOUIsT0FBTyxFQUFFLGlFQUFpRTtvQkFDMUUsSUFBSSxFQUFFLHVCQUF1QjtpQkFDOUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztpQkFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztnQkFDckQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsS0FBSyxFQUFFLGdCQUFnQjtvQkFDdkIsT0FBTyxFQUFFLHdDQUF3QztvQkFDakQsSUFBSSxFQUFFLGdCQUFnQjtpQkFDdkIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztpQkFBTSxJQUFJLEtBQUssQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEVBQUUsQ0FBQztnQkFDckQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsS0FBSyxFQUFFLGdDQUFnQztvQkFDdkMsT0FBTyxFQUFFLGtEQUFrRDtvQkFDM0QsSUFBSSxFQUFFLGtCQUFrQjtpQkFDekIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHlCQUF5QjtZQUN6QixHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsS0FBSyxFQUFFLG1CQUFtQjtnQkFDMUIsT0FBTyxFQUFFLGdEQUFnRDtnQkFDekQsSUFBSSxFQUFFLGtCQUFrQjthQUN6QixDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUNGLENBQUM7SUFFRjs7O09BR0c7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDOUQsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE1BQU0sR0FBRyxLQUFLLEVBQUUsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQztZQUV6RSw2QkFBNkI7WUFDN0IsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBRXRCLElBQUksVUFBVSxJQUFJLFVBQVUsS0FBSyxLQUFLLEVBQUUsQ0FBQztnQkFDdkMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFBLGdCQUFFLEVBQUMsS0FBSyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBQ3BELENBQUM7WUFFRCxJQUFJLFFBQVEsSUFBSSxRQUFRLEtBQUssS0FBSyxFQUFFLENBQUM7Z0JBQ25DLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQztZQUNoRCxDQUFDO1lBRUQsSUFBSSxJQUFJLEVBQUUsQ0FBQztnQkFDVCxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUEsaUJBQUcsRUFBQSxxQkFBcUIsS0FBSyxDQUFDLFNBQVMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3hFLENBQUM7WUFFRCxJQUFJLE1BQU0sSUFBSSxNQUFNLEtBQUssS0FBSyxFQUFFLENBQUM7Z0JBQy9CLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUM1QyxDQUFDO1lBRUQsSUFBSSxNQUFNLEVBQUUsQ0FBQztnQkFDWCxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQVMsRUFBRSxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQzlFLE1BQU0sZUFBZSxHQUFHLFlBQVksQ0FBQyxHQUFHLENBQ3RDLENBQUMsS0FBYSxFQUFFLEVBQUUsQ0FBQyxJQUFBLGlCQUFHLEVBQUEsc0JBQXNCLEtBQUssQ0FBQyxTQUFTLE9BQU8sS0FBSyxFQUFFLENBQzFFLENBQUM7Z0JBQ0YsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFBLGlCQUFHLEVBQUEsSUFBSSxpQkFBRyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsSUFBQSxpQkFBRyxFQUFBLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNsRSxDQUFDO1lBRUQsTUFBTSxXQUFXLEdBQUcsVUFBVSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUEsaUJBQUcsRUFBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFFM0UsTUFBTSxTQUFTLEdBQUcsTUFBTSxPQUFFO2lCQUN2QixNQUFNLENBQUM7Z0JBQ04sRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFO2dCQUNaLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dCQUM1QixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUN4QixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07Z0JBQ3BCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQzlCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2dCQUNwQixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7YUFDM0IsQ0FBQztpQkFDRCxJQUFJLENBQUMsS0FBSyxDQUFDO2lCQUNYLEtBQUssQ0FBQyxXQUFXLENBQUM7aUJBQ2xCLE9BQU8sQ0FBQyxJQUFBLGtCQUFJLEVBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFFbEMsR0FBRyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN0QixDQUFDO1FBQUMsT0FBTyxNQUFXLEVBQUUsQ0FBQztZQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLHlCQUF5QixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2pELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsdUJBQXVCO2dCQUNoQyxNQUFNLEVBQUUsTUFBTSxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZTthQUNuRSxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtRQUNsRSxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUUxQixNQUFNLElBQUksR0FBRyxNQUFNLE9BQUU7aUJBQ2xCLE1BQU0sQ0FBQztnQkFDTixFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUU7Z0JBQ1osVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dCQUM1QixVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7Z0JBQzVCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO2dCQUM5QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtnQkFDcEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO2dCQUM5QixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07Z0JBQ3BCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUN4QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtnQkFDeEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO2dCQUNoQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2FBQzNCLENBQUM7aUJBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQztpQkFDWCxLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ3ZCLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVaLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDdEIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLGdCQUFnQjtpQkFDMUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUdELEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEIsQ0FBQztRQUFDLE9BQU8sTUFBVyxFQUFFLENBQUM7WUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyx3QkFBd0IsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNoRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLHNCQUFzQjtnQkFDL0IsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQVEsRUFBRSxFQUFFO1FBQy9ELElBQUksQ0FBQztZQUNILE1BQU0sVUFBVSxHQUFHLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFeEQsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsQ0FBQztnQkFDeEIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLG1CQUFtQjtvQkFDNUIsTUFBTSxFQUFFLFVBQVUsQ0FBQyxLQUFLLENBQUMsTUFBTTtpQkFDaEMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDakMsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFFO2lCQUNyQixNQUFNLENBQUMsS0FBSyxDQUFDO2lCQUNiLE1BQU0sQ0FBQztnQkFDTixVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7Z0JBQy9CLFVBQVUsRUFBRSxRQUFRLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDaEMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLO2dCQUNyQixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7Z0JBQ2pDLFFBQVEsRUFBRSxRQUFRLENBQUMsUUFBUTtnQkFDM0IsTUFBTSxFQUFFLFFBQVEsQ0FBQyxNQUFNO2dCQUN2QixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7Z0JBQ2pDLGVBQWUsRUFBRSxRQUFRLENBQUMsZUFBZTtnQkFDekMsY0FBYyxFQUFFLFFBQVEsQ0FBQyxjQUFjO2dCQUN2QyxLQUFLLEVBQUUsUUFBUSxDQUFDLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDckQsV0FBVyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO2dCQUM3QyxTQUFTLEVBQUUsUUFBUSxDQUFDLFNBQVM7Z0JBQzdCLE9BQU8sRUFBRSxRQUFRLENBQUMsT0FBTyxJQUFJLElBQUk7Z0JBQ2pDLE1BQU0sRUFBRSxRQUFRLENBQUMsTUFBTTtnQkFDdkIsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLO2dCQUNyQixTQUFTLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO2FBQ3ZCLENBQUM7aUJBQ0QsU0FBUyxFQUFFLENBQUM7WUFFZixpRUFBaUU7WUFDakUsSUFBSSxDQUFDO2dCQUNILDZDQUFvQixDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUN6RCxDQUFDO1lBQUMsT0FBTyxlQUFlLEVBQUUsQ0FBQztnQkFDekIsT0FBTyxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxlQUFlLENBQUMsQ0FBQztnQkFDcEUsbURBQW1EO1lBQ3JELENBQUM7WUFFRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuQyxDQUFDO1FBQUMsT0FBTyxNQUFXLEVBQUUsQ0FBQztZQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLHdCQUF3QixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ2hELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsdUJBQXVCO2dCQUNoQyxNQUFNLEVBQUUsTUFBTSxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZTthQUNuRSxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsS0FBSyxDQUFDLGdCQUFnQixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtRQUNwRSxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUMxQixNQUFNLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXhELElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3hCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxtQkFBbUI7b0JBQzVCLE1BQU0sRUFBRSxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU07aUJBQ2hDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDO1lBRWpDLE1BQU0sVUFBVSxHQUFRLEVBQUUsQ0FBQztZQUMzQixJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsVUFBVSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO1lBQ3BDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDekIsVUFBVSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDO1lBQ2hELENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDdEIsVUFBVSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO1lBQzFDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDcEIsVUFBVSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQ3RDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDekIsVUFBVSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDO1lBQ2hELENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsVUFBVSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDNUUsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN6QixVQUFVLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDNUQsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUN2QixVQUFVLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUM7WUFDNUMsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLE9BQU8sRUFBRSxDQUFDO2dCQUNyQixVQUFVLENBQUMsT0FBTyxHQUFHLFFBQVEsQ0FBQyxPQUFPLENBQUM7WUFDeEMsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNwQixVQUFVLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7WUFDdEMsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNuQixVQUFVLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUM7WUFDcEMsQ0FBQztZQUNELFVBQVUsQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUVsQyxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7aUJBQ3pCLE1BQU0sQ0FBQyxLQUFLLENBQUM7aUJBQ2IsR0FBRyxDQUFDLFVBQVUsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ3ZCLFNBQVMsRUFBRSxDQUFDO1lBRWYsSUFBSSxXQUFXLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUM3QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsZ0JBQWdCO2lCQUMxQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixDQUFDO1FBQUMsT0FBTyxNQUFXLEVBQUUsQ0FBQztZQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLGdDQUFnQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3hELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsdUJBQXVCO2dCQUNoQyxNQUFNLEVBQUUsTUFBTSxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZTthQUNuRSxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtRQUNsRSxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUMxQixNQUFNLFVBQVUsR0FBRyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXhELElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3hCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxtQkFBbUI7b0JBQzVCLE1BQU0sRUFBRSxVQUFVLENBQUMsS0FBSyxDQUFDLE1BQU07aUJBQ2hDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLFFBQVEsR0FBRyxVQUFVLENBQUMsSUFBSSxDQUFDO1lBRWpDLE1BQU0sVUFBVSxHQUFRLEVBQUUsQ0FBQztZQUMzQixJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsVUFBVSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDO1lBQ3BDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDekIsVUFBVSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDO1lBQ2hELENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQztnQkFDdEIsVUFBVSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO1lBQzFDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDcEIsVUFBVSxDQUFDLE1BQU0sR0FBRyxRQUFRLENBQUMsTUFBTSxDQUFDO1lBQ3RDLENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDekIsVUFBVSxDQUFDLFdBQVcsR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDO1lBQ2hELENBQUM7WUFDRCxJQUFJLFFBQVEsQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDbkIsVUFBVSxDQUFDLEtBQUssR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7WUFDNUUsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUN6QixVQUFVLENBQUMsV0FBVyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDNUQsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUN2QixVQUFVLENBQUMsU0FBUyxHQUFHLFFBQVEsQ0FBQyxTQUFTLENBQUM7WUFDNUMsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO2dCQUNwQixVQUFVLENBQUMsTUFBTSxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUM7WUFDdEMsQ0FBQztZQUNELElBQUksUUFBUSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNuQixVQUFVLENBQUMsS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUM7WUFDcEMsQ0FBQztZQUNELFVBQVUsQ0FBQyxTQUFTLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztZQUVsQyxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7aUJBQ3pCLE1BQU0sQ0FBQyxLQUFLLENBQUM7aUJBQ2IsR0FBRyxDQUFDLFVBQVUsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ3ZCLFNBQVMsRUFBRSxDQUFDO1lBRWYsSUFBSSxXQUFXLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUM3QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsZ0JBQWdCO2lCQUMxQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQscUVBQXFFO1lBQ3JFLElBQUksQ0FBQztnQkFDSCw2Q0FBb0IsQ0FBQyxrQkFBa0IsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM5QyxDQUFDO1lBQUMsT0FBTyxlQUFlLEVBQUUsQ0FBQztnQkFDekIsT0FBTyxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxlQUFlLENBQUMsQ0FBQztnQkFDcEUsaURBQWlEO1lBQ25ELENBQUM7WUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLE9BQU8sQ0FBQyxLQUFLLENBQUMsOEJBQThCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDdEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE9BQU8sRUFBRSx1QkFBdUI7Z0JBQ2hDLE1BQU0sRUFBRSxNQUFNLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxlQUFlO2FBQ25FLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILEdBQUcsQ0FBQyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQVEsRUFBRSxFQUFFO1FBQ3JFLElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO1lBRTFCLE1BQU0sV0FBVyxHQUFHLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUUvRSxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUMsSUFBSSxXQUFXLENBQUMsTUFBTSxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQzdFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxnQkFBZ0I7aUJBQzFCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSwyQkFBMkI7Z0JBQ3BDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2FBQ3JCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLE9BQU8sQ0FBQyxLQUFLLENBQUMsd0JBQXdCLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDaEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE9BQU8sRUFBRSx1QkFBdUI7Z0JBQ2hDLE1BQU0sRUFBRSxNQUFNLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxlQUFlO2FBQ25FLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILEdBQUcsQ0FBQyxJQUFJLENBQ04sZ0NBQWdDLEVBQ2hDLGtCQUFXLEVBQ1gsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFDekIsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtRQUMzQixPQUFPLENBQUMsR0FBRyxDQUFDLDJEQUEyRCxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDeEYsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQkFBMkIsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDO1FBRXpFLElBQUksQ0FBQztZQUNILE1BQU0sRUFBRSxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDO1lBRTFCLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO2dCQUM1RCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQztZQUMvRCxDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsRUFBRTtnQkFDOUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTtnQkFDbkMsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUTtnQkFDM0IsSUFBSSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtnQkFDbkIsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTthQUN4QixDQUFDLENBQUM7WUFFSCxnREFBZ0Q7WUFDaEQsTUFBTSxhQUFhLEdBQUcsTUFBTSxpQkFBTyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdEUsTUFBTSxjQUFjLEdBQ2xCLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7WUFFekUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpREFBaUQsY0FBYyxFQUFFLENBQUMsQ0FBQztZQUUvRSw4Q0FBOEM7WUFDOUMsTUFBTSxRQUFRLEdBQUcsWUFBWSxjQUFjLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztZQUN2RSxPQUFPLENBQUMsR0FBRyxDQUFDLDJDQUEyQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBRW5FLHlEQUF5RDtZQUN6RCxNQUFNLElBQUksR0FBRyx3REFBYSxNQUFNLEdBQUMsQ0FBQztZQUNsQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLENBQUMsQ0FBQztZQUN2RCxNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRSxZQUFZLGNBQWMsRUFBRSxDQUFDLENBQUM7WUFFbkUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQ0FBb0MsRUFBRTtnQkFDaEQsVUFBVTtnQkFDVixNQUFNO2dCQUNOLGFBQWEsRUFBRSxZQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQztnQkFDeEMsWUFBWSxFQUFFLFlBQUUsQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDO2FBQ3BDLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxZQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7Z0JBQy9CLFlBQUUsQ0FBQyxTQUFTLENBQUMsVUFBVSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQzlDLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0RBQWdELFVBQVUsRUFBRSxDQUFDLENBQUM7WUFDNUUsQ0FBQztZQUNELElBQUksQ0FBQyxZQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7Z0JBQzNCLFlBQUUsQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Z0JBQzFDLE9BQU8sQ0FBQyxHQUFHLENBQUMscURBQXFELE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDN0UsQ0FBQztZQUVELGlDQUFpQztZQUNqQyxNQUFNLGlCQUFpQixHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1lBQzFELE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxPQUFPLGlCQUFpQixFQUFFLENBQUMsQ0FBQztZQUM1RixZQUFFLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLENBQUM7WUFDbEQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnRUFBZ0UsQ0FBQyxDQUFDO1lBRTlFLG9EQUFvRDtZQUNwRCxJQUFJLGNBQWMsR0FBRyxJQUFJLENBQUM7WUFDMUIsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEtBQUssaUJBQWlCLEVBQUUsQ0FBQztnQkFDdEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLE9BQU8sQ0FBQyxDQUFDO2dCQUNwRixJQUFJLENBQUM7b0JBQ0gsY0FBYyxHQUFHLE1BQU0seUNBQWtCLENBQUMsbUJBQW1CLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztvQkFDaEcsT0FBTyxDQUFDLEdBQUcsQ0FBQywyQ0FBMkMsRUFBRTt3QkFDdkQsU0FBUyxFQUFFLENBQUMsQ0FBQyxjQUFjO3dCQUMzQixZQUFZLEVBQUUsY0FBYyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFO3FCQUNoRSxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFBQyxPQUFPLE9BQU8sRUFBRSxDQUFDO29CQUNqQixPQUFPLENBQUMsSUFBSSxDQUFDLG9FQUFvRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO29CQUM1RiwrQkFBK0I7Z0JBQ2pDLENBQUM7WUFDSCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyxxRUFBcUUsR0FBRyxDQUFDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3hHLENBQUM7WUFFRCxpREFBaUQ7WUFDakQsTUFBTSxVQUFVLEdBQVk7Z0JBQzFCLFFBQVE7Z0JBQ1IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsWUFBWTtnQkFDL0IsUUFBUSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSTtnQkFDdkIsWUFBWSxFQUFFLENBQUMsQ0FBQyxjQUFjO2dCQUM5QixjQUFjLEVBQUUsY0FBYztnQkFDOUIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCLENBQUM7WUFFRixPQUFPLENBQUMsR0FBRyxDQUFDLG1DQUFtQyxFQUFFLG9CQUFvQixFQUFFO2dCQUNyRSxRQUFRO2dCQUNSLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLFlBQVk7Z0JBQy9CLFFBQVEsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUk7Z0JBQ3ZCLGFBQWEsRUFBRSxDQUFDLENBQUMsY0FBYzthQUNoQyxDQUFDLENBQUM7WUFFSCxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7aUJBQ3pCLE1BQU0sQ0FBQyxLQUFLLENBQUM7aUJBQ2IsR0FBRyxDQUFDLFVBQVUsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7aUJBQ3ZCLFNBQVMsRUFBRSxDQUFDO1lBRWYsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5REFBeUQsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUUzRSwwQkFBMEI7WUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxpREFBaUQsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQzlFLFlBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUU3QixPQUFPLENBQUMsR0FBRyxDQUFDLG1FQUFtRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO1lBRXJGLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLDZDQUE2QztnQkFDdEQsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3BCLGNBQWM7YUFDZixDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxNQUFXLEVBQUUsQ0FBQztZQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLDZCQUE2QixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRXJELHVDQUF1QztZQUN2QyxJQUFJLEdBQUcsQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUM7Z0JBQ25CLElBQUksQ0FBQztvQkFDSCxZQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQUMsT0FBTyxlQUFlLEVBQUUsQ0FBQztvQkFDekIsT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxlQUFlLENBQUMsQ0FBQztnQkFDakUsQ0FBQztZQUNILENBQUM7WUFFRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLDJCQUEyQjtnQkFDcEMsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FDRixDQUFDO0lBRUY7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0MsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDcEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4REFBOEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQzNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkJBQTZCLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxHQUFHLENBQUMsQ0FBQztRQUUzRSxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUUxQiw2Q0FBNkM7WUFDN0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtREFBbUQsRUFBRSxFQUFFLENBQUMsQ0FBQztZQUNyRSxNQUFNLElBQUksR0FBRyxNQUFNLE9BQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTVFLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDdEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQ0FBc0MsRUFBRSxFQUFFLENBQUMsQ0FBQztnQkFDeEQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLENBQUM7WUFDN0QsQ0FBQztZQUVELE1BQU0sUUFBUSxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN6QixPQUFPLENBQUMsR0FBRyxDQUFDLGlDQUFpQyxFQUFFO2dCQUM3QyxFQUFFLEVBQUUsUUFBUSxDQUFDLEVBQUU7Z0JBQ2YsV0FBVyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUTtnQkFDaEMsV0FBVyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUTtnQkFDaEMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxRQUFRO2dCQUMzQixRQUFRLEVBQUUsUUFBUSxDQUFDLFFBQVE7YUFDNUIsQ0FBQyxDQUFDO1lBRUgsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7Z0JBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdURBQXVELEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3pFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsdUNBQXVDLEVBQUUsQ0FBQyxDQUFDO1lBQ3BGLENBQUM7WUFFRCwwQ0FBMEM7WUFDMUMsTUFBTSxhQUFhLEdBQUcsTUFBTSxpQkFBTyxDQUFDLG9CQUFvQixDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdEUsTUFBTSxjQUFjLEdBQUcsYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztZQUU5Riw2Q0FBNkM7WUFDN0MsTUFBTSxJQUFJLEdBQUcsd0RBQWEsTUFBTSxHQUFDLENBQUM7WUFDbEMsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDdkQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTlELE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLEVBQUU7Z0JBQzdDLFVBQVU7Z0JBQ1YsUUFBUSxFQUFFLFFBQVEsQ0FBQyxRQUFRO2dCQUMzQixZQUFZLEVBQUUsWUFBWTtnQkFDMUIsUUFBUSxFQUFFLFFBQVEsQ0FBQyxRQUFRO2dCQUMzQixjQUFjO2FBQ2YsQ0FBQyxDQUFDO1lBRUgsdUJBQXVCO1lBQ3ZCLElBQUksQ0FBQyxZQUFFLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7Z0JBQ2pDLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLFlBQVksRUFBRSxDQUFDLENBQUM7Z0JBQzFFLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsbUNBQW1DLEVBQUUsQ0FBQyxDQUFDO1lBQ2hGLENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGdFQUFnRSxDQUFDLENBQUM7WUFFOUUsNENBQTRDO1lBQzVDLEdBQUcsQ0FBQyxTQUFTLENBQUMscUJBQXFCLEVBQUUseUJBQXlCLFFBQVEsQ0FBQyxRQUFRLEdBQUcsQ0FBQyxDQUFDO1lBQ3BGLEdBQUcsQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLDBCQUEwQixDQUFDLENBQUM7WUFFMUQsa0JBQWtCO1lBQ2xCLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLENBQUMsQ0FBQztZQUM1RCxHQUFHLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTNCLE9BQU8sQ0FBQyxHQUFHLENBQUMsb0VBQW9FLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFDeEYsQ0FBQztRQUFDLE9BQU8sTUFBVyxFQUFFLENBQUM7WUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQywrQkFBK0IsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUN2RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLDZCQUE2QjtnQkFDdEMsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLElBQUksQ0FBQyxrQ0FBa0MsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDckYsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7WUFFMUIscUNBQXFDO1lBQ3JDLE1BQU0sSUFBSSxHQUFHLE1BQU0sT0FBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFNUUsSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUN0QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQztZQUM3RCxDQUFDO1lBRUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXpCLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxJQUFJLENBQUMsUUFBUSxDQUFDLGNBQWMsRUFBRSxDQUFDO2dCQUN2RCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLDZDQUE2QyxFQUFFLENBQUMsQ0FBQztZQUMxRixDQUFDO1lBRUQsTUFBTSxRQUFRLEdBQUcsUUFBUSxDQUFDLGNBQXFCLENBQUM7WUFFaEQsa0NBQWtDO1lBQ2xDLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSx5Q0FBa0IsQ0FBQyxzQkFBc0IsQ0FDeEUsUUFBUSxDQUFDLFFBQVEsRUFDakIsVUFBVSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FDakMsQ0FBQztZQUVGLHFDQUFxQztZQUNyQyxNQUFNLFVBQVUsR0FBWTtnQkFDMUIsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLO2dCQUNyQixNQUFNLEVBQUUsUUFBUSxDQUFDLE1BQU07Z0JBQ3ZCLFdBQVcsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQztnQkFDN0MsUUFBUSxFQUFFLFFBQVEsQ0FBQyxRQUFRO2dCQUMzQixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7Z0JBQ2pDLFdBQVcsRUFBRSxrQkFBa0IsQ0FBQyxXQUFXO2dCQUMzQyxlQUFlLEVBQUUsa0JBQWtCLENBQUMsZUFBZTtnQkFDbkQsS0FBSyxFQUFFLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFDekMsU0FBUyxFQUFFLFFBQVEsQ0FBQyxTQUFTLElBQUksUUFBUSxDQUFDLE9BQU8sSUFBSSxRQUFRLENBQUMsU0FBUztnQkFDdkUsS0FBSyxFQUFFLCtDQUErQyxRQUFRLENBQUMsVUFBVSxJQUFJLEtBQUssaUJBQWlCLENBQUMsUUFBUSxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sa0JBQWtCLENBQUMsU0FBUyxFQUFFO2dCQUM3SyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQztZQUVGLE1BQU0sV0FBVyxHQUFHLE1BQU0sT0FBRTtpQkFDekIsTUFBTSxDQUFDLEtBQUssQ0FBQztpQkFDYixHQUFHLENBQUMsVUFBVSxDQUFDO2lCQUNmLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDdkIsU0FBUyxFQUFFLENBQUM7WUFFZixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxrQ0FBa0M7Z0JBQzNDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2dCQUNwQixRQUFRO2dCQUNSLGtCQUFrQjthQUNuQixDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxNQUFXLEVBQUUsQ0FBQztZQUNyQixPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixPQUFPLEVBQUUsNkJBQTZCO2dCQUN0QyxNQUFNLEVBQUUsTUFBTSxZQUFZLEtBQUssQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsZUFBZTthQUNuRSxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtRQUNuRixJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQztZQUUxQixNQUFNLElBQUksR0FBRyxNQUFNLE9BQUU7aUJBQ2xCLE1BQU0sQ0FBQztnQkFDTixFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUU7Z0JBQ1osVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dCQUM1QixVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7Z0JBQzVCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO2dCQUM5QixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7Z0JBQ3hCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtnQkFDcEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO2dCQUM5QixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07Z0JBQ3BCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUzthQUMzQixDQUFDO2lCQUNELElBQUksQ0FBQyxLQUFLLENBQUM7aUJBQ1gsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDO2lCQUN2QixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFWixJQUFJLElBQUksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ3RCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxnQkFBZ0I7aUJBQzFCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxtREFBbUQ7WUFDbkQsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFFO2lCQUN0QixNQUFNLENBQUM7Z0JBQ04sRUFBRSxFQUFFLFNBQVMsQ0FBQyxFQUFFO2dCQUNoQixJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7Z0JBQ3BCLGNBQWMsRUFBRSxTQUFTLENBQUMsY0FBYzthQUN6QyxDQUFDO2lCQUNELElBQUksQ0FBQyxTQUFTLENBQUM7aUJBQ2YsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxTQUFTLENBQUMsRUFBRSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQztpQkFDM0MsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUMxQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsd0NBQXdDO29CQUNqRCxJQUFJLEVBQUUsZUFBZTtpQkFDdEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLFdBQVcsS0FBSyxXQUFXLEVBQUUsQ0FBQztnQkFDeEMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLG9EQUFvRDtpQkFDOUQsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHdCQUF3QjtZQUN4QixNQUFNLE1BQU0sR0FBRyxNQUFNLCtDQUFxQixDQUFDLDJCQUEyQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQVEsQ0FBQyxDQUFDO1lBRXZGLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLHFDQUFxQztnQkFDOUMsWUFBWSxFQUFFLE1BQU0sQ0FBQyxZQUFZO2dCQUNqQyxjQUFjLEVBQUUsTUFBTSxDQUFDLGNBQWM7YUFDdEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sTUFBVyxFQUFFLENBQUM7WUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMxRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLGlDQUFpQztnQkFDMUMsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDekUsSUFBSSxDQUFDO1lBQ0gsTUFBTSxVQUFVLEdBQUc7Z0JBQ2pCLFdBQVc7Z0JBQ1gsYUFBYTtnQkFDYixRQUFRO2dCQUNSLFdBQVc7Z0JBQ1gsVUFBVTtnQkFDVixVQUFVO2dCQUNWLGFBQWE7Z0JBQ2IsdUJBQXVCO2dCQUN2QixnQkFBZ0I7Z0JBQ2hCLFNBQVM7Z0JBQ1QsVUFBVTtnQkFDVixPQUFPO2dCQUNQLFlBQVk7Z0JBQ1osVUFBVTtnQkFDVixPQUFPO2FBQ1IsQ0FBQztZQUVGLEdBQUcsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDdkIsQ0FBQztRQUFDLE9BQU8sTUFBVyxFQUFFLENBQUM7WUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUMzRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLGlDQUFpQztnQkFDMUMsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxnQ0FBZ0MsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDbEYsSUFBSSxDQUFDO1lBQ0gsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUM7WUFFMUIsTUFBTSxJQUFJLEdBQUcsTUFBTSxPQUFFO2lCQUNsQixNQUFNLENBQUM7Z0JBQ04sRUFBRSxFQUFFLEtBQUssQ0FBQyxFQUFFO2dCQUNaLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsVUFBVSxFQUFFLEtBQUssQ0FBQyxVQUFVO2dCQUM1QixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO2dCQUN4QixNQUFNLEVBQUUsS0FBSyxDQUFDLE1BQU07Z0JBQ3BCLFdBQVcsRUFBRSxLQUFLLENBQUMsV0FBVztnQkFDOUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQzlCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2dCQUNwQixLQUFLLEVBQUUsS0FBSyxDQUFDLEtBQUs7Z0JBQ2xCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2dCQUMxQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7YUFDM0IsQ0FBQztpQkFDRCxJQUFJLENBQUMsS0FBSyxDQUFDO2lCQUNYLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztpQkFDdkIsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxJQUFJLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUN0QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsZ0JBQWdCO2lCQUMxQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsaUZBQWlGO1lBQ2pGLE1BQU0sY0FBYyxHQUFHLE1BQU0sT0FBRTtpQkFDNUIsTUFBTSxDQUFDO2dCQUNOLEVBQUUsRUFBRSxLQUFLLENBQUMsRUFBRTtnQkFDWixVQUFVLEVBQUUsS0FBSyxDQUFDLFVBQVU7Z0JBQzVCLFVBQVUsRUFBRSxLQUFLLENBQUMsVUFBVTtnQkFDNUIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQzlCLFFBQVEsRUFBRSxLQUFLLENBQUMsUUFBUTtnQkFDeEIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO2dCQUNwQixXQUFXLEVBQUUsS0FBSyxDQUFDLFdBQVc7Z0JBQzlCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsV0FBVyxFQUFFLEtBQUssQ0FBQyxXQUFXO2dCQUM5QixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFCLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtnQkFDcEIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7Z0JBQzFCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztnQkFDMUIsU0FBUyxFQUFFLEtBQUssQ0FBQyxTQUFTO2FBQzNCLENBQUM7aUJBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQztpQkFDWCxLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFBLDJDQUEyQyxDQUFDO2lCQUNyRCxPQUFPLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTVCLE1BQU0sS0FBSyxHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzdDLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRTtnQkFDZCxLQUFLLEVBQUUsT0FBTyxDQUFDLEtBQUs7Z0JBQ3BCLE1BQU0sRUFBRSxPQUFPLENBQUMsV0FBVztnQkFDM0IsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTO2dCQUM1QixNQUFNLEVBQUUsT0FBTyxDQUFDLE1BQU07Z0JBQ3RCLFVBQVUsRUFBRSxPQUFPLENBQUMsVUFBVTthQUMvQixDQUFDLENBQUMsQ0FBQztZQUVKLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsVUFBVSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUM7Z0JBQ25CLGNBQWMsRUFBRSxLQUFLO2FBQ3RCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLE1BQVcsRUFBRSxDQUFDO1lBQ3JCLE9BQU8sQ0FBQyxLQUFLLENBQUMsNkNBQTZDLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFDckUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE9BQU8sRUFBRSwwQ0FBMEM7Z0JBQ25ELE1BQU0sRUFBRSxNQUFNLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxlQUFlO2FBQ25FLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILEdBQUcsQ0FBQyxJQUFJLENBQUMsNkJBQTZCLEVBQUUsa0JBQVcsRUFBRSxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7UUFDM0csSUFBSSxDQUFDO1lBQ0gsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDZCxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsMkJBQTJCO2lCQUNyQyxDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxRQUFRLEdBQUcsTUFBTSx5Q0FBa0IsQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRTdFLEdBQUcsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckIsQ0FBQztRQUFDLE9BQU8sTUFBVyxFQUFFLENBQUM7WUFDckIsT0FBTyxDQUFDLEtBQUssQ0FBQywyQkFBMkIsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNuRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLDRCQUE0QjtnQkFDckMsTUFBTSxFQUFFLE1BQU0sWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDbkUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvYmlsbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBFeHByZXNzLCBSZXF1ZXN0LCBSZXNwb25zZSB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgZXEsIGRlc2MsIGFuZCwgc3FsLCBpc051bGwgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uL2RiJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgeyBzdG9yYWdlIH0gZnJvbSAnLi4vc3RvcmFnZSc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCB7IG1vbmV5Rmxvd0pvYiB9IGZyb20gJy4uL2pvYnMvbW9uZXlfZmxvd19qb2InO1xuaW1wb3J0IHsgYmlsbEdlbmVyYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvYmlsbC1nZW5lcmF0aW9uLXNlcnZpY2UnO1xuaW1wb3J0IHsgZGVsYXllZFVwZGF0ZVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9kZWxheWVkLXVwZGF0ZS1zZXJ2aWNlJztcbmltcG9ydCB7IGdlbWluaUJpbGxBbmFseXplciB9IGZyb20gJy4uL3NlcnZpY2VzL2dlbWluaS1iaWxsLWFuYWx5emVyJztcbmltcG9ydCB7IGdlbWluaVNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9nZW1pbmlTZXJ2aWNlJztcbmltcG9ydCB7IHVwbG9hZEludm9pY2VGaWxlLCBoYW5kbGVVcGxvYWRFcnJvciB9IGZyb20gJy4uL21pZGRsZXdhcmUvZmlsZVVwbG9hZCc7XG5pbXBvcnQgcmF0ZUxpbWl0LCB7IGlwS2V5R2VuZXJhdG9yIH0gZnJvbSAnZXhwcmVzcy1yYXRlLWxpbWl0JztcbmltcG9ydCBtdWx0ZXIgZnJvbSAnbXVsdGVyJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5cbmNvbnN0IHsgYnVpbGRpbmdzLCBiaWxscyB9ID0gc2NoZW1hO1xuXG4vLyBEYXRhYmFzZS1kcml2ZW4gYmlsbHMgLSBubyBtb3JlIG1vY2sgZGF0YVxuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGJpbGxGaWx0ZXJTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJ1aWxkaW5nSWQ6IHouc3RyaW5nKCkudXVpZCgpLFxuICBjYXRlZ29yeTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB5ZWFyOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0YXR1czogei5lbnVtKFsnYWxsJywgJ2RyYWZ0JywgJ3NlbnQnLCAnb3ZlcmR1ZScsICdwYWlkJywgJ2NhbmNlbGxlZCddKS5vcHRpb25hbCgpLFxuICBtb250aHM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSwgLy8gQ29tbWEtc2VwYXJhdGVkIG1vbnRoIG51bWJlcnMgKGUuZy4sIFwiMSwzLDYsMTJcIilcbn0pO1xuXG5jb25zdCBjcmVhdGVCaWxsU2NoZW1hID0gei5vYmplY3Qoe1xuICBidWlsZGluZ0lkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgdGl0bGU6IHouc3RyaW5nKCkubWluKDEpLFxuICBkZXNjcmlwdGlvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBjYXRlZ29yeTogei5lbnVtKFtcbiAgICAnaW5zdXJhbmNlJyxcbiAgICAnbWFpbnRlbmFuY2UnLFxuICAgICdzYWxhcnknLFxuICAgICd1dGlsaXRpZXMnLFxuICAgICdjbGVhbmluZycsXG4gICAgJ3NlY3VyaXR5JyxcbiAgICAnbGFuZHNjYXBpbmcnLFxuICAgICdwcm9mZXNzaW9uYWxfc2VydmljZXMnLFxuICAgICdhZG1pbmlzdHJhdGlvbicsXG4gICAgJ3JlcGFpcnMnLFxuICAgICdzdXBwbGllcycsXG4gICAgJ3RheGVzJyxcbiAgICAndGVjaG5vbG9neScsXG4gICAgJ3Jlc2VydmVzJyxcbiAgICAnb3RoZXInLFxuICBdKSxcbiAgdmVuZG9yOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHBheW1lbnRUeXBlOiB6LmVudW0oWyd1bmlxdWUnLCAncmVjdXJyZW50J10pLFxuICBzY2hlZHVsZVBheW1lbnQ6IHouZW51bShbJ3dlZWtseScsICdtb250aGx5JywgJ3F1YXJ0ZXJseScsICd5ZWFybHknLCAnY3VzdG9tJ10pLm9wdGlvbmFsKCksXG4gIHNjaGVkdWxlQ3VzdG9tOiB6LmFycmF5KHouc3RyaW5nKCkpLm9wdGlvbmFsKCksXG4gIGNvc3RzOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICB0b3RhbEFtb3VudDogei5zdHJpbmcoKSxcbiAgc3RhcnREYXRlOiB6LnN0cmluZygpLFxuICBlbmREYXRlOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIHN0YXR1czogei5lbnVtKFsnZHJhZnQnLCAnc2VudCcsICdvdmVyZHVlJywgJ3BhaWQnLCAnY2FuY2VsbGVkJ10pLFxuICBub3Rlczogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IHVwZGF0ZUJpbGxTY2hlbWEgPSBjcmVhdGVCaWxsU2NoZW1hLnBhcnRpYWwoKTtcblxuLy8gUmF0ZSBsaW1pdGluZyBmb3IgQUkgZXh0cmFjdGlvbiBlbmRwb2ludCAoZXhwZW5zaXZlIG9wZXJhdGlvbilcbmNvbnN0IGV4dHJhY3Rpb25SYXRlTGltaXQgPSByYXRlTGltaXQoe1xuICB3aW5kb3dNczogMTUgKiA2MCAqIDEwMDAsIC8vIDE1IG1pbnV0ZXNcbiAgbWF4OiAxMCwgLy8gTGltaXQgZWFjaCB1c2VyIHRvIDEwIGV4dHJhY3Rpb24gcmVxdWVzdHMgcGVyIHdpbmRvd01zXG4gIG1lc3NhZ2U6IHtcbiAgICBlcnJvcjogJ1RvbyBtYW55IGV4dHJhY3Rpb24gcmVxdWVzdHMnLFxuICAgIG1lc3NhZ2U6ICdQbGVhc2Ugd2FpdCBiZWZvcmUgbWFraW5nIGFub3RoZXIgZXh0cmFjdGlvbiByZXF1ZXN0JyxcbiAgICBjb2RlOiAnUkFURV9MSU1JVF9FWENFRURFRCdcbiAgfSxcbiAgc3RhbmRhcmRIZWFkZXJzOiB0cnVlLCAvLyBSZXR1cm4gcmF0ZSBsaW1pdCBpbmZvIGluIHRoZSBgUmF0ZUxpbWl0LSpgIGhlYWRlcnNcbiAgbGVnYWN5SGVhZGVyczogZmFsc2UsIC8vIERpc2FibGUgdGhlIGBYLVJhdGVMaW1pdC0qYCBoZWFkZXJzXG4gIGtleUdlbmVyYXRvcjogKHJlcTogYW55KSA9PiB7XG4gICAgLy8gUmF0ZSBsaW1pdCBwZXIgYXV0aGVudGljYXRlZCB1c2VyIElEIChwcmVmZXJyZWQpIG9yIHVzZSBJUCBhcyBmYWxsYmFjayB3aXRoIElQdjYgc3VwcG9ydFxuICAgIHJldHVybiByZXEudXNlcj8uaWQgfHwgaXBLZXlHZW5lcmF0b3IocmVxKTtcbiAgfSxcbiAgc2tpcDogKHJlcTogYW55KSA9PiB7XG4gICAgLy8gU2tpcCByYXRlIGxpbWl0aW5nIGlmIHVzZXIgaXMgbm90IGF1dGhlbnRpY2F0ZWQgKGhhbmRsZWQgYnkgcmVxdWlyZUF1dGgpXG4gICAgcmV0dXJuICFyZXEudXNlcj8uaWQ7XG4gIH1cbn0pO1xuXG4vLyBDb25maWd1cmUgbXVsdGVyIGZvciBmaWxlIHVwbG9hZHNcbmNvbnN0IHVwbG9hZCA9IG11bHRlcih7XG4gIGRlc3Q6ICcvdG1wL3VwbG9hZHMvJyxcbiAgZmlsZUZpbHRlcjogKHJlcSwgZmlsZSwgY2IpID0+IHtcbiAgICBjb25zdCBhbGxvd2VkVHlwZXMgPSBbJ2ltYWdlL2pwZWcnLCAnaW1hZ2UvcG5nJywgJ2ltYWdlL2dpZicsICdhcHBsaWNhdGlvbi9wZGYnXTtcbiAgICBpZiAoYWxsb3dlZFR5cGVzLmluY2x1ZGVzKGZpbGUubWltZXR5cGUpKSB7XG4gICAgICBjYihudWxsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IobmV3IEVycm9yKCdPbmx5IGltYWdlIGFuZCBQREYgZmlsZXMgYXJlIGFsbG93ZWQnKSk7XG4gICAgfVxuICB9LFxuICBsaW1pdHM6IHtcbiAgICBmaWxlU2l6ZTogMTAgKiAxMDI0ICogMTAyNCwgLy8gMTBNQiBsaW1pdFxuICB9LFxufSk7XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBhcHBcbiAqL1xuLyoqXG4gKiBSZWdpc3RlckJpbGxSb3V0ZXMgZnVuY3Rpb24uXG4gKiBAcGFyYW0gYXBwXG4gKiBAcmV0dXJucyBGdW5jdGlvbiByZXN1bHQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckJpbGxSb3V0ZXMoYXBwOiBFeHByZXNzKSB7XG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvYmlsbHMvZXh0cmFjdC1kYXRhXG4gICAqIEV4dHJhY3QgYmlsbCBkYXRhIGZyb20gdXBsb2FkZWQgZmlsZSB1c2luZyBHZW1pbmkgQUkuXG4gICAqIFxuICAgKiBTZWN1cml0eTogUmVxdWlyZXMgYXV0aGVudGljYXRpb24sIHJhdGUgbGltaXRpbmcsIGFuZCBmaWxlIHZhbGlkYXRpb24uXG4gICAqIEZpbGUgVHlwZXM6IFBERiwgSlBFRywgUE5HLCBXZWJQLCBIRUlDLCBIRUlGXG4gICAqIE1heCBTaXplOiAyNU1CXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9iaWxscy9leHRyYWN0LWRhdGEnLCBcbiAgICByZXF1aXJlQXV0aCxcbiAgICBleHRyYWN0aW9uUmF0ZUxpbWl0LFxuICAgIHVwbG9hZEludm9pY2VGaWxlLFxuICAgIGhhbmRsZVVwbG9hZEVycm9yLFxuICAgIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyLmlkO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSByZXEudXNlci5yb2xlO1xuXG4gICAgICBjb25zb2xlLmxvZyhgW0JJTEwgRVhUUkFDVElPTl0gU3RhcnRpbmcgZXh0cmFjdGlvbiBmb3IgdXNlciAke3VzZXJJZH0gKCR7dXNlclJvbGV9KWApO1xuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBWYWxpZGF0ZSBmaWxlIHVwbG9hZFxuICAgICAgICBpZiAoIXJlcS5maWxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYFtCSUxMIEVYVFJBQ1RJT05dIE5vIGZpbGUgdXBsb2FkZWQgYnkgdXNlciAke3VzZXJJZH1gKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6ICdObyBmaWxlIHVwbG9hZGVkJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdQbGVhc2UgdXBsb2FkIGEgYmlsbCBmaWxlJyxcbiAgICAgICAgICAgIGNvZGU6ICdOT19GSUxFJ1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBidWZmZXIsIG1pbWV0eXBlLCBvcmlnaW5hbG5hbWUsIHNpemUgfSA9IHJlcS5maWxlO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYFtCSUxMIEVYVFJBQ1RJT05dIFByb2Nlc3NpbmcgZmlsZSBmb3IgdXNlciAke3VzZXJJZH06YCwge1xuICAgICAgICAgIGZpbGVuYW1lOiBvcmlnaW5hbG5hbWUsXG4gICAgICAgICAgbWltZXR5cGUsXG4gICAgICAgICAgc2l6ZTogYCR7TWF0aC5yb3VuZChzaXplIC8gMTAyNCl9S0JgXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENhbGwgR2VtaW5pIHNlcnZpY2UgZm9yIGJpbGwgZXh0cmFjdGlvblxuICAgICAgICBjb25zdCBleHRyYWN0ZWREYXRhID0gYXdhaXQgZ2VtaW5pU2VydmljZS5leHRyYWN0QmlsbERhdGEoYnVmZmVyLCBtaW1ldHlwZSk7XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhgW0JJTEwgRVhUUkFDVElPTl0gRXh0cmFjdGlvbiBjb21wbGV0ZWQgZm9yIHVzZXIgJHt1c2VySWR9IGluICR7RGF0ZS5ub3coKSAtIHN0YXJ0VGltZX1tc2ApO1xuXG4gICAgICAgIC8vIFJldHVybiBzdWNjZXNzZnVsIHJlc3BvbnNlXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIGRhdGE6IGV4dHJhY3RlZERhdGEsXG4gICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGNvbmZpZGVuY2U6IDAuOSwgLy8gQ291bGQgYmUgY2FsY3VsYXRlZCBiYXNlZCBvbiBmaWVsZCBjb21wbGV0ZW5lc3NcbiAgICAgICAgICAgIHByb2Nlc3NpbmdUaW1lOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuICAgICAgICAgICAgZmlsZW5hbWU6IG9yaWdpbmFsbmFtZSxcbiAgICAgICAgICAgIGZpbGVTaXplOiBzaXplXG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbQklMTCBFWFRSQUNUSU9OXSBFcnJvciBmb3IgdXNlciAke3VzZXJJZH06YCwgZXJyb3IpO1xuICAgICAgICBcbiAgICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCBlcnJvciB0eXBlc1xuICAgICAgICBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ1Vuc3VwcG9ydGVkIGZpbGUgdHlwZScpKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIGVycm9yOiAnVW5zdXBwb3J0ZWQgZmlsZSB0eXBlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdQbGVhc2UgdXBsb2FkIGEgUERGIG9yIGltYWdlIGZpbGUgKEpQRUcsIFBORywgV2ViUCwgSEVJQywgSEVJRiknLFxuICAgICAgICAgICAgY29kZTogJ1VOU1VQUE9SVEVEX0ZJTEVfVFlQRSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmIChlcnJvci5tZXNzYWdlPy5pbmNsdWRlcygnRklMRV9UT09fTEFSR0UnKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBlcnJvcjogJ0ZpbGUgdG9vIGxhcmdlJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdQbGVhc2UgdXBsb2FkIGEgZmlsZSBzbWFsbGVyIHRoYW4gMjVNQicsXG4gICAgICAgICAgICBjb2RlOiAnRklMRV9UT09fTEFSR0UnXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSBpZiAoZXJyb3IubWVzc2FnZT8uaW5jbHVkZXMoJ0dFTUlOSV9BUElfS0VZJykpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6ICdBSSBzZXJ2aWNlIGNvbmZpZ3VyYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0FJIGV4dHJhY3Rpb24gc2VydmljZSBpcyB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZScsXG4gICAgICAgICAgICBjb2RlOiAnR0VNSU5JX0FQSV9FUlJPUidcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdlbmVyaWMgZXJyb3IgcmVzcG9uc2VcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnRXh0cmFjdGlvbiBmYWlsZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZXh0cmFjdCBiaWxsIGRhdGEuIFBsZWFzZSB0cnkgYWdhaW4uJyxcbiAgICAgICAgICBjb2RlOiAnRVhUUkFDVElPTl9FUlJPUidcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBHZXQgYWxsIGJpbGxzIHdpdGggb3B0aW9uYWwgZmlsdGVyaW5nXG4gICAqIEdFVCAvYXBpL2JpbGxzP2J1aWxkaW5nSWQ9dXVpZCZjYXRlZ29yeT1pbnN1cmFuY2UmeWVhcj0yMDI0JnN0YXR1cz1kcmFmdCZtb250aHM9MSwzLDYuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2JpbGxzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBidWlsZGluZ0lkLCBjYXRlZ29yeSwgeWVhciwgc3RhdHVzID0gJ2FsbCcsIG1vbnRocyB9ID0gcmVxLnF1ZXJ5O1xuXG4gICAgICAvLyBCdWlsZCB0aGUgV0hFUkUgY29uZGl0aW9uc1xuICAgICAgY29uc3QgY29uZGl0aW9ucyA9IFtdO1xuXG4gICAgICBpZiAoYnVpbGRpbmdJZCAmJiBidWlsZGluZ0lkICE9PSAnYWxsJykge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoYmlsbHMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoY2F0ZWdvcnkgJiYgY2F0ZWdvcnkgIT09ICdhbGwnKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShiaWxscy5jYXRlZ29yeSwgY2F0ZWdvcnkpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHllYXIpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKHNxbGBFWFRSQUNUKFlFQVIgRlJPTSAke2JpbGxzLnN0YXJ0RGF0ZX0pID0gJHt5ZWFyfWApO1xuICAgICAgfVxuXG4gICAgICBpZiAoc3RhdHVzICYmIHN0YXR1cyAhPT0gJ2FsbCcpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGJpbGxzLnN0YXR1cywgc3RhdHVzKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChtb250aHMpIHtcbiAgICAgICAgY29uc3QgbW9udGhOdW1iZXJzID0gbW9udGhzLnNwbGl0KCcsJykubWFwKChtOiBzdHJpbmcpID0+IHBhcnNlSW50KG0udHJpbSgpKSk7XG4gICAgICAgIGNvbnN0IG1vbnRoQ29uZGl0aW9ucyA9IG1vbnRoTnVtYmVycy5tYXAoXG4gICAgICAgICAgKG1vbnRoOiBudW1iZXIpID0+IHNxbGBFWFRSQUNUKE1PTlRIIEZST00gJHtiaWxscy5zdGFydERhdGV9KSA9ICR7bW9udGh9YFxuICAgICAgICApO1xuICAgICAgICBjb25kaXRpb25zLnB1c2goc3FsYCgke3NxbC5qb2luKG1vbnRoQ29uZGl0aW9ucywgc3FsYCBPUiBgKX0pYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHdoZXJlQ2xhdXNlID0gY29uZGl0aW9ucy5sZW5ndGggPiAwID8gYW5kKC4uLmNvbmRpdGlvbnMpIDogdW5kZWZpbmVkO1xuXG4gICAgICBjb25zdCBiaWxsc0xpc3QgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYmlsbHMuaWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogYmlsbHMuYnVpbGRpbmdJZCxcbiAgICAgICAgICBiaWxsTnVtYmVyOiBiaWxscy5iaWxsTnVtYmVyLFxuICAgICAgICAgIHRpdGxlOiBiaWxscy50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYmlsbHMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnk6IGJpbGxzLmNhdGVnb3J5LFxuICAgICAgICAgIHZlbmRvcjogYmlsbHMudmVuZG9yLFxuICAgICAgICAgIHBheW1lbnRUeXBlOiBiaWxscy5wYXltZW50VHlwZSxcbiAgICAgICAgICBjb3N0czogYmlsbHMuY29zdHMsXG4gICAgICAgICAgdG90YWxBbW91bnQ6IGJpbGxzLnRvdGFsQW1vdW50LFxuICAgICAgICAgIHN0YXJ0RGF0ZTogYmlsbHMuc3RhcnREYXRlLFxuICAgICAgICAgIHN0YXR1czogYmlsbHMuc3RhdHVzLFxuICAgICAgICAgIG5vdGVzOiBiaWxscy5ub3RlcyxcbiAgICAgICAgICBjcmVhdGVkQnk6IGJpbGxzLmNyZWF0ZWRCeSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJpbGxzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGJpbGxzLnVwZGF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZSh3aGVyZUNsYXVzZSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhiaWxscy5zdGFydERhdGUpKTtcblxuICAgICAgcmVzLmpzb24oYmlsbHNMaXN0KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGJpbGxzOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYmlsbHMnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHZXQgYSBzcGVjaWZpYyBiaWxsIGJ5IElEXG4gICAqIEdFVCAvYXBpL2JpbGxzLzppZC5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYmlsbHMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgY29uc3QgYmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBiaWxscy5pZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxscy5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGJpbGxzLmJpbGxOdW1iZXIsXG4gICAgICAgICAgdGl0bGU6IGJpbGxzLnRpdGxlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBiaWxscy5kZXNjcmlwdGlvbixcbiAgICAgICAgICBjYXRlZ29yeTogYmlsbHMuY2F0ZWdvcnksXG4gICAgICAgICAgdmVuZG9yOiBiaWxscy52ZW5kb3IsXG4gICAgICAgICAgcGF5bWVudFR5cGU6IGJpbGxzLnBheW1lbnRUeXBlLFxuICAgICAgICAgIGNvc3RzOiBiaWxscy5jb3N0cyxcbiAgICAgICAgICB0b3RhbEFtb3VudDogYmlsbHMudG90YWxBbW91bnQsXG4gICAgICAgICAgc3RhcnREYXRlOiBiaWxscy5zdGFydERhdGUsXG4gICAgICAgICAgc3RhdHVzOiBiaWxscy5zdGF0dXMsXG4gICAgICAgICAgbm90ZXM6IGJpbGxzLm5vdGVzLFxuICAgICAgICAgIGZpbGVQYXRoOiBiaWxscy5maWxlUGF0aCxcbiAgICAgICAgICBmaWxlTmFtZTogYmlsbHMuZmlsZU5hbWUsXG4gICAgICAgICAgZmlsZVNpemU6IGJpbGxzLmZpbGVTaXplLFxuICAgICAgICAgIGlzQWlBbmFseXplZDogYmlsbHMuaXNBaUFuYWx5emVkLFxuICAgICAgICAgIGNyZWF0ZWRCeTogYmlsbHMuY3JlYXRlZEJ5LFxuICAgICAgICAgIGNyZWF0ZWRBdDogYmlsbHMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogYmlsbHMudXBkYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0JpbGwgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cblxuICAgICAgcmVzLmpzb24oYmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBiaWxsXG4gICAqIFBPU1QgL2FwaS9iaWxscy5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2JpbGxzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGNyZWF0ZUJpbGxTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBiaWxsIGRhdGEnLFxuICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiaWxsRGF0YSA9IHZhbGlkYXRpb24uZGF0YTtcbiAgICAgIGNvbnN0IG5ld0JpbGwgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KGJpbGxzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxsRGF0YS5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGBCSUxMLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIHRpdGxlOiBiaWxsRGF0YS50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYmlsbERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnk6IGJpbGxEYXRhLmNhdGVnb3J5LFxuICAgICAgICAgIHZlbmRvcjogYmlsbERhdGEudmVuZG9yLFxuICAgICAgICAgIHBheW1lbnRUeXBlOiBiaWxsRGF0YS5wYXltZW50VHlwZSxcbiAgICAgICAgICBzY2hlZHVsZVBheW1lbnQ6IGJpbGxEYXRhLnNjaGVkdWxlUGF5bWVudCxcbiAgICAgICAgICBzY2hlZHVsZUN1c3RvbTogYmlsbERhdGEuc2NoZWR1bGVDdXN0b20sXG4gICAgICAgICAgY29zdHM6IGJpbGxEYXRhLmNvc3RzLm1hcCgoY29zdCkgPT4gcGFyc2VGbG9hdChjb3N0KSksXG4gICAgICAgICAgdG90YWxBbW91bnQ6IHBhcnNlRmxvYXQoYmlsbERhdGEudG90YWxBbW91bnQpLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogYmlsbERhdGEuc3RhcnREYXRlLFxuICAgICAgICAgIGVuZERhdGU6IGJpbGxEYXRhLmVuZERhdGUgfHwgbnVsbCxcbiAgICAgICAgICBzdGF0dXM6IGJpbGxEYXRhLnN0YXR1cyxcbiAgICAgICAgICBub3RlczogYmlsbERhdGEubm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEJ5OiByZXEudXNlci5pZCxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBTY2hlZHVsZSBkZWxheWVkIG1vbmV5IGZsb3cgYW5kIGJ1ZGdldCB1cGRhdGUgZm9yIHRoZSBuZXcgYmlsbFxuICAgICAgdHJ5IHtcbiAgICAgICAgZGVsYXllZFVwZGF0ZVNlcnZpY2Uuc2NoZWR1bGVCaWxsVXBkYXRlKG5ld0JpbGxbMF0uaWQpO1xuICAgICAgfSBjYXRjaCAoc2NoZWR1bGluZ0Vycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBzY2hlZHVsZSBiaWxsIHVwZGF0ZTonLCBzY2hlZHVsaW5nRXJyb3IpO1xuICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSBiaWxsIGNyZWF0aW9uIGlmIHNjaGVkdWxpbmcgZmFpbHNcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24obmV3QmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGJpbGwnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgYSBiaWxsIChQQVRDSClcbiAgICogUEFUQ0ggL2FwaS9iaWxscy86aWQuXG4gICAqL1xuICBhcHAucGF0Y2goJy9hcGkvYmlsbHMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB1cGRhdGVCaWxsU2NoZW1hLnNhZmVQYXJzZShyZXEuYm9keSk7XG5cbiAgICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgYmlsbCBkYXRhJyxcbiAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYmlsbERhdGEgPSB2YWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHt9O1xuICAgICAgaWYgKGJpbGxEYXRhLnRpdGxlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEudGl0bGUgPSBiaWxsRGF0YS50aXRsZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5kZXNjcmlwdGlvbikge1xuICAgICAgICB1cGRhdGVEYXRhLmRlc2NyaXB0aW9uID0gYmlsbERhdGEuZGVzY3JpcHRpb247XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuY2F0ZWdvcnkpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5jYXRlZ29yeSA9IGJpbGxEYXRhLmNhdGVnb3J5O1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnZlbmRvcikge1xuICAgICAgICB1cGRhdGVEYXRhLnZlbmRvciA9IGJpbGxEYXRhLnZlbmRvcjtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5wYXltZW50VHlwZSkge1xuICAgICAgICB1cGRhdGVEYXRhLnBheW1lbnRUeXBlID0gYmlsbERhdGEucGF5bWVudFR5cGU7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuY29zdHMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5jb3N0cyA9IGJpbGxEYXRhLmNvc3RzLm1hcCgoY29zdDogc3RyaW5nKSA9PiBwYXJzZUZsb2F0KGNvc3QpKTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS50b3RhbEFtb3VudCkge1xuICAgICAgICB1cGRhdGVEYXRhLnRvdGFsQW1vdW50ID0gcGFyc2VGbG9hdChiaWxsRGF0YS50b3RhbEFtb3VudCk7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuc3RhcnREYXRlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuc3RhcnREYXRlID0gYmlsbERhdGEuc3RhcnREYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLmVuZERhdGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5lbmREYXRlID0gYmlsbERhdGEuZW5kRGF0ZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5zdGF0dXMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5zdGF0dXMgPSBiaWxsRGF0YS5zdGF0dXM7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEubm90ZXMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5ub3RlcyA9IGJpbGxEYXRhLm5vdGVzO1xuICAgICAgfVxuICAgICAgdXBkYXRlRGF0YS51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkQmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoYmlsbHMpXG4gICAgICAgIC5zZXQodXBkYXRlRGF0YSlcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgaWYgKHVwZGF0ZWRCaWxsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdCaWxsIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih1cGRhdGVkQmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBiaWxsIChQQVRDSCk6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhIGJpbGwgKFBVVClcbiAgICogUFVUIC9hcGkvYmlsbHMvOmlkLlxuICAgKi9cbiAgYXBwLnB1dCgnL2FwaS9iaWxscy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHVwZGF0ZUJpbGxTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBiaWxsIGRhdGEnLFxuICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiaWxsRGF0YSA9IHZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge307XG4gICAgICBpZiAoYmlsbERhdGEudGl0bGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS50aXRsZSA9IGJpbGxEYXRhLnRpdGxlO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBiaWxsRGF0YS5kZXNjcmlwdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5jYXRlZ29yeSkge1xuICAgICAgICB1cGRhdGVEYXRhLmNhdGVnb3J5ID0gYmlsbERhdGEuY2F0ZWdvcnk7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEudmVuZG9yKSB7XG4gICAgICAgIHVwZGF0ZURhdGEudmVuZG9yID0gYmlsbERhdGEudmVuZG9yO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnBheW1lbnRUeXBlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEucGF5bWVudFR5cGUgPSBiaWxsRGF0YS5wYXltZW50VHlwZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5jb3N0cykge1xuICAgICAgICB1cGRhdGVEYXRhLmNvc3RzID0gYmlsbERhdGEuY29zdHMubWFwKChjb3N0OiBzdHJpbmcpID0+IHBhcnNlRmxvYXQoY29zdCkpO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnRvdGFsQW1vdW50KSB7XG4gICAgICAgIHVwZGF0ZURhdGEudG90YWxBbW91bnQgPSBwYXJzZUZsb2F0KGJpbGxEYXRhLnRvdGFsQW1vdW50KTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5zdGFydERhdGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5zdGFydERhdGUgPSBiaWxsRGF0YS5zdGFydERhdGU7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuc3RhdHVzKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuc3RhdHVzID0gYmlsbERhdGEuc3RhdHVzO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLm5vdGVzKSB7XG4gICAgICAgIHVwZGF0ZURhdGEubm90ZXMgPSBiaWxsRGF0YS5ub3RlcztcbiAgICAgIH1cbiAgICAgIHVwZGF0ZURhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgY29uc3QgdXBkYXRlZEJpbGwgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKGJpbGxzKVxuICAgICAgICAuc2V0KHVwZGF0ZURhdGEpXG4gICAgICAgIC53aGVyZShlcShiaWxscy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmICh1cGRhdGVkQmlsbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU2NoZWR1bGUgZGVsYXllZCBtb25leSBmbG93IGFuZCBidWRnZXQgdXBkYXRlIGZvciB0aGUgdXBkYXRlZCBiaWxsXG4gICAgICB0cnkge1xuICAgICAgICBkZWxheWVkVXBkYXRlU2VydmljZS5zY2hlZHVsZUJpbGxVcGRhdGUoaWQpO1xuICAgICAgfSBjYXRjaCAoc2NoZWR1bGluZ0Vycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBzY2hlZHVsZSBiaWxsIHVwZGF0ZTonLCBzY2hlZHVsaW5nRXJyb3IpO1xuICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSBiaWxsIHVwZGF0ZSBpZiBzY2hlZHVsaW5nIGZhaWxzXG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWRCaWxsWzBdKTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIGJpbGwgKFBVVCk6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIGJpbGxcbiAgICogREVMRVRFIC9hcGkvYmlsbHMvOmlkLlxuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS9iaWxscy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBjb25zdCBkZWxldGVkQmlsbCA9IGF3YWl0IGRiLmRlbGV0ZShiaWxscykud2hlcmUoZXEoYmlsbHMuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmICghZGVsZXRlZEJpbGwgfHwgKEFycmF5LmlzQXJyYXkoZGVsZXRlZEJpbGwpICYmIGRlbGV0ZWRCaWxsLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQmlsbCBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGJpbGw6IGRlbGV0ZWRCaWxsWzBdLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIGJpbGwnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGxvYWQgYW5kIGFuYWx5emUgYmlsbCBkb2N1bWVudCB3aXRoIEdlbWluaSBBSVxuICAgKiBQT1NUIC9hcGkvYmlsbHMvOmlkL3VwbG9hZC1kb2N1bWVudC5cbiAgICovXG4gIGFwcC5wb3N0KFxuICAgICcvYXBpL2JpbGxzLzppZC91cGxvYWQtZG9jdW1lbnQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHVwbG9hZC5zaW5nbGUoJ2RvY3VtZW50JyksXG4gICAgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYPCfk4QgW0JJTExTIFVQTE9BRF0gU3RhcnRpbmcgZG9jdW1lbnQgdXBsb2FkIGZvciBiaWxsIElEOiAke3JlcS5wYXJhbXMuaWR9YCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBVc2VyOiAke3JlcS51c2VyLmlkfSAoJHtyZXEudXNlci5yb2xlfSlgKTtcbiAgICAgIFxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgICBpZiAoIXJlcS5maWxlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KdjCBbQklMTFMgVVBMT0FEXSBObyBmaWxlIHByb3ZpZGVkIGluIHJlcXVlc3QnKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnTm8gZmlsZSB1cGxvYWRlZCcgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBGaWxlIHJlY2VpdmVkOmAsIHtcbiAgICAgICAgICBvcmlnaW5hbE5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICBtaW1lVHlwZTogcmVxLmZpbGUubWltZXR5cGUsXG4gICAgICAgICAgc2l6ZTogcmVxLmZpbGUuc2l6ZSxcbiAgICAgICAgICB0ZW1wUGF0aDogcmVxLmZpbGUucGF0aFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIElEIGZvciBkb2N1bWVudCBvcmdhbml6YXRpb25cbiAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9ucyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnMocmVxLnVzZXIuaWQpO1xuICAgICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9XG4gICAgICAgICAgb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6ICdkZWZhdWx0JztcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtCSUxMUyBVUExPQURdIE9yZ2FuaXphdGlvbiBJRCBkZXRlcm1pbmVkOiAke29yZ2FuaXphdGlvbklkfWApO1xuXG4gICAgICAgIC8vIENyZWF0ZSBkb2N1bWVudCBwYXRoIGluIHRoZSBleHBlY3RlZCBmb3JtYXRcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBgcHJvZF9vcmdfJHtvcmdhbml6YXRpb25JZH0vJHtyZXEuZmlsZS5vcmlnaW5hbG5hbWV9YDtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4QgW0JJTExTIFVQTE9BRF0gRmlsZSBwYXRoIGRldGVybWluZWQ6ICR7ZmlsZVBhdGh9YCk7XG4gICAgICAgIFxuICAgICAgICAvLyBDcmVhdGUgdXBsb2FkcyBkaXJlY3Rvcnkgc3RydWN0dXJlIGlmIGl0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgY29uc3QgcGF0aCA9IGF3YWl0IGltcG9ydCgncGF0aCcpO1xuICAgICAgICBjb25zdCB1cGxvYWRzRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJyk7XG4gICAgICAgIGNvbnN0IG9yZ0RpciA9IHBhdGguam9pbih1cGxvYWRzRGlyLCBgcHJvZF9vcmdfJHtvcmdhbml6YXRpb25JZH1gKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtCSUxMUyBVUExPQURdIERpcmVjdG9yeSBwYXRoczpgLCB7XG4gICAgICAgICAgdXBsb2Fkc0RpcixcbiAgICAgICAgICBvcmdEaXIsXG4gICAgICAgICAgdXBsb2Fkc0V4aXN0czogZnMuZXhpc3RzU3luYyh1cGxvYWRzRGlyKSxcbiAgICAgICAgICBvcmdEaXJFeGlzdHM6IGZzLmV4aXN0c1N5bmMob3JnRGlyKVxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyh1cGxvYWRzRGlyKSkge1xuICAgICAgICAgIGZzLm1rZGlyU3luYyh1cGxvYWRzRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBDcmVhdGVkIHVwbG9hZHMgZGlyZWN0b3J5OiAke3VwbG9hZHNEaXJ9YCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKG9yZ0RpcikpIHtcbiAgICAgICAgICBmcy5ta2RpclN5bmMob3JnRGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBDcmVhdGVkIG9yZ2FuaXphdGlvbiBkaXJlY3Rvcnk6ICR7b3JnRGlyfWApO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2F2ZSBmaWxlIHRvIHBlcm1hbmVudCBzdG9yYWdlXG4gICAgICAgIGNvbnN0IHBlcm1hbmVudEZpbGVQYXRoID0gcGF0aC5qb2luKHVwbG9hZHNEaXIsIGZpbGVQYXRoKTtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4QgW0JJTExTIFVQTE9BRF0gQ29weWluZyBmaWxlIGZyb20gJHtyZXEuZmlsZS5wYXRofSB0byAke3Blcm1hbmVudEZpbGVQYXRofWApO1xuICAgICAgICBmcy5jb3B5RmlsZVN5bmMocmVxLmZpbGUucGF0aCwgcGVybWFuZW50RmlsZVBhdGgpO1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBGaWxlIHN1Y2Nlc3NmdWxseSBzYXZlZCB0byBwZXJtYW5lbnQgc3RvcmFnZWApO1xuXG4gICAgICAgIC8vIEFuYWx5emUgZG9jdW1lbnQgd2l0aCBHZW1pbmkgQUkgKGltYWdlcyBhbmQgUERGcylcbiAgICAgICAgbGV0IGFuYWx5c2lzUmVzdWx0ID0gbnVsbDtcbiAgICAgICAgaWYgKHJlcS5maWxlLm1pbWV0eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpIHx8IHJlcS5maWxlLm1pbWV0eXBlID09PSAnYXBwbGljYXRpb24vcGRmJykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn6SWIFtCSUxMUyBVUExPQURdIFN0YXJ0aW5nIEFJIGFuYWx5c2lzIGZvciAke3JlcS5maWxlLm1pbWV0eXBlfSBmaWxlYCk7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGFuYWx5c2lzUmVzdWx0ID0gYXdhaXQgZ2VtaW5pQmlsbEFuYWx5emVyLmFuYWx5emVCaWxsRG9jdW1lbnQocmVxLmZpbGUucGF0aCwgcmVxLmZpbGUubWltZXR5cGUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfpJYgW0JJTExTIFVQTE9BRF0gQUkgYW5hbHlzaXMgc3VjY2Vzc2Z1bDpgLCB7XG4gICAgICAgICAgICAgIGhhc1Jlc3VsdDogISFhbmFseXNpc1Jlc3VsdCxcbiAgICAgICAgICAgICAgYW5hbHlzaXNLZXlzOiBhbmFseXNpc1Jlc3VsdCA/IE9iamVjdC5rZXlzKGFuYWx5c2lzUmVzdWx0KSA6IFtdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGNhdGNoIChhaUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ/CfpJYgW0JJTExTIFVQTE9BRF0gQUkgYW5hbHlzaXMgZmFpbGVkLCBjb250aW51aW5nIHdpdGhvdXQgYW5hbHlzaXM6JywgYWlFcnJvcik7XG4gICAgICAgICAgICAvLyBDb250aW51ZSB3aXRob3V0IEFJIGFuYWx5c2lzXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn6SWIFtCSUxMUyBVUExPQURdIFNraXBwaW5nIEFJIGFuYWx5c2lzIGZvciB1bnN1cHBvcnRlZCBmaWxlIHR5cGU6ICR7cmVxLmZpbGUubWltZXR5cGV9YCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgYmlsbCB3aXRoIGRvY3VtZW50IGluZm8gYW5kIEFJIGFuYWx5c2lzXG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IHVua25vd24gPSB7XG4gICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgZmlsZU5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICBmaWxlU2l6ZTogcmVxLmZpbGUuc2l6ZSxcbiAgICAgICAgICBpc0FpQW5hbHl6ZWQ6ICEhYW5hbHlzaXNSZXN1bHQsXG4gICAgICAgICAgYWlBbmFseXNpc0RhdGE6IGFuYWx5c2lzUmVzdWx0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhg8J+ThCBbQklMTFMgVVBMT0FEXSBVcGRhdGluZyBiaWxsICR7aWR9IGluIGRhdGFiYXNlIHdpdGg6YCwge1xuICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgIGZpbGVOYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgZmlsZVNpemU6IHJlcS5maWxlLnNpemUsXG4gICAgICAgICAgaGFzQWlBbmFseXNpczogISFhbmFseXNpc1Jlc3VsdFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB1cGRhdGVkQmlsbCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShiaWxscylcbiAgICAgICAgICAuc2V0KHVwZGF0ZURhdGEpXG4gICAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtCSUxMUyBVUExPQURdIERhdGFiYXNlIHVwZGF0ZSBzdWNjZXNzZnVsIGZvciBiaWxsICR7aWR9YCk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGVcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4QgW0JJTExTIFVQTE9BRF0gQ2xlYW5pbmcgdXAgdGVtcG9yYXJ5IGZpbGU6ICR7cmVxLmZpbGUucGF0aH1gKTtcbiAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtCSUxMUyBVUExPQURdIFVwbG9hZCBwcm9jZXNzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgZm9yIGJpbGwgJHtpZH1gKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IHVwbG9hZGVkIGFuZCBhbmFseXplZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgIGJpbGw6IHVwZGF0ZWRCaWxsWzBdLFxuICAgICAgICAgIGFuYWx5c2lzUmVzdWx0LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGxvYWRpbmcgZG9jdW1lbnQ6JywgX2Vycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlIGlmIGl0IGV4aXN0c1xuICAgICAgICBpZiAocmVxLmZpbGU/LnBhdGgpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICB9IGNhdGNoIChfX19jbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsZWFuaW5nIHVwIHRlbXAgZmlsZTonLCBfX19jbGVhbnVwRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwbG9hZCBkb2N1bWVudCcsXG4gICAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLyoqXG4gICAqIERvd25sb2FkIGJpbGwgZG9jdW1lbnQgdXNpbmcgc2VjdXJlIHNpZ25lZCBVUkxcbiAgICogR0VUIC9hcGkvYmlsbHMvOmlkL2Rvd25sb2FkLWRvY3VtZW50LlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9iaWxscy86aWQvZG93bmxvYWQtZG9jdW1lbnQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OlIFtCSUxMUyBET1dOTE9BRF0gRG9jdW1lbnQgZG93bmxvYWQgcmVxdWVzdCBmb3IgYmlsbCBJRDogJHtyZXEucGFyYW1zLmlkfWApO1xuICAgIGNvbnNvbGUubG9nKGDwn5OlIFtCSUxMUyBET1dOTE9BRF0gVXNlcjogJHtyZXEudXNlci5pZH0gKCR7cmVxLnVzZXIucm9sZX0pYCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIC8vIEdldCB0aGUgYmlsbCB0byBjaGVjayBpZiBpdCBoYXMgYSBkb2N1bWVudFxuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0JJTExTIERPV05MT0FEXSBRdWVyeWluZyBkYXRhYmFzZSBmb3IgYmlsbDogJHtpZH1gKTtcbiAgICAgIGNvbnN0IGJpbGwgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKGJpbGxzKS53aGVyZShlcShiaWxscy5pZCwgaWQpKS5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0JJTExTIERPV05MT0FEXSBCaWxsIG5vdCBmb3VuZDogJHtpZH1gKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0JpbGwgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYmlsbERhdGEgPSBiaWxsWzBdO1xuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0JJTExTIERPV05MT0FEXSBCaWxsIGZvdW5kOmAsIHtcbiAgICAgICAgaWQ6IGJpbGxEYXRhLmlkLFxuICAgICAgICBoYXNGaWxlUGF0aDogISFiaWxsRGF0YS5maWxlUGF0aCxcbiAgICAgICAgaGFzRmlsZU5hbWU6ICEhYmlsbERhdGEuZmlsZU5hbWUsXG4gICAgICAgIGZpbGVQYXRoOiBiaWxsRGF0YS5maWxlUGF0aCxcbiAgICAgICAgZmlsZU5hbWU6IGJpbGxEYXRhLmZpbGVOYW1lXG4gICAgICB9KTtcblxuICAgICAgaWYgKCFiaWxsRGF0YS5maWxlUGF0aCB8fCAhYmlsbERhdGEuZmlsZU5hbWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBbQklMTFMgRE9XTkxPQURdIE5vIGRvY3VtZW50IGFzc29jaWF0ZWQgd2l0aCBiaWxsICR7aWR9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdObyBkb2N1bWVudCBhc3NvY2lhdGVkIHdpdGggdGhpcyBiaWxsJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBJRCBmb3IgZG9jdW1lbnQgYWNjZXNzXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyhyZXEudXNlci5pZCk7XG4gICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IG9yZ2FuaXphdGlvbnMubGVuZ3RoID4gMCA/IG9yZ2FuaXphdGlvbnNbMF0ub3JnYW5pemF0aW9uSWQgOiAnZGVmYXVsdCc7XG5cbiAgICAgIC8vIFNlcnZlIHRoZSBmaWxlIGRpcmVjdGx5IGZyb20gbG9jYWwgc3RvcmFnZVxuICAgICAgY29uc3QgcGF0aCA9IGF3YWl0IGltcG9ydCgncGF0aCcpO1xuICAgICAgY29uc3QgdXBsb2Fkc0RpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycpO1xuICAgICAgY29uc3QgZmlsZUZ1bGxQYXRoID0gcGF0aC5qb2luKHVwbG9hZHNEaXIsIGJpbGxEYXRhLmZpbGVQYXRoKTtcblxuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0JJTExTIERPV05MT0FEXSBGaWxlIHBhdGhzOmAsIHtcbiAgICAgICAgdXBsb2Fkc0RpcixcbiAgICAgICAgZmlsZVBhdGg6IGJpbGxEYXRhLmZpbGVQYXRoLFxuICAgICAgICBmdWxsRmlsZVBhdGg6IGZpbGVGdWxsUGF0aCxcbiAgICAgICAgZmlsZU5hbWU6IGJpbGxEYXRhLmZpbGVOYW1lLFxuICAgICAgICBvcmdhbml6YXRpb25JZFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENoZWNrIGlmIGZpbGUgZXhpc3RzXG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoZmlsZUZ1bGxQYXRoKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtCSUxMUyBET1dOTE9BRF0gRmlsZSBub3QgZm91bmQgYXQgcGF0aDogJHtmaWxlRnVsbFBhdGh9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudCBmaWxlIG5vdCBmb3VuZCBvbiBzZXJ2ZXInIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TpSBbQklMTFMgRE9XTkxPQURdIEZpbGUgZm91bmQsIHNldHRpbmcgaGVhZGVycyBhbmQgc2VuZGluZy4uLmApO1xuICAgICAgXG4gICAgICAvLyBTZXQgYXBwcm9wcmlhdGUgaGVhZGVycyBmb3IgZmlsZSBkb3dubG9hZFxuICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1EaXNwb3NpdGlvbicsIGBhdHRhY2htZW50OyBmaWxlbmFtZT1cIiR7YmlsbERhdGEuZmlsZU5hbWV9XCJgKTtcbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nKTtcbiAgICAgIFxuICAgICAgLy8gU3RyZWFtIHRoZSBmaWxlXG4gICAgICBjb25zb2xlLmxvZyhg8J+TpSBbQklMTFMgRE9XTkxPQURdIFN0cmVhbWluZyBmaWxlIHRvIGNsaWVudGApO1xuICAgICAgcmVzLnNlbmRGaWxlKGZpbGVGdWxsUGF0aCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgW0JJTExTIERPV05MT0FEXSBGaWxlIGRvd25sb2FkIGluaXRpYXRlZCBzdWNjZXNzZnVsbHkgZm9yIGJpbGwgJHtpZH1gKTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRvd25sb2FkaW5nIGRvY3VtZW50OicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZG93bmxvYWQgZG9jdW1lbnQnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBcHBseSBBSSBhbmFseXNpcyB0byBiaWxsIGZvcm0gZGF0YVxuICAgKiBQT1NUIC9hcGkvYmlsbHMvOmlkL2FwcGx5LWFpLWFuYWx5c2lzLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvYmlsbHMvOmlkL2FwcGx5LWFpLWFuYWx5c2lzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgLy8gR2V0IHRoZSBiaWxsIHdpdGggQUkgYW5hbHlzaXMgZGF0YVxuICAgICAgY29uc3QgYmlsbCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oYmlsbHMpLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYmlsbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0JpbGwgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYmlsbERhdGEgPSBiaWxsWzBdO1xuXG4gICAgICBpZiAoIWJpbGxEYXRhLmlzQWlBbmFseXplZCB8fCAhYmlsbERhdGEuYWlBbmFseXNpc0RhdGEpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ05vIEFJIGFuYWx5c2lzIGRhdGEgYXZhaWxhYmxlIGZvciB0aGlzIGJpbGwnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhbmFseXNpcyA9IGJpbGxEYXRhLmFpQW5hbHlzaXNEYXRhIGFzIGFueTtcblxuICAgICAgLy8gR2V0IHBheW1lbnQgc2NoZWR1bGUgc3VnZ2VzdGlvblxuICAgICAgY29uc3Qgc2NoZWR1bGVTaWduZXN0aW9uID0gYXdhaXQgZ2VtaW5pQmlsbEFuYWx5emVyLnN1Z2dlc3RQYXltZW50U2NoZWR1bGUoXG4gICAgICAgIGFuYWx5c2lzLmNhdGVnb3J5LFxuICAgICAgICBwYXJzZUZsb2F0KGFuYWx5c2lzLnRvdGFsQW1vdW50KVxuICAgICAgKTtcblxuICAgICAgLy8gVXBkYXRlIGJpbGwgd2l0aCBBSS1leHRyYWN0ZWQgZGF0YVxuICAgICAgY29uc3QgdXBkYXRlRGF0YTogdW5rbm93biA9IHtcbiAgICAgICAgdGl0bGU6IGFuYWx5c2lzLnRpdGxlLFxuICAgICAgICB2ZW5kb3I6IGFuYWx5c2lzLnZlbmRvcixcbiAgICAgICAgdG90YWxBbW91bnQ6IHBhcnNlRmxvYXQoYW5hbHlzaXMudG90YWxBbW91bnQpLFxuICAgICAgICBjYXRlZ29yeTogYW5hbHlzaXMuY2F0ZWdvcnksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBhbmFseXNpcy5kZXNjcmlwdGlvbixcbiAgICAgICAgcGF5bWVudFR5cGU6IHNjaGVkdWxlU2lnbmVzdGlvbi5wYXltZW50VHlwZSxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiBzY2hlZHVsZVNpZ25lc3Rpb24uc2NoZWR1bGVQYXltZW50LFxuICAgICAgICBjb3N0czogW3BhcnNlRmxvYXQoYW5hbHlzaXMudG90YWxBbW91bnQpXSxcbiAgICAgICAgc3RhcnREYXRlOiBhbmFseXNpcy5pc3N1ZURhdGUgfHwgYW5hbHlzaXMuZHVlRGF0ZSB8fCBiaWxsRGF0YS5zdGFydERhdGUsXG4gICAgICAgIG5vdGVzOiBgQUktYW5hbHl6ZWQgZG9jdW1lbnQuIE9yaWdpbmFsIGJpbGwgbnVtYmVyOiAke2FuYWx5c2lzLmJpbGxOdW1iZXIgfHwgJ04vQSd9LiBDb25maWRlbmNlOiAkeyhhbmFseXNpcy5jb25maWRlbmNlICogMTAwKS50b0ZpeGVkKDEpfSUuICR7c2NoZWR1bGVTaWduZXN0aW9uLnJlYXNvbmluZ31gLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB1cGRhdGVkQmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoYmlsbHMpXG4gICAgICAgIC5zZXQodXBkYXRlRGF0YSlcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQUkgYW5hbHlzaXMgYXBwbGllZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBiaWxsOiB1cGRhdGVkQmlsbFswXSxcbiAgICAgICAgYW5hbHlzaXMsXG4gICAgICAgIHNjaGVkdWxlU2lnbmVzdGlvbixcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgYXBwbHlpbmcgQUkgYW5hbHlzaXM6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBhcHBseSBBSSBhbmFseXNpcycsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGZ1dHVyZSBiaWxsIGluc3RhbmNlcyBmb3IgYSByZWN1cnJlbnQgYmlsbFxuICAgKiBQT1NUIC9hcGkvYmlsbHMvOmlkL2dlbmVyYXRlLWZ1dHVyZS5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2JpbGxzLzppZC9nZW5lcmF0ZS1mdXR1cmUnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBjb25zdCBiaWxsID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJpbGxzLmlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJpbGxzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgYmlsbE51bWJlcjogYmlsbHMuYmlsbE51bWJlcixcbiAgICAgICAgICB0aXRsZTogYmlsbHMudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGJpbGxzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGNhdGVnb3J5OiBiaWxscy5jYXRlZ29yeSxcbiAgICAgICAgICB2ZW5kb3I6IGJpbGxzLnZlbmRvcixcbiAgICAgICAgICBwYXltZW50VHlwZTogYmlsbHMucGF5bWVudFR5cGUsXG4gICAgICAgICAgY29zdHM6IGJpbGxzLmNvc3RzLFxuICAgICAgICAgIHRvdGFsQW1vdW50OiBiaWxscy50b3RhbEFtb3VudCxcbiAgICAgICAgICBzdGFydERhdGU6IGJpbGxzLnN0YXJ0RGF0ZSxcbiAgICAgICAgICBzdGF0dXM6IGJpbGxzLnN0YXR1cyxcbiAgICAgICAgICBub3RlczogYmlsbHMubm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEJ5OiBiaWxscy5jcmVhdGVkQnksXG4gICAgICAgICAgY3JlYXRlZEF0OiBiaWxscy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBiaWxscy51cGRhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoZXEoYmlsbHMuaWQsIGlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYmlsbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgYmlsbCdzIGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBiaWxsWzBdLmJ1aWxkaW5nSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChidWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byBnZW5lcmF0ZSBmdXR1cmUgYmlsbHMnLFxuICAgICAgICAgIGNvZGU6ICdBQ0NFU1NfREVOSUVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChiaWxsWzBdLnBheW1lbnRUeXBlICE9PSAncmVjdXJyZW50Jykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdPbmx5IHJlY3VycmVudCBiaWxscyBjYW4gZ2VuZXJhdGUgZnV0dXJlIGluc3RhbmNlcycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZW5lcmF0ZSBmdXR1cmUgYmlsbHNcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZUZ1dHVyZUJpbGxJbnN0YW5jZXMoYmlsbFswXSBhcyBhbnkpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGdXR1cmUgYmlsbHMgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGJpbGxzQ3JlYXRlZDogcmVzdWx0LmJpbGxzQ3JlYXRlZCxcbiAgICAgICAgZ2VuZXJhdGVkVW50aWw6IHJlc3VsdC5nZW5lcmF0ZWRVbnRpbCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2VuZXJhdGluZyBmdXR1cmUgYmlsbHM6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZW5lcmF0ZSBmdXR1cmUgYmlsbHMnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHZXQgYmlsbCBjYXRlZ29yaWVzIGZvciBmaWx0ZXIgZHJvcGRvd25cbiAgICogR0VUIC9hcGkvYmlsbHMvY2F0ZWdvcmllcy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYmlsbHMvY2F0ZWdvcmllcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNhdGVnb3JpZXMgPSBbXG4gICAgICAgICdpbnN1cmFuY2UnLFxuICAgICAgICAnbWFpbnRlbmFuY2UnLFxuICAgICAgICAnc2FsYXJ5JyxcbiAgICAgICAgJ3V0aWxpdGllcycsXG4gICAgICAgICdjbGVhbmluZycsXG4gICAgICAgICdzZWN1cml0eScsXG4gICAgICAgICdsYW5kc2NhcGluZycsXG4gICAgICAgICdwcm9mZXNzaW9uYWxfc2VydmljZXMnLFxuICAgICAgICAnYWRtaW5pc3RyYXRpb24nLFxuICAgICAgICAncmVwYWlycycsXG4gICAgICAgICdzdXBwbGllcycsXG4gICAgICAgICd0YXhlcycsXG4gICAgICAgICd0ZWNobm9sb2d5JyxcbiAgICAgICAgJ3Jlc2VydmVzJyxcbiAgICAgICAgJ290aGVyJyxcbiAgICAgIF07XG5cbiAgICAgIHJlcy5qc29uKGNhdGVnb3JpZXMpO1xuICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYmlsbCBjYXRlZ29yaWVzOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYmlsbCBjYXRlZ29yaWVzJyxcbiAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR2V0IHN0YXRpc3RpY3MgZm9yIGF1dG8tZ2VuZXJhdGVkIGJpbGxzIGZyb20gYSBwYXJlbnQgYmlsbFxuICAgKiBHRVQgL2FwaS9iaWxscy86aWQvZ2VuZXJhdGVkLXN0YXRzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9iaWxscy86aWQvZ2VuZXJhdGVkLXN0YXRzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgY29uc3QgYmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBiaWxscy5pZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxscy5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGJpbGxzLmJpbGxOdW1iZXIsXG4gICAgICAgICAgdGl0bGU6IGJpbGxzLnRpdGxlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBiaWxscy5kZXNjcmlwdGlvbixcbiAgICAgICAgICBjYXRlZ29yeTogYmlsbHMuY2F0ZWdvcnksXG4gICAgICAgICAgdmVuZG9yOiBiaWxscy52ZW5kb3IsXG4gICAgICAgICAgcGF5bWVudFR5cGU6IGJpbGxzLnBheW1lbnRUeXBlLFxuICAgICAgICAgIGNvc3RzOiBiaWxscy5jb3N0cyxcbiAgICAgICAgICB0b3RhbEFtb3VudDogYmlsbHMudG90YWxBbW91bnQsXG4gICAgICAgICAgc3RhcnREYXRlOiBiaWxscy5zdGFydERhdGUsXG4gICAgICAgICAgc3RhdHVzOiBiaWxscy5zdGF0dXMsXG4gICAgICAgICAgbm90ZXM6IGJpbGxzLm5vdGVzLFxuICAgICAgICAgIGNyZWF0ZWRCeTogYmlsbHMuY3JlYXRlZEJ5LFxuICAgICAgICAgIGNyZWF0ZWRBdDogYmlsbHMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogYmlsbHMudXBkYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0JpbGwgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZpbmQgYWxsIGJpbGxzIGdlbmVyYXRlZCBmcm9tIHRoaXMgcGFyZW50IGJpbGwgKGxvb2sgZm9yIGF1dG8tZ2VuZXJhdGVkIGJpbGxzKVxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYmlsbHMuaWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogYmlsbHMuYnVpbGRpbmdJZCxcbiAgICAgICAgICBiaWxsTnVtYmVyOiBiaWxscy5iaWxsTnVtYmVyLFxuICAgICAgICAgIHRpdGxlOiBiaWxscy50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYmlsbHMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnk6IGJpbGxzLmNhdGVnb3J5LFxuICAgICAgICAgIHZlbmRvcjogYmlsbHMudmVuZG9yLFxuICAgICAgICAgIHBheW1lbnRUeXBlOiBiaWxscy5wYXltZW50VHlwZSxcbiAgICAgICAgICBjb3N0czogYmlsbHMuY29zdHMsXG4gICAgICAgICAgdG90YWxBbW91bnQ6IGJpbGxzLnRvdGFsQW1vdW50LFxuICAgICAgICAgIHN0YXJ0RGF0ZTogYmlsbHMuc3RhcnREYXRlLFxuICAgICAgICAgIHN0YXR1czogYmlsbHMuc3RhdHVzLFxuICAgICAgICAgIG5vdGVzOiBiaWxscy5ub3RlcyxcbiAgICAgICAgICBjcmVhdGVkQnk6IGJpbGxzLmNyZWF0ZWRCeSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJpbGxzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGJpbGxzLnVwZGF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShzcWxgYmlsbHMubm90ZXMgTElLRSAnJUF1dG8tZ2VuZXJhdGVkIGZyb206JSdgKVxuICAgICAgICAub3JkZXJCeShiaWxscy5zdGFydERhdGUpO1xuXG4gICAgICBjb25zdCBzdGF0cyA9IGdlbmVyYXRlZEJpbGxzLm1hcCgoZ2VuQmlsbCkgPT4gKHtcbiAgICAgICAgaWQ6IGdlbkJpbGwuaWQsXG4gICAgICAgIHRpdGxlOiBnZW5CaWxsLnRpdGxlLFxuICAgICAgICBhbW91bnQ6IGdlbkJpbGwudG90YWxBbW91bnQsXG4gICAgICAgIHN0YXJ0RGF0ZTogZ2VuQmlsbC5zdGFydERhdGUsXG4gICAgICAgIHN0YXR1czogZ2VuQmlsbC5zdGF0dXMsXG4gICAgICAgIGJpbGxOdW1iZXI6IGdlbkJpbGwuYmlsbE51bWJlcixcbiAgICAgIH0pKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBwYXJlbnRCaWxsOiBiaWxsWzBdLFxuICAgICAgICBnZW5lcmF0ZWRCaWxsczogc3RhdHMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdldHRpbmcgZ2VuZXJhdGVkIGJpbGxzIHN0YXRpc3RpY3M6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgZ2VuZXJhdGVkIGJpbGxzIHN0YXRpc3RpY3MnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBBbmFseXplIGRvY3VtZW50IHdpdGhvdXQgY3JlYXRpbmcgYSBiaWxsXG4gICAqIFBPU1QgL2FwaS9iaWxscy9hbmFseXplLWRvY3VtZW50XG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9iaWxscy9hbmFseXplLWRvY3VtZW50JywgcmVxdWlyZUF1dGgsIHVwbG9hZC5zaW5nbGUoJ2RvY3VtZW50JyksIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKCFyZXEuZmlsZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdObyBkb2N1bWVudCBmaWxlIHByb3ZpZGVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFuYWx5c2lzID0gYXdhaXQgZ2VtaW5pQmlsbEFuYWx5emVyLmFuYWx5emVCaWxsRG9jdW1lbnQocmVxLmZpbGUucGF0aCk7XG4gICAgICBcbiAgICAgIHJlcy5qc29uKGFuYWx5c2lzKTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYW5hbHl6aW5nIGRvY3VtZW50OicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gYW5hbHl6ZSBkb2N1bWVudCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG4iXSwidmVyc2lvbiI6M30=