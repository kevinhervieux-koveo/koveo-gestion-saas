acb65c02b4bd87f008243db4112b83b1
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const db_1 = require("../../server/db");
const schema = __importStar(require("../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const users_1 = require("../../server/api/users");
const invitations_1 = require("../../server/api/invitations");
// Test utilities - simplified version similar to existing tests
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Test authentication middleware
    app.use(async (req, res, next) => {
        const testUserId = req.headers['x-test-user-id'];
        if (testUserId) {
            const [user] = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, testUserId)).limit(1);
            if (user) {
                req.session = {
                    userId: testUserId,
                    isAuthenticated: true,
                    role: user.role
                };
                req.user = user;
            }
        }
        next();
    });
    // Register only needed routes for testing
    (0, users_1.registerUserRoutes)(app);
    (0, invitations_1.registerInvitationRoutes)(app);
    return app;
};
(0, globals_1.describe)('User Management Comprehensive Tests', () => {
    let app;
    let adminUser;
    let regularManager;
    let demoManager;
    let testOrganization;
    let demoOrganization;
    let testBuilding;
    let testResidence1;
    let testResidence2;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Clean test data
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.invitations);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.organizations);
        // Create test organizations
        const [org1] = await db_1.db
            .insert(schema.organizations)
            .values({
            name: 'Regular Test Organization',
            type: 'Standard',
            address: '123 Test St',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H1H 1H1',
            phone: '514-555-0123',
            email: 'test@org.com',
        })
            .returning();
        testOrganization = org1;
        const [org2] = await db_1.db
            .insert(schema.organizations)
            .values({
            name: 'Demo Test Organization',
            type: 'demo',
            address: '456 Demo St',
            city: 'Demo City',
            province: 'QC',
            postalCode: 'H2H 2H2',
            phone: '514-555-0456',
            email: 'demo@org.com',
        })
            .returning();
        demoOrganization = org2;
        // Create test building
        const [building] = await db_1.db
            .insert(schema.buildings)
            .values({
            organizationId: testOrganization.id,
            name: 'Test Building',
            address: '123 Test St',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H1H 1H1',
            totalUnits: 10,
            buildingType: 'apartment',
        })
            .returning();
        testBuilding = building;
        // Create test residences
        const [residence1] = await db_1.db
            .insert(schema.residences)
            .values({
            buildingId: testBuilding.id,
            unitNumber: '101',
            squareFootage: 1000,
            bedrooms: 2,
            bathrooms: 1,
        })
            .returning();
        testResidence1 = residence1;
        const [residence2] = await db_1.db
            .insert(schema.residences)
            .values({
            buildingId: testBuilding.id,
            unitNumber: '102',
            squareFootage: 1200,
            bedrooms: 3,
            bathrooms: 2,
        })
            .returning();
        testResidence2 = residence2;
        // Create admin user
        const [admin] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'admin@test.com',
            username: 'admin',
            password: 'hashedpassword123',
            firstName: 'Admin',
            lastName: 'User',
            role: 'admin',
            isActive: true,
            phone: '514-555-0001',
        })
            .returning();
        adminUser = admin;
        // Create regular manager
        const [manager] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'manager@test.com',
            username: 'manager',
            password: 'hashedpassword123',
            firstName: 'Regular',
            lastName: 'Manager',
            role: 'manager',
            isActive: true,
            phone: '514-555-0002',
        })
            .returning();
        regularManager = manager;
        // Assign regular manager to organization
        await db_1.db
            .insert(schema.userOrganizations)
            .values({
            userId: regularManager.id,
            organizationId: testOrganization.id,
            organizationRole: 'manager',
            isActive: true,
        });
        // Create demo manager
        const [demoMgr] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'demo.manager@test.com',
            username: 'demo_manager',
            password: 'hashedpassword123',
            firstName: 'Demo',
            lastName: 'Manager',
            role: 'demo_manager',
            isActive: true,
            phone: '514-555-0003',
        })
            .returning();
        demoManager = demoMgr;
        // Create demo users for visibility testing
        await db_1.db
            .insert(schema.users)
            .values([
            {
                email: 'demo.tenant@test.com',
                username: 'demo_tenant',
                password: 'hashedpassword123',
                firstName: 'Demo',
                lastName: 'Tenant',
                role: 'demo_tenant',
                isActive: true,
                phone: '514-555-0004',
            },
            {
                email: 'demo.resident@test.com',
                username: 'demo_resident',
                password: 'hashedpassword123',
                firstName: 'Demo',
                lastName: 'Resident',
                role: 'demo_resident',
                isActive: true,
                phone: '514-555-0005',
            },
            {
                email: 'regular.tenant@test.com',
                username: 'regular_tenant',
                password: 'hashedpassword123',
                firstName: 'Regular',
                lastName: 'Tenant',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0006',
            }
        ]);
    });
    (0, globals_1.afterEach)(async () => {
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.invitations);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.organizations);
    });
    (0, globals_1.describe)('Invitation Organization/Building/Residence Assignment', () => {
        (0, globals_1.it)('should assign correct organization and residence when user accepts invitation', async () => {
            // Create invitation with organization and residence
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const invitationData = {
                email: 'newuser@test.com',
                role: 'tenant',
                organizationId: testOrganization.id,
                residenceId: testResidence1.id,
                expiresAt: expiresAt.toISOString(),
                personalMessage: 'Welcome!',
            };
            // Create invitation
            const inviteResponse = await (0, supertest_1.default)(app)
                .post('/api/invitations')
                .set('x-test-user-id', adminUser.id)
                .send(invitationData)
                .expect(201);
            // Get the invitation token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.email, 'newuser@test.com'));
            // Accept invitation
            const acceptData = {
                firstName: 'New',
                lastName: 'User',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData)
                .expect(201);
            // Verify user was created
            const [newUser] = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'newuser@test.com'));
            (0, globals_1.expect)(newUser).toBeDefined();
            (0, globals_1.expect)(newUser.role).toBe('tenant');
            // Verify organization assignment
            const orgAssignment = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, testOrganization.id)));
            (0, globals_1.expect)(orgAssignment).toHaveLength(1);
            (0, globals_1.expect)(orgAssignment[0].organizationRole).toBe('tenant');
            (0, globals_1.expect)(orgAssignment[0].isActive).toBe(true);
            // Verify residence assignment
            const residenceAssignment = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id), (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, testResidence1.id)));
            (0, globals_1.expect)(residenceAssignment).toHaveLength(1);
            (0, globals_1.expect)(residenceAssignment[0].relationshipType).toBe('tenant');
            (0, globals_1.expect)(residenceAssignment[0].isActive).toBe(true);
        });
        (0, globals_1.it)('should handle invitation with only organization (no residence)', async () => {
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const invitationData = {
                email: 'manager@test.com',
                role: 'manager',
                organizationId: testOrganization.id,
                expiresAt: expiresAt.toISOString(),
            };
            // Create invitation
            await (0, supertest_1.default)(app)
                .post('/api/invitations')
                .set('x-test-user-id', adminUser.id)
                .send(invitationData)
                .expect(201);
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.email, 'manager@test.com'));
            // Accept invitation
            const acceptData = {
                firstName: 'New',
                lastName: 'Manager',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData)
                .expect(201);
            const [newUser] = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'manager@test.com'));
            // Should have organization assignment
            const orgAssignment = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id));
            (0, globals_1.expect)(orgAssignment).toHaveLength(1);
            // Should NOT have residence assignment
            const residenceAssignment = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id));
            (0, globals_1.expect)(residenceAssignment).toHaveLength(0);
        });
    });
    (0, globals_1.describe)('Multiple Building/Residence Assignment', () => {
        (0, globals_1.it)('should allow admin to assign multiple residences to a user', async () => {
            // Create a test user first
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'multiuser@test.com',
                username: 'multiuser',
                password: 'hashedpassword123',
                firstName: 'Multi',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0007',
            })
                .returning();
            // Assign multiple residences
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
                {
                    residenceId: testResidence2.id,
                    relationshipType: 'occupant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Verify multiple assignments
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
            (0, globals_1.expect)(assignments).toHaveLength(2);
            (0, globals_1.expect)(assignments.some(a => a.residenceId === testResidence1.id)).toBe(true);
            (0, globals_1.expect)(assignments.some(a => a.residenceId === testResidence2.id)).toBe(true);
        });
        (0, globals_1.it)('should allow manager to assign residences only within their organization', async () => {
            // Create a test user
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'limiteduser@test.com',
                username: 'limiteduser',
                password: 'hashedpassword123',
                firstName: 'Limited',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0008',
            })
                .returning();
            // Manager tries to assign residence in their organization (should work)
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', regularManager.id)
                .send({ residenceAssignments })
                .expect(200);
            // Verify assignment was created
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
            (0, globals_1.expect)(assignments).toHaveLength(1);
            (0, globals_1.expect)(assignments[0].residenceId).toBe(testResidence1.id);
        });
    });
    (0, globals_1.describe)('Manager Permission Restrictions', () => {
        (0, globals_1.it)('should prevent regular manager from assigning organizations to users', async () => {
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'restricteduser@test.com',
                username: 'restricteduser',
                password: 'hashedpassword123',
                firstName: 'Restricted',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0009',
            })
                .returning();
            // Manager tries to assign organization (should fail)
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/organizations`)
                .set('x-test-user-id', regularManager.id)
                .send({ organizationIds: [testOrganization.id] })
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Only administrators can modify organization assignments');
        });
        (0, globals_1.it)('should prevent regular manager from creating users with organization assignments', async () => {
            // This would be tested if there's a user creation endpoint that accepts organizationIds
            // For now, we test that managers can't directly assign organizations
            const userData = {
                email: 'newmanaged@test.com',
                firstName: 'New',
                lastName: 'Managed',
                role: 'tenant',
                password: 'password123',
                organizationIds: [testOrganization.id], // Manager shouldn't be able to set this
            };
            // This test assumes there's validation in the user creation endpoint
            // The actual implementation might handle this differently
        });
        (0, globals_1.it)('should only allow manager to assign residences within their organization', async () => {
            // Create another organization and building
            const [otherOrg] = await db_1.db
                .insert(schema.organizations)
                .values({
                name: 'Other Organization',
                type: 'Standard',
                address: '789 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H3H 3H3',
                phone: '514-555-0789',
                email: 'other@org.com',
            })
                .returning();
            const [otherBuilding] = await db_1.db
                .insert(schema.buildings)
                .values({
                organizationId: otherOrg.id,
                name: 'Other Building',
                address: '789 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H3H 3H3',
                totalUnits: 5,
                buildingType: 'apartment',
            })
                .returning();
            const [otherResidence] = await db_1.db
                .insert(schema.residences)
                .values({
                buildingId: otherBuilding.id,
                unitNumber: '301',
                squareFootage: 800,
                bedrooms: 1,
                bathrooms: 1,
            })
                .returning();
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'crossorguser@test.com',
                username: 'crossorguser',
                password: 'hashedpassword123',
                firstName: 'Cross',
                lastName: 'Org',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0010',
            })
                .returning();
            // Manager tries to assign residence from different organization (should fail or be filtered)
            const residenceAssignments = [
                {
                    residenceId: otherResidence.id, // This is from a different organization
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            // This should either fail with 403 or silently ignore the invalid assignment
            // depending on implementation
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', regularManager.id)
                .send({ residenceAssignments });
            // The exact response depends on implementation, but the assignment shouldn't succeed
            if (response.status === 200) {
                // If it returns 200, verify no assignment was actually created
                const assignments = await db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
                (0, globals_1.expect)(assignments).toHaveLength(0);
            }
            else {
                // Should return an error status
                (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(400);
            }
        });
    });
    (0, globals_1.describe)('Demo Manager User Visibility', () => {
        (0, globals_1.it)('should show only demo users to demo manager in user management', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', demoManager.id)
                .expect(200);
            const users = response.body;
            // Demo manager should only see demo users (demo_manager, demo_tenant, demo_resident)
            const visibleRoles = users.map((user) => user.role);
            (0, globals_1.expect)(visibleRoles).toContain('demo_manager');
            (0, globals_1.expect)(visibleRoles).toContain('demo_tenant');
            (0, globals_1.expect)(visibleRoles).toContain('demo_resident');
            // Should NOT see regular roles
            (0, globals_1.expect)(visibleRoles).not.toContain('admin');
            (0, globals_1.expect)(visibleRoles).not.toContain('manager');
            (0, globals_1.expect)(visibleRoles).not.toContain('tenant');
            (0, globals_1.expect)(visibleRoles).not.toContain('resident');
        });
        (0, globals_1.it)('should allow regular manager to see non-demo users in their organization', async () => {
            // Assign the regular tenant to the same organization as the manager
            await db_1.db
                .insert(schema.userOrganizations)
                .values({
                userId: (await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'regular.tenant@test.com')))[0].id,
                organizationId: testOrganization.id,
                organizationRole: 'tenant',
                isActive: true,
            });
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', regularManager.id)
                .expect(200);
            const users = response.body;
            const visibleEmails = users.map((user) => user.email);
            // Should see users in their organization
            (0, globals_1.expect)(visibleEmails).toContain('regular.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('manager@test.com'); // themselves
            // Should NOT see demo users
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.resident@test.com');
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.manager@test.com');
        });
        (0, globals_1.it)('should allow admin to see all users regardless of type', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            const users = response.body;
            const visibleEmails = users.map((user) => user.email);
            // Admin should see all users
            (0, globals_1.expect)(visibleEmails).toContain('admin@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('manager@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.manager@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.resident@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('regular.tenant@test.com');
        });
    });
    (0, globals_1.describe)('Edge Cases and Validation', () => {
        (0, globals_1.it)('should handle invitation acceptance when residence no longer exists', async () => {
            // Create invitation with residence
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const [invitation] = await db_1.db
                .insert(schema.invitations)
                .values({
                email: 'edgecase@test.com',
                token: 'edge-case-token',
                role: 'tenant',
                status: 'pending',
                invitedByUserId: adminUser.id,
                expiresAt,
                tokenHash: 'hashed-token',
                usageCount: 0,
                maxUsageCount: 1,
                requires2fa: false,
                organizationId: testOrganization.id,
                residenceId: testResidence1.id,
            })
                .returning();
            // Delete the residence
            await db_1.db.delete(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence1.id));
            // Accept invitation - should still create user and org assignment, but skip residence
            const acceptData = {
                firstName: 'Edge',
                lastName: 'Case',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData);
            // Should either succeed with warning or handle gracefully
            if (response.status === 201) {
                const [newUser] = await db_1.db
                    .select()
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.email, 'edgecase@test.com'));
                // Should have organization assignment
                const orgAssignment = await db_1.db
                    .select()
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id));
                (0, globals_1.expect)(orgAssignment).toHaveLength(1);
                // Should NOT have residence assignment (since residence was deleted)
                const residenceAssignment = await db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id));
                (0, globals_1.expect)(residenceAssignment).toHaveLength(0);
            }
        });
        (0, globals_1.it)('should prevent duplicate residence assignments', async () => {
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'duplicate@test.com',
                username: 'duplicate',
                password: 'hashedpassword123',
                firstName: 'Duplicate',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0011',
            })
                .returning();
            // Assign residence once
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Try to assign same residence again
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Should still only have one assignment
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)));
            (0, globals_1.expect)(assignments).toHaveLength(1);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi91c2VyLW1hbmFnZW1lbnQtY29tcHJlaGVuc2l2ZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTRFO0FBQzVFLDBEQUFnQztBQUNoQyxzREFBOEI7QUFDOUIsd0NBQXFDO0FBQ3JDLDREQUE4QztBQUM5Qyw2Q0FBK0M7QUFFL0Msa0RBQTREO0FBQzVELDhEQUF3RTtBQUV4RSxnRUFBZ0U7QUFDaEUsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFO0lBQ3pCLE1BQU0sR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO0lBQ3RCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRWhELGlDQUFpQztJQUNqQyxHQUFHLENBQUMsR0FBRyxDQUFDLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFO1FBQ3BDLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztRQUNqRCxJQUFJLFVBQVUsRUFBRSxDQUFDO1lBQ2YsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLE1BQU0sT0FBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwRyxJQUFJLElBQUksRUFBRSxDQUFDO2dCQUNULEdBQUcsQ0FBQyxPQUFPLEdBQUc7b0JBQ1osTUFBTSxF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RCxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxFQUN6QyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQ3pDLENBQ0YsQ0FBQztZQUVKLElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvaW50ZWdyYXRpb24vdXNlci1tYW5hZ2VtZW50LWNvbXByZWhlbnNpdmUudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uLy4uL3NlcnZlci9kYic7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSwgYW5kLCBpbkFycmF5IH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IHsgc3RvcmFnZSB9IGZyb20gJy4uLy4uL3NlcnZlci9zdG9yYWdlJztcbmltcG9ydCB7IHJlZ2lzdGVyVXNlclJvdXRlcyB9IGZyb20gJy4uLy4uL3NlcnZlci9hcGkvdXNlcnMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJJbnZpdGF0aW9uUm91dGVzIH0gZnJvbSAnLi4vLi4vc2VydmVyL2FwaS9pbnZpdGF0aW9ucyc7XG5cbi8vIFRlc3QgdXRpbGl0aWVzIC0gc2ltcGxpZmllZCB2ZXJzaW9uIHNpbWlsYXIgdG8gZXhpc3RpbmcgdGVzdHNcbmNvbnN0IGNyZWF0ZVRlc3RBcHAgPSAoKSA9PiB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gIGFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuICBcbiAgLy8gVGVzdCBhdXRoZW50aWNhdGlvbiBtaWRkbGV3YXJlXG4gIGFwcC51c2UoYXN5bmMgKHJlcTogYW55LCByZXMsIG5leHQpID0+IHtcbiAgICBjb25zdCB0ZXN0VXNlcklkID0gcmVxLmhlYWRlcnNbJ3gtdGVzdC11c2VyLWlkJ107XG4gICAgaWYgKHRlc3RVc2VySWQpIHtcbiAgICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIHRlc3RVc2VySWQpKS5saW1pdCgxKTtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHJlcS5zZXNzaW9uID0geyBcbiAgICAgICAgICB1c2VySWQ6IHRlc3RVc2VySWQsXG4gICAgICAgICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZVxuICAgICAgICB9O1xuICAgICAgICByZXEudXNlciA9IHVzZXI7XG4gICAgICB9XG4gICAgfVxuICAgIG5leHQoKTtcbiAgfSk7XG4gIFxuICAvLyBSZWdpc3RlciBvbmx5IG5lZWRlZCByb3V0ZXMgZm9yIHRlc3RpbmdcbiAgcmVnaXN0ZXJVc2VyUm91dGVzKGFwcCk7XG4gIHJlZ2lzdGVySW52aXRhdGlvblJvdXRlcyhhcHApO1xuICByZXR1cm4gYXBwO1xufTtcblxuZGVzY3JpYmUoJ1VzZXIgTWFuYWdlbWVudCBDb21wcmVoZW5zaXZlIFRlc3RzJywgKCkgPT4ge1xuICBsZXQgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uO1xuICBsZXQgYWRtaW5Vc2VyOiBhbnk7XG4gIGxldCByZWd1bGFyTWFuYWdlcjogYW55O1xuICBsZXQgZGVtb01hbmFnZXI6IGFueTtcbiAgbGV0IHRlc3RPcmdhbml6YXRpb246IGFueTtcbiAgbGV0IGRlbW9Pcmdhbml6YXRpb246IGFueTtcbiAgbGV0IHRlc3RCdWlsZGluZzogYW55O1xuICBsZXQgdGVzdFJlc2lkZW5jZTE6IGFueTtcbiAgbGV0IHRlc3RSZXNpZGVuY2UyOiBhbnk7XG4gIFxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhcHAgPSBjcmVhdGVUZXN0QXBwKCk7XG4gICAgXG4gICAgLy8gQ2xlYW4gdGVzdCBkYXRhXG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyUmVzaWRlbmNlcyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2Vycyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5yZXNpZGVuY2VzKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLmJ1aWxkaW5ncyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5vcmdhbml6YXRpb25zKTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IG9yZ2FuaXphdGlvbnNcbiAgICBjb25zdCBbb3JnMV0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBuYW1lOiAnUmVndWxhciBUZXN0IE9yZ2FuaXphdGlvbicsXG4gICAgICAgIHR5cGU6ICdTdGFuZGFyZCcsXG4gICAgICAgIGFkZHJlc3M6ICcxMjMgVGVzdCBTdCcsXG4gICAgICAgIGNpdHk6ICdUZXN0IENpdHknLFxuICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgcG9zdGFsQ29kZTogJ0gxSCAxSDEnLFxuICAgICAgICBwaG9uZTogJzUxNC01NTUtMDEyMycsXG4gICAgICAgIGVtYWlsOiAndGVzdEBvcmcuY29tJyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdE9yZ2FuaXphdGlvbiA9IG9yZzE7XG5cbiAgICBjb25zdCBbb3JnMl0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBuYW1lOiAnRGVtbyBUZXN0IE9yZ2FuaXphdGlvbicsXG4gICAgICAgIHR5cGU6ICdkZW1vJyxcbiAgICAgICAgYWRkcmVzczogJzQ1NiBEZW1vIFN0JyxcbiAgICAgICAgY2l0eTogJ0RlbW8gQ2l0eScsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnSDJIIDJIMicsXG4gICAgICAgIHBob25lOiAnNTE0LTU1NS0wNDU2JyxcbiAgICAgICAgZW1haWw6ICdkZW1vQG9yZy5jb20nLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICBkZW1vT3JnYW5pemF0aW9uID0gb3JnMjtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IGJ1aWxkaW5nXG4gICAgY29uc3QgW2J1aWxkaW5nXSA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb24uaWQsXG4gICAgICAgIG5hbWU6ICdUZXN0IEJ1aWxkaW5nJyxcbiAgICAgICAgYWRkcmVzczogJzEyMyBUZXN0IFN0JyxcbiAgICAgICAgY2l0eTogJ1Rlc3QgQ2l0eScsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnSDFIIDFIMScsXG4gICAgICAgIHRvdGFsVW5pdHM6IDEwLFxuICAgICAgICBidWlsZGluZ1R5cGU6ICdhcGFydG1lbnQnLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0QnVpbGRpbmcgPSBidWlsZGluZztcblxuICAgIC8vIENyZWF0ZSB0ZXN0IHJlc2lkZW5jZXNcbiAgICBjb25zdCBbcmVzaWRlbmNlMV0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBidWlsZGluZ0lkOiB0ZXN0QnVpbGRpbmcuaWQsXG4gICAgICAgIHVuaXROdW1iZXI6ICcxMDEnLFxuICAgICAgICBzcXVhcmVGb290YWdlOiAxMDAwLFxuICAgICAgICBiZWRyb29tczogMixcbiAgICAgICAgYmF0aHJvb21zOiAxLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0UmVzaWRlbmNlMSA9IHJlc2lkZW5jZTE7XG5cbiAgICBjb25zdCBbcmVzaWRlbmNlMl0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBidWlsZGluZ0lkOiB0ZXN0QnVpbGRpbmcuaWQsXG4gICAgICAgIHVuaXROdW1iZXI6ICcxMDInLFxuICAgICAgICBzcXVhcmVGb290YWdlOiAxMjAwLFxuICAgICAgICBiZWRyb29tczogMyxcbiAgICAgICAgYmF0aHJvb21zOiAyLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0UmVzaWRlbmNlMiA9IHJlc2lkZW5jZTI7XG5cbiAgICAvLyBDcmVhdGUgYWRtaW4gdXNlclxuICAgIGNvbnN0IFthZG1pbl0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgZW1haWw6ICdhZG1pbkB0ZXN0LmNvbScsXG4gICAgICAgIHVzZXJuYW1lOiAnYWRtaW4nLFxuICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnQWRtaW4nLFxuICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDEnLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICBhZG1pblVzZXIgPSBhZG1pbjtcblxuICAgIC8vIENyZWF0ZSByZWd1bGFyIG1hbmFnZXJcbiAgICBjb25zdCBbbWFuYWdlcl0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgZW1haWw6ICdtYW5hZ2VyQHRlc3QuY29tJyxcbiAgICAgICAgdXNlcm5hbWU6ICdtYW5hZ2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgIGZpcnN0TmFtZTogJ1JlZ3VsYXInLFxuICAgICAgICBsYXN0TmFtZTogJ01hbmFnZXInLFxuICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwMicsXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuICAgIHJlZ3VsYXJNYW5hZ2VyID0gbWFuYWdlcjtcblxuICAgIC8vIEFzc2lnbiByZWd1bGFyIG1hbmFnZXIgdG8gb3JnYW5pemF0aW9uXG4gICAgYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIHVzZXJJZDogcmVndWxhck1hbmFnZXIuaWQsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiAnbWFuYWdlcicsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAvLyBDcmVhdGUgZGVtbyBtYW5hZ2VyXG4gICAgY29uc3QgW2RlbW9NZ3JdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnZGVtby5tYW5hZ2VyQHRlc3QuY29tJyxcbiAgICAgICAgdXNlcm5hbWU6ICdkZW1vX21hbmFnZXInLFxuICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnRGVtbycsXG4gICAgICAgIGxhc3ROYW1lOiAnTWFuYWdlcicsXG4gICAgICAgIHJvbGU6ICdkZW1vX21hbmFnZXInLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDMnLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICBkZW1vTWFuYWdlciA9IGRlbW9NZ3I7XG5cbiAgICAvLyBDcmVhdGUgZGVtbyB1c2VycyBmb3IgdmlzaWJpbGl0eSB0ZXN0aW5nXG4gICAgYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgLnZhbHVlcyhbXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ2RlbW8udGVuYW50QHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2RlbW9fdGVuYW50JyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdEZW1vJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1RlbmFudCcsXG4gICAgICAgICAgcm9sZTogJ2RlbW9fdGVuYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwNCcsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ2RlbW8ucmVzaWRlbnRAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnZGVtb19yZXNpZGVudCcsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRGVtbycsXG4gICAgICAgICAgbGFzdE5hbWU6ICdSZXNpZGVudCcsXG4gICAgICAgICAgcm9sZTogJ2RlbW9fcmVzaWRlbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDA1JyxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGVtYWlsOiAncmVndWxhci50ZW5hbnRAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAncmVndWxhcl90ZW5hbnQnLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzc3dvcmQxMjMnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ1JlZ3VsYXInLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVGVuYW50JyxcbiAgICAgICAgICByb2xlOiAndGVuYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwNicsXG4gICAgICAgIH1cbiAgICAgIF0pO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlclJlc2lkZW5jZXMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEucmVzaWRlbmNlcyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5idWlsZGluZ3MpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEub3JnYW5pemF0aW9ucyk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnZpdGF0aW9uIE9yZ2FuaXphdGlvbi9CdWlsZGluZy9SZXNpZGVuY2UgQXNzaWdubWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFzc2lnbiBjb3JyZWN0IG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlIHdoZW4gdXNlciBhY2NlcHRzIGludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgaW52aXRhdGlvbiB3aXRoIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlXG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgZXhwaXJlc0F0LnNldERhdGUoZXhwaXJlc0F0LmdldERhdGUoKSArIDcpO1xuXG4gICAgICBjb25zdCBpbnZpdGF0aW9uRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICduZXd1c2VyQHRlc3QuY29tJyxcbiAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZTEuaWQsXG4gICAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHBlcnNvbmFsTWVzc2FnZTogJ1dlbGNvbWUhJyxcbiAgICAgIH07XG5cbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uXG4gICAgICBjb25zdCBpbnZpdGVSZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucycpXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZChpbnZpdGF0aW9uRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICAvLyBHZXQgdGhlIGludml0YXRpb24gdG9rZW5cbiAgICAgIGNvbnN0IFtpbnZpdGF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsICduZXd1c2VyQHRlc3QuY29tJykpO1xuXG4gICAgICAvLyBBY2NlcHQgaW52aXRhdGlvblxuICAgICAgY29uc3QgYWNjZXB0RGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL2ludml0YXRpb25zL2FjY2VwdC8ke2ludml0YXRpb24udG9rZW59YClcbiAgICAgICAgLnNlbmQoYWNjZXB0RGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICAvLyBWZXJpZnkgdXNlciB3YXMgY3JlYXRlZFxuICAgICAgY29uc3QgW25ld1VzZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5lbWFpbCwgJ25ld3VzZXJAdGVzdC5jb20nKSk7XG5cbiAgICAgIGV4cGVjdChuZXdVc2VyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG5ld1VzZXIucm9sZSkudG9CZSgndGVuYW50Jyk7XG5cbiAgICAgIC8vIFZlcmlmeSBvcmdhbml6YXRpb24gYXNzaWdubWVudFxuICAgICAgY29uc3Qgb3JnQXNzaWdubWVudCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBuZXdVc2VyLmlkKSxcbiAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgdGVzdE9yZ2FuaXphdGlvbi5pZClcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGV4cGVjdChvcmdBc3NpZ25tZW50KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3Qob3JnQXNzaWdubWVudFswXS5vcmdhbml6YXRpb25Sb2xlKS50b0JlKCd0ZW5hbnQnKTtcbiAgICAgIGV4cGVjdChvcmdBc3NpZ25tZW50WzBdLmlzQWN0aXZlKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBWZXJpZnkgcmVzaWRlbmNlIGFzc2lnbm1lbnRcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUFzc2lnbm1lbnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgbmV3VXNlci5pZCksXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHRlc3RSZXNpZGVuY2UxLmlkKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc2lkZW5jZUFzc2lnbm1lbnQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZXNpZGVuY2VBc3NpZ25tZW50WzBdLnJlbGF0aW9uc2hpcFR5cGUpLnRvQmUoJ3RlbmFudCcpO1xuICAgICAgZXhwZWN0KHJlc2lkZW5jZUFzc2lnbm1lbnRbMF0uaXNBY3RpdmUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZpdGF0aW9uIHdpdGggb25seSBvcmdhbml6YXRpb24gKG5vIHJlc2lkZW5jZSknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgZXhwaXJlc0F0LnNldERhdGUoZXhwaXJlc0F0LmdldERhdGUoKSArIDcpO1xuXG4gICAgICBjb25zdCBpbnZpdGF0aW9uRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICdtYW5hZ2VyQHRlc3QuY29tJyxcbiAgICAgICAgcm9sZTogJ21hbmFnZXInLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgZXhwaXJlc0F0OiBleHBpcmVzQXQudG9JU09TdHJpbmcoKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLnNlbmQoaW52aXRhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgY29uc3QgW2ludml0YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgJ21hbmFnZXJAdGVzdC5jb20nKSk7XG5cbiAgICAgIC8vIEFjY2VwdCBpbnZpdGF0aW9uXG4gICAgICBjb25zdCBhY2NlcHREYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ01hbmFnZXInLFxuICAgICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoYC9hcGkvaW52aXRhdGlvbnMvYWNjZXB0LyR7aW52aXRhdGlvbi50b2tlbn1gKVxuICAgICAgICAuc2VuZChhY2NlcHREYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGNvbnN0IFtuZXdVc2VyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICdtYW5hZ2VyQHRlc3QuY29tJykpO1xuXG4gICAgICAvLyBTaG91bGQgaGF2ZSBvcmdhbml6YXRpb24gYXNzaWdubWVudFxuICAgICAgY29uc3Qgb3JnQXNzaWdubWVudCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBuZXdVc2VyLmlkKSk7XG5cbiAgICAgIGV4cGVjdChvcmdBc3NpZ25tZW50KS50b0hhdmVMZW5ndGgoMSk7XG5cbiAgICAgIC8vIFNob3VsZCBOT1QgaGF2ZSByZXNpZGVuY2UgYXNzaWdubWVudFxuICAgICAgY29uc3QgcmVzaWRlbmNlQXNzaWdubWVudCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCBuZXdVc2VyLmlkKSk7XG5cbiAgICAgIGV4cGVjdChyZXNpZGVuY2VBc3NpZ25tZW50KS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNdWx0aXBsZSBCdWlsZGluZy9SZXNpZGVuY2UgQXNzaWdubWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFsbG93IGFkbWluIHRvIGFzc2lnbiBtdWx0aXBsZSByZXNpZGVuY2VzIHRvIGEgdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIHRlc3QgdXNlciBmaXJzdFxuICAgICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGVtYWlsOiAnbXVsdGl1c2VyQHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ211bHRpdXNlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnTXVsdGknLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDcnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIEFzc2lnbiBtdWx0aXBsZSByZXNpZGVuY2VzXG4gICAgICBjb25zdCByZXNpZGVuY2VBc3NpZ25tZW50cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHJlc2lkZW5jZUlkOiB0ZXN0UmVzaWRlbmNlMS5pZCxcbiAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiAndGVuYW50JyxcbiAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UyLmlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICdvY2N1cGFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvdXNlcnMvJHt1c2VyLmlkfS9yZXNpZGVuY2VzYClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5zZW5kKHsgcmVzaWRlbmNlQXNzaWdubWVudHMgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBWZXJpZnkgbXVsdGlwbGUgYXNzaWdubWVudHNcbiAgICAgIGNvbnN0IGFzc2lnbm1lbnRzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpKTtcblxuICAgICAgZXhwZWN0KGFzc2lnbm1lbnRzKS50b0hhdmVMZW5ndGgoMik7XG4gICAgICBleHBlY3QoYXNzaWdubWVudHMuc29tZShhID0+IGEucmVzaWRlbmNlSWQgPT09IHRlc3RSZXNpZGVuY2UxLmlkKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChhc3NpZ25tZW50cy5zb21lKGEgPT4gYS5yZXNpZGVuY2VJZCA9PT0gdGVzdFJlc2lkZW5jZTIuaWQpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBtYW5hZ2VyIHRvIGFzc2lnbiByZXNpZGVuY2VzIG9ubHkgd2l0aGluIHRoZWlyIG9yZ2FuaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIHRlc3QgdXNlclxuICAgICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGVtYWlsOiAnbGltaXRlZHVzZXJAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnbGltaXRlZHVzZXInLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzc3dvcmQxMjMnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0xpbWl0ZWQnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDgnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIE1hbmFnZXIgdHJpZXMgdG8gYXNzaWduIHJlc2lkZW5jZSBpbiB0aGVpciBvcmdhbml6YXRpb24gKHNob3VsZCB3b3JrKVxuICAgICAgY29uc3QgcmVzaWRlbmNlQXNzaWdubWVudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZTEuaWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogJ3RlbmFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3VzZXJzLyR7dXNlci5pZH0vcmVzaWRlbmNlc2ApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgcmVndWxhck1hbmFnZXIuaWQpXG4gICAgICAgIC5zZW5kKHsgcmVzaWRlbmNlQXNzaWdubWVudHMgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBWZXJpZnkgYXNzaWdubWVudCB3YXMgY3JlYXRlZFxuICAgICAgY29uc3QgYXNzaWdubWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCkpO1xuXG4gICAgICBleHBlY3QoYXNzaWdubWVudHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChhc3NpZ25tZW50c1swXS5yZXNpZGVuY2VJZCkudG9CZSh0ZXN0UmVzaWRlbmNlMS5pZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNYW5hZ2VyIFBlcm1pc3Npb24gUmVzdHJpY3Rpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJldmVudCByZWd1bGFyIG1hbmFnZXIgZnJvbSBhc3NpZ25pbmcgb3JnYW5pemF0aW9ucyB0byB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBlbWFpbDogJ3Jlc3RyaWN0ZWR1c2VyQHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ3Jlc3RyaWN0ZWR1c2VyJyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdSZXN0cmljdGVkJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDA5JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBNYW5hZ2VyIHRyaWVzIHRvIGFzc2lnbiBvcmdhbml6YXRpb24gKHNob3VsZCBmYWlsKVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnB1dChgL2FwaS91c2Vycy8ke3VzZXIuaWR9L29yZ2FuaXphdGlvbnNgKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHJlZ3VsYXJNYW5hZ2VyLmlkKVxuICAgICAgICAuc2VuZCh7IG9yZ2FuaXphdGlvbklkczogW3Rlc3RPcmdhbml6YXRpb24uaWRdIH0pXG4gICAgICAgIC5leHBlY3QoNDAzKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9Db250YWluKCdPbmx5IGFkbWluaXN0cmF0b3JzIGNhbiBtb2RpZnkgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgcmVndWxhciBtYW5hZ2VyIGZyb20gY3JlYXRpbmcgdXNlcnMgd2l0aCBvcmdhbml6YXRpb24gYXNzaWdubWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHdvdWxkIGJlIHRlc3RlZCBpZiB0aGVyZSdzIGEgdXNlciBjcmVhdGlvbiBlbmRwb2ludCB0aGF0IGFjY2VwdHMgb3JnYW5pemF0aW9uSWRzXG4gICAgICAvLyBGb3Igbm93LCB3ZSB0ZXN0IHRoYXQgbWFuYWdlcnMgY2FuJ3QgZGlyZWN0bHkgYXNzaWduIG9yZ2FuaXphdGlvbnNcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xuICAgICAgICBlbWFpbDogJ25ld21hbmFnZWRAdGVzdC5jb20nLFxuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ01hbmFnZWQnLFxuICAgICAgICByb2xlOiAndGVuYW50JyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkczogW3Rlc3RPcmdhbml6YXRpb24uaWRdLCAvLyBNYW5hZ2VyIHNob3VsZG4ndCBiZSBhYmxlIHRvIHNldCB0aGlzXG4gICAgICB9O1xuXG4gICAgICAvLyBUaGlzIHRlc3QgYXNzdW1lcyB0aGVyZSdzIHZhbGlkYXRpb24gaW4gdGhlIHVzZXIgY3JlYXRpb24gZW5kcG9pbnRcbiAgICAgIC8vIFRoZSBhY3R1YWwgaW1wbGVtZW50YXRpb24gbWlnaHQgaGFuZGxlIHRoaXMgZGlmZmVyZW50bHlcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgb25seSBhbGxvdyBtYW5hZ2VyIHRvIGFzc2lnbiByZXNpZGVuY2VzIHdpdGhpbiB0aGVpciBvcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYW5vdGhlciBvcmdhbml6YXRpb24gYW5kIGJ1aWxkaW5nXG4gICAgICBjb25zdCBbb3RoZXJPcmddID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgbmFtZTogJ090aGVyIE9yZ2FuaXphdGlvbicsXG4gICAgICAgICAgdHlwZTogJ1N0YW5kYXJkJyxcbiAgICAgICAgICBhZGRyZXNzOiAnNzg5IE90aGVyIFN0JyxcbiAgICAgICAgICBjaXR5OiAnT3RoZXIgQ2l0eScsXG4gICAgICAgICAgcHJvdmluY2U6ICdRQycsXG4gICAgICAgICAgcG9zdGFsQ29kZTogJ0gzSCAzSDMnLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wNzg5JyxcbiAgICAgICAgICBlbWFpbDogJ290aGVyQG9yZy5jb20nLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGNvbnN0IFtvdGhlckJ1aWxkaW5nXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG90aGVyT3JnLmlkLFxuICAgICAgICAgIG5hbWU6ICdPdGhlciBCdWlsZGluZycsXG4gICAgICAgICAgYWRkcmVzczogJzc4OSBPdGhlciBTdCcsXG4gICAgICAgICAgY2l0eTogJ090aGVyIENpdHknLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIM0ggM0gzJyxcbiAgICAgICAgICB0b3RhbFVuaXRzOiA1LFxuICAgICAgICAgIGJ1aWxkaW5nVHlwZTogJ2FwYXJ0bWVudCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgY29uc3QgW290aGVyUmVzaWRlbmNlXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGJ1aWxkaW5nSWQ6IG90aGVyQnVpbGRpbmcuaWQsXG4gICAgICAgICAgdW5pdE51bWJlcjogJzMwMScsXG4gICAgICAgICAgc3F1YXJlRm9vdGFnZTogODAwLFxuICAgICAgICAgIGJlZHJvb21zOiAxLFxuICAgICAgICAgIGJhdGhyb29tczogMSxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICBjb25zdCBbdXNlcl0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgZW1haWw6ICdjcm9zc29yZ3VzZXJAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnY3Jvc3Nvcmd1c2VyJyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdDcm9zcycsXG4gICAgICAgICAgbGFzdE5hbWU6ICdPcmcnLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDEwJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBNYW5hZ2VyIHRyaWVzIHRvIGFzc2lnbiByZXNpZGVuY2UgZnJvbSBkaWZmZXJlbnQgb3JnYW5pemF0aW9uIChzaG91bGQgZmFpbCBvciBiZSBmaWx0ZXJlZClcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUFzc2lnbm1lbnRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IG90aGVyUmVzaWRlbmNlLmlkLCAvLyBUaGlzIGlzIGZyb20gYSBkaWZmZXJlbnQgb3JnYW5pemF0aW9uXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogJ3RlbmFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIC8vIFRoaXMgc2hvdWxkIGVpdGhlciBmYWlsIHdpdGggNDAzIG9yIHNpbGVudGx5IGlnbm9yZSB0aGUgaW52YWxpZCBhc3NpZ25tZW50XG4gICAgICAvLyBkZXBlbmRpbmcgb24gaW1wbGVtZW50YXRpb25cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvdXNlcnMvJHt1c2VyLmlkfS9yZXNpZGVuY2VzYClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCByZWd1bGFyTWFuYWdlci5pZClcbiAgICAgICAgLnNlbmQoeyByZXNpZGVuY2VBc3NpZ25tZW50cyB9KTtcblxuICAgICAgLy8gVGhlIGV4YWN0IHJlc3BvbnNlIGRlcGVuZHMgb24gaW1wbGVtZW50YXRpb24sIGJ1dCB0aGUgYXNzaWdubWVudCBzaG91bGRuJ3Qgc3VjY2VlZFxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAwKSB7XG4gICAgICAgIC8vIElmIGl0IHJldHVybnMgMjAwLCB2ZXJpZnkgbm8gYXNzaWdubWVudCB3YXMgYWN0dWFsbHkgY3JlYXRlZFxuICAgICAgICBjb25zdCBhc3NpZ25tZW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSk7XG5cbiAgICAgICAgZXhwZWN0KGFzc2lnbm1lbnRzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBTaG91bGQgcmV0dXJuIGFuIGVycm9yIHN0YXR1c1xuICAgICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDQwMCk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEZW1vIE1hbmFnZXIgVXNlciBWaXNpYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2hvdyBvbmx5IGRlbW8gdXNlcnMgdG8gZGVtbyBtYW5hZ2VyIGluIHVzZXIgbWFuYWdlbWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvdXNlcnMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGRlbW9NYW5hZ2VyLmlkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IHVzZXJzID0gcmVzcG9uc2UuYm9keTtcbiAgICAgIFxuICAgICAgLy8gRGVtbyBtYW5hZ2VyIHNob3VsZCBvbmx5IHNlZSBkZW1vIHVzZXJzIChkZW1vX21hbmFnZXIsIGRlbW9fdGVuYW50LCBkZW1vX3Jlc2lkZW50KVxuICAgICAgY29uc3QgdmlzaWJsZVJvbGVzID0gdXNlcnMubWFwKCh1c2VyOiBhbnkpID0+IHVzZXIucm9sZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh2aXNpYmxlUm9sZXMpLnRvQ29udGFpbignZGVtb19tYW5hZ2VyJyk7XG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS50b0NvbnRhaW4oJ2RlbW9fdGVuYW50Jyk7IFxuICAgICAgZXhwZWN0KHZpc2libGVSb2xlcykudG9Db250YWluKCdkZW1vX3Jlc2lkZW50Jyk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBOT1Qgc2VlIHJlZ3VsYXIgcm9sZXNcbiAgICAgIGV4cGVjdCh2aXNpYmxlUm9sZXMpLm5vdC50b0NvbnRhaW4oJ2FkbWluJyk7XG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS5ub3QudG9Db250YWluKCdtYW5hZ2VyJyk7XG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS5ub3QudG9Db250YWluKCd0ZW5hbnQnKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlUm9sZXMpLm5vdC50b0NvbnRhaW4oJ3Jlc2lkZW50Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFsbG93IHJlZ3VsYXIgbWFuYWdlciB0byBzZWUgbm9uLWRlbW8gdXNlcnMgaW4gdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXNzaWduIHRoZSByZWd1bGFyIHRlbmFudCB0byB0aGUgc2FtZSBvcmdhbml6YXRpb24gYXMgdGhlIG1hbmFnZXJcbiAgICAgIGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICB1c2VySWQ6IChhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAncmVndWxhci50ZW5hbnRAdGVzdC5jb20nKSkpWzBdLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvblJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS91c2VycycpXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgcmVndWxhck1hbmFnZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgY29uc3QgdXNlcnMgPSByZXNwb25zZS5ib2R5O1xuICAgICAgY29uc3QgdmlzaWJsZUVtYWlscyA9IHVzZXJzLm1hcCgodXNlcjogYW55KSA9PiB1c2VyLmVtYWlsKTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIHNlZSB1c2VycyBpbiB0aGVpciBvcmdhbml6YXRpb25cbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ3JlZ3VsYXIudGVuYW50QHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdtYW5hZ2VyQHRlc3QuY29tJyk7IC8vIHRoZW1zZWx2ZXNcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIE5PVCBzZWUgZGVtbyB1c2Vyc1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLm5vdC50b0NvbnRhaW4oJ2RlbW8udGVuYW50QHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykubm90LnRvQ29udGFpbignZGVtby5yZXNpZGVudEB0ZXN0LmNvbScpO1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLm5vdC50b0NvbnRhaW4oJ2RlbW8ubWFuYWdlckB0ZXN0LmNvbScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBzZWUgYWxsIHVzZXJzIHJlZ2FyZGxlc3Mgb2YgdHlwZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvdXNlcnMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBjb25zdCB1c2VycyA9IHJlc3BvbnNlLmJvZHk7XG4gICAgICBjb25zdCB2aXNpYmxlRW1haWxzID0gdXNlcnMubWFwKCh1c2VyOiBhbnkpID0+IHVzZXIuZW1haWwpO1xuICAgICAgXG4gICAgICAvLyBBZG1pbiBzaG91bGQgc2VlIGFsbCB1c2Vyc1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLnRvQ29udGFpbignYWRtaW5AdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ21hbmFnZXJAdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ2RlbW8ubWFuYWdlckB0ZXN0LmNvbScpO1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLnRvQ29udGFpbignZGVtby50ZW5hbnRAdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ2RlbW8ucmVzaWRlbnRAdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ3JlZ3VsYXIudGVuYW50QHRlc3QuY29tJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzIGFuZCBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludml0YXRpb24gYWNjZXB0YW5jZSB3aGVuIHJlc2lkZW5jZSBubyBsb25nZXIgZXhpc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGludml0YXRpb24gd2l0aCByZXNpZGVuY2VcbiAgICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKCk7XG4gICAgICBleHBpcmVzQXQuc2V0RGF0ZShleHBpcmVzQXQuZ2V0RGF0ZSgpICsgNyk7XG5cbiAgICAgIGNvbnN0IFtpbnZpdGF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBlbWFpbDogJ2VkZ2VjYXNlQHRlc3QuY29tJyxcbiAgICAgICAgICB0b2tlbjogJ2VkZ2UtY2FzZS10b2tlbicsXG4gICAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgICAgaW52aXRlZEJ5VXNlcklkOiBhZG1pblVzZXIuaWQsXG4gICAgICAgICAgZXhwaXJlc0F0LFxuICAgICAgICAgIHRva2VuSGFzaDogJ2hhc2hlZC10b2tlbicsXG4gICAgICAgICAgdXNhZ2VDb3VudDogMCxcbiAgICAgICAgICBtYXhVc2FnZUNvdW50OiAxLFxuICAgICAgICAgIHJlcXVpcmVzMmZhOiBmYWxzZSxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZTEuaWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gRGVsZXRlIHRoZSByZXNpZGVuY2VcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEucmVzaWRlbmNlcykud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2UxLmlkKSk7XG5cbiAgICAgIC8vIEFjY2VwdCBpbnZpdGF0aW9uIC0gc2hvdWxkIHN0aWxsIGNyZWF0ZSB1c2VyIGFuZCBvcmcgYXNzaWdubWVudCwgYnV0IHNraXAgcmVzaWRlbmNlXG4gICAgICBjb25zdCBhY2NlcHREYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdFZGdlJyxcbiAgICAgICAgbGFzdE5hbWU6ICdDYXNlJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoYC9hcGkvaW52aXRhdGlvbnMvYWNjZXB0LyR7aW52aXRhdGlvbi50b2tlbn1gKVxuICAgICAgICAuc2VuZChhY2NlcHREYXRhKTtcblxuICAgICAgLy8gU2hvdWxkIGVpdGhlciBzdWNjZWVkIHdpdGggd2FybmluZyBvciBoYW5kbGUgZ3JhY2VmdWxseVxuICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gMjAxKSB7XG4gICAgICAgIGNvbnN0IFtuZXdVc2VyXSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICdlZGdlY2FzZUB0ZXN0LmNvbScpKTtcblxuICAgICAgICAvLyBTaG91bGQgaGF2ZSBvcmdhbml6YXRpb24gYXNzaWdubWVudFxuICAgICAgICBjb25zdCBvcmdBc3NpZ25tZW50ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIG5ld1VzZXIuaWQpKTtcblxuICAgICAgICBleHBlY3Qob3JnQXNzaWdubWVudCkudG9IYXZlTGVuZ3RoKDEpO1xuXG4gICAgICAgIC8vIFNob3VsZCBOT1QgaGF2ZSByZXNpZGVuY2UgYXNzaWdubWVudCAoc2luY2UgcmVzaWRlbmNlIHdhcyBkZWxldGVkKVxuICAgICAgICBjb25zdCByZXNpZGVuY2VBc3NpZ25tZW50ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIG5ld1VzZXIuaWQpKTtcblxuICAgICAgICBleHBlY3QocmVzaWRlbmNlQXNzaWdubWVudCkudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGR1cGxpY2F0ZSByZXNpZGVuY2UgYXNzaWdubWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBbdXNlcl0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgZW1haWw6ICdkdXBsaWNhdGVAdGVzdC5jb20nLFxuICAgICAgICAgIHVzZXJuYW1lOiAnZHVwbGljYXRlJyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdEdXBsaWNhdGUnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMTEnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIEFzc2lnbiByZXNpZGVuY2Ugb25jZVxuICAgICAgY29uc3QgcmVzaWRlbmNlQXNzaWdubWVudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZTEuaWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogJ3RlbmFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3VzZXJzLyR7dXNlci5pZH0vcmVzaWRlbmNlc2ApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZCh7IHJlc2lkZW5jZUFzc2lnbm1lbnRzIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gVHJ5IHRvIGFzc2lnbiBzYW1lIHJlc2lkZW5jZSBhZ2FpblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvdXNlcnMvJHt1c2VyLmlkfS9yZXNpZGVuY2VzYClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5zZW5kKHsgcmVzaWRlbmNlQXNzaWdubWVudHMgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBTaG91bGQgc3RpbGwgb25seSBoYXZlIG9uZSBhc3NpZ25tZW50XG4gICAgICBjb25zdCBhc3NpZ25tZW50cyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGV4cGVjdChhc3NpZ25tZW50cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==