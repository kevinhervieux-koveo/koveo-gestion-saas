e9caaf958594eabdf2baed6b442a44c2
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const db_1 = require("../../server/db");
const schema_1 = require("../../shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
(0, globals_1.describe)('Residence Update API', () => {
    let testOrganizationId;
    let testBuildingId;
    let testResidenceId;
    (0, globals_1.beforeAll)(async () => {
        // Create a test organization
        const [org] = await db_1.db
            .insert(schema_1.organizations)
            .values({
            name: 'Test Residence Update Org',
            address: '123 Test St',
            city: 'Montreal',
            province: 'QC',
            postalCode: 'H1H 1H1',
            isActive: true,
        })
            .returning();
        testOrganizationId = org.id;
        // Create a test building
        const [building] = await db_1.db
            .insert(schema_1.buildings)
            .values({
            organizationId: testOrganizationId,
            name: 'Test Building for Updates',
            address: '456 Update Ave',
            city: 'Montreal',
            province: 'QC',
            postalCode: 'H2H 2H2',
            buildingType: 'condo',
            totalUnits: 10,
            totalFloors: 3,
            isActive: true,
        })
            .returning();
        testBuildingId = building.id;
        // Create a test residence
        const [residence] = await db_1.db
            .insert(schema_1.residences)
            .values({
            buildingId: testBuildingId,
            unitNumber: '101',
            floor: 1,
            squareFootage: '1000',
            bedrooms: 2,
            bathrooms: '1.5',
            balcony: true,
            parkingSpaceNumbers: ['P1'],
            storageSpaceNumbers: ['S1'],
            ownershipPercentage: '2.5',
            monthlyFees: '350.00',
            isActive: true,
        })
            .returning();
        testResidenceId = residence.id;
    });
    (0, globals_1.afterAll)(async () => {
        // Clean up test data
        await db_1.db.delete(schema_1.residences).where((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, testBuildingId));
        await db_1.db.delete(schema_1.buildings).where((0, drizzle_orm_1.eq)(schema_1.buildings.id, testBuildingId));
        await db_1.db.delete(schema_1.organizations).where((0, drizzle_orm_1.eq)(schema_1.organizations.id, testOrganizationId));
    });
    (0, globals_1.beforeEach)(async () => {
        // Reset residence to known state before each test
        await db_1.db
            .update(schema_1.residences)
            .set({
            unitNumber: '101',
            floor: 1,
            squareFootage: '1000',
            bedrooms: 2,
            bathrooms: '1.5',
            balcony: true,
            parkingSpaceNumbers: ['P1'],
            storageSpaceNumbers: ['S1'],
            ownershipPercentage: '2.5',
            monthlyFees: '350.00',
            isActive: true,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId));
    });
    (0, globals_1.test)('should update residence with valid numeric data', async () => {
        const updateData = {
            unitNumber: '102',
            floor: 2,
            squareFootage: 1200,
            bedrooms: 3,
            bathrooms: 2.0,
            balcony: false,
            parkingSpaceNumbers: ['P2', 'P3'],
            storageSpaceNumbers: ['S2'],
            ownershipPercentage: 3.0,
            monthlyFees: 425.50,
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set({
            ...updateData,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(updated.unitNumber).toBe('102');
        (0, globals_1.expect)(updated.floor).toBe(2);
        (0, globals_1.expect)(Number(updated.squareFootage)).toBe(1200);
        (0, globals_1.expect)(updated.bedrooms).toBe(3);
        (0, globals_1.expect)(Number(updated.bathrooms)).toBe(2.0);
        (0, globals_1.expect)(updated.balcony).toBe(false);
        (0, globals_1.expect)(updated.parkingSpaceNumbers).toEqual(['P2', 'P3']);
        (0, globals_1.expect)(updated.storageSpaceNumbers).toEqual(['S2']);
        (0, globals_1.expect)(Number(updated.ownershipPercentage)).toBe(3.0);
        (0, globals_1.expect)(Number(updated.monthlyFees)).toBe(425.50);
    });
    (0, globals_1.test)('should handle null values for optional fields', async () => {
        const updateData = {
            unitNumber: '103',
            floor: 1,
            squareFootage: null,
            bedrooms: 1,
            bathrooms: null,
            balcony: false,
            parkingSpaceNumbers: [],
            storageSpaceNumbers: [],
            ownershipPercentage: null,
            monthlyFees: null,
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set({
            ...updateData,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(updated.unitNumber).toBe('103');
        (0, globals_1.expect)(updated.squareFootage).toBeNull();
        (0, globals_1.expect)(updated.bathrooms).toBeNull();
        (0, globals_1.expect)(updated.ownershipPercentage).toBeNull();
        (0, globals_1.expect)(updated.monthlyFees).toBeNull();
        (0, globals_1.expect)(updated.parkingSpaceNumbers).toEqual([]);
        (0, globals_1.expect)(updated.storageSpaceNumbers).toEqual([]);
    });
    (0, globals_1.test)('should handle string numbers (converted to numeric)', async () => {
        const updateData = {
            unitNumber: '104',
            floor: 2,
            squareFootage: '1500', // String number
            bedrooms: 2,
            bathrooms: '2.5', // String number
            balcony: true,
            parkingSpaceNumbers: ['P4'],
            storageSpaceNumbers: ['S4'],
            ownershipPercentage: '4.25', // String number
            monthlyFees: '500.75', // String number
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set({
            ...updateData,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(updated.unitNumber).toBe('104');
        (0, globals_1.expect)(Number(updated.squareFootage)).toBe(1500);
        (0, globals_1.expect)(Number(updated.bathrooms)).toBe(2.5);
        (0, globals_1.expect)(Number(updated.ownershipPercentage)).toBe(4.25);
        (0, globals_1.expect)(Number(updated.monthlyFees)).toBe(500.75);
    });
    (0, globals_1.test)('should handle empty strings as null for optional fields', async () => {
        const updateData = {
            unitNumber: '105',
            floor: 1,
            squareFootage: '', // Empty string should become null
            bedrooms: 1,
            bathrooms: '', // Empty string should become null
            balcony: false,
            parkingSpaceNumbers: [],
            storageSpaceNumbers: [],
            ownershipPercentage: '', // Empty string should become null
            monthlyFees: '', // Empty string should become null
        };
        // Process empty strings to null (mimicking backend logic)
        const processedData = {
            ...updateData,
            squareFootage: updateData.squareFootage === '' ? null : updateData.squareFootage,
            bathrooms: updateData.bathrooms === '' ? null : updateData.bathrooms,
            ownershipPercentage: updateData.ownershipPercentage === '' ? null : updateData.ownershipPercentage,
            monthlyFees: updateData.monthlyFees === '' ? null : updateData.monthlyFees,
            updatedAt: new Date(),
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set(processedData)
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(updated.unitNumber).toBe('105');
        (0, globals_1.expect)(updated.squareFootage).toBeNull();
        (0, globals_1.expect)(updated.bathrooms).toBeNull();
        (0, globals_1.expect)(updated.ownershipPercentage).toBeNull();
        (0, globals_1.expect)(updated.monthlyFees).toBeNull();
    });
    (0, globals_1.test)('should preserve arrays correctly', async () => {
        const updateData = {
            unitNumber: '106',
            floor: 2,
            squareFootage: 1100,
            bedrooms: 2,
            bathrooms: 2.0,
            balcony: true,
            parkingSpaceNumbers: ['P5', 'P6', 'P7'],
            storageSpaceNumbers: ['S5', 'S6'],
            ownershipPercentage: 2.75,
            monthlyFees: 375.25,
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set({
            ...updateData,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(updated.parkingSpaceNumbers).toEqual(['P5', 'P6', 'P7']);
        (0, globals_1.expect)(updated.storageSpaceNumbers).toEqual(['S5', 'S6']);
        (0, globals_1.expect)(updated.parkingSpaceNumbers).toHaveLength(3);
        (0, globals_1.expect)(updated.storageSpaceNumbers).toHaveLength(2);
    });
    (0, globals_1.test)('should handle decimal precision correctly', async () => {
        const updateData = {
            unitNumber: '107',
            floor: 3,
            squareFootage: 1234.56, // Should preserve to 2 decimal places
            bedrooms: 3,
            bathrooms: 2.5, // Should preserve to 1 decimal place
            balcony: true,
            parkingSpaceNumbers: ['P8'],
            storageSpaceNumbers: ['S8'],
            ownershipPercentage: 3.1234, // Should preserve to 4 decimal places
            monthlyFees: 456.78, // Should preserve to 2 decimal places
        };
        const [updated] = await db_1.db
            .update(schema_1.residences)
            .set({
            ...updateData,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId))
            .returning();
        (0, globals_1.expect)(updated).toBeDefined();
        (0, globals_1.expect)(Number(updated.squareFootage)).toBe(1234.56);
        (0, globals_1.expect)(Number(updated.bathrooms)).toBe(2.5);
        (0, globals_1.expect)(Number(updated.ownershipPercentage)).toBe(3.1234);
        (0, globals_1.expect)(Number(updated.monthlyFees)).toBe(456.78);
    });
    (0, globals_1.test)('should maintain data integrity across multiple updates', async () => {
        // First update
        await db_1.db
            .update(schema_1.residences)
            .set({
            unitNumber: '108',
            squareFootage: 1000,
            bathrooms: '1.5',
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId));
        // Second update
        await db_1.db
            .update(schema_1.residences)
            .set({
            monthlyFees: 400.00,
            ownershipPercentage: 2.75,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId));
        // Verify final state
        const [final] = await db_1.db
            .select()
            .from(schema_1.residences)
            .where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidenceId));
        (0, globals_1.expect)(final).toBeDefined();
        (0, globals_1.expect)(final.unitNumber).toBe('108');
        (0, globals_1.expect)(Number(final.squareFootage)).toBe(1000);
        (0, globals_1.expect)(Number(final.bathrooms)).toBe(1.5);
        (0, globals_1.expect)(Number(final.monthlyFees)).toBe(400.00);
        (0, globals_1.expect)(Number(final.ownershipPercentage)).toBe(2.75);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L3Jlc2lkZW5jZS11cGRhdGUudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDJDQUF3RjtBQUN4Rix3Q0FBcUM7QUFDckMsZ0RBQTJFO0FBQzNFLDZDQUFpQztBQUVqQyxJQUFBLGtCQUFRLEVBQUMsc0JBQXNCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLElBQUksa0JBQTBCLENBQUM7SUFDL0IsSUFBSSxjQUFzQixDQUFDO0lBQzNCLElBQUksZUFBdUIsQ0FBQztJQUU1QixJQUFBLG1CQUFTLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsNkJBQTZCO1FBQzdCLE1BQU0sQ0FBQyxHQUFHLENBQUMsR0FBRyxNQUFNLE9BQUU7YUFDbkIsTUFBTSxDQUFDLHNCQUFhLENBQUM7YUFDckIsTUFBTSxDQUFDO1lBQ04sSUFBSSxFQUFFLDJCQUEyQjtZQUNqQyxPQUFPLEVBQUUsYUFBYTtZQUN0QixJQUFJLEVBQUUsVUFBVTtZQUNoQixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxTQUFTO1lBQ3JCLFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQzthQUNELFNBQVMsRUFBRSxDQUFDO1FBQ2Ysa0JBQWtCLEdBQUcsR0FBRyxDQUFDLEVBQUUsQ0FBQztRQUU1Qix5QkFBeUI7UUFDekIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxHQUFHLE1BQU0sT0FBRTthQUN4QixNQUFNLENBQUMsa0JBQVMsQ0FBQzthQUNqQixNQUFNLENBQUM7WUFDTixjQUFjLEVBQUUsa0JBQWtCO1lBQ2xDLElBQUksRUFBRSwyQkFBMkI7WUFDakMsT0FBTyxFQUFFLGdCQUFnQjtZQUN6QixJQUFJLEVBQUUsVUFBVTtZQUNoQixRQUFRLEVBQUUsSUFBSTtZQUNkLFVBQVUsRUFBRSxTQUFTO1lBQ3JCLFlBQVksRUFBRSxPQUFPO1lBQ3JCLFVBQVUsRUFBRSxFQUFFO1lBQ2QsV0FBVyxFQUFFLENBQUM7WUFDZCxRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUM7YUFDRCxTQUFT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LEVBQUMsbUJBQVUsQ0FBQyxFQUFFLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQztRQUU3QyxJQUFBLGdCQUFNLEVBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDNUIsSUFBQSxnQkFBTSxFQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0MsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDL0MsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN2RCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvdW5pdC9yZXNpZGVuY2UtdXBkYXRlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIHRlc3QsIGV4cGVjdCwgYmVmb3JlQWxsLCBhZnRlckFsbCwgYmVmb3JlRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi8uLi9zZXJ2ZXIvZGInO1xuaW1wb3J0IHsgcmVzaWRlbmNlcywgYnVpbGRpbmdzLCBvcmdhbml6YXRpb25zIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcblxuZGVzY3JpYmUoJ1Jlc2lkZW5jZSBVcGRhdGUgQVBJJywgKCkgPT4ge1xuICBsZXQgdGVzdE9yZ2FuaXphdGlvbklkOiBzdHJpbmc7XG4gIGxldCB0ZXN0QnVpbGRpbmdJZDogc3RyaW5nO1xuICBsZXQgdGVzdFJlc2lkZW5jZUlkOiBzdHJpbmc7XG5cbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDcmVhdGUgYSB0ZXN0IG9yZ2FuaXphdGlvblxuICAgIGNvbnN0IFtvcmddID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQob3JnYW5pemF0aW9ucylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBuYW1lOiAnVGVzdCBSZXNpZGVuY2UgVXBkYXRlIE9yZycsXG4gICAgICAgIGFkZHJlc3M6ICcxMjMgVGVzdCBTdCcsXG4gICAgICAgIGNpdHk6ICdNb250cmVhbCcsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnSDFIIDFIMScsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0T3JnYW5pemF0aW9uSWQgPSBvcmcuaWQ7XG5cbiAgICAvLyBDcmVhdGUgYSB0ZXN0IGJ1aWxkaW5nXG4gICAgY29uc3QgW2J1aWxkaW5nXSA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KGJ1aWxkaW5ncylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbklkLFxuICAgICAgICBuYW1lOiAnVGVzdCBCdWlsZGluZyBmb3IgVXBkYXRlcycsXG4gICAgICAgIGFkZHJlc3M6ICc0NTYgVXBkYXRlIEF2ZScsXG4gICAgICAgIGNpdHk6ICdNb250cmVhbCcsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnSDJIIDJIMicsXG4gICAgICAgIGJ1aWxkaW5nVHlwZTogJ2NvbmRvJyxcbiAgICAgICAgdG90YWxVbml0czogMTAsXG4gICAgICAgIHRvdGFsRmxvb3JzOiAzLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdEJ1aWxkaW5nSWQgPSBidWlsZGluZy5pZDtcblxuICAgIC8vIENyZWF0ZSBhIHRlc3QgcmVzaWRlbmNlXG4gICAgY29uc3QgW3Jlc2lkZW5jZV0gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChyZXNpZGVuY2VzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIGJ1aWxkaW5nSWQ6IHRlc3RCdWlsZGluZ0lkLFxuICAgICAgICB1bml0TnVtYmVyOiAnMTAxJyxcbiAgICAgICAgZmxvb3I6IDEsXG4gICAgICAgIHNxdWFyZUZvb3RhZ2U6ICcxMDAwJyxcbiAgICAgICAgYmVkcm9vbXM6IDIsXG4gICAgICAgIGJhdGhyb29tczogJzEuNScsXG4gICAgICAgIGJhbGNvbnk6IHRydWUsXG4gICAgICAgIHBhcmtpbmdTcGFjZU51bWJlcnM6IFsnUDEnXSxcbiAgICAgICAgc3RvcmFnZVNwYWNlTnVtYmVyczogWydTMSddLFxuICAgICAgICBvd25lcnNoaXBQZXJjZW50YWdlOiAnMi41JyxcbiAgICAgICAgbW9udGhseUZlZXM6ICczNTAuMDAnLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdFJlc2lkZW5jZUlkID0gcmVzaWRlbmNlLmlkO1xuICB9KTtcblxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhXG4gICAgYXdhaXQgZGIuZGVsZXRlKHJlc2lkZW5jZXMpLndoZXJlKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgdGVzdEJ1aWxkaW5nSWQpKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoYnVpbGRpbmdzKS53aGVyZShlcShidWlsZGluZ3MuaWQsIHRlc3RCdWlsZGluZ0lkKSk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKG9yZ2FuaXphdGlvbnMpLndoZXJlKGVxKG9yZ2FuaXphdGlvbnMuaWQsIHRlc3RPcmdhbml6YXRpb25JZCkpO1xuICB9KTtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBSZXNldCByZXNpZGVuY2UgdG8ga25vd24gc3RhdGUgYmVmb3JlIGVhY2ggdGVzdFxuICAgIGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgdW5pdE51bWJlcjogJzEwMScsXG4gICAgICAgIGZsb29yOiAxLFxuICAgICAgICBzcXVhcmVGb290YWdlOiAnMTAwMCcsXG4gICAgICAgIGJlZHJvb21zOiAyLFxuICAgICAgICBiYXRocm9vbXM6ICcxLjUnLFxuICAgICAgICBiYWxjb255OiB0cnVlLFxuICAgICAgICBwYXJraW5nU3BhY2VOdW1iZXJzOiBbJ1AxJ10sXG4gICAgICAgIHN0b3JhZ2VTcGFjZU51bWJlcnM6IFsnUzEnXSxcbiAgICAgICAgb3duZXJzaGlwUGVyY2VudGFnZTogJzIuNScsXG4gICAgICAgIG1vbnRobHlGZWVzOiAnMzUwLjAwJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEocmVzaWRlbmNlcy5pZCwgdGVzdFJlc2lkZW5jZUlkKSk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCB1cGRhdGUgcmVzaWRlbmNlIHdpdGggdmFsaWQgbnVtZXJpYyBkYXRhJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICB1bml0TnVtYmVyOiAnMTAyJyxcbiAgICAgIGZsb29yOiAyLFxuICAgICAgc3F1YXJlRm9vdGFnZTogMTIwMCxcbiAgICAgIGJlZHJvb21zOiAzLFxuICAgICAgYmF0aHJvb21zOiAyLjAsXG4gICAgICBiYWxjb255OiBmYWxzZSxcbiAgICAgIHBhcmtpbmdTcGFjZU51bWJlcnM6IFsnUDInLCAnUDMnXSxcbiAgICAgIHN0b3JhZ2VTcGFjZU51bWJlcnM6IFsnUzInXSxcbiAgICAgIG93bmVyc2hpcFBlcmNlbnRhZ2U6IDMuMCxcbiAgICAgIG1vbnRobHlGZWVzOiA0MjUuNTAsXG4gICAgfTtcblxuICAgIGNvbnN0IFt1cGRhdGVkXSA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgLi4udXBkYXRlRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShlcShyZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlSWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgZXhwZWN0KHVwZGF0ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQudW5pdE51bWJlcikudG9CZSgnMTAyJyk7XG4gICAgZXhwZWN0KHVwZGF0ZWQuZmxvb3IpLnRvQmUoMik7XG4gICAgZXhwZWN0KE51bWJlcih1cGRhdGVkLnNxdWFyZUZvb3RhZ2UpKS50b0JlKDEyMDApO1xuICAgIGV4cGVjdCh1cGRhdGVkLmJlZHJvb21zKS50b0JlKDMpO1xuICAgIGV4cGVjdChOdW1iZXIodXBkYXRlZC5iYXRocm9vbXMpKS50b0JlKDIuMCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQuYmFsY29ueSkudG9CZShmYWxzZSk7XG4gICAgZXhwZWN0KHVwZGF0ZWQucGFya2luZ1NwYWNlTnVtYmVycykudG9FcXVhbChbJ1AyJywgJ1AzJ10pO1xuICAgIGV4cGVjdCh1cGRhdGVkLnN0b3JhZ2VTcGFjZU51bWJlcnMpLnRvRXF1YWwoWydTMiddKTtcbiAgICBleHBlY3QoTnVtYmVyKHVwZGF0ZWQub3duZXJzaGlwUGVyY2VudGFnZSkpLnRvQmUoMy4wKTtcbiAgICBleHBlY3QoTnVtYmVyKHVwZGF0ZWQubW9udGhseUZlZXMpKS50b0JlKDQyNS41MCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbnVsbCB2YWx1ZXMgZm9yIG9wdGlvbmFsIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgdW5pdE51bWJlcjogJzEwMycsXG4gICAgICBmbG9vcjogMSxcbiAgICAgIHNxdWFyZUZvb3RhZ2U6IG51bGwsXG4gICAgICBiZWRyb29tczogMSxcbiAgICAgIGJhdGhyb29tczogbnVsbCxcbiAgICAgIGJhbGNvbnk6IGZhbHNlLFxuICAgICAgcGFya2luZ1NwYWNlTnVtYmVyczogW10sXG4gICAgICBzdG9yYWdlU3BhY2VOdW1iZXJzOiBbXSxcbiAgICAgIG93bmVyc2hpcFBlcmNlbnRhZ2U6IG51bGwsXG4gICAgICBtb250aGx5RmVlczogbnVsbCxcbiAgICB9O1xuXG4gICAgY29uc3QgW3VwZGF0ZWRdID0gYXdhaXQgZGJcbiAgICAgIC51cGRhdGUocmVzaWRlbmNlcylcbiAgICAgIC5zZXQoe1xuICAgICAgICAuLi51cGRhdGVEYXRhLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2VJZCkpXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICBleHBlY3QodXBkYXRlZCkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QodXBkYXRlZC51bml0TnVtYmVyKS50b0JlKCcxMDMnKTtcbiAgICBleHBlY3QodXBkYXRlZC5zcXVhcmVGb290YWdlKS50b0JlTnVsbCgpO1xuICAgIGV4cGVjdCh1cGRhdGVkLmJhdGhyb29tcykudG9CZU51bGwoKTtcbiAgICBleHBlY3QodXBkYXRlZC5vd25lcnNoaXBQZXJjZW50YWdlKS50b0JlTnVsbCgpO1xuICAgIGV4cGVjdCh1cGRhdGVkLm1vbnRobHlGZWVzKS50b0JlTnVsbCgpO1xuICAgIGV4cGVjdCh1cGRhdGVkLnBhcmtpbmdTcGFjZU51bWJlcnMpLnRvRXF1YWwoW10pO1xuICAgIGV4cGVjdCh1cGRhdGVkLnN0b3JhZ2VTcGFjZU51bWJlcnMpLnRvRXF1YWwoW10pO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgaGFuZGxlIHN0cmluZyBudW1iZXJzIChjb252ZXJ0ZWQgdG8gbnVtZXJpYyknLCBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgIHVuaXROdW1iZXI6ICcxMDQnLFxuICAgICAgZmxvb3I6IDIsXG4gICAgICBzcXVhcmVGb290YWdlOiAnMTUwMCcsIC8vIFN0cmluZyBudW1iZXJcbiAgICAgIGJlZHJvb21zOiAyLFxuICAgICAgYmF0aHJvb21zOiAnMi41JywgLy8gU3RyaW5nIG51bWJlclxuICAgICAgYmFsY29ueTogdHJ1ZSxcbiAgICAgIHBhcmtpbmdTcGFjZU51bWJlcnM6IFsnUDQnXSxcbiAgICAgIHN0b3JhZ2VTcGFjZU51bWJlcnM6IFsnUzQnXSxcbiAgICAgIG93bmVyc2hpcFBlcmNlbnRhZ2U6ICc0LjI1JywgLy8gU3RyaW5nIG51bWJlclxuICAgICAgbW9udGhseUZlZXM6ICc1MDAuNzUnLCAvLyBTdHJpbmcgbnVtYmVyXG4gICAgfTtcblxuICAgIGNvbnN0IFt1cGRhdGVkXSA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgLi4udXBkYXRlRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShlcShyZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlSWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgZXhwZWN0KHVwZGF0ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQudW5pdE51bWJlcikudG9CZSgnMTA0Jyk7XG4gICAgZXhwZWN0KE51bWJlcih1cGRhdGVkLnNxdWFyZUZvb3RhZ2UpKS50b0JlKDE1MDApO1xuICAgIGV4cGVjdChOdW1iZXIodXBkYXRlZC5iYXRocm9vbXMpKS50b0JlKDIuNSk7XG4gICAgZXhwZWN0KE51bWJlcih1cGRhdGVkLm93bmVyc2hpcFBlcmNlbnRhZ2UpKS50b0JlKDQuMjUpO1xuICAgIGV4cGVjdChOdW1iZXIodXBkYXRlZC5tb250aGx5RmVlcykpLnRvQmUoNTAwLjc1KTtcbiAgfSk7XG5cbiAgdGVzdCgnc2hvdWxkIGhhbmRsZSBlbXB0eSBzdHJpbmdzIGFzIG51bGwgZm9yIG9wdGlvbmFsIGZpZWxkcycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgdW5pdE51bWJlcjogJzEwNScsXG4gICAgICBmbG9vcjogMSxcbiAgICAgIHNxdWFyZUZvb3RhZ2U6ICcnLCAvLyBFbXB0eSBzdHJpbmcgc2hvdWxkIGJlY29tZSBudWxsXG4gICAgICBiZWRyb29tczogMSxcbiAgICAgIGJhdGhyb29tczogJycsIC8vIEVtcHR5IHN0cmluZyBzaG91bGQgYmVjb21lIG51bGxcbiAgICAgIGJhbGNvbnk6IGZhbHNlLFxuICAgICAgcGFya2luZ1NwYWNlTnVtYmVyczogW10sXG4gICAgICBzdG9yYWdlU3BhY2VOdW1iZXJzOiBbXSxcbiAgICAgIG93bmVyc2hpcFBlcmNlbnRhZ2U6ICcnLCAvLyBFbXB0eSBzdHJpbmcgc2hvdWxkIGJlY29tZSBudWxsXG4gICAgICBtb250aGx5RmVlczogJycsIC8vIEVtcHR5IHN0cmluZyBzaG91bGQgYmVjb21lIG51bGxcbiAgICB9O1xuXG4gICAgLy8gUHJvY2VzcyBlbXB0eSBzdHJpbmdzIHRvIG51bGwgKG1pbWlja2luZyBiYWNrZW5kIGxvZ2ljKVxuICAgIGNvbnN0IHByb2Nlc3NlZERhdGEgPSB7XG4gICAgICAuLi51cGRhdGVEYXRhLFxuICAgICAgc3F1YXJlRm9vdGFnZTogdXBkYXRlRGF0YS5zcXVhcmVGb290YWdlID09PSAnJyA/IG51bGwgOiB1cGRhdGVEYXRhLnNxdWFyZUZvb3RhZ2UsXG4gICAgICBiYXRocm9vbXM6IHVwZGF0ZURhdGEuYmF0aHJvb21zID09PSAnJyA/IG51bGwgOiB1cGRhdGVEYXRhLmJhdGhyb29tcyxcbiAgICAgIG93bmVyc2hpcFBlcmNlbnRhZ2U6IHVwZGF0ZURhdGEub3duZXJzaGlwUGVyY2VudGFnZSA9PT0gJycgPyBudWxsIDogdXBkYXRlRGF0YS5vd25lcnNoaXBQZXJjZW50YWdlLFxuICAgICAgbW9udGhseUZlZXM6IHVwZGF0ZURhdGEubW9udGhseUZlZXMgPT09ICcnID8gbnVsbCA6IHVwZGF0ZURhdGEubW9udGhseUZlZXMsXG4gICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgfTtcblxuICAgIGNvbnN0IFt1cGRhdGVkXSA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHByb2Nlc3NlZERhdGEpXG4gICAgICAud2hlcmUoZXEocmVzaWRlbmNlcy5pZCwgdGVzdFJlc2lkZW5jZUlkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIGV4cGVjdCh1cGRhdGVkKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdCh1cGRhdGVkLnVuaXROdW1iZXIpLnRvQmUoJzEwNScpO1xuICAgIGV4cGVjdCh1cGRhdGVkLnNxdWFyZUZvb3RhZ2UpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQuYmF0aHJvb21zKS50b0JlTnVsbCgpO1xuICAgIGV4cGVjdCh1cGRhdGVkLm93bmVyc2hpcFBlcmNlbnRhZ2UpLnRvQmVOdWxsKCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQubW9udGhseUZlZXMpLnRvQmVOdWxsKCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBwcmVzZXJ2ZSBhcnJheXMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICB1bml0TnVtYmVyOiAnMTA2JyxcbiAgICAgIGZsb29yOiAyLFxuICAgICAgc3F1YXJlRm9vdGFnZTogMTEwMCxcbiAgICAgIGJlZHJvb21zOiAyLFxuICAgICAgYmF0aHJvb21zOiAyLjAsXG4gICAgICBiYWxjb255OiB0cnVlLFxuICAgICAgcGFya2luZ1NwYWNlTnVtYmVyczogWydQNScsICdQNicsICdQNyddLFxuICAgICAgc3RvcmFnZVNwYWNlTnVtYmVyczogWydTNScsICdTNiddLFxuICAgICAgb3duZXJzaGlwUGVyY2VudGFnZTogMi43NSxcbiAgICAgIG1vbnRobHlGZWVzOiAzNzUuMjUsXG4gICAgfTtcblxuICAgIGNvbnN0IFt1cGRhdGVkXSA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgLi4udXBkYXRlRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShlcShyZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlSWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgZXhwZWN0KHVwZGF0ZWQpLnRvQmVEZWZpbmVkKCk7XG4gICAgZXhwZWN0KHVwZGF0ZWQucGFya2luZ1NwYWNlTnVtYmVycykudG9FcXVhbChbJ1A1JywgJ1A2JywgJ1A3J10pO1xuICAgIGV4cGVjdCh1cGRhdGVkLnN0b3JhZ2VTcGFjZU51bWJlcnMpLnRvRXF1YWwoWydTNScsICdTNiddKTtcbiAgICBleHBlY3QodXBkYXRlZC5wYXJraW5nU3BhY2VOdW1iZXJzKS50b0hhdmVMZW5ndGgoMyk7XG4gICAgZXhwZWN0KHVwZGF0ZWQuc3RvcmFnZVNwYWNlTnVtYmVycykudG9IYXZlTGVuZ3RoKDIpO1xuICB9KTtcblxuICB0ZXN0KCdzaG91bGQgaGFuZGxlIGRlY2ltYWwgcHJlY2lzaW9uIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB1cGRhdGVEYXRhID0ge1xuICAgICAgdW5pdE51bWJlcjogJzEwNycsXG4gICAgICBmbG9vcjogMyxcbiAgICAgIHNxdWFyZUZvb3RhZ2U6IDEyMzQuNTYsIC8vIFNob3VsZCBwcmVzZXJ2ZSB0byAyIGRlY2ltYWwgcGxhY2VzXG4gICAgICBiZWRyb29tczogMyxcbiAgICAgIGJhdGhyb29tczogMi41LCAvLyBTaG91bGQgcHJlc2VydmUgdG8gMSBkZWNpbWFsIHBsYWNlXG4gICAgICBiYWxjb255OiB0cnVlLFxuICAgICAgcGFya2luZ1NwYWNlTnVtYmVyczogWydQOCddLFxuICAgICAgc3RvcmFnZVNwYWNlTnVtYmVyczogWydTOCddLFxuICAgICAgb3duZXJzaGlwUGVyY2VudGFnZTogMy4xMjM0LCAvLyBTaG91bGQgcHJlc2VydmUgdG8gNCBkZWNpbWFsIHBsYWNlc1xuICAgICAgbW9udGhseUZlZXM6IDQ1Ni43OCwgLy8gU2hvdWxkIHByZXNlcnZlIHRvIDIgZGVjaW1hbCBwbGFjZXNcbiAgICB9O1xuXG4gICAgY29uc3QgW3VwZGF0ZWRdID0gYXdhaXQgZGJcbiAgICAgIC51cGRhdGUocmVzaWRlbmNlcylcbiAgICAgIC5zZXQoe1xuICAgICAgICAuLi51cGRhdGVEYXRhLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2VJZCkpXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICBleHBlY3QodXBkYXRlZCkudG9CZURlZmluZWQoKTtcbiAgICBleHBlY3QoTnVtYmVyKHVwZGF0ZWQuc3F1YXJlRm9vdGFnZSkpLnRvQmUoMTIzNC41Nik7XG4gICAgZXhwZWN0KE51bWJlcih1cGRhdGVkLmJhdGhyb29tcykpLnRvQmUoMi41KTtcbiAgICBleHBlY3QoTnVtYmVyKHVwZGF0ZWQub3duZXJzaGlwUGVyY2VudGFnZSkpLnRvQmUoMy4xMjM0KTtcbiAgICBleHBlY3QoTnVtYmVyKHVwZGF0ZWQubW9udGhseUZlZXMpKS50b0JlKDQ1Ni43OCk7XG4gIH0pO1xuXG4gIHRlc3QoJ3Nob3VsZCBtYWludGFpbiBkYXRhIGludGVncml0eSBhY3Jvc3MgbXVsdGlwbGUgdXBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAvLyBGaXJzdCB1cGRhdGVcbiAgICBhd2FpdCBkYlxuICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgLnNldCh7XG4gICAgICAgIHVuaXROdW1iZXI6ICcxMDgnLFxuICAgICAgICBzcXVhcmVGb290YWdlOiAxMDAwLFxuICAgICAgICBiYXRocm9vbXM6ICcxLjUnLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2VJZCkpO1xuXG4gICAgLy8gU2Vjb25kIHVwZGF0ZVxuICAgIGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgbW9udGhseUZlZXM6IDQwMC4wMCxcbiAgICAgICAgb3duZXJzaGlwUGVyY2VudGFnZTogMi43NSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShlcShyZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlSWQpKTtcblxuICAgIC8vIFZlcmlmeSBmaW5hbCBzdGF0ZVxuICAgIGNvbnN0IFtmaW5hbF0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuaWQsIHRlc3RSZXNpZGVuY2VJZCkpO1xuXG4gICAgZXhwZWN0KGZpbmFsKS50b0JlRGVmaW5lZCgpO1xuICAgIGV4cGVjdChmaW5hbC51bml0TnVtYmVyKS50b0JlKCcxMDgnKTtcbiAgICBleHBlY3QoTnVtYmVyKGZpbmFsLnNxdWFyZUZvb3RhZ2UpKS50b0JlKDEwMDApO1xuICAgIGV4cGVjdChOdW1iZXIoZmluYWwuYmF0aHJvb21zKSkudG9CZSgxLjUpO1xuICAgIGV4cGVjdChOdW1iZXIoZmluYWwubW9udGhseUZlZXMpKS50b0JlKDQwMC4wMCk7XG4gICAgZXhwZWN0KE51bWJlcihmaW5hbC5vd25lcnNoaXBQZXJjZW50YWdlKSkudG9CZSgyLjc1KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=