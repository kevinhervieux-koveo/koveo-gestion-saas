8875606224b59a31a6483f4f14629321
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerCommonSpacesRoutes = registerCommonSpacesRoutes;
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
const auth_1 = require("../auth");
const zod_1 = require("zod");
const schema = __importStar(require("@shared/schema"));
const { commonSpaces, bookings, userBookingRestrictions, userTimeLimits, buildings, users, userResidences, userOrganizations, } = schema;
// Validation schemas
const commonSpaceFilterSchema = zod_1.z.object({
    building_id: zod_1.z.string().uuid().optional(),
});
const bookingFilterSchema = zod_1.z.object({
    start_date: zod_1.z.string().datetime().optional(),
    end_date: zod_1.z.string().datetime().optional(),
});
// Calendar-specific schemas
const calendarQuerySchema = zod_1.z.object({
    start_date: zod_1.z.string().datetime(),
    end_date: zod_1.z.string().datetime(),
    view: zod_1.z.enum(['month', 'week', 'day']).optional().default('month'),
});
const buildingCalendarSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
});
const createBookingSchema = zod_1.z.object({
    start_time: zod_1.z.string().datetime(),
    end_time: zod_1.z.string().datetime(),
});
const createRestrictionSchema = zod_1.z.object({
    common_space_id: zod_1.z.string().uuid(),
    is_blocked: zod_1.z.boolean(),
    reason: zod_1.z.string().optional(),
});
const createCommonSpaceSchema = zod_1.z.object({
    name: zod_1.z.string().min(1, 'Name is required').max(100, 'Name too long'),
    description: zod_1.z.string().optional(),
    building_id: zod_1.z.string().uuid('Building ID must be a valid UUID'),
    is_reservable: zod_1.z.boolean().default(true),
    capacity: zod_1.z.number().int().min(1).max(200).optional(),
    opening_hours: zod_1.z
        .object({
        start: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
        end: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
    })
        .optional(),
});
const setTimeLimitSchema = zod_1.z.object({
    user_id: zod_1.z.string().uuid(),
    common_space_id: zod_1.z.string().uuid().optional(), // null means applies to all spaces
    limit_type: zod_1.z.enum(['monthly', 'yearly']),
    limit_hours: zod_1.z.number().int().min(1).max(8760), // Max 1 year worth of hours
});
const spaceIdSchema = zod_1.z.object({
    spaceId: zod_1.z.string().uuid(),
});
const bookingIdSchema = zod_1.z.object({
    bookingId: zod_1.z.string().uuid(),
});
const userIdSchema = zod_1.z.object({
    userId: zod_1.z.string().uuid(),
});
/**
 * Helper function to get accessible building IDs for a user based on their role.
 * @param user
 */
async function getAccessibleBuildingIds(user) {
    // Admin users have access to all buildings
    if (user.role === 'admin') {
        const allBuildings = await db_1.db
            .select({ buildingId: buildings.id })
            .from(buildings)
            .where((0, drizzle_orm_1.eq)(buildings.isActive, true));
        return allBuildings.map((b) => b.buildingId);
    }
    // Check if user belongs to Koveo organization (special global access)
    const userOrgs = await db_1.db
        .select({
        organizationId: schema.organizations.id,
        organizationName: schema.organizations.name,
        canAccessAllOrganizations: userOrganizations.canAccessAllOrganizations,
    })
        .from(schema.organizations)
        .innerJoin(userOrganizations, (0, drizzle_orm_1.eq)(userOrganizations.organizationId, schema.organizations.id))
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(userOrganizations.isActive, true)));
    const hasGlobalAccess = userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
    if (hasGlobalAccess) {
        const allBuildings = await db_1.db
            .select({ buildingId: buildings.id })
            .from(buildings)
            .where((0, drizzle_orm_1.eq)(buildings.isActive, true));
        return allBuildings.map((b) => b.buildingId);
    }
    // Regular users and managers: Get buildings from their organizations
    if (user.role === 'manager') {
        if (userOrgs.length > 0) {
            const orgIds = userOrgs.map((uo) => uo.organizationId);
            const orgBuildings = await db_1.db
                .select({ buildingId: buildings.id })
                .from(buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(buildings.isActive, true)));
            return orgBuildings.map((b) => b.buildingId);
        }
    }
    // All users can also access buildings where they have residences
    const userBuildingIds = await db_1.db
        .select({ buildingId: schema.residences.buildingId })
        .from(userResidences)
        .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(userResidences.residenceId, schema.residences.id))
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userResidences.userId, user.id), (0, drizzle_orm_1.eq)(userResidences.isActive, true)));
    return userBuildingIds.map((b) => b.buildingId);
}
/**
 * Helper function to calculate user's total booking hours for a time period.
 * @param userId
 * @param commonSpaceId
 * @param limitType
 */
async function getUserBookingHours(userId, commonSpaceId, limitType) {
    const now = new Date();
    let startDate;
    if (limitType === 'monthly') {
        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
    }
    else {
        startDate = new Date(now.getFullYear(), 0, 1);
    }
    const conditions = [
        (0, drizzle_orm_1.eq)(bookings.userId, userId),
        (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
        (0, drizzle_orm_1.gte)(bookings.startTime, startDate),
    ];
    if (commonSpaceId) {
        conditions.push((0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaceId));
    }
    const userBookings = await db_1.db
        .select({
        totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
    })
        .from(bookings)
        .where((0, drizzle_orm_1.and)(...conditions));
    return userBookings[0]?.totalHours || 0;
}
/**
 * Helper function to check if user has exceeded their booking time limit.
 * @param userId
 * @param commonSpaceId
 * @param newBookingHours
 */
async function checkUserTimeLimit(userId, commonSpaceId, newBookingHours) {
    // Get user's time limits for this space (specific or global)
    const timeLimits = await db_1.db
        .select()
        .from(userTimeLimits)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, commonSpaceId), (0, drizzle_orm_1.sql) `${userTimeLimits.commonSpaceId} IS NULL`)))
        .orderBy(userTimeLimits.commonSpaceId); // Specific limits come first (nulls last)
    if (timeLimits.length === 0) {
        return { withinLimit: true }; // No limits set
    }
    // Use the most specific limit (space-specific over global)
    const activeLimit = timeLimits[0];
    const currentHours = await getUserBookingHours(userId, activeLimit.commonSpaceId, activeLimit.limitType);
    const totalAfterBooking = currentHours + newBookingHours;
    const remainingHours = Math.max(0, activeLimit.limitHours - currentHours);
    if (totalAfterBooking > activeLimit.limitHours) {
        const limitPeriod = activeLimit.limitType === 'monthly' ? 'ce mois' : 'cette année';
        return {
            withinLimit: false,
            message: `Limite de temps dépassée. Vous avez utilisé ${Math.round(currentHours)}h sur ${activeLimit.limitHours}h autorisées pour ${limitPeriod}. Il vous reste ${Math.round(remainingHours)}h disponibles.`,
            remainingHours,
        };
    }
    return { withinLimit: true, remainingHours };
}
/**
 * Helper function to check if a time slot overlaps with existing bookings.
 * @param commonSpaceId
 * @param startTime
 * @param endTime
 * @param excludeBookingId
 */
async function hasOverlappingBookings(commonSpaceId, startTime, endTime, excludeBookingId) {
    const conditions = [
        (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaceId),
        (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
        (0, drizzle_orm_1.or)(
        // New booking starts during existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.startTime, startTime), (0, drizzle_orm_1.lte)(bookings.startTime, endTime)), 
        // New booking ends during existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.endTime, startTime), (0, drizzle_orm_1.lte)(bookings.endTime, endTime)), 
        // New booking completely contains existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.lte)(bookings.startTime, startTime), (0, drizzle_orm_1.gte)(bookings.endTime, endTime)), 
        // Existing booking completely contains new booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.startTime, startTime), (0, drizzle_orm_1.lte)(bookings.endTime, endTime))),
    ];
    if (excludeBookingId) {
        conditions.push((0, drizzle_orm_1.sql) `${bookings.id} != ${excludeBookingId}`);
    }
    const overlapping = await db_1.db
        .select({ id: bookings.id })
        .from(bookings)
        .where((0, drizzle_orm_1.and)(...conditions))
        .limit(1);
    return overlapping.length > 0;
}
/**
 * Helper function to check if user is blocked from booking a space.
 * @param userId
 * @param commonSpaceId
 */
async function isUserBlocked(userId, commonSpaceId) {
    const restriction = await db_1.db
        .select({ isBlocked: userBookingRestrictions.isBlocked })
        .from(userBookingRestrictions)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userBookingRestrictions.userId, userId), (0, drizzle_orm_1.eq)(userBookingRestrictions.commonSpaceId, commonSpaceId)))
        .limit(1);
    return restriction.length > 0 && restriction[0].isBlocked;
}
/**
 * Helper function to check if booking time is within opening hours.
 * @param startTime
 * @param endTime
 * @param openingHours
 */
function isWithinOpeningHours(startTime, endTime, openingHours) {
    if (!openingHours || openingHours.length === 0) {
        return true; // No restrictions if no opening hours defined
    }
    const startDay = startTime.toLocaleDateString('en-US', { weekday: 'long' });
    const endDay = endTime.toLocaleDateString('en-US', { weekday: 'long' });
    // For simplicity, require booking to be within same day
    if (startDay !== endDay) {
        return false;
    }
    const dayHours = openingHours.find((oh) => oh.day === startDay);
    if (!dayHours) {
        return false; // No hours defined for this day
    }
    const startTimeStr = startTime.toTimeString().slice(0, 5); // HH:MM format
    const endTimeStr = endTime.toTimeString().slice(0, 5);
    return startTimeStr >= dayHours.open && endTimeStr <= dayHours.close;
}
/**
 * Registers all common spaces API endpoints.
 * @param app
 */
function registerCommonSpacesRoutes(app) {
    /**
     * GET /api/common-spaces - Retrieve common spaces for accessible buildings.
     */
    app.get('/api/common-spaces', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate query parameters
            const queryValidation = commonSpaceFilterSchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { building_id } = queryValidation.data;
            // Get accessible building IDs
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (accessibleBuildingIds.length === 0) {
                return res.json([]);
            }
            // Build conditions
            const conditions = [(0, drizzle_orm_1.eq)(buildings.isActive, true)];
            if (building_id) {
                if (!accessibleBuildingIds.includes(building_id)) {
                    return res.status(403).json({
                        message: 'Access denied to this building',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
                conditions.push((0, drizzle_orm_1.eq)(commonSpaces.buildingId, building_id));
            }
            else {
                conditions.push((0, drizzle_orm_1.inArray)(commonSpaces.buildingId, accessibleBuildingIds));
            }
            const spaces = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                description: commonSpaces.description,
                buildingId: commonSpaces.buildingId,
                buildingName: buildings.name,
                isReservable: commonSpaces.isReservable,
                capacity: commonSpaces.capacity,
                contactPersonId: commonSpaces.contactPersonId,
                contactPersonName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                openingHours: commonSpaces.openingHours,
                bookingRules: commonSpaces.bookingRules,
                createdAt: commonSpaces.createdAt,
                updatedAt: commonSpaces.updatedAt,
            })
                .from(commonSpaces)
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .leftJoin(users, (0, drizzle_orm_1.eq)(commonSpaces.contactPersonId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(buildings.name, commonSpaces.name);
            res.json(spaces);
        }
        catch (error) {
            res.status(500).json({
                message: 'Failed to fetch common spaces',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/:spaceId/bookings - Get bookings for a specific space.
     */
    app.get('/api/common-spaces/:spaceId/bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const queryValidation = bookingFilterSchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_date, end_date } = queryValidation.data;
            // Check if user has access to this space
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Build query conditions
            const conditions = [(0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId)];
            if (start_date) {
                conditions.push((0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)));
            }
            if (end_date) {
                conditions.push((0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date)));
            }
            const spaceBookings = await db_1.db
                .select({
                id: bookings.id,
                commonSpaceId: bookings.commonSpaceId,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                createdAt: bookings.createdAt,
                updatedAt: bookings.updatedAt,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(bookings.startTime);
            res.json(spaceBookings);
        }
        catch (error) {
            console.error('❌ Error fetching bookings:', error);
            res.status(500).json({
                message: 'Failed to fetch bookings',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/:spaceId/bookings - Create a new booking.
     */
    app.post('/api/common-spaces/:spaceId/bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters and body
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const bodyValidation = createBookingSchema.safeParse(req.body);
            if (!bodyValidation.success) {
                return res.status(400).json({
                    message: 'Invalid booking data',
                    errors: bodyValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_time, end_time } = bodyValidation.data;
            const startTime = new Date(start_time);
            const endTime = new Date(end_time);
            // Validate time range
            if (startTime >= endTime) {
                return res.status(400).json({
                    message: 'Start time must be before end time',
                    code: 'INVALID_TIME_RANGE',
                });
            }
            // Allow bookings for today and future dates (with 5-minute buffer for current time)
            const now = new Date();
            const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);
            if (startTime < fiveMinutesAgo) {
                return res.status(400).json({
                    message: 'Cannot book in the past',
                    code: 'INVALID_TIME_RANGE',
                });
            }
            // Get common space details
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                buildingId: commonSpaces.buildingId,
                isReservable: commonSpaces.isReservable,
                openingHours: commonSpaces.openingHours,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const commonSpace = space[0];
            // Check if space is reservable
            if (!commonSpace.isReservable) {
                return res.status(400).json({
                    message: 'This common space is not reservable',
                    code: 'NOT_RESERVABLE',
                });
            }
            // Check user access to building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(commonSpace.buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Check if user is blocked
            const blocked = await isUserBlocked(user.id, spaceId);
            if (blocked) {
                return res.status(403).json({
                    message: 'You are blocked from booking this space',
                    code: 'USER_BLOCKED',
                });
            }
            // Check opening hours
            if (commonSpace.openingHours &&
                !isWithinOpeningHours(startTime, endTime, commonSpace.openingHours)) {
                return res.status(400).json({
                    message: 'Booking time is outside opening hours',
                    code: 'OUTSIDE_OPENING_HOURS',
                });
            }
            // Check for overlapping bookings
            const hasOverlap = await hasOverlappingBookings(spaceId, startTime, endTime);
            if (hasOverlap) {
                return res.status(409).json({
                    message: 'Time slot is already booked',
                    code: 'TIME_CONFLICT',
                });
            }
            // Check user's time limits
            const bookingDurationHours = (endTime.getTime() - startTime.getTime()) / (1000 * 60 * 60);
            const timeLimitCheck = await checkUserTimeLimit(user.id, spaceId, bookingDurationHours);
            if (!timeLimitCheck.withinLimit) {
                return res.status(403).json({
                    message: timeLimitCheck.message,
                    code: 'TIME_LIMIT_EXCEEDED',
                    remainingHours: timeLimitCheck.remainingHours,
                });
            }
            // Create booking
            const newBooking = await db_1.db
                .insert(bookings)
                .values({
                commonSpaceId: spaceId,
                userId: user.id,
                startTime,
                endTime,
                status: 'confirmed',
            })
                .returning();
            res.status(201).json({
                message: 'Booking created successfully',
                booking: newBooking[0],
            });
        }
        catch (error) {
            console.error('❌ Error creating booking:', error);
            res.status(500).json({
                message: 'Failed to create booking',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/calendar/:spaceId - Get calendar data for a specific space.
     */
    app.get('/api/common-spaces/calendar/:spaceId', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_date, end_date, view } = queryValidation.data;
            // Get space details and check access
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                buildingId: commonSpaces.buildingId,
                isReservable: commonSpaces.isReservable,
                openingHours: commonSpaces.openingHours,
                capacity: commonSpaces.capacity,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const commonSpace = space[0];
            // Check user access to building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(commonSpace.buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get bookings for the specified date range
            const conditions = [
                (0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId),
                (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
                (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)),
                (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date)),
            ];
            const spaceBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                userRole: users.role,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(bookings.startTime);
            // Determine permissions
            const canViewDetails = ['admin', 'manager'].includes(user.role);
            // Transform bookings to calendar events
            const events = spaceBookings.map((booking) => ({
                id: booking.id,
                startTime: booking.startTime.toISOString(),
                endTime: booking.endTime.toISOString(),
                status: booking.status,
                userId: booking.userId,
                userName: canViewDetails || booking.userId === user.id ? booking.userName : 'Déjà Réservé',
                userEmail: canViewDetails || booking.userId === user.id ? booking.userEmail : null,
                isOwnBooking: booking.userId === user.id,
                spaceId: spaceId,
                spaceName: commonSpace.name,
                userRole: booking.userRole,
            }));
            // Calculate summary statistics
            const totalBookings = events.length;
            const totalHours = events.reduce((sum, event) => {
                const duration = (new Date(event.endTime).getTime() - new Date(event.startTime).getTime()) /
                    (1000 * 60 * 60);
                return sum + duration;
            }, 0);
            const uniqueUsers = new Set(events.map((e) => e.userId)).size;
            // Build calendar response
            const calendarData = {
                space: {
                    id: commonSpace.id,
                    name: commonSpace.name,
                    isReservable: commonSpace.isReservable,
                    openingHours: commonSpace.openingHours,
                },
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    events,
                },
                permissions: {
                    canViewDetails,
                    canCreateBookings: commonSpace.isReservable && !(await isUserBlocked(user.id, spaceId)),
                },
                summary: {
                    totalBookings,
                    totalHours: Math.round(totalHours * 10) / 10,
                    uniqueUsers,
                },
            };
            res.json(calendarData);
        }
        catch (error) {
            console.error('❌ Error fetching calendar data:', error);
            res.status(500).json({
                message: 'Failed to fetch calendar data',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/my-bookings - Get current user's bookings.
     */
    app.get('/api/common-spaces/my-bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            // Get all user's confirmed bookings with space and building info
            const userBookings = await db_1.db
                .select({
                id: bookings.id,
                commonSpaceId: bookings.commonSpaceId,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                createdAt: bookings.createdAt,
                commonSpaceName: commonSpaces.name,
                buildingName: buildings.name,
                buildingAddress: buildings.address,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.userId, user.id), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed')))
                .orderBy((0, drizzle_orm_1.desc)(bookings.startTime));
            res.json(userBookings);
        }
        catch (error) {
            console.error('❌ Error fetching user bookings:', error);
            res.status(500).json({
                message: 'Failed to fetch user bookings',
                details: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * DELETE /api/common-spaces/bookings/:bookingId - Cancel a booking.
     */
    app.delete('/api/common-spaces/bookings/:bookingId', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = bookingIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid booking ID',
                    errors: paramValidation.error.issues,
                });
            }
            const { bookingId } = paramValidation.data;
            // Get booking details
            const booking = await db_1.db
                .select({
                id: bookings.id,
                userId: bookings.userId,
                commonSpaceId: bookings.commonSpaceId,
                buildingId: commonSpaces.buildingId,
                status: bookings.status,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .where((0, drizzle_orm_1.eq)(bookings.id, bookingId))
                .limit(1);
            if (booking.length === 0) {
                return res.status(404).json({
                    message: 'Booking not found',
                    code: 'NOT_FOUND',
                });
            }
            const bookingDetails = booking[0];
            // Check permissions: users can cancel their own bookings, managers can cancel any in their buildings
            let canCancel = false;
            if (bookingDetails.userId === user.id) {
                canCancel = true; // Users can always cancel their own bookings
            }
            else if (['admin', 'manager'].includes(user.role)) {
                // Managers can cancel bookings in buildings they have access to
                const accessibleBuildingIds = await getAccessibleBuildingIds(user);
                canCancel = accessibleBuildingIds.includes(bookingDetails.buildingId);
            }
            if (!canCancel) {
                return res.status(403).json({
                    message: 'Can only cancel your own bookings',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Update booking status to cancelled
            await db_1.db
                .update(bookings)
                .set({
                status: 'cancelled',
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(bookings.id, bookingId));
            res.json({
                message: 'Booking cancelled successfully',
            });
        }
        catch (error) {
            console.error('❌ Error cancelling booking:', error);
            res.status(500).json({
                message: 'Failed to cancel booking',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/:spaceId/stats - Get usage statistics (Manager/Admin only).
     */
    app.get('/api/common-spaces/:spaceId/stats', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            // Check access to space
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
                name: commonSpaces.name,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Calculate stats for last year
            const oneYearAgo = new Date();
            oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
            const stats = await db_1.db
                .select({
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
                totalBookings: (0, drizzle_orm_1.sql) `COUNT(${bookings.id})`,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, oneYearAgo)))
                .groupBy(bookings.userId, users.firstName, users.lastName, users.email)
                .orderBy((0, drizzle_orm_1.desc)((0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`));
            const totalStats = await db_1.db
                .select({
                totalBookings: (0, drizzle_orm_1.sql) `COUNT(${bookings.id})`,
                totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
                uniqueUsers: (0, drizzle_orm_1.sql) `COUNT(DISTINCT ${bookings.userId})`,
            })
                .from(bookings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, oneYearAgo)));
            res.json({
                spaceName: space[0].name,
                period: 'Last 12 months',
                summary: totalStats[0],
                userStats: stats,
            });
        }
        catch (error) {
            console.error('❌ Error fetching space statistics:', error);
            res.status(500).json({
                message: 'Failed to fetch space statistics',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/users/:userId/restrictions - Block/unblock user (Manager/Admin only).
     */
    app.post('/api/common-spaces/users/:userId/restrictions', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters and body
            const paramValidation = userIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid user ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const bodyValidation = createRestrictionSchema.safeParse(req.body);
            if (!bodyValidation.success) {
                return res.status(400).json({
                    message: 'Invalid restriction data',
                    errors: bodyValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { userId } = paramValidation.data;
            const { common_space_id, is_blocked, reason } = bodyValidation.data;
            // Check if target user exists
            const targetUser = await db_1.db
                .select({ id: users.id })
                .from(users)
                .where((0, drizzle_orm_1.eq)(users.id, userId))
                .limit(1);
            if (targetUser.length === 0) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'NOT_FOUND',
                });
            }
            // Check if common space exists and user has access
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, common_space_id))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Check if restriction already exists
            const existingRestriction = await db_1.db
                .select({ id: userBookingRestrictions.id })
                .from(userBookingRestrictions)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userBookingRestrictions.userId, userId), (0, drizzle_orm_1.eq)(userBookingRestrictions.commonSpaceId, common_space_id)))
                .limit(1);
            if (existingRestriction.length > 0) {
                // Update existing restriction
                await db_1.db
                    .update(userBookingRestrictions)
                    .set({
                    isBlocked: is_blocked,
                    reason,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.eq)(userBookingRestrictions.id, existingRestriction[0].id));
            }
            else {
                // Create new restriction
                await db_1.db.insert(userBookingRestrictions).values({
                    userId,
                    commonSpaceId: common_space_id,
                    isBlocked: is_blocked,
                    reason,
                });
            }
            res.json({
                message: `User ${is_blocked ? 'blocked from' : 'unblocked from'} booking this space`,
            });
        }
        catch (error) {
            console.error('❌ Error managing user restriction:', error);
            res.status(500).json({
                message: 'Failed to manage user restriction',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces - Create a new common space (Manager/Admin only).
     */
    app.post('/api/common-spaces', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate request body
            const validationResult = createCommonSpaceSchema.safeParse(req.body);
            if (!validationResult.success) {
                return res.status(400).json({
                    message: 'Invalid request data',
                    errors: validationResult.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { name, description, building_id, is_reservable, capacity, opening_hours } = validationResult.data;
            // Check if user has access to this building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(building_id)) {
                return res.status(403).json({
                    message: 'Access denied. You can only create spaces in buildings you manage.',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Verify building exists and is active
            const building = await db_1.db
                .select({ id: buildings.id, name: buildings.name })
                .from(buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(buildings.id, building_id), (0, drizzle_orm_1.eq)(buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    message: 'Building not found or inactive',
                    code: 'BUILDING_NOT_FOUND',
                });
            }
            // Check if a space with the same name already exists in this building
            const existingSpace = await db_1.db
                .select({ id: commonSpaces.id })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(commonSpaces.name, name), (0, drizzle_orm_1.eq)(commonSpaces.buildingId, building_id)))
                .limit(1);
            if (existingSpace.length > 0) {
                return res.status(409).json({
                    message: 'A common space with this name already exists in this building',
                    code: 'DUPLICATE_NAME',
                });
            }
            // Create the new common space
            const newSpace = await db_1.db
                .insert(commonSpaces)
                .values({
                name,
                description: description || null,
                buildingId: building_id,
                isReservable: is_reservable,
                capacity: capacity || null,
                openingHours: opening_hours ? `${opening_hours.start}-${opening_hours.end}` : null,
            })
                .returning();
            console.log(`✅ Created new common space: ${name} in building ${building[0].name}`);
            res.status(201).json({
                message: 'Common space created successfully',
                space: {
                    id: newSpace[0].id,
                    name: newSpace[0].name,
                    description: newSpace[0].description,
                    buildingId: newSpace[0].buildingId,
                    buildingName: building[0].name,
                    isReservable: newSpace[0].isReservable,
                    capacity: newSpace[0].capacity,
                    openingHours: newSpace[0].openingHours,
                    createdAt: newSpace[0].createdAt,
                },
            });
        }
        catch (error) {
            console.error('❌ Error creating common space:', error);
            res.status(500).json({
                message: 'Failed to create common space',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/users/:userId/time-limits - Set user time limits (Manager/Admin only).
     */
    app.post('/api/common-spaces/users/:userId/time-limits', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = userIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid user ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            // Validate request body
            const validationResult = setTimeLimitSchema.safeParse(req.body);
            if (!validationResult.success) {
                return res.status(400).json({
                    message: 'Invalid time limit data',
                    errors: validationResult.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { userId } = paramValidation.data;
            const { user_id, common_space_id, limit_type, limit_hours } = validationResult.data;
            // Verify user exists
            const targetUser = await db_1.db
                .select({ id: users.id, firstName: users.firstName, lastName: users.lastName })
                .from(users)
                .where((0, drizzle_orm_1.eq)(users.id, userId))
                .limit(1);
            if (targetUser.length === 0) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // If common_space_id is provided, verify space exists and user has access
            if (common_space_id) {
                const space = await db_1.db
                    .select({
                    id: commonSpaces.id,
                    name: commonSpaces.name,
                    buildingId: commonSpaces.buildingId,
                })
                    .from(commonSpaces)
                    .where((0, drizzle_orm_1.eq)(commonSpaces.id, common_space_id))
                    .limit(1);
                if (space.length === 0) {
                    return res.status(404).json({
                        message: 'Common space not found',
                        code: 'SPACE_NOT_FOUND',
                    });
                }
                const accessibleBuildingIds = await getAccessibleBuildingIds(user);
                if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                    return res.status(403).json({
                        message: 'Access denied to this common space',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
            }
            // Check if a time limit already exists
            const existingLimit = await db_1.db
                .select({ id: userTimeLimits.id })
                .from(userTimeLimits)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId), common_space_id
                ? (0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, common_space_id)
                : (0, drizzle_orm_1.sql) `${userTimeLimits.commonSpaceId} IS NULL`, (0, drizzle_orm_1.eq)(userTimeLimits.limitType, limit_type)))
                .limit(1);
            if (existingLimit.length > 0) {
                // Update existing limit
                await db_1.db
                    .update(userTimeLimits)
                    .set({
                    limitHours: limit_hours,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.eq)(userTimeLimits.id, existingLimit[0].id));
            }
            else {
                // Create new limit
                await db_1.db.insert(userTimeLimits).values({
                    userId,
                    commonSpaceId: common_space_id || null,
                    limitType: limit_type,
                    limitHours: limit_hours,
                });
            }
            console.log(`✅ Set time limit for user ${targetUser[0].firstName} ${targetUser[0].lastName}: ${limit_hours}h per ${limit_type}`);
            res.json({
                message: 'Time limit set successfully',
                user: {
                    id: targetUser[0].id,
                    name: `${targetUser[0].firstName} ${targetUser[0].lastName}`,
                    limitType: limit_type,
                    limitHours: limit_hours,
                    spaceId: common_space_id,
                },
            });
        }
        catch (error) {
            console.error('❌ Error setting time limit:', error);
            res.status(500).json({
                message: 'Failed to set time limit',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/users/:userId/time-limits - Get user time limits.
     */
    app.get('/api/common-spaces/users/:userId/time-limits', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { userId } = req.params;
            // Get user's time limits
            const limits = await db_1.db
                .select({
                id: userTimeLimits.id,
                userId: userTimeLimits.userId,
                commonSpaceId: userTimeLimits.commonSpaceId,
                spaceName: commonSpaces.name,
                limitType: userTimeLimits.limitType,
                limitHours: userTimeLimits.limitHours,
                createdAt: userTimeLimits.createdAt,
                updatedAt: userTimeLimits.updatedAt,
            })
                .from(userTimeLimits)
                .leftJoin(commonSpaces, (0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, commonSpaces.id))
                .where((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId))
                .orderBy(userTimeLimits.limitType, userTimeLimits.commonSpaceId);
            // Calculate current usage for each limit
            const limitsWithUsage = await Promise.all(limits.map(async (limit) => {
                const currentHours = await getUserBookingHours(userId, limit.commonSpaceId, limit.limitType);
                return {
                    ...limit,
                    currentHours: Math.round(currentHours * 100) / 100,
                    remainingHours: Math.max(0, limit.limitHours - currentHours),
                };
            }));
            res.json({
                limits: limitsWithUsage,
            });
        }
        catch (error) {
            console.error('❌ Error fetching time limits:', error);
            res.status(500).json({
                message: 'Failed to fetch time limits',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/user-calendar - Get user's personal calendar
     * Shows all user's bookings across all spaces they have access to.
     */
    app.get('/api/common-spaces/user-calendar', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid calendar query parameters',
                    errors: queryValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { start_date, end_date, view } = queryValidation.data;
            // Get user's bookings within date range
            const userBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                spaceName: commonSpaces.name,
                spaceId: commonSpaces.id,
                buildingName: buildings.name,
                buildingId: buildings.id,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.userId, user.id), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)), (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date))))
                .orderBy(bookings.startTime);
            res.json({
                user: {
                    id: user.id,
                    name: `${user.firstName} ${user.lastName}`,
                    role: user.role,
                },
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    bookings: userBookings,
                },
                summary: {
                    totalBookings: userBookings.length,
                    totalHours: userBookings.reduce((total, booking) => {
                        const duration = (new Date(booking.endTime).getTime() - new Date(booking.startTime).getTime()) /
                            (1000 * 60 * 60);
                        return total + duration;
                    }, 0),
                },
            });
        }
        catch (error) {
            console.error('❌ Error fetching user calendar:', error);
            res.status(500).json({
                message: 'Failed to fetch user calendar',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/calendar/building/:buildingId - Get building-wide calendar (Manager/Admin only)
     * Shows all bookings across all spaces in a building with full details.
     */
    app.get('/api/common-spaces/calendar/building/:buildingId', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const paramValidation = zod_1.z.object({ buildingId: zod_1.z.string().uuid() }).safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid building ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid calendar query parameters',
                    errors: queryValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { buildingId } = paramValidation.data;
            const { start_date, end_date, view } = queryValidation.data;
            // Check building access
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this building',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get building details
            const building = await db_1.db
                .select({
                id: buildings.id,
                name: buildings.name,
                address: buildings.address,
            })
                .from(buildings)
                .where((0, drizzle_orm_1.eq)(buildings.id, buildingId))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    message: 'Building not found',
                    code: 'NOT_FOUND',
                });
            }
            // Get all bookings for spaces in this building within date range
            const buildingBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                spaceName: commonSpaces.name,
                spaceId: commonSpaces.id,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                userRole: users.role,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildingId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)), (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date))))
                .orderBy(bookings.startTime);
            // Get all common spaces in this building
            const buildingSpaces = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                isReservable: commonSpaces.isReservable,
                capacity: commonSpaces.capacity,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildingId))
                .orderBy(commonSpaces.name);
            // Generate usage statistics
            const spaceUsage = buildingSpaces.map((space) => {
                const spaceBookings = buildingBookings.filter((booking) => booking.spaceId === space.id);
                const totalHours = spaceBookings.reduce((total, booking) => {
                    const duration = (new Date(booking.endTime).getTime() - new Date(booking.startTime).getTime()) /
                        (1000 * 60 * 60);
                    return total + duration;
                }, 0);
                return {
                    ...space,
                    bookingCount: spaceBookings.length,
                    totalHours: Math.round(totalHours * 10) / 10,
                    uniqueUsers: [...new Set(spaceBookings.map((b) => b.userId))].length,
                };
            });
            res.json({
                building: building[0],
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    events: buildingBookings,
                },
                spaces: spaceUsage,
                summary: {
                    totalBookings: buildingBookings.length,
                    totalSpaces: buildingSpaces.length,
                    activeSpaces: buildingSpaces.filter((s) => s.isReservable).length,
                    uniqueUsers: [...new Set(buildingBookings.map((b) => b.userId))].length,
                },
            });
        }
        catch (error) {
            console.error('❌ Error fetching building calendar:', error);
            res.status(500).json({
                message: 'Failed to fetch building calendar',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2NvbW1vbi1zcGFjZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUF1VUEsZ0VBKzNDQztBQXJzREQsNkNBQWlGO0FBQ2pGLDhCQUEyQjtBQUMzQixrQ0FBbUQ7QUFDbkQsNkJBQXdCO0FBQ3hCLHVEQUF5QztBQUV6QyxNQUFNLEVBQ0osWUFBWSxFQUNaLFFBQVEsRUFDUix1QkFBdUIsRUFDdkIsY0FBYyxFQUNkLFNBQVMsRUFDVCxLQUFLLEVBQ0wsY0FBYyxFQUNkLGlCQUFpQixHQUNsQixHQUFHLE1BQU0sQ0FBQztBQUVYLHFCQUFxQjtBQUNyQixNQUFNLHVCQUF1QixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDdkMsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxRQUFRLEVBQUU7Q0FDMUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxtQkFBbUIsR0FBRyxPQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQzVDLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQzNDLENBQUMsQ0FBQztBQUVILDRCQUE0QjtBQUM1QixNQUFNLG1CQUFtQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDbkMsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDakMsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDL0IsSUFBSSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8s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LENBQUMsQ0FBQztZQUVILEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLFFBQVEsRUFBRTtvQkFDUixJQUFJO29CQUNKLFNBQVMsRUFBRSxVQUFVO29CQUNyQixPQUFPLEVBQUUsUUFBUTtvQkFDakIsTUFBTSxFQUFFLGdCQUFnQjtpQkFDekI7Z0JBQ0QsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLE9BQU8sRUFBRTtvQkFDUCxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtvQkFDdEMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxNQUFNO29CQUNsQyxZQUFZLEVBQUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU07b0JBQ2pFLFdBQVcsRUFBRSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU07aUJBQ3hFO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLG1DQUFtQztnQkFDNUMsS0FBSyxFQUFFLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDaEUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FDRixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvY29tbW9uLXNwYWNlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEV4cHJlc3MsIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBlcSwgZGVzYywgYW5kLCBzcWwsIG9yLCBndGUsIGx0ZSwgYmV0d2VlbiwgaW5BcnJheSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vZGInO1xuaW1wb3J0IHsgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5cbmNvbnN0IHtcbiAgY29tbW9uU3BhY2VzLFxuICBib29raW5ncyxcbiAgdXNlckJvb2tpbmdSZXN0cmljdGlvbnMsXG4gIHVzZXJUaW1lTGltaXRzLFxuICBidWlsZGluZ3MsXG4gIHVzZXJzLFxuICB1c2VyUmVzaWRlbmNlcyxcbiAgdXNlck9yZ2FuaXphdGlvbnMsXG59ID0gc2NoZW1hO1xuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGNvbW1vblNwYWNlRmlsdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICBidWlsZGluZ19pZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBib29raW5nRmlsdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICBzdGFydF9kYXRlOiB6LnN0cmluZygpLmRhdGV0aW1lKCkub3B0aW9uYWwoKSxcbiAgZW5kX2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKS5vcHRpb25hbCgpLFxufSk7XG5cbi8vIENhbGVuZGFyLXNwZWNpZmljIHNjaGVtYXNcbmNvbnN0IGNhbGVuZGFyUXVlcnlTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0X2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kX2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgdmlldzogei5lbnVtKFsnbW9udGgnLCAnd2VlaycsICdkYXknXSkub3B0aW9uYWwoKS5kZWZhdWx0KCdtb250aCcpLFxufSk7XG5cbmNvbnN0IGJ1aWxkaW5nQ2FsZW5kYXJTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJ1aWxkaW5nSWQ6IHouc3RyaW5nKCkudXVpZCgpLFxufSk7XG5cbmNvbnN0IGNyZWF0ZUJvb2tpbmdTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0X3RpbWU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kX3RpbWU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbn0pO1xuXG5jb25zdCBjcmVhdGVSZXN0cmljdGlvblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgY29tbW9uX3NwYWNlX2lkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgaXNfYmxvY2tlZDogei5ib29sZWFuKCksXG4gIHJlYXNvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IGNyZWF0ZUNvbW1vblNwYWNlU2NoZW1hID0gei5vYmplY3Qoe1xuICBuYW1lOiB6LnN0cmluZygpLm1pbigxLCAnTmFtZSBpcyByZXF1aXJlZCcpLm1heCgxMDAsICdOYW1lIHRvbyBsb25nJyksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGJ1aWxkaW5nX2lkOiB6LnN0cmluZygpLnV1aWQoJ0J1aWxkaW5nIElEIG11c3QgYmUgYSB2YWxpZCBVVUlEJyksXG4gIGlzX3Jlc2VydmFibGU6IHouYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSksXG4gIGNhcGFjaXR5OiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoMjAwKS5vcHRpb25hbCgpLFxuICBvcGVuaW5nX2hvdXJzOiB6XG4gICAgLm9iamVjdCh7XG4gICAgICBzdGFydDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsyfTpcXGR7Mn0kLywgJ0ludmFsaWQgdGltZSBmb3JtYXQnKSxcbiAgICAgIGVuZDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsyfTpcXGR7Mn0kLywgJ0ludmFsaWQgdGltZSBmb3JtYXQnKSxcbiAgICB9KVxuICAgIC5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IHNldFRpbWVMaW1pdFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdXNlcl9pZDogei5zdHJpbmcoKS51dWlkKCksXG4gIGNvbW1vbl9zcGFjZV9pZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSwgLy8gbnVsbCBtZWFucyBhcHBsaWVzIHRvIGFsbCBzcGFjZXNcbiAgbGltaXRfdHlwZTogei5lbnVtKFsnbW9udGhseScsICd5ZWFybHknXSksXG4gIGxpbWl0X2hvdXJzOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoODc2MCksIC8vIE1heCAxIHllYXIgd29ydGggb2YgaG91cnNcbn0pO1xuXG5jb25zdCBzcGFjZUlkU2NoZW1hID0gei5vYmplY3Qoe1xuICBzcGFjZUlkOiB6LnN0cmluZygpLnV1aWQoKSxcbn0pO1xuXG5jb25zdCBib29raW5nSWRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJvb2tpbmdJZDogei5zdHJpbmcoKS51dWlkKCksXG59KTtcblxuY29uc3QgdXNlcklkU2NoZW1hID0gei5vYmplY3Qoe1xuICB1c2VySWQ6IHouc3RyaW5nKCkudXVpZCgpLFxufSk7XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhY2Nlc3NpYmxlIGJ1aWxkaW5nIElEcyBmb3IgYSB1c2VyIGJhc2VkIG9uIHRoZWlyIHJvbGUuXG4gKiBAcGFyYW0gdXNlclxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcjogYW55KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAvLyBBZG1pbiB1c2VycyBoYXZlIGFjY2VzcyB0byBhbGwgYnVpbGRpbmdzXG4gIGlmICh1c2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICBjb25zdCBhbGxCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IGJ1aWxkaW5ncy5pZCB9KVxuICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgIHJldHVybiBhbGxCdWlsZGluZ3MubWFwKChiKSA9PiBiLmJ1aWxkaW5nSWQpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBiZWxvbmdzIHRvIEtvdmVvIG9yZ2FuaXphdGlvbiAoc3BlY2lhbCBnbG9iYWwgYWNjZXNzKVxuICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7XG4gICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICBvcmdhbml6YXRpb25OYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9uczogdXNlck9yZ2FuaXphdGlvbnMuY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9ucyxcbiAgICB9KVxuICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgIC5pbm5lckpvaW4odXNlck9yZ2FuaXphdGlvbnMsIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCkpXG4gICAgLndoZXJlKGFuZChlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICBjb25zdCBoYXNHbG9iYWxBY2Nlc3MgPSB1c2VyT3Jncy5zb21lKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25OYW1lID09PSAnS292ZW8nIHx8IG9yZy5jYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zKTtcblxuICBpZiAoaGFzR2xvYmFsQWNjZXNzKSB7XG4gICAgY29uc3QgYWxsQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBidWlsZGluZ0lkOiBidWlsZGluZ3MuaWQgfSlcbiAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKTtcbiAgICByZXR1cm4gYWxsQnVpbGRpbmdzLm1hcCgoYikgPT4gYi5idWlsZGluZ0lkKTtcbiAgfVxuXG4gIC8vIFJlZ3VsYXIgdXNlcnMgYW5kIG1hbmFnZXJzOiBHZXQgYnVpbGRpbmdzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uc1xuICBpZiAodXNlci5yb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICBpZiAodXNlck9yZ3MubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3Qgb3JnSWRzID0gdXNlck9yZ3MubWFwKCh1bykgPT4gdW8ub3JnYW5pemF0aW9uSWQpO1xuICAgICAgY29uc3Qgb3JnQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IGJ1aWxkaW5ncy5pZCB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShhbmQoaW5BcnJheShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ0lkcyksIGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcbiAgICAgIHJldHVybiBvcmdCdWlsZGluZ3MubWFwKChiKSA9PiBiLmJ1aWxkaW5nSWQpO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFsbCB1c2VycyBjYW4gYWxzbyBhY2Nlc3MgYnVpbGRpbmdzIHdoZXJlIHRoZXkgaGF2ZSByZXNpZGVuY2VzXG4gIGNvbnN0IHVzZXJCdWlsZGluZ0lkcyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQgfSlcbiAgICAuZnJvbSh1c2VyUmVzaWRlbmNlcylcbiAgICAuaW5uZXJKb2luKHNjaGVtYS5yZXNpZGVuY2VzLCBlcSh1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgc2NoZW1hLnJlc2lkZW5jZXMuaWQpKVxuICAgIC53aGVyZShhbmQoZXEodXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSk7XG4gIHJldHVybiB1c2VyQnVpbGRpbmdJZHMubWFwKChiKSA9PiBiLmJ1aWxkaW5nSWQpO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjYWxjdWxhdGUgdXNlcidzIHRvdGFsIGJvb2tpbmcgaG91cnMgZm9yIGEgdGltZSBwZXJpb2QuXG4gKiBAcGFyYW0gdXNlcklkXG4gKiBAcGFyYW0gY29tbW9uU3BhY2VJZFxuICogQHBhcmFtIGxpbWl0VHlwZVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRVc2VyQm9va2luZ0hvdXJzKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgY29tbW9uU3BhY2VJZDogc3RyaW5nIHwgbnVsbCxcbiAgbGltaXRUeXBlOiAnbW9udGhseScgfCAneWVhcmx5J1xuKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgbGV0IHN0YXJ0RGF0ZTogRGF0ZTtcblxuICBpZiAobGltaXRUeXBlID09PSAnbW9udGhseScpIHtcbiAgICBzdGFydERhdGUgPSBuZXcgRGF0ZShub3cuZ2V0RnVsbFllYXIoKSwgbm93LmdldE1vbnRoKCksIDEpO1xuICB9IGVsc2Uge1xuICAgIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG5vdy5nZXRGdWxsWWVhcigpLCAwLCAxKTtcbiAgfVxuXG4gIGNvbnN0IGNvbmRpdGlvbnMgPSBbXG4gICAgZXEoYm9va2luZ3MudXNlcklkLCB1c2VySWQpLFxuICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgIGd0ZShib29raW5ncy5zdGFydFRpbWUsIHN0YXJ0RGF0ZSksXG4gIF07XG5cbiAgaWYgKGNvbW1vblNwYWNlSWQpIHtcbiAgICBjb25kaXRpb25zLnB1c2goZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgY29tbW9uU3BhY2VJZCkpO1xuICB9XG5cbiAgY29uc3QgdXNlckJvb2tpbmdzID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHtcbiAgICAgIHRvdGFsSG91cnM6IHNxbDxudW1iZXI+YEVYVFJBQ1QoRVBPQ0ggRlJPTSBTVU0oJHtib29raW5ncy5lbmRUaW1lfSAtICR7Ym9va2luZ3Muc3RhcnRUaW1lfSkpIC8gMzYwMGAsXG4gICAgfSlcbiAgICAuZnJvbShib29raW5ncylcbiAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcblxuICByZXR1cm4gdXNlckJvb2tpbmdzWzBdPy50b3RhbEhvdXJzIHx8IDA7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHVzZXIgaGFzIGV4Y2VlZGVkIHRoZWlyIGJvb2tpbmcgdGltZSBsaW1pdC5cbiAqIEBwYXJhbSB1c2VySWRcbiAqIEBwYXJhbSBjb21tb25TcGFjZUlkXG4gKiBAcGFyYW0gbmV3Qm9va2luZ0hvdXJzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNoZWNrVXNlclRpbWVMaW1pdChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIGNvbW1vblNwYWNlSWQ6IHN0cmluZyxcbiAgbmV3Qm9va2luZ0hvdXJzOiBudW1iZXJcbik6IFByb21pc2U8eyB3aXRoaW5MaW1pdDogYm9vbGVhbjsgbWVzc2FnZT86IHN0cmluZzsgcmVtYWluaW5nSG91cnM/OiBudW1iZXIgfT4ge1xuICAvLyBHZXQgdXNlcidzIHRpbWUgbGltaXRzIGZvciB0aGlzIHNwYWNlIChzcGVjaWZpYyBvciBnbG9iYWwpXG4gIGNvbnN0IHRpbWVMaW1pdHMgPSBhd2FpdCBkYlxuICAgIC5zZWxlY3QoKVxuICAgIC5mcm9tKHVzZXJUaW1lTGltaXRzKVxuICAgIC53aGVyZShcbiAgICAgIGFuZChcbiAgICAgICAgZXEodXNlclRpbWVMaW1pdHMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICBvcihcbiAgICAgICAgICBlcSh1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZUlkKSxcbiAgICAgICAgICBzcWxgJHt1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkfSBJUyBOVUxMYFxuICAgICAgICApXG4gICAgICApXG4gICAgKVxuICAgIC5vcmRlckJ5KHVzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWQpOyAvLyBTcGVjaWZpYyBsaW1pdHMgY29tZSBmaXJzdCAobnVsbHMgbGFzdClcblxuICBpZiAodGltZUxpbWl0cy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4geyB3aXRoaW5MaW1pdDogdHJ1ZSB9OyAvLyBObyBsaW1pdHMgc2V0XG4gIH1cblxuICAvLyBVc2UgdGhlIG1vc3Qgc3BlY2lmaWMgbGltaXQgKHNwYWNlLXNwZWNpZmljIG92ZXIgZ2xvYmFsKVxuICBjb25zdCBhY3RpdmVMaW1pdCA9IHRpbWVMaW1pdHNbMF07XG4gIGNvbnN0IGN1cnJlbnRIb3VycyA9IGF3YWl0IGdldFVzZXJCb29raW5nSG91cnMoXG4gICAgdXNlcklkLFxuICAgIGFjdGl2ZUxpbWl0LmNvbW1vblNwYWNlSWQsXG4gICAgYWN0aXZlTGltaXQubGltaXRUeXBlIGFzICdtb250aGx5JyB8ICd5ZWFybHknXG4gICk7XG5cbiAgY29uc3QgdG90YWxBZnRlckJvb2tpbmcgPSBjdXJyZW50SG91cnMgKyBuZXdCb29raW5nSG91cnM7XG4gIGNvbnN0IHJlbWFpbmluZ0hvdXJzID0gTWF0aC5tYXgoMCwgYWN0aXZlTGltaXQubGltaXRIb3VycyAtIGN1cnJlbnRIb3Vycyk7XG5cbiAgaWYgKHRvdGFsQWZ0ZXJCb29raW5nID4gYWN0aXZlTGltaXQubGltaXRIb3Vycykge1xuICAgIGNvbnN0IGxpbWl0UGVyaW9kID0gYWN0aXZlTGltaXQubGltaXRUeXBlID09PSAnbW9udGhseScgPyAnY2UgbW9pcycgOiAnY2V0dGUgYW5uw6llJztcbiAgICByZXR1cm4ge1xuICAgICAgd2l0aGluTGltaXQ6IGZhbHNlLFxuICAgICAgbWVzc2FnZTogYExpbWl0ZSBkZSB0ZW1wcyBkw6lwYXNzw6llLiBWb3VzIGF2ZXogdXRpbGlzw6kgJHtNYXRoLnJvdW5kKGN1cnJlbnRIb3Vycyl9aCBzdXIgJHthY3RpdmVMaW1pdC5saW1pdEhvdXJzfWggYXV0b3Jpc8OpZXMgcG91ciAke2xpbWl0UGVyaW9kfS4gSWwgdm91cyByZXN0ZSAke01hdGgucm91bmQocmVtYWluaW5nSG91cnMpfWggZGlzcG9uaWJsZXMuYCxcbiAgICAgIHJlbWFpbmluZ0hvdXJzLFxuICAgIH07XG4gIH1cblxuICByZXR1cm4geyB3aXRoaW5MaW1pdDogdHJ1ZSwgcmVtYWluaW5nSG91cnMgfTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY2hlY2sgaWYgYSB0aW1lIHNsb3Qgb3ZlcmxhcHMgd2l0aCBleGlzdGluZyBib29raW5ncy5cbiAqIEBwYXJhbSBjb21tb25TcGFjZUlkXG4gKiBAcGFyYW0gc3RhcnRUaW1lXG4gKiBAcGFyYW0gZW5kVGltZVxuICogQHBhcmFtIGV4Y2x1ZGVCb29raW5nSWRcbiAqL1xuYXN5bmMgZnVuY3Rpb24gaGFzT3ZlcmxhcHBpbmdCb29raW5ncyhcbiAgY29tbW9uU3BhY2VJZDogc3RyaW5nLFxuICBzdGFydFRpbWU6IERhdGUsXG4gIGVuZFRpbWU6IERhdGUsXG4gIGV4Y2x1ZGVCb29raW5nSWQ/OiBzdHJpbmdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCBjb25kaXRpb25zID0gW1xuICAgIGVxKGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsIGNvbW1vblNwYWNlSWQpLFxuICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgIG9yKFxuICAgICAgLy8gTmV3IGJvb2tpbmcgc3RhcnRzIGR1cmluZyBleGlzdGluZyBib29raW5nXG4gICAgICBhbmQoZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgc3RhcnRUaW1lKSwgbHRlKGJvb2tpbmdzLnN0YXJ0VGltZSwgZW5kVGltZSkpLFxuICAgICAgLy8gTmV3IGJvb2tpbmcgZW5kcyBkdXJpbmcgZXhpc3RpbmcgYm9va2luZ1xuICAgICAgYW5kKGd0ZShib29raW5ncy5lbmRUaW1lLCBzdGFydFRpbWUpLCBsdGUoYm9va2luZ3MuZW5kVGltZSwgZW5kVGltZSkpLFxuICAgICAgLy8gTmV3IGJvb2tpbmcgY29tcGxldGVseSBjb250YWlucyBleGlzdGluZyBib29raW5nXG4gICAgICBhbmQobHRlKGJvb2tpbmdzLnN0YXJ0VGltZSwgc3RhcnRUaW1lKSwgZ3RlKGJvb2tpbmdzLmVuZFRpbWUsIGVuZFRpbWUpKSxcbiAgICAgIC8vIEV4aXN0aW5nIGJvb2tpbmcgY29tcGxldGVseSBjb250YWlucyBuZXcgYm9va2luZ1xuICAgICAgYW5kKGd0ZShib29raW5ncy5zdGFydFRpbWUsIHN0YXJ0VGltZSksIGx0ZShib29raW5ncy5lbmRUaW1lLCBlbmRUaW1lKSlcbiAgICApLFxuICBdO1xuXG4gIGlmIChleGNsdWRlQm9va2luZ0lkKSB7XG4gICAgY29uZGl0aW9ucy5wdXNoKHNxbGAke2Jvb2tpbmdzLmlkfSAhPSAke2V4Y2x1ZGVCb29raW5nSWR9YCk7XG4gIH1cblxuICBjb25zdCBvdmVybGFwcGluZyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlkOiBib29raW5ncy5pZCB9KVxuICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgIC53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpXG4gICAgLmxpbWl0KDEpO1xuXG4gIHJldHVybiBvdmVybGFwcGluZy5sZW5ndGggPiAwO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBpZiB1c2VyIGlzIGJsb2NrZWQgZnJvbSBib29raW5nIGEgc3BhY2UuXG4gKiBAcGFyYW0gdXNlcklkXG4gKiBAcGFyYW0gY29tbW9uU3BhY2VJZFxuICovXG5hc3luYyBmdW5jdGlvbiBpc1VzZXJCbG9ja2VkKHVzZXJJZDogc3RyaW5nLCBjb21tb25TcGFjZUlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgY29uc3QgcmVzdHJpY3Rpb24gPSBhd2FpdCBkYlxuICAgIC5zZWxlY3QoeyBpc0Jsb2NrZWQ6IHVzZXJCb29raW5nUmVzdHJpY3Rpb25zLmlzQmxvY2tlZCB9KVxuICAgIC5mcm9tKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zKVxuICAgIC53aGVyZShcbiAgICAgIGFuZChcbiAgICAgICAgZXEodXNlckJvb2tpbmdSZXN0cmljdGlvbnMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICBlcSh1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZUlkKVxuICAgICAgKVxuICAgIClcbiAgICAubGltaXQoMSk7XG5cbiAgcmV0dXJuIHJlc3RyaWN0aW9uLmxlbmd0aCA+IDAgJiYgcmVzdHJpY3Rpb25bMF0uaXNCbG9ja2VkO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBpZiBib29raW5nIHRpbWUgaXMgd2l0aGluIG9wZW5pbmcgaG91cnMuXG4gKiBAcGFyYW0gc3RhcnRUaW1lXG4gKiBAcGFyYW0gZW5kVGltZVxuICogQHBhcmFtIG9wZW5pbmdIb3Vyc1xuICovXG5mdW5jdGlvbiBpc1dpdGhpbk9wZW5pbmdIb3VycyhzdGFydFRpbWU6IERhdGUsIGVuZFRpbWU6IERhdGUsIG9wZW5pbmdIb3VyczogYW55W10pOiBib29sZWFuIHtcbiAgaWYgKCFvcGVuaW5nSG91cnMgfHwgb3BlbmluZ0hvdXJzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB0cnVlOyAvLyBObyByZXN0cmljdGlvbnMgaWYgbm8gb3BlbmluZyBob3VycyBkZWZpbmVkXG4gIH1cblxuICBjb25zdCBzdGFydERheSA9IHN0YXJ0VGltZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJywgeyB3ZWVrZGF5OiAnbG9uZycgfSk7XG4gIGNvbnN0IGVuZERheSA9IGVuZFRpbWUudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1VUycsIHsgd2Vla2RheTogJ2xvbmcnIH0pO1xuXG4gIC8vIEZvciBzaW1wbGljaXR5LCByZXF1aXJlIGJvb2tpbmcgdG8gYmUgd2l0aGluIHNhbWUgZGF5XG4gIGlmIChzdGFydERheSAhPT0gZW5kRGF5KSB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgY29uc3QgZGF5SG91cnMgPSBvcGVuaW5nSG91cnMuZmluZCgob2gpID0+IG9oLmRheSA9PT0gc3RhcnREYXkpO1xuICBpZiAoIWRheUhvdXJzKSB7XG4gICAgcmV0dXJuIGZhbHNlOyAvLyBObyBob3VycyBkZWZpbmVkIGZvciB0aGlzIGRheVxuICB9XG5cbiAgY29uc3Qgc3RhcnRUaW1lU3RyID0gc3RhcnRUaW1lLnRvVGltZVN0cmluZygpLnNsaWNlKDAsIDUpOyAvLyBISDpNTSBmb3JtYXRcbiAgY29uc3QgZW5kVGltZVN0ciA9IGVuZFRpbWUudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgNSk7XG5cbiAgcmV0dXJuIHN0YXJ0VGltZVN0ciA+PSBkYXlIb3Vycy5vcGVuICYmIGVuZFRpbWVTdHIgPD0gZGF5SG91cnMuY2xvc2U7XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGFsbCBjb21tb24gc3BhY2VzIEFQSSBlbmRwb2ludHMuXG4gKiBAcGFyYW0gYXBwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckNvbW1vblNwYWNlc1JvdXRlcyhhcHA6IEV4cHJlc3MpOiB2b2lkIHtcbiAgLyoqXG4gICAqIEdFVCAvYXBpL2NvbW1vbi1zcGFjZXMgLSBSZXRyaWV2ZSBjb21tb24gc3BhY2VzIGZvciBhY2Nlc3NpYmxlIGJ1aWxkaW5ncy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvY29tbW9uLXNwYWNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICBjb25zdCBxdWVyeVZhbGlkYXRpb24gPSBjb21tb25TcGFjZUZpbHRlclNjaGVtYS5zYWZlUGFyc2UocmVxLnF1ZXJ5KTtcbiAgICAgIGlmICghcXVlcnlWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBxdWVyeSBwYXJhbWV0ZXJzJyxcbiAgICAgICAgICBlcnJvcnM6IHF1ZXJ5VmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IGJ1aWxkaW5nX2lkIH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuXG4gICAgICAvLyBHZXQgYWNjZXNzaWJsZSBidWlsZGluZyBJRHNcbiAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcblxuICAgICAgaWYgKGFjY2Vzc2libGVCdWlsZGluZ0lkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5qc29uKFtdKTtcbiAgICAgIH1cblxuICAgICAgLy8gQnVpbGQgY29uZGl0aW9uc1xuICAgICAgY29uc3QgY29uZGl0aW9ucyA9IFtlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXTtcblxuICAgICAgaWYgKGJ1aWxkaW5nX2lkKSB7XG4gICAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKGJ1aWxkaW5nX2lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGJ1aWxkaW5nJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShjb21tb25TcGFjZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdfaWQpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMpKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3BhY2VzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICBuYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogY29tbW9uU3BhY2VzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgIGJ1aWxkaW5nTmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgaXNSZXNlcnZhYmxlOiBjb21tb25TcGFjZXMuaXNSZXNlcnZhYmxlLFxuICAgICAgICAgIGNhcGFjaXR5OiBjb21tb25TcGFjZXMuY2FwYWNpdHksXG4gICAgICAgICAgY29udGFjdFBlcnNvbklkOiBjb21tb25TcGFjZXMuY29udGFjdFBlcnNvbklkLFxuICAgICAgICAgIGNvbnRhY3RQZXJzb25OYW1lOiBzcWw8c3RyaW5nPmBDT05DQVQoJHt1c2Vycy5maXJzdE5hbWV9LCAnICcsICR7dXNlcnMubGFzdE5hbWV9KWAsXG4gICAgICAgICAgb3BlbmluZ0hvdXJzOiBjb21tb25TcGFjZXMub3BlbmluZ0hvdXJzLFxuICAgICAgICAgIGJvb2tpbmdSdWxlczogY29tbW9uU3BhY2VzLmJvb2tpbmdSdWxlcyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGNvbW1vblNwYWNlcy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBjb21tb25TcGFjZXMudXBkYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgIC5pbm5lckpvaW4oYnVpbGRpbmdzLCBlcShjb21tb25TcGFjZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgLmxlZnRKb2luKHVzZXJzLCBlcShjb21tb25TcGFjZXMuY29udGFjdFBlcnNvbklkLCB1c2Vycy5pZCkpXG4gICAgICAgIC53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpXG4gICAgICAgIC5vcmRlckJ5KGJ1aWxkaW5ncy5uYW1lLCBjb21tb25TcGFjZXMubmFtZSk7XG5cbiAgICAgIHJlcy5qc29uKHNwYWNlcyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGNvbW1vbiBzcGFjZXMnLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9jb21tb24tc3BhY2VzLzpzcGFjZUlkL2Jvb2tpbmdzIC0gR2V0IGJvb2tpbmdzIGZvciBhIHNwZWNpZmljIHNwYWNlLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9jb21tb24tc3BhY2VzLzpzcGFjZUlkL2Jvb2tpbmdzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IHNwYWNlSWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHNwYWNlIElEJyxcbiAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBxdWVyeVZhbGlkYXRpb24gPSBib29raW5nRmlsdGVyU2NoZW1hLnNhZmVQYXJzZShyZXEucXVlcnkpO1xuICAgICAgaWYgKCFxdWVyeVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGVycm9yczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgc3BhY2VJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG4gICAgICBjb25zdCB7IHN0YXJ0X2RhdGUsIGVuZF9kYXRlIH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgc3BhY2VcbiAgICAgIGNvbnN0IHNwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBjb21tb25TcGFjZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oY29tbW9uU3BhY2VzKVxuICAgICAgICAud2hlcmUoZXEoY29tbW9uU3BhY2VzLmlkLCBzcGFjZUlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoc3BhY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgaWYgKCFhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoc3BhY2VbMF0uYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBCdWlsZCBxdWVyeSBjb25kaXRpb25zXG4gICAgICBjb25zdCBjb25kaXRpb25zID0gW2VxKGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsIHNwYWNlSWQpXTtcblxuICAgICAgaWYgKHN0YXJ0X2RhdGUpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGd0ZShib29raW5ncy5zdGFydFRpbWUsIG5ldyBEYXRlKHN0YXJ0X2RhdGUpKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbmRfZGF0ZSkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2gobHRlKGJvb2tpbmdzLmVuZFRpbWUsIG5ldyBEYXRlKGVuZF9kYXRlKSkpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzcGFjZUJvb2tpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJvb2tpbmdzLmlkLFxuICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsXG4gICAgICAgICAgdXNlcklkOiBib29raW5ncy51c2VySWQsXG4gICAgICAgICAgdXNlck5hbWU6IHNxbDxzdHJpbmc+YENPTkNBVCgke3VzZXJzLmZpcnN0TmFtZX0sICcgJywgJHt1c2Vycy5sYXN0TmFtZX0pYCxcbiAgICAgICAgICB1c2VyRW1haWw6IHVzZXJzLmVtYWlsLFxuICAgICAgICAgIHN0YXJ0VGltZTogYm9va2luZ3Muc3RhcnRUaW1lLFxuICAgICAgICAgIGVuZFRpbWU6IGJvb2tpbmdzLmVuZFRpbWUsXG4gICAgICAgICAgc3RhdHVzOiBib29raW5ncy5zdGF0dXMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBib29raW5ncy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBib29raW5ncy51cGRhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAuaW5uZXJKb2luKHVzZXJzLCBlcShib29raW5ncy51c2VySWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSlcbiAgICAgICAgLm9yZGVyQnkoYm9va2luZ3Muc3RhcnRUaW1lKTtcblxuICAgICAgcmVzLmpzb24oc3BhY2VCb29raW5ncyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGJvb2tpbmdzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBib29raW5ncycsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS9jb21tb24tc3BhY2VzLzpzcGFjZUlkL2Jvb2tpbmdzIC0gQ3JlYXRlIGEgbmV3IGJvb2tpbmcuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9jb21tb24tc3BhY2VzLzpzcGFjZUlkL2Jvb2tpbmdzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnMgYW5kIGJvZHlcbiAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IHNwYWNlSWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHNwYWNlIElEJyxcbiAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBib2R5VmFsaWRhdGlvbiA9IGNyZWF0ZUJvb2tpbmdTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcbiAgICAgIGlmICghYm9keVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGJvb2tpbmcgZGF0YScsXG4gICAgICAgICAgZXJyb3JzOiBib2R5VmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHNwYWNlSWQgfSA9IHBhcmFtVmFsaWRhdGlvbi5kYXRhO1xuICAgICAgY29uc3QgeyBzdGFydF90aW1lLCBlbmRfdGltZSB9ID0gYm9keVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gbmV3IERhdGUoc3RhcnRfdGltZSk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gbmV3IERhdGUoZW5kX3RpbWUpO1xuXG4gICAgICAvLyBWYWxpZGF0ZSB0aW1lIHJhbmdlXG4gICAgICBpZiAoc3RhcnRUaW1lID49IGVuZFRpbWUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnU3RhcnQgdGltZSBtdXN0IGJlIGJlZm9yZSBlbmQgdGltZScsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVElNRV9SQU5HRScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBBbGxvdyBib29raW5ncyBmb3IgdG9kYXkgYW5kIGZ1dHVyZSBkYXRlcyAod2l0aCA1LW1pbnV0ZSBidWZmZXIgZm9yIGN1cnJlbnQgdGltZSlcbiAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBmaXZlTWludXRlc0FnbyA9IG5ldyBEYXRlKG5vdy5nZXRUaW1lKCkgLSA1ICogNjAgKiAxMDAwKTtcblxuICAgICAgaWYgKHN0YXJ0VGltZSA8IGZpdmVNaW51dGVzQWdvKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBib29rIGluIHRoZSBwYXN0JyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9USU1FX1JBTkdFJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBjb21tb24gc3BhY2UgZGV0YWlsc1xuICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgIGlzUmVzZXJ2YWJsZTogY29tbW9uU3BhY2VzLmlzUmVzZXJ2YWJsZSxcbiAgICAgICAgICBvcGVuaW5nSG91cnM6IGNvbW1vblNwYWNlcy5vcGVuaW5nSG91cnMsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGNvbW1vblNwYWNlcylcbiAgICAgICAgLndoZXJlKGVxKGNvbW1vblNwYWNlcy5pZCwgc3BhY2VJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKHNwYWNlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDb21tb24gc3BhY2Ugbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGNvbW1vblNwYWNlID0gc3BhY2VbMF07XG5cbiAgICAgIC8vIENoZWNrIGlmIHNwYWNlIGlzIHJlc2VydmFibGVcbiAgICAgIGlmICghY29tbW9uU3BhY2UuaXNSZXNlcnZhYmxlKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1RoaXMgY29tbW9uIHNwYWNlIGlzIG5vdCByZXNlcnZhYmxlJyxcbiAgICAgICAgICBjb2RlOiAnTk9UX1JFU0VSVkFCTEUnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgdXNlciBhY2Nlc3MgdG8gYnVpbGRpbmdcbiAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKGNvbW1vblNwYWNlLmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQgdG8gdGhpcyBjb21tb24gc3BhY2UnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBibG9ja2VkXG4gICAgICBjb25zdCBibG9ja2VkID0gYXdhaXQgaXNVc2VyQmxvY2tlZCh1c2VyLmlkLCBzcGFjZUlkKTtcbiAgICAgIGlmIChibG9ja2VkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1lvdSBhcmUgYmxvY2tlZCBmcm9tIGJvb2tpbmcgdGhpcyBzcGFjZScsXG4gICAgICAgICAgY29kZTogJ1VTRVJfQkxPQ0tFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBvcGVuaW5nIGhvdXJzXG4gICAgICBpZiAoXG4gICAgICAgIGNvbW1vblNwYWNlLm9wZW5pbmdIb3VycyAmJlxuICAgICAgICAhaXNXaXRoaW5PcGVuaW5nSG91cnMoc3RhcnRUaW1lLCBlbmRUaW1lLCBjb21tb25TcGFjZS5vcGVuaW5nSG91cnMgYXMgYW55W10pXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQm9va2luZyB0aW1lIGlzIG91dHNpZGUgb3BlbmluZyBob3VycycsXG4gICAgICAgICAgY29kZTogJ09VVFNJREVfT1BFTklOR19IT1VSUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBmb3Igb3ZlcmxhcHBpbmcgYm9va2luZ3NcbiAgICAgIGNvbnN0IGhhc092ZXJsYXAgPSBhd2FpdCBoYXNPdmVybGFwcGluZ0Jvb2tpbmdzKHNwYWNlSWQsIHN0YXJ0VGltZSwgZW5kVGltZSk7XG4gICAgICBpZiAoaGFzT3ZlcmxhcCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDkpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdUaW1lIHNsb3QgaXMgYWxyZWFkeSBib29rZWQnLFxuICAgICAgICAgIGNvZGU6ICdUSU1FX0NPTkZMSUNUJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHVzZXIncyB0aW1lIGxpbWl0c1xuICAgICAgY29uc3QgYm9va2luZ0R1cmF0aW9uSG91cnMgPSAoZW5kVGltZS5nZXRUaW1lKCkgLSBzdGFydFRpbWUuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCk7XG4gICAgICBjb25zdCB0aW1lTGltaXRDaGVjayA9IGF3YWl0IGNoZWNrVXNlclRpbWVMaW1pdCh1c2VyLmlkLCBzcGFjZUlkLCBib29raW5nRHVyYXRpb25Ib3Vycyk7XG5cbiAgICAgIGlmICghdGltZUxpbWl0Q2hlY2sud2l0aGluTGltaXQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiB0aW1lTGltaXRDaGVjay5tZXNzYWdlLFxuICAgICAgICAgIGNvZGU6ICdUSU1FX0xJTUlUX0VYQ0VFREVEJyxcbiAgICAgICAgICByZW1haW5pbmdIb3VyczogdGltZUxpbWl0Q2hlY2sucmVtYWluaW5nSG91cnMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgYm9va2luZ1xuICAgICAgY29uc3QgbmV3Qm9va2luZyA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoYm9va2luZ3MpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IHNwYWNlSWQsXG4gICAgICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgICAgIHN0YXJ0VGltZSxcbiAgICAgICAgICBlbmRUaW1lLFxuICAgICAgICAgIHN0YXR1czogJ2NvbmZpcm1lZCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQm9va2luZyBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGJvb2tpbmc6IG5ld0Jvb2tpbmdbMF0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgYm9va2luZzonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGJvb2tpbmcnLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9jb21tb24tc3BhY2VzL2NhbGVuZGFyLzpzcGFjZUlkIC0gR2V0IGNhbGVuZGFyIGRhdGEgZm9yIGEgc3BlY2lmaWMgc3BhY2UuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2NvbW1vbi1zcGFjZXMvY2FsZW5kYXIvOnNwYWNlSWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVyc1xuICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gc3BhY2VJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3BhY2UgSUQnLFxuICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IGNhbGVuZGFyUXVlcnlTY2hlbWEuc2FmZVBhcnNlKHJlcS5xdWVyeSk7XG4gICAgICBpZiAoIXF1ZXJ5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcXVlcnkgcGFyYW1ldGVycycsXG4gICAgICAgICAgZXJyb3JzOiBxdWVyeVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBzcGFjZUlkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcbiAgICAgIGNvbnN0IHsgc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIHZpZXcgfSA9IHF1ZXJ5VmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAvLyBHZXQgc3BhY2UgZGV0YWlscyBhbmQgY2hlY2sgYWNjZXNzXG4gICAgICBjb25zdCBzcGFjZSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgbmFtZTogY29tbW9uU3BhY2VzLm5hbWUsXG4gICAgICAgICAgYnVpbGRpbmdJZDogY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgaXNSZXNlcnZhYmxlOiBjb21tb25TcGFjZXMuaXNSZXNlcnZhYmxlLFxuICAgICAgICAgIG9wZW5pbmdIb3VyczogY29tbW9uU3BhY2VzLm9wZW5pbmdIb3VycyxcbiAgICAgICAgICBjYXBhY2l0eTogY29tbW9uU3BhY2VzLmNhcGFjaXR5LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIHNwYWNlSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChzcGFjZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb21tb25TcGFjZSA9IHNwYWNlWzBdO1xuXG4gICAgICAvLyBDaGVjayB1c2VyIGFjY2VzcyB0byBidWlsZGluZ1xuICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgaWYgKCFhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoY29tbW9uU3BhY2UuYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgYm9va2luZ3MgZm9yIHRoZSBzcGVjaWZpZWQgZGF0ZSByYW5nZVxuICAgICAgY29uc3QgY29uZGl0aW9ucyA9IFtcbiAgICAgICAgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgc3BhY2VJZCksXG4gICAgICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgICAgICBndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBuZXcgRGF0ZShzdGFydF9kYXRlKSksXG4gICAgICAgIGx0ZShib29raW5ncy5lbmRUaW1lLCBuZXcgRGF0ZShlbmRfZGF0ZSkpLFxuICAgICAgXTtcblxuICAgICAgY29uc3Qgc3BhY2VCb29raW5ncyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBib29raW5ncy5pZCxcbiAgICAgICAgICBzdGFydFRpbWU6IGJvb2tpbmdzLnN0YXJ0VGltZSxcbiAgICAgICAgICBlbmRUaW1lOiBib29raW5ncy5lbmRUaW1lLFxuICAgICAgICAgIHN0YXR1czogYm9va2luZ3Muc3RhdHVzLFxuICAgICAgICAgIHVzZXJJZDogYm9va2luZ3MudXNlcklkLFxuICAgICAgICAgIHVzZXJOYW1lOiBzcWw8c3RyaW5nPmBDT05DQVQoJHt1c2Vycy5maXJzdE5hbWV9LCAnICcsICR7dXNlcnMubGFzdE5hbWV9KWAsXG4gICAgICAgICAgdXNlckVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICB1c2VyUm9sZTogdXNlcnMucm9sZSxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKGJvb2tpbmdzLnVzZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKVxuICAgICAgICAub3JkZXJCeShib29raW5ncy5zdGFydFRpbWUpO1xuXG4gICAgICAvLyBEZXRlcm1pbmUgcGVybWlzc2lvbnNcbiAgICAgIGNvbnN0IGNhblZpZXdEZXRhaWxzID0gWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXModXNlci5yb2xlKTtcblxuICAgICAgLy8gVHJhbnNmb3JtIGJvb2tpbmdzIHRvIGNhbGVuZGFyIGV2ZW50c1xuICAgICAgY29uc3QgZXZlbnRzID0gc3BhY2VCb29raW5ncy5tYXAoKGJvb2tpbmcpID0+ICh7XG4gICAgICAgIGlkOiBib29raW5nLmlkLFxuICAgICAgICBzdGFydFRpbWU6IGJvb2tpbmcuc3RhcnRUaW1lLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGVuZFRpbWU6IGJvb2tpbmcuZW5kVGltZS50b0lTT1N0cmluZygpLFxuICAgICAgICBzdGF0dXM6IGJvb2tpbmcuc3RhdHVzLFxuICAgICAgICB1c2VySWQ6IGJvb2tpbmcudXNlcklkLFxuICAgICAgICB1c2VyTmFtZTogY2FuVmlld0RldGFpbHMgfHwgYm9va2luZy51c2VySWQgPT09IHVzZXIuaWQgPyBib29raW5nLnVzZXJOYW1lIDogJ0TDqWrDoCBSw6lzZXJ2w6knLFxuICAgICAgICB1c2VyRW1haWw6IGNhblZpZXdEZXRhaWxzIHx8IGJvb2tpbmcudXNlcklkID09PSB1c2VyLmlkID8gYm9va2luZy51c2VyRW1haWwgOiBudWxsLFxuICAgICAgICBpc093bkJvb2tpbmc6IGJvb2tpbmcudXNlcklkID09PSB1c2VyLmlkLFxuICAgICAgICBzcGFjZUlkOiBzcGFjZUlkLFxuICAgICAgICBzcGFjZU5hbWU6IGNvbW1vblNwYWNlLm5hbWUsXG4gICAgICAgIHVzZXJSb2xlOiBib29raW5nLnVzZXJSb2xlLFxuICAgICAgfSkpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgc3VtbWFyeSBzdGF0aXN0aWNzXG4gICAgICBjb25zdCB0b3RhbEJvb2tpbmdzID0gZXZlbnRzLmxlbmd0aDtcbiAgICAgIGNvbnN0IHRvdGFsSG91cnMgPSBldmVudHMucmVkdWNlKChzdW0sIGV2ZW50KSA9PiB7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID1cbiAgICAgICAgICAobmV3IERhdGUoZXZlbnQuZW5kVGltZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoZXZlbnQuc3RhcnRUaW1lKS5nZXRUaW1lKCkpIC9cbiAgICAgICAgICAoMTAwMCAqIDYwICogNjApO1xuICAgICAgICByZXR1cm4gc3VtICsgZHVyYXRpb247XG4gICAgICB9LCAwKTtcbiAgICAgIGNvbnN0IHVuaXF1ZVVzZXJzID0gbmV3IFNldChldmVudHMubWFwKChlKSA9PiBlLnVzZXJJZCkpLnNpemU7XG5cbiAgICAgIC8vIEJ1aWxkIGNhbGVuZGFyIHJlc3BvbnNlXG4gICAgICBjb25zdCBjYWxlbmRhckRhdGEgPSB7XG4gICAgICAgIHNwYWNlOiB7XG4gICAgICAgICAgaWQ6IGNvbW1vblNwYWNlLmlkLFxuICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlLm5hbWUsXG4gICAgICAgICAgaXNSZXNlcnZhYmxlOiBjb21tb25TcGFjZS5pc1Jlc2VydmFibGUsXG4gICAgICAgICAgb3BlbmluZ0hvdXJzOiBjb21tb25TcGFjZS5vcGVuaW5nSG91cnMsXG4gICAgICAgIH0sXG4gICAgICAgIGNhbGVuZGFyOiB7XG4gICAgICAgICAgdmlldyxcbiAgICAgICAgICBzdGFydERhdGU6IHN0YXJ0X2RhdGUsXG4gICAgICAgICAgZW5kRGF0ZTogZW5kX2RhdGUsXG4gICAgICAgICAgZXZlbnRzLFxuICAgICAgICB9LFxuICAgICAgICBwZXJtaXNzaW9uczoge1xuICAgICAgICAgIGNhblZpZXdEZXRhaWxzLFxuICAgICAgICAgIGNhbkNyZWF0ZUJvb2tpbmdzOiBjb21tb25TcGFjZS5pc1Jlc2VydmFibGUgJiYgIShhd2FpdCBpc1VzZXJCbG9ja2VkKHVzZXIuaWQsIHNwYWNlSWQpKSxcbiAgICAgICAgfSxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsQm9va2luZ3MsXG4gICAgICAgICAgdG90YWxIb3VyczogTWF0aC5yb3VuZCh0b3RhbEhvdXJzICogMTApIC8gMTAsXG4gICAgICAgICAgdW5pcXVlVXNlcnMsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICByZXMuanNvbihjYWxlbmRhckRhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBjYWxlbmRhciBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBjYWxlbmRhciBkYXRhJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcy9teS1ib29raW5ncyAtIEdldCBjdXJyZW50IHVzZXIncyBib29raW5ncy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvY29tbW9uLXNwYWNlcy9teS1ib29raW5ncycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuXG4gICAgICAvLyBHZXQgYWxsIHVzZXIncyBjb25maXJtZWQgYm9va2luZ3Mgd2l0aCBzcGFjZSBhbmQgYnVpbGRpbmcgaW5mb1xuICAgICAgY29uc3QgdXNlckJvb2tpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJvb2tpbmdzLmlkLFxuICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsXG4gICAgICAgICAgc3RhcnRUaW1lOiBib29raW5ncy5zdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZTogYm9va2luZ3MuZW5kVGltZSxcbiAgICAgICAgICBzdGF0dXM6IGJvb2tpbmdzLnN0YXR1cyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJvb2tpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICBjb21tb25TcGFjZU5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIGJ1aWxkaW5nTmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgYnVpbGRpbmdBZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgIC5pbm5lckpvaW4oY29tbW9uU3BhY2VzLCBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZXMuaWQpKVxuICAgICAgICAuaW5uZXJKb2luKGJ1aWxkaW5ncywgZXEoY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5ncy5pZCkpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYm9va2luZ3MudXNlcklkLCB1c2VyLmlkKSwgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJykpKVxuICAgICAgICAub3JkZXJCeShkZXNjKGJvb2tpbmdzLnN0YXJ0VGltZSkpO1xuXG4gICAgICByZXMuanNvbih1c2VyQm9va2luZ3MpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIGJvb2tpbmdzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCB1c2VyIGJvb2tpbmdzJyxcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBERUxFVEUgL2FwaS9jb21tb24tc3BhY2VzL2Jvb2tpbmdzLzpib29raW5nSWQgLSBDYW5jZWwgYSBib29raW5nLlxuICAgKi9cbiAgYXBwLmRlbGV0ZShcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzL2Jvb2tpbmdzLzpib29raW5nSWQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gYm9va2luZ0lkU2NoZW1hLnNhZmVQYXJzZShyZXEucGFyYW1zKTtcbiAgICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBib29raW5nIElEJyxcbiAgICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgYm9va2luZ0lkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgICAvLyBHZXQgYm9va2luZyBkZXRhaWxzXG4gICAgICAgIGNvbnN0IGJvb2tpbmcgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGJvb2tpbmdzLmlkLFxuICAgICAgICAgICAgdXNlcklkOiBib29raW5ncy51c2VySWQsXG4gICAgICAgICAgICBjb21tb25TcGFjZUlkOiBib29raW5ncy5jb21tb25TcGFjZUlkLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICBzdGF0dXM6IGJvb2tpbmdzLnN0YXR1cyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAgIC5pbm5lckpvaW4oY29tbW9uU3BhY2VzLCBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZXMuaWQpKVxuICAgICAgICAgIC53aGVyZShlcShib29raW5ncy5pZCwgYm9va2luZ0lkKSlcbiAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgaWYgKGJvb2tpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdCb29raW5nIG5vdCBmb3VuZCcsXG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJvb2tpbmdEZXRhaWxzID0gYm9va2luZ1swXTtcblxuICAgICAgICAvLyBDaGVjayBwZXJtaXNzaW9uczogdXNlcnMgY2FuIGNhbmNlbCB0aGVpciBvd24gYm9va2luZ3MsIG1hbmFnZXJzIGNhbiBjYW5jZWwgYW55IGluIHRoZWlyIGJ1aWxkaW5nc1xuICAgICAgICBsZXQgY2FuQ2FuY2VsID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKGJvb2tpbmdEZXRhaWxzLnVzZXJJZCA9PT0gdXNlci5pZCkge1xuICAgICAgICAgIGNhbkNhbmNlbCA9IHRydWU7IC8vIFVzZXJzIGNhbiBhbHdheXMgY2FuY2VsIHRoZWlyIG93biBib29raW5nc1xuICAgICAgICB9IGVsc2UgaWYgKFsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKHVzZXIucm9sZSkpIHtcbiAgICAgICAgICAvLyBNYW5hZ2VycyBjYW4gY2FuY2VsIGJvb2tpbmdzIGluIGJ1aWxkaW5ncyB0aGV5IGhhdmUgYWNjZXNzIHRvXG4gICAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICAgIGNhbkNhbmNlbCA9IGFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhib29raW5nRGV0YWlscy5idWlsZGluZ0lkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghY2FuQ2FuY2VsKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYW4gb25seSBjYW5jZWwgeW91ciBvd24gYm9va2luZ3MnLFxuICAgICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgYm9va2luZyBzdGF0dXMgdG8gY2FuY2VsbGVkXG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShib29raW5ncylcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIHN0YXR1czogJ2NhbmNlbGxlZCcsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgfSlcbiAgICAgICAgICAud2hlcmUoZXEoYm9va2luZ3MuaWQsIGJvb2tpbmdJZCkpO1xuXG4gICAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQm9va2luZyBjYW5jZWxsZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjYW5jZWxsaW5nIGJvb2tpbmc6JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjYW5jZWwgYm9va2luZycsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvc3RhdHMgLSBHZXQgdXNhZ2Ugc3RhdGlzdGljcyAoTWFuYWdlci9BZG1pbiBvbmx5KS5cbiAgICovXG4gIGFwcC5nZXQoXG4gICAgJy9hcGkvY29tbW9uLXNwYWNlcy86c3BhY2VJZC9zdGF0cycsXG4gICAgcmVxdWlyZUF1dGgsXG4gICAgcmVxdWlyZVJvbGUoWydhZG1pbicsICdtYW5hZ2VyJ10pLFxuICAgIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gc3BhY2VJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICAgIGlmICghcGFyYW1WYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3BhY2UgSUQnLFxuICAgICAgICAgICAgZXJyb3JzOiBwYXJhbVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBzcGFjZUlkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgICAvLyBDaGVjayBhY2Nlc3MgdG8gc3BhY2VcbiAgICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgbmFtZTogY29tbW9uU3BhY2VzLm5hbWUsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgICAgLndoZXJlKGVxKGNvbW1vblNwYWNlcy5pZCwgc3BhY2VJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChzcGFjZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMgPSBhd2FpdCBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcik7XG4gICAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKHNwYWNlWzBdLmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgY29tbW9uIHNwYWNlJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2FsY3VsYXRlIHN0YXRzIGZvciBsYXN0IHllYXJcbiAgICAgICAgY29uc3Qgb25lWWVhckFnbyA9IG5ldyBEYXRlKCk7XG4gICAgICAgIG9uZVllYXJBZ28uc2V0RnVsbFllYXIob25lWWVhckFnby5nZXRGdWxsWWVhcigpIC0gMSk7XG5cbiAgICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgdXNlcklkOiBib29raW5ncy51c2VySWQsXG4gICAgICAgICAgICB1c2VyTmFtZTogc3FsPHN0cmluZz5gQ09OQ0FUKCR7dXNlcnMuZmlyc3ROYW1lfSwgJyAnLCAke3VzZXJzLmxhc3ROYW1lfSlgLFxuICAgICAgICAgICAgdXNlckVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICAgIHRvdGFsSG91cnM6IHNxbDxudW1iZXI+YEVYVFJBQ1QoRVBPQ0ggRlJPTSBTVU0oJHtib29raW5ncy5lbmRUaW1lfSAtICR7Ym9va2luZ3Muc3RhcnRUaW1lfSkpIC8gMzYwMGAsXG4gICAgICAgICAgICB0b3RhbEJvb2tpbmdzOiBzcWw8bnVtYmVyPmBDT1VOVCgke2Jvb2tpbmdzLmlkfSlgLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgICAgLmlubmVySm9pbih1c2VycywgZXEoYm9va2luZ3MudXNlcklkLCB1c2Vycy5pZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBzcGFjZUlkKSxcbiAgICAgICAgICAgICAgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJyksXG4gICAgICAgICAgICAgIGd0ZShib29raW5ncy5zdGFydFRpbWUsIG9uZVllYXJBZ28pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5ncm91cEJ5KGJvb2tpbmdzLnVzZXJJZCwgdXNlcnMuZmlyc3ROYW1lLCB1c2Vycy5sYXN0TmFtZSwgdXNlcnMuZW1haWwpXG4gICAgICAgICAgLm9yZGVyQnkoXG4gICAgICAgICAgICBkZXNjKFxuICAgICAgICAgICAgICBzcWw8bnVtYmVyPmBFWFRSQUNUKEVQT0NIIEZST00gU1VNKCR7Ym9va2luZ3MuZW5kVGltZX0gLSAke2Jvb2tpbmdzLnN0YXJ0VGltZX0pKSAvIDM2MDBgXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBjb25zdCB0b3RhbFN0YXRzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHRvdGFsQm9va2luZ3M6IHNxbDxudW1iZXI+YENPVU5UKCR7Ym9va2luZ3MuaWR9KWAsXG4gICAgICAgICAgICB0b3RhbEhvdXJzOiBzcWw8bnVtYmVyPmBFWFRSQUNUKEVQT0NIIEZST00gU1VNKCR7Ym9va2luZ3MuZW5kVGltZX0gLSAke2Jvb2tpbmdzLnN0YXJ0VGltZX0pKSAvIDM2MDBgLFxuICAgICAgICAgICAgdW5pcXVlVXNlcnM6IHNxbDxudW1iZXI+YENPVU5UKERJU1RJTkNUICR7Ym9va2luZ3MudXNlcklkfSlgLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBzcGFjZUlkKSxcbiAgICAgICAgICAgICAgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJyksXG4gICAgICAgICAgICAgIGd0ZShib29raW5ncy5zdGFydFRpbWUsIG9uZVllYXJBZ28pXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgc3BhY2VOYW1lOiBzcGFjZVswXS5uYW1lLFxuICAgICAgICAgIHBlcmlvZDogJ0xhc3QgMTIgbW9udGhzJyxcbiAgICAgICAgICBzdW1tYXJ5OiB0b3RhbFN0YXRzWzBdLFxuICAgICAgICAgIHVzZXJTdGF0czogc3RhdHMsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgc3BhY2Ugc3RhdGlzdGljczonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHNwYWNlIHN0YXRpc3RpY3MnLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvY29tbW9uLXNwYWNlcy91c2Vycy86dXNlcklkL3Jlc3RyaWN0aW9ucyAtIEJsb2NrL3VuYmxvY2sgdXNlciAoTWFuYWdlci9BZG1pbiBvbmx5KS5cbiAgICovXG4gIGFwcC5wb3N0KFxuICAgICcvYXBpL2NvbW1vbi1zcGFjZXMvdXNlcnMvOnVzZXJJZC9yZXN0cmljdGlvbnMnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSBwYXJhbWV0ZXJzIGFuZCBib2R5XG4gICAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IHVzZXJJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICAgIGlmICghcGFyYW1WYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdXNlciBJRCcsXG4gICAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMubWFwKChpc3N1ZSkgPT4gKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYm9keVZhbGlkYXRpb24gPSBjcmVhdGVSZXN0cmljdGlvblNjaGVtYS5zYWZlUGFyc2UocmVxLmJvZHkpO1xuICAgICAgICBpZiAoIWJvZHlWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcmVzdHJpY3Rpb24gZGF0YScsXG4gICAgICAgICAgICBlcnJvcnM6IGJvZHlWYWxpZGF0aW9uLmVycm9yLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiAoe1xuICAgICAgICAgICAgICBmaWVsZDogaXNzdWUucGF0aC5qb2luKCcuJyksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGlzc3VlLm1lc3NhZ2UsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IHVzZXJJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG4gICAgICAgIGNvbnN0IHsgY29tbW9uX3NwYWNlX2lkLCBpc19ibG9ja2VkLCByZWFzb24gfSA9IGJvZHlWYWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdGFyZ2V0IHVzZXIgZXhpc3RzXG4gICAgICAgIGNvbnN0IHRhcmdldFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBpZDogdXNlcnMuaWQgfSlcbiAgICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgICAud2hlcmUoZXEodXNlcnMuaWQsIHVzZXJJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmICh0YXJnZXRVc2VyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBjb21tb24gc3BhY2UgZXhpc3RzIGFuZCB1c2VyIGhhcyBhY2Nlc3NcbiAgICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oY29tbW9uU3BhY2VzKVxuICAgICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIGNvbW1vbl9zcGFjZV9pZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChzcGFjZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMgPSBhd2FpdCBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcik7XG4gICAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKHNwYWNlWzBdLmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgY29tbW9uIHNwYWNlJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgcmVzdHJpY3Rpb24gYWxyZWFkeSBleGlzdHNcbiAgICAgICAgY29uc3QgZXhpc3RpbmdSZXN0cmljdGlvbiA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IGlkOiB1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucy5pZCB9KVxuICAgICAgICAgIC5mcm9tKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEodXNlckJvb2tpbmdSZXN0cmljdGlvbnMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgICAgICBlcSh1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucy5jb21tb25TcGFjZUlkLCBjb21tb25fc3BhY2VfaWQpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoZXhpc3RpbmdSZXN0cmljdGlvbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gVXBkYXRlIGV4aXN0aW5nIHJlc3RyaWN0aW9uXG4gICAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAgIC51cGRhdGUodXNlckJvb2tpbmdSZXN0cmljdGlvbnMpXG4gICAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgICAgaXNCbG9ja2VkOiBpc19ibG9ja2VkLFxuICAgICAgICAgICAgICByZWFzb24sXG4gICAgICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2hlcmUoZXEodXNlckJvb2tpbmdSZXN0cmljdGlvbnMuaWQsIGV4aXN0aW5nUmVzdHJpY3Rpb25bMF0uaWQpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBDcmVhdGUgbmV3IHJlc3RyaWN0aW9uXG4gICAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHVzZXJCb29raW5nUmVzdHJpY3Rpb25zKS52YWx1ZXMoe1xuICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgY29tbW9uU3BhY2VJZDogY29tbW9uX3NwYWNlX2lkLFxuICAgICAgICAgICAgaXNCbG9ja2VkOiBpc19ibG9ja2VkLFxuICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6IGBVc2VyICR7aXNfYmxvY2tlZCA/ICdibG9ja2VkIGZyb20nIDogJ3VuYmxvY2tlZCBmcm9tJ30gYm9va2luZyB0aGlzIHNwYWNlYCxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBtYW5hZ2luZyB1c2VyIHJlc3RyaWN0aW9uOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gbWFuYWdlIHVzZXIgcmVzdHJpY3Rpb24nLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvY29tbW9uLXNwYWNlcyAtIENyZWF0ZSBhIG5ldyBjb21tb24gc3BhY2UgKE1hbmFnZXIvQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAucG9zdChcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzJyxcbiAgICByZXF1aXJlQXV0aCxcbiAgICByZXF1aXJlUm9sZShbJ2FkbWluJywgJ21hbmFnZXInXSksXG4gICAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gY3JlYXRlQ29tbW9uU3BhY2VTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcmVxdWVzdCBkYXRhJyxcbiAgICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvblJlc3VsdC5lcnJvci5pc3N1ZXMubWFwKChpc3N1ZSkgPT4gKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBuYW1lLCBkZXNjcmlwdGlvbiwgYnVpbGRpbmdfaWQsIGlzX3Jlc2VydmFibGUsIGNhcGFjaXR5LCBvcGVuaW5nX2hvdXJzIH0gPVxuICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQuZGF0YTtcblxuICAgICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBidWlsZGluZ1xuICAgICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMgPSBhd2FpdCBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcik7XG4gICAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKGJ1aWxkaW5nX2lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZC4gWW91IGNhbiBvbmx5IGNyZWF0ZSBzcGFjZXMgaW4gYnVpbGRpbmdzIHlvdSBtYW5hZ2UuJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmVyaWZ5IGJ1aWxkaW5nIGV4aXN0cyBhbmQgaXMgYWN0aXZlXG4gICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgaWQ6IGJ1aWxkaW5ncy5pZCwgbmFtZTogYnVpbGRpbmdzLm5hbWUgfSlcbiAgICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgICAgLndoZXJlKGFuZChlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nX2lkKSwgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChidWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCBvciBpbmFjdGl2ZScsXG4gICAgICAgICAgICBjb2RlOiAnQlVJTERJTkdfTk9UX0ZPVU5EJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIGEgc3BhY2Ugd2l0aCB0aGUgc2FtZSBuYW1lIGFscmVhZHkgZXhpc3RzIGluIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgY29uc3QgZXhpc3RpbmdTcGFjZSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IGlkOiBjb21tb25TcGFjZXMuaWQgfSlcbiAgICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgICAgLndoZXJlKGFuZChlcShjb21tb25TcGFjZXMubmFtZSwgbmFtZSksIGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ19pZCkpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoZXhpc3RpbmdTcGFjZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA5KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBIGNvbW1vbiBzcGFjZSB3aXRoIHRoaXMgbmFtZSBhbHJlYWR5IGV4aXN0cyBpbiB0aGlzIGJ1aWxkaW5nJyxcbiAgICAgICAgICAgIGNvZGU6ICdEVVBMSUNBVEVfTkFNRScsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBjb21tb24gc3BhY2VcbiAgICAgICAgY29uc3QgbmV3U3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAgIC5pbnNlcnQoY29tbW9uU3BhY2VzKVxuICAgICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgICAgbmFtZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZXNjcmlwdGlvbiB8fCBudWxsLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogYnVpbGRpbmdfaWQsXG4gICAgICAgICAgICBpc1Jlc2VydmFibGU6IGlzX3Jlc2VydmFibGUsXG4gICAgICAgICAgICBjYXBhY2l0eTogY2FwYWNpdHkgfHwgbnVsbCxcbiAgICAgICAgICAgIG9wZW5pbmdIb3Vyczogb3BlbmluZ19ob3VycyA/IGAke29wZW5pbmdfaG91cnMuc3RhcnR9LSR7b3BlbmluZ19ob3Vycy5lbmR9YCA6IG51bGwsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKchSBDcmVhdGVkIG5ldyBjb21tb24gc3BhY2U6ICR7bmFtZX0gaW4gYnVpbGRpbmcgJHtidWlsZGluZ1swXS5uYW1lfWApO1xuXG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICBzcGFjZToge1xuICAgICAgICAgICAgaWQ6IG5ld1NwYWNlWzBdLmlkLFxuICAgICAgICAgICAgbmFtZTogbmV3U3BhY2VbMF0ubmFtZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBuZXdTcGFjZVswXS5kZXNjcmlwdGlvbixcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IG5ld1NwYWNlWzBdLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICBidWlsZGluZ05hbWU6IGJ1aWxkaW5nWzBdLm5hbWUsXG4gICAgICAgICAgICBpc1Jlc2VydmFibGU6IG5ld1NwYWNlWzBdLmlzUmVzZXJ2YWJsZSxcbiAgICAgICAgICAgIGNhcGFjaXR5OiBuZXdTcGFjZVswXS5jYXBhY2l0eSxcbiAgICAgICAgICAgIG9wZW5pbmdIb3VyczogbmV3U3BhY2VbMF0ub3BlbmluZ0hvdXJzLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBuZXdTcGFjZVswXS5jcmVhdGVkQXQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBjb21tb24gc3BhY2U6JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgY29tbW9uIHNwYWNlJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2NvbW1vbi1zcGFjZXMvdXNlcnMvOnVzZXJJZC90aW1lLWxpbWl0cyAtIFNldCB1c2VyIHRpbWUgbGltaXRzIChNYW5hZ2VyL0FkbWluIG9ubHkpLlxuICAgKi9cbiAgYXBwLnBvc3QoXG4gICAgJy9hcGkvY29tbW9uLXNwYWNlcy91c2Vycy86dXNlcklkL3RpbWUtbGltaXRzJyxcbiAgICByZXF1aXJlQXV0aCxcbiAgICByZXF1aXJlUm9sZShbJ2FkbWluJywgJ21hbmFnZXInXSksXG4gICAgYXN5bmMgKHJlcTogUmVxdWVzdCwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gdXNlcklkU2NoZW1hLnNhZmVQYXJzZShyZXEucGFyYW1zKTtcbiAgICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCB1c2VyIElEJyxcbiAgICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiAoe1xuICAgICAgICAgICAgICBmaWVsZDogaXNzdWUucGF0aC5qb2luKCcuJyksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGlzc3VlLm1lc3NhZ2UsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IHNldFRpbWVMaW1pdFNjaGVtYS5zYWZlUGFyc2UocmVxLmJvZHkpO1xuICAgICAgICBpZiAoIXZhbGlkYXRpb25SZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCB0aW1lIGxpbWl0IGRhdGEnLFxuICAgICAgICAgICAgZXJyb3JzOiB2YWxpZGF0aW9uUmVzdWx0LmVycm9yLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiAoe1xuICAgICAgICAgICAgICBmaWVsZDogaXNzdWUucGF0aC5qb2luKCcuJyksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGlzc3VlLm1lc3NhZ2UsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IHVzZXJJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG4gICAgICAgIGNvbnN0IHsgdXNlcl9pZCwgY29tbW9uX3NwYWNlX2lkLCBsaW1pdF90eXBlLCBsaW1pdF9ob3VycyB9ID0gdmFsaWRhdGlvblJlc3VsdC5kYXRhO1xuXG4gICAgICAgIC8vIFZlcmlmeSB1c2VyIGV4aXN0c1xuICAgICAgICBjb25zdCB0YXJnZXRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHVzZXJzLmlkLCBmaXJzdE5hbWU6IHVzZXJzLmZpcnN0TmFtZSwgbGFzdE5hbWU6IHVzZXJzLmxhc3ROYW1lIH0pXG4gICAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCB1c2VySWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAodGFyZ2V0VXNlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBJZiBjb21tb25fc3BhY2VfaWQgaXMgcHJvdmlkZWQsIHZlcmlmeSBzcGFjZSBleGlzdHMgYW5kIHVzZXIgaGFzIGFjY2Vzc1xuICAgICAgICBpZiAoY29tbW9uX3NwYWNlX2lkKSB7XG4gICAgICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgIGlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgICAgICBidWlsZGluZ0lkOiBjb21tb25TcGFjZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgICAgICAud2hlcmUoZXEoY29tbW9uU3BhY2VzLmlkLCBjb21tb25fc3BhY2VfaWQpKVxuICAgICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgICAgaWYgKHNwYWNlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBub3QgZm91bmQnLFxuICAgICAgICAgICAgICBjb2RlOiAnU1BBQ0VfTk9UX0ZPVU5EJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhzcGFjZVswXS5idWlsZGluZ0lkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQgdG8gdGhpcyBjb21tb24gc3BhY2UnLFxuICAgICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIGEgdGltZSBsaW1pdCBhbHJlYWR5IGV4aXN0c1xuICAgICAgICBjb25zdCBleGlzdGluZ0xpbWl0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHVzZXJUaW1lTGltaXRzLmlkIH0pXG4gICAgICAgICAgLmZyb20odXNlclRpbWVMaW1pdHMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcSh1c2VyVGltZUxpbWl0cy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgICAgICAgIGNvbW1vbl9zcGFjZV9pZFxuICAgICAgICAgICAgICAgID8gZXEodXNlclRpbWVMaW1pdHMuY29tbW9uU3BhY2VJZCwgY29tbW9uX3NwYWNlX2lkKVxuICAgICAgICAgICAgICAgIDogc3FsYCR7dXNlclRpbWVMaW1pdHMuY29tbW9uU3BhY2VJZH0gSVMgTlVMTGAsXG4gICAgICAgICAgICAgIGVxKHVzZXJUaW1lTGltaXRzLmxpbWl0VHlwZSwgbGltaXRfdHlwZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0xpbWl0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBVcGRhdGUgZXhpc3RpbmcgbGltaXRcbiAgICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgICAgLnVwZGF0ZSh1c2VyVGltZUxpbWl0cylcbiAgICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgICBsaW1pdEhvdXJzOiBsaW1pdF9ob3VycyxcbiAgICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC53aGVyZShlcSh1c2VyVGltZUxpbWl0cy5pZCwgZXhpc3RpbmdMaW1pdFswXS5pZCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIENyZWF0ZSBuZXcgbGltaXRcbiAgICAgICAgICBhd2FpdCBkYi5pbnNlcnQodXNlclRpbWVMaW1pdHMpLnZhbHVlcyh7XG4gICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICBjb21tb25TcGFjZUlkOiBjb21tb25fc3BhY2VfaWQgfHwgbnVsbCxcbiAgICAgICAgICAgIGxpbWl0VHlwZTogbGltaXRfdHlwZSxcbiAgICAgICAgICAgIGxpbWl0SG91cnM6IGxpbWl0X2hvdXJzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYOKchSBTZXQgdGltZSBsaW1pdCBmb3IgdXNlciAke3RhcmdldFVzZXJbMF0uZmlyc3ROYW1lfSAke3RhcmdldFVzZXJbMF0ubGFzdE5hbWV9OiAke2xpbWl0X2hvdXJzfWggcGVyICR7bGltaXRfdHlwZX1gXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdUaW1lIGxpbWl0IHNldCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgIHVzZXI6IHtcbiAgICAgICAgICAgIGlkOiB0YXJnZXRVc2VyWzBdLmlkLFxuICAgICAgICAgICAgbmFtZTogYCR7dGFyZ2V0VXNlclswXS5maXJzdE5hbWV9ICR7dGFyZ2V0VXNlclswXS5sYXN0TmFtZX1gLFxuICAgICAgICAgICAgbGltaXRUeXBlOiBsaW1pdF90eXBlLFxuICAgICAgICAgICAgbGltaXRIb3VyczogbGltaXRfaG91cnMsXG4gICAgICAgICAgICBzcGFjZUlkOiBjb21tb25fc3BhY2VfaWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBzZXR0aW5nIHRpbWUgbGltaXQ6JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBzZXQgdGltZSBsaW1pdCcsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2NvbW1vbi1zcGFjZXMvdXNlcnMvOnVzZXJJZC90aW1lLWxpbWl0cyAtIEdldCB1c2VyIHRpbWUgbGltaXRzLlxuICAgKi9cbiAgYXBwLmdldChcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzL3VzZXJzLzp1c2VySWQvdGltZS1saW1pdHMnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB1c2VySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgICAgLy8gR2V0IHVzZXIncyB0aW1lIGxpbWl0c1xuICAgICAgICBjb25zdCBsaW1pdHMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHVzZXJUaW1lTGltaXRzLmlkLFxuICAgICAgICAgICAgdXNlcklkOiB1c2VyVGltZUxpbWl0cy51c2VySWQsXG4gICAgICAgICAgICBjb21tb25TcGFjZUlkOiB1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkLFxuICAgICAgICAgICAgc3BhY2VOYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICAgIGxpbWl0VHlwZTogdXNlclRpbWVMaW1pdHMubGltaXRUeXBlLFxuICAgICAgICAgICAgbGltaXRIb3VyczogdXNlclRpbWVMaW1pdHMubGltaXRIb3VycyxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogdXNlclRpbWVMaW1pdHMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiB1c2VyVGltZUxpbWl0cy51cGRhdGVkQXQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbSh1c2VyVGltZUxpbWl0cylcbiAgICAgICAgICAubGVmdEpvaW4oY29tbW9uU3BhY2VzLCBlcSh1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZXMuaWQpKVxuICAgICAgICAgIC53aGVyZShlcSh1c2VyVGltZUxpbWl0cy51c2VySWQsIHVzZXJJZCkpXG4gICAgICAgICAgLm9yZGVyQnkodXNlclRpbWVMaW1pdHMubGltaXRUeXBlLCB1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkKTtcblxuICAgICAgICAvLyBDYWxjdWxhdGUgY3VycmVudCB1c2FnZSBmb3IgZWFjaCBsaW1pdFxuICAgICAgICBjb25zdCBsaW1pdHNXaXRoVXNhZ2UgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICBsaW1pdHMubWFwKGFzeW5jIChsaW1pdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY3VycmVudEhvdXJzID0gYXdhaXQgZ2V0VXNlckJvb2tpbmdIb3VycyhcbiAgICAgICAgICAgICAgdXNlcklkLFxuICAgICAgICAgICAgICBsaW1pdC5jb21tb25TcGFjZUlkLFxuICAgICAgICAgICAgICBsaW1pdC5saW1pdFR5cGUgYXMgJ21vbnRobHknIHwgJ3llYXJseSdcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLmxpbWl0LFxuICAgICAgICAgICAgICBjdXJyZW50SG91cnM6IE1hdGgucm91bmQoY3VycmVudEhvdXJzICogMTAwKSAvIDEwMCxcbiAgICAgICAgICAgICAgcmVtYWluaW5nSG91cnM6IE1hdGgubWF4KDAsIGxpbWl0LmxpbWl0SG91cnMgLSBjdXJyZW50SG91cnMpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgICBsaW1pdHM6IGxpbWl0c1dpdGhVc2FnZSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB0aW1lIGxpbWl0czonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHRpbWUgbGltaXRzJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcy91c2VyLWNhbGVuZGFyIC0gR2V0IHVzZXIncyBwZXJzb25hbCBjYWxlbmRhclxuICAgKiBTaG93cyBhbGwgdXNlcidzIGJvb2tpbmdzIGFjcm9zcyBhbGwgc3BhY2VzIHRoZXkgaGF2ZSBhY2Nlc3MgdG8uXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2NvbW1vbi1zcGFjZXMvdXNlci1jYWxlbmRhcicsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBxdWVyeVZhbGlkYXRpb24gPSBjYWxlbmRhclF1ZXJ5U2NoZW1hLnNhZmVQYXJzZShyZXEucXVlcnkpO1xuICAgICAgaWYgKCFxdWVyeVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGNhbGVuZGFyIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGVycm9yczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiAoe1xuICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICB9KSksXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB7IHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCB2aWV3IH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgLy8gR2V0IHVzZXIncyBib29raW5ncyB3aXRoaW4gZGF0ZSByYW5nZVxuICAgICAgY29uc3QgdXNlckJvb2tpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJvb2tpbmdzLmlkLFxuICAgICAgICAgIHN0YXJ0VGltZTogYm9va2luZ3Muc3RhcnRUaW1lLFxuICAgICAgICAgIGVuZFRpbWU6IGJvb2tpbmdzLmVuZFRpbWUsXG4gICAgICAgICAgc3RhdHVzOiBib29raW5ncy5zdGF0dXMsXG4gICAgICAgICAgc3BhY2VOYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICBzcGFjZUlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgYnVpbGRpbmdOYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICBidWlsZGluZ0lkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAuaW5uZXJKb2luKGNvbW1vblNwYWNlcywgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgY29tbW9uU3BhY2VzLmlkKSlcbiAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ3MuaWQpKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoYm9va2luZ3MudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgICAgICAgICAgZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgbmV3IERhdGUoc3RhcnRfZGF0ZSkpLFxuICAgICAgICAgICAgbHRlKGJvb2tpbmdzLmVuZFRpbWUsIG5ldyBEYXRlKGVuZF9kYXRlKSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLm9yZGVyQnkoYm9va2luZ3Muc3RhcnRUaW1lKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHVzZXIuaWQsXG4gICAgICAgICAgbmFtZTogYCR7dXNlci5maXJzdE5hbWV9ICR7dXNlci5sYXN0TmFtZX1gLFxuICAgICAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgfSxcbiAgICAgICAgY2FsZW5kYXI6IHtcbiAgICAgICAgICB2aWV3LFxuICAgICAgICAgIHN0YXJ0RGF0ZTogc3RhcnRfZGF0ZSxcbiAgICAgICAgICBlbmREYXRlOiBlbmRfZGF0ZSxcbiAgICAgICAgICBib29raW5nczogdXNlckJvb2tpbmdzLFxuICAgICAgICB9LFxuICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgdG90YWxCb29raW5nczogdXNlckJvb2tpbmdzLmxlbmd0aCxcbiAgICAgICAgICB0b3RhbEhvdXJzOiB1c2VyQm9va2luZ3MucmVkdWNlKCh0b3RhbCwgYm9va2luZykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPVxuICAgICAgICAgICAgICAobmV3IERhdGUoYm9va2luZy5lbmRUaW1lKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShib29raW5nLnN0YXJ0VGltZSkuZ2V0VGltZSgpKSAvXG4gICAgICAgICAgICAgICgxMDAwICogNjAgKiA2MCk7XG4gICAgICAgICAgICByZXR1cm4gdG90YWwgKyBkdXJhdGlvbjtcbiAgICAgICAgICB9LCAwKSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIGNhbGVuZGFyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCB1c2VyIGNhbGVuZGFyJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcy9jYWxlbmRhci9idWlsZGluZy86YnVpbGRpbmdJZCAtIEdldCBidWlsZGluZy13aWRlIGNhbGVuZGFyIChNYW5hZ2VyL0FkbWluIG9ubHkpXG4gICAqIFNob3dzIGFsbCBib29raW5ncyBhY3Jvc3MgYWxsIHNwYWNlcyBpbiBhIGJ1aWxkaW5nIHdpdGggZnVsbCBkZXRhaWxzLlxuICAgKi9cbiAgYXBwLmdldChcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzL2NhbGVuZGFyL2J1aWxkaW5nLzpidWlsZGluZ0lkJyxcbiAgICByZXF1aXJlQXV0aCxcbiAgICByZXF1aXJlUm9sZShbJ2FkbWluJywgJ21hbmFnZXInXSksXG4gICAgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gei5vYmplY3QoeyBidWlsZGluZ0lkOiB6LnN0cmluZygpLnV1aWQoKSB9KS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICAgIGlmICghcGFyYW1WYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgYnVpbGRpbmcgSUQnLFxuICAgICAgICAgICAgZXJyb3JzOiBwYXJhbVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IGNhbGVuZGFyUXVlcnlTY2hlbWEuc2FmZVBhcnNlKHJlcS5xdWVyeSk7XG4gICAgICAgIGlmICghcXVlcnlWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgY2FsZW5kYXIgcXVlcnkgcGFyYW1ldGVycycsXG4gICAgICAgICAgICBlcnJvcnM6IHF1ZXJ5VmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMubWFwKChpc3N1ZSkgPT4gKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBidWlsZGluZ0lkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcbiAgICAgICAgY29uc3QgeyBzdGFydF9kYXRlLCBlbmRfZGF0ZSwgdmlldyB9ID0gcXVlcnlWYWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgICAgLy8gQ2hlY2sgYnVpbGRpbmcgYWNjZXNzXG4gICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgICAgaWYgKCFhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQgdG8gdGhpcyBidWlsZGluZycsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCBidWlsZGluZyBkZXRhaWxzXG4gICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoYnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgYWxsIGJvb2tpbmdzIGZvciBzcGFjZXMgaW4gdGhpcyBidWlsZGluZyB3aXRoaW4gZGF0ZSByYW5nZVxuICAgICAgICBjb25zdCBidWlsZGluZ0Jvb2tpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBib29raW5ncy5pZCxcbiAgICAgICAgICAgIHN0YXJ0VGltZTogYm9va2luZ3Muc3RhcnRUaW1lLFxuICAgICAgICAgICAgZW5kVGltZTogYm9va2luZ3MuZW5kVGltZSxcbiAgICAgICAgICAgIHN0YXR1czogYm9va2luZ3Muc3RhdHVzLFxuICAgICAgICAgICAgc3BhY2VOYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICAgIHNwYWNlSWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICAgIHVzZXJJZDogYm9va2luZ3MudXNlcklkLFxuICAgICAgICAgICAgdXNlck5hbWU6IHNxbDxzdHJpbmc+YENPTkNBVCgke3VzZXJzLmZpcnN0TmFtZX0sICcgJywgJHt1c2Vycy5sYXN0TmFtZX0pYCxcbiAgICAgICAgICAgIHVzZXJFbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgICB1c2VyUm9sZTogdXNlcnMucm9sZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAgIC5pbm5lckpvaW4oY29tbW9uU3BhY2VzLCBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZXMuaWQpKVxuICAgICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKGJvb2tpbmdzLnVzZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgICBlcShib29raW5ncy5zdGF0dXMsICdjb25maXJtZWQnKSxcbiAgICAgICAgICAgICAgZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgbmV3IERhdGUoc3RhcnRfZGF0ZSkpLFxuICAgICAgICAgICAgICBsdGUoYm9va2luZ3MuZW5kVGltZSwgbmV3IERhdGUoZW5kX2RhdGUpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAub3JkZXJCeShib29raW5ncy5zdGFydFRpbWUpO1xuXG4gICAgICAgIC8vIEdldCBhbGwgY29tbW9uIHNwYWNlcyBpbiB0aGlzIGJ1aWxkaW5nXG4gICAgICAgIGNvbnN0IGJ1aWxkaW5nU3BhY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgICBuYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICAgIGlzUmVzZXJ2YWJsZTogY29tbW9uU3BhY2VzLmlzUmVzZXJ2YWJsZSxcbiAgICAgICAgICAgIGNhcGFjaXR5OiBjb21tb25TcGFjZXMuY2FwYWNpdHksXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgICAgLndoZXJlKGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSlcbiAgICAgICAgICAub3JkZXJCeShjb21tb25TcGFjZXMubmFtZSk7XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgdXNhZ2Ugc3RhdGlzdGljc1xuICAgICAgICBjb25zdCBzcGFjZVVzYWdlID0gYnVpbGRpbmdTcGFjZXMubWFwKChzcGFjZSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHNwYWNlQm9va2luZ3MgPSBidWlsZGluZ0Jvb2tpbmdzLmZpbHRlcigoYm9va2luZykgPT4gYm9va2luZy5zcGFjZUlkID09PSBzcGFjZS5pZCk7XG4gICAgICAgICAgY29uc3QgdG90YWxIb3VycyA9IHNwYWNlQm9va2luZ3MucmVkdWNlKCh0b3RhbCwgYm9va2luZykgPT4ge1xuICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPVxuICAgICAgICAgICAgICAobmV3IERhdGUoYm9va2luZy5lbmRUaW1lKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShib29raW5nLnN0YXJ0VGltZSkuZ2V0VGltZSgpKSAvXG4gICAgICAgICAgICAgICgxMDAwICogNjAgKiA2MCk7XG4gICAgICAgICAgICByZXR1cm4gdG90YWwgKyBkdXJhdGlvbjtcbiAgICAgICAgICB9LCAwKTtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5zcGFjZSxcbiAgICAgICAgICAgIGJvb2tpbmdDb3VudDogc3BhY2VCb29raW5ncy5sZW5ndGgsXG4gICAgICAgICAgICB0b3RhbEhvdXJzOiBNYXRoLnJvdW5kKHRvdGFsSG91cnMgKiAxMCkgLyAxMCxcbiAgICAgICAgICAgIHVuaXF1ZVVzZXJzOiBbLi4ubmV3IFNldChzcGFjZUJvb2tpbmdzLm1hcCgoYikgPT4gYi51c2VySWQpKV0ubGVuZ3RoLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgICBidWlsZGluZzogYnVpbGRpbmdbMF0sXG4gICAgICAgICAgY2FsZW5kYXI6IHtcbiAgICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgICBzdGFydERhdGU6IHN0YXJ0X2RhdGUsXG4gICAgICAgICAgICBlbmREYXRlOiBlbmRfZGF0ZSxcbiAgICAgICAgICAgIGV2ZW50czogYnVpbGRpbmdCb29raW5ncyxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNwYWNlczogc3BhY2VVc2FnZSxcbiAgICAgICAgICBzdW1tYXJ5OiB7XG4gICAgICAgICAgICB0b3RhbEJvb2tpbmdzOiBidWlsZGluZ0Jvb2tpbmdzLmxlbmd0aCxcbiAgICAgICAgICAgIHRvdGFsU3BhY2VzOiBidWlsZGluZ1NwYWNlcy5sZW5ndGgsXG4gICAgICAgICAgICBhY3RpdmVTcGFjZXM6IGJ1aWxkaW5nU3BhY2VzLmZpbHRlcigocykgPT4gcy5pc1Jlc2VydmFibGUpLmxlbmd0aCxcbiAgICAgICAgICAgIHVuaXF1ZVVzZXJzOiBbLi4ubmV3IFNldChidWlsZGluZ0Jvb2tpbmdzLm1hcCgoYikgPT4gYi51c2VySWQpKV0ubGVuZ3RoLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYnVpbGRpbmcgY2FsZW5kYXI6JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBidWlsZGluZyBjYWxlbmRhcicsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG59XG4iXSwidmVyc2lvbiI6M30=