2ee823995f034c55f042f46806de5115
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const globals_1 = require("@jest/globals");
globals_1.jest.mock('wouter', () => ({
    useLocation: () => [mockLocation, mockSetLocation],
    useSearch: () => mockSearch,
}));
// Mock the SelectionGrid import
globals_1.jest.mock('@/components/ui/selection-grid', () => ({
    SelectionGrid: MockSelectionGrid,
}));
// Mock lucide-react icons
globals_1.jest.mock('lucide-react', () => ({
    ArrowLeft: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "arrow-left-icon", children: "ArrowLeft" }),
    Building: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "building-icon", children: "Building" }),
    MapPin: () => (0, jsx_runtime_1.jsx)("div", { "data-testid": "map-pin-icon", children: "MapPin" }),
}));
// Mock UI components
globals_1.jest.mock('@/components/ui/button', () => ({
    Button: ({ children, onClick, variant, size, className, 'data-testid': testId, ...props }) => ((0, jsx_runtime_1.jsx)("button", { onClick: onClick, "data-testid": testId, className: className, "data-variant": variant, "data-size": size, ...props, children: children })),
}));
globals_1.jest.mock('@/components/layout/header', () => ({
    Header: ({ title, subtitle }) => ((0, jsx_runtime_1.jsxs)("header", { "data-testid": "header", children: [(0, jsx_runtime_1.jsx)("h1", { "data-testid": "header-title", children: title }), (0, jsx_runtime_1.jsx)("p", { "data-testid": "header-subtitle", children: subtitle })] })),
}));
/**
 * Hierarchical Navigation Components Integration Tests
 * Tests the withHierarchicalSelection HOC and integrated components
 */
const react_1 = __importDefault(require("react"));
const react_2 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
require("@testing-library/jest-dom");
// Mock wouter for routing
const mockSetLocation = globals_1.jest.fn();
const mockLocation = '/residents/building';
const mockSearch = '';
// Mock the SelectionGrid component
const MockSelectionGrid = ({ title, items, onSelectItem, isLoading }) => ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "selection-grid", children: [(0, jsx_runtime_1.jsx)("h3", { "data-testid": "selection-title", children: title }), isLoading && (0, jsx_runtime_1.jsx)("div", { "data-testid": "loading-spinner", children: "Loading..." }), (0, jsx_runtime_1.jsx)("div", { "data-testid": "items-grid", children: items.map((item, index) => ((0, jsx_runtime_1.jsx)("button", { "data-testid": `item-${item.id || index}`, onClick: () => onSelectItem(item.id || `item-${index}`), className: "selection-item", children: item.name || item.title || `Item ${index + 1}` }, item.id || index))) })] }));
// Test component that simulates a hierarchical page
const TestComponent = ({ buildingId, showBackButton, backButtonLabel, onBack }) => ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "test-component", children: [showBackButton && onBack && ((0, jsx_runtime_1.jsx)("div", { "data-testid": "back-button-container", children: (0, jsx_runtime_1.jsx)("button", { "data-testid": "button-back", onClick: onBack, children: backButtonLabel }) })), buildingId ? ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "building-details", children: [(0, jsx_runtime_1.jsx)("h2", { children: "Building Details" }), (0, jsx_runtime_1.jsx)("p", { "data-testid": "building-id", children: buildingId })] })) : ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "selection-screen", children: [(0, jsx_runtime_1.jsx)("h2", { children: "Select Building" }), (0, jsx_runtime_1.jsx)("p", { children: "Choose a building to view details" })] }))] }));
// Mock the withHierarchicalSelection HOC
const withHierarchicalSelection = (Component, config) => {
    return (props) => {
        const [currentBuildingId, setCurrentBuildingId] = react_1.default.useState(null);
        const [showBuildings, setShowBuildings] = react_1.default.useState(false);
        // Mock data
        const mockBuildings = [
            { id: 'building-1', name: 'Building A' },
            { id: 'building-2', name: 'Building B' },
        ];
        // Simulate URL parsing
        react_1.default.useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const buildingFromUrl = urlParams.get('building');
            if (buildingFromUrl) {
                setCurrentBuildingId(buildingFromUrl);
                setShowBuildings(false);
            }
            else {
                setShowBuildings(true);
            }
        }, []);
        const handleBuildingSelect = (buildingId) => {
            setCurrentBuildingId(buildingId);
            setShowBuildings(false);
            // Simulate URL update
            window.history.pushState({}, '', `?building=${buildingId}`);
        };
        const handleBack = () => {
            setCurrentBuildingId(null);
            setShowBuildings(true);
            window.history.pushState({}, '', '/residents/building');
            mockSetLocation('/residents/building');
        };
        if (showBuildings) {
            return ((0, jsx_runtime_1.jsx)("div", { "data-testid": "hierarchical-selection", children: (0, jsx_runtime_1.jsx)(MockSelectionGrid, { title: "Select Building", items: mockBuildings, onSelectItem: handleBuildingSelect, isLoading: false }) }));
        }
        // Determine if should show back button (mock logic)
        const shouldShowBackButton = currentBuildingId && mockBuildings.length > 1;
        return ((0, jsx_runtime_1.jsx)(Component, { ...props, buildingId: currentBuildingId, showBackButton: shouldShowBackButton, backButtonLabel: "Building", onBack: handleBack }));
    };
};
const WrappedTestComponent = withHierarchicalSelection(TestComponent, {
    hierarchy: ['building'],
});
(0, globals_1.describe)('Hierarchical Navigation Components', () => {
    let queryClient;
    (0, globals_1.beforeEach)(() => {
        queryClient = new react_query_1.QueryClient({
            defaultOptions: {
                queries: {
                    retry: false,
                },
            },
        });
        // Reset mocks
        globals_1.jest.clearAllMocks();
        mockSetLocation.mockClear();
        // Mock window.history.pushState
        Object.defineProperty(window, 'history', {
            value: {
                pushState: globals_1.jest.fn(),
            },
            writable: true,
        });
        // Reset URL
        Object.defineProperty(window, 'location', {
            value: {
                search: '',
                pathname: '/residents/building',
            },
            writable: true,
        });
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.resetAllMocks();
    });
    const renderWithProviders = (component) => {
        return (0, react_2.render)((0, jsx_runtime_1.jsx)(react_query_1.QueryClientProvider, { client: queryClient, children: component }));
    };
    (0, globals_1.describe)('Building Selection Screen', () => {
        (0, globals_1.test)('should render building selection when no building is selected', () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.getByTestId('hierarchical-selection')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-grid')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Building');
            // Should show building options
            (0, globals_1.expect)(react_2.screen.getByTestId('item-building-1')).toHaveTextContent('Building A');
            (0, globals_1.expect)(react_2.screen.getByTestId('item-building-2')).toHaveTextContent('Building B');
        });
        (0, globals_1.test)('should handle building selection', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            const buildingAButton = react_2.screen.getByTestId('item-building-1');
            react_2.fireEvent.click(buildingAButton);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('test-component')).toBeInTheDocument();
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details')).toBeInTheDocument();
                (0, globals_1.expect)(react_2.screen.getByTestId('building-id')).toHaveTextContent('building-1');
            });
            // Should update URL
            (0, globals_1.expect)(window.history.pushState).toHaveBeenCalledWith({}, '', '?building=building-1');
        });
        (0, globals_1.test)('should not show loading spinner when not loading', () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.queryByTestId('loading-spinner')).not.toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Building Details Screen', () => {
        (0, globals_1.test)('should render building details when building is selected', () => {
            // Mock URL with building parameter
            Object.defineProperty(window, 'location', {
                value: {
                    search: '?building=building-1',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.getByTestId('test-component')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('building-details')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('building-id')).toHaveTextContent('building-1');
        });
        (0, globals_1.test)('should show back button when building is selected and multiple buildings exist', () => {
            Object.defineProperty(window, 'location', {
                value: {
                    search: '?building=building-1',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.getByTestId('back-button-container')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('button-back')).toHaveTextContent('Building');
        });
        (0, globals_1.test)('should handle back button click', async () => {
            Object.defineProperty(window, 'location', {
                value: {
                    search: '?building=building-1',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            const backButton = react_2.screen.getByTestId('button-back');
            react_2.fireEvent.click(backButton);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('hierarchical-selection')).toBeInTheDocument();
                (0, globals_1.expect)(react_2.screen.getByTestId('selection-grid')).toBeInTheDocument();
            });
            // Should update URL and router
            (0, globals_1.expect)(window.history.pushState).toHaveBeenCalledWith({}, '', '/residents/building');
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building');
        });
    });
    (0, globals_1.describe)('Smart Back Button Logic', () => {
        (0, globals_1.test)('should not show back button when only one building exists', () => {
            // Mock only one building
            const SingleBuildingComponent = withHierarchicalSelection(TestComponent, {
                hierarchy: ['building'],
            });
            // Override the component to simulate single building scenario
            const SingleBuildingTestComponent = (props) => {
                const [currentBuildingId, setCurrentBuildingId] = react_1.default.useState('building-1');
                // Mock single building scenario - should not show back button
                const shouldShowBackButton = false; // Single building = no back button
                return ((0, jsx_runtime_1.jsx)(TestComponent, { ...props, buildingId: currentBuildingId, showBackButton: shouldShowBackButton, backButtonLabel: "Building", onBack: () => { } }));
            };
            renderWithProviders((0, jsx_runtime_1.jsx)(SingleBuildingTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.queryByTestId('back-button-container')).not.toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.queryByTestId('button-back')).not.toBeInTheDocument();
        });
        (0, globals_1.test)('should show back button when multiple buildings exist', () => {
            Object.defineProperty(window, 'location', {
                value: {
                    search: '?building=building-1',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            // Should show back button because mock has 2 buildings
            (0, globals_1.expect)(react_2.screen.getByTestId('back-button-container')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('button-back')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('URL Navigation', () => {
        (0, globals_1.test)('should parse building ID from URL parameters', () => {
            Object.defineProperty(window, 'location', {
                value: {
                    search: '?building=test-building-123',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.getByTestId('building-details')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('building-id')).toHaveTextContent('test-building-123');
        });
        (0, globals_1.test)('should show selection screen when no URL parameters', () => {
            Object.defineProperty(window, 'location', {
                value: {
                    search: '',
                    pathname: '/residents/building',
                },
                writable: true,
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            (0, globals_1.expect)(react_2.screen.getByTestId('hierarchical-selection')).toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-grid')).toBeInTheDocument();
        });
        (0, globals_1.test)('should handle URL updates correctly', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(WrappedTestComponent, {}));
            // Start with selection screen
            (0, globals_1.expect)(react_2.screen.getByTestId('hierarchical-selection')).toBeInTheDocument();
            // Select a building
            const buildingButton = react_2.screen.getByTestId('item-building-2');
            react_2.fireEvent.click(buildingButton);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(window.history.pushState).toHaveBeenCalledWith({}, '', '?building=building-2');
            });
            // Go back
            const backButton = react_2.screen.getByTestId('button-back');
            react_2.fireEvent.click(backButton);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(window.history.pushState).toHaveBeenCalledWith({}, '', '/residents/building');
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2hpZXJhcmNoaWNhbC1uYXZpZ2F0aW9uLWNvbXBvbmVudHMudGVzdC50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBT0EsMkNBQW9GO0FBU3BGLGNBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekIsV0FBVyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQztJQUNsRCxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsVUFBVTtDQUM1QixDQUFDLENBQUMsQ0FBQztBQXNCSixnQ0FBZ0M7QUFDaEMsY0FBSSxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pELGFBQWEsRUFBRSxpQkFBaUI7Q0FDakMsQ0FBQyxDQUFDLENBQUM7QUFFSiwwQkFBMEI7QUFDMUIsY0FBSSxDQUFDLElBQUksQ0FBQyxjQUFjLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUMvQixTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsK0NBQWlCLGlCQUFpQiwwQkFBZ0I7SUFDbkUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDLCtDQUFpQixlQUFlLHlCQUFlO0lBQy9ELE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQywrQ0FBaUIsY0FBYyx1QkFBYTtDQUMzRCxDQUFDLENBQUMsQ0FBQztBQUVKLHFCQUFxQjtBQUNyQixjQUFJLENBQUMsSUFBSSxDQUFDLHdCQUF3QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDekMsTUFBTSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsU0FBUyxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsR0FBRyxLQUFLLEVBQU8sRUFBRSxFQUFFLENBQUMsQ0FDakcsbUNBQ0UsT0FBTyxFQUFFLE9BQU8saUJBQ0gsTUFBTSxFQUNuQixTQUFTLEVBQUUsU0FBUyxrQkFDTixPQUFPLGVBQ1YsSUFBSSxLQUNYLEtBQUssWUFFUixRQUFRLEdBQ0YsQ0FDVjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBRUosY0FBSSxDQUFDLElBQUksQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdDLE1BQU0sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBTyxFQUFFLEVBQUUsQ0FBQyxDQUNwQyxtREFBb0IsUUFBUSxhQUMxQiw4Q0FBZ0IsY0FBYyxZQUFFLEtBQUssR0FBTSxFQUMzQyw2Q0FBZSxpQkFBaUIsWUFBRSxRQUFRLEdBQUssSUFDeEMsQ0FDVjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBNUVKOzs7R0FHRztBQUVILGtEQUEwQjtBQUMxQixrREFBNEU7QUFFNUUsdURBQXlFO0FBQ3pFLHFDQUFtQztBQUVuQywwQkFBMEI7QUFDMUIsTUFBTSxlQUFlLEdBQUcsY0FBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBQ2xDLE1BQU0sWUFBWSxHQUFHLHFCQUFxQixDQUFDO0FBQzNDLE1BQU0sVUFBVSxHQUFHLEVBQUUsQ0FBQztBQU90QixtQ0FBbUM7QUFDbkMsTUFBTSxpQkFBaUIsR0FBRyxDQUFDLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFPLEVBQUUsRUFBRSxDQUFDLENBQzVFLGdEQUFpQixnQkFBZ0IsYUFDL0IsOENBQWdCLGlCQUFpQixZQUFFLEtBQUssR0FBTSxFQUM3QyxTQUFTLElBQUksK0NBQWlCLGlCQUFpQiwyQkFBaUIsRUFDakUsK0NBQWlCLFlBQVksWUFDMUIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQVMsRUFBRSxLQUFhLEVBQUUsRUFBRSxDQUFDLENBQ3ZDLGtEQUVlLFFBQVEsSUFBSSxDQUFDLEVBQUUsSUFBSSxLQUFLLEVBQUUsRUFDdkMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsRUFBRSxJQUFJLFFBQVEsS0FBSyxFQUFFLENBQUMsRUFDdkQsU0FBUyxFQUFDLGdCQUFnQixZQUV6QixJQUFJLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxLQUFLLElBQUksUUFBUSxLQUFLLEdBQUcsQ0FBQyxFQUFFLElBTDFDLElBQUksQ0FBQyxFQUFFLElBQUksS0FBSyxDQU1kLENBQ1YsQ0FBQyxHQUNFLElBQ0YsQ0FDUCxDQUFDO0FBdUNGLG9EQUFvRDtBQUNwRCxNQUFNLGFBQWEsR0FBRyxDQUFDLEVBQ3JCLFVBQVUsRUFDVixjQUFjLEVBQ2QsZUFBZSxFQUNmLE1BQU0sRUFNUCxFQUFFLEVBQUUsQ0FBQyxDQUNKLGdEQUFpQixnQkFBZ0IsYUFDOUIsY0FBYyxJQUFJLE1BQU0sSUFBSSxDQUMzQiwrQ0FBaUIsdUJBQXVCLFlBQ3RDLGtEQUNjLGFBQWEsRUFDekIsT0FBTyxFQUFFLE1BQU0sWUFFZCxlQUFlLEdBQ1QsR0FDTCxDQUNQLEVBQ0EsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUNaLGdEQUFpQixrQkFBa0IsYUFDakMsOERBQXlCLEVBQ3pCLDZDQUFlLGFBQWEsWUFBRSxVQUFVLEdBQUssSUFDekMsQ0FDUCxDQUFDLENBQUMsQ0FBQyxDQUNGLGdEQUFpQixrQkFBa0IsYUFDakMsNkRBQXdCLEVBQ3hCLDhFQUF3QyxJQUNwQyxDQUNQLElBQ0csQ0FDUCxDQUFDO0FBRUYseUNBQXlDO0FBQ3pDLE1BQU0seUJBQXlCLEdBQUcsQ0FBQyxTQUFtQyxFQUFFLE1BQVcsRUFBRSxFQUFFO0lBQ3JGLE9BQU8sQ0FBQyxLQUFVLEVBQUUsRUFBRTtRQUNwQixNQUFNLENBQUMsaUJBQWlCLEVBQUUsb0JBQW9CLENBQUMsR0FBRyxlQUFLLENBQUMsUUFBUSxDQUFnQixJQUFJLENBQUMsQ0FBQztRQUN0RixNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsZUFBSyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUVoRSxZQUFZO1FBQ1osTUFBTSxhQUFhLEdBQUc7WUFDcEIsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUU7WUFDeEMsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUU7U0FDekMsQ0FBQztRQUVGLHVCQUF1QjtRQUN2QixlQUFLLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRTtZQUNuQixNQUFNLFNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzlELE1BQU0sZUFBZSxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbEQsSUFBSSxlQUFlLEVBQUUsQ0FBQztnQkFDcEIsb0JBQW9CLENBQUMsZUFBZSxDQUFDLENBQUM7Z0JBQ3RDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzFCLENBQUM7aUJBQU0sQ0FBQztnQkFDTixnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QixDQUFDO1FBQ0gsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRVAsTUFBTSxvQkFBb0IsR0FBRyxDQUFDLFVBQWtCLEVBQUUsRUFBRTtZQUNsRCxvQkFBb0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNqQyxnQkFBZ0IsQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUN4QixzQkFBc0I7WUFDdEIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxhQUFhLFVBQVUsRUFBRSxDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDO1FBRUYsTUFBTSxVQUFVLEdBQUcsR0FBRyxFQUFFO1lBQ3RCLG9CQUFvQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzNCLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3ZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUN4RCxlQUFlLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUM7UUFFRixJQUFJLGFBQWEsRUFBRSxDQUFDO1lBQ2xCLE9BQU8sQ0FDTCwrQ0FBaUIsd0JBQXdCLFlBQ3ZDLHVCQUFDLGlCQUFpQixJQUNoQixLQUFLLEVBQUMsaUJBQWlCLEVBQ3ZCLEtBQUssRUFBRSxhQUFhLEVBQ3BCLFlBQVksRUFBRSxvQkFBb0IsRUFDbEMsU0FBUyxFQUFFLEtBQUssR0FDaEIsR0FDRSxDQUNQLENBQUM7UUFDSixDQUFDO1FBRUQsb0RBQW9EO1FBQ3BELE1BQU0sb0JBQW9CLEdBQUcsaUJBQWlCLElBQUksYUFBYSxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7UUFFM0UsT0FBTyxDQUNMLHVCQUFDLFNBQVMsT0FDSixLQUFLLEVBQ1QsVUFBVSxFQUFFLGlCQUFpQixFQUM3QixjQUFjLEVBQUUsb0JBQW9CLEVBQ3BDLGVBQWUsRUFBQyxVQUFVLEVBQzFCLE1BQU0sRUFBRSxVQUFVLEdBQ2xCLENBQ0gsQ0FBQztJQUNKLENBQUMsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLE1BQU0sb0JBQW9CLEdBQUcseUJBQXlCLENBQUMsYUFBYSxFQUFFO0lBQ3BFLFNBQVMsRUFBRSxDQUFDLFVBQVUsQ0FBQztDQUN4QixDQUFDLENBQUM7QUFFSCxJQUFBLGtCQUFRLEVBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO0lBQ2xELElBQUksV0FBd0IsQ0FBQztJQUU3QixJQUFBLG9CQUFVLEVBQUMsR0FBRyxFQUFFO1FBQ2QsV0FBVyxHQUFHLElBQUkseUJBQVcsQ0FBQztZQUM1QixjQUFjLEVBQUU7Z0JBQ2QsT0FBTyxFQUFFO29CQUNQLEtBQUssRUFBRSxLQUFLO2lCQUNiO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCxjQUFjO1FBQ2QsY0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLGVBQWUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUU1QixnQ0FBZ0M7UUFDaEMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsU0FBUyxFQUFFO1lBQ3ZDLEtBQUssRUFBRTtnQkFDTCxTQUFTLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTthQUNyQjtZQUNELFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQyxDQUFDO1FBRUgsWUFBWTtRQUNaLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFVBQVUsRUFBRTtZQUN4QyxLQUFLLEVBQUU7Z0JBQ0wsTUFBTSxFQUFFLEVBQUU7Z0JBQ1YsUUFBUSxFQUFFLHFCQUFxQjthQUNoQztZQUNELFFBQVEsRUFBRSxJQUFJO1NBQ2YsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLG1CQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsY0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLFNBQTZCLEVBQUUsRUFBRTtRQUM1RCxPQUFPLElBQUEsY0FBTSxFQUNYLHVCQUFDLGlDQUFtQixJQUFDLE1BQU0sRUFBRSxXQUFXLFlBQ3JDLFNBQVMsR0FDVSxDQUN2QixDQUFDO0lBQ0osQ0FBQyxDQUFDO0lBRUYsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUN6QyxJQUFBLGNBQUksRUFBQywrREFBK0QsRUFBRSxHQUFHLEVBQUU7WUFDekUsbUJBQW1CLENBQUMsdUJBQUMsb0JBQW9CLEtBQUcsQ0FBQyxDQUFDO1lBRTlDLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pFLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ2pFLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1lBRW5GLCtCQUErQjtZQUMvQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDOUUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hGLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxjQUFJLEVBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEQsbUJBQW1CLENBQUMsdUJBQUMsb0JBQW9CLEtBQUcsQ0FBQyxDQUFDO1lBRTlDLE1BQU0sZUFBZSxHQUFHLGNBQU0sQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUM5RCxpQkFBUyxDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUVqQyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ2pFLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO2dCQUNuRSxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQzVFLENBQUMsQ0FBQyxDQUFDO1lBRUgsb0JBQW9CO1lBQ3BCLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztRQUN4RixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLGtEQUFrRCxFQUFFLEdBQUcsRUFBRTtZQUM1RCxtQkFBbUIsQ0FBQyx1QkFBQyxvQkFBb0IsS0FBRyxDQUFDLENBQUM7WUFFOUMsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxhQUFhLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQzFFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMseUJBQXlCLEVBQUUsR0FBRyxFQUFFO1FBQ3ZDLElBQUEsY0FBSSxFQUFDLDBEQUEwRCxFQUFFLEdBQUcsRUFBRTtZQUNwRSxtQ0FBbUM7WUFDbkMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFO2dCQUN4QyxLQUFLLEVBQUU7b0JBQ0wsTUFBTSxFQUFFLHNCQUFzQjtvQkFDOUIsUUFBUSxFQUFFLHFCQUFxQjtpQkFDaEM7Z0JBQ0QsUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7WUFFSCxtQkFBbUIsQ0FBQyx1QkFBQyxvQkFBb0IsS0FBRyxDQUFDLENBQUM7WUFFOUMsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDakUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDbkUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLGdGQUFnRixFQUFFLEdBQUcsRUFBRTtZQUMxRixNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUU7Z0JBQ3hDLEtBQUssRUFBRTtvQkFDTCxNQUFNLEVBQUUsc0JBQXNCO29CQUM5QixRQUFRLEVBQUUscUJBQXFCO2lCQUNoQztnQkFDRCxRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUVILG1CQUFtQixDQUFDLHVCQUFDLG9CQUFvQixLQUFHLENBQUMsQ0FBQztZQUU5QyxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUN4RSxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzFFLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxjQUFJLEVBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDakQsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFO2dCQUN4QyxLQUFLLEVBQUU7b0JBQ0wsTUFBTSxFQUFFLHNCQUFzQjtvQkFDOUIsUUFBUSxFQUFFLHFCQUFxQjtpQkFDaEM7Z0JBQ0QsUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7WUFFSCxtQkFBbUIsQ0FBQyx1QkFBQyxvQkFBb0IsS0FBRyxDQUFDLENBQUM7WUFFOUMsTUFBTSxVQUFVLEdBQUcsY0FBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUNyRCxpQkFBUyxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUU1QixNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQ3pFLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ25FLENBQUMsQ0FBQyxDQUFDO1lBRUgsK0JBQStCO1lBQy9CLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUscUJBQXFCLENBQUMsQ0FBQztZQUNyRixJQUFBLGdCQUFNLEVBQUMsZUFBZSxDQUFDLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtRQUN2QyxJQUFBLGNBQUksRUFBQywyREFBMkQsRUFBRSxHQUFHLEVBQUU7WUFDckUseUJBQXlCO1lBQ3pCLE1BQU0sdUJBQXVCLEdBQUcseUJBQXlCLENBQUMsYUFBYSxFQUFFO2dCQUN2RSxTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUM7YUFDeEIsQ0FBQyxDQUFDO1lBRUgsOERBQThEO1lBQzlELE1BQU0sMkJBQTJCLEdBQUcsQ0FBQyxLQUFVLEVBQUUsRUFBRTtnQkFDakQsTUFBTSxDQUFDLGlCQUFpQixFQUFFLG9CQUFvQixDQUFDLEdBQUcsZUFBSyxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsQ0FBQztnQkFFL0UsOERBQThEO2dCQUM5RCxNQUFNLG9CQUFvQixHQUFHLEtBQUssQ0FBQyxDQUFDLG1DQUFtQztnQkFFdkUsT0FBTyxDQUNMLHVCQUFDLGFBQWEsT0FDUixLQUFLLEVBQ1QsVUFBVSxFQUFFLGlCQUFpQixFQUM3QixjQUFjLEVBQUUsb0JBQW9CLEVBQ3BDLGVBQWUsRUFBQyxVQUFVLEVBQzFCLE1BQU0sRUFBRSxHQUFHLEVBQUUsR0FBRSxDQUFDLEdBQ2hCLENBQ0gsQ0FBQztZQUNKLENBQUMsQ0FBQztZQUVGLG1CQUFtQixDQUFDLHVCQUFDLDJCQUEyQixLQUFHLENBQUMsQ0FBQztZQUVyRCxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDOUUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLHVEQUF1RCxFQUFFLEdBQUcsRUFBRTtZQUNqRSxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUU7Z0JBQ3hDLEtBQUssRUFBRTtvQkFDTCxNQUFNLEVBQUUsc0JBQXNCO29CQUM5QixRQUFRLEVBQUUscUJBQXFCO2lCQUNoQztnQkFDRCxRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUVILG1CQUFtQixDQUFDLHVCQUFDLG9CQUFvQixLQUFHLENBQUMsQ0FBQztZQUU5Qyx1REFBdUQ7WUFDdkQsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsdUJBQXVCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDeEUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ2hFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLElBQUEsY0FBSSxFQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN4RCxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxVQUFVLEVBQUU7Z0JBQ3hDLEtBQUssRUFBRTtvQkFDTCxNQUFNLEVBQUUsNkJBQTZCO29CQUNyQyxRQUFRLEVBQUUscUJBQXFCO2lCQUNoQztnQkFDRCxRQUFRLEVBQUUsSUFBSTthQUNmLENBQUMsQ0FBQztZQUVILG1CQUFtQixDQUFDLHVCQUFDLG9CQUFvQixLQUFHLENBQUMsQ0FBQztZQUU5QyxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNuRSxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLG1CQUFtQixDQUFDLENBQUM7UUFDbkYsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyxxREFBcUQsRUFBRSxHQUFHLEVBQUU7WUFDL0QsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFO2dCQUN4QyxLQUFLLEVBQUU7b0JBQ0wsTUFBTSxFQUFFLEVBQUU7b0JBQ1YsUUFBUSxFQUFFLHFCQUFxQjtpQkFDaEM7Z0JBQ0QsUUFBUSxFQUFFLElBQUk7YUFDZixDQUFDLENBQUM7WUFFSCxtQkFBbUIsQ0FBQyx1QkFBQyxvQkFBb0IsS0FBRyxDQUFDLENBQUM7WUFFOUMsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDekUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyxxQ0FBcUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxtQkFBbUIsQ0FBQyx1QkFBQyxvQkFBb0IsS0FBRyxDQUFDLENBQUM7WUFFOUMsOEJBQThCO1lBQzlCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRXpFLG9CQUFvQjtZQUNwQixNQUFNLGNBQWMsR0FBRyxjQUFNLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDN0QsaUJBQVMsQ0FBQyxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUM7WUFFaEMsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsc0JBQXNCLENBQUMsQ0FBQztZQUN4RixDQUFDLENBQUMsQ0FBQztZQUVILFVBQVU7WUFDVixNQUFNLFVBQVUsR0FBRyxjQUFNLENBQUMsV0FBVyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQ3JELGlCQUFTLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTVCLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLEVBQUUsRUFBRSxFQUFFLHFCQUFxQixDQUFDLENBQUM7WUFDdkYsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2hpZXJhcmNoaWNhbC1uYXZpZ2F0aW9uLWNvbXBvbmVudHMudGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBIaWVyYXJjaGljYWwgTmF2aWdhdGlvbiBDb21wb25lbnRzIEludGVncmF0aW9uIFRlc3RzXG4gKiBUZXN0cyB0aGUgd2l0aEhpZXJhcmNoaWNhbFNlbGVjdGlvbiBIT0MgYW5kIGludGVncmF0ZWQgY29tcG9uZW50c1xuICovXG5cbmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgeyBkZXNjcmliZSwgdGVzdCwgZXhwZWN0LCBqZXN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IFF1ZXJ5Q2xpZW50LCBRdWVyeUNsaWVudFByb3ZpZGVyIH0gZnJvbSAnQHRhbnN0YWNrL3JlYWN0LXF1ZXJ5JztcbmltcG9ydCAnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbSc7XG5cbi8vIE1vY2sgd291dGVyIGZvciByb3V0aW5nXG5jb25zdCBtb2NrU2V0TG9jYXRpb24gPSBqZXN0LmZuKCk7XG5jb25zdCBtb2NrTG9jYXRpb24gPSAnL3Jlc2lkZW50cy9idWlsZGluZyc7XG5jb25zdCBtb2NrU2VhcmNoID0gJyc7XG5cbmplc3QubW9jaygnd291dGVyJywgKCkgPT4gKHtcbiAgdXNlTG9jYXRpb246ICgpID0+IFttb2NrTG9jYXRpb24sIG1vY2tTZXRMb2NhdGlvbl0sXG4gIHVzZVNlYXJjaDogKCkgPT4gbW9ja1NlYXJjaCxcbn0pKTtcblxuLy8gTW9jayB0aGUgU2VsZWN0aW9uR3JpZCBjb21wb25lbnRcbmNvbnN0IE1vY2tTZWxlY3Rpb25HcmlkID0gKHsgdGl0bGUsIGl0ZW1zLCBvblNlbGVjdEl0ZW0sIGlzTG9hZGluZyB9OiBhbnkpID0+IChcbiAgPGRpdiBkYXRhLXRlc3RpZD1cInNlbGVjdGlvbi1ncmlkXCI+XG4gICAgPGgzIGRhdGEtdGVzdGlkPVwic2VsZWN0aW9uLXRpdGxlXCI+e3RpdGxlfTwvaDM+XG4gICAge2lzTG9hZGluZyAmJiA8ZGl2IGRhdGEtdGVzdGlkPVwibG9hZGluZy1zcGlubmVyXCI+TG9hZGluZy4uLjwvZGl2Pn1cbiAgICA8ZGl2IGRhdGEtdGVzdGlkPVwiaXRlbXMtZ3JpZFwiPlxuICAgICAge2l0ZW1zLm1hcCgoaXRlbTogYW55LCBpbmRleDogbnVtYmVyKSA9PiAoXG4gICAgICAgIDxidXR0b25cbiAgICAgICAgICBrZXk9e2l0ZW0uaWQgfHwgaW5kZXh9XG4gICAgICAgICAgZGF0YS10ZXN0aWQ9e2BpdGVtLSR7aXRlbS5pZCB8fCBpbmRleH1gfVxuICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG9uU2VsZWN0SXRlbShpdGVtLmlkIHx8IGBpdGVtLSR7aW5kZXh9YCl9XG4gICAgICAgICAgY2xhc3NOYW1lPVwic2VsZWN0aW9uLWl0ZW1cIlxuICAgICAgICA+XG4gICAgICAgICAge2l0ZW0ubmFtZSB8fCBpdGVtLnRpdGxlIHx8IGBJdGVtICR7aW5kZXggKyAxfWB9XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgKSl9XG4gICAgPC9kaXY+XG4gIDwvZGl2PlxuKTtcblxuLy8gTW9jayB0aGUgU2VsZWN0aW9uR3JpZCBpbXBvcnRcbmplc3QubW9jaygnQC9jb21wb25lbnRzL3VpL3NlbGVjdGlvbi1ncmlkJywgKCkgPT4gKHtcbiAgU2VsZWN0aW9uR3JpZDogTW9ja1NlbGVjdGlvbkdyaWQsXG59KSk7XG5cbi8vIE1vY2sgbHVjaWRlLXJlYWN0IGljb25zXG5qZXN0Lm1vY2soJ2x1Y2lkZS1yZWFjdCcsICgpID0+ICh7XG4gIEFycm93TGVmdDogKCkgPT4gPGRpdiBkYXRhLXRlc3RpZD1cImFycm93LWxlZnQtaWNvblwiPkFycm93TGVmdDwvZGl2PixcbiAgQnVpbGRpbmc6ICgpID0+IDxkaXYgZGF0YS10ZXN0aWQ9XCJidWlsZGluZy1pY29uXCI+QnVpbGRpbmc8L2Rpdj4sXG4gIE1hcFBpbjogKCkgPT4gPGRpdiBkYXRhLXRlc3RpZD1cIm1hcC1waW4taWNvblwiPk1hcFBpbjwvZGl2Pixcbn0pKTtcblxuLy8gTW9jayBVSSBjb21wb25lbnRzXG5qZXN0Lm1vY2soJ0AvY29tcG9uZW50cy91aS9idXR0b24nLCAoKSA9PiAoe1xuICBCdXR0b246ICh7IGNoaWxkcmVuLCBvbkNsaWNrLCB2YXJpYW50LCBzaXplLCBjbGFzc05hbWUsICdkYXRhLXRlc3RpZCc6IHRlc3RJZCwgLi4ucHJvcHMgfTogYW55KSA9PiAoXG4gICAgPGJ1dHRvblxuICAgICAgb25DbGljaz17b25DbGlja31cbiAgICAgIGRhdGEtdGVzdGlkPXt0ZXN0SWR9XG4gICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZX1cbiAgICAgIGRhdGEtdmFyaWFudD17dmFyaWFudH1cbiAgICAgIGRhdGEtc2l6ZT17c2l6ZX1cbiAgICAgIHsuLi5wcm9wc31cbiAgICA+XG4gICAgICB7Y2hpbGRyZW59XG4gICAgPC9idXR0b24+XG4gICksXG59KSk7XG5cbmplc3QubW9jaygnQC9jb21wb25lbnRzL2xheW91dC9oZWFkZXInLCAoKSA9PiAoe1xuICBIZWFkZXI6ICh7IHRpdGxlLCBzdWJ0aXRsZSB9OiBhbnkpID0+IChcbiAgICA8aGVhZGVyIGRhdGEtdGVzdGlkPVwiaGVhZGVyXCI+XG4gICAgICA8aDEgZGF0YS10ZXN0aWQ9XCJoZWFkZXItdGl0bGVcIj57dGl0bGV9PC9oMT5cbiAgICAgIDxwIGRhdGEtdGVzdGlkPVwiaGVhZGVyLXN1YnRpdGxlXCI+e3N1YnRpdGxlfTwvcD5cbiAgICA8L2hlYWRlcj5cbiAgKSxcbn0pKTtcblxuLy8gVGVzdCBjb21wb25lbnQgdGhhdCBzaW11bGF0ZXMgYSBoaWVyYXJjaGljYWwgcGFnZVxuY29uc3QgVGVzdENvbXBvbmVudCA9ICh7IFxuICBidWlsZGluZ0lkLCBcbiAgc2hvd0JhY2tCdXR0b24sIFxuICBiYWNrQnV0dG9uTGFiZWwsIFxuICBvbkJhY2sgXG59OiB7XG4gIGJ1aWxkaW5nSWQ/OiBzdHJpbmc7XG4gIHNob3dCYWNrQnV0dG9uPzogYm9vbGVhbjtcbiAgYmFja0J1dHRvbkxhYmVsPzogc3RyaW5nO1xuICBvbkJhY2s/OiAoKSA9PiB2b2lkO1xufSkgPT4gKFxuICA8ZGl2IGRhdGEtdGVzdGlkPVwidGVzdC1jb21wb25lbnRcIj5cbiAgICB7c2hvd0JhY2tCdXR0b24gJiYgb25CYWNrICYmIChcbiAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJiYWNrLWJ1dHRvbi1jb250YWluZXJcIj5cbiAgICAgICAgPGJ1dHRvblxuICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLWJhY2tcIlxuICAgICAgICAgIG9uQ2xpY2s9e29uQmFja31cbiAgICAgICAgPlxuICAgICAgICAgIHtiYWNrQnV0dG9uTGFiZWx9XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgKX1cbiAgICB7YnVpbGRpbmdJZCA/IChcbiAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJidWlsZGluZy1kZXRhaWxzXCI+XG4gICAgICAgIDxoMj5CdWlsZGluZyBEZXRhaWxzPC9oMj5cbiAgICAgICAgPHAgZGF0YS10ZXN0aWQ9XCJidWlsZGluZy1pZFwiPntidWlsZGluZ0lkfTwvcD5cbiAgICAgIDwvZGl2PlxuICAgICkgOiAoXG4gICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwic2VsZWN0aW9uLXNjcmVlblwiPlxuICAgICAgICA8aDI+U2VsZWN0IEJ1aWxkaW5nPC9oMj5cbiAgICAgICAgPHA+Q2hvb3NlIGEgYnVpbGRpbmcgdG8gdmlldyBkZXRhaWxzPC9wPlxuICAgICAgPC9kaXY+XG4gICAgKX1cbiAgPC9kaXY+XG4pO1xuXG4vLyBNb2NrIHRoZSB3aXRoSGllcmFyY2hpY2FsU2VsZWN0aW9uIEhPQ1xuY29uc3Qgd2l0aEhpZXJhcmNoaWNhbFNlbGVjdGlvbiA9IChDb21wb25lbnQ6IFJlYWN0LkNvbXBvbmVudFR5cGU8YW55PiwgY29uZmlnOiBhbnkpID0+IHtcbiAgcmV0dXJuIChwcm9wczogYW55KSA9PiB7XG4gICAgY29uc3QgW2N1cnJlbnRCdWlsZGluZ0lkLCBzZXRDdXJyZW50QnVpbGRpbmdJZF0gPSBSZWFjdC51c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTtcbiAgICBjb25zdCBbc2hvd0J1aWxkaW5ncywgc2V0U2hvd0J1aWxkaW5nc10gPSBSZWFjdC51c2VTdGF0ZShmYWxzZSk7XG4gICAgXG4gICAgLy8gTW9jayBkYXRhXG4gICAgY29uc3QgbW9ja0J1aWxkaW5ncyA9IFtcbiAgICAgIHsgaWQ6ICdidWlsZGluZy0xJywgbmFtZTogJ0J1aWxkaW5nIEEnIH0sXG4gICAgICB7IGlkOiAnYnVpbGRpbmctMicsIG5hbWU6ICdCdWlsZGluZyBCJyB9LFxuICAgIF07XG5cbiAgICAvLyBTaW11bGF0ZSBVUkwgcGFyc2luZ1xuICAgIFJlYWN0LnVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpO1xuICAgICAgY29uc3QgYnVpbGRpbmdGcm9tVXJsID0gdXJsUGFyYW1zLmdldCgnYnVpbGRpbmcnKTtcbiAgICAgIGlmIChidWlsZGluZ0Zyb21VcmwpIHtcbiAgICAgICAgc2V0Q3VycmVudEJ1aWxkaW5nSWQoYnVpbGRpbmdGcm9tVXJsKTtcbiAgICAgICAgc2V0U2hvd0J1aWxkaW5ncyhmYWxzZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXRTaG93QnVpbGRpbmdzKHRydWUpO1xuICAgICAgfVxuICAgIH0sIFtdKTtcblxuICAgIGNvbnN0IGhhbmRsZUJ1aWxkaW5nU2VsZWN0ID0gKGJ1aWxkaW5nSWQ6IHN0cmluZykgPT4ge1xuICAgICAgc2V0Q3VycmVudEJ1aWxkaW5nSWQoYnVpbGRpbmdJZCk7XG4gICAgICBzZXRTaG93QnVpbGRpbmdzKGZhbHNlKTtcbiAgICAgIC8vIFNpbXVsYXRlIFVSTCB1cGRhdGVcbiAgICAgIHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSh7fSwgJycsIGA/YnVpbGRpbmc9JHtidWlsZGluZ0lkfWApO1xuICAgIH07XG5cbiAgICBjb25zdCBoYW5kbGVCYWNrID0gKCkgPT4ge1xuICAgICAgc2V0Q3VycmVudEJ1aWxkaW5nSWQobnVsbCk7XG4gICAgICBzZXRTaG93QnVpbGRpbmdzKHRydWUpO1xuICAgICAgd2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKHt9LCAnJywgJy9yZXNpZGVudHMvYnVpbGRpbmcnKTtcbiAgICAgIG1vY2tTZXRMb2NhdGlvbignL3Jlc2lkZW50cy9idWlsZGluZycpO1xuICAgIH07XG5cbiAgICBpZiAoc2hvd0J1aWxkaW5ncykge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImhpZXJhcmNoaWNhbC1zZWxlY3Rpb25cIj5cbiAgICAgICAgICA8TW9ja1NlbGVjdGlvbkdyaWRcbiAgICAgICAgICAgIHRpdGxlPVwiU2VsZWN0IEJ1aWxkaW5nXCJcbiAgICAgICAgICAgIGl0ZW1zPXttb2NrQnVpbGRpbmdzfVxuICAgICAgICAgICAgb25TZWxlY3RJdGVtPXtoYW5kbGVCdWlsZGluZ1NlbGVjdH1cbiAgICAgICAgICAgIGlzTG9hZGluZz17ZmFsc2V9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIERldGVybWluZSBpZiBzaG91bGQgc2hvdyBiYWNrIGJ1dHRvbiAobW9jayBsb2dpYylcbiAgICBjb25zdCBzaG91bGRTaG93QmFja0J1dHRvbiA9IGN1cnJlbnRCdWlsZGluZ0lkICYmIG1vY2tCdWlsZGluZ3MubGVuZ3RoID4gMTtcblxuICAgIHJldHVybiAoXG4gICAgICA8Q29tcG9uZW50XG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgICAgYnVpbGRpbmdJZD17Y3VycmVudEJ1aWxkaW5nSWR9XG4gICAgICAgIHNob3dCYWNrQnV0dG9uPXtzaG91bGRTaG93QmFja0J1dHRvbn1cbiAgICAgICAgYmFja0J1dHRvbkxhYmVsPVwiQnVpbGRpbmdcIlxuICAgICAgICBvbkJhY2s9e2hhbmRsZUJhY2t9XG4gICAgICAvPlxuICAgICk7XG4gIH07XG59O1xuXG5jb25zdCBXcmFwcGVkVGVzdENvbXBvbmVudCA9IHdpdGhIaWVyYXJjaGljYWxTZWxlY3Rpb24oVGVzdENvbXBvbmVudCwge1xuICBoaWVyYXJjaHk6IFsnYnVpbGRpbmcnXSxcbn0pO1xuXG5kZXNjcmliZSgnSGllcmFyY2hpY2FsIE5hdmlnYXRpb24gQ29tcG9uZW50cycsICgpID0+IHtcbiAgbGV0IHF1ZXJ5Q2xpZW50OiBRdWVyeUNsaWVudDtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBxdWVyeUNsaWVudCA9IG5ldyBRdWVyeUNsaWVudCh7XG4gICAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBxdWVyaWVzOiB7XG4gICAgICAgICAgcmV0cnk6IGZhbHNlLFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIFJlc2V0IG1vY2tzXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgbW9ja1NldExvY2F0aW9uLm1vY2tDbGVhcigpO1xuXG4gICAgLy8gTW9jayB3aW5kb3cuaGlzdG9yeS5wdXNoU3RhdGVcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnaGlzdG9yeScsIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHB1c2hTdGF0ZTogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gUmVzZXQgVVJMXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2xvY2F0aW9uJywge1xuICAgICAgdmFsdWU6IHtcbiAgICAgICAgc2VhcmNoOiAnJyxcbiAgICAgICAgcGF0aG5hbWU6ICcvcmVzaWRlbnRzL2J1aWxkaW5nJyxcbiAgICAgIH0sXG4gICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgY29uc3QgcmVuZGVyV2l0aFByb3ZpZGVycyA9IChjb21wb25lbnQ6IFJlYWN0LlJlYWN0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiByZW5kZXIoXG4gICAgICA8UXVlcnlDbGllbnRQcm92aWRlciBjbGllbnQ9e3F1ZXJ5Q2xpZW50fT5cbiAgICAgICAge2NvbXBvbmVudH1cbiAgICAgIDwvUXVlcnlDbGllbnRQcm92aWRlcj5cbiAgICApO1xuICB9O1xuXG4gIGRlc2NyaWJlKCdCdWlsZGluZyBTZWxlY3Rpb24gU2NyZWVuJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZW5kZXIgYnVpbGRpbmcgc2VsZWN0aW9uIHdoZW4gbm8gYnVpbGRpbmcgaXMgc2VsZWN0ZWQnLCAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxXcmFwcGVkVGVzdENvbXBvbmVudCAvPik7XG5cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2hpZXJhcmNoaWNhbC1zZWxlY3Rpb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NlbGVjdGlvbi1ncmlkJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3Rpb24tdGl0bGUnKSkudG9IYXZlVGV4dENvbnRlbnQoJ1NlbGVjdCBCdWlsZGluZycpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgc2hvdyBidWlsZGluZyBvcHRpb25zXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdpdGVtLWJ1aWxkaW5nLTEnKSkudG9IYXZlVGV4dENvbnRlbnQoJ0J1aWxkaW5nIEEnKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2l0ZW0tYnVpbGRpbmctMicpKS50b0hhdmVUZXh0Q29udGVudCgnQnVpbGRpbmcgQicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBidWlsZGluZyBzZWxlY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxXcmFwcGVkVGVzdENvbXBvbmVudCAvPik7XG5cbiAgICAgIGNvbnN0IGJ1aWxkaW5nQUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnaXRlbS1idWlsZGluZy0xJyk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2soYnVpbGRpbmdBQnV0dG9uKTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3Rlc3QtY29tcG9uZW50JykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWRldGFpbHMnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctaWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ2J1aWxkaW5nLTEnKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgdXBkYXRlIFVSTFxuICAgICAgZXhwZWN0KHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe30sICcnLCAnP2J1aWxkaW5nPWJ1aWxkaW5nLTEnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBub3Qgc2hvdyBsb2FkaW5nIHNwaW5uZXIgd2hlbiBub3QgbG9hZGluZycsICgpID0+IHtcbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5xdWVyeUJ5VGVzdElkKCdsb2FkaW5nLXNwaW5uZXInKSkubm90LnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCdWlsZGluZyBEZXRhaWxzIFNjcmVlbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcmVuZGVyIGJ1aWxkaW5nIGRldGFpbHMgd2hlbiBidWlsZGluZyBpcyBzZWxlY3RlZCcsICgpID0+IHtcbiAgICAgIC8vIE1vY2sgVVJMIHdpdGggYnVpbGRpbmcgcGFyYW1ldGVyXG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYXRpb24nLCB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc2VhcmNoOiAnP2J1aWxkaW5nPWJ1aWxkaW5nLTEnLFxuICAgICAgICAgIHBhdGhuYW1lOiAnL3Jlc2lkZW50cy9idWlsZGluZycsXG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgndGVzdC1jb21wb25lbnQnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWRldGFpbHMnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWlkJykpLnRvSGF2ZVRleHRDb250ZW50KCdidWlsZGluZy0xJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgc2hvdyBiYWNrIGJ1dHRvbiB3aGVuIGJ1aWxkaW5nIGlzIHNlbGVjdGVkIGFuZCBtdWx0aXBsZSBidWlsZGluZ3MgZXhpc3QnLCAoKSA9PiB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYXRpb24nLCB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc2VhcmNoOiAnP2J1aWxkaW5nPWJ1aWxkaW5nLTEnLFxuICAgICAgICAgIHBhdGhuYW1lOiAnL3Jlc2lkZW50cy9idWlsZGluZycsXG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYmFjay1idXR0b24tY29udGFpbmVyJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tYmFjaycpKS50b0hhdmVUZXh0Q29udGVudCgnQnVpbGRpbmcnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYmFjayBidXR0b24gY2xpY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYXRpb24nLCB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc2VhcmNoOiAnP2J1aWxkaW5nPWJ1aWxkaW5nLTEnLFxuICAgICAgICAgIHBhdGhuYW1lOiAnL3Jlc2lkZW50cy9idWlsZGluZycsXG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgY29uc3QgYmFja0J1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLWJhY2snKTtcbiAgICAgIGZpcmVFdmVudC5jbGljayhiYWNrQnV0dG9uKTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2hpZXJhcmNoaWNhbC1zZWxlY3Rpb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0aW9uLWdyaWQnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgdXBkYXRlIFVSTCBhbmQgcm91dGVyXG4gICAgICBleHBlY3Qod2luZG93Lmhpc3RvcnkucHVzaFN0YXRlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7fSwgJycsICcvcmVzaWRlbnRzL2J1aWxkaW5nJyk7XG4gICAgICBleHBlY3QobW9ja1NldExvY2F0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3Jlc2lkZW50cy9idWlsZGluZycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnU21hcnQgQmFjayBCdXR0b24gTG9naWMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIG5vdCBzaG93IGJhY2sgYnV0dG9uIHdoZW4gb25seSBvbmUgYnVpbGRpbmcgZXhpc3RzJywgKCkgPT4ge1xuICAgICAgLy8gTW9jayBvbmx5IG9uZSBidWlsZGluZ1xuICAgICAgY29uc3QgU2luZ2xlQnVpbGRpbmdDb21wb25lbnQgPSB3aXRoSGllcmFyY2hpY2FsU2VsZWN0aW9uKFRlc3RDb21wb25lbnQsIHtcbiAgICAgICAgaGllcmFyY2h5OiBbJ2J1aWxkaW5nJ10sXG4gICAgICB9KTtcblxuICAgICAgLy8gT3ZlcnJpZGUgdGhlIGNvbXBvbmVudCB0byBzaW11bGF0ZSBzaW5nbGUgYnVpbGRpbmcgc2NlbmFyaW9cbiAgICAgIGNvbnN0IFNpbmdsZUJ1aWxkaW5nVGVzdENvbXBvbmVudCA9IChwcm9wczogYW55KSA9PiB7XG4gICAgICAgIGNvbnN0IFtjdXJyZW50QnVpbGRpbmdJZCwgc2V0Q3VycmVudEJ1aWxkaW5nSWRdID0gUmVhY3QudXNlU3RhdGUoJ2J1aWxkaW5nLTEnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIE1vY2sgc2luZ2xlIGJ1aWxkaW5nIHNjZW5hcmlvIC0gc2hvdWxkIG5vdCBzaG93IGJhY2sgYnV0dG9uXG4gICAgICAgIGNvbnN0IHNob3VsZFNob3dCYWNrQnV0dG9uID0gZmFsc2U7IC8vIFNpbmdsZSBidWlsZGluZyA9IG5vIGJhY2sgYnV0dG9uXG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8VGVzdENvbXBvbmVudFxuICAgICAgICAgICAgey4uLnByb3BzfVxuICAgICAgICAgICAgYnVpbGRpbmdJZD17Y3VycmVudEJ1aWxkaW5nSWR9XG4gICAgICAgICAgICBzaG93QmFja0J1dHRvbj17c2hvdWxkU2hvd0JhY2tCdXR0b259XG4gICAgICAgICAgICBiYWNrQnV0dG9uTGFiZWw9XCJCdWlsZGluZ1wiXG4gICAgICAgICAgICBvbkJhY2s9eygpID0+IHt9fVxuICAgICAgICAgIC8+XG4gICAgICAgICk7XG4gICAgICB9O1xuXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxTaW5nbGVCdWlsZGluZ1Rlc3RDb21wb25lbnQgLz4pO1xuXG4gICAgICBleHBlY3Qoc2NyZWVuLnF1ZXJ5QnlUZXN0SWQoJ2JhY2stYnV0dG9uLWNvbnRhaW5lcicpKS5ub3QudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4ucXVlcnlCeVRlc3RJZCgnYnV0dG9uLWJhY2snKSkubm90LnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgc2hvdyBiYWNrIGJ1dHRvbiB3aGVuIG11bHRpcGxlIGJ1aWxkaW5ncyBleGlzdCcsICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhdGlvbicsIHtcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICBzZWFyY2g6ICc/YnVpbGRpbmc9YnVpbGRpbmctMScsXG4gICAgICAgICAgcGF0aG5hbWU6ICcvcmVzaWRlbnRzL2J1aWxkaW5nJyxcbiAgICAgICAgfSxcbiAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8V3JhcHBlZFRlc3RDb21wb25lbnQgLz4pO1xuXG4gICAgICAvLyBTaG91bGQgc2hvdyBiYWNrIGJ1dHRvbiBiZWNhdXNlIG1vY2sgaGFzIDIgYnVpbGRpbmdzXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdiYWNrLWJ1dHRvbi1jb250YWluZXInKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1dHRvbi1iYWNrJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdVUkwgTmF2aWdhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcGFyc2UgYnVpbGRpbmcgSUQgZnJvbSBVUkwgcGFyYW1ldGVycycsICgpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhdGlvbicsIHtcbiAgICAgICAgdmFsdWU6IHtcbiAgICAgICAgICBzZWFyY2g6ICc/YnVpbGRpbmc9dGVzdC1idWlsZGluZy0xMjMnLFxuICAgICAgICAgIHBhdGhuYW1lOiAnL3Jlc2lkZW50cy9idWlsZGluZycsXG4gICAgICAgIH0sXG4gICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctZGV0YWlscycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctaWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ3Rlc3QtYnVpbGRpbmctMTIzJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgc2hvdyBzZWxlY3Rpb24gc2NyZWVuIHdoZW4gbm8gVVJMIHBhcmFtZXRlcnMnLCAoKSA9PiB7XG4gICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYXRpb24nLCB7XG4gICAgICAgIHZhbHVlOiB7XG4gICAgICAgICAgc2VhcmNoOiAnJyxcbiAgICAgICAgICBwYXRobmFtZTogJy9yZXNpZGVudHMvYnVpbGRpbmcnLFxuICAgICAgICB9LFxuICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxXcmFwcGVkVGVzdENvbXBvbmVudCAvPik7XG5cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2hpZXJhcmNoaWNhbC1zZWxlY3Rpb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NlbGVjdGlvbi1ncmlkJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIFVSTCB1cGRhdGVzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPFdyYXBwZWRUZXN0Q29tcG9uZW50IC8+KTtcblxuICAgICAgLy8gU3RhcnQgd2l0aCBzZWxlY3Rpb24gc2NyZWVuXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdoaWVyYXJjaGljYWwtc2VsZWN0aW9uJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAgIC8vIFNlbGVjdCBhIGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZ0J1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnaXRlbS1idWlsZGluZy0yJyk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2soYnVpbGRpbmdCdXR0b24pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe30sICcnLCAnP2J1aWxkaW5nPWJ1aWxkaW5nLTInKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBHbyBiYWNrXG4gICAgICBjb25zdCBiYWNrQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tYmFjaycpO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKGJhY2tCdXR0b24pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHdpbmRvdy5oaXN0b3J5LnB1c2hTdGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe30sICcnLCAnL3Jlc2lkZW50cy9idWlsZGluZycpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9