70efd3fca21bc4649847b2f1db9a49dc
"use strict";
/**
 * Document utility functions and constants.
 * Consolidates document-related functionality across the application.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.documentApi = exports.GENERAL_DOCUMENT_CATEGORIES = exports.RESIDENCE_DOCUMENT_CATEGORIES = exports.BUILDING_DOCUMENT_CATEGORIES = void 0;
exports.getDisplayableFileUrl = getDisplayableFileUrl;
exports.createUploadHandler = createUploadHandler;
exports.getCategoryLabel = getCategoryLabel;
const queryClient_1 = require("@/lib/queryClient");
/**
 * Document categories for building documents.
 */
exports.BUILDING_DOCUMENT_CATEGORIES = [
    { _value: 'bylaw', label: 'Bylaws' },
    { _value: 'financial', label: 'Financial' },
    { _value: 'maintenance', label: 'Maintenance' },
    { _value: 'legal', label: 'Legal' },
    { _value: 'meeting_minutes', label: 'Meeting Minutes' },
    { _value: 'insurance', label: 'Insurance' },
    { _value: 'contracts', label: 'Contracts' },
    { _value: 'permits', label: 'Permits' },
    { _value: 'inspection', label: 'Inspection' },
    { _value: 'other', label: 'Other' },
];
/**
 * Document categories for residence documents.
 */
exports.RESIDENCE_DOCUMENT_CATEGORIES = [
    { _value: 'lease', label: 'Lease Documents' },
    { _value: 'inspection', label: 'Inspections' },
    { _value: 'maintenance', label: 'Maintenance' },
    { _value: 'financial', label: 'Financial' },
    { _value: 'insurance', label: 'Insurance' },
    { _value: 'legal', label: 'Legal' },
    { _value: 'correspondence', label: 'Correspondence' },
    { _value: 'permits', label: 'Permits' },
    { _value: 'utilities', label: 'Utilities' },
    { _value: 'other', label: 'Other' },
];
/**
 * General document categories for resident use.
 */
exports.GENERAL_DOCUMENT_CATEGORIES = [
    { _value: 'lease', label: 'Lease Agreement' },
    { _value: 'insurance', label: 'Insurance' },
    { _value: 'inspection', label: 'Inspections' },
    { _value: 'maintenance', label: 'Maintenance' },
    { _value: 'financial', label: 'Financial' },
    { _value: 'legal', label: 'Legal Documents' },
    { _value: 'correspondence', label: 'Correspondence' },
    { _value: 'utilities', label: 'Utilities' },
    { _value: 'other', label: 'Other' },
];
/**
 * Utility function to convert raw object storage URLs to server routes.
 * @param fileUrl - The file URL to convert.
 * @returns The displayable file URL.
 */
/**
 * Get displayable file url.
 * @param fileUrl - FileUrl parameter.
 * @returns String result.
 */
function getDisplayableFileUrl(fileUrl) {
    /**
     * If function.
     * @param !fileUrl - !fileUrl parameter.
     */ /**
    * If function.
    * @param !fileUrl - !fileUrl parameter.
    */
    if (!fileUrl) {
        return '';
    }
    // If it's already a proper server route, return as-is
    if (fileUrl.startsWith('/objects/') || fileUrl.startsWith('/public-objects/')) {
        return fileUrl;
    }
    // If it starts with /objects/, use as-is
    if (fileUrl.startsWith('/objects/')) {
        return fileUrl;
    }
    // For other formats, try to use as objects route
    return `/objects/${fileUrl.replace(/^\/+/, '')}`;
}
/**
 * Document API operations.
 */
exports.documentApi = {
    /**
     * Create a new document.
     * @param data - Document data to create.
     * @param _data
     * @returns Promise with the created document.
     */
    create: (_data) => {
        return (0, queryClient_1.apiRequest)('POST', '/api/documents', _data);
    },
    /**
     * Update an existing document.
     * @param id - Document ID to update.
     * @param data - Updated document data.
     * @param _data
     * @returns Promise with the updated document.
     */
    update: (id, _data) => {
        return (0, queryClient_1.apiRequest)('PUT', `/api/documents/${id}`, _data);
    },
    /**
     * Delete a document.
     * @param id - Document ID to delete.
     * @returns Promise with deletion confirmation.
     */
    delete: (id) => {
        return (0, queryClient_1.apiRequest)('DELETE', `/api/documents/${id}`);
    },
    /**
     * Upload a file for a document.
     * @param id - Document ID.
     * @param fileData - File data to upload.
     * @returns Promise with upload result.
     */
    upload: (id, fileData) => {
        return (0, queryClient_1.apiRequest)('POST', `/api/documents/${id}/upload`, fileData);
    },
};
/**
 * Common upload handler factory.
 * @param documentId - The document ID.
 * @param onSuccess - Success callback.
 * @param onError - Error callback.
 * @returns Upload handler function.
 */
function createUploadHandler(documentId, onSuccess, onError) {
    return (_result) => {
        try {
            /**
             * If function.
             * @param result.successful && result.successful.length > 0 - result.successful && result.successful.length > 0 parameter.
             */ /**
            * If function.
            * @param result.successful && result.successful.length > 0 - result.successful && result.successful.length > 0 parameter.
            */
            if (_result.successful && _result.successful.length > 0) {
                onSuccess?.();
            }
            else if (_result.failed && _result.failed.length > 0) {
                const error = new Error(`Upload failed: ${_result.failed[0].error}`);
                onError?.(error);
            }
        }
        catch (error) {
            onError?.(error);
        }
    };
}
/**
 * Get category label by value.
 * @param categories - Array of category objects.
 * @param value - Category value to find.
 * @returns Category label or the original value.
 */
/**
 * Get category label.
 * @param categories - Categories parameter.
 * @param value - Value to process.
 * @param _value
 * @returns String result.
 */
function getCategoryLabel(categories, _value) {
    return categories.find((cat) => cat._value === _value)?.label || _value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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aG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvbGliL2RvY3VtZW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERvY3VtZW50IHV0aWxpdHkgZnVuY3Rpb25zIGFuZCBjb25zdGFudHMuXG4gKiBDb25zb2xpZGF0ZXMgZG9jdW1lbnQtcmVsYXRlZCBmdW5jdGlvbmFsaXR5IGFjcm9zcyB0aGUgYXBwbGljYXRpb24uXG4gKi9cblxuaW1wb3J0IHsgYXBpUmVxdWVzdCB9IGZyb20gJ0AvbGliL3F1ZXJ5Q2xpZW50JztcbmltcG9ydCB0eXBlIHsgVXBsb2FkUmVzdWx0IH0gZnJvbSAnQHVwcHkvY29yZSc7XG5cbi8qKlxuICogRG9jdW1lbnQgY2F0ZWdvcmllcyBmb3IgYnVpbGRpbmcgZG9jdW1lbnRzLlxuICovXG5leHBvcnQgY29uc3QgQlVJTERJTkdfRE9DVU1FTlRfQ0FURUdPUklFUyA9IFtcbiAgeyBfdmFsdWU6ICdieWxhdycsIGxhYmVsOiAnQnlsYXdzJyB9LFxuICB7IF92YWx1ZTogJ2ZpbmFuY2lhbCcsIGxhYmVsOiAnRmluYW5jaWFsJyB9LFxuICB7IF92YWx1ZTogJ21haW50ZW5hbmNlJywgbGFiZWw6ICdNYWludGVuYW5jZScgfSxcbiAgeyBfdmFsdWU6ICdsZWdhbCcsIGxhYmVsOiAnTGVnYWwnIH0sXG4gIHsgX3ZhbHVlOiAnbWVldGluZ19taW51dGVzJywgbGFiZWw6ICdNZWV0aW5nIE1pbnV0ZXMnIH0sXG4gIHsgX3ZhbHVlOiAnaW5zdXJhbmNlJywgbGFiZWw6ICdJbnN1cmFuY2UnIH0sXG4gIHsgX3ZhbHVlOiAnY29udHJhY3RzJywgbGFiZWw6ICdDb250cmFjdHMnIH0sXG4gIHsgX3ZhbHVlOiAncGVybWl0cycsIGxhYmVsOiAnUGVybWl0cycgfSxcbiAgeyBfdmFsdWU6ICdpbnNwZWN0aW9uJywgbGFiZWw6ICdJbnNwZWN0aW9uJyB9LFxuICB7IF92YWx1ZTogJ290aGVyJywgbGFiZWw6ICdPdGhlcicgfSxcbl0gYXMgY29uc3Q7XG5cbi8qKlxuICogRG9jdW1lbnQgY2F0ZWdvcmllcyBmb3IgcmVzaWRlbmNlIGRvY3VtZW50cy5cbiAqL1xuZXhwb3J0IGNvbnN0IFJFU0lERU5DRV9ET0NVTUVOVF9DQVRFR09SSUVTID0gW1xuICB7IF92YWx1ZTogJ2xlYXNlJywgbGFiZWw6ICdMZWFzZSBEb2N1bWVudHMnIH0sXG4gIHsgX3ZhbHVlOiAnaW5zcGVjdGlvbicsIGxhYmVsOiAnSW5zcGVjdGlvbnMnIH0sXG4gIHsgX3ZhbHVlOiAnbWFpbnRlbmFuY2UnLCBsYWJlbDogJ01haW50ZW5hbmNlJyB9LFxuICB7IF92YWx1ZTogJ2ZpbmFuY2lhbCcsIGxhYmVsOiAnRmluYW5jaWFsJyB9LFxuICB7IF92YWx1ZTogJ2luc3VyYW5jZScsIGxhYmVsOiAnSW5zdXJhbmNlJyB9LFxuICB7IF92YWx1ZTogJ2xlZ2FsJywgbGFiZWw6ICdMZWdhbCcgfSxcbiAgeyBfdmFsdWU6ICdjb3JyZXNwb25kZW5jZScsIGxhYmVsOiAnQ29ycmVzcG9uZGVuY2UnIH0sXG4gIHsgX3ZhbHVlOiAncGVybWl0cycsIGxhYmVsOiAnUGVybWl0cycgfSxcbiAgeyBfdmFsdWU6ICd1dGlsaXRpZXMnLCBsYWJlbDogJ1V0aWxpdGllcycgfSxcbiAgeyBfdmFsdWU6ICdvdGhlcicsIGxhYmVsOiAnT3RoZXInIH0sXG5dIGFzIGNvbnN0O1xuXG4vKipcbiAqIEdlbmVyYWwgZG9jdW1lbnQgY2F0ZWdvcmllcyBmb3IgcmVzaWRlbnQgdXNlLlxuICovXG5leHBvcnQgY29uc3QgR0VORVJBTF9ET0NVTUVOVF9DQVRFR09SSUVTID0gW1xuICB7IF92YWx1ZTogJ2xlYXNlJywgbGFiZWw6ICdMZWFzZSBBZ3JlZW1lbnQnIH0sXG4gIHsgX3ZhbHVlOiAnaW5zdXJhbmNlJywgbGFiZWw6ICdJbnN1cmFuY2UnIH0sXG4gIHsgX3ZhbHVlOiAnaW5zcGVjdGlvbicsIGxhYmVsOiAnSW5zcGVjdGlvbnMnIH0sXG4gIHsgX3ZhbHVlOiAnbWFpbnRlbmFuY2UnLCBsYWJlbDogJ01haW50ZW5hbmNlJyB9LFxuICB7IF92YWx1ZTogJ2ZpbmFuY2lhbCcsIGxhYmVsOiAnRmluYW5jaWFsJyB9LFxuICB7IF92YWx1ZTogJ2xlZ2FsJywgbGFiZWw6ICdMZWdhbCBEb2N1bWVudHMnIH0sXG4gIHsgX3ZhbHVlOiAnY29ycmVzcG9uZGVuY2UnLCBsYWJlbDogJ0NvcnJlc3BvbmRlbmNlJyB9LFxuICB7IF92YWx1ZTogJ3V0aWxpdGllcycsIGxhYmVsOiAnVXRpbGl0aWVzJyB9LFxuICB7IF92YWx1ZTogJ290aGVyJywgbGFiZWw6ICdPdGhlcicgfSxcbl0gYXMgY29uc3Q7XG5cbi8qKlxuICogVXRpbGl0eSBmdW5jdGlvbiB0byBjb252ZXJ0IHJhdyBvYmplY3Qgc3RvcmFnZSBVUkxzIHRvIHNlcnZlciByb3V0ZXMuXG4gKiBAcGFyYW0gZmlsZVVybCAtIFRoZSBmaWxlIFVSTCB0byBjb252ZXJ0LlxuICogQHJldHVybnMgVGhlIGRpc3BsYXlhYmxlIGZpbGUgVVJMLlxuICovXG4vKipcbiAqIEdldCBkaXNwbGF5YWJsZSBmaWxlIHVybC5cbiAqIEBwYXJhbSBmaWxlVXJsIC0gRmlsZVVybCBwYXJhbWV0ZXIuXG4gKiBAcmV0dXJucyBTdHJpbmcgcmVzdWx0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gLyoqXG4gKiBHZXQgZGlzcGxheWFibGUgZmlsZSB1cmwuXG4gKiBAcGFyYW0gZmlsZVVybCAtIEZpbGVVcmwgcGFyYW1ldGVyLlxuICogQHJldHVybnMgU3RyaW5nIHJlc3VsdC5cbiAqLyAvKipcbiAqIEdldCBkaXNwbGF5YWJsZSBmaWxlIHVybC5cbiAqIEBwYXJhbSBmaWxlVXJsIC0gRmlsZVVybCBwYXJhbWV0ZXIuXG4gKiBAcmV0dXJucyBTdHJpbmcgcmVzdWx0LlxuICovXG5cbmdldERpc3BsYXlhYmxlRmlsZVVybChmaWxlVXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuICAvKipcbiAgICogSWYgZnVuY3Rpb24uXG4gICAqIEBwYXJhbSAhZmlsZVVybCAtICFmaWxlVXJsIHBhcmFtZXRlci5cbiAgICovIC8qKlxuICAgKiBJZiBmdW5jdGlvbi5cbiAgICogQHBhcmFtICFmaWxlVXJsIC0gIWZpbGVVcmwgcGFyYW1ldGVyLlxuICAgKi9cblxuICBpZiAoIWZpbGVVcmwpIHtcbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICAvLyBJZiBpdCdzIGFscmVhZHkgYSBwcm9wZXIgc2VydmVyIHJvdXRlLCByZXR1cm4gYXMtaXNcbiAgaWYgKGZpbGVVcmwuc3RhcnRzV2l0aCgnL29iamVjdHMvJykgfHwgZmlsZVVybC5zdGFydHNXaXRoKCcvcHVibGljLW9iamVjdHMvJykpIHtcbiAgICByZXR1cm4gZmlsZVVybDtcbiAgfVxuXG4gIC8vIElmIGl0IHN0YXJ0cyB3aXRoIC9vYmplY3RzLywgdXNlIGFzLWlzXG4gIGlmIChmaWxlVXJsLnN0YXJ0c1dpdGgoJy9vYmplY3RzLycpKSB7XG4gICAgcmV0dXJuIGZpbGVVcmw7XG4gIH1cblxuICAvLyBGb3Igb3RoZXIgZm9ybWF0cywgdHJ5IHRvIHVzZSBhcyBvYmplY3RzIHJvdXRlXG4gIHJldHVybiBgL29iamVjdHMvJHtmaWxlVXJsLnJlcGxhY2UoL15cXC8rLywgJycpfWA7XG59XG5cbi8qKlxuICogRG9jdW1lbnQgQVBJIG9wZXJhdGlvbnMuXG4gKi9cbmV4cG9ydCBjb25zdCBkb2N1bWVudEFwaSA9IHtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBkb2N1bWVudC5cbiAgICogQHBhcmFtIGRhdGEgLSBEb2N1bWVudCBkYXRhIHRvIGNyZWF0ZS5cbiAgICogQHBhcmFtIF9kYXRhXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCB0aGUgY3JlYXRlZCBkb2N1bWVudC5cbiAgICovXG4gIGNyZWF0ZTogKF9kYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4ge1xuICAgIHJldHVybiBhcGlSZXF1ZXN0KCdQT1NUJywgJy9hcGkvZG9jdW1lbnRzJywgX2RhdGEpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYW4gZXhpc3RpbmcgZG9jdW1lbnQuXG4gICAqIEBwYXJhbSBpZCAtIERvY3VtZW50IElEIHRvIHVwZGF0ZS5cbiAgICogQHBhcmFtIGRhdGEgLSBVcGRhdGVkIGRvY3VtZW50IGRhdGEuXG4gICAqIEBwYXJhbSBfZGF0YVxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggdGhlIHVwZGF0ZWQgZG9jdW1lbnQuXG4gICAqL1xuICB1cGRhdGU6IChpZDogc3RyaW5nLCBfZGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pID0+IHtcbiAgICByZXR1cm4gYXBpUmVxdWVzdCgnUFVUJywgYC9hcGkvZG9jdW1lbnRzLyR7aWR9YCwgX2RhdGEpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBEZWxldGUgYSBkb2N1bWVudC5cbiAgICogQHBhcmFtIGlkIC0gRG9jdW1lbnQgSUQgdG8gZGVsZXRlLlxuICAgKiBAcmV0dXJucyBQcm9taXNlIHdpdGggZGVsZXRpb24gY29uZmlybWF0aW9uLlxuICAgKi9cbiAgZGVsZXRlOiAoaWQ6IHN0cmluZykgPT4ge1xuICAgIHJldHVybiBhcGlSZXF1ZXN0KCdERUxFVEUnLCBgL2FwaS9kb2N1bWVudHMvJHtpZH1gKTtcbiAgfSxcblxuICAvKipcbiAgICogVXBsb2FkIGEgZmlsZSBmb3IgYSBkb2N1bWVudC5cbiAgICogQHBhcmFtIGlkIC0gRG9jdW1lbnQgSUQuXG4gICAqIEBwYXJhbSBmaWxlRGF0YSAtIEZpbGUgZGF0YSB0byB1cGxvYWQuXG4gICAqIEByZXR1cm5zIFByb21pc2Ugd2l0aCB1cGxvYWQgcmVzdWx0LlxuICAgKi9cbiAgdXBsb2FkOiAoaWQ6IHN0cmluZywgZmlsZURhdGE6IEZvcm1EYXRhKSA9PiB7XG4gICAgcmV0dXJuIGFwaVJlcXVlc3QoJ1BPU1QnLCBgL2FwaS9kb2N1bWVudHMvJHtpZH0vdXBsb2FkYCwgZmlsZURhdGEpO1xuICB9LFxufTtcblxuLyoqXG4gKiBDb21tb24gdXBsb2FkIGhhbmRsZXIgZmFjdG9yeS5cbiAqIEBwYXJhbSBkb2N1bWVudElkIC0gVGhlIGRvY3VtZW50IElELlxuICogQHBhcmFtIG9uU3VjY2VzcyAtIFN1Y2Nlc3MgY2FsbGJhY2suXG4gKiBAcGFyYW0gb25FcnJvciAtIEVycm9yIGNhbGxiYWNrLlxuICogQHJldHVybnMgVXBsb2FkIGhhbmRsZXIgZnVuY3Rpb24uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVVcGxvYWRIYW5kbGVyKFxuICBkb2N1bWVudElkOiBzdHJpbmcsXG4gIG9uU3VjY2Vzcz86ICgpID0+IHZvaWQsXG4gIG9uRXJyb3I/OiAoX2Vycm9yOiBFcnJvcikgPT4gdm9pZFxuKSB7XG4gIHJldHVybiAoX3Jlc3VsdDogVXBsb2FkUmVzdWx0PFJlY29yZDxzdHJpbmcsIHVua25vd24+LCBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4pID0+IHtcbiAgICB0cnkge1xuICAgICAgLyoqXG4gICAgICAgKiBJZiBmdW5jdGlvbi5cbiAgICAgICAqIEBwYXJhbSByZXN1bHQuc3VjY2Vzc2Z1bCAmJiByZXN1bHQuc3VjY2Vzc2Z1bC5sZW5ndGggPiAwIC0gcmVzdWx0LnN1Y2Nlc3NmdWwgJiYgcmVzdWx0LnN1Y2Nlc3NmdWwubGVuZ3RoID4gMCBwYXJhbWV0ZXIuXG4gICAgICAgKi8gLyoqXG4gICAgICAgKiBJZiBmdW5jdGlvbi5cbiAgICAgICAqIEBwYXJhbSByZXN1bHQuc3VjY2Vzc2Z1bCAmJiByZXN1bHQuc3VjY2Vzc2Z1bC5sZW5ndGggPiAwIC0gcmVzdWx0LnN1Y2Nlc3NmdWwgJiYgcmVzdWx0LnN1Y2Nlc3NmdWwubGVuZ3RoID4gMCBwYXJhbWV0ZXIuXG4gICAgICAgKi9cblxuICAgICAgaWYgKF9yZXN1bHQuc3VjY2Vzc2Z1bCAmJiBfcmVzdWx0LnN1Y2Nlc3NmdWwubGVuZ3RoID4gMCkge1xuICAgICAgICBvblN1Y2Nlc3M/LigpO1xuICAgICAgfSBlbHNlIGlmIChfcmVzdWx0LmZhaWxlZCAmJiBfcmVzdWx0LmZhaWxlZC5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGVycm9yID0gbmV3IEVycm9yKGBVcGxvYWQgZmFpbGVkOiAke19yZXN1bHQuZmFpbGVkWzBdLmVycm9yfWApO1xuICAgICAgICBvbkVycm9yPy4oZXJyb3IpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBvbkVycm9yPy4oZXJyb3IgYXMgRXJyb3IpO1xuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKiBHZXQgY2F0ZWdvcnkgbGFiZWwgYnkgdmFsdWUuXG4gKiBAcGFyYW0gY2F0ZWdvcmllcyAtIEFycmF5IG9mIGNhdGVnb3J5IG9iamVjdHMuXG4gKiBAcGFyYW0gdmFsdWUgLSBDYXRlZ29yeSB2YWx1ZSB0byBmaW5kLlxuICogQHJldHVybnMgQ2F0ZWdvcnkgbGFiZWwgb3IgdGhlIG9yaWdpbmFsIHZhbHVlLlxuICovXG4vKipcbiAqIEdldCBjYXRlZ29yeSBsYWJlbC5cbiAqIEBwYXJhbSBjYXRlZ29yaWVzIC0gQ2F0ZWdvcmllcyBwYXJhbWV0ZXIuXG4gKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byBwcm9jZXNzLlxuICogQHBhcmFtIF92YWx1ZVxuICogQHJldHVybnMgU3RyaW5nIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIC8qKlxuICogR2V0IGNhdGVnb3J5IGxhYmVsLlxuICogQHBhcmFtIGNhdGVnb3JpZXMgLSBDYXRlZ29yaWVzIHBhcmFtZXRlci5cbiAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIHRvIHByb2Nlc3MuXG4gKiBAcmV0dXJucyBTdHJpbmcgcmVzdWx0LlxuICovIC8qKlxuICogR2V0IGNhdGVnb3J5IGxhYmVsLlxuICogQHBhcmFtIGNhdGVnb3JpZXMgLSBDYXRlZ29yaWVzIHBhcmFtZXRlci5cbiAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIHRvIHByb2Nlc3MuXG4gKiBAcmV0dXJucyBTdHJpbmcgcmVzdWx0LlxuICovXG5cbmdldENhdGVnb3J5TGFiZWwoY2F0ZWdvcmllczogcmVhZG9ubHkgeyBfdmFsdWU6IHN0cmluZzsgbGFiZWw6IHN0cmluZyB9W10sIF92YWx1ZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgcmV0dXJuIGNhdGVnb3JpZXMuZmluZCgoY2F0KSA9PiBjYXQuX3ZhbHVlID09PSBfdmFsdWUpPy5sYWJlbCB8fCBfdmFsdWU7XG59XG4iXSwidmVyc2lvbiI6M30=