a821fbfc77dd45c42a37e621b340d45b
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
/**
 * Comprehensive page accessibility testing suite
 * Tests all pages for accessibility compliance and proper functionality
 */
const react_1 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
const memory_location_1 = require("wouter/memory-location");
const use_auth_1 = require("@/hooks/use-auth");
const use_language_1 = require("@/hooks/use-language");
require("@testing-library/jest-dom");
// Mock fetch for API calls
global.fetch = jest.fn();
// Test providers wrapper
const TestWrapper = ({ children, mockUser = null, initialRoute = '/' }) => {
    const queryClient = new react_query_1.QueryClient({
        defaultOptions: {
            queries: {
                retry: false,
                gcTime: 0,
            },
        },
    });
    const mockFetch = global.fetch;
    // Mock auth response
    if (mockUser) {
        mockFetch.mockImplementation((url) => {
            if (url === '/api/auth/user') {
                return Promise.resolve({
                    ok: true,
                    status: 200,
                    json: () => Promise.resolve(mockUser),
                });
            }
            // Mock other API endpoints
            if (url === '/api/buildings') {
                return Promise.resolve({
                    ok: true,
                    status: 200,
                    json: () => Promise.resolve([
                        { id: '1', name: 'Test Building 1', yearBuilt: 2020 },
                        { id: '2', name: 'Test Building 2', yearBuilt: 2021 }
                    ]),
                });
            }
            if (url?.toString().includes('/api/bills')) {
                return Promise.resolve({
                    ok: true,
                    status: 200,
                    json: () => Promise.resolve([]),
                });
            }
            return Promise.resolve({
                ok: true,
                status: 200,
                json: () => Promise.resolve([]),
            });
        });
    }
    else {
        mockFetch.mockResolvedValue({
            ok: false,
            status: 401,
            statusText: 'Unauthorized',
            json: () => Promise.resolve({ error: 'Unauthorized' }),
        });
    }
    return ((0, jsx_runtime_1.jsx)(react_query_1.QueryClientProvider, { client: queryClient, children: (0, jsx_runtime_1.jsx)(use_language_1.LanguageProvider, { children: (0, jsx_runtime_1.jsx)(use_auth_1.AuthProvider, { children: (0, jsx_runtime_1.jsx)(memory_location_1.MemoryRouter, { initialEntries: [initialRoute], children: children }) }) }) }));
};
// Test data for different user roles
const mockUsers = {
    admin: {
        id: '1',
        email: 'admin@test.com',
        role: 'admin',
        firstName: 'Admin',
        lastName: 'User'
    },
    manager: {
        id: '2',
        email: 'manager@test.com',
        role: 'manager',
        firstName: 'Manager',
        lastName: 'User'
    },
    resident: {
        id: '3',
        email: 'resident@test.com',
        role: 'resident',
        firstName: 'Resident',
        lastName: 'User'
    }
};
// Pages to test with their required roles
const pagesToTest = [
    // Public pages
    { path: '/', name: 'Home', role: null },
    { path: '/features', name: 'Features', role: null },
    { path: '/login', name: 'Login', role: null },
    // Protected pages
    { path: '/dashboard', name: 'Dashboard', role: 'admin' },
    { path: '/manager/bills', name: 'Manager Bills', role: 'manager' },
    { path: '/manager/buildings', name: 'Manager Buildings', role: 'manager' },
    { path: '/admin/organizations', name: 'Admin Organizations', role: 'admin' },
    { path: '/residents/dashboard', name: 'Residents Dashboard', role: 'resident' },
];
describe('Page Accessibility Tests', () => {
    beforeEach(() => {
        jest.clearAllMocks();
        jest.spyOn(console, 'error').mockImplementation(() => { });
    });
    afterEach(() => {
        jest.restoreAllMocks();
    });
    describe('Basic Page Accessibility', () => {
        it.each(pagesToTest)('$name page should have proper semantic structure', async ({ path, name, role }) => {
            const mockUser = role ? mockUsers[role] : null;
            let Component;
            try {
                let importPath = path;
                if (path === '/')
                    importPath = '/home';
                if (path.startsWith('/manager/'))
                    importPath = path.replace('/manager/', '/pages/manager/');
                if (path.startsWith('/admin/'))
                    importPath = path.replace('/admin/', '/pages/admin/');
                if (path.startsWith('/residents/'))
                    importPath = path.replace('/residents/', '/pages/residents/');
                const module = await Promise.resolve(`${`@${importPath}`}`).then(s => __importStar(require(s)));
                Component = module?.default;
            }
            catch (error) {
                // Skip if component doesn't exist or has import issues
                console.warn(`Could not import ${name} component:`, error);
                return;
            }
            if (!Component)
                return;
            (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, initialRoute: path, children: (0, jsx_runtime_1.jsx)(Component, {}) }));
            await (0, react_1.waitFor)(() => {
                // Wait for component to fully render
                expect(document.body).toBeInTheDocument();
            }, { timeout: 3000 });
            // Test 1: Page should have proper heading structure
            const headings = react_1.screen.queryAllByRole('heading');
            if (headings.length > 0) {
                expect(headings[0]).toBeInTheDocument();
                // Main heading should be h1 or h2
                const mainHeading = headings.find(h => h.tagName === 'H1' || h.tagName === 'H2');
                expect(mainHeading).toBeTruthy();
            }
            // Test 2: Interactive elements should be accessible
            const buttons = react_1.screen.queryAllByRole('button');
            buttons.forEach(button => {
                // Buttons should have accessible names
                expect(button).toHaveAttribute('type');
                expect(button.textContent || button.getAttribute('aria-label')).toBeTruthy();
            });
            // Test 3: Forms should have proper labels
            const inputs = react_1.screen.queryAllByRole('textbox');
            inputs.forEach(input => {
                const label = react_1.screen.queryByLabelText(new RegExp(input.getAttribute('name') || '', 'i'));
                if (!label) {
                    // Input should have aria-label if no associated label
                    expect(input).toHaveAttribute('aria-label');
                }
            });
            // Test 4: Links should be accessible
            const links = react_1.screen.queryAllByRole('link');
            links.forEach(link => {
                expect(link.textContent || link.getAttribute('aria-label')).toBeTruthy();
            });
        });
    });
    describe('Bills Page Specific Accessibility', () => {
        it('should render bills page without CATEGORY_LABELS error', async () => {
            const mockUser = mockUsers.manager;
            let BillsComponent;
            try {
                const module = await Promise.resolve().then(() => __importStar(require('@/pages/manager/bills')));
                BillsComponent = module?.default;
            }
            catch (error) {
                throw new Error(`Failed to import Bills component: ${error}`);
            }
            if (!BillsComponent) {
                throw new Error('Bills component not found');
            }
            const consoleSpy = jest.spyOn(console, 'error');
            (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, children: (0, jsx_runtime_1.jsx)(BillsComponent, {}) }));
            await (0, react_1.waitFor)(() => {
                // Wait for the page to load
                expect(react_1.screen.getByText(/bills/i)).toBeInTheDocument();
            }, { timeout: 5000 });
            // Should not have CATEGORY_LABELS error
            expect(consoleSpy).not.toHaveBeenCalledWith(expect.stringMatching(/ReferenceError.*CATEGORY_LABELS is not defined/));
            // Should have proper form labels
            const buildingFilter = react_1.screen.queryByLabelText(/building/i);
            if (buildingFilter) {
                expect(buildingFilter).toBeInTheDocument();
            }
            const categoryFilter = react_1.screen.queryByLabelText(/category/i);
            if (categoryFilter) {
                expect(categoryFilter).toBeInTheDocument();
            }
        });
        it('should handle keyboard navigation on bills page', async () => {
            const mockUser = mockUsers.manager;
            const BillsComponent = (await Promise.resolve().then(() => __importStar(require('@/pages/manager/bills')))).default;
            (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, children: (0, jsx_runtime_1.jsx)(BillsComponent, {}) }));
            await (0, react_1.waitFor)(() => {
                expect(react_1.screen.getByText(/bills/i)).toBeInTheDocument();
            }, { timeout: 5000 });
            // Test tab navigation
            const interactiveElements = react_1.screen.queryAllByRole('button')
                .concat(react_1.screen.queryAllByRole('combobox'))
                .concat(react_1.screen.queryAllByRole('textbox'));
            if (interactiveElements.length > 0) {
                // Focus should be manageable
                interactiveElements[0].focus();
                expect(document.activeElement).toBe(interactiveElements[0]);
                // Tab should move focus
                react_1.fireEvent.keyDown(interactiveElements[0], { key: 'Tab' });
                // Note: jsdom doesn't simulate actual tab behavior, but we can test the element is focusable
                expect(interactiveElements[0]).toBeInTheDocument();
            }
        });
    });
    describe('Language Support Accessibility', () => {
        it.each(['en', 'fr'])('should render pages properly in %s language', async (language) => {
            const mockUser = mockUsers.admin;
            // Test a few key pages in different languages
            const pagesToTestLang = [
                { path: '/dashboard', component: () => Promise.resolve().then(() => __importStar(require('@/pages/dashboard'))) },
                { path: '/manager/bills', component: () => Promise.resolve().then(() => __importStar(require('@/pages/manager/bills'))) }
            ];
            for (const { path, component } of pagesToTestLang) {
                let Component;
                try {
                    const module = await component();
                    Component = module?.default;
                }
                catch (error) {
                    continue; // Skip if component doesn't exist
                }
                if (!Component)
                    continue;
                (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, children: (0, jsx_runtime_1.jsx)(Component, {}) }));
                await (0, react_1.waitFor)(() => {
                    expect(document.body).toBeInTheDocument();
                }, { timeout: 3000 });
                // Check that text content exists (language-agnostic)
                const textElements = react_1.screen.queryAllByText(/\w+/);
                expect(textElements.length).toBeGreaterThan(0);
            }
        });
    });
    describe('Error Handling Accessibility', () => {
        it('should provide accessible error messages', async () => {
            const mockUser = mockUsers.manager;
            // Mock API error
            const mockFetch = global.fetch;
            mockFetch.mockImplementation((url) => {
                if (url === '/api/auth/user') {
                    return Promise.resolve({
                        ok: true,
                        status: 200,
                        json: () => Promise.resolve(mockUser),
                    });
                }
                // Simulate API error
                return Promise.resolve({
                    ok: false,
                    status: 500,
                    statusText: 'Internal Server Error',
                    json: () => Promise.resolve({ error: 'Server error' }),
                });
            });
            const BillsComponent = (await Promise.resolve().then(() => __importStar(require('@/pages/manager/bills')))).default;
            (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, children: (0, jsx_runtime_1.jsx)(BillsComponent, {}) }));
            await (0, react_1.waitFor)(() => {
                // Look for error messages or retry buttons
                const errorElements = react_1.screen.queryAllByText(/error|retry|failed/i);
                if (errorElements.length > 0) {
                    // Error messages should be accessible
                    errorElements.forEach(element => {
                        expect(element).toBeInTheDocument();
                    });
                }
            }, { timeout: 5000 });
        });
    });
    describe('ARIA and Screen Reader Support', () => {
        it('should have proper ARIA attributes on interactive elements', async () => {
            const mockUser = mockUsers.manager;
            const BillsComponent = (await Promise.resolve().then(() => __importStar(require('@/pages/manager/bills')))).default;
            (0, react_1.render)((0, jsx_runtime_1.jsx)(TestWrapper, { mockUser: mockUser, children: (0, jsx_runtime_1.jsx)(BillsComponent, {}) }));
            await (0, react_1.waitFor)(() => {
                expect(react_1.screen.getByText(/bills/i)).toBeInTheDocument();
            }, { timeout: 5000 });
            // Check for proper ARIA attributes
            const comboboxes = react_1.screen.queryAllByRole('combobox');
            comboboxes.forEach(combobox => {
                // Comboboxes should have proper ARIA attributes
                expect(combobox).toHaveAttribute('aria-expanded');
            });
            // Check for loading states
            const loadingElements = react_1.screen.queryAllByText(/loading|wait/i);
            loadingElements.forEach(element => {
                // Loading states should be announced to screen readers
                expect(element).toBeInTheDocument();
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9wYWdlLWFjY2Vzc2liaWxpdHkudGVzdC50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7OztHQUdHO0FBRUgsa0RBQTRFO0FBQzVFLHVEQUF5RTtBQUN6RSw0REFBc0Q7QUFDdEQsK0NBQWdEO0FBQ2hELHVEQUF3RDtBQUN4RCxxQ0FBbUM7QUFFbkMsMkJBQTJCO0FBQzNCLE1BQU0sQ0FBQyxLQUFLLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBRXpCLHlCQUF5QjtBQUN6QixNQUFNLFdBQVcsR0FBRyxDQUFDLEVBQ25CLFFBQVEsRUFDUixRQUFRLEdBQUcsSUFBSSxFQUNmLFlBQVksR0FBRyxHQUFHLEVBS25CLEVBQUUsRUFBRTtJQUNILE1BQU0sV0FBVyxHQUFHLElBQUkseUJBQVcsQ0FBQztRQUNsQyxjQUFjLEVBQUU7WUFDZCxPQUFPLEVBQUU7Z0JBQ1AsS0FBSyxFQUFFLEtBQUs7Z0JBQ1osTUFBTSxFQUFFLENBQUM7YUFDVjtTQUNGO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLEtBQTBDLENBQUM7SUFFcEUscUJBQXFCO0lBQ3JCLElBQUksUUFBUSxFQUFFLENBQUM7UUFDYixTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNuQyxJQUFJLEdBQUcsS0FBSyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUM3QixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7b0JBQ3JCLEVBQUUsRUFBRSxJQUFJO29CQUNSLE1BQU0sRUFBRSxHQUFHO29CQUNYLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztpQkFDMUIsQ0FBQyxDQUFDO1lBQ2pCLENBQUM7WUFFRCwyQkFBMkI7WUFDM0IsSUFBSSxHQUFHLEtBQUssZ0JBQWdCLEVBQUUsQ0FBQztnQkFDN0IsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO29CQUNyQixFQUFFLEVBQUUsSUFBSTtvQkFDUixNQUFNLEVBQUUsR0FBRztvQkFDWCxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQzt3QkFDMUIsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFO3dCQUNyRCxFQUFFLEVBQUUsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLGlCQUFpQixFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUU7cUJBQ3RELENBQUM7aUJBQ1MsQ0FBQyxDQUFDO1lBQ2pCLENBQUM7WUFFRCxJQUFJLEdBQUcsRUFBRSxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQztnQkFDM0MsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO29CQUNyQixFQUFFLEVBQUUsSUFBSTtvQkFDUixNQUFNLEVBQUUsR0FBRztvQkFDWCxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7aUJBQ3BCLENBQUMsQ0FBQztZQUNqQixDQUFDO1lBRUQsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO2dCQUNyQixFQUFFLEVBQUUsSUFBSTtnQkFDUixNQUFNLEVBQUUsR0FBRztnQkFDWCxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7YUFDcEIsQ0FBQyxDQUFDO1FBQ2pCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztTQUFNLENBQUM7UUFDTixTQUFTLENBQUMsaUJBQWlCLENBQUM7WUFDMUIsRUFBRSxFQUFFLEtBQUs7WUFDVCxNQUFNLEVBQUUsR0FBRztZQUNYLFVBQVUsRUFBRSxjQUFjO1lBQzFCLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDO1NBQzNDLENBQUMsQ0FBQztJQUNqQixDQUFDO0lBRUQsT0FBTyxDQUNMLHVCQUFDLGlDQUFtQixJQUFDLE1BQU0sRUFBRSxXQUFXLFlBQ3RDLHVCQUFDLCtCQUFnQixjQUNmLHVCQUFDLHVCQUFZLGNBQ1gsdUJBQUMsOEJBQVksSUFBQyxjQUFjLEVBQUUsQ0FBQyxZQUFZLENBQUMsWUFDekMsUUFBUSxHQUNJLEdBQ0YsR0FDRSxHQUNDLENBQ3ZCLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixxQ0FBcUM7QUFDckMsTUFBTSxTQUFTLEdBQUc7SUFDaEIsS0FBSyxFQUFFO1FBQ0wsRUFBRSxFQUFFLEdBQUc7UUFDUCxLQUFLLEVBQUUsZ0JBQWdCO1FBQ3ZCLElBQUksRUFBRSxPQUFPO1FBQ2IsU0FBUyxFQUFFLE9BQU87UUFDbEIsUUFBUSxFQUFFLE1BQU07S0FDakI7SUFDRCxPQUFPLEVBQUU7UUFDUCxFQUFFLEVBQUUsR0FBRztRQUNQLEtBQUssRUFBRSxrQkFBa0I7UUFDekIsSUFBSSxFQUFFLFNBQVM7UUFDZixTQUFTLEVBQUUsU0FBUztRQUNwQixRQUFRLEVBQUUsTUFBTTtLQUNqQjtJQUNELFFBQVEsRUFBRTtRQUNSLEVBQUUsRUFBRSxHQUFHO1FBQ1AsS0FBSyxFQUFFLG1CQUFtQjtRQUMxQixJQUFJLEVBQUUsVUFBVTtRQUNoQixTQUFTLEVBQUUsVUFBVTtRQUNyQixRQUFRLEVBQUUsTUFBTTtLQUNqQjtDQUNGLENBQUM7QUFFRiwwQ0FBMEM7QUFDMUMsTUFBTSxXQUFXLEdBQUc7SUFDbEIsZUFBZTtJQUNmLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUU7SUFDdkMsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtJQUNuRCxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFO0lBRTdDLGtCQUFrQjtJQUNsQixFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFO0lBQ3hELEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFLElBQUksRUFBRSxlQUFlLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRTtJQUNsRSxFQUFFLElBQUksRUFBRSxvQkFBb0IsRUFBRSxJQUFJLEVBQUUsbUJBQW1CLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRTtJQUMxRSxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRTtJQUM1RSxFQUFFLElBQUksRUFBRSxzQkFBc0IsRUFBRSxJQUFJLEVBQUUscUJBQXFCLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTtDQUNoRixDQUFDO0FBRUYsUUFBUSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtJQUN4QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFFLENBQUMsQ0FBQyxDQUFDO0lBQzVELENBQUMsQ0FBQyxDQUFDO0lBRUgsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxrREFBa0QsRUFBRSxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7WUFDdEcsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsSUFBOEIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7WUFFekUsSUFBSSxTQUFTLENBQUM7WUFDZCxJQUFJLENBQUM7Z0JBQ0gsSUFBSSxVQUFVLEdBQUcsSUFBSSxDQUFDO2dCQUN0QixJQUFJLElBQUksS0FBSyxHQUFHO29CQUFFLFVBQVUsR0FBRyxPQUFPLENBQUM7Z0JBQ3ZDLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7b0JBQUUsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsV0FBVyxFQUFFLGlCQUFpQixDQUFDLENBQUM7Z0JBQzVGLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxTQUFTLENBQUM7b0JBQUUsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsU0FBUyxFQUFFLGVBQWUsQ0FBQyxDQUFDO2dCQUN0RixJQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsYUFBYSxDQUFDO29CQUFFLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO2dCQUVsRyxNQUFNLE1BQU0sR0FBRyx5QkFBYSxJQUFJLFVBQVUsRUFBRSx1Q0FBQyxDQUFDO2dCQUM5QyxTQUFTLEdBQUcsTUFBTSxFQUFFLE9BQU8sQ0FBQztZQUM5QixDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZix1REFBdUQ7Z0JBQ3ZELE9BQU8sQ0FBQyxJQUFJLENBQUMsb0JBQW9CLElBQUksYUFBYSxFQUFFLEtBQUssQ0FBQyxDQUFDO2dCQUMzRCxPQUFPO1lBQ1QsQ0FBQztZQUVELElBQUksQ0FBQyxTQUFTO2dCQUFFLE9BQU87WUFFdkIsSUFBQSxjQUFNLEVBQ0osdUJBQUMsV0FBVyxJQUFDLFFBQVEsRUFBRSxRQUFRLEVBQUUsWUFBWSxFQUFFLElBQUksWUFDakQsdUJBQUMsU0FBUyxLQUFHLEdBQ0QsQ0FDZixDQUFDO1lBRUYsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLHFDQUFxQztnQkFDckMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzVDLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXRCLG9EQUFvRDtZQUNwRCxNQUFNLFFBQVEsR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBQ2xELElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDeEIsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBRXhDLGtDQUFrQztnQkFDbEMsTUFBTSxXQUFXLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUNwQyxDQUFDLENBQUMsT0FBTyxLQUFLLElBQUksSUFBSSxDQUFDLENBQUMsT0FBTyxLQUFLLElBQUksQ0FDekMsQ0FBQztnQkFDRixNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsVUFBVSxFQUFFLENBQUM7WUFDbkMsQ0FBQztZQUVELG9EQUFvRDtZQUNwRCxNQUFNLE9BQU8sR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ2hELE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3ZCLHVDQUF1QztnQkFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztnQkFDdkMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBQy9FLENBQUMsQ0FBQyxDQUFDO1lBRUgsMENBQTBDO1lBQzFDLE1BQU0sTUFBTSxHQUFHLGNBQU0sQ0FBQyxjQUFjLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDaEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRTtnQkFDckIsTUFBTSxLQUFLLEdBQUcsY0FBTSxDQUFDLGdCQUFnQixDQUFDLElBQUksTUFBTSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3pGLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztvQkFDWCxzREFBc0Q7b0JBQ3RELE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUM7Z0JBQzlDLENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztZQUVILHFDQUFxQztZQUNyQyxNQUFNLEtBQUssR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQzVDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ25CLE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUMzRSxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1FBQ2pELEVBQUUsQ0FBQyx3REFBd0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RSxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDO1lBRW5DLElBQUksY0FBYyxDQUFDO1lBQ25CLElBQUksQ0FBQztnQkFDSCxNQUFNLE1BQU0sR0FBRyx3REFBYSx1QkFBdUIsR0FBQyxDQUFDO2dCQUNyRCxjQUFjLEdBQUcsTUFBTSxFQUFFLE9BQU8sQ0FBQztZQUNuQyxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixNQUFNLElBQUksS0FBSyxDQUFDLHFDQUFxQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFFRCxJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3BCLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztZQUMvQyxDQUFDO1lBRUQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFFaEQsSUFBQSxjQUFNLEVBQ0osdUJBQUMsV0FBVyxJQUFDLFFBQVEsRUFBRSxRQUFRLFlBQzdCLHVCQUFDLGNBQWMsS0FBRyxHQUNOLENBQ2YsQ0FBQztZQUVGLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQiw0QkFBNEI7Z0JBQzVCLE1BQU0sQ0FBQyxjQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUN6RCxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUV0Qix3Q0FBd0M7WUFDeEMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FDekMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxnREFBZ0QsQ0FBQyxDQUN4RSxDQUFDO1lBRUYsaUNBQWlDO1lBQ2pDLE1BQU0sY0FBYyxHQUFHLGNBQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLENBQUMsQ0FBQztZQUM1RCxJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNuQixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM3QyxDQUFDO1lBRUQsTUFBTSxjQUFjLEdBQUcsY0FBTSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQzVELElBQUksY0FBYyxFQUFFLENBQUM7Z0JBQ25CLE1BQU0sQ0FBQyxjQUFjLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzdDLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRCxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDO1lBRW5DLE1BQU0sY0FBYyxHQUFHLENBQUMsd0RBQWEsdUJBQXVCLEdBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQztZQUV2RSxJQUFBLGNBQU0sRUFDSix1QkFBQyxXQUFXLElBQUMsUUFBUSxFQUFFLFFBQVEsWUFDN0IsdUJBQUMsY0FBYyxLQUFHLEdBQ04sQ0FDZixDQUFDO1lBRUYsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLE1BQU0sQ0FBQyxjQUFNLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUN6RCxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUV0QixzQkFBc0I7WUFDdEIsTUFBTSxtQkFBbUIsR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQztpQkFDeEQsTUFBTSxDQUFDLGNBQU0sQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7aUJBQ3pDLE1BQU0sQ0FBQyxjQUFNLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7WUFFNUMsSUFBSSxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ25DLDZCQUE2QjtnQkFDN0IsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLENBQUM7Z0JBQy9CLE1BQU0sQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRTVELHdCQUF3QjtnQkFDeEIsaUJBQVMsQ0FBQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQztnQkFDMUQsNkZBQTZGO2dCQUM3RixNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3JELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdDQUFnQyxFQUFFLEdBQUcsRUFBRTtRQUM5QyxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsNkNBQTZDLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxFQUFFO1lBQ3RGLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUM7WUFFakMsOENBQThDO1lBQzlDLE1BQU0sZUFBZSxHQUFHO2dCQUN0QixFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxtREFBUSxtQkFBbUIsR0FBQyxFQUFFO2dCQUNwRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLG1EQUFRLHVCQUF1QixHQUFDLEVBQUU7YUFDN0UsQ0FBQztZQUVGLEtBQUssTUFBTSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsSUFBSSxlQUFlLEVBQUUsQ0FBQztnQkFDbEQsSUFBSSxTQUFTLENBQUM7Z0JBQ2QsSUFBSSxDQUFDO29CQUNILE1BQU0sTUFBTSxHQUFHLE1BQU0sU0FBUyxFQUFFLENBQUM7b0JBQ2pDLFNBQVMsR0FBRyxNQUFNLEVBQUUsT0FBTyxDQUFDO2dCQUM5QixDQUFDO2dCQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7b0JBQ2YsU0FBUyxDQUFDLGtDQUFrQztnQkFDOUMsQ0FBQztnQkFFRCxJQUFJLENBQUMsU0FBUztvQkFBRSxTQUFTO2dCQUV6QixJQUFBLGNBQU0sRUFDSix1QkFBQyxXQUFXLElBQUMsUUFBUSxFQUFFLFFBQVEsWUFDN0IsdUJBQUMsU0FBUyxLQUFHLEdBQ0QsQ0FDZixDQUFDO2dCQUVGLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO29CQUNqQixNQUFNLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7Z0JBQzVDLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUV0QixxREFBcUQ7Z0JBQ3JELE1BQU0sWUFBWSxHQUFHLGNBQU0sQ0FBQyxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ2xELE1BQU0sQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUM1QyxFQUFFLENBQUMsMENBQTBDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsTUFBTSxRQUFRLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQztZQUVuQyxpQkFBaUI7WUFDakIsTUFBTSxTQUFTLEdBQUcsTUFBTSxDQUFDLEtBQTBDLENBQUM7WUFDcEUsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ25DLElBQUksR0FBRyxLQUFLLGdCQUFnQixFQUFFLENBQUM7b0JBQzdCLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQzt3QkFDckIsRUFBRSxFQUFFLElBQUk7d0JBQ1IsTUFBTSxFQUFFLEdBQUc7d0JBQ1gsSUFBSSxFQUFFLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO3FCQUMxQixDQUFDLENBQUM7Z0JBQ2pCLENBQUM7Z0JBRUQscUJBQXFCO2dCQUNyQixPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7b0JBQ3JCLEVBQUUsRUFBRSxLQUFLO29CQUNULE1BQU0sRUFBRSxHQUFHO29CQUNYLFVBQVUsRUFBRSx1QkFBdUI7b0JBQ25DLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxDQUFDO2lCQUMzQyxDQUFDLENBQUM7WUFDakIsQ0FBQyxDQUFDLENBQUM7WUFFSCxNQUFNLGNBQWMsR0FBRyxDQUFDLHdEQUFhLHVCQUF1QixHQUFDLENBQUMsQ0FBQyxPQUFPLENBQUM7WUFFdkUsSUFBQSxjQUFNLEVBQ0osdUJBQUMsV0FBVyxJQUFDLFFBQVEsRUFBRSxRQUFRLFlBQzdCLHVCQUFDLGNBQWMsS0FBRyxHQUNOLENBQ2YsQ0FBQztZQUVGLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQiwyQ0FBMkM7Z0JBQzNDLE1BQU0sYUFBYSxHQUFHLGNBQU0sQ0FBQyxjQUFjLENBQUMscUJBQXFCLENBQUMsQ0FBQztnQkFDbkUsSUFBSSxhQUFhLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUM3QixzQ0FBc0M7b0JBQ3RDLGFBQWEsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7d0JBQzlCLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO29CQUN0QyxDQUFDLENBQUMsQ0FBQztnQkFDTCxDQUFDO1lBQ0gsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsRUFBRSxDQUFDLDREQUE0RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzFFLE1BQU0sUUFBUSxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUM7WUFFbkMsTUFBTSxjQUFjLEdBQUcsQ0FBQyx3REFBYSx1QkFBdUIsR0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBRXZFLElBQUEsY0FBTSxFQUNKLHVCQUFDLFdBQVcsSUFBQyxRQUFRLEVBQUUsUUFBUSxZQUM3Qix1QkFBQyxjQUFjLEtBQUcsR0FDTixDQUNmLENBQUM7WUFFRixNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsTUFBTSxDQUFDLGNBQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pELENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXRCLG1DQUFtQztZQUNuQyxNQUFNLFVBQVUsR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ3JELFVBQVUsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUU7Z0JBQzVCLGdEQUFnRDtnQkFDaEQsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsQ0FBQztZQUVILDJCQUEyQjtZQUMzQixNQUFNLGVBQWUsR0FBRyxjQUFNLENBQUMsY0FBYyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1lBQy9ELGVBQWUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUU7Z0JBQ2hDLHVEQUF1RDtnQkFDdkQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDdEMsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9wYWdlLWFjY2Vzc2liaWxpdHkudGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21wcmVoZW5zaXZlIHBhZ2UgYWNjZXNzaWJpbGl0eSB0ZXN0aW5nIHN1aXRlXG4gKiBUZXN0cyBhbGwgcGFnZXMgZm9yIGFjY2Vzc2liaWxpdHkgY29tcGxpYW5jZSBhbmQgcHJvcGVyIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgd2FpdEZvciwgZmlyZUV2ZW50IH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgeyBRdWVyeUNsaWVudCwgUXVlcnlDbGllbnRQcm92aWRlciB9IGZyb20gJ0B0YW5zdGFjay9yZWFjdC1xdWVyeSc7XG5pbXBvcnQgeyBNZW1vcnlSb3V0ZXIgfSBmcm9tICd3b3V0ZXIvbWVtb3J5LWxvY2F0aW9uJztcbmltcG9ydCB7IEF1dGhQcm92aWRlciB9IGZyb20gJ0AvaG9va3MvdXNlLWF1dGgnO1xuaW1wb3J0IHsgTGFuZ3VhZ2VQcm92aWRlciB9IGZyb20gJ0AvaG9va3MvdXNlLWxhbmd1YWdlJztcbmltcG9ydCAnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbSc7XG5cbi8vIE1vY2sgZmV0Y2ggZm9yIEFQSSBjYWxsc1xuZ2xvYmFsLmZldGNoID0gamVzdC5mbigpO1xuXG4vLyBUZXN0IHByb3ZpZGVycyB3cmFwcGVyXG5jb25zdCBUZXN0V3JhcHBlciA9ICh7IFxuICBjaGlsZHJlbiwgXG4gIG1vY2tVc2VyID0gbnVsbCwgXG4gIGluaXRpYWxSb3V0ZSA9ICcvJyBcbn06IHsgXG4gIGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGU7XG4gIG1vY2tVc2VyPzogYW55O1xuICBpbml0aWFsUm91dGU/OiBzdHJpbmc7XG59KSA9PiB7XG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gbmV3IFF1ZXJ5Q2xpZW50KHtcbiAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgcXVlcmllczoge1xuICAgICAgICByZXRyeTogZmFsc2UsXG4gICAgICAgIGdjVGltZTogMCxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgY29uc3QgbW9ja0ZldGNoID0gZ2xvYmFsLmZldGNoIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGZldGNoPjtcbiAgXG4gIC8vIE1vY2sgYXV0aCByZXNwb25zZVxuICBpZiAobW9ja1VzZXIpIHtcbiAgICBtb2NrRmV0Y2gubW9ja0ltcGxlbWVudGF0aW9uKCh1cmwpID0+IHtcbiAgICAgIGlmICh1cmwgPT09ICcvYXBpL2F1dGgvdXNlcicpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICAgICAganNvbjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG1vY2tVc2VyKSxcbiAgICAgICAgfSBhcyBSZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIE1vY2sgb3RoZXIgQVBJIGVuZHBvaW50c1xuICAgICAgaWYgKHVybCA9PT0gJy9hcGkvYnVpbGRpbmdzJykge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICBzdGF0dXM6IDIwMCxcbiAgICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoW1xuICAgICAgICAgICAgeyBpZDogJzEnLCBuYW1lOiAnVGVzdCBCdWlsZGluZyAxJywgeWVhckJ1aWx0OiAyMDIwIH0sXG4gICAgICAgICAgICB7IGlkOiAnMicsIG5hbWU6ICdUZXN0IEJ1aWxkaW5nIDInLCB5ZWFyQnVpbHQ6IDIwMjEgfVxuICAgICAgICAgIF0pLFxuICAgICAgICB9IGFzIFJlc3BvbnNlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHVybD8udG9TdHJpbmcoKS5pbmNsdWRlcygnL2FwaS9iaWxscycpKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgIG9rOiB0cnVlLFxuICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgIGpzb246ICgpID0+IFByb21pc2UucmVzb2x2ZShbXSksXG4gICAgICAgIH0gYXMgUmVzcG9uc2UpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgb2s6IHRydWUsXG4gICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoW10pLFxuICAgICAgfSBhcyBSZXNwb25zZSk7XG4gICAgfSk7XG4gIH0gZWxzZSB7XG4gICAgbW9ja0ZldGNoLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIG9rOiBmYWxzZSxcbiAgICAgIHN0YXR1czogNDAxLFxuICAgICAgc3RhdHVzVGV4dDogJ1VuYXV0aG9yaXplZCcsXG4gICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSksXG4gICAgfSBhcyBSZXNwb25zZSk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxRdWVyeUNsaWVudFByb3ZpZGVyIGNsaWVudD17cXVlcnlDbGllbnR9PlxuICAgICAgPExhbmd1YWdlUHJvdmlkZXI+XG4gICAgICAgIDxBdXRoUHJvdmlkZXI+XG4gICAgICAgICAgPE1lbW9yeVJvdXRlciBpbml0aWFsRW50cmllcz17W2luaXRpYWxSb3V0ZV19PlxuICAgICAgICAgICAge2NoaWxkcmVufVxuICAgICAgICAgIDwvTWVtb3J5Um91dGVyPlxuICAgICAgICA8L0F1dGhQcm92aWRlcj5cbiAgICAgIDwvTGFuZ3VhZ2VQcm92aWRlcj5cbiAgICA8L1F1ZXJ5Q2xpZW50UHJvdmlkZXI+XG4gICk7XG59O1xuXG4vLyBUZXN0IGRhdGEgZm9yIGRpZmZlcmVudCB1c2VyIHJvbGVzXG5jb25zdCBtb2NrVXNlcnMgPSB7XG4gIGFkbWluOiB7IFxuICAgIGlkOiAnMScsIFxuICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLCBcbiAgICByb2xlOiAnYWRtaW4nLCBcbiAgICBmaXJzdE5hbWU6ICdBZG1pbicsIFxuICAgIGxhc3ROYW1lOiAnVXNlcicgXG4gIH0sXG4gIG1hbmFnZXI6IHsgXG4gICAgaWQ6ICcyJywgXG4gICAgZW1haWw6ICdtYW5hZ2VyQHRlc3QuY29tJywgXG4gICAgcm9sZTogJ21hbmFnZXInLCBcbiAgICBmaXJzdE5hbWU6ICdNYW5hZ2VyJywgXG4gICAgbGFzdE5hbWU6ICdVc2VyJyBcbiAgfSxcbiAgcmVzaWRlbnQ6IHsgXG4gICAgaWQ6ICczJywgXG4gICAgZW1haWw6ICdyZXNpZGVudEB0ZXN0LmNvbScsIFxuICAgIHJvbGU6ICdyZXNpZGVudCcsIFxuICAgIGZpcnN0TmFtZTogJ1Jlc2lkZW50JywgXG4gICAgbGFzdE5hbWU6ICdVc2VyJyBcbiAgfVxufTtcblxuLy8gUGFnZXMgdG8gdGVzdCB3aXRoIHRoZWlyIHJlcXVpcmVkIHJvbGVzXG5jb25zdCBwYWdlc1RvVGVzdCA9IFtcbiAgLy8gUHVibGljIHBhZ2VzXG4gIHsgcGF0aDogJy8nLCBuYW1lOiAnSG9tZScsIHJvbGU6IG51bGwgfSxcbiAgeyBwYXRoOiAnL2ZlYXR1cmVzJywgbmFtZTogJ0ZlYXR1cmVzJywgcm9sZTogbnVsbCB9LFxuICB7IHBhdGg6ICcvbG9naW4nLCBuYW1lOiAnTG9naW4nLCByb2xlOiBudWxsIH0sXG4gIFxuICAvLyBQcm90ZWN0ZWQgcGFnZXNcbiAgeyBwYXRoOiAnL2Rhc2hib2FyZCcsIG5hbWU6ICdEYXNoYm9hcmQnLCByb2xlOiAnYWRtaW4nIH0sXG4gIHsgcGF0aDogJy9tYW5hZ2VyL2JpbGxzJywgbmFtZTogJ01hbmFnZXIgQmlsbHMnLCByb2xlOiAnbWFuYWdlcicgfSxcbiAgeyBwYXRoOiAnL21hbmFnZXIvYnVpbGRpbmdzJywgbmFtZTogJ01hbmFnZXIgQnVpbGRpbmdzJywgcm9sZTogJ21hbmFnZXInIH0sXG4gIHsgcGF0aDogJy9hZG1pbi9vcmdhbml6YXRpb25zJywgbmFtZTogJ0FkbWluIE9yZ2FuaXphdGlvbnMnLCByb2xlOiAnYWRtaW4nIH0sXG4gIHsgcGF0aDogJy9yZXNpZGVudHMvZGFzaGJvYXJkJywgbmFtZTogJ1Jlc2lkZW50cyBEYXNoYm9hcmQnLCByb2xlOiAncmVzaWRlbnQnIH0sXG5dO1xuXG5kZXNjcmliZSgnUGFnZSBBY2Nlc3NpYmlsaXR5IFRlc3RzJywgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Jhc2ljIFBhZ2UgQWNjZXNzaWJpbGl0eScsICgpID0+IHtcbiAgICBpdC5lYWNoKHBhZ2VzVG9UZXN0KSgnJG5hbWUgcGFnZSBzaG91bGQgaGF2ZSBwcm9wZXIgc2VtYW50aWMgc3RydWN0dXJlJywgYXN5bmMgKHsgcGF0aCwgbmFtZSwgcm9sZSB9KSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IHJvbGUgPyBtb2NrVXNlcnNbcm9sZSBhcyBrZXlvZiB0eXBlb2YgbW9ja1VzZXJzXSA6IG51bGw7XG4gICAgICBcbiAgICAgIGxldCBDb21wb25lbnQ7XG4gICAgICB0cnkge1xuICAgICAgICBsZXQgaW1wb3J0UGF0aCA9IHBhdGg7XG4gICAgICAgIGlmIChwYXRoID09PSAnLycpIGltcG9ydFBhdGggPSAnL2hvbWUnO1xuICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvbWFuYWdlci8nKSkgaW1wb3J0UGF0aCA9IHBhdGgucmVwbGFjZSgnL21hbmFnZXIvJywgJy9wYWdlcy9tYW5hZ2VyLycpO1xuICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvYWRtaW4vJykpIGltcG9ydFBhdGggPSBwYXRoLnJlcGxhY2UoJy9hZG1pbi8nLCAnL3BhZ2VzL2FkbWluLycpO1xuICAgICAgICBpZiAocGF0aC5zdGFydHNXaXRoKCcvcmVzaWRlbnRzLycpKSBpbXBvcnRQYXRoID0gcGF0aC5yZXBsYWNlKCcvcmVzaWRlbnRzLycsICcvcGFnZXMvcmVzaWRlbnRzLycpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgaW1wb3J0KGBAJHtpbXBvcnRQYXRofWApO1xuICAgICAgICBDb21wb25lbnQgPSBtb2R1bGU/LmRlZmF1bHQ7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBTa2lwIGlmIGNvbXBvbmVudCBkb2Vzbid0IGV4aXN0IG9yIGhhcyBpbXBvcnQgaXNzdWVzXG4gICAgICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IGltcG9ydCAke25hbWV9IGNvbXBvbmVudDpgLCBlcnJvcik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKCFDb21wb25lbnQpIHJldHVybjtcblxuICAgICAgcmVuZGVyKFxuICAgICAgICA8VGVzdFdyYXBwZXIgbW9ja1VzZXI9e21vY2tVc2VyfSBpbml0aWFsUm91dGU9e3BhdGh9PlxuICAgICAgICAgIDxDb21wb25lbnQgLz5cbiAgICAgICAgPC9UZXN0V3JhcHBlcj5cbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICAvLyBXYWl0IGZvciBjb21wb25lbnQgdG8gZnVsbHkgcmVuZGVyXG4gICAgICAgIGV4cGVjdChkb2N1bWVudC5ib2R5KS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSwgeyB0aW1lb3V0OiAzMDAwIH0pO1xuXG4gICAgICAvLyBUZXN0IDE6IFBhZ2Ugc2hvdWxkIGhhdmUgcHJvcGVyIGhlYWRpbmcgc3RydWN0dXJlXG4gICAgICBjb25zdCBoZWFkaW5ncyA9IHNjcmVlbi5xdWVyeUFsbEJ5Um9sZSgnaGVhZGluZycpO1xuICAgICAgaWYgKGhlYWRpbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZXhwZWN0KGhlYWRpbmdzWzBdKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgICBcbiAgICAgICAgLy8gTWFpbiBoZWFkaW5nIHNob3VsZCBiZSBoMSBvciBoMlxuICAgICAgICBjb25zdCBtYWluSGVhZGluZyA9IGhlYWRpbmdzLmZpbmQoaCA9PiBcbiAgICAgICAgICBoLnRhZ05hbWUgPT09ICdIMScgfHwgaC50YWdOYW1lID09PSAnSDInXG4gICAgICAgICk7XG4gICAgICAgIGV4cGVjdChtYWluSGVhZGluZykudG9CZVRydXRoeSgpO1xuICAgICAgfVxuXG4gICAgICAvLyBUZXN0IDI6IEludGVyYWN0aXZlIGVsZW1lbnRzIHNob3VsZCBiZSBhY2Nlc3NpYmxlXG4gICAgICBjb25zdCBidXR0b25zID0gc2NyZWVuLnF1ZXJ5QWxsQnlSb2xlKCdidXR0b24nKTtcbiAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4ge1xuICAgICAgICAvLyBCdXR0b25zIHNob3VsZCBoYXZlIGFjY2Vzc2libGUgbmFtZXNcbiAgICAgICAgZXhwZWN0KGJ1dHRvbikudG9IYXZlQXR0cmlidXRlKCd0eXBlJyk7XG4gICAgICAgIGV4cGVjdChidXR0b24udGV4dENvbnRlbnQgfHwgYnV0dG9uLmdldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcpKS50b0JlVHJ1dGh5KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gVGVzdCAzOiBGb3JtcyBzaG91bGQgaGF2ZSBwcm9wZXIgbGFiZWxzXG4gICAgICBjb25zdCBpbnB1dHMgPSBzY3JlZW4ucXVlcnlBbGxCeVJvbGUoJ3RleHRib3gnKTtcbiAgICAgIGlucHV0cy5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgICAgY29uc3QgbGFiZWwgPSBzY3JlZW4ucXVlcnlCeUxhYmVsVGV4dChuZXcgUmVnRXhwKGlucHV0LmdldEF0dHJpYnV0ZSgnbmFtZScpIHx8ICcnLCAnaScpKTtcbiAgICAgICAgaWYgKCFsYWJlbCkge1xuICAgICAgICAgIC8vIElucHV0IHNob3VsZCBoYXZlIGFyaWEtbGFiZWwgaWYgbm8gYXNzb2NpYXRlZCBsYWJlbFxuICAgICAgICAgIGV4cGVjdChpbnB1dCkudG9IYXZlQXR0cmlidXRlKCdhcmlhLWxhYmVsJyk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICAvLyBUZXN0IDQ6IExpbmtzIHNob3VsZCBiZSBhY2Nlc3NpYmxlXG4gICAgICBjb25zdCBsaW5rcyA9IHNjcmVlbi5xdWVyeUFsbEJ5Um9sZSgnbGluaycpO1xuICAgICAgbGlua3MuZm9yRWFjaChsaW5rID0+IHtcbiAgICAgICAgZXhwZWN0KGxpbmsudGV4dENvbnRlbnQgfHwgbGluay5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKSkudG9CZVRydXRoeSgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdCaWxscyBQYWdlIFNwZWNpZmljIEFjY2Vzc2liaWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZW5kZXIgYmlsbHMgcGFnZSB3aXRob3V0IENBVEVHT1JZX0xBQkVMUyBlcnJvcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0gbW9ja1VzZXJzLm1hbmFnZXI7XG4gICAgICBcbiAgICAgIGxldCBCaWxsc0NvbXBvbmVudDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG1vZHVsZSA9IGF3YWl0IGltcG9ydCgnQC9wYWdlcy9tYW5hZ2VyL2JpbGxzJyk7XG4gICAgICAgIEJpbGxzQ29tcG9uZW50ID0gbW9kdWxlPy5kZWZhdWx0O1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gaW1wb3J0IEJpbGxzIGNvbXBvbmVudDogJHtlcnJvcn1gKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFCaWxsc0NvbXBvbmVudCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JpbGxzIGNvbXBvbmVudCBub3QgZm91bmQnKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29uc29sZVNweSA9IGplc3Quc3B5T24oY29uc29sZSwgJ2Vycm9yJyk7XG4gICAgICBcbiAgICAgIHJlbmRlcihcbiAgICAgICAgPFRlc3RXcmFwcGVyIG1vY2tVc2VyPXttb2NrVXNlcn0+XG4gICAgICAgICAgPEJpbGxzQ29tcG9uZW50IC8+XG4gICAgICAgIDwvVGVzdFdyYXBwZXI+XG4gICAgICApO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgLy8gV2FpdCBmb3IgdGhlIHBhZ2UgdG8gbG9hZFxuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgvYmlsbHMvaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9LCB7IHRpbWVvdXQ6IDUwMDAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCBub3QgaGF2ZSBDQVRFR09SWV9MQUJFTFMgZXJyb3JcbiAgICAgIGV4cGVjdChjb25zb2xlU3B5KS5ub3QudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5zdHJpbmdNYXRjaGluZygvUmVmZXJlbmNlRXJyb3IuKkNBVEVHT1JZX0xBQkVMUyBpcyBub3QgZGVmaW5lZC8pXG4gICAgICApO1xuXG4gICAgICAvLyBTaG91bGQgaGF2ZSBwcm9wZXIgZm9ybSBsYWJlbHNcbiAgICAgIGNvbnN0IGJ1aWxkaW5nRmlsdGVyID0gc2NyZWVuLnF1ZXJ5QnlMYWJlbFRleHQoL2J1aWxkaW5nL2kpO1xuICAgICAgaWYgKGJ1aWxkaW5nRmlsdGVyKSB7XG4gICAgICAgIGV4cGVjdChidWlsZGluZ0ZpbHRlcikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2F0ZWdvcnlGaWx0ZXIgPSBzY3JlZW4ucXVlcnlCeUxhYmVsVGV4dCgvY2F0ZWdvcnkvaSk7XG4gICAgICBpZiAoY2F0ZWdvcnlGaWx0ZXIpIHtcbiAgICAgICAgZXhwZWN0KGNhdGVnb3J5RmlsdGVyKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUga2V5Ym9hcmQgbmF2aWdhdGlvbiBvbiBiaWxscyBwYWdlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSBtb2NrVXNlcnMubWFuYWdlcjtcbiAgICAgIFxuICAgICAgY29uc3QgQmlsbHNDb21wb25lbnQgPSAoYXdhaXQgaW1wb3J0KCdAL3BhZ2VzL21hbmFnZXIvYmlsbHMnKSkuZGVmYXVsdDtcbiAgICAgIFxuICAgICAgcmVuZGVyKFxuICAgICAgICA8VGVzdFdyYXBwZXIgbW9ja1VzZXI9e21vY2tVc2VyfT5cbiAgICAgICAgICA8QmlsbHNDb21wb25lbnQgLz5cbiAgICAgICAgPC9UZXN0V3JhcHBlcj5cbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGV4dCgvYmlsbHMvaSkpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9LCB7IHRpbWVvdXQ6IDUwMDAgfSk7XG5cbiAgICAgIC8vIFRlc3QgdGFiIG5hdmlnYXRpb25cbiAgICAgIGNvbnN0IGludGVyYWN0aXZlRWxlbWVudHMgPSBzY3JlZW4ucXVlcnlBbGxCeVJvbGUoJ2J1dHRvbicpXG4gICAgICAgIC5jb25jYXQoc2NyZWVuLnF1ZXJ5QWxsQnlSb2xlKCdjb21ib2JveCcpKVxuICAgICAgICAuY29uY2F0KHNjcmVlbi5xdWVyeUFsbEJ5Um9sZSgndGV4dGJveCcpKTtcblxuICAgICAgaWYgKGludGVyYWN0aXZlRWxlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBGb2N1cyBzaG91bGQgYmUgbWFuYWdlYWJsZVxuICAgICAgICBpbnRlcmFjdGl2ZUVsZW1lbnRzWzBdLmZvY3VzKCk7XG4gICAgICAgIGV4cGVjdChkb2N1bWVudC5hY3RpdmVFbGVtZW50KS50b0JlKGludGVyYWN0aXZlRWxlbWVudHNbMF0pO1xuXG4gICAgICAgIC8vIFRhYiBzaG91bGQgbW92ZSBmb2N1c1xuICAgICAgICBmaXJlRXZlbnQua2V5RG93bihpbnRlcmFjdGl2ZUVsZW1lbnRzWzBdLCB7IGtleTogJ1RhYicgfSk7XG4gICAgICAgIC8vIE5vdGU6IGpzZG9tIGRvZXNuJ3Qgc2ltdWxhdGUgYWN0dWFsIHRhYiBiZWhhdmlvciwgYnV0IHdlIGNhbiB0ZXN0IHRoZSBlbGVtZW50IGlzIGZvY3VzYWJsZVxuICAgICAgICBleHBlY3QoaW50ZXJhY3RpdmVFbGVtZW50c1swXSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xhbmd1YWdlIFN1cHBvcnQgQWNjZXNzaWJpbGl0eScsICgpID0+IHtcbiAgICBpdC5lYWNoKFsnZW4nLCAnZnInXSkoJ3Nob3VsZCByZW5kZXIgcGFnZXMgcHJvcGVybHkgaW4gJXMgbGFuZ3VhZ2UnLCBhc3luYyAobGFuZ3VhZ2UpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tVc2VyID0gbW9ja1VzZXJzLmFkbWluO1xuICAgICAgXG4gICAgICAvLyBUZXN0IGEgZmV3IGtleSBwYWdlcyBpbiBkaWZmZXJlbnQgbGFuZ3VhZ2VzXG4gICAgICBjb25zdCBwYWdlc1RvVGVzdExhbmcgPSBbXG4gICAgICAgIHsgcGF0aDogJy9kYXNoYm9hcmQnLCBjb21wb25lbnQ6ICgpID0+IGltcG9ydCgnQC9wYWdlcy9kYXNoYm9hcmQnKSB9LFxuICAgICAgICB7IHBhdGg6ICcvbWFuYWdlci9iaWxscycsIGNvbXBvbmVudDogKCkgPT4gaW1wb3J0KCdAL3BhZ2VzL21hbmFnZXIvYmlsbHMnKSB9XG4gICAgICBdO1xuXG4gICAgICBmb3IgKGNvbnN0IHsgcGF0aCwgY29tcG9uZW50IH0gb2YgcGFnZXNUb1Rlc3RMYW5nKSB7XG4gICAgICAgIGxldCBDb21wb25lbnQ7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgY29tcG9uZW50KCk7XG4gICAgICAgICAgQ29tcG9uZW50ID0gbW9kdWxlPy5kZWZhdWx0O1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnRpbnVlOyAvLyBTa2lwIGlmIGNvbXBvbmVudCBkb2Vzbid0IGV4aXN0XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIUNvbXBvbmVudCkgY29udGludWU7XG5cbiAgICAgICAgcmVuZGVyKFxuICAgICAgICAgIDxUZXN0V3JhcHBlciBtb2NrVXNlcj17bW9ja1VzZXJ9PlxuICAgICAgICAgICAgPENvbXBvbmVudCAvPlxuICAgICAgICAgIDwvVGVzdFdyYXBwZXI+XG4gICAgICAgICk7XG5cbiAgICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KGRvY3VtZW50LmJvZHkpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICAgIH0sIHsgdGltZW91dDogMzAwMCB9KTtcblxuICAgICAgICAvLyBDaGVjayB0aGF0IHRleHQgY29udGVudCBleGlzdHMgKGxhbmd1YWdlLWFnbm9zdGljKVxuICAgICAgICBjb25zdCB0ZXh0RWxlbWVudHMgPSBzY3JlZW4ucXVlcnlBbGxCeVRleHQoL1xcdysvKTtcbiAgICAgICAgZXhwZWN0KHRleHRFbGVtZW50cy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nIEFjY2Vzc2liaWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGFjY2Vzc2libGUgZXJyb3IgbWVzc2FnZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IG1vY2tVc2Vycy5tYW5hZ2VyO1xuICAgICAgXG4gICAgICAvLyBNb2NrIEFQSSBlcnJvclxuICAgICAgY29uc3QgbW9ja0ZldGNoID0gZ2xvYmFsLmZldGNoIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGZldGNoPjtcbiAgICAgIG1vY2tGZXRjaC5tb2NrSW1wbGVtZW50YXRpb24oKHVybCkgPT4ge1xuICAgICAgICBpZiAodXJsID09PSAnL2FwaS9hdXRoL3VzZXInKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXR1czogMjAwLFxuICAgICAgICAgICAganNvbjogKCkgPT4gUHJvbWlzZS5yZXNvbHZlKG1vY2tVc2VyKSxcbiAgICAgICAgICB9IGFzIFJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gU2ltdWxhdGUgQVBJIGVycm9yXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgIG9rOiBmYWxzZSxcbiAgICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgICBzdGF0dXNUZXh0OiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJyxcbiAgICAgICAgICBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBlcnJvcjogJ1NlcnZlciBlcnJvcicgfSksXG4gICAgICAgIH0gYXMgUmVzcG9uc2UpO1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IEJpbGxzQ29tcG9uZW50ID0gKGF3YWl0IGltcG9ydCgnQC9wYWdlcy9tYW5hZ2VyL2JpbGxzJykpLmRlZmF1bHQ7XG4gICAgICBcbiAgICAgIHJlbmRlcihcbiAgICAgICAgPFRlc3RXcmFwcGVyIG1vY2tVc2VyPXttb2NrVXNlcn0+XG4gICAgICAgICAgPEJpbGxzQ29tcG9uZW50IC8+XG4gICAgICAgIDwvVGVzdFdyYXBwZXI+XG4gICAgICApO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgLy8gTG9vayBmb3IgZXJyb3IgbWVzc2FnZXMgb3IgcmV0cnkgYnV0dG9uc1xuICAgICAgICBjb25zdCBlcnJvckVsZW1lbnRzID0gc2NyZWVuLnF1ZXJ5QWxsQnlUZXh0KC9lcnJvcnxyZXRyeXxmYWlsZWQvaSk7XG4gICAgICAgIGlmIChlcnJvckVsZW1lbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBFcnJvciBtZXNzYWdlcyBzaG91bGQgYmUgYWNjZXNzaWJsZVxuICAgICAgICAgIGVycm9yRWxlbWVudHMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICAgICAgICAgIGV4cGVjdChlbGVtZW50KS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9LCB7IHRpbWVvdXQ6IDUwMDAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBUklBIGFuZCBTY3JlZW4gUmVhZGVyIFN1cHBvcnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYXZlIHByb3BlciBBUklBIGF0dHJpYnV0ZXMgb24gaW50ZXJhY3RpdmUgZWxlbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrVXNlciA9IG1vY2tVc2Vycy5tYW5hZ2VyO1xuICAgICAgXG4gICAgICBjb25zdCBCaWxsc0NvbXBvbmVudCA9IChhd2FpdCBpbXBvcnQoJ0AvcGFnZXMvbWFuYWdlci9iaWxscycpKS5kZWZhdWx0O1xuICAgICAgXG4gICAgICByZW5kZXIoXG4gICAgICAgIDxUZXN0V3JhcHBlciBtb2NrVXNlcj17bW9ja1VzZXJ9PlxuICAgICAgICAgIDxCaWxsc0NvbXBvbmVudCAvPlxuICAgICAgICA8L1Rlc3RXcmFwcGVyPlxuICAgICAgKTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXh0KC9iaWxscy9pKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0sIHsgdGltZW91dDogNTAwMCB9KTtcblxuICAgICAgLy8gQ2hlY2sgZm9yIHByb3BlciBBUklBIGF0dHJpYnV0ZXNcbiAgICAgIGNvbnN0IGNvbWJvYm94ZXMgPSBzY3JlZW4ucXVlcnlBbGxCeVJvbGUoJ2NvbWJvYm94Jyk7XG4gICAgICBjb21ib2JveGVzLmZvckVhY2goY29tYm9ib3ggPT4ge1xuICAgICAgICAvLyBDb21ib2JveGVzIHNob3VsZCBoYXZlIHByb3BlciBBUklBIGF0dHJpYnV0ZXNcbiAgICAgICAgZXhwZWN0KGNvbWJvYm94KS50b0hhdmVBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDaGVjayBmb3IgbG9hZGluZyBzdGF0ZXNcbiAgICAgIGNvbnN0IGxvYWRpbmdFbGVtZW50cyA9IHNjcmVlbi5xdWVyeUFsbEJ5VGV4dCgvbG9hZGluZ3x3YWl0L2kpO1xuICAgICAgbG9hZGluZ0VsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgIC8vIExvYWRpbmcgc3RhdGVzIHNob3VsZCBiZSBhbm5vdW5jZWQgdG8gc2NyZWVuIHJlYWRlcnNcbiAgICAgICAgZXhwZWN0KGVsZW1lbnQpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=