d73a051662fb0c2c2d03985d8513014f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.AttachedFileSection = AttachedFileSection;
const jsx_runtime_1 = require("react/jsx-runtime");
const button_1 = require("@/components/ui/button");
const label_1 = require("@/components/ui/label");
const lucide_react_1 = require("lucide-react");
function AttachedFileSection({ entityType, entityId, filePath, fileName, fileSize, canView = true, canDownload = true, className = '', fallbackName = 'Attachment' }) {
    // Don't render if no file is attached
    if (!filePath) {
        return null;
    }
    // Generate API endpoint based on entity type
    const getApiEndpoint = (download = false) => {
        const downloadParam = download ? '?download=true' : '';
        switch (entityType) {
            case 'document':
                return `/api/documents/${entityId}/file${downloadParam}`;
            case 'bug':
                return `/api/bugs/${entityId}/file${downloadParam}`;
            case 'feature-request':
                return `/api/feature-requests/${entityId}/file${downloadParam}`;
            case 'bill':
                return `/api/bills/${entityId}/file${downloadParam}`;
            default:
                return '';
        }
    };
    const handleViewFile = () => {
        if (!canView || !filePath)
            return;
        const fileUrl = getApiEndpoint(false);
        window.open(fileUrl, '_blank');
    };
    const handleDownloadFile = async () => {
        if (!canDownload || !filePath)
            return;
        try {
            // Use fetch with credentials to ensure authentication
            const response = await fetch(getApiEndpoint(true), {
                method: 'GET',
                credentials: 'include', // Include authentication cookies
            });
            if (!response.ok) {
                throw new Error(`Download failed: ${response.status} ${response.statusText}`);
            }
            // Get the filename from Content-Disposition header or use existing name
            const contentDisposition = response.headers.get('Content-Disposition');
            let downloadFileName = fileName || fallbackName;
            if (contentDisposition) {
                const fileNameMatch = contentDisposition.match(/filename="([^"]+)"/);
                if (fileNameMatch) {
                    downloadFileName = fileNameMatch[1];
                }
            }
            // Convert response to blob and create download
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const link = window.document.createElement('a');
            link.href = url;
            link.download = downloadFileName;
            window.document.body.appendChild(link);
            link.click();
            // Clean up
            window.document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }
        catch (error) {
            console.error('[DOWNLOAD] File download failed:', error);
        }
    };
    const formatFileSize = (bytes) => {
        if (!bytes)
            return '';
        const kb = bytes / 1024;
        if (kb < 1024)
            return `${kb.toFixed(1)} KB`;
        const mb = kb / 1024;
        return `${mb.toFixed(1)} MB`;
    };
    // Fix encoding issues in filename display
    const decodeFileName = (name) => {
        if (!name)
            return name;
        try {
            // Fix common encoding issues like "procÃ¨s" -> "procès"
            return name
                .replace(/Ã¨/g, 'è')
                .replace(/Ã©/g, 'é')
                .replace(/Ã /g, 'à')
                .replace(/Ã´/g, 'ô')
                .replace(/Ã®/g, 'î')
                .replace(/Ã§/g, 'ç')
                .replace(/Ã¹/g, 'ù')
                .replace(/Ã»/g, 'û')
                .replace(/Ã¢/g, 'â')
                .replace(/Ãª/g, 'ê');
        }
        catch {
            return name;
        }
    };
    const displayName = decodeFileName(fileName) || fallbackName;
    const sizeText = formatFileSize(fileSize);
    return ((0, jsx_runtime_1.jsxs)("div", { className: `border-t pt-4 ${className}`, children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: "text-sm font-medium", children: "Attached File" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between p-3 bg-gray-50 rounded-lg mt-2", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center gap-2", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: "w-4 h-4 text-gray-500" }), (0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col", children: [(0, jsx_runtime_1.jsx)("span", { className: "text-sm font-medium", children: displayName }), sizeText && (0, jsx_runtime_1.jsx)("span", { className: "text-xs text-gray-500", children: sizeText })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [canView && ((0, jsx_runtime_1.jsxs)(button_1.Button, { type: "button", onClick: handleViewFile, disabled: !filePath, "data-testid": "button-view-file", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: "w-4 h-4 mr-2" }), "View"] })), canDownload && ((0, jsx_runtime_1.jsxs)(button_1.Button, { type: "button", variant: "outline", onClick: handleDownloadFile, disabled: !filePath, "data-testid": "button-download-file", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Download, { className: "w-4 h-4 mr-2" }), "Download"] }))] })] })] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvY29tbW9uL0F0dGFjaGVkRmlsZVNlY3Rpb24udHN4IiwibWFwcGluZ3MiOiI7O0FBeUJBLGtEQXlKQzs7QUFsTEQsbURBQWdEO0FBQ2hELGlEQUE4QztBQUM5QywrQ0FBa0Q7QUF1QmxELFNBQWdCLG1CQUFtQixDQUFDLEVBQ2xDLFVBQVUsRUFDVixRQUFRLEVBQ1IsUUFBUSxFQUNSLFFBQVEsRUFDUixRQUFRLEVBQ1IsT0FBTyxHQUFHLElBQUksRUFDZCxXQUFXLEdBQUcsSUFBSSxFQUNsQixTQUFTLEdBQUcsRUFBRSxFQUNkLFlBQVksR0FBRyxZQUFZLEVBQ0Y7SUFDekIsc0NBQXNDO0lBQ3RDLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztRQUNkLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELDZDQUE2QztJQUM3QyxNQUFNLGNBQWMsR0FBRyxDQUFDLFFBQVEsR0FBRyxLQUFLLEVBQUUsRUFBRTtRQUMxQyxNQUFNLGFBQWEsR0FBRyxRQUFRLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7UUFDdkQsUUFBUSxVQUFVLEVBQUUsQ0FBQztZQUNuQixLQUFLLFVBQVU7Z0JBQ2IsT0FBTyxrQkFBa0IsUUFBUSxRQUFRLGFBQWEsRUFBRSxDQUFDO1lBQzNELEtBQUssS0FBSztnQkFDUixPQUFPLGFBQWEsUUFBUSxRQUFRLGFBQWEsRUFBRSxDQUFDO1lBQ3RELEtBQUssaUJBQWlCO2dCQUNwQixPQUFPLHlCQUF5QixRQUFRLFFBQVEsYUFBYSxFQUFFLENBQUM7WUFDbEUsS0FBSyxNQUFNO2dCQUNULE9BQU8sY0FBYyxRQUFRLFFBQVEsYUFBYSxFQUFFLENBQUM7WUFDdkQ7Z0JBQ0UsT0FBTyxFQUFFLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQyxDQUFDO0lBRUYsTUFBTSxjQUFjLEdBQUcsR0FBRyxFQUFFO1FBQzFCLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxR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U0FBUyxFQUFDLHVCQUF1QixZQUFFLFFBQVEsR0FBUSxJQUNsRSxJQUNGLEVBQ04saUNBQUssU0FBUyxFQUFDLFlBQVksYUFDeEIsT0FBTyxJQUFJLENBQ1Ysd0JBQUMsZUFBTSxJQUNMLElBQUksRUFBQyxRQUFRLEVBQ2IsT0FBTyxFQUFFLGNBQWMsRUFDdkIsUUFBUSxFQUFFLENBQUMsUUFBUSxpQkFDUCxrQkFBa0IsYUFFOUIsdUJBQUMsdUJBQVEsSUFBQyxTQUFTLEVBQUMsY0FBYyxHQUFHLFlBRTlCLENBQ1YsRUFDQSxXQUFXLElBQUksQ0FDZCx3QkFBQyxlQUFNLElBQ0wsSUFBSSxFQUFDLFFBQVEsRUFDYixPQUFPLEVBQUMsU0FBUyxFQUNqQixPQUFPLEVBQUUsa0JBQWtCLEVBQzNCLFFBQVEsRUFBRSxDQUFDLFFBQVEsaUJBQ1Asc0JBQXNCLGFBRWxDLHVCQUFDLHVCQUFRLElBQUMsU0FBUyxFQUFDLGNBQWMsR0FBRyxnQkFFOUIsQ0FDVixJQUNHLElBQ0YsSUFDRixDQUNQLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvY2xpZW50L3NyYy9jb21wb25lbnRzL2NvbW1vbi9BdHRhY2hlZEZpbGVTZWN0aW9uLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCdXR0b24gfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvYnV0dG9uJztcbmltcG9ydCB7IExhYmVsIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2xhYmVsJztcbmltcG9ydCB7IEZpbGVUZXh0LCBEb3dubG9hZCB9IGZyb20gJ2x1Y2lkZS1yZWFjdCc7XG5cbmludGVyZmFjZSBBdHRhY2hlZEZpbGVTZWN0aW9uUHJvcHMge1xuICAvLyBFbnRpdHkgaW5mb3JtYXRpb25cbiAgZW50aXR5VHlwZTogJ2RvY3VtZW50JyB8ICdidWcnIHwgJ2ZlYXR1cmUtcmVxdWVzdCcgfCAnYmlsbCc7XG4gIGVudGl0eUlkOiBzdHJpbmc7XG4gIFxuICAvLyBGaWxlIGluZm9ybWF0aW9uXG4gIGZpbGVQYXRoPzogc3RyaW5nIHwgbnVsbDtcbiAgZmlsZU5hbWU/OiBzdHJpbmcgfCBudWxsO1xuICBmaWxlU2l6ZT86IG51bWJlciB8IG51bGw7XG4gIFxuICAvLyBQZXJtaXNzaW9uc1xuICBjYW5WaWV3PzogYm9vbGVhbjtcbiAgY2FuRG93bmxvYWQ/OiBib29sZWFuO1xuICBcbiAgLy8gT3B0aW9uYWwgc3R5bGluZ1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG4gIFxuICAvLyBPcHRpb25hbCBmYWxsYmFjayBuYW1lXG4gIGZhbGxiYWNrTmFtZT86IHN0cmluZztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEF0dGFjaGVkRmlsZVNlY3Rpb24oe1xuICBlbnRpdHlUeXBlLFxuICBlbnRpdHlJZCxcbiAgZmlsZVBhdGgsXG4gIGZpbGVOYW1lLFxuICBmaWxlU2l6ZSxcbiAgY2FuVmlldyA9IHRydWUsXG4gIGNhbkRvd25sb2FkID0gdHJ1ZSxcbiAgY2xhc3NOYW1lID0gJycsXG4gIGZhbGxiYWNrTmFtZSA9ICdBdHRhY2htZW50J1xufTogQXR0YWNoZWRGaWxlU2VjdGlvblByb3BzKSB7XG4gIC8vIERvbid0IHJlbmRlciBpZiBubyBmaWxlIGlzIGF0dGFjaGVkXG4gIGlmICghZmlsZVBhdGgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8vIEdlbmVyYXRlIEFQSSBlbmRwb2ludCBiYXNlZCBvbiBlbnRpdHkgdHlwZVxuICBjb25zdCBnZXRBcGlFbmRwb2ludCA9IChkb3dubG9hZCA9IGZhbHNlKSA9PiB7XG4gICAgY29uc3QgZG93bmxvYWRQYXJhbSA9IGRvd25sb2FkID8gJz9kb3dubG9hZD10cnVlJyA6ICcnO1xuICAgIHN3aXRjaCAoZW50aXR5VHlwZSkge1xuICAgICAgY2FzZSAnZG9jdW1lbnQnOlxuICAgICAgICByZXR1cm4gYC9hcGkvZG9jdW1lbnRzLyR7ZW50aXR5SWR9L2ZpbGUke2Rvd25sb2FkUGFyYW19YDtcbiAgICAgIGNhc2UgJ2J1Zyc6XG4gICAgICAgIHJldHVybiBgL2FwaS9idWdzLyR7ZW50aXR5SWR9L2ZpbGUke2Rvd25sb2FkUGFyYW19YDtcbiAgICAgIGNhc2UgJ2ZlYXR1cmUtcmVxdWVzdCc6XG4gICAgICAgIHJldHVybiBgL2FwaS9mZWF0dXJlLXJlcXVlc3RzLyR7ZW50aXR5SWR9L2ZpbGUke2Rvd25sb2FkUGFyYW19YDtcbiAgICAgIGNhc2UgJ2JpbGwnOlxuICAgICAgICByZXR1cm4gYC9hcGkvYmlsbHMvJHtlbnRpdHlJZH0vZmlsZSR7ZG93bmxvYWRQYXJhbX1gO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoYW5kbGVWaWV3RmlsZSA9ICgpID0+IHtcbiAgICBpZiAoIWNhblZpZXcgfHwgIWZpbGVQYXRoKSByZXR1cm47XG4gICAgY29uc3QgZmlsZVVybCA9IGdldEFwaUVuZHBvaW50KGZhbHNlKTtcbiAgICB3aW5kb3cub3BlbihmaWxlVXJsLCAnX2JsYW5rJyk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlRG93bmxvYWRGaWxlID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghY2FuRG93bmxvYWQgfHwgIWZpbGVQYXRoKSByZXR1cm47XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBmZXRjaCB3aXRoIGNyZWRlbnRpYWxzIHRvIGVuc3VyZSBhdXRoZW50aWNhdGlvblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChnZXRBcGlFbmRwb2ludCh0cnVlKSwge1xuICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLCAvLyBJbmNsdWRlIGF1dGhlbnRpY2F0aW9uIGNvb2tpZXNcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRG93bmxvYWQgZmFpbGVkOiAke3Jlc3BvbnNlLnN0YXR1c30gJHtyZXNwb25zZS5zdGF0dXNUZXh0fWApO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGZpbGVuYW1lIGZyb20gQ29udGVudC1EaXNwb3NpdGlvbiBoZWFkZXIgb3IgdXNlIGV4aXN0aW5nIG5hbWVcbiAgICAgIGNvbnN0IGNvbnRlbnREaXNwb3NpdGlvbiA9IHJlc3BvbnNlLmhlYWRlcnMuZ2V0KCdDb250ZW50LURpc3Bvc2l0aW9uJyk7XG4gICAgICBsZXQgZG93bmxvYWRGaWxlTmFtZSA9IGZpbGVOYW1lIHx8IGZhbGxiYWNrTmFtZTtcbiAgICAgIFxuICAgICAgaWYgKGNvbnRlbnREaXNwb3NpdGlvbikge1xuICAgICAgICBjb25zdCBmaWxlTmFtZU1hdGNoID0gY29udGVudERpc3Bvc2l0aW9uLm1hdGNoKC9maWxlbmFtZT1cIihbXlwiXSspXCIvKTtcbiAgICAgICAgaWYgKGZpbGVOYW1lTWF0Y2gpIHtcbiAgICAgICAgICBkb3dubG9hZEZpbGVOYW1lID0gZmlsZU5hbWVNYXRjaFsxXTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDb252ZXJ0IHJlc3BvbnNlIHRvIGJsb2IgYW5kIGNyZWF0ZSBkb3dubG9hZFxuICAgICAgY29uc3QgYmxvYiA9IGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcbiAgICAgIGNvbnN0IHVybCA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpO1xuICAgICAgXG4gICAgICBjb25zdCBsaW5rID0gd2luZG93LmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgIGxpbmsuaHJlZiA9IHVybDtcbiAgICAgIGxpbmsuZG93bmxvYWQgPSBkb3dubG9hZEZpbGVOYW1lO1xuICAgICAgd2luZG93LmRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7XG4gICAgICBsaW5rLmNsaWNrKCk7XG4gICAgICBcbiAgICAgIC8vIENsZWFuIHVwXG4gICAgICB3aW5kb3cuZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChsaW5rKTtcbiAgICAgIHdpbmRvdy5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tET1dOTE9BRF0gRmlsZSBkb3dubG9hZCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBmb3JtYXRGaWxlU2l6ZSA9IChieXRlcz86IG51bWJlciB8IG51bGwpID0+IHtcbiAgICBpZiAoIWJ5dGVzKSByZXR1cm4gJyc7XG4gICAgY29uc3Qga2IgPSBieXRlcyAvIDEwMjQ7XG4gICAgaWYgKGtiIDwgMTAyNCkgcmV0dXJuIGAke2tiLnRvRml4ZWQoMSl9IEtCYDtcbiAgICBjb25zdCBtYiA9IGtiIC8gMTAyNDtcbiAgICByZXR1cm4gYCR7bWIudG9GaXhlZCgxKX0gTUJgO1xuICB9O1xuXG4gIC8vIEZpeCBlbmNvZGluZyBpc3N1ZXMgaW4gZmlsZW5hbWUgZGlzcGxheVxuICBjb25zdCBkZWNvZGVGaWxlTmFtZSA9IChuYW1lOiBzdHJpbmcpID0+IHtcbiAgICBpZiAoIW5hbWUpIHJldHVybiBuYW1lO1xuICAgIHRyeSB7XG4gICAgICAvLyBGaXggY29tbW9uIGVuY29kaW5nIGlzc3VlcyBsaWtlIFwicHJvY8ODwqhzXCIgLT4gXCJwcm9jw6hzXCJcbiAgICAgIHJldHVybiBuYW1lXG4gICAgICAgIC5yZXBsYWNlKC/Dg8KoL2csICfDqCcpXG4gICAgICAgIC5yZXBsYWNlKC/Dg8KpL2csICfDqScpXG4gICAgICAgIC5yZXBsYWNlKC/DgyAvZywgJ8OgJylcbiAgICAgICAgLnJlcGxhY2UoL8ODwrQvZywgJ8O0JylcbiAgICAgICAgLnJlcGxhY2UoL8ODwq4vZywgJ8OuJylcbiAgICAgICAgLnJlcGxhY2UoL8ODwqcvZywgJ8OnJylcbiAgICAgICAgLnJlcGxhY2UoL8ODwrkvZywgJ8O5JylcbiAgICAgICAgLnJlcGxhY2UoL8ODwrsvZywgJ8O7JylcbiAgICAgICAgLnJlcGxhY2UoL8ODwqIvZywgJ8OiJylcbiAgICAgICAgLnJlcGxhY2UoL8ODwqovZywgJ8OqJyk7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gbmFtZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZGlzcGxheU5hbWUgPSBkZWNvZGVGaWxlTmFtZShmaWxlTmFtZSkgfHwgZmFsbGJhY2tOYW1lO1xuICBjb25zdCBzaXplVGV4dCA9IGZvcm1hdEZpbGVTaXplKGZpbGVTaXplKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtgYm9yZGVyLXQgcHQtNCAke2NsYXNzTmFtZX1gfT5cbiAgICAgIDxMYWJlbCBjbGFzc05hbWU9XCJ0ZXh0LXNtIGZvbnQtbWVkaXVtXCI+QXR0YWNoZWQgRmlsZTwvTGFiZWw+XG4gICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBwLTMgYmctZ3JheS01MCByb3VuZGVkLWxnIG10LTJcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMlwiPlxuICAgICAgICAgIDxGaWxlVGV4dCBjbGFzc05hbWU9XCJ3LTQgaC00IHRleHQtZ3JheS01MDBcIiAvPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbFwiPlxuICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC1zbSBmb250LW1lZGl1bVwiPntkaXNwbGF5TmFtZX08L3NwYW4+XG4gICAgICAgICAgICB7c2l6ZVRleHQgJiYgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LWdyYXktNTAwXCI+e3NpemVUZXh0fTwvc3Bhbj59XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggZ2FwLTJcIj5cbiAgICAgICAgICB7Y2FuVmlldyAmJiAoXG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHR5cGU9XCJidXR0b25cIlxuICAgICAgICAgICAgICBvbkNsaWNrPXtoYW5kbGVWaWV3RmlsZX1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFmaWxlUGF0aH1cbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJidXR0b24tdmlldy1maWxlXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPEZpbGVUZXh0IGNsYXNzTmFtZT1cInctNCBoLTQgbXItMlwiIC8+XG4gICAgICAgICAgICAgIFZpZXdcbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICl9XG4gICAgICAgICAge2NhbkRvd25sb2FkICYmIChcbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgdHlwZT1cImJ1dHRvblwiXG4gICAgICAgICAgICAgIHZhcmlhbnQ9XCJvdXRsaW5lXCJcbiAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlRG93bmxvYWRGaWxlfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17IWZpbGVQYXRofVxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD1cImJ1dHRvbi1kb3dubG9hZC1maWxlXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPERvd25sb2FkIGNsYXNzTmFtZT1cInctNCBoLTQgbXItMlwiIC8+XG4gICAgICAgICAgICAgIERvd25sb2FkXG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICApO1xufSJdLCJ2ZXJzaW9uIjozfQ==