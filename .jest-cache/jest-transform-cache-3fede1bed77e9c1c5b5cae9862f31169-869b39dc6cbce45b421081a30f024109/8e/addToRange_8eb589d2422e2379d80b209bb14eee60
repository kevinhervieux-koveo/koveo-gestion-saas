95ac9fbc3f5c0814a06edaa847d257b6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addToRange = addToRange;
const DateLib_js_1 = require("../classes/DateLib.js");
/**
 * Adds a date to an existing range, considering constraints like minimum and
 * maximum range size.
 *
 * @param date - The date to add to the range.
 * @param initialRange - The initial range to which the date will be added.
 * @param min - The minimum number of days in the range.
 * @param max - The maximum number of days in the range.
 * @param required - Whether the range must always include at least one date.
 * @param dateLib - The date utility library instance.
 * @returns The updated date range, or `undefined` if the range is cleared.
 * @group Utilities
 */
function addToRange(date, initialRange, min = 0, max = 0, required = false, dateLib = DateLib_js_1.defaultDateLib) {
    const { from, to } = initialRange || {};
    const { isSameDay, isAfter, isBefore } = dateLib;
    let range;
    if (!from && !to) {
        // the range is empty, add the date
        range = { from: date, to: min > 0 ? undefined : date };
    }
    else if (from && !to) {
        // adding date to an incomplete range
        if (isSameDay(from, date)) {
            // adding a date equal to the start of the range
            if (min === 0) {
                range = { from, to: date };
            }
            else if (required) {
                range = { from, to: undefined };
            }
            else {
                range = undefined;
            }
        }
        else if (isBefore(date, from)) {
            // adding a date before the start of the range
            range = { from: date, to: from };
        }
        else {
            // adding a date after the start of the range
            range = { from, to: date };
        }
    }
    else if (from && to) {
        // adding date to a complete range
        if (isSameDay(from, date) && isSameDay(to, date)) {
            // adding a date that is equal to both start and end of the range
            if (required) {
                range = { from, to };
            }
            else {
                range = undefined;
            }
        }
        else if (isSameDay(from, date)) {
            // adding a date equal to the the start of the range
            range = { from, to: min > 0 ? undefined : date };
        }
        else if (isSameDay(to, date)) {
            // adding a dare equal to the end of the range
            range = { from: date, to: min > 0 ? undefined : date };
        }
        else if (isBefore(date, from)) {
            // adding a date before the start of the range
            range = { from: date, to: to };
        }
        else if (isAfter(date, from)) {
            // adding a date after the start of the range
            range = { from, to: date };
        }
        else if (isAfter(date, to)) {
            // adding a date after the end of the range
            range = { from, to: date };
        }
        else {
            throw new Error("Invalid range");
        }
    }
    // check for min / max
    if (range?.from && range?.to) {
        const diff = dateLib.differenceInCalendarDays(range.to, range.from);
        if (max > 0 && diff > max) {
            range = { from: date, to: undefined };
        }
        else if (min > 1 && diff < min) {
            range = { from: date, to: undefined };
        }
    }
    return range;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvcmVhY3QtZGF5LXBpY2tlci9kaXN0L2Nqcy91dGlscy9hZGRUb1JhbmdlLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUNiLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQzlELE9BQU8sQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0FBQ2hDLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ3REOzs7Ozs7Ozs7Ozs7R0FZRztBQUNILFNBQVMsVUFBVSxDQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLEdBQUcsQ0FBQyxFQUFFLFFBQVEsR0FBRyxLQUFLLEVBQUUsT0FBTyxHQUFHLFlBQVksQ0FBQyxjQUFjO0lBQzdHLE1BQU0sRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEdBQUcsWUFBWSxJQUFJLEVBQUUsQ0FBQztJQUN4QyxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxRQUFRLEVBQUUsR0FBRyxPQUFPLENBQUM7SUFDakQsSUFBSSxLQUFLLENBQUM7SUFDVixJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDZixtQ0FBbUM7UUFDbkMsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUMzRCxDQUFDO1NBQ0ksSUFBSSxJQUFJLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztRQUNuQixxQ0FBcUM7UUFDckMsSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDeEIsZ0RBQWdEO1lBQ2hELElBQUksR0FBRyxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNaLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUM7WUFDL0IsQ0FBQztpQkFDSSxJQUFJLFFBQVEsRUFBRSxDQUFDO2dCQUNoQixLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQ3BDLENBQUM7aUJBQ0ksQ0FBQztnQkFDRixLQUFLLEdBQUcsU0FBUyxDQUFDO1lBQ3RCLENBQUM7UUFDTCxDQUFDO2FBQ0ksSUFBSSxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUIsOENBQThDO1lBQzlDLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDO1FBQ3JDLENBQUM7YUFDSSxDQUFDO1lBQ0YsNkNBQTZDO1lBQzdDLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDL0IsQ0FBQztJQUNMLENBQUM7U0FDSSxJQUFJLElBQUksSUFBSSxFQUFFLEVBQUUsQ0FBQztRQUNsQixrQ0FBa0M7UUFDbEMsSUFBSSxTQUFTLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLFNBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMvQyxpRUFBaUU7WUFDakUsSUFBSSxRQUFRLEVBQUUsQ0FBQztnQkFDWCxLQUFLLEdBQUcsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUM7WUFDekIsQ0FBQztpQkFDSSxDQUFDO2dCQUNGLEtBQUssR0FBRyxTQUFTLENBQUM7WUFDdEIsQ0FBQztRQUNMLENBQUM7YUFDSSxJQUFJLFNBQVMsQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUM3QixvREFBb0Q7WUFDcEQsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3JELENBQUM7YUFDSSxJQUFJLFNBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMzQiw4Q0FBOEM7WUFDOUMsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUMzRCxDQUFDO2FBQ0ksSUFBSSxRQUFRLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUM7WUFDNUIsOENBQThDO1lBQzlDLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBQ25DLENBQUM7YUFDSSxJQUFJLE9BQU8sQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUMzQiw2Q0FBNkM7WUFDN0MsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUMvQixDQUFDO2FBQ0ksSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxFQUFFLENBQUM7WUFDekIsMkNBQTJDO1lBQzNDLEtBQUssR0FBRyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLENBQUM7UUFDL0IsQ0FBQzthQUNJLENBQUM7WUFDRixNQUFNLElBQUksS0FBSyxDQUFDLGVBQWUsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7SUFDTCxDQUFDO0lBQ0Qsc0JBQXNCO0lBQ3RCLElBQUksS0FBSyxFQUFFLElBQUksSUFBSSxLQUFLLEVBQUUsRUFBRSxFQUFFLENBQUM7UUFDM0IsTUFBTSxJQUFJLEdBQUcsT0FBTyxDQUFDLHdCQUF3QixDQUFDLEtBQUssQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BFLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDeEIsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUM7UUFDMUMsQ0FBQzthQUNJLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsR0FBRyxFQUFFLENBQUM7WUFDN0IsS0FBSyxHQUFHLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUM7UUFDMUMsQ0FBQztJQUNMLENBQUM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvbm9kZV9tb2R1bGVzL3JlYWN0LWRheS1waWNrZXIvZGlzdC9janMvdXRpbHMvYWRkVG9SYW5nZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuYWRkVG9SYW5nZSA9IGFkZFRvUmFuZ2U7XG5jb25zdCBEYXRlTGliX2pzXzEgPSByZXF1aXJlKFwiLi4vY2xhc3Nlcy9EYXRlTGliLmpzXCIpO1xuLyoqXG4gKiBBZGRzIGEgZGF0ZSB0byBhbiBleGlzdGluZyByYW5nZSwgY29uc2lkZXJpbmcgY29uc3RyYWludHMgbGlrZSBtaW5pbXVtIGFuZFxuICogbWF4aW11bSByYW5nZSBzaXplLlxuICpcbiAqIEBwYXJhbSBkYXRlIC0gVGhlIGRhdGUgdG8gYWRkIHRvIHRoZSByYW5nZS5cbiAqIEBwYXJhbSBpbml0aWFsUmFuZ2UgLSBUaGUgaW5pdGlhbCByYW5nZSB0byB3aGljaCB0aGUgZGF0ZSB3aWxsIGJlIGFkZGVkLlxuICogQHBhcmFtIG1pbiAtIFRoZSBtaW5pbXVtIG51bWJlciBvZiBkYXlzIGluIHRoZSByYW5nZS5cbiAqIEBwYXJhbSBtYXggLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgZGF5cyBpbiB0aGUgcmFuZ2UuXG4gKiBAcGFyYW0gcmVxdWlyZWQgLSBXaGV0aGVyIHRoZSByYW5nZSBtdXN0IGFsd2F5cyBpbmNsdWRlIGF0IGxlYXN0IG9uZSBkYXRlLlxuICogQHBhcmFtIGRhdGVMaWIgLSBUaGUgZGF0ZSB1dGlsaXR5IGxpYnJhcnkgaW5zdGFuY2UuXG4gKiBAcmV0dXJucyBUaGUgdXBkYXRlZCBkYXRlIHJhbmdlLCBvciBgdW5kZWZpbmVkYCBpZiB0aGUgcmFuZ2UgaXMgY2xlYXJlZC5cbiAqIEBncm91cCBVdGlsaXRpZXNcbiAqL1xuZnVuY3Rpb24gYWRkVG9SYW5nZShkYXRlLCBpbml0aWFsUmFuZ2UsIG1pbiA9IDAsIG1heCA9IDAsIHJlcXVpcmVkID0gZmFsc2UsIGRhdGVMaWIgPSBEYXRlTGliX2pzXzEuZGVmYXVsdERhdGVMaWIpIHtcbiAgICBjb25zdCB7IGZyb20sIHRvIH0gPSBpbml0aWFsUmFuZ2UgfHwge307XG4gICAgY29uc3QgeyBpc1NhbWVEYXksIGlzQWZ0ZXIsIGlzQmVmb3JlIH0gPSBkYXRlTGliO1xuICAgIGxldCByYW5nZTtcbiAgICBpZiAoIWZyb20gJiYgIXRvKSB7XG4gICAgICAgIC8vIHRoZSByYW5nZSBpcyBlbXB0eSwgYWRkIHRoZSBkYXRlXG4gICAgICAgIHJhbmdlID0geyBmcm9tOiBkYXRlLCB0bzogbWluID4gMCA/IHVuZGVmaW5lZCA6IGRhdGUgfTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZnJvbSAmJiAhdG8pIHtcbiAgICAgICAgLy8gYWRkaW5nIGRhdGUgdG8gYW4gaW5jb21wbGV0ZSByYW5nZVxuICAgICAgICBpZiAoaXNTYW1lRGF5KGZyb20sIGRhdGUpKSB7XG4gICAgICAgICAgICAvLyBhZGRpbmcgYSBkYXRlIGVxdWFsIHRvIHRoZSBzdGFydCBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIGlmIChtaW4gPT09IDApIHtcbiAgICAgICAgICAgICAgICByYW5nZSA9IHsgZnJvbSwgdG86IGRhdGUgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHJlcXVpcmVkKSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB7IGZyb20sIHRvOiB1bmRlZmluZWQgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJhbmdlID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzQmVmb3JlKGRhdGUsIGZyb20pKSB7XG4gICAgICAgICAgICAvLyBhZGRpbmcgYSBkYXRlIGJlZm9yZSB0aGUgc3RhcnQgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByYW5nZSA9IHsgZnJvbTogZGF0ZSwgdG86IGZyb20gfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGFkZGluZyBhIGRhdGUgYWZ0ZXIgdGhlIHN0YXJ0IG9mIHRoZSByYW5nZVxuICAgICAgICAgICAgcmFuZ2UgPSB7IGZyb20sIHRvOiBkYXRlIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoZnJvbSAmJiB0bykge1xuICAgICAgICAvLyBhZGRpbmcgZGF0ZSB0byBhIGNvbXBsZXRlIHJhbmdlXG4gICAgICAgIGlmIChpc1NhbWVEYXkoZnJvbSwgZGF0ZSkgJiYgaXNTYW1lRGF5KHRvLCBkYXRlKSkge1xuICAgICAgICAgICAgLy8gYWRkaW5nIGEgZGF0ZSB0aGF0IGlzIGVxdWFsIHRvIGJvdGggc3RhcnQgYW5kIGVuZCBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIGlmIChyZXF1aXJlZCkge1xuICAgICAgICAgICAgICAgIHJhbmdlID0geyBmcm9tLCB0byB9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmFuZ2UgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNTYW1lRGF5KGZyb20sIGRhdGUpKSB7XG4gICAgICAgICAgICAvLyBhZGRpbmcgYSBkYXRlIGVxdWFsIHRvIHRoZSB0aGUgc3RhcnQgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByYW5nZSA9IHsgZnJvbSwgdG86IG1pbiA+IDAgPyB1bmRlZmluZWQgOiBkYXRlIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNTYW1lRGF5KHRvLCBkYXRlKSkge1xuICAgICAgICAgICAgLy8gYWRkaW5nIGEgZGFyZSBlcXVhbCB0byB0aGUgZW5kIG9mIHRoZSByYW5nZVxuICAgICAgICAgICAgcmFuZ2UgPSB7IGZyb206IGRhdGUsIHRvOiBtaW4gPiAwID8gdW5kZWZpbmVkIDogZGF0ZSB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzQmVmb3JlKGRhdGUsIGZyb20pKSB7XG4gICAgICAgICAgICAvLyBhZGRpbmcgYSBkYXRlIGJlZm9yZSB0aGUgc3RhcnQgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByYW5nZSA9IHsgZnJvbTogZGF0ZSwgdG86IHRvIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaXNBZnRlcihkYXRlLCBmcm9tKSkge1xuICAgICAgICAgICAgLy8gYWRkaW5nIGEgZGF0ZSBhZnRlciB0aGUgc3RhcnQgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByYW5nZSA9IHsgZnJvbSwgdG86IGRhdGUgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChpc0FmdGVyKGRhdGUsIHRvKSkge1xuICAgICAgICAgICAgLy8gYWRkaW5nIGEgZGF0ZSBhZnRlciB0aGUgZW5kIG9mIHRoZSByYW5nZVxuICAgICAgICAgICAgcmFuZ2UgPSB7IGZyb20sIHRvOiBkYXRlIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIHJhbmdlXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGNoZWNrIGZvciBtaW4gLyBtYXhcbiAgICBpZiAocmFuZ2U/LmZyb20gJiYgcmFuZ2U/LnRvKSB7XG4gICAgICAgIGNvbnN0IGRpZmYgPSBkYXRlTGliLmRpZmZlcmVuY2VJbkNhbGVuZGFyRGF5cyhyYW5nZS50bywgcmFuZ2UuZnJvbSk7XG4gICAgICAgIGlmIChtYXggPiAwICYmIGRpZmYgPiBtYXgpIHtcbiAgICAgICAgICAgIHJhbmdlID0geyBmcm9tOiBkYXRlLCB0bzogdW5kZWZpbmVkIH07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobWluID4gMSAmJiBkaWZmIDwgbWluKSB7XG4gICAgICAgICAgICByYW5nZSA9IHsgZnJvbTogZGF0ZSwgdG86IHVuZGVmaW5lZCB9O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByYW5nZTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==