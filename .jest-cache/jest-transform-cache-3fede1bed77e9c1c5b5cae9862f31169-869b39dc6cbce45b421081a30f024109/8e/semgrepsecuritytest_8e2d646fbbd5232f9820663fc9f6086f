345300665a7572d24bb16c85ecc6ee5a
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
describe('Semgrep Security Tests', () => {
    let semgrepResults;
    beforeAll(() => {
        // Ensure reports directory exists
        if (!fs.existsSync('reports')) {
            fs.mkdirSync('reports', { recursive: true });
        }
        // Run Semgrep scan and capture results
        try {
            const semgrepOutput = (0, child_process_1.execSync)('npx semgrep --config=.semgrep.yml --json --no-git-ignore --include="*.ts" --include="*.tsx" .', {
                encoding: 'utf-8',
                stdio: ['pipe', 'pipe', 'pipe'],
                timeout: 30000
            });
            semgrepResults = JSON.parse(semgrepOutput);
            // Save results to reports directory
            fs.writeFileSync('reports/semgrep-results.json', JSON.stringify(semgrepResults, null, 2));
        }
        catch (error) {
            // Semgrep may exit with code 1 when findings are detected, which is expected
            if (error.stdout) {
                try {
                    semgrepResults = JSON.parse(error.stdout);
                    fs.writeFileSync('reports/semgrep-results.json', JSON.stringify(semgrepResults, null, 2));
                }
                catch (parseError) {
                    console.warn('Semgrep output parsing failed, using empty results');
                    semgrepResults = { results: [] };
                }
            }
            else {
                console.warn('Semgrep execution completed with no output, using empty results');
                semgrepResults = { results: [] };
            }
        }
    });
    describe('Security Rule Validation', () => {
        test('should detect hardcoded secrets', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'hardcoded-secrets') || [];
            // Should not have any hardcoded secrets in production code
            expect(violations.length).toBe(0);
        });
        test('should detect SQL injection vulnerabilities', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'sql-injection-prevention') || [];
            // Should not have any SQL injection vulnerabilities
            expect(violations.length).toBe(0);
        });
        test('should detect XSS vulnerabilities in React components', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'xss-prevention-react') || [];
            // Should not have any unvalidated dangerouslySetInnerHTML usage
            expect(violations.length).toBe(0);
        });
        test('should detect weak cryptographic usage', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'weak-crypto-usage') || [];
            // Should not use weak crypto algorithms
            expect(violations.length).toBe(0);
        });
        test('should detect command injection risks', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'command-injection-risk') || [];
            // Should not have command injection vulnerabilities
            expect(violations.length).toBe(0);
        });
        test('should detect directory traversal vulnerabilities', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'directory-traversal-prevention') || [];
            // Should not have path traversal vulnerabilities
            expect(violations.length).toBe(0);
        });
        test('should detect environment variable exposure', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'env-var-exposure') || [];
            // Should not expose environment variables in logs
            expect(violations.length).toBe(0);
        });
        test('should detect database connection exposure', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'database-connection-exposure') || [];
            // Should not expose database connection details
            expect(violations.length).toBe(0);
        });
    });
    describe('Quebec Law 25 Compliance', () => {
        test('should flag potential personal data logging violations', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'law25-sensitive-data-logging') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ Potential Law 25 violations found:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // This is informational - log violations but don't fail the test
            expect(violations).toBeDefined();
        });
        test('should flag cross-border data transfer without consent', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'law25-cross-border-transfer') || [];
            // Critical compliance issue
            expect(violations.length).toBe(0);
        });
        test('should flag missing encryption for sensitive data', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'law25-encryption-at-rest') || [];
            // Critical compliance issue
            expect(violations.length).toBe(0);
        });
        test('should flag insecure communication protocols', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'law25-secure-communication') || [];
            // Critical compliance issue
            expect(violations.length).toBe(0);
        });
    });
    describe('Express.js Security', () => {
        test('should detect CORS wildcard misconfigurations', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'express-cors-wildcard') || [];
            // Should not have overly permissive CORS
            expect(violations.length).toBe(0);
        });
        test('should detect missing rate limiting on auth endpoints', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'missing-rate-limiting') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ Auth endpoints without rate limiting:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Warning level - log but don't fail
            expect(violations).toBeDefined();
        });
        test('should detect insecure session configurations', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'session-security-missing') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ Session security issues:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Warning level - check but don't fail tests
            expect(violations).toBeDefined();
        });
    });
    describe('React Security', () => {
        test('should detect external links without security attributes', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'react-external-links') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ External links missing rel attributes:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Warning level - informational
            expect(violations).toBeDefined();
        });
        test('should detect potential prototype pollution', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'prototype-pollution-risk') || [];
            // Critical security issue
            expect(violations.length).toBe(0);
        });
    });
    describe('Property Management Security', () => {
        test('should protect tenant financial data', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'tenant-financial-data-protection') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ Tenant financial data protection concerns:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Domain-specific warning
            expect(violations).toBeDefined();
        });
        test('should protect building access data', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'building-access-data-security') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ Building access data security concerns:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Domain-specific warning
            expect(violations).toBeDefined();
        });
    });
    describe('File Upload Security', () => {
        test('should detect insecure file upload configurations', () => {
            const violations = semgrepResults.results?.filter((result) => result.check_id === 'file-upload-security') || [];
            if (violations.length > 0) {
                console.warn('âš ï¸ File upload security issues:', violations.length);
                violations.forEach((v) => {
                    console.warn(`  - ${v.path}:${v.start.line} - ${v.message}`);
                });
            }
            // Warning level - should be addressed
            expect(violations).toBeDefined();
        });
    });
    describe('Security Summary Report', () => {
        test('should generate security summary report', () => {
            const totalFindings = semgrepResults.results?.length || 0;
            const criticalFindings = semgrepResults.results?.filter((r) => r.severity === 'ERROR').length || 0;
            const warningFindings = semgrepResults.results?.filter((r) => r.severity === 'WARNING').length || 0;
            const infoFindings = semgrepResults.results?.filter((r) => r.severity === 'INFO').length || 0;
            const summary = {
                totalFindings,
                criticalFindings,
                warningFindings,
                infoFindings,
                scanDate: new Date().toISOString(),
                rulesApplied: semgrepResults.results?.map((r) => r.check_id).filter((id, index, array) => array.indexOf(id) === index) || []
            };
            // Save security summary
            fs.writeFileSync('reports/security-summary.json', JSON.stringify(summary, null, 2));
            console.log('\nðŸ”’ Security Scan Summary:');
            console.log(`   Total findings: ${totalFindings}`);
            console.log(`   Critical: ${criticalFindings}`);
            console.log(`   Warnings: ${warningFindings}`);
            console.log(`   Info: ${infoFindings}`);
            console.log(`   Rules applied: ${summary.rulesApplied.length}`);
            // Test should pass if no critical findings
            expect(criticalFindings).toBe(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9zZWN1cml0eS9zZW1ncmVwLXNlY3VyaXR5LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBeUM7QUFDekMsdUNBQXlCO0FBR3pCLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDdEMsSUFBSSxjQUFtQixDQUFDO0lBRXhCLFNBQVMsQ0FBQyxHQUFHLEVBQUU7UUFDYixrQ0FBa0M7UUFDbEMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxVQUFVLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQztZQUM5QixFQUFFLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUM7UUFFRCx1Q0FBdUM7UUFDdkMsSUFBSSxDQUFDO1lBQ0gsTUFBTSxhQUFhLEdBQUcsSUFBQSx3QkFBUSxFQUM1QiwrRkFBK0YsRUFDL0Y7Z0JBQ0UsUUFBUSxFQUFFLE9BQU87Z0JBQ2pCLEtBQUssRUFBRSxDQUFDLE1BQU0sRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDO2dCQUMvQixPQUFPLEVBQUUsS0FBSzthQUNmLENBQ0YsQ0FBQztZQUNGLGNBQWMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBRTNDLG9DQUFvQztZQUNwQyxFQUFFLENBQUMsYUFBYSxDQUFDLDhCQUE4QixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVGLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLDZFQUE2RTtZQUM3RSxJQUFJLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQztnQkFDakIsSUFBSSxDQUFDO29CQUNILGNBQWMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDMUMs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QUcsQ0FBQyxnQkFBZ0IsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO1lBQ2hELE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLGVBQWUsRUFBRSxDQUFDLENBQUM7WUFDL0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLFlBQVksRUFBRSxDQUFDLENBQUM7WUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsT0FBTyxDQUFDLFlBQVksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBRWhFLDJDQUEyQztZQUMzQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvc2VjdXJpdHkvc2VtZ3JlcC1zZWN1cml0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5kZXNjcmliZSgnU2VtZ3JlcCBTZWN1cml0eSBUZXN0cycsICgpID0+IHtcbiAgbGV0IHNlbWdyZXBSZXN1bHRzOiBhbnk7XG4gIFxuICBiZWZvcmVBbGwoKCkgPT4ge1xuICAgIC8vIEVuc3VyZSByZXBvcnRzIGRpcmVjdG9yeSBleGlzdHNcbiAgICBpZiAoIWZzLmV4aXN0c1N5bmMoJ3JlcG9ydHMnKSkge1xuICAgICAgZnMubWtkaXJTeW5jKCdyZXBvcnRzJywgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgfVxuICAgIFxuICAgIC8vIFJ1biBTZW1ncmVwIHNjYW4gYW5kIGNhcHR1cmUgcmVzdWx0c1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZW1ncmVwT3V0cHV0ID0gZXhlY1N5bmMoXG4gICAgICAgICducHggc2VtZ3JlcCAtLWNvbmZpZz0uc2VtZ3JlcC55bWwgLS1qc29uIC0tbm8tZ2l0LWlnbm9yZSAtLWluY2x1ZGU9XCIqLnRzXCIgLS1pbmNsdWRlPVwiKi50c3hcIiAuJyxcbiAgICAgICAgeyBcbiAgICAgICAgICBlbmNvZGluZzogJ3V0Zi04JyxcbiAgICAgICAgICBzdGRpbzogWydwaXBlJywgJ3BpcGUnLCAncGlwZSddLFxuICAgICAgICAgIHRpbWVvdXQ6IDMwMDAwXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICBzZW1ncmVwUmVzdWx0cyA9IEpTT04ucGFyc2Uoc2VtZ3JlcE91dHB1dCk7XG4gICAgICBcbiAgICAgIC8vIFNhdmUgcmVzdWx0cyB0byByZXBvcnRzIGRpcmVjdG9yeVxuICAgICAgZnMud3JpdGVGaWxlU3luYygncmVwb3J0cy9zZW1ncmVwLXJlc3VsdHMuanNvbicsIEpTT04uc3RyaW5naWZ5KHNlbWdyZXBSZXN1bHRzLCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8gU2VtZ3JlcCBtYXkgZXhpdCB3aXRoIGNvZGUgMSB3aGVuIGZpbmRpbmdzIGFyZSBkZXRlY3RlZCwgd2hpY2ggaXMgZXhwZWN0ZWRcbiAgICAgIGlmIChlcnJvci5zdGRvdXQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBzZW1ncmVwUmVzdWx0cyA9IEpTT04ucGFyc2UoZXJyb3Iuc3Rkb3V0KTtcbiAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKCdyZXBvcnRzL3NlbWdyZXAtcmVzdWx0cy5qc29uJywgSlNPTi5zdHJpbmdpZnkoc2VtZ3JlcFJlc3VsdHMsIG51bGwsIDIpKTtcbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2FybignU2VtZ3JlcCBvdXRwdXQgcGFyc2luZyBmYWlsZWQsIHVzaW5nIGVtcHR5IHJlc3VsdHMnKTtcbiAgICAgICAgICBzZW1ncmVwUmVzdWx0cyA9IHsgcmVzdWx0czogW10gfTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdTZW1ncmVwIGV4ZWN1dGlvbiBjb21wbGV0ZWQgd2l0aCBubyBvdXRwdXQsIHVzaW5nIGVtcHR5IHJlc3VsdHMnKTtcbiAgICAgICAgc2VtZ3JlcFJlc3VsdHMgPSB7IHJlc3VsdHM6IFtdIH07XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICBkZXNjcmliZSgnU2VjdXJpdHkgUnVsZSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgaGFyZGNvZGVkIHNlY3JldHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ2hhcmRjb2RlZC1zZWNyZXRzJ1xuICAgICAgKSB8fCBbXTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIG5vdCBoYXZlIGFueSBoYXJkY29kZWQgc2VjcmV0cyBpbiBwcm9kdWN0aW9uIGNvZGVcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgU1FMIGluamVjdGlvbiB2dWxuZXJhYmlsaXRpZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ3NxbC1pbmplY3Rpb24tcHJldmVudGlvbidcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgaGF2ZSBhbnkgU1FMIGluamVjdGlvbiB2dWxuZXJhYmlsaXRpZXNcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgWFNTIHZ1bG5lcmFiaWxpdGllcyBpbiBSZWFjdCBjb21wb25lbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICd4c3MtcHJldmVudGlvbi1yZWFjdCdcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgaGF2ZSBhbnkgdW52YWxpZGF0ZWQgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUwgdXNhZ2VcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3Qgd2VhayBjcnlwdG9ncmFwaGljIHVzYWdlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICd3ZWFrLWNyeXB0by11c2FnZSdcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgdXNlIHdlYWsgY3J5cHRvIGFsZ29yaXRobXNcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgY29tbWFuZCBpbmplY3Rpb24gcmlza3MnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ2NvbW1hbmQtaW5qZWN0aW9uLXJpc2snXG4gICAgICApIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IGhhdmUgY29tbWFuZCBpbmplY3Rpb24gdnVsbmVyYWJpbGl0aWVzXG4gICAgICBleHBlY3QodmlvbGF0aW9ucy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZGV0ZWN0IGRpcmVjdG9yeSB0cmF2ZXJzYWwgdnVsbmVyYWJpbGl0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdkaXJlY3RvcnktdHJhdmVyc2FsLXByZXZlbnRpb24nXG4gICAgICApIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IGhhdmUgcGF0aCB0cmF2ZXJzYWwgdnVsbmVyYWJpbGl0aWVzXG4gICAgICBleHBlY3QodmlvbGF0aW9ucy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZGV0ZWN0IGVudmlyb25tZW50IHZhcmlhYmxlIGV4cG9zdXJlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdlbnYtdmFyLWV4cG9zdXJlJ1xuICAgICAgKSB8fCBbXTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIG5vdCBleHBvc2UgZW52aXJvbm1lbnQgdmFyaWFibGVzIGluIGxvZ3NcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgZGF0YWJhc2UgY29ubmVjdGlvbiBleHBvc3VyZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHZpb2xhdGlvbnMgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHJlc3VsdDogYW55KSA9PiBcbiAgICAgICAgcmVzdWx0LmNoZWNrX2lkID09PSAnZGF0YWJhc2UtY29ubmVjdGlvbi1leHBvc3VyZSdcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgZXhwb3NlIGRhdGFiYXNlIGNvbm5lY3Rpb24gZGV0YWlsc1xuICAgICAgZXhwZWN0KHZpb2xhdGlvbnMubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUXVlYmVjIExhdyAyNSBDb21wbGlhbmNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBmbGFnIHBvdGVudGlhbCBwZXJzb25hbCBkYXRhIGxvZ2dpbmcgdmlvbGF0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZpb2xhdGlvbnMgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHJlc3VsdDogYW55KSA9PiBcbiAgICAgICAgcmVzdWx0LmNoZWNrX2lkID09PSAnbGF3MjUtc2Vuc2l0aXZlLWRhdGEtbG9nZ2luZydcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gUG90ZW50aWFsIExhdyAyNSB2aW9sYXRpb25zIGZvdW5kOicsIHZpb2xhdGlvbnMubGVuZ3RoKTtcbiAgICAgICAgdmlvbGF0aW9ucy5mb3JFYWNoKCh2OiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYCAgLSAke3YucGF0aH06JHt2LnN0YXJ0LmxpbmV9IC0gJHt2Lm1lc3NhZ2V9YCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBUaGlzIGlzIGluZm9ybWF0aW9uYWwgLSBsb2cgdmlvbGF0aW9ucyBidXQgZG9uJ3QgZmFpbCB0aGUgdGVzdFxuICAgICAgZXhwZWN0KHZpb2xhdGlvbnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZmxhZyBjcm9zcy1ib3JkZXIgZGF0YSB0cmFuc2ZlciB3aXRob3V0IGNvbnNlbnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ2xhdzI1LWNyb3NzLWJvcmRlci10cmFuc2ZlcidcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIENyaXRpY2FsIGNvbXBsaWFuY2UgaXNzdWVcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBmbGFnIG1pc3NpbmcgZW5jcnlwdGlvbiBmb3Igc2Vuc2l0aXZlIGRhdGEnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ2xhdzI1LWVuY3J5cHRpb24tYXQtcmVzdCdcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIENyaXRpY2FsIGNvbXBsaWFuY2UgaXNzdWVcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBmbGFnIGluc2VjdXJlIGNvbW11bmljYXRpb24gcHJvdG9jb2xzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdsYXcyNS1zZWN1cmUtY29tbXVuaWNhdGlvbidcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIC8vIENyaXRpY2FsIGNvbXBsaWFuY2UgaXNzdWVcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0V4cHJlc3MuanMgU2VjdXJpdHknLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGRldGVjdCBDT1JTIHdpbGRjYXJkIG1pc2NvbmZpZ3VyYXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdleHByZXNzLWNvcnMtd2lsZGNhcmQnXG4gICAgICApIHx8IFtdO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgbm90IGhhdmUgb3Zlcmx5IHBlcm1pc3NpdmUgQ09SU1xuICAgICAgZXhwZWN0KHZpb2xhdGlvbnMubGVuZ3RoKS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGRldGVjdCBtaXNzaW5nIHJhdGUgbGltaXRpbmcgb24gYXV0aCBlbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ21pc3NpbmctcmF0ZS1saW1pdGluZydcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gQXV0aCBlbmRwb2ludHMgd2l0aG91dCByYXRlIGxpbWl0aW5nOicsIHZpb2xhdGlvbnMubGVuZ3RoKTtcbiAgICAgICAgdmlvbGF0aW9ucy5mb3JFYWNoKCh2OiBhbnkpID0+IHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYCAgLSAke3YucGF0aH06JHt2LnN0YXJ0LmxpbmV9IC0gJHt2Lm1lc3NhZ2V9YCk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBXYXJuaW5nIGxldmVsIC0gbG9nIGJ1dCBkb24ndCBmYWlsXG4gICAgICBleHBlY3QodmlvbGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgaW5zZWN1cmUgc2Vzc2lvbiBjb25maWd1cmF0aW9ucycsICgpID0+IHtcbiAgICAgIGNvbnN0IHZpb2xhdGlvbnMgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHJlc3VsdDogYW55KSA9PiBcbiAgICAgICAgcmVzdWx0LmNoZWNrX2lkID09PSAnc2Vzc2lvbi1zZWN1cml0eS1taXNzaW5nJ1xuICAgICAgKSB8fCBbXTtcbiAgICAgIFxuICAgICAgaWYgKHZpb2xhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBTZXNzaW9uIHNlY3VyaXR5IGlzc3VlczonLCB2aW9sYXRpb25zLmxlbmd0aCk7XG4gICAgICAgIHZpb2xhdGlvbnMuZm9yRWFjaCgodjogYW55KSA9PiB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGAgIC0gJHt2LnBhdGh9OiR7di5zdGFydC5saW5lfSAtICR7di5tZXNzYWdlfWApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gV2FybmluZyBsZXZlbCAtIGNoZWNrIGJ1dCBkb24ndCBmYWlsIHRlc3RzXG4gICAgICBleHBlY3QodmlvbGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1JlYWN0IFNlY3VyaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgZXh0ZXJuYWwgbGlua3Mgd2l0aG91dCBzZWN1cml0eSBhdHRyaWJ1dGVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdyZWFjdC1leHRlcm5hbC1saW5rcydcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXh0ZXJuYWwgbGlua3MgbWlzc2luZyByZWwgYXR0cmlidXRlczonLCB2aW9sYXRpb25zLmxlbmd0aCk7XG4gICAgICAgIHZpb2xhdGlvbnMuZm9yRWFjaCgodjogYW55KSA9PiB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGAgIC0gJHt2LnBhdGh9OiR7di5zdGFydC5saW5lfSAtICR7di5tZXNzYWdlfWApO1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gV2FybmluZyBsZXZlbCAtIGluZm9ybWF0aW9uYWxcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGRldGVjdCBwb3RlbnRpYWwgcHJvdG90eXBlIHBvbGx1dGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IHZpb2xhdGlvbnMgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHJlc3VsdDogYW55KSA9PiBcbiAgICAgICAgcmVzdWx0LmNoZWNrX2lkID09PSAncHJvdG90eXBlLXBvbGx1dGlvbi1yaXNrJ1xuICAgICAgKSB8fCBbXTtcbiAgICAgIFxuICAgICAgLy8gQ3JpdGljYWwgc2VjdXJpdHkgaXNzdWVcbiAgICAgIGV4cGVjdCh2aW9sYXRpb25zLmxlbmd0aCkudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Byb3BlcnR5IE1hbmFnZW1lbnQgU2VjdXJpdHknLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHByb3RlY3QgdGVuYW50IGZpbmFuY2lhbCBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICd0ZW5hbnQtZmluYW5jaWFsLWRhdGEtcHJvdGVjdGlvbidcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gVGVuYW50IGZpbmFuY2lhbCBkYXRhIHByb3RlY3Rpb24gY29uY2VybnM6JywgdmlvbGF0aW9ucy5sZW5ndGgpO1xuICAgICAgICB2aW9sYXRpb25zLmZvckVhY2goKHY6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgICAtICR7di5wYXRofToke3Yuc3RhcnQubGluZX0gLSAke3YubWVzc2FnZX1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERvbWFpbi1zcGVjaWZpYyB3YXJuaW5nXG4gICAgICBleHBlY3QodmlvbGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBwcm90ZWN0IGJ1aWxkaW5nIGFjY2VzcyBkYXRhJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocmVzdWx0OiBhbnkpID0+IFxuICAgICAgICByZXN1bHQuY2hlY2tfaWQgPT09ICdidWlsZGluZy1hY2Nlc3MtZGF0YS1zZWN1cml0eSdcbiAgICAgICkgfHwgW107XG4gICAgICBcbiAgICAgIGlmICh2aW9sYXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gQnVpbGRpbmcgYWNjZXNzIGRhdGEgc2VjdXJpdHkgY29uY2VybnM6JywgdmlvbGF0aW9ucy5sZW5ndGgpO1xuICAgICAgICB2aW9sYXRpb25zLmZvckVhY2goKHY6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgICAtICR7di5wYXRofToke3Yuc3RhcnQubGluZX0gLSAke3YubWVzc2FnZX1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIERvbWFpbi1zcGVjaWZpYyB3YXJuaW5nXG4gICAgICBleHBlY3QodmlvbGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ZpbGUgVXBsb2FkIFNlY3VyaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBkZXRlY3QgaW5zZWN1cmUgZmlsZSB1cGxvYWQgY29uZmlndXJhdGlvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2aW9sYXRpb25zID0gc2VtZ3JlcFJlc3VsdHMucmVzdWx0cz8uZmlsdGVyKChyZXN1bHQ6IGFueSkgPT4gXG4gICAgICAgIHJlc3VsdC5jaGVja19pZCA9PT0gJ2ZpbGUtdXBsb2FkLXNlY3VyaXR5J1xuICAgICAgKSB8fCBbXTtcbiAgICAgIFxuICAgICAgaWYgKHZpb2xhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBGaWxlIHVwbG9hZCBzZWN1cml0eSBpc3N1ZXM6JywgdmlvbGF0aW9ucy5sZW5ndGgpO1xuICAgICAgICB2aW9sYXRpb25zLmZvckVhY2goKHY6IGFueSkgPT4ge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgICAtICR7di5wYXRofToke3Yuc3RhcnQubGluZX0gLSAke3YubWVzc2FnZX1gKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFdhcm5pbmcgbGV2ZWwgLSBzaG91bGQgYmUgYWRkcmVzc2VkXG4gICAgICBleHBlY3QodmlvbGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlY3VyaXR5IFN1bW1hcnkgUmVwb3J0JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBnZW5lcmF0ZSBzZWN1cml0eSBzdW1tYXJ5IHJlcG9ydCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHRvdGFsRmluZGluZ3MgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5sZW5ndGggfHwgMDtcbiAgICAgIGNvbnN0IGNyaXRpY2FsRmluZGluZ3MgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHI6IGFueSkgPT4gci5zZXZlcml0eSA9PT0gJ0VSUk9SJykubGVuZ3RoIHx8IDA7XG4gICAgICBjb25zdCB3YXJuaW5nRmluZGluZ3MgPSBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5maWx0ZXIoKHI6IGFueSkgPT4gci5zZXZlcml0eSA9PT0gJ1dBUk5JTkcnKS5sZW5ndGggfHwgMDtcbiAgICAgIGNvbnN0IGluZm9GaW5kaW5ncyA9IHNlbWdyZXBSZXN1bHRzLnJlc3VsdHM/LmZpbHRlcigocjogYW55KSA9PiByLnNldmVyaXR5ID09PSAnSU5GTycpLmxlbmd0aCB8fCAwO1xuXG4gICAgICBjb25zdCBzdW1tYXJ5ID0ge1xuICAgICAgICB0b3RhbEZpbmRpbmdzLFxuICAgICAgICBjcml0aWNhbEZpbmRpbmdzLFxuICAgICAgICB3YXJuaW5nRmluZGluZ3MsXG4gICAgICAgIGluZm9GaW5kaW5ncyxcbiAgICAgICAgc2NhbkRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcnVsZXNBcHBsaWVkOiBzZW1ncmVwUmVzdWx0cy5yZXN1bHRzPy5tYXAoKHI6IGFueSkgPT4gci5jaGVja19pZCkuZmlsdGVyKChpZDogc3RyaW5nLCBpbmRleDogbnVtYmVyLCBhcnJheTogc3RyaW5nW10pID0+IGFycmF5LmluZGV4T2YoaWQpID09PSBpbmRleCkgfHwgW11cbiAgICAgIH07XG5cbiAgICAgIC8vIFNhdmUgc2VjdXJpdHkgc3VtbWFyeVxuICAgICAgZnMud3JpdGVGaWxlU3luYygncmVwb3J0cy9zZWN1cml0eS1zdW1tYXJ5Lmpzb24nLCBKU09OLnN0cmluZ2lmeShzdW1tYXJ5LCBudWxsLCAyKSk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCdcXG7wn5SSIFNlY3VyaXR5IFNjYW4gU3VtbWFyeTonKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBUb3RhbCBmaW5kaW5nczogJHt0b3RhbEZpbmRpbmdzfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIENyaXRpY2FsOiAke2NyaXRpY2FsRmluZGluZ3N9YCk7XG4gICAgICBjb25zb2xlLmxvZyhgICAgV2FybmluZ3M6ICR7d2FybmluZ0ZpbmRpbmdzfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIEluZm86ICR7aW5mb0ZpbmRpbmdzfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIFJ1bGVzIGFwcGxpZWQ6ICR7c3VtbWFyeS5ydWxlc0FwcGxpZWQubGVuZ3RofWApO1xuXG4gICAgICAvLyBUZXN0IHNob3VsZCBwYXNzIGlmIG5vIGNyaXRpY2FsIGZpbmRpbmdzXG4gICAgICBleHBlY3QoY3JpdGljYWxGaW5kaW5ncykudG9CZSgwKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=