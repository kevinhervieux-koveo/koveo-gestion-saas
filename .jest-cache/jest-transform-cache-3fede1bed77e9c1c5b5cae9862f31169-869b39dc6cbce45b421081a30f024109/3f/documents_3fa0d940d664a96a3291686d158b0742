ad6d0eeaa263b6de16fa76a294d84e51
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerDocumentRoutes = registerDocumentRoutes;
const auth_1 = require("../auth");
const storage_1 = require("../storage");
const schema_1 = require("../../shared/schema");
const zod_1 = require("zod");
const multer_1 = __importDefault(require("multer"));
const path_1 = __importDefault(require("path"));
const fs_1 = __importDefault(require("fs"));
const crypto_1 = __importDefault(require("crypto"));
const uuid_1 = require("uuid");
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
// Enhanced security configuration for file uploads
const SECURITY_CONFIG = {
    MAX_FILE_SIZE: 25 * 1024 * 1024, // Reduced to 25MB for better security
    MAX_FILES_PER_USER_PER_HOUR: 10, // Rate limiting
    ALLOWED_MIME_TYPES: [
        'application/pdf',
        'application/msword',
        'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
        'application/vnd.ms-excel',
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
        'text/plain',
        'image/jpeg',
        'image/png',
        'image/gif'
    ],
    ALLOWED_EXTENSIONS: ['pdf', 'doc', 'docx', 'xls', 'xlsx', 'txt', 'jpg', 'jpeg', 'png', 'gif']
};
// Rate limiting storage for uploads
const uploadRateTracker = new Map();
// Enhanced file validation function
function validateFile(file) {
    if (!file)
        return { isValid: false, error: 'No file provided' };
    // Check file size
    if (file.size > SECURITY_CONFIG.MAX_FILE_SIZE) {
        return { isValid: false, error: `File size exceeds ${SECURITY_CONFIG.MAX_FILE_SIZE / (1024 * 1024)}MB limit` };
    }
    // Check MIME type
    if (!SECURITY_CONFIG.ALLOWED_MIME_TYPES.includes(file.mimetype)) {
        return { isValid: false, error: `File type ${file.mimetype} not allowed` };
    }
    // Check file extension
    const extension = path_1.default.extname(file.originalname).toLowerCase().substring(1);
    if (!SECURITY_CONFIG.ALLOWED_EXTENSIONS.includes(extension)) {
        return { isValid: false, error: `File extension .${extension} not allowed` };
    }
    // Check filename for path traversal attempts
    if (file.originalname.includes('..') || file.originalname.includes('/') || file.originalname.includes('\\')) {
        return { isValid: false, error: 'Invalid filename detected' };
    }
    return { isValid: true };
}
// Rate limiting function
function checkUploadRateLimit(userId) {
    const now = Date.now();
    const userUploads = uploadRateTracker.get(userId) || [];
    // Clean old uploads (older than 1 hour)
    const recentUploads = userUploads.filter((timestamp) => now - timestamp < 60 * 60 * 1000);
    if (recentUploads.length >= SECURITY_CONFIG.MAX_FILES_PER_USER_PER_HOUR) {
        return { allowed: false, error: 'Upload rate limit exceeded. Please try again later.' };
    }
    // Update tracker
    recentUploads.push(now);
    uploadRateTracker.set(userId, recentUploads);
    return { allowed: true };
}
// Configure multer for file uploads with enhanced security
const upload = (0, multer_1.default)({
    dest: '/tmp/uploads/',
    limits: {
        fileSize: SECURITY_CONFIG.MAX_FILE_SIZE,
        files: 1, // Only allow one file at a time
    },
    fileFilter: (req, file, cb) => {
        const validation = validateFile(file);
        if (validation.isValid) {
            cb(null, true);
        }
        else {
            cb(new Error(validation.error));
        }
    },
});
// DocumentRecord categories for validation - synchronized with frontend
const DOCUMENT_CATEGORIES = [
    'bylaw',
    'financial',
    'maintenance',
    'legal',
    'meeting_minutes',
    'insurance',
    'contracts',
    'permits',
    'inspection',
    'lease',
    'correspondence',
    'utilities',
    'other',
];
// Enhanced schemas for different document types
const createDocumentSchema = schema_1.insertDocumentSchema.extend({
    category: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255),
    description: zod_1.z.string().optional(),
    isVisibleToTenants: zod_1.z.boolean().default(false),
});
const createBuildingDocumentSchema = schema_1.insertDocumentSchema.extend({
    type: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255).optional(),
    description: zod_1.z.string().optional(),
});
const createResidentDocumentSchema = schema_1.insertDocumentSchema.extend({
    type: zod_1.z.enum(DOCUMENT_CATEGORIES),
    title: zod_1.z.string().min(1).max(255).optional(),
    description: zod_1.z.string().optional(),
});
// Schema for unified document upload
const uploadDocumentRecordSchema = zod_1.z.object({
    name: zod_1.z.string().min(1).max(255),
    description: zod_1.z.string().optional(),
    documentType: zod_1.z.enum(DOCUMENT_CATEGORIES),
    isVisibleToTenants: zod_1.z.boolean().default(false),
    residenceId: zod_1.z.string().uuid().optional(),
    buildingId: zod_1.z.string().uuid().optional(),
    attachedToType: zod_1.z.string().optional(),
    attachedToId: zod_1.z.string().optional(),
});
/**
 *
 * @param app
 */
/**
 * RegisterDocumentRecordRoutes function.
 * @param app
 * @returns Function result.
 */
function registerDocumentRoutes(app) {
    console.log(`[${new Date().toISOString()}] ðŸ”§ Registering document routes...`);
    // Security audit logging
    const auditLog = [];
    // Error tracking for production debugging
    const errorLog = [];
    // Security audit logging function
    const logSecurityEvent = (action, user, success, documentId, details) => {
        const event = {
            timestamp: new Date().toISOString(),
            action,
            userId: user.id,
            userRole: user.role,
            documentId,
            success,
            details
        };
        auditLog.push(event);
        if (auditLog.length > 1000)
            auditLog.shift(); // Keep last 1000 events
        console.log(`[SECURITY AUDIT] ${action}:`, event);
        return event;
    };
    // Database connection testing functions
    const testDatabaseConnection = async () => {
        try {
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT 1 as test`);
            return {
                success: true,
                result: result.rows[0],
                url_truncated: process.env.DATABASE_URL?.substring(0, 50) + '...'
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message,
                url_truncated: process.env.DATABASE_URL?.substring(0, 50) + '...'
            };
        }
    };
    const testSampleQuery = async () => {
        try {
            // Test the exact query that's failing
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT COUNT(*) as document_count 
        FROM documents 
        LIMIT 1
      `);
            return {
                success: true,
                document_count: result.rows[0]?.document_count || 0
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message,
                stack: error.stack?.substring(0, 200) + '...'
            };
        }
    };
    const checkEnumValues = async () => {
        try {
            // Check current enum values in production
            const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT enumlabel 
        FROM pg_enum 
        WHERE enumtypid = (
          SELECT oid 
          FROM pg_type 
          WHERE typname = 'user_role'
        )
        ORDER BY enumsortorder
      `);
            return {
                success: true,
                production_enum_values: result.rows.map(row => row.enumlabel)
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    };
    const checkUserOrganizationLinks = async () => {
        try {
            // Check user-organization relationships
            const userCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM users WHERE is_active = true`);
            const orgCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM organizations WHERE is_active = true`);
            const linkCount = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT COUNT(*) as total FROM user_organizations WHERE is_active = true`);
            // Check users without organization links
            const orphanUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.id, u.email, u.role 
        FROM users u 
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true
        WHERE u.is_active = true AND uo.user_id IS NULL
        LIMIT 10
      `);
            // Check current test user specifically (from error logs)
            const testUser = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.email, u.role, uo.organization_id, o.name as org_name
        FROM users u
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true  
        LEFT JOIN organizations o ON uo.organization_id = o.id
        WHERE u.id = '222f5a0d-6bc6-4f28-9f4d-32c133eed333'
      `);
            return {
                success: true,
                stats: {
                    total_users: userCount.rows[0]?.total || 0,
                    total_organizations: orgCount.rows[0]?.total || 0,
                    total_links: linkCount.rows[0]?.total || 0,
                    orphan_user_count: orphanUsers.rows.length
                },
                orphan_users: orphanUsers.rows,
                test_user_status: testUser.rows[0] || null
            };
        }
        catch (error) {
            return {
                success: false,
                error: error.message
            };
        }
    };
    // Enum cleanup endpoint for safe schema migration  
    app.post('/api/documents/cleanup-enum', async (req, res) => {
        try {
            // First, verify no users have the 'owner' role
            const userCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT COUNT(*) as owner_count 
        FROM users 
        WHERE role = 'owner'
      `);
            const ownerCount = Number(userCheck.rows[0]?.owner_count) || 0;
            if (ownerCount > 0) {
                return res.status(400).json({
                    error: 'Cannot remove owner role - users still assigned to it',
                    owner_count: ownerCount
                });
            }
            // Safe to remove - no users have 'owner' role
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TYPE user_role DROP VALUE IF EXISTS 'owner'
      `);
            res.json({
                message: 'Successfully removed unused owner role',
                safe_to_push_schema: true,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error during enum cleanup:', error);
            res.status(500).json({
                error: 'Enum cleanup failed',
                message: error.message,
                suggestion: 'Try running npm run db:push --force instead'
            });
        }
    });
    // Fix user-organization relationships
    app.post('/api/documents/fix-user-links', async (req, res) => {
        try {
            // Step 1: Find users without organization links
            const orphanUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT u.id, u.email, u.role 
        FROM users u 
        LEFT JOIN user_organizations uo ON u.id = uo.user_id AND uo.is_active = true
        WHERE u.is_active = true AND uo.user_id IS NULL
      `);
            if (orphanUsers.rows.length === 0) {
                return res.json({
                    message: 'All users already have organization links',
                    action_taken: 'none',
                    timestamp: new Date().toISOString()
                });
            }
            // Step 2: Get the first available organization (or create default one)
            let defaultOrg = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT id, name FROM organizations WHERE is_active = true LIMIT 1
      `);
            let organizationId;
            let organizationName;
            if (defaultOrg.rows.length === 0) {
                // Create a default organization if none exists
                organizationId = crypto_1.default.randomUUID();
                organizationName = 'Default Organization';
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          INSERT INTO organizations (id, name, type, address, phone, email, is_active, created_at, updated_at)
          VALUES (${organizationId}, ${organizationName}, 'condominium', '123 Main St', '514-555-0100', 'admin@koveo.ca', true, NOW(), NOW())
        `);
            }
            else {
                organizationId = defaultOrg.rows[0].id;
                organizationName = defaultOrg.rows[0].name;
            }
            // Step 3: Link all orphan users to the default organization
            const linkPromises = orphanUsers.rows.map(user => {
                const linkId = crypto_1.default.randomUUID();
                return db_1.db.execute((0, drizzle_orm_1.sql) `
          INSERT INTO user_organizations (id, user_id, organization_id, role, is_active, created_at, updated_at)
          VALUES (${linkId}, ${user.id}, ${organizationId}, ${user.role}, true, NOW(), NOW())
        `);
            });
            await Promise.all(linkPromises);
            res.json({
                message: 'Successfully linked users to organizations',
                users_linked: orphanUsers.rows.length,
                organization_id: organizationId,
                organization_name: organizationName,
                linked_users: orphanUsers.rows.map(u => ({ id: u.id, email: u.email, role: u.role })),
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error fixing user-organization links:', error);
            res.status(500).json({
                error: 'Failed to fix user-organization links',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Safe enum migration endpoint
    app.post('/api/documents/fix-enum-migration', async (req, res) => {
        try {
            // Step 1: Check current enum values and usage
            const enumCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT enumlabel, enumsortorder 
        FROM pg_enum 
        WHERE enumtypid = (SELECT oid FROM pg_type WHERE typname = 'user_role')
        ORDER BY enumsortorder
      `);
            const currentEnumValues = enumCheck.rows.map(row => row.enumlabel);
            // Step 2: Check if we have any data that would prevent migration
            const userRoleUsage = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT role, COUNT(*) as count 
        FROM users 
        GROUP BY role
      `);
            // Step 3: Since enum reordering is the issue, let's use a different approach
            // We'll create a new enum with correct order, migrate data, then swap
            const targetEnumValues = ['admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident'];
            // Check if current order matches target
            const orderMatches = JSON.stringify(currentEnumValues) === JSON.stringify(targetEnumValues);
            if (orderMatches) {
                return res.json({
                    message: 'Enum values already in correct order',
                    current_values: currentEnumValues,
                    target_values: targetEnumValues,
                    migration_needed: false
                });
            }
            // Step 4: Create new enum with correct order
            await db_1.db.execute((0, drizzle_orm_1.sql) `CREATE TYPE user_role_new AS ENUM ('admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident')`);
            // Step 5: Update all tables to use new enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE users 
        ALTER COLUMN role TYPE user_role_new 
        USING role::text::user_role_new
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE user_organizations 
        ALTER COLUMN organization_role TYPE user_role_new 
        USING organization_role::text::user_role_new
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE role_permissions 
        ALTER COLUMN role TYPE user_role_new 
        USING role::text::user_role_new
      `);
            // Step 6: Drop old enum and rename new one
            await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role`);
            await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TYPE user_role_new RENAME TO user_role`);
            res.json({
                message: 'Successfully migrated user_role enum',
                old_values: currentEnumValues,
                new_values: targetEnumValues,
                user_role_usage: userRoleUsage.rows,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error during enum migration:', error);
            res.status(500).json({
                error: 'Enum migration failed',
                message: error.message,
                suggestion: 'This is a complex migration - may need manual intervention',
                timestamp: new Date().toISOString()
            });
        }
    });
    // Fix invitations table enum dependency
    app.post('/api/documents/fix-invitations-dependency', async (req, res) => {
        try {
            // Step 1: Check current invitations table structure
            const invitationsSchema = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT column_name, data_type, column_default
        FROM information_schema.columns 
        WHERE table_name = 'invitations' AND column_name = 'role'
      `);
            // Step 2: Remove default value from invitations.role column temporarily
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE invitations 
        ALTER COLUMN role DROP DEFAULT
      `);
            // Step 3: Check what other tables might have enum dependencies
            const enumDependencies = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT 
          t.table_name,
          c.column_name,
          c.column_default
        FROM information_schema.tables t
        JOIN information_schema.columns c ON t.table_name = c.table_name
        WHERE c.data_type = 'USER-DEFINED' 
        AND c.udt_name = 'user_role'
        AND c.column_default IS NOT NULL
      `);
            res.json({
                message: 'Successfully removed invitations table enum dependency',
                removed_defaults: invitationsSchema.rows,
                remaining_dependencies: enumDependencies.rows,
                next_step: 'Run npm run db:push now, then call /api/documents/restore-invitations-default',
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error fixing invitations dependency:', error);
            res.status(500).json({
                error: 'Failed to fix invitations dependency',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Restore invitations default value after schema sync
    app.post('/api/documents/restore-invitations-default', async (req, res) => {
        try {
            // Restore default value to 'tenant' for invitations.role column
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE invitations 
        ALTER COLUMN role SET DEFAULT 'tenant'
      `);
            // Verify the change
            const verification = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT column_name, column_default
        FROM information_schema.columns 
        WHERE table_name = 'invitations' AND column_name = 'role'
      `);
            res.json({
                message: 'Successfully restored invitations role default to tenant',
                current_default: verification.rows[0]?.column_default,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error restoring invitations default:', error);
            res.status(500).json({
                error: 'Failed to restore invitations default',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Migrate owner users to admin before enum cleanup
    app.post('/api/documents/migrate-owner-to-admin', async (req, res) => {
        try {
            // Step 1: Check how many users have 'owner' role
            const ownerUsersCheck = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT id, email, first_name, last_name 
        FROM users 
        WHERE role = 'owner'
      `);
            const ownerCount = ownerUsersCheck.rows.length;
            if (ownerCount === 0) {
                return res.json({
                    message: 'No owner users found - migration not needed',
                    owner_count: 0,
                    timestamp: new Date().toISOString()
                });
            }
            // Step 2: Update all owner users to admin
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        UPDATE users 
        SET role = 'admin' 
        WHERE role = 'owner'
      `);
            // Step 3: Update user_organizations table if it exists
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          UPDATE user_organizations 
          SET organization_role = 'admin' 
          WHERE organization_role = 'owner'
        `);
            }
            catch (e) {
                // Table might not exist, that's OK
            }
            // Step 4: Remove 'owner' from enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TYPE user_role RENAME TO user_role_old
      `);
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        CREATE TYPE user_role AS ENUM ('admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident')
      `);
            // Step 5: Update all tables to use new enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `
        ALTER TABLE users 
        ALTER COLUMN role TYPE user_role 
        USING role::text::user_role
      `);
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role TYPE user_role 
          USING organization_role::text::user_role
        `);
            }
            catch (e) {
                // Table might not exist
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE role_permissions 
          ALTER COLUMN role TYPE user_role 
          USING role::text::user_role
        `);
            }
            catch (e) {
                // Table might not exist
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitations 
          ALTER COLUMN role TYPE user_role 
          USING role::text::user_role
        `);
            }
            catch (e) {
                // Column might not exist
            }
            // Step 6: Drop old enum
            await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role_old`);
            res.json({
                message: 'Successfully migrated owner users to admin',
                migrated_users: ownerUsersCheck.rows,
                owner_count: ownerCount,
                new_enum_values: ['admin', 'manager', 'tenant', 'resident', 'demo_manager', 'demo_tenant', 'demo_resident'],
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error migrating owner users to admin:', error);
            res.status(500).json({
                error: 'Owner to admin migration failed',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Remove all remaining enum dependencies
    app.post('/api/documents/remove-all-enum-dependencies', async (req, res) => {
        try {
            const results = [];
            // Remove default from users.role
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE users 
          ALTER COLUMN role DROP DEFAULT
        `);
                results.push('users.role default removed');
            }
            catch (e) {
                results.push(`users.role: ${e.message}`);
            }
            // Remove default from user_organizations.organization_role
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role DROP DEFAULT
        `);
                results.push('user_organizations.organization_role default removed');
            }
            catch (e) {
                results.push(`user_organizations.organization_role: ${e.message}`);
            }
            // Check remaining dependencies
            const remainingDeps = await db_1.db.execute((0, drizzle_orm_1.sql) `
        SELECT 
          t.table_name,
          c.column_name,
          c.column_default
        FROM information_schema.tables t
        JOIN information_schema.columns c ON t.table_name = c.table_name
        WHERE c.data_type = 'USER-DEFINED' 
        AND c.udt_name = 'user_role'
        AND c.column_default IS NOT NULL
      `);
            res.json({
                message: 'Removed all enum dependencies',
                operations: results,
                remaining_dependencies: remainingDeps.rows,
                next_step: 'Run npm run db:push now',
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error removing enum dependencies:', error);
            res.status(500).json({
                error: 'Failed to remove enum dependencies',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Restore all default values after schema sync
    app.post('/api/documents/restore-all-defaults', async (req, res) => {
        try {
            const results = [];
            // Restore users.role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE users 
          ALTER COLUMN role SET DEFAULT 'tenant'
        `);
                results.push('users.role default restored to tenant');
            }
            catch (e) {
                results.push(`users.role restore failed: ${e.message}`);
            }
            // Restore user_organizations.organization_role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE user_organizations 
          ALTER COLUMN organization_role SET DEFAULT 'tenant'
        `);
                results.push('user_organizations.organization_role default restored to tenant');
            }
            catch (e) {
                results.push(`user_organizations.organization_role restore failed: ${e.message}`);
            }
            // Restore invitations.role default
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitations 
          ALTER COLUMN role SET DEFAULT 'tenant'
        `);
                results.push('invitations.role default restored to tenant');
            }
            catch (e) {
                results.push(`invitations.role restore failed: ${e.message}`);
            }
            res.json({
                message: 'Restored all default values',
                operations: results,
                timestamp: new Date().toISOString()
            });
        }
        catch (error) {
            console.error('âŒ Error restoring defaults:', error);
            res.status(500).json({
                error: 'Failed to restore defaults',
                message: error.message,
                timestamp: new Date().toISOString()
            });
        }
    });
    // Complete database schema sync endpoint
    app.post('/api/documents/complete-schema-sync', async (req, res) => {
        try {
            const results = [];
            // Step 1: Remove all enum dependencies temporarily
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role DROP DEFAULT`);
                results.push('âœ“ Removed users.role default');
            }
            catch (e) {
                results.push(`users.role: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role DROP DEFAULT`);
                results.push('âœ“ Removed user_organizations.organization_role default');
            }
            catch (e) {
                results.push(`user_organizations.organization_role: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role DROP DEFAULT`);
                results.push('âœ“ Removed invitations.role default');
            }
            catch (e) {
                results.push(`invitations.role: ${e.message}`);
            }
            // Step 2: Migrate any 'owner' users to 'admin'
            const ownerUsers = await db_1.db.execute((0, drizzle_orm_1.sql) `SELECT count(*) as count FROM users WHERE role = 'owner'`);
            const ownerCount = Number(ownerUsers.rows[0]?.count || 0);
            if (ownerCount > 0) {
                await db_1.db.execute((0, drizzle_orm_1.sql) `UPDATE users SET role = 'admin' WHERE role = 'owner'`);
                results.push(`âœ“ Migrated ${ownerCount} owner users to admin`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `UPDATE user_organizations SET organization_role = 'admin' WHERE organization_role = 'owner'`);
                results.push('âœ“ Updated user_organizations owner roles to admin');
            }
            catch (e) {
                results.push(`user_organizations owner update: ${e.message}`);
            }
            // Step 3: Fix the enum to match development schema
            try {
                // Rename current enum
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TYPE user_role RENAME TO user_role_old`);
                // Create new enum with correct values
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          CREATE TYPE user_role AS ENUM (
            'admin', 'manager', 'tenant', 'resident', 
            'demo_manager', 'demo_tenant', 'demo_resident'
          )
        `);
                // Update all tables
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role TYPE user_role USING organization_role::text::user_role`);
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                try {
                    await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE role_permissions ALTER COLUMN role TYPE user_role USING role::text::user_role`);
                    results.push('âœ“ Updated role_permissions enum');
                }
                catch (e) {
                    results.push(`role_permissions: ${e.message}`);
                }
                // Drop old enum
                await db_1.db.execute((0, drizzle_orm_1.sql) `DROP TYPE user_role_old`);
                results.push('âœ“ Successfully updated user_role enum');
            }
            catch (e) {
                results.push(`Enum update failed: ${e.message}`);
            }
            // Step 4: Restore default values
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE users ALTER COLUMN role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored users.role default to tenant');
            }
            catch (e) {
                results.push(`users.role default restore: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE user_organizations ALTER COLUMN organization_role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored user_organizations.organization_role default to tenant');
            }
            catch (e) {
                results.push(`user_organizations.organization_role default restore: ${e.message}`);
            }
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `ALTER TABLE invitations ALTER COLUMN role SET DEFAULT 'tenant'`);
                results.push('âœ“ Restored invitations.role default to tenant');
            }
            catch (e) {
                results.push(`invitations.role default restore: ${e.message}`);
            }
            // Step 5: Add missing columns that exist in production but not development
            try {
                await db_1.db.execute((0, drizzle_orm_1.sql) `
          ALTER TABLE invitation_audit_log 
          ADD COLUMN IF NOT EXISTS created_at TIMESTAMP DEFAULT NOW()
        `);
                results.push('âœ“ Added created_at to invitation_audit_log');
            }
            catch (e) {
                results.push(`invitation_audit_log.created_at: ${e.message}`);
            }
            res.json({
                message: 'Database schema synchronization complete',
                operations: results,
                timestamp: new Date().toISOString(),
                success: true
            });
        }
        catch (error) {
            console.error('âŒ Error during schema synchronization:', error);
            res.status(500).json({
                error: 'Schema synchronization failed',
                message: error.message,
                timestamp: new Date().toISOString(),
                success: false
            });
        }
    });
    // Enhanced diagnostic endpoint with database schema check
    app.get('/api/documents/diagnostic', async (req, res) => {
        try {
            // Check if documents table exists
            let tableExists = false;
            let tableSchema = null;
            try {
                const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
          SELECT column_name, data_type, is_nullable, column_default 
          FROM information_schema.columns 
          WHERE table_name = 'documents' 
          ORDER BY ordinal_position
        `);
                tableExists = result.rows.length > 0;
                tableSchema = result.rows;
            }
            catch (schemaError) {
                console.error('Schema check error:', schemaError);
            }
            res.json({
                message: 'Document API diagnostic',
                gcs_disabled: true,
                session_fix_applied: true,
                timestamp: new Date().toISOString(),
                environment: process.env.NODE_ENV,
                version: 'v2.1-gcs-disabled',
                recent_errors: errorLog.slice(-5), // Last 5 errors
                storage_status: {
                    exists: !!storage_1.storage,
                    type: storage_1.storage?.constructor?.name,
                    methods: Object.getOwnPropertyNames(Object.getPrototypeOf(storage_1.storage || {}))
                },
                database_status: {
                    documents_table_exists: tableExists,
                    documents_table_schema: tableSchema,
                    schema_columns_count: tableSchema?.length || 0,
                    connection_test: await testDatabaseConnection(),
                    sample_query_test: await testSampleQuery(),
                    enum_check: await checkEnumValues(),
                    user_organization_links: await checkUserOrganizationLinks()
                }
            });
        }
        catch (error) {
            console.error('âŒ Error running diagnostic:', error);
            res.status(500).json({
                error: 'Diagnostic failed',
                message: error.message
            });
        }
    });
    // Error logging helper
    const logError = (endpoint, error, user) => {
        const errorEntry = {
            timestamp: new Date().toISOString(),
            endpoint,
            error: {
                message: error.message,
                stack: error.stack,
                name: error.name,
                details: error.toString()
            },
            user: user ? { id: user.id, role: user.role } : null
        };
        errorLog.push(errorEntry);
        if (errorLog.length > 50)
            errorLog.shift(); // Keep only last 50 errors
        console.error(`[${errorEntry.timestamp}] ðŸš¨ ERROR in ${endpoint}:`, errorEntry);
        return errorEntry;
    };
    // Get all documents for the authenticated user
    app.get('/api/documents', auth_1.requireAuth, async (req, res) => {
        const timestamp = new Date().toISOString();
        console.log(`[${timestamp}] ðŸ“„ GET /api/documents - Starting request`, {
            userId: req.user?.id,
            userRole: req.user?.role,
            query: req.query,
            url: req.url,
            method: req.method
        });
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            // Production debugging: Log the request details
            console.log(`[${timestamp}] ðŸ” User data extracted:`, {
                userId,
                userRole,
                hasValidUser: !!user
            });
            // Critical: Check if storage object exists and is properly initialized
            console.log(`[${timestamp}] ðŸ’¾ Storage check:`, {
                storageExists: !!storage_1.storage,
                storageType: storage_1.storage?.constructor?.name,
                storageMethod: typeof storage_1.storage?.getDocuments
            });
            const documentType = req.query.type; // 'building', 'resident', or undefined for both
            const specificResidenceId = req.query.residenceId; // Filter by specific residence
            const specificBuildingId = req.query.buildingId; // Filter by specific building
            // Get user's organization and residences for filtering
            console.log(`[${timestamp}] ðŸ” Fetching user data from storage...`);
            console.log(`[${timestamp}] ðŸ“‹ Calling getUserOrganizations(${userId})...`);
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            console.log(`[${timestamp}] âœ… getUserOrganizations SUCCESS - Found ${organizations.length} organizations`);
            console.log(`[${timestamp}] ðŸ“‹ Calling getUserResidences(${userId})...`);
            const userResidences = await storage_1.storage.getUserResidences(userId);
            console.log(`[${timestamp}] âœ… getUserResidences SUCCESS - Found ${userResidences.length} user residences`);
            console.log(`[${timestamp}] ðŸ“‹ Calling getBuildings()...`);
            const buildings = await storage_1.storage.getBuildings();
            console.log(`[${timestamp}] âœ… getBuildings SUCCESS - Found ${buildings.length} buildings`);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            console.log(`[${timestamp}] ðŸ¢ Organization ID determined:`, organizationId);
            // If specific residence ID provided, filter to only that residence
            let residenceIds;
            if (specificResidenceId) {
                // Admin users have access to all residences
                if (userRole === 'admin' || userRole === 'manager') {
                    residenceIds = [specificResidenceId];
                }
                else {
                    // Verify user has access to this specific residence
                    // Handle both simple {residenceId: string} and complex nested structures
                    const hasAccess = userResidences.some((ur) => {
                        // Handle simple structure
                        if (ur.residenceId === specificResidenceId) {
                            return true;
                        }
                        // Handle complex nested structure
                        if (ur.userResidence?.residenceId === specificResidenceId) {
                            return true;
                        }
                        // Handle residence nested structure
                        if (ur.residence?.id === specificResidenceId) {
                            return true;
                        }
                        return false;
                    });
                    if (!hasAccess) {
                        return res.status(403).json({ message: 'Access denied to this residence' });
                    }
                    residenceIds = [specificResidenceId];
                }
            }
            else {
                // Extract residence IDs from both simple and complex structures
                residenceIds = userResidences
                    .map((ur) => {
                    // Handle simple structure
                    if (ur.residenceId) {
                        return ur.residenceId;
                    }
                    // Handle complex nested structure
                    if (ur.userResidence?.residenceId) {
                        return ur.userResidence.residenceId;
                    }
                    // Handle residence nested structure
                    if (ur.residence?.id) {
                        return ur.residence.id;
                    }
                    return null;
                })
                    .filter((id) => id !== null);
            }
            const buildingIds = buildings.map((b) => b.id);
            const allDocumentRecords = [];
            // Use unified documents system
            const filters = {
                userId,
                userRole,
            };
            // Filter by specific residence if provided
            if (specificResidenceId) {
                filters.residenceId = specificResidenceId;
            }
            // Filter by specific building if provided
            if (specificBuildingId) {
                filters.buildingId = specificBuildingId;
            }
            else if (documentType === 'building') {
                // For building documents, search in buildings user has access to
                if (buildingIds.length > 0) {
                    // Get all documents for buildings, will filter later
                }
            }
            else if (documentType === 'resident') {
                // For resident documents, search in residences user has access to
                if (residenceIds.length > 0) {
                    // Get all documents for residences, will filter later
                }
            }
            // CRITICAL DEBUG POINT: This is where 500 errors likely occur
            console.log(`[${timestamp}] ðŸŽ¯ CRITICAL: About to call storage.getDocuments with filters:`, filters);
            console.log(`[${timestamp}] ðŸ”§ Storage instance:`, storage_1.storage.constructor.name);
            console.log(`[${timestamp}] ðŸ“Š Filters being passed:`, JSON.stringify(filters, null, 2));
            const documents = await storage_1.storage.getDocuments(filters);
            // CRITICAL: Log successful database response
            console.log(`[${timestamp}] âœ… CRITICAL: storage.getDocuments SUCCESS - returned ${documents?.length || 0} documents`);
            console.log(`[${timestamp}] ðŸ“‹ Document preview:`, documents?.slice(0, 3)?.map(d => ({
                id: d.id,
                name: d.name,
                uploadedById: d.uploadedById,
                buildingId: d.buildingId,
                residenceId: d.residenceId
            })));
            // Debug logging
            console.log('ðŸ” [DOCUMENTS API DEBUG]:', {
                filters,
                documentsFound: documents?.length || 0,
                specificResidenceId,
                userRole,
                userId,
            });
            // Apply role-based filtering with tenant visibility rules
            const filteredDocumentRecords = documents.filter((doc) => {
                // If filtering by specific building, only show documents for that building
                if (specificBuildingId) {
                    if (doc.buildingId !== specificBuildingId) {
                        return false;
                    }
                }
                // Admin can see all documents
                if (userRole === 'admin') {
                    return true;
                }
                // Manager can see all documents in their organization
                if (userRole === 'manager' && organizationId) {
                    if (doc.buildingId && buildingIds.includes(doc.buildingId)) {
                        return true;
                    }
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                }
                // Resident access rules
                if (userRole === 'resident') {
                    // Residents can see documents in their residence
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                    // Residents can see building documents related to their residences
                    if (doc.buildingId) {
                        // Check if any of user's residences belong to this building
                        const userBuildingIds = userResidences
                            .map((ur) => ur.residence?.buildingId || ur.userResidence?.residence?.buildingId)
                            .filter(Boolean);
                        return userBuildingIds.includes(doc.buildingId);
                    }
                }
                // Tenant access rules - more restrictive
                if (userRole === 'tenant') {
                    // Tenants can only see documents marked as visible to tenants
                    if (!doc.isVisibleToTenants) {
                        return false;
                    }
                    // Tenants can see visible documents in their residence
                    if (doc.residenceId && residenceIds.includes(doc.residenceId)) {
                        return true;
                    }
                    // Tenants can see visible building documents related to their residences
                    if (doc.buildingId) {
                        // Check if any of user's residences belong to this building
                        const userBuildingIds = userResidences
                            .map((ur) => ur.residence?.buildingId || ur.userResidence?.residence?.buildingId)
                            .filter(Boolean);
                        return userBuildingIds.includes(doc.buildingId);
                    }
                }
                return false;
            });
            // Add document type indicators for frontend compatibility and field mapping
            const enhancedDocumentRecords = filteredDocumentRecords.map((doc) => ({
                ...doc,
                title: doc.name, // Map database 'name' field to frontend 'title' field
                category: doc.documentType, // Map database 'documentType' to frontend 'category'
                documentCategory: doc.buildingId ? 'building' : 'resident',
                entityType: doc.buildingId ? 'building' : 'residence',
                entityId: doc.buildingId || doc.residenceId,
                uploadDate: doc.createdAt, // For backward compatibility
                fileUrl: doc.filePath ? `/api/documents/${doc.id}/file` : undefined, // Generate file URL if file exists
            }));
            allDocumentRecords.push(...enhancedDocumentRecords);
            // Sort by upload date, most recent first
            allDocumentRecords.sort((a, b) => new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime());
            const response = {
                documents: allDocumentRecords,
                total: allDocumentRecords.length,
                buildingCount: allDocumentRecords.filter((d) => d.documentCategory === 'building').length,
                residentCount: allDocumentRecords.filter((d) => d.documentCategory === 'resident').length,
                legacyCount: allDocumentRecords.filter((d) => d.documentCategory === 'legacy').length,
            };
            // Log successful document access
            logSecurityEvent('DOCUMENT_LIST_ACCESS', user, true, undefined, {
                documentsReturned: allDocumentRecords.length,
                filters: { documentType, specificResidenceId, specificBuildingId }
            });
            res.json(response);
        }
        catch (_error) {
            const errorEntry = logError('GET /api/documents', _error, req.user);
            res.status(500).json({
                message: 'Failed to fetch documents',
                error_id: errorEntry.timestamp,
                debug_info: process.env.NODE_ENV === 'development' ? _error.message : undefined
            });
        }
    });
    // Get a specific document by ID
    app.get('/api/documents/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const documentType = req.query.type; // Optional type hint
            // Get user's organization and residences for filtering
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const residences = await storage_1.storage.getUserResidences(userId);
            const buildings = await storage_1.storage.getBuildings();
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            const residenceIds = residences.map((ur) => ur.residenceId);
            const buildingIds = buildings.map((b) => b.id);
            let document = null;
            // Try to find the document in the appropriate table(s)
            const hasNewDocumentRecordMethods = 'getBuildingDocumentRecord' in storage_1.storage;
            if (hasNewDocumentRecordMethods) {
                if (!documentType || documentType === 'building') {
                    try {
                        document = await storage_1.storage.getBuildingDocumentRecord(documentId, userId, userRole, organizationId, buildingIds);
                        if (document) {
                            document.documentCategory = 'building';
                            document.entityType = 'building';
                            document.entityId = document.buildingId;
                        }
                    }
                    catch (e) {
                        console.warn('âš ï¸ Error fetching building document:', e);
                    }
                }
                if (!document && (!documentType || documentType === 'resident')) {
                    try {
                        document = await storage_1.storage.getResidentDocumentRecord(documentId, userId, userRole, organizationId, residenceIds);
                        if (document) {
                            document.documentCategory = 'resident';
                            document.entityType = 'residence';
                            document.entityId = document.residenceId;
                        }
                    }
                    catch (e) {
                        console.warn('âš ï¸ Error fetching resident document:', e);
                    }
                }
            }
            // Fallback to legacy documents if not found and no type specified
            if (!document && !documentType) {
                try {
                    document = await storage_1.storage.getDocument(documentId);
                    if (document) {
                        document.documentCategory = 'legacy';
                        document.entityType = 'legacy';
                        document.entityId = null;
                    }
                }
                catch (e) {
                    console.warn('âš ï¸ Error fetching legacy document:', e);
                }
            }
            if (!document) {
                return res.status(404).json({ message: 'DocumentRecord not found or access denied' });
            }
            res.json(document);
        }
        catch (error) {
            console.error('âŒ Error fetching document:', error);
            res.status(500).json({ message: 'Failed to fetch document' });
        }
    });
    // Create a new document (supports both file upload and text-only documents)
    app.post('/api/documents', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Starting document upload/creation`);
        console.log(`ðŸ“„ [DOCUMENTS UPLOAD] User: ${req.user.id} (${req.user.role})`);
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const { documentType, buildingId, residenceId, textContent, type, ...otherData } = req.body;
            // Enhanced debug logging with context information
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Request details:`, {
                documentType,
                type,
                buildingId,
                residenceId,
                hasFile: !!req.file,
                hasTextContent: !!textContent,
                otherDataKeys: Object.keys(otherData),
                fileName: req.file?.originalname,
                fileSize: req.file?.size,
                mimeType: req.file?.mimetype
            });
            if (req.file) {
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] File details:`, {
                    originalName: req.file.originalname,
                    mimeType: req.file.mimetype,
                    size: req.file.size,
                    tempPath: req.file.path,
                    encoding: req.file.encoding
                });
            }
            // Enhanced rate limiting check
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Checking rate limit for user ${userId}`);
            const rateLimitCheck = checkUploadRateLimit(userId);
            if (!rateLimitCheck.allowed) {
                console.log(`âŒ [DOCUMENTS UPLOAD] Rate limit exceeded for user ${userId}: ${rateLimitCheck.error}`);
                logSecurityEvent('UPLOAD_RATE_LIMIT_EXCEEDED', user, false, undefined, { error: rateLimitCheck.error });
                return res.status(429).json({ message: rateLimitCheck.error });
            }
            console.log(`âœ… [DOCUMENTS UPLOAD] Rate limit check passed for user ${userId}`);
            // Validate permissions - only admin, manager, and resident can create documents
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Checking permissions for role: ${userRole}`);
            if (!['admin', 'manager', 'resident'].includes(userRole)) {
                console.log(`âŒ [DOCUMENTS UPLOAD] Insufficient permissions for role: ${userRole}`);
                logSecurityEvent('UNAUTHORIZED_UPLOAD_ATTEMPT', user, false, undefined, { requiredRoles: ['admin', 'manager', 'resident'] });
                return res.status(403).json({ message: 'Insufficient permissions to create documents' });
            }
            console.log(`âœ… [DOCUMENTS UPLOAD] Permission check passed for role: ${userRole}`);
            // Check if this is a text-only document, file upload, or metadata-only document
            const isTextDocumentRecord = !req.file && textContent;
            const isFileDocumentRecord = !!req.file;
            const isMetadataDocumentRecord = !req.file && !textContent && (otherData.title || otherData.name);
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Document type determination:`, {
                isTextDocument: isTextDocumentRecord,
                isFileDocument: isFileDocumentRecord,
                isMetadataDocument: isMetadataDocumentRecord,
                hasTitle: !!otherData.title,
                hasName: !!otherData.name,
                hasTextContent: !!textContent
            });
            if (!isTextDocumentRecord && !isFileDocumentRecord && !isMetadataDocumentRecord) {
                console.log(`âŒ [DOCUMENTS UPLOAD] Invalid document request - no file, text, or metadata provided`);
                return res.status(400).json({ message: 'Either a file, text content, or document title/name is required' });
            }
            // For text documents, create unified document directly
            if (isTextDocumentRecord) {
                // Create text document without file storage
                const documentData = {
                    name: otherData.name || 'Untitled DocumentRecord',
                    description: otherData.description || textContent.substring(0, 200) + (textContent.length > 200 ? '...' : ''),
                    documentType: documentType || 'other',
                    filePath: `text-documents/${userId}/${(0, uuid_1.v4)()}.txt`, // Virtual path for text documents
                    isVisibleToTenants: otherData.isVisibleToTenants === 'true' || otherData.isVisibleToTenants === true,
                    residenceId: residenceId || undefined,
                    buildingId: buildingId || undefined,
                    uploadedById: userId,
                };
                // Permission checks
                if (buildingId && userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const building = await storage_1.storage.getBuilding(buildingId);
                    if (!building || building.organizationId !== organizationId) {
                        return res.status(403).json({ message: 'Cannot assign document to building outside your organization' });
                    }
                }
                if (residenceId && userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res.status(403).json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Determine document record type for directory structure
                let documentRecordType;
                if (buildingId && !residenceId) {
                    documentRecordType = 'building';
                }
                else if (residenceId && !buildingId) {
                    documentRecordType = 'resident';
                }
                else {
                    return res.status(400).json({
                        message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                    });
                }
                // Save text content to local file system with proper directory structure
                let fileName;
                try {
                    const textFilePath = path_1.default.join(process.cwd(), 'uploads', documentRecordType);
                    if (!fs_1.default.existsSync(textFilePath)) {
                        fs_1.default.mkdirSync(textFilePath, { recursive: true });
                    }
                    fileName = `${(0, uuid_1.v4)()}-text-document.txt`;
                    const fullPath = path_1.default.join(textFilePath, fileName);
                    fs_1.default.writeFileSync(fullPath, textContent, 'utf8');
                }
                catch (fsError) {
                    console.error('Error saving text document to filesystem:', fsError);
                    return res.status(500).json({ message: 'Failed to save text document' });
                }
                // Update file path to match regular document uploads
                documentData.filePath = `${documentRecordType}/${fileName}`;
                // Create document record in database
                const document = await storage_1.storage.createDocument(documentData);
                return res.status(201).json({
                    message: 'Text document created successfully',
                    document: {
                        ...document,
                        title: document.name, // Map name to title for frontend compatibility
                        category: document.documentType, // Map documentType to category for frontend compatibility
                        documentCategory: buildingId ? 'building' : 'resident',
                        entityType: buildingId ? 'building' : 'residence',
                        entityId: buildingId || residenceId,
                    },
                });
            }
            // Handle metadata-only documents (create document record without file)
            if (isMetadataDocumentRecord) {
                // Map frontend 'title' field to database 'name' field and 'category' to 'documentType'
                const documentData = {
                    name: otherData.title || otherData.name || 'Untitled Document',
                    description: otherData.description || '',
                    documentType: otherData.category || documentType || 'other',
                    filePath: `metadata-documents/${userId}/${(0, uuid_1.v4)()}`, // Placeholder path for metadata-only documents
                    isVisibleToTenants: otherData.isVisibleToTenants === 'true' || otherData.isVisibleToTenants === true || false,
                    residenceId: residenceId || undefined,
                    buildingId: buildingId || undefined,
                    uploadedById: userId,
                };
                // Validate building/residence requirement
                if (!buildingId && !residenceId) {
                    return res.status(400).json({
                        message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                    });
                }
                if (buildingId && residenceId) {
                    return res.status(400).json({
                        message: 'Cannot provide both buildingId and residenceId',
                    });
                }
                // Permission checks
                if (buildingId && userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const building = await storage_1.storage.getBuilding(buildingId);
                    if (!building || building.organizationId !== organizationId) {
                        return res.status(403).json({ message: 'Cannot assign document to building outside your organization' });
                    }
                }
                if (residenceId && userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res.status(403).json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Create document record in database
                const document = await storage_1.storage.createDocument(documentData);
                return res.status(201).json({
                    message: 'Document created successfully',
                    document: {
                        ...document,
                        title: document.name, // Map name to title for frontend compatibility
                        category: document.documentType, // Map documentType to category for frontend compatibility
                        documentCategory: buildingId ? 'building' : 'resident',
                        entityType: buildingId ? 'building' : 'residence',
                        entityId: buildingId || residenceId,
                        fileUrl: undefined, // No file URL for metadata-only documents
                    },
                });
            }
            // Handle file uploads (existing logic)
            console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Starting file document processing`);
            // Determine document record type based on buildingId/residenceId (not from documentType field)
            let finalDocumentRecordType;
            if (buildingId && !residenceId) {
                finalDocumentRecordType = 'building';
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Determined document type: BUILDING (ID: ${buildingId})`);
            }
            else if (residenceId && !buildingId) {
                finalDocumentRecordType = 'resident';
                console.log(`ðŸ“„ [DOCUMENTS UPLOAD] Determined document type: RESIDENCE (ID: ${residenceId})`);
            }
            else if (buildingId && residenceId) {
                console.log(`âŒ [DOCUMENTS UPLOAD] Both buildingId and residenceId provided: ${buildingId}, ${residenceId}`);
                return res.status(400).json({
                    message: 'Cannot provide both buildingId and residenceId',
                });
            }
            else {
                console.log(`âŒ [DOCUMENTS UPLOAD] No buildingId or residenceId provided`);
                return res.status(400).json({
                    message: 'Must provide either buildingId (for building documents) or residenceId (for resident documents)',
                });
            }
            if (finalDocumentRecordType === 'building') {
                console.log(`ðŸ¢ [BUILDING UPLOAD] Processing building document for building ID: ${buildingId}`);
                // Validate and create building document
                if (!buildingId) {
                    console.log(`âŒ [BUILDING UPLOAD] Missing buildingId`);
                    return res.status(400).json({ message: 'buildingId is required for building documents' });
                }
                // Prepare the permanent file path and move file if needed
                let filePath;
                let fileName;
                if (req.file) {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Processing file upload for building ${buildingId}`);
                    // Generate unique filename and move to permanent location
                    fileName = `${(0, uuid_1.v4)()}-${req.file.originalname}`;
                    const permanentDir = path_1.default.join(process.cwd(), 'uploads', 'buildings', buildingId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] File paths:`, {
                        originalName: req.file.originalname,
                        newFileName: fileName,
                        tempPath: req.file.path,
                        permanentDir,
                        directoryExists: fs_1.default.existsSync(permanentDir)
                    });
                    // Ensure directory exists
                    if (!fs_1.default.existsSync(permanentDir)) {
                        console.log(`ðŸ¢ [BUILDING UPLOAD] Creating directory: ${permanentDir}`);
                        fs_1.default.mkdirSync(permanentDir, { recursive: true });
                    }
                    // Move file from temporary to permanent location (copy + delete for cross-filesystem)
                    const permanentPath = path_1.default.join(permanentDir, fileName);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Copying file from ${req.file.path} to ${permanentPath}`);
                    fs_1.default.copyFileSync(req.file.path, permanentPath);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Cleaning up temporary file: ${req.file.path}`);
                    fs_1.default.unlinkSync(req.file.path); // Clean up temporary file
                    filePath = `buildings/${buildingId}/${fileName}`;
                    console.log(`ðŸ¢ [BUILDING UPLOAD] File successfully moved to: ${filePath}`);
                }
                else {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] No file provided, creating placeholder path`);
                    filePath = `temp-path-${Date.now()}`;
                }
                const dataToValidate = {
                    ...otherData,
                    buildingId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other', // Default to 'other' if not provided
                };
                console.log(`ðŸ¢ [BUILDING UPLOAD] Data to validate:`, {
                    buildingId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other',
                    otherDataKeys: Object.keys(otherData)
                });
                let validatedData;
                try {
                    validatedData = schema_1.insertDocumentSchema.parse(dataToValidate);
                    console.log(`âœ… [BUILDING UPLOAD] Document validation successful for building ${buildingId}`);
                }
                catch (validationError) {
                    console.log(`âŒ [BUILDING UPLOAD] Document validation failed for building ${buildingId}:`, validationError);
                    return res.status(400).json({
                        message: 'Validation failed',
                        error: validationError.message || 'Invalid data',
                        details: validationError.issues || validationError
                    });
                }
                // Permission checks for building documents
                console.log(`ðŸ¢ [BUILDING UPLOAD] Checking permissions for role: ${userRole}`);
                if (userRole === 'manager') {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Manager permission check for building ${buildingId}`);
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Manager organization: ${organizationId}`);
                    const building = await storage_1.storage.getBuilding(buildingId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Building organization: ${building?.organizationId}`);
                    if (!building || building.organizationId !== organizationId) {
                        console.log(`âŒ [BUILDING UPLOAD] Manager permission denied - organization mismatch`);
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to building outside your organization' });
                    }
                    console.log(`âœ… [BUILDING UPLOAD] Manager permission check passed`);
                }
                if (userRole === 'resident') {
                    console.log(`ðŸ¢ [BUILDING UPLOAD] Resident permission check for building ${buildingId}`);
                    const residences = await storage_1.storage.getUserResidences(userId);
                    console.log(`ðŸ¢ [BUILDING UPLOAD] User residences count: ${residences.length}`);
                    const hasResidenceInBuilding = await Promise.all(residences.map(async (ur) => {
                        const residence = await storage_1.storage.getResidence(ur.residenceId);
                        const isInBuilding = residence && residence.buildingId === buildingId;
                        console.log(`ðŸ¢ [BUILDING UPLOAD] Residence ${ur.residenceId} in building ${buildingId}: ${isInBuilding}`);
                        return isInBuilding;
                    }));
                    if (!hasResidenceInBuilding.some(Boolean)) {
                        console.log(`âŒ [BUILDING UPLOAD] Resident permission denied - no residence in building`);
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to building where you have no residence' });
                    }
                    console.log(`âœ… [BUILDING UPLOAD] Resident permission check passed`);
                }
                // Create unified document instead of separate building document
                const unifiedDocument = {
                    name: validatedData.name || 'Untitled',
                    description: validatedData.description,
                    documentType: validatedData.documentType,
                    filePath: validatedData.filePath || `temp-path-${Date.now()}`,
                    isVisibleToTenants: validatedData.isVisibleToTenants || false,
                    residenceId: undefined,
                    buildingId: validatedData.buildingId,
                    uploadedById: validatedData.uploadedById,
                };
                console.log(`ðŸ¢ [BUILDING UPLOAD] Creating document in database:`, {
                    name: unifiedDocument.name,
                    documentType: unifiedDocument.documentType,
                    filePath: unifiedDocument.filePath,
                    buildingId: unifiedDocument.buildingId,
                    uploadedById: unifiedDocument.uploadedById
                });
                const document = await storage_1.storage.createDocument(unifiedDocument);
                console.log(`âœ… [BUILDING UPLOAD] Document created successfully with ID: ${document.id}`);
                // File has been moved to permanent location, no cleanup needed
                res.status(201).json({
                    ...document,
                    documentCategory: 'building',
                    entityType: 'building',
                    entityId: document.buildingId,
                });
            }
            else if (finalDocumentRecordType === 'resident') {
                console.log(`ðŸ  [RESIDENCE UPLOAD] Processing residence document for residence ID: ${residenceId}`);
                // Validate and create resident document
                if (!residenceId) {
                    console.log(`âŒ [RESIDENCE UPLOAD] Missing residenceId`);
                    return res
                        .status(400)
                        .json({ message: 'residenceId is required for resident documents' });
                }
                // Prepare the permanent file path and move file if needed
                let filePath;
                let fileName;
                if (req.file) {
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Processing file upload for residence ${residenceId}`);
                    // Generate unique filename and move to permanent location
                    fileName = `${(0, uuid_1.v4)()}-${req.file.originalname}`;
                    const permanentDir = path_1.default.join(process.cwd(), 'uploads', 'residences', residenceId);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] File paths:`, {
                        originalName: req.file.originalname,
                        newFileName: fileName,
                        tempPath: req.file.path,
                        permanentDir,
                        directoryExists: fs_1.default.existsSync(permanentDir)
                    });
                    // Ensure directory exists
                    if (!fs_1.default.existsSync(permanentDir)) {
                        console.log(`ðŸ  [RESIDENCE UPLOAD] Creating directory: ${permanentDir}`);
                        fs_1.default.mkdirSync(permanentDir, { recursive: true });
                    }
                    // Move file from temporary to permanent location (copy + delete for cross-filesystem)
                    const permanentPath = path_1.default.join(permanentDir, fileName);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Copying file from ${req.file.path} to ${permanentPath}`);
                    fs_1.default.copyFileSync(req.file.path, permanentPath);
                    console.log(`ðŸ  [RESIDENCE UPLOAD] Cleaning up temporary file: ${req.file.path}`);
                    fs_1.default.unlinkSync(req.file.path); // Clean up temporary file
                    filePath = `residences/${residenceId}/${fileName}`;
                    console.log(`ðŸ  [RESIDENCE UPLOAD] File successfully moved to: ${filePath}`);
                }
                else {
                    console.log(`ðŸ  [RESIDENCE UPLOAD] No file provided, creating placeholder path`);
                    filePath = `temp-path-${Date.now()}`;
                }
                const dataToValidate = {
                    ...otherData,
                    residenceId,
                    uploadedById: userId,
                    filePath,
                    fileName,
                    fileSize: req.file?.size,
                    mimeType: req.file?.mimetype,
                    documentType: documentType || type || 'other', // Default to 'other' if not provided
                };
                console.log('ðŸ” Residence document validation debug:', {
                    dataToValidate,
                    documentType,
                    otherDataKeys: Object.keys(otherData),
                    hasFile: !!req.file
                });
                let validatedData;
                try {
                    validatedData = schema_1.insertDocumentSchema.parse(dataToValidate);
                    console.log('âœ… Residence document validation SUCCESS');
                }
                catch (validationError) {
                    console.log('âŒ Residence document validation ERROR:', validationError);
                    return res.status(400).json({
                        message: 'Validation failed',
                        error: validationError.message || 'Invalid data',
                        details: validationError.issues || validationError
                    });
                }
                // Permission checks for resident documents
                if (userRole === 'manager') {
                    const organizations = await storage_1.storage.getUserOrganizations(userId);
                    const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
                    const residence = await storage_1.storage.getResidence(residenceId);
                    if (residence) {
                        const building = await storage_1.storage.getBuilding(residence.buildingId);
                        if (!building || building.organizationId !== organizationId) {
                            return res
                                .status(403)
                                .json({ message: 'Cannot assign document to residence outside your organization' });
                        }
                    }
                    else {
                        return res.status(404).json({ message: 'Residence not found' });
                    }
                }
                if (userRole === 'resident') {
                    const residences = await storage_1.storage.getUserResidences(userId);
                    const residenceIds = residences.map((ur) => ur.residenceId);
                    if (!residenceIds.includes(residenceId)) {
                        return res
                            .status(403)
                            .json({ message: 'Cannot assign document to residence you do not own' });
                    }
                }
                // Convert to unified document format
                const unifiedDocument = {
                    name: validatedData.name || 'Untitled',
                    description: validatedData.description,
                    documentType: validatedData.documentType,
                    filePath: validatedData.filePath || `temp-path-${Date.now()}`,
                    isVisibleToTenants: validatedData.isVisibleToTenants || false,
                    residenceId: validatedData.residenceId,
                    buildingId: undefined,
                    uploadedById: validatedData.uploadedById,
                };
                const document = await storage_1.storage.createDocument(unifiedDocument);
                console.log('ðŸ“ Created resident document:', document);
                console.log('ðŸ“ DocumentRecord ID:', document.id);
                const response = {
                    ...document,
                    documentCategory: 'resident',
                    entityType: 'residence',
                    entityId: document.residenceId,
                };
                console.log('ðŸ“¤ Sending response:', response);
                res.status(201).json(response);
            }
            else {
                return res.status(400).json({
                    message: 'Invalid documentType. Must be either \"building\" or \"resident\"',
                });
            }
        }
        catch (_error) {
            // Clean up temporary file on error
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.warn('âš ï¸ Failed to cleanup temporary file:', cleanupError);
                }
            }
            console.error('âŒ Error creating document:', _error);
            if (_error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    message: 'Invalid document data',
                    errors: _error.issues,
                });
            }
            res.status(500).json({ message: 'Failed to create document' });
        }
    });
    // Update a document
    app.put('/api/documents/:id', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        console.log(`ðŸ“ [DOCUMENT UPDATE] Starting update for document ID: ${req.params.id}`);
        console.log(`ðŸ“ [DOCUMENT UPDATE] User: ${req.user.id} (${req.user.role})`);
        console.log(`ðŸ“ [DOCUMENT UPDATE] Body:`, req.body);
        console.log(`ðŸ“ [DOCUMENT UPDATE] File provided:`, !!req.file);
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            // Get existing document first to check permissions and get current file path
            const existingDocument = await storage_1.storage.getDocuments({ documentId }).then(docs => docs[0]);
            if (!existingDocument) {
                console.log(`âŒ [DOCUMENT UPDATE] Document not found: ${documentId}`);
                return res.status(404).json({ message: 'Document not found' });
            }
            console.log(`ðŸ“ [DOCUMENT UPDATE] Existing document:`, {
                id: existingDocument.id,
                name: existingDocument.name,
                filePath: existingDocument.filePath,
                buildingId: existingDocument.buildingId,
                residenceId: existingDocument.residenceId
            });
            // Check permissions (similar to view permissions)
            let hasAccess = false;
            if (userRole === 'admin') {
                hasAccess = true;
                console.log(`âœ… [DOCUMENT UPDATE] Admin access granted`);
            }
            else if (userRole === 'manager') {
                // Manager should have access to documents in their organization
                const organizations = await storage_1.storage.getUserOrganizations(userId);
                const buildings = await storage_1.storage.getBuildings();
                const userOrganizations = organizations.map(org => org.organizationId);
                if (existingDocument.buildingId) {
                    const orgBuildings = buildings.filter(building => userOrganizations.includes(building.organizationId || ''));
                    const orgBuildingIds = orgBuildings.map(b => b.id);
                    hasAccess = orgBuildingIds.includes(existingDocument.buildingId);
                }
                console.log(`ðŸ“ [DOCUMENT UPDATE] Manager access: ${hasAccess}`);
            }
            if (!hasAccess) {
                console.log(`âŒ [DOCUMENT UPDATE] Access denied for user ${userId}`);
                return res.status(403).json({ message: 'Access denied' });
            }
            // Prepare update data
            const updateData = {};
            if (req.body.name)
                updateData.name = req.body.name;
            if (req.body.description !== undefined)
                updateData.description = req.body.description;
            if (req.body.documentType)
                updateData.documentType = req.body.documentType;
            if (req.body.isVisibleToTenants !== undefined) {
                updateData.isVisibleToTenants = req.body.isVisibleToTenants === 'true';
            }
            console.log(`ðŸ“ [DOCUMENT UPDATE] Update data:`, updateData);
            // Handle file replacement if provided
            if (req.file) {
                console.log(`ðŸ“ [DOCUMENT UPDATE] Processing file replacement:`, {
                    originalname: req.file.originalname,
                    size: req.file.size,
                    mimetype: req.file.mimetype,
                    tempPath: req.file.path
                });
                // Validate the file
                const fileValidation = validateFile(req.file);
                if (!fileValidation.isValid) {
                    // Clean up temp file
                    try {
                        fs_1.default.unlinkSync(req.file.path);
                    }
                    catch (cleanupError) {
                        console.warn('âš ï¸ Failed to cleanup temp file:', cleanupError);
                    }
                    return res.status(400).json({ message: fileValidation.error });
                }
                // Generate unique file path
                const fileExtension = path_1.default.extname(req.file.originalname);
                const baseFileName = path_1.default.basename(req.file.originalname, fileExtension);
                const uniqueId = crypto_1.default.randomBytes(16).toString('hex');
                const entityType = existingDocument.buildingId ? 'buildings' : 'residences';
                const entityId = existingDocument.buildingId || existingDocument.residenceId;
                const documentsDir = path_1.default.join(process.cwd(), 'uploads', entityType, entityId || 'general');
                const uniqueFileName = `${uniqueId}-${baseFileName}${fileExtension}`;
                const finalPath = path_1.default.join(documentsDir, uniqueFileName);
                const relativePath = path_1.default.join(entityType, entityId || 'general', uniqueFileName);
                // Ensure directory exists
                if (!fs_1.default.existsSync(documentsDir)) {
                    fs_1.default.mkdirSync(documentsDir, { recursive: true });
                }
                // Move file from temp to final location
                fs_1.default.renameSync(req.file.path, finalPath);
                // Update file-related fields
                updateData.filePath = relativePath;
                updateData.fileName = req.file.originalname;
                updateData.fileSize = req.file.size;
                updateData.mimeType = req.file.mimetype;
                console.log(`âœ… [DOCUMENT UPDATE] File stored at: ${finalPath}`);
                // Clean up old file if it exists
                if (existingDocument.filePath) {
                    const oldFilePath = path_1.default.isAbsolute(existingDocument.filePath)
                        ? existingDocument.filePath
                        : path_1.default.join(process.cwd(), 'uploads', existingDocument.filePath);
                    try {
                        if (fs_1.default.existsSync(oldFilePath)) {
                            fs_1.default.unlinkSync(oldFilePath);
                            console.log(`ðŸ—‘ï¸ [DOCUMENT UPDATE] Cleaned up old file: ${oldFilePath}`);
                        }
                    }
                    catch (cleanupError) {
                        console.warn('âš ï¸ Failed to cleanup old file:', cleanupError);
                    }
                }
            }
            // Update the document
            const updatedDocument = await storage_1.storage.updateDocument(documentId, updateData);
            if (!updatedDocument) {
                console.log(`âŒ [DOCUMENT UPDATE] Failed to update document: ${documentId}`);
                return res.status(404).json({ message: 'Failed to update document' });
            }
            console.log(`âœ… [DOCUMENT UPDATE] Document updated successfully:`, {
                id: updatedDocument.id,
                name: updatedDocument.name
            });
            // Add compatibility fields for frontend
            updatedDocument.documentCategory = updatedDocument.buildingId ? 'building' : 'resident';
            updatedDocument.entityType = updatedDocument.buildingId ? 'building' : 'residence';
            updatedDocument.entityId = updatedDocument.buildingId || updatedDocument.residenceId;
            res.json(updatedDocument);
        }
        catch (_error) {
            // Clean up temporary file on error
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                    console.log(`ðŸ—‘ï¸ [DOCUMENT UPDATE] Cleaned up temp file on error: ${req.file.path}`);
                }
                catch (cleanupError) {
                    console.warn('âš ï¸ Failed to cleanup temporary file:', cleanupError);
                }
            }
            console.error('âŒ Error updating document:', _error);
            if (_error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    message: 'Invalid document data',
                    errors: _error.issues,
                });
            }
            res.status(500).json({ message: 'Failed to update document' });
        }
    });
    // Security audit endpoint - admin only
    app.get('/api/documents/security/audit-log', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            // Only admins can access audit logs
            if (user.role !== 'admin') {
                logSecurityEvent('UNAUTHORIZED_AUDIT_ACCESS', user, false);
                return res.status(403).json({ message: 'Access denied. Admin privileges required.' });
            }
            // Get last 100 audit events with pagination support
            const limit = Math.min(parseInt(req.query.limit) || 50, 100);
            const offset = parseInt(req.query.offset) || 0;
            const paginatedLogs = auditLog.slice(offset, offset + limit);
            logSecurityEvent('AUDIT_LOG_ACCESS', user, true, undefined, { limit, offset });
            res.json({
                events: paginatedLogs,
                total: auditLog.length,
                limit,
                offset
            });
        }
        catch (error) {
            console.error('Error accessing audit log:', error);
            res.status(500).json({ message: 'Failed to retrieve audit log' });
        }
    });
    // Delete document with enhanced security logging
    app.delete('/api/documents/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const documentType = req.query.type; // Optional type hint
            // Get user's organization for permission checking
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : undefined;
            // Use unified documents system for deletion
            let deleted = false;
            try {
                deleted = await storage_1.storage.deleteDocument(documentId);
            }
            catch (e) {
                console.warn('âš ï¸ Error deleting document:', e);
            }
            if (!deleted) {
                return res.status(404).json({ message: 'DocumentRecord not found or access denied' });
            }
            res.status(204).send();
        }
        catch (error) {
            console.error('âŒ Error in document deletion:', error);
            res.status(500).json({ message: 'Failed to delete document' });
        }
    });
    // Upload endpoint that matches frontend expectation: /api/documents/:id/upload
    app.post('/api/documents/:id/upload', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id; // The :id in the URL is the document ID (from frontend)
            const { documentType = 'resident', residenceId, ...otherData } = req.body;
            console.log('ðŸ“¤ Upload request received:', {
                documentId,
                userId,
                userRole,
                hasFile: !!req.file,
                fileInfo: req.file
                    ? {
                        fieldname: req.file.fieldname,
                        originalname: req.file.originalname,
                        encoding: req.file.encoding,
                        mimetype: req.file.mimetype,
                        size: req.file.size,
                        path: req.file.path,
                    }
                    : null,
                bodyKeys: Object.keys(req.body),
                contentType: req.headers['content-type'],
            });
            // Validate permissions - only admin, manager, and resident can create documents
            if (!['admin', 'manager', 'resident'].includes(userRole)) {
                return res.status(403).json({ message: 'Insufficient permissions to create documents' });
            }
            if (!req.file) {
                console.error('âŒ No file received in upload request');
                return res.status(400).json({ message: 'File is required for upload' });
            }
            // Get the existing document to determine where to store the file
            const documents = await storage_1.storage.getDocuments({
                userId,
                userRole,
            });
            const existingDocument = documents.find((doc) => doc.id === documentId);
            if (!existingDocument) {
                return res.status(404).json({ message: 'DocumentRecord not found' });
            }
            // File validation passed - file exists and is ready for upload
            // Determine organization ID based on document context
            let organizationId;
            if (existingDocument.buildingId) {
                const building = await storage_1.storage.getBuilding(existingDocument.buildingId);
                if (!building) {
                    return res.status(404).json({ message: 'Building not found' });
                }
                organizationId = building.organizationId;
            }
            else if (existingDocument.residenceId) {
                const residence = await storage_1.storage.getResidence(existingDocument.residenceId);
                if (!residence) {
                    return res.status(404).json({ message: 'Residence not found' });
                }
                const building = await storage_1.storage.getBuilding(residence.buildingId);
                if (!building) {
                    return res.status(404).json({ message: 'Building not found' });
                }
                organizationId = building.organizationId;
            }
            else {
                return res
                    .status(400)
                    .json({ message: 'DocumentRecord must be associated with a building or residence' });
            }
            // Note: File upload to external storage removed
            // Update document with file information
            const updatedDocument = await storage_1.storage.updateDocument(documentId, {
                filePath: `prod_org_${organizationId}/${req.file.originalname}`,
                name: req.file.originalname,
                // Remove mimeType as it's not in schema
            });
            // Clean up temporary file
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                fs_1.default.unlinkSync(req.file.path);
            }
            res.status(200).json({
                document: updatedDocument,
                message: 'File uploaded successfully',
            });
        }
        catch (error) {
            const errorTimestamp = new Date().toISOString();
            console.error(`[${errorTimestamp}] Error type:`, error.constructor.name);
            console.error(`[${errorTimestamp}] Error message:`, error.message);
            console.error(`[${errorTimestamp}] Error stack:`, error.stack);
            // Clean up temporary file on error
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.error(`[${errorTimestamp}] Error cleaning up file:`, cleanupError);
                }
            }
            if (error.name === 'ZodError') {
                return res.status(400).json({
                    message: 'Validation error',
                    errors: error.errors,
                });
            }
            res.status(500).json({ message: 'Failed to upload document' });
        }
    });
    // POST /api/documents/upload - Upload file to GCS and create unified document record
    app.post('/api/documents/upload', auth_1.requireAuth, upload.single('file'), async (req, res) => {
        const timestamp = new Date().toISOString();
        console.log(`[${timestamp}] ðŸ“‹ POST /api/documents/upload - Starting upload`, {
            hasFile: !!req.file,
            fileName: req.file?.originalname,
            fileSize: req.file?.size,
            body: req.body,
            userId: req.user?.id
        });
        try {
            // Check if file was uploaded
            if (!req.file) {
                return res.status(400).json({ message: 'No file uploaded' });
            }
            // Parse form data
            const formData = {
                name: req.body.name,
                description: req.body.description || '',
                documentType: req.body.documentType || req.body.type, // Handle both field names
                isVisibleToTenants: req.body.isVisibleToTenants === 'true',
                residenceId: req.body.residenceId || undefined,
                buildingId: req.body.buildingId || undefined,
                attachedToType: req.body.attachedToType || undefined,
                attachedToId: req.body.attachedToId || undefined,
            };
            // Production debugging: Log form data before validation
            if (process.env.NODE_ENV === 'production') {
                console.log('[PROD DEBUG] Form data before validation:', formData);
            }
            // Validate form data
            const validatedData = uploadDocumentRecordSchema.parse(formData);
            // DEBUG: Log validated data to see what's being passed
            console.log(`[${timestamp}] ðŸ” VALIDATION DEBUG: Form data before validation:`, formData);
            console.log(`[${timestamp}] ðŸ” VALIDATION DEBUG: Validated data:`, {
                ...validatedData,
                hasAttachedToType: !!validatedData.attachedToType,
                hasAttachedToId: !!validatedData.attachedToId
            });
            // Production debugging: Log after validation
            if (process.env.NODE_ENV === 'production') {
                console.log('[PROD DEBUG] Form data validation passed:', validatedData);
            }
            // Get user info from auth middleware
            const userId = req.user?.id;
            if (!userId) {
                return res.status(401).json({ message: 'User not authenticated' });
            }
            // GCS DISABLED: Skip bucket configuration (using local storage only)
            console.log('ðŸ“ GCS disabled - skipping bucket configuration check');
            // Generate unique GCS path
            const fileExtension = path_1.default.extname(req.file.originalname);
            const baseFileName = path_1.default.basename(req.file.originalname, fileExtension);
            const uniqueFileName = `${(0, uuid_1.v4)()}-${baseFileName}${fileExtension}`;
            let filePath;
            if (validatedData.residenceId) {
                filePath = `residences/${validatedData.residenceId}/${uniqueFileName}`;
            }
            else if (validatedData.buildingId) {
                filePath = `buildings/${validatedData.buildingId}/${uniqueFileName}`;
            }
            else {
                filePath = `general/${uniqueFileName}`;
            }
            // DISABLED GCS: Force local storage for all environments
            console.log('ðŸ“ GCS disabled - using local storage for all document operations');
            // Always use local storage (GCS disabled)
            try {
                // Use local storage with robust error handling
                const localStoragePath = path_1.default.join(process.cwd(), 'uploads');
                // Ensure uploads directory exists
                try {
                    if (!fs_1.default.existsSync(localStoragePath)) {
                        fs_1.default.mkdirSync(localStoragePath, { recursive: true });
                        console.log(`ðŸ“ Created uploads directory: ${localStoragePath}`);
                    }
                }
                catch (dirError) {
                    console.error('Failed to create uploads directory:', dirError);
                    throw new Error('Cannot create uploads directory - check permissions');
                }
                // Create directory structure for file
                const localFilePath = path_1.default.join(localStoragePath, filePath);
                const localFileDir = path_1.default.dirname(localFilePath);
                try {
                    if (!fs_1.default.existsSync(localFileDir)) {
                        fs_1.default.mkdirSync(localFileDir, { recursive: true });
                        console.log(`ðŸ“ Created subdirectory: ${localFileDir}`);
                    }
                }
                catch (subdirError) {
                    console.error('Failed to create file subdirectory:', subdirError);
                    throw new Error('Cannot create file directory - check permissions');
                }
                // Copy uploaded file to local storage
                try {
                    fs_1.default.copyFileSync(req.file.path, localFilePath);
                    console.log(`ðŸ“ File saved successfully at ${localFilePath}`);
                }
                catch (copyError) {
                    console.error('Failed to copy file:', copyError);
                    throw new Error('Cannot save file - check disk space and permissions');
                }
            }
            catch (localError) {
                console.error('Local storage error:', localError);
                throw new Error('Failed to save file locally');
            }
            // Create document record in database
            const documentData = {
                name: validatedData.name,
                description: validatedData.description,
                documentType: validatedData.documentType,
                filePath: filePath,
                isVisibleToTenants: validatedData.isVisibleToTenants,
                residenceId: validatedData.residenceId,
                buildingId: validatedData.buildingId,
                uploadedById: userId,
                attachedToType: validatedData.attachedToType,
                attachedToId: validatedData.attachedToId,
            };
            // CRITICAL DEBUG POINT: Database creation
            console.log(`[${timestamp}] ðŸŽ¯ CRITICAL: About to create document in database:`, {
                name: documentData.name,
                type: documentData.documentType,
                buildingId: documentData.buildingId,
                residenceId: documentData.residenceId,
                uploadedById: documentData.uploadedById,
                attachedToType: documentData.attachedToType,
                attachedToId: documentData.attachedToId
            });
            // Create document record in database  
            const newDocument = await storage_1.storage.createDocument(documentData);
            // CRITICAL: Log successful database creation
            console.log(`[${timestamp}] âœ… CRITICAL: DocumentRecord created successfully:`, {
                id: newDocument?.id,
                name: newDocument?.name,
                filePath: newDocument?.filePath
            });
            // Clean up temporary file
            if (fs_1.default.existsSync(req.file.path)) {
                fs_1.default.unlinkSync(req.file.path);
            }
            // Return success response
            res.status(201).json({
                message: 'DocumentRecord uploaded successfully',
                document: newDocument,
            });
        }
        catch (error) {
            const errorEntry = logError('POST /api/documents/upload', error, req.user);
            // Clean up temporary file on error
            if (req.file && req.file.path && fs_1.default.existsSync(req.file.path)) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (cleanupError) {
                    console.error('Error cleaning up temporary file:', cleanupError);
                }
            }
            // Handle validation errors
            if (error.name === 'ZodError') {
                return res.status(400).json({
                    message: 'Validation error',
                    errors: error.errors,
                    error_id: errorEntry.timestamp
                });
            }
            // Handle GCS errors
            if (error.message && error.message.includes('Google Cloud Storage')) {
                return res.status(500).json({
                    message: 'File upload failed',
                    error: 'Storage service error',
                    error_id: errorEntry.timestamp
                });
            }
            // Handle unique constraint violations (path conflicts)
            if (error?.message?.includes('unique constraint') || error?.code === '23505') {
                return res.status(409).json({
                    message: 'DocumentRecord path conflict - please try uploading again',
                    error: 'Path already exists',
                    error_id: errorEntry.timestamp
                });
            }
            // Handle database errors
            if (error.message && error.message.includes('database')) {
                return res.status(500).json({
                    message: 'Failed to save document record',
                    error: 'Database error',
                    error_id: errorEntry.timestamp
                });
            }
            // Generic error response
            res.status(500).json({
                message: 'Internal server error',
                error: 'DocumentRecord upload failed',
                error_id: errorEntry.timestamp,
                debug_info: process.env.NODE_ENV === 'development' ? error.message : undefined
            });
        }
    });
    // Serve document files
    // Serve document files with proper role-based access control
    app.get('/api/documents/:id/file', auth_1.requireAuth, async (req, res) => {
        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] File download request for document ID: ${req.params.id}`);
        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] User: ${req.user.id} (${req.user.role})`);
        try {
            const user = req.user;
            const userRole = user.role;
            const userId = user.id;
            const documentId = req.params.id;
            const isDownload = req.query.download === 'true';
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Request details:`, {
                documentId,
                userId,
                userRole,
                isDownload
            });
            // Get user's organization and residences for permission checking
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Fetching user permissions data...`);
            const organizations = await storage_1.storage.getUserOrganizations(userId);
            const residences = await storage_1.storage.getUserResidences(userId);
            const buildings = await storage_1.storage.getBuildings();
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] User permissions:`, {
                organizationsCount: organizations.length,
                residencesCount: residences.length,
                buildingsCount: buildings.length
            });
            // Log access attempt for security auditing
            logSecurityEvent('DOCUMENT_FILE_ACCESS_ATTEMPT', user, false, documentId, {
                userRole,
                documentId,
                isDownload
            });
            // Find the document directly from database without filtering by user
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Looking for document ${documentId} in database...`);
            const allDocuments = await storage_1.storage.getDocuments({});
            const document = allDocuments.find((doc) => doc.id === documentId);
            if (!document) {
                console.log(`âŒ [DOCUMENT DOWNLOAD] Document not found: ${documentId}`);
                logSecurityEvent('DOCUMENT_FILE_ACCESS_NOT_FOUND', user, false, documentId);
                return res.status(404).json({ message: 'Document not found' });
            }
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Document found:`, {
                id: document.id,
                name: document.name,
                filePath: document.filePath,
                buildingId: document.buildingId,
                residenceId: document.residenceId,
                isVisibleToTenants: document.isVisibleToTenants,
                uploadedById: document.uploadedById
            });
            // Get user's organization info
            const userOrganizations = organizations.map(org => org.organizationId);
            const userResidenceIds = residences
                .map((ur) => ur.residenceId || ur.userResidence?.residenceId || ur.residence?.id)
                .filter(Boolean);
            // Get building IDs that user's residences belong to
            const userBuildingIds = [];
            for (const userResidence of residences) {
                // Handle different residence data structures
                const residenceId = userResidence.residenceId;
                if (residenceId) {
                    // Find the actual residence to get building ID
                    const allResidences = await storage_1.storage.getResidences();
                    const residence = allResidences.find(r => r.id === residenceId);
                    if (residence?.buildingId) {
                        userBuildingIds.push(residence.buildingId);
                    }
                }
            }
            // Check permissions based on the specified rules
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Checking access permissions for role: ${userRole}`);
            let hasAccess = false;
            let accessReason = '';
            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Permission context:`, {
                userOrganizations,
                userResidenceIds,
                userBuildingIds,
                documentBuildingId: document.buildingId,
                documentResidenceId: document.residenceId,
                documentIsVisibleToTenants: document.isVisibleToTenants
            });
            if (userRole === 'admin') {
                hasAccess = true;
                accessReason = 'Admin has global access';
                console.log(`âœ… [DOCUMENT DOWNLOAD] Admin granted access`);
            }
            else if (userRole === 'manager') {
                console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Checking manager permissions...`);
                // Manager should have access to buildings they are assigned to
                if (document.buildingId) {
                    console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Document is building-level, checking organization access`);
                    // Get buildings for the manager's organization
                    const orgBuildings = buildings.filter(building => userOrganizations.includes(building.organizationId || ''));
                    const orgBuildingIds = orgBuildings.map(b => b.id);
                    console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Manager organization buildings:`, {
                        userOrganizations,
                        orgBuildingIds,
                        documentBuildingId: document.buildingId
                    });
                    if (orgBuildingIds.includes(document.buildingId)) {
                        hasAccess = true;
                        accessReason = 'Manager has access to organization buildings';
                        console.log(`âœ… [DOCUMENT DOWNLOAD] Manager granted building access`);
                    }
                    else {
                        console.log(`âŒ [DOCUMENT DOWNLOAD] Manager denied building access - not in organization`);
                    }
                }
                // Manager has access to all residences in their organization
                if (document.residenceId) {
                    // Check if residence belongs to manager's organization
                    const allResidences = await storage_1.storage.getResidences();
                    const residence = allResidences.find(r => r.id === document.residenceId);
                    if (residence) {
                        // Check if residence building belongs to manager's organization
                        const residenceBuilding = buildings.find(b => b.id === residence.buildingId);
                        if (residenceBuilding && userOrganizations.includes(residenceBuilding.organizationId || '')) {
                            hasAccess = true;
                            accessReason = 'Manager has access to organization residences';
                        }
                    }
                }
            }
            else if (userRole === 'resident') {
                // Resident has access to building files they are assigned to
                if (document.buildingId && userBuildingIds.includes(document.buildingId)) {
                    hasAccess = true;
                    accessReason = 'Resident has access to assigned building documents';
                }
                // Resident has access to residence files they are assigned to
                if (document.residenceId && userResidenceIds.includes(document.residenceId)) {
                    hasAccess = true;
                    accessReason = 'Resident has access to assigned residence documents';
                }
            }
            else if (userRole === 'tenant') {
                // Tenants can only access documents marked as visible to tenants
                if (document.isVisibleToTenants) {
                    // Tenant has access to building files they are assigned to and marked for tenant
                    if (document.buildingId && userBuildingIds.includes(document.buildingId)) {
                        hasAccess = true;
                        accessReason = 'Tenant has access to assigned building documents marked for tenants';
                    }
                    // Tenant has access to residence files they are assigned to and marked for tenant
                    if (document.residenceId && userResidenceIds.includes(document.residenceId)) {
                        hasAccess = true;
                        accessReason = 'Tenant has access to assigned residence documents marked for tenants';
                    }
                }
            }
            if (!hasAccess) {
                console.log(`âŒ [DOCUMENT DOWNLOAD] Access denied for user ${userId} to document ${documentId}`);
                logSecurityEvent('DOCUMENT_FILE_ACCESS_DENIED', user, false, documentId, {
                    userRole,
                    documentBuildingId: document.buildingId,
                    documentResidenceId: document.residenceId,
                    userBuildingIds,
                    userResidenceIds,
                    isVisibleToTenants: document.isVisibleToTenants
                });
                return res.status(403).json({ message: 'Access denied' });
            }
            console.log(`âœ… [DOCUMENT DOWNLOAD] Access granted: ${accessReason}`);
            // Log successful access
            logSecurityEvent('DOCUMENT_FILE_ACCESS_GRANTED', user, true, documentId, {
                accessReason,
                userRole,
                documentType: document.documentType
            });
            // Serve from local storage
            if (document.filePath) {
                console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Serving file from local storage: ${document.filePath}`);
                try {
                    // Always serve from local storage (GCS disabled)
                    let filePathToServe = document.filePath;
                    console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Resolving file path from: ${document.filePath}`);
                    // Check if it's an absolute path
                    if (document.filePath.startsWith('/')) {
                        filePathToServe = document.filePath;
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Using absolute path: ${filePathToServe}`);
                    }
                    // Check if it's a relative file path
                    else if (document.filePath.includes('residences/') ||
                        document.filePath.includes('buildings/') ||
                        document.filePath.includes('text-documents/') ||
                        document.filePath.includes('general/')) {
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Relative path detected, checking common locations...`);
                        // For development, try to find the file in common upload directories
                        const possiblePaths = [
                            path_1.default.join(process.cwd(), 'uploads', document.filePath), // Main fallback location
                            `/tmp/uploads/${document.filePath}`,
                            `/uploads/${document.filePath}`,
                            `./uploads/${document.filePath}`,
                            path_1.default.join('/tmp', document.filePath),
                        ];
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Checking possible paths:`, possiblePaths);
                        // Try to find the file in any of these locations
                        for (const possiblePath of possiblePaths) {
                            console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Checking path: ${possiblePath} (exists: ${fs_1.default.existsSync(possiblePath)})`);
                            if (fs_1.default.existsSync(possiblePath)) {
                                filePathToServe = possiblePath;
                                console.log(`âœ… [DOCUMENT DOWNLOAD] Found file at: ${filePathToServe}`);
                                break;
                            }
                        }
                    }
                    // Check if it's a temp file path
                    else if (document.filePath.includes('tmp')) {
                        filePathToServe = document.filePath;
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Using temp file path: ${filePathToServe}`);
                    }
                    // Try to serve the file
                    if (fs_1.default.existsSync(filePathToServe)) {
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] File found, preparing to serve: ${filePathToServe}`);
                        // Get the original filename with extension, or construct one from the document name
                        let fileName = document.fileName || document.name || path_1.default.basename(document.filePath);
                        // If the fileName doesn't have an extension, add it from the original file path
                        if (!path_1.default.extname(fileName) && document.filePath) {
                            const originalExt = path_1.default.extname(document.filePath);
                            if (originalExt) {
                                fileName += originalExt;
                            }
                        }
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] File details:`, {
                            originalFileName: fileName,
                            isDownload,
                            filePathToServe,
                            fileSize: fs_1.default.statSync(filePathToServe).size
                        });
                        if (isDownload) {
                            res.setHeader('Content-Disposition', `attachment; filename="${fileName}"`);
                        }
                        else {
                            res.setHeader('Content-Disposition', `inline; filename="${fileName}"`);
                        }
                        // Set appropriate content type based on file extension
                        const ext = path_1.default.extname(fileName).toLowerCase();
                        console.log(`ðŸ“¥ [DOCUMENT DOWNLOAD] Setting content type for extension: ${ext}`);
                        if (ext === '.pdf') {
                            res.setHeader('Content-Type', 'application/pdf');
                        }
                        else if (ext === '.jpg' || ext === '.jpeg') {
                            res.setHeader('Content-Type', 'image/jpeg');
                        }
                        else if (ext === '.png') {
                            res.setHeader('Content-Type', 'image/png');
                        }
                        else if (ext === '.gif') {
                            res.setHeader('Content-Type', 'image/gif');
                        }
                        else if (ext === '.doc' || ext === '.docx') {
                            res.setHeader('Content-Type', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document');
                        }
                        else if (ext === '.txt') {
                            res.setHeader('Content-Type', 'text/plain; charset=utf-8');
                        }
                        else {
                            res.setHeader('Content-Type', 'application/octet-stream');
                        }
                        // Production cache busting for documents
                        if (process.env.NODE_ENV === 'production') {
                            const fileStats = fs_1.default.statSync(filePathToServe);
                            res.set({
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0',
                                'ETag': `"${document.id}-${fileStats.mtime.getTime()}"`,
                                'Last-Modified': fileStats.mtime.toUTCString(),
                            });
                        }
                        console.log(`âœ… [DOCUMENT DOWNLOAD] Serving file: ${filePathToServe} as ${fileName}`);
                        return res.sendFile(path_1.default.resolve(filePathToServe));
                    }
                    // If file not found locally, log for debugging
                    console.log(`âŒ [DOCUMENT DOWNLOAD] File not found at filePath: ${document.filePath}`);
                    console.log(`âŒ [DOCUMENT DOWNLOAD] Tried filePath: ${filePathToServe}`);
                    return res.status(404).json({ message: 'File not found on server' });
                }
                catch (fileError) {
                    console.error('âŒ [DOCUMENT DOWNLOAD] Error serving file:', fileError);
                    return res.status(500).json({ message: 'Failed to serve file' });
                }
            }
            console.log(`âŒ [DOCUMENT DOWNLOAD] No file associated with document ${documentId}`);
            return res.status(404).json({ message: 'No file associated with this document' });
        }
        catch (error) {
            console.error('âŒ [DOCUMENT DOWNLOAD] Error serving document file:', error);
            res.status(500).json({ message: 'Failed to serve document file' });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDbkUsQ0FBQztZQUNILENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLDBEQUEwRCxVQUFVLEVBQUUsQ0FBQyxDQUFDO1lBQ3BGLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsdUNBQXVDLEVBQUUsQ0FBQyxDQUFDO1FBQ3BGLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0RBQW9ELEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDM0UsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsK0JBQStCLEVBQUUsQ0FBQyxDQUFDO1FBQ3JFLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUVMLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2RvY3VtZW50cy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEV4cHJlc3MgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoLCByZXF1aXJlUm9sZSB9IGZyb20gJy4uL2F1dGgnO1xuaW1wb3J0IHsgc3RvcmFnZSB9IGZyb20gJy4uL3N0b3JhZ2UnO1xuaW1wb3J0IHtcbiAgZG9jdW1lbnRzLFxuICBpbnNlcnREb2N1bWVudFNjaGVtYSxcbiAgdHlwZSBJbnNlcnREb2N1bWVudCxcbiAgdHlwZSBEb2N1bWVudCxcbn0gZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5cbi8vIFVzZSB0aGUgZ2VuZXJhdGVkIERvY3VtZW50IHR5cGUgZnJvbSBzY2hlbWEgdG8gYXZvaWQgRE9NIERvY3VtZW50IGNvbGxpc2lvblxudHlwZSBEb2N1bWVudFJlY29yZCA9IERvY3VtZW50O1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgbXVsdGVyIGZyb20gJ211bHRlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcm9tICd1dWlkJztcbmltcG9ydCB7IHNxbCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vZGInO1xuXG4vLyBFbmhhbmNlZCBzZWN1cml0eSBjb25maWd1cmF0aW9uIGZvciBmaWxlIHVwbG9hZHNcbmNvbnN0IFNFQ1VSSVRZX0NPTkZJRyA9IHtcbiAgTUFYX0ZJTEVfU0laRTogMjUgKiAxMDI0ICogMTAyNCwgLy8gUmVkdWNlZCB0byAyNU1CIGZvciBiZXR0ZXIgc2VjdXJpdHlcbiAgTUFYX0ZJTEVTX1BFUl9VU0VSX1BFUl9IT1VSOiAxMCwgLy8gUmF0ZSBsaW1pdGluZ1xuICBBTExPV0VEX01JTUVfVFlQRVM6IFtcbiAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAnYXBwbGljYXRpb24vbXN3b3JkJyxcbiAgICAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnLFxuICAgICdhcHBsaWNhdGlvbi92bmQubXMtZXhjZWwnLFxuICAgICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCcsXG4gICAgJ3RleHQvcGxhaW4nLFxuICAgICdpbWFnZS9qcGVnJyxcbiAgICAnaW1hZ2UvcG5nJyxcbiAgICAnaW1hZ2UvZ2lmJ1xuICBdLFxuICBBTExPV0VEX0VYVEVOU0lPTlM6IFsncGRmJywgJ2RvYycsICdkb2N4JywgJ3hscycsICd4bHN4JywgJ3R4dCcsICdqcGcnLCAnanBlZycsICdwbmcnLCAnZ2lmJ11cbn07XG5cbi8vIFJhdGUgbGltaXRpbmcgc3RvcmFnZSBmb3IgdXBsb2Fkc1xuY29uc3QgdXBsb2FkUmF0ZVRyYWNrZXIgPSBuZXcgTWFwKCk7XG5cbi8vIEVuaGFuY2VkIGZpbGUgdmFsaWRhdGlvbiBmdW5jdGlvblxuZnVuY3Rpb24gdmFsaWRhdGVGaWxlKGZpbGU6IGFueSk6IHsgaXNWYWxpZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSB7XG4gIGlmICghZmlsZSkgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnTm8gZmlsZSBwcm92aWRlZCcgfTtcbiAgXG4gIC8vIENoZWNrIGZpbGUgc2l6ZVxuICBpZiAoZmlsZS5zaXplID4gU0VDVVJJVFlfQ09ORklHLk1BWF9GSUxFX1NJWkUpIHtcbiAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3I6IGBGaWxlIHNpemUgZXhjZWVkcyAke1NFQ1VSSVRZX0NPTkZJRy5NQVhfRklMRV9TSVpFIC8gKDEwMjQgKiAxMDI0KX1NQiBsaW1pdGAgfTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgTUlNRSB0eXBlXG4gIGlmICghU0VDVVJJVFlfQ09ORklHLkFMTE9XRURfTUlNRV9UWVBFUy5pbmNsdWRlcyhmaWxlLm1pbWV0eXBlKSkge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogYEZpbGUgdHlwZSAke2ZpbGUubWltZXR5cGV9IG5vdCBhbGxvd2VkYCB9O1xuICB9XG4gIFxuICAvLyBDaGVjayBmaWxlIGV4dGVuc2lvblxuICBjb25zdCBleHRlbnNpb24gPSBwYXRoLmV4dG5hbWUoZmlsZS5vcmlnaW5hbG5hbWUpLnRvTG93ZXJDYXNlKCkuc3Vic3RyaW5nKDEpO1xuICBpZiAoIVNFQ1VSSVRZX0NPTkZJRy5BTExPV0VEX0VYVEVOU0lPTlMuaW5jbHVkZXMoZXh0ZW5zaW9uKSkge1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcjogYEZpbGUgZXh0ZW5zaW9uIC4ke2V4dGVuc2lvbn0gbm90IGFsbG93ZWRgIH07XG4gIH1cbiAgXG4gIC8vIENoZWNrIGZpbGVuYW1lIGZvciBwYXRoIHRyYXZlcnNhbCBhdHRlbXB0c1xuICBpZiAoZmlsZS5vcmlnaW5hbG5hbWUuaW5jbHVkZXMoJy4uJykgfHwgZmlsZS5vcmlnaW5hbG5hbWUuaW5jbHVkZXMoJy8nKSB8fCBmaWxlLm9yaWdpbmFsbmFtZS5pbmNsdWRlcygnXFxcXCcpKSB7XG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBmaWxlbmFtZSBkZXRlY3RlZCcgfTtcbiAgfVxuICBcbiAgcmV0dXJuIHsgaXNWYWxpZDogdHJ1ZSB9O1xufVxuXG4vLyBSYXRlIGxpbWl0aW5nIGZ1bmN0aW9uXG5mdW5jdGlvbiBjaGVja1VwbG9hZFJhdGVMaW1pdCh1c2VySWQ6IHN0cmluZyk6IHsgYWxsb3dlZDogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfSB7XG4gIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gIGNvbnN0IHVzZXJVcGxvYWRzID0gdXBsb2FkUmF0ZVRyYWNrZXIuZ2V0KHVzZXJJZCkgfHwgW107XG4gIFxuICAvLyBDbGVhbiBvbGQgdXBsb2FkcyAob2xkZXIgdGhhbiAxIGhvdXIpXG4gIGNvbnN0IHJlY2VudFVwbG9hZHMgPSB1c2VyVXBsb2Fkcy5maWx0ZXIoKHRpbWVzdGFtcDogbnVtYmVyKSA9PiBub3cgLSB0aW1lc3RhbXAgPCA2MCAqIDYwICogMTAwMCk7XG4gIFxuICBpZiAocmVjZW50VXBsb2Fkcy5sZW5ndGggPj0gU0VDVVJJVFlfQ09ORklHLk1BWF9GSUxFU19QRVJfVVNFUl9QRVJfSE9VUikge1xuICAgIHJldHVybiB7IGFsbG93ZWQ6IGZhbHNlLCBlcnJvcjogJ1VwbG9hZCByYXRlIGxpbWl0IGV4Y2VlZGVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicgfTtcbiAgfVxuICBcbiAgLy8gVXBkYXRlIHRyYWNrZXJcbiAgcmVjZW50VXBsb2Fkcy5wdXNoKG5vdyk7XG4gIHVwbG9hZFJhdGVUcmFja2VyLnNldCh1c2VySWQsIHJlY2VudFVwbG9hZHMpO1xuICBcbiAgcmV0dXJuIHsgYWxsb3dlZDogdHJ1ZSB9O1xufVxuXG4vLyBDb25maWd1cmUgbXVsdGVyIGZvciBmaWxlIHVwbG9hZHMgd2l0aCBlbmhhbmNlZCBzZWN1cml0eVxuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtcbiAgZGVzdDogJy90bXAvdXBsb2Fkcy8nLFxuICBsaW1pdHM6IHtcbiAgICBmaWxlU2l6ZTogU0VDVVJJVFlfQ09ORklHLk1BWF9GSUxFX1NJWkUsXG4gICAgZmlsZXM6IDEsIC8vIE9ubHkgYWxsb3cgb25lIGZpbGUgYXQgYSB0aW1lXG4gIH0sXG4gIGZpbGVGaWx0ZXI6IChyZXEsIGZpbGUsIGNiKSA9PiB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlRmlsZShmaWxlKTtcbiAgICBpZiAodmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICBjYihudWxsLCB0cnVlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY2IobmV3IEVycm9yKHZhbGlkYXRpb24uZXJyb3IpKTtcbiAgICB9XG4gIH0sXG59KTtcblxuLy8gRG9jdW1lbnRSZWNvcmQgY2F0ZWdvcmllcyBmb3IgdmFsaWRhdGlvbiAtIHN5bmNocm9uaXplZCB3aXRoIGZyb250ZW5kXG5jb25zdCBET0NVTUVOVF9DQVRFR09SSUVTID0gW1xuICAnYnlsYXcnLFxuICAnZmluYW5jaWFsJyxcbiAgJ21haW50ZW5hbmNlJyxcbiAgJ2xlZ2FsJyxcbiAgJ21lZXRpbmdfbWludXRlcycsXG4gICdpbnN1cmFuY2UnLFxuICAnY29udHJhY3RzJyxcbiAgJ3Blcm1pdHMnLFxuICAnaW5zcGVjdGlvbicsXG4gICdsZWFzZScsXG4gICdjb3JyZXNwb25kZW5jZScsXG4gICd1dGlsaXRpZXMnLFxuICAnb3RoZXInLFxuXSBhcyBjb25zdDtcblxuLy8gRW5oYW5jZWQgc2NoZW1hcyBmb3IgZGlmZmVyZW50IGRvY3VtZW50IHR5cGVzXG5jb25zdCBjcmVhdGVEb2N1bWVudFNjaGVtYSA9IGluc2VydERvY3VtZW50U2NoZW1hLmV4dGVuZCh7XG4gIGNhdGVnb3J5OiB6LmVudW0oRE9DVU1FTlRfQ0FURUdPUklFUyksXG4gIHRpdGxlOiB6LnN0cmluZygpLm1pbigxKS5tYXgoMjU1KSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgaXNWaXNpYmxlVG9UZW5hbnRzOiB6LmJvb2xlYW4oKS5kZWZhdWx0KGZhbHNlKSxcbn0pO1xuXG5jb25zdCBjcmVhdGVCdWlsZGluZ0RvY3VtZW50U2NoZW1hID0gaW5zZXJ0RG9jdW1lbnRTY2hlbWEuZXh0ZW5kKHtcbiAgdHlwZTogei5lbnVtKERPQ1VNRU5UX0NBVEVHT1JJRVMpLFxuICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSkub3B0aW9uYWwoKSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBjcmVhdGVSZXNpZGVudERvY3VtZW50U2NoZW1hID0gaW5zZXJ0RG9jdW1lbnRTY2hlbWEuZXh0ZW5kKHtcbiAgdHlwZTogei5lbnVtKERPQ1VNRU5UX0NBVEVHT1JJRVMpLFxuICB0aXRsZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSkub3B0aW9uYWwoKSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG4vLyBTY2hlbWEgZm9yIHVuaWZpZWQgZG9jdW1lbnQgdXBsb2FkXG5jb25zdCB1cGxvYWREb2N1bWVudFJlY29yZFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgbmFtZTogei5zdHJpbmcoKS5taW4oMSkubWF4KDI1NSksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGRvY3VtZW50VHlwZTogei5lbnVtKERPQ1VNRU5UX0NBVEVHT1JJRVMpLFxuICBpc1Zpc2libGVUb1RlbmFudHM6IHouYm9vbGVhbigpLmRlZmF1bHQoZmFsc2UpLFxuICByZXNpZGVuY2VJZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgYnVpbGRpbmdJZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbiAgYXR0YWNoZWRUb1R5cGU6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgYXR0YWNoZWRUb0lkOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG59KTtcblxuLyoqXG4gKlxuICogQHBhcmFtIGFwcFxuICovXG4vKipcbiAqIFJlZ2lzdGVyRG9jdW1lbnRSZWNvcmRSb3V0ZXMgZnVuY3Rpb24uXG4gKiBAcGFyYW0gYXBwXG4gKiBAcmV0dXJucyBGdW5jdGlvbiByZXN1bHQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlckRvY3VtZW50Um91dGVzKGFwcDogRXhwcmVzcyk6IHZvaWQge1xuICBjb25zb2xlLmxvZyhgWyR7bmV3IERhdGUoKS50b0lTT1N0cmluZygpfV0g8J+UpyBSZWdpc3RlcmluZyBkb2N1bWVudCByb3V0ZXMuLi5gKTtcbiAgXG4gIC8vIFNlY3VyaXR5IGF1ZGl0IGxvZ2dpbmdcbiAgY29uc3QgYXVkaXRMb2c6IEFycmF5PHtcbiAgICB0aW1lc3RhbXA6IHN0cmluZztcbiAgICBhY3Rpb246IHN0cmluZztcbiAgICB1c2VySWQ6IHN0cmluZztcbiAgICB1c2VyUm9sZTogc3RyaW5nO1xuICAgIGRvY3VtZW50SWQ/OiBzdHJpbmc7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICBkZXRhaWxzPzogYW55O1xuICB9PiA9IFtdO1xuICBcbiAgLy8gRXJyb3IgdHJhY2tpbmcgZm9yIHByb2R1Y3Rpb24gZGVidWdnaW5nXG4gIGNvbnN0IGVycm9yTG9nOiBBcnJheTx7dGltZXN0YW1wOiBzdHJpbmcsIGVycm9yOiBhbnksIGVuZHBvaW50OiBzdHJpbmcsIHVzZXI/OiBhbnl9PiA9IFtdO1xuICBcbiAgLy8gU2VjdXJpdHkgYXVkaXQgbG9nZ2luZyBmdW5jdGlvblxuICBjb25zdCBsb2dTZWN1cml0eUV2ZW50ID0gKGFjdGlvbjogc3RyaW5nLCB1c2VyOiBhbnksIHN1Y2Nlc3M6IGJvb2xlYW4sIGRvY3VtZW50SWQ/OiBzdHJpbmcsIGRldGFpbHM/OiBhbnkpID0+IHtcbiAgICBjb25zdCBldmVudCA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgYWN0aW9uLFxuICAgICAgdXNlcklkOiB1c2VyLmlkLFxuICAgICAgdXNlclJvbGU6IHVzZXIucm9sZSxcbiAgICAgIGRvY3VtZW50SWQsXG4gICAgICBzdWNjZXNzLFxuICAgICAgZGV0YWlsc1xuICAgIH07XG4gICAgXG4gICAgYXVkaXRMb2cucHVzaChldmVudCk7XG4gICAgaWYgKGF1ZGl0TG9nLmxlbmd0aCA+IDEwMDApIGF1ZGl0TG9nLnNoaWZ0KCk7IC8vIEtlZXAgbGFzdCAxMDAwIGV2ZW50c1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbU0VDVVJJVFkgQVVESVRdICR7YWN0aW9ufTpgLCBldmVudCk7XG4gICAgcmV0dXJuIGV2ZW50O1xuICB9O1xuXG4gIC8vIERhdGFiYXNlIGNvbm5lY3Rpb24gdGVzdGluZyBmdW5jdGlvbnNcbiAgY29uc3QgdGVzdERhdGFiYXNlQ29ubmVjdGlvbiA9IGFzeW5jICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgU0VMRUNUIDEgYXMgdGVzdGApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcmVzdWx0OiByZXN1bHQucm93c1swXSxcbiAgICAgICAgdXJsX3RydW5jYXRlZDogcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMPy5zdWJzdHJpbmcoMCwgNTApICsgJy4uLidcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB1cmxfdHJ1bmNhdGVkOiBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkw/LnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJ1xuICAgICAgfTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgdGVzdFNhbXBsZVF1ZXJ5ID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUZXN0IHRoZSBleGFjdCBxdWVyeSB0aGF0J3MgZmFpbGluZ1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyBkb2N1bWVudF9jb3VudCBcbiAgICAgICAgRlJPTSBkb2N1bWVudHMgXG4gICAgICAgIExJTUlUIDFcbiAgICAgIGApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZG9jdW1lbnRfY291bnQ6IHJlc3VsdC5yb3dzWzBdPy5kb2N1bWVudF9jb3VudCB8fCAwXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrPy5zdWJzdHJpbmcoMCwgMjAwKSArICcuLi4nXG4gICAgICB9O1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBjaGVja0VudW1WYWx1ZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGN1cnJlbnQgZW51bSB2YWx1ZXMgaW4gcHJvZHVjdGlvblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBlbnVtbGFiZWwgXG4gICAgICAgIEZST00gcGdfZW51bSBcbiAgICAgICAgV0hFUkUgZW51bXR5cGlkID0gKFxuICAgICAgICAgIFNFTEVDVCBvaWQgXG4gICAgICAgICAgRlJPTSBwZ190eXBlIFxuICAgICAgICAgIFdIRVJFIHR5cG5hbWUgPSAndXNlcl9yb2xlJ1xuICAgICAgICApXG4gICAgICAgIE9SREVSIEJZIGVudW1zb3J0b3JkZXJcbiAgICAgIGApO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgcHJvZHVjdGlvbl9lbnVtX3ZhbHVlczogcmVzdWx0LnJvd3MubWFwKHJvdyA9PiByb3cuZW51bWxhYmVsKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2VcbiAgICAgIH07XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNoZWNrVXNlck9yZ2FuaXphdGlvbkxpbmtzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayB1c2VyLW9yZ2FuaXphdGlvbiByZWxhdGlvbnNoaXBzXG4gICAgICBjb25zdCB1c2VyQ291bnQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBTRUxFQ1QgQ09VTlQoKikgYXMgdG90YWwgRlJPTSB1c2VycyBXSEVSRSBpc19hY3RpdmUgPSB0cnVlYCk7XG4gICAgICBjb25zdCBvcmdDb3VudCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFNFTEVDVCBDT1VOVCgqKSBhcyB0b3RhbCBGUk9NIG9yZ2FuaXphdGlvbnMgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZWApO1xuICAgICAgY29uc3QgbGlua0NvdW50ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgU0VMRUNUIENPVU5UKCopIGFzIHRvdGFsIEZST00gdXNlcl9vcmdhbml6YXRpb25zIFdIRVJFIGlzX2FjdGl2ZSA9IHRydWVgKTtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgdXNlcnMgd2l0aG91dCBvcmdhbml6YXRpb24gbGlua3NcbiAgICAgIGNvbnN0IG9ycGhhblVzZXJzID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCB1LmlkLCB1LmVtYWlsLCB1LnJvbGUgXG4gICAgICAgIEZST00gdXNlcnMgdSBcbiAgICAgICAgTEVGVCBKT0lOIHVzZXJfb3JnYW5pemF0aW9ucyB1byBPTiB1LmlkID0gdW8udXNlcl9pZCBBTkQgdW8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICBXSEVSRSB1LmlzX2FjdGl2ZSA9IHRydWUgQU5EIHVvLnVzZXJfaWQgSVMgTlVMTFxuICAgICAgICBMSU1JVCAxMFxuICAgICAgYCk7XG5cbiAgICAgIC8vIENoZWNrIGN1cnJlbnQgdGVzdCB1c2VyIHNwZWNpZmljYWxseSAoZnJvbSBlcnJvciBsb2dzKVxuICAgICAgY29uc3QgdGVzdFVzZXIgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgU0VMRUNUIHUuZW1haWwsIHUucm9sZSwgdW8ub3JnYW5pemF0aW9uX2lkLCBvLm5hbWUgYXMgb3JnX25hbWVcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIExFRlQgSk9JTiB1c2VyX29yZ2FuaXphdGlvbnMgdW8gT04gdS5pZCA9IHVvLnVzZXJfaWQgQU5EIHVvLmlzX2FjdGl2ZSA9IHRydWUgIFxuICAgICAgICBMRUZUIEpPSU4gb3JnYW5pemF0aW9ucyBvIE9OIHVvLm9yZ2FuaXphdGlvbl9pZCA9IG8uaWRcbiAgICAgICAgV0hFUkUgdS5pZCA9ICcyMjJmNWEwZC02YmM2LTRmMjgtOWY0ZC0zMmMxMzNlZWQzMzMnXG4gICAgICBgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3RhdHM6IHtcbiAgICAgICAgICB0b3RhbF91c2VyczogdXNlckNvdW50LnJvd3NbMF0/LnRvdGFsIHx8IDAsXG4gICAgICAgICAgdG90YWxfb3JnYW5pemF0aW9uczogb3JnQ291bnQucm93c1swXT8udG90YWwgfHwgMCxcbiAgICAgICAgICB0b3RhbF9saW5rczogbGlua0NvdW50LnJvd3NbMF0/LnRvdGFsIHx8IDAsXG4gICAgICAgICAgb3JwaGFuX3VzZXJfY291bnQ6IG9ycGhhblVzZXJzLnJvd3MubGVuZ3RoXG4gICAgICAgIH0sXG4gICAgICAgIG9ycGhhbl91c2Vyczogb3JwaGFuVXNlcnMucm93cyxcbiAgICAgICAgdGVzdF91c2VyX3N0YXR1czogdGVzdFVzZXIucm93c1swXSB8fCBudWxsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZVxuICAgICAgfTtcbiAgICB9XG4gIH07XG4gIFxuICAvLyBFbnVtIGNsZWFudXAgZW5kcG9pbnQgZm9yIHNhZmUgc2NoZW1hIG1pZ3JhdGlvbiAgXG4gIGFwcC5wb3N0KCcvYXBpL2RvY3VtZW50cy9jbGVhbnVwLWVudW0nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QsIHZlcmlmeSBubyB1c2VycyBoYXZlIHRoZSAnb3duZXInIHJvbGVcbiAgICAgIGNvbnN0IHVzZXJDaGVjayA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgQ09VTlQoKikgYXMgb3duZXJfY291bnQgXG4gICAgICAgIEZST00gdXNlcnMgXG4gICAgICAgIFdIRVJFIHJvbGUgPSAnb3duZXInXG4gICAgICBgKTtcbiAgICAgIFxuICAgICAgY29uc3Qgb3duZXJDb3VudCA9IE51bWJlcih1c2VyQ2hlY2sucm93c1swXT8ub3duZXJfY291bnQpIHx8IDA7XG4gICAgICBcbiAgICAgIGlmIChvd25lckNvdW50ID4gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnQ2Fubm90IHJlbW92ZSBvd25lciByb2xlIC0gdXNlcnMgc3RpbGwgYXNzaWduZWQgdG8gaXQnLFxuICAgICAgICAgIG93bmVyX2NvdW50OiBvd25lckNvdW50XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTYWZlIHRvIHJlbW92ZSAtIG5vIHVzZXJzIGhhdmUgJ293bmVyJyByb2xlXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgQUxURVIgVFlQRSB1c2VyX3JvbGUgRFJPUCBWQUxVRSBJRiBFWElTVFMgJ293bmVyJ1xuICAgICAgYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSByZW1vdmVkIHVudXNlZCBvd25lciByb2xlJyxcbiAgICAgICAgc2FmZV90b19wdXNoX3NjaGVtYTogdHJ1ZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkdXJpbmcgZW51bSBjbGVhbnVwOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdFbnVtIGNsZWFudXAgZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3VnZ2VzdGlvbjogJ1RyeSBydW5uaW5nIG5wbSBydW4gZGI6cHVzaCAtLWZvcmNlIGluc3RlYWQnXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZpeCB1c2VyLW9yZ2FuaXphdGlvbiByZWxhdGlvbnNoaXBzXG4gIGFwcC5wb3N0KCcvYXBpL2RvY3VtZW50cy9maXgtdXNlci1saW5rcycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBTdGVwIDE6IEZpbmQgdXNlcnMgd2l0aG91dCBvcmdhbml6YXRpb24gbGlua3NcbiAgICAgIGNvbnN0IG9ycGhhblVzZXJzID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCB1LmlkLCB1LmVtYWlsLCB1LnJvbGUgXG4gICAgICAgIEZST00gdXNlcnMgdSBcbiAgICAgICAgTEVGVCBKT0lOIHVzZXJfb3JnYW5pemF0aW9ucyB1byBPTiB1LmlkID0gdW8udXNlcl9pZCBBTkQgdW8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICBXSEVSRSB1LmlzX2FjdGl2ZSA9IHRydWUgQU5EIHVvLnVzZXJfaWQgSVMgTlVMTFxuICAgICAgYCk7XG5cbiAgICAgIGlmIChvcnBoYW5Vc2Vycy5yb3dzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBbGwgdXNlcnMgYWxyZWFkeSBoYXZlIG9yZ2FuaXphdGlvbiBsaW5rcycsXG4gICAgICAgICAgYWN0aW9uX3Rha2VuOiAnbm9uZScsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMjogR2V0IHRoZSBmaXJzdCBhdmFpbGFibGUgb3JnYW5pemF0aW9uIChvciBjcmVhdGUgZGVmYXVsdCBvbmUpXG4gICAgICBsZXQgZGVmYXVsdE9yZyA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgaWQsIG5hbWUgRlJPTSBvcmdhbml6YXRpb25zIFdIRVJFIGlzX2FjdGl2ZSA9IHRydWUgTElNSVQgMVxuICAgICAgYCk7XG5cbiAgICAgIGxldCBvcmdhbml6YXRpb25JZDogc3RyaW5nO1xuICAgICAgbGV0IG9yZ2FuaXphdGlvbk5hbWU6IHN0cmluZztcblxuICAgICAgaWYgKGRlZmF1bHRPcmcucm93cy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgLy8gQ3JlYXRlIGEgZGVmYXVsdCBvcmdhbml6YXRpb24gaWYgbm9uZSBleGlzdHNcbiAgICAgICAgb3JnYW5pemF0aW9uSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICAgICAgICBvcmdhbml6YXRpb25OYW1lID0gJ0RlZmF1bHQgT3JnYW5pemF0aW9uJztcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgSU5TRVJUIElOVE8gb3JnYW5pemF0aW9ucyAoaWQsIG5hbWUsIHR5cGUsIGFkZHJlc3MsIHBob25lLCBlbWFpbCwgaXNfYWN0aXZlLCBjcmVhdGVkX2F0LCB1cGRhdGVkX2F0KVxuICAgICAgICAgIFZBTFVFUyAoJHtvcmdhbml6YXRpb25JZH0sICR7b3JnYW5pemF0aW9uTmFtZX0sICdjb25kb21pbml1bScsICcxMjMgTWFpbiBTdCcsICc1MTQtNTU1LTAxMDAnLCAnYWRtaW5Aa292ZW8uY2EnLCB0cnVlLCBOT1coKSwgTk9XKCkpXG4gICAgICAgIGApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgb3JnYW5pemF0aW9uSWQgPSBkZWZhdWx0T3JnLnJvd3NbMF0uaWQgYXMgc3RyaW5nO1xuICAgICAgICBvcmdhbml6YXRpb25OYW1lID0gZGVmYXVsdE9yZy5yb3dzWzBdLm5hbWUgYXMgc3RyaW5nO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDM6IExpbmsgYWxsIG9ycGhhbiB1c2VycyB0byB0aGUgZGVmYXVsdCBvcmdhbml6YXRpb25cbiAgICAgIGNvbnN0IGxpbmtQcm9taXNlcyA9IG9ycGhhblVzZXJzLnJvd3MubWFwKHVzZXIgPT4ge1xuICAgICAgICBjb25zdCBsaW5rSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICAgICAgICByZXR1cm4gZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgSU5TRVJUIElOVE8gdXNlcl9vcmdhbml6YXRpb25zIChpZCwgdXNlcl9pZCwgb3JnYW5pemF0aW9uX2lkLCByb2xlLCBpc19hY3RpdmUsIGNyZWF0ZWRfYXQsIHVwZGF0ZWRfYXQpXG4gICAgICAgICAgVkFMVUVTICgke2xpbmtJZH0sICR7dXNlci5pZH0sICR7b3JnYW5pemF0aW9uSWR9LCAke3VzZXIucm9sZX0sIHRydWUsIE5PVygpLCBOT1coKSlcbiAgICAgICAgYCk7XG4gICAgICB9KTtcblxuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwobGlua1Byb21pc2VzKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnU3VjY2Vzc2Z1bGx5IGxpbmtlZCB1c2VycyB0byBvcmdhbml6YXRpb25zJyxcbiAgICAgICAgdXNlcnNfbGlua2VkOiBvcnBoYW5Vc2Vycy5yb3dzLmxlbmd0aCxcbiAgICAgICAgb3JnYW5pemF0aW9uX2lkOiBvcmdhbml6YXRpb25JZCxcbiAgICAgICAgb3JnYW5pemF0aW9uX25hbWU6IG9yZ2FuaXphdGlvbk5hbWUsXG4gICAgICAgIGxpbmtlZF91c2Vyczogb3JwaGFuVXNlcnMucm93cy5tYXAodSA9PiAoeyBpZDogdS5pZCwgZW1haWw6IHUuZW1haWwsIHJvbGU6IHUucm9sZSB9KSksXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZml4aW5nIHVzZXItb3JnYW5pemF0aW9uIGxpbmtzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZml4IHVzZXItb3JnYW5pemF0aW9uIGxpbmtzJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gU2FmZSBlbnVtIG1pZ3JhdGlvbiBlbmRwb2ludFxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvZml4LWVudW0tbWlncmF0aW9uJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogQ2hlY2sgY3VycmVudCBlbnVtIHZhbHVlcyBhbmQgdXNhZ2VcbiAgICAgIGNvbnN0IGVudW1DaGVjayA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgZW51bWxhYmVsLCBlbnVtc29ydG9yZGVyIFxuICAgICAgICBGUk9NIHBnX2VudW0gXG4gICAgICAgIFdIRVJFIGVudW10eXBpZCA9IChTRUxFQ1Qgb2lkIEZST00gcGdfdHlwZSBXSEVSRSB0eXBuYW1lID0gJ3VzZXJfcm9sZScpXG4gICAgICAgIE9SREVSIEJZIGVudW1zb3J0b3JkZXJcbiAgICAgIGApO1xuXG4gICAgICBjb25zdCBjdXJyZW50RW51bVZhbHVlcyA9IGVudW1DaGVjay5yb3dzLm1hcChyb3cgPT4gcm93LmVudW1sYWJlbCk7XG4gICAgICBcbiAgICAgIC8vIFN0ZXAgMjogQ2hlY2sgaWYgd2UgaGF2ZSBhbnkgZGF0YSB0aGF0IHdvdWxkIHByZXZlbnQgbWlncmF0aW9uXG4gICAgICBjb25zdCB1c2VyUm9sZVVzYWdlID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCByb2xlLCBDT1VOVCgqKSBhcyBjb3VudCBcbiAgICAgICAgRlJPTSB1c2VycyBcbiAgICAgICAgR1JPVVAgQlkgcm9sZVxuICAgICAgYCk7XG5cbiAgICAgIC8vIFN0ZXAgMzogU2luY2UgZW51bSByZW9yZGVyaW5nIGlzIHRoZSBpc3N1ZSwgbGV0J3MgdXNlIGEgZGlmZmVyZW50IGFwcHJvYWNoXG4gICAgICAvLyBXZSdsbCBjcmVhdGUgYSBuZXcgZW51bSB3aXRoIGNvcnJlY3Qgb3JkZXIsIG1pZ3JhdGUgZGF0YSwgdGhlbiBzd2FwXG4gICAgICBjb25zdCB0YXJnZXRFbnVtVmFsdWVzID0gWydhZG1pbicsICdtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCcsICdkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBpZiBjdXJyZW50IG9yZGVyIG1hdGNoZXMgdGFyZ2V0XG4gICAgICBjb25zdCBvcmRlck1hdGNoZXMgPSBKU09OLnN0cmluZ2lmeShjdXJyZW50RW51bVZhbHVlcykgPT09IEpTT04uc3RyaW5naWZ5KHRhcmdldEVudW1WYWx1ZXMpO1xuICAgICAgXG4gICAgICBpZiAob3JkZXJNYXRjaGVzKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0VudW0gdmFsdWVzIGFscmVhZHkgaW4gY29ycmVjdCBvcmRlcicsXG4gICAgICAgICAgY3VycmVudF92YWx1ZXM6IGN1cnJlbnRFbnVtVmFsdWVzLFxuICAgICAgICAgIHRhcmdldF92YWx1ZXM6IHRhcmdldEVudW1WYWx1ZXMsXG4gICAgICAgICAgbWlncmF0aW9uX25lZWRlZDogZmFsc2VcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNDogQ3JlYXRlIG5ldyBlbnVtIHdpdGggY29ycmVjdCBvcmRlclxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQ1JFQVRFIFRZUEUgdXNlcl9yb2xlX25ldyBBUyBFTlVNICgnYWRtaW4nLCAnbWFuYWdlcicsICd0ZW5hbnQnLCAncmVzaWRlbnQnLCAnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnKWApO1xuXG4gICAgICAvLyBTdGVwIDU6IFVwZGF0ZSBhbGwgdGFibGVzIHRvIHVzZSBuZXcgZW51bVxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIEFMVEVSIFRBQkxFIHVzZXJzIFxuICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZV9uZXcgXG4gICAgICAgIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZV9uZXdcbiAgICAgIGApO1xuXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgQUxURVIgVEFCTEUgdXNlcl9vcmdhbml6YXRpb25zIFxuICAgICAgICBBTFRFUiBDT0xVTU4gb3JnYW5pemF0aW9uX3JvbGUgVFlQRSB1c2VyX3JvbGVfbmV3IFxuICAgICAgICBVU0lORyBvcmdhbml6YXRpb25fcm9sZTo6dGV4dDo6dXNlcl9yb2xlX25ld1xuICAgICAgYCk7XG5cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUQUJMRSByb2xlX3Blcm1pc3Npb25zIFxuICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZV9uZXcgXG4gICAgICAgIFVTSU5HIHJvbGU6OnRleHQ6OnVzZXJfcm9sZV9uZXdcbiAgICAgIGApO1xuXG4gICAgICAvLyBTdGVwIDY6IERyb3Agb2xkIGVudW0gYW5kIHJlbmFtZSBuZXcgb25lXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBEUk9QIFRZUEUgdXNlcl9yb2xlYCk7XG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUWVBFIHVzZXJfcm9sZV9uZXcgUkVOQU1FIFRPIHVzZXJfcm9sZWApO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgbWlncmF0ZWQgdXNlcl9yb2xlIGVudW0nLFxuICAgICAgICBvbGRfdmFsdWVzOiBjdXJyZW50RW51bVZhbHVlcyxcbiAgICAgICAgbmV3X3ZhbHVlczogdGFyZ2V0RW51bVZhbHVlcyxcbiAgICAgICAgdXNlcl9yb2xlX3VzYWdlOiB1c2VyUm9sZVVzYWdlLnJvd3MsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZHVyaW5nIGVudW0gbWlncmF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdFbnVtIG1pZ3JhdGlvbiBmYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICBzdWdnZXN0aW9uOiAnVGhpcyBpcyBhIGNvbXBsZXggbWlncmF0aW9uIC0gbWF5IG5lZWQgbWFudWFsIGludGVydmVudGlvbicsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEZpeCBpbnZpdGF0aW9ucyB0YWJsZSBlbnVtIGRlcGVuZGVuY3lcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL2ZpeC1pbnZpdGF0aW9ucy1kZXBlbmRlbmN5JywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogQ2hlY2sgY3VycmVudCBpbnZpdGF0aW9ucyB0YWJsZSBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGludml0YXRpb25zU2NoZW1hID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBjb2x1bW5fbmFtZSwgZGF0YV90eXBlLCBjb2x1bW5fZGVmYXVsdFxuICAgICAgICBGUk9NIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zIFxuICAgICAgICBXSEVSRSB0YWJsZV9uYW1lID0gJ2ludml0YXRpb25zJyBBTkQgY29sdW1uX25hbWUgPSAncm9sZSdcbiAgICAgIGApO1xuXG4gICAgICAvLyBTdGVwIDI6IFJlbW92ZSBkZWZhdWx0IHZhbHVlIGZyb20gaW52aXRhdGlvbnMucm9sZSBjb2x1bW4gdGVtcG9yYXJpbHlcbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBcbiAgICAgICAgQUxURVIgQ09MVU1OIHJvbGUgRFJPUCBERUZBVUxUXG4gICAgICBgKTtcblxuICAgICAgLy8gU3RlcCAzOiBDaGVjayB3aGF0IG90aGVyIHRhYmxlcyBtaWdodCBoYXZlIGVudW0gZGVwZW5kZW5jaWVzXG4gICAgICBjb25zdCBlbnVtRGVwZW5kZW5jaWVzID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICB0LnRhYmxlX25hbWUsXG4gICAgICAgICAgYy5jb2x1bW5fbmFtZSxcbiAgICAgICAgICBjLmNvbHVtbl9kZWZhdWx0XG4gICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyB0XG4gICAgICAgIEpPSU4gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgYyBPTiB0LnRhYmxlX25hbWUgPSBjLnRhYmxlX25hbWVcbiAgICAgICAgV0hFUkUgYy5kYXRhX3R5cGUgPSAnVVNFUi1ERUZJTkVEJyBcbiAgICAgICAgQU5EIGMudWR0X25hbWUgPSAndXNlcl9yb2xlJ1xuICAgICAgICBBTkQgYy5jb2x1bW5fZGVmYXVsdCBJUyBOT1QgTlVMTFxuICAgICAgYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSByZW1vdmVkIGludml0YXRpb25zIHRhYmxlIGVudW0gZGVwZW5kZW5jeScsXG4gICAgICAgIHJlbW92ZWRfZGVmYXVsdHM6IGludml0YXRpb25zU2NoZW1hLnJvd3MsXG4gICAgICAgIHJlbWFpbmluZ19kZXBlbmRlbmNpZXM6IGVudW1EZXBlbmRlbmNpZXMucm93cyxcbiAgICAgICAgbmV4dF9zdGVwOiAnUnVuIG5wbSBydW4gZGI6cHVzaCBub3csIHRoZW4gY2FsbCAvYXBpL2RvY3VtZW50cy9yZXN0b3JlLWludml0YXRpb25zLWRlZmF1bHQnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZpeGluZyBpbnZpdGF0aW9ucyBkZXBlbmRlbmN5OicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gZml4IGludml0YXRpb25zIGRlcGVuZGVuY3knLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBSZXN0b3JlIGludml0YXRpb25zIGRlZmF1bHQgdmFsdWUgYWZ0ZXIgc2NoZW1hIHN5bmNcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL3Jlc3RvcmUtaW52aXRhdGlvbnMtZGVmYXVsdCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBSZXN0b3JlIGRlZmF1bHQgdmFsdWUgdG8gJ3RlbmFudCcgZm9yIGludml0YXRpb25zLnJvbGUgY29sdW1uXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgQUxURVIgVEFCTEUgaW52aXRhdGlvbnMgXG4gICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnXG4gICAgICBgKTtcblxuICAgICAgLy8gVmVyaWZ5IHRoZSBjaGFuZ2VcbiAgICAgIGNvbnN0IHZlcmlmaWNhdGlvbiA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgY29sdW1uX25hbWUsIGNvbHVtbl9kZWZhdWx0XG4gICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgXG4gICAgICAgIFdIRVJFIHRhYmxlX25hbWUgPSAnaW52aXRhdGlvbnMnIEFORCBjb2x1bW5fbmFtZSA9ICdyb2xlJ1xuICAgICAgYCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCBpbnZpdGF0aW9ucyByb2xlIGRlZmF1bHQgdG8gdGVuYW50JyxcbiAgICAgICAgY3VycmVudF9kZWZhdWx0OiB2ZXJpZmljYXRpb24ucm93c1swXT8uY29sdW1uX2RlZmF1bHQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVzdG9yaW5nIGludml0YXRpb25zIGRlZmF1bHQ6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ZhaWxlZCB0byByZXN0b3JlIGludml0YXRpb25zIGRlZmF1bHQnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBNaWdyYXRlIG93bmVyIHVzZXJzIHRvIGFkbWluIGJlZm9yZSBlbnVtIGNsZWFudXBcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL21pZ3JhdGUtb3duZXItdG8tYWRtaW4nLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gU3RlcCAxOiBDaGVjayBob3cgbWFueSB1c2VycyBoYXZlICdvd25lcicgcm9sZVxuICAgICAgY29uc3Qgb3duZXJVc2Vyc0NoZWNrID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIFNFTEVDVCBpZCwgZW1haWwsIGZpcnN0X25hbWUsIGxhc3RfbmFtZSBcbiAgICAgICAgRlJPTSB1c2VycyBcbiAgICAgICAgV0hFUkUgcm9sZSA9ICdvd25lcidcbiAgICAgIGApO1xuXG4gICAgICBjb25zdCBvd25lckNvdW50ID0gb3duZXJVc2Vyc0NoZWNrLnJvd3MubGVuZ3RoO1xuXG4gICAgICBpZiAob3duZXJDb3VudCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdObyBvd25lciB1c2VycyBmb3VuZCAtIG1pZ3JhdGlvbiBub3QgbmVlZGVkJyxcbiAgICAgICAgICBvd25lcl9jb3VudDogMCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAyOiBVcGRhdGUgYWxsIG93bmVyIHVzZXJzIHRvIGFkbWluXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgVVBEQVRFIHVzZXJzIFxuICAgICAgICBTRVQgcm9sZSA9ICdhZG1pbicgXG4gICAgICAgIFdIRVJFIHJvbGUgPSAnb3duZXInXG4gICAgICBgKTtcblxuICAgICAgLy8gU3RlcCAzOiBVcGRhdGUgdXNlcl9vcmdhbml6YXRpb25zIHRhYmxlIGlmIGl0IGV4aXN0c1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgVVBEQVRFIHVzZXJfb3JnYW5pemF0aW9ucyBcbiAgICAgICAgICBTRVQgb3JnYW5pemF0aW9uX3JvbGUgPSAnYWRtaW4nIFxuICAgICAgICAgIFdIRVJFIG9yZ2FuaXphdGlvbl9yb2xlID0gJ293bmVyJ1xuICAgICAgICBgKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gVGFibGUgbWlnaHQgbm90IGV4aXN0LCB0aGF0J3MgT0tcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBSZW1vdmUgJ293bmVyJyBmcm9tIGVudW1cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBBTFRFUiBUWVBFIHVzZXJfcm9sZSBSRU5BTUUgVE8gdXNlcl9yb2xlX29sZFxuICAgICAgYCk7XG5cbiAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBDUkVBVEUgVFlQRSB1c2VyX3JvbGUgQVMgRU5VTSAoJ2FkbWluJywgJ21hbmFnZXInLCAndGVuYW50JywgJ3Jlc2lkZW50JywgJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50JylcbiAgICAgIGApO1xuXG4gICAgICAvLyBTdGVwIDU6IFVwZGF0ZSBhbGwgdGFibGVzIHRvIHVzZSBuZXcgZW51bVxuICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgIEFMVEVSIFRBQkxFIHVzZXJzIFxuICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBcbiAgICAgICAgVVNJTkcgcm9sZTo6dGV4dDo6dXNlcl9yb2xlXG4gICAgICBgKTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgdXNlcl9vcmdhbml6YXRpb25zIFxuICAgICAgICAgIEFMVEVSIENPTFVNTiBvcmdhbml6YXRpb25fcm9sZSBUWVBFIHVzZXJfcm9sZSBcbiAgICAgICAgICBVU0lORyBvcmdhbml6YXRpb25fcm9sZTo6dGV4dDo6dXNlcl9yb2xlXG4gICAgICAgIGApO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAvLyBUYWJsZSBtaWdodCBub3QgZXhpc3RcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgcm9sZV9wZXJtaXNzaW9ucyBcbiAgICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBcbiAgICAgICAgICBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVcbiAgICAgICAgYCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIFRhYmxlIG1pZ2h0IG5vdCBleGlzdFxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBcbiAgICAgICAgICBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBcbiAgICAgICAgICBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVcbiAgICAgICAgYCk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIENvbHVtbiBtaWdodCBub3QgZXhpc3RcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA2OiBEcm9wIG9sZCBlbnVtXG4gICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBEUk9QIFRZUEUgdXNlcl9yb2xlX29sZGApO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdTdWNjZXNzZnVsbHkgbWlncmF0ZWQgb3duZXIgdXNlcnMgdG8gYWRtaW4nLFxuICAgICAgICBtaWdyYXRlZF91c2Vyczogb3duZXJVc2Vyc0NoZWNrLnJvd3MsXG4gICAgICAgIG93bmVyX2NvdW50OiBvd25lckNvdW50LFxuICAgICAgICBuZXdfZW51bV92YWx1ZXM6IFsnYWRtaW4nLCAnbWFuYWdlcicsICd0ZW5hbnQnLCAncmVzaWRlbnQnLCAnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnXSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBtaWdyYXRpbmcgb3duZXIgdXNlcnMgdG8gYWRtaW46JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ093bmVyIHRvIGFkbWluIG1pZ3JhdGlvbiBmYWlsZWQnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBSZW1vdmUgYWxsIHJlbWFpbmluZyBlbnVtIGRlcGVuZGVuY2llc1xuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvcmVtb3ZlLWFsbC1lbnVtLWRlcGVuZGVuY2llcycsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRzID0gW107XG5cbiAgICAgIC8vIFJlbW92ZSBkZWZhdWx0IGZyb20gdXNlcnMucm9sZVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgdXNlcnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIHJvbGUgRFJPUCBERUZBVUxUXG4gICAgICAgIGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ3VzZXJzLnJvbGUgZGVmYXVsdCByZW1vdmVkJyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcnMucm9sZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbW92ZSBkZWZhdWx0IGZyb20gdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIG9yZ2FuaXphdGlvbl9yb2xlIERST1AgREVGQVVMVFxuICAgICAgICBgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKCd1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGUgZGVmYXVsdCByZW1vdmVkJyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcmVtYWluaW5nIGRlcGVuZGVuY2llc1xuICAgICAgY29uc3QgcmVtYWluaW5nRGVwcyA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgdC50YWJsZV9uYW1lLFxuICAgICAgICAgIGMuY29sdW1uX25hbWUsXG4gICAgICAgICAgYy5jb2x1bW5fZGVmYXVsdFxuICAgICAgICBGUk9NIGluZm9ybWF0aW9uX3NjaGVtYS50YWJsZXMgdFxuICAgICAgICBKT0lOIGluZm9ybWF0aW9uX3NjaGVtYS5jb2x1bW5zIGMgT04gdC50YWJsZV9uYW1lID0gYy50YWJsZV9uYW1lXG4gICAgICAgIFdIRVJFIGMuZGF0YV90eXBlID0gJ1VTRVItREVGSU5FRCcgXG4gICAgICAgIEFORCBjLnVkdF9uYW1lID0gJ3VzZXJfcm9sZSdcbiAgICAgICAgQU5EIGMuY29sdW1uX2RlZmF1bHQgSVMgTk9UIE5VTExcbiAgICAgIGApO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdSZW1vdmVkIGFsbCBlbnVtIGRlcGVuZGVuY2llcycsXG4gICAgICAgIG9wZXJhdGlvbnM6IHJlc3VsdHMsXG4gICAgICAgIHJlbWFpbmluZ19kZXBlbmRlbmNpZXM6IHJlbWFpbmluZ0RlcHMucm93cyxcbiAgICAgICAgbmV4dF9zdGVwOiAnUnVuIG5wbSBydW4gZGI6cHVzaCBub3cnLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHJlbW92aW5nIGVudW0gZGVwZW5kZW5jaWVzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdGYWlsZWQgdG8gcmVtb3ZlIGVudW0gZGVwZW5kZW5jaWVzJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gUmVzdG9yZSBhbGwgZGVmYXVsdCB2YWx1ZXMgYWZ0ZXIgc2NoZW1hIHN5bmNcbiAgYXBwLnBvc3QoJy9hcGkvZG9jdW1lbnRzL3Jlc3RvcmUtYWxsLWRlZmF1bHRzJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBbXTtcblxuICAgICAgLy8gUmVzdG9yZSB1c2Vycy5yb2xlIGRlZmF1bHRcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIEFMVEVSIFRBQkxFIHVzZXJzIFxuICAgICAgICAgIEFMVEVSIENPTFVNTiByb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnXG4gICAgICAgIGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ3VzZXJzLnJvbGUgZGVmYXVsdCByZXN0b3JlZCB0byB0ZW5hbnQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2Vycy5yb2xlIHJlc3RvcmUgZmFpbGVkOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVzdG9yZSB1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGUgZGVmYXVsdFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgdXNlcl9vcmdhbml6YXRpb25zIFxuICAgICAgICAgIEFMVEVSIENPTFVNTiBvcmdhbml6YXRpb25fcm9sZSBTRVQgREVGQVVMVCAndGVuYW50J1xuICAgICAgICBgKTtcbiAgICAgICAgcmVzdWx0cy5wdXNoKCd1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGUgZGVmYXVsdCByZXN0b3JlZCB0byB0ZW5hbnQnKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgcmVzdWx0cy5wdXNoKGB1c2VyX29yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uX3JvbGUgcmVzdG9yZSBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBSZXN0b3JlIGludml0YXRpb25zLnJvbGUgZGVmYXVsdFxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgQUxURVIgVEFCTEUgaW52aXRhdGlvbnMgXG4gICAgICAgICAgQUxURVIgQ09MVU1OIHJvbGUgU0VUIERFRkFVTFQgJ3RlbmFudCdcbiAgICAgICAgYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgnaW52aXRhdGlvbnMucm9sZSBkZWZhdWx0IHJlc3RvcmVkIHRvIHRlbmFudCcpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYGludml0YXRpb25zLnJvbGUgcmVzdG9yZSBmYWlsZWQ6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdSZXN0b3JlZCBhbGwgZGVmYXVsdCB2YWx1ZXMnLFxuICAgICAgICBvcGVyYXRpb25zOiByZXN1bHRzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHJlc3RvcmluZyBkZWZhdWx0czonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnRmFpbGVkIHRvIHJlc3RvcmUgZGVmYXVsdHMnLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBDb21wbGV0ZSBkYXRhYmFzZSBzY2hlbWEgc3luYyBlbmRwb2ludFxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvY29tcGxldGUtc2NoZW1hLXN5bmMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuXG4gICAgICAvLyBTdGVwIDE6IFJlbW92ZSBhbGwgZW51bSBkZXBlbmRlbmNpZXMgdGVtcG9yYXJpbHlcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIHVzZXJzIEFMVEVSIENPTFVNTiByb2xlIERST1AgREVGQVVMVGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBSZW1vdmVkIHVzZXJzLnJvbGUgZGVmYXVsdCcpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYHVzZXJzLnJvbGU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgQUxURVIgQ09MVU1OIG9yZ2FuaXphdGlvbl9yb2xlIERST1AgREVGQVVMVGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBSZW1vdmVkIHVzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcl9vcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbl9yb2xlOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVEFCTEUgaW52aXRhdGlvbnMgQUxURVIgQ09MVU1OIHJvbGUgRFJPUCBERUZBVUxUYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlbW92ZWQgaW52aXRhdGlvbnMucm9sZSBkZWZhdWx0Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgaW52aXRhdGlvbnMucm9sZTogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMjogTWlncmF0ZSBhbnkgJ293bmVyJyB1c2VycyB0byAnYWRtaW4nXG4gICAgICBjb25zdCBvd25lclVzZXJzID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgU0VMRUNUIGNvdW50KCopIGFzIGNvdW50IEZST00gdXNlcnMgV0hFUkUgcm9sZSA9ICdvd25lcidgKTtcbiAgICAgIGNvbnN0IG93bmVyQ291bnQgPSBOdW1iZXIob3duZXJVc2Vycy5yb3dzWzBdPy5jb3VudCB8fCAwKTtcbiAgICAgIGlmIChvd25lckNvdW50ID4gMCkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBVUERBVEUgdXNlcnMgU0VUIHJvbGUgPSAnYWRtaW4nIFdIRVJFIHJvbGUgPSAnb3duZXInYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaChg4pyTIE1pZ3JhdGVkICR7b3duZXJDb3VudH0gb3duZXIgdXNlcnMgdG8gYWRtaW5gKTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgVVBEQVRFIHVzZXJfb3JnYW5pemF0aW9ucyBTRVQgb3JnYW5pemF0aW9uX3JvbGUgPSAnYWRtaW4nIFdIRVJFIG9yZ2FuaXphdGlvbl9yb2xlID0gJ293bmVyJ2ApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBVcGRhdGVkIHVzZXJfb3JnYW5pemF0aW9ucyBvd25lciByb2xlcyB0byBhZG1pbicpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYHVzZXJfb3JnYW5pemF0aW9ucyBvd25lciB1cGRhdGU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDM6IEZpeCB0aGUgZW51bSB0byBtYXRjaCBkZXZlbG9wbWVudCBzY2hlbWFcbiAgICAgIHRyeSB7XG4gICAgICAgIC8vIFJlbmFtZSBjdXJyZW50IGVudW1cbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVFlQRSB1c2VyX3JvbGUgUkVOQU1FIFRPIHVzZXJfcm9sZV9vbGRgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBuZXcgZW51bSB3aXRoIGNvcnJlY3QgdmFsdWVzXG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIENSRUFURSBUWVBFIHVzZXJfcm9sZSBBUyBFTlVNIChcbiAgICAgICAgICAgICdhZG1pbicsICdtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCcsIFxuICAgICAgICAgICAgJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J1xuICAgICAgICAgIClcbiAgICAgICAgYCk7XG5cbiAgICAgICAgLy8gVXBkYXRlIGFsbCB0YWJsZXNcbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVEFCTEUgdXNlcnMgQUxURVIgQ09MVU1OIHJvbGUgVFlQRSB1c2VyX3JvbGUgVVNJTkcgcm9sZTo6dGV4dDo6dXNlcl9yb2xlYCk7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYEFMVEVSIFRBQkxFIHVzZXJfb3JnYW5pemF0aW9ucyBBTFRFUiBDT0xVTU4gb3JnYW5pemF0aW9uX3JvbGUgVFlQRSB1c2VyX3JvbGUgVVNJTkcgb3JnYW5pemF0aW9uX3JvbGU6OnRleHQ6OnVzZXJfcm9sZWApO1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVgKTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgQUxURVIgVEFCTEUgcm9sZV9wZXJtaXNzaW9ucyBBTFRFUiBDT0xVTU4gcm9sZSBUWVBFIHVzZXJfcm9sZSBVU0lORyByb2xlOjp0ZXh0Ojp1c2VyX3JvbGVgKTtcbiAgICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBVcGRhdGVkIHJvbGVfcGVybWlzc2lvbnMgZW51bScpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgcmVzdWx0cy5wdXNoKGByb2xlX3Blcm1pc3Npb25zOiAke2UubWVzc2FnZX1gKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIERyb3Agb2xkIGVudW1cbiAgICAgICAgYXdhaXQgZGIuZXhlY3V0ZShzcWxgRFJPUCBUWVBFIHVzZXJfcm9sZV9vbGRgKTtcbiAgICAgICAgXG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFN1Y2Nlc3NmdWxseSB1cGRhdGVkIHVzZXJfcm9sZSBlbnVtJyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgRW51bSB1cGRhdGUgZmFpbGVkOiAke2UubWVzc2FnZX1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBSZXN0b3JlIGRlZmF1bHQgdmFsdWVzXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSB1c2VycyBBTFRFUiBDT0xVTU4gcm9sZSBTRVQgREVGQVVMVCAndGVuYW50J2ApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBSZXN0b3JlZCB1c2Vycy5yb2xlIGRlZmF1bHQgdG8gdGVuYW50Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgdXNlcnMucm9sZSBkZWZhdWx0IHJlc3RvcmU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSB1c2VyX29yZ2FuaXphdGlvbnMgQUxURVIgQ09MVU1OIG9yZ2FuaXphdGlvbl9yb2xlIFNFVCBERUZBVUxUICd0ZW5hbnQnYCk7XG4gICAgICAgIHJlc3VsdHMucHVzaCgn4pyTIFJlc3RvcmVkIHVzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0IHRvIHRlbmFudCcpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICByZXN1bHRzLnB1c2goYHVzZXJfb3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25fcm9sZSBkZWZhdWx0IHJlc3RvcmU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBkYi5leGVjdXRlKHNxbGBBTFRFUiBUQUJMRSBpbnZpdGF0aW9ucyBBTFRFUiBDT0xVTU4gcm9sZSBTRVQgREVGQVVMVCAndGVuYW50J2ApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBSZXN0b3JlZCBpbnZpdGF0aW9ucy5yb2xlIGRlZmF1bHQgdG8gdGVuYW50Jyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgaW52aXRhdGlvbnMucm9sZSBkZWZhdWx0IHJlc3RvcmU6ICR7ZS5tZXNzYWdlfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDU6IEFkZCBtaXNzaW5nIGNvbHVtbnMgdGhhdCBleGlzdCBpbiBwcm9kdWN0aW9uIGJ1dCBub3QgZGV2ZWxvcG1lbnRcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGRiLmV4ZWN1dGUoc3FsYFxuICAgICAgICAgIEFMVEVSIFRBQkxFIGludml0YXRpb25fYXVkaXRfbG9nIFxuICAgICAgICAgIEFERCBDT0xVTU4gSUYgTk9UIEVYSVNUUyBjcmVhdGVkX2F0IFRJTUVTVEFNUCBERUZBVUxUIE5PVygpXG4gICAgICAgIGApO1xuICAgICAgICByZXN1bHRzLnB1c2goJ+KckyBBZGRlZCBjcmVhdGVkX2F0IHRvIGludml0YXRpb25fYXVkaXRfbG9nJyk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIHJlc3VsdHMucHVzaChgaW52aXRhdGlvbl9hdWRpdF9sb2cuY3JlYXRlZF9hdDogJHtlLm1lc3NhZ2V9YCk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0RhdGFiYXNlIHNjaGVtYSBzeW5jaHJvbml6YXRpb24gY29tcGxldGUnLFxuICAgICAgICBvcGVyYXRpb25zOiByZXN1bHRzLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgc3VjY2VzczogdHJ1ZVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGR1cmluZyBzY2hlbWEgc3luY2hyb25pemF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdTY2hlbWEgc3luY2hyb25pemF0aW9uIGZhaWxlZCcsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBzdWNjZXNzOiBmYWxzZVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBFbmhhbmNlZCBkaWFnbm9zdGljIGVuZHBvaW50IHdpdGggZGF0YWJhc2Ugc2NoZW1hIGNoZWNrXG4gIGFwcC5nZXQoJy9hcGkvZG9jdW1lbnRzL2RpYWdub3N0aWMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgZG9jdW1lbnRzIHRhYmxlIGV4aXN0c1xuICAgICAgbGV0IHRhYmxlRXhpc3RzID0gZmFsc2U7XG4gICAgICBsZXQgdGFibGVTY2hlbWEgPSBudWxsO1xuICAgICAgXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICBTRUxFQ1QgY29sdW1uX25hbWUsIGRhdGFfdHlwZSwgaXNfbnVsbGFibGUsIGNvbHVtbl9kZWZhdWx0IFxuICAgICAgICAgIEZST00gaW5mb3JtYXRpb25fc2NoZW1hLmNvbHVtbnMgXG4gICAgICAgICAgV0hFUkUgdGFibGVfbmFtZSA9ICdkb2N1bWVudHMnIFxuICAgICAgICAgIE9SREVSIEJZIG9yZGluYWxfcG9zaXRpb25cbiAgICAgICAgYCk7XG4gICAgICAgIHRhYmxlRXhpc3RzID0gcmVzdWx0LnJvd3MubGVuZ3RoID4gMDtcbiAgICAgICAgdGFibGVTY2hlbWEgPSByZXN1bHQucm93cztcbiAgICAgIH0gY2F0Y2ggKHNjaGVtYUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1NjaGVtYSBjaGVjayBlcnJvcjonLCBzY2hlbWFFcnJvcik7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IEFQSSBkaWFnbm9zdGljJyxcbiAgICAgICAgZ2NzX2Rpc2FibGVkOiB0cnVlLFxuICAgICAgICBzZXNzaW9uX2ZpeF9hcHBsaWVkOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgZW52aXJvbm1lbnQ6IHByb2Nlc3MuZW52Lk5PREVfRU5WLFxuICAgICAgICB2ZXJzaW9uOiAndjIuMS1nY3MtZGlzYWJsZWQnLFxuICAgICAgICByZWNlbnRfZXJyb3JzOiBlcnJvckxvZy5zbGljZSgtNSksIC8vIExhc3QgNSBlcnJvcnNcbiAgICAgICAgc3RvcmFnZV9zdGF0dXM6IHtcbiAgICAgICAgICBleGlzdHM6ICEhc3RvcmFnZSxcbiAgICAgICAgICB0eXBlOiBzdG9yYWdlPy5jb25zdHJ1Y3Rvcj8ubmFtZSxcbiAgICAgICAgICBtZXRob2RzOiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhPYmplY3QuZ2V0UHJvdG90eXBlT2Yoc3RvcmFnZSB8fCB7fSkpXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFiYXNlX3N0YXR1czoge1xuICAgICAgICAgIGRvY3VtZW50c190YWJsZV9leGlzdHM6IHRhYmxlRXhpc3RzLFxuICAgICAgICAgIGRvY3VtZW50c190YWJsZV9zY2hlbWE6IHRhYmxlU2NoZW1hLFxuICAgICAgICAgIHNjaGVtYV9jb2x1bW5zX2NvdW50OiB0YWJsZVNjaGVtYT8ubGVuZ3RoIHx8IDAsXG4gICAgICAgICAgY29ubmVjdGlvbl90ZXN0OiBhd2FpdCB0ZXN0RGF0YWJhc2VDb25uZWN0aW9uKCksXG4gICAgICAgICAgc2FtcGxlX3F1ZXJ5X3Rlc3Q6IGF3YWl0IHRlc3RTYW1wbGVRdWVyeSgpLFxuICAgICAgICAgIGVudW1fY2hlY2s6IGF3YWl0IGNoZWNrRW51bVZhbHVlcygpLFxuICAgICAgICAgIHVzZXJfb3JnYW5pemF0aW9uX2xpbmtzOiBhd2FpdCBjaGVja1VzZXJPcmdhbml6YXRpb25MaW5rcygpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBydW5uaW5nIGRpYWdub3N0aWM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0RpYWdub3N0aWMgZmFpbGVkJyxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbiAgXG4gIC8vIEVycm9yIGxvZ2dpbmcgaGVscGVyXG4gIGNvbnN0IGxvZ0Vycm9yID0gKGVuZHBvaW50OiBzdHJpbmcsIGVycm9yOiBhbnksIHVzZXI/OiBhbnkpID0+IHtcbiAgICBjb25zdCBlcnJvckVudHJ5ID0ge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICBlbmRwb2ludCxcbiAgICAgIGVycm9yOiB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgZGV0YWlsczogZXJyb3IudG9TdHJpbmcoKVxuICAgICAgfSxcbiAgICAgIHVzZXI6IHVzZXIgPyB7IGlkOiB1c2VyLmlkLCByb2xlOiB1c2VyLnJvbGUgfSA6IG51bGxcbiAgICB9O1xuICAgIFxuICAgIGVycm9yTG9nLnB1c2goZXJyb3JFbnRyeSk7XG4gICAgaWYgKGVycm9yTG9nLmxlbmd0aCA+IDUwKSBlcnJvckxvZy5zaGlmdCgpOyAvLyBLZWVwIG9ubHkgbGFzdCA1MCBlcnJvcnNcbiAgICBcbiAgICBjb25zb2xlLmVycm9yKGBbJHtlcnJvckVudHJ5LnRpbWVzdGFtcH1dIPCfmqggRVJST1IgaW4gJHtlbmRwb2ludH06YCwgZXJyb3JFbnRyeSk7XG4gICAgcmV0dXJuIGVycm9yRW50cnk7XG4gIH07XG4gIFxuICAvLyBHZXQgYWxsIGRvY3VtZW50cyBmb3IgdGhlIGF1dGhlbnRpY2F0ZWQgdXNlclxuICBhcHAuZ2V0KCcvYXBpL2RvY3VtZW50cycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+ThCBHRVQgL2FwaS9kb2N1bWVudHMgLSBTdGFydGluZyByZXF1ZXN0YCwge1xuICAgICAgdXNlcklkOiByZXEudXNlcj8uaWQsXG4gICAgICB1c2VyUm9sZTogcmVxLnVzZXI/LnJvbGUsXG4gICAgICBxdWVyeTogcmVxLnF1ZXJ5LFxuICAgICAgdXJsOiByZXEudXJsLFxuICAgICAgbWV0aG9kOiByZXEubWV0aG9kXG4gICAgfSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIFxuICAgICAgLy8gUHJvZHVjdGlvbiBkZWJ1Z2dpbmc6IExvZyB0aGUgcmVxdWVzdCBkZXRhaWxzXG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+UjSBVc2VyIGRhdGEgZXh0cmFjdGVkOmAsIHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgaGFzVmFsaWRVc2VyOiAhIXVzZXJcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBDcml0aWNhbDogQ2hlY2sgaWYgc3RvcmFnZSBvYmplY3QgZXhpc3RzIGFuZCBpcyBwcm9wZXJseSBpbml0aWFsaXplZFxuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCfkr4gU3RvcmFnZSBjaGVjazpgLCB7XG4gICAgICAgIHN0b3JhZ2VFeGlzdHM6ICEhc3RvcmFnZSxcbiAgICAgICAgc3RvcmFnZVR5cGU6IHN0b3JhZ2U/LmNvbnN0cnVjdG9yPy5uYW1lLFxuICAgICAgICBzdG9yYWdlTWV0aG9kOiB0eXBlb2Ygc3RvcmFnZT8uZ2V0RG9jdW1lbnRzXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGRvY3VtZW50VHlwZSA9IHJlcS5xdWVyeS50eXBlIGFzIHN0cmluZzsgLy8gJ2J1aWxkaW5nJywgJ3Jlc2lkZW50Jywgb3IgdW5kZWZpbmVkIGZvciBib3RoXG4gICAgICBjb25zdCBzcGVjaWZpY1Jlc2lkZW5jZUlkID0gcmVxLnF1ZXJ5LnJlc2lkZW5jZUlkIGFzIHN0cmluZzsgLy8gRmlsdGVyIGJ5IHNwZWNpZmljIHJlc2lkZW5jZVxuICAgICAgY29uc3Qgc3BlY2lmaWNCdWlsZGluZ0lkID0gcmVxLnF1ZXJ5LmJ1aWxkaW5nSWQgYXMgc3RyaW5nOyAvLyBGaWx0ZXIgYnkgc3BlY2lmaWMgYnVpbGRpbmdcblxuICAgICAgLy8gR2V0IHVzZXIncyBvcmdhbml6YXRpb24gYW5kIHJlc2lkZW5jZXMgZm9yIGZpbHRlcmluZ1xuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCflI0gRmV0Y2hpbmcgdXNlciBkYXRhIGZyb20gc3RvcmFnZS4uLmApO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+TiyBDYWxsaW5nIGdldFVzZXJPcmdhbml6YXRpb25zKCR7dXNlcklkfSkuLi5gKTtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g4pyFIGdldFVzZXJPcmdhbml6YXRpb25zIFNVQ0NFU1MgLSBGb3VuZCAke29yZ2FuaXphdGlvbnMubGVuZ3RofSBvcmdhbml6YXRpb25zYCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDwn5OLIENhbGxpbmcgZ2V0VXNlclJlc2lkZW5jZXMoJHt1c2VySWR9KS4uLmApO1xuICAgICAgY29uc3QgdXNlclJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g4pyFIGdldFVzZXJSZXNpZGVuY2VzIFNVQ0NFU1MgLSBGb3VuZCAke3VzZXJSZXNpZGVuY2VzLmxlbmd0aH0gdXNlciByZXNpZGVuY2VzYCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDwn5OLIENhbGxpbmcgZ2V0QnVpbGRpbmdzKCkuLi5gKTtcbiAgICAgIGNvbnN0IGJ1aWxkaW5ncyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmdzKCk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g4pyFIGdldEJ1aWxkaW5ncyBTVUNDRVNTIC0gRm91bmQgJHtidWlsZGluZ3MubGVuZ3RofSBidWlsZGluZ3NgKTtcblxuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSBvcmdhbml6YXRpb25zLmxlbmd0aCA+IDAgPyBvcmdhbml6YXRpb25zWzBdLm9yZ2FuaXphdGlvbklkIDogdW5kZWZpbmVkO1xuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCfj6IgT3JnYW5pemF0aW9uIElEIGRldGVybWluZWQ6YCwgb3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAvLyBJZiBzcGVjaWZpYyByZXNpZGVuY2UgSUQgcHJvdmlkZWQsIGZpbHRlciB0byBvbmx5IHRoYXQgcmVzaWRlbmNlXG4gICAgICBsZXQgcmVzaWRlbmNlSWRzOiBzdHJpbmdbXTtcbiAgICAgIGlmIChzcGVjaWZpY1Jlc2lkZW5jZUlkKSB7XG4gICAgICAgIC8vIEFkbWluIHVzZXJzIGhhdmUgYWNjZXNzIHRvIGFsbCByZXNpZGVuY2VzXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyUm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgICAgcmVzaWRlbmNlSWRzID0gW3NwZWNpZmljUmVzaWRlbmNlSWRdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFZlcmlmeSB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBzcGVjaWZpYyByZXNpZGVuY2VcbiAgICAgICAgICAvLyBIYW5kbGUgYm90aCBzaW1wbGUge3Jlc2lkZW5jZUlkOiBzdHJpbmd9IGFuZCBjb21wbGV4IG5lc3RlZCBzdHJ1Y3R1cmVzXG4gICAgICAgICAgY29uc3QgaGFzQWNjZXNzID0gdXNlclJlc2lkZW5jZXMuc29tZSgodXI6IGFueSkgPT4ge1xuICAgICAgICAgICAgLy8gSGFuZGxlIHNpbXBsZSBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2VJZCA9PT0gc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEhhbmRsZSBjb21wbGV4IG5lc3RlZCBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci51c2VyUmVzaWRlbmNlPy5yZXNpZGVuY2VJZCA9PT0gc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIEhhbmRsZSByZXNpZGVuY2UgbmVzdGVkIHN0cnVjdHVyZVxuICAgICAgICAgICAgaWYgKHVyLnJlc2lkZW5jZT8uaWQgPT09IHNwZWNpZmljUmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgcmVzaWRlbmNlJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmVzaWRlbmNlSWRzID0gW3NwZWNpZmljUmVzaWRlbmNlSWRdO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBFeHRyYWN0IHJlc2lkZW5jZSBJRHMgZnJvbSBib3RoIHNpbXBsZSBhbmQgY29tcGxleCBzdHJ1Y3R1cmVzXG4gICAgICAgIHJlc2lkZW5jZUlkcyA9IHVzZXJSZXNpZGVuY2VzXG4gICAgICAgICAgLm1hcCgodXI6IGFueSkgPT4ge1xuICAgICAgICAgICAgLy8gSGFuZGxlIHNpbXBsZSBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2VJZCkge1xuICAgICAgICAgICAgICByZXR1cm4gdXIucmVzaWRlbmNlSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBIYW5kbGUgY29tcGxleCBuZXN0ZWQgc3RydWN0dXJlXG4gICAgICAgICAgICBpZiAodXIudXNlclJlc2lkZW5jZT8ucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHVyLnVzZXJSZXNpZGVuY2UucmVzaWRlbmNlSWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBIYW5kbGUgcmVzaWRlbmNlIG5lc3RlZCBzdHJ1Y3R1cmVcbiAgICAgICAgICAgIGlmICh1ci5yZXNpZGVuY2U/LmlkKSB7XG4gICAgICAgICAgICAgIHJldHVybiB1ci5yZXNpZGVuY2UuaWQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5maWx0ZXIoKGlkOiBhbnkpID0+IGlkICE9PSBudWxsKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBidWlsZGluZ3MubWFwKChiKSA9PiBiLmlkKTtcblxuICAgICAgY29uc3QgYWxsRG9jdW1lbnRSZWNvcmRzOiBhbnlbXSA9IFtdO1xuXG4gICAgICAvLyBVc2UgdW5pZmllZCBkb2N1bWVudHMgc3lzdGVtXG4gICAgICBjb25zdCBmaWx0ZXJzOiBhbnkgPSB7XG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICB9O1xuXG4gICAgICAvLyBGaWx0ZXIgYnkgc3BlY2lmaWMgcmVzaWRlbmNlIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoc3BlY2lmaWNSZXNpZGVuY2VJZCkge1xuICAgICAgICBmaWx0ZXJzLnJlc2lkZW5jZUlkID0gc3BlY2lmaWNSZXNpZGVuY2VJZDtcbiAgICAgIH1cblxuICAgICAgLy8gRmlsdGVyIGJ5IHNwZWNpZmljIGJ1aWxkaW5nIGlmIHByb3ZpZGVkXG4gICAgICBpZiAoc3BlY2lmaWNCdWlsZGluZ0lkKSB7XG4gICAgICAgIGZpbHRlcnMuYnVpbGRpbmdJZCA9IHNwZWNpZmljQnVpbGRpbmdJZDtcbiAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnRUeXBlID09PSAnYnVpbGRpbmcnKSB7XG4gICAgICAgIC8vIEZvciBidWlsZGluZyBkb2N1bWVudHMsIHNlYXJjaCBpbiBidWlsZGluZ3MgdXNlciBoYXMgYWNjZXNzIHRvXG4gICAgICAgIGlmIChidWlsZGluZ0lkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gR2V0IGFsbCBkb2N1bWVudHMgZm9yIGJ1aWxkaW5ncywgd2lsbCBmaWx0ZXIgbGF0ZXJcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChkb2N1bWVudFR5cGUgPT09ICdyZXNpZGVudCcpIHtcbiAgICAgICAgLy8gRm9yIHJlc2lkZW50IGRvY3VtZW50cywgc2VhcmNoIGluIHJlc2lkZW5jZXMgdXNlciBoYXMgYWNjZXNzIHRvXG4gICAgICAgIGlmIChyZXNpZGVuY2VJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIEdldCBhbGwgZG9jdW1lbnRzIGZvciByZXNpZGVuY2VzLCB3aWxsIGZpbHRlciBsYXRlclxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENSSVRJQ0FMIERFQlVHIFBPSU5UOiBUaGlzIGlzIHdoZXJlIDUwMCBlcnJvcnMgbGlrZWx5IG9jY3VyXG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+OryBDUklUSUNBTDogQWJvdXQgdG8gY2FsbCBzdG9yYWdlLmdldERvY3VtZW50cyB3aXRoIGZpbHRlcnM6YCwgZmlsdGVycyk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+UpyBTdG9yYWdlIGluc3RhbmNlOmAsIHN0b3JhZ2UuY29uc3RydWN0b3IubmFtZSk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+TiiBGaWx0ZXJzIGJlaW5nIHBhc3NlZDpgLCBKU09OLnN0cmluZ2lmeShmaWx0ZXJzLCBudWxsLCAyKSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRvY3VtZW50cyA9IGF3YWl0IHN0b3JhZ2UuZ2V0RG9jdW1lbnRzKGZpbHRlcnMpO1xuXG4gICAgICAvLyBDUklUSUNBTDogTG9nIHN1Y2Nlc3NmdWwgZGF0YWJhc2UgcmVzcG9uc2VcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDinIUgQ1JJVElDQUw6IHN0b3JhZ2UuZ2V0RG9jdW1lbnRzIFNVQ0NFU1MgLSByZXR1cm5lZCAke2RvY3VtZW50cz8ubGVuZ3RoIHx8IDB9IGRvY3VtZW50c2ApO1xuICAgICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCfk4sgRG9jdW1lbnQgcHJldmlldzpgLCBkb2N1bWVudHM/LnNsaWNlKDAsIDMpPy5tYXAoZCA9PiAoeyBcbiAgICAgICAgaWQ6IGQuaWQsIFxuICAgICAgICBuYW1lOiBkLm5hbWUsIFxuICAgICAgICB1cGxvYWRlZEJ5SWQ6IGQudXBsb2FkZWRCeUlkLFxuICAgICAgICBidWlsZGluZ0lkOiBkLmJ1aWxkaW5nSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkOiBkLnJlc2lkZW5jZUlkIFxuICAgICAgfSkpKTtcblxuICAgICAgLy8gRGVidWcgbG9nZ2luZ1xuICAgICAgY29uc29sZS5sb2coJ/CflI0gW0RPQ1VNRU5UUyBBUEkgREVCVUddOicsIHtcbiAgICAgICAgZmlsdGVycyxcbiAgICAgICAgZG9jdW1lbnRzRm91bmQ6IGRvY3VtZW50cz8ubGVuZ3RoIHx8IDAsXG4gICAgICAgIHNwZWNpZmljUmVzaWRlbmNlSWQsXG4gICAgICAgIHVzZXJSb2xlLFxuICAgICAgICB1c2VySWQsXG4gICAgICB9KTtcblxuICAgICAgLy8gQXBwbHkgcm9sZS1iYXNlZCBmaWx0ZXJpbmcgd2l0aCB0ZW5hbnQgdmlzaWJpbGl0eSBydWxlc1xuICAgICAgY29uc3QgZmlsdGVyZWREb2N1bWVudFJlY29yZHMgPSBkb2N1bWVudHMuZmlsdGVyKChkb2MpID0+IHtcbiAgICAgICAgLy8gSWYgZmlsdGVyaW5nIGJ5IHNwZWNpZmljIGJ1aWxkaW5nLCBvbmx5IHNob3cgZG9jdW1lbnRzIGZvciB0aGF0IGJ1aWxkaW5nXG4gICAgICAgIGlmIChzcGVjaWZpY0J1aWxkaW5nSWQpIHtcbiAgICAgICAgICBpZiAoZG9jLmJ1aWxkaW5nSWQgIT09IHNwZWNpZmljQnVpbGRpbmdJZCkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFkbWluIGNhbiBzZWUgYWxsIGRvY3VtZW50c1xuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1hbmFnZXIgY2FuIHNlZSBhbGwgZG9jdW1lbnRzIGluIHRoZWlyIG9yZ2FuaXphdGlvblxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdtYW5hZ2VyJyAmJiBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgIGlmIChkb2MuYnVpbGRpbmdJZCAmJiBidWlsZGluZ0lkcy5pbmNsdWRlcyhkb2MuYnVpbGRpbmdJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZG9jLnJlc2lkZW5jZUlkICYmIHJlc2lkZW5jZUlkcy5pbmNsdWRlcyhkb2MucmVzaWRlbmNlSWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBSZXNpZGVudCBhY2Nlc3MgcnVsZXNcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgLy8gUmVzaWRlbnRzIGNhbiBzZWUgZG9jdW1lbnRzIGluIHRoZWlyIHJlc2lkZW5jZVxuICAgICAgICAgIGlmIChkb2MucmVzaWRlbmNlSWQgJiYgcmVzaWRlbmNlSWRzLmluY2x1ZGVzKGRvYy5yZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBSZXNpZGVudHMgY2FuIHNlZSBidWlsZGluZyBkb2N1bWVudHMgcmVsYXRlZCB0byB0aGVpciByZXNpZGVuY2VzXG4gICAgICAgICAgaWYgKGRvYy5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBhbnkgb2YgdXNlcidzIHJlc2lkZW5jZXMgYmVsb25nIHRvIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgICAgIGNvbnN0IHVzZXJCdWlsZGluZ0lkcyA9IHVzZXJSZXNpZGVuY2VzXG4gICAgICAgICAgICAgIC5tYXAoKHVyOiBhbnkpID0+IHVyLnJlc2lkZW5jZT8uYnVpbGRpbmdJZCB8fCB1ci51c2VyUmVzaWRlbmNlPy5yZXNpZGVuY2U/LmJ1aWxkaW5nSWQpXG4gICAgICAgICAgICAgIC5maWx0ZXIoQm9vbGVhbik7XG4gICAgICAgICAgICByZXR1cm4gdXNlckJ1aWxkaW5nSWRzLmluY2x1ZGVzKGRvYy5idWlsZGluZ0lkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUZW5hbnQgYWNjZXNzIHJ1bGVzIC0gbW9yZSByZXN0cmljdGl2ZVxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICd0ZW5hbnQnKSB7XG4gICAgICAgICAgLy8gVGVuYW50cyBjYW4gb25seSBzZWUgZG9jdW1lbnRzIG1hcmtlZCBhcyB2aXNpYmxlIHRvIHRlbmFudHNcbiAgICAgICAgICBpZiAoIWRvYy5pc1Zpc2libGVUb1RlbmFudHMpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUZW5hbnRzIGNhbiBzZWUgdmlzaWJsZSBkb2N1bWVudHMgaW4gdGhlaXIgcmVzaWRlbmNlXG4gICAgICAgICAgaWYgKGRvYy5yZXNpZGVuY2VJZCAmJiByZXNpZGVuY2VJZHMuaW5jbHVkZXMoZG9jLnJlc2lkZW5jZUlkKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gVGVuYW50cyBjYW4gc2VlIHZpc2libGUgYnVpbGRpbmcgZG9jdW1lbnRzIHJlbGF0ZWQgdG8gdGhlaXIgcmVzaWRlbmNlc1xuICAgICAgICAgIGlmIChkb2MuYnVpbGRpbmdJZCkge1xuICAgICAgICAgICAgLy8gQ2hlY2sgaWYgYW55IG9mIHVzZXIncyByZXNpZGVuY2VzIGJlbG9uZyB0byB0aGlzIGJ1aWxkaW5nXG4gICAgICAgICAgICBjb25zdCB1c2VyQnVpbGRpbmdJZHMgPSB1c2VyUmVzaWRlbmNlc1xuICAgICAgICAgICAgICAubWFwKCh1cjogYW55KSA9PiB1ci5yZXNpZGVuY2U/LmJ1aWxkaW5nSWQgfHwgdXIudXNlclJlc2lkZW5jZT8ucmVzaWRlbmNlPy5idWlsZGluZ0lkKVxuICAgICAgICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgICAgICAgICAgcmV0dXJuIHVzZXJCdWlsZGluZ0lkcy5pbmNsdWRlcyhkb2MuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBkb2N1bWVudCB0eXBlIGluZGljYXRvcnMgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHkgYW5kIGZpZWxkIG1hcHBpbmdcbiAgICAgIGNvbnN0IGVuaGFuY2VkRG9jdW1lbnRSZWNvcmRzID0gZmlsdGVyZWREb2N1bWVudFJlY29yZHMubWFwKChkb2MpID0+ICh7XG4gICAgICAgIC4uLmRvYyxcbiAgICAgICAgdGl0bGU6IGRvYy5uYW1lLCAvLyBNYXAgZGF0YWJhc2UgJ25hbWUnIGZpZWxkIHRvIGZyb250ZW5kICd0aXRsZScgZmllbGRcbiAgICAgICAgY2F0ZWdvcnk6IGRvYy5kb2N1bWVudFR5cGUsIC8vIE1hcCBkYXRhYmFzZSAnZG9jdW1lbnRUeXBlJyB0byBmcm9udGVuZCAnY2F0ZWdvcnknXG4gICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6IGRvYy5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVudCcsXG4gICAgICAgIGVudGl0eVR5cGU6IGRvYy5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVuY2UnLFxuICAgICAgICBlbnRpdHlJZDogZG9jLmJ1aWxkaW5nSWQgfHwgZG9jLnJlc2lkZW5jZUlkLFxuICAgICAgICB1cGxvYWREYXRlOiBkb2MuY3JlYXRlZEF0LCAvLyBGb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eVxuICAgICAgICBmaWxlVXJsOiBkb2MuZmlsZVBhdGggPyBgL2FwaS9kb2N1bWVudHMvJHtkb2MuaWR9L2ZpbGVgIDogdW5kZWZpbmVkLCAvLyBHZW5lcmF0ZSBmaWxlIFVSTCBpZiBmaWxlIGV4aXN0c1xuICAgICAgfSkpO1xuXG4gICAgICBhbGxEb2N1bWVudFJlY29yZHMucHVzaCguLi5lbmhhbmNlZERvY3VtZW50UmVjb3Jkcyk7XG5cbiAgICAgIC8vIFNvcnQgYnkgdXBsb2FkIGRhdGUsIG1vc3QgcmVjZW50IGZpcnN0XG4gICAgICBhbGxEb2N1bWVudFJlY29yZHMuc29ydChcbiAgICAgICAgKGEsIGIpID0+IG5ldyBEYXRlKGIudXBsb2FkRGF0ZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS51cGxvYWREYXRlKS5nZXRUaW1lKClcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgICBkb2N1bWVudHM6IGFsbERvY3VtZW50UmVjb3JkcyxcbiAgICAgICAgdG90YWw6IGFsbERvY3VtZW50UmVjb3Jkcy5sZW5ndGgsXG4gICAgICAgIGJ1aWxkaW5nQ291bnQ6IGFsbERvY3VtZW50UmVjb3Jkcy5maWx0ZXIoKGQpID0+IGQuZG9jdW1lbnRDYXRlZ29yeSA9PT0gJ2J1aWxkaW5nJykubGVuZ3RoLFxuICAgICAgICByZXNpZGVudENvdW50OiBhbGxEb2N1bWVudFJlY29yZHMuZmlsdGVyKChkKSA9PiBkLmRvY3VtZW50Q2F0ZWdvcnkgPT09ICdyZXNpZGVudCcpLmxlbmd0aCxcbiAgICAgICAgbGVnYWN5Q291bnQ6IGFsbERvY3VtZW50UmVjb3Jkcy5maWx0ZXIoKGQpID0+IGQuZG9jdW1lbnRDYXRlZ29yeSA9PT0gJ2xlZ2FjeScpLmxlbmd0aCxcbiAgICAgIH07XG4gICAgICAvLyBMb2cgc3VjY2Vzc2Z1bCBkb2N1bWVudCBhY2Nlc3NcbiAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ0RPQ1VNRU5UX0xJU1RfQUNDRVNTJywgdXNlciwgdHJ1ZSwgdW5kZWZpbmVkLCB7XG4gICAgICAgIGRvY3VtZW50c1JldHVybmVkOiBhbGxEb2N1bWVudFJlY29yZHMubGVuZ3RoLFxuICAgICAgICBmaWx0ZXJzOiB7IGRvY3VtZW50VHlwZSwgc3BlY2lmaWNSZXNpZGVuY2VJZCwgc3BlY2lmaWNCdWlsZGluZ0lkIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXMuanNvbihyZXNwb25zZSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnN0IGVycm9yRW50cnkgPSBsb2dFcnJvcignR0VUIC9hcGkvZG9jdW1lbnRzJywgX2Vycm9yLCByZXEudXNlcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGRvY3VtZW50cycsXG4gICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcCxcbiAgICAgICAgZGVidWdfaW5mbzogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCcgPyBfZXJyb3IubWVzc2FnZSA6IHVuZGVmaW5lZFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBHZXQgYSBzcGVjaWZpYyBkb2N1bWVudCBieSBJRFxuICBhcHAuZ2V0KCcvYXBpL2RvY3VtZW50cy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCBkb2N1bWVudFR5cGUgPSByZXEucXVlcnkudHlwZSBhcyBzdHJpbmc7IC8vIE9wdGlvbmFsIHR5cGUgaGludFxuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlcyBmb3IgZmlsdGVyaW5nXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgY29uc3QgcmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlclJlc2lkZW5jZXModXNlcklkKTtcbiAgICAgIGNvbnN0IGJ1aWxkaW5ncyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmdzKCk7XG5cbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUlkcyA9IHJlc2lkZW5jZXMubWFwKCh1cikgPT4gdXIucmVzaWRlbmNlSWQpO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBidWlsZGluZ3MubWFwKChiKSA9PiBiLmlkKTtcblxuICAgICAgbGV0IGRvY3VtZW50OiBEb2N1bWVudFJlY29yZCB8IG51bGwgPSBudWxsO1xuXG4gICAgICAvLyBUcnkgdG8gZmluZCB0aGUgZG9jdW1lbnQgaW4gdGhlIGFwcHJvcHJpYXRlIHRhYmxlKHMpXG4gICAgICBjb25zdCBoYXNOZXdEb2N1bWVudFJlY29yZE1ldGhvZHMgPSAnZ2V0QnVpbGRpbmdEb2N1bWVudFJlY29yZCcgaW4gc3RvcmFnZTtcblxuICAgICAgaWYgKGhhc05ld0RvY3VtZW50UmVjb3JkTWV0aG9kcykge1xuICAgICAgICBpZiAoIWRvY3VtZW50VHlwZSB8fCBkb2N1bWVudFR5cGUgPT09ICdidWlsZGluZycpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG9jdW1lbnQgPSBhd2FpdCAoc3RvcmFnZSBhcyBhbnkpLmdldEJ1aWxkaW5nRG9jdW1lbnRSZWNvcmQoXG4gICAgICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICBidWlsZGluZ0lkc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGlmIChkb2N1bWVudCkge1xuICAgICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5kb2N1bWVudENhdGVnb3J5ID0gJ2J1aWxkaW5nJztcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZW50aXR5VHlwZSA9ICdidWlsZGluZyc7XG4gICAgICAgICAgICAgIChkb2N1bWVudCBhcyBhbnkpLmVudGl0eUlkID0gKGRvY3VtZW50IGFzIGFueSkuYnVpbGRpbmdJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBmZXRjaGluZyBidWlsZGluZyBkb2N1bWVudDonLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWRvY3VtZW50ICYmICghZG9jdW1lbnRUeXBlIHx8IGRvY3VtZW50VHlwZSA9PT0gJ3Jlc2lkZW50JykpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZG9jdW1lbnQgPSBhd2FpdCAoc3RvcmFnZSBhcyBhbnkpLmdldFJlc2lkZW50RG9jdW1lbnRSZWNvcmQoXG4gICAgICAgICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICByZXNpZGVuY2VJZHNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAoZG9jdW1lbnQpIHtcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZG9jdW1lbnRDYXRlZ29yeSA9ICdyZXNpZGVudCc7XG4gICAgICAgICAgICAgIChkb2N1bWVudCBhcyBhbnkpLmVudGl0eVR5cGUgPSAncmVzaWRlbmNlJztcbiAgICAgICAgICAgICAgKGRvY3VtZW50IGFzIGFueSkuZW50aXR5SWQgPSAoZG9jdW1lbnQgYXMgYW55KS5yZXNpZGVuY2VJZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBmZXRjaGluZyByZXNpZGVudCBkb2N1bWVudDonLCBlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRmFsbGJhY2sgdG8gbGVnYWN5IGRvY3VtZW50cyBpZiBub3QgZm91bmQgYW5kIG5vIHR5cGUgc3BlY2lmaWVkXG4gICAgICBpZiAoIWRvY3VtZW50ICYmICFkb2N1bWVudFR5cGUpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuZ2V0RG9jdW1lbnQoZG9jdW1lbnRJZCk7XG4gICAgICAgICAgaWYgKGRvY3VtZW50KSB7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5kb2N1bWVudENhdGVnb3J5ID0gJ2xlZ2FjeSc7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5lbnRpdHlUeXBlID0gJ2xlZ2FjeSc7XG4gICAgICAgICAgICAoZG9jdW1lbnQgYXMgYW55KS5lbnRpdHlJZCA9IG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRXJyb3IgZmV0Y2hpbmcgbGVnYWN5IGRvY3VtZW50OicsIGUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghZG9jdW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0RvY3VtZW50UmVjb3JkIG5vdCBmb3VuZCBvciBhY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oZG9jdW1lbnQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBkb2N1bWVudDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggZG9jdW1lbnQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgbmV3IGRvY3VtZW50IChzdXBwb3J0cyBib3RoIGZpbGUgdXBsb2FkIGFuZCB0ZXh0LW9ubHkgZG9jdW1lbnRzKVxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMnLCByZXF1aXJlQXV0aCwgdXBsb2FkLnNpbmdsZSgnZmlsZScpLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBTdGFydGluZyBkb2N1bWVudCB1cGxvYWQvY3JlYXRpb25gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+ThCBbRE9DVU1FTlRTIFVQTE9BRF0gVXNlcjogJHtyZXEudXNlci5pZH0gKCR7cmVxLnVzZXIucm9sZX0pYCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIGNvbnN0IHsgZG9jdW1lbnRUeXBlLCBidWlsZGluZ0lkLCByZXNpZGVuY2VJZCwgdGV4dENvbnRlbnQsIHR5cGUsIC4uLm90aGVyRGF0YSB9ID0gcmVxLmJvZHk7XG4gICAgICBcbiAgICAgIC8vIEVuaGFuY2VkIGRlYnVnIGxvZ2dpbmcgd2l0aCBjb250ZXh0IGluZm9ybWF0aW9uXG4gICAgICBjb25zb2xlLmxvZyhg8J+ThCBbRE9DVU1FTlRTIFVQTE9BRF0gUmVxdWVzdCBkZXRhaWxzOmAsIHtcbiAgICAgICAgZG9jdW1lbnRUeXBlLFxuICAgICAgICB0eXBlLFxuICAgICAgICBidWlsZGluZ0lkLCBcbiAgICAgICAgcmVzaWRlbmNlSWQsXG4gICAgICAgIGhhc0ZpbGU6ICEhcmVxLmZpbGUsXG4gICAgICAgIGhhc1RleHRDb250ZW50OiAhIXRleHRDb250ZW50LFxuICAgICAgICBvdGhlckRhdGFLZXlzOiBPYmplY3Qua2V5cyhvdGhlckRhdGEpLFxuICAgICAgICBmaWxlTmFtZTogcmVxLmZpbGU/Lm9yaWdpbmFsbmFtZSxcbiAgICAgICAgZmlsZVNpemU6IHJlcS5maWxlPy5zaXplLFxuICAgICAgICBtaW1lVHlwZTogcmVxLmZpbGU/Lm1pbWV0eXBlXG4gICAgICB9KTtcblxuICAgICAgaWYgKHJlcS5maWxlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBGaWxlIGRldGFpbHM6YCwge1xuICAgICAgICAgIG9yaWdpbmFsTmFtZTogcmVxLmZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICAgIG1pbWVUeXBlOiByZXEuZmlsZS5taW1ldHlwZSxcbiAgICAgICAgICBzaXplOiByZXEuZmlsZS5zaXplLFxuICAgICAgICAgIHRlbXBQYXRoOiByZXEuZmlsZS5wYXRoLFxuICAgICAgICAgIGVuY29kaW5nOiByZXEuZmlsZS5lbmNvZGluZ1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRW5oYW5jZWQgcmF0ZSBsaW1pdGluZyBjaGVja1xuICAgICAgY29uc29sZS5sb2coYPCfk4QgW0RPQ1VNRU5UUyBVUExPQURdIENoZWNraW5nIHJhdGUgbGltaXQgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gICAgICBjb25zdCByYXRlTGltaXRDaGVjayA9IGNoZWNrVXBsb2FkUmF0ZUxpbWl0KHVzZXJJZCk7XG4gICAgICBpZiAoIXJhdGVMaW1pdENoZWNrLmFsbG93ZWQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlRTIFVQTE9BRF0gUmF0ZSBsaW1pdCBleGNlZWRlZCBmb3IgdXNlciAke3VzZXJJZH06ICR7cmF0ZUxpbWl0Q2hlY2suZXJyb3J9YCk7XG4gICAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ1VQTE9BRF9SQVRFX0xJTUlUX0VYQ0VFREVEJywgdXNlciwgZmFsc2UsIHVuZGVmaW5lZCwgeyBlcnJvcjogcmF0ZUxpbWl0Q2hlY2suZXJyb3IgfSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQyOSkuanNvbih7IG1lc3NhZ2U6IHJhdGVMaW1pdENoZWNrLmVycm9yIH0pO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlRTIFVQTE9BRF0gUmF0ZSBsaW1pdCBjaGVjayBwYXNzZWQgZm9yIHVzZXIgJHt1c2VySWR9YCk7XG4gICAgICBcbiAgICAgIC8vIFZhbGlkYXRlIHBlcm1pc3Npb25zIC0gb25seSBhZG1pbiwgbWFuYWdlciwgYW5kIHJlc2lkZW50IGNhbiBjcmVhdGUgZG9jdW1lbnRzXG4gICAgICBjb25zb2xlLmxvZyhg8J+ThCBbRE9DVU1FTlRTIFVQTE9BRF0gQ2hlY2tpbmcgcGVybWlzc2lvbnMgZm9yIHJvbGU6ICR7dXNlclJvbGV9YCk7XG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlcicsICdyZXNpZGVudCddLmluY2x1ZGVzKHVzZXJSb2xlKSkge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVFMgVVBMT0FEXSBJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgZm9yIHJvbGU6ICR7dXNlclJvbGV9YCk7XG4gICAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ1VOQVVUSE9SSVpFRF9VUExPQURfQVRURU1QVCcsIHVzZXIsIGZhbHNlLCB1bmRlZmluZWQsIHsgcmVxdWlyZWRSb2xlczogWydhZG1pbicsICdtYW5hZ2VyJywgJ3Jlc2lkZW50J10gfSk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gY3JlYXRlIGRvY3VtZW50cycgfSk7XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFtET0NVTUVOVFMgVVBMT0FEXSBQZXJtaXNzaW9uIGNoZWNrIHBhc3NlZCBmb3Igcm9sZTogJHt1c2VyUm9sZX1gKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIHRleHQtb25seSBkb2N1bWVudCwgZmlsZSB1cGxvYWQsIG9yIG1ldGFkYXRhLW9ubHkgZG9jdW1lbnRcbiAgICAgIGNvbnN0IGlzVGV4dERvY3VtZW50UmVjb3JkID0gIXJlcS5maWxlICYmIHRleHRDb250ZW50O1xuICAgICAgY29uc3QgaXNGaWxlRG9jdW1lbnRSZWNvcmQgPSAhIXJlcS5maWxlO1xuICAgICAgY29uc3QgaXNNZXRhZGF0YURvY3VtZW50UmVjb3JkID0gIXJlcS5maWxlICYmICF0ZXh0Q29udGVudCAmJiAob3RoZXJEYXRhLnRpdGxlIHx8IG90aGVyRGF0YS5uYW1lKTtcblxuICAgICAgY29uc29sZS5sb2coYPCfk4QgW0RPQ1VNRU5UUyBVUExPQURdIERvY3VtZW50IHR5cGUgZGV0ZXJtaW5hdGlvbjpgLCB7XG4gICAgICAgIGlzVGV4dERvY3VtZW50OiBpc1RleHREb2N1bWVudFJlY29yZCxcbiAgICAgICAgaXNGaWxlRG9jdW1lbnQ6IGlzRmlsZURvY3VtZW50UmVjb3JkLFxuICAgICAgICBpc01ldGFkYXRhRG9jdW1lbnQ6IGlzTWV0YWRhdGFEb2N1bWVudFJlY29yZCxcbiAgICAgICAgaGFzVGl0bGU6ICEhb3RoZXJEYXRhLnRpdGxlLFxuICAgICAgICBoYXNOYW1lOiAhIW90aGVyRGF0YS5uYW1lLFxuICAgICAgICBoYXNUZXh0Q29udGVudDogISF0ZXh0Q29udGVudFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghaXNUZXh0RG9jdW1lbnRSZWNvcmQgJiYgIWlzRmlsZURvY3VtZW50UmVjb3JkICYmICFpc01ldGFkYXRhRG9jdW1lbnRSZWNvcmQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlRTIFVQTE9BRF0gSW52YWxpZCBkb2N1bWVudCByZXF1ZXN0IC0gbm8gZmlsZSwgdGV4dCwgb3IgbWV0YWRhdGEgcHJvdmlkZWRgKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ0VpdGhlciBhIGZpbGUsIHRleHQgY29udGVudCwgb3IgZG9jdW1lbnQgdGl0bGUvbmFtZSBpcyByZXF1aXJlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZvciB0ZXh0IGRvY3VtZW50cywgY3JlYXRlIHVuaWZpZWQgZG9jdW1lbnQgZGlyZWN0bHlcbiAgICAgIGlmIChpc1RleHREb2N1bWVudFJlY29yZCkge1xuICAgICAgICAvLyBDcmVhdGUgdGV4dCBkb2N1bWVudCB3aXRob3V0IGZpbGUgc3RvcmFnZVxuICAgICAgICBjb25zdCBkb2N1bWVudERhdGE6IEluc2VydERvY3VtZW50ID0ge1xuICAgICAgICAgIG5hbWU6IG90aGVyRGF0YS5uYW1lIHx8ICdVbnRpdGxlZCBEb2N1bWVudFJlY29yZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IG90aGVyRGF0YS5kZXNjcmlwdGlvbiB8fCB0ZXh0Q29udGVudC5zdWJzdHJpbmcoMCwgMjAwKSArICh0ZXh0Q29udGVudC5sZW5ndGggPiAyMDAgPyAnLi4uJyA6ICcnKSxcbiAgICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50VHlwZSB8fCAnb3RoZXInLFxuICAgICAgICAgIGZpbGVQYXRoOiBgdGV4dC1kb2N1bWVudHMvJHt1c2VySWR9LyR7dXVpZHY0KCl9LnR4dGAsIC8vIFZpcnR1YWwgcGF0aCBmb3IgdGV4dCBkb2N1bWVudHNcbiAgICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IG90aGVyRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgPT09ICd0cnVlJyB8fCBvdGhlckRhdGEuaXNWaXNpYmxlVG9UZW5hbnRzID09PSB0cnVlLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiByZXNpZGVuY2VJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogYnVpbGRpbmdJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB1c2VySWQsXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gUGVybWlzc2lvbiBjaGVja3NcbiAgICAgICAgaWYgKGJ1aWxkaW5nSWQgJiYgdXNlclJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSBvcmdhbml6YXRpb25zLmxlbmd0aCA+IDAgPyBvcmdhbml6YXRpb25zWzBdLm9yZ2FuaXphdGlvbklkIDogdW5kZWZpbmVkO1xuICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZyhidWlsZGluZ0lkKTtcbiAgICAgICAgICBpZiAoIWJ1aWxkaW5nIHx8IGJ1aWxkaW5nLm9yZ2FuaXphdGlvbklkICE9PSBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhc3NpZ24gZG9jdW1lbnQgdG8gYnVpbGRpbmcgb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc2lkZW5jZUlkICYmIHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlclJlc2lkZW5jZXModXNlcklkKTtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2VJZHMgPSByZXNpZGVuY2VzLm1hcCgodXIpID0+IHVyLnJlc2lkZW5jZUlkKTtcbiAgICAgICAgICBpZiAoIXJlc2lkZW5jZUlkcy5pbmNsdWRlcyhyZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIHJlc2lkZW5jZSB5b3UgZG8gbm90IG93bicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIGRvY3VtZW50IHJlY29yZCB0eXBlIGZvciBkaXJlY3Rvcnkgc3RydWN0dXJlXG4gICAgICAgIGxldCBkb2N1bWVudFJlY29yZFR5cGU7XG4gICAgICAgIGlmIChidWlsZGluZ0lkICYmICFyZXNpZGVuY2VJZCkge1xuICAgICAgICAgIGRvY3VtZW50UmVjb3JkVHlwZSA9ICdidWlsZGluZyc7XG4gICAgICAgIH0gZWxzZSBpZiAocmVzaWRlbmNlSWQgJiYgIWJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBkb2N1bWVudFJlY29yZFR5cGUgPSAncmVzaWRlbnQnO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnTXVzdCBwcm92aWRlIGVpdGhlciBidWlsZGluZ0lkIChmb3IgYnVpbGRpbmcgZG9jdW1lbnRzKSBvciByZXNpZGVuY2VJZCAoZm9yIHJlc2lkZW50IGRvY3VtZW50cyknLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gU2F2ZSB0ZXh0IGNvbnRlbnQgdG8gbG9jYWwgZmlsZSBzeXN0ZW0gd2l0aCBwcm9wZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgICBsZXQgZmlsZU5hbWU6IHN0cmluZztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB0ZXh0RmlsZVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnLCBkb2N1bWVudFJlY29yZFR5cGUpO1xuICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyh0ZXh0RmlsZVBhdGgpKSB7XG4gICAgICAgICAgICBmcy5ta2RpclN5bmModGV4dEZpbGVQYXRoLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZmlsZU5hbWUgPSBgJHt1dWlkdjQoKX0tdGV4dC1kb2N1bWVudC50eHRgO1xuICAgICAgICAgIGNvbnN0IGZ1bGxQYXRoID0gcGF0aC5qb2luKHRleHRGaWxlUGF0aCwgZmlsZU5hbWUpO1xuICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZnVsbFBhdGgsIHRleHRDb250ZW50LCAndXRmOCcpO1xuICAgICAgICB9IGNhdGNoIChmc0Vycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3Igc2F2aW5nIHRleHQgZG9jdW1lbnQgdG8gZmlsZXN5c3RlbTonLCBmc0Vycm9yKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHNhdmUgdGV4dCBkb2N1bWVudCcgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSBmaWxlIHBhdGggdG8gbWF0Y2ggcmVndWxhciBkb2N1bWVudCB1cGxvYWRzXG4gICAgICAgIGRvY3VtZW50RGF0YS5maWxlUGF0aCA9IGAke2RvY3VtZW50UmVjb3JkVHlwZX0vJHtmaWxlTmFtZX1gO1xuXG4gICAgICAgIC8vIENyZWF0ZSBkb2N1bWVudCByZWNvcmQgaW4gZGF0YWJhc2VcbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZURvY3VtZW50KGRvY3VtZW50RGF0YSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdUZXh0IGRvY3VtZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICBkb2N1bWVudDoge1xuICAgICAgICAgICAgLi4uZG9jdW1lbnQsXG4gICAgICAgICAgICB0aXRsZTogZG9jdW1lbnQubmFtZSwgLy8gTWFwIG5hbWUgdG8gdGl0bGUgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIGNhdGVnb3J5OiBkb2N1bWVudC5kb2N1bWVudFR5cGUsIC8vIE1hcCBkb2N1bWVudFR5cGUgdG8gY2F0ZWdvcnkgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6IGJ1aWxkaW5nSWQgPyAnYnVpbGRpbmcnIDogJ3Jlc2lkZW50JyxcbiAgICAgICAgICAgIGVudGl0eVR5cGU6IGJ1aWxkaW5nSWQgPyAnYnVpbGRpbmcnIDogJ3Jlc2lkZW5jZScsXG4gICAgICAgICAgICBlbnRpdHlJZDogYnVpbGRpbmdJZCB8fCByZXNpZGVuY2VJZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIG1ldGFkYXRhLW9ubHkgZG9jdW1lbnRzIChjcmVhdGUgZG9jdW1lbnQgcmVjb3JkIHdpdGhvdXQgZmlsZSlcbiAgICAgIGlmIChpc01ldGFkYXRhRG9jdW1lbnRSZWNvcmQpIHtcbiAgICAgICAgLy8gTWFwIGZyb250ZW5kICd0aXRsZScgZmllbGQgdG8gZGF0YWJhc2UgJ25hbWUnIGZpZWxkIGFuZCAnY2F0ZWdvcnknIHRvICdkb2N1bWVudFR5cGUnXG4gICAgICAgIGNvbnN0IGRvY3VtZW50RGF0YTogSW5zZXJ0RG9jdW1lbnQgPSB7XG4gICAgICAgICAgbmFtZTogb3RoZXJEYXRhLnRpdGxlIHx8IG90aGVyRGF0YS5uYW1lIHx8ICdVbnRpdGxlZCBEb2N1bWVudCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IG90aGVyRGF0YS5kZXNjcmlwdGlvbiB8fCAnJyxcbiAgICAgICAgICBkb2N1bWVudFR5cGU6IG90aGVyRGF0YS5jYXRlZ29yeSB8fCBkb2N1bWVudFR5cGUgfHwgJ290aGVyJyxcbiAgICAgICAgICBmaWxlUGF0aDogYG1ldGFkYXRhLWRvY3VtZW50cy8ke3VzZXJJZH0vJHt1dWlkdjQoKX1gLCAvLyBQbGFjZWhvbGRlciBwYXRoIGZvciBtZXRhZGF0YS1vbmx5IGRvY3VtZW50c1xuICAgICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogb3RoZXJEYXRhLmlzVmlzaWJsZVRvVGVuYW50cyA9PT0gJ3RydWUnIHx8IG90aGVyRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgPT09IHRydWUgfHwgZmFsc2UsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHJlc2lkZW5jZUlkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBidWlsZGluZ0lkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICB1cGxvYWRlZEJ5SWQ6IHVzZXJJZCxcbiAgICAgICAgfTtcblxuICAgICAgICAvLyBWYWxpZGF0ZSBidWlsZGluZy9yZXNpZGVuY2UgcmVxdWlyZW1lbnRcbiAgICAgICAgaWYgKCFidWlsZGluZ0lkICYmICFyZXNpZGVuY2VJZCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnTXVzdCBwcm92aWRlIGVpdGhlciBidWlsZGluZ0lkIChmb3IgYnVpbGRpbmcgZG9jdW1lbnRzKSBvciByZXNpZGVuY2VJZCAoZm9yIHJlc2lkZW50IGRvY3VtZW50cyknLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGJ1aWxkaW5nSWQgJiYgcmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBwcm92aWRlIGJvdGggYnVpbGRpbmdJZCBhbmQgcmVzaWRlbmNlSWQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGVybWlzc2lvbiBjaGVja3NcbiAgICAgICAgaWYgKGJ1aWxkaW5nSWQgJiYgdXNlclJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSBvcmdhbml6YXRpb25zLmxlbmd0aCA+IDAgPyBvcmdhbml6YXRpb25zWzBdLm9yZ2FuaXphdGlvbklkIDogdW5kZWZpbmVkO1xuICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZyhidWlsZGluZ0lkKTtcbiAgICAgICAgICBpZiAoIWJ1aWxkaW5nIHx8IGJ1aWxkaW5nLm9yZ2FuaXphdGlvbklkICE9PSBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhc3NpZ24gZG9jdW1lbnQgdG8gYnVpbGRpbmcgb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHJlc2lkZW5jZUlkICYmIHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlclJlc2lkZW5jZXModXNlcklkKTtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2VJZHMgPSByZXNpZGVuY2VzLm1hcCgodXIpID0+IHVyLnJlc2lkZW5jZUlkKTtcbiAgICAgICAgICBpZiAoIXJlc2lkZW5jZUlkcy5pbmNsdWRlcyhyZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIHJlc2lkZW5jZSB5b3UgZG8gbm90IG93bicgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIGRvY3VtZW50IHJlY29yZCBpbiBkYXRhYmFzZVxuICAgICAgICBjb25zdCBkb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlRG9jdW1lbnQoZG9jdW1lbnREYXRhKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgICBkb2N1bWVudDoge1xuICAgICAgICAgICAgLi4uZG9jdW1lbnQsXG4gICAgICAgICAgICB0aXRsZTogZG9jdW1lbnQubmFtZSwgLy8gTWFwIG5hbWUgdG8gdGl0bGUgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIGNhdGVnb3J5OiBkb2N1bWVudC5kb2N1bWVudFR5cGUsIC8vIE1hcCBkb2N1bWVudFR5cGUgdG8gY2F0ZWdvcnkgZm9yIGZyb250ZW5kIGNvbXBhdGliaWxpdHlcbiAgICAgICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6IGJ1aWxkaW5nSWQgPyAnYnVpbGRpbmcnIDogJ3Jlc2lkZW50JyxcbiAgICAgICAgICAgIGVudGl0eVR5cGU6IGJ1aWxkaW5nSWQgPyAnYnVpbGRpbmcnIDogJ3Jlc2lkZW5jZScsXG4gICAgICAgICAgICBlbnRpdHlJZDogYnVpbGRpbmdJZCB8fCByZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIGZpbGVVcmw6IHVuZGVmaW5lZCwgLy8gTm8gZmlsZSBVUkwgZm9yIG1ldGFkYXRhLW9ubHkgZG9jdW1lbnRzXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSBmaWxlIHVwbG9hZHMgKGV4aXN0aW5nIGxvZ2ljKVxuICAgICAgY29uc29sZS5sb2coYPCfk4QgW0RPQ1VNRU5UUyBVUExPQURdIFN0YXJ0aW5nIGZpbGUgZG9jdW1lbnQgcHJvY2Vzc2luZ2ApO1xuICAgICAgXG4gICAgICAvLyBEZXRlcm1pbmUgZG9jdW1lbnQgcmVjb3JkIHR5cGUgYmFzZWQgb24gYnVpbGRpbmdJZC9yZXNpZGVuY2VJZCAobm90IGZyb20gZG9jdW1lbnRUeXBlIGZpZWxkKVxuICAgICAgbGV0IGZpbmFsRG9jdW1lbnRSZWNvcmRUeXBlO1xuICAgICAgaWYgKGJ1aWxkaW5nSWQgJiYgIXJlc2lkZW5jZUlkKSB7XG4gICAgICAgIGZpbmFsRG9jdW1lbnRSZWNvcmRUeXBlID0gJ2J1aWxkaW5nJztcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4QgW0RPQ1VNRU5UUyBVUExPQURdIERldGVybWluZWQgZG9jdW1lbnQgdHlwZTogQlVJTERJTkcgKElEOiAke2J1aWxkaW5nSWR9KWApO1xuICAgICAgfSBlbHNlIGlmIChyZXNpZGVuY2VJZCAmJiAhYnVpbGRpbmdJZCkge1xuICAgICAgICBmaW5hbERvY3VtZW50UmVjb3JkVHlwZSA9ICdyZXNpZGVudCc7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OEIFtET0NVTUVOVFMgVVBMT0FEXSBEZXRlcm1pbmVkIGRvY3VtZW50IHR5cGU6IFJFU0lERU5DRSAoSUQ6ICR7cmVzaWRlbmNlSWR9KWApO1xuICAgICAgfSBlbHNlIGlmIChidWlsZGluZ0lkICYmIHJlc2lkZW5jZUlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UUyBVUExPQURdIEJvdGggYnVpbGRpbmdJZCBhbmQgcmVzaWRlbmNlSWQgcHJvdmlkZWQ6ICR7YnVpbGRpbmdJZH0sICR7cmVzaWRlbmNlSWR9YCk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBwcm92aWRlIGJvdGggYnVpbGRpbmdJZCBhbmQgcmVzaWRlbmNlSWQnLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UUyBVUExPQURdIE5vIGJ1aWxkaW5nSWQgb3IgcmVzaWRlbmNlSWQgcHJvdmlkZWRgKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOlxuICAgICAgICAgICAgJ011c3QgcHJvdmlkZSBlaXRoZXIgYnVpbGRpbmdJZCAoZm9yIGJ1aWxkaW5nIGRvY3VtZW50cykgb3IgcmVzaWRlbmNlSWQgKGZvciByZXNpZGVudCBkb2N1bWVudHMpJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChmaW5hbERvY3VtZW50UmVjb3JkVHlwZSA9PT0gJ2J1aWxkaW5nJykge1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBQcm9jZXNzaW5nIGJ1aWxkaW5nIGRvY3VtZW50IGZvciBidWlsZGluZyBJRDogJHtidWlsZGluZ0lkfWApO1xuICAgICAgICBcbiAgICAgICAgLy8gVmFsaWRhdGUgYW5kIGNyZWF0ZSBidWlsZGluZyBkb2N1bWVudFxuICAgICAgICBpZiAoIWJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtCVUlMRElORyBVUExPQURdIE1pc3NpbmcgYnVpbGRpbmdJZGApO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdidWlsZGluZ0lkIGlzIHJlcXVpcmVkIGZvciBidWlsZGluZyBkb2N1bWVudHMnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgcGVybWFuZW50IGZpbGUgcGF0aCBhbmQgbW92ZSBmaWxlIGlmIG5lZWRlZFxuICAgICAgICBsZXQgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgICAgbGV0IGZpbGVOYW1lOiBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gICAgICAgIFxuICAgICAgICBpZiAocmVxLmZpbGUpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBQcm9jZXNzaW5nIGZpbGUgdXBsb2FkIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGVuYW1lIGFuZCBtb3ZlIHRvIHBlcm1hbmVudCBsb2NhdGlvblxuICAgICAgICAgIGZpbGVOYW1lID0gYCR7dXVpZHY0KCl9LSR7cmVxLmZpbGUub3JpZ2luYWxuYW1lfWA7XG4gICAgICAgICAgY29uc3QgcGVybWFuZW50RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgJ2J1aWxkaW5ncycsIGJ1aWxkaW5nSWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIEZpbGUgcGF0aHM6YCwge1xuICAgICAgICAgICAgb3JpZ2luYWxOYW1lOiByZXEuZmlsZS5vcmlnaW5hbG5hbWUsXG4gICAgICAgICAgICBuZXdGaWxlTmFtZTogZmlsZU5hbWUsXG4gICAgICAgICAgICB0ZW1wUGF0aDogcmVxLmZpbGUucGF0aCxcbiAgICAgICAgICAgIHBlcm1hbmVudERpcixcbiAgICAgICAgICAgIGRpcmVjdG9yeUV4aXN0czogZnMuZXhpc3RzU3luYyhwZXJtYW5lbnREaXIpXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRW5zdXJlIGRpcmVjdG9yeSBleGlzdHNcbiAgICAgICAgICBpZiAoIWZzLmV4aXN0c1N5bmMocGVybWFuZW50RGlyKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gQ3JlYXRpbmcgZGlyZWN0b3J5OiAke3Blcm1hbmVudERpcn1gKTtcbiAgICAgICAgICAgIGZzLm1rZGlyU3luYyhwZXJtYW5lbnREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBNb3ZlIGZpbGUgZnJvbSB0ZW1wb3JhcnkgdG8gcGVybWFuZW50IGxvY2F0aW9uIChjb3B5ICsgZGVsZXRlIGZvciBjcm9zcy1maWxlc3lzdGVtKVxuICAgICAgICAgIGNvbnN0IHBlcm1hbmVudFBhdGggPSBwYXRoLmpvaW4ocGVybWFuZW50RGlyLCBmaWxlTmFtZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gQ29weWluZyBmaWxlIGZyb20gJHtyZXEuZmlsZS5wYXRofSB0byAke3Blcm1hbmVudFBhdGh9YCk7XG4gICAgICAgICAgZnMuY29weUZpbGVTeW5jKHJlcS5maWxlLnBhdGgsIHBlcm1hbmVudFBhdGgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIENsZWFuaW5nIHVwIHRlbXBvcmFyeSBmaWxlOiAke3JlcS5maWxlLnBhdGh9YCk7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTsgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGVcbiAgICAgICAgICBmaWxlUGF0aCA9IGBidWlsZGluZ3MvJHtidWlsZGluZ0lkfS8ke2ZpbGVOYW1lfWA7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gRmlsZSBzdWNjZXNzZnVsbHkgbW92ZWQgdG86ICR7ZmlsZVBhdGh9YCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gTm8gZmlsZSBwcm92aWRlZCwgY3JlYXRpbmcgcGxhY2Vob2xkZXIgcGF0aGApO1xuICAgICAgICAgIGZpbGVQYXRoID0gYHRlbXAtcGF0aC0ke0RhdGUubm93KCl9YDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgZGF0YVRvVmFsaWRhdGUgPSB7XG4gICAgICAgICAgLi4ub3RoZXJEYXRhLFxuICAgICAgICAgIGJ1aWxkaW5nSWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB1c2VySWQsXG4gICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgZmlsZU5hbWUsXG4gICAgICAgICAgZmlsZVNpemU6IHJlcS5maWxlPy5zaXplLFxuICAgICAgICAgIG1pbWVUeXBlOiByZXEuZmlsZT8ubWltZXR5cGUsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudFR5cGUgfHwgdHlwZSB8fCAnb3RoZXInLCAvLyBEZWZhdWx0IHRvICdvdGhlcicgaWYgbm90IHByb3ZpZGVkXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBEYXRhIHRvIHZhbGlkYXRlOmAsIHtcbiAgICAgICAgICBidWlsZGluZ0lkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdXNlcklkLFxuICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgIGZpbGVOYW1lLFxuICAgICAgICAgIGZpbGVTaXplOiByZXEuZmlsZT8uc2l6ZSxcbiAgICAgICAgICBtaW1lVHlwZTogcmVxLmZpbGU/Lm1pbWV0eXBlLFxuICAgICAgICAgIGRvY3VtZW50VHlwZTogZG9jdW1lbnRUeXBlIHx8IHR5cGUgfHwgJ290aGVyJyxcbiAgICAgICAgICBvdGhlckRhdGFLZXlzOiBPYmplY3Qua2V5cyhvdGhlckRhdGEpXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbGV0IHZhbGlkYXRlZERhdGE7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFsaWRhdGVkRGF0YSA9IGluc2VydERvY3VtZW50U2NoZW1hLnBhcnNlKGRhdGFUb1ZhbGlkYXRlKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtCVUlMRElORyBVUExPQURdIERvY3VtZW50IHZhbGlkYXRpb24gc3VjY2Vzc2Z1bCBmb3IgYnVpbGRpbmcgJHtidWlsZGluZ0lkfWApO1xuICAgICAgICB9IGNhdGNoICh2YWxpZGF0aW9uRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtCVUlMRElORyBVUExPQURdIERvY3VtZW50IHZhbGlkYXRpb24gZmFpbGVkIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9OmAsIHZhbGlkYXRpb25FcnJvcik7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBmYWlsZWQnLCBcbiAgICAgICAgICAgIGVycm9yOiB2YWxpZGF0aW9uRXJyb3IubWVzc2FnZSB8fCAnSW52YWxpZCBkYXRhJyxcbiAgICAgICAgICAgIGRldGFpbHM6IHZhbGlkYXRpb25FcnJvci5pc3N1ZXMgfHwgdmFsaWRhdGlvbkVycm9yXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQZXJtaXNzaW9uIGNoZWNrcyBmb3IgYnVpbGRpbmcgZG9jdW1lbnRzXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIENoZWNraW5nIHBlcm1pc3Npb25zIGZvciByb2xlOiAke3VzZXJSb2xlfWApO1xuICAgICAgICBcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBNYW5hZ2VyIHBlcm1pc3Npb24gY2hlY2sgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gKTtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQpO1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID1cbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbnMubGVuZ3RoID4gMCA/IG9yZ2FuaXphdGlvbnNbMF0ub3JnYW5pemF0aW9uSWQgOiB1bmRlZmluZWQ7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6IgW0JVSUxESU5HIFVQTE9BRF0gTWFuYWdlciBvcmdhbml6YXRpb246ICR7b3JnYW5pemF0aW9uSWR9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5nKGJ1aWxkaW5nSWQpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+iIFtCVUlMRElORyBVUExPQURdIEJ1aWxkaW5nIG9yZ2FuaXphdGlvbjogJHtidWlsZGluZz8ub3JnYW5pemF0aW9uSWR9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCFidWlsZGluZyB8fCBidWlsZGluZy5vcmdhbml6YXRpb25JZCAhPT0gb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0JVSUxESU5HIFVQTE9BRF0gTWFuYWdlciBwZXJtaXNzaW9uIGRlbmllZCAtIG9yZ2FuaXphdGlvbiBtaXNtYXRjaGApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAgICAgICAuc3RhdHVzKDQwMylcbiAgICAgICAgICAgICAgLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGFzc2lnbiBkb2N1bWVudCB0byBidWlsZGluZyBvdXRzaWRlIHlvdXIgb3JnYW5pemF0aW9uJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc29sZS5sb2coYOKchSBbQlVJTERJTkcgVVBMT0FEXSBNYW5hZ2VyIHBlcm1pc3Npb24gY2hlY2sgcGFzc2VkYCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdyZXNpZGVudCcpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBSZXNpZGVudCBwZXJtaXNzaW9uIGNoZWNrIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YCk7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlclJlc2lkZW5jZXModXNlcklkKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBVc2VyIHJlc2lkZW5jZXMgY291bnQ6ICR7cmVzaWRlbmNlcy5sZW5ndGh9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgaGFzUmVzaWRlbmNlSW5CdWlsZGluZyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgICAgcmVzaWRlbmNlcy5tYXAoYXN5bmMgKHVyKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZSA9IGF3YWl0IHN0b3JhZ2UuZ2V0UmVzaWRlbmNlKHVyLnJlc2lkZW5jZUlkKTtcbiAgICAgICAgICAgICAgY29uc3QgaXNJbkJ1aWxkaW5nID0gcmVzaWRlbmNlICYmIHJlc2lkZW5jZS5idWlsZGluZ0lkID09PSBidWlsZGluZ0lkO1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBSZXNpZGVuY2UgJHt1ci5yZXNpZGVuY2VJZH0gaW4gYnVpbGRpbmcgJHtidWlsZGluZ0lkfTogJHtpc0luQnVpbGRpbmd9YCk7XG4gICAgICAgICAgICAgIHJldHVybiBpc0luQnVpbGRpbmc7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAoIWhhc1Jlc2lkZW5jZUluQnVpbGRpbmcuc29tZShCb29sZWFuKSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYOKdjCBbQlVJTERJTkcgVVBMT0FEXSBSZXNpZGVudCBwZXJtaXNzaW9uIGRlbmllZCAtIG5vIHJlc2lkZW5jZSBpbiBidWlsZGluZ2ApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAgICAgICAuc3RhdHVzKDQwMylcbiAgICAgICAgICAgICAgLmpzb24oeyBtZXNzYWdlOiAnQ2Fubm90IGFzc2lnbiBkb2N1bWVudCB0byBidWlsZGluZyB3aGVyZSB5b3UgaGF2ZSBubyByZXNpZGVuY2UnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtCVUlMRElORyBVUExPQURdIFJlc2lkZW50IHBlcm1pc3Npb24gY2hlY2sgcGFzc2VkYCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDcmVhdGUgdW5pZmllZCBkb2N1bWVudCBpbnN0ZWFkIG9mIHNlcGFyYXRlIGJ1aWxkaW5nIGRvY3VtZW50XG4gICAgICAgIGNvbnN0IHVuaWZpZWREb2N1bWVudDogSW5zZXJ0RG9jdW1lbnQgPSB7XG4gICAgICAgICAgbmFtZTogdmFsaWRhdGVkRGF0YS5uYW1lIHx8ICdVbnRpdGxlZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiB2YWxpZGF0ZWREYXRhLmRvY3VtZW50VHlwZSxcbiAgICAgICAgICBmaWxlUGF0aDogdmFsaWRhdGVkRGF0YS5maWxlUGF0aCB8fCBgdGVtcC1wYXRoLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogdmFsaWRhdGVkRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgfHwgZmFsc2UsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiB2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB2YWxpZGF0ZWREYXRhLnVwbG9hZGVkQnlJZCxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoiBbQlVJTERJTkcgVVBMT0FEXSBDcmVhdGluZyBkb2N1bWVudCBpbiBkYXRhYmFzZTpgLCB7XG4gICAgICAgICAgbmFtZTogdW5pZmllZERvY3VtZW50Lm5hbWUsXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiB1bmlmaWVkRG9jdW1lbnQuZG9jdW1lbnRUeXBlLFxuICAgICAgICAgIGZpbGVQYXRoOiB1bmlmaWVkRG9jdW1lbnQuZmlsZVBhdGgsXG4gICAgICAgICAgYnVpbGRpbmdJZDogdW5pZmllZERvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgICAgdXBsb2FkZWRCeUlkOiB1bmlmaWVkRG9jdW1lbnQudXBsb2FkZWRCeUlkXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGRvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS5jcmVhdGVEb2N1bWVudCh1bmlmaWVkRG9jdW1lbnQpO1xuICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFtCVUlMRElORyBVUExPQURdIERvY3VtZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IHdpdGggSUQ6ICR7ZG9jdW1lbnQuaWR9YCk7XG5cbiAgICAgICAgLy8gRmlsZSBoYXMgYmVlbiBtb3ZlZCB0byBwZXJtYW5lbnQgbG9jYXRpb24sIG5vIGNsZWFudXAgbmVlZGVkXG5cbiAgICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICAgIC4uLmRvY3VtZW50LFxuICAgICAgICAgIGRvY3VtZW50Q2F0ZWdvcnk6ICdidWlsZGluZycsXG4gICAgICAgICAgZW50aXR5VHlwZTogJ2J1aWxkaW5nJyxcbiAgICAgICAgICBlbnRpdHlJZDogZG9jdW1lbnQuYnVpbGRpbmdJZCxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKGZpbmFsRG9jdW1lbnRSZWNvcmRUeXBlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn4+gIFtSRVNJREVOQ0UgVVBMT0FEXSBQcm9jZXNzaW5nIHJlc2lkZW5jZSBkb2N1bWVudCBmb3IgcmVzaWRlbmNlIElEOiAke3Jlc2lkZW5jZUlkfWApO1xuICAgICAgICBcbiAgICAgICAgLy8gVmFsaWRhdGUgYW5kIGNyZWF0ZSByZXNpZGVudCBkb2N1bWVudFxuICAgICAgICBpZiAoIXJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKdjCBbUkVTSURFTkNFIFVQTE9BRF0gTWlzc2luZyByZXNpZGVuY2VJZGApO1xuICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgIC5zdGF0dXMoNDAwKVxuICAgICAgICAgICAgLmpzb24oeyBtZXNzYWdlOiAncmVzaWRlbmNlSWQgaXMgcmVxdWlyZWQgZm9yIHJlc2lkZW50IGRvY3VtZW50cycgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBwZXJtYW5lbnQgZmlsZSBwYXRoIGFuZCBtb3ZlIGZpbGUgaWYgbmVlZGVkXG4gICAgICAgIGxldCBmaWxlUGF0aDogc3RyaW5nO1xuICAgICAgICBsZXQgZmlsZU5hbWU6IHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgICAgICAgXG4gICAgICAgIGlmIChyZXEuZmlsZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+gIFtSRVNJREVOQ0UgVVBMT0FEXSBQcm9jZXNzaW5nIGZpbGUgdXBsb2FkIGZvciByZXNpZGVuY2UgJHtyZXNpZGVuY2VJZH1gKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgZmlsZW5hbWUgYW5kIG1vdmUgdG8gcGVybWFuZW50IGxvY2F0aW9uXG4gICAgICAgICAgZmlsZU5hbWUgPSBgJHt1dWlkdjQoKX0tJHtyZXEuZmlsZS5vcmlnaW5hbG5hbWV9YDtcbiAgICAgICAgICBjb25zdCBwZXJtYW5lbnREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3VwbG9hZHMnLCAncmVzaWRlbmNlcycsIHJlc2lkZW5jZUlkKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gRmlsZSBwYXRoczpgLCB7XG4gICAgICAgICAgICBvcmlnaW5hbE5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICAgIG5ld0ZpbGVOYW1lOiBmaWxlTmFtZSxcbiAgICAgICAgICAgIHRlbXBQYXRoOiByZXEuZmlsZS5wYXRoLFxuICAgICAgICAgICAgcGVybWFuZW50RGlyLFxuICAgICAgICAgICAgZGlyZWN0b3J5RXhpc3RzOiBmcy5leGlzdHNTeW5jKHBlcm1hbmVudERpcilcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBFbnN1cmUgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhwZXJtYW5lbnREaXIpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gQ3JlYXRpbmcgZGlyZWN0b3J5OiAke3Blcm1hbmVudERpcn1gKTtcbiAgICAgICAgICAgIGZzLm1rZGlyU3luYyhwZXJtYW5lbnREaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICAvLyBNb3ZlIGZpbGUgZnJvbSB0ZW1wb3JhcnkgdG8gcGVybWFuZW50IGxvY2F0aW9uIChjb3B5ICsgZGVsZXRlIGZvciBjcm9zcy1maWxlc3lzdGVtKVxuICAgICAgICAgIGNvbnN0IHBlcm1hbmVudFBhdGggPSBwYXRoLmpvaW4ocGVybWFuZW50RGlyLCBmaWxlTmFtZSk7XG4gICAgICAgICAgY29uc29sZS5sb2coYPCfj6AgW1JFU0lERU5DRSBVUExPQURdIENvcHlpbmcgZmlsZSBmcm9tICR7cmVxLmZpbGUucGF0aH0gdG8gJHtwZXJtYW5lbnRQYXRofWApO1xuICAgICAgICAgIGZzLmNvcHlGaWxlU3luYyhyZXEuZmlsZS5wYXRoLCBwZXJtYW5lbnRQYXRoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gQ2xlYW5pbmcgdXAgdGVtcG9yYXJ5IGZpbGU6ICR7cmVxLmZpbGUucGF0aH1gKTtcbiAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpOyAvLyBDbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZVxuICAgICAgICAgIGZpbGVQYXRoID0gYHJlc2lkZW5jZXMvJHtyZXNpZGVuY2VJZH0vJHtmaWxlTmFtZX1gO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn4+gIFtSRVNJREVOQ0UgVVBMT0FEXSBGaWxlIHN1Y2Nlc3NmdWxseSBtb3ZlZCB0bzogJHtmaWxlUGF0aH1gKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBbUkVTSURFTkNFIFVQTE9BRF0gTm8gZmlsZSBwcm92aWRlZCwgY3JlYXRpbmcgcGxhY2Vob2xkZXIgcGF0aGApO1xuICAgICAgICAgIGZpbGVQYXRoID0gYHRlbXAtcGF0aC0ke0RhdGUubm93KCl9YDtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRhdGFUb1ZhbGlkYXRlID0ge1xuICAgICAgICAgIC4uLm90aGVyRGF0YSxcbiAgICAgICAgICByZXNpZGVuY2VJZCxcbiAgICAgICAgICB1cGxvYWRlZEJ5SWQ6IHVzZXJJZCxcbiAgICAgICAgICBmaWxlUGF0aCxcbiAgICAgICAgICBmaWxlTmFtZSxcbiAgICAgICAgICBmaWxlU2l6ZTogcmVxLmZpbGU/LnNpemUsXG4gICAgICAgICAgbWltZVR5cGU6IHJlcS5maWxlPy5taW1ldHlwZSxcbiAgICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50VHlwZSB8fCB0eXBlIHx8ICdvdGhlcicsIC8vIERlZmF1bHQgdG8gJ290aGVyJyBpZiBub3QgcHJvdmlkZWRcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFJlc2lkZW5jZSBkb2N1bWVudCB2YWxpZGF0aW9uIGRlYnVnOicsIHtcbiAgICAgICAgICBkYXRhVG9WYWxpZGF0ZSxcbiAgICAgICAgICBkb2N1bWVudFR5cGUsXG4gICAgICAgICAgb3RoZXJEYXRhS2V5czogT2JqZWN0LmtleXMob3RoZXJEYXRhKSxcbiAgICAgICAgICBoYXNGaWxlOiAhIXJlcS5maWxlXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgbGV0IHZhbGlkYXRlZERhdGE7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdmFsaWRhdGVkRGF0YSA9IGluc2VydERvY3VtZW50U2NoZW1hLnBhcnNlKGRhdGFUb1ZhbGlkYXRlKTtcbiAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFJlc2lkZW5jZSBkb2N1bWVudCB2YWxpZGF0aW9uIFNVQ0NFU1MnKTtcbiAgICAgICAgfSBjYXRjaCAodmFsaWRhdGlvbkVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KdjCBSZXNpZGVuY2UgZG9jdW1lbnQgdmFsaWRhdGlvbiBFUlJPUjonLCB2YWxpZGF0aW9uRXJyb3IpO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZmFpbGVkJywgXG4gICAgICAgICAgICBlcnJvcjogdmFsaWRhdGlvbkVycm9yLm1lc3NhZ2UgfHwgJ0ludmFsaWQgZGF0YScsXG4gICAgICAgICAgICBkZXRhaWxzOiB2YWxpZGF0aW9uRXJyb3IuaXNzdWVzIHx8IHZhbGlkYXRpb25FcnJvclxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUGVybWlzc2lvbiBjaGVja3MgZm9yIHJlc2lkZW50IGRvY3VtZW50c1xuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPVxuICAgICAgICAgICAgb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2UgPSBhd2FpdCBzdG9yYWdlLmdldFJlc2lkZW5jZShyZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKHJlc2lkZW5jZSkge1xuICAgICAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5nKHJlc2lkZW5jZS5idWlsZGluZ0lkKTtcbiAgICAgICAgICAgIGlmICghYnVpbGRpbmcgfHwgYnVpbGRpbmcub3JnYW5pemF0aW9uSWQgIT09IG9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgICAgICAuc3RhdHVzKDQwMylcbiAgICAgICAgICAgICAgICAuanNvbih7IG1lc3NhZ2U6ICdDYW5ub3QgYXNzaWduIGRvY3VtZW50IHRvIHJlc2lkZW5jZSBvdXRzaWRlIHlvdXIgb3JnYW5pemF0aW9uJyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ1Jlc2lkZW5jZSBub3QgZm91bmQnIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gcmVzaWRlbmNlcy5tYXAoKHVyKSA9PiB1ci5yZXNpZGVuY2VJZCk7XG5cbiAgICAgICAgICBpZiAoIXJlc2lkZW5jZUlkcy5pbmNsdWRlcyhyZXNpZGVuY2VJZCkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXNcbiAgICAgICAgICAgICAgLnN0YXR1cyg0MDMpXG4gICAgICAgICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ0Nhbm5vdCBhc3NpZ24gZG9jdW1lbnQgdG8gcmVzaWRlbmNlIHlvdSBkbyBub3Qgb3duJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDb252ZXJ0IHRvIHVuaWZpZWQgZG9jdW1lbnQgZm9ybWF0XG4gICAgICAgIGNvbnN0IHVuaWZpZWREb2N1bWVudDogSW5zZXJ0RG9jdW1lbnQgPSB7XG4gICAgICAgICAgbmFtZTogdmFsaWRhdGVkRGF0YS5uYW1lIHx8ICdVbnRpdGxlZCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246IHZhbGlkYXRlZERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgZG9jdW1lbnRUeXBlOiB2YWxpZGF0ZWREYXRhLmRvY3VtZW50VHlwZSxcbiAgICAgICAgICBmaWxlUGF0aDogdmFsaWRhdGVkRGF0YS5maWxlUGF0aCB8fCBgdGVtcC1wYXRoLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogdmFsaWRhdGVkRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgfHwgZmFsc2UsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHZhbGlkYXRlZERhdGEucmVzaWRlbmNlSWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogdW5kZWZpbmVkLFxuICAgICAgICAgIHVwbG9hZGVkQnlJZDogdmFsaWRhdGVkRGF0YS51cGxvYWRlZEJ5SWQsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgZG9jdW1lbnQgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZURvY3VtZW50KHVuaWZpZWREb2N1bWVudCkgO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5OdIENyZWF0ZWQgcmVzaWRlbnQgZG9jdW1lbnQ6JywgZG9jdW1lbnQpO1xuICAgICAgICBjb25zb2xlLmxvZygn8J+TnSBEb2N1bWVudFJlY29yZCBJRDonLCBkb2N1bWVudC5pZCk7XG5cbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSB7XG4gICAgICAgICAgLi4uZG9jdW1lbnQsXG4gICAgICAgICAgZG9jdW1lbnRDYXRlZ29yeTogJ3Jlc2lkZW50JyxcbiAgICAgICAgICBlbnRpdHlUeXBlOiAncmVzaWRlbmNlJyxcbiAgICAgICAgICBlbnRpdHlJZDogZG9jdW1lbnQucmVzaWRlbmNlSWQsXG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc29sZS5sb2coJ/Cfk6QgU2VuZGluZyByZXNwb25zZTonLCByZXNwb25zZSk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHJlc3BvbnNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgZG9jdW1lbnRUeXBlLiBNdXN0IGJlIGVpdGhlciBcXFwiYnVpbGRpbmdcXFwiIG9yIFxcXCJyZXNpZGVudFxcXCInLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGUgb24gZXJyb3JcbiAgICAgIGlmIChyZXEuZmlsZT8ucGF0aCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGZzLnVubGlua1N5bmMocmVxLmZpbGUucGF0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBjbGVhbnVwIHRlbXBvcmFyeSBmaWxlOicsIGNsZWFudXBFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIGRvY3VtZW50OicsIF9lcnJvcik7XG4gICAgICBcbiAgICAgIGlmIChfZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgZG9jdW1lbnQgZGF0YScsXG4gICAgICAgICAgZXJyb3JzOiBfZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBkb2N1bWVudCcgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBVcGRhdGUgYSBkb2N1bWVudFxuICBhcHAucHV0KCcvYXBpL2RvY3VtZW50cy86aWQnLCByZXF1aXJlQXV0aCwgdXBsb2FkLnNpbmdsZSgnZmlsZScpLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OdIFtET0NVTUVOVCBVUERBVEVdIFN0YXJ0aW5nIHVwZGF0ZSBmb3IgZG9jdW1lbnQgSUQ6ICR7cmVxLnBhcmFtcy5pZH1gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBVc2VyOiAke3JlcS51c2VyLmlkfSAoJHtyZXEudXNlci5yb2xlfSlgKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBCb2R5OmAsIHJlcS5ib2R5KTtcbiAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBGaWxlIHByb3ZpZGVkOmAsICEhcmVxLmZpbGUpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICBjb25zdCB1c2VyUm9sZSA9IHVzZXIucm9sZTtcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHVzZXIuaWQ7XG4gICAgICBjb25zdCBkb2N1bWVudElkID0gcmVxLnBhcmFtcy5pZDtcblxuICAgICAgLy8gR2V0IGV4aXN0aW5nIGRvY3VtZW50IGZpcnN0IHRvIGNoZWNrIHBlcm1pc3Npb25zIGFuZCBnZXQgY3VycmVudCBmaWxlIHBhdGhcbiAgICAgIGNvbnN0IGV4aXN0aW5nRG9jdW1lbnQgPSBhd2FpdCBzdG9yYWdlLmdldERvY3VtZW50cyh7IGRvY3VtZW50SWQgfSkudGhlbihkb2NzID0+IGRvY3NbMF0pO1xuICAgICAgXG4gICAgICBpZiAoIWV4aXN0aW5nRG9jdW1lbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlQgVVBEQVRFXSBEb2N1bWVudCBub3QgZm91bmQ6ICR7ZG9jdW1lbnRJZH1gKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0RvY3VtZW50IG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn5OdIFtET0NVTUVOVCBVUERBVEVdIEV4aXN0aW5nIGRvY3VtZW50OmAsIHtcbiAgICAgICAgaWQ6IGV4aXN0aW5nRG9jdW1lbnQuaWQsXG4gICAgICAgIG5hbWU6IGV4aXN0aW5nRG9jdW1lbnQubmFtZSxcbiAgICAgICAgZmlsZVBhdGg6IGV4aXN0aW5nRG9jdW1lbnQuZmlsZVBhdGgsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IGV4aXN0aW5nRG9jdW1lbnQucmVzaWRlbmNlSWRcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDaGVjayBwZXJtaXNzaW9ucyAoc2ltaWxhciB0byB2aWV3IHBlcm1pc3Npb25zKVxuICAgICAgbGV0IGhhc0FjY2VzcyA9IGZhbHNlO1xuICAgICAgaWYgKHVzZXJSb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgW0RPQ1VNRU5UIFVQREFURV0gQWRtaW4gYWNjZXNzIGdyYW50ZWRgKTtcbiAgICAgIH0gZWxzZSBpZiAodXNlclJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAvLyBNYW5hZ2VyIHNob3VsZCBoYXZlIGFjY2VzcyB0byBkb2N1bWVudHMgaW4gdGhlaXIgb3JnYW5pemF0aW9uXG4gICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICAgIGNvbnN0IGJ1aWxkaW5ncyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmdzKCk7XG4gICAgICAgIGNvbnN0IHVzZXJPcmdhbml6YXRpb25zID0gb3JnYW5pemF0aW9ucy5tYXAob3JnID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoZXhpc3RpbmdEb2N1bWVudC5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgY29uc3Qgb3JnQnVpbGRpbmdzID0gYnVpbGRpbmdzLmZpbHRlcihidWlsZGluZyA9PiBcbiAgICAgICAgICAgIHVzZXJPcmdhbml6YXRpb25zLmluY2x1ZGVzKGJ1aWxkaW5nLm9yZ2FuaXphdGlvbklkIHx8ICcnKVxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3Qgb3JnQnVpbGRpbmdJZHMgPSBvcmdCdWlsZGluZ3MubWFwKGIgPT4gYi5pZCk7XG4gICAgICAgICAgaGFzQWNjZXNzID0gb3JnQnVpbGRpbmdJZHMuaW5jbHVkZXMoZXhpc3RpbmdEb2N1bWVudC5idWlsZGluZ0lkKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhg8J+TnSBbRE9DVU1FTlQgVVBEQVRFXSBNYW5hZ2VyIGFjY2VzczogJHtoYXNBY2Nlc3N9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIFVQREFURV0gQWNjZXNzIGRlbmllZCBmb3IgdXNlciAke3VzZXJJZH1gKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBQcmVwYXJlIHVwZGF0ZSBkYXRhXG4gICAgICBjb25zdCB1cGRhdGVEYXRhOiBhbnkgPSB7fTtcbiAgICAgIFxuICAgICAgaWYgKHJlcS5ib2R5Lm5hbWUpIHVwZGF0ZURhdGEubmFtZSA9IHJlcS5ib2R5Lm5hbWU7XG4gICAgICBpZiAocmVxLmJvZHkuZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZCkgdXBkYXRlRGF0YS5kZXNjcmlwdGlvbiA9IHJlcS5ib2R5LmRlc2NyaXB0aW9uO1xuICAgICAgaWYgKHJlcS5ib2R5LmRvY3VtZW50VHlwZSkgdXBkYXRlRGF0YS5kb2N1bWVudFR5cGUgPSByZXEuYm9keS5kb2N1bWVudFR5cGU7XG4gICAgICBpZiAocmVxLmJvZHkuaXNWaXNpYmxlVG9UZW5hbnRzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5pc1Zpc2libGVUb1RlbmFudHMgPSByZXEuYm9keS5pc1Zpc2libGVUb1RlbmFudHMgPT09ICd0cnVlJztcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gVXBkYXRlIGRhdGE6YCwgdXBkYXRlRGF0YSk7XG5cbiAgICAgIC8vIEhhbmRsZSBmaWxlIHJlcGxhY2VtZW50IGlmIHByb3ZpZGVkXG4gICAgICBpZiAocmVxLmZpbGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk50gW0RPQ1VNRU5UIFVQREFURV0gUHJvY2Vzc2luZyBmaWxlIHJlcGxhY2VtZW50OmAsIHtcbiAgICAgICAgICBvcmlnaW5hbG5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICBzaXplOiByZXEuZmlsZS5zaXplLFxuICAgICAgICAgIG1pbWV0eXBlOiByZXEuZmlsZS5taW1ldHlwZSxcbiAgICAgICAgICB0ZW1wUGF0aDogcmVxLmZpbGUucGF0aFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBWYWxpZGF0ZSB0aGUgZmlsZVxuICAgICAgICBjb25zdCBmaWxlVmFsaWRhdGlvbiA9IHZhbGlkYXRlRmlsZShyZXEuZmlsZSk7XG4gICAgICAgIGlmICghZmlsZVZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICAgIC8vIENsZWFuIHVwIHRlbXAgZmlsZVxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gRmFpbGVkIHRvIGNsZWFudXAgdGVtcCBmaWxlOicsIGNsZWFudXBFcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6IGZpbGVWYWxpZGF0aW9uLmVycm9yIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIGZpbGUgcGF0aFxuICAgICAgICBjb25zdCBmaWxlRXh0ZW5zaW9uID0gcGF0aC5leHRuYW1lKHJlcS5maWxlLm9yaWdpbmFsbmFtZSk7XG4gICAgICAgIGNvbnN0IGJhc2VGaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUocmVxLmZpbGUub3JpZ2luYWxuYW1lLCBmaWxlRXh0ZW5zaW9uKTtcbiAgICAgICAgY29uc3QgdW5pcXVlSWQgPSBjcnlwdG8ucmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcbiAgICAgICAgY29uc3QgZW50aXR5VHlwZSA9IGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCA/ICdidWlsZGluZ3MnIDogJ3Jlc2lkZW5jZXMnO1xuICAgICAgICBjb25zdCBlbnRpdHlJZCA9IGV4aXN0aW5nRG9jdW1lbnQuYnVpbGRpbmdJZCB8fCBleGlzdGluZ0RvY3VtZW50LnJlc2lkZW5jZUlkO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgZG9jdW1lbnRzRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgZW50aXR5VHlwZSwgZW50aXR5SWQgfHwgJ2dlbmVyYWwnKTtcbiAgICAgICAgY29uc3QgdW5pcXVlRmlsZU5hbWUgPSBgJHt1bmlxdWVJZH0tJHtiYXNlRmlsZU5hbWV9JHtmaWxlRXh0ZW5zaW9ufWA7XG4gICAgICAgIGNvbnN0IGZpbmFsUGF0aCA9IHBhdGguam9pbihkb2N1bWVudHNEaXIsIHVuaXF1ZUZpbGVOYW1lKTtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5qb2luKGVudGl0eVR5cGUsIGVudGl0eUlkIHx8ICdnZW5lcmFsJywgdW5pcXVlRmlsZU5hbWUpO1xuXG4gICAgICAgIC8vIEVuc3VyZSBkaXJlY3RvcnkgZXhpc3RzXG4gICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhkb2N1bWVudHNEaXIpKSB7XG4gICAgICAgICAgZnMubWtkaXJTeW5jKGRvY3VtZW50c0RpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBNb3ZlIGZpbGUgZnJvbSB0ZW1wIHRvIGZpbmFsIGxvY2F0aW9uXG4gICAgICAgIGZzLnJlbmFtZVN5bmMocmVxLmZpbGUucGF0aCwgZmluYWxQYXRoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFVwZGF0ZSBmaWxlLXJlbGF0ZWQgZmllbGRzXG4gICAgICAgIHVwZGF0ZURhdGEuZmlsZVBhdGggPSByZWxhdGl2ZVBhdGg7XG4gICAgICAgIHVwZGF0ZURhdGEuZmlsZU5hbWUgPSByZXEuZmlsZS5vcmlnaW5hbG5hbWU7XG4gICAgICAgIHVwZGF0ZURhdGEuZmlsZVNpemUgPSByZXEuZmlsZS5zaXplO1xuICAgICAgICB1cGRhdGVEYXRhLm1pbWVUeXBlID0gcmVxLmZpbGUubWltZXR5cGU7XG5cbiAgICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlQgVVBEQVRFXSBGaWxlIHN0b3JlZCBhdDogJHtmaW5hbFBhdGh9YCk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgb2xkIGZpbGUgaWYgaXQgZXhpc3RzXG4gICAgICAgIGlmIChleGlzdGluZ0RvY3VtZW50LmZpbGVQYXRoKSB7XG4gICAgICAgICAgY29uc3Qgb2xkRmlsZVBhdGggPSBwYXRoLmlzQWJzb2x1dGUoZXhpc3RpbmdEb2N1bWVudC5maWxlUGF0aCkgXG4gICAgICAgICAgICA/IGV4aXN0aW5nRG9jdW1lbnQuZmlsZVBhdGggXG4gICAgICAgICAgICA6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycsIGV4aXN0aW5nRG9jdW1lbnQuZmlsZVBhdGgpO1xuICAgICAgICAgIFxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhvbGRGaWxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhvbGRGaWxlUGF0aCk7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5eR77iPIFtET0NVTUVOVCBVUERBVEVdIENsZWFuZWQgdXAgb2xkIGZpbGU6ICR7b2xkRmlsZVBhdGh9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoY2xlYW51cEVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBGYWlsZWQgdG8gY2xlYW51cCBvbGQgZmlsZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgdGhlIGRvY3VtZW50XG4gICAgICBjb25zdCB1cGRhdGVkRG9jdW1lbnQgPSBhd2FpdCBzdG9yYWdlLnVwZGF0ZURvY3VtZW50KGRvY3VtZW50SWQsIHVwZGF0ZURhdGEpO1xuXG4gICAgICBpZiAoIXVwZGF0ZWREb2N1bWVudCkge1xuICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVCBVUERBVEVdIEZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQ6ICR7ZG9jdW1lbnRJZH1gKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIFtET0NVTUVOVCBVUERBVEVdIERvY3VtZW50IHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5OmAsIHtcbiAgICAgICAgaWQ6ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5pZCxcbiAgICAgICAgbmFtZTogKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLm5hbWVcbiAgICAgIH0pO1xuXG4gICAgICAvLyBBZGQgY29tcGF0aWJpbGl0eSBmaWVsZHMgZm9yIGZyb250ZW5kXG4gICAgICAodXBkYXRlZERvY3VtZW50IGFzIGFueSkuZG9jdW1lbnRDYXRlZ29yeSA9ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVudCc7XG4gICAgICAodXBkYXRlZERvY3VtZW50IGFzIGFueSkuZW50aXR5VHlwZSA9ICh1cGRhdGVkRG9jdW1lbnQgYXMgYW55KS5idWlsZGluZ0lkID8gJ2J1aWxkaW5nJyA6ICdyZXNpZGVuY2UnO1xuICAgICAgKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLmVudGl0eUlkID0gKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLmJ1aWxkaW5nSWQgfHwgKHVwZGF0ZWREb2N1bWVudCBhcyBhbnkpLnJlc2lkZW5jZUlkO1xuXG4gICAgICByZXMuanNvbih1cGRhdGVkRG9jdW1lbnQpO1xuICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICAvLyBDbGVhbiB1cCB0ZW1wb3JhcnkgZmlsZSBvbiBlcnJvclxuICAgICAgaWYgKHJlcS5maWxlPy5wYXRoKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+Xke+4jyBbRE9DVU1FTlQgVVBEQVRFXSBDbGVhbmVkIHVwIHRlbXAgZmlsZSBvbiBlcnJvcjogJHtyZXEuZmlsZS5wYXRofWApO1xuICAgICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBGYWlsZWQgdG8gY2xlYW51cCB0ZW1wb3JhcnkgZmlsZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBkb2N1bWVudDonLCBfZXJyb3IpO1xuICAgICAgXG4gICAgICBpZiAoX2Vycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIGRvY3VtZW50IGRhdGEnLFxuICAgICAgICAgIGVycm9yczogX2Vycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgZG9jdW1lbnQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gU2VjdXJpdHkgYXVkaXQgZW5kcG9pbnQgLSBhZG1pbiBvbmx5XG4gIGFwcC5nZXQoJy9hcGkvZG9jdW1lbnRzL3NlY3VyaXR5L2F1ZGl0LWxvZycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICBcbiAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBhY2Nlc3MgYXVkaXQgbG9nc1xuICAgICAgaWYgKHVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICBsb2dTZWN1cml0eUV2ZW50KCdVTkFVVEhPUklaRURfQVVESVRfQUNDRVNTJywgdXNlciwgZmFsc2UpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZC4gQWRtaW4gcHJpdmlsZWdlcyByZXF1aXJlZC4nIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBHZXQgbGFzdCAxMDAgYXVkaXQgZXZlbnRzIHdpdGggcGFnaW5hdGlvbiBzdXBwb3J0XG4gICAgICBjb25zdCBsaW1pdCA9IE1hdGgubWluKHBhcnNlSW50KHJlcS5xdWVyeS5saW1pdCBhcyBzdHJpbmcpIHx8IDUwLCAxMDApO1xuICAgICAgY29uc3Qgb2Zmc2V0ID0gcGFyc2VJbnQocmVxLnF1ZXJ5Lm9mZnNldCBhcyBzdHJpbmcpIHx8IDA7XG4gICAgICBcbiAgICAgIGNvbnN0IHBhZ2luYXRlZExvZ3MgPSBhdWRpdExvZy5zbGljZShvZmZzZXQsIG9mZnNldCArIGxpbWl0KTtcbiAgICAgIFxuICAgICAgbG9nU2VjdXJpdHlFdmVudCgnQVVESVRfTE9HX0FDQ0VTUycsIHVzZXIsIHRydWUsIHVuZGVmaW5lZCwgeyBsaW1pdCwgb2Zmc2V0IH0pO1xuICAgICAgXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIGV2ZW50czogcGFnaW5hdGVkTG9ncyxcbiAgICAgICAgdG90YWw6IGF1ZGl0TG9nLmxlbmd0aCxcbiAgICAgICAgbGltaXQsXG4gICAgICAgIG9mZnNldFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgYWNjZXNzaW5nIGF1ZGl0IGxvZzonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gcmV0cmlldmUgYXVkaXQgbG9nJyB9KTtcbiAgICB9XG4gIH0pO1xuICBcbiAgLy8gRGVsZXRlIGRvY3VtZW50IHdpdGggZW5oYW5jZWQgc2VjdXJpdHkgbG9nZ2luZ1xuICBhcHAuZGVsZXRlKCcvYXBpL2RvY3VtZW50cy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgY29uc3QgZG9jdW1lbnRJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCBkb2N1bWVudFR5cGUgPSByZXEucXVlcnkudHlwZSBhcyBzdHJpbmc7IC8vIE9wdGlvbmFsIHR5cGUgaGludFxuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBmb3IgcGVybWlzc2lvbiBjaGVja2luZ1xuICAgICAgY29uc3Qgb3JnYW5pemF0aW9ucyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnModXNlcklkKTtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6IHVuZGVmaW5lZDtcblxuICAgICAgLy8gVXNlIHVuaWZpZWQgZG9jdW1lbnRzIHN5c3RlbSBmb3IgZGVsZXRpb25cbiAgICAgIGxldCBkZWxldGVkID0gZmFsc2U7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbGV0ZWQgPSBhd2FpdCBzdG9yYWdlLmRlbGV0ZURvY3VtZW50KGRvY3VtZW50SWQpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBFcnJvciBkZWxldGluZyBkb2N1bWVudDonLCBlKTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFkZWxldGVkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudFJlY29yZCBub3QgZm91bmQgb3IgYWNjZXNzIGRlbmllZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoMjA0KS5zZW5kKCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluIGRvY3VtZW50IGRlbGV0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgZG9jdW1lbnQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gVXBsb2FkIGVuZHBvaW50IHRoYXQgbWF0Y2hlcyBmcm9udGVuZCBleHBlY3RhdGlvbjogL2FwaS9kb2N1bWVudHMvOmlkL3VwbG9hZFxuICBhcHAucG9zdChcbiAgICAnL2FwaS9kb2N1bWVudHMvOmlkL3VwbG9hZCcsXG4gICAgcmVxdWlyZUF1dGgsXG4gICAgdXBsb2FkLnNpbmdsZSgnZmlsZScpLFxuICAgIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgICBjb25zdCB1c2VySWQgPSB1c2VyLmlkO1xuICAgICAgICBjb25zdCBkb2N1bWVudElkID0gcmVxLnBhcmFtcy5pZDsgLy8gVGhlIDppZCBpbiB0aGUgVVJMIGlzIHRoZSBkb2N1bWVudCBJRCAoZnJvbSBmcm9udGVuZClcbiAgICAgICAgY29uc3QgeyBkb2N1bWVudFR5cGUgPSAncmVzaWRlbnQnLCByZXNpZGVuY2VJZCwgLi4ub3RoZXJEYXRhIH0gPSByZXEuYm9keTtcblxuICAgICAgICBjb25zb2xlLmxvZygn8J+TpCBVcGxvYWQgcmVxdWVzdCByZWNlaXZlZDonLCB7XG4gICAgICAgICAgZG9jdW1lbnRJZCxcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgaGFzRmlsZTogISFyZXEuZmlsZSxcbiAgICAgICAgICBmaWxlSW5mbzogcmVxLmZpbGVcbiAgICAgICAgICAgID8ge1xuICAgICAgICAgICAgICAgIGZpZWxkbmFtZTogcmVxLmZpbGUuZmllbGRuYW1lLFxuICAgICAgICAgICAgICAgIG9yaWdpbmFsbmFtZTogcmVxLmZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICAgICAgICAgIGVuY29kaW5nOiByZXEuZmlsZS5lbmNvZGluZyxcbiAgICAgICAgICAgICAgICBtaW1ldHlwZTogcmVxLmZpbGUubWltZXR5cGUsXG4gICAgICAgICAgICAgICAgc2l6ZTogcmVxLmZpbGUuc2l6ZSxcbiAgICAgICAgICAgICAgICBwYXRoOiByZXEuZmlsZS5wYXRoLFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA6IG51bGwsXG4gICAgICAgICAgYm9keUtleXM6IE9iamVjdC5rZXlzKHJlcS5ib2R5KSxcbiAgICAgICAgICBjb250ZW50VHlwZTogcmVxLmhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddLFxuICAgICAgICB9KTtcblxuICAgICAgICAvLyBWYWxpZGF0ZSBwZXJtaXNzaW9ucyAtIG9ubHkgYWRtaW4sIG1hbmFnZXIsIGFuZCByZXNpZGVudCBjYW4gY3JlYXRlIGRvY3VtZW50c1xuICAgICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlcicsICdyZXNpZGVudCddLmluY2x1ZGVzKHVzZXJSb2xlKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gY3JlYXRlIGRvY3VtZW50cycgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIXJlcS5maWxlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIE5vIGZpbGUgcmVjZWl2ZWQgaW4gdXBsb2FkIHJlcXVlc3QnKTtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnRmlsZSBpcyByZXF1aXJlZCBmb3IgdXBsb2FkJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCB0aGUgZXhpc3RpbmcgZG9jdW1lbnQgdG8gZGV0ZXJtaW5lIHdoZXJlIHRvIHN0b3JlIHRoZSBmaWxlXG4gICAgICAgIGNvbnN0IGRvY3VtZW50cyA9IGF3YWl0IHN0b3JhZ2UuZ2V0RG9jdW1lbnRzKHtcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nRG9jdW1lbnQgPSBkb2N1bWVudHMuZmluZCgoZG9jKSA9PiBkb2MuaWQgPT09IGRvY3VtZW50SWQpO1xuXG4gICAgICAgIGlmICghZXhpc3RpbmdEb2N1bWVudCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEb2N1bWVudFJlY29yZCBub3QgZm91bmQnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRmlsZSB2YWxpZGF0aW9uIHBhc3NlZCAtIGZpbGUgZXhpc3RzIGFuZCBpcyByZWFkeSBmb3IgdXBsb2FkXG5cbiAgICAgICAgLy8gRGV0ZXJtaW5lIG9yZ2FuaXphdGlvbiBJRCBiYXNlZCBvbiBkb2N1bWVudCBjb250ZXh0XG4gICAgICAgIGxldCBvcmdhbml6YXRpb25JZDogc3RyaW5nO1xuXG4gICAgICAgIGlmIChleGlzdGluZ0RvY3VtZW50LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IHN0b3JhZ2UuZ2V0QnVpbGRpbmcoZXhpc3RpbmdEb2N1bWVudC5idWlsZGluZ0lkKTtcbiAgICAgICAgICBpZiAoIWJ1aWxkaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQgPSBidWlsZGluZy5vcmdhbml6YXRpb25JZDtcbiAgICAgICAgfSBlbHNlIGlmIChleGlzdGluZ0RvY3VtZW50LnJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlID0gYXdhaXQgc3RvcmFnZS5nZXRSZXNpZGVuY2UoZXhpc3RpbmdEb2N1bWVudC5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgaWYgKCFyZXNpZGVuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdSZXNpZGVuY2Ugbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBzdG9yYWdlLmdldEJ1aWxkaW5nKHJlc2lkZW5jZS5idWlsZGluZ0lkKTtcbiAgICAgICAgICBpZiAoIWJ1aWxkaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQgPSBidWlsZGluZy5vcmdhbml6YXRpb25JZDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcmVzXG4gICAgICAgICAgICAuc3RhdHVzKDQwMClcbiAgICAgICAgICAgIC5qc29uKHsgbWVzc2FnZTogJ0RvY3VtZW50UmVjb3JkIG11c3QgYmUgYXNzb2NpYXRlZCB3aXRoIGEgYnVpbGRpbmcgb3IgcmVzaWRlbmNlJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE5vdGU6IEZpbGUgdXBsb2FkIHRvIGV4dGVybmFsIHN0b3JhZ2UgcmVtb3ZlZFxuXG4gICAgICAgIC8vIFVwZGF0ZSBkb2N1bWVudCB3aXRoIGZpbGUgaW5mb3JtYXRpb25cbiAgICAgICAgY29uc3QgdXBkYXRlZERvY3VtZW50ID0gYXdhaXQgc3RvcmFnZS51cGRhdGVEb2N1bWVudChkb2N1bWVudElkLCB7XG4gICAgICAgICAgZmlsZVBhdGg6IGBwcm9kX29yZ18ke29yZ2FuaXphdGlvbklkfS8ke3JlcS5maWxlLm9yaWdpbmFsbmFtZX1gLFxuICAgICAgICAgIG5hbWU6IHJlcS5maWxlLm9yaWdpbmFsbmFtZSxcbiAgICAgICAgICAvLyBSZW1vdmUgbWltZVR5cGUgYXMgaXQncyBub3QgaW4gc2NoZW1hXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlXG4gICAgICAgIGlmIChyZXEuZmlsZSAmJiByZXEuZmlsZS5wYXRoICYmIGZzLmV4aXN0c1N5bmMocmVxLmZpbGUucGF0aCkpIHtcbiAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xuICAgICAgICAgIGRvY3VtZW50OiB1cGRhdGVkRG9jdW1lbnQsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZpbGUgdXBsb2FkZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnN0IGVycm9yVGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgICAgICBjb25zb2xlLmVycm9yKGBbJHtlcnJvclRpbWVzdGFtcH1dIEVycm9yIHR5cGU6YCwgZXJyb3IuY29uc3RydWN0b3IubmFtZSk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYFske2Vycm9yVGltZXN0YW1wfV0gRXJyb3IgbWVzc2FnZTpgLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgY29uc29sZS5lcnJvcihgWyR7ZXJyb3JUaW1lc3RhbXB9XSBFcnJvciBzdGFjazpgLCBlcnJvci5zdGFjayk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGUgb24gZXJyb3JcbiAgICAgICAgaWYgKHJlcS5maWxlICYmIHJlcS5maWxlLnBhdGggJiYgZnMuZXhpc3RzU3luYyhyZXEuZmlsZS5wYXRoKSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgICAgIH0gY2F0Y2ggKGNsZWFudXBFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihgWyR7ZXJyb3JUaW1lc3RhbXB9XSBFcnJvciBjbGVhbmluZyB1cCBmaWxlOmAsIGNsZWFudXBFcnJvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdab2RFcnJvcicpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBsb2FkIGRvY3VtZW50JyB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLy8gUE9TVCAvYXBpL2RvY3VtZW50cy91cGxvYWQgLSBVcGxvYWQgZmlsZSB0byBHQ1MgYW5kIGNyZWF0ZSB1bmlmaWVkIGRvY3VtZW50IHJlY29yZFxuICBhcHAucG9zdCgnL2FwaS9kb2N1bWVudHMvdXBsb2FkJywgcmVxdWlyZUF1dGgsIHVwbG9hZC5zaW5nbGUoJ2ZpbGUnKSwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc29sZS5sb2coYFske3RpbWVzdGFtcH1dIPCfk4sgUE9TVCAvYXBpL2RvY3VtZW50cy91cGxvYWQgLSBTdGFydGluZyB1cGxvYWRgLCB7XG4gICAgICBoYXNGaWxlOiAhIXJlcS5maWxlLFxuICAgICAgZmlsZU5hbWU6IHJlcS5maWxlPy5vcmlnaW5hbG5hbWUsXG4gICAgICBmaWxlU2l6ZTogcmVxLmZpbGU/LnNpemUsXG4gICAgICBib2R5OiByZXEuYm9keSxcbiAgICAgIHVzZXJJZDogcmVxLnVzZXI/LmlkXG4gICAgfSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgaWYgZmlsZSB3YXMgdXBsb2FkZWRcbiAgICAgIGlmICghcmVxLmZpbGUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBQYXJzZSBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0ge1xuICAgICAgICBuYW1lOiByZXEuYm9keS5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogcmVxLmJvZHkuZGVzY3JpcHRpb24gfHwgJycsXG4gICAgICAgIGRvY3VtZW50VHlwZTogcmVxLmJvZHkuZG9jdW1lbnRUeXBlIHx8IHJlcS5ib2R5LnR5cGUsIC8vIEhhbmRsZSBib3RoIGZpZWxkIG5hbWVzXG4gICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogcmVxLmJvZHkuaXNWaXNpYmxlVG9UZW5hbnRzID09PSAndHJ1ZScsXG4gICAgICAgIHJlc2lkZW5jZUlkOiByZXEuYm9keS5yZXNpZGVuY2VJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IHJlcS5ib2R5LmJ1aWxkaW5nSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhdHRhY2hlZFRvVHlwZTogcmVxLmJvZHkuYXR0YWNoZWRUb1R5cGUgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhdHRhY2hlZFRvSWQ6IHJlcS5ib2R5LmF0dGFjaGVkVG9JZCB8fCB1bmRlZmluZWQsXG4gICAgICB9O1xuXG4gICAgICAvLyBQcm9kdWN0aW9uIGRlYnVnZ2luZzogTG9nIGZvcm0gZGF0YSBiZWZvcmUgdmFsaWRhdGlvblxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tQUk9EIERFQlVHXSBGb3JtIGRhdGEgYmVmb3JlIHZhbGlkYXRpb246JywgZm9ybURhdGEpO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBmb3JtIGRhdGFcbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSB1cGxvYWREb2N1bWVudFJlY29yZFNjaGVtYS5wYXJzZShmb3JtRGF0YSk7XG4gICAgICBcbiAgICAgIC8vIERFQlVHOiBMb2cgdmFsaWRhdGVkIGRhdGEgdG8gc2VlIHdoYXQncyBiZWluZyBwYXNzZWRcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDwn5SNIFZBTElEQVRJT04gREVCVUc6IEZvcm0gZGF0YSBiZWZvcmUgdmFsaWRhdGlvbjpgLCBmb3JtRGF0YSk7XG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g8J+UjSBWQUxJREFUSU9OIERFQlVHOiBWYWxpZGF0ZWQgZGF0YTpgLCB7XG4gICAgICAgIC4uLnZhbGlkYXRlZERhdGEsXG4gICAgICAgIGhhc0F0dGFjaGVkVG9UeXBlOiAhIXZhbGlkYXRlZERhdGEuYXR0YWNoZWRUb1R5cGUsXG4gICAgICAgIGhhc0F0dGFjaGVkVG9JZDogISF2YWxpZGF0ZWREYXRhLmF0dGFjaGVkVG9JZFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFByb2R1Y3Rpb24gZGVidWdnaW5nOiBMb2cgYWZ0ZXIgdmFsaWRhdGlvblxuICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tQUk9EIERFQlVHXSBGb3JtIGRhdGEgdmFsaWRhdGlvbiBwYXNzZWQ6JywgdmFsaWRhdGVkRGF0YSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB1c2VyIGluZm8gZnJvbSBhdXRoIG1pZGRsZXdhcmVcbiAgICAgIGNvbnN0IHVzZXJJZCA9IHJlcS51c2VyPy5pZDtcbiAgICAgIGlmICghdXNlcklkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG5vdCBhdXRoZW50aWNhdGVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR0NTIERJU0FCTEVEOiBTa2lwIGJ1Y2tldCBjb25maWd1cmF0aW9uICh1c2luZyBsb2NhbCBzdG9yYWdlIG9ubHkpXG4gICAgICBjb25zb2xlLmxvZygn8J+TgSBHQ1MgZGlzYWJsZWQgLSBza2lwcGluZyBidWNrZXQgY29uZmlndXJhdGlvbiBjaGVjaycpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgR0NTIHBhdGhcbiAgICAgIGNvbnN0IGZpbGVFeHRlbnNpb24gPSBwYXRoLmV4dG5hbWUocmVxLmZpbGUub3JpZ2luYWxuYW1lKTtcbiAgICAgIGNvbnN0IGJhc2VGaWxlTmFtZSA9IHBhdGguYmFzZW5hbWUocmVxLmZpbGUub3JpZ2luYWxuYW1lLCBmaWxlRXh0ZW5zaW9uKTtcbiAgICAgIGNvbnN0IHVuaXF1ZUZpbGVOYW1lID0gYCR7dXVpZHY0KCl9LSR7YmFzZUZpbGVOYW1lfSR7ZmlsZUV4dGVuc2lvbn1gO1xuXG4gICAgICBsZXQgZmlsZVBhdGg6IHN0cmluZztcbiAgICAgIGlmICh2YWxpZGF0ZWREYXRhLnJlc2lkZW5jZUlkKSB7XG4gICAgICAgIGZpbGVQYXRoID0gYHJlc2lkZW5jZXMvJHt2YWxpZGF0ZWREYXRhLnJlc2lkZW5jZUlkfS8ke3VuaXF1ZUZpbGVOYW1lfWA7XG4gICAgICB9IGVsc2UgaWYgKHZhbGlkYXRlZERhdGEuYnVpbGRpbmdJZCkge1xuICAgICAgICBmaWxlUGF0aCA9IGBidWlsZGluZ3MvJHt2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWR9LyR7dW5pcXVlRmlsZU5hbWV9YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZpbGVQYXRoID0gYGdlbmVyYWwvJHt1bmlxdWVGaWxlTmFtZX1gO1xuICAgICAgfVxuXG4gICAgICAvLyBESVNBQkxFRCBHQ1M6IEZvcmNlIGxvY2FsIHN0b3JhZ2UgZm9yIGFsbCBlbnZpcm9ubWVudHNcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OBIEdDUyBkaXNhYmxlZCAtIHVzaW5nIGxvY2FsIHN0b3JhZ2UgZm9yIGFsbCBkb2N1bWVudCBvcGVyYXRpb25zJyk7XG4gICAgICBcbiAgICAgIC8vIEFsd2F5cyB1c2UgbG9jYWwgc3RvcmFnZSAoR0NTIGRpc2FibGVkKVxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gVXNlIGxvY2FsIHN0b3JhZ2Ugd2l0aCByb2J1c3QgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgY29uc3QgbG9jYWxTdG9yYWdlUGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAndXBsb2FkcycpO1xuICAgICAgICBcbiAgICAgICAgLy8gRW5zdXJlIHVwbG9hZHMgZGlyZWN0b3J5IGV4aXN0c1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGlmICghZnMuZXhpc3RzU3luYyhsb2NhbFN0b3JhZ2VQYXRoKSkge1xuICAgICAgICAgICAgZnMubWtkaXJTeW5jKGxvY2FsU3RvcmFnZVBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfk4EgQ3JlYXRlZCB1cGxvYWRzIGRpcmVjdG9yeTogJHtsb2NhbFN0b3JhZ2VQYXRofWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZGlyRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIHVwbG9hZHMgZGlyZWN0b3J5OicsIGRpckVycm9yKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjcmVhdGUgdXBsb2FkcyBkaXJlY3RvcnkgLSBjaGVjayBwZXJtaXNzaW9ucycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSBzdHJ1Y3R1cmUgZm9yIGZpbGVcbiAgICAgICAgY29uc3QgbG9jYWxGaWxlUGF0aCA9IHBhdGguam9pbihsb2NhbFN0b3JhZ2VQYXRoLCBmaWxlUGF0aCk7XG4gICAgICAgIGNvbnN0IGxvY2FsRmlsZURpciA9IHBhdGguZGlybmFtZShsb2NhbEZpbGVQYXRoKTtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGxvY2FsRmlsZURpcikpIHtcbiAgICAgICAgICAgIGZzLm1rZGlyU3luYyhsb2NhbEZpbGVEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfk4EgQ3JlYXRlZCBzdWJkaXJlY3Rvcnk6ICR7bG9jYWxGaWxlRGlyfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoc3ViZGlyRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gY3JlYXRlIGZpbGUgc3ViZGlyZWN0b3J5OicsIHN1YmRpckVycm9yKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCBjcmVhdGUgZmlsZSBkaXJlY3RvcnkgLSBjaGVjayBwZXJtaXNzaW9ucycpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ29weSB1cGxvYWRlZCBmaWxlIHRvIGxvY2FsIHN0b3JhZ2VcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBmcy5jb3B5RmlsZVN5bmMocmVxLmZpbGUhLnBhdGgsIGxvY2FsRmlsZVBhdGgpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OBIEZpbGUgc2F2ZWQgc3VjY2Vzc2Z1bGx5IGF0ICR7bG9jYWxGaWxlUGF0aH1gKTtcbiAgICAgICAgfSBjYXRjaCAoY29weUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGNvcHkgZmlsZTonLCBjb3B5RXJyb3IpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IHNhdmUgZmlsZSAtIGNoZWNrIGRpc2sgc3BhY2UgYW5kIHBlcm1pc3Npb25zJyk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGxvY2FsRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignTG9jYWwgc3RvcmFnZSBlcnJvcjonLCBsb2NhbEVycm9yKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gc2F2ZSBmaWxlIGxvY2FsbHknKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGRvY3VtZW50IHJlY29yZCBpbiBkYXRhYmFzZVxuICAgICAgY29uc3QgZG9jdW1lbnREYXRhOiBJbnNlcnREb2N1bWVudCA9IHtcbiAgICAgICAgbmFtZTogdmFsaWRhdGVkRGF0YS5uYW1lLFxuICAgICAgICBkZXNjcmlwdGlvbjogdmFsaWRhdGVkRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgICAgZG9jdW1lbnRUeXBlOiB2YWxpZGF0ZWREYXRhLmRvY3VtZW50VHlwZSxcbiAgICAgICAgZmlsZVBhdGg6IGZpbGVQYXRoLFxuICAgICAgICBpc1Zpc2libGVUb1RlbmFudHM6IHZhbGlkYXRlZERhdGEuaXNWaXNpYmxlVG9UZW5hbnRzLFxuICAgICAgICByZXNpZGVuY2VJZDogdmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZCxcbiAgICAgICAgYnVpbGRpbmdJZDogdmFsaWRhdGVkRGF0YS5idWlsZGluZ0lkLFxuICAgICAgICB1cGxvYWRlZEJ5SWQ6IHVzZXJJZCxcbiAgICAgICAgYXR0YWNoZWRUb1R5cGU6IHZhbGlkYXRlZERhdGEuYXR0YWNoZWRUb1R5cGUsXG4gICAgICAgIGF0dGFjaGVkVG9JZDogdmFsaWRhdGVkRGF0YS5hdHRhY2hlZFRvSWQsXG4gICAgICB9O1xuXG4gICAgICAvLyBDUklUSUNBTCBERUJVRyBQT0lOVDogRGF0YWJhc2UgY3JlYXRpb25cbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSDwn46vIENSSVRJQ0FMOiBBYm91dCB0byBjcmVhdGUgZG9jdW1lbnQgaW4gZGF0YWJhc2U6YCwge1xuICAgICAgICBuYW1lOiBkb2N1bWVudERhdGEubmFtZSxcbiAgICAgICAgdHlwZTogZG9jdW1lbnREYXRhLmRvY3VtZW50VHlwZSxcbiAgICAgICAgYnVpbGRpbmdJZDogZG9jdW1lbnREYXRhLmJ1aWxkaW5nSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkOiBkb2N1bWVudERhdGEucmVzaWRlbmNlSWQsXG4gICAgICAgIHVwbG9hZGVkQnlJZDogZG9jdW1lbnREYXRhLnVwbG9hZGVkQnlJZCxcbiAgICAgICAgYXR0YWNoZWRUb1R5cGU6IGRvY3VtZW50RGF0YS5hdHRhY2hlZFRvVHlwZSxcbiAgICAgICAgYXR0YWNoZWRUb0lkOiBkb2N1bWVudERhdGEuYXR0YWNoZWRUb0lkXG4gICAgICB9KTtcblxuICAgICAgLy8gQ3JlYXRlIGRvY3VtZW50IHJlY29yZCBpbiBkYXRhYmFzZSAgXG4gICAgICBjb25zdCBuZXdEb2N1bWVudCA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlRG9jdW1lbnQoZG9jdW1lbnREYXRhKTtcbiAgICAgIFxuICAgICAgLy8gQ1JJVElDQUw6IExvZyBzdWNjZXNzZnVsIGRhdGFiYXNlIGNyZWF0aW9uXG4gICAgICBjb25zb2xlLmxvZyhgWyR7dGltZXN0YW1wfV0g4pyFIENSSVRJQ0FMOiBEb2N1bWVudFJlY29yZCBjcmVhdGVkIHN1Y2Nlc3NmdWxseTpgLCB7IFxuICAgICAgICBpZDogbmV3RG9jdW1lbnQ/LmlkLCBcbiAgICAgICAgbmFtZTogbmV3RG9jdW1lbnQ/Lm5hbWUsXG4gICAgICAgIGZpbGVQYXRoOiBuZXdEb2N1bWVudD8uZmlsZVBhdGggXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGVcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKHJlcS5maWxlLnBhdGgpKSB7XG4gICAgICAgIGZzLnVubGlua1N5bmMocmVxLmZpbGUucGF0aCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJldHVybiBzdWNjZXNzIHJlc3BvbnNlXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdEb2N1bWVudFJlY29yZCB1cGxvYWRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBkb2N1bWVudDogbmV3RG9jdW1lbnQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zdCBlcnJvckVudHJ5ID0gbG9nRXJyb3IoJ1BPU1QgL2FwaS9kb2N1bWVudHMvdXBsb2FkJywgZXJyb3IsIHJlcS51c2VyKTtcblxuICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGUgb24gZXJyb3JcbiAgICAgIGlmIChyZXEuZmlsZSAmJiByZXEuZmlsZS5wYXRoICYmIGZzLmV4aXN0c1N5bmMocmVxLmZpbGUucGF0aCkpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBmcy51bmxpbmtTeW5jKHJlcS5maWxlLnBhdGgpO1xuICAgICAgICB9IGNhdGNoIChjbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBjbGVhbmluZyB1cCB0ZW1wb3JhcnkgZmlsZTonLCBjbGVhbnVwRXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSB2YWxpZGF0aW9uIGVycm9yc1xuICAgICAgaWYgKGVycm9yLm5hbWUgPT09ICdab2RFcnJvcicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgZXJyb3JzOiBlcnJvci5lcnJvcnMsXG4gICAgICAgICAgZXJyb3JfaWQ6IGVycm9yRW50cnkudGltZXN0YW1wXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYW5kbGUgR0NTIGVycm9yc1xuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnR29vZ2xlIENsb3VkIFN0b3JhZ2UnKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGaWxlIHVwbG9hZCBmYWlsZWQnLFxuICAgICAgICAgIGVycm9yOiAnU3RvcmFnZSBzZXJ2aWNlIGVycm9yJyxcbiAgICAgICAgICBlcnJvcl9pZDogZXJyb3JFbnRyeS50aW1lc3RhbXBcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEhhbmRsZSB1bmlxdWUgY29uc3RyYWludCB2aW9sYXRpb25zIChwYXRoIGNvbmZsaWN0cylcbiAgICAgIGlmIChlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ3VuaXF1ZSBjb25zdHJhaW50JykgfHwgZXJyb3I/LmNvZGUgPT09ICcyMzUwNScpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA5KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnRSZWNvcmQgcGF0aCBjb25mbGljdCAtIHBsZWFzZSB0cnkgdXBsb2FkaW5nIGFnYWluJyxcbiAgICAgICAgICBlcnJvcjogJ1BhdGggYWxyZWFkeSBleGlzdHMnLFxuICAgICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFuZGxlIGRhdGFiYXNlIGVycm9yc1xuICAgICAgaWYgKGVycm9yLm1lc3NhZ2UgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnZGF0YWJhc2UnKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2F2ZSBkb2N1bWVudCByZWNvcmQnLFxuICAgICAgICAgIGVycm9yOiAnRGF0YWJhc2UgZXJyb3InLFxuICAgICAgICAgIGVycm9yX2lkOiBlcnJvckVudHJ5LnRpbWVzdGFtcFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2VuZXJpYyBlcnJvciByZXNwb25zZVxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgZXJyb3I6ICdEb2N1bWVudFJlY29yZCB1cGxvYWQgZmFpbGVkJyxcbiAgICAgICAgZXJyb3JfaWQ6IGVycm9yRW50cnkudGltZXN0YW1wLFxuICAgICAgICBkZWJ1Z19pbmZvOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JyA/IGVycm9yLm1lc3NhZ2UgOiB1bmRlZmluZWRcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gU2VydmUgZG9jdW1lbnQgZmlsZXNcbiAgLy8gU2VydmUgZG9jdW1lbnQgZmlsZXMgd2l0aCBwcm9wZXIgcm9sZS1iYXNlZCBhY2Nlc3MgY29udHJvbFxuICBhcHAuZ2V0KCcvYXBpL2RvY3VtZW50cy86aWQvZmlsZScsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gRmlsZSBkb3dubG9hZCByZXF1ZXN0IGZvciBkb2N1bWVudCBJRDogJHtyZXEucGFyYW1zLmlkfWApO1xuICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gVXNlcjogJHtyZXEudXNlci5pZH0gKCR7cmVxLnVzZXIucm9sZX0pYCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHVzZXJSb2xlID0gdXNlci5yb2xlO1xuICAgICAgY29uc3QgdXNlcklkID0gdXNlci5pZDtcbiAgICAgIGNvbnN0IGRvY3VtZW50SWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgaXNEb3dubG9hZCA9IHJlcS5xdWVyeS5kb3dubG9hZCA9PT0gJ3RydWUnO1xuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIFJlcXVlc3QgZGV0YWlsczpgLCB7XG4gICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICAgIGlzRG93bmxvYWRcbiAgICAgIH0pO1xuXG4gICAgICAvLyBHZXQgdXNlcidzIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlcyBmb3IgcGVybWlzc2lvbiBjaGVja2luZ1xuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBGZXRjaGluZyB1c2VyIHBlcm1pc3Npb25zIGRhdGEuLi5gKTtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZCk7XG4gICAgICBjb25zdCByZXNpZGVuY2VzID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyUmVzaWRlbmNlcyh1c2VySWQpO1xuICAgICAgY29uc3QgYnVpbGRpbmdzID0gYXdhaXQgc3RvcmFnZS5nZXRCdWlsZGluZ3MoKTtcblxuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBVc2VyIHBlcm1pc3Npb25zOmAsIHtcbiAgICAgICAgb3JnYW5pemF0aW9uc0NvdW50OiBvcmdhbml6YXRpb25zLmxlbmd0aCxcbiAgICAgICAgcmVzaWRlbmNlc0NvdW50OiByZXNpZGVuY2VzLmxlbmd0aCxcbiAgICAgICAgYnVpbGRpbmdzQ291bnQ6IGJ1aWxkaW5ncy5sZW5ndGhcbiAgICAgIH0pO1xuXG4gICAgICAvLyBMb2cgYWNjZXNzIGF0dGVtcHQgZm9yIHNlY3VyaXR5IGF1ZGl0aW5nXG4gICAgICBsb2dTZWN1cml0eUV2ZW50KCdET0NVTUVOVF9GSUxFX0FDQ0VTU19BVFRFTVBUJywgdXNlciwgZmFsc2UsIGRvY3VtZW50SWQsIHtcbiAgICAgICAgdXNlclJvbGUsXG4gICAgICAgIGRvY3VtZW50SWQsXG4gICAgICAgIGlzRG93bmxvYWRcbiAgICAgIH0pO1xuXG4gICAgICAvLyBGaW5kIHRoZSBkb2N1bWVudCBkaXJlY3RseSBmcm9tIGRhdGFiYXNlIHdpdGhvdXQgZmlsdGVyaW5nIGJ5IHVzZXJcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gTG9va2luZyBmb3IgZG9jdW1lbnQgJHtkb2N1bWVudElkfSBpbiBkYXRhYmFzZS4uLmApO1xuICAgICAgY29uc3QgYWxsRG9jdW1lbnRzID0gYXdhaXQgc3RvcmFnZS5nZXREb2N1bWVudHMoe30pO1xuICAgICAgY29uc3QgZG9jdW1lbnQgPSBhbGxEb2N1bWVudHMuZmluZCgoZG9jKSA9PiBkb2MuaWQgPT09IGRvY3VtZW50SWQpO1xuXG4gICAgICBpZiAoIWRvY3VtZW50KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBEb2N1bWVudCBub3QgZm91bmQ6ICR7ZG9jdW1lbnRJZH1gKTtcbiAgICAgICAgbG9nU2VjdXJpdHlFdmVudCgnRE9DVU1FTlRfRklMRV9BQ0NFU1NfTk9UX0ZPVU5EJywgdXNlciwgZmFsc2UsIGRvY3VtZW50SWQpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnRG9jdW1lbnQgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBEb2N1bWVudCBmb3VuZDpgLCB7XG4gICAgICAgIGlkOiBkb2N1bWVudC5pZCxcbiAgICAgICAgbmFtZTogZG9jdW1lbnQubmFtZSxcbiAgICAgICAgZmlsZVBhdGg6IGRvY3VtZW50LmZpbGVQYXRoLFxuICAgICAgICBidWlsZGluZ0lkOiBkb2N1bWVudC5idWlsZGluZ0lkLFxuICAgICAgICByZXNpZGVuY2VJZDogZG9jdW1lbnQucmVzaWRlbmNlSWQsXG4gICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogZG9jdW1lbnQuaXNWaXNpYmxlVG9UZW5hbnRzLFxuICAgICAgICB1cGxvYWRlZEJ5SWQ6IGRvY3VtZW50LnVwbG9hZGVkQnlJZFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEdldCB1c2VyJ3Mgb3JnYW5pemF0aW9uIGluZm9cbiAgICAgIGNvbnN0IHVzZXJPcmdhbml6YXRpb25zID0gb3JnYW5pemF0aW9ucy5tYXAob3JnID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG4gICAgICBjb25zdCB1c2VyUmVzaWRlbmNlSWRzID0gcmVzaWRlbmNlc1xuICAgICAgICAubWFwKCh1cjogYW55KSA9PiB1ci5yZXNpZGVuY2VJZCB8fCB1ci51c2VyUmVzaWRlbmNlPy5yZXNpZGVuY2VJZCB8fCB1ci5yZXNpZGVuY2U/LmlkKVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuXG4gICAgICAvLyBHZXQgYnVpbGRpbmcgSURzIHRoYXQgdXNlcidzIHJlc2lkZW5jZXMgYmVsb25nIHRvXG4gICAgICBjb25zdCB1c2VyQnVpbGRpbmdJZHMgPSBbXTtcbiAgICAgIGZvciAoY29uc3QgdXNlclJlc2lkZW5jZSBvZiByZXNpZGVuY2VzKSB7XG4gICAgICAgIC8vIEhhbmRsZSBkaWZmZXJlbnQgcmVzaWRlbmNlIGRhdGEgc3RydWN0dXJlc1xuICAgICAgICBjb25zdCByZXNpZGVuY2VJZCA9IHVzZXJSZXNpZGVuY2UucmVzaWRlbmNlSWQ7XG4gICAgICAgIGlmIChyZXNpZGVuY2VJZCkge1xuICAgICAgICAgIC8vIEZpbmQgdGhlIGFjdHVhbCByZXNpZGVuY2UgdG8gZ2V0IGJ1aWxkaW5nIElEXG4gICAgICAgICAgY29uc3QgYWxsUmVzaWRlbmNlcyA9IGF3YWl0IHN0b3JhZ2UuZ2V0UmVzaWRlbmNlcygpO1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZSA9IGFsbFJlc2lkZW5jZXMuZmluZChyID0+IHIuaWQgPT09IHJlc2lkZW5jZUlkKTtcbiAgICAgICAgICBpZiAocmVzaWRlbmNlPy5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgICB1c2VyQnVpbGRpbmdJZHMucHVzaChyZXNpZGVuY2UuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHBlcm1pc3Npb25zIGJhc2VkIG9uIHRoZSBzcGVjaWZpZWQgcnVsZXNcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gQ2hlY2tpbmcgYWNjZXNzIHBlcm1pc3Npb25zIGZvciByb2xlOiAke3VzZXJSb2xlfWApO1xuICAgICAgbGV0IGhhc0FjY2VzcyA9IGZhbHNlO1xuICAgICAgbGV0IGFjY2Vzc1JlYXNvbiA9ICcnO1xuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIFBlcm1pc3Npb24gY29udGV4dDpgLCB7XG4gICAgICAgIHVzZXJPcmdhbml6YXRpb25zLFxuICAgICAgICB1c2VyUmVzaWRlbmNlSWRzLFxuICAgICAgICB1c2VyQnVpbGRpbmdJZHMsXG4gICAgICAgIGRvY3VtZW50QnVpbGRpbmdJZDogZG9jdW1lbnQuYnVpbGRpbmdJZCxcbiAgICAgICAgZG9jdW1lbnRSZXNpZGVuY2VJZDogZG9jdW1lbnQucmVzaWRlbmNlSWQsXG4gICAgICAgIGRvY3VtZW50SXNWaXNpYmxlVG9UZW5hbnRzOiBkb2N1bWVudC5pc1Zpc2libGVUb1RlbmFudHNcbiAgICAgIH0pO1xuXG4gICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgYWNjZXNzUmVhc29uID0gJ0FkbWluIGhhcyBnbG9iYWwgYWNjZXNzJztcbiAgICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlQgRE9XTkxPQURdIEFkbWluIGdyYW50ZWQgYWNjZXNzYCk7XG4gICAgICB9IGVsc2UgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBDaGVja2luZyBtYW5hZ2VyIHBlcm1pc3Npb25zLi4uYCk7XG4gICAgICAgIFxuICAgICAgICAvLyBNYW5hZ2VyIHNob3VsZCBoYXZlIGFjY2VzcyB0byBidWlsZGluZ3MgdGhleSBhcmUgYXNzaWduZWQgdG9cbiAgICAgICAgaWYgKGRvY3VtZW50LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIERvY3VtZW50IGlzIGJ1aWxkaW5nLWxldmVsLCBjaGVja2luZyBvcmdhbml6YXRpb24gYWNjZXNzYCk7XG4gICAgICAgICAgLy8gR2V0IGJ1aWxkaW5ncyBmb3IgdGhlIG1hbmFnZXIncyBvcmdhbml6YXRpb25cbiAgICAgICAgICBjb25zdCBvcmdCdWlsZGluZ3MgPSBidWlsZGluZ3MuZmlsdGVyKGJ1aWxkaW5nID0+IFxuICAgICAgICAgICAgdXNlck9yZ2FuaXphdGlvbnMuaW5jbHVkZXMoYnVpbGRpbmcub3JnYW5pemF0aW9uSWQgfHwgJycpXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCBvcmdCdWlsZGluZ0lkcyA9IG9yZ0J1aWxkaW5ncy5tYXAoYiA9PiBiLmlkKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIE1hbmFnZXIgb3JnYW5pemF0aW9uIGJ1aWxkaW5nczpgLCB7XG4gICAgICAgICAgICB1c2VyT3JnYW5pemF0aW9ucyxcbiAgICAgICAgICAgIG9yZ0J1aWxkaW5nSWRzLFxuICAgICAgICAgICAgZG9jdW1lbnRCdWlsZGluZ0lkOiBkb2N1bWVudC5idWlsZGluZ0lkXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKG9yZ0J1aWxkaW5nSWRzLmluY2x1ZGVzKGRvY3VtZW50LmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgYWNjZXNzUmVhc29uID0gJ01hbmFnZXIgaGFzIGFjY2VzcyB0byBvcmdhbml6YXRpb24gYnVpbGRpbmdzJztcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgW0RPQ1VNRU5UIERPV05MT0FEXSBNYW5hZ2VyIGdyYW50ZWQgYnVpbGRpbmcgYWNjZXNzYCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBNYW5hZ2VyIGRlbmllZCBidWlsZGluZyBhY2Nlc3MgLSBub3QgaW4gb3JnYW5pemF0aW9uYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBNYW5hZ2VyIGhhcyBhY2Nlc3MgdG8gYWxsIHJlc2lkZW5jZXMgaW4gdGhlaXIgb3JnYW5pemF0aW9uXG4gICAgICAgIGlmIChkb2N1bWVudC5yZXNpZGVuY2VJZCkge1xuICAgICAgICAgIC8vIENoZWNrIGlmIHJlc2lkZW5jZSBiZWxvbmdzIHRvIG1hbmFnZXIncyBvcmdhbml6YXRpb25cbiAgICAgICAgICBjb25zdCBhbGxSZXNpZGVuY2VzID0gYXdhaXQgc3RvcmFnZS5nZXRSZXNpZGVuY2VzKCk7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlID0gYWxsUmVzaWRlbmNlcy5maW5kKHIgPT4gci5pZCA9PT0gZG9jdW1lbnQucmVzaWRlbmNlSWQpO1xuICAgICAgICAgIGlmIChyZXNpZGVuY2UpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHJlc2lkZW5jZSBidWlsZGluZyBiZWxvbmdzIHRvIG1hbmFnZXIncyBvcmdhbml6YXRpb25cbiAgICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZUJ1aWxkaW5nID0gYnVpbGRpbmdzLmZpbmQoYiA9PiBiLmlkID09PSByZXNpZGVuY2UuYnVpbGRpbmdJZCk7XG4gICAgICAgICAgICBpZiAocmVzaWRlbmNlQnVpbGRpbmcgJiYgdXNlck9yZ2FuaXphdGlvbnMuaW5jbHVkZXMocmVzaWRlbmNlQnVpbGRpbmcub3JnYW5pemF0aW9uSWQgfHwgJycpKSB7XG4gICAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgIGFjY2Vzc1JlYXNvbiA9ICdNYW5hZ2VyIGhhcyBhY2Nlc3MgdG8gb3JnYW5pemF0aW9uIHJlc2lkZW5jZXMnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh1c2VyUm9sZSA9PT0gJ3Jlc2lkZW50Jykge1xuICAgICAgICAvLyBSZXNpZGVudCBoYXMgYWNjZXNzIHRvIGJ1aWxkaW5nIGZpbGVzIHRoZXkgYXJlIGFzc2lnbmVkIHRvXG4gICAgICAgIGlmIChkb2N1bWVudC5idWlsZGluZ0lkICYmIHVzZXJCdWlsZGluZ0lkcy5pbmNsdWRlcyhkb2N1bWVudC5idWlsZGluZ0lkKSkge1xuICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgYWNjZXNzUmVhc29uID0gJ1Jlc2lkZW50IGhhcyBhY2Nlc3MgdG8gYXNzaWduZWQgYnVpbGRpbmcgZG9jdW1lbnRzJztcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gUmVzaWRlbnQgaGFzIGFjY2VzcyB0byByZXNpZGVuY2UgZmlsZXMgdGhleSBhcmUgYXNzaWduZWQgdG9cbiAgICAgICAgaWYgKGRvY3VtZW50LnJlc2lkZW5jZUlkICYmIHVzZXJSZXNpZGVuY2VJZHMuaW5jbHVkZXMoZG9jdW1lbnQucmVzaWRlbmNlSWQpKSB7XG4gICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICBhY2Nlc3NSZWFzb24gPSAnUmVzaWRlbnQgaGFzIGFjY2VzcyB0byBhc3NpZ25lZCByZXNpZGVuY2UgZG9jdW1lbnRzJztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmICh1c2VyUm9sZSA9PT0gJ3RlbmFudCcpIHtcbiAgICAgICAgLy8gVGVuYW50cyBjYW4gb25seSBhY2Nlc3MgZG9jdW1lbnRzIG1hcmtlZCBhcyB2aXNpYmxlIHRvIHRlbmFudHNcbiAgICAgICAgaWYgKGRvY3VtZW50LmlzVmlzaWJsZVRvVGVuYW50cykge1xuICAgICAgICAgIC8vIFRlbmFudCBoYXMgYWNjZXNzIHRvIGJ1aWxkaW5nIGZpbGVzIHRoZXkgYXJlIGFzc2lnbmVkIHRvIGFuZCBtYXJrZWQgZm9yIHRlbmFudFxuICAgICAgICAgIGlmIChkb2N1bWVudC5idWlsZGluZ0lkICYmIHVzZXJCdWlsZGluZ0lkcy5pbmNsdWRlcyhkb2N1bWVudC5idWlsZGluZ0lkKSkge1xuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIGFjY2Vzc1JlYXNvbiA9ICdUZW5hbnQgaGFzIGFjY2VzcyB0byBhc3NpZ25lZCBidWlsZGluZyBkb2N1bWVudHMgbWFya2VkIGZvciB0ZW5hbnRzJztcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVGVuYW50IGhhcyBhY2Nlc3MgdG8gcmVzaWRlbmNlIGZpbGVzIHRoZXkgYXJlIGFzc2lnbmVkIHRvIGFuZCBtYXJrZWQgZm9yIHRlbmFudFxuICAgICAgICAgIGlmIChkb2N1bWVudC5yZXNpZGVuY2VJZCAmJiB1c2VyUmVzaWRlbmNlSWRzLmluY2x1ZGVzKGRvY3VtZW50LnJlc2lkZW5jZUlkKSkge1xuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgIGFjY2Vzc1JlYXNvbiA9ICdUZW5hbnQgaGFzIGFjY2VzcyB0byBhc3NpZ25lZCByZXNpZGVuY2UgZG9jdW1lbnRzIG1hcmtlZCBmb3IgdGVuYW50cyc7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBBY2Nlc3MgZGVuaWVkIGZvciB1c2VyICR7dXNlcklkfSB0byBkb2N1bWVudCAke2RvY3VtZW50SWR9YCk7XG4gICAgICAgIGxvZ1NlY3VyaXR5RXZlbnQoJ0RPQ1VNRU5UX0ZJTEVfQUNDRVNTX0RFTklFRCcsIHVzZXIsIGZhbHNlLCBkb2N1bWVudElkLCB7XG4gICAgICAgICAgdXNlclJvbGUsXG4gICAgICAgICAgZG9jdW1lbnRCdWlsZGluZ0lkOiBkb2N1bWVudC5idWlsZGluZ0lkLFxuICAgICAgICAgIGRvY3VtZW50UmVzaWRlbmNlSWQ6IGRvY3VtZW50LnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHVzZXJCdWlsZGluZ0lkcyxcbiAgICAgICAgICB1c2VyUmVzaWRlbmNlSWRzLFxuICAgICAgICAgIGlzVmlzaWJsZVRvVGVuYW50czogZG9jdW1lbnQuaXNWaXNpYmxlVG9UZW5hbnRzXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDinIUgW0RPQ1VNRU5UIERPV05MT0FEXSBBY2Nlc3MgZ3JhbnRlZDogJHthY2Nlc3NSZWFzb259YCk7XG5cbiAgICAgIC8vIExvZyBzdWNjZXNzZnVsIGFjY2Vzc1xuICAgICAgbG9nU2VjdXJpdHlFdmVudCgnRE9DVU1FTlRfRklMRV9BQ0NFU1NfR1JBTlRFRCcsIHVzZXIsIHRydWUsIGRvY3VtZW50SWQsIHtcbiAgICAgICAgYWNjZXNzUmVhc29uLFxuICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudC5kb2N1bWVudFR5cGVcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTZXJ2ZSBmcm9tIGxvY2FsIHN0b3JhZ2VcbiAgICAgIGlmIChkb2N1bWVudC5maWxlUGF0aCkge1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIFNlcnZpbmcgZmlsZSBmcm9tIGxvY2FsIHN0b3JhZ2U6ICR7ZG9jdW1lbnQuZmlsZVBhdGh9YCk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gQWx3YXlzIHNlcnZlIGZyb20gbG9jYWwgc3RvcmFnZSAoR0NTIGRpc2FibGVkKVxuICAgICAgICAgIGxldCBmaWxlUGF0aFRvU2VydmUgPSBkb2N1bWVudC5maWxlUGF0aDtcblxuICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gUmVzb2x2aW5nIGZpbGUgcGF0aCBmcm9tOiAke2RvY3VtZW50LmZpbGVQYXRofWApO1xuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgaXQncyBhbiBhYnNvbHV0ZSBwYXRoXG4gICAgICAgICAgaWYgKGRvY3VtZW50LmZpbGVQYXRoLnN0YXJ0c1dpdGgoJy8nKSkge1xuICAgICAgICAgICAgZmlsZVBhdGhUb1NlcnZlID0gZG9jdW1lbnQuZmlsZVBhdGg7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIFVzaW5nIGFic29sdXRlIHBhdGg6ICR7ZmlsZVBhdGhUb1NlcnZlfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBDaGVjayBpZiBpdCdzIGEgcmVsYXRpdmUgZmlsZSBwYXRoXG4gICAgICAgICAgZWxzZSBpZiAoXG4gICAgICAgICAgICBkb2N1bWVudC5maWxlUGF0aC5pbmNsdWRlcygncmVzaWRlbmNlcy8nKSB8fFxuICAgICAgICAgICAgZG9jdW1lbnQuZmlsZVBhdGguaW5jbHVkZXMoJ2J1aWxkaW5ncy8nKSB8fFxuICAgICAgICAgICAgZG9jdW1lbnQuZmlsZVBhdGguaW5jbHVkZXMoJ3RleHQtZG9jdW1lbnRzLycpIHx8XG4gICAgICAgICAgICBkb2N1bWVudC5maWxlUGF0aC5pbmNsdWRlcygnZ2VuZXJhbC8nKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBSZWxhdGl2ZSBwYXRoIGRldGVjdGVkLCBjaGVja2luZyBjb21tb24gbG9jYXRpb25zLi4uYCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEZvciBkZXZlbG9wbWVudCwgdHJ5IHRvIGZpbmQgdGhlIGZpbGUgaW4gY29tbW9uIHVwbG9hZCBkaXJlY3Rvcmllc1xuICAgICAgICAgICAgY29uc3QgcG9zc2libGVQYXRocyA9IFtcbiAgICAgICAgICAgICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd1cGxvYWRzJywgZG9jdW1lbnQuZmlsZVBhdGgpLCAvLyBNYWluIGZhbGxiYWNrIGxvY2F0aW9uXG4gICAgICAgICAgICAgIGAvdG1wL3VwbG9hZHMvJHtkb2N1bWVudC5maWxlUGF0aH1gLFxuICAgICAgICAgICAgICBgL3VwbG9hZHMvJHtkb2N1bWVudC5maWxlUGF0aH1gLFxuICAgICAgICAgICAgICBgLi91cGxvYWRzLyR7ZG9jdW1lbnQuZmlsZVBhdGh9YCxcbiAgICAgICAgICAgICAgcGF0aC5qb2luKCcvdG1wJywgZG9jdW1lbnQuZmlsZVBhdGgpLFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfk6UgW0RPQ1VNRU5UIERPV05MT0FEXSBDaGVja2luZyBwb3NzaWJsZSBwYXRoczpgLCBwb3NzaWJsZVBhdGhzKTtcblxuICAgICAgICAgICAgLy8gVHJ5IHRvIGZpbmQgdGhlIGZpbGUgaW4gYW55IG9mIHRoZXNlIGxvY2F0aW9uc1xuICAgICAgICAgICAgZm9yIChjb25zdCBwb3NzaWJsZVBhdGggb2YgcG9zc2libGVQYXRocykge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIENoZWNraW5nIHBhdGg6ICR7cG9zc2libGVQYXRofSAoZXhpc3RzOiAke2ZzLmV4aXN0c1N5bmMocG9zc2libGVQYXRoKX0pYCk7XG4gICAgICAgICAgICAgIGlmIChmcy5leGlzdHNTeW5jKHBvc3NpYmxlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICBmaWxlUGF0aFRvU2VydmUgPSBwb3NzaWJsZVBhdGg7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlQgRE9XTkxPQURdIEZvdW5kIGZpbGUgYXQ6ICR7ZmlsZVBhdGhUb1NlcnZlfWApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIENoZWNrIGlmIGl0J3MgYSB0ZW1wIGZpbGUgcGF0aFxuICAgICAgICAgIGVsc2UgaWYgKGRvY3VtZW50LmZpbGVQYXRoLmluY2x1ZGVzKCd0bXAnKSkge1xuICAgICAgICAgICAgZmlsZVBhdGhUb1NlcnZlID0gZG9jdW1lbnQuZmlsZVBhdGg7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIFVzaW5nIHRlbXAgZmlsZSBwYXRoOiAke2ZpbGVQYXRoVG9TZXJ2ZX1gKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBUcnkgdG8gc2VydmUgdGhlIGZpbGVcbiAgICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhmaWxlUGF0aFRvU2VydmUpKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg8J+TpSBbRE9DVU1FTlQgRE9XTkxPQURdIEZpbGUgZm91bmQsIHByZXBhcmluZyB0byBzZXJ2ZTogJHtmaWxlUGF0aFRvU2VydmV9YCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEdldCB0aGUgb3JpZ2luYWwgZmlsZW5hbWUgd2l0aCBleHRlbnNpb24sIG9yIGNvbnN0cnVjdCBvbmUgZnJvbSB0aGUgZG9jdW1lbnQgbmFtZVxuICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gKGRvY3VtZW50IGFzIGFueSkuZmlsZU5hbWUgfHwgZG9jdW1lbnQubmFtZSB8fCBwYXRoLmJhc2VuYW1lKGRvY3VtZW50LmZpbGVQYXRoKTtcblxuICAgICAgICAgICAgLy8gSWYgdGhlIGZpbGVOYW1lIGRvZXNuJ3QgaGF2ZSBhbiBleHRlbnNpb24sIGFkZCBpdCBmcm9tIHRoZSBvcmlnaW5hbCBmaWxlIHBhdGhcbiAgICAgICAgICAgIGlmICghcGF0aC5leHRuYW1lKGZpbGVOYW1lKSAmJiBkb2N1bWVudC5maWxlUGF0aCkge1xuICAgICAgICAgICAgICBjb25zdCBvcmlnaW5hbEV4dCA9IHBhdGguZXh0bmFtZShkb2N1bWVudC5maWxlUGF0aCk7XG4gICAgICAgICAgICAgIGlmIChvcmlnaW5hbEV4dCkge1xuICAgICAgICAgICAgICAgIGZpbGVOYW1lICs9IG9yaWdpbmFsRXh0O1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gRmlsZSBkZXRhaWxzOmAsIHtcbiAgICAgICAgICAgICAgb3JpZ2luYWxGaWxlTmFtZTogZmlsZU5hbWUsXG4gICAgICAgICAgICAgIGlzRG93bmxvYWQsXG4gICAgICAgICAgICAgIGZpbGVQYXRoVG9TZXJ2ZSxcbiAgICAgICAgICAgICAgZmlsZVNpemU6IGZzLnN0YXRTeW5jKGZpbGVQYXRoVG9TZXJ2ZSkuc2l6ZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChpc0Rvd25sb2FkKSB7XG4gICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtRGlzcG9zaXRpb24nLCBgYXR0YWNobWVudDsgZmlsZW5hbWU9XCIke2ZpbGVOYW1lfVwiYCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LURpc3Bvc2l0aW9uJywgYGlubGluZTsgZmlsZW5hbWU9XCIke2ZpbGVOYW1lfVwiYCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIFNldCBhcHByb3ByaWF0ZSBjb250ZW50IHR5cGUgYmFzZWQgb24gZmlsZSBleHRlbnNpb25cbiAgICAgICAgICAgIGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShmaWxlTmFtZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5OlIFtET0NVTUVOVCBET1dOTE9BRF0gU2V0dGluZyBjb250ZW50IHR5cGUgZm9yIGV4dGVuc2lvbjogJHtleHR9YCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChleHQgPT09ICcucGRmJykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vcGRmJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4dCA9PT0gJy5qcGcnIHx8IGV4dCA9PT0gJy5qcGVnJykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnaW1hZ2UvanBlZycpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleHQgPT09ICcucG5nJykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnaW1hZ2UvcG5nJyk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGV4dCA9PT0gJy5naWYnKSB7XG4gICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdpbWFnZS9naWYnKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ID09PSAnLmRvYycgfHwgZXh0ID09PSAnLmRvY3gnKSB7XG4gICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoXG4gICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZScsXG4gICAgICAgICAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50J1xuICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChleHQgPT09ICcudHh0Jykge1xuICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAndGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBQcm9kdWN0aW9uIGNhY2hlIGJ1c3RpbmcgZm9yIGRvY3VtZW50c1xuICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgICAgICAgY29uc3QgZmlsZVN0YXRzID0gZnMuc3RhdFN5bmMoZmlsZVBhdGhUb1NlcnZlKTtcbiAgICAgICAgICAgICAgcmVzLnNldCh7XG4gICAgICAgICAgICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUsIG5vLXN0b3JlLCBtdXN0LXJldmFsaWRhdGUnLFxuICAgICAgICAgICAgICAgICdQcmFnbWEnOiAnbm8tY2FjaGUnLFxuICAgICAgICAgICAgICAgICdFeHBpcmVzJzogJzAnLFxuICAgICAgICAgICAgICAgICdFVGFnJzogYFwiJHtkb2N1bWVudC5pZH0tJHtmaWxlU3RhdHMubXRpbWUuZ2V0VGltZSgpfVwiYCxcbiAgICAgICAgICAgICAgICAnTGFzdC1Nb2RpZmllZCc6IGZpbGVTdGF0cy5tdGltZS50b1VUQ1N0cmluZygpLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc29sZS5sb2coYOKchSBbRE9DVU1FTlQgRE9XTkxPQURdIFNlcnZpbmcgZmlsZTogJHtmaWxlUGF0aFRvU2VydmV9IGFzICR7ZmlsZU5hbWV9YCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnNlbmRGaWxlKHBhdGgucmVzb2x2ZShmaWxlUGF0aFRvU2VydmUpKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBJZiBmaWxlIG5vdCBmb3VuZCBsb2NhbGx5LCBsb2cgZm9yIGRlYnVnZ2luZ1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBGaWxlIG5vdCBmb3VuZCBhdCBmaWxlUGF0aDogJHtkb2N1bWVudC5maWxlUGF0aH1gKTtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg4p2MIFtET0NVTUVOVCBET1dOTE9BRF0gVHJpZWQgZmlsZVBhdGg6ICR7ZmlsZVBhdGhUb1NlcnZlfWApO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdGaWxlIG5vdCBmb3VuZCBvbiBzZXJ2ZXInIH0pO1xuICAgICAgICB9IGNhdGNoIChmaWxlRXJyb3I6IGFueSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbRE9DVU1FTlQgRE9XTkxPQURdIEVycm9yIHNlcnZpbmcgZmlsZTonLCBmaWxlRXJyb3IpO1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gc2VydmUgZmlsZScgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYOKdjCBbRE9DVU1FTlQgRE9XTkxPQURdIE5vIGZpbGUgYXNzb2NpYXRlZCB3aXRoIGRvY3VtZW50ICR7ZG9jdW1lbnRJZH1gKTtcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdObyBmaWxlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGRvY3VtZW50JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW0RPQ1VNRU5UIERPV05MT0FEXSBFcnJvciBzZXJ2aW5nIGRvY3VtZW50IGZpbGU6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIHNlcnZlIGRvY3VtZW50IGZpbGUnIH0pO1xuICAgIH1cbiAgfSk7XG5cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==