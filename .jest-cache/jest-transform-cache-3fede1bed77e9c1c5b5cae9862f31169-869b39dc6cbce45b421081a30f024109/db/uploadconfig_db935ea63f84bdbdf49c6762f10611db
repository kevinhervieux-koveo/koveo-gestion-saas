30d6e91d94dca3f7f8fa071dc9eb1736
"use strict";
/**
 * Universal Upload Configuration System
 *
 * Defines AI analysis settings, storage directories, and form configurations
 * for all document upload functionality across the application.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.UPLOAD_FORM_CONFIGS = void 0;
exports.generateStorageDirectory = generateStorageDirectory;
exports.getUploadConfig = getUploadConfig;
exports.isAiAnalysisEnabled = isAiAnalysisEnabled;
exports.validateUploadContext = validateUploadContext;
/**
 * Configuration for each upload form type
 */
exports.UPLOAD_FORM_CONFIGS = {
    bills: {
        aiAnalysisEnabled: true, // Bills have AI enabled by default
        maxFileSize: 25,
        allowedFileTypes: ['image/*', 'application/pdf'],
        showCamera: true,
        contextFields: {
            category: 'string',
            vendor: 'string',
            amount: 'number',
            date: 'string'
        }
    },
    buildings: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 25,
        allowedFileTypes: ['image/*', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],
        showCamera: true,
        contextFields: {
            documentType: 'string',
            description: 'string'
        }
    },
    residences: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 25,
        allowedFileTypes: ['image/*', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],
        showCamera: true,
        contextFields: {
            documentType: 'string',
            description: 'string'
        }
    },
    bugs: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 15,
        allowedFileTypes: ['image/*', 'application/pdf', '.txt', '.log', '.json', '.csv'],
        showCamera: true,
        contextFields: {
            category: 'string',
            priority: 'string',
            steps: 'string'
        }
    },
    features: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 20,
        allowedFileTypes: ['image/*', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],
        showCamera: true,
        contextFields: {
            category: 'string',
            priority: 'string',
            description: 'string'
        }
    },
    documents: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 50,
        allowedFileTypes: ['image/*', 'application/pdf', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'],
        showCamera: true,
        contextFields: {
            category: 'string',
            accessLevel: 'string',
            description: 'string'
        }
    },
    maintenance: {
        aiAnalysisEnabled: false, // Disabled by default
        maxFileSize: 25,
        allowedFileTypes: ['image/*', 'application/pdf'],
        showCamera: true,
        contextFields: {
            priority: 'string',
            category: 'string',
            description: 'string'
        }
    }
};
/**
 * Generate secure storage directory path based on context and user role
 */
function generateStorageDirectory(context) {
    const { type, organizationId, buildingId, residenceId, userRole, userId } = context;
    // Base directory structure: uploads/{type}/{org_or_default}/{building?}/{residence?}/{user_role}
    const baseParts = ['uploads', type];
    // Organization level
    const orgId = organizationId || 'default';
    baseParts.push(`org_${orgId}`);
    // Building level (if applicable)
    if (buildingId) {
        baseParts.push(`building_${buildingId}`);
    }
    // Residence level (if applicable)
    if (residenceId) {
        baseParts.push(`residence_${residenceId}`);
    }
    // Role-based access control
    if (userRole) {
        baseParts.push(`role_${userRole}`);
    }
    // User-specific directory for private uploads (if needed)
    if (userRole === 'tenant' || userRole === 'resident') {
        baseParts.push(`user_${userId}`);
    }
    return baseParts.join('/');
}
/**
 * Get upload configuration for a specific form type
 */
function getUploadConfig(formType) {
    return exports.UPLOAD_FORM_CONFIGS[formType] || exports.UPLOAD_FORM_CONFIGS.documents;
}
/**
 * Check if AI analysis is enabled for a specific context
 */
function isAiAnalysisEnabled(formType) {
    const config = getUploadConfig(formType);
    return config.aiAnalysisEnabled;
}
/**
 * Validate upload context and ensure proper access control
 */
function validateUploadContext(context, userRole) {
    // Admin can upload to any context
    if (userRole === 'admin') {
        return true;
    }
    // Manager can upload to their organization's buildings and residences
    if (userRole === 'manager') {
        return !!context.organizationId;
    }
    // Resident can upload to their specific building/residence
    if (userRole === 'resident') {
        return !!(context.organizationId && (context.buildingId || context.residenceId));
    }
    // Tenant can only upload to their specific residence
    if (userRole === 'tenant') {
        return !!(context.organizationId && context.buildingId && context.residenceId);
    }
    return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zaGFyZWQvY29uZmlnL3VwbG9hZC1jb25maWcudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUE2R0gsNERBK0JDO0FBS0QsMENBRUM7QUFLRCxrREFHQztBQUtELHNEQXNCQztBQTlKRDs7R0FFRztBQUNVLFFBQUEsbUJBQW1CLEdBQXFDO0lBQ25FLEtBQUssRUFBRTtRQUNMLGlCQUFpQixFQUFFLElBQUksRUFBRSxtQ0FBbUM7UUFDNUQsV0FBVyxFQUFFLEVBQUU7UUFDZixnQkFBZ0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxpQkFBaUIsQ0FBQztRQUNoRCxVQUFVLEVBQUUsSUFBSTtRQUNoQixhQUFhLEVBQUU7WUFDYixRQUFRLEVBQUUsUUFBUTtZQUNsQixNQUFNLEVBQUUsUUFBUTtZQUNoQixNQUFNLEVBQUUsUUFBUTtZQUNoQixJQUFJLEVBQUUsUUFBUTtTQUNmO0tBQ0Y7SUFDRCxTQUFTLEVBQUU7UUFDVCxpQkFBaUIsRUFBRSxLQUFLLEVBQUUsc0JBQXNCO1FBQ2hELFdBQVcsRUFBRSxFQUFFO1FBQ2YsZ0JBQWdCLEVBQUUsQ0FBQyxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsb0JBQW9CLEVBQUUseUVBQXlFLENBQUM7UUFDakosVUFBVSxFQUFFLElBQUk7UUFDaEIsYUFBYSxFQUFFO1lBQ2IsWUFBWSxFQUFFLFFBQVE7WUFDdEIsV0FBVyxFQUFFLFFBQVE7U0FDdEI7S0FDRjtJQUNELFVBQVUsRUFBRTtRQUNWLGlCQUFpQixFQUFFLEtBQUssRUFBRSxzQkFBc0I7UUFDaEQsV0FBVyxFQUFFLEVBQUU7UUFDZixnQkFBZ0IsRUFBRSxDQUFDLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxvQkFBb0IsRUFBRSx5RUFBeUUsQ0FBQztRQUNqSixVQUFVLEVBQUUsSUFBSTtRQUNoQixhQUFhLEVBQUU7WUFDYixZQUFZLEVBQUUsUUFBUTtZQUN0QixXQUFXLEVBQUUsUUFBUTtTQUN0QjtLQUNGO0lBQ0QsSUFBSSxFQUFFO1FBQ0osaUJBQWlC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QUFlLENBQUMsUUFBZ0I7SUFDOUMsT0FBTywyQkFBbUIsQ0FBQyxRQUFRLENBQUMsSUFBSSwyQkFBbUIsQ0FBQyxTQUFTLENBQUM7QUFDeEUsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsbUJBQW1CLENBQUMsUUFBZ0I7SUFDbEQsTUFBTSxNQUFNLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQ3pDLE9BQU8sTUFBTSxDQUFDLGlCQUFpQixDQUFDO0FBQ2xDLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLHFCQUFxQixDQUFDLE9BQXNCLEVBQUUsUUFBZ0I7SUFDNUUsa0NBQWtDO0lBQ2xDLElBQUksUUFBUSxLQUFLLE9BQU8sRUFBRSxDQUFDO1FBQ3pCLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVELHNFQUFzRTtJQUN0RSxJQUFJLFFBQVEsS0FBSyxTQUFTLEVBQUUsQ0FBQztRQUMzQixPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxDQUFDO0lBQ2xDLENBQUM7SUFFRCwyREFBMkQ7SUFDM0QsSUFBSSxRQUFRLEtBQUssVUFBVSxFQUFFLENBQUM7UUFDNUIsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsY0FBYyxJQUFJLENBQUMsT0FBTyxDQUFDLFVBQVUsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztJQUNuRixDQUFDO0lBRUQscURBQXFEO0lBQ3JELElBQUksUUFBUSxLQUFLLFFBQVEsRUFBRSxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLGNBQWMsSUFBSSxPQUFPLENBQUMsVUFBVSxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztJQUNqRixDQUFDO0lBRUQsT0FBTyxLQUFLLENBQUM7QUFDZixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvc2hhcmVkL2NvbmZpZy91cGxvYWQtY29uZmlnLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVW5pdmVyc2FsIFVwbG9hZCBDb25maWd1cmF0aW9uIFN5c3RlbVxuICogXG4gKiBEZWZpbmVzIEFJIGFuYWx5c2lzIHNldHRpbmdzLCBzdG9yYWdlIGRpcmVjdG9yaWVzLCBhbmQgZm9ybSBjb25maWd1cmF0aW9uc1xuICogZm9yIGFsbCBkb2N1bWVudCB1cGxvYWQgZnVuY3Rpb25hbGl0eSBhY3Jvc3MgdGhlIGFwcGxpY2F0aW9uLlxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBsb2FkQ29udGV4dCB7XG4gIHR5cGU6ICdiaWxscycgfCAnYnVpbGRpbmdzJyB8ICdyZXNpZGVuY2VzJyB8ICdidWdzJyB8ICdmZWF0dXJlcycgfCAnZG9jdW1lbnRzJyB8ICdtYWludGVuYW5jZSc7XG4gIG9yZ2FuaXphdGlvbklkPzogc3RyaW5nO1xuICBidWlsZGluZ0lkPzogc3RyaW5nO1xuICByZXNpZGVuY2VJZD86IHN0cmluZztcbiAgdXNlclJvbGU/OiBzdHJpbmc7XG4gIHVzZXJJZD86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGxvYWRGb3JtQ29uZmlnIHtcbiAgLyoqIFdoZXRoZXIgQUkgYW5hbHlzaXMgaXMgZW5hYmxlZCBmb3IgdGhpcyBmb3JtIHR5cGUgKi9cbiAgYWlBbmFseXNpc0VuYWJsZWQ6IGJvb2xlYW47XG4gIC8qKiBDdXN0b20gZmllbGRzIHNwZWNpZmljIHRvIHRoaXMgdXBsb2FkIGNvbnRleHQgKi9cbiAgY29udGV4dEZpZWxkcz86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIC8qKiBNYXhpbXVtIGZpbGUgc2l6ZSBpbiBNQiAqL1xuICBtYXhGaWxlU2l6ZTogbnVtYmVyO1xuICAvKiogQWxsb3dlZCBmaWxlIHR5cGVzICovXG4gIGFsbG93ZWRGaWxlVHlwZXM6IHN0cmluZ1tdO1xuICAvKiogV2hldGhlciB0byBzaG93IGNhbWVyYSBvcHRpb24gZm9yIG1vYmlsZSB1cGxvYWRzICovXG4gIHNob3dDYW1lcmE6IGJvb2xlYW47XG59XG5cbi8qKlxuICogQ29uZmlndXJhdGlvbiBmb3IgZWFjaCB1cGxvYWQgZm9ybSB0eXBlXG4gKi9cbmV4cG9ydCBjb25zdCBVUExPQURfRk9STV9DT05GSUdTOiBSZWNvcmQ8c3RyaW5nLCBVcGxvYWRGb3JtQ29uZmlnPiA9IHtcbiAgYmlsbHM6IHtcbiAgICBhaUFuYWx5c2lzRW5hYmxlZDogdHJ1ZSwgLy8gQmlsbHMgaGF2ZSBBSSBlbmFibGVkIGJ5IGRlZmF1bHRcbiAgICBtYXhGaWxlU2l6ZTogMjUsXG4gICAgYWxsb3dlZEZpbGVUeXBlczogWydpbWFnZS8qJywgJ2FwcGxpY2F0aW9uL3BkZiddLFxuICAgIHNob3dDYW1lcmE6IHRydWUsXG4gICAgY29udGV4dEZpZWxkczoge1xuICAgICAgY2F0ZWdvcnk6ICdzdHJpbmcnLFxuICAgICAgdmVuZG9yOiAnc3RyaW5nJyxcbiAgICAgIGFtb3VudDogJ251bWJlcicsXG4gICAgICBkYXRlOiAnc3RyaW5nJ1xuICAgIH1cbiAgfSxcbiAgYnVpbGRpbmdzOiB7XG4gICAgYWlBbmFseXNpc0VuYWJsZWQ6IGZhbHNlLCAvLyBEaXNhYmxlZCBieSBkZWZhdWx0XG4gICAgbWF4RmlsZVNpemU6IDI1LFxuICAgIGFsbG93ZWRGaWxlVHlwZXM6IFsnaW1hZ2UvKicsICdhcHBsaWNhdGlvbi9wZGYnLCAnYXBwbGljYXRpb24vbXN3b3JkJywgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50J10sXG4gICAgc2hvd0NhbWVyYTogdHJ1ZSxcbiAgICBjb250ZXh0RmllbGRzOiB7XG4gICAgICBkb2N1bWVudFR5cGU6ICdzdHJpbmcnLFxuICAgICAgZGVzY3JpcHRpb246ICdzdHJpbmcnXG4gICAgfVxuICB9LFxuICByZXNpZGVuY2VzOiB7XG4gICAgYWlBbmFseXNpc0VuYWJsZWQ6IGZhbHNlLCAvLyBEaXNhYmxlZCBieSBkZWZhdWx0XG4gICAgbWF4RmlsZVNpemU6IDI1LFxuICAgIGFsbG93ZWRGaWxlVHlwZXM6IFsnaW1hZ2UvKicsICdhcHBsaWNhdGlvbi9wZGYnLCAnYXBwbGljYXRpb24vbXN3b3JkJywgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50J10sXG4gICAgc2hvd0NhbWVyYTogdHJ1ZSxcbiAgICBjb250ZXh0RmllbGRzOiB7XG4gICAgICBkb2N1bWVudFR5cGU6ICdzdHJpbmcnLFxuICAgICAgZGVzY3JpcHRpb246ICdzdHJpbmcnXG4gICAgfVxuICB9LFxuICBidWdzOiB7XG4gICAgYWlBbmFseXNpc0VuYWJsZWQ6IGZhbHNlLCAvLyBEaXNhYmxlZCBieSBkZWZhdWx0XG4gICAgbWF4RmlsZVNpemU6IDE1LFxuICAgIGFsbG93ZWRGaWxlVHlwZXM6IFsnaW1hZ2UvKicsICdhcHBsaWNhdGlvbi9wZGYnLCAnLnR4dCcsICcubG9nJywgJy5qc29uJywgJy5jc3YnXSxcbiAgICBzaG93Q2FtZXJhOiB0cnVlLFxuICAgIGNvbnRleHRGaWVsZHM6IHtcbiAgICAgIGNhdGVnb3J5OiAnc3RyaW5nJyxcbiAgICAgIHByaW9yaXR5OiAnc3RyaW5nJyxcbiAgICAgIHN0ZXBzOiAnc3RyaW5nJ1xuICAgIH1cbiAgfSxcbiAgZmVhdHVyZXM6IHtcbiAgICBhaUFuYWx5c2lzRW5hYmxlZDogZmFsc2UsIC8vIERpc2FibGVkIGJ5IGRlZmF1bHRcbiAgICBtYXhGaWxlU2l6ZTogMjAsXG4gICAgYWxsb3dlZEZpbGVUeXBlczogWydpbWFnZS8qJywgJ2FwcGxpY2F0aW9uL3BkZicsICdhcHBsaWNhdGlvbi9tc3dvcmQnLCAnYXBwbGljYXRpb24vdm5kLm9wZW54bWxmb3JtYXRzLW9mZmljZWRvY3VtZW50LndvcmRwcm9jZXNzaW5nbWwuZG9jdW1lbnQnXSxcbiAgICBzaG93Q2FtZXJhOiB0cnVlLFxuICAgIGNvbnRleHRGaWVsZHM6IHtcbiAgICAgIGNhdGVnb3J5OiAnc3RyaW5nJyxcbiAgICAgIHByaW9yaXR5OiAnc3RyaW5nJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnc3RyaW5nJ1xuICAgIH1cbiAgfSxcbiAgZG9jdW1lbnRzOiB7XG4gICAgYWlBbmFseXNpc0VuYWJsZWQ6IGZhbHNlLCAvLyBEaXNhYmxlZCBieSBkZWZhdWx0XG4gICAgbWF4RmlsZVNpemU6IDUwLFxuICAgIGFsbG93ZWRGaWxlVHlwZXM6IFsnaW1hZ2UvKicsICdhcHBsaWNhdGlvbi9wZGYnLCAnYXBwbGljYXRpb24vbXN3b3JkJywgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JywgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCcsICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCddLFxuICAgIHNob3dDYW1lcmE6IHRydWUsXG4gICAgY29udGV4dEZpZWxkczoge1xuICAgICAgY2F0ZWdvcnk6ICdzdHJpbmcnLFxuICAgICAgYWNjZXNzTGV2ZWw6ICdzdHJpbmcnLFxuICAgICAgZGVzY3JpcHRpb246ICdzdHJpbmcnXG4gICAgfVxuICB9LFxuICBtYWludGVuYW5jZToge1xuICAgIGFpQW5hbHlzaXNFbmFibGVkOiBmYWxzZSwgLy8gRGlzYWJsZWQgYnkgZGVmYXVsdFxuICAgIG1heEZpbGVTaXplOiAyNSxcbiAgICBhbGxvd2VkRmlsZVR5cGVzOiBbJ2ltYWdlLyonLCAnYXBwbGljYXRpb24vcGRmJ10sXG4gICAgc2hvd0NhbWVyYTogdHJ1ZSxcbiAgICBjb250ZXh0RmllbGRzOiB7XG4gICAgICBwcmlvcml0eTogJ3N0cmluZycsXG4gICAgICBjYXRlZ29yeTogJ3N0cmluZycsXG4gICAgICBkZXNjcmlwdGlvbjogJ3N0cmluZydcbiAgICB9XG4gIH1cbn07XG5cbi8qKlxuICogR2VuZXJhdGUgc2VjdXJlIHN0b3JhZ2UgZGlyZWN0b3J5IHBhdGggYmFzZWQgb24gY29udGV4dCBhbmQgdXNlciByb2xlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVN0b3JhZ2VEaXJlY3RvcnkoY29udGV4dDogVXBsb2FkQ29udGV4dCk6IHN0cmluZyB7XG4gIGNvbnN0IHsgdHlwZSwgb3JnYW5pemF0aW9uSWQsIGJ1aWxkaW5nSWQsIHJlc2lkZW5jZUlkLCB1c2VyUm9sZSwgdXNlcklkIH0gPSBjb250ZXh0O1xuICBcbiAgLy8gQmFzZSBkaXJlY3Rvcnkgc3RydWN0dXJlOiB1cGxvYWRzL3t0eXBlfS97b3JnX29yX2RlZmF1bHR9L3tidWlsZGluZz99L3tyZXNpZGVuY2U/fS97dXNlcl9yb2xlfVxuICBjb25zdCBiYXNlUGFydHMgPSBbJ3VwbG9hZHMnLCB0eXBlXTtcbiAgXG4gIC8vIE9yZ2FuaXphdGlvbiBsZXZlbFxuICBjb25zdCBvcmdJZCA9IG9yZ2FuaXphdGlvbklkIHx8ICdkZWZhdWx0JztcbiAgYmFzZVBhcnRzLnB1c2goYG9yZ18ke29yZ0lkfWApO1xuICBcbiAgLy8gQnVpbGRpbmcgbGV2ZWwgKGlmIGFwcGxpY2FibGUpXG4gIGlmIChidWlsZGluZ0lkKSB7XG4gICAgYmFzZVBhcnRzLnB1c2goYGJ1aWxkaW5nXyR7YnVpbGRpbmdJZH1gKTtcbiAgfVxuICBcbiAgLy8gUmVzaWRlbmNlIGxldmVsIChpZiBhcHBsaWNhYmxlKVxuICBpZiAocmVzaWRlbmNlSWQpIHtcbiAgICBiYXNlUGFydHMucHVzaChgcmVzaWRlbmNlXyR7cmVzaWRlbmNlSWR9YCk7XG4gIH1cbiAgXG4gIC8vIFJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2xcbiAgaWYgKHVzZXJSb2xlKSB7XG4gICAgYmFzZVBhcnRzLnB1c2goYHJvbGVfJHt1c2VyUm9sZX1gKTtcbiAgfVxuICBcbiAgLy8gVXNlci1zcGVjaWZpYyBkaXJlY3RvcnkgZm9yIHByaXZhdGUgdXBsb2FkcyAoaWYgbmVlZGVkKVxuICBpZiAodXNlclJvbGUgPT09ICd0ZW5hbnQnIHx8IHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgYmFzZVBhcnRzLnB1c2goYHVzZXJfJHt1c2VySWR9YCk7XG4gIH1cbiAgXG4gIHJldHVybiBiYXNlUGFydHMuam9pbignLycpO1xufVxuXG4vKipcbiAqIEdldCB1cGxvYWQgY29uZmlndXJhdGlvbiBmb3IgYSBzcGVjaWZpYyBmb3JtIHR5cGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFVwbG9hZENvbmZpZyhmb3JtVHlwZTogc3RyaW5nKTogVXBsb2FkRm9ybUNvbmZpZyB7XG4gIHJldHVybiBVUExPQURfRk9STV9DT05GSUdTW2Zvcm1UeXBlXSB8fCBVUExPQURfRk9STV9DT05GSUdTLmRvY3VtZW50cztcbn1cblxuLyoqXG4gKiBDaGVjayBpZiBBSSBhbmFseXNpcyBpcyBlbmFibGVkIGZvciBhIHNwZWNpZmljIGNvbnRleHRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzQWlBbmFseXNpc0VuYWJsZWQoZm9ybVR5cGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICBjb25zdCBjb25maWcgPSBnZXRVcGxvYWRDb25maWcoZm9ybVR5cGUpO1xuICByZXR1cm4gY29uZmlnLmFpQW5hbHlzaXNFbmFibGVkO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHVwbG9hZCBjb250ZXh0IGFuZCBlbnN1cmUgcHJvcGVyIGFjY2VzcyBjb250cm9sXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVVwbG9hZENvbnRleHQoY29udGV4dDogVXBsb2FkQ29udGV4dCwgdXNlclJvbGU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAvLyBBZG1pbiBjYW4gdXBsb2FkIHRvIGFueSBjb250ZXh0XG4gIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIFxuICAvLyBNYW5hZ2VyIGNhbiB1cGxvYWQgdG8gdGhlaXIgb3JnYW5pemF0aW9uJ3MgYnVpbGRpbmdzIGFuZCByZXNpZGVuY2VzXG4gIGlmICh1c2VyUm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgcmV0dXJuICEhY29udGV4dC5vcmdhbml6YXRpb25JZDtcbiAgfVxuICBcbiAgLy8gUmVzaWRlbnQgY2FuIHVwbG9hZCB0byB0aGVpciBzcGVjaWZpYyBidWlsZGluZy9yZXNpZGVuY2VcbiAgaWYgKHVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgcmV0dXJuICEhKGNvbnRleHQub3JnYW5pemF0aW9uSWQgJiYgKGNvbnRleHQuYnVpbGRpbmdJZCB8fCBjb250ZXh0LnJlc2lkZW5jZUlkKSk7XG4gIH1cbiAgXG4gIC8vIFRlbmFudCBjYW4gb25seSB1cGxvYWQgdG8gdGhlaXIgc3BlY2lmaWMgcmVzaWRlbmNlXG4gIGlmICh1c2VyUm9sZSA9PT0gJ3RlbmFudCcpIHtcbiAgICByZXR1cm4gISEoY29udGV4dC5vcmdhbml6YXRpb25JZCAmJiBjb250ZXh0LmJ1aWxkaW5nSWQgJiYgY29udGV4dC5yZXNpZGVuY2VJZCk7XG4gIH1cbiAgXG4gIHJldHVybiBmYWxzZTtcbn0iXSwidmVyc2lvbiI6M30=