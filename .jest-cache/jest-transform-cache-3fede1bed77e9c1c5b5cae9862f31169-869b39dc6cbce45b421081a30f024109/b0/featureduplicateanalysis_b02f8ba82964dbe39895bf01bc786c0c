283986b6ad315089bac0523f16fcd593
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.useFeatureDuplicateAnalysis = useFeatureDuplicateAnalysis;
exports.getDuplicateBadge = getDuplicateBadge;
exports.getDuplicateNote = getDuplicateNote;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const badge_1 = require("@/components/ui/badge");
const lucide_react_1 = require("lucide-react");
/**
 * Hook for analyzing feature duplicates and similarities.
 * @param features
 */
/**
 * UseFeatureDuplicateAnalysis function.
 * @param features
 * @returns Function result.
 */
function useFeatureDuplicateAnalysis(features) {
    const duplicateAnalysis = (0, react_1.useMemo)(() => {
        if (!features.length) {
            return new Map();
        }
        const analysis = new Map();
        features.forEach((feature, _index) => {
            const duplicates = [];
            let exactMatch = false;
            // Compare with all other features
            features.forEach((otherFeature, otherIndex) => {
                if (_index === otherIndex) {
                    return;
                }
                const nameMatch = feature.name.toLowerCase().trim() === otherFeature.name.toLowerCase().trim();
                const descMatch = feature.description?.toLowerCase().trim() ===
                    otherFeature.description?.toLowerCase().trim();
                // Check for exact duplicates (same name OR same description)
                if (nameMatch || (descMatch && feature.description && otherFeature.description)) {
                    duplicates.push(otherFeature);
                    exactMatch = true;
                }
                // Check for similar features (containing similar keywords)
                else {
                    const featureWords = feature.name
                        .toLowerCase()
                        .split(/\s+/)
                        .filter((w) => w.length > 3);
                    const otherWords = otherFeature.name
                        .toLowerCase()
                        .split(/\s+/)
                        .filter((w) => w.length > 3);
                    const commonWords = featureWords.filter((word) => otherWords.includes(word));
                    // If more than 50% of significant words match, consider it similar
                    if (featureWords.length > 0 && commonWords.length / featureWords.length > 0.5) {
                        duplicates.push(otherFeature);
                    }
                }
            });
            analysis.set(feature.id, {
                isDuplicate: duplicates.length > 0,
                duplicateCount: duplicates.length,
                duplicateFeatures: duplicates,
                similarityType: exactMatch ? 'exact' : duplicates.length > 0 ? 'similar' : 'none',
            });
        });
        return analysis;
    }, [features]);
    const duplicateStats = (0, react_1.useMemo)(() => {
        const exactDuplicates = Array.from(duplicateAnalysis.values()).filter((d) => d.similarityType === 'exact');
        const similarFeatures = Array.from(duplicateAnalysis.values()).filter((d) => d.similarityType === 'similar');
        return {
            totalExact: exactDuplicates.length,
            totalSimilar: similarFeatures.length,
            totalWithDuplicates: Array.from(duplicateAnalysis.values()).filter((d) => d.isDuplicate)
                .length,
        };
    }, [duplicateAnalysis]);
    return { duplicateAnalysis, duplicateStats };
}
/**
 * Gets duplicate badge for a feature.
 * @param featureId
 * @param duplicateAnalysis
 */
/**
 * GetDuplicateBadge function.
 * @param featureId
 * @param duplicateAnalysis
 * @returns Function result.
 */
function getDuplicateBadge(featureId, duplicateAnalysis) {
    if (!duplicateAnalysis) {
        return null;
    }
    const dupInfo = duplicateAnalysis.get(featureId);
    if (!dupInfo || !dupInfo.isDuplicate) {
        return null;
    }
    if (dupInfo.similarityType === 'exact') {
        return ((0, jsx_runtime_1.jsxs)(badge_1.Badge, { className: 'bg-red-100 text-red-800 hover:bg-red-100 ml-2 flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.AlertTriangle, { className: 'h-3 w-3' }), "Exact Duplicate (", dupInfo.duplicateCount, ")"] }));
    }
    else {
        return ((0, jsx_runtime_1.jsxs)(badge_1.Badge, { className: 'bg-orange-100 text-orange-800 hover:bg-orange-100 ml-2 flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Copy, { className: 'h-3 w-3' }), "Similar (", dupInfo.duplicateCount, ")"] }));
    }
}
/**
 * Gets duplicate note text for a feature.
 * @param featureId
 * @param duplicateAnalysis
 */
/**
 * GetDuplicateNote function.
 * @param featureId
 * @param duplicateAnalysis
 * @returns Function result.
 */
function getDuplicateNote(featureId, duplicateAnalysis) {
    if (!duplicateAnalysis) {
        return null;
    }
    const dupInfo = duplicateAnalysis.get(featureId);
    if (!dupInfo || !dupInfo.isDuplicate) {
        return null;
    }
    const duplicateNames = dupInfo.duplicateFeatures.map((f) => f.name).join(', ');
    if (dupInfo.similarityType === 'exact') {
        return `‚ö†Ô∏è This feature has ${dupInfo.duplicateCount} exact ${dupInfo.duplicateCount === 1 ? 'duplicate' : 'duplicates'}: ${duplicateNames}`;
    }
    else {
        return `üìã This feature is similar to ${dupInfo.duplicateCount} other ${dupInfo.duplicateCount === 1 ? 'feature' : 'features'}: ${duplicateNames}`;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvcm9hZG1hcC9mZWF0dXJlLWR1cGxpY2F0ZS1hbmFseXNpcy50c3giLCJtYXBwaW5ncyI6Ijs7QUErQkEsa0VBNkVDO0FBYUQsOENBMkJDO0FBYUQsNENBbUJDOztBQXBMRCxpQ0FBZ0M7QUFDaEMsaURBQThDO0FBQzlDLCtDQUFtRDtBQW9CbkQ7OztHQUdHO0FBQ0g7Ozs7R0FJRztBQUNILFNBQWdCLDJCQUEyQixDQUFDLFFBQW1CO0lBQzdELE1BQU0saUJBQWlCLEdBQUcsSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO1FBQ3JDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDckIsT0FBTyxJQUFJLEdBQUcsRUFBeUIsQ0FBQztRQUMxQyxDQUFDO1FBRUQsTUFBTSxRQUFRLEdBQUcsSUFBSSxHQUFHLEVBQXlCLENBQUM7UUFFbEQsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLE9BQWdCLEVBQUUsTUFBYyxFQUFFLEVBQUU7WUFDcEQsTUFBTSxVQUFVLEdBQWMsRUFBRSxDQUFDO1lBQ2pDLElBQUksVUFBVSxHQUFHLEtBQUssQ0FBQztZQUV2QixrQ0FBa0M7WUFDbEMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFlBQXFCLEVBQUUsVUFBa0IsRUFBRSxFQUFFO2dCQUM3RCxJQUFJLE1BQU0sS0FBSyxVQUFVLEVBQUUsQ0FBQztvQkFDMUIsT0FBTztnQkFDVCxDQUFDO2dCQUVELE1BQU0sU0FBUyxHQUNiLE9BQU8sQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxFQUFFLEtBQUssWUFBWSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDL0UsTUFBTSxTQUFTLEdBQ2IsT0FBTyxDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsQ0FBQyxJQUFJLEVBQUU7b0JBQ3pDLFlBQVksQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLENBQUMsSUFBSSxF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QUUsQ0FBQztRQUNyQyxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFFRCxNQUFNLGNBQWMsR0FBRyxPQUFPLENBQUMsaUJBQWlCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRS9FLElBQUksT0FBTyxDQUFDLGNBQWMsS0FBSyxPQUFPLEVBQUUsQ0FBQztRQUN2QyxPQUFPLHVCQUF1QixPQUFPLENBQUMsY0FBYyxVQUFVLE9BQU8sQ0FBQyxjQUFjLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFlBQVksS0FBSyxjQUFjLEVBQUUsQ0FBQztJQUMvSSxDQUFDO1NBQU0sQ0FBQztRQUNOLE9BQU8saUNBQWlDLE9BQU8sQ0FBQyxjQUFjLFVBQVUsT0FBTyxDQUFDLGNBQWMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsVUFBVSxLQUFLLGNBQWMsRUFBRSxDQUFDO0lBQ3JKLENBQUM7QUFDSCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvY2xpZW50L3NyYy9jb21wb25lbnRzL3JvYWRtYXAvZmVhdHVyZS1kdXBsaWNhdGUtYW5hbHlzaXMudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBCYWRnZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9iYWRnZSc7XG5pbXBvcnQgeyBBbGVydFRyaWFuZ2xlLCBDb3B5IH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB0eXBlIHsgRmVhdHVyZSB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcblxuLyoqXG4gKiBEdXBsaWNhdGUgYW5hbHlzaXMgcmVzdWx0IGZvciBhIGZlYXR1cmUuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRHVwbGljYXRlSW5mbyB7XG4gIGlzRHVwbGljYXRlOiBib29sZWFuO1xuICBkdXBsaWNhdGVDb3VudDogbnVtYmVyO1xuICBkdXBsaWNhdGVGZWF0dXJlczogRmVhdHVyZVtdO1xuICBzaW1pbGFyaXR5VHlwZTogJ2V4YWN0JyB8ICdzaW1pbGFyJyB8ICdub25lJztcbn1cblxuLyoqXG4gKiBQcm9wcyBmb3IgZHVwbGljYXRlIGFuYWx5c2lzIGNvbXBvbmVudC5cbiAqL1xuaW50ZXJmYWNlIEZlYXR1cmVEdXBsaWNhdGVBbmFseXNpc1Byb3BzIHtcbiAgZmVhdHVyZXM6IEZlYXR1cmVbXTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBhbmFseXppbmcgZmVhdHVyZSBkdXBsaWNhdGVzIGFuZCBzaW1pbGFyaXRpZXMuXG4gKiBAcGFyYW0gZmVhdHVyZXNcbiAqL1xuLyoqXG4gKiBVc2VGZWF0dXJlRHVwbGljYXRlQW5hbHlzaXMgZnVuY3Rpb24uXG4gKiBAcGFyYW0gZmVhdHVyZXNcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUZlYXR1cmVEdXBsaWNhdGVBbmFseXNpcyhmZWF0dXJlczogRmVhdHVyZVtdKSB7XG4gIGNvbnN0IGR1cGxpY2F0ZUFuYWx5c2lzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFmZWF0dXJlcy5sZW5ndGgpIHtcbiAgICAgIHJldHVybiBuZXcgTWFwPHN0cmluZywgRHVwbGljYXRlSW5mbz4oKTtcbiAgICB9XG5cbiAgICBjb25zdCBhbmFseXNpcyA9IG5ldyBNYXA8c3RyaW5nLCBEdXBsaWNhdGVJbmZvPigpO1xuXG4gICAgZmVhdHVyZXMuZm9yRWFjaCgoZmVhdHVyZTogRmVhdHVyZSwgX2luZGV4OiBudW1iZXIpID0+IHtcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZXM6IEZlYXR1cmVbXSA9IFtdO1xuICAgICAgbGV0IGV4YWN0TWF0Y2ggPSBmYWxzZTtcblxuICAgICAgLy8gQ29tcGFyZSB3aXRoIGFsbCBvdGhlciBmZWF0dXJlc1xuICAgICAgZmVhdHVyZXMuZm9yRWFjaCgob3RoZXJGZWF0dXJlOiBGZWF0dXJlLCBvdGhlckluZGV4OiBudW1iZXIpID0+IHtcbiAgICAgICAgaWYgKF9pbmRleCA9PT0gb3RoZXJJbmRleCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG5hbWVNYXRjaCA9XG4gICAgICAgICAgZmVhdHVyZS5uYW1lLnRvTG93ZXJDYXNlKCkudHJpbSgpID09PSBvdGhlckZlYXR1cmUubmFtZS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICAgICAgY29uc3QgZGVzY01hdGNoID1cbiAgICAgICAgICBmZWF0dXJlLmRlc2NyaXB0aW9uPy50b0xvd2VyQ2FzZSgpLnRyaW0oKSA9PT1cbiAgICAgICAgICBvdGhlckZlYXR1cmUuZGVzY3JpcHRpb24/LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBleGFjdCBkdXBsaWNhdGVzIChzYW1lIG5hbWUgT1Igc2FtZSBkZXNjcmlwdGlvbilcbiAgICAgICAgaWYgKG5hbWVNYXRjaCB8fCAoZGVzY01hdGNoICYmIGZlYXR1cmUuZGVzY3JpcHRpb24gJiYgb3RoZXJGZWF0dXJlLmRlc2NyaXB0aW9uKSkge1xuICAgICAgICAgIGR1cGxpY2F0ZXMucHVzaChvdGhlckZlYXR1cmUpO1xuICAgICAgICAgIGV4YWN0TWF0Y2ggPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrIGZvciBzaW1pbGFyIGZlYXR1cmVzIChjb250YWluaW5nIHNpbWlsYXIga2V5d29yZHMpXG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGZlYXR1cmVXb3JkcyA9IGZlYXR1cmUubmFtZVxuICAgICAgICAgICAgLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgIC5zcGxpdCgvXFxzKy8pXG4gICAgICAgICAgICAuZmlsdGVyKCh3OiBzdHJpbmcpID0+IHcubGVuZ3RoID4gMyk7XG4gICAgICAgICAgY29uc3Qgb3RoZXJXb3JkcyA9IG90aGVyRmVhdHVyZS5uYW1lXG4gICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgLnNwbGl0KC9cXHMrLylcbiAgICAgICAgICAgIC5maWx0ZXIoKHc6IHN0cmluZykgPT4gdy5sZW5ndGggPiAzKTtcblxuICAgICAgICAgIGNvbnN0IGNvbW1vbldvcmRzID0gZmVhdHVyZVdvcmRzLmZpbHRlcigod29yZDogc3RyaW5nKSA9PiBvdGhlcldvcmRzLmluY2x1ZGVzKHdvcmQpKTtcblxuICAgICAgICAgIC8vIElmIG1vcmUgdGhhbiA1MCUgb2Ygc2lnbmlmaWNhbnQgd29yZHMgbWF0Y2gsIGNvbnNpZGVyIGl0IHNpbWlsYXJcbiAgICAgICAgICBpZiAoZmVhdHVyZVdvcmRzLmxlbmd0aCA+IDAgJiYgY29tbW9uV29yZHMubGVuZ3RoIC8gZmVhdHVyZVdvcmRzLmxlbmd0aCA+IDAuNSkge1xuICAgICAgICAgICAgZHVwbGljYXRlcy5wdXNoKG90aGVyRmVhdHVyZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgYW5hbHlzaXMuc2V0KGZlYXR1cmUuaWQsIHtcbiAgICAgICAgaXNEdXBsaWNhdGU6IGR1cGxpY2F0ZXMubGVuZ3RoID4gMCxcbiAgICAgICAgZHVwbGljYXRlQ291bnQ6IGR1cGxpY2F0ZXMubGVuZ3RoLFxuICAgICAgICBkdXBsaWNhdGVGZWF0dXJlczogZHVwbGljYXRlcyxcbiAgICAgICAgc2ltaWxhcml0eVR5cGU6IGV4YWN0TWF0Y2ggPyAnZXhhY3QnIDogZHVwbGljYXRlcy5sZW5ndGggPiAwID8gJ3NpbWlsYXInIDogJ25vbmUnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYW5hbHlzaXM7XG4gIH0sIFtmZWF0dXJlc10pO1xuXG4gIGNvbnN0IGR1cGxpY2F0ZVN0YXRzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgY29uc3QgZXhhY3REdXBsaWNhdGVzID0gQXJyYXkuZnJvbShkdXBsaWNhdGVBbmFseXNpcy52YWx1ZXMoKSkuZmlsdGVyKFxuICAgICAgKGQpID0+IGQuc2ltaWxhcml0eVR5cGUgPT09ICdleGFjdCdcbiAgICApO1xuICAgIGNvbnN0IHNpbWlsYXJGZWF0dXJlcyA9IEFycmF5LmZyb20oZHVwbGljYXRlQW5hbHlzaXMudmFsdWVzKCkpLmZpbHRlcihcbiAgICAgIChkKSA9PiBkLnNpbWlsYXJpdHlUeXBlID09PSAnc2ltaWxhcidcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsRXhhY3Q6IGV4YWN0RHVwbGljYXRlcy5sZW5ndGgsXG4gICAgICB0b3RhbFNpbWlsYXI6IHNpbWlsYXJGZWF0dXJlcy5sZW5ndGgsXG4gICAgICB0b3RhbFdpdGhEdXBsaWNhdGVzOiBBcnJheS5mcm9tKGR1cGxpY2F0ZUFuYWx5c2lzLnZhbHVlcygpKS5maWx0ZXIoKGQpID0+IGQuaXNEdXBsaWNhdGUpXG4gICAgICAgIC5sZW5ndGgsXG4gICAgfTtcbiAgfSwgW2R1cGxpY2F0ZUFuYWx5c2lzXSk7XG5cbiAgcmV0dXJuIHsgZHVwbGljYXRlQW5hbHlzaXMsIGR1cGxpY2F0ZVN0YXRzIH07XG59XG5cbi8qKlxuICogR2V0cyBkdXBsaWNhdGUgYmFkZ2UgZm9yIGEgZmVhdHVyZS5cbiAqIEBwYXJhbSBmZWF0dXJlSWRcbiAqIEBwYXJhbSBkdXBsaWNhdGVBbmFseXNpc1xuICovXG4vKipcbiAqIEdldER1cGxpY2F0ZUJhZGdlIGZ1bmN0aW9uLlxuICogQHBhcmFtIGZlYXR1cmVJZFxuICogQHBhcmFtIGR1cGxpY2F0ZUFuYWx5c2lzXG4gKiBAcmV0dXJucyBGdW5jdGlvbiByZXN1bHQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREdXBsaWNhdGVCYWRnZShcbiAgZmVhdHVyZUlkOiBzdHJpbmcsXG4gIGR1cGxpY2F0ZUFuYWx5c2lzOiBNYXA8c3RyaW5nLCBEdXBsaWNhdGVJbmZvPiB8IHVuZGVmaW5lZFxuKSB7XG4gIGlmICghZHVwbGljYXRlQW5hbHlzaXMpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBkdXBJbmZvID0gZHVwbGljYXRlQW5hbHlzaXMuZ2V0KGZlYXR1cmVJZCk7XG4gIGlmICghZHVwSW5mbyB8fCAhZHVwSW5mby5pc0R1cGxpY2F0ZSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgaWYgKGR1cEluZm8uc2ltaWxhcml0eVR5cGUgPT09ICdleGFjdCcpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPEJhZGdlIGNsYXNzTmFtZT0nYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAgaG92ZXI6YmctcmVkLTEwMCBtbC0yIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xJz5cbiAgICAgICAgPEFsZXJ0VHJpYW5nbGUgY2xhc3NOYW1lPSdoLTMgdy0zJyAvPlxuICAgICAgICBFeGFjdCBEdXBsaWNhdGUgKHtkdXBJbmZvLmR1cGxpY2F0ZUNvdW50fSlcbiAgICAgIDwvQmFkZ2U+XG4gICAgKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gKFxuICAgICAgPEJhZGdlIGNsYXNzTmFtZT0nYmctb3JhbmdlLTEwMCB0ZXh0LW9yYW5nZS04MDAgaG92ZXI6Ymctb3JhbmdlLTEwMCBtbC0yIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xJz5cbiAgICAgICAgPENvcHkgY2xhc3NOYW1lPSdoLTMgdy0zJyAvPlxuICAgICAgICBTaW1pbGFyICh7ZHVwSW5mby5kdXBsaWNhdGVDb3VudH0pXG4gICAgICA8L0JhZGdlPlxuICAgICk7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXRzIGR1cGxpY2F0ZSBub3RlIHRleHQgZm9yIGEgZmVhdHVyZS5cbiAqIEBwYXJhbSBmZWF0dXJlSWRcbiAqIEBwYXJhbSBkdXBsaWNhdGVBbmFseXNpc1xuICovXG4vKipcbiAqIEdldER1cGxpY2F0ZU5vdGUgZnVuY3Rpb24uXG4gKiBAcGFyYW0gZmVhdHVyZUlkXG4gKiBAcGFyYW0gZHVwbGljYXRlQW5hbHlzaXNcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldER1cGxpY2F0ZU5vdGUoXG4gIGZlYXR1cmVJZDogc3RyaW5nLFxuICBkdXBsaWNhdGVBbmFseXNpczogTWFwPHN0cmluZywgRHVwbGljYXRlSW5mbz4gfCB1bmRlZmluZWRcbikge1xuICBpZiAoIWR1cGxpY2F0ZUFuYWx5c2lzKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgZHVwSW5mbyA9IGR1cGxpY2F0ZUFuYWx5c2lzLmdldChmZWF0dXJlSWQpO1xuICBpZiAoIWR1cEluZm8gfHwgIWR1cEluZm8uaXNEdXBsaWNhdGUpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IGR1cGxpY2F0ZU5hbWVzID0gZHVwSW5mby5kdXBsaWNhdGVGZWF0dXJlcy5tYXAoKGYpID0+IGYubmFtZSkuam9pbignLCAnKTtcblxuICBpZiAoZHVwSW5mby5zaW1pbGFyaXR5VHlwZSA9PT0gJ2V4YWN0Jykge1xuICAgIHJldHVybiBg4pqg77iPIFRoaXMgZmVhdHVyZSBoYXMgJHtkdXBJbmZvLmR1cGxpY2F0ZUNvdW50fSBleGFjdCAke2R1cEluZm8uZHVwbGljYXRlQ291bnQgPT09IDEgPyAnZHVwbGljYXRlJyA6ICdkdXBsaWNhdGVzJ306ICR7ZHVwbGljYXRlTmFtZXN9YDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYPCfk4sgVGhpcyBmZWF0dXJlIGlzIHNpbWlsYXIgdG8gJHtkdXBJbmZvLmR1cGxpY2F0ZUNvdW50fSBvdGhlciAke2R1cEluZm8uZHVwbGljYXRlQ291bnQgPT09IDEgPyAnZmVhdHVyZScgOiAnZmVhdHVyZXMnfTogJHtkdXBsaWNhdGVOYW1lc31gO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=