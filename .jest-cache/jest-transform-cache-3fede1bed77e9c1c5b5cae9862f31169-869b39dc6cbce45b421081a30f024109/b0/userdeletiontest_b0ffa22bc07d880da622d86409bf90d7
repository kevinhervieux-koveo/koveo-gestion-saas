bf41c6aafb46dd1ec286a15621cce04f
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const express_1 = __importDefault(require("express"));
const supertest_1 = __importDefault(require("supertest"));
const routes_1 = require("../../../server/routes");
const db_1 = require("../../../server/db");
const schema = __importStar(require("../../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const bcryptjs_1 = __importDefault(require("bcryptjs"));
/**
 * User Deletion Test Suite
 *
 * Tests complete user deletion functionality including:
 * - Complete record removal (not marking inactive)
 * - Authentication requirements
 * - Admin vs self-deletion permissions
 * - Related data cleanup
 * - Error handling for non-existent users
 */
// Create test app
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    (0, routes_1.registerRoutes)(app);
    return app;
};
(0, globals_1.describe)('User Deletion', () => {
    let app;
    let testUser;
    let adminUser;
    let testOrganization;
    let authCookie;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Clean up any existing test data
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'test-deletion@example.com'));
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'admin-test@example.com'));
        // Create test organization
        testOrganization = await db_1.db
            .insert(schema.organizations)
            .values({
            name: 'Test Deletion Org',
            type: 'syndicate',
            address: '456 Delete St',
            city: 'Quebec City',
            province: 'QC',
            postalCode: 'G1A 1A1',
        })
            .returning();
        // Create admin user for testing admin deletion
        adminUser = await db_1.db
            .insert(schema.users)
            .values({
            username: 'admintest',
            email: 'admin-test@example.com',
            firstName: 'Admin',
            lastName: 'Test',
            password: await bcryptjs_1.default.hash('AdminPass123!', 12),
            role: 'admin',
        })
            .returning();
        // Create test user to be deleted
        testUser = await db_1.db
            .insert(schema.users)
            .values({
            username: 'testdeletion',
            email: 'test-deletion@example.com',
            firstName: 'Delete',
            lastName: 'Me',
            password: await bcryptjs_1.default.hash('DeletePass123!', 12),
            role: 'manager',
        })
            .returning();
        // Create user-organization relationship
        await db_1.db.insert(schema.userOrganizations).values({
            userId: testUser[0].id,
            organizationId: testOrganization[0].id,
        });
        // Authenticate as admin for admin deletion tests
        const loginResponse = await (0, supertest_1.default)(app)
            .post('/api/auth/login')
            .send({
            email: 'admin-test@example.com',
            password: 'AdminPass123!',
        });
        authCookie = loginResponse.headers['set-cookie'][0];
    });
    (0, globals_1.afterEach)(async () => {
        // Clean up test data
        if (testUser?.[0]?.id) {
            await db_1.db.delete(schema.userOrganizations).where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, testUser[0].id));
        }
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'test-deletion@example.com'));
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'admin-test@example.com'));
        if (testOrganization?.[0]?.id) {
            await db_1.db.delete(schema.organizations).where((0, drizzle_orm_1.eq)(schema.organizations.id, testOrganization[0].id));
        }
    });
    (0, globals_1.describe)('Admin User Deletion', () => {
        (0, globals_1.it)('should completely remove user record from database', async () => {
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User account deleted successfully',
                success: true,
            });
            // Verify user is completely removed from database
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
        });
        (0, globals_1.it)('should remove user-organization relationships', async () => {
            await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .expect(200);
            // Verify user-organization relationships are removed
            const userOrgs = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, testUser[0].id));
            (0, globals_1.expect)(userOrgs).toHaveLength(0);
        });
        (0, globals_1.it)('should require authentication for admin deletion', async () => {
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .expect(401);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Authentication required',
                code: 'AUTH_REQUIRED',
            });
        });
        (0, globals_1.it)('should return error for non-existent user deletion', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/users/non-existent-user-id/delete-account')
                .set('Cookie', authCookie)
                .expect(404);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User not found',
                code: 'USER_NOT_FOUND',
            });
        });
        (0, globals_1.it)('should require valid user ID parameter', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/users//delete-account')
                .set('Cookie', authCookie)
                .expect(400);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User ID is required',
                code: 'MISSING_USER_ID',
            });
        });
    });
    (0, globals_1.describe)('Self Deletion', () => {
        let userAuthCookie;
        (0, globals_1.beforeEach)(async () => {
            // Login as the test user for self-deletion tests
            const userLoginResponse = await (0, supertest_1.default)(app)
                .post('/api/auth/login')
                .send({
                email: 'test-deletion@example.com',
                password: 'DeletePass123!',
            });
            userAuthCookie = userLoginResponse.headers['set-cookie'][0];
        });
        (0, globals_1.it)('should allow user to delete their own account', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/users/me/delete-account')
                .set('Cookie', userAuthCookie)
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Your account has been deleted successfully',
                success: true,
            });
            // Verify user is completely removed
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
        });
        (0, globals_1.it)('should require authentication for self deletion', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/users/me/delete-account')
                .expect(401);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Authentication required',
                code: 'AUTH_REQUIRED',
            });
        });
        (0, globals_1.it)('should clear session after self deletion', async () => {
            await (0, supertest_1.default)(app)
                .post('/api/users/me/delete-account')
                .set('Cookie', userAuthCookie)
                .expect(200);
            // Try to access protected endpoint with same cookie
            const protectedResponse = await (0, supertest_1.default)(app)
                .get('/api/users/me/organizations')
                .set('Cookie', userAuthCookie)
                .expect(401);
            (0, globals_1.expect)(protectedResponse.body).toMatchObject({
                message: 'Authentication required',
            });
        });
    });
    (0, globals_1.describe)('Data Integrity', () => {
        (0, globals_1.it)('should maintain referential integrity after user deletion', async () => {
            // Create some related data
            const invitation = await db_1.db
                .insert(schema.invitations)
                .values({
                email: 'related-invite@example.com',
                token: 'related-token',
                tokenHash: 'hash123',
                role: 'tenant',
                organizationId: testOrganization[0].id,
                invitedByUserId: testUser[0].id,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
                status: 'pending',
            })
                .returning();
            // Delete the user
            await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .expect(200);
            // Verify related invitation still exists but references are handled properly
            const relatedInvitation = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, invitation[0].id))
                .limit(1);
            (0, globals_1.expect)(relatedInvitation).toHaveLength(1);
            (0, globals_1.expect)(relatedInvitation[0].invitedByUserId).toBe(testUser[0].id);
            // Clean up
            await db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, invitation[0].id));
        });
    });
    (0, globals_1.describe)('Foreign Key Constraint Handling', () => {
        let testBuilding;
        let testResidence;
        (0, globals_1.beforeEach)(async () => {
            // Create test building
            testBuilding = await db_1.db
                .insert(schema.buildings)
                .values({
                name: 'Test Building',
                address: '123 Test St',
                city: 'Test City',
                province: 'QC',
                postalCode: 'H1A 1A1',
                buildingType: 'apartment',
                totalUnits: 100,
                organizationId: testOrganization[0].id,
            })
                .returning();
            // Create test residence
            testResidence = await db_1.db
                .insert(schema.residences)
                .values({
                unitNumber: '101',
                buildingId: testBuilding[0].id,
            })
                .returning();
        });
        (0, globals_1.afterEach)(async () => {
            // Clean up test data
            if (testResidence?.[0]?.id) {
                await db_1.db.delete(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence[0].id));
            }
            if (testBuilding?.[0]?.id) {
                await db_1.db.delete(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.id, testBuilding[0].id));
            }
        });
        (0, globals_1.it)('should handle user deletion with demands and demand comments', async () => {
            // Create a demand submitted by the test user
            const demand = await db_1.db
                .insert(schema.demands)
                .values({
                submitterId: testUser[0].id,
                type: 'maintenance',
                description: 'Test demand for deletion',
                buildingId: testBuilding[0].id,
                residenceId: testResidence[0].id,
                status: 'submitted',
            })
                .returning();
            // Create a comment on the demand
            const comment = await db_1.db
                .insert(schema.demandComments)
                .values({
                demandId: demand[0].id,
                commenterId: testUser[0].id,
                commentText: 'Test comment for deletion',
                commentType: 'general',
            })
                .returning();
            // Verify the demand and comment exist
            const existingDemand = await db_1.db
                .select()
                .from(schema.demands)
                .where((0, drizzle_orm_1.eq)(schema.demands.id, demand[0].id))
                .limit(1);
            const existingComment = await db_1.db
                .select()
                .from(schema.demandComments)
                .where((0, drizzle_orm_1.eq)(schema.demandComments.id, comment[0].id))
                .limit(1);
            (0, globals_1.expect)(existingDemand).toHaveLength(1);
            (0, globals_1.expect)(existingComment).toHaveLength(1);
            // Delete the user - this should now succeed
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .send({
                confirmEmail: testUser[0].email,
                reason: 'Testing foreign key constraint handling',
            })
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User account and all associated data have been permanently deleted',
                deletedUserId: testUser[0].id,
                deletedUserEmail: testUser[0].email,
            });
            // Verify the user is deleted
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
            // Verify the demand and comment are also deleted
            const deletedDemand = await db_1.db
                .select()
                .from(schema.demands)
                .where((0, drizzle_orm_1.eq)(schema.demands.id, demand[0].id))
                .limit(1);
            const deletedComment = await db_1.db
                .select()
                .from(schema.demandComments)
                .where((0, drizzle_orm_1.eq)(schema.demandComments.id, comment[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedDemand).toHaveLength(0);
            (0, globals_1.expect)(deletedComment).toHaveLength(0);
        });
        (0, globals_1.it)('should handle user deletion with bugs and feature requests', async () => {
            // Create a bug submitted by the test user
            const bug = await db_1.db
                .insert(schema.bugs)
                .values({
                createdBy: testUser[0].id,
                title: 'Test Bug',
                description: 'Test bug for deletion',
                category: 'functionality',
                page: '/test-page',
                priority: 'medium',
                status: 'new',
            })
                .returning();
            // Create a feature request submitted by the test user
            const featureRequest = await db_1.db
                .insert(schema.featureRequests)
                .values({
                createdBy: testUser[0].id,
                title: 'Test Feature Request',
                description: 'Test feature request for deletion',
                need: 'Testing feature deletion',
                category: 'dashboard',
                page: '/test-page',
                status: 'submitted',
            })
                .returning();
            // Create an upvote by the test user
            const upvote = await db_1.db
                .insert(schema.featureRequestUpvotes)
                .values({
                featureRequestId: featureRequest[0].id,
                userId: testUser[0].id,
            })
                .returning();
            // Verify they exist
            const existingBug = await db_1.db
                .select()
                .from(schema.bugs)
                .where((0, drizzle_orm_1.eq)(schema.bugs.id, bug[0].id))
                .limit(1);
            const existingFeatureRequest = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequest[0].id))
                .limit(1);
            const existingUpvote = await db_1.db
                .select()
                .from(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.id, upvote[0].id))
                .limit(1);
            (0, globals_1.expect)(existingBug).toHaveLength(1);
            (0, globals_1.expect)(existingFeatureRequest).toHaveLength(1);
            (0, globals_1.expect)(existingUpvote).toHaveLength(1);
            // Delete the user
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .send({
                confirmEmail: testUser[0].email,
                reason: 'Testing bug and feature request deletion',
            })
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User account and all associated data have been permanently deleted',
            });
            // Verify the user is deleted
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
            // Verify the bug, feature request, and upvote are also deleted
            const deletedBug = await db_1.db
                .select()
                .from(schema.bugs)
                .where((0, drizzle_orm_1.eq)(schema.bugs.id, bug[0].id))
                .limit(1);
            const deletedFeatureRequest = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequest[0].id))
                .limit(1);
            const deletedUpvote = await db_1.db
                .select()
                .from(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.id, upvote[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedBug).toHaveLength(0);
            (0, globals_1.expect)(deletedFeatureRequest).toHaveLength(0);
            (0, globals_1.expect)(deletedUpvote).toHaveLength(0);
        });
        (0, globals_1.it)('should reproduce the original error scenario and verify fix', async () => {
            // This test reproduces the exact scenario from the user's screenshot
            // Create a demand that would cause the foreign key constraint error
            const demand = await db_1.db
                .insert(schema.demands)
                .values({
                submitterId: testUser[0].id,
                type: 'complaint',
                description: 'This demand will test the foreign key constraint fix',
                buildingId: testBuilding[0].id,
                status: 'submitted',
            })
                .returning();
            // Verify the demand exists and references the user
            const existingDemand = await db_1.db
                .select()
                .from(schema.demands)
                .where((0, drizzle_orm_1.eq)(schema.demands.submitterId, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(existingDemand).toHaveLength(1);
            (0, globals_1.expect)(existingDemand[0].submitterId).toBe(testUser[0].id);
            // This deletion should now succeed (previously would fail with foreign key constraint error)
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .send({
                confirmEmail: testUser[0].email,
                reason: 'Testing the fix for demands_submitter_id_users_id_fk constraint violation',
            })
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User account and all associated data have been permanently deleted',
                deletedUserId: testUser[0].id,
                deletedUserEmail: testUser[0].email,
            });
            // Verify the demand is also deleted (no orphaned records)
            const deletedDemand = await db_1.db
                .select()
                .from(schema.demands)
                .where((0, drizzle_orm_1.eq)(schema.demands.id, demand[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedDemand).toHaveLength(0);
            // Verify the user is completely removed
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
        });
    });
    (0, globals_1.describe)('Edge Cases', () => {
        (0, globals_1.it)('should handle deletion of user with no organization assignments', async () => {
            // Remove organization assignments
            await db_1.db
                .delete(schema.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, testUser[0].id));
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .expect(200);
            (0, globals_1.expect)(response.body.success).toBe(true);
            // Verify user is deleted
            const deletedUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id))
                .limit(1);
            (0, globals_1.expect)(deletedUser).toHaveLength(0);
        });
        (0, globals_1.it)('should prevent deletion of the last admin user', async () => {
            // Make test user the only admin
            await db_1.db
                .update(schema.users)
                .set({ role: 'admin' })
                .where((0, drizzle_orm_1.eq)(schema.users.id, testUser[0].id));
            // Delete the current admin user
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, adminUser[0].id));
            const response = await (0, supertest_1.default)(app)
                .post(`/api/users/${testUser[0].id}/delete-account`)
                .set('Cookie', authCookie)
                .expect(403);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Cannot delete the last admin user',
                code: 'CANNOT_DELETE_LAST_ADMIN',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2F1dGgvdXNlci1kZWxldGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTRFO0FBQzVFLHNEQUE4QjtBQUM5QiwwREFBZ0M7QUFDaEMsbURBQXdEO0FBQ3hELDJDQUF3QztBQUN4QywrREFBaUQ7QUFDakQsNkNBQWlDO0FBQ2pDLHdEQUE4QjtBQUU5Qjs7Ozs7Ozs7O0dBU0c7QUFFSCxrQkFBa0I7QUFDbEIsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFO0lBQ3pCLE1BQU0sR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO0lBQ3RCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hELElBQUEsdUJBQWMsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGLElBQUEsa0JBQVEsRUFBQyxlQUFlLEVBQUUsR0FBRyxFQUFFO0lBQzdCLElBQUksR0FBd0IsQ0FBQztJQUM3QixJQUFJLFFBQWEsQ0FBQztJQUNsQixJQUFJLFNBQWMsQ0FBQztJQUNuQixJQUFJLGdCQUFxQixDQUFDO0lBQzFCLElBQUksVUFBa0IsQ0FBQztJQUV2QixJQUFBLG9CQUFVLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsR0FBRyxHQUFHLGFBQWEsRUFBRSxDQUFDO1FBRXRCLGtDQUFrQztRQUNsQyxNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsMkJBQTJCLENBQUMs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TSxFQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQyxhQUFhLENBQUM7Z0JBQ2xDLE9BQU8sRUFBRSxtQ0FBbUM7Z0JBQzVDLElBQUksRUFBRSwwQkFBMEI7YUFDakMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvdW5pdC9hdXRoL3VzZXItZGVsZXRpb24udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlRWFjaCwgYWZ0ZXJFYWNoIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgeyByZWdpc3RlclJvdXRlcyB9IGZyb20gJy4uLy4uLy4uL3NlcnZlci9yb3V0ZXMnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi8uLi8uLi9zZXJ2ZXIvZGInO1xuaW1wb3J0ICogYXMgc2NoZW1hIGZyb20gJy4uLy4uLy4uL3NoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgZXEgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgYmNyeXB0IGZyb20gJ2JjcnlwdGpzJztcblxuLyoqXG4gKiBVc2VyIERlbGV0aW9uIFRlc3QgU3VpdGVcbiAqIFxuICogVGVzdHMgY29tcGxldGUgdXNlciBkZWxldGlvbiBmdW5jdGlvbmFsaXR5IGluY2x1ZGluZzpcbiAqIC0gQ29tcGxldGUgcmVjb3JkIHJlbW92YWwgKG5vdCBtYXJraW5nIGluYWN0aXZlKVxuICogLSBBdXRoZW50aWNhdGlvbiByZXF1aXJlbWVudHNcbiAqIC0gQWRtaW4gdnMgc2VsZi1kZWxldGlvbiBwZXJtaXNzaW9uc1xuICogLSBSZWxhdGVkIGRhdGEgY2xlYW51cFxuICogLSBFcnJvciBoYW5kbGluZyBmb3Igbm9uLWV4aXN0ZW50IHVzZXJzXG4gKi9cblxuLy8gQ3JlYXRlIHRlc3QgYXBwXG5jb25zdCBjcmVhdGVUZXN0QXBwID0gKCkgPT4ge1xuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbiAgcmVnaXN0ZXJSb3V0ZXMoYXBwKTtcbiAgcmV0dXJuIGFwcDtcbn07XG5cbmRlc2NyaWJlKCdVc2VyIERlbGV0aW9uJywgKCkgPT4ge1xuICBsZXQgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uO1xuICBsZXQgdGVzdFVzZXI6IGFueTtcbiAgbGV0IGFkbWluVXNlcjogYW55O1xuICBsZXQgdGVzdE9yZ2FuaXphdGlvbjogYW55O1xuICBsZXQgYXV0aENvb2tpZTogc3RyaW5nO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGFwcCA9IGNyZWF0ZVRlc3RBcHAoKTtcbiAgICBcbiAgICAvLyBDbGVhbiB1cCBhbnkgZXhpc3RpbmcgdGVzdCBkYXRhXG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAndGVzdC1kZWxldGlvbkBleGFtcGxlLmNvbScpKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICdhZG1pbi10ZXN0QGV4YW1wbGUuY29tJykpO1xuXG4gICAgLy8gQ3JlYXRlIHRlc3Qgb3JnYW5pemF0aW9uXG4gICAgdGVzdE9yZ2FuaXphdGlvbiA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIG5hbWU6ICdUZXN0IERlbGV0aW9uIE9yZycsXG4gICAgICAgIHR5cGU6ICdzeW5kaWNhdGUnLFxuICAgICAgICBhZGRyZXNzOiAnNDU2IERlbGV0ZSBTdCcsXG4gICAgICAgIGNpdHk6ICdRdWViZWMgQ2l0eScsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnRzFBIDFBMScsXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gQ3JlYXRlIGFkbWluIHVzZXIgZm9yIHRlc3RpbmcgYWRtaW4gZGVsZXRpb25cbiAgICBhZG1pblVzZXIgPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgdXNlcm5hbWU6ICdhZG1pbnRlc3QnLFxuICAgICAgICBlbWFpbDogJ2FkbWluLXRlc3RAZXhhbXBsZS5jb20nLFxuICAgICAgICBmaXJzdE5hbWU6ICdBZG1pbicsXG4gICAgICAgIGxhc3ROYW1lOiAnVGVzdCcsXG4gICAgICAgIHBhc3N3b3JkOiBhd2FpdCBiY3J5cHQuaGFzaCgnQWRtaW5QYXNzMTIzIScsIDEyKSxcbiAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCB1c2VyIHRvIGJlIGRlbGV0ZWRcbiAgICB0ZXN0VXNlciA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICB1c2VybmFtZTogJ3Rlc3RkZWxldGlvbicsXG4gICAgICAgIGVtYWlsOiAndGVzdC1kZWxldGlvbkBleGFtcGxlLmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0RlbGV0ZScsXG4gICAgICAgIGxhc3ROYW1lOiAnTWUnLFxuICAgICAgICBwYXNzd29yZDogYXdhaXQgYmNyeXB0Lmhhc2goJ0RlbGV0ZVBhc3MxMjMhJywgMTIpLFxuICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gQ3JlYXRlIHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcFxuICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpLnZhbHVlcyh7XG4gICAgICB1c2VySWQ6IHRlc3RVc2VyWzBdLmlkLFxuICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb25bMF0uaWQsXG4gICAgfSk7XG5cbiAgICAvLyBBdXRoZW50aWNhdGUgYXMgYWRtaW4gZm9yIGFkbWluIGRlbGV0aW9uIHRlc3RzXG4gICAgY29uc3QgbG9naW5SZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgLnBvc3QoJy9hcGkvYXV0aC9sb2dpbicpXG4gICAgICAuc2VuZCh7XG4gICAgICAgIGVtYWlsOiAnYWRtaW4tdGVzdEBleGFtcGxlLmNvbScsXG4gICAgICAgIHBhc3N3b3JkOiAnQWRtaW5QYXNzMTIzIScsXG4gICAgICB9KTtcblxuICAgIGF1dGhDb29raWUgPSBsb2dpblJlc3BvbnNlLmhlYWRlcnNbJ3NldC1jb29raWUnXVswXTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB0ZXN0IGRhdGFcbiAgICBpZiAodGVzdFVzZXI/LlswXT8uaWQpIHtcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHRlc3RVc2VyWzBdLmlkKSk7XG4gICAgfVxuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5lbWFpbCwgJ3Rlc3QtZGVsZXRpb25AZXhhbXBsZS5jb20nKSk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAnYWRtaW4tdGVzdEBleGFtcGxlLmNvbScpKTtcbiAgICBpZiAodGVzdE9yZ2FuaXphdGlvbj8uWzBdPy5pZCkge1xuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5vcmdhbml6YXRpb25zKS53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgdGVzdE9yZ2FuaXphdGlvblswXS5pZCkpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FkbWluIFVzZXIgRGVsZXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjb21wbGV0ZWx5IHJlbW92ZSB1c2VyIHJlY29yZCBmcm9tIGRhdGFiYXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoYC9hcGkvdXNlcnMvJHt0ZXN0VXNlclswXS5pZH0vZGVsZXRlLWFjY291bnRgKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgYWNjb3VudCBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgaXMgY29tcGxldGVseSByZW1vdmVkIGZyb20gZGF0YWJhc2VcbiAgICAgIGNvbnN0IGRlbGV0ZWRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGVzdFVzZXJbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkVXNlcikudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZW1vdmUgdXNlci1vcmdhbml6YXRpb24gcmVsYXRpb25zaGlwcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdChgL2FwaS91c2Vycy8ke3Rlc3RVc2VyWzBdLmlkfS9kZWxldGUtYWNjb3VudGApXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gVmVyaWZ5IHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHMgYXJlIHJlbW92ZWRcbiAgICAgIGNvbnN0IHVzZXJPcmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHRlc3RVc2VyWzBdLmlkKSk7XG5cbiAgICAgIGV4cGVjdCh1c2VyT3JncykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uIGZvciBhZG1pbiBkZWxldGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL3VzZXJzLyR7dGVzdFVzZXJbMF0uaWR9L2RlbGV0ZS1hY2NvdW50YClcbiAgICAgICAgLmV4cGVjdCg0MDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gZXJyb3IgZm9yIG5vbi1leGlzdGVudCB1c2VyIGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdXNlcnMvbm9uLWV4aXN0ZW50LXVzZXItaWQvZGVsZXRlLWFjY291bnQnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgY29kZTogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIHZhbGlkIHVzZXIgSUQgcGFyYW1ldGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdXNlcnMvL2RlbGV0ZS1hY2NvdW50JylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgY29kZTogJ01JU1NJTkdfVVNFUl9JRCcsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1NlbGYgRGVsZXRpb24nLCAoKSA9PiB7XG4gICAgbGV0IHVzZXJBdXRoQ29va2llOiBzdHJpbmc7XG5cbiAgICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICAgIC8vIExvZ2luIGFzIHRoZSB0ZXN0IHVzZXIgZm9yIHNlbGYtZGVsZXRpb24gdGVzdHNcbiAgICAgIGNvbnN0IHVzZXJMb2dpblJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2F1dGgvbG9naW4nKVxuICAgICAgICAuc2VuZCh7XG4gICAgICAgICAgZW1haWw6ICd0ZXN0LWRlbGV0aW9uQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICBwYXNzd29yZDogJ0RlbGV0ZVBhc3MxMjMhJyxcbiAgICAgICAgfSk7XG5cbiAgICAgIHVzZXJBdXRoQ29va2llID0gdXNlckxvZ2luUmVzcG9uc2UuaGVhZGVyc1snc2V0LWNvb2tpZSddWzBdO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyB1c2VyIHRvIGRlbGV0ZSB0aGVpciBvd24gYWNjb3VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL3VzZXJzL21lL2RlbGV0ZS1hY2NvdW50JylcbiAgICAgICAgLnNldCgnQ29va2llJywgdXNlckF1dGhDb29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBtZXNzYWdlOiAnWW91ciBhY2NvdW50IGhhcyBiZWVuIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZnkgdXNlciBpcyBjb21wbGV0ZWx5IHJlbW92ZWRcbiAgICAgIGNvbnN0IGRlbGV0ZWRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGVzdFVzZXJbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkVXNlcikudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXF1aXJlIGF1dGhlbnRpY2F0aW9uIGZvciBzZWxmIGRlbGV0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvdXNlcnMvbWUvZGVsZXRlLWFjY291bnQnKVxuICAgICAgICAuZXhwZWN0KDQwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsZWFyIHNlc3Npb24gYWZ0ZXIgc2VsZiBkZWxldGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS91c2Vycy9tZS9kZWxldGUtYWNjb3VudCcpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIHVzZXJBdXRoQ29va2llKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIC8vIFRyeSB0byBhY2Nlc3MgcHJvdGVjdGVkIGVuZHBvaW50IHdpdGggc2FtZSBjb29raWVcbiAgICAgIGNvbnN0IHByb3RlY3RlZFJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvdXNlcnMvbWUvb3JnYW5pemF0aW9ucycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIHVzZXJBdXRoQ29va2llKVxuICAgICAgICAuZXhwZWN0KDQwMSk7XG5cbiAgICAgIGV4cGVjdChwcm90ZWN0ZWRSZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YSBJbnRlZ3JpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtYWludGFpbiByZWZlcmVudGlhbCBpbnRlZ3JpdHkgYWZ0ZXIgdXNlciBkZWxldGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBzb21lIHJlbGF0ZWQgZGF0YVxuICAgICAgY29uc3QgaW52aXRhdGlvbiA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBlbWFpbDogJ3JlbGF0ZWQtaW52aXRlQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICB0b2tlbjogJ3JlbGF0ZWQtdG9rZW4nLFxuICAgICAgICAgIHRva2VuSGFzaDogJ2hhc2gxMjMnLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uWzBdLmlkLFxuICAgICAgICAgIGludml0ZWRCeVVzZXJJZDogdGVzdFVzZXJbMF0uaWQsXG4gICAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIERlbGV0ZSB0aGUgdXNlclxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL3VzZXJzLyR7dGVzdFVzZXJbMF0uaWR9L2RlbGV0ZS1hY2NvdW50YClcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICAvLyBWZXJpZnkgcmVsYXRlZCBpbnZpdGF0aW9uIHN0aWxsIGV4aXN0cyBidXQgcmVmZXJlbmNlcyBhcmUgaGFuZGxlZCBwcm9wZXJseVxuICAgICAgY29uc3QgcmVsYXRlZEludml0YXRpb24gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpbnZpdGF0aW9uWzBdLmlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBleHBlY3QocmVsYXRlZEludml0YXRpb24pLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChyZWxhdGVkSW52aXRhdGlvblswXS5pbnZpdGVkQnlVc2VySWQpLnRvQmUodGVzdFVzZXJbMF0uaWQpO1xuXG4gICAgICAvLyBDbGVhbiB1cFxuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpbnZpdGF0aW9uWzBdLmlkKSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdGb3JlaWduIEtleSBDb25zdHJhaW50IEhhbmRsaW5nJywgKCkgPT4ge1xuICAgIGxldCB0ZXN0QnVpbGRpbmc6IGFueTtcbiAgICBsZXQgdGVzdFJlc2lkZW5jZTogYW55O1xuXG4gICAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgdGVzdCBidWlsZGluZ1xuICAgICAgdGVzdEJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBuYW1lOiAnVGVzdCBCdWlsZGluZycsXG4gICAgICAgICAgYWRkcmVzczogJzEyMyBUZXN0IFN0JyxcbiAgICAgICAgICBjaXR5OiAnVGVzdCBDaXR5JyxcbiAgICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiAnSDFBIDFBMScsXG4gICAgICAgICAgYnVpbGRpbmdUeXBlOiAnYXBhcnRtZW50JyxcbiAgICAgICAgICB0b3RhbFVuaXRzOiAxMDAsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb25bMF0uaWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gQ3JlYXRlIHRlc3QgcmVzaWRlbmNlXG4gICAgICB0ZXN0UmVzaWRlbmNlID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgdW5pdE51bWJlcjogJzEwMScsXG4gICAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nWzBdLmlkLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ2xlYW4gdXAgdGVzdCBkYXRhXG4gICAgICBpZiAodGVzdFJlc2lkZW5jZT8uWzBdPy5pZCkge1xuICAgICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlWzBdLmlkKSk7XG4gICAgICB9XG4gICAgICBpZiAodGVzdEJ1aWxkaW5nPy5bMF0/LmlkKSB7XG4gICAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuYnVpbGRpbmdzKS53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlkLCB0ZXN0QnVpbGRpbmdbMF0uaWQpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVzZXIgZGVsZXRpb24gd2l0aCBkZW1hbmRzIGFuZCBkZW1hbmQgY29tbWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSBkZW1hbmQgc3VibWl0dGVkIGJ5IHRoZSB0ZXN0IHVzZXJcbiAgICAgIGNvbnN0IGRlbWFuZCA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmRlbWFuZHMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIHN1Ym1pdHRlcklkOiB0ZXN0VXNlclswXS5pZCxcbiAgICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBkZW1hbmQgZm9yIGRlbGV0aW9uJyxcbiAgICAgICAgICBidWlsZGluZ0lkOiB0ZXN0QnVpbGRpbmdbMF0uaWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2VbMF0uaWQsXG4gICAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBDcmVhdGUgYSBjb21tZW50IG9uIHRoZSBkZW1hbmRcbiAgICAgIGNvbnN0IGNvbW1lbnQgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5kZW1hbmRDb21tZW50cylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgZGVtYW5kSWQ6IGRlbWFuZFswXS5pZCxcbiAgICAgICAgICBjb21tZW50ZXJJZDogdGVzdFVzZXJbMF0uaWQsXG4gICAgICAgICAgY29tbWVudFRleHQ6ICdUZXN0IGNvbW1lbnQgZm9yIGRlbGV0aW9uJyxcbiAgICAgICAgICBjb21tZW50VHlwZTogJ2dlbmVyYWwnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgZGVtYW5kIGFuZCBjb21tZW50IGV4aXN0XG4gICAgICBjb25zdCBleGlzdGluZ0RlbWFuZCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZGVtYW5kcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kZW1hbmRzLmlkLCBkZW1hbmRbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGV4aXN0aW5nQ29tbWVudCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZGVtYW5kQ29tbWVudHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZGVtYW5kQ29tbWVudHMuaWQsIGNvbW1lbnRbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChleGlzdGluZ0RlbWFuZCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KGV4aXN0aW5nQ29tbWVudCkudG9IYXZlTGVuZ3RoKDEpO1xuXG4gICAgICAvLyBEZWxldGUgdGhlIHVzZXIgLSB0aGlzIHNob3VsZCBub3cgc3VjY2VlZFxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoYC9hcGkvdXNlcnMvJHt0ZXN0VXNlclswXS5pZH0vZGVsZXRlLWFjY291bnRgKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZCh7XG4gICAgICAgICAgY29uZmlybUVtYWlsOiB0ZXN0VXNlclswXS5lbWFpbCxcbiAgICAgICAgICByZWFzb246ICdUZXN0aW5nIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnQgaGFuZGxpbmcnLFxuICAgICAgICB9KVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ1VzZXIgYWNjb3VudCBhbmQgYWxsIGFzc29jaWF0ZWQgZGF0YSBoYXZlIGJlZW4gcGVybWFuZW50bHkgZGVsZXRlZCcsXG4gICAgICAgIGRlbGV0ZWRVc2VySWQ6IHRlc3RVc2VyWzBdLmlkLFxuICAgICAgICBkZWxldGVkVXNlckVtYWlsOiB0ZXN0VXNlclswXS5lbWFpbCxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZnkgdGhlIHVzZXIgaXMgZGVsZXRlZFxuICAgICAgY29uc3QgZGVsZXRlZFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCB0ZXN0VXNlclswXS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgZXhwZWN0KGRlbGV0ZWRVc2VyKS50b0hhdmVMZW5ndGgoMCk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgZGVtYW5kIGFuZCBjb21tZW50IGFyZSBhbHNvIGRlbGV0ZWRcbiAgICAgIGNvbnN0IGRlbGV0ZWREZW1hbmQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmRlbWFuZHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZGVtYW5kcy5pZCwgZGVtYW5kWzBdLmlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuICAgICAgXG4gICAgICBjb25zdCBkZWxldGVkQ29tbWVudCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZGVtYW5kQ29tbWVudHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZGVtYW5kQ29tbWVudHMuaWQsIGNvbW1lbnRbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkRGVtYW5kKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QoZGVsZXRlZENvbW1lbnQpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVzZXIgZGVsZXRpb24gd2l0aCBidWdzIGFuZCBmZWF0dXJlIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGEgYnVnIHN1Ym1pdHRlZCBieSB0aGUgdGVzdCB1c2VyXG4gICAgICBjb25zdCBidWcgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5idWdzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBjcmVhdGVkQnk6IHRlc3RVc2VyWzBdLmlkLFxuICAgICAgICAgIHRpdGxlOiAnVGVzdCBCdWcnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBidWcgZm9yIGRlbGV0aW9uJyxcbiAgICAgICAgICBjYXRlZ29yeTogJ2Z1bmN0aW9uYWxpdHknLFxuICAgICAgICAgIHBhZ2U6ICcvdGVzdC1wYWdlJyxcbiAgICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgICAgc3RhdHVzOiAnbmV3JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBDcmVhdGUgYSBmZWF0dXJlIHJlcXVlc3Qgc3VibWl0dGVkIGJ5IHRoZSB0ZXN0IHVzZXJcbiAgICAgIGNvbnN0IGZlYXR1cmVSZXF1ZXN0ID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBjcmVhdGVkQnk6IHRlc3RVc2VyWzBdLmlkLFxuICAgICAgICAgIHRpdGxlOiAnVGVzdCBGZWF0dXJlIFJlcXVlc3QnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBmZWF0dXJlIHJlcXVlc3QgZm9yIGRlbGV0aW9uJyxcbiAgICAgICAgICBuZWVkOiAnVGVzdGluZyBmZWF0dXJlIGRlbGV0aW9uJyxcbiAgICAgICAgICBjYXRlZ29yeTogJ2Rhc2hib2FyZCcsXG4gICAgICAgICAgcGFnZTogJy90ZXN0LXBhZ2UnLFxuICAgICAgICAgIHN0YXR1czogJ3N1Ym1pdHRlZCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gQ3JlYXRlIGFuIHVwdm90ZSBieSB0aGUgdGVzdCB1c2VyXG4gICAgICBjb25zdCB1cHZvdGUgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGZlYXR1cmVSZXF1ZXN0SWQ6IGZlYXR1cmVSZXF1ZXN0WzBdLmlkLFxuICAgICAgICAgIHVzZXJJZDogdGVzdFVzZXJbMF0uaWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gVmVyaWZ5IHRoZXkgZXhpc3RcbiAgICAgIGNvbnN0IGV4aXN0aW5nQnVnID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5idWdzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGJ1Z1swXS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcbiAgICAgIFxuICAgICAgY29uc3QgZXhpc3RpbmdGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGNvbnN0IGV4aXN0aW5nVXB2b3RlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLmlkLCB1cHZvdGVbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChleGlzdGluZ0J1ZykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KGV4aXN0aW5nRmVhdHVyZVJlcXVlc3QpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChleGlzdGluZ1Vwdm90ZSkudG9IYXZlTGVuZ3RoKDEpO1xuXG4gICAgICAvLyBEZWxldGUgdGhlIHVzZXJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL3VzZXJzLyR7dGVzdFVzZXJbMF0uaWR9L2RlbGV0ZS1hY2NvdW50YClcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIGNvbmZpcm1FbWFpbDogdGVzdFVzZXJbMF0uZW1haWwsXG4gICAgICAgICAgcmVhc29uOiAnVGVzdGluZyBidWcgYW5kIGZlYXR1cmUgcmVxdWVzdCBkZWxldGlvbicsXG4gICAgICAgIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBtZXNzYWdlOiAnVXNlciBhY2NvdW50IGFuZCBhbGwgYXNzb2NpYXRlZCBkYXRhIGhhdmUgYmVlbiBwZXJtYW5lbnRseSBkZWxldGVkJyxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBWZXJpZnkgdGhlIHVzZXIgaXMgZGVsZXRlZFxuICAgICAgY29uc3QgZGVsZXRlZFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCB0ZXN0VXNlclswXS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgZXhwZWN0KGRlbGV0ZWRVc2VyKS50b0hhdmVMZW5ndGgoMCk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgYnVnLCBmZWF0dXJlIHJlcXVlc3QsIGFuZCB1cHZvdGUgYXJlIGFsc28gZGVsZXRlZFxuICAgICAgY29uc3QgZGVsZXRlZEJ1ZyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuYnVncylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWdzLmlkLCBidWdbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRlbGV0ZWRGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGNvbnN0IGRlbGV0ZWRVcHZvdGUgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuaWQsIHVwdm90ZVswXS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgZXhwZWN0KGRlbGV0ZWRCdWcpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChkZWxldGVkRmVhdHVyZVJlcXVlc3QpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIGV4cGVjdChkZWxldGVkVXB2b3RlKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcHJvZHVjZSB0aGUgb3JpZ2luYWwgZXJyb3Igc2NlbmFyaW8gYW5kIHZlcmlmeSBmaXgnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUaGlzIHRlc3QgcmVwcm9kdWNlcyB0aGUgZXhhY3Qgc2NlbmFyaW8gZnJvbSB0aGUgdXNlcidzIHNjcmVlbnNob3RcbiAgICAgIC8vIENyZWF0ZSBhIGRlbWFuZCB0aGF0IHdvdWxkIGNhdXNlIHRoZSBmb3JlaWduIGtleSBjb25zdHJhaW50IGVycm9yXG4gICAgICBjb25zdCBkZW1hbmQgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5kZW1hbmRzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBzdWJtaXR0ZXJJZDogdGVzdFVzZXJbMF0uaWQsXG4gICAgICAgICAgdHlwZTogJ2NvbXBsYWludCcsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdUaGlzIGRlbWFuZCB3aWxsIHRlc3QgdGhlIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnQgZml4JyxcbiAgICAgICAgICBidWlsZGluZ0lkOiB0ZXN0QnVpbGRpbmdbMF0uaWQsXG4gICAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBWZXJpZnkgdGhlIGRlbWFuZCBleGlzdHMgYW5kIHJlZmVyZW5jZXMgdGhlIHVzZXJcbiAgICAgIGNvbnN0IGV4aXN0aW5nRGVtYW5kID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5kZW1hbmRzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRlbWFuZHMuc3VibWl0dGVySWQsIHRlc3RVc2VyWzBdLmlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBleHBlY3QoZXhpc3RpbmdEZW1hbmQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChleGlzdGluZ0RlbWFuZFswXS5zdWJtaXR0ZXJJZCkudG9CZSh0ZXN0VXNlclswXS5pZCk7XG5cbiAgICAgIC8vIFRoaXMgZGVsZXRpb24gc2hvdWxkIG5vdyBzdWNjZWVkIChwcmV2aW91c2x5IHdvdWxkIGZhaWwgd2l0aCBmb3JlaWduIGtleSBjb25zdHJhaW50IGVycm9yKVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoYC9hcGkvdXNlcnMvJHt0ZXN0VXNlclswXS5pZH0vZGVsZXRlLWFjY291bnRgKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZCh7XG4gICAgICAgICAgY29uZmlybUVtYWlsOiB0ZXN0VXNlclswXS5lbWFpbCxcbiAgICAgICAgICByZWFzb246ICdUZXN0aW5nIHRoZSBmaXggZm9yIGRlbWFuZHNfc3VibWl0dGVyX2lkX3VzZXJzX2lkX2ZrIGNvbnN0cmFpbnQgdmlvbGF0aW9uJyxcbiAgICAgICAgfSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGFjY291bnQgYW5kIGFsbCBhc3NvY2lhdGVkIGRhdGEgaGF2ZSBiZWVuIHBlcm1hbmVudGx5IGRlbGV0ZWQnLFxuICAgICAgICBkZWxldGVkVXNlcklkOiB0ZXN0VXNlclswXS5pZCxcbiAgICAgICAgZGVsZXRlZFVzZXJFbWFpbDogdGVzdFVzZXJbMF0uZW1haWwsXG4gICAgICB9KTtcblxuICAgICAgLy8gVmVyaWZ5IHRoZSBkZW1hbmQgaXMgYWxzbyBkZWxldGVkIChubyBvcnBoYW5lZCByZWNvcmRzKVxuICAgICAgY29uc3QgZGVsZXRlZERlbWFuZCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZGVtYW5kcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kZW1hbmRzLmlkLCBkZW1hbmRbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkRGVtYW5kKS50b0hhdmVMZW5ndGgoMCk7XG5cbiAgICAgIC8vIFZlcmlmeSB0aGUgdXNlciBpcyBjb21wbGV0ZWx5IHJlbW92ZWRcbiAgICAgIGNvbnN0IGRlbGV0ZWRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGVzdFVzZXJbMF0uaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkVXNlcikudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWRnZSBDYXNlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkZWxldGlvbiBvZiB1c2VyIHdpdGggbm8gb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gUmVtb3ZlIG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50c1xuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB0ZXN0VXNlclswXS5pZCkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdChgL2FwaS91c2Vycy8ke3Rlc3RVc2VyWzBdLmlkfS9kZWxldGUtYWNjb3VudGApXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgaXMgZGVsZXRlZFxuICAgICAgY29uc3QgZGVsZXRlZFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCB0ZXN0VXNlclswXS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgZXhwZWN0KGRlbGV0ZWRVc2VyKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgZGVsZXRpb24gb2YgdGhlIGxhc3QgYWRtaW4gdXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1ha2UgdGVzdCB1c2VyIHRoZSBvbmx5IGFkbWluXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS51c2VycylcbiAgICAgICAgLnNldCh7IHJvbGU6ICdhZG1pbicgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGVzdFVzZXJbMF0uaWQpKTtcblxuICAgICAgLy8gRGVsZXRlIHRoZSBjdXJyZW50IGFkbWluIHVzZXJcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgYWRtaW5Vc2VyWzBdLmlkKSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL3VzZXJzLyR7dGVzdFVzZXJbMF0uaWR9L2RlbGV0ZS1hY2NvdW50YClcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgZGVsZXRlIHRoZSBsYXN0IGFkbWluIHVzZXInLFxuICAgICAgICBjb2RlOiAnQ0FOTk9UX0RFTEVURV9MQVNUX0FETUlOJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==