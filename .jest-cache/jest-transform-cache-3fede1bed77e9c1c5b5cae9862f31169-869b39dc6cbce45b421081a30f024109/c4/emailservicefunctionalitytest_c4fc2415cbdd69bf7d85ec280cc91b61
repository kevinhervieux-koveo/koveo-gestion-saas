9458e3434207503b60dc0affc71ac4e0
"use strict";
/**
 * Email Service Functionality Test
 * Tests email service by sending actual emails to kevin.hervieux@koveo-gestion.com
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const email_service_1 = require("../../server/services/email-service");
(0, globals_1.describe)('Email Service Functionality Test', () => {
    const testEmail = 'kevin.hervieux@koveo-gestion.com';
    (0, globals_1.beforeAll)(async () => {
        // Send summary email about what emails to expect
        const emailList = [
            '1. Password Reset Email - Testing password reset functionality',
            '2. User Invitation Email - Testing invitation system',
            '3. Welcome Email - Testing user onboarding',
            '4. Test Notification - General email service validation'
        ];
        const summaryMessage = `
Email Service Testing for Koveo Gestion

You should receive ${emailList.length} test emails:

${emailList.map((item, index) => `${index + 1}. ${item}`).join('\n')}

These emails are part of the automated testing process to validate the email functionality of the Quebec property management system.

Test initiated at: ${new Date().toISOString()}
    `.trim();
        try {
            await email_service_1.emailService.sendEmail(testEmail, 'Kevin Hervieux', 'Email Service Testing - Expected Emails Summary', summaryMessage, `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #0066cc;">Email Service Testing for Koveo Gestion</h2>
          
          <p>You should receive <strong>${emailList.length} test emails</strong>:</p>
          
          <ol style="line-height: 1.6;">
            ${emailList.map(item => `<li>${item}</li>`).join('')}
          </ol>
          
          <p style="margin-top: 20px; padding: 10px; background-color: #f0f8ff; border-left: 4px solid #0066cc;">
            These emails are part of the automated testing process to validate the email functionality 
            of the Quebec property management system.
          </p>
          
          <p style="color: #666; font-size: 12px;">
            Test initiated at: ${new Date().toISOString()}
          </p>
        </div>
        `);
            console.log('✅ Summary email sent successfully');
        }
        catch (error) {
            console.error('❌ Failed to send summary email:', error);
        }
    });
    (0, globals_1.describe)('Password Reset Email', () => {
        (0, globals_1.it)('should send password reset email successfully', async () => {
            const resetUrl = 'https://koveo-gestion.com/reset-password?token=test-token-123';
            const emailSent = await email_service_1.emailService.sendPasswordResetEmail(testEmail, 'Kevin Hervieux', resetUrl);
            (0, globals_1.expect)(emailSent).toBe(true);
        });
        (0, globals_1.it)('should handle password reset email with French content', async () => {
            const resetUrl = 'https://koveo-gestion.com/reset-password?token=test-token-fr-456';
            const emailSent = await email_service_1.emailService.sendEmail(testEmail, 'Kevin Hervieux', 'Réinitialisation de mot de passe - Koveo Gestion', `
Bonjour Kevin Hervieux,

Vous avez demandé une réinitialisation de votre mot de passe pour votre compte Koveo Gestion.

Cliquez sur le lien suivant pour réinitialiser votre mot de passe:
${resetUrl}

Ce lien expirera dans 1 heure pour votre sécurité.

Si vous n'avez pas demandé cette réinitialisation, ignorez ce courriel.

Cordialement,
L'équipe Koveo Gestion
        `.trim(), `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #0066cc;">Réinitialisation de mot de passe</h2>
          
          <p>Bonjour Kevin Hervieux,</p>
          
          <p>Vous avez demandé une réinitialisation de votre mot de passe pour votre compte Koveo Gestion.</p>
          
          <div style="text-align: center; margin: 20px 0;">
            <a href="${resetUrl}" style="background-color: #0066cc; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; display: inline-block;">
              Réinitialiser le mot de passe
            </a>
          </div>
          
          <p style="color: #666; font-size: 14px;">
            Ce lien expirera dans 1 heure pour votre sécurité.
          </p>
          
          <p style="color: #666; font-size: 12px;">
            Si vous n'avez pas demandé cette réinitialisation, ignorez ce courriel.
          </p>
        </div>
        `);
            (0, globals_1.expect)(emailSent).toBe(true);
        });
    });
    (0, globals_1.describe)('User Invitation Email', () => {
        (0, globals_1.it)('should send user invitation email successfully', async () => {
            const invitationData = {
                email: testEmail,
                recipientName: 'Kevin Hervieux',
                token: 'test-invitation-token-789',
                organizationName: 'Koveo Gestion Test',
                inviterName: 'System Administrator',
                role: 'admin',
                personalMessage: 'Welcome to our Quebec property management system!'
            };
            const emailSent = await email_service_1.emailService.sendInvitationEmail(invitationData.email, invitationData.recipientName, invitationData.token, invitationData.organizationName, invitationData.inviterName, invitationData.role, invitationData.personalMessage);
            (0, globals_1.expect)(emailSent).toBe(true);
        });
    });
    (0, globals_1.describe)('General Email Functionality', () => {
        (0, globals_1.it)('should send welcome email successfully', async () => {
            const welcomeMessage = `
Bienvenue dans Koveo Gestion!

Votre compte administrateur a été configuré avec succès.

Caractéristiques de votre compte:
- Rôle: Administrateur
- Langue: Français
- Accès complet au système de gestion immobilière

Vous pouvez maintenant accéder à toutes les fonctionnalités de la plateforme.

Cordialement,
L'équipe Koveo Gestion
      `.trim();
            const emailSent = await email_service_1.emailService.sendEmail(testEmail, 'Kevin Hervieux', 'Bienvenue dans Koveo Gestion - Compte Configuré', welcomeMessage, `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #0066cc;">Bienvenue dans Koveo Gestion!</h2>
          
          <p>Votre compte administrateur a été configuré avec succès.</p>
          
          <div style="background-color: #f8f9fa; padding: 15px; border-radius: 8px; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #495057;">Caractéristiques de votre compte:</h3>
            <ul style="margin-bottom: 0;">
              <li><strong>Rôle:</strong> Administrateur</li>
              <li><strong>Langue:</strong> Français</li>
              <li><strong>Accès:</strong> Complet au système de gestion immobilière</li>
            </ul>
          </div>
          
          <p>Vous pouvez maintenant accéder à toutes les fonctionnalités de la plateforme.</p>
          
          <div style="text-align: center; margin: 30px 0;">
            <a href="https://koveo-gestion.com/login" style="background-color: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 4px; display: inline-block;">
              Se connecter
            </a>
          </div>
        </div>
        `);
            (0, globals_1.expect)(emailSent).toBe(true);
        });
        (0, globals_1.it)('should send general test notification', async () => {
            const testNotification = `
Test de notification - Koveo Gestion

Ce message confirme que le service de courriel fonctionne correctement.

Détails du test:
- Date: ${new Date().toLocaleString('fr-CA')}
- Type: Notification générale
- Système: Gestion immobilière Quebec
- Statut: Service email opérationnel

Tous les tests de courriels sont maintenant terminés.
      `.trim();
            const emailSent = await email_service_1.emailService.sendEmail(testEmail, 'Kevin Hervieux', 'Test Notification - Service Email Opérationnel', testNotification, `
        <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
          <h2 style="color: #28a745;">✅ Test de notification - Koveo Gestion</h2>
          
          <p>Ce message confirme que le service de courriel fonctionne correctement.</p>
          
          <div style="background-color: #d4edda; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745; margin: 20px 0;">
            <h3 style="margin-top: 0; color: #155724;">Détails du test:</h3>
            <ul style="margin-bottom: 0; color: #155724;">
              <li><strong>Date:</strong> ${new Date().toLocaleString('fr-CA')}</li>
              <li><strong>Type:</strong> Notification générale</li>
              <li><strong>Système:</strong> Gestion immobilière Quebec</li>
              <li><strong>Statut:</strong> Service email opérationnel</li>
            </ul>
          </div>
          
          <p style="font-weight: bold; color: #28a745;">
            ✅ Tous les tests de courriels sont maintenant terminés.
          </p>
        </div>
        `);
            (0, globals_1.expect)(emailSent).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9lbWFpbC1zZXJ2aWNlLWZ1bmN0aW9uYWxpdHkudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUVILDJDQUFnRTtBQUNoRSx1RUFBbUU7QUFFbkUsSUFBQSxrQkFBUSxFQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtJQUNoRCxNQUFNLFNBQVMsR0FBRyxrQ0FBa0MsQ0FBQztJQUVyRCxJQUFBLG1CQUFTLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDbkIsaURBQWlEO1FBQ2pELE1BQU0sU0FBUyxHQUFHO1lBQ2hCLGdFQUFnRTtZQUNoRSxzREFBc0Q7WUFDdEQsNENBQTRDO1lBQzVDLHlEQUF5RDtTQUMxRCxDQUFDO1FBRUYsTUFBTSxjQUFjLEdBQUc7OztxQkFHTixTQUFTLENBQUMsTUFBTTs7RUFFbkMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLEdBQUcsS0FBSyxHQUFHLENBQUMsS0FBSyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7Ozs7cUJBSS9DLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO0tBQ3hDLENBQUMsSUFBSSxFQUFFLENBQUM7UUFFVCxJQUFJLENBQUM7WUFDSCxNQUFNLDRCQUFZLENBQUMsU0FBUyxDQUMxQixTQUFTLEVBQ1QsZ0JBQWdCLEVBQ2hCLGlEQUFpRCxFQUNqRCxjQUFjLEVBQ2Q7Ozs7MENBSWtDLFNBQVMsQ0FBQyxNQUFNOzs7Y0FHNUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLE9BQU8sSUFBSSxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDOzs7Ozs7Ozs7aUNBUy9CLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFOzs7U0FHaEQsQ0FDRixDQUFDO1lBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFD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Ozs7Ozs7VUFNckIsSUFBSSxJQUFJLEVBQUUsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDOzs7Ozs7T0FNckMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUVULE1BQU0sU0FBUyxHQUFHLE1BQU0sNEJBQVksQ0FBQyxTQUFTLENBQzVDLFNBQVMsRUFDVCxnQkFBZ0IsRUFDaEIsZ0RBQWdELEVBQ2hELGdCQUFnQixFQUNoQjs7Ozs7Ozs7OzJDQVNtQyxJQUFJLElBQUksRUFBRSxDQUFDLGNBQWMsQ0FBQyxPQUFPLENBQUM7Ozs7Ozs7Ozs7O1NBV3BFLENBQ0YsQ0FBQztZQUVGLElBQUEsZ0JBQU0sRUFBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDL0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvaW50ZWdyYXRpb24vZW1haWwtc2VydmljZS1mdW5jdGlvbmFsaXR5LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFbWFpbCBTZXJ2aWNlIEZ1bmN0aW9uYWxpdHkgVGVzdFxuICogVGVzdHMgZW1haWwgc2VydmljZSBieSBzZW5kaW5nIGFjdHVhbCBlbWFpbHMgdG8ga2V2aW4uaGVydmlldXhAa292ZW8tZ2VzdGlvbi5jb21cbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCwgYmVmb3JlQWxsIH0gZnJvbSAnQGplc3QvZ2xvYmFscyc7XG5pbXBvcnQgeyBlbWFpbFNlcnZpY2UgfSBmcm9tICcuLi8uLi9zZXJ2ZXIvc2VydmljZXMvZW1haWwtc2VydmljZSc7XG5cbmRlc2NyaWJlKCdFbWFpbCBTZXJ2aWNlIEZ1bmN0aW9uYWxpdHkgVGVzdCcsICgpID0+IHtcbiAgY29uc3QgdGVzdEVtYWlsID0gJ2tldmluLmhlcnZpZXV4QGtvdmVvLWdlc3Rpb24uY29tJztcblxuICBiZWZvcmVBbGwoYXN5bmMgKCkgPT4ge1xuICAgIC8vIFNlbmQgc3VtbWFyeSBlbWFpbCBhYm91dCB3aGF0IGVtYWlscyB0byBleHBlY3RcbiAgICBjb25zdCBlbWFpbExpc3QgPSBbXG4gICAgICAnMS4gUGFzc3dvcmQgUmVzZXQgRW1haWwgLSBUZXN0aW5nIHBhc3N3b3JkIHJlc2V0IGZ1bmN0aW9uYWxpdHknLFxuICAgICAgJzIuIFVzZXIgSW52aXRhdGlvbiBFbWFpbCAtIFRlc3RpbmcgaW52aXRhdGlvbiBzeXN0ZW0nLFxuICAgICAgJzMuIFdlbGNvbWUgRW1haWwgLSBUZXN0aW5nIHVzZXIgb25ib2FyZGluZycsXG4gICAgICAnNC4gVGVzdCBOb3RpZmljYXRpb24gLSBHZW5lcmFsIGVtYWlsIHNlcnZpY2UgdmFsaWRhdGlvbidcbiAgICBdO1xuXG4gICAgY29uc3Qgc3VtbWFyeU1lc3NhZ2UgPSBgXG5FbWFpbCBTZXJ2aWNlIFRlc3RpbmcgZm9yIEtvdmVvIEdlc3Rpb25cblxuWW91IHNob3VsZCByZWNlaXZlICR7ZW1haWxMaXN0Lmxlbmd0aH0gdGVzdCBlbWFpbHM6XG5cbiR7ZW1haWxMaXN0Lm1hcCgoaXRlbSwgaW5kZXgpID0+IGAke2luZGV4ICsgMX0uICR7aXRlbX1gKS5qb2luKCdcXG4nKX1cblxuVGhlc2UgZW1haWxzIGFyZSBwYXJ0IG9mIHRoZSBhdXRvbWF0ZWQgdGVzdGluZyBwcm9jZXNzIHRvIHZhbGlkYXRlIHRoZSBlbWFpbCBmdW5jdGlvbmFsaXR5IG9mIHRoZSBRdWViZWMgcHJvcGVydHkgbWFuYWdlbWVudCBzeXN0ZW0uXG5cblRlc3QgaW5pdGlhdGVkIGF0OiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cbiAgICBgLnRyaW0oKTtcblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZEVtYWlsKFxuICAgICAgICB0ZXN0RW1haWwsXG4gICAgICAgICdLZXZpbiBIZXJ2aWV1eCcsXG4gICAgICAgICdFbWFpbCBTZXJ2aWNlIFRlc3RpbmcgLSBFeHBlY3RlZCBFbWFpbHMgU3VtbWFyeScsXG4gICAgICAgIHN1bW1hcnlNZXNzYWdlLFxuICAgICAgICBgXG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvO1wiPlxuICAgICAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjMDA2NmNjO1wiPkVtYWlsIFNlcnZpY2UgVGVzdGluZyBmb3IgS292ZW8gR2VzdGlvbjwvaDI+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+WW91IHNob3VsZCByZWNlaXZlIDxzdHJvbmc+JHtlbWFpbExpc3QubGVuZ3RofSB0ZXN0IGVtYWlsczwvc3Ryb25nPjo8L3A+XG4gICAgICAgICAgXG4gICAgICAgICAgPG9sIHN0eWxlPVwibGluZS1oZWlnaHQ6IDEuNjtcIj5cbiAgICAgICAgICAgICR7ZW1haWxMaXN0Lm1hcChpdGVtID0+IGA8bGk+JHtpdGVtfTwvbGk+YCkuam9pbignJyl9XG4gICAgICAgICAgPC9vbD5cbiAgICAgICAgICBcbiAgICAgICAgICA8cCBzdHlsZT1cIm1hcmdpbi10b3A6IDIwcHg7IHBhZGRpbmc6IDEwcHg7IGJhY2tncm91bmQtY29sb3I6ICNmMGY4ZmY7IGJvcmRlci1sZWZ0OiA0cHggc29saWQgIzAwNjZjYztcIj5cbiAgICAgICAgICAgIFRoZXNlIGVtYWlscyBhcmUgcGFydCBvZiB0aGUgYXV0b21hdGVkIHRlc3RpbmcgcHJvY2VzcyB0byB2YWxpZGF0ZSB0aGUgZW1haWwgZnVuY3Rpb25hbGl0eSBcbiAgICAgICAgICAgIG9mIHRoZSBRdWViZWMgcHJvcGVydHkgbWFuYWdlbWVudCBzeXN0ZW0uXG4gICAgICAgICAgPC9wPlxuICAgICAgICAgIFxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2NjY7IGZvbnQtc2l6ZTogMTJweDtcIj5cbiAgICAgICAgICAgIFRlc3QgaW5pdGlhdGVkIGF0OiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1cbiAgICAgICAgICA8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBgXG4gICAgICApO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBTdW1tYXJ5IGVtYWlsIHNlbnQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gc2VuZCBzdW1tYXJ5IGVtYWlsOicsIGVycm9yKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQYXNzd29yZCBSZXNldCBFbWFpbCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNlbmQgcGFzc3dvcmQgcmVzZXQgZW1haWwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzZXRVcmwgPSAnaHR0cHM6Ly9rb3Zlby1nZXN0aW9uLmNvbS9yZXNldC1wYXNzd29yZD90b2tlbj10ZXN0LXRva2VuLTEyMyc7XG4gICAgICBcbiAgICAgIGNvbnN0IGVtYWlsU2VudCA9IGF3YWl0IGVtYWlsU2VydmljZS5zZW5kUGFzc3dvcmRSZXNldEVtYWlsKFxuICAgICAgICB0ZXN0RW1haWwsXG4gICAgICAgICdLZXZpbiBIZXJ2aWV1eCcsXG4gICAgICAgIHJlc2V0VXJsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoZW1haWxTZW50KS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcGFzc3dvcmQgcmVzZXQgZW1haWwgd2l0aCBGcmVuY2ggY29udGVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc2V0VXJsID0gJ2h0dHBzOi8va292ZW8tZ2VzdGlvbi5jb20vcmVzZXQtcGFzc3dvcmQ/dG9rZW49dGVzdC10b2tlbi1mci00NTYnO1xuICAgICAgXG4gICAgICBjb25zdCBlbWFpbFNlbnQgPSBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZEVtYWlsKFxuICAgICAgICB0ZXN0RW1haWwsXG4gICAgICAgICdLZXZpbiBIZXJ2aWV1eCcsXG4gICAgICAgICdSw6lpbml0aWFsaXNhdGlvbiBkZSBtb3QgZGUgcGFzc2UgLSBLb3ZlbyBHZXN0aW9uJyxcbiAgICAgICAgYFxuQm9uam91ciBLZXZpbiBIZXJ2aWV1eCxcblxuVm91cyBhdmV6IGRlbWFuZMOpIHVuZSByw6lpbml0aWFsaXNhdGlvbiBkZSB2b3RyZSBtb3QgZGUgcGFzc2UgcG91ciB2b3RyZSBjb21wdGUgS292ZW8gR2VzdGlvbi5cblxuQ2xpcXVleiBzdXIgbGUgbGllbiBzdWl2YW50IHBvdXIgcsOpaW5pdGlhbGlzZXIgdm90cmUgbW90IGRlIHBhc3NlOlxuJHtyZXNldFVybH1cblxuQ2UgbGllbiBleHBpcmVyYSBkYW5zIDEgaGV1cmUgcG91ciB2b3RyZSBzw6ljdXJpdMOpLlxuXG5TaSB2b3VzIG4nYXZleiBwYXMgZGVtYW5kw6kgY2V0dGUgcsOpaW5pdGlhbGlzYXRpb24sIGlnbm9yZXogY2UgY291cnJpZWwuXG5cbkNvcmRpYWxlbWVudCxcbkwnw6lxdWlwZSBLb3ZlbyBHZXN0aW9uXG4gICAgICAgIGAudHJpbSgpLFxuICAgICAgICBgXG4gICAgICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7IG1heC13aWR0aDogNjAwcHg7IG1hcmdpbjogMCBhdXRvO1wiPlxuICAgICAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjMDA2NmNjO1wiPlLDqWluaXRpYWxpc2F0aW9uIGRlIG1vdCBkZSBwYXNzZTwvaDI+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+Qm9uam91ciBLZXZpbiBIZXJ2aWV1eCw8L3A+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+Vm91cyBhdmV6IGRlbWFuZMOpIHVuZSByw6lpbml0aWFsaXNhdGlvbiBkZSB2b3RyZSBtb3QgZGUgcGFzc2UgcG91ciB2b3RyZSBjb21wdGUgS292ZW8gR2VzdGlvbi48L3A+XG4gICAgICAgICAgXG4gICAgICAgICAgPGRpdiBzdHlsZT1cInRleHQtYWxpZ246IGNlbnRlcjsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAgICA8YSBocmVmPVwiJHtyZXNldFVybH1cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICMwMDY2Y2M7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDRweDsgZGlzcGxheTogaW5saW5lLWJsb2NrO1wiPlxuICAgICAgICAgICAgICBSw6lpbml0aWFsaXNlciBsZSBtb3QgZGUgcGFzc2VcbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICBcbiAgICAgICAgICA8cCBzdHlsZT1cImNvbG9yOiAjNjY2OyBmb250LXNpemU6IDE0cHg7XCI+XG4gICAgICAgICAgICBDZSBsaWVuIGV4cGlyZXJhIGRhbnMgMSBoZXVyZSBwb3VyIHZvdHJlIHPDqWN1cml0w6kuXG4gICAgICAgICAgPC9wPlxuICAgICAgICAgIFxuICAgICAgICAgIDxwIHN0eWxlPVwiY29sb3I6ICM2NjY7IGZvbnQtc2l6ZTogMTJweDtcIj5cbiAgICAgICAgICAgIFNpIHZvdXMgbidhdmV6IHBhcyBkZW1hbmTDqSBjZXR0ZSByw6lpbml0aWFsaXNhdGlvbiwgaWdub3JleiBjZSBjb3VycmllbC5cbiAgICAgICAgICA8L3A+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBgXG4gICAgICApO1xuXG4gICAgICBleHBlY3QoZW1haWxTZW50KS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBJbnZpdGF0aW9uIEVtYWlsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc2VuZCB1c2VyIGludml0YXRpb24gZW1haWwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52aXRhdGlvbkRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiB0ZXN0RW1haWwsXG4gICAgICAgIHJlY2lwaWVudE5hbWU6ICdLZXZpbiBIZXJ2aWV1eCcsXG4gICAgICAgIHRva2VuOiAndGVzdC1pbnZpdGF0aW9uLXRva2VuLTc4OScsXG4gICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6ICdLb3ZlbyBHZXN0aW9uIFRlc3QnLFxuICAgICAgICBpbnZpdGVyTmFtZTogJ1N5c3RlbSBBZG1pbmlzdHJhdG9yJyxcbiAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgcGVyc29uYWxNZXNzYWdlOiAnV2VsY29tZSB0byBvdXIgUXVlYmVjIHByb3BlcnR5IG1hbmFnZW1lbnQgc3lzdGVtISdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGVtYWlsU2VudCA9IGF3YWl0IGVtYWlsU2VydmljZS5zZW5kSW52aXRhdGlvbkVtYWlsKFxuICAgICAgICBpbnZpdGF0aW9uRGF0YS5lbWFpbCxcbiAgICAgICAgaW52aXRhdGlvbkRhdGEucmVjaXBpZW50TmFtZSxcbiAgICAgICAgaW52aXRhdGlvbkRhdGEudG9rZW4sXG4gICAgICAgIGludml0YXRpb25EYXRhLm9yZ2FuaXphdGlvbk5hbWUsXG4gICAgICAgIGludml0YXRpb25EYXRhLmludml0ZXJOYW1lLFxuICAgICAgICBpbnZpdGF0aW9uRGF0YS5yb2xlLFxuICAgICAgICBpbnZpdGF0aW9uRGF0YS5wZXJzb25hbE1lc3NhZ2VcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChlbWFpbFNlbnQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdHZW5lcmFsIEVtYWlsIEZ1bmN0aW9uYWxpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzZW5kIHdlbGNvbWUgZW1haWwgc3VjY2Vzc2Z1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgd2VsY29tZU1lc3NhZ2UgPSBgXG5CaWVudmVudWUgZGFucyBLb3ZlbyBHZXN0aW9uIVxuXG5Wb3RyZSBjb21wdGUgYWRtaW5pc3RyYXRldXIgYSDDqXTDqSBjb25maWd1csOpIGF2ZWMgc3VjY8Oocy5cblxuQ2FyYWN0w6lyaXN0aXF1ZXMgZGUgdm90cmUgY29tcHRlOlxuLSBSw7RsZTogQWRtaW5pc3RyYXRldXJcbi0gTGFuZ3VlOiBGcmFuw6dhaXNcbi0gQWNjw6hzIGNvbXBsZXQgYXUgc3lzdMOobWUgZGUgZ2VzdGlvbiBpbW1vYmlsacOocmVcblxuVm91cyBwb3V2ZXogbWFpbnRlbmFudCBhY2PDqWRlciDDoCB0b3V0ZXMgbGVzIGZvbmN0aW9ubmFsaXTDqXMgZGUgbGEgcGxhdGVmb3JtZS5cblxuQ29yZGlhbGVtZW50LFxuTCfDqXF1aXBlIEtvdmVvIEdlc3Rpb25cbiAgICAgIGAudHJpbSgpO1xuXG4gICAgICBjb25zdCBlbWFpbFNlbnQgPSBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZEVtYWlsKFxuICAgICAgICB0ZXN0RW1haWwsXG4gICAgICAgICdLZXZpbiBIZXJ2aWV1eCcsXG4gICAgICAgICdCaWVudmVudWUgZGFucyBLb3ZlbyBHZXN0aW9uIC0gQ29tcHRlIENvbmZpZ3Vyw6knLFxuICAgICAgICB3ZWxjb21lTWVzc2FnZSxcbiAgICAgICAgYFxuICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bztcIj5cbiAgICAgICAgICA8aDIgc3R5bGU9XCJjb2xvcjogIzAwNjZjYztcIj5CaWVudmVudWUgZGFucyBLb3ZlbyBHZXN0aW9uITwvaDI+XG4gICAgICAgICAgXG4gICAgICAgICAgPHA+Vm90cmUgY29tcHRlIGFkbWluaXN0cmF0ZXVyIGEgw6l0w6kgY29uZmlndXLDqSBhdmVjIHN1Y2PDqHMuPC9wPlxuICAgICAgICAgIFxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOWZhOyBwYWRkaW5nOiAxNXB4OyBib3JkZXItcmFkaXVzOiA4cHg7IG1hcmdpbjogMjBweCAwO1wiPlxuICAgICAgICAgICAgPGgzIHN0eWxlPVwibWFyZ2luLXRvcDogMDsgY29sb3I6ICM0OTUwNTc7XCI+Q2FyYWN0w6lyaXN0aXF1ZXMgZGUgdm90cmUgY29tcHRlOjwvaDM+XG4gICAgICAgICAgICA8dWwgc3R5bGU9XCJtYXJnaW4tYm90dG9tOiAwO1wiPlxuICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5Sw7RsZTo8L3N0cm9uZz4gQWRtaW5pc3RyYXRldXI8L2xpPlxuICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5MYW5ndWU6PC9zdHJvbmc+IEZyYW7Dp2FpczwvbGk+XG4gICAgICAgICAgICAgIDxsaT48c3Ryb25nPkFjY8Ooczo8L3N0cm9uZz4gQ29tcGxldCBhdSBzeXN0w6htZSBkZSBnZXN0aW9uIGltbW9iaWxpw6hyZTwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIFxuICAgICAgICAgIDxwPlZvdXMgcG91dmV6IG1haW50ZW5hbnQgYWNjw6lkZXIgw6AgdG91dGVzIGxlcyBmb25jdGlvbm5hbGl0w6lzIGRlIGxhIHBsYXRlZm9ybWUuPC9wPlxuICAgICAgICAgIFxuICAgICAgICAgIDxkaXYgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7IG1hcmdpbjogMzBweCAwO1wiPlxuICAgICAgICAgICAgPGEgaHJlZj1cImh0dHBzOi8va292ZW8tZ2VzdGlvbi5jb20vbG9naW5cIiBzdHlsZT1cImJhY2tncm91bmQtY29sb3I6ICMyOGE3NDU7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDRweDsgZGlzcGxheTogaW5saW5lLWJsb2NrO1wiPlxuICAgICAgICAgICAgICBTZSBjb25uZWN0ZXJcbiAgICAgICAgICAgIDwvYT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIGBcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChlbWFpbFNlbnQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNlbmQgZ2VuZXJhbCB0ZXN0IG5vdGlmaWNhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3ROb3RpZmljYXRpb24gPSBgXG5UZXN0IGRlIG5vdGlmaWNhdGlvbiAtIEtvdmVvIEdlc3Rpb25cblxuQ2UgbWVzc2FnZSBjb25maXJtZSBxdWUgbGUgc2VydmljZSBkZSBjb3VycmllbCBmb25jdGlvbm5lIGNvcnJlY3RlbWVudC5cblxuRMOpdGFpbHMgZHUgdGVzdDpcbi0gRGF0ZTogJHtuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCdmci1DQScpfVxuLSBUeXBlOiBOb3RpZmljYXRpb24gZ8OpbsOpcmFsZVxuLSBTeXN0w6htZTogR2VzdGlvbiBpbW1vYmlsacOocmUgUXVlYmVjXG4tIFN0YXR1dDogU2VydmljZSBlbWFpbCBvcMOpcmF0aW9ubmVsXG5cblRvdXMgbGVzIHRlc3RzIGRlIGNvdXJyaWVscyBzb250IG1haW50ZW5hbnQgdGVybWluw6lzLlxuICAgICAgYC50cmltKCk7XG5cbiAgICAgIGNvbnN0IGVtYWlsU2VudCA9IGF3YWl0IGVtYWlsU2VydmljZS5zZW5kRW1haWwoXG4gICAgICAgIHRlc3RFbWFpbCxcbiAgICAgICAgJ0tldmluIEhlcnZpZXV4JyxcbiAgICAgICAgJ1Rlc3QgTm90aWZpY2F0aW9uIC0gU2VydmljZSBFbWFpbCBPcMOpcmF0aW9ubmVsJyxcbiAgICAgICAgdGVzdE5vdGlmaWNhdGlvbixcbiAgICAgICAgYFxuICAgICAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bztcIj5cbiAgICAgICAgICA8aDIgc3R5bGU9XCJjb2xvcjogIzI4YTc0NTtcIj7inIUgVGVzdCBkZSBub3RpZmljYXRpb24gLSBLb3ZlbyBHZXN0aW9uPC9oMj5cbiAgICAgICAgICBcbiAgICAgICAgICA8cD5DZSBtZXNzYWdlIGNvbmZpcm1lIHF1ZSBsZSBzZXJ2aWNlIGRlIGNvdXJyaWVsIGZvbmN0aW9ubmUgY29ycmVjdGVtZW50LjwvcD5cbiAgICAgICAgICBcbiAgICAgICAgICA8ZGl2IHN0eWxlPVwiYmFja2dyb3VuZC1jb2xvcjogI2Q0ZWRkYTsgcGFkZGluZzogMTVweDsgYm9yZGVyLXJhZGl1czogOHB4OyBib3JkZXItbGVmdDogNHB4IHNvbGlkICMyOGE3NDU7IG1hcmdpbjogMjBweCAwO1wiPlxuICAgICAgICAgICAgPGgzIHN0eWxlPVwibWFyZ2luLXRvcDogMDsgY29sb3I6ICMxNTU3MjQ7XCI+RMOpdGFpbHMgZHUgdGVzdDo8L2gzPlxuICAgICAgICAgICAgPHVsIHN0eWxlPVwibWFyZ2luLWJvdHRvbTogMDsgY29sb3I6ICMxNTU3MjQ7XCI+XG4gICAgICAgICAgICAgIDxsaT48c3Ryb25nPkRhdGU6PC9zdHJvbmc+ICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygnZnItQ0EnKX08L2xpPlxuICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5UeXBlOjwvc3Ryb25nPiBOb3RpZmljYXRpb24gZ8OpbsOpcmFsZTwvbGk+XG4gICAgICAgICAgICAgIDxsaT48c3Ryb25nPlN5c3TDqG1lOjwvc3Ryb25nPiBHZXN0aW9uIGltbW9iaWxpw6hyZSBRdWViZWM8L2xpPlxuICAgICAgICAgICAgICA8bGk+PHN0cm9uZz5TdGF0dXQ6PC9zdHJvbmc+IFNlcnZpY2UgZW1haWwgb3DDqXJhdGlvbm5lbDwvbGk+XG4gICAgICAgICAgICA8L3VsPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIFxuICAgICAgICAgIDxwIHN0eWxlPVwiZm9udC13ZWlnaHQ6IGJvbGQ7IGNvbG9yOiAjMjhhNzQ1O1wiPlxuICAgICAgICAgICAg4pyFIFRvdXMgbGVzIHRlc3RzIGRlIGNvdXJyaWVscyBzb250IG1haW50ZW5hbnQgdGVybWluw6lzLlxuICAgICAgICAgIDwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIGBcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChlbWFpbFNlbnQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9