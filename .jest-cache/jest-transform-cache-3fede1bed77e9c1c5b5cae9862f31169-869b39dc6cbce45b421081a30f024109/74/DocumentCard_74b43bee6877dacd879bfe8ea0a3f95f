04af9b795bedecd44f70d1c3c7e140f7
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DocumentCard = DocumentCard;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importDefault(require("react"));
const lucide_react_1 = require("lucide-react");
const card_1 = require("@/components/ui/card");
const button_1 = require("@/components/ui/button");
const badge_1 = require("@/components/ui/badge");
const utils_1 = require("@/lib/utils");
/**
 * DocumentCard - A standardized card component for displaying document summaries
 * Optimized for mobile interactions with large touch targets
 */
function DocumentCard({ title, documentId, onViewClick, documentType, description, createdAt, fileSize, mimeType, uploadedBy, isVisibleToTenants, className, compact = false, showMetadata = true }) {
    // Get appropriate icon based on document type/mime type
    const getDocumentIcon = () => {
        if (mimeType?.startsWith('image/')) {
            return (0, jsx_runtime_1.jsx)(lucide_react_1.Image, { className: "w-5 h-5 text-blue-500" });
        }
        switch (mimeType) {
            case 'application/pdf':
                return (0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: "w-5 h-5 text-red-500" });
            case 'application/msword':
            case 'application/vnd.openxmlformats-officedocument.wordprocessingml.document':
                return (0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: "w-5 h-5 text-blue-600" });
            case 'application/vnd.ms-excel':
            case 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':
                return (0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: "w-5 h-5 text-green-600" });
            default:
                return (0, jsx_runtime_1.jsx)(lucide_react_1.File, { className: "w-5 h-5 text-gray-500" });
        }
    };
    // Format file size for display
    const formatFileSize = (bytes) => {
        if (!bytes)
            return null;
        const kb = bytes / 1024;
        if (kb < 1024)
            return `${kb.toFixed(1)} KB`;
        const mb = kb / 1024;
        return `${mb.toFixed(1)} MB`;
    };
    // Format date for display
    const formatDate = (dateString) => {
        if (!dateString)
            return null;
        return new Date(dateString).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    };
    // Get document type badge color
    const getTypeColor = (type) => {
        const colors = {
            'bylaw': 'bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200',
            'financial': 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200',
            'maintenance': 'bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200',
            'legal': 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200',
            'inspection': 'bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200',
            'insurance': 'bg-cyan-100 text-cyan-800 dark:bg-cyan-900 dark:text-cyan-200',
        };
        return colors[type || ''] || 'bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-200';
    };
    // Handle card click - entire card is clickable for mobile friendliness
    const handleCardClick = () => {
        onViewClick(documentId);
    };
    // Handle view button click (prevent event bubbling)
    const handleViewButtonClick = (e) => {
        e.stopPropagation();
        onViewClick(documentId);
    };
    return ((0, jsx_runtime_1.jsxs)(card_1.Card, { className: (0, utils_1.cn)("group cursor-pointer transition-all duration-200 hover:shadow-md hover:border-blue-200 dark:hover:border-blue-700", "active:scale-[0.98] transform", // Touch feedback
        compact ? "p-3" : "", className), onClick: handleCardClick, "data-testid": `document-card-${documentId}`, children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: (0, utils_1.cn)("flex flex-row items-start justify-between space-y-0", compact ? "pb-2" : "pb-3"), children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-start space-x-3 flex-1 min-w-0", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex-shrink-0 mt-1", children: getDocumentIcon() }), (0, jsx_runtime_1.jsxs)("div", { className: "flex-1 min-w-0", children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: (0, utils_1.cn)("text-left leading-tight break-words", compact ? "text-sm" : "text-base"), children: title }), description && !compact && ((0, jsx_runtime_1.jsx)("p", { className: "text-sm text-gray-600 dark:text-gray-400 mt-1 line-clamp-2", children: description }))] })] }), (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: "ghost", size: "sm", onClick: handleViewButtonClick, className: "flex-shrink-0 ml-2 min-h-[36px] min-w-[36px] hover:bg-blue-50 dark:hover:bg-blue-950", "data-testid": `view-document-${documentId}`, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Eye, { className: "w-4 h-4" }), (0, jsx_runtime_1.jsx)("span", { className: "sr-only", children: "View document" })] })] }), showMetadata && !compact && ((0, jsx_runtime_1.jsx)(card_1.CardContent, { className: "pt-0", children: (0, jsx_runtime_1.jsxs)("div", { className: "space-y-2", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex flex-wrap gap-2", children: [documentType && ((0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: "secondary", className: (0, utils_1.cn)("text-xs", getTypeColor(documentType)), children: documentType.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase()) })), isVisibleToTenants && ((0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: "outline", className: "text-xs border-green-300 text-green-700 dark:border-green-600 dark:text-green-400", children: "\uD83D\uDC65 Visible to Tenants" }))] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between text-xs text-gray-500 dark:text-gray-400", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-4", children: [createdAt && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: "w-3 h-3" }), (0, jsx_runtime_1.jsx)("span", { children: formatDate(createdAt) })] })), uploadedBy && ((0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-1", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.User, { className: "w-3 h-3" }), (0, jsx_runtime_1.jsx)("span", { className: "truncate max-w-20", children: uploadedBy })] }))] }), fileSize && ((0, jsx_runtime_1.jsx)("span", { className: "text-gray-400 dark:text-gray-500", children: formatFileSize(fileSize) }))] })] }) })), showMetadata && compact && ((0, jsx_runtime_1.jsx)(card_1.CardContent, { className: "pt-0", children: (0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between text-xs text-gray-500 dark:text-gray-400", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center space-x-2", children: [documentType && ((0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: "secondary", className: "text-xs", children: documentType })), createdAt && (0, jsx_runtime_1.jsx)("span", { children: formatDate(createdAt) })] }), fileSize && (0, jsx_runtime_1.jsx)("span", { children: formatFileSize(fileSize) })] }) }))] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvZG9jdW1lbnQtbWFuYWdlbWVudC9Eb2N1bWVudENhcmQudHN4IiwibWFwcGluZ3MiOiI7Ozs7O0FBK0JBLG9DQStMQzs7QUE5TkQsa0RBQTBCO0FBQzFCLCtDQUEwRTtBQUMxRSwrQ0FBZ0Y7QUFDaEYsbURBQWdEO0FBQ2hELGlEQUE4QztBQUM5Qyx1Q0FBaUM7QUFzQmpDOzs7R0FHRztBQUNILFNBQWdCLFlBQVksQ0FBQyxFQUMzQixLQUFLLEVBQ0wsVUFBVSxFQUNWLFdBQVcsRUFDWCxZQUFZLEVBQ1osV0FBVyxFQUNYLFNBQVMsRUFDVCxRQUFRLEVBQ1IsUUFBUSxFQUNSLFVBQVUsRUFDVixrQkFBa0IsRUFDbEIsU0FBUyxFQUNULE9BQU8sR0FBRyxLQUFLLEVBQ2YsWUFBWSxHQUFHLElBQUksRUFDRDtJQUVsQix3REFBd0Q7SUFDeEQsTUFBTSxlQUFlLEdBQUcsR0FBRyxFQUFFO1FBQzNCLElBQUksUUFBUSxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ25DLE9BQU8sdUJBQUMsb0JBQUssSUFBQyxTQUFTLEVBQUMsdUJBQXVCLEdBQUcsQ0FBQztRQUNyRCxDQUFDO1FBRUQsUUFBUSxRQUFRLEVBQUUsQ0FBQztZQUNqQixLQUFLLGlCQUFpQjtnQkFDcEIsT0FBTyx1QkFBQyx1QkFBUSxJQUFDLFNBQVMsRUFBQyxzQkFBc0IsR0FBRyxDQUFDO1lBQ3ZELEtBQUssb0JBQW9CLENBQUM7WUFDMUIsS0FBSyx5RUFBeUU7Z0JBQzVFLE9BQU8sdUJBQUMsdUJBQVEsSUFBQyxTQUFTLEVBQUMsdUJBQXVCLEdBQUcsQ0FBQztZQUN4RCxLQUFLLDBCQUEwQixDQUFDO1lBQ2hDLEtBQUssbUVBQW1FO2dCQUN0RSxPQUFPLHVCQUFDLHVCQUFRLElBQUMsU0FBUyxFQUFDLHdCQUF3QixHQUFHLENBQUM7WUFDekQ7Z0JBQ0UsT0FBTyx1QkFBQyxtQkFBSSxJQUFDLFNBQVMsRUFBQyx1QkFBdUIs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U0FBUyxFQUFDLFNBQVMsR0FBRyxFQUM1QixpQ0FBTSxTQUFTLEVBQUMsbUJBQW1CLFlBQUUsVUFBVSxHQUFRLElBQ25ELENBQ1AsSUFDRyxFQUVMLFFBQVEsSUFBSSxDQUNYLGlDQUFNLFNBQVMsRUFBQyxrQ0FBa0MsWUFDL0MsY0FBYyxDQUFDLFFBQVEsQ0FBQyxHQUNwQixDQUNSLElBQ0csSUFDRixHQUNNLENBQ2YsRUFHQSxZQUFZLElBQUksT0FBTyxJQUFJLENBQzFCLHVCQUFDLGtCQUFXLElBQUMsU0FBUyxFQUFDLE1BQU0sWUFDM0IsaUNBQUssU0FBUyxFQUFDLDRFQUE0RSxhQUN6RixpQ0FBSyxTQUFTLEVBQUMsNkJBQTZCLGFBQ3pDLFlBQVksSUFBSSxDQUNmLHVCQUFDLGFBQUssSUFBQyxPQUFPLEVBQUMsV0FBVyxFQUFDLFNBQVMsRUFBQyxTQUFTLFlBQzNDLFlBQVksR0FDUCxDQUNULEVBQ0EsU0FBUyxJQUFJLDJDQUFPLFVBQVUsQ0FBQyxTQUFTLENBQUMsR0FBUSxJQUM5QyxFQUNMLFFBQVEsSUFBSSwyQ0FBTyxjQUFjLENBQUMsUUFBUSxDQUFDLEdBQVEsSUFDaEQsR0FDTSxDQUNmLElBQ0ksQ0FDUixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvY29tcG9uZW50cy9kb2N1bWVudC1tYW5hZ2VtZW50L0RvY3VtZW50Q2FyZC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEV5ZSwgRmlsZVRleHQsIEltYWdlLCBGaWxlLCBDYWxlbmRhciwgVXNlciB9IGZyb20gJ2x1Y2lkZS1yZWFjdCc7XG5pbXBvcnQgeyBDYXJkLCBDYXJkSGVhZGVyLCBDYXJkVGl0bGUsIENhcmRDb250ZW50IH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2NhcmQnO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2J1dHRvbic7XG5pbXBvcnQgeyBCYWRnZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9iYWRnZSc7XG5pbXBvcnQgeyBjbiB9IGZyb20gJ0AvbGliL3V0aWxzJztcblxuaW50ZXJmYWNlIERvY3VtZW50Q2FyZFByb3BzIHtcbiAgdGl0bGU6IHN0cmluZztcbiAgZG9jdW1lbnRJZDogc3RyaW5nO1xuICBvblZpZXdDbGljazogKGRvY3VtZW50SWQ6IHN0cmluZykgPT4gdm9pZDtcbiAgXG4gIC8vIE9wdGlvbmFsIG1ldGFkYXRhIGZvciBlbmhhbmNlZCBkaXNwbGF5XG4gIGRvY3VtZW50VHlwZT86IHN0cmluZztcbiAgZGVzY3JpcHRpb24/OiBzdHJpbmc7XG4gIGNyZWF0ZWRBdD86IHN0cmluZztcbiAgZmlsZVNpemU/OiBudW1iZXI7XG4gIG1pbWVUeXBlPzogc3RyaW5nO1xuICB1cGxvYWRlZEJ5Pzogc3RyaW5nO1xuICBpc1Zpc2libGVUb1RlbmFudHM/OiBib29sZWFuO1xuICBcbiAgLy8gVmlzdWFsIGN1c3RvbWl6YXRpb25cbiAgY2xhc3NOYW1lPzogc3RyaW5nO1xuICBjb21wYWN0PzogYm9vbGVhbjtcbiAgc2hvd01ldGFkYXRhPzogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBEb2N1bWVudENhcmQgLSBBIHN0YW5kYXJkaXplZCBjYXJkIGNvbXBvbmVudCBmb3IgZGlzcGxheWluZyBkb2N1bWVudCBzdW1tYXJpZXNcbiAqIE9wdGltaXplZCBmb3IgbW9iaWxlIGludGVyYWN0aW9ucyB3aXRoIGxhcmdlIHRvdWNoIHRhcmdldHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIERvY3VtZW50Q2FyZCh7XG4gIHRpdGxlLFxuICBkb2N1bWVudElkLFxuICBvblZpZXdDbGljayxcbiAgZG9jdW1lbnRUeXBlLFxuICBkZXNjcmlwdGlvbixcbiAgY3JlYXRlZEF0LFxuICBmaWxlU2l6ZSxcbiAgbWltZVR5cGUsXG4gIHVwbG9hZGVkQnksXG4gIGlzVmlzaWJsZVRvVGVuYW50cyxcbiAgY2xhc3NOYW1lLFxuICBjb21wYWN0ID0gZmFsc2UsXG4gIHNob3dNZXRhZGF0YSA9IHRydWVcbn06IERvY3VtZW50Q2FyZFByb3BzKSB7XG4gIFxuICAvLyBHZXQgYXBwcm9wcmlhdGUgaWNvbiBiYXNlZCBvbiBkb2N1bWVudCB0eXBlL21pbWUgdHlwZVxuICBjb25zdCBnZXREb2N1bWVudEljb24gPSAoKSA9PiB7XG4gICAgaWYgKG1pbWVUeXBlPy5zdGFydHNXaXRoKCdpbWFnZS8nKSkge1xuICAgICAgcmV0dXJuIDxJbWFnZSBjbGFzc05hbWU9XCJ3LTUgaC01IHRleHQtYmx1ZS01MDBcIiAvPjtcbiAgICB9XG4gICAgXG4gICAgc3dpdGNoIChtaW1lVHlwZSkge1xuICAgICAgY2FzZSAnYXBwbGljYXRpb24vcGRmJzpcbiAgICAgICAgcmV0dXJuIDxGaWxlVGV4dCBjbGFzc05hbWU9XCJ3LTUgaC01IHRleHQtcmVkLTUwMFwiIC8+O1xuICAgICAgY2FzZSAnYXBwbGljYXRpb24vbXN3b3JkJzpcbiAgICAgIGNhc2UgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50JzpcbiAgICAgICAgcmV0dXJuIDxGaWxlVGV4dCBjbGFzc05hbWU9XCJ3LTUgaC01IHRleHQtYmx1ZS02MDBcIiAvPjtcbiAgICAgIGNhc2UgJ2FwcGxpY2F0aW9uL3ZuZC5tcy1leGNlbCc6XG4gICAgICBjYXNlICdhcHBsaWNhdGlvbi92bmQub3BlbnhtbGZvcm1hdHMtb2ZmaWNlZG9jdW1lbnQuc3ByZWFkc2hlZXRtbC5zaGVldCc6XG4gICAgICAgIHJldHVybiA8RmlsZVRleHQgY2xhc3NOYW1lPVwidy01IGgtNSB0ZXh0LWdyZWVuLTYwMFwiIC8+O1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDxGaWxlIGNsYXNzTmFtZT1cInctNSBoLTUgdGV4dC1ncmF5LTUwMFwiIC8+O1xuICAgIH1cbiAgfTtcblxuICAvLyBGb3JtYXQgZmlsZSBzaXplIGZvciBkaXNwbGF5XG4gIGNvbnN0IGZvcm1hdEZpbGVTaXplID0gKGJ5dGVzPzogbnVtYmVyKSA9PiB7XG4gICAgaWYgKCFieXRlcykgcmV0dXJuIG51bGw7XG4gICAgY29uc3Qga2IgPSBieXRlcyAvIDEwMjQ7XG4gICAgaWYgKGtiIDwgMTAyNCkgcmV0dXJuIGAke2tiLnRvRml4ZWQoMSl9IEtCYDtcbiAgICBjb25zdCBtYiA9IGtiIC8gMTAyNDtcbiAgICByZXR1cm4gYCR7bWIudG9GaXhlZCgxKX0gTUJgO1xuICB9O1xuXG4gIC8vIEZvcm1hdCBkYXRlIGZvciBkaXNwbGF5XG4gIGNvbnN0IGZvcm1hdERhdGUgPSAoZGF0ZVN0cmluZz86IHN0cmluZykgPT4ge1xuICAgIGlmICghZGF0ZVN0cmluZykgcmV0dXJuIG51bGw7XG4gICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVTdHJpbmcpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCB7XG4gICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICBtb250aDogJ3Nob3J0JyxcbiAgICAgIGRheTogJ251bWVyaWMnXG4gICAgfSk7XG4gIH07XG5cbiAgLy8gR2V0IGRvY3VtZW50IHR5cGUgYmFkZ2UgY29sb3JcbiAgY29uc3QgZ2V0VHlwZUNvbG9yID0gKHR5cGU/OiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBjb2xvcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgICAnYnlsYXcnOiAnYmctcHVycGxlLTEwMCB0ZXh0LXB1cnBsZS04MDAgZGFyazpiZy1wdXJwbGUtOTAwIGRhcms6dGV4dC1wdXJwbGUtMjAwJyxcbiAgICAgICdmaW5hbmNpYWwnOiAnYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwIGRhcms6YmctZ3JlZW4tOTAwIGRhcms6dGV4dC1ncmVlbi0yMDAnLFxuICAgICAgJ21haW50ZW5hbmNlJzogJ2JnLW9yYW5nZS0xMDAgdGV4dC1vcmFuZ2UtODAwIGRhcms6Ymctb3JhbmdlLTkwMCBkYXJrOnRleHQtb3JhbmdlLTIwMCcsXG4gICAgICAnbGVnYWwnOiAnYmctcmVkLTEwMCB0ZXh0LXJlZC04MDAgZGFyazpiZy1yZWQtOTAwIGRhcms6dGV4dC1yZWQtMjAwJyxcbiAgICAgICdpbnNwZWN0aW9uJzogJ2JnLWJsdWUtMTAwIHRleHQtYmx1ZS04MDAgZGFyazpiZy1ibHVlLTkwMCBkYXJrOnRleHQtYmx1ZS0yMDAnLFxuICAgICAgJ2luc3VyYW5jZSc6ICdiZy1jeWFuLTEwMCB0ZXh0LWN5YW4tODAwIGRhcms6YmctY3lhbi05MDAgZGFyazp0ZXh0LWN5YW4tMjAwJyxcbiAgICB9O1xuICAgIHJldHVybiBjb2xvcnNbdHlwZSB8fCAnJ10gfHwgJ2JnLWdyYXktMTAwIHRleHQtZ3JheS04MDAgZGFyazpiZy1ncmF5LTgwMCBkYXJrOnRleHQtZ3JheS0yMDAnO1xuICB9O1xuXG4gIC8vIEhhbmRsZSBjYXJkIGNsaWNrIC0gZW50aXJlIGNhcmQgaXMgY2xpY2thYmxlIGZvciBtb2JpbGUgZnJpZW5kbGluZXNzXG4gIGNvbnN0IGhhbmRsZUNhcmRDbGljayA9ICgpID0+IHtcbiAgICBvblZpZXdDbGljayhkb2N1bWVudElkKTtcbiAgfTtcblxuICAvLyBIYW5kbGUgdmlldyBidXR0b24gY2xpY2sgKHByZXZlbnQgZXZlbnQgYnViYmxpbmcpXG4gIGNvbnN0IGhhbmRsZVZpZXdCdXR0b25DbGljayA9IChlOiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7XG4gICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICBvblZpZXdDbGljayhkb2N1bWVudElkKTtcbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxDYXJkIFxuICAgICAgY2xhc3NOYW1lPXtjbihcbiAgICAgICAgXCJncm91cCBjdXJzb3ItcG9pbnRlciB0cmFuc2l0aW9uLWFsbCBkdXJhdGlvbi0yMDAgaG92ZXI6c2hhZG93LW1kIGhvdmVyOmJvcmRlci1ibHVlLTIwMCBkYXJrOmhvdmVyOmJvcmRlci1ibHVlLTcwMFwiLFxuICAgICAgICBcImFjdGl2ZTpzY2FsZS1bMC45OF0gdHJhbnNmb3JtXCIsIC8vIFRvdWNoIGZlZWRiYWNrXG4gICAgICAgIGNvbXBhY3QgPyBcInAtM1wiIDogXCJcIixcbiAgICAgICAgY2xhc3NOYW1lXG4gICAgICApfVxuICAgICAgb25DbGljaz17aGFuZGxlQ2FyZENsaWNrfVxuICAgICAgZGF0YS10ZXN0aWQ9e2Bkb2N1bWVudC1jYXJkLSR7ZG9jdW1lbnRJZH1gfVxuICAgID5cbiAgICAgIDxDYXJkSGVhZGVyIGNsYXNzTmFtZT17Y24oXCJmbGV4IGZsZXgtcm93IGl0ZW1zLXN0YXJ0IGp1c3RpZnktYmV0d2VlbiBzcGFjZS15LTBcIiwgY29tcGFjdCA/IFwicGItMlwiIDogXCJwYi0zXCIpfT5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGl0ZW1zLXN0YXJ0IHNwYWNlLXgtMyBmbGV4LTEgbWluLXctMFwiPlxuICAgICAgICAgIHsvKiBEb2N1bWVudCBpY29uICovfVxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleC1zaHJpbmstMCBtdC0xXCI+XG4gICAgICAgICAgICB7Z2V0RG9jdW1lbnRJY29uKCl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgXG4gICAgICAgICAgey8qIERvY3VtZW50IGluZm8gKi99XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTEgbWluLXctMFwiPlxuICAgICAgICAgICAgPENhcmRUaXRsZSBjbGFzc05hbWU9e2NuKFxuICAgICAgICAgICAgICBcInRleHQtbGVmdCBsZWFkaW5nLXRpZ2h0IGJyZWFrLXdvcmRzXCIsXG4gICAgICAgICAgICAgIGNvbXBhY3QgPyBcInRleHQtc21cIiA6IFwidGV4dC1iYXNlXCJcbiAgICAgICAgICAgICl9PlxuICAgICAgICAgICAgICB7dGl0bGV9XG4gICAgICAgICAgICA8L0NhcmRUaXRsZT5cbiAgICAgICAgICAgIFxuICAgICAgICAgICAge2Rlc2NyaXB0aW9uICYmICFjb21wYWN0ICYmIChcbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC1zbSB0ZXh0LWdyYXktNjAwIGRhcms6dGV4dC1ncmF5LTQwMCBtdC0xIGxpbmUtY2xhbXAtMlwiPlxuICAgICAgICAgICAgICAgIHtkZXNjcmlwdGlvbn1cbiAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgey8qIFZpZXcgYnV0dG9uICovfVxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgdmFyaWFudD1cImdob3N0XCJcbiAgICAgICAgICBzaXplPVwic21cIlxuICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZVZpZXdCdXR0b25DbGlja31cbiAgICAgICAgICBjbGFzc05hbWU9XCJmbGV4LXNocmluay0wIG1sLTIgbWluLWgtWzM2cHhdIG1pbi13LVszNnB4XSBob3ZlcjpiZy1ibHVlLTUwIGRhcms6aG92ZXI6YmctYmx1ZS05NTBcIlxuICAgICAgICAgIGRhdGEtdGVzdGlkPXtgdmlldy1kb2N1bWVudC0ke2RvY3VtZW50SWR9YH1cbiAgICAgICAgPlxuICAgICAgICAgIDxFeWUgY2xhc3NOYW1lPVwidy00IGgtNFwiIC8+XG4gICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwic3Itb25seVwiPlZpZXcgZG9jdW1lbnQ8L3NwYW4+XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgPC9DYXJkSGVhZGVyPlxuXG4gICAgICB7c2hvd01ldGFkYXRhICYmICFjb21wYWN0ICYmIChcbiAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT1cInB0LTBcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInNwYWNlLXktMlwiPlxuICAgICAgICAgICAgey8qIERvY3VtZW50IHR5cGUgYW5kIHZpc2liaWxpdHkgYmFkZ2VzICovfVxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtd3JhcCBnYXAtMlwiPlxuICAgICAgICAgICAgICB7ZG9jdW1lbnRUeXBlICYmIChcbiAgICAgICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD1cInNlY29uZGFyeVwiIGNsYXNzTmFtZT17Y24oXCJ0ZXh0LXhzXCIsIGdldFR5cGVDb2xvcihkb2N1bWVudFR5cGUpKX0+XG4gICAgICAgICAgICAgICAgICB7ZG9jdW1lbnRUeXBlLnJlcGxhY2UoJ18nLCAnICcpLnJlcGxhY2UoL1xcYlxcdy9nLCBsID0+IGwudG9VcHBlckNhc2UoKSl9XG4gICAgICAgICAgICAgICAgPC9CYWRnZT5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHtpc1Zpc2libGVUb1RlbmFudHMgJiYgKFxuICAgICAgICAgICAgICAgIDxCYWRnZSB2YXJpYW50PVwib3V0bGluZVwiIGNsYXNzTmFtZT1cInRleHQteHMgYm9yZGVyLWdyZWVuLTMwMCB0ZXh0LWdyZWVuLTcwMCBkYXJrOmJvcmRlci1ncmVlbi02MDAgZGFyazp0ZXh0LWdyZWVuLTQwMFwiPlxuICAgICAgICAgICAgICAgICAg8J+RpSBWaXNpYmxlIHRvIFRlbmFudHNcbiAgICAgICAgICAgICAgICA8L0JhZGdlPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIHsvKiBNZXRhZGF0YSByb3cgKi99XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiB0ZXh0LXhzIHRleHQtZ3JheS01MDAgZGFyazp0ZXh0LWdyYXktNDAwXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC00XCI+XG4gICAgICAgICAgICAgICAge2NyZWF0ZWRBdCAmJiAoXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMVwiPlxuICAgICAgICAgICAgICAgICAgICA8Q2FsZW5kYXIgY2xhc3NOYW1lPVwidy0zIGgtM1wiIC8+XG4gICAgICAgICAgICAgICAgICAgIDxzcGFuPntmb3JtYXREYXRlKGNyZWF0ZWRBdCl9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB7dXBsb2FkZWRCeSAmJiAoXG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMVwiPlxuICAgICAgICAgICAgICAgICAgICA8VXNlciBjbGFzc05hbWU9XCJ3LTMgaC0zXCIgLz5cbiAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidHJ1bmNhdGUgbWF4LXctMjBcIj57dXBsb2FkZWRCeX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHtmaWxlU2l6ZSAmJiAoXG4gICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPVwidGV4dC1ncmF5LTQwMCBkYXJrOnRleHQtZ3JheS01MDBcIj5cbiAgICAgICAgICAgICAgICAgIHtmb3JtYXRGaWxlU2l6ZShmaWxlU2l6ZSl9XG4gICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICApfVxuXG4gICAgICB7LyogQ29tcGFjdCBtZXRhZGF0YSBmb3IgY29tcGFjdCBtb2RlICovfVxuICAgICAge3Nob3dNZXRhZGF0YSAmJiBjb21wYWN0ICYmIChcbiAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT1cInB0LTBcIj5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiB0ZXh0LXhzIHRleHQtZ3JheS01MDAgZGFyazp0ZXh0LWdyYXktNDAwXCI+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtMlwiPlxuICAgICAgICAgICAgICB7ZG9jdW1lbnRUeXBlICYmIChcbiAgICAgICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD1cInNlY29uZGFyeVwiIGNsYXNzTmFtZT1cInRleHQteHNcIj5cbiAgICAgICAgICAgICAgICAgIHtkb2N1bWVudFR5cGV9XG4gICAgICAgICAgICAgICAgPC9CYWRnZT5cbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAge2NyZWF0ZWRBdCAmJiA8c3Bhbj57Zm9ybWF0RGF0ZShjcmVhdGVkQXQpfTwvc3Bhbj59XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgIHtmaWxlU2l6ZSAmJiA8c3Bhbj57Zm9ybWF0RmlsZVNpemUoZmlsZVNpemUpfTwvc3Bhbj59XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICApfVxuICAgIDwvQ2FyZD5cbiAgKTtcbn0iXSwidmVyc2lvbiI6M30=