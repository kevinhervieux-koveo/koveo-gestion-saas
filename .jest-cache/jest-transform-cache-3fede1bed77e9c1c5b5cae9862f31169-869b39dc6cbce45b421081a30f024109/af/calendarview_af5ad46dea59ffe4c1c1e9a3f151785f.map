{"file":"/home/runner/workspace/client/src/components/common-spaces/calendar-view.tsx","mappings":"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","names":[],"sources":["/home/runner/workspace/client/src/components/common-spaces/calendar-view.tsx"],"sourcesContent":["import { useState, useMemo } from 'react';\nimport { useQuery, useQueryClient } from '@tanstack/react-query';\nimport {\n  format,\n  addDays,\n  startOfMonth,\n  endOfMonth,\n  eachDayOfInterval,\n  isSameDay,\n  parseISO,\n  isToday,\n} from 'date-fns';\nimport { fr } from 'date-fns/locale';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from '@/components/ui/select';\nimport { Separator } from '@/components/ui/separator';\nimport { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';\nimport {\n  Calendar as CalendarIcon,\n  ChevronLeft,\n  ChevronRight,\n  Clock,\n  User,\n  Users,\n  Eye,\n  EyeOff,\n} from 'lucide-react';\nimport { apiRequest } from '@/lib/queryClient';\nimport { useLanguage } from '@/hooks/use-language';\nimport { useAuth } from '@/hooks/use-auth';\n\n/**\n *\n */\ninterface CalendarEvent {\n  id: string;\n  startTime: string;\n  endTime: string;\n  status: 'confirmed' | 'cancelled';\n  userId?: string | null;\n  userName: string;\n  userEmail?: string | null;\n  isOwnBooking?: boolean;\n  spaceName?: string;\n  spaceId?: string;\n  buildingName?: string;\n  userRole?: string;\n}\n\n/**\n *\n */\ninterface CalendarViewProps {\n  spaceId?: string;\n  buildingId?: string;\n  mode: 'space' | 'user' | 'building';\n  onEventClick?: (event: CalendarEvent) => void;\n  onDateClick?: (date: Date) => void;\n  showControls?: boolean;\n  className?: string;\n}\n\n/**\n *\n */\ninterface CalendarData {\n  space?: {\n    id: string;\n    name: string;\n    isReservable: boolean;\n    openingHours?: any;\n  };\n  user?: {\n    id: string;\n    name: string;\n    role: string;\n  };\n  building?: {\n    id: string;\n    name: string;\n    address: string;\n  };\n  calendar: {\n    view: string;\n    startDate: string;\n    endDate: string;\n    events?: CalendarEvent[];\n    bookings?: CalendarEvent[];\n  };\n  permissions?: {\n    canViewDetails: boolean;\n    canCreateBookings: boolean;\n  };\n  summary?: {\n    totalBookings: number;\n    totalHours?: number;\n    totalSpaces?: number;\n    activeSpaces?: number;\n    uniqueUsers?: number;\n  };\n}\n\n/**\n *\n * @param root0\n * @param root0.spaceId\n * @param root0.buildingId\n * @param root0.mode\n * @param root0.onEventClick\n * @param root0.onDateClick\n * @param root0.showControls\n * @param root0.className\n */\nexport function CalendarView({\n  spaceId,\n  buildingId,\n  mode,\n  onEventClick,\n  onDateClick,\n  showControls = true,\n  className = '',\n}: CalendarViewProps) {\n  const { t, language } = useLanguage();\n  const { user } = useAuth();\n  const [currentDate, setCurrentDate] = useState(new Date());\n  const [viewMode, setViewMode] = useState<'month' | 'week'>('month');\n  const queryClient = useQueryClient();\n\n  const startDate = startOfMonth(currentDate).toISOString();\n  const endDate = endOfMonth(currentDate).toISOString();\n\n  // Build API URL based on mode\n  const apiUrl = useMemo(() => {\n    const params = new URLSearchParams({\n      start_date: startDate,\n      end_date: endDate,\n      view: viewMode,\n    });\n\n    if (mode === 'space' && spaceId) {\n      return `/api/common-spaces/calendar/${spaceId}?${params}`;\n    } else if (mode === 'building' && buildingId) {\n      return `/api/common-spaces/calendar/building/${buildingId}?${params}`;\n    } else if (mode === 'user') {\n      return `/api/common-spaces/user-calendar?${params}`;\n    }\n    return null;\n  }, [mode, spaceId, buildingId, startDate, endDate, viewMode]);\n\n  const { data, isLoading, error } = useQuery<CalendarData>({\n    queryKey: ['calendar', mode, spaceId, buildingId, startDate, endDate, viewMode],\n    queryFn: async () => {\n      if (!apiUrl) {\n        return null;\n      }\n\n      try {\n        const response = await apiRequest('GET', apiUrl);\n        return await response.json();\n      } catch (error: any) {\n        // Handle authentication errors specifically - suppress for timing issues\n        if (error.message?.includes('401')) {\n          throw new Error('Authentication required for calendar access');\n        }\n        throw error;\n      }\n    },\n    enabled: !!apiUrl && !!user && !!user.id,\n    retry: (failureCount, error: any) => {\n      // Don't retry on auth errors\n      if (error?.message?.includes('Authentication required')) {\n        return false;\n      }\n      return failureCount < 2;\n    },\n  });\n\n  const monthDays = useMemo(() => {\n    const start = startOfMonth(currentDate);\n    const end = endOfMonth(currentDate);\n    return eachDayOfInterval({ start, end });\n  }, [currentDate]);\n\n  const getEventsForDay = (day: Date) => {\n    if (!data?.calendar) {\n      return [];\n    }\n\n    const events = data.calendar.events || data.calendar.bookings || [];\n    return events.filter(\n      (event) => isSameDay(parseISO(event.startTime), day) && event.status === 'confirmed'\n    );\n  };\n\n  const formatEventTime = (startTime: string, endTime: string) => {\n    const start = parseISO(startTime);\n    const end = parseISO(endTime);\n    const locale = language === 'fr' ? fr : undefined;\n    return `${format(start, 'HH:mm', { locale })} - ${format(end, 'HH:mm', { locale })}`;\n  };\n\n  const getEventDisplayName = (event: CalendarEvent) => {\n    if (mode === 'user') {\n      return event.spaceName || event.userName;\n    }\n\n    if (data?.permissions?.canViewDetails || event.isOwnBooking) {\n      return event.userName;\n    }\n\n    return event.userName === 'Déjà Réservé' ? 'Déjà Réservé' : 'Réservé';\n  };\n\n  const goToPrevMonth = () => {\n    setCurrentDate((prev) => {\n      const newDate = new Date(prev);\n      newDate.setMonth(prev.getMonth() - 1);\n      return newDate;\n    });\n  };\n\n  const goToNextMonth = () => {\n    setCurrentDate((prev) => {\n      const newDate = new Date(prev);\n      newDate.setMonth(prev.getMonth() + 1);\n      return newDate;\n    });\n  };\n\n  if (error) {\n    const isAuthError =\n      error.message?.includes('Authentication required') || error.message?.includes('401');\n\n    return (\n      <Card className={className}>\n        <CardContent className='p-6'>\n          <div className='text-center space-y-3' data-testid='calendar-error'>\n            <div className='text-red-600'>\n              {isAuthError\n                ? language === 'fr'\n                  ? 'Authentification requise pour le calendrier'\n                  : 'Authentication required for calendar'\n                : language === 'fr'\n                  ? 'Erreur lors du chargement du calendrier'\n                  : 'Error loading calendar'}\n            </div>\n            {isAuthError && (\n              <div className='text-sm text-gray-600'>\n                {language === 'fr'\n                  ? 'Veuillez vous reconnecter pour accéder au calendrier'\n                  : 'Please sign in again to access the calendar'}\n              </div>\n            )}\n            <Button\n              variant='outline'\n              size='sm'\n              onClick={() => queryClient.invalidateQueries({ queryKey: ['calendar'] })}\n              data-testid='retry-calendar'\n            >\n              {language === 'fr' ? 'Réessayer' : 'Retry'}\n            </Button>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  return (\n    <TooltipProvider>\n      <Card className={className} data-testid='calendar-view'>\n        <CardHeader className='pb-4'>\n          <div className='flex items-center justify-between'>\n            <CardTitle className='flex items-center gap-2'>\n              <CalendarIcon className='h-5 w-5' />\n              {mode === 'space' && data?.space?.name && <span>{data.space.name}</span>}\n              {mode === 'user' && (\n                <span>{language === 'fr' ? 'Mon Calendrier' : 'My Calendar'}</span>\n              )}\n              {mode === 'building' && data?.building?.name && (\n                <span>\n                  {data.building.name} - {language === 'fr' ? 'Calendrier' : 'Calendar'}\n                </span>\n              )}\n            </CardTitle>\n\n            {showControls && (\n              <div className='flex items-center gap-2'>\n                <Select\n                  value={viewMode}\n                  onValueChange={(value: 'month' | 'week') => setViewMode(value)}\n                >\n                  <SelectTrigger className='w-32'>\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value='month'>{language === 'fr' ? 'Mois' : 'Month'}</SelectItem>\n                    <SelectItem value='week'>{language === 'fr' ? 'Semaine' : 'Week'}</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            )}\n          </div>\n\n          <div className='flex items-center justify-between'>\n            <div className='flex items-center gap-4'>\n              <Button variant='outline' size='sm' onClick={goToPrevMonth} data-testid='prev-month'>\n                <ChevronLeft className='h-4 w-4' />\n              </Button>\n\n              <h3 className='text-lg font-semibold' data-testid='current-month'>\n                {format(currentDate, 'MMMM yyyy', { locale: language === 'fr' ? fr : undefined })}\n              </h3>\n\n              <Button variant='outline' size='sm' onClick={goToNextMonth} data-testid='next-month'>\n                <ChevronRight className='h-4 w-4' />\n              </Button>\n            </div>\n\n            {data?.summary && (\n              <div className='flex items-center gap-4 text-sm text-muted-foreground'>\n                <div className='flex items-center gap-1'>\n                  <Clock className='h-4 w-4' />\n                  <span>\n                    {data.summary.totalBookings} {language === 'fr' ? 'réservations' : 'bookings'}\n                  </span>\n                </div>\n                {data.summary.totalHours && (\n                  <div className='flex items-center gap-1'>\n                    <span>{Math.round(data.summary.totalHours * 10) / 10}h</span>\n                  </div>\n                )}\n                {data.summary.uniqueUsers && (\n                  <div className='flex items-center gap-1'>\n                    <Users className='h-4 w-4' />\n                    <span>\n                      {data.summary.uniqueUsers} {language === 'fr' ? 'utilisateurs' : 'users'}\n                    </span>\n                  </div>\n                )}\n              </div>\n            )}\n          </div>\n        </CardHeader>\n\n        <CardContent>\n          {isLoading ? (\n            <div className='flex items-center justify-center py-12' data-testid='calendar-loading'>\n              <div className='animate-spin rounded-full h-8 w-8 border-b-2 border-primary'></div>\n            </div>\n          ) : (\n            <div className='space-y-4'>\n              {/* Calendar Grid */}\n              <div className='grid grid-cols-7 gap-1'>\n                {/* Week day headers */}\n                {['L', 'M', 'M', 'J', 'V', 'S', 'D'].map((day, index) => (\n                  <div\n                    key={index}\n                    className='p-2 text-center text-sm font-medium text-muted-foreground border-b'\n                  >\n                    {day}\n                  </div>\n                ))}\n\n                {/* Calendar days */}\n                {monthDays.map((day, index) => {\n                  const dayEvents = getEventsForDay(day);\n                  const isCurrentDay = isToday(day);\n\n                  return (\n                    <div\n                      key={index}\n                      className={`\n                        min-h-[80px] p-1 border border-border/50 \n                        ${isCurrentDay ? 'bg-primary/10 border-primary/30' : 'bg-card hover:bg-muted/50'}\n                        transition-colors cursor-pointer\n                      `}\n                      onClick={() => onDateClick?.(day)}\n                      data-testid={`calendar-day-${format(day, 'yyyy-MM-dd')}`}\n                    >\n                      <div\n                        className={`text-xs font-medium mb-1 ${isCurrentDay ? 'text-primary' : 'text-foreground'}`}\n                      >\n                        {format(day, 'd')}\n                      </div>\n\n                      <div className='space-y-0.5'>\n                        {dayEvents.slice(0, 2).map((event, eventIndex) => (\n                          <Tooltip key={eventIndex}>\n                            <TooltipTrigger asChild>\n                              <div\n                                className={`\n                                  text-xs p-1 rounded truncate cursor-pointer\n                                  ${\n                                    event.isOwnBooking\n                                      ? 'bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200 border border-green-200 dark:border-green-800'\n                                      : data?.permissions?.canViewDetails\n                                        ? 'bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 border border-blue-200 dark:border-blue-800'\n                                        : 'bg-gray-100 dark:bg-gray-900/30 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-800'\n                                  }\n                                `}\n                                onClick={() => onEventClick?.(event)}\n                                data-testid={`calendar-event-${event.id}`}\n                              >\n                                <div className='flex items-center gap-1'>\n                                  {event.isOwnBooking && <User className='h-3 w-3' />}\n                                  {data?.permissions?.canViewDetails && !event.isOwnBooking && (\n                                    <Eye className='h-3 w-3' />\n                                  )}\n                                  {!data?.permissions?.canViewDetails && !event.isOwnBooking && (\n                                    <EyeOff className='h-3 w-3' />\n                                  )}\n                                  <span className='truncate'>{getEventDisplayName(event)}</span>\n                                </div>\n                              </div>\n                            </TooltipTrigger>\n                            <TooltipContent>\n                              <div className='space-y-1'>\n                                <p className='font-medium'>{getEventDisplayName(event)}</p>\n                                <p className='text-xs'>\n                                  {formatEventTime(event.startTime, event.endTime)}\n                                </p>\n                                {mode === 'user' && event.spaceName && (\n                                  <p className='text-xs opacity-80'>{event.spaceName}</p>\n                                )}\n                                {mode === 'user' && event.buildingName && (\n                                  <p className='text-xs opacity-80'>{event.buildingName}</p>\n                                )}\n                                {data?.permissions?.canViewDetails && event.userEmail && (\n                                  <p className='text-xs opacity-80'>{event.userEmail}</p>\n                                )}\n                              </div>\n                            </TooltipContent>\n                          </Tooltip>\n                        ))}\n\n                        {dayEvents.length > 2 && (\n                          <div className='text-xs text-muted-foreground'>\n                            +{dayEvents.length - 2} {language === 'fr' ? 'autres' : 'more'}\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n\n              {/* Legend */}\n              <div className='flex items-center justify-center gap-6 pt-4 border-t'>\n                <div className='flex items-center gap-2'>\n                  <div className='w-3 h-3 rounded bg-green-200 border border-green-300'></div>\n                  <span className='text-xs text-muted-foreground'>\n                    {language === 'fr' ? 'Mes réservations' : 'My bookings'}\n                  </span>\n                </div>\n                {data?.permissions?.canViewDetails ? (\n                  <div className='flex items-center gap-2'>\n                    <div className='w-3 h-3 rounded bg-blue-200 border border-blue-300'></div>\n                    <span className='text-xs text-muted-foreground'>\n                      {language === 'fr' ? 'Autres réservations' : 'Other bookings'}\n                    </span>\n                  </div>\n                ) : (\n                  <div className='flex items-center gap-2'>\n                    <div className='w-3 h-3 rounded bg-gray-200 border border-gray-300'></div>\n                    <span className='text-xs text-muted-foreground'>\n                      {language === 'fr' ? 'Déjà réservé' : 'Already reserved'}\n                    </span>\n                  </div>\n                )}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </TooltipProvider>\n  );\n}\n"],"version":3}