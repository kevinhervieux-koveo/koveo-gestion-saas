74a93f0e0488fbc76a92c16c9ce0f0e9
"use strict";
/**
 * Organizations API endpoints for admin operations.
 * Provides CRUD operations for organization management.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerOrganizationRoutes = registerOrganizationRoutes;
const db_1 = require("../db");
const schema_1 = require("@shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
const auth_1 = require("../auth");
/**
 *
 * @param app
 */
/**
 * RegisterOrganizationRoutes function.
 * @param app
 * @returns Function result.
 */
function registerOrganizationRoutes(app) {
    /**
     * GET /api/organizations - Retrieves organizations accessible to the current user
     * Returns array of organizations directly for frontend components.
     */
    app.get('/api/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            console.log(`📊 Fetching organizations for user ${currentUser.id} with role ${currentUser.role}`);
            // Get organizations based on user role
            let organizationsQuery;
            if (currentUser.role === 'admin') {
                // Admin can see all organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema_1.organizations.id,
                    name: schema_1.organizations.name,
                    type: schema_1.organizations.type,
                    address: schema_1.organizations.address,
                    city: schema_1.organizations.city,
                    province: schema_1.organizations.province,
                    postalCode: schema_1.organizations.postalCode,
                    phone: schema_1.organizations.phone,
                    email: schema_1.organizations.email,
                    website: schema_1.organizations.website,
                    registrationNumber: schema_1.organizations.registrationNumber,
                    isActive: schema_1.organizations.isActive,
                    createdAt: schema_1.organizations.createdAt,
                })
                    .from(schema_1.organizations)
                    .where((0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true))
                    .orderBy(schema_1.organizations.name);
            }
            else {
                // Other users see organizations they have access to through user_organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema_1.organizations.id,
                    name: schema_1.organizations.name,
                    type: schema_1.organizations.type,
                    address: schema_1.organizations.address,
                    city: schema_1.organizations.city,
                    province: schema_1.organizations.province,
                    postalCode: schema_1.organizations.postalCode,
                    phone: schema_1.organizations.phone,
                    email: schema_1.organizations.email,
                    website: schema_1.organizations.website,
                    registrationNumber: schema_1.organizations.registrationNumber,
                    isActive: schema_1.organizations.isActive,
                    createdAt: schema_1.organizations.createdAt,
                })
                    .from(schema_1.organizations)
                    .innerJoin(schema_1.userOrganizations, (0, drizzle_orm_1.eq)(schema_1.organizations.id, schema_1.userOrganizations.organizationId))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                    .orderBy(schema_1.organizations.name);
            }
            const accessibleOrganizations = await organizationsQuery;
            console.log(`✅ Found ${accessibleOrganizations.length} organizations for user ${currentUser.id}`);
            // Return array directly (not wrapped in object)
            res.json(accessibleOrganizations);
        }
        catch (error) {
            console.error('❌ Error fetching organizations:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch organizations',
            });
        }
    });
    /**
     * GET /api/admin/organizations - Retrieves all organizations for admin users
     * Only admin users can access all organizations.
     */
    app.get('/api/admin/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            // Get all organizations for admin
            const allOrganizations = await db_1.db
                .select({
                id: schema_1.organizations.id,
                name: schema_1.organizations.name,
                type: schema_1.organizations.type,
                address: schema_1.organizations.address,
                city: schema_1.organizations.city,
                province: schema_1.organizations.province,
                postalCode: schema_1.organizations.postalCode,
                phone: schema_1.organizations.phone,
                email: schema_1.organizations.email,
                website: schema_1.organizations.website,
                registrationNumber: schema_1.organizations.registrationNumber,
                isActive: schema_1.organizations.isActive,
                createdAt: schema_1.organizations.createdAt,
            })
                .from(schema_1.organizations)
                .where((0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true))
                .orderBy(schema_1.organizations.name);
            res.json({
                organizations: allOrganizations,
            });
        }
        catch (error) {
            console.error('❌ Error fetching organizations:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch organizations',
            });
        }
    });
    /**
     * POST /api/organizations - Create a new organization
     * Allows authorized users to create organizations.
     */
    app.post('/api/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admin users can create organizations for now
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required to create organizations',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const organizationData = req.body;
            // Insert new organization
            const [newOrganization] = await db_1.db
                .insert(schema_1.organizations)
                .values({
                name: organizationData.name,
                type: organizationData.type,
                address: organizationData.address,
                city: organizationData.city,
                province: organizationData.province || 'QC',
                postalCode: organizationData.postalCode,
                phone: organizationData.phone || null,
                email: organizationData.email || null,
                website: organizationData.website || null,
                registrationNumber: organizationData.registrationNumber || null,
            })
                .returning({
                id: schema_1.organizations.id,
                name: schema_1.organizations.name,
                type: schema_1.organizations.type,
                address: schema_1.organizations.address,
                city: schema_1.organizations.city,
                province: schema_1.organizations.province,
                postalCode: schema_1.organizations.postalCode,
                phone: schema_1.organizations.phone,
                email: schema_1.organizations.email,
                website: schema_1.organizations.website,
                registrationNumber: schema_1.organizations.registrationNumber,
                isActive: schema_1.organizations.isActive,
                createdAt: schema_1.organizations.createdAt,
            });
            // Organization storage hierarchy will be created automatically when documents are uploaded
            console.log('Organization created - storage hierarchy will be created on first document upload');
            res.status(201).json(newOrganization);
        }
        catch (error) {
            console.error('❌ Error creating organization:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to create organization',
            });
        }
    });
    /**
     * GET /api/organizations/:id - Get organization by ID
     */
    app.get('/api/organizations/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const organizationId = req.params.id;
            // Find the organization
            const [organization] = await db_1.db
                .select()
                .from(schema_1.organizations)
                .where((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId));
            if (!organization) {
                return res.status(404).json({
                    message: 'Organization not found',
                    code: 'NOT_FOUND',
                });
            }
            res.json(organization);
        }
        catch (error) {
            console.error('❌ Error fetching organization:', error);
            res.status(500).json({
                message: 'Failed to fetch organization',
                code: 'SERVER_ERROR',
            });
        }
    });
    /**
     * PUT /api/organizations/:id - Update an existing organization
     * Allows authorized users to update organization details.
     */
    app.put('/api/organizations/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admin users can update organizations
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required to update organizations',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const organizationId = req.params.id;
            const updateData = req.body;
            // Check if organization exists
            const existingOrg = await db_1.db
                .select()
                .from(schema_1.organizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId), (0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true)))
                .limit(1);
            if (existingOrg.length === 0) {
                return res.status(404).json({
                    message: 'Organization not found',
                    code: 'NOT_FOUND',
                });
            }
            // Update organization
            const [updatedOrganization] = await db_1.db
                .update(schema_1.organizations)
                .set({
                name: updateData.name,
                type: updateData.type,
                address: updateData.address,
                city: updateData.city,
                province: updateData.province || 'QC',
                postalCode: updateData.postalCode,
                phone: updateData.phone || null,
                email: updateData.email || null,
                website: updateData.website || null,
                registrationNumber: updateData.registrationNumber || null,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId))
                .returning({
                id: schema_1.organizations.id,
                name: schema_1.organizations.name,
                type: schema_1.organizations.type,
                address: schema_1.organizations.address,
                city: schema_1.organizations.city,
                province: schema_1.organizations.province,
                postalCode: schema_1.organizations.postalCode,
                phone: schema_1.organizations.phone,
                email: schema_1.organizations.email,
                website: schema_1.organizations.website,
                registrationNumber: schema_1.organizations.registrationNumber,
                isActive: schema_1.organizations.isActive,
                createdAt: schema_1.organizations.createdAt,
                updatedAt: schema_1.organizations.updatedAt,
            });
            res.json(updatedOrganization);
        }
        catch (error) {
            console.error('❌ Error updating organization:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update organization',
            });
        }
    });
    /**
     * GET /api/organizations/:id/deletion-impact - Get deletion impact analysis
     * Shows what will be deleted when removing an organization.
     */
    app.get('/api/organizations/:id/deletion-impact', auth_1.requireAuth, async (req, res) => {
        const organizationId = req.params.id;
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            // Check if organization exists
            const organization = await db_1.db
                .select({ id: schema_1.organizations.id, name: schema_1.organizations.name })
                .from(schema_1.organizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId), (0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true)))
                .limit(1);
            if (organization.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Organization not found',
                });
            }
            // Count buildings in this organization
            const buildingsCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.count)() })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)));
            // Count residences in buildings of this organization
            const residencesCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.count)() })
                .from(schema_1.residences)
                .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, schema_1.buildings.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            // Count invitations associated with this organization
            let totalInvitations = 0;
            try {
                const invitationsCount = await db_1.db
                    .select({ count: (0, drizzle_orm_1.count)() })
                    .from(schema_1.invitations)
                    .where((0, drizzle_orm_1.eq)(schema_1.invitations.organizationId, organizationId));
                totalInvitations = invitationsCount[0]?.count || 0;
            }
            catch (___invError) {
                totalInvitations = 0;
            }
            // Count users who will become orphaned (only belong to this organization)
            const potentialOrphansCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.count)() })
                .from(schema_1.userOrganizations)
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, schema_1.users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema_1.users.isActive, true)));
            const impact = {
                organization: organization[0],
                buildings: buildingsCount[0]?.count || 0,
                residences: residencesCount[0]?.count || 0,
                invitations: totalInvitations,
                potentialOrphanedUsers: potentialOrphansCount[0]?.count || 0,
            };
            res.json(impact);
        }
        catch (error) {
            console.error('❌ Error analyzing deletion impact:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to analyze deletion impact',
            });
        }
    });
    /**
     * DELETE /api/organizations/:id - Cascade delete an organization
     * Deletes organization and all related entities (buildings, residences, documents). Users are preserved for data safety.
     */
    app.delete('/api/organizations/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const organizationId = req.params.id;
            // Check if organization exists
            const organization = await db_1.db
                .select({ id: schema_1.organizations.id, name: schema_1.organizations.name })
                .from(schema_1.organizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId), (0, drizzle_orm_1.eq)(schema_1.organizations.isActive, true)))
                .limit(1);
            if (organization.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Organization not found',
                });
            }
            console.log(`🗑️ Deleting organization ${organizationId} with cascade delete...`);
            // Since Neon HTTP driver doesn't support transactions, we'll do cascading delete manually
            // in the correct order to maintain referential integrity
            // 1. Get all buildings in this organization (including already inactive ones)
            const orgBuildings = await db_1.db
                .select({ id: schema_1.buildings.id })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationId));
            if (orgBuildings.length > 0) {
                const orgBuildingIds = orgBuildings.map((b) => b.id);
                // 2. Soft delete residences first (children of buildings) - get ALL residences in these buildings
                const affectedResidences = await db_1.db
                    .update(schema_1.residences)
                    .set({ isActive: false, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.inArray)(schema_1.residences.buildingId, orgBuildingIds))
                    .returning({ id: schema_1.residences.id, unitNumber: schema_1.residences.unitNumber });
                console.log(`🗑️ Soft deleted ${affectedResidences.length} residences in buildings: ${orgBuildingIds.join(', ')}`);
                // 3. Soft delete buildings
                const affectedBuildings = await db_1.db
                    .update(schema_1.buildings)
                    .set({ isActive: false, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.inArray)(schema_1.buildings.id, orgBuildingIds))
                    .returning({ id: schema_1.buildings.id, name: schema_1.buildings.name });
                console.log(`🗑️ Soft deleted ${affectedBuildings.length} buildings: ${affectedBuildings.map((b) => b.name).join(', ')}`);
            }
            // 4. Delete user-organization relationships
            await db_1.db
                .delete(schema_1.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, organizationId));
            // 5. DISABLED: User deletion is now prohibited for data safety
            // Users are never deleted during cascade operations to prevent permanent data loss
            // This protects against accidental deletion of user accounts and their historical data
            console.log('⚠️  User deletion disabled for data safety - users will be preserved');
            // Optional: Log users who would have been affected for admin review
            const affectedUsers = await db_1.db
                .select({
                id: schema_1.users.id,
                email: schema_1.users.email,
                firstName: schema_1.users.firstName,
                lastName: schema_1.users.lastName,
            })
                .from(schema_1.users)
                .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userOrganizations.userId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userOrganizations.userId)));
            if (affectedUsers.length > 0) {
                console.log(`⚠️  ${affectedUsers.length} users are now without organization assignments but have been preserved:`, affectedUsers.map(u => u.email));
                // DISABLED: Users are no longer deleted - they are preserved for data safety
            }
            // 6. Finally, soft delete the organization
            await db_1.db
                .update(schema_1.organizations)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema_1.organizations.id, organizationId));
            // Object storage cleanup will be handled automatically
            try {
                console.log('Organization deleted - storage cleanup will be handled automatically');
            }
            catch (storageError) {
                console.error('⚠️ Object storage cleanup failed, but organization deletion succeeded:', storageError);
            }
            res.json({
                message: 'Organization and related entities deleted successfully',
                deletedOrganization: organization[0].name,
            });
        }
        catch (error) {
            console.error('❌ Error deleting organization:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to delete organization and related entities',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxzRUFBc0UsQ0FBQyxDQUFDO1lBQ3RGLENBQUM7WUFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO2dCQUN0QixPQUFPLENBQUMsS0FBSyxDQUNYLHdFQUF3RSxFQUN4RSxZQUFZLENBQ2IsQ0FBQztZQUNKLENBQUM7WUFFRCxHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSx3REFBd0Q7Z0JBQ2pFLG1CQUFtQixFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJO2FBQzFDLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsZ0NBQWdDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDdkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSx1QkFBdUI7Z0JBQy9CLE9BQU8sRUFBRSxvREFBb0Q7YUFDOUQsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvb3JnYW5pemF0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE9yZ2FuaXphdGlvbnMgQVBJIGVuZHBvaW50cyBmb3IgYWRtaW4gb3BlcmF0aW9ucy5cbiAqIFByb3ZpZGVzIENSVUQgb3BlcmF0aW9ucyBmb3Igb3JnYW5pemF0aW9uIG1hbmFnZW1lbnQuXG4gKi9cblxuaW1wb3J0IHsgRXhwcmVzcyB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQge1xuICBvcmdhbml6YXRpb25zLFxuICBidWlsZGluZ3MsXG4gIHJlc2lkZW5jZXMsXG4gIHVzZXJzLFxuICB1c2VyT3JnYW5pemF0aW9ucyxcbiAgdXNlclJlc2lkZW5jZXMsXG4gIGludml0YXRpb25zLFxufSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBhbmQsIGVxLCBjb3VudCwgc3FsLCBvciwgaW5BcnJheSwgaXNOdWxsLCBuZSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnLi4vYXV0aCc7XG5cbi8qKlxuICpcbiAqIEBwYXJhbSBhcHBcbiAqL1xuLyoqXG4gKiBSZWdpc3Rlck9yZ2FuaXphdGlvblJvdXRlcyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBhcHBcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyT3JnYW5pemF0aW9uUm91dGVzKGFwcDogRXhwcmVzcyk6IHZvaWQge1xuICAvKipcbiAgICogR0VUIC9hcGkvb3JnYW5pemF0aW9ucyAtIFJldHJpZXZlcyBvcmdhbml6YXRpb25zIGFjY2Vzc2libGUgdG8gdGhlIGN1cnJlbnQgdXNlclxuICAgKiBSZXR1cm5zIGFycmF5IG9mIG9yZ2FuaXphdGlvbnMgZGlyZWN0bHkgZm9yIGZyb250ZW5kIGNvbXBvbmVudHMuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL29yZ2FuaXphdGlvbnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+TiiBGZXRjaGluZyBvcmdhbml6YXRpb25zIGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9IHdpdGggcm9sZSAke2N1cnJlbnRVc2VyLnJvbGV9YFxuICAgICAgKTtcblxuICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbnMgYmFzZWQgb24gdXNlciByb2xlXG4gICAgICBsZXQgb3JnYW5pemF0aW9uc1F1ZXJ5O1xuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbiBjYW4gc2VlIGFsbCBvcmdhbml6YXRpb25zXG4gICAgICAgIG9yZ2FuaXphdGlvbnNRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogb3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICAgIG5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIHR5cGU6IG9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IG9yZ2FuaXphdGlvbnMuYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IG9yZ2FuaXphdGlvbnMuY2l0eSxcbiAgICAgICAgICAgIHByb3ZpbmNlOiBvcmdhbml6YXRpb25zLnByb3ZpbmNlLFxuICAgICAgICAgICAgcG9zdGFsQ29kZTogb3JnYW5pemF0aW9ucy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgcGhvbmU6IG9yZ2FuaXphdGlvbnMucGhvbmUsXG4gICAgICAgICAgICBlbWFpbDogb3JnYW5pemF0aW9ucy5lbWFpbCxcbiAgICAgICAgICAgIHdlYnNpdGU6IG9yZ2FuaXphdGlvbnMud2Vic2l0ZSxcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbk51bWJlcjogb3JnYW5pemF0aW9ucy5yZWdpc3RyYXRpb25OdW1iZXIsXG4gICAgICAgICAgICBpc0FjdGl2ZTogb3JnYW5pemF0aW9ucy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogb3JnYW5pemF0aW9ucy5jcmVhdGVkQXQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShvcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShvcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICAub3JkZXJCeShvcmdhbml6YXRpb25zLm5hbWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gT3RoZXIgdXNlcnMgc2VlIG9yZ2FuaXphdGlvbnMgdGhleSBoYXZlIGFjY2VzcyB0byB0aHJvdWdoIHVzZXJfb3JnYW5pemF0aW9uc1xuICAgICAgICBvcmdhbml6YXRpb25zUXVlcnkgPSBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IG9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICAgICAgICBuYW1lOiBvcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgICB0eXBlOiBvcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgICBhZGRyZXNzOiBvcmdhbml6YXRpb25zLmFkZHJlc3MsXG4gICAgICAgICAgICBjaXR5OiBvcmdhbml6YXRpb25zLmNpdHksXG4gICAgICAgICAgICBwcm92aW5jZTogb3JnYW5pemF0aW9ucy5wcm92aW5jZSxcbiAgICAgICAgICAgIHBvc3RhbENvZGU6IG9yZ2FuaXphdGlvbnMucG9zdGFsQ29kZSxcbiAgICAgICAgICAgIHBob25lOiBvcmdhbml6YXRpb25zLnBob25lLFxuICAgICAgICAgICAgZW1haWw6IG9yZ2FuaXphdGlvbnMuZW1haWwsXG4gICAgICAgICAgICB3ZWJzaXRlOiBvcmdhbml6YXRpb25zLndlYnNpdGUsXG4gICAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IG9yZ2FuaXphdGlvbnMucmVnaXN0cmF0aW9uTnVtYmVyLFxuICAgICAgICAgICAgaXNBY3RpdmU6IG9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IG9yZ2FuaXphdGlvbnMuY3JlYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20ob3JnYW5pemF0aW9ucylcbiAgICAgICAgICAuaW5uZXJKb2luKHVzZXJPcmdhbml6YXRpb25zLCBlcShvcmdhbml6YXRpb25zLmlkLCB1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShvcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgZXEodXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAub3JkZXJCeShvcmdhbml6YXRpb25zLm5hbWUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhY2Nlc3NpYmxlT3JnYW5pemF0aW9ucyA9IGF3YWl0IG9yZ2FuaXphdGlvbnNRdWVyeTtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg4pyFIEZvdW5kICR7YWNjZXNzaWJsZU9yZ2FuaXphdGlvbnMubGVuZ3RofSBvcmdhbml6YXRpb25zIGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9YFxuICAgICAgKTtcblxuICAgICAgLy8gUmV0dXJuIGFycmF5IGRpcmVjdGx5IChub3Qgd3JhcHBlZCBpbiBvYmplY3QpXG4gICAgICByZXMuanNvbihhY2Nlc3NpYmxlT3JnYW5pemF0aW9ucyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIG9yZ2FuaXphdGlvbnM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIG9yZ2FuaXphdGlvbnMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvYWRtaW4vb3JnYW5pemF0aW9ucyAtIFJldHJpZXZlcyBhbGwgb3JnYW5pemF0aW9ucyBmb3IgYWRtaW4gdXNlcnNcbiAgICogT25seSBhZG1pbiB1c2VycyBjYW4gYWNjZXNzIGFsbCBvcmdhbml6YXRpb25zLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9hZG1pbi9vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG5cbiAgICAgIC8vIEdldCBhbGwgb3JnYW5pemF0aW9ucyBmb3IgYWRtaW5cbiAgICAgIGNvbnN0IGFsbE9yZ2FuaXphdGlvbnMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogb3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICBuYW1lOiBvcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgdHlwZTogb3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgIGFkZHJlc3M6IG9yZ2FuaXphdGlvbnMuYWRkcmVzcyxcbiAgICAgICAgICBjaXR5OiBvcmdhbml6YXRpb25zLmNpdHksXG4gICAgICAgICAgcHJvdmluY2U6IG9yZ2FuaXphdGlvbnMucHJvdmluY2UsXG4gICAgICAgICAgcG9zdGFsQ29kZTogb3JnYW5pemF0aW9ucy5wb3N0YWxDb2RlLFxuICAgICAgICAgIHBob25lOiBvcmdhbml6YXRpb25zLnBob25lLFxuICAgICAgICAgIGVtYWlsOiBvcmdhbml6YXRpb25zLmVtYWlsLFxuICAgICAgICAgIHdlYnNpdGU6IG9yZ2FuaXphdGlvbnMud2Vic2l0ZSxcbiAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IG9yZ2FuaXphdGlvbnMucmVnaXN0cmF0aW9uTnVtYmVyLFxuICAgICAgICAgIGlzQWN0aXZlOiBvcmdhbml6YXRpb25zLmlzQWN0aXZlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogb3JnYW5pemF0aW9ucy5jcmVhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKG9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShvcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lKTtcblxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG9yZ2FuaXphdGlvbnM6IGFsbE9yZ2FuaXphdGlvbnMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgb3JnYW5pemF0aW9uczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIF9lcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggb3JnYW5pemF0aW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvb3JnYW5pemF0aW9ucyAtIENyZWF0ZSBhIG5ldyBvcmdhbml6YXRpb25cbiAgICogQWxsb3dzIGF1dGhvcml6ZWQgdXNlcnMgdG8gY3JlYXRlIG9yZ2FuaXphdGlvbnMuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWluIHVzZXJzIGNhbiBjcmVhdGUgb3JnYW5pemF0aW9ucyBmb3Igbm93XG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQgdG8gY3JlYXRlIG9yZ2FuaXphdGlvbnMnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25EYXRhID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIEluc2VydCBuZXcgb3JnYW5pemF0aW9uXG4gICAgICBjb25zdCBbbmV3T3JnYW5pemF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQob3JnYW5pemF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgbmFtZTogb3JnYW5pemF0aW9uRGF0YS5uYW1lLFxuICAgICAgICAgIHR5cGU6IG9yZ2FuaXphdGlvbkRhdGEudHlwZSxcbiAgICAgICAgICBhZGRyZXNzOiBvcmdhbml6YXRpb25EYXRhLmFkZHJlc3MsXG4gICAgICAgICAgY2l0eTogb3JnYW5pemF0aW9uRGF0YS5jaXR5LFxuICAgICAgICAgIHByb3ZpbmNlOiBvcmdhbml6YXRpb25EYXRhLnByb3ZpbmNlIHx8ICdRQycsXG4gICAgICAgICAgcG9zdGFsQ29kZTogb3JnYW5pemF0aW9uRGF0YS5wb3N0YWxDb2RlLFxuICAgICAgICAgIHBob25lOiBvcmdhbml6YXRpb25EYXRhLnBob25lIHx8IG51bGwsXG4gICAgICAgICAgZW1haWw6IG9yZ2FuaXphdGlvbkRhdGEuZW1haWwgfHwgbnVsbCxcbiAgICAgICAgICB3ZWJzaXRlOiBvcmdhbml6YXRpb25EYXRhLndlYnNpdGUgfHwgbnVsbCxcbiAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IG9yZ2FuaXphdGlvbkRhdGEucmVnaXN0cmF0aW9uTnVtYmVyIHx8IG51bGwsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoe1xuICAgICAgICAgIGlkOiBvcmdhbml6YXRpb25zLmlkLFxuICAgICAgICAgIG5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICB0eXBlOiBvcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgYWRkcmVzczogb3JnYW5pemF0aW9ucy5hZGRyZXNzLFxuICAgICAgICAgIGNpdHk6IG9yZ2FuaXphdGlvbnMuY2l0eSxcbiAgICAgICAgICBwcm92aW5jZTogb3JnYW5pemF0aW9ucy5wcm92aW5jZSxcbiAgICAgICAgICBwb3N0YWxDb2RlOiBvcmdhbml6YXRpb25zLnBvc3RhbENvZGUsXG4gICAgICAgICAgcGhvbmU6IG9yZ2FuaXphdGlvbnMucGhvbmUsXG4gICAgICAgICAgZW1haWw6IG9yZ2FuaXphdGlvbnMuZW1haWwsXG4gICAgICAgICAgd2Vic2l0ZTogb3JnYW5pemF0aW9ucy53ZWJzaXRlLFxuICAgICAgICAgIHJlZ2lzdHJhdGlvbk51bWJlcjogb3JnYW5pemF0aW9ucy5yZWdpc3RyYXRpb25OdW1iZXIsXG4gICAgICAgICAgaXNBY3RpdmU6IG9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsXG4gICAgICAgICAgY3JlYXRlZEF0OiBvcmdhbml6YXRpb25zLmNyZWF0ZWRBdCxcbiAgICAgICAgfSk7XG5cblxuICAgICAgLy8gT3JnYW5pemF0aW9uIHN0b3JhZ2UgaGllcmFyY2h5IHdpbGwgYmUgY3JlYXRlZCBhdXRvbWF0aWNhbGx5IHdoZW4gZG9jdW1lbnRzIGFyZSB1cGxvYWRlZFxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICdPcmdhbml6YXRpb24gY3JlYXRlZCAtIHN0b3JhZ2UgaGllcmFyY2h5IHdpbGwgYmUgY3JlYXRlZCBvbiBmaXJzdCBkb2N1bWVudCB1cGxvYWQnXG4gICAgICApO1xuXG4gICAgICByZXMuc3RhdHVzKDIwMSkuanNvbihuZXdPcmdhbml6YXRpb24pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBvcmdhbml6YXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBvcmdhbml6YXRpb24nLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvb3JnYW5pemF0aW9ucy86aWQgLSBHZXQgb3JnYW5pemF0aW9uIGJ5IElEXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL29yZ2FuaXphdGlvbnMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IHJlcS5wYXJhbXMuaWQ7XG5cbiAgICAgIC8vIEZpbmQgdGhlIG9yZ2FuaXphdGlvblxuICAgICAgY29uc3QgW29yZ2FuaXphdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20ob3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKG9yZ2FuaXphdGlvbnMuaWQsIG9yZ2FuaXphdGlvbklkKSk7XG5cbiAgICAgIGlmICghb3JnYW5pemF0aW9uKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ09yZ2FuaXphdGlvbiBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24ob3JnYW5pemF0aW9uKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgb3JnYW5pemF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBvcmdhbml6YXRpb24nLFxuICAgICAgICBjb2RlOiAnU0VSVkVSX0VSUk9SJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBVVCAvYXBpL29yZ2FuaXphdGlvbnMvOmlkIC0gVXBkYXRlIGFuIGV4aXN0aW5nIG9yZ2FuaXphdGlvblxuICAgKiBBbGxvd3MgYXV0aG9yaXplZCB1c2VycyB0byB1cGRhdGUgb3JnYW5pemF0aW9uIGRldGFpbHMuXG4gICAqL1xuICBhcHAucHV0KCcvYXBpL29yZ2FuaXphdGlvbnMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWluIHVzZXJzIGNhbiB1cGRhdGUgb3JnYW5pemF0aW9uc1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkIHRvIHVwZGF0ZSBvcmdhbml6YXRpb25zJyxcbiAgICAgICAgICBjb2RlOiAnQURNSU5fUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgdXBkYXRlRGF0YSA9IHJlcS5ib2R5O1xuXG5cbiAgICAgIC8vIENoZWNrIGlmIG9yZ2FuaXphdGlvbiBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nT3JnID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKG9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShhbmQoZXEob3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpLCBlcShvcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGV4aXN0aW5nT3JnLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdPcmdhbml6YXRpb24gbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSBvcmdhbml6YXRpb25cbiAgICAgIGNvbnN0IFt1cGRhdGVkT3JnYW5pemF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUob3JnYW5pemF0aW9ucylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgbmFtZTogdXBkYXRlRGF0YS5uYW1lLFxuICAgICAgICAgIHR5cGU6IHVwZGF0ZURhdGEudHlwZSxcbiAgICAgICAgICBhZGRyZXNzOiB1cGRhdGVEYXRhLmFkZHJlc3MsXG4gICAgICAgICAgY2l0eTogdXBkYXRlRGF0YS5jaXR5LFxuICAgICAgICAgIHByb3ZpbmNlOiB1cGRhdGVEYXRhLnByb3ZpbmNlIHx8ICdRQycsXG4gICAgICAgICAgcG9zdGFsQ29kZTogdXBkYXRlRGF0YS5wb3N0YWxDb2RlLFxuICAgICAgICAgIHBob25lOiB1cGRhdGVEYXRhLnBob25lIHx8IG51bGwsXG4gICAgICAgICAgZW1haWw6IHVwZGF0ZURhdGEuZW1haWwgfHwgbnVsbCxcbiAgICAgICAgICB3ZWJzaXRlOiB1cGRhdGVEYXRhLndlYnNpdGUgfHwgbnVsbCxcbiAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IHVwZGF0ZURhdGEucmVnaXN0cmF0aW9uTnVtYmVyIHx8IG51bGwsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEob3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAucmV0dXJuaW5nKHtcbiAgICAgICAgICBpZDogb3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICBuYW1lOiBvcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgdHlwZTogb3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgIGFkZHJlc3M6IG9yZ2FuaXphdGlvbnMuYWRkcmVzcyxcbiAgICAgICAgICBjaXR5OiBvcmdhbml6YXRpb25zLmNpdHksXG4gICAgICAgICAgcHJvdmluY2U6IG9yZ2FuaXphdGlvbnMucHJvdmluY2UsXG4gICAgICAgICAgcG9zdGFsQ29kZTogb3JnYW5pemF0aW9ucy5wb3N0YWxDb2RlLFxuICAgICAgICAgIHBob25lOiBvcmdhbml6YXRpb25zLnBob25lLFxuICAgICAgICAgIGVtYWlsOiBvcmdhbml6YXRpb25zLmVtYWlsLFxuICAgICAgICAgIHdlYnNpdGU6IG9yZ2FuaXphdGlvbnMud2Vic2l0ZSxcbiAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IG9yZ2FuaXphdGlvbnMucmVnaXN0cmF0aW9uTnVtYmVyLFxuICAgICAgICAgIGlzQWN0aXZlOiBvcmdhbml6YXRpb25zLmlzQWN0aXZlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogb3JnYW5pemF0aW9ucy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBvcmdhbml6YXRpb25zLnVwZGF0ZWRBdCxcbiAgICAgICAgfSk7XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWRPcmdhbml6YXRpb24pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBvcmdhbml6YXRpb246JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIG9yZ2FuaXphdGlvbicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9vcmdhbml6YXRpb25zLzppZC9kZWxldGlvbi1pbXBhY3QgLSBHZXQgZGVsZXRpb24gaW1wYWN0IGFuYWx5c2lzXG4gICAqIFNob3dzIHdoYXQgd2lsbCBiZSBkZWxldGVkIHdoZW4gcmVtb3ZpbmcgYW4gb3JnYW5pemF0aW9uLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9vcmdhbml6YXRpb25zLzppZC9kZWxldGlvbi1pbXBhY3QnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IHJlcS5wYXJhbXMuaWQ7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIG9yZ2FuaXphdGlvbiBleGlzdHNcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbiA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBpZDogb3JnYW5pemF0aW9ucy5pZCwgbmFtZTogb3JnYW5pemF0aW9ucy5uYW1lIH0pXG4gICAgICAgIC5mcm9tKG9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShhbmQoZXEob3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpLCBlcShvcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKG9yZ2FuaXphdGlvbi5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdPcmdhbml6YXRpb24gbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvdW50IGJ1aWxkaW5ncyBpbiB0aGlzIG9yZ2FuaXphdGlvblxuICAgICAgY29uc3QgYnVpbGRpbmdzQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpLCBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKSk7XG5cbiAgICAgIC8vIENvdW50IHJlc2lkZW5jZXMgaW4gYnVpbGRpbmdzIG9mIHRoaXMgb3JnYW5pemF0aW9uXG4gICAgICBjb25zdCByZXNpZGVuY2VzQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpLFxuICAgICAgICAgICAgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAvLyBDb3VudCBpbnZpdGF0aW9ucyBhc3NvY2lhdGVkIHdpdGggdGhpcyBvcmdhbml6YXRpb25cbiAgICAgIGxldCB0b3RhbEludml0YXRpb25zID0gMDtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGludml0YXRpb25zQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogY291bnQoKSB9KVxuICAgICAgICAgIC5mcm9tKGludml0YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShpbnZpdGF0aW9ucy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpKTtcblxuICAgICAgICB0b3RhbEludml0YXRpb25zID0gaW52aXRhdGlvbnNDb3VudFswXT8uY291bnQgfHwgMDtcbiAgICAgIH0gY2F0Y2ggKF9fX2ludkVycm9yKSB7XG4gICAgICAgIHRvdGFsSW52aXRhdGlvbnMgPSAwO1xuICAgICAgfVxuXG4gICAgICAvLyBDb3VudCB1c2VycyB3aG8gd2lsbCBiZWNvbWUgb3JwaGFuZWQgKG9ubHkgYmVsb25nIHRvIHRoaXMgb3JnYW5pemF0aW9uKVxuICAgICAgY29uc3QgcG90ZW50aWFsT3JwaGFuc0NvdW50ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pXG4gICAgICAgIC5mcm9tKHVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAuaW5uZXJKb2luKHVzZXJzLCBlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25JZCksXG4gICAgICAgICAgICBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGNvbnN0IGltcGFjdCA9IHtcbiAgICAgICAgb3JnYW5pemF0aW9uOiBvcmdhbml6YXRpb25bMF0sXG4gICAgICAgIGJ1aWxkaW5nczogYnVpbGRpbmdzQ291bnRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIHJlc2lkZW5jZXM6IHJlc2lkZW5jZXNDb3VudFswXT8uY291bnQgfHwgMCxcbiAgICAgICAgaW52aXRhdGlvbnM6IHRvdGFsSW52aXRhdGlvbnMsXG4gICAgICAgIHBvdGVudGlhbE9ycGhhbmVkVXNlcnM6IHBvdGVudGlhbE9ycGhhbnNDb3VudFswXT8uY291bnQgfHwgMCxcbiAgICAgIH07XG5cbiAgICAgIHJlcy5qc29uKGltcGFjdCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGFuYWx5emluZyBkZWxldGlvbiBpbXBhY3Q6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGFuYWx5emUgZGVsZXRpb24gaW1wYWN0JyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERFTEVURSAvYXBpL29yZ2FuaXphdGlvbnMvOmlkIC0gQ2FzY2FkZSBkZWxldGUgYW4gb3JnYW5pemF0aW9uXG4gICAqIERlbGV0ZXMgb3JnYW5pemF0aW9uIGFuZCBhbGwgcmVsYXRlZCBlbnRpdGllcyAoYnVpbGRpbmdzLCByZXNpZGVuY2VzLCBkb2N1bWVudHMpLiBVc2VycyBhcmUgcHJlc2VydmVkIGZvciBkYXRhIHNhZmV0eS5cbiAgICovXG4gIGFwcC5kZWxldGUoJy9hcGkvb3JnYW5pemF0aW9ucy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gcmVxLnBhcmFtcy5pZDtcblxuICAgICAgLy8gQ2hlY2sgaWYgb3JnYW5pemF0aW9uIGV4aXN0c1xuICAgICAgY29uc3Qgb3JnYW5pemF0aW9uID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGlkOiBvcmdhbml6YXRpb25zLmlkLCBuYW1lOiBvcmdhbml6YXRpb25zLm5hbWUgfSlcbiAgICAgICAgLmZyb20ob3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGFuZChlcShvcmdhbml6YXRpb25zLmlkLCBvcmdhbml6YXRpb25JZCksIGVxKG9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAob3JnYW5pemF0aW9uLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ09yZ2FuaXphdGlvbiBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfl5HvuI8gRGVsZXRpbmcgb3JnYW5pemF0aW9uICR7b3JnYW5pemF0aW9uSWR9IHdpdGggY2FzY2FkZSBkZWxldGUuLi5gKTtcblxuICAgICAgLy8gU2luY2UgTmVvbiBIVFRQIGRyaXZlciBkb2Vzbid0IHN1cHBvcnQgdHJhbnNhY3Rpb25zLCB3ZSdsbCBkbyBjYXNjYWRpbmcgZGVsZXRlIG1hbnVhbGx5XG4gICAgICAvLyBpbiB0aGUgY29ycmVjdCBvcmRlciB0byBtYWludGFpbiByZWZlcmVudGlhbCBpbnRlZ3JpdHlcblxuICAgICAgLy8gMS4gR2V0IGFsbCBidWlsZGluZ3MgaW4gdGhpcyBvcmdhbml6YXRpb24gKGluY2x1ZGluZyBhbHJlYWR5IGluYWN0aXZlIG9uZXMpXG4gICAgICBjb25zdCBvcmdCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgaWQ6IGJ1aWxkaW5ncy5pZCB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkKSk7XG5cbiAgICAgIGlmIChvcmdCdWlsZGluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBvcmdCdWlsZGluZ0lkcyA9IG9yZ0J1aWxkaW5ncy5tYXAoKGIpID0+IGIuaWQpO1xuXG4gICAgICAgIC8vIDIuIFNvZnQgZGVsZXRlIHJlc2lkZW5jZXMgZmlyc3QgKGNoaWxkcmVuIG9mIGJ1aWxkaW5ncykgLSBnZXQgQUxMIHJlc2lkZW5jZXMgaW4gdGhlc2UgYnVpbGRpbmdzXG4gICAgICAgIGNvbnN0IGFmZmVjdGVkUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAgIC53aGVyZShpbkFycmF5KHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgb3JnQnVpbGRpbmdJZHMpKVxuICAgICAgICAgIC5yZXR1cm5pbmcoeyBpZDogcmVzaWRlbmNlcy5pZCwgdW5pdE51bWJlcjogcmVzaWRlbmNlcy51bml0TnVtYmVyIH0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGDwn5eR77iPIFNvZnQgZGVsZXRlZCAke2FmZmVjdGVkUmVzaWRlbmNlcy5sZW5ndGh9IHJlc2lkZW5jZXMgaW4gYnVpbGRpbmdzOiAke29yZ0J1aWxkaW5nSWRzLmpvaW4oJywgJyl9YFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIDMuIFNvZnQgZGVsZXRlIGJ1aWxkaW5nc1xuICAgICAgICBjb25zdCBhZmZlY3RlZEJ1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShidWlsZGluZ3MpXG4gICAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgICAgLndoZXJlKGluQXJyYXkoYnVpbGRpbmdzLmlkLCBvcmdCdWlsZGluZ0lkcykpXG4gICAgICAgICAgLnJldHVybmluZyh7IGlkOiBidWlsZGluZ3MuaWQsIG5hbWU6IGJ1aWxkaW5ncy5uYW1lIH0pO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGDwn5eR77iPIFNvZnQgZGVsZXRlZCAke2FmZmVjdGVkQnVpbGRpbmdzLmxlbmd0aH0gYnVpbGRpbmdzOiAke2FmZmVjdGVkQnVpbGRpbmdzLm1hcCgoYikgPT4gYi5uYW1lKS5qb2luKCcsICcpfWBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gNC4gRGVsZXRlIHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHNcbiAgICAgIGF3YWl0IGRiXG4gICAgICAgIC5kZWxldGUodXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcSh1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpKTtcblxuICAgICAgLy8gNS4gRElTQUJMRUQ6IFVzZXIgZGVsZXRpb24gaXMgbm93IHByb2hpYml0ZWQgZm9yIGRhdGEgc2FmZXR5XG4gICAgICAvLyBVc2VycyBhcmUgbmV2ZXIgZGVsZXRlZCBkdXJpbmcgY2FzY2FkZSBvcGVyYXRpb25zIHRvIHByZXZlbnQgcGVybWFuZW50IGRhdGEgbG9zc1xuICAgICAgLy8gVGhpcyBwcm90ZWN0cyBhZ2FpbnN0IGFjY2lkZW50YWwgZGVsZXRpb24gb2YgdXNlciBhY2NvdW50cyBhbmQgdGhlaXIgaGlzdG9yaWNhbCBkYXRhXG4gICAgICBjb25zb2xlLmxvZygn4pqg77iPICBVc2VyIGRlbGV0aW9uIGRpc2FibGVkIGZvciBkYXRhIHNhZmV0eSAtIHVzZXJzIHdpbGwgYmUgcHJlc2VydmVkJyk7XG4gICAgICBcbiAgICAgIC8vIE9wdGlvbmFsOiBMb2cgdXNlcnMgd2hvIHdvdWxkIGhhdmUgYmVlbiBhZmZlY3RlZCBmb3IgYWRtaW4gcmV2aWV3XG4gICAgICBjb25zdCBhZmZlY3RlZFVzZXJzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHVzZXJzLmlkLFxuICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICBmaXJzdE5hbWU6IHVzZXJzLmZpcnN0TmFtZSxcbiAgICAgICAgICBsYXN0TmFtZTogdXNlcnMubGFzdE5hbWUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgdXNlck9yZ2FuaXphdGlvbnMsXG4gICAgICAgICAgYW5kKGVxKHVzZXJzLmlkLCB1c2VyT3JnYW5pemF0aW9ucy51c2VySWQpLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIClcbiAgICAgICAgLndoZXJlKGFuZChlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksIGlzTnVsbCh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQpKSk7XG4gICAgICBcbiAgICAgIGlmIChhZmZlY3RlZFVzZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYOKaoO+4jyAgJHthZmZlY3RlZFVzZXJzLmxlbmd0aH0gdXNlcnMgYXJlIG5vdyB3aXRob3V0IG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50cyBidXQgaGF2ZSBiZWVuIHByZXNlcnZlZDpgLCBcbiAgICAgICAgICBhZmZlY3RlZFVzZXJzLm1hcCh1ID0+IHUuZW1haWwpKTtcblxuICAgICAgICAvLyBESVNBQkxFRDogVXNlcnMgYXJlIG5vIGxvbmdlciBkZWxldGVkIC0gdGhleSBhcmUgcHJlc2VydmVkIGZvciBkYXRhIHNhZmV0eVxuICAgICAgfVxuXG4gICAgICAvLyA2LiBGaW5hbGx5LCBzb2Z0IGRlbGV0ZSB0aGUgb3JnYW5pemF0aW9uXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKG9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEob3JnYW5pemF0aW9ucy5pZCwgb3JnYW5pemF0aW9uSWQpKTtcblxuXG4gICAgICAvLyBPYmplY3Qgc3RvcmFnZSBjbGVhbnVwIHdpbGwgYmUgaGFuZGxlZCBhdXRvbWF0aWNhbGx5XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZygnT3JnYW5pemF0aW9uIGRlbGV0ZWQgLSBzdG9yYWdlIGNsZWFudXAgd2lsbCBiZSBoYW5kbGVkIGF1dG9tYXRpY2FsbHknKTtcbiAgICAgIH0gY2F0Y2ggKHN0b3JhZ2VFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICfimqDvuI8gT2JqZWN0IHN0b3JhZ2UgY2xlYW51cCBmYWlsZWQsIGJ1dCBvcmdhbml6YXRpb24gZGVsZXRpb24gc3VjY2VlZGVkOicsXG4gICAgICAgICAgc3RvcmFnZUVycm9yXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ09yZ2FuaXphdGlvbiBhbmQgcmVsYXRlZCBlbnRpdGllcyBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRlbGV0ZWRPcmdhbml6YXRpb246IG9yZ2FuaXphdGlvblswXS5uYW1lLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlbGV0aW5nIG9yZ2FuaXphdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIF9lcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIG9yZ2FuaXphdGlvbiBhbmQgcmVsYXRlZCBlbnRpdGllcycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sInZlcnNpb24iOjN9