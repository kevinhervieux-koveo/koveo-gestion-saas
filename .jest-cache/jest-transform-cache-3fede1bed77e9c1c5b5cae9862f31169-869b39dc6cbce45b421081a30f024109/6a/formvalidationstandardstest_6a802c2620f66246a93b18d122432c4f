3cc8f8d47d045f2acb4d5842dea9ff4f
"use strict";
/**
 * Form Validation Standards Test Suite
 * Simplified tests to ensure all forms follow basic validation principles
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const zod_1 = require("zod");
(0, globals_1.describe)('Form Validation Standards', () => {
    (0, globals_1.describe)('Basic Error Message Requirements', () => {
        (0, globals_1.test)('should require helpful error messages for common field types', () => {
            // Test that our validation templates produce good error messages
            const commonFields = {
                email: zod_1.z.string().email('Please enter a valid email address (example: user@domain.com)'),
                name: zod_1.z.string().min(1, 'Name is required (example: Jean Dupont)'),
                phone: zod_1.z.string().regex(/^(\+1\s?)?(\(\d{3}\)|\d{3})[\s.-]?\d{3}[\s.-]?\d{4}$/, 'Phone number must be a valid North American format (example: (514) 123-4567)').optional(),
                amount: zod_1.z.string().regex(/^\d+(\.\d{1,2})?$/, 'Amount must be a valid number with up to 2 decimal places (example: 125.50)'),
                selection: zod_1.z.string().min(1, 'Please select an option from the dropdown')
            };
            // Test each field type produces helpful error messages
            Object.entries(commonFields).forEach(([fieldType, schema]) => {
                // Test with appropriate invalid input for each field type
                let invalidInput = '';
                switch (fieldType) {
                    case 'email':
                        invalidInput = 'invalid-email';
                        break;
                    case 'phone':
                        invalidInput = '123';
                        break;
                    case 'amount':
                        invalidInput = '123.456';
                        break;
                    default:
                        invalidInput = '';
                }
                const result = schema.safeParse(invalidInput);
                if (!result.success) {
                    const errorMessage = result.error.issues[0].message;
                    // Basic quality checks
                    (0, globals_1.expect)(errorMessage.length).toBeGreaterThan(10);
                    (0, globals_1.expect)(errorMessage).toMatch(/please|must|required|should/i);
                    // Format fields should have examples
                    if (['email', 'phone', 'amount'].includes(fieldType)) {
                        (0, globals_1.expect)(errorMessage).toContain('example:');
                    }
                }
            });
        });
        (0, globals_1.test)('should validate Quebec-specific validation patterns work correctly', () => {
            const quebecValidations = {
                name: zod_1.z.string().regex(/^[a-zA-ZÀ-ÿ\s'-]+$/, 'Name can only contain letters, spaces, apostrophes and hyphens'),
                postalCode: zod_1.z.string().regex(/^[A-Z]\d[A-Z]\s?\d[A-Z]\d$/, 'Postal code must follow Canadian format (example: H1A 1B1)'),
                city: zod_1.z.string().regex(/^[a-zA-ZÀ-ÿ\s'-]+$/, 'City name can only contain letters, spaces, apostrophes and hyphens')
            };
            // Test valid Quebec inputs
            (0, globals_1.expect)(quebecValidations.name.safeParse('Jean-Baptiste').success).toBe(true);
            (0, globals_1.expect)(quebecValidations.name.safeParse('Marie-Ève').success).toBe(true);
            (0, globals_1.expect)(quebecValidations.postalCode.safeParse('H1A 1B1').success).toBe(true);
            (0, globals_1.expect)(quebecValidations.city.safeParse('Montréal').success).toBe(true);
            // Test that error messages are helpful
            const nameResult = quebecValidations.name.safeParse('Name123');
            const postalResult = quebecValidations.postalCode.safeParse('12345');
            (0, globals_1.expect)(nameResult.success).toBe(false);
            (0, globals_1.expect)(postalResult.success).toBe(false);
            if (!nameResult.success) {
                (0, globals_1.expect)(nameResult.error.issues[0].message).toContain('letters, spaces');
            }
            if (!postalResult.success) {
                (0, globals_1.expect)(postalResult.error.issues[0].message).toContain('Canadian format');
                (0, globals_1.expect)(postalResult.error.issues[0].message).toContain('example:');
            }
        });
    });
    (0, globals_1.describe)('Validation Helper Functions', () => {
        (0, globals_1.test)('should provide utility to check error message quality', () => {
            const checkErrorMessageQuality = (message) => {
                return {
                    isDetailed: message.length >= 15,
                    hasGuidance: /please|must|should|required/i.test(message),
                    isNotVague: !/^(invalid|error|wrong|bad)$/i.test(message),
                    hasExample: message.includes('example:')
                };
            };
            // Test good messages
            const goodMessages = [
                'Please enter a valid email address (example: user@domain.com)',
                'Name is required (example: Jean Dupont)',
                'Amount must be a valid number with up to 2 decimal places (example: 125.50)'
            ];
            goodMessages.forEach(message => {
                const quality = checkErrorMessageQuality(message);
                (0, globals_1.expect)(quality.isDetailed).toBe(true);
                (0, globals_1.expect)(quality.hasGuidance).toBe(true);
                (0, globals_1.expect)(quality.isNotVague).toBe(true);
            });
            // Test bad messages
            const badMessages = ['Invalid', 'Required', 'Error'];
            badMessages.forEach(message => {
                const quality = checkErrorMessageQuality(message);
                (0, globals_1.expect)(quality.isDetailed).toBe(false);
                (0, globals_1.expect)(quality.isNotVague).toBe(false);
            });
        });
    });
    (0, globals_1.describe)('Future Form Compliance', () => {
        (0, globals_1.test)('should provide templates for consistent form validation', () => {
            const validationTemplates = {
                email: () => zod_1.z.string().min(1, 'Email address is required').email('Please enter a valid email address (example: user@domain.com)'),
                name: (fieldName, example) => zod_1.z.string().min(1, `${fieldName} is required (example: ${example})`),
                phone: () => zod_1.z.string().regex(/^(\+1\s?)?(\(\d{3}\)|\d{3})[\s.-]?\d{3}[\s.-]?\d{4}$/, 'Phone number must be a valid North American format (example: (514) 123-4567)').optional(),
                amount: () => zod_1.z.string().regex(/^\d+(\.\d{1,2})?$/, 'Amount must be a valid number with up to 2 decimal places (example: 125.50)'),
                selection: (fieldName) => zod_1.z.string().min(1, `Please select ${fieldName} from the dropdown`)
            };
            // Test that templates work correctly
            (0, globals_1.expect)(() => validationTemplates.email().parse('user@domain.com')).not.toThrow();
            (0, globals_1.expect)(() => validationTemplates.name('First name', 'Jean').parse('Jean')).not.toThrow();
            (0, globals_1.expect)(() => validationTemplates.amount().parse('125.50')).not.toThrow();
            // Test that templates produce helpful error messages
            const emailError = validationTemplates.email().safeParse('invalid');
            const nameError = validationTemplates.name('First name', 'Jean').safeParse('');
            (0, globals_1.expect)(emailError.success).toBe(false);
            (0, globals_1.expect)(nameError.success).toBe(false);
        });
    });
    (0, globals_1.describe)('Application Compliance Standards', () => {
        (0, globals_1.test)('should define minimum compliance requirements for all forms', () => {
            const complianceRequirements = {
                errorMessages: {
                    minLength: 15,
                    mustContainGuidance: true,
                    shouldIncludeExamples: true,
                    avoidVagueLanguage: true
                },
                quebecSupport: {
                    frenchCharacters: true,
                    canadianFormats: true,
                    appropriateExamples: true
                },
                accessibility: {
                    dataTestIds: true,
                    properLabels: true,
                    errorAssociation: true
                },
                security: {
                    passwordValidation: true,
                    sensitiveDataProtection: true,
                    confirmationForDestructive: true
                }
            };
            // Validate all requirements are set to true (required)
            const flattenRequirements = (obj) => {
                return Object.values(obj).flatMap(value => typeof value === 'object' ? flattenRequirements(value) : [value]);
            };
            const allRequirements = flattenRequirements(complianceRequirements);
            allRequirements.forEach(requirement => {
                (0, globals_1.expect)(requirement).toBe(true);
            });
        });
    });
    (0, globals_1.describe)('Development Workflow Integration', () => {
        (0, globals_1.test)('should provide clear guidelines for form validation implementation', () => {
            const implementationSteps = [
                'Use ValidationTemplates from form-validation-helpers.ts for consistent schemas',
                'Implement React Hook Form with zodResolver for type safety',
                'Use FormLabel, FormControl, FormMessage components for consistent UI',
                'Add data-testid attributes to all interactive elements',
                'Include validation tests for all new forms',
                'Verify Quebec compliance for name and address fields'
            ];
            // Validate implementation steps are comprehensive
            (0, globals_1.expect)(implementationSteps.length).toBeGreaterThanOrEqual(6);
            implementationSteps.forEach(step => {
                (0, globals_1.expect)(step.length).toBeGreaterThan(25);
                (0, globals_1.expect)(step).toMatch(/use|implement|add|include|verify/i);
            });
        });
        (0, globals_1.test)('should establish testing requirements for form validation', () => {
            const testingRequirements = [
                'Test schema validation produces helpful error messages',
                'Test UI displays red labels when validation fails',
                'Test error messages clear when fields become valid',
                'Test accessibility compliance with screen readers',
                'Test Quebec character support in name fields',
                'Test Canadian format validation for postal codes and phone numbers'
            ];
            testingRequirements.forEach(requirement => {
                (0, globals_1.expect)(requirement).toMatch(/test/i);
                (0, globals_1.expect)(requirement.length).toBeGreaterThan(30);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2Zvcm0tdmFsaWRhdGlvbi1zdGFuZGFyZHMudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOztBQUdILDJDQUF1RDtBQUR2RCw2QkFBd0I7QUFHeEIsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxJQUFBLGtCQUFRLEVBQUMsa0NBQWtDLEVBQUUsR0FBRyxFQUFFO1FBQ2hELElBQUEsY0FBSSxFQUFDLDhEQUE4RCxFQUFFLEdBQUcsRUFBRTtZQUN4RSxpRUFBaUU7WUFDakUsTUFBTSxZQUFZLEdBQUc7Z0JBQ25CLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDLCtEQUErRCxDQUFDO2dCQUN4RixJQUFJLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUseUNBQXlDLENBQUM7Z0JBQ2xFLEtBQUssRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsS0FBSyxDQUFDLHNEQUFzRCxFQUFFLDhFQUE4RSxDQUFDLENBQUMsUUFBUSxFQUFFO2dCQUMxSyxNQUFNLEVBQUUsT0FBQyxDQUFDLE1BQU0sRUFBRSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsRUFBRSw2RUFBNkUsQ0FBQztnQkFDNUgsU0FBUyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLDJDQUEyQyxDQUFDO2FBQzFFLENBQUM7WUFFRix1REFBdUQ7WUFDdkQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFO2dCQUMzRCwwREFBMEQ7Z0JBQzFELElBQUksWUFBWSxHQUFHLEVBQUUsQ0FBQztnQkFDdEIsUUFBUSxTQUFTLEVBQUUsQ0FBQztvQkFDbEIsS0FBSyxPQUFPO3dCQUNWLFlBQVksR0FBRyxlQUFlLENB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LGNBQUksRUFBQywyREFBMkQsRUFBRSxHQUFHLEVBQUU7WUFDckUsTUFBTSxtQkFBbUIsR0FBRztnQkFDMUIsd0RBQXdEO2dCQUN4RCxtREFBbUQ7Z0JBQ25ELG9EQUFvRDtnQkFDcEQsbURBQW1EO2dCQUNuRCw4Q0FBOEM7Z0JBQzlDLG9FQUFvRTthQUNyRSxDQUFDO1lBRUYsbUJBQW1CLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxFQUFFO2dCQUN4QyxJQUFBLGdCQUFNLEVBQUMsV0FBVyxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2dCQUNyQyxJQUFBLGdCQUFNLEVBQUMsV0FBVyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUNqRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3Rlc3RzL3VuaXQvZm9ybS12YWxpZGF0aW9uLXN0YW5kYXJkcy50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRm9ybSBWYWxpZGF0aW9uIFN0YW5kYXJkcyBUZXN0IFN1aXRlXG4gKiBTaW1wbGlmaWVkIHRlc3RzIHRvIGVuc3VyZSBhbGwgZm9ybXMgZm9sbG93IGJhc2ljIHZhbGlkYXRpb24gcHJpbmNpcGxlc1xuICovXG5cbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgZGVzY3JpYmUsIHRlc3QsIGV4cGVjdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG5kZXNjcmliZSgnRm9ybSBWYWxpZGF0aW9uIFN0YW5kYXJkcycsICgpID0+IHtcbiAgZGVzY3JpYmUoJ0Jhc2ljIEVycm9yIE1lc3NhZ2UgUmVxdWlyZW1lbnRzJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCByZXF1aXJlIGhlbHBmdWwgZXJyb3IgbWVzc2FnZXMgZm9yIGNvbW1vbiBmaWVsZCB0eXBlcycsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBvdXIgdmFsaWRhdGlvbiB0ZW1wbGF0ZXMgcHJvZHVjZSBnb29kIGVycm9yIG1lc3NhZ2VzXG4gICAgICBjb25zdCBjb21tb25GaWVsZHMgPSB7XG4gICAgICAgIGVtYWlsOiB6LnN0cmluZygpLmVtYWlsKCdQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzIChleGFtcGxlOiB1c2VyQGRvbWFpbi5jb20pJyksXG4gICAgICAgIG5hbWU6IHouc3RyaW5nKCkubWluKDEsICdOYW1lIGlzIHJlcXVpcmVkIChleGFtcGxlOiBKZWFuIER1cG9udCknKSxcbiAgICAgICAgcGhvbmU6IHouc3RyaW5nKCkucmVnZXgoL14oXFwrMVxccz8pPyhcXChcXGR7M31cXCl8XFxkezN9KVtcXHMuLV0/XFxkezN9W1xccy4tXT9cXGR7NH0kLywgJ1Bob25lIG51bWJlciBtdXN0IGJlIGEgdmFsaWQgTm9ydGggQW1lcmljYW4gZm9ybWF0IChleGFtcGxlOiAoNTE0KSAxMjMtNDU2NyknKS5vcHRpb25hbCgpLFxuICAgICAgICBhbW91bnQ6IHouc3RyaW5nKCkucmVnZXgoL15cXGQrKFxcLlxcZHsxLDJ9KT8kLywgJ0Ftb3VudCBtdXN0IGJlIGEgdmFsaWQgbnVtYmVyIHdpdGggdXAgdG8gMiBkZWNpbWFsIHBsYWNlcyAoZXhhbXBsZTogMTI1LjUwKScpLFxuICAgICAgICBzZWxlY3Rpb246IHouc3RyaW5nKCkubWluKDEsICdQbGVhc2Ugc2VsZWN0IGFuIG9wdGlvbiBmcm9tIHRoZSBkcm9wZG93bicpXG4gICAgICB9O1xuXG4gICAgICAvLyBUZXN0IGVhY2ggZmllbGQgdHlwZSBwcm9kdWNlcyBoZWxwZnVsIGVycm9yIG1lc3NhZ2VzXG4gICAgICBPYmplY3QuZW50cmllcyhjb21tb25GaWVsZHMpLmZvckVhY2goKFtmaWVsZFR5cGUsIHNjaGVtYV0pID0+IHtcbiAgICAgICAgLy8gVGVzdCB3aXRoIGFwcHJvcHJpYXRlIGludmFsaWQgaW5wdXQgZm9yIGVhY2ggZmllbGQgdHlwZVxuICAgICAgICBsZXQgaW52YWxpZElucHV0ID0gJyc7XG4gICAgICAgIHN3aXRjaCAoZmllbGRUeXBlKSB7XG4gICAgICAgICAgY2FzZSAnZW1haWwnOlxuICAgICAgICAgICAgaW52YWxpZElucHV0ID0gJ2ludmFsaWQtZW1haWwnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgY2FzZSAncGhvbmUnOlxuICAgICAgICAgICAgaW52YWxpZElucHV0ID0gJzEyMyc7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICBjYXNlICdhbW91bnQnOlxuICAgICAgICAgICAgaW52YWxpZElucHV0ID0gJzEyMy40NTYnO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIGludmFsaWRJbnB1dCA9ICcnO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gc2NoZW1hLnNhZmVQYXJzZShpbnZhbGlkSW5wdXQpO1xuICAgICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gcmVzdWx0LmVycm9yLmlzc3Vlc1swXS5tZXNzYWdlO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEJhc2ljIHF1YWxpdHkgY2hlY2tzXG4gICAgICAgICAgZXhwZWN0KGVycm9yTWVzc2FnZS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigxMCk7XG4gICAgICAgICAgZXhwZWN0KGVycm9yTWVzc2FnZSkudG9NYXRjaCgvcGxlYXNlfG11c3R8cmVxdWlyZWR8c2hvdWxkL2kpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZvcm1hdCBmaWVsZHMgc2hvdWxkIGhhdmUgZXhhbXBsZXNcbiAgICAgICAgICBpZiAoWydlbWFpbCcsICdwaG9uZScsICdhbW91bnQnXS5pbmNsdWRlcyhmaWVsZFR5cGUpKSB7XG4gICAgICAgICAgICBleHBlY3QoZXJyb3JNZXNzYWdlKS50b0NvbnRhaW4oJ2V4YW1wbGU6Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBRdWViZWMtc3BlY2lmaWMgdmFsaWRhdGlvbiBwYXR0ZXJucyB3b3JrIGNvcnJlY3RseScsICgpID0+IHtcbiAgICAgIGNvbnN0IHF1ZWJlY1ZhbGlkYXRpb25zID0ge1xuICAgICAgICBuYW1lOiB6LnN0cmluZygpLnJlZ2V4KC9eW2EtekEtWsOALcO/XFxzJy1dKyQvLCAnTmFtZSBjYW4gb25seSBjb250YWluIGxldHRlcnMsIHNwYWNlcywgYXBvc3Ryb3BoZXMgYW5kIGh5cGhlbnMnKSxcbiAgICAgICAgcG9zdGFsQ29kZTogei5zdHJpbmcoKS5yZWdleCgvXltBLVpdXFxkW0EtWl1cXHM/XFxkW0EtWl1cXGQkLywgJ1Bvc3RhbCBjb2RlIG11c3QgZm9sbG93IENhbmFkaWFuIGZvcm1hdCAoZXhhbXBsZTogSDFBIDFCMSknKSxcbiAgICAgICAgY2l0eTogei5zdHJpbmcoKS5yZWdleCgvXlthLXpBLVrDgC3Dv1xccyctXSskLywgJ0NpdHkgbmFtZSBjYW4gb25seSBjb250YWluIGxldHRlcnMsIHNwYWNlcywgYXBvc3Ryb3BoZXMgYW5kIGh5cGhlbnMnKVxuICAgICAgfTtcblxuICAgICAgLy8gVGVzdCB2YWxpZCBRdWViZWMgaW5wdXRzXG4gICAgICBleHBlY3QocXVlYmVjVmFsaWRhdGlvbnMubmFtZS5zYWZlUGFyc2UoJ0plYW4tQmFwdGlzdGUnKS5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHF1ZWJlY1ZhbGlkYXRpb25zLm5hbWUuc2FmZVBhcnNlKCdNYXJpZS3DiHZlJykuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChxdWViZWNWYWxpZGF0aW9ucy5wb3N0YWxDb2RlLnNhZmVQYXJzZSgnSDFBIDFCMScpLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocXVlYmVjVmFsaWRhdGlvbnMuY2l0eS5zYWZlUGFyc2UoJ01vbnRyw6lhbCcpLnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIC8vIFRlc3QgdGhhdCBlcnJvciBtZXNzYWdlcyBhcmUgaGVscGZ1bFxuICAgICAgY29uc3QgbmFtZVJlc3VsdCA9IHF1ZWJlY1ZhbGlkYXRpb25zLm5hbWUuc2FmZVBhcnNlKCdOYW1lMTIzJyk7XG4gICAgICBjb25zdCBwb3N0YWxSZXN1bHQgPSBxdWViZWNWYWxpZGF0aW9ucy5wb3N0YWxDb2RlLnNhZmVQYXJzZSgnMTIzNDUnKTtcblxuICAgICAgZXhwZWN0KG5hbWVSZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocG9zdGFsUmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuXG4gICAgICBpZiAoIW5hbWVSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBleHBlY3QobmFtZVJlc3VsdC5lcnJvci5pc3N1ZXNbMF0ubWVzc2FnZSkudG9Db250YWluKCdsZXR0ZXJzLCBzcGFjZXMnKTtcbiAgICAgIH1cbiAgICAgIGlmICghcG9zdGFsUmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgZXhwZWN0KHBvc3RhbFJlc3VsdC5lcnJvci5pc3N1ZXNbMF0ubWVzc2FnZSkudG9Db250YWluKCdDYW5hZGlhbiBmb3JtYXQnKTtcbiAgICAgICAgZXhwZWN0KHBvc3RhbFJlc3VsdC5lcnJvci5pc3N1ZXNbMF0ubWVzc2FnZSkudG9Db250YWluKCdleGFtcGxlOicpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVmFsaWRhdGlvbiBIZWxwZXIgRnVuY3Rpb25zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBwcm92aWRlIHV0aWxpdHkgdG8gY2hlY2sgZXJyb3IgbWVzc2FnZSBxdWFsaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY2hlY2tFcnJvck1lc3NhZ2VRdWFsaXR5ID0gKG1lc3NhZ2U6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGlzRGV0YWlsZWQ6IG1lc3NhZ2UubGVuZ3RoID49IDE1LFxuICAgICAgICAgIGhhc0d1aWRhbmNlOiAvcGxlYXNlfG11c3R8c2hvdWxkfHJlcXVpcmVkL2kudGVzdChtZXNzYWdlKSxcbiAgICAgICAgICBpc05vdFZhZ3VlOiAhL14oaW52YWxpZHxlcnJvcnx3cm9uZ3xiYWQpJC9pLnRlc3QobWVzc2FnZSksXG4gICAgICAgICAgaGFzRXhhbXBsZTogbWVzc2FnZS5pbmNsdWRlcygnZXhhbXBsZTonKVxuICAgICAgICB9O1xuICAgICAgfTtcblxuICAgICAgLy8gVGVzdCBnb29kIG1lc3NhZ2VzXG4gICAgICBjb25zdCBnb29kTWVzc2FnZXMgPSBbXG4gICAgICAgICdQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzIChleGFtcGxlOiB1c2VyQGRvbWFpbi5jb20pJyxcbiAgICAgICAgJ05hbWUgaXMgcmVxdWlyZWQgKGV4YW1wbGU6IEplYW4gRHVwb250KScsXG4gICAgICAgICdBbW91bnQgbXVzdCBiZSBhIHZhbGlkIG51bWJlciB3aXRoIHVwIHRvIDIgZGVjaW1hbCBwbGFjZXMgKGV4YW1wbGU6IDEyNS41MCknXG4gICAgICBdO1xuXG4gICAgICBnb29kTWVzc2FnZXMuZm9yRWFjaChtZXNzYWdlID0+IHtcbiAgICAgICAgY29uc3QgcXVhbGl0eSA9IGNoZWNrRXJyb3JNZXNzYWdlUXVhbGl0eShtZXNzYWdlKTtcbiAgICAgICAgZXhwZWN0KHF1YWxpdHkuaXNEZXRhaWxlZCkudG9CZSh0cnVlKTtcbiAgICAgICAgZXhwZWN0KHF1YWxpdHkuaGFzR3VpZGFuY2UpLnRvQmUodHJ1ZSk7XG4gICAgICAgIGV4cGVjdChxdWFsaXR5LmlzTm90VmFndWUpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcblxuICAgICAgLy8gVGVzdCBiYWQgbWVzc2FnZXNcbiAgICAgIGNvbnN0IGJhZE1lc3NhZ2VzID0gWydJbnZhbGlkJywgJ1JlcXVpcmVkJywgJ0Vycm9yJ107XG5cbiAgICAgIGJhZE1lc3NhZ2VzLmZvckVhY2gobWVzc2FnZSA9PiB7XG4gICAgICAgIGNvbnN0IHF1YWxpdHkgPSBjaGVja0Vycm9yTWVzc2FnZVF1YWxpdHkobWVzc2FnZSk7XG4gICAgICAgIGV4cGVjdChxdWFsaXR5LmlzRGV0YWlsZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgICBleHBlY3QocXVhbGl0eS5pc05vdFZhZ3VlKS50b0JlKGZhbHNlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRnV0dXJlIEZvcm0gQ29tcGxpYW5jZScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcHJvdmlkZSB0ZW1wbGF0ZXMgZm9yIGNvbnNpc3RlbnQgZm9ybSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgdmFsaWRhdGlvblRlbXBsYXRlcyA9IHtcbiAgICAgICAgZW1haWw6ICgpID0+IHouc3RyaW5nKCkubWluKDEsICdFbWFpbCBhZGRyZXNzIGlzIHJlcXVpcmVkJykuZW1haWwoJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MgKGV4YW1wbGU6IHVzZXJAZG9tYWluLmNvbSknKSxcbiAgICAgICAgbmFtZTogKGZpZWxkTmFtZTogc3RyaW5nLCBleGFtcGxlOiBzdHJpbmcpID0+IHouc3RyaW5nKCkubWluKDEsIGAke2ZpZWxkTmFtZX0gaXMgcmVxdWlyZWQgKGV4YW1wbGU6ICR7ZXhhbXBsZX0pYCksXG4gICAgICAgIHBob25lOiAoKSA9PiB6LnN0cmluZygpLnJlZ2V4KC9eKFxcKzFcXHM/KT8oXFwoXFxkezN9XFwpfFxcZHszfSlbXFxzLi1dP1xcZHszfVtcXHMuLV0/XFxkezR9JC8sICdQaG9uZSBudW1iZXIgbXVzdCBiZSBhIHZhbGlkIE5vcnRoIEFtZXJpY2FuIGZvcm1hdCAoZXhhbXBsZTogKDUxNCkgMTIzLTQ1NjcpJykub3B0aW9uYWwoKSxcbiAgICAgICAgYW1vdW50OiAoKSA9PiB6LnN0cmluZygpLnJlZ2V4KC9eXFxkKyhcXC5cXGR7MSwyfSk/JC8sICdBbW91bnQgbXVzdCBiZSBhIHZhbGlkIG51bWJlciB3aXRoIHVwIHRvIDIgZGVjaW1hbCBwbGFjZXMgKGV4YW1wbGU6IDEyNS41MCknKSxcbiAgICAgICAgc2VsZWN0aW9uOiAoZmllbGROYW1lOiBzdHJpbmcpID0+IHouc3RyaW5nKCkubWluKDEsIGBQbGVhc2Ugc2VsZWN0ICR7ZmllbGROYW1lfSBmcm9tIHRoZSBkcm9wZG93bmApXG4gICAgICB9O1xuXG4gICAgICAvLyBUZXN0IHRoYXQgdGVtcGxhdGVzIHdvcmsgY29ycmVjdGx5XG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGlvblRlbXBsYXRlcy5lbWFpbCgpLnBhcnNlKCd1c2VyQGRvbWFpbi5jb20nKSkubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdCgoKSA9PiB2YWxpZGF0aW9uVGVtcGxhdGVzLm5hbWUoJ0ZpcnN0IG5hbWUnLCAnSmVhbicpLnBhcnNlKCdKZWFuJykpLm5vdC50b1Rocm93KCk7XG4gICAgICBleHBlY3QoKCkgPT4gdmFsaWRhdGlvblRlbXBsYXRlcy5hbW91bnQoKS5wYXJzZSgnMTI1LjUwJykpLm5vdC50b1Rocm93KCk7XG5cbiAgICAgIC8vIFRlc3QgdGhhdCB0ZW1wbGF0ZXMgcHJvZHVjZSBoZWxwZnVsIGVycm9yIG1lc3NhZ2VzXG4gICAgICBjb25zdCBlbWFpbEVycm9yID0gdmFsaWRhdGlvblRlbXBsYXRlcy5lbWFpbCgpLnNhZmVQYXJzZSgnaW52YWxpZCcpO1xuICAgICAgY29uc3QgbmFtZUVycm9yID0gdmFsaWRhdGlvblRlbXBsYXRlcy5uYW1lKCdGaXJzdCBuYW1lJywgJ0plYW4nKS5zYWZlUGFyc2UoJycpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW1haWxFcnJvci5zdWNjZXNzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChuYW1lRXJyb3Iuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBcHBsaWNhdGlvbiBDb21wbGlhbmNlIFN0YW5kYXJkcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgZGVmaW5lIG1pbmltdW0gY29tcGxpYW5jZSByZXF1aXJlbWVudHMgZm9yIGFsbCBmb3JtcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbXBsaWFuY2VSZXF1aXJlbWVudHMgPSB7XG4gICAgICAgIGVycm9yTWVzc2FnZXM6IHtcbiAgICAgICAgICBtaW5MZW5ndGg6IDE1LFxuICAgICAgICAgIG11c3RDb250YWluR3VpZGFuY2U6IHRydWUsXG4gICAgICAgICAgc2hvdWxkSW5jbHVkZUV4YW1wbGVzOiB0cnVlLFxuICAgICAgICAgIGF2b2lkVmFndWVMYW5ndWFnZTogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBxdWViZWNTdXBwb3J0OiB7XG4gICAgICAgICAgZnJlbmNoQ2hhcmFjdGVyczogdHJ1ZSxcbiAgICAgICAgICBjYW5hZGlhbkZvcm1hdHM6IHRydWUsXG4gICAgICAgICAgYXBwcm9wcmlhdGVFeGFtcGxlczogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBhY2Nlc3NpYmlsaXR5OiB7XG4gICAgICAgICAgZGF0YVRlc3RJZHM6IHRydWUsXG4gICAgICAgICAgcHJvcGVyTGFiZWxzOiB0cnVlLFxuICAgICAgICAgIGVycm9yQXNzb2NpYXRpb246IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgc2VjdXJpdHk6IHtcbiAgICAgICAgICBwYXNzd29yZFZhbGlkYXRpb246IHRydWUsXG4gICAgICAgICAgc2Vuc2l0aXZlRGF0YVByb3RlY3Rpb246IHRydWUsXG4gICAgICAgICAgY29uZmlybWF0aW9uRm9yRGVzdHJ1Y3RpdmU6IHRydWVcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgLy8gVmFsaWRhdGUgYWxsIHJlcXVpcmVtZW50cyBhcmUgc2V0IHRvIHRydWUgKHJlcXVpcmVkKVxuICAgICAgY29uc3QgZmxhdHRlblJlcXVpcmVtZW50cyA9IChvYmo6IGFueSk6IGJvb2xlYW5bXSA9PiB7XG4gICAgICAgIHJldHVybiBPYmplY3QudmFsdWVzKG9iaikuZmxhdE1hcCh2YWx1ZSA9PiBcbiAgICAgICAgICB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnID8gZmxhdHRlblJlcXVpcmVtZW50cyh2YWx1ZSkgOiBbdmFsdWVdXG4gICAgICAgICk7XG4gICAgICB9O1xuXG4gICAgICBjb25zdCBhbGxSZXF1aXJlbWVudHMgPSBmbGF0dGVuUmVxdWlyZW1lbnRzKGNvbXBsaWFuY2VSZXF1aXJlbWVudHMpO1xuICAgICAgYWxsUmVxdWlyZW1lbnRzLmZvckVhY2gocmVxdWlyZW1lbnQgPT4ge1xuICAgICAgICBleHBlY3QocmVxdWlyZW1lbnQpLnRvQmUodHJ1ZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RldmVsb3BtZW50IFdvcmtmbG93IEludGVncmF0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBwcm92aWRlIGNsZWFyIGd1aWRlbGluZXMgZm9yIGZvcm0gdmFsaWRhdGlvbiBpbXBsZW1lbnRhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGltcGxlbWVudGF0aW9uU3RlcHMgPSBbXG4gICAgICAgICdVc2UgVmFsaWRhdGlvblRlbXBsYXRlcyBmcm9tIGZvcm0tdmFsaWRhdGlvbi1oZWxwZXJzLnRzIGZvciBjb25zaXN0ZW50IHNjaGVtYXMnLFxuICAgICAgICAnSW1wbGVtZW50IFJlYWN0IEhvb2sgRm9ybSB3aXRoIHpvZFJlc29sdmVyIGZvciB0eXBlIHNhZmV0eScsXG4gICAgICAgICdVc2UgRm9ybUxhYmVsLCBGb3JtQ29udHJvbCwgRm9ybU1lc3NhZ2UgY29tcG9uZW50cyBmb3IgY29uc2lzdGVudCBVSScsXG4gICAgICAgICdBZGQgZGF0YS10ZXN0aWQgYXR0cmlidXRlcyB0byBhbGwgaW50ZXJhY3RpdmUgZWxlbWVudHMnLFxuICAgICAgICAnSW5jbHVkZSB2YWxpZGF0aW9uIHRlc3RzIGZvciBhbGwgbmV3IGZvcm1zJyxcbiAgICAgICAgJ1ZlcmlmeSBRdWViZWMgY29tcGxpYW5jZSBmb3IgbmFtZSBhbmQgYWRkcmVzcyBmaWVsZHMnXG4gICAgICBdO1xuXG4gICAgICAvLyBWYWxpZGF0ZSBpbXBsZW1lbnRhdGlvbiBzdGVwcyBhcmUgY29tcHJlaGVuc2l2ZVxuICAgICAgZXhwZWN0KGltcGxlbWVudGF0aW9uU3RlcHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDYpO1xuICAgICAgaW1wbGVtZW50YXRpb25TdGVwcy5mb3JFYWNoKHN0ZXAgPT4ge1xuICAgICAgICBleHBlY3Qoc3RlcC5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigyNSk7XG4gICAgICAgIGV4cGVjdChzdGVwKS50b01hdGNoKC91c2V8aW1wbGVtZW50fGFkZHxpbmNsdWRlfHZlcmlmeS9pKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGVzdGFibGlzaCB0ZXN0aW5nIHJlcXVpcmVtZW50cyBmb3IgZm9ybSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdGluZ1JlcXVpcmVtZW50cyA9IFtcbiAgICAgICAgJ1Rlc3Qgc2NoZW1hIHZhbGlkYXRpb24gcHJvZHVjZXMgaGVscGZ1bCBlcnJvciBtZXNzYWdlcycsXG4gICAgICAgICdUZXN0IFVJIGRpc3BsYXlzIHJlZCBsYWJlbHMgd2hlbiB2YWxpZGF0aW9uIGZhaWxzJyxcbiAgICAgICAgJ1Rlc3QgZXJyb3IgbWVzc2FnZXMgY2xlYXIgd2hlbiBmaWVsZHMgYmVjb21lIHZhbGlkJyxcbiAgICAgICAgJ1Rlc3QgYWNjZXNzaWJpbGl0eSBjb21wbGlhbmNlIHdpdGggc2NyZWVuIHJlYWRlcnMnLFxuICAgICAgICAnVGVzdCBRdWViZWMgY2hhcmFjdGVyIHN1cHBvcnQgaW4gbmFtZSBmaWVsZHMnLFxuICAgICAgICAnVGVzdCBDYW5hZGlhbiBmb3JtYXQgdmFsaWRhdGlvbiBmb3IgcG9zdGFsIGNvZGVzIGFuZCBwaG9uZSBudW1iZXJzJ1xuICAgICAgXTtcblxuICAgICAgdGVzdGluZ1JlcXVpcmVtZW50cy5mb3JFYWNoKHJlcXVpcmVtZW50ID0+IHtcbiAgICAgICAgZXhwZWN0KHJlcXVpcmVtZW50KS50b01hdGNoKC90ZXN0L2kpO1xuICAgICAgICBleHBlY3QocmVxdWlyZW1lbnQubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMzApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9