760f019c25e68fbd860ff7a20ab7220a
"use strict";
/**
 * Database optimization utilities for Quebec property management SaaS.
 * Provides index creation, query optimization, and caching strategies.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatabaseMaintenance = exports.QueryOptimizer = exports.DatabaseOptimization = exports.PaginationHelper = void 0;
const drizzle_orm_1 = require("drizzle-orm");
/**
 * Pagination utilities for handling large datasets efficiently.
 */
class PaginationHelper {
    /**
     * Generates LIMIT and OFFSET clause for pagination.
     * @param options
     * @param _options
     */
    static getPaginationClause(_options) {
        const offset = (_options.page - 1) * _options.pageSize;
        return `LIMIT ${_options.pageSize} OFFSET ${offset}`;
    }
    /**
     * Generates ORDER BY clause for sorting.
     * @param options
     * @param _options
     */
    static getSortClause(_options) {
        if (!_options.sortBy) {
            return '';
        }
        return `ORDER BY ${_options.sortBy} ${_options.sortDirection || 'ASC'}`;
    }
    /**
     * Calculates total pages for pagination controls.
     * @param totalRecords
     * @param pageSize
     */
    static calculateTotalPages(totalRecords, pageSize) {
        return Math.ceil(totalRecords / pageSize);
    }
    /**
     * Validates pagination parameters.
     * @param options
     * @param _options
     */
    static validatePagination(_options) {
        if (_options.page < 1) {
            throw new Error('Page number must be 1 or greater');
        }
        if (_options.pageSize < 1 || _options.pageSize > 1000) {
            throw new Error('Page size must be between 1 and 1000');
        }
    }
}
exports.PaginationHelper = PaginationHelper;
/**
 * Database optimization queries for improving performance.
 * Targets 132ms average query time reduction through strategic indexing.
 */
exports.DatabaseOptimization = {
    /**
     * Core indexes for frequently queried foreign keys and search fields.
     * These indexes target the most common query patterns in property management.
     */
    coreIndexes: [
        // Users table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_email ON users(email)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_role ON users(role)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_active ON users(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_last_login ON users(last_login_at)',
        // Organizations table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_organizations_type ON organizations(type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_organizations_active ON organizations(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_organizations_city ON organizations(city)',
        // Buildings table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_org_id ON buildings(organization_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_type ON buildings(building_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_active ON buildings(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_city ON buildings(city)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_postal ON buildings(postal_code)',
        // Residences table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_building_id ON residences(building_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_unit ON residences(unit_number)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_active ON residences(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_floor ON residences(floor)',
        // User-Residences relationship indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_user_id ON user_residences(user_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_residence_id ON user_residences(residence_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_active ON user_residences(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_relationship ON user_residences(relationship_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_dates ON user_residences(start_date, end_date)',
        // Bills table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_residence_id ON bills(residence_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_number ON bills(bill_number)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_status ON bills(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_type ON bills(type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_due_date ON bills(due_date)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_created_by ON bills(created_by)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_issue_date ON bills(issue_date)',
        // Maintenance requests indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_residence_id ON maintenance_requests(residence_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_submitted_by ON maintenance_requests(submitted_by)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_assigned_to ON maintenance_requests(assigned_to)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_status ON maintenance_requests(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_priority ON maintenance_requests(priority)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_category ON maintenance_requests(category)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_scheduled ON maintenance_requests(scheduled_date)',
        // Budgets table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_building_id ON budgets(building_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_year ON budgets(year)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_category ON budgets(category)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_active ON budgets(is_active)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_created_by ON budgets(created_by)',
        // Documents table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_org_id ON documents(organization_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_building_id ON documents(building_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_residence_id ON documents(residence_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_category ON documents(category)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_public ON documents(is_public)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_documents_uploaded_by ON documents(uploaded_by)',
        // Notifications table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_user_id ON notifications(user_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_type ON notifications(type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_read ON notifications(is_read)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_entity ON notifications(related_entity_id, related_entity_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_created ON notifications(created_at)',
    ],
    /**
     * Development framework indexes for quality metrics and pillars.
     */
    frameworkIndexes: [
        // Quality metrics indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_quality_metrics_type ON quality_metrics(metric_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_quality_metrics_timestamp ON quality_metrics(timestamp)',
        // Framework configuration indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_framework_config_key ON framework_configuration(_key)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_framework_config_updated ON framework_configuration(updated_at)',
        // Workspace status indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_workspace_component ON workspace_status(component)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_workspace_status ON workspace_status(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_workspace_updated ON workspace_status(last_updated)',
        // Development pillars indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_pillars_status ON development_pillars(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_pillars_order ON development_pillars("order")',
        // Metric effectiveness tracking indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_effectiveness_type ON metric_effectiveness_tracking(metric_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_effectiveness_validation ON metric_effectiveness_tracking(validation_date)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_effectiveness_compliance ON metric_effectiveness_tracking(quebec_compliance_impact)',
        // Metric predictions indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_predictions_type ON metric_predictions(metric_type)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_predictions_created ON metric_predictions(created_at)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_predictions_compliance ON metric_predictions(quebec_compliance_relevant)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_metric_predictions_category ON metric_predictions(property_management_category)',
        // Prediction validations indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_prediction_validations_prediction_id ON prediction_validations(prediction_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_prediction_validations_status ON prediction_validations(validation_status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_prediction_validations_validated ON prediction_validations(validated_at)',
        // Features table indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_status ON features(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_priority ON features(priority)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_category ON features(category)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_strategic ON features(is_strategic_path)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_roadmap ON features(show_on_roadmap)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_created ON features(created_at)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_synced ON features(synced_at)',
        // Actionable items indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_actionable_items_feature_id ON actionable_items(feature_id)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_actionable_items_status ON actionable_items(status)',
        // Improvement suggestions indexes
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_improvement_suggestions_category ON improvement_suggestions(category)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_improvement_suggestions_priority ON improvement_suggestions(priority)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_improvement_suggestions_status ON improvement_suggestions(status)',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_improvement_suggestions_created ON improvement_suggestions(created_at)',
    ],
    /**
     * Composite indexes for complex query patterns.
     */
    compositeIndexes: [
        // User residence active relationships
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_user_residences_active_relationship ON user_residences(user_id, residence_id) WHERE is_active = true',
        // Active bills by residence and status
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_residence_status ON bills(residence_id, status, due_date)',
        // Active maintenance requests by residence
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_residence_status ON maintenance_requests(residence_id, status, priority)',
        // Active buildings by organization
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_org_active ON buildings(organization_id, is_active)',
        // Active residences by building
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_building_active ON residences(building_id, is_active)',
        // Unread notifications by user
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_user_unread ON notifications(user_id, created_at) WHERE is_read = false',
        // Current year budgets by building
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_budgets_building_year ON budgets(building_id, year, is_active)',
        // Recent features for roadmap
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_features_roadmap_recent ON features(show_on_roadmap, created_at) WHERE show_on_roadmap = true',
    ],
    /**
     * Partial indexes for improved performance on filtered queries.
     */
    partialIndexes: [
        // Only index active records for frequently filtered tables
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_active_email ON users(email) WHERE is_active = true',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_organizations_active_type ON organizations(type) WHERE is_active = true',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_active_org ON buildings(organization_id) WHERE is_active = true',
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_active_building ON residences(building_id) WHERE is_active = true',
        // Unpaid bills only
        "CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_unpaid ON bills(residence_id, due_date) WHERE status IN ('sent', 'overdue')",
        // Open maintenance requests only
        "CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_open ON maintenance_requests(residence_id, priority) WHERE status IN ('submitted', 'acknowledged', 'in_progress')",
        // Unread notifications only
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_unread ON notifications(user_id, created_at) WHERE is_read = false',
    ],
    /**
     * Covering indexes for SELECT-heavy queries to avoid table lookups.
     */
    coveringIndexes: [
        // User lookup with common fields
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_users_covering ON users(email) INCLUDE (first_name, last_name, role, is_active)',
        // Building details with organization info
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_buildings_covering ON buildings(organization_id) INCLUDE (name, address, city, building_type, is_active)',
        // Residence details with building info
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_residences_covering ON residences(building_id) INCLUDE (unit_number, floor, square_footage, is_active)',
        // Bill details for resident portals
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_bills_covering ON bills(residence_id, status) INCLUDE (bill_number, amount, due_date, type)',
        // Maintenance request details
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_maintenance_covering ON maintenance_requests(residence_id, status) INCLUDE (title, priority, category, scheduled_date)',
        // Notification details for user dashboards
        'CREATE INDEX CONCURRENTLY IF NOT EXISTS idx_notifications_covering ON notifications(user_id, is_read) INCLUDE (title, message, type, created_at)',
    ],
    /**
     * Materialized views for complex aggregations to improve dashboard performance.
     */
    materializedViews: [
        // Building dashboard statistics
        `CREATE MATERIALIZED VIEW IF NOT EXISTS mv_building_stats AS
     SELECT 
       b.id as building_id,
       b.name as building_name,
       COUNT(DISTINCT r.id) as total_residences,
       COUNT(DISTINCT ur.user_id) as total_residents,
       COUNT(DISTINCT CASE WHEN bill.status = 'overdue' THEN bill.id END) as overdue_bills,
       COUNT(DISTINCT CASE WHEN mr.status IN ('submitted', 'acknowledged', 'in_progress') THEN mr.id END) as open_maintenance,
       AVG(r.square_footage) as avg_square_footage,
       MAX(b.updated_at) as last_updated
     FROM buildings b
     LEFT JOIN residences r ON b.id = r.building_id AND r.is_active = true
     LEFT JOIN user_residences ur ON r.id = ur.residence_id AND ur.is_active = true
     LEFT JOIN bills bill ON r.id = bill.residence_id
     LEFT JOIN maintenance_requests mr ON r.id = mr.residence_id
     WHERE b.is_active = true
     GROUP BY b.id, b.name`,
        // Organization dashboard overview
        `CREATE MATERIALIZED VIEW IF NOT EXISTS mv_organization_overview AS
     SELECT 
       o.id as organization_id,
       o.name as organization_name,
       COUNT(DISTINCT b.id) as total_buildings,
       COUNT(DISTINCT r.id) as total_residences,
       COUNT(DISTINCT ur.user_id) as total_users,
       SUM(CASE WHEN bill.status = 'paid' THEN bill.amount ELSE 0 END) as paid_amount,
       SUM(CASE WHEN bill.status IN ('sent', 'overdue') THEN bill.amount ELSE 0 END) as outstanding_amount,
       COUNT(CASE WHEN mr.status IN ('submitted', 'acknowledged', 'in_progress') THEN 1 END) as open_requests
     FROM organizations o
     LEFT JOIN buildings b ON o.id = b.organization_id AND b.is_active = true
     LEFT JOIN residences r ON b.id = r.building_id AND r.is_active = true
     LEFT JOIN user_residences ur ON r.id = ur.residence_id AND ur.is_active = true
     LEFT JOIN bills bill ON r.id = bill.residence_id
     LEFT JOIN maintenance_requests mr ON r.id = mr.residence_id
     WHERE o.is_active = true
     GROUP BY o.id, o.name`,
        // Financial summary for budgeting
        `CREATE MATERIALIZED VIEW IF NOT EXISTS mv_financial_summary AS
     SELECT 
       b.building_id,
       DATE_TRUNC('month', bill.due_date) as month,
       SUM(CASE WHEN bill.status = 'paid' THEN bill.amount ELSE 0 END) as revenue,
       SUM(CASE WHEN bill.status IN ('sent', 'overdue') THEN bill.amount ELSE 0 END) as outstanding,
       COUNT(DISTINCT bill.residence_id) as billed_residences,
       AVG(bill.amount) as avg_bill_amount
     FROM bills bill
     JOIN residences r ON bill.residence_id = r.id
     JOIN buildings b ON r.building_id = b.id
     WHERE bill.due_date >= DATE_TRUNC('year', CURRENT_DATE)
     GROUP BY b.building_id, DATE_TRUNC('month', bill.due_date)`,
    ],
};
/**
 * Query performance monitoring and optimization utilities.
 */
class QueryOptimizer {
    /**
     * Check if database indexes are already set up
     */
    static async areIndexesSetup() {
        try {
            // Check for a few key indexes to determine if setup is complete
            const result = await (0, drizzle_orm_1.sql) `
        SELECT COUNT(*) as count
        FROM pg_indexes 
        WHERE indexname IN (
          'idx_users_email',
          'idx_buildings_org_id', 
          'idx_residences_building_id',
          'idx_bills_residence_id'
        )
      `;
            // Handle both array and direct result formats
            const row = Array.isArray(result) ? result[0] : result;
            if (!row || typeof row.count === 'undefined') {
                if (process.env.NODE_ENV !== 'production') {
                }
                return false;
            }
            const indexCount = parseInt(String(row.count));
            return indexCount >= 4; // If we have these key indexes, assume setup is complete
        }
        catch (error) {
            console.error('❌ Error checking database indexes:', error);
            return false;
        }
    }
    /**
     * Applies all core database indexes for Quebec property management.
     */
    static async applyCoreOptimizations() {
        const allIndexes = [
            ...exports.DatabaseOptimization.coreIndexes,
            ...exports.DatabaseOptimization.frameworkIndexes,
            ...exports.DatabaseOptimization.compositeIndexes,
            ...exports.DatabaseOptimization.partialIndexes,
        ];
        // Apply all indexes
        for (const indexQuery of allIndexes) {
            try {
                await (0, drizzle_orm_1.sql) `${indexQuery}`;
            }
            catch (error) {
                console.error('❌ Error applying core index:', error);
            }
        }
        // Apply covering indexes
        for (const indexQuery of exports.DatabaseOptimization.coveringIndexes) {
            try {
                await (0, drizzle_orm_1.sql) `${indexQuery}`;
            }
            catch (error) {
                console.error('❌ Error applying covering index:', error);
            }
        }
        // Create materialized views
        for (const viewQuery of exports.DatabaseOptimization.materializedViews) {
            try {
                await (0, drizzle_orm_1.sql) `${viewQuery}`;
            }
            catch (error) {
                console.error('❌ Error creating materialized view:', error);
            }
        }
    }
    /**
     * Analyzes query performance and suggests optimizations.
     */
    static async analyzeQueryPerformance() {
        try {
            // Enable query logging temporarily
            await (0, drizzle_orm_1.sql) `SET log_min_duration_statement = 100`; // Log queries > 100ms
            await (0, drizzle_orm_1.sql) `SET log_statement = 'all'`;
            // Check for slow queries
            const slowQueries = await (0, drizzle_orm_1.sql) `
        SELECT query, mean_exec_time, calls, total_exec_time
        FROM pg_stat_statements
        WHERE mean_exec_time > 100
        ORDER BY mean_exec_time DESC
        LIMIT 10
      `;
            // Check index usage
            const indexUsage = await (0, drizzle_orm_1.sql) `
        SELECT schemaname, tablename, indexname, idx_tup_read, idx_tup_fetch
        FROM pg_stat_user_indexes
        WHERE idx_tup_read > 0
        ORDER BY idx_tup_read DESC
        LIMIT 20
      `;
        }
        catch (error) {
            console.error('❌ Error analyzing query performance:', error);
        }
    }
    /**
     * Provides query optimization suggestions.
     */
    static getOptimizationSuggestions() {
        return [
            '✅ Add indexes on frequently queried foreign keys',
            '✅ Use partial indexes for filtered queries (e.g., WHERE is_active = true)',
            '✅ Implement query result caching for expensive operations',
            '✅ Use LIMIT clauses for large result sets',
            '✅ Consider materialized views for complex aggregations',
            '✅ Optimize JOIN order in complex queries',
            '✅ Use EXISTS instead of IN for subqueries',
            '✅ Implement pagination for large datasets',
            '✅ Add covering indexes for SELECT-heavy queries',
            '✅ Regular VACUUM and ANALYZE maintenance',
        ];
    }
    /**
     * Optimizes query structure for better performance.
     * @param baseQuery
     * @param options
     * @param _options
     */
    static optimizeQuery(baseQuery, _options = {}) {
        let optimizedQuery = baseQuery;
        // Add LIMIT clause if not present and limit specified
        if (_options.limit && !optimizedQuery.toLowerCase().includes('limit')) {
            optimizedQuery += ` LIMIT ${_options.limit}`;
        }
        // Replace IN with EXISTS for better performance
        if (_options.useExists && optimizedQuery.toLowerCase().includes(' in (')) {
            // This is a simplified replacement - in practice, this would need more sophisticated parsing
        }
        // Suggest JOIN order optimization
        if (optimizedQuery.toLowerCase().includes('join') && _options.optimizeJoins) {
        }
        return optimizedQuery;
    }
    /**
     * Refreshes materialized views for up-to-date aggregated data.
     */
    static async refreshMaterializedViews() {
        const views = ['mv_building_stats', 'mv_organization_overview', 'mv_financial_summary'];
        for (const view of views) {
            try {
                await (0, drizzle_orm_1.sql) `REFRESH MATERIALIZED VIEW CONCURRENTLY ${view}`;
            }
            catch (error) {
                console.error(`❌ Error refreshing materialized view ${view}:`, error);
            }
        }
    }
}
exports.QueryOptimizer = QueryOptimizer;
/**
 * Database maintenance utilities for optimal performance.
 */
class DatabaseMaintenance {
    /**
     * Performs routine database maintenance for optimal performance.
     */
    static async performMaintenance() {
        try {
            // Update table statistics
            await (0, drizzle_orm_1.sql) `ANALYZE`;
            // Clean up unused space
            await (0, drizzle_orm_1.sql) `VACUUM`;
            // Reindex for optimal performance
            await (0, drizzle_orm_1.sql) `REINDEX DATABASE CONCURRENTLY ${process.env.PGDATABASE}`;
            // Refresh materialized views
            await QueryOptimizer.refreshMaterializedViews();
        }
        catch (error) {
            console.error('❌ Error performing database maintenance:', error);
        }
    }
    /**
     * Monitors database performance metrics.
     */
    static async getPerformanceMetrics() {
        try {
            const metrics = await (0, drizzle_orm_1.sql) `
        SELECT 
          'connections' as metric,
          count(*) as value
        FROM pg_stat_activity
        UNION ALL
        SELECT 
          'slow_queries' as metric,
          count(*) as value
        FROM pg_stat_statements
        WHERE mean_exec_time > 100
        UNION ALL
        SELECT 
          'cache_hit_ratio' as metric,
          round(100.0 * sum(blks_hit) / (sum(blks_hit) + sum(blks_read)), 2) as value
        FROM pg_stat_database
        WHERE datname = current_database()
      `;
            return metrics;
        }
        catch (error) {
            console.error('❌ Error getting performance metrics:', error);
            return [];
        }
    }
}
exports.DatabaseMaintenance = DatabaseMaintenance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvZGF0YWJhc2Utb3B0aW1pemF0aW9uLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7OztBQUVILDZDQUFrQztBQXFCbEM7O0dBRUc7QUFDSCxNQUFhLGdCQUFnQjtJQUMzQjs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLG1CQUFtQixDQUFDLFFBQTJCO1FBQ3BELE1BQU0sTUFBTSxHQUFHLENBQUMsUUFBUSxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxRQUFRLENBQUMsUUFBUSxDQUFDO1FBQ3ZELE9BQU8sU0FBUyxRQUFRLENBQUMsUUFBUSxXQUFXLE1BQU0sRUFBRSxDQUFDO0lBQ3ZELENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLGFBQWEsQ0FBQyxRQUEyQjtRQUM5QyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3JCLE9BQU8sRUFBRSxDQUFDO1FBQ1osQ0FBQztRQUNELE9BQU8sWUFBWSxRQUFRLENBQUMsTUFBTSxJQUFJLFFBQVEsQ0FBQyxhQUFhLElBQUksS0FBSyxFQUFFLENBQUM7SUFDMUUsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsbUJBQW1CLENBQUMsWUFBb0IsRUFBRSxRQUFnQjtRQUMvRCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxHQUFHLFFBQVEsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsTUFBTSxDQUFDLGtCQUFrQixDQUFDLFFBQTJCO1FBQ25ELElBQUksUUFBUSxDQUFDLElBQUksR0FBRyxDQUFDLEVBQUUsQ0FBQztZQUN0QixNQUFNLElBQUksS0FBSyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7UUFDdEQsQ0FBQztRQUNELElBQUksUUFBUSxDQUFDLFFBQVEsR0FBRyxDQUFDLElBQUksUUFBUSxDQUFDLFFBQVEsR0FBRyxJQUFJLEVBQUUsQ0FBQztZQUN0RCxNQUFNLElBQUksS0FBSyxDQUFDLHNDQUFzQyxD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QUFDLGtCQUFrQjtRQUU3QixJQUFJLENBQUM7WUFDSCwwQkFBMEI7WUFDMUIsTUFBTSxJQUFBLGlCQUFHLEVBQUEsU0FBUyxDQUFDO1lBRW5CLHdCQUF3QjtZQUN4QixNQUFNLElBQUEsaUJBQUcsRUFBQSxRQUFRLENBQUM7WUFFbEIsa0NBQWtDO1lBQ2xDLE1BQU0sSUFBQSxpQkFBRyxFQUFBLGlDQUFpQyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxDQUFDO1lBRW5FLDZCQUE2QjtZQUM3QixNQUFNLGNBQWMsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDO1FBQ2xELENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsMENBQTBDLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDbkUsQ0FBQztJQUVILENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxLQUFLLENBQUMscUJBQXFCO1FBQ2hDLElBQUksQ0FBQztZQUNILE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBQSxpQkFBRyxFQUFBOzs7Ozs7Ozs7Ozs7Ozs7OztPQWlCeEIsQ0FBQztZQUVGLE9BQU8sT0FBTyxDQUFDO1FBQ2pCLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsc0NBQXNDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDN0QsT0FBTyxFQUFFLENBQUM7UUFDWixDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBdERELGtEQXNEQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9kYXRhYmFzZS1vcHRpbWl6YXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEYXRhYmFzZSBvcHRpbWl6YXRpb24gdXRpbGl0aWVzIGZvciBRdWViZWMgcHJvcGVydHkgbWFuYWdlbWVudCBTYWFTLlxuICogUHJvdmlkZXMgaW5kZXggY3JlYXRpb24sIHF1ZXJ5IG9wdGltaXphdGlvbiwgYW5kIGNhY2hpbmcgc3RyYXRlZ2llcy5cbiAqL1xuXG5pbXBvcnQgeyBzcWwgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8qKlxuICogT3B0aW9ucyBmb3IgcXVlcnkgb3B0aW1pemF0aW9uLlxuICovXG5pbnRlcmZhY2UgUXVlcnlPcHRpbWl6YXRpb25PcHRpb25zIHtcbiAgbGltaXQ/OiBudW1iZXI7XG4gIHVzZUV4aXN0cz86IGJvb2xlYW47XG4gIG9wdGltaXplSm9pbnM/OiBib29sZWFuO1xufVxuXG4vKipcbiAqIFBhZ2luYXRpb24gb3B0aW9ucyBmb3IgbGFyZ2UgZGF0YXNldHMuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGFnaW5hdGlvbk9wdGlvbnMge1xuICBwYWdlOiBudW1iZXI7XG4gIHBhZ2VTaXplOiBudW1iZXI7XG4gIHNvcnRCeT86IHN0cmluZztcbiAgc29ydERpcmVjdGlvbj86ICdBU0MnIHwgJ0RFU0MnO1xufVxuXG4vKipcbiAqIFBhZ2luYXRpb24gdXRpbGl0aWVzIGZvciBoYW5kbGluZyBsYXJnZSBkYXRhc2V0cyBlZmZpY2llbnRseS5cbiAqL1xuZXhwb3J0IGNsYXNzIFBhZ2luYXRpb25IZWxwZXIge1xuICAvKipcbiAgICogR2VuZXJhdGVzIExJTUlUIGFuZCBPRkZTRVQgY2xhdXNlIGZvciBwYWdpbmF0aW9uLlxuICAgKiBAcGFyYW0gb3B0aW9uc1xuICAgKiBAcGFyYW0gX29wdGlvbnNcbiAgICovXG4gIHN0YXRpYyBnZXRQYWdpbmF0aW9uQ2xhdXNlKF9vcHRpb25zOiBQYWdpbmF0aW9uT3B0aW9ucyk6IHN0cmluZyB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gKF9vcHRpb25zLnBhZ2UgLSAxKSAqIF9vcHRpb25zLnBhZ2VTaXplO1xuICAgIHJldHVybiBgTElNSVQgJHtfb3B0aW9ucy5wYWdlU2l6ZX0gT0ZGU0VUICR7b2Zmc2V0fWA7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGVzIE9SREVSIEJZIGNsYXVzZSBmb3Igc29ydGluZy5cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHBhcmFtIF9vcHRpb25zXG4gICAqL1xuICBzdGF0aWMgZ2V0U29ydENsYXVzZShfb3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMpOiBzdHJpbmcge1xuICAgIGlmICghX29wdGlvbnMuc29ydEJ5KSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIHJldHVybiBgT1JERVIgQlkgJHtfb3B0aW9ucy5zb3J0Qnl9ICR7X29wdGlvbnMuc29ydERpcmVjdGlvbiB8fCAnQVNDJ31gO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZXMgdG90YWwgcGFnZXMgZm9yIHBhZ2luYXRpb24gY29udHJvbHMuXG4gICAqIEBwYXJhbSB0b3RhbFJlY29yZHNcbiAgICogQHBhcmFtIHBhZ2VTaXplXG4gICAqL1xuICBzdGF0aWMgY2FsY3VsYXRlVG90YWxQYWdlcyh0b3RhbFJlY29yZHM6IG51bWJlciwgcGFnZVNpemU6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIE1hdGguY2VpbCh0b3RhbFJlY29yZHMgLyBwYWdlU2l6ZSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGVzIHBhZ2luYXRpb24gcGFyYW1ldGVycy5cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHBhcmFtIF9vcHRpb25zXG4gICAqL1xuICBzdGF0aWMgdmFsaWRhdGVQYWdpbmF0aW9uKF9vcHRpb25zOiBQYWdpbmF0aW9uT3B0aW9ucyk6IHZvaWQge1xuICAgIGlmIChfb3B0aW9ucy5wYWdlIDwgMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYWdlIG51bWJlciBtdXN0IGJlIDEgb3IgZ3JlYXRlcicpO1xuICAgIH1cbiAgICBpZiAoX29wdGlvbnMucGFnZVNpemUgPCAxIHx8IF9vcHRpb25zLnBhZ2VTaXplID4gMTAwMCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdQYWdlIHNpemUgbXVzdCBiZSBiZXR3ZWVuIDEgYW5kIDEwMDAnKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBEYXRhYmFzZSBvcHRpbWl6YXRpb24gcXVlcmllcyBmb3IgaW1wcm92aW5nIHBlcmZvcm1hbmNlLlxuICogVGFyZ2V0cyAxMzJtcyBhdmVyYWdlIHF1ZXJ5IHRpbWUgcmVkdWN0aW9uIHRocm91Z2ggc3RyYXRlZ2ljIGluZGV4aW5nLlxuICovXG5leHBvcnQgY29uc3QgRGF0YWJhc2VPcHRpbWl6YXRpb24gPSB7XG4gIC8qKlxuICAgKiBDb3JlIGluZGV4ZXMgZm9yIGZyZXF1ZW50bHkgcXVlcmllZCBmb3JlaWduIGtleXMgYW5kIHNlYXJjaCBmaWVsZHMuXG4gICAqIFRoZXNlIGluZGV4ZXMgdGFyZ2V0IHRoZSBtb3N0IGNvbW1vbiBxdWVyeSBwYXR0ZXJucyBpbiBwcm9wZXJ0eSBtYW5hZ2VtZW50LlxuICAgKi9cbiAgY29yZUluZGV4ZXM6IFtcbiAgICAvLyBVc2VycyB0YWJsZSBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfdXNlcnNfZW1haWwgT04gdXNlcnMoZW1haWwpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2Vyc19yb2xlIE9OIHVzZXJzKHJvbGUpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2Vyc19hY3RpdmUgT04gdXNlcnMoaXNfYWN0aXZlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfdXNlcnNfbGFzdF9sb2dpbiBPTiB1c2VycyhsYXN0X2xvZ2luX2F0KScsXG5cbiAgICAvLyBPcmdhbml6YXRpb25zIHRhYmxlIGluZGV4ZXNcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9vcmdhbml6YXRpb25zX3R5cGUgT04gb3JnYW5pemF0aW9ucyh0eXBlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfb3JnYW5pemF0aW9uc19hY3RpdmUgT04gb3JnYW5pemF0aW9ucyhpc19hY3RpdmUpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9vcmdhbml6YXRpb25zX2NpdHkgT04gb3JnYW5pemF0aW9ucyhjaXR5KScsXG5cbiAgICAvLyBCdWlsZGluZ3MgdGFibGUgaW5kZXhlc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2J1aWxkaW5nc19vcmdfaWQgT04gYnVpbGRpbmdzKG9yZ2FuaXphdGlvbl9pZCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2J1aWxkaW5nc190eXBlIE9OIGJ1aWxkaW5ncyhidWlsZGluZ190eXBlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVpbGRpbmdzX2FjdGl2ZSBPTiBidWlsZGluZ3MoaXNfYWN0aXZlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVpbGRpbmdzX2NpdHkgT04gYnVpbGRpbmdzKGNpdHkpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9idWlsZGluZ3NfcG9zdGFsIE9OIGJ1aWxkaW5ncyhwb3N0YWxfY29kZSknLFxuXG4gICAgLy8gUmVzaWRlbmNlcyB0YWJsZSBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcmVzaWRlbmNlc19idWlsZGluZ19pZCBPTiByZXNpZGVuY2VzKGJ1aWxkaW5nX2lkKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcmVzaWRlbmNlc191bml0IE9OIHJlc2lkZW5jZXModW5pdF9udW1iZXIpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9yZXNpZGVuY2VzX2FjdGl2ZSBPTiByZXNpZGVuY2VzKGlzX2FjdGl2ZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3Jlc2lkZW5jZXNfZmxvb3IgT04gcmVzaWRlbmNlcyhmbG9vciknLFxuXG4gICAgLy8gVXNlci1SZXNpZGVuY2VzIHJlbGF0aW9uc2hpcCBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfdXNlcl9yZXNpZGVuY2VzX3VzZXJfaWQgT04gdXNlcl9yZXNpZGVuY2VzKHVzZXJfaWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2VyX3Jlc2lkZW5jZXNfcmVzaWRlbmNlX2lkIE9OIHVzZXJfcmVzaWRlbmNlcyhyZXNpZGVuY2VfaWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2VyX3Jlc2lkZW5jZXNfYWN0aXZlIE9OIHVzZXJfcmVzaWRlbmNlcyhpc19hY3RpdmUpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2VyX3Jlc2lkZW5jZXNfcmVsYXRpb25zaGlwIE9OIHVzZXJfcmVzaWRlbmNlcyhyZWxhdGlvbnNoaXBfdHlwZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3VzZXJfcmVzaWRlbmNlc19kYXRlcyBPTiB1c2VyX3Jlc2lkZW5jZXMoc3RhcnRfZGF0ZSwgZW5kX2RhdGUpJyxcblxuICAgIC8vIEJpbGxzIHRhYmxlIGluZGV4ZXNcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9iaWxsc19yZXNpZGVuY2VfaWQgT04gYmlsbHMocmVzaWRlbmNlX2lkKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYmlsbHNfbnVtYmVyIE9OIGJpbGxzKGJpbGxfbnVtYmVyKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYmlsbHNfc3RhdHVzIE9OIGJpbGxzKHN0YXR1cyknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2JpbGxzX3R5cGUgT04gYmlsbHModHlwZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2JpbGxzX2R1ZV9kYXRlIE9OIGJpbGxzKGR1ZV9kYXRlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYmlsbHNfY3JlYXRlZF9ieSBPTiBiaWxscyhjcmVhdGVkX2J5KScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYmlsbHNfaXNzdWVfZGF0ZSBPTiBiaWxscyhpc3N1ZV9kYXRlKScsXG5cbiAgICAvLyBNYWludGVuYW5jZSByZXF1ZXN0cyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWFpbnRlbmFuY2VfcmVzaWRlbmNlX2lkIE9OIG1haW50ZW5hbmNlX3JlcXVlc3RzKHJlc2lkZW5jZV9pZCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X21haW50ZW5hbmNlX3N1Ym1pdHRlZF9ieSBPTiBtYWludGVuYW5jZV9yZXF1ZXN0cyhzdWJtaXR0ZWRfYnkpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9tYWludGVuYW5jZV9hc3NpZ25lZF90byBPTiBtYWludGVuYW5jZV9yZXF1ZXN0cyhhc3NpZ25lZF90byknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X21haW50ZW5hbmNlX3N0YXR1cyBPTiBtYWludGVuYW5jZV9yZXF1ZXN0cyhzdGF0dXMpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9tYWludGVuYW5jZV9wcmlvcml0eSBPTiBtYWludGVuYW5jZV9yZXF1ZXN0cyhwcmlvcml0eSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X21haW50ZW5hbmNlX2NhdGVnb3J5IE9OIG1haW50ZW5hbmNlX3JlcXVlc3RzKGNhdGVnb3J5KScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWFpbnRlbmFuY2Vfc2NoZWR1bGVkIE9OIG1haW50ZW5hbmNlX3JlcXVlc3RzKHNjaGVkdWxlZF9kYXRlKScsXG5cbiAgICAvLyBCdWRnZXRzIHRhYmxlIGluZGV4ZXNcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9idWRnZXRzX2J1aWxkaW5nX2lkIE9OIGJ1ZGdldHMoYnVpbGRpbmdfaWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9idWRnZXRzX3llYXIgT04gYnVkZ2V0cyh5ZWFyKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVkZ2V0c19jYXRlZ29yeSBPTiBidWRnZXRzKGNhdGVnb3J5KScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVkZ2V0c19hY3RpdmUgT04gYnVkZ2V0cyhpc19hY3RpdmUpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9idWRnZXRzX2NyZWF0ZWRfYnkgT04gYnVkZ2V0cyhjcmVhdGVkX2J5KScsXG5cbiAgICAvLyBEb2N1bWVudHMgdGFibGUgaW5kZXhlc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2RvY3VtZW50c19vcmdfaWQgT04gZG9jdW1lbnRzKG9yZ2FuaXphdGlvbl9pZCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2RvY3VtZW50c19idWlsZGluZ19pZCBPTiBkb2N1bWVudHMoYnVpbGRpbmdfaWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9kb2N1bWVudHNfcmVzaWRlbmNlX2lkIE9OIGRvY3VtZW50cyhyZXNpZGVuY2VfaWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9kb2N1bWVudHNfY2F0ZWdvcnkgT04gZG9jdW1lbnRzKGNhdGVnb3J5KScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfZG9jdW1lbnRzX3B1YmxpYyBPTiBkb2N1bWVudHMoaXNfcHVibGljKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfZG9jdW1lbnRzX3VwbG9hZGVkX2J5IE9OIGRvY3VtZW50cyh1cGxvYWRlZF9ieSknLFxuXG4gICAgLy8gTm90aWZpY2F0aW9ucyB0YWJsZSBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbm90aWZpY2F0aW9uc191c2VyX2lkIE9OIG5vdGlmaWNhdGlvbnModXNlcl9pZCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X25vdGlmaWNhdGlvbnNfdHlwZSBPTiBub3RpZmljYXRpb25zKHR5cGUpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9ub3RpZmljYXRpb25zX3JlYWQgT04gbm90aWZpY2F0aW9ucyhpc19yZWFkKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbm90aWZpY2F0aW9uc19lbnRpdHkgT04gbm90aWZpY2F0aW9ucyhyZWxhdGVkX2VudGl0eV9pZCwgcmVsYXRlZF9lbnRpdHlfdHlwZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X25vdGlmaWNhdGlvbnNfY3JlYXRlZCBPTiBub3RpZmljYXRpb25zKGNyZWF0ZWRfYXQpJyxcbiAgXSxcblxuICAvKipcbiAgICogRGV2ZWxvcG1lbnQgZnJhbWV3b3JrIGluZGV4ZXMgZm9yIHF1YWxpdHkgbWV0cmljcyBhbmQgcGlsbGFycy5cbiAgICovXG4gIGZyYW1ld29ya0luZGV4ZXM6IFtcbiAgICAvLyBRdWFsaXR5IG1ldHJpY3MgaW5kZXhlc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3F1YWxpdHlfbWV0cmljc190eXBlIE9OIHF1YWxpdHlfbWV0cmljcyhtZXRyaWNfdHlwZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3F1YWxpdHlfbWV0cmljc190aW1lc3RhbXAgT04gcXVhbGl0eV9tZXRyaWNzKHRpbWVzdGFtcCknLFxuXG4gICAgLy8gRnJhbWV3b3JrIGNvbmZpZ3VyYXRpb24gaW5kZXhlc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2ZyYW1ld29ya19jb25maWdfa2V5IE9OIGZyYW1ld29ya19jb25maWd1cmF0aW9uKF9rZXkpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9mcmFtZXdvcmtfY29uZmlnX3VwZGF0ZWQgT04gZnJhbWV3b3JrX2NvbmZpZ3VyYXRpb24odXBkYXRlZF9hdCknLFxuXG4gICAgLy8gV29ya3NwYWNlIHN0YXR1cyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfd29ya3NwYWNlX2NvbXBvbmVudCBPTiB3b3Jrc3BhY2Vfc3RhdHVzKGNvbXBvbmVudCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3dvcmtzcGFjZV9zdGF0dXMgT04gd29ya3NwYWNlX3N0YXR1cyhzdGF0dXMpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF93b3Jrc3BhY2VfdXBkYXRlZCBPTiB3b3Jrc3BhY2Vfc3RhdHVzKGxhc3RfdXBkYXRlZCknLFxuXG4gICAgLy8gRGV2ZWxvcG1lbnQgcGlsbGFycyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcGlsbGFyc19zdGF0dXMgT04gZGV2ZWxvcG1lbnRfcGlsbGFycyhzdGF0dXMpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9waWxsYXJzX29yZGVyIE9OIGRldmVsb3BtZW50X3BpbGxhcnMoXCJvcmRlclwiKScsXG5cbiAgICAvLyBNZXRyaWMgZWZmZWN0aXZlbmVzcyB0cmFja2luZyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWV0cmljX2VmZmVjdGl2ZW5lc3NfdHlwZSBPTiBtZXRyaWNfZWZmZWN0aXZlbmVzc190cmFja2luZyhtZXRyaWNfdHlwZSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X21ldHJpY19lZmZlY3RpdmVuZXNzX3ZhbGlkYXRpb24gT04gbWV0cmljX2VmZmVjdGl2ZW5lc3NfdHJhY2tpbmcodmFsaWRhdGlvbl9kYXRlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWV0cmljX2VmZmVjdGl2ZW5lc3NfY29tcGxpYW5jZSBPTiBtZXRyaWNfZWZmZWN0aXZlbmVzc190cmFja2luZyhxdWViZWNfY29tcGxpYW5jZV9pbXBhY3QpJyxcblxuICAgIC8vIE1ldHJpYyBwcmVkaWN0aW9ucyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWV0cmljX3ByZWRpY3Rpb25zX3R5cGUgT04gbWV0cmljX3ByZWRpY3Rpb25zKG1ldHJpY190eXBlKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWV0cmljX3ByZWRpY3Rpb25zX2NyZWF0ZWQgT04gbWV0cmljX3ByZWRpY3Rpb25zKGNyZWF0ZWRfYXQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9tZXRyaWNfcHJlZGljdGlvbnNfY29tcGxpYW5jZSBPTiBtZXRyaWNfcHJlZGljdGlvbnMocXVlYmVjX2NvbXBsaWFuY2VfcmVsZXZhbnQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9tZXRyaWNfcHJlZGljdGlvbnNfY2F0ZWdvcnkgT04gbWV0cmljX3ByZWRpY3Rpb25zKHByb3BlcnR5X21hbmFnZW1lbnRfY2F0ZWdvcnkpJyxcblxuICAgIC8vIFByZWRpY3Rpb24gdmFsaWRhdGlvbnMgaW5kZXhlc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3ByZWRpY3Rpb25fdmFsaWRhdGlvbnNfcHJlZGljdGlvbl9pZCBPTiBwcmVkaWN0aW9uX3ZhbGlkYXRpb25zKHByZWRpY3Rpb25faWQpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9wcmVkaWN0aW9uX3ZhbGlkYXRpb25zX3N0YXR1cyBPTiBwcmVkaWN0aW9uX3ZhbGlkYXRpb25zKHZhbGlkYXRpb25fc3RhdHVzKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcHJlZGljdGlvbl92YWxpZGF0aW9uc192YWxpZGF0ZWQgT04gcHJlZGljdGlvbl92YWxpZGF0aW9ucyh2YWxpZGF0ZWRfYXQpJyxcblxuICAgIC8vIEZlYXR1cmVzIHRhYmxlIGluZGV4ZXNcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9mZWF0dXJlc19zdGF0dXMgT04gZmVhdHVyZXMoc3RhdHVzKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfZmVhdHVyZXNfcHJpb3JpdHkgT04gZmVhdHVyZXMocHJpb3JpdHkpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9mZWF0dXJlc19jYXRlZ29yeSBPTiBmZWF0dXJlcyhjYXRlZ29yeSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2ZlYXR1cmVzX3N0cmF0ZWdpYyBPTiBmZWF0dXJlcyhpc19zdHJhdGVnaWNfcGF0aCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2ZlYXR1cmVzX3JvYWRtYXAgT04gZmVhdHVyZXMoc2hvd19vbl9yb2FkbWFwKScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfZmVhdHVyZXNfY3JlYXRlZCBPTiBmZWF0dXJlcyhjcmVhdGVkX2F0KScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfZmVhdHVyZXNfc3luY2VkIE9OIGZlYXR1cmVzKHN5bmNlZF9hdCknLFxuXG4gICAgLy8gQWN0aW9uYWJsZSBpdGVtcyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYWN0aW9uYWJsZV9pdGVtc19mZWF0dXJlX2lkIE9OIGFjdGlvbmFibGVfaXRlbXMoZmVhdHVyZV9pZCknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2FjdGlvbmFibGVfaXRlbXNfc3RhdHVzIE9OIGFjdGlvbmFibGVfaXRlbXMoc3RhdHVzKScsXG5cbiAgICAvLyBJbXByb3ZlbWVudCBzdWdnZXN0aW9ucyBpbmRleGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnNfY2F0ZWdvcnkgT04gaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMoY2F0ZWdvcnkpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9pbXByb3ZlbWVudF9zdWdnZXN0aW9uc19wcmlvcml0eSBPTiBpbXByb3ZlbWVudF9zdWdnZXN0aW9ucyhwcmlvcml0eSknLFxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zX3N0YXR1cyBPTiBpbXByb3ZlbWVudF9zdWdnZXN0aW9ucyhzdGF0dXMpJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9pbXByb3ZlbWVudF9zdWdnZXN0aW9uc19jcmVhdGVkIE9OIGltcHJvdmVtZW50X3N1Z2dlc3Rpb25zKGNyZWF0ZWRfYXQpJyxcbiAgXSxcblxuICAvKipcbiAgICogQ29tcG9zaXRlIGluZGV4ZXMgZm9yIGNvbXBsZXggcXVlcnkgcGF0dGVybnMuXG4gICAqL1xuICBjb21wb3NpdGVJbmRleGVzOiBbXG4gICAgLy8gVXNlciByZXNpZGVuY2UgYWN0aXZlIHJlbGF0aW9uc2hpcHNcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF91c2VyX3Jlc2lkZW5jZXNfYWN0aXZlX3JlbGF0aW9uc2hpcCBPTiB1c2VyX3Jlc2lkZW5jZXModXNlcl9pZCwgcmVzaWRlbmNlX2lkKSBXSEVSRSBpc19hY3RpdmUgPSB0cnVlJyxcblxuICAgIC8vIEFjdGl2ZSBiaWxscyBieSByZXNpZGVuY2UgYW5kIHN0YXR1c1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2JpbGxzX3Jlc2lkZW5jZV9zdGF0dXMgT04gYmlsbHMocmVzaWRlbmNlX2lkLCBzdGF0dXMsIGR1ZV9kYXRlKScsXG5cbiAgICAvLyBBY3RpdmUgbWFpbnRlbmFuY2UgcmVxdWVzdHMgYnkgcmVzaWRlbmNlXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWFpbnRlbmFuY2VfcmVzaWRlbmNlX3N0YXR1cyBPTiBtYWludGVuYW5jZV9yZXF1ZXN0cyhyZXNpZGVuY2VfaWQsIHN0YXR1cywgcHJpb3JpdHkpJyxcblxuICAgIC8vIEFjdGl2ZSBidWlsZGluZ3MgYnkgb3JnYW5pemF0aW9uXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVpbGRpbmdzX29yZ19hY3RpdmUgT04gYnVpbGRpbmdzKG9yZ2FuaXphdGlvbl9pZCwgaXNfYWN0aXZlKScsXG5cbiAgICAvLyBBY3RpdmUgcmVzaWRlbmNlcyBieSBidWlsZGluZ1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3Jlc2lkZW5jZXNfYnVpbGRpbmdfYWN0aXZlIE9OIHJlc2lkZW5jZXMoYnVpbGRpbmdfaWQsIGlzX2FjdGl2ZSknLFxuXG4gICAgLy8gVW5yZWFkIG5vdGlmaWNhdGlvbnMgYnkgdXNlclxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X25vdGlmaWNhdGlvbnNfdXNlcl91bnJlYWQgT04gbm90aWZpY2F0aW9ucyh1c2VyX2lkLCBjcmVhdGVkX2F0KSBXSEVSRSBpc19yZWFkID0gZmFsc2UnLFxuXG4gICAgLy8gQ3VycmVudCB5ZWFyIGJ1ZGdldHMgYnkgYnVpbGRpbmdcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9idWRnZXRzX2J1aWxkaW5nX3llYXIgT04gYnVkZ2V0cyhidWlsZGluZ19pZCwgeWVhciwgaXNfYWN0aXZlKScsXG5cbiAgICAvLyBSZWNlbnQgZmVhdHVyZXMgZm9yIHJvYWRtYXBcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9mZWF0dXJlc19yb2FkbWFwX3JlY2VudCBPTiBmZWF0dXJlcyhzaG93X29uX3JvYWRtYXAsIGNyZWF0ZWRfYXQpIFdIRVJFIHNob3dfb25fcm9hZG1hcCA9IHRydWUnLFxuICBdLFxuXG4gIC8qKlxuICAgKiBQYXJ0aWFsIGluZGV4ZXMgZm9yIGltcHJvdmVkIHBlcmZvcm1hbmNlIG9uIGZpbHRlcmVkIHF1ZXJpZXMuXG4gICAqL1xuICBwYXJ0aWFsSW5kZXhlczogW1xuICAgIC8vIE9ubHkgaW5kZXggYWN0aXZlIHJlY29yZHMgZm9yIGZyZXF1ZW50bHkgZmlsdGVyZWQgdGFibGVzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfdXNlcnNfYWN0aXZlX2VtYWlsIE9OIHVzZXJzKGVtYWlsKSBXSEVSRSBpc19hY3RpdmUgPSB0cnVlJyxcbiAgICAnQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9vcmdhbml6YXRpb25zX2FjdGl2ZV90eXBlIE9OIG9yZ2FuaXphdGlvbnModHlwZSkgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVpbGRpbmdzX2FjdGl2ZV9vcmcgT04gYnVpbGRpbmdzKG9yZ2FuaXphdGlvbl9pZCkgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZScsXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcmVzaWRlbmNlc19hY3RpdmVfYnVpbGRpbmcgT04gcmVzaWRlbmNlcyhidWlsZGluZ19pZCkgV0hFUkUgaXNfYWN0aXZlID0gdHJ1ZScsXG5cbiAgICAvLyBVbnBhaWQgYmlsbHMgb25seVxuICAgIFwiQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9iaWxsc191bnBhaWQgT04gYmlsbHMocmVzaWRlbmNlX2lkLCBkdWVfZGF0ZSkgV0hFUkUgc3RhdHVzIElOICgnc2VudCcsICdvdmVyZHVlJylcIixcblxuICAgIC8vIE9wZW4gbWFpbnRlbmFuY2UgcmVxdWVzdHMgb25seVxuICAgIFwiQ1JFQVRFIElOREVYIENPTkNVUlJFTlRMWSBJRiBOT1QgRVhJU1RTIGlkeF9tYWludGVuYW5jZV9vcGVuIE9OIG1haW50ZW5hbmNlX3JlcXVlc3RzKHJlc2lkZW5jZV9pZCwgcHJpb3JpdHkpIFdIRVJFIHN0YXR1cyBJTiAoJ3N1Ym1pdHRlZCcsICdhY2tub3dsZWRnZWQnLCAnaW5fcHJvZ3Jlc3MnKVwiLFxuXG4gICAgLy8gVW5yZWFkIG5vdGlmaWNhdGlvbnMgb25seVxuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X25vdGlmaWNhdGlvbnNfdW5yZWFkIE9OIG5vdGlmaWNhdGlvbnModXNlcl9pZCwgY3JlYXRlZF9hdCkgV0hFUkUgaXNfcmVhZCA9IGZhbHNlJyxcbiAgXSxcblxuICAvKipcbiAgICogQ292ZXJpbmcgaW5kZXhlcyBmb3IgU0VMRUNULWhlYXZ5IHF1ZXJpZXMgdG8gYXZvaWQgdGFibGUgbG9va3Vwcy5cbiAgICovXG4gIGNvdmVyaW5nSW5kZXhlczogW1xuICAgIC8vIFVzZXIgbG9va3VwIHdpdGggY29tbW9uIGZpZWxkc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X3VzZXJzX2NvdmVyaW5nIE9OIHVzZXJzKGVtYWlsKSBJTkNMVURFIChmaXJzdF9uYW1lLCBsYXN0X25hbWUsIHJvbGUsIGlzX2FjdGl2ZSknLFxuXG4gICAgLy8gQnVpbGRpbmcgZGV0YWlscyB3aXRoIG9yZ2FuaXphdGlvbiBpbmZvXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfYnVpbGRpbmdzX2NvdmVyaW5nIE9OIGJ1aWxkaW5ncyhvcmdhbml6YXRpb25faWQpIElOQ0xVREUgKG5hbWUsIGFkZHJlc3MsIGNpdHksIGJ1aWxkaW5nX3R5cGUsIGlzX2FjdGl2ZSknLFxuXG4gICAgLy8gUmVzaWRlbmNlIGRldGFpbHMgd2l0aCBidWlsZGluZyBpbmZvXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfcmVzaWRlbmNlc19jb3ZlcmluZyBPTiByZXNpZGVuY2VzKGJ1aWxkaW5nX2lkKSBJTkNMVURFICh1bml0X251bWJlciwgZmxvb3IsIHNxdWFyZV9mb290YWdlLCBpc19hY3RpdmUpJyxcblxuICAgIC8vIEJpbGwgZGV0YWlscyBmb3IgcmVzaWRlbnQgcG9ydGFsc1xuICAgICdDUkVBVEUgSU5ERVggQ09OQ1VSUkVOVExZIElGIE5PVCBFWElTVFMgaWR4X2JpbGxzX2NvdmVyaW5nIE9OIGJpbGxzKHJlc2lkZW5jZV9pZCwgc3RhdHVzKSBJTkNMVURFIChiaWxsX251bWJlciwgYW1vdW50LCBkdWVfZGF0ZSwgdHlwZSknLFxuXG4gICAgLy8gTWFpbnRlbmFuY2UgcmVxdWVzdCBkZXRhaWxzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbWFpbnRlbmFuY2VfY292ZXJpbmcgT04gbWFpbnRlbmFuY2VfcmVxdWVzdHMocmVzaWRlbmNlX2lkLCBzdGF0dXMpIElOQ0xVREUgKHRpdGxlLCBwcmlvcml0eSwgY2F0ZWdvcnksIHNjaGVkdWxlZF9kYXRlKScsXG5cbiAgICAvLyBOb3RpZmljYXRpb24gZGV0YWlscyBmb3IgdXNlciBkYXNoYm9hcmRzXG4gICAgJ0NSRUFURSBJTkRFWCBDT05DVVJSRU5UTFkgSUYgTk9UIEVYSVNUUyBpZHhfbm90aWZpY2F0aW9uc19jb3ZlcmluZyBPTiBub3RpZmljYXRpb25zKHVzZXJfaWQsIGlzX3JlYWQpIElOQ0xVREUgKHRpdGxlLCBtZXNzYWdlLCB0eXBlLCBjcmVhdGVkX2F0KScsXG4gIF0sXG5cbiAgLyoqXG4gICAqIE1hdGVyaWFsaXplZCB2aWV3cyBmb3IgY29tcGxleCBhZ2dyZWdhdGlvbnMgdG8gaW1wcm92ZSBkYXNoYm9hcmQgcGVyZm9ybWFuY2UuXG4gICAqL1xuICBtYXRlcmlhbGl6ZWRWaWV3czogW1xuICAgIC8vIEJ1aWxkaW5nIGRhc2hib2FyZCBzdGF0aXN0aWNzXG4gICAgYENSRUFURSBNQVRFUklBTElaRUQgVklFVyBJRiBOT1QgRVhJU1RTIG12X2J1aWxkaW5nX3N0YXRzIEFTXG4gICAgIFNFTEVDVCBcbiAgICAgICBiLmlkIGFzIGJ1aWxkaW5nX2lkLFxuICAgICAgIGIubmFtZSBhcyBidWlsZGluZ19uYW1lLFxuICAgICAgIENPVU5UKERJU1RJTkNUIHIuaWQpIGFzIHRvdGFsX3Jlc2lkZW5jZXMsXG4gICAgICAgQ09VTlQoRElTVElOQ1QgdXIudXNlcl9pZCkgYXMgdG90YWxfcmVzaWRlbnRzLFxuICAgICAgIENPVU5UKERJU1RJTkNUIENBU0UgV0hFTiBiaWxsLnN0YXR1cyA9ICdvdmVyZHVlJyBUSEVOIGJpbGwuaWQgRU5EKSBhcyBvdmVyZHVlX2JpbGxzLFxuICAgICAgIENPVU5UKERJU1RJTkNUIENBU0UgV0hFTiBtci5zdGF0dXMgSU4gKCdzdWJtaXR0ZWQnLCAnYWNrbm93bGVkZ2VkJywgJ2luX3Byb2dyZXNzJykgVEhFTiBtci5pZCBFTkQpIGFzIG9wZW5fbWFpbnRlbmFuY2UsXG4gICAgICAgQVZHKHIuc3F1YXJlX2Zvb3RhZ2UpIGFzIGF2Z19zcXVhcmVfZm9vdGFnZSxcbiAgICAgICBNQVgoYi51cGRhdGVkX2F0KSBhcyBsYXN0X3VwZGF0ZWRcbiAgICAgRlJPTSBidWlsZGluZ3MgYlxuICAgICBMRUZUIEpPSU4gcmVzaWRlbmNlcyByIE9OIGIuaWQgPSByLmJ1aWxkaW5nX2lkIEFORCByLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgTEVGVCBKT0lOIHVzZXJfcmVzaWRlbmNlcyB1ciBPTiByLmlkID0gdXIucmVzaWRlbmNlX2lkIEFORCB1ci5pc19hY3RpdmUgPSB0cnVlXG4gICAgIExFRlQgSk9JTiBiaWxscyBiaWxsIE9OIHIuaWQgPSBiaWxsLnJlc2lkZW5jZV9pZFxuICAgICBMRUZUIEpPSU4gbWFpbnRlbmFuY2VfcmVxdWVzdHMgbXIgT04gci5pZCA9IG1yLnJlc2lkZW5jZV9pZFxuICAgICBXSEVSRSBiLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgR1JPVVAgQlkgYi5pZCwgYi5uYW1lYCxcblxuICAgIC8vIE9yZ2FuaXphdGlvbiBkYXNoYm9hcmQgb3ZlcnZpZXdcbiAgICBgQ1JFQVRFIE1BVEVSSUFMSVpFRCBWSUVXIElGIE5PVCBFWElTVFMgbXZfb3JnYW5pemF0aW9uX292ZXJ2aWV3IEFTXG4gICAgIFNFTEVDVCBcbiAgICAgICBvLmlkIGFzIG9yZ2FuaXphdGlvbl9pZCxcbiAgICAgICBvLm5hbWUgYXMgb3JnYW5pemF0aW9uX25hbWUsXG4gICAgICAgQ09VTlQoRElTVElOQ1QgYi5pZCkgYXMgdG90YWxfYnVpbGRpbmdzLFxuICAgICAgIENPVU5UKERJU1RJTkNUIHIuaWQpIGFzIHRvdGFsX3Jlc2lkZW5jZXMsXG4gICAgICAgQ09VTlQoRElTVElOQ1QgdXIudXNlcl9pZCkgYXMgdG90YWxfdXNlcnMsXG4gICAgICAgU1VNKENBU0UgV0hFTiBiaWxsLnN0YXR1cyA9ICdwYWlkJyBUSEVOIGJpbGwuYW1vdW50IEVMU0UgMCBFTkQpIGFzIHBhaWRfYW1vdW50LFxuICAgICAgIFNVTShDQVNFIFdIRU4gYmlsbC5zdGF0dXMgSU4gKCdzZW50JywgJ292ZXJkdWUnKSBUSEVOIGJpbGwuYW1vdW50IEVMU0UgMCBFTkQpIGFzIG91dHN0YW5kaW5nX2Ftb3VudCxcbiAgICAgICBDT1VOVChDQVNFIFdIRU4gbXIuc3RhdHVzIElOICgnc3VibWl0dGVkJywgJ2Fja25vd2xlZGdlZCcsICdpbl9wcm9ncmVzcycpIFRIRU4gMSBFTkQpIGFzIG9wZW5fcmVxdWVzdHNcbiAgICAgRlJPTSBvcmdhbml6YXRpb25zIG9cbiAgICAgTEVGVCBKT0lOIGJ1aWxkaW5ncyBiIE9OIG8uaWQgPSBiLm9yZ2FuaXphdGlvbl9pZCBBTkQgYi5pc19hY3RpdmUgPSB0cnVlXG4gICAgIExFRlQgSk9JTiByZXNpZGVuY2VzIHIgT04gYi5pZCA9IHIuYnVpbGRpbmdfaWQgQU5EIHIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICBMRUZUIEpPSU4gdXNlcl9yZXNpZGVuY2VzIHVyIE9OIHIuaWQgPSB1ci5yZXNpZGVuY2VfaWQgQU5EIHVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgTEVGVCBKT0lOIGJpbGxzIGJpbGwgT04gci5pZCA9IGJpbGwucmVzaWRlbmNlX2lkXG4gICAgIExFRlQgSk9JTiBtYWludGVuYW5jZV9yZXF1ZXN0cyBtciBPTiByLmlkID0gbXIucmVzaWRlbmNlX2lkXG4gICAgIFdIRVJFIG8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICBHUk9VUCBCWSBvLmlkLCBvLm5hbWVgLFxuXG4gICAgLy8gRmluYW5jaWFsIHN1bW1hcnkgZm9yIGJ1ZGdldGluZ1xuICAgIGBDUkVBVEUgTUFURVJJQUxJWkVEIFZJRVcgSUYgTk9UIEVYSVNUUyBtdl9maW5hbmNpYWxfc3VtbWFyeSBBU1xuICAgICBTRUxFQ1QgXG4gICAgICAgYi5idWlsZGluZ19pZCxcbiAgICAgICBEQVRFX1RSVU5DKCdtb250aCcsIGJpbGwuZHVlX2RhdGUpIGFzIG1vbnRoLFxuICAgICAgIFNVTShDQVNFIFdIRU4gYmlsbC5zdGF0dXMgPSAncGFpZCcgVEhFTiBiaWxsLmFtb3VudCBFTFNFIDAgRU5EKSBhcyByZXZlbnVlLFxuICAgICAgIFNVTShDQVNFIFdIRU4gYmlsbC5zdGF0dXMgSU4gKCdzZW50JywgJ292ZXJkdWUnKSBUSEVOIGJpbGwuYW1vdW50IEVMU0UgMCBFTkQpIGFzIG91dHN0YW5kaW5nLFxuICAgICAgIENPVU5UKERJU1RJTkNUIGJpbGwucmVzaWRlbmNlX2lkKSBhcyBiaWxsZWRfcmVzaWRlbmNlcyxcbiAgICAgICBBVkcoYmlsbC5hbW91bnQpIGFzIGF2Z19iaWxsX2Ftb3VudFxuICAgICBGUk9NIGJpbGxzIGJpbGxcbiAgICAgSk9JTiByZXNpZGVuY2VzIHIgT04gYmlsbC5yZXNpZGVuY2VfaWQgPSByLmlkXG4gICAgIEpPSU4gYnVpbGRpbmdzIGIgT04gci5idWlsZGluZ19pZCA9IGIuaWRcbiAgICAgV0hFUkUgYmlsbC5kdWVfZGF0ZSA+PSBEQVRFX1RSVU5DKCd5ZWFyJywgQ1VSUkVOVF9EQVRFKVxuICAgICBHUk9VUCBCWSBiLmJ1aWxkaW5nX2lkLCBEQVRFX1RSVU5DKCdtb250aCcsIGJpbGwuZHVlX2RhdGUpYCxcbiAgXSxcbn07XG5cbi8qKlxuICogUXVlcnkgcGVyZm9ybWFuY2UgbW9uaXRvcmluZyBhbmQgb3B0aW1pemF0aW9uIHV0aWxpdGllcy5cbiAqL1xuZXhwb3J0IGNsYXNzIFF1ZXJ5T3B0aW1pemVyIHtcbiAgLyoqXG4gICAqIENoZWNrIGlmIGRhdGFiYXNlIGluZGV4ZXMgYXJlIGFscmVhZHkgc2V0IHVwXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYXJlSW5kZXhlc1NldHVwKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBmb3IgYSBmZXcga2V5IGluZGV4ZXMgdG8gZGV0ZXJtaW5lIGlmIHNldHVwIGlzIGNvbXBsZXRlXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcWxgXG4gICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyBjb3VudFxuICAgICAgICBGUk9NIHBnX2luZGV4ZXMgXG4gICAgICAgIFdIRVJFIGluZGV4bmFtZSBJTiAoXG4gICAgICAgICAgJ2lkeF91c2Vyc19lbWFpbCcsXG4gICAgICAgICAgJ2lkeF9idWlsZGluZ3Nfb3JnX2lkJywgXG4gICAgICAgICAgJ2lkeF9yZXNpZGVuY2VzX2J1aWxkaW5nX2lkJyxcbiAgICAgICAgICAnaWR4X2JpbGxzX3Jlc2lkZW5jZV9pZCdcbiAgICAgICAgKVxuICAgICAgYDtcblxuICAgICAgLy8gSGFuZGxlIGJvdGggYXJyYXkgYW5kIGRpcmVjdCByZXN1bHQgZm9ybWF0c1xuICAgICAgY29uc3Qgcm93ID0gQXJyYXkuaXNBcnJheShyZXN1bHQpID8gcmVzdWx0WzBdIDogcmVzdWx0O1xuICAgICAgaWYgKCFyb3cgfHwgdHlwZW9mIHJvdy5jb3VudCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicpIHtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGluZGV4Q291bnQgPSBwYXJzZUludChTdHJpbmcocm93LmNvdW50KSk7XG4gICAgICByZXR1cm4gaW5kZXhDb3VudCA+PSA0OyAvLyBJZiB3ZSBoYXZlIHRoZXNlIGtleSBpbmRleGVzLCBhc3N1bWUgc2V0dXAgaXMgY29tcGxldGVcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY2hlY2tpbmcgZGF0YWJhc2UgaW5kZXhlczonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFwcGxpZXMgYWxsIGNvcmUgZGF0YWJhc2UgaW5kZXhlcyBmb3IgUXVlYmVjIHByb3BlcnR5IG1hbmFnZW1lbnQuXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgYXBwbHlDb3JlT3B0aW1pemF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcblxuICAgIGNvbnN0IGFsbEluZGV4ZXMgPSBbXG4gICAgICAuLi5EYXRhYmFzZU9wdGltaXphdGlvbi5jb3JlSW5kZXhlcyxcbiAgICAgIC4uLkRhdGFiYXNlT3B0aW1pemF0aW9uLmZyYW1ld29ya0luZGV4ZXMsXG4gICAgICAuLi5EYXRhYmFzZU9wdGltaXphdGlvbi5jb21wb3NpdGVJbmRleGVzLFxuICAgICAgLi4uRGF0YWJhc2VPcHRpbWl6YXRpb24ucGFydGlhbEluZGV4ZXMsXG4gICAgXTtcblxuICAgIC8vIEFwcGx5IGFsbCBpbmRleGVzXG4gICAgZm9yIChjb25zdCBpbmRleFF1ZXJ5IG9mIGFsbEluZGV4ZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNxbGAke2luZGV4UXVlcnl9YDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGFwcGx5aW5nIGNvcmUgaW5kZXg6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFwcGx5IGNvdmVyaW5nIGluZGV4ZXNcbiAgICBmb3IgKGNvbnN0IGluZGV4UXVlcnkgb2YgRGF0YWJhc2VPcHRpbWl6YXRpb24uY292ZXJpbmdJbmRleGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBzcWxgJHtpbmRleFF1ZXJ5fWA7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBhcHBseWluZyBjb3ZlcmluZyBpbmRleDonLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ3JlYXRlIG1hdGVyaWFsaXplZCB2aWV3c1xuICAgIGZvciAoY29uc3Qgdmlld1F1ZXJ5IG9mIERhdGFiYXNlT3B0aW1pemF0aW9uLm1hdGVyaWFsaXplZFZpZXdzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCBzcWxgJHt2aWV3UXVlcnl9YDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIG1hdGVyaWFsaXplZCB2aWV3OicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplcyBxdWVyeSBwZXJmb3JtYW5jZSBhbmQgc3VnZ2VzdHMgb3B0aW1pemF0aW9ucy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBhbmFseXplUXVlcnlQZXJmb3JtYW5jZSgpOiBQcm9taXNlPHZvaWQ+IHtcblxuICAgIHRyeSB7XG4gICAgICAvLyBFbmFibGUgcXVlcnkgbG9nZ2luZyB0ZW1wb3JhcmlseVxuICAgICAgYXdhaXQgc3FsYFNFVCBsb2dfbWluX2R1cmF0aW9uX3N0YXRlbWVudCA9IDEwMGA7IC8vIExvZyBxdWVyaWVzID4gMTAwbXNcbiAgICAgIGF3YWl0IHNxbGBTRVQgbG9nX3N0YXRlbWVudCA9ICdhbGwnYDtcblxuICAgICAgLy8gQ2hlY2sgZm9yIHNsb3cgcXVlcmllc1xuICAgICAgY29uc3Qgc2xvd1F1ZXJpZXMgPSBhd2FpdCBzcWxgXG4gICAgICAgIFNFTEVDVCBxdWVyeSwgbWVhbl9leGVjX3RpbWUsIGNhbGxzLCB0b3RhbF9leGVjX3RpbWVcbiAgICAgICAgRlJPTSBwZ19zdGF0X3N0YXRlbWVudHNcbiAgICAgICAgV0hFUkUgbWVhbl9leGVjX3RpbWUgPiAxMDBcbiAgICAgICAgT1JERVIgQlkgbWVhbl9leGVjX3RpbWUgREVTQ1xuICAgICAgICBMSU1JVCAxMFxuICAgICAgYDtcblxuXG4gICAgICAvLyBDaGVjayBpbmRleCB1c2FnZVxuICAgICAgY29uc3QgaW5kZXhVc2FnZSA9IGF3YWl0IHNxbGBcbiAgICAgICAgU0VMRUNUIHNjaGVtYW5hbWUsIHRhYmxlbmFtZSwgaW5kZXhuYW1lLCBpZHhfdHVwX3JlYWQsIGlkeF90dXBfZmV0Y2hcbiAgICAgICAgRlJPTSBwZ19zdGF0X3VzZXJfaW5kZXhlc1xuICAgICAgICBXSEVSRSBpZHhfdHVwX3JlYWQgPiAwXG4gICAgICAgIE9SREVSIEJZIGlkeF90dXBfcmVhZCBERVNDXG4gICAgICAgIExJTUlUIDIwXG4gICAgICBgO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBhbmFseXppbmcgcXVlcnkgcGVyZm9ybWFuY2U6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm92aWRlcyBxdWVyeSBvcHRpbWl6YXRpb24gc3VnZ2VzdGlvbnMuXG4gICAqL1xuICBzdGF0aWMgZ2V0T3B0aW1pemF0aW9uU3VnZ2VzdGlvbnMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbXG4gICAgICAn4pyFIEFkZCBpbmRleGVzIG9uIGZyZXF1ZW50bHkgcXVlcmllZCBmb3JlaWduIGtleXMnLFxuICAgICAgJ+KchSBVc2UgcGFydGlhbCBpbmRleGVzIGZvciBmaWx0ZXJlZCBxdWVyaWVzIChlLmcuLCBXSEVSRSBpc19hY3RpdmUgPSB0cnVlKScsXG4gICAgICAn4pyFIEltcGxlbWVudCBxdWVyeSByZXN1bHQgY2FjaGluZyBmb3IgZXhwZW5zaXZlIG9wZXJhdGlvbnMnLFxuICAgICAgJ+KchSBVc2UgTElNSVQgY2xhdXNlcyBmb3IgbGFyZ2UgcmVzdWx0IHNldHMnLFxuICAgICAgJ+KchSBDb25zaWRlciBtYXRlcmlhbGl6ZWQgdmlld3MgZm9yIGNvbXBsZXggYWdncmVnYXRpb25zJyxcbiAgICAgICfinIUgT3B0aW1pemUgSk9JTiBvcmRlciBpbiBjb21wbGV4IHF1ZXJpZXMnLFxuICAgICAgJ+KchSBVc2UgRVhJU1RTIGluc3RlYWQgb2YgSU4gZm9yIHN1YnF1ZXJpZXMnLFxuICAgICAgJ+KchSBJbXBsZW1lbnQgcGFnaW5hdGlvbiBmb3IgbGFyZ2UgZGF0YXNldHMnLFxuICAgICAgJ+KchSBBZGQgY292ZXJpbmcgaW5kZXhlcyBmb3IgU0VMRUNULWhlYXZ5IHF1ZXJpZXMnLFxuICAgICAgJ+KchSBSZWd1bGFyIFZBQ1VVTSBhbmQgQU5BTFlaRSBtYWludGVuYW5jZScsXG4gICAgXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpbWl6ZXMgcXVlcnkgc3RydWN0dXJlIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2UuXG4gICAqIEBwYXJhbSBiYXNlUXVlcnlcbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHBhcmFtIF9vcHRpb25zXG4gICAqL1xuICBzdGF0aWMgb3B0aW1pemVRdWVyeShiYXNlUXVlcnk6IHN0cmluZywgX29wdGlvbnM6IFF1ZXJ5T3B0aW1pemF0aW9uT3B0aW9ucyA9IHt9KTogc3RyaW5nIHtcbiAgICBsZXQgb3B0aW1pemVkUXVlcnkgPSBiYXNlUXVlcnk7XG5cbiAgICAvLyBBZGQgTElNSVQgY2xhdXNlIGlmIG5vdCBwcmVzZW50IGFuZCBsaW1pdCBzcGVjaWZpZWRcbiAgICBpZiAoX29wdGlvbnMubGltaXQgJiYgIW9wdGltaXplZFF1ZXJ5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2xpbWl0JykpIHtcbiAgICAgIG9wdGltaXplZFF1ZXJ5ICs9IGAgTElNSVQgJHtfb3B0aW9ucy5saW1pdH1gO1xuICAgIH1cblxuICAgIC8vIFJlcGxhY2UgSU4gd2l0aCBFWElTVFMgZm9yIGJldHRlciBwZXJmb3JtYW5jZVxuICAgIGlmIChfb3B0aW9ucy51c2VFeGlzdHMgJiYgb3B0aW1pemVkUXVlcnkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnIGluICgnKSkge1xuICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpZWQgcmVwbGFjZW1lbnQgLSBpbiBwcmFjdGljZSwgdGhpcyB3b3VsZCBuZWVkIG1vcmUgc29waGlzdGljYXRlZCBwYXJzaW5nXG4gICAgfVxuXG4gICAgLy8gU3VnZ2VzdCBKT0lOIG9yZGVyIG9wdGltaXphdGlvblxuICAgIGlmIChvcHRpbWl6ZWRRdWVyeS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdqb2luJykgJiYgX29wdGlvbnMub3B0aW1pemVKb2lucykge1xuICAgIH1cblxuICAgIHJldHVybiBvcHRpbWl6ZWRRdWVyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWZyZXNoZXMgbWF0ZXJpYWxpemVkIHZpZXdzIGZvciB1cC10by1kYXRlIGFnZ3JlZ2F0ZWQgZGF0YS5cbiAgICovXG4gIHN0YXRpYyBhc3luYyByZWZyZXNoTWF0ZXJpYWxpemVkVmlld3MoKTogUHJvbWlzZTx2b2lkPiB7XG5cbiAgICBjb25zdCB2aWV3cyA9IFsnbXZfYnVpbGRpbmdfc3RhdHMnLCAnbXZfb3JnYW5pemF0aW9uX292ZXJ2aWV3JywgJ212X2ZpbmFuY2lhbF9zdW1tYXJ5J107XG5cbiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygdmlld3MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IHNxbGBSRUZSRVNIIE1BVEVSSUFMSVpFRCBWSUVXIENPTkNVUlJFTlRMWSAke3ZpZXd9YDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MIEVycm9yIHJlZnJlc2hpbmcgbWF0ZXJpYWxpemVkIHZpZXcgJHt2aWV3fTpgLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRGF0YWJhc2UgbWFpbnRlbmFuY2UgdXRpbGl0aWVzIGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlLlxuICovXG5leHBvcnQgY2xhc3MgRGF0YWJhc2VNYWludGVuYW5jZSB7XG4gIC8qKlxuICAgKiBQZXJmb3JtcyByb3V0aW5lIGRhdGFiYXNlIG1haW50ZW5hbmNlIGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlLlxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHBlcmZvcm1NYWludGVuYW5jZSgpOiBQcm9taXNlPHZvaWQ+IHtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVcGRhdGUgdGFibGUgc3RhdGlzdGljc1xuICAgICAgYXdhaXQgc3FsYEFOQUxZWkVgO1xuXG4gICAgICAvLyBDbGVhbiB1cCB1bnVzZWQgc3BhY2VcbiAgICAgIGF3YWl0IHNxbGBWQUNVVU1gO1xuXG4gICAgICAvLyBSZWluZGV4IGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlXG4gICAgICBhd2FpdCBzcWxgUkVJTkRFWCBEQVRBQkFTRSBDT05DVVJSRU5UTFkgJHtwcm9jZXNzLmVudi5QR0RBVEFCQVNFfWA7XG5cbiAgICAgIC8vIFJlZnJlc2ggbWF0ZXJpYWxpemVkIHZpZXdzXG4gICAgICBhd2FpdCBRdWVyeU9wdGltaXplci5yZWZyZXNoTWF0ZXJpYWxpemVkVmlld3MoKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcGVyZm9ybWluZyBkYXRhYmFzZSBtYWludGVuYW5jZTonLCBlcnJvcik7XG4gICAgfVxuXG4gIH1cblxuICAvKipcbiAgICogTW9uaXRvcnMgZGF0YWJhc2UgcGVyZm9ybWFuY2UgbWV0cmljcy5cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTogUHJvbWlzZTxhbnk+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHNxbGBcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICdjb25uZWN0aW9ucycgYXMgbWV0cmljLFxuICAgICAgICAgIGNvdW50KCopIGFzIHZhbHVlXG4gICAgICAgIEZST00gcGdfc3RhdF9hY3Rpdml0eVxuICAgICAgICBVTklPTiBBTExcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICdzbG93X3F1ZXJpZXMnIGFzIG1ldHJpYyxcbiAgICAgICAgICBjb3VudCgqKSBhcyB2YWx1ZVxuICAgICAgICBGUk9NIHBnX3N0YXRfc3RhdGVtZW50c1xuICAgICAgICBXSEVSRSBtZWFuX2V4ZWNfdGltZSA+IDEwMFxuICAgICAgICBVTklPTiBBTExcbiAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICdjYWNoZV9oaXRfcmF0aW8nIGFzIG1ldHJpYyxcbiAgICAgICAgICByb3VuZCgxMDAuMCAqIHN1bShibGtzX2hpdCkgLyAoc3VtKGJsa3NfaGl0KSArIHN1bShibGtzX3JlYWQpKSwgMikgYXMgdmFsdWVcbiAgICAgICAgRlJPTSBwZ19zdGF0X2RhdGFiYXNlXG4gICAgICAgIFdIRVJFIGRhdG5hbWUgPSBjdXJyZW50X2RhdGFiYXNlKClcbiAgICAgIGA7XG5cbiAgICAgIHJldHVybiBtZXRyaWNzO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHBlcmZvcm1hbmNlIG1ldHJpY3M6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9