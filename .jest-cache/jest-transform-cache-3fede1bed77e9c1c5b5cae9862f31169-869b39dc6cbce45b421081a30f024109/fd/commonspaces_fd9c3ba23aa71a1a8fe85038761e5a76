d50a40988a6cb02b1b03899136b95449
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerCommonSpacesRoutes = registerCommonSpacesRoutes;
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
const auth_1 = require("../auth");
const zod_1 = require("zod");
const schema = __importStar(require("@shared/schema"));
const { commonSpaces, bookings, userBookingRestrictions, userTimeLimits, buildings, users, userResidences, userOrganizations, } = schema;
// Validation schemas
const commonSpaceFilterSchema = zod_1.z.object({
    building_id: zod_1.z.string().uuid().optional(),
});
const bookingFilterSchema = zod_1.z.object({
    start_date: zod_1.z.string().datetime().optional(),
    end_date: zod_1.z.string().datetime().optional(),
});
// Calendar-specific schemas
const calendarQuerySchema = zod_1.z.object({
    start_date: zod_1.z.string().datetime(),
    end_date: zod_1.z.string().datetime(),
    view: zod_1.z.enum(['month', 'week', 'day']).optional().default('month'),
});
const buildingCalendarSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
});
const createBookingSchema = zod_1.z.object({
    start_time: zod_1.z.string().datetime(),
    end_time: zod_1.z.string().datetime(),
});
const createRestrictionSchema = zod_1.z.object({
    common_space_id: zod_1.z.string().uuid(),
    is_blocked: zod_1.z.boolean(),
    reason: zod_1.z.string().optional(),
});
const createCommonSpaceSchema = zod_1.z.object({
    name: zod_1.z.string().min(1, 'Name is required').max(100, 'Name too long'),
    description: zod_1.z.string().optional(),
    building_id: zod_1.z.string().uuid('Building ID must be a valid UUID'),
    is_reservable: zod_1.z.boolean().default(true),
    capacity: zod_1.z.number().int().min(1).max(200).optional(),
    opening_hours: zod_1.z
        .object({
        start: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
        end: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
    })
        .optional(),
    weekly_hours: zod_1.z.record(zod_1.z.string(), zod_1.z.object({
        start: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
        end: zod_1.z.string().regex(/^\d{2}:\d{2}$/, 'Invalid time format'),
    })).optional(),
    available_days: zod_1.z
        .array(zod_1.z.enum(['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday']))
        .optional(),
});
const setTimeLimitSchema = zod_1.z.object({
    user_id: zod_1.z.string().uuid(),
    common_space_id: zod_1.z.string().uuid().optional(), // null means applies to all spaces
    limit_type: zod_1.z.enum(['monthly', 'yearly']),
    limit_hours: zod_1.z.number().int().min(1).max(8760), // Max 1 year worth of hours
});
const spaceIdSchema = zod_1.z.object({
    spaceId: zod_1.z.string().uuid(),
});
const bookingIdSchema = zod_1.z.object({
    bookingId: zod_1.z.string().uuid(),
});
const userIdSchema = zod_1.z.object({
    userId: zod_1.z.string().uuid(),
});
/**
 * Helper function to get accessible building IDs for a user based on their role.
 * @param user
 */
async function getAccessibleBuildingIds(user) {
    // Admin users have access to all buildings
    if (user.role === 'admin') {
        const allBuildings = await db_1.db
            .select({ buildingId: buildings.id })
            .from(buildings)
            .where((0, drizzle_orm_1.eq)(buildings.isActive, true));
        return allBuildings.map((b) => b.buildingId);
    }
    // Check if user belongs to Koveo organization (special global access)
    const userOrgs = await db_1.db
        .select({
        organizationId: schema.organizations.id,
        organizationName: schema.organizations.name,
        canAccessAllOrganizations: userOrganizations.canAccessAllOrganizations,
    })
        .from(schema.organizations)
        .innerJoin(userOrganizations, (0, drizzle_orm_1.eq)(userOrganizations.organizationId, schema.organizations.id))
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(userOrganizations.isActive, true)));
    const hasGlobalAccess = userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
    if (hasGlobalAccess) {
        const allBuildings = await db_1.db
            .select({ buildingId: buildings.id })
            .from(buildings)
            .where((0, drizzle_orm_1.eq)(buildings.isActive, true));
        return allBuildings.map((b) => b.buildingId);
    }
    // Regular users and managers: Get buildings from their organizations
    if (user.role === 'manager' || user.role === 'demo_manager') {
        if (userOrgs.length > 0) {
            const orgIds = userOrgs.map((uo) => uo.organizationId);
            const orgBuildings = await db_1.db
                .select({ buildingId: buildings.id })
                .from(buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(buildings.isActive, true)));
            return orgBuildings.map((b) => b.buildingId);
        }
    }
    // All users can also access buildings where they have residences
    const userBuildingIds = await db_1.db
        .select({ buildingId: schema.residences.buildingId })
        .from(userResidences)
        .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(userResidences.residenceId, schema.residences.id))
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userResidences.userId, user.id), (0, drizzle_orm_1.eq)(userResidences.isActive, true)));
    return userBuildingIds.map((b) => b.buildingId);
}
/**
 * Helper function to calculate user's total booking hours for a time period.
 * @param userId
 * @param commonSpaceId
 * @param limitType
 */
async function getUserBookingHours(userId, commonSpaceId, limitType) {
    const now = new Date();
    let startDate;
    if (limitType === 'monthly') {
        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
    }
    else {
        startDate = new Date(now.getFullYear(), 0, 1);
    }
    const conditions = [
        (0, drizzle_orm_1.eq)(bookings.userId, userId),
        (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
        (0, drizzle_orm_1.gte)(bookings.startTime, startDate),
    ];
    if (commonSpaceId) {
        conditions.push((0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaceId));
    }
    const userBookings = await db_1.db
        .select({
        totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
    })
        .from(bookings)
        .where((0, drizzle_orm_1.and)(...conditions));
    return userBookings[0]?.totalHours || 0;
}
/**
 * Helper function to check if user has exceeded their booking time limit.
 * @param userId
 * @param commonSpaceId
 * @param newBookingHours
 */
async function checkUserTimeLimit(userId, commonSpaceId, newBookingHours) {
    // Get user's time limits for this space (specific or global)
    const timeLimits = await db_1.db
        .select()
        .from(userTimeLimits)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, commonSpaceId), (0, drizzle_orm_1.sql) `${userTimeLimits.commonSpaceId} IS NULL`)))
        .orderBy(userTimeLimits.commonSpaceId); // Specific limits come first (nulls last)
    if (timeLimits.length === 0) {
        return { withinLimit: true }; // No limits set
    }
    // Use the most specific limit (space-specific over global)
    const activeLimit = timeLimits[0];
    const currentHours = await getUserBookingHours(userId, activeLimit.commonSpaceId, activeLimit.limitType);
    const totalAfterBooking = currentHours + newBookingHours;
    const remainingHours = Math.max(0, activeLimit.limitHours - currentHours);
    if (totalAfterBooking > activeLimit.limitHours) {
        const limitPeriod = activeLimit.limitType === 'monthly' ? 'ce mois' : 'cette annÃ©e';
        return {
            withinLimit: false,
            message: `Limite de temps dÃ©passÃ©e. Vous avez utilisÃ© ${Math.round(currentHours)}h sur ${activeLimit.limitHours}h autorisÃ©es pour ${limitPeriod}. Il vous reste ${Math.round(remainingHours)}h disponibles.`,
            remainingHours,
        };
    }
    return { withinLimit: true, remainingHours };
}
/**
 * Helper function to check if a time slot overlaps with existing bookings.
 * @param commonSpaceId
 * @param startTime
 * @param endTime
 * @param excludeBookingId
 */
async function hasOverlappingBookings(commonSpaceId, startTime, endTime, excludeBookingId) {
    const conditions = [
        (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaceId),
        (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
        (0, drizzle_orm_1.or)(
        // New booking starts during existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.startTime, startTime), (0, drizzle_orm_1.lte)(bookings.startTime, endTime)), 
        // New booking ends during existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.endTime, startTime), (0, drizzle_orm_1.lte)(bookings.endTime, endTime)), 
        // New booking completely contains existing booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.lte)(bookings.startTime, startTime), (0, drizzle_orm_1.gte)(bookings.endTime, endTime)), 
        // Existing booking completely contains new booking
        (0, drizzle_orm_1.and)((0, drizzle_orm_1.gte)(bookings.startTime, startTime), (0, drizzle_orm_1.lte)(bookings.endTime, endTime))),
    ];
    if (excludeBookingId) {
        conditions.push((0, drizzle_orm_1.sql) `${bookings.id} != ${excludeBookingId}`);
    }
    const overlapping = await db_1.db
        .select({ id: bookings.id })
        .from(bookings)
        .where((0, drizzle_orm_1.and)(...conditions))
        .limit(1);
    return overlapping.length > 0;
}
/**
 * Helper function to check if user is blocked from booking a space.
 * @param userId
 * @param commonSpaceId
 */
async function isUserBlocked(userId, commonSpaceId) {
    const restriction = await db_1.db
        .select({ isBlocked: userBookingRestrictions.isBlocked })
        .from(userBookingRestrictions)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userBookingRestrictions.userId, userId), (0, drizzle_orm_1.eq)(userBookingRestrictions.commonSpaceId, commonSpaceId)))
        .limit(1);
    return restriction.length > 0 && restriction[0].isBlocked;
}
/**
 * Helper function to check if booking time is within opening hours.
 * @param startTime
 * @param endTime
 * @param openingHours
 */
function isWithinOpeningHours(startTime, endTime, openingHours) {
    if (!openingHours || openingHours.length === 0) {
        return true; // No restrictions if no opening hours defined
    }
    const startDay = startTime.toLocaleDateString('en-US', { weekday: 'long' });
    const endDay = endTime.toLocaleDateString('en-US', { weekday: 'long' });
    // For simplicity, require booking to be within same day
    if (startDay !== endDay) {
        return false;
    }
    const dayHours = openingHours.find((oh) => oh.day === startDay);
    if (!dayHours) {
        return false; // No hours defined for this day
    }
    const startTimeStr = startTime.toTimeString().slice(0, 5); // HH:MM format
    const endTimeStr = endTime.toTimeString().slice(0, 5);
    return startTimeStr >= dayHours.open && endTimeStr <= dayHours.close;
}
/**
 * Registers all common spaces API endpoints.
 * @param app
 */
function registerCommonSpacesRoutes(app) {
    /**
     * GET /api/common-spaces - Retrieve common spaces for accessible buildings.
     */
    app.get('/api/common-spaces', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate query parameters
            const queryValidation = commonSpaceFilterSchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { building_id } = queryValidation.data;
            // Get accessible building IDs
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (accessibleBuildingIds.length === 0) {
                return res.json([]);
            }
            // Build conditions
            const conditions = [(0, drizzle_orm_1.eq)(buildings.isActive, true)];
            if (building_id) {
                if (!accessibleBuildingIds.includes(building_id)) {
                    return res.status(403).json({
                        message: 'Access denied to this building',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
                conditions.push((0, drizzle_orm_1.eq)(commonSpaces.buildingId, building_id));
            }
            else {
                conditions.push((0, drizzle_orm_1.inArray)(commonSpaces.buildingId, accessibleBuildingIds));
            }
            const spaces = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                description: commonSpaces.description,
                buildingId: commonSpaces.buildingId,
                buildingName: buildings.name,
                isReservable: commonSpaces.isReservable,
                capacity: commonSpaces.capacity,
                contactPersonId: commonSpaces.contactPersonId,
                contactPersonName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                openingHours: commonSpaces.openingHours,
                bookingRules: commonSpaces.bookingRules,
                createdAt: commonSpaces.createdAt,
                updatedAt: commonSpaces.updatedAt,
            })
                .from(commonSpaces)
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .leftJoin(users, (0, drizzle_orm_1.eq)(commonSpaces.contactPersonId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(buildings.name, commonSpaces.name);
            res.json(spaces);
        }
        catch (error) {
            res.status(500).json({
                message: 'Failed to fetch common spaces',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/:spaceId/bookings - Get bookings for a specific space.
     */
    app.get('/api/common-spaces/:spaceId/bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const queryValidation = bookingFilterSchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_date, end_date } = queryValidation.data;
            // Check if user has access to this space
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Build query conditions
            const conditions = [(0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId)];
            if (start_date) {
                conditions.push((0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)));
            }
            if (end_date) {
                conditions.push((0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date)));
            }
            const spaceBookings = await db_1.db
                .select({
                id: bookings.id,
                commonSpaceId: bookings.commonSpaceId,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                createdAt: bookings.createdAt,
                updatedAt: bookings.updatedAt,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(bookings.startTime);
            res.json(spaceBookings);
        }
        catch (error) {
            console.error('âŒ Error fetching bookings:', error);
            res.status(500).json({
                message: 'Failed to fetch bookings',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/:spaceId/bookings - Create a new booking.
     */
    app.post('/api/common-spaces/:spaceId/bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters and body
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            console.log('ðŸ” Booking request body:', req.body);
            const bodyValidation = createBookingSchema.safeParse(req.body);
            if (!bodyValidation.success) {
                console.log('âŒ Validation failed:', bodyValidation.error.issues);
                return res.status(400).json({
                    message: 'Invalid booking data',
                    errors: bodyValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_time, end_time } = bodyValidation.data;
            const startTime = new Date(start_time);
            const endTime = new Date(end_time);
            // Validate time range
            if (startTime >= endTime) {
                return res.status(400).json({
                    message: 'Start time must be before end time',
                    code: 'INVALID_TIME_RANGE',
                });
            }
            // Allow bookings for today and future dates (with 5-minute buffer for current time)
            const now = new Date();
            const fiveMinutesAgo = new Date(now.getTime() - 5 * 60 * 1000);
            if (startTime < fiveMinutesAgo) {
                return res.status(400).json({
                    message: 'Cannot book in the past',
                    code: 'INVALID_TIME_RANGE',
                });
            }
            // Get common space details
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                buildingId: commonSpaces.buildingId,
                isReservable: commonSpaces.isReservable,
                openingHours: commonSpaces.openingHours,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const commonSpace = space[0];
            // Check if space is reservable
            if (!commonSpace.isReservable) {
                return res.status(400).json({
                    message: 'This common space is not reservable',
                    code: 'NOT_RESERVABLE',
                });
            }
            // Check user access to building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(commonSpace.buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Check if user is blocked
            const blocked = await isUserBlocked(user.id, spaceId);
            if (blocked) {
                return res.status(403).json({
                    message: 'You are blocked from booking this space',
                    code: 'USER_BLOCKED',
                });
            }
            // Check opening hours
            if (commonSpace.openingHours &&
                !isWithinOpeningHours(startTime, endTime, commonSpace.openingHours)) {
                return res.status(400).json({
                    message: 'Booking time is outside opening hours',
                    code: 'OUTSIDE_OPENING_HOURS',
                });
            }
            // Check for overlapping bookings
            const hasOverlap = await hasOverlappingBookings(spaceId, startTime, endTime);
            if (hasOverlap) {
                return res.status(409).json({
                    message: 'Time slot is already booked',
                    code: 'TIME_CONFLICT',
                });
            }
            // Check user's time limits
            const bookingDurationHours = (endTime.getTime() - startTime.getTime()) / (1000 * 60 * 60);
            const timeLimitCheck = await checkUserTimeLimit(user.id, spaceId, bookingDurationHours);
            if (!timeLimitCheck.withinLimit) {
                return res.status(403).json({
                    message: timeLimitCheck.message,
                    code: 'TIME_LIMIT_EXCEEDED',
                    remainingHours: timeLimitCheck.remainingHours,
                });
            }
            // Create booking
            const newBooking = await db_1.db
                .insert(bookings)
                .values({
                commonSpaceId: spaceId,
                userId: user.id,
                startTime,
                endTime,
                status: 'confirmed',
            })
                .returning();
            res.status(201).json({
                message: 'Booking created successfully',
                booking: newBooking[0],
            });
        }
        catch (error) {
            console.error('âŒ Error creating booking:', error);
            res.status(500).json({
                message: 'Failed to create booking',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/calendar/:spaceId - Get calendar data for a specific space.
     */
    app.get('/api/common-spaces/calendar/:spaceId', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid query parameters',
                    errors: queryValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            const { start_date, end_date, view } = queryValidation.data;
            // Get space details and check access
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                buildingId: commonSpaces.buildingId,
                isReservable: commonSpaces.isReservable,
                openingHours: commonSpaces.openingHours,
                capacity: commonSpaces.capacity,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const commonSpace = space[0];
            // Check user access to building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(commonSpace.buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get bookings for the specified date range
            const conditions = [
                (0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId),
                (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'),
                (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)),
                (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date)),
            ];
            const spaceBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                userRole: users.role,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)(...conditions))
                .orderBy(bookings.startTime);
            // Determine permissions
            const canViewDetails = ['admin', 'manager'].includes(user.role);
            // Transform bookings to calendar events
            const events = spaceBookings.map((booking) => ({
                id: booking.id,
                startTime: booking.startTime.toISOString(),
                endTime: booking.endTime.toISOString(),
                status: booking.status,
                userId: booking.userId,
                userName: canViewDetails || booking.userId === user.id ? booking.userName : 'DÃ©jÃ  RÃ©servÃ©',
                userEmail: canViewDetails || booking.userId === user.id ? booking.userEmail : null,
                isOwnBooking: booking.userId === user.id,
                spaceId: spaceId,
                spaceName: commonSpace.name,
                userRole: booking.userRole,
            }));
            // Calculate summary statistics
            const totalBookings = events.length;
            const totalHours = events.reduce((sum, event) => {
                const duration = (new Date(event.endTime).getTime() - new Date(event.startTime).getTime()) /
                    (1000 * 60 * 60);
                return sum + duration;
            }, 0);
            const uniqueUsers = new Set(events.map((e) => e.userId)).size;
            // Build calendar response
            const calendarData = {
                space: {
                    id: commonSpace.id,
                    name: commonSpace.name,
                    isReservable: commonSpace.isReservable,
                    openingHours: commonSpace.openingHours,
                },
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    events,
                },
                permissions: {
                    canViewDetails,
                    canCreateBookings: commonSpace.isReservable && !(await isUserBlocked(user.id, spaceId)),
                },
                summary: {
                    totalBookings,
                    totalHours: Math.round(totalHours * 10) / 10,
                    uniqueUsers,
                },
            };
            res.json(calendarData);
        }
        catch (error) {
            console.error('âŒ Error fetching calendar data:', error);
            res.status(500).json({
                message: 'Failed to fetch calendar data',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/my-bookings - Get current user's bookings.
     */
    app.get('/api/common-spaces/my-bookings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            // Get all user's confirmed bookings with space and building info
            const userBookings = await db_1.db
                .select({
                id: bookings.id,
                commonSpaceId: bookings.commonSpaceId,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                createdAt: bookings.createdAt,
                commonSpaceName: commonSpaces.name,
                buildingName: buildings.name,
                buildingAddress: buildings.address,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.userId, user.id), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed')))
                .orderBy((0, drizzle_orm_1.desc)(bookings.startTime));
            res.json(userBookings);
        }
        catch (error) {
            console.error('âŒ Error fetching user bookings:', error);
            res.status(500).json({
                message: 'Failed to fetch user bookings',
                details: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * DELETE /api/common-spaces/bookings/:bookingId - Cancel a booking.
     */
    app.delete('/api/common-spaces/bookings/:bookingId', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = bookingIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid booking ID',
                    errors: paramValidation.error.issues,
                });
            }
            const { bookingId } = paramValidation.data;
            // Get booking details
            const booking = await db_1.db
                .select({
                id: bookings.id,
                userId: bookings.userId,
                commonSpaceId: bookings.commonSpaceId,
                buildingId: commonSpaces.buildingId,
                status: bookings.status,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .where((0, drizzle_orm_1.eq)(bookings.id, bookingId))
                .limit(1);
            if (booking.length === 0) {
                return res.status(404).json({
                    message: 'Booking not found',
                    code: 'NOT_FOUND',
                });
            }
            const bookingDetails = booking[0];
            // Check permissions: users can cancel their own bookings, managers can cancel any in their buildings
            let canCancel = false;
            if (bookingDetails.userId === user.id) {
                canCancel = true; // Users can always cancel their own bookings
            }
            else if (['admin', 'manager'].includes(user.role)) {
                // Managers can cancel bookings in buildings they have access to
                const accessibleBuildingIds = await getAccessibleBuildingIds(user);
                canCancel = accessibleBuildingIds.includes(bookingDetails.buildingId);
            }
            if (!canCancel) {
                return res.status(403).json({
                    message: 'Can only cancel your own bookings',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Update booking status to cancelled
            await db_1.db
                .update(bookings)
                .set({
                status: 'cancelled',
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(bookings.id, bookingId));
            res.json({
                message: 'Booking cancelled successfully',
            });
        }
        catch (error) {
            console.error('âŒ Error cancelling booking:', error);
            res.status(500).json({
                message: 'Failed to cancel booking',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/:spaceId/stats - Get usage statistics (Manager/Admin only).
     */
    app.get('/api/common-spaces/:spaceId/stats', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            const { spaceId } = paramValidation.data;
            // Check access to space
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
                name: commonSpaces.name,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Calculate stats for last year
            const oneYearAgo = new Date();
            oneYearAgo.setFullYear(oneYearAgo.getFullYear() - 1);
            const stats = await db_1.db
                .select({
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
                totalBookings: (0, drizzle_orm_1.sql) `COUNT(${bookings.id})`,
            })
                .from(bookings)
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, oneYearAgo)))
                .groupBy(bookings.userId, users.firstName, users.lastName, users.email)
                .orderBy((0, drizzle_orm_1.desc)((0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`));
            const totalStats = await db_1.db
                .select({
                totalBookings: (0, drizzle_orm_1.sql) `COUNT(${bookings.id})`,
                totalHours: (0, drizzle_orm_1.sql) `EXTRACT(EPOCH FROM SUM(${bookings.endTime} - ${bookings.startTime})) / 3600`,
                uniqueUsers: (0, drizzle_orm_1.sql) `COUNT(DISTINCT ${bookings.userId})`,
            })
                .from(bookings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.commonSpaceId, spaceId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, oneYearAgo)));
            res.json({
                spaceName: space[0].name,
                period: 'Last 12 months',
                summary: totalStats[0],
                userStats: stats,
            });
        }
        catch (error) {
            console.error('âŒ Error fetching space statistics:', error);
            res.status(500).json({
                message: 'Failed to fetch space statistics',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/users/:userId/restrictions - Block/unblock user (Manager/Admin only).
     */
    app.post('/api/common-spaces/users/:userId/restrictions', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters and body
            const paramValidation = userIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid user ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const bodyValidation = createRestrictionSchema.safeParse(req.body);
            if (!bodyValidation.success) {
                return res.status(400).json({
                    message: 'Invalid restriction data',
                    errors: bodyValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { userId } = paramValidation.data;
            const { common_space_id, is_blocked, reason } = bodyValidation.data;
            // Check if target user exists
            const targetUser = await db_1.db
                .select({ id: users.id })
                .from(users)
                .where((0, drizzle_orm_1.eq)(users.id, userId))
                .limit(1);
            if (targetUser.length === 0) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'NOT_FOUND',
                });
            }
            // Check if common space exists and user has access
            const space = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, common_space_id))
                .limit(1);
            if (space.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this common space',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Check if restriction already exists
            const existingRestriction = await db_1.db
                .select({ id: userBookingRestrictions.id })
                .from(userBookingRestrictions)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userBookingRestrictions.userId, userId), (0, drizzle_orm_1.eq)(userBookingRestrictions.commonSpaceId, common_space_id)))
                .limit(1);
            if (existingRestriction.length > 0) {
                // Update existing restriction
                await db_1.db
                    .update(userBookingRestrictions)
                    .set({
                    isBlocked: is_blocked,
                    reason,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.eq)(userBookingRestrictions.id, existingRestriction[0].id));
            }
            else {
                // Create new restriction
                await db_1.db.insert(userBookingRestrictions).values({
                    userId,
                    commonSpaceId: common_space_id,
                    isBlocked: is_blocked,
                    reason,
                });
            }
            res.json({
                message: `User ${is_blocked ? 'blocked from' : 'unblocked from'} booking this space`,
            });
        }
        catch (error) {
            console.error('âŒ Error managing user restriction:', error);
            res.status(500).json({
                message: 'Failed to manage user restriction',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces - Create a new common space (Manager/Admin only).
     */
    app.post('/api/common-spaces', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate request body
            const validationResult = createCommonSpaceSchema.safeParse(req.body);
            if (!validationResult.success) {
                return res.status(400).json({
                    message: 'Invalid request data',
                    errors: validationResult.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { name, description, building_id, is_reservable, capacity, opening_hours, weekly_hours, available_days } = validationResult.data;
            // Check if user has access to this building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(building_id)) {
                return res.status(403).json({
                    message: 'Access denied. You can only create spaces in buildings you manage.',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Verify building exists and is active
            const building = await db_1.db
                .select({ id: buildings.id, name: buildings.name })
                .from(buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(buildings.id, building_id), (0, drizzle_orm_1.eq)(buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    message: 'Building not found or inactive',
                    code: 'BUILDING_NOT_FOUND',
                });
            }
            // Check if a space with the same name already exists in this building
            const existingSpace = await db_1.db
                .select({ id: commonSpaces.id })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(commonSpaces.name, name), (0, drizzle_orm_1.eq)(commonSpaces.buildingId, building_id)))
                .limit(1);
            if (existingSpace.length > 0) {
                return res.status(409).json({
                    message: 'A common space with this name already exists in this building',
                    code: 'DUPLICATE_NAME',
                });
            }
            // Create the new common space
            const newSpace = await db_1.db
                .insert(commonSpaces)
                .values({
                name,
                description: description || null,
                buildingId: building_id,
                isReservable: is_reservable,
                capacity: capacity || null,
                openingHours: opening_hours ? [{ day: 'all', open: opening_hours.start, close: opening_hours.end }] :
                    weekly_hours ? Object.entries(weekly_hours).map(([day, hours]) => ({
                        day,
                        open: hours.start,
                        close: hours.end
                    })) : null,
                availableDays: available_days || null,
            })
                .returning();
            console.log(`âœ… Created new common space: ${name} in building ${building[0].name}`);
            res.status(201).json({
                message: 'Common space created successfully',
                space: {
                    id: newSpace[0].id,
                    name: newSpace[0].name,
                    description: newSpace[0].description,
                    buildingId: newSpace[0].buildingId,
                    buildingName: building[0].name,
                    isReservable: newSpace[0].isReservable,
                    capacity: newSpace[0].capacity,
                    openingHours: newSpace[0].openingHours,
                    createdAt: newSpace[0].createdAt,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error creating common space:', error);
            res.status(500).json({
                message: 'Failed to create common space',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * PUT /api/common-spaces/:spaceId - Update a common space (Manager/Admin only).
     */
    app.put('/api/common-spaces/:spaceId', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = spaceIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid space ID',
                    errors: paramValidation.error.issues,
                });
            }
            // Validate request body
            const validationResult = createCommonSpaceSchema.safeParse(req.body);
            if (!validationResult.success) {
                return res.status(400).json({
                    message: 'Invalid request data',
                    errors: validationResult.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { spaceId } = paramValidation.data;
            const { name, description, building_id, is_reservable, capacity, opening_hours, weekly_hours, available_days } = validationResult.data;
            // Check if space exists and user has access
            const existingSpace = await db_1.db
                .select({
                id: commonSpaces.id,
                buildingId: commonSpaces.buildingId,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .limit(1);
            if (existingSpace.length === 0) {
                return res.status(404).json({
                    message: 'Common space not found',
                    code: 'NOT_FOUND',
                });
            }
            // Check if user has access to this building
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(existingSpace[0].buildingId)) {
                return res.status(403).json({
                    message: 'Access denied. You can only update spaces in buildings you manage.',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Update the common space
            const updatedSpace = await db_1.db
                .update(commonSpaces)
                .set({
                name,
                description: description || null,
                buildingId: building_id,
                isReservable: is_reservable,
                capacity: capacity || null,
                openingHours: opening_hours ? [{ day: 'all', open: opening_hours.start, close: opening_hours.end }] :
                    weekly_hours ? Object.entries(weekly_hours).map(([day, hours]) => ({
                        day,
                        open: hours.start,
                        close: hours.end
                    })) : null,
                availableDays: available_days || null,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(commonSpaces.id, spaceId))
                .returning();
            console.log(`âœ… Updated common space: ${name}`);
            res.json({
                message: 'Common space updated successfully',
                space: {
                    id: updatedSpace[0].id,
                    name: updatedSpace[0].name,
                    description: updatedSpace[0].description,
                    buildingId: updatedSpace[0].buildingId,
                    isReservable: updatedSpace[0].isReservable,
                    capacity: updatedSpace[0].capacity,
                    openingHours: updatedSpace[0].openingHours,
                    availableDays: updatedSpace[0].availableDays,
                    updatedAt: updatedSpace[0].updatedAt,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error updating common space:', error);
            res.status(500).json({
                message: 'Failed to update common space',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * POST /api/common-spaces/users/:userId/time-limits - Set user time limits (Manager/Admin only).
     */
    app.post('/api/common-spaces/users/:userId/time-limits', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate parameters
            const paramValidation = userIdSchema.safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid user ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            // Validate request body
            const validationResult = setTimeLimitSchema.safeParse(req.body);
            if (!validationResult.success) {
                return res.status(400).json({
                    message: 'Invalid time limit data',
                    errors: validationResult.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { userId } = paramValidation.data;
            const { user_id, common_space_id, limit_type, limit_hours } = validationResult.data;
            // Verify user exists
            const targetUser = await db_1.db
                .select({ id: users.id, firstName: users.firstName, lastName: users.lastName })
                .from(users)
                .where((0, drizzle_orm_1.eq)(users.id, userId))
                .limit(1);
            if (targetUser.length === 0) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // If common_space_id is provided, verify space exists and user has access
            if (common_space_id) {
                const space = await db_1.db
                    .select({
                    id: commonSpaces.id,
                    name: commonSpaces.name,
                    buildingId: commonSpaces.buildingId,
                })
                    .from(commonSpaces)
                    .where((0, drizzle_orm_1.eq)(commonSpaces.id, common_space_id))
                    .limit(1);
                if (space.length === 0) {
                    return res.status(404).json({
                        message: 'Common space not found',
                        code: 'SPACE_NOT_FOUND',
                    });
                }
                const accessibleBuildingIds = await getAccessibleBuildingIds(user);
                if (!accessibleBuildingIds.includes(space[0].buildingId)) {
                    return res.status(403).json({
                        message: 'Access denied to this common space',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
            }
            // Check if a time limit already exists
            const existingLimit = await db_1.db
                .select({ id: userTimeLimits.id })
                .from(userTimeLimits)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId), common_space_id
                ? (0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, common_space_id)
                : (0, drizzle_orm_1.sql) `${userTimeLimits.commonSpaceId} IS NULL`, (0, drizzle_orm_1.eq)(userTimeLimits.limitType, limit_type)))
                .limit(1);
            if (existingLimit.length > 0) {
                // Update existing limit
                await db_1.db
                    .update(userTimeLimits)
                    .set({
                    limitHours: limit_hours,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.eq)(userTimeLimits.id, existingLimit[0].id));
            }
            else {
                // Create new limit
                await db_1.db.insert(userTimeLimits).values({
                    userId,
                    commonSpaceId: common_space_id || null,
                    limitType: limit_type,
                    limitHours: limit_hours,
                });
            }
            console.log(`âœ… Set time limit for user ${targetUser[0].firstName} ${targetUser[0].lastName}: ${limit_hours}h per ${limit_type}`);
            res.json({
                message: 'Time limit set successfully',
                user: {
                    id: targetUser[0].id,
                    name: `${targetUser[0].firstName} ${targetUser[0].lastName}`,
                    limitType: limit_type,
                    limitHours: limit_hours,
                    spaceId: common_space_id,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error setting time limit:', error);
            res.status(500).json({
                message: 'Failed to set time limit',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/users/:userId/time-limits - Get user time limits.
     */
    app.get('/api/common-spaces/users/:userId/time-limits', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { userId } = req.params;
            // Get user's time limits
            const limits = await db_1.db
                .select({
                id: userTimeLimits.id,
                userId: userTimeLimits.userId,
                commonSpaceId: userTimeLimits.commonSpaceId,
                spaceName: commonSpaces.name,
                limitType: userTimeLimits.limitType,
                limitHours: userTimeLimits.limitHours,
                createdAt: userTimeLimits.createdAt,
                updatedAt: userTimeLimits.updatedAt,
            })
                .from(userTimeLimits)
                .leftJoin(commonSpaces, (0, drizzle_orm_1.eq)(userTimeLimits.commonSpaceId, commonSpaces.id))
                .where((0, drizzle_orm_1.eq)(userTimeLimits.userId, userId))
                .orderBy(userTimeLimits.limitType, userTimeLimits.commonSpaceId);
            // Calculate current usage for each limit
            const limitsWithUsage = await Promise.all(limits.map(async (limit) => {
                const currentHours = await getUserBookingHours(userId, limit.commonSpaceId, limit.limitType);
                return {
                    ...limit,
                    currentHours: Math.round(currentHours * 100) / 100,
                    remainingHours: Math.max(0, limit.limitHours - currentHours),
                };
            }));
            res.json({
                limits: limitsWithUsage,
            });
        }
        catch (error) {
            console.error('âŒ Error fetching time limits:', error);
            res.status(500).json({
                message: 'Failed to fetch time limits',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/user-calendar - Get user's personal calendar
     * Shows all user's bookings across all spaces they have access to.
     */
    app.get('/api/common-spaces/user-calendar', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid calendar query parameters',
                    errors: queryValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { start_date, end_date, view } = queryValidation.data;
            // Get user's bookings within date range
            const userBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                spaceName: commonSpaces.name,
                spaceId: commonSpaces.id,
                buildingName: buildings.name,
                buildingId: buildings.id,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(buildings, (0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildings.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(bookings.userId, user.id), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)), (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date))))
                .orderBy(bookings.startTime);
            res.json({
                user: {
                    id: user.id,
                    name: `${user.firstName} ${user.lastName}`,
                    role: user.role,
                },
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    bookings: userBookings,
                },
                summary: {
                    totalBookings: userBookings.length,
                    totalHours: userBookings.reduce((total, booking) => {
                        const duration = (new Date(booking.endTime).getTime() - new Date(booking.startTime).getTime()) /
                            (1000 * 60 * 60);
                        return total + duration;
                    }, 0),
                },
            });
        }
        catch (error) {
            console.error('âŒ Error fetching user calendar:', error);
            res.status(500).json({
                message: 'Failed to fetch user calendar',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
    /**
     * GET /api/common-spaces/calendar/building/:buildingId - Get building-wide calendar (Manager/Admin only)
     * Shows all bookings across all spaces in a building with full details.
     */
    app.get('/api/common-spaces/calendar/building/:buildingId', auth_1.requireAuth, (0, auth_1.requireRole)(['admin', 'manager']), async (req, res) => {
        try {
            const user = req.user || req.session?.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const paramValidation = zod_1.z.object({ buildingId: zod_1.z.string().uuid() }).safeParse(req.params);
            if (!paramValidation.success) {
                return res.status(400).json({
                    message: 'Invalid building ID',
                    errors: paramValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const queryValidation = calendarQuerySchema.safeParse(req.query);
            if (!queryValidation.success) {
                return res.status(400).json({
                    message: 'Invalid calendar query parameters',
                    errors: queryValidation.error.issues.map((issue) => ({
                        field: issue.path.join('.'),
                        message: issue.message,
                    })),
                });
            }
            const { buildingId } = paramValidation.data;
            const { start_date, end_date, view } = queryValidation.data;
            // Check building access
            const accessibleBuildingIds = await getAccessibleBuildingIds(user);
            if (!accessibleBuildingIds.includes(buildingId)) {
                return res.status(403).json({
                    message: 'Access denied to this building',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get building details
            const building = await db_1.db
                .select({
                id: buildings.id,
                name: buildings.name,
                address: buildings.address,
            })
                .from(buildings)
                .where((0, drizzle_orm_1.eq)(buildings.id, buildingId))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    message: 'Building not found',
                    code: 'NOT_FOUND',
                });
            }
            // Get all bookings for spaces in this building within date range
            const buildingBookings = await db_1.db
                .select({
                id: bookings.id,
                startTime: bookings.startTime,
                endTime: bookings.endTime,
                status: bookings.status,
                spaceName: commonSpaces.name,
                spaceId: commonSpaces.id,
                userId: bookings.userId,
                userName: (0, drizzle_orm_1.sql) `CONCAT(${users.firstName}, ' ', ${users.lastName})`,
                userEmail: users.email,
                userRole: users.role,
            })
                .from(bookings)
                .innerJoin(commonSpaces, (0, drizzle_orm_1.eq)(bookings.commonSpaceId, commonSpaces.id))
                .innerJoin(users, (0, drizzle_orm_1.eq)(bookings.userId, users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildingId), (0, drizzle_orm_1.eq)(bookings.status, 'confirmed'), (0, drizzle_orm_1.gte)(bookings.startTime, new Date(start_date)), (0, drizzle_orm_1.lte)(bookings.endTime, new Date(end_date))))
                .orderBy(bookings.startTime);
            // Get all common spaces in this building
            const buildingSpaces = await db_1.db
                .select({
                id: commonSpaces.id,
                name: commonSpaces.name,
                isReservable: commonSpaces.isReservable,
                capacity: commonSpaces.capacity,
            })
                .from(commonSpaces)
                .where((0, drizzle_orm_1.eq)(commonSpaces.buildingId, buildingId))
                .orderBy(commonSpaces.name);
            // Generate usage statistics
            const spaceUsage = buildingSpaces.map((space) => {
                const spaceBookings = buildingBookings.filter((booking) => booking.spaceId === space.id);
                const totalHours = spaceBookings.reduce((total, booking) => {
                    const duration = (new Date(booking.endTime).getTime() - new Date(booking.startTime).getTime()) /
                        (1000 * 60 * 60);
                    return total + duration;
                }, 0);
                return {
                    ...space,
                    bookingCount: spaceBookings.length,
                    totalHours: Math.round(totalHours * 10) / 10,
                    uniqueUsers: [...new Set(spaceBookings.map((b) => b.userId))].length,
                };
            });
            res.json({
                building: building[0],
                calendar: {
                    view,
                    startDate: start_date,
                    endDate: end_date,
                    events: buildingBookings,
                },
                spaces: spaceUsage,
                summary: {
                    totalBookings: buildingBookings.length,
                    totalSpaces: buildingSpaces.length,
                    activeSpaces: buildingSpaces.filter((s) => s.isReservable).length,
                    uniqueUsers: [...new Set(buildingBookings.map((b) => b.userId))].length,
                },
            });
        }
        catch (error) {
            console.error('âŒ Error fetching building calendar:', error);
            res.status(500).json({
                message: 'Failed to fetch building calendar',
                error: error instanceof Error ? error.message : 'Unknown error',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2NvbW1vbi1zcGFjZXMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnVkEsZ0VBMC9DQztBQXowREQsNkNBQWlGO0FBQ2pGLDhCQUEyQjtBQUMzQixrQ0FBbUQ7QUFDbkQsNkJBQXdCO0FBQ3hCLHVEQUF5QztBQUV6QyxNQUFNLEVBQ0osWUFBWSxFQUNaLFFBQVEsRUFDUix1QkFBdUIsRUFDdkIsY0FBYyxFQUNkLFNBQVMsRUFDVCxLQUFLLEVBQ0wsY0FBYyxFQUNkLGlCQUFpQixHQUNsQixHQUFHLE1BQU0sQ0FBQztBQUVYLHFCQUFxQjtBQUNyQixNQUFNLHVCQUF1QixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDdkMsV0FBVyxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxRQUFRLEVBQUU7Q0FDMUMsQ0FBQyxDQUFDO0FBRUgsTUFBTSxtQkFBbUIsR0FBRyxPQUFDLENBQUMsTUFBTSxDQUFDO0lBQ25DLFVBQVUsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFO0lBQzVDLFFBQVEsRUFBRSxPQUFDLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxFQUFFO0NBQzNDLENBQUMsQ0FBQztBQUVILDRCQUE0QjtBQUM1QixNQUFNLG1CQUFtQixHQUFHLE9BQUMsQ0FBQyxNQUFNLENBQUM7SUFDbkMsVUFBVSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDakMsUUFBUSxFQUFFLE9BQUMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLEVBQUU7SUFDL0IsSUFBSSxFQUFFLE9BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsTUFBTSxFQUFFLEtBQUssQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8s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USxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLFFBQVEsRUFBRTtvQkFDUixJQUFJO29CQUNKLFNBQVMsRUFBRSxVQUFVO29CQUNyQixPQUFPLEVBQUUsUUFBUTtvQkFDakIsTUFBTSxFQUFFLGdCQUFnQjtpQkFDekI7Z0JBQ0QsTUFBTSxFQUFFLFVBQVU7Z0JBQ2xCLE9BQU8sRUFBRTtvQkFDUCxhQUFhLEVBQUUsZ0JBQWdCLENBQUMsTUFBTTtvQkFDdEMsV0FBVyxFQUFFLGNBQWMsQ0FBQyxNQUFNO29CQUNsQyxZQUFZLEVBQUUsY0FBYyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLE1BQU07b0JBQ2pFLFdBQVcsRUFBRSxDQUFDLEdBQUcsSUFBSSxHQUFHLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU07aUJBQ3hFO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsT0FBTyxFQUFFLG1DQUFtQztnQkFDNUMsS0FBSyxFQUFFLEtBQUssWUFBWSxLQUFLLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLGVBQWU7YUFDaEUsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FDRixDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvY29tbW9uLXNwYWNlcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEV4cHJlc3MsIFJlcXVlc3QsIFJlc3BvbnNlIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBlcSwgZGVzYywgYW5kLCBzcWwsIG9yLCBndGUsIGx0ZSwgYmV0d2VlbiwgaW5BcnJheSB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vZGInO1xuaW1wb3J0IHsgcmVxdWlyZUF1dGgsIHJlcXVpcmVSb2xlIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5cbmNvbnN0IHtcbiAgY29tbW9uU3BhY2VzLFxuICBib29raW5ncyxcbiAgdXNlckJvb2tpbmdSZXN0cmljdGlvbnMsXG4gIHVzZXJUaW1lTGltaXRzLFxuICBidWlsZGluZ3MsXG4gIHVzZXJzLFxuICB1c2VyUmVzaWRlbmNlcyxcbiAgdXNlck9yZ2FuaXphdGlvbnMsXG59ID0gc2NoZW1hO1xuXG4vLyBWYWxpZGF0aW9uIHNjaGVtYXNcbmNvbnN0IGNvbW1vblNwYWNlRmlsdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICBidWlsZGluZ19pZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCBib29raW5nRmlsdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICBzdGFydF9kYXRlOiB6LnN0cmluZygpLmRhdGV0aW1lKCkub3B0aW9uYWwoKSxcbiAgZW5kX2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKS5vcHRpb25hbCgpLFxufSk7XG5cbi8vIENhbGVuZGFyLXNwZWNpZmljIHNjaGVtYXNcbmNvbnN0IGNhbGVuZGFyUXVlcnlTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0X2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kX2RhdGU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgdmlldzogei5lbnVtKFsnbW9udGgnLCAnd2VlaycsICdkYXknXSkub3B0aW9uYWwoKS5kZWZhdWx0KCdtb250aCcpLFxufSk7XG5cbmNvbnN0IGJ1aWxkaW5nQ2FsZW5kYXJTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJ1aWxkaW5nSWQ6IHouc3RyaW5nKCkudXVpZCgpLFxufSk7XG5cbmNvbnN0IGNyZWF0ZUJvb2tpbmdTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIHN0YXJ0X3RpbWU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbiAgZW5kX3RpbWU6IHouc3RyaW5nKCkuZGF0ZXRpbWUoKSxcbn0pO1xuXG5jb25zdCBjcmVhdGVSZXN0cmljdGlvblNjaGVtYSA9IHoub2JqZWN0KHtcbiAgY29tbW9uX3NwYWNlX2lkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgaXNfYmxvY2tlZDogei5ib29sZWFuKCksXG4gIHJlYXNvbjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IGNyZWF0ZUNvbW1vblNwYWNlU2NoZW1hID0gei5vYmplY3Qoe1xuICBuYW1lOiB6LnN0cmluZygpLm1pbigxLCAnTmFtZSBpcyByZXF1aXJlZCcpLm1heCgxMDAsICdOYW1lIHRvbyBsb25nJyksXG4gIGRlc2NyaXB0aW9uOiB6LnN0cmluZygpLm9wdGlvbmFsKCksXG4gIGJ1aWxkaW5nX2lkOiB6LnN0cmluZygpLnV1aWQoJ0J1aWxkaW5nIElEIG11c3QgYmUgYSB2YWxpZCBVVUlEJyksXG4gIGlzX3Jlc2VydmFibGU6IHouYm9vbGVhbigpLmRlZmF1bHQodHJ1ZSksXG4gIGNhcGFjaXR5OiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoMjAwKS5vcHRpb25hbCgpLFxuICBvcGVuaW5nX2hvdXJzOiB6XG4gICAgLm9iamVjdCh7XG4gICAgICBzdGFydDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsyfTpcXGR7Mn0kLywgJ0ludmFsaWQgdGltZSBmb3JtYXQnKSxcbiAgICAgIGVuZDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsyfTpcXGR7Mn0kLywgJ0ludmFsaWQgdGltZSBmb3JtYXQnKSxcbiAgICB9KVxuICAgIC5vcHRpb25hbCgpLFxuICB3ZWVrbHlfaG91cnM6IHoucmVjb3JkKHouc3RyaW5nKCksIHoub2JqZWN0KHtcbiAgICBzdGFydDogei5zdHJpbmcoKS5yZWdleCgvXlxcZHsyfTpcXGR7Mn0kLywgJ0ludmFsaWQgdGltZSBmb3JtYXQnKSxcbiAgICBlbmQ6IHouc3RyaW5nKCkucmVnZXgoL15cXGR7Mn06XFxkezJ9JC8sICdJbnZhbGlkIHRpbWUgZm9ybWF0JyksXG4gIH0pKS5vcHRpb25hbCgpLFxuICBhdmFpbGFibGVfZGF5czogelxuICAgIC5hcnJheShcbiAgICAgIHouZW51bShbJ21vbmRheScsICd0dWVzZGF5JywgJ3dlZG5lc2RheScsICd0aHVyc2RheScsICdmcmlkYXknLCAnc2F0dXJkYXknLCAnc3VuZGF5J10pXG4gICAgKVxuICAgIC5vcHRpb25hbCgpLFxufSk7XG5cbmNvbnN0IHNldFRpbWVMaW1pdFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgdXNlcl9pZDogei5zdHJpbmcoKS51dWlkKCksXG4gIGNvbW1vbl9zcGFjZV9pZDogei5zdHJpbmcoKS51dWlkKCkub3B0aW9uYWwoKSwgLy8gbnVsbCBtZWFucyBhcHBsaWVzIHRvIGFsbCBzcGFjZXNcbiAgbGltaXRfdHlwZTogei5lbnVtKFsnbW9udGhseScsICd5ZWFybHknXSksXG4gIGxpbWl0X2hvdXJzOiB6Lm51bWJlcigpLmludCgpLm1pbigxKS5tYXgoODc2MCksIC8vIE1heCAxIHllYXIgd29ydGggb2YgaG91cnNcbn0pO1xuXG5jb25zdCBzcGFjZUlkU2NoZW1hID0gei5vYmplY3Qoe1xuICBzcGFjZUlkOiB6LnN0cmluZygpLnV1aWQoKSxcbn0pO1xuXG5jb25zdCBib29raW5nSWRTY2hlbWEgPSB6Lm9iamVjdCh7XG4gIGJvb2tpbmdJZDogei5zdHJpbmcoKS51dWlkKCksXG59KTtcblxuY29uc3QgdXNlcklkU2NoZW1hID0gei5vYmplY3Qoe1xuICB1c2VySWQ6IHouc3RyaW5nKCkudXVpZCgpLFxufSk7XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBhY2Nlc3NpYmxlIGJ1aWxkaW5nIElEcyBmb3IgYSB1c2VyIGJhc2VkIG9uIHRoZWlyIHJvbGUuXG4gKiBAcGFyYW0gdXNlclxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcjogYW55KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAvLyBBZG1pbiB1c2VycyBoYXZlIGFjY2VzcyB0byBhbGwgYnVpbGRpbmdzXG4gIGlmICh1c2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICBjb25zdCBhbGxCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IGJ1aWxkaW5ncy5pZCB9KVxuICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgIHJldHVybiBhbGxCdWlsZGluZ3MubWFwKChiKSA9PiBiLmJ1aWxkaW5nSWQpO1xuICB9XG5cbiAgLy8gQ2hlY2sgaWYgdXNlciBiZWxvbmdzIHRvIEtvdmVvIG9yZ2FuaXphdGlvbiAoc3BlY2lhbCBnbG9iYWwgYWNjZXNzKVxuICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7XG4gICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICBvcmdhbml6YXRpb25OYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9uczogdXNlck9yZ2FuaXphdGlvbnMuY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9ucyxcbiAgICB9KVxuICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgIC5pbm5lckpvaW4odXNlck9yZ2FuaXphdGlvbnMsIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCkpXG4gICAgLndoZXJlKGFuZChlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICBjb25zdCBoYXNHbG9iYWxBY2Nlc3MgPSB1c2VyT3Jncy5zb21lKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25OYW1lID09PSAnS292ZW8nIHx8IG9yZy5jYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zKTtcblxuICBpZiAoaGFzR2xvYmFsQWNjZXNzKSB7XG4gICAgY29uc3QgYWxsQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgIC5zZWxlY3QoeyBidWlsZGluZ0lkOiBidWlsZGluZ3MuaWQgfSlcbiAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKTtcbiAgICByZXR1cm4gYWxsQnVpbGRpbmdzLm1hcCgoYikgPT4gYi5idWlsZGluZ0lkKTtcbiAgfVxuXG4gIC8vIFJlZ3VsYXIgdXNlcnMgYW5kIG1hbmFnZXJzOiBHZXQgYnVpbGRpbmdzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uc1xuICBpZiAodXNlci5yb2xlID09PSAnbWFuYWdlcicgfHwgdXNlci5yb2xlID09PSAnZGVtb19tYW5hZ2VyJykge1xuICAgIGlmICh1c2VyT3Jncy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBvcmdJZHMgPSB1c2VyT3Jncy5tYXAoKHVvKSA9PiB1by5vcmdhbml6YXRpb25JZCk7XG4gICAgICBjb25zdCBvcmdCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgYnVpbGRpbmdJZDogYnVpbGRpbmdzLmlkIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGFuZChpbkFycmF5KGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnSWRzKSwgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSkpO1xuICAgICAgcmV0dXJuIG9yZ0J1aWxkaW5ncy5tYXAoKGIpID0+IGIuYnVpbGRpbmdJZCk7XG4gICAgfVxuICB9XG5cbiAgLy8gQWxsIHVzZXJzIGNhbiBhbHNvIGFjY2VzcyBidWlsZGluZ3Mgd2hlcmUgdGhleSBoYXZlIHJlc2lkZW5jZXNcbiAgY29uc3QgdXNlckJ1aWxkaW5nSWRzID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHsgYnVpbGRpbmdJZDogc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCB9KVxuICAgIC5mcm9tKHVzZXJSZXNpZGVuY2VzKVxuICAgIC5pbm5lckpvaW4oc2NoZW1hLnJlc2lkZW5jZXMsIGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCBzY2hlbWEucmVzaWRlbmNlcy5pZCkpXG4gICAgLndoZXJlKGFuZChlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpLCBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcbiAgcmV0dXJuIHVzZXJCdWlsZGluZ0lkcy5tYXAoKGIpID0+IGIuYnVpbGRpbmdJZCk7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNhbGN1bGF0ZSB1c2VyJ3MgdG90YWwgYm9va2luZyBob3VycyBmb3IgYSB0aW1lIHBlcmlvZC5cbiAqIEBwYXJhbSB1c2VySWRcbiAqIEBwYXJhbSBjb21tb25TcGFjZUlkXG4gKiBAcGFyYW0gbGltaXRUeXBlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFVzZXJCb29raW5nSG91cnMoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBjb21tb25TcGFjZUlkOiBzdHJpbmcgfCBudWxsLFxuICBsaW1pdFR5cGU6ICdtb250aGx5JyB8ICd5ZWFybHknXG4pOiBQcm9taXNlPG51bWJlcj4ge1xuICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICBsZXQgc3RhcnREYXRlOiBEYXRlO1xuXG4gIGlmIChsaW1pdFR5cGUgPT09ICdtb250aGx5Jykge1xuICAgIHN0YXJ0RGF0ZSA9IG5ldyBEYXRlKG5vdy5nZXRGdWxsWWVhcigpLCBub3cuZ2V0TW9udGgoKSwgMSk7XG4gIH0gZWxzZSB7XG4gICAgc3RhcnREYXRlID0gbmV3IERhdGUobm93LmdldEZ1bGxZZWFyKCksIDAsIDEpO1xuICB9XG5cbiAgY29uc3QgY29uZGl0aW9ucyA9IFtcbiAgICBlcShib29raW5ncy51c2VySWQsIHVzZXJJZCksXG4gICAgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJyksXG4gICAgZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgc3RhcnREYXRlKSxcbiAgXTtcblxuICBpZiAoY29tbW9uU3BhY2VJZCkge1xuICAgIGNvbmRpdGlvbnMucHVzaChlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZUlkKSk7XG4gIH1cblxuICBjb25zdCB1c2VyQm9va2luZ3MgPSBhd2FpdCBkYlxuICAgIC5zZWxlY3Qoe1xuICAgICAgdG90YWxIb3Vyczogc3FsPG51bWJlcj5gRVhUUkFDVChFUE9DSCBGUk9NIFNVTSgke2Jvb2tpbmdzLmVuZFRpbWV9IC0gJHtib29raW5ncy5zdGFydFRpbWV9KSkgLyAzNjAwYCxcbiAgICB9KVxuICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgIC53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuXG4gIHJldHVybiB1c2VyQm9va2luZ3NbMF0/LnRvdGFsSG91cnMgfHwgMDtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY2hlY2sgaWYgdXNlciBoYXMgZXhjZWVkZWQgdGhlaXIgYm9va2luZyB0aW1lIGxpbWl0LlxuICogQHBhcmFtIHVzZXJJZFxuICogQHBhcmFtIGNvbW1vblNwYWNlSWRcbiAqIEBwYXJhbSBuZXdCb29raW5nSG91cnNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY2hlY2tVc2VyVGltZUxpbWl0KFxuICB1c2VySWQ6IHN0cmluZyxcbiAgY29tbW9uU3BhY2VJZDogc3RyaW5nLFxuICBuZXdCb29raW5nSG91cnM6IG51bWJlclxuKTogUHJvbWlzZTx7IHdpdGhpbkxpbWl0OiBib29sZWFuOyBtZXNzYWdlPzogc3RyaW5nOyByZW1haW5pbmdIb3Vycz86IG51bWJlciB9PiB7XG4gIC8vIEdldCB1c2VyJ3MgdGltZSBsaW1pdHMgZm9yIHRoaXMgc3BhY2UgKHNwZWNpZmljIG9yIGdsb2JhbClcbiAgY29uc3QgdGltZUxpbWl0cyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCgpXG4gICAgLmZyb20odXNlclRpbWVMaW1pdHMpXG4gICAgLndoZXJlKFxuICAgICAgYW5kKFxuICAgICAgICBlcSh1c2VyVGltZUxpbWl0cy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgIG9yKFxuICAgICAgICAgIGVxKHVzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWQsIGNvbW1vblNwYWNlSWQpLFxuICAgICAgICAgIHNxbGAke3VzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWR9IElTIE5VTExgXG4gICAgICAgIClcbiAgICAgIClcbiAgICApXG4gICAgLm9yZGVyQnkodXNlclRpbWVMaW1pdHMuY29tbW9uU3BhY2VJZCk7IC8vIFNwZWNpZmljIGxpbWl0cyBjb21lIGZpcnN0IChudWxscyBsYXN0KVxuXG4gIGlmICh0aW1lTGltaXRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiB7IHdpdGhpbkxpbWl0OiB0cnVlIH07IC8vIE5vIGxpbWl0cyBzZXRcbiAgfVxuXG4gIC8vIFVzZSB0aGUgbW9zdCBzcGVjaWZpYyBsaW1pdCAoc3BhY2Utc3BlY2lmaWMgb3ZlciBnbG9iYWwpXG4gIGNvbnN0IGFjdGl2ZUxpbWl0ID0gdGltZUxpbWl0c1swXTtcbiAgY29uc3QgY3VycmVudEhvdXJzID0gYXdhaXQgZ2V0VXNlckJvb2tpbmdIb3VycyhcbiAgICB1c2VySWQsXG4gICAgYWN0aXZlTGltaXQuY29tbW9uU3BhY2VJZCxcbiAgICBhY3RpdmVMaW1pdC5saW1pdFR5cGUgYXMgJ21vbnRobHknIHwgJ3llYXJseSdcbiAgKTtcblxuICBjb25zdCB0b3RhbEFmdGVyQm9va2luZyA9IGN1cnJlbnRIb3VycyArIG5ld0Jvb2tpbmdIb3VycztcbiAgY29uc3QgcmVtYWluaW5nSG91cnMgPSBNYXRoLm1heCgwLCBhY3RpdmVMaW1pdC5saW1pdEhvdXJzIC0gY3VycmVudEhvdXJzKTtcblxuICBpZiAodG90YWxBZnRlckJvb2tpbmcgPiBhY3RpdmVMaW1pdC5saW1pdEhvdXJzKSB7XG4gICAgY29uc3QgbGltaXRQZXJpb2QgPSBhY3RpdmVMaW1pdC5saW1pdFR5cGUgPT09ICdtb250aGx5JyA/ICdjZSBtb2lzJyA6ICdjZXR0ZSBhbm7DqWUnO1xuICAgIHJldHVybiB7XG4gICAgICB3aXRoaW5MaW1pdDogZmFsc2UsXG4gICAgICBtZXNzYWdlOiBgTGltaXRlIGRlIHRlbXBzIGTDqXBhc3PDqWUuIFZvdXMgYXZleiB1dGlsaXPDqSAke01hdGgucm91bmQoY3VycmVudEhvdXJzKX1oIHN1ciAke2FjdGl2ZUxpbWl0LmxpbWl0SG91cnN9aCBhdXRvcmlzw6llcyBwb3VyICR7bGltaXRQZXJpb2R9LiBJbCB2b3VzIHJlc3RlICR7TWF0aC5yb3VuZChyZW1haW5pbmdIb3Vycyl9aCBkaXNwb25pYmxlcy5gLFxuICAgICAgcmVtYWluaW5nSG91cnMsXG4gICAgfTtcbiAgfVxuXG4gIHJldHVybiB7IHdpdGhpbkxpbWl0OiB0cnVlLCByZW1haW5pbmdIb3VycyB9O1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBjaGVjayBpZiBhIHRpbWUgc2xvdCBvdmVybGFwcyB3aXRoIGV4aXN0aW5nIGJvb2tpbmdzLlxuICogQHBhcmFtIGNvbW1vblNwYWNlSWRcbiAqIEBwYXJhbSBzdGFydFRpbWVcbiAqIEBwYXJhbSBlbmRUaW1lXG4gKiBAcGFyYW0gZXhjbHVkZUJvb2tpbmdJZFxuICovXG5hc3luYyBmdW5jdGlvbiBoYXNPdmVybGFwcGluZ0Jvb2tpbmdzKFxuICBjb21tb25TcGFjZUlkOiBzdHJpbmcsXG4gIHN0YXJ0VGltZTogRGF0ZSxcbiAgZW5kVGltZTogRGF0ZSxcbiAgZXhjbHVkZUJvb2tpbmdJZD86IHN0cmluZ1xuKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IGNvbmRpdGlvbnMgPSBbXG4gICAgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgY29tbW9uU3BhY2VJZCksXG4gICAgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJyksXG4gICAgb3IoXG4gICAgICAvLyBOZXcgYm9va2luZyBzdGFydHMgZHVyaW5nIGV4aXN0aW5nIGJvb2tpbmdcbiAgICAgIGFuZChndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBzdGFydFRpbWUpLCBsdGUoYm9va2luZ3Muc3RhcnRUaW1lLCBlbmRUaW1lKSksXG4gICAgICAvLyBOZXcgYm9va2luZyBlbmRzIGR1cmluZyBleGlzdGluZyBib29raW5nXG4gICAgICBhbmQoZ3RlKGJvb2tpbmdzLmVuZFRpbWUsIHN0YXJ0VGltZSksIGx0ZShib29raW5ncy5lbmRUaW1lLCBlbmRUaW1lKSksXG4gICAgICAvLyBOZXcgYm9va2luZyBjb21wbGV0ZWx5IGNvbnRhaW5zIGV4aXN0aW5nIGJvb2tpbmdcbiAgICAgIGFuZChsdGUoYm9va2luZ3Muc3RhcnRUaW1lLCBzdGFydFRpbWUpLCBndGUoYm9va2luZ3MuZW5kVGltZSwgZW5kVGltZSkpLFxuICAgICAgLy8gRXhpc3RpbmcgYm9va2luZyBjb21wbGV0ZWx5IGNvbnRhaW5zIG5ldyBib29raW5nXG4gICAgICBhbmQoZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgc3RhcnRUaW1lKSwgbHRlKGJvb2tpbmdzLmVuZFRpbWUsIGVuZFRpbWUpKVxuICAgICksXG4gIF07XG5cbiAgaWYgKGV4Y2x1ZGVCb29raW5nSWQpIHtcbiAgICBjb25kaXRpb25zLnB1c2goc3FsYCR7Ym9va2luZ3MuaWR9ICE9ICR7ZXhjbHVkZUJvb2tpbmdJZH1gKTtcbiAgfVxuXG4gIGNvbnN0IG92ZXJsYXBwaW5nID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHsgaWQ6IGJvb2tpbmdzLmlkIH0pXG4gICAgLmZyb20oYm9va2luZ3MpXG4gICAgLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSlcbiAgICAubGltaXQoMSk7XG5cbiAgcmV0dXJuIG92ZXJsYXBwaW5nLmxlbmd0aCA+IDA7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIHVzZXIgaXMgYmxvY2tlZCBmcm9tIGJvb2tpbmcgYSBzcGFjZS5cbiAqIEBwYXJhbSB1c2VySWRcbiAqIEBwYXJhbSBjb21tb25TcGFjZUlkXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGlzVXNlckJsb2NrZWQodXNlcklkOiBzdHJpbmcsIGNvbW1vblNwYWNlSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBjb25zdCByZXN0cmljdGlvbiA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlzQmxvY2tlZDogdXNlckJvb2tpbmdSZXN0cmljdGlvbnMuaXNCbG9ja2VkIH0pXG4gICAgLmZyb20odXNlckJvb2tpbmdSZXN0cmljdGlvbnMpXG4gICAgLndoZXJlKFxuICAgICAgYW5kKFxuICAgICAgICBlcSh1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgIGVxKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zLmNvbW1vblNwYWNlSWQsIGNvbW1vblNwYWNlSWQpXG4gICAgICApXG4gICAgKVxuICAgIC5saW1pdCgxKTtcblxuICByZXR1cm4gcmVzdHJpY3Rpb24ubGVuZ3RoID4gMCAmJiByZXN0cmljdGlvblswXS5pc0Jsb2NrZWQ7XG59XG5cbi8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIGJvb2tpbmcgdGltZSBpcyB3aXRoaW4gb3BlbmluZyBob3Vycy5cbiAqIEBwYXJhbSBzdGFydFRpbWVcbiAqIEBwYXJhbSBlbmRUaW1lXG4gKiBAcGFyYW0gb3BlbmluZ0hvdXJzXG4gKi9cbmZ1bmN0aW9uIGlzV2l0aGluT3BlbmluZ0hvdXJzKHN0YXJ0VGltZTogRGF0ZSwgZW5kVGltZTogRGF0ZSwgb3BlbmluZ0hvdXJzOiBhbnlbXSk6IGJvb2xlYW4ge1xuICBpZiAoIW9wZW5pbmdIb3VycyB8fCBvcGVuaW5nSG91cnMubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIHRydWU7IC8vIE5vIHJlc3RyaWN0aW9ucyBpZiBubyBvcGVuaW5nIGhvdXJzIGRlZmluZWRcbiAgfVxuXG4gIGNvbnN0IHN0YXJ0RGF5ID0gc3RhcnRUaW1lLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCB7IHdlZWtkYXk6ICdsb25nJyB9KTtcbiAgY29uc3QgZW5kRGF5ID0gZW5kVGltZS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJywgeyB3ZWVrZGF5OiAnbG9uZycgfSk7XG5cbiAgLy8gRm9yIHNpbXBsaWNpdHksIHJlcXVpcmUgYm9va2luZyB0byBiZSB3aXRoaW4gc2FtZSBkYXlcbiAgaWYgKHN0YXJ0RGF5ICE9PSBlbmREYXkpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBjb25zdCBkYXlIb3VycyA9IG9wZW5pbmdIb3Vycy5maW5kKChvaCkgPT4gb2guZGF5ID09PSBzdGFydERheSk7XG4gIGlmICghZGF5SG91cnMpIHtcbiAgICByZXR1cm4gZmFsc2U7IC8vIE5vIGhvdXJzIGRlZmluZWQgZm9yIHRoaXMgZGF5XG4gIH1cblxuICBjb25zdCBzdGFydFRpbWVTdHIgPSBzdGFydFRpbWUudG9UaW1lU3RyaW5nKCkuc2xpY2UoMCwgNSk7IC8vIEhIOk1NIGZvcm1hdFxuICBjb25zdCBlbmRUaW1lU3RyID0gZW5kVGltZS50b1RpbWVTdHJpbmcoKS5zbGljZSgwLCA1KTtcblxuICByZXR1cm4gc3RhcnRUaW1lU3RyID49IGRheUhvdXJzLm9wZW4gJiYgZW5kVGltZVN0ciA8PSBkYXlIb3Vycy5jbG9zZTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYWxsIGNvbW1vbiBzcGFjZXMgQVBJIGVuZHBvaW50cy5cbiAqIEBwYXJhbSBhcHBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQ29tbW9uU3BhY2VzUm91dGVzKGFwcDogRXhwcmVzcyk6IHZvaWQge1xuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcyAtIFJldHJpZXZlIGNvbW1vbiBzcGFjZXMgZm9yIGFjY2Vzc2libGUgYnVpbGRpbmdzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9jb21tb24tc3BhY2VzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHF1ZXJ5IHBhcmFtZXRlcnNcbiAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IGNvbW1vblNwYWNlRmlsdGVyU2NoZW1hLnNhZmVQYXJzZShyZXEucXVlcnkpO1xuICAgICAgaWYgKCFxdWVyeVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGVycm9yczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgYnVpbGRpbmdfaWQgfSA9IHF1ZXJ5VmFsaWRhdGlvbi5kYXRhO1xuXG5cbiAgICAgIC8vIEdldCBhY2Nlc3NpYmxlIGJ1aWxkaW5nIElEc1xuICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuXG4gICAgICBpZiAoYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLmpzb24oW10pO1xuICAgICAgfVxuXG4gICAgICAvLyBCdWlsZCBjb25kaXRpb25zXG4gICAgICBjb25zdCBjb25kaXRpb25zID0gW2VxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSldO1xuXG4gICAgICBpZiAoYnVpbGRpbmdfaWQpIHtcbiAgICAgICAgaWYgKCFhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoYnVpbGRpbmdfaWQpKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgYnVpbGRpbmcnLFxuICAgICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ19pZCkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGluQXJyYXkoY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsIGFjY2Vzc2libGVCdWlsZGluZ0lkcykpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzcGFjZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBjb21tb25TcGFjZXMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgYnVpbGRpbmdJZDogY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgYnVpbGRpbmdOYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICBpc1Jlc2VydmFibGU6IGNvbW1vblNwYWNlcy5pc1Jlc2VydmFibGUsXG4gICAgICAgICAgY2FwYWNpdHk6IGNvbW1vblNwYWNlcy5jYXBhY2l0eSxcbiAgICAgICAgICBjb250YWN0UGVyc29uSWQ6IGNvbW1vblNwYWNlcy5jb250YWN0UGVyc29uSWQsXG4gICAgICAgICAgY29udGFjdFBlcnNvbk5hbWU6IHNxbDxzdHJpbmc+YENPTkNBVCgke3VzZXJzLmZpcnN0TmFtZX0sICcgJywgJHt1c2Vycy5sYXN0TmFtZX0pYCxcbiAgICAgICAgICBvcGVuaW5nSG91cnM6IGNvbW1vblNwYWNlcy5vcGVuaW5nSG91cnMsXG4gICAgICAgICAgYm9va2luZ1J1bGVzOiBjb21tb25TcGFjZXMuYm9va2luZ1J1bGVzLFxuICAgICAgICAgIGNyZWF0ZWRBdDogY29tbW9uU3BhY2VzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGNvbW1vblNwYWNlcy51cGRhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGNvbW1vblNwYWNlcylcbiAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ3MuaWQpKVxuICAgICAgICAubGVmdEpvaW4odXNlcnMsIGVxKGNvbW1vblNwYWNlcy5jb250YWN0UGVyc29uSWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSlcbiAgICAgICAgLm9yZGVyQnkoYnVpbGRpbmdzLm5hbWUsIGNvbW1vblNwYWNlcy5uYW1lKTtcblxuICAgICAgcmVzLmpzb24oc3BhY2VzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggY29tbW9uIHNwYWNlcycsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvYm9va2luZ3MgLSBHZXQgYm9va2luZ3MgZm9yIGEgc3BlY2lmaWMgc3BhY2UuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvYm9va2luZ3MnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVyc1xuICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gc3BhY2VJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3BhY2UgSUQnLFxuICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IGJvb2tpbmdGaWx0ZXJTY2hlbWEuc2FmZVBhcnNlKHJlcS5xdWVyeSk7XG4gICAgICBpZiAoIXF1ZXJ5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgcXVlcnkgcGFyYW1ldGVycycsXG4gICAgICAgICAgZXJyb3JzOiBxdWVyeVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBzcGFjZUlkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcbiAgICAgIGNvbnN0IHsgc3RhcnRfZGF0ZSwgZW5kX2RhdGUgfSA9IHF1ZXJ5VmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhpcyBzcGFjZVxuICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIHNwYWNlSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChzcGFjZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMgPSBhd2FpdCBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcik7XG4gICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhzcGFjZVswXS5idWlsZGluZ0lkKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgY29tbW9uIHNwYWNlJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEJ1aWxkIHF1ZXJ5IGNvbmRpdGlvbnNcbiAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgc3BhY2VJZCldO1xuXG4gICAgICBpZiAoc3RhcnRfZGF0ZSkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgbmV3IERhdGUoc3RhcnRfZGF0ZSkpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKGVuZF9kYXRlKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChsdGUoYm9va2luZ3MuZW5kVGltZSwgbmV3IERhdGUoZW5kX2RhdGUpKSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHNwYWNlQm9va2luZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYm9va2luZ3MuaWQsXG4gICAgICAgICAgY29tbW9uU3BhY2VJZDogYm9va2luZ3MuY29tbW9uU3BhY2VJZCxcbiAgICAgICAgICB1c2VySWQ6IGJvb2tpbmdzLnVzZXJJZCxcbiAgICAgICAgICB1c2VyTmFtZTogc3FsPHN0cmluZz5gQ09OQ0FUKCR7dXNlcnMuZmlyc3ROYW1lfSwgJyAnLCAke3VzZXJzLmxhc3ROYW1lfSlgLFxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgc3RhcnRUaW1lOiBib29raW5ncy5zdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZTogYm9va2luZ3MuZW5kVGltZSxcbiAgICAgICAgICBzdGF0dXM6IGJvb2tpbmdzLnN0YXR1cyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJvb2tpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGJvb2tpbmdzLnVwZGF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKGJvb2tpbmdzLnVzZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKVxuICAgICAgICAub3JkZXJCeShib29raW5ncy5zdGFydFRpbWUpO1xuXG4gICAgICByZXMuanNvbihzcGFjZUJvb2tpbmdzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYm9va2luZ3M6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGJvb2tpbmdzJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvYm9va2luZ3MgLSBDcmVhdGUgYSBuZXcgYm9va2luZy5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvYm9va2luZ3MnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVycyBhbmQgYm9keVxuICAgICAgY29uc3QgcGFyYW1WYWxpZGF0aW9uID0gc3BhY2VJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgc3BhY2UgSUQnLFxuICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIEJvb2tpbmcgcmVxdWVzdCBib2R5OicsIHJlcS5ib2R5KTtcbiAgICAgIGNvbnN0IGJvZHlWYWxpZGF0aW9uID0gY3JlYXRlQm9va2luZ1NjaGVtYS5zYWZlUGFyc2UocmVxLmJvZHkpO1xuICAgICAgaWYgKCFib2R5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinYwgVmFsaWRhdGlvbiBmYWlsZWQ6JywgYm9keVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBib29raW5nIGRhdGEnLFxuICAgICAgICAgIGVycm9yczogYm9keVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBzcGFjZUlkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcbiAgICAgIGNvbnN0IHsgc3RhcnRfdGltZSwgZW5kX3RpbWUgfSA9IGJvZHlWYWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKHN0YXJ0X3RpbWUpO1xuICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKGVuZF90aW1lKTtcblxuICAgICAgLy8gVmFsaWRhdGUgdGltZSByYW5nZVxuICAgICAgaWYgKHN0YXJ0VGltZSA+PSBlbmRUaW1lKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1N0YXJ0IHRpbWUgbXVzdCBiZSBiZWZvcmUgZW5kIHRpbWUnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1RJTUVfUkFOR0UnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQWxsb3cgYm9va2luZ3MgZm9yIHRvZGF5IGFuZCBmdXR1cmUgZGF0ZXMgKHdpdGggNS1taW51dGUgYnVmZmVyIGZvciBjdXJyZW50IHRpbWUpXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZml2ZU1pbnV0ZXNBZ28gPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gNSAqIDYwICogMTAwMCk7XG5cbiAgICAgIGlmIChzdGFydFRpbWUgPCBmaXZlTWludXRlc0Fnbykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDYW5ub3QgYm9vayBpbiB0aGUgcGFzdCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfVElNRV9SQU5HRScsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgY29tbW9uIHNwYWNlIGRldGFpbHNcbiAgICAgIGNvbnN0IHNwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICBuYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICBidWlsZGluZ0lkOiBjb21tb25TcGFjZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICBpc1Jlc2VydmFibGU6IGNvbW1vblNwYWNlcy5pc1Jlc2VydmFibGUsXG4gICAgICAgICAgb3BlbmluZ0hvdXJzOiBjb21tb25TcGFjZXMub3BlbmluZ0hvdXJzLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIHNwYWNlSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChzcGFjZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBjb21tb25TcGFjZSA9IHNwYWNlWzBdO1xuXG4gICAgICAvLyBDaGVjayBpZiBzcGFjZSBpcyByZXNlcnZhYmxlXG4gICAgICBpZiAoIWNvbW1vblNwYWNlLmlzUmVzZXJ2YWJsZSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdUaGlzIGNvbW1vbiBzcGFjZSBpcyBub3QgcmVzZXJ2YWJsZScsXG4gICAgICAgICAgY29kZTogJ05PVF9SRVNFUlZBQkxFJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIHVzZXIgYWNjZXNzIHRvIGJ1aWxkaW5nXG4gICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMgPSBhd2FpdCBnZXRBY2Nlc3NpYmxlQnVpbGRpbmdJZHModXNlcik7XG4gICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhjb21tb25TcGFjZS5idWlsZGluZ0lkKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgY29tbW9uIHNwYWNlJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYmxvY2tlZFxuICAgICAgY29uc3QgYmxvY2tlZCA9IGF3YWl0IGlzVXNlckJsb2NrZWQodXNlci5pZCwgc3BhY2VJZCk7XG4gICAgICBpZiAoYmxvY2tlZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdZb3UgYXJlIGJsb2NrZWQgZnJvbSBib29raW5nIHRoaXMgc3BhY2UnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX0JMT0NLRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgb3BlbmluZyBob3Vyc1xuICAgICAgaWYgKFxuICAgICAgICBjb21tb25TcGFjZS5vcGVuaW5nSG91cnMgJiZcbiAgICAgICAgIWlzV2l0aGluT3BlbmluZ0hvdXJzKHN0YXJ0VGltZSwgZW5kVGltZSwgY29tbW9uU3BhY2Uub3BlbmluZ0hvdXJzIGFzIGFueVtdKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0Jvb2tpbmcgdGltZSBpcyBvdXRzaWRlIG9wZW5pbmcgaG91cnMnLFxuICAgICAgICAgIGNvZGU6ICdPVVRTSURFX09QRU5JTkdfSE9VUlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIG92ZXJsYXBwaW5nIGJvb2tpbmdzXG4gICAgICBjb25zdCBoYXNPdmVybGFwID0gYXdhaXQgaGFzT3ZlcmxhcHBpbmdCb29raW5ncyhzcGFjZUlkLCBzdGFydFRpbWUsIGVuZFRpbWUpO1xuICAgICAgaWYgKGhhc092ZXJsYXApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA5KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVGltZSBzbG90IGlzIGFscmVhZHkgYm9va2VkJyxcbiAgICAgICAgICBjb2RlOiAnVElNRV9DT05GTElDVCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayB1c2VyJ3MgdGltZSBsaW1pdHNcbiAgICAgIGNvbnN0IGJvb2tpbmdEdXJhdGlvbkhvdXJzID0gKGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKSkgLyAoMTAwMCAqIDYwICogNjApO1xuICAgICAgY29uc3QgdGltZUxpbWl0Q2hlY2sgPSBhd2FpdCBjaGVja1VzZXJUaW1lTGltaXQodXNlci5pZCwgc3BhY2VJZCwgYm9va2luZ0R1cmF0aW9uSG91cnMpO1xuXG4gICAgICBpZiAoIXRpbWVMaW1pdENoZWNrLndpdGhpbkxpbWl0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogdGltZUxpbWl0Q2hlY2subWVzc2FnZSxcbiAgICAgICAgICBjb2RlOiAnVElNRV9MSU1JVF9FWENFRURFRCcsXG4gICAgICAgICAgcmVtYWluaW5nSG91cnM6IHRpbWVMaW1pdENoZWNrLnJlbWFpbmluZ0hvdXJzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGJvb2tpbmdcbiAgICAgIGNvbnN0IG5ld0Jvb2tpbmcgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KGJvb2tpbmdzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBjb21tb25TcGFjZUlkOiBzcGFjZUlkLFxuICAgICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgICBzdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZSxcbiAgICAgICAgICBzdGF0dXM6ICdjb25maXJtZWQnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0Jvb2tpbmcgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBib29raW5nOiBuZXdCb29raW5nWzBdLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIGJvb2tpbmc6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBib29raW5nJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcy9jYWxlbmRhci86c3BhY2VJZCAtIEdldCBjYWxlbmRhciBkYXRhIGZvciBhIHNwZWNpZmljIHNwYWNlLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9jb21tb24tc3BhY2VzL2NhbGVuZGFyLzpzcGFjZUlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHBhcmFtZXRlcnNcbiAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IHNwYWNlSWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHNwYWNlIElEJyxcbiAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBxdWVyeVZhbGlkYXRpb24gPSBjYWxlbmRhclF1ZXJ5U2NoZW1hLnNhZmVQYXJzZShyZXEucXVlcnkpO1xuICAgICAgaWYgKCFxdWVyeVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHF1ZXJ5IHBhcmFtZXRlcnMnLFxuICAgICAgICAgIGVycm9yczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgc3BhY2VJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG4gICAgICBjb25zdCB7IHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCB2aWV3IH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgLy8gR2V0IHNwYWNlIGRldGFpbHMgYW5kIGNoZWNrIGFjY2Vzc1xuICAgICAgY29uc3Qgc3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgIGlzUmVzZXJ2YWJsZTogY29tbW9uU3BhY2VzLmlzUmVzZXJ2YWJsZSxcbiAgICAgICAgICBvcGVuaW5nSG91cnM6IGNvbW1vblNwYWNlcy5vcGVuaW5nSG91cnMsXG4gICAgICAgICAgY2FwYWNpdHk6IGNvbW1vblNwYWNlcy5jYXBhY2l0eSxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oY29tbW9uU3BhY2VzKVxuICAgICAgICAud2hlcmUoZXEoY29tbW9uU3BhY2VzLmlkLCBzcGFjZUlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoc3BhY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY29tbW9uU3BhY2UgPSBzcGFjZVswXTtcblxuICAgICAgLy8gQ2hlY2sgdXNlciBhY2Nlc3MgdG8gYnVpbGRpbmdcbiAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKGNvbW1vblNwYWNlLmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQgdG8gdGhpcyBjb21tb24gc3BhY2UnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGJvb2tpbmdzIGZvciB0aGUgc3BlY2lmaWVkIGRhdGUgcmFuZ2VcbiAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXG4gICAgICAgIGVxKGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsIHNwYWNlSWQpLFxuICAgICAgICBlcShib29raW5ncy5zdGF0dXMsICdjb25maXJtZWQnKSxcbiAgICAgICAgZ3RlKGJvb2tpbmdzLnN0YXJ0VGltZSwgbmV3IERhdGUoc3RhcnRfZGF0ZSkpLFxuICAgICAgICBsdGUoYm9va2luZ3MuZW5kVGltZSwgbmV3IERhdGUoZW5kX2RhdGUpKSxcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHNwYWNlQm9va2luZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYm9va2luZ3MuaWQsXG4gICAgICAgICAgc3RhcnRUaW1lOiBib29raW5ncy5zdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZTogYm9va2luZ3MuZW5kVGltZSxcbiAgICAgICAgICBzdGF0dXM6IGJvb2tpbmdzLnN0YXR1cyxcbiAgICAgICAgICB1c2VySWQ6IGJvb2tpbmdzLnVzZXJJZCxcbiAgICAgICAgICB1c2VyTmFtZTogc3FsPHN0cmluZz5gQ09OQ0FUKCR7dXNlcnMuZmlyc3ROYW1lfSwgJyAnLCAke3VzZXJzLmxhc3ROYW1lfSlgLFxuICAgICAgICAgIHVzZXJFbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgdXNlclJvbGU6IHVzZXJzLnJvbGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAuaW5uZXJKb2luKHVzZXJzLCBlcShib29raW5ncy51c2VySWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLndoZXJlKGFuZCguLi5jb25kaXRpb25zKSlcbiAgICAgICAgLm9yZGVyQnkoYm9va2luZ3Muc3RhcnRUaW1lKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIHBlcm1pc3Npb25zXG4gICAgICBjb25zdCBjYW5WaWV3RGV0YWlscyA9IFsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKHVzZXIucm9sZSk7XG5cbiAgICAgIC8vIFRyYW5zZm9ybSBib29raW5ncyB0byBjYWxlbmRhciBldmVudHNcbiAgICAgIGNvbnN0IGV2ZW50cyA9IHNwYWNlQm9va2luZ3MubWFwKChib29raW5nKSA9PiAoe1xuICAgICAgICBpZDogYm9va2luZy5pZCxcbiAgICAgICAgc3RhcnRUaW1lOiBib29raW5nLnN0YXJ0VGltZS50b0lTT1N0cmluZygpLFxuICAgICAgICBlbmRUaW1lOiBib29raW5nLmVuZFRpbWUudG9JU09TdHJpbmcoKSxcbiAgICAgICAgc3RhdHVzOiBib29raW5nLnN0YXR1cyxcbiAgICAgICAgdXNlcklkOiBib29raW5nLnVzZXJJZCxcbiAgICAgICAgdXNlck5hbWU6IGNhblZpZXdEZXRhaWxzIHx8IGJvb2tpbmcudXNlcklkID09PSB1c2VyLmlkID8gYm9va2luZy51c2VyTmFtZSA6ICdEw6lqw6AgUsOpc2VydsOpJyxcbiAgICAgICAgdXNlckVtYWlsOiBjYW5WaWV3RGV0YWlscyB8fCBib29raW5nLnVzZXJJZCA9PT0gdXNlci5pZCA/IGJvb2tpbmcudXNlckVtYWlsIDogbnVsbCxcbiAgICAgICAgaXNPd25Cb29raW5nOiBib29raW5nLnVzZXJJZCA9PT0gdXNlci5pZCxcbiAgICAgICAgc3BhY2VJZDogc3BhY2VJZCxcbiAgICAgICAgc3BhY2VOYW1lOiBjb21tb25TcGFjZS5uYW1lLFxuICAgICAgICB1c2VyUm9sZTogYm9va2luZy51c2VyUm9sZSxcbiAgICAgIH0pKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHN1bW1hcnkgc3RhdGlzdGljc1xuICAgICAgY29uc3QgdG90YWxCb29raW5ncyA9IGV2ZW50cy5sZW5ndGg7XG4gICAgICBjb25zdCB0b3RhbEhvdXJzID0gZXZlbnRzLnJlZHVjZSgoc3VtLCBldmVudCkgPT4ge1xuICAgICAgICBjb25zdCBkdXJhdGlvbiA9XG4gICAgICAgICAgKG5ldyBEYXRlKGV2ZW50LmVuZFRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGV2ZW50LnN0YXJ0VGltZSkuZ2V0VGltZSgpKSAvXG4gICAgICAgICAgKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgICAgcmV0dXJuIHN1bSArIGR1cmF0aW9uO1xuICAgICAgfSwgMCk7XG4gICAgICBjb25zdCB1bmlxdWVVc2VycyA9IG5ldyBTZXQoZXZlbnRzLm1hcCgoZSkgPT4gZS51c2VySWQpKS5zaXplO1xuXG4gICAgICAvLyBCdWlsZCBjYWxlbmRhciByZXNwb25zZVxuICAgICAgY29uc3QgY2FsZW5kYXJEYXRhID0ge1xuICAgICAgICBzcGFjZToge1xuICAgICAgICAgIGlkOiBjb21tb25TcGFjZS5pZCxcbiAgICAgICAgICBuYW1lOiBjb21tb25TcGFjZS5uYW1lLFxuICAgICAgICAgIGlzUmVzZXJ2YWJsZTogY29tbW9uU3BhY2UuaXNSZXNlcnZhYmxlLFxuICAgICAgICAgIG9wZW5pbmdIb3VyczogY29tbW9uU3BhY2Uub3BlbmluZ0hvdXJzLFxuICAgICAgICB9LFxuICAgICAgICBjYWxlbmRhcjoge1xuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgc3RhcnREYXRlOiBzdGFydF9kYXRlLFxuICAgICAgICAgIGVuZERhdGU6IGVuZF9kYXRlLFxuICAgICAgICAgIGV2ZW50cyxcbiAgICAgICAgfSxcbiAgICAgICAgcGVybWlzc2lvbnM6IHtcbiAgICAgICAgICBjYW5WaWV3RGV0YWlscyxcbiAgICAgICAgICBjYW5DcmVhdGVCb29raW5nczogY29tbW9uU3BhY2UuaXNSZXNlcnZhYmxlICYmICEoYXdhaXQgaXNVc2VyQmxvY2tlZCh1c2VyLmlkLCBzcGFjZUlkKSksXG4gICAgICAgIH0sXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICB0b3RhbEJvb2tpbmdzLFxuICAgICAgICAgIHRvdGFsSG91cnM6IE1hdGgucm91bmQodG90YWxIb3VycyAqIDEwKSAvIDEwLFxuICAgICAgICAgIHVuaXF1ZVVzZXJzLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgcmVzLmpzb24oY2FsZW5kYXJEYXRhKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgY2FsZW5kYXIgZGF0YTonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggY2FsZW5kYXIgZGF0YScsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2NvbW1vbi1zcGFjZXMvbXktYm9va2luZ3MgLSBHZXQgY3VycmVudCB1c2VyJ3MgYm9va2luZ3MuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2NvbW1vbi1zcGFjZXMvbXktYm9va2luZ3MnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcblxuICAgICAgLy8gR2V0IGFsbCB1c2VyJ3MgY29uZmlybWVkIGJvb2tpbmdzIHdpdGggc3BhY2UgYW5kIGJ1aWxkaW5nIGluZm9cbiAgICAgIGNvbnN0IHVzZXJCb29raW5ncyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBib29raW5ncy5pZCxcbiAgICAgICAgICBjb21tb25TcGFjZUlkOiBib29raW5ncy5jb21tb25TcGFjZUlkLFxuICAgICAgICAgIHN0YXJ0VGltZTogYm9va2luZ3Muc3RhcnRUaW1lLFxuICAgICAgICAgIGVuZFRpbWU6IGJvb2tpbmdzLmVuZFRpbWUsXG4gICAgICAgICAgc3RhdHVzOiBib29raW5ncy5zdGF0dXMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBib29raW5ncy5jcmVhdGVkQXQsXG4gICAgICAgICAgY29tbW9uU3BhY2VOYW1lOiBjb21tb25TcGFjZXMubmFtZSxcbiAgICAgICAgICBidWlsZGluZ05hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgIGJ1aWxkaW5nQWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAuaW5uZXJKb2luKGNvbW1vblNwYWNlcywgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgY29tbW9uU3BhY2VzLmlkKSlcbiAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLCBidWlsZGluZ3MuaWQpKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJvb2tpbmdzLnVzZXJJZCwgdXNlci5pZCksIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpKSlcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhib29raW5ncy5zdGFydFRpbWUpKTtcblxuICAgICAgcmVzLmpzb24odXNlckJvb2tpbmdzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgdXNlciBib29raW5nczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdXNlciBib29raW5ncycsXG4gICAgICAgIGRldGFpbHM6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogREVMRVRFIC9hcGkvY29tbW9uLXNwYWNlcy9ib29raW5ncy86Ym9va2luZ0lkIC0gQ2FuY2VsIGEgYm9va2luZy5cbiAgICovXG4gIGFwcC5kZWxldGUoXG4gICAgJy9hcGkvY29tbW9uLXNwYWNlcy9ib29raW5ncy86Ym9va2luZ0lkJyxcbiAgICByZXF1aXJlQXV0aCxcbiAgICBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSBwYXJhbWV0ZXJzXG4gICAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IGJvb2tpbmdJZFNjaGVtYS5zYWZlUGFyc2UocmVxLnBhcmFtcyk7XG4gICAgICAgIGlmICghcGFyYW1WYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgYm9va2luZyBJRCcsXG4gICAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGJvb2tpbmdJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgICAgLy8gR2V0IGJvb2tpbmcgZGV0YWlsc1xuICAgICAgICBjb25zdCBib29raW5nID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBib29raW5ncy5pZCxcbiAgICAgICAgICAgIHVzZXJJZDogYm9va2luZ3MudXNlcklkLFxuICAgICAgICAgICAgY29tbW9uU3BhY2VJZDogYm9va2luZ3MuY29tbW9uU3BhY2VJZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgc3RhdHVzOiBib29raW5ncy5zdGF0dXMsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShib29raW5ncylcbiAgICAgICAgICAuaW5uZXJKb2luKGNvbW1vblNwYWNlcywgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgY29tbW9uU3BhY2VzLmlkKSlcbiAgICAgICAgICAud2hlcmUoZXEoYm9va2luZ3MuaWQsIGJvb2tpbmdJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChib29raW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQm9va2luZyBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBib29raW5nRGV0YWlscyA9IGJvb2tpbmdbMF07XG5cbiAgICAgICAgLy8gQ2hlY2sgcGVybWlzc2lvbnM6IHVzZXJzIGNhbiBjYW5jZWwgdGhlaXIgb3duIGJvb2tpbmdzLCBtYW5hZ2VycyBjYW4gY2FuY2VsIGFueSBpbiB0aGVpciBidWlsZGluZ3NcbiAgICAgICAgbGV0IGNhbkNhbmNlbCA9IGZhbHNlO1xuXG4gICAgICAgIGlmIChib29raW5nRGV0YWlscy51c2VySWQgPT09IHVzZXIuaWQpIHtcbiAgICAgICAgICBjYW5DYW5jZWwgPSB0cnVlOyAvLyBVc2VycyBjYW4gYWx3YXlzIGNhbmNlbCB0aGVpciBvd24gYm9va2luZ3NcbiAgICAgICAgfSBlbHNlIGlmIChbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyh1c2VyLnJvbGUpKSB7XG4gICAgICAgICAgLy8gTWFuYWdlcnMgY2FuIGNhbmNlbCBib29raW5ncyBpbiBidWlsZGluZ3MgdGhleSBoYXZlIGFjY2VzcyB0b1xuICAgICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgICAgICBjYW5DYW5jZWwgPSBhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoYm9va2luZ0RldGFpbHMuYnVpbGRpbmdJZCk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoIWNhbkNhbmNlbCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQ2FuIG9ubHkgY2FuY2VsIHlvdXIgb3duIGJvb2tpbmdzJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIGJvb2tpbmcgc3RhdHVzIHRvIGNhbmNlbGxlZFxuICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgIC51cGRhdGUoYm9va2luZ3MpXG4gICAgICAgICAgLnNldCh7XG4gICAgICAgICAgICBzdGF0dXM6ICdjYW5jZWxsZWQnLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGVxKGJvb2tpbmdzLmlkLCBib29raW5nSWQpKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0Jvb2tpbmcgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY2FuY2VsbGluZyBib29raW5nOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY2FuY2VsIGJvb2tpbmcnLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9jb21tb24tc3BhY2VzLzpzcGFjZUlkL3N0YXRzIC0gR2V0IHVzYWdlIHN0YXRpc3RpY3MgKE1hbmFnZXIvQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAuZ2V0KFxuICAgICcvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQvc3RhdHMnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSBwYXJhbWV0ZXJzXG4gICAgICAgIGNvbnN0IHBhcmFtVmFsaWRhdGlvbiA9IHNwYWNlSWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHNwYWNlIElEJyxcbiAgICAgICAgICAgIGVycm9yczogcGFyYW1WYWxpZGF0aW9uLmVycm9yLmlzc3VlcyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgc3BhY2VJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgICAgLy8gQ2hlY2sgYWNjZXNzIHRvIHNwYWNlXG4gICAgICAgIGNvbnN0IHNwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgICBidWlsZGluZ0lkOiBjb21tb25TcGFjZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oY29tbW9uU3BhY2VzKVxuICAgICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIHNwYWNlSWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoc3BhY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDb21tb24gc3BhY2Ugbm90IGZvdW5kJyxcbiAgICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhzcGFjZVswXS5idWlsZGluZ0lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBzdGF0cyBmb3IgbGFzdCB5ZWFyXG4gICAgICAgIGNvbnN0IG9uZVllYXJBZ28gPSBuZXcgRGF0ZSgpO1xuICAgICAgICBvbmVZZWFyQWdvLnNldEZ1bGxZZWFyKG9uZVllYXJBZ28uZ2V0RnVsbFllYXIoKSAtIDEpO1xuXG4gICAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHVzZXJJZDogYm9va2luZ3MudXNlcklkLFxuICAgICAgICAgICAgdXNlck5hbWU6IHNxbDxzdHJpbmc+YENPTkNBVCgke3VzZXJzLmZpcnN0TmFtZX0sICcgJywgJHt1c2Vycy5sYXN0TmFtZX0pYCxcbiAgICAgICAgICAgIHVzZXJFbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgICB0b3RhbEhvdXJzOiBzcWw8bnVtYmVyPmBFWFRSQUNUKEVQT0NIIEZST00gU1VNKCR7Ym9va2luZ3MuZW5kVGltZX0gLSAke2Jvb2tpbmdzLnN0YXJ0VGltZX0pKSAvIDM2MDBgLFxuICAgICAgICAgICAgdG90YWxCb29raW5nczogc3FsPG51bWJlcj5gQ09VTlQoJHtib29raW5ncy5pZH0pYCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKGJvb2tpbmdzLnVzZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgc3BhY2VJZCksXG4gICAgICAgICAgICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgICAgICAgICAgICBndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBvbmVZZWFyQWdvKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAuZ3JvdXBCeShib29raW5ncy51c2VySWQsIHVzZXJzLmZpcnN0TmFtZSwgdXNlcnMubGFzdE5hbWUsIHVzZXJzLmVtYWlsKVxuICAgICAgICAgIC5vcmRlckJ5KFxuICAgICAgICAgICAgZGVzYyhcbiAgICAgICAgICAgICAgc3FsPG51bWJlcj5gRVhUUkFDVChFUE9DSCBGUk9NIFNVTSgke2Jvb2tpbmdzLmVuZFRpbWV9IC0gJHtib29raW5ncy5zdGFydFRpbWV9KSkgLyAzNjAwYFxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgdG90YWxTdGF0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICB0b3RhbEJvb2tpbmdzOiBzcWw8bnVtYmVyPmBDT1VOVCgke2Jvb2tpbmdzLmlkfSlgLFxuICAgICAgICAgICAgdG90YWxIb3Vyczogc3FsPG51bWJlcj5gRVhUUkFDVChFUE9DSCBGUk9NIFNVTSgke2Jvb2tpbmdzLmVuZFRpbWV9IC0gJHtib29raW5ncy5zdGFydFRpbWV9KSkgLyAzNjAwYCxcbiAgICAgICAgICAgIHVuaXF1ZVVzZXJzOiBzcWw8bnVtYmVyPmBDT1VOVChESVNUSU5DVCAke2Jvb2tpbmdzLnVzZXJJZH0pYCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJvb2tpbmdzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoYm9va2luZ3MuY29tbW9uU3BhY2VJZCwgc3BhY2VJZCksXG4gICAgICAgICAgICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgICAgICAgICAgICBndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBvbmVZZWFyQWdvKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIHNwYWNlTmFtZTogc3BhY2VbMF0ubmFtZSxcbiAgICAgICAgICBwZXJpb2Q6ICdMYXN0IDEyIG1vbnRocycsXG4gICAgICAgICAgc3VtbWFyeTogdG90YWxTdGF0c1swXSxcbiAgICAgICAgICB1c2VyU3RhdHM6IHN0YXRzLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHNwYWNlIHN0YXRpc3RpY3M6JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBzcGFjZSBzdGF0aXN0aWNzJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2NvbW1vbi1zcGFjZXMvdXNlcnMvOnVzZXJJZC9yZXN0cmljdGlvbnMgLSBCbG9jay91bmJsb2NrIHVzZXIgKE1hbmFnZXIvQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAucG9zdChcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzL3VzZXJzLzp1c2VySWQvcmVzdHJpY3Rpb25zJyxcbiAgICByZXF1aXJlQXV0aCxcbiAgICByZXF1aXJlUm9sZShbJ2FkbWluJywgJ21hbmFnZXInXSksXG4gICAgYXN5bmMgKHJlcTogYW55LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVycyBhbmQgYm9keVxuICAgICAgICBjb25zdCBwYXJhbVZhbGlkYXRpb24gPSB1c2VySWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHVzZXIgSUQnLFxuICAgICAgICAgICAgZXJyb3JzOiBwYXJhbVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGJvZHlWYWxpZGF0aW9uID0gY3JlYXRlUmVzdHJpY3Rpb25TY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcbiAgICAgICAgaWYgKCFib2R5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlc3RyaWN0aW9uIGRhdGEnLFxuICAgICAgICAgICAgZXJyb3JzOiBib2R5VmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMubWFwKChpc3N1ZSkgPT4gKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyB1c2VySWQgfSA9IHBhcmFtVmFsaWRhdGlvbi5kYXRhO1xuICAgICAgICBjb25zdCB7IGNvbW1vbl9zcGFjZV9pZCwgaXNfYmxvY2tlZCwgcmVhc29uIH0gPSBib2R5VmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHRhcmdldCB1c2VyIGV4aXN0c1xuICAgICAgICBjb25zdCB0YXJnZXRVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHVzZXJzLmlkIH0pXG4gICAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgICAgLndoZXJlKGVxKHVzZXJzLmlkLCB1c2VySWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAodGFyZ2V0VXNlci5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgY29tbW9uIHNwYWNlIGV4aXN0cyBhbmQgdXNlciBoYXMgYWNjZXNzXG4gICAgICAgIGNvbnN0IHNwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBjb21tb25TcGFjZXMuaWQsXG4gICAgICAgICAgICBidWlsZGluZ0lkOiBjb21tb25TcGFjZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGNvbW1vblNwYWNlcylcbiAgICAgICAgICAud2hlcmUoZXEoY29tbW9uU3BhY2VzLmlkLCBjb21tb25fc3BhY2VfaWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoc3BhY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDb21tb24gc3BhY2Ugbm90IGZvdW5kJyxcbiAgICAgICAgICAgIGNvZGU6ICdOT1RfRk9VTkQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhzcGFjZVswXS5idWlsZGluZ0lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHJlc3RyaWN0aW9uIGFscmVhZHkgZXhpc3RzXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nUmVzdHJpY3Rpb24gPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBpZDogdXNlckJvb2tpbmdSZXN0cmljdGlvbnMuaWQgfSlcbiAgICAgICAgICAuZnJvbSh1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgZXEodXNlckJvb2tpbmdSZXN0cmljdGlvbnMuY29tbW9uU3BhY2VJZCwgY29tbW9uX3NwYWNlX2lkKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nUmVzdHJpY3Rpb24ubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyByZXN0cmljdGlvblxuICAgICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAudXBkYXRlKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zKVxuICAgICAgICAgICAgLnNldCh7XG4gICAgICAgICAgICAgIGlzQmxvY2tlZDogaXNfYmxvY2tlZCxcbiAgICAgICAgICAgICAgcmVhc29uLFxuICAgICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZXJlKGVxKHVzZXJCb29raW5nUmVzdHJpY3Rpb25zLmlkLCBleGlzdGluZ1Jlc3RyaWN0aW9uWzBdLmlkKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIG5ldyByZXN0cmljdGlvblxuICAgICAgICAgIGF3YWl0IGRiLmluc2VydCh1c2VyQm9va2luZ1Jlc3RyaWN0aW9ucykudmFsdWVzKHtcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IGNvbW1vbl9zcGFjZV9pZCxcbiAgICAgICAgICAgIGlzQmxvY2tlZDogaXNfYmxvY2tlZCxcbiAgICAgICAgICAgIHJlYXNvbixcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiBgVXNlciAke2lzX2Jsb2NrZWQgPyAnYmxvY2tlZCBmcm9tJyA6ICd1bmJsb2NrZWQgZnJvbSd9IGJvb2tpbmcgdGhpcyBzcGFjZWAsXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgbWFuYWdpbmcgdXNlciByZXN0cmljdGlvbjonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIG1hbmFnZSB1c2VyIHJlc3RyaWN0aW9uJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2NvbW1vbi1zcGFjZXMgLSBDcmVhdGUgYSBuZXcgY29tbW9uIHNwYWNlIChNYW5hZ2VyL0FkbWluIG9ubHkpLlxuICAgKi9cbiAgYXBwLnBvc3QoXG4gICAgJy9hcGkvY29tbW9uLXNwYWNlcycsXG4gICAgcmVxdWlyZUF1dGgsXG4gICAgcmVxdWlyZVJvbGUoWydhZG1pbicsICdtYW5hZ2VyJ10pLFxuICAgIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IGNyZWF0ZUNvbW1vblNwYWNlU2NoZW1hLnNhZmVQYXJzZShyZXEuYm9keSk7XG4gICAgICAgIGlmICghdmFsaWRhdGlvblJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlcXVlc3QgZGF0YScsXG4gICAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb25SZXN1bHQuZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIGJ1aWxkaW5nX2lkLCBpc19yZXNlcnZhYmxlLCBjYXBhY2l0eSwgb3BlbmluZ19ob3Vycywgd2Vla2x5X2hvdXJzLCBhdmFpbGFibGVfZGF5cyB9ID1cbiAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmRhdGE7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhidWlsZGluZ19pZCkpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQuIFlvdSBjYW4gb25seSBjcmVhdGUgc3BhY2VzIGluIGJ1aWxkaW5ncyB5b3UgbWFuYWdlLicsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZlcmlmeSBidWlsZGluZyBleGlzdHMgYW5kIGlzIGFjdGl2ZVxuICAgICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQsIG5hbWU6IGJ1aWxkaW5ncy5uYW1lIH0pXG4gICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgIC53aGVyZShhbmQoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ19pZCksIGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAoYnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBub3QgZm91bmQgb3IgaW5hY3RpdmUnLFxuICAgICAgICAgICAgY29kZTogJ0JVSUxESU5HX05PVF9GT1VORCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBDaGVjayBpZiBhIHNwYWNlIHdpdGggdGhlIHNhbWUgbmFtZSBhbHJlYWR5IGV4aXN0cyBpbiB0aGlzIGJ1aWxkaW5nXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nU3BhY2UgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBpZDogY29tbW9uU3BhY2VzLmlkIH0pXG4gICAgICAgICAgLmZyb20oY29tbW9uU3BhY2VzKVxuICAgICAgICAgIC53aGVyZShhbmQoZXEoY29tbW9uU3BhY2VzLm5hbWUsIG5hbWUpLCBlcShjb21tb25TcGFjZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdfaWQpKSlcbiAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nU3BhY2UubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwOSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQSBjb21tb24gc3BhY2Ugd2l0aCB0aGlzIG5hbWUgYWxyZWFkeSBleGlzdHMgaW4gdGhpcyBidWlsZGluZycsXG4gICAgICAgICAgICBjb2RlOiAnRFVQTElDQVRFX05BTUUnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBuZXcgY29tbW9uIHNwYWNlXG4gICAgICAgIGNvbnN0IG5ld1NwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgICAuaW5zZXJ0KGNvbW1vblNwYWNlcylcbiAgICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJ1aWxkaW5nX2lkLFxuICAgICAgICAgICAgaXNSZXNlcnZhYmxlOiBpc19yZXNlcnZhYmxlLFxuICAgICAgICAgICAgY2FwYWNpdHk6IGNhcGFjaXR5IHx8IG51bGwsXG4gICAgICAgICAgICBvcGVuaW5nSG91cnM6IG9wZW5pbmdfaG91cnMgPyBbeyBkYXk6ICdhbGwnLCBvcGVuOiBvcGVuaW5nX2hvdXJzLnN0YXJ0LCBjbG9zZTogb3BlbmluZ19ob3Vycy5lbmQgfV0gOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICB3ZWVrbHlfaG91cnMgPyBPYmplY3QuZW50cmllcyh3ZWVrbHlfaG91cnMpLm1hcCgoW2RheSwgaG91cnNdKSA9PiAoeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuOiBob3Vycy5zdGFydCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZTogaG91cnMuZW5kIFxuICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSA6IG51bGwsXG4gICAgICAgICAgICBhdmFpbGFibGVEYXlzOiBhdmFpbGFibGVfZGF5cyB8fCBudWxsLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgQ3JlYXRlZCBuZXcgY29tbW9uIHNwYWNlOiAke25hbWV9IGluIGJ1aWxkaW5nICR7YnVpbGRpbmdbMF0ubmFtZX1gKTtcblxuICAgICAgICByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgc3BhY2U6IHtcbiAgICAgICAgICAgIGlkOiBuZXdTcGFjZVswXS5pZCxcbiAgICAgICAgICAgIG5hbWU6IG5ld1NwYWNlWzBdLm5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogbmV3U3BhY2VbMF0uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBidWlsZGluZ0lkOiBuZXdTcGFjZVswXS5idWlsZGluZ0lkLFxuICAgICAgICAgICAgYnVpbGRpbmdOYW1lOiBidWlsZGluZ1swXS5uYW1lLFxuICAgICAgICAgICAgaXNSZXNlcnZhYmxlOiBuZXdTcGFjZVswXS5pc1Jlc2VydmFibGUsXG4gICAgICAgICAgICBjYXBhY2l0eTogbmV3U3BhY2VbMF0uY2FwYWNpdHksXG4gICAgICAgICAgICBvcGVuaW5nSG91cnM6IG5ld1NwYWNlWzBdLm9wZW5pbmdIb3VycyxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogbmV3U3BhY2VbMF0uY3JlYXRlZEF0LFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgY29tbW9uIHNwYWNlOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLyoqXG4gICAqIFBVVCAvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQgLSBVcGRhdGUgYSBjb21tb24gc3BhY2UgKE1hbmFnZXIvQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAucHV0KFxuICAgICcvYXBpL2NvbW1vbi1zcGFjZXMvOnNwYWNlSWQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVyc1xuICAgICAgICBjb25zdCBwYXJhbVZhbGlkYXRpb24gPSBzcGFjZUlkU2NoZW1hLnNhZmVQYXJzZShyZXEucGFyYW1zKTtcbiAgICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBzcGFjZSBJRCcsXG4gICAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBWYWxpZGF0ZSByZXF1ZXN0IGJvZHlcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdCA9IGNyZWF0ZUNvbW1vblNwYWNlU2NoZW1hLnNhZmVQYXJzZShyZXEuYm9keSk7XG4gICAgICAgIGlmICghdmFsaWRhdGlvblJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHJlcXVlc3QgZGF0YScsXG4gICAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb25SZXN1bHQuZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgc3BhY2VJZCB9ID0gcGFyYW1WYWxpZGF0aW9uLmRhdGE7XG4gICAgICAgIGNvbnN0IHsgbmFtZSwgZGVzY3JpcHRpb24sIGJ1aWxkaW5nX2lkLCBpc19yZXNlcnZhYmxlLCBjYXBhY2l0eSwgb3BlbmluZ19ob3Vycywgd2Vla2x5X2hvdXJzLCBhdmFpbGFibGVfZGF5cyB9ID1cbiAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmRhdGE7XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgc3BhY2UgZXhpc3RzIGFuZCB1c2VyIGhhcyBhY2Nlc3NcbiAgICAgICAgY29uc3QgZXhpc3RpbmdTcGFjZSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShjb21tb25TcGFjZXMpXG4gICAgICAgICAgLndoZXJlKGVxKGNvbW1vblNwYWNlcy5pZCwgc3BhY2VJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChleGlzdGluZ1NwYWNlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIG5vdCBmb3VuZCcsXG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIGJ1aWxkaW5nXG4gICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IGF3YWl0IGdldEFjY2Vzc2libGVCdWlsZGluZ0lkcyh1c2VyKTtcbiAgICAgICAgaWYgKCFhY2Nlc3NpYmxlQnVpbGRpbmdJZHMuaW5jbHVkZXMoZXhpc3RpbmdTcGFjZVswXS5idWlsZGluZ0lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZC4gWW91IGNhbiBvbmx5IHVwZGF0ZSBzcGFjZXMgaW4gYnVpbGRpbmdzIHlvdSBtYW5hZ2UuJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVXBkYXRlIHRoZSBjb21tb24gc3BhY2VcbiAgICAgICAgY29uc3QgdXBkYXRlZFNwYWNlID0gYXdhaXQgZGJcbiAgICAgICAgICAudXBkYXRlKGNvbW1vblNwYWNlcylcbiAgICAgICAgICAuc2V0KHtcbiAgICAgICAgICAgIG5hbWUsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJ1aWxkaW5nX2lkLFxuICAgICAgICAgICAgaXNSZXNlcnZhYmxlOiBpc19yZXNlcnZhYmxlLFxuICAgICAgICAgICAgY2FwYWNpdHk6IGNhcGFjaXR5IHx8IG51bGwsXG4gICAgICAgICAgICBvcGVuaW5nSG91cnM6IG9wZW5pbmdfaG91cnMgPyBbeyBkYXk6ICdhbGwnLCBvcGVuOiBvcGVuaW5nX2hvdXJzLnN0YXJ0LCBjbG9zZTogb3BlbmluZ19ob3Vycy5lbmQgfV0gOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICB3ZWVrbHlfaG91cnMgPyBPYmplY3QuZW50cmllcyh3ZWVrbHlfaG91cnMpLm1hcCgoW2RheSwgaG91cnNdKSA9PiAoeyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIGRheSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBvcGVuOiBob3Vycy5zdGFydCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZTogaG91cnMuZW5kIFxuICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSA6IG51bGwsXG4gICAgICAgICAgICBhdmFpbGFibGVEYXlzOiBhdmFpbGFibGVfZGF5cyB8fCBudWxsLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGVxKGNvbW1vblNwYWNlcy5pZCwgc3BhY2VJZCkpXG4gICAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgVXBkYXRlZCBjb21tb24gc3BhY2U6ICR7bmFtZX1gKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0NvbW1vbiBzcGFjZSB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgc3BhY2U6IHtcbiAgICAgICAgICAgIGlkOiB1cGRhdGVkU3BhY2VbMF0uaWQsXG4gICAgICAgICAgICBuYW1lOiB1cGRhdGVkU3BhY2VbMF0ubmFtZSxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB1cGRhdGVkU3BhY2VbMF0uZGVzY3JpcHRpb24sXG4gICAgICAgICAgICBidWlsZGluZ0lkOiB1cGRhdGVkU3BhY2VbMF0uYnVpbGRpbmdJZCxcbiAgICAgICAgICAgIGlzUmVzZXJ2YWJsZTogdXBkYXRlZFNwYWNlWzBdLmlzUmVzZXJ2YWJsZSxcbiAgICAgICAgICAgIGNhcGFjaXR5OiB1cGRhdGVkU3BhY2VbMF0uY2FwYWNpdHksXG4gICAgICAgICAgICBvcGVuaW5nSG91cnM6IHVwZGF0ZWRTcGFjZVswXS5vcGVuaW5nSG91cnMsXG4gICAgICAgICAgICBhdmFpbGFibGVEYXlzOiB1cGRhdGVkU3BhY2VbMF0uYXZhaWxhYmxlRGF5cyxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogdXBkYXRlZFNwYWNlWzBdLnVwZGF0ZWRBdCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIGNvbW1vbiBzcGFjZTonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBjb21tb24gc3BhY2UnLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvY29tbW9uLXNwYWNlcy91c2Vycy86dXNlcklkL3RpbWUtbGltaXRzIC0gU2V0IHVzZXIgdGltZSBsaW1pdHMgKE1hbmFnZXIvQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAucG9zdChcbiAgICAnL2FwaS9jb21tb24tc3BhY2VzL3VzZXJzLzp1c2VySWQvdGltZS1saW1pdHMnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBSZXF1ZXN0LCByZXM6IFJlc3BvbnNlKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICAgIGlmICghdXNlcikge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgcGFyYW1ldGVyc1xuICAgICAgICBjb25zdCBwYXJhbVZhbGlkYXRpb24gPSB1c2VySWRTY2hlbWEuc2FmZVBhcnNlKHJlcS5wYXJhbXMpO1xuICAgICAgICBpZiAoIXBhcmFtVmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHVzZXIgSUQnLFxuICAgICAgICAgICAgZXJyb3JzOiBwYXJhbVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFZhbGlkYXRlIHJlcXVlc3QgYm9keVxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gc2V0VGltZUxpbWl0U2NoZW1hLnNhZmVQYXJzZShyZXEuYm9keSk7XG4gICAgICAgIGlmICghdmFsaWRhdGlvblJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdJbnZhbGlkIHRpbWUgbGltaXQgZGF0YScsXG4gICAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb25SZXN1bHQuZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICAgIGZpZWxkOiBpc3N1ZS5wYXRoLmpvaW4oJy4nKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogaXNzdWUubWVzc2FnZSxcbiAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHsgdXNlcklkIH0gPSBwYXJhbVZhbGlkYXRpb24uZGF0YTtcbiAgICAgICAgY29uc3QgeyB1c2VyX2lkLCBjb21tb25fc3BhY2VfaWQsIGxpbWl0X3R5cGUsIGxpbWl0X2hvdXJzIH0gPSB2YWxpZGF0aW9uUmVzdWx0LmRhdGE7XG5cbiAgICAgICAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzXG4gICAgICAgIGNvbnN0IHRhcmdldFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBpZDogdXNlcnMuaWQsIGZpcnN0TmFtZTogdXNlcnMuZmlyc3ROYW1lLCBsYXN0TmFtZTogdXNlcnMubGFzdE5hbWUgfSlcbiAgICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgICAud2hlcmUoZXEodXNlcnMuaWQsIHVzZXJJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmICh0YXJnZXRVc2VyLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgICAgY29kZTogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIElmIGNvbW1vbl9zcGFjZV9pZCBpcyBwcm92aWRlZCwgdmVyaWZ5IHNwYWNlIGV4aXN0cyBhbmQgdXNlciBoYXMgYWNjZXNzXG4gICAgICAgIGlmIChjb21tb25fc3BhY2VfaWQpIHtcbiAgICAgICAgICBjb25zdCBzcGFjZSA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICAgICAgbmFtZTogY29tbW9uU3BhY2VzLm5hbWUsXG4gICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGNvbW1vblNwYWNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mcm9tKGNvbW1vblNwYWNlcylcbiAgICAgICAgICAgIC53aGVyZShlcShjb21tb25TcGFjZXMuaWQsIGNvbW1vbl9zcGFjZV9pZCkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgICBpZiAoc3BhY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgICBtZXNzYWdlOiAnQ29tbW9uIHNwYWNlIG5vdCBmb3VuZCcsXG4gICAgICAgICAgICAgIGNvZGU6ICdTUEFDRV9OT1RfRk9VTkQnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICAgIGlmICghYWNjZXNzaWJsZUJ1aWxkaW5nSWRzLmluY2x1ZGVzKHNwYWNlWzBdLmJ1aWxkaW5nSWQpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGNvbW1vbiBzcGFjZScsXG4gICAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgaWYgYSB0aW1lIGxpbWl0IGFscmVhZHkgZXhpc3RzXG4gICAgICAgIGNvbnN0IGV4aXN0aW5nTGltaXQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBpZDogdXNlclRpbWVMaW1pdHMuaWQgfSlcbiAgICAgICAgICAuZnJvbSh1c2VyVGltZUxpbWl0cylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHVzZXJUaW1lTGltaXRzLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgY29tbW9uX3NwYWNlX2lkXG4gICAgICAgICAgICAgICAgPyBlcSh1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkLCBjb21tb25fc3BhY2VfaWQpXG4gICAgICAgICAgICAgICAgOiBzcWxgJHt1c2VyVGltZUxpbWl0cy5jb21tb25TcGFjZUlkfSBJUyBOVUxMYCxcbiAgICAgICAgICAgICAgZXEodXNlclRpbWVMaW1pdHMubGltaXRUeXBlLCBsaW1pdF90eXBlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgaWYgKGV4aXN0aW5nTGltaXQubGVuZ3RoID4gMCkge1xuICAgICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBsaW1pdFxuICAgICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAudXBkYXRlKHVzZXJUaW1lTGltaXRzKVxuICAgICAgICAgICAgLnNldCh7XG4gICAgICAgICAgICAgIGxpbWl0SG91cnM6IGxpbWl0X2hvdXJzLFxuICAgICAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndoZXJlKGVxKHVzZXJUaW1lTGltaXRzLmlkLCBleGlzdGluZ0xpbWl0WzBdLmlkKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gQ3JlYXRlIG5ldyBsaW1pdFxuICAgICAgICAgIGF3YWl0IGRiLmluc2VydCh1c2VyVGltZUxpbWl0cykudmFsdWVzKHtcbiAgICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IGNvbW1vbl9zcGFjZV9pZCB8fCBudWxsLFxuICAgICAgICAgICAgbGltaXRUeXBlOiBsaW1pdF90eXBlLFxuICAgICAgICAgICAgbGltaXRIb3VyczogbGltaXRfaG91cnMsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg4pyFIFNldCB0aW1lIGxpbWl0IGZvciB1c2VyICR7dGFyZ2V0VXNlclswXS5maXJzdE5hbWV9ICR7dGFyZ2V0VXNlclswXS5sYXN0TmFtZX06ICR7bGltaXRfaG91cnN9aCBwZXIgJHtsaW1pdF90eXBlfWBcbiAgICAgICAgKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1RpbWUgbGltaXQgc2V0IHN1Y2Nlc3NmdWxseScsXG4gICAgICAgICAgdXNlcjoge1xuICAgICAgICAgICAgaWQ6IHRhcmdldFVzZXJbMF0uaWQsXG4gICAgICAgICAgICBuYW1lOiBgJHt0YXJnZXRVc2VyWzBdLmZpcnN0TmFtZX0gJHt0YXJnZXRVc2VyWzBdLmxhc3ROYW1lfWAsXG4gICAgICAgICAgICBsaW1pdFR5cGU6IGxpbWl0X3R5cGUsXG4gICAgICAgICAgICBsaW1pdEhvdXJzOiBsaW1pdF9ob3VycyxcbiAgICAgICAgICAgIHNwYWNlSWQ6IGNvbW1vbl9zcGFjZV9pZCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHNldHRpbmcgdGltZSBsaW1pdDonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHNldCB0aW1lIGxpbWl0JyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvY29tbW9uLXNwYWNlcy91c2Vycy86dXNlcklkL3RpbWUtbGltaXRzIC0gR2V0IHVzZXIgdGltZSBsaW1pdHMuXG4gICAqL1xuICBhcHAuZ2V0KFxuICAgICcvYXBpL2NvbW1vbi1zcGFjZXMvdXNlcnMvOnVzZXJJZC90aW1lLWxpbWl0cycsXG4gICAgcmVxdWlyZUF1dGgsXG4gICAgcmVxdWlyZVJvbGUoWydhZG1pbicsICdtYW5hZ2VyJ10pLFxuICAgIGFzeW5jIChyZXE6IFJlcXVlc3QsIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IHVzZXJJZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgICAvLyBHZXQgdXNlcidzIHRpbWUgbGltaXRzXG4gICAgICAgIGNvbnN0IGxpbWl0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogdXNlclRpbWVMaW1pdHMuaWQsXG4gICAgICAgICAgICB1c2VySWQ6IHVzZXJUaW1lTGltaXRzLnVzZXJJZCxcbiAgICAgICAgICAgIGNvbW1vblNwYWNlSWQ6IHVzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWQsXG4gICAgICAgICAgICBzcGFjZU5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgICAgbGltaXRUeXBlOiB1c2VyVGltZUxpbWl0cy5saW1pdFR5cGUsXG4gICAgICAgICAgICBsaW1pdEhvdXJzOiB1c2VyVGltZUxpbWl0cy5saW1pdEhvdXJzLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiB1c2VyVGltZUxpbWl0cy5jcmVhdGVkQXQsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHVzZXJUaW1lTGltaXRzLnVwZGF0ZWRBdCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHVzZXJUaW1lTGltaXRzKVxuICAgICAgICAgIC5sZWZ0Sm9pbihjb21tb25TcGFjZXMsIGVxKHVzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWQsIGNvbW1vblNwYWNlcy5pZCkpXG4gICAgICAgICAgLndoZXJlKGVxKHVzZXJUaW1lTGltaXRzLnVzZXJJZCwgdXNlcklkKSlcbiAgICAgICAgICAub3JkZXJCeSh1c2VyVGltZUxpbWl0cy5saW1pdFR5cGUsIHVzZXJUaW1lTGltaXRzLmNvbW1vblNwYWNlSWQpO1xuXG4gICAgICAgIC8vIENhbGN1bGF0ZSBjdXJyZW50IHVzYWdlIGZvciBlYWNoIGxpbWl0XG4gICAgICAgIGNvbnN0IGxpbWl0c1dpdGhVc2FnZSA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgIGxpbWl0cy5tYXAoYXN5bmMgKGxpbWl0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjdXJyZW50SG91cnMgPSBhd2FpdCBnZXRVc2VyQm9va2luZ0hvdXJzKFxuICAgICAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgICAgIGxpbWl0LmNvbW1vblNwYWNlSWQsXG4gICAgICAgICAgICAgIGxpbWl0LmxpbWl0VHlwZSBhcyAnbW9udGhseScgfCAneWVhcmx5J1xuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4ubGltaXQsXG4gICAgICAgICAgICAgIGN1cnJlbnRIb3VyczogTWF0aC5yb3VuZChjdXJyZW50SG91cnMgKiAxMDApIC8gMTAwLFxuICAgICAgICAgICAgICByZW1haW5pbmdIb3VyczogTWF0aC5tYXgoMCwgbGltaXQubGltaXRIb3VycyAtIGN1cnJlbnRIb3VycyksXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIGxpbWl0czogbGltaXRzV2l0aFVzYWdlLFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHRpbWUgbGltaXRzOicsIGVycm9yKTtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdGltZSBsaW1pdHMnLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICApO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9jb21tb24tc3BhY2VzL3VzZXItY2FsZW5kYXIgLSBHZXQgdXNlcidzIHBlcnNvbmFsIGNhbGVuZGFyXG4gICAqIFNob3dzIGFsbCB1c2VyJ3MgYm9va2luZ3MgYWNyb3NzIGFsbCBzcGFjZXMgdGhleSBoYXZlIGFjY2VzcyB0by5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvY29tbW9uLXNwYWNlcy91c2VyLWNhbGVuZGFyJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBSZXNwb25zZSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHF1ZXJ5VmFsaWRhdGlvbiA9IGNhbGVuZGFyUXVlcnlTY2hlbWEuc2FmZVBhcnNlKHJlcS5xdWVyeSk7XG4gICAgICBpZiAoIXF1ZXJ5VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgY2FsZW5kYXIgcXVlcnkgcGFyYW1ldGVycycsXG4gICAgICAgICAgZXJyb3JzOiBxdWVyeVZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLm1hcCgoaXNzdWUpID0+ICh7XG4gICAgICAgICAgICBmaWVsZDogaXNzdWUucGF0aC5qb2luKCcuJyksXG4gICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgIH0pKSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgc3RhcnRfZGF0ZSwgZW5kX2RhdGUsIHZpZXcgfSA9IHF1ZXJ5VmFsaWRhdGlvbi5kYXRhO1xuXG4gICAgICAvLyBHZXQgdXNlcidzIGJvb2tpbmdzIHdpdGhpbiBkYXRlIHJhbmdlXG4gICAgICBjb25zdCB1c2VyQm9va2luZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYm9va2luZ3MuaWQsXG4gICAgICAgICAgc3RhcnRUaW1lOiBib29raW5ncy5zdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZTogYm9va2luZ3MuZW5kVGltZSxcbiAgICAgICAgICBzdGF0dXM6IGJvb2tpbmdzLnN0YXR1cyxcbiAgICAgICAgICBzcGFjZU5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgIHNwYWNlSWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICBidWlsZGluZ05hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgIC5pbm5lckpvaW4oY29tbW9uU3BhY2VzLCBlcShib29raW5ncy5jb21tb25TcGFjZUlkLCBjb21tb25TcGFjZXMuaWQpKVxuICAgICAgICAuaW5uZXJKb2luKGJ1aWxkaW5ncywgZXEoY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5ncy5pZCkpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShib29raW5ncy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgZXEoYm9va2luZ3Muc3RhdHVzLCAnY29uZmlybWVkJyksXG4gICAgICAgICAgICBndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBuZXcgRGF0ZShzdGFydF9kYXRlKSksXG4gICAgICAgICAgICBsdGUoYm9va2luZ3MuZW5kVGltZSwgbmV3IERhdGUoZW5kX2RhdGUpKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAub3JkZXJCeShib29raW5ncy5zdGFydFRpbWUpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogdXNlci5pZCxcbiAgICAgICAgICBuYW1lOiBgJHt1c2VyLmZpcnN0TmFtZX0gJHt1c2VyLmxhc3ROYW1lfWAsXG4gICAgICAgICAgcm9sZTogdXNlci5yb2xlLFxuICAgICAgICB9LFxuICAgICAgICBjYWxlbmRhcjoge1xuICAgICAgICAgIHZpZXcsXG4gICAgICAgICAgc3RhcnREYXRlOiBzdGFydF9kYXRlLFxuICAgICAgICAgIGVuZERhdGU6IGVuZF9kYXRlLFxuICAgICAgICAgIGJvb2tpbmdzOiB1c2VyQm9va2luZ3MsXG4gICAgICAgIH0sXG4gICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICB0b3RhbEJvb2tpbmdzOiB1c2VyQm9va2luZ3MubGVuZ3RoLFxuICAgICAgICAgIHRvdGFsSG91cnM6IHVzZXJCb29raW5ncy5yZWR1Y2UoKHRvdGFsLCBib29raW5nKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9XG4gICAgICAgICAgICAgIChuZXcgRGF0ZShib29raW5nLmVuZFRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGJvb2tpbmcuc3RhcnRUaW1lKS5nZXRUaW1lKCkpIC9cbiAgICAgICAgICAgICAgKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgICAgICAgIHJldHVybiB0b3RhbCArIGR1cmF0aW9uO1xuICAgICAgICAgIH0sIDApLFxuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHVzZXIgY2FsZW5kYXI6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXIgY2FsZW5kYXInLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9jb21tb24tc3BhY2VzL2NhbGVuZGFyL2J1aWxkaW5nLzpidWlsZGluZ0lkIC0gR2V0IGJ1aWxkaW5nLXdpZGUgY2FsZW5kYXIgKE1hbmFnZXIvQWRtaW4gb25seSlcbiAgICogU2hvd3MgYWxsIGJvb2tpbmdzIGFjcm9zcyBhbGwgc3BhY2VzIGluIGEgYnVpbGRpbmcgd2l0aCBmdWxsIGRldGFpbHMuXG4gICAqL1xuICBhcHAuZ2V0KFxuICAgICcvYXBpL2NvbW1vbi1zcGFjZXMvY2FsZW5kYXIvYnVpbGRpbmcvOmJ1aWxkaW5nSWQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHJlcXVpcmVSb2xlKFsnYWRtaW4nLCAnbWFuYWdlciddKSxcbiAgICBhc3luYyAocmVxOiBhbnksIHJlczogUmVzcG9uc2UpID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBwYXJhbVZhbGlkYXRpb24gPSB6Lm9iamVjdCh7IGJ1aWxkaW5nSWQ6IHouc3RyaW5nKCkudXVpZCgpIH0pLnNhZmVQYXJzZShyZXEucGFyYW1zKTtcbiAgICAgICAgaWYgKCFwYXJhbVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBidWlsZGluZyBJRCcsXG4gICAgICAgICAgICBlcnJvcnM6IHBhcmFtVmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMubWFwKChpc3N1ZSkgPT4gKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGlzc3VlLnBhdGguam9pbignLicpLFxuICAgICAgICAgICAgICBtZXNzYWdlOiBpc3N1ZS5tZXNzYWdlLFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcXVlcnlWYWxpZGF0aW9uID0gY2FsZW5kYXJRdWVyeVNjaGVtYS5zYWZlUGFyc2UocmVxLnF1ZXJ5KTtcbiAgICAgICAgaWYgKCFxdWVyeVZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBjYWxlbmRhciBxdWVyeSBwYXJhbWV0ZXJzJyxcbiAgICAgICAgICAgIGVycm9yczogcXVlcnlWYWxpZGF0aW9uLmVycm9yLmlzc3Vlcy5tYXAoKGlzc3VlKSA9PiAoe1xuICAgICAgICAgICAgICBmaWVsZDogaXNzdWUucGF0aC5qb2luKCcuJyksXG4gICAgICAgICAgICAgIG1lc3NhZ2U6IGlzc3VlLm1lc3NhZ2UsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGJ1aWxkaW5nSWQgfSA9IHBhcmFtVmFsaWRhdGlvbi5kYXRhO1xuICAgICAgICBjb25zdCB7IHN0YXJ0X2RhdGUsIGVuZF9kYXRlLCB2aWV3IH0gPSBxdWVyeVZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgICAvLyBDaGVjayBidWlsZGluZyBhY2Nlc3NcbiAgICAgICAgY29uc3QgYWNjZXNzaWJsZUJ1aWxkaW5nSWRzID0gYXdhaXQgZ2V0QWNjZXNzaWJsZUJ1aWxkaW5nSWRzKHVzZXIpO1xuICAgICAgICBpZiAoIWFjY2Vzc2libGVCdWlsZGluZ0lkcy5pbmNsdWRlcyhidWlsZGluZ0lkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnQWNjZXNzIGRlbmllZCB0byB0aGlzIGJ1aWxkaW5nJyxcbiAgICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2V0IGJ1aWxkaW5nIGRldGFpbHNcbiAgICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgYWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmIChidWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcsXG4gICAgICAgICAgICBjb2RlOiAnTk9UX0ZPVU5EJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCBhbGwgYm9va2luZ3MgZm9yIHNwYWNlcyBpbiB0aGlzIGJ1aWxkaW5nIHdpdGhpbiBkYXRlIHJhbmdlXG4gICAgICAgIGNvbnN0IGJ1aWxkaW5nQm9va2luZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGJvb2tpbmdzLmlkLFxuICAgICAgICAgICAgc3RhcnRUaW1lOiBib29raW5ncy5zdGFydFRpbWUsXG4gICAgICAgICAgICBlbmRUaW1lOiBib29raW5ncy5lbmRUaW1lLFxuICAgICAgICAgICAgc3RhdHVzOiBib29raW5ncy5zdGF0dXMsXG4gICAgICAgICAgICBzcGFjZU5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgICAgc3BhY2VJZDogY29tbW9uU3BhY2VzLmlkLFxuICAgICAgICAgICAgdXNlcklkOiBib29raW5ncy51c2VySWQsXG4gICAgICAgICAgICB1c2VyTmFtZTogc3FsPHN0cmluZz5gQ09OQ0FUKCR7dXNlcnMuZmlyc3ROYW1lfSwgJyAnLCAke3VzZXJzLmxhc3ROYW1lfSlgLFxuICAgICAgICAgICAgdXNlckVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICAgIHVzZXJSb2xlOiB1c2Vycy5yb2xlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYm9va2luZ3MpXG4gICAgICAgICAgLmlubmVySm9pbihjb21tb25TcGFjZXMsIGVxKGJvb2tpbmdzLmNvbW1vblNwYWNlSWQsIGNvbW1vblNwYWNlcy5pZCkpXG4gICAgICAgICAgLmlubmVySm9pbih1c2VycywgZXEoYm9va2luZ3MudXNlcklkLCB1c2Vycy5pZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShjb21tb25TcGFjZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksXG4gICAgICAgICAgICAgIGVxKGJvb2tpbmdzLnN0YXR1cywgJ2NvbmZpcm1lZCcpLFxuICAgICAgICAgICAgICBndGUoYm9va2luZ3Muc3RhcnRUaW1lLCBuZXcgRGF0ZShzdGFydF9kYXRlKSksXG4gICAgICAgICAgICAgIGx0ZShib29raW5ncy5lbmRUaW1lLCBuZXcgRGF0ZShlbmRfZGF0ZSkpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vcmRlckJ5KGJvb2tpbmdzLnN0YXJ0VGltZSk7XG5cbiAgICAgICAgLy8gR2V0IGFsbCBjb21tb24gc3BhY2VzIGluIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgY29uc3QgYnVpbGRpbmdTcGFjZXMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGNvbW1vblNwYWNlcy5pZCxcbiAgICAgICAgICAgIG5hbWU6IGNvbW1vblNwYWNlcy5uYW1lLFxuICAgICAgICAgICAgaXNSZXNlcnZhYmxlOiBjb21tb25TcGFjZXMuaXNSZXNlcnZhYmxlLFxuICAgICAgICAgICAgY2FwYWNpdHk6IGNvbW1vblNwYWNlcy5jYXBhY2l0eSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGNvbW1vblNwYWNlcylcbiAgICAgICAgICAud2hlcmUoZXEoY29tbW9uU3BhY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGNvbW1vblNwYWNlcy5uYW1lKTtcblxuICAgICAgICAvLyBHZW5lcmF0ZSB1c2FnZSBzdGF0aXN0aWNzXG4gICAgICAgIGNvbnN0IHNwYWNlVXNhZ2UgPSBidWlsZGluZ1NwYWNlcy5tYXAoKHNwYWNlKSA9PiB7XG4gICAgICAgICAgY29uc3Qgc3BhY2VCb29raW5ncyA9IGJ1aWxkaW5nQm9va2luZ3MuZmlsdGVyKChib29raW5nKSA9PiBib29raW5nLnNwYWNlSWQgPT09IHNwYWNlLmlkKTtcbiAgICAgICAgICBjb25zdCB0b3RhbEhvdXJzID0gc3BhY2VCb29raW5ncy5yZWR1Y2UoKHRvdGFsLCBib29raW5nKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkdXJhdGlvbiA9XG4gICAgICAgICAgICAgIChuZXcgRGF0ZShib29raW5nLmVuZFRpbWUpLmdldFRpbWUoKSAtIG5ldyBEYXRlKGJvb2tpbmcuc3RhcnRUaW1lKS5nZXRUaW1lKCkpIC9cbiAgICAgICAgICAgICAgKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgICAgICAgIHJldHVybiB0b3RhbCArIGR1cmF0aW9uO1xuICAgICAgICAgIH0sIDApO1xuXG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnNwYWNlLFxuICAgICAgICAgICAgYm9va2luZ0NvdW50OiBzcGFjZUJvb2tpbmdzLmxlbmd0aCxcbiAgICAgICAgICAgIHRvdGFsSG91cnM6IE1hdGgucm91bmQodG90YWxIb3VycyAqIDEwKSAvIDEwLFxuICAgICAgICAgICAgdW5pcXVlVXNlcnM6IFsuLi5uZXcgU2V0KHNwYWNlQm9va2luZ3MubWFwKChiKSA9PiBiLnVzZXJJZCkpXS5sZW5ndGgsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmVzLmpzb24oe1xuICAgICAgICAgIGJ1aWxkaW5nOiBidWlsZGluZ1swXSxcbiAgICAgICAgICBjYWxlbmRhcjoge1xuICAgICAgICAgICAgdmlldyxcbiAgICAgICAgICAgIHN0YXJ0RGF0ZTogc3RhcnRfZGF0ZSxcbiAgICAgICAgICAgIGVuZERhdGU6IGVuZF9kYXRlLFxuICAgICAgICAgICAgZXZlbnRzOiBidWlsZGluZ0Jvb2tpbmdzLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc3BhY2VzOiBzcGFjZVVzYWdlLFxuICAgICAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgICAgIHRvdGFsQm9va2luZ3M6IGJ1aWxkaW5nQm9va2luZ3MubGVuZ3RoLFxuICAgICAgICAgICAgdG90YWxTcGFjZXM6IGJ1aWxkaW5nU3BhY2VzLmxlbmd0aCxcbiAgICAgICAgICAgIGFjdGl2ZVNwYWNlczogYnVpbGRpbmdTcGFjZXMuZmlsdGVyKChzKSA9PiBzLmlzUmVzZXJ2YWJsZSkubGVuZ3RoLFxuICAgICAgICAgICAgdW5pcXVlVXNlcnM6IFsuLi5uZXcgU2V0KGJ1aWxkaW5nQm9va2luZ3MubWFwKChiKSA9PiBiLnVzZXJJZCkpXS5sZW5ndGgsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBidWlsZGluZyBjYWxlbmRhcjonLCBlcnJvcik7XG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGJ1aWxkaW5nIGNhbGVuZGFyJyxcbiAgICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==