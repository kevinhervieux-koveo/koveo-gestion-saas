d07700beb0ea7ed462bfc4c2507fae9c
'use strict';
var FileList = require('./FileList.js');
function _define_property(obj, key, value) {
    if (key in obj) {
        Object.defineProperty(obj, key, {
            value: value,
            enumerable: true,
            configurable: true,
            writable: true
        });
    }
    else {
        obj[key] = value;
    }
    return obj;
}
// DataTransfer is not implemented in jsdom.
// DataTransfer with FileList is being created by the browser on certain events.
class DataTransferItemStub {
    getAsFile() {
        return this.file;
    }
    getAsString(callback) {
        if (typeof this.data === 'string') {
            callback(this.data);
        }
    }
    /* istanbul ignore next */ webkitGetAsEntry() {
        throw new Error('not implemented');
    }
    constructor(dataOrFile, type) {
        _define_property(this, "kind", undefined);
        _define_property(this, "type", undefined);
        _define_property(this, "file", null);
        _define_property(this, "data", undefined);
        if (typeof dataOrFile === 'string') {
            this.kind = 'string';
            this.type = String(type);
            this.data = dataOrFile;
        }
        else {
            this.kind = 'file';
            this.type = dataOrFile.type;
            this.file = dataOrFile;
        }
    }
}
class DataTransferItemListStub extends Array {
    add(...args) {
        const item = new DataTransferItemStub(args[0], args[1]);
        this.push(item);
        return item;
    }
    clear() {
        this.splice(0, this.length);
    }
    remove(index) {
        this.splice(index, 1);
    }
}
function getTypeMatcher(type, exact) {
    const [group, sub] = type.split('/');
    const isGroup = !sub || sub === '*';
    return (item) => {
        return exact ? item.type === (isGroup ? group : type) : isGroup ? item.type.startsWith(`${group}/`) : item.type === group;
    };
}
function createDataTransferStub(window) {
    return new class DataTransferStub {
        getData(format) {
            var _this_items_find;
            const match = (_this_items_find = this.items.find(getTypeMatcher(format, true))) !== null && _this_items_find !== undefined ? _this_items_find : this.items.find(getTypeMatcher(format, false));
            let text = '';
            match === null || match === undefined ? undefined : match.getAsString((t) => {
                text = t;
            });
            return text;
        }
        setData(format, data) {
            const matchIndex = this.items.findIndex(getTypeMatcher(format, true));
            const item = new DataTransferItemStub(data, format);
            if (matchIndex >= 0) {
                this.items.splice(matchIndex, 1, item);
            }
            else {
                this.items.push(item);
            }
        }
        clearData(format) {
            if (format) {
                const matchIndex = this.items.findIndex(getTypeMatcher(format, true));
                if (matchIndex >= 0) {
                    this.items.remove(matchIndex);
                }
            }
            else {
                this.items.clear();
            }
        }
        get types() {
            const t = [];
            if (this.files.length) {
                t.push('Files');
            }
            this.items.forEach((i) => t.push(i.type));
            Object.freeze(t);
            return t;
        }
        /* istanbul ignore next */ setDragImage() { }
        constructor() {
            _define_property(this, "dropEffect", 'none');
            _define_property(this, "effectAllowed", 'uninitialized');
            _define_property(this, "items", new DataTransferItemListStub());
            _define_property(this, "files", FileList.createFileList(window, []));
        }
    }();
}
function createDataTransfer(window, files = []) {
    // Use real DataTransfer if available
    const dt = typeof window.DataTransfer === 'undefined' ? createDataTransferStub(window) : /* istanbul ignore next */ new window.DataTransfer();
    Object.defineProperty(dt, 'files', {
        get: () => FileList.createFileList(window, files)
    });
    return dt;
}
async function getBlobFromDataTransferItem(window, item) {
    if (item.kind === 'file') {
        return item.getAsFile();
    }
    return new window.Blob([
        await new Promise((r) => item.getAsString(r))
    ], {
        type: item.type
    });
}
exports.createDataTransfer = createDataTransfer;
exports.getBlobFromDataTransferItem = getBlobFromDataTransferItem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50L2Rpc3QvY2pzL3V0aWxzL2RhdGFUcmFuc2Zlci9EYXRhVHJhbnNmZXIuanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBRXhDLFNBQVMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLO0lBQ3JDLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBQ2IsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO1lBQzVCLEtBQUssRUFBRSxLQUFLO1lBQ1osVUFBVSxFQUFFLElBQUk7WUFDaEIsWUFBWSxFQUFFLElBQUk7WUFDbEIsUUFBUSxFQUFFLElBQUk7U0FDakIsQ0FBQyxDQUFDO0lBQ1AsQ0FBQztTQUFNLENBQUM7UUFDSixHQUFHLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDO0lBQ3JCLENBQUM7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUM7QUFDRCw0Q0FBNEM7QUFDNUMsZ0ZBQWdGO0FBQ2hGLE1BQU0sb0JBQW9CO0lBQ3RCLFNBQVM7UUFDTCxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUM7SUFDckIsQ0FBQztJQUNELFdBQVcsQ0FBQyxRQUFRO1FBQ2hCLElBQUksT0FBTyxJQUFJLENBQUMsSUFBSSxLQUFLLFFBQVEsRUFBRSxDQUFDO1lBQ2hDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsQ0FBQztJQUNMLENBQUM7SUFDRCwwQkFBMEIsQ0FBQyxnQkFBZ0I7UUFDdkMsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFDRCxZQUFZLFVBQVUsRUFBRSxJQUFJO1FBQ3hCLGdCQUFnQixDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsU0FBUyxDQUFDLENB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QUFDO0lBQ0gsT0FBTyxFQUFFLENBQUM7QUFDZCxDQUFDO0FBQ0QsS0FBSyxVQUFVLDJCQUEyQixDQUFDLE1BQU0sRUFBRSxJQUFJO0lBQ25ELElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxNQUFNLEVBQUUsQ0FBQztRQUN2QixPQUFPLElBQUksQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUM1QixDQUFDO0lBQ0QsT0FBTyxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDbkIsTUFBTSxJQUFJLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBQyxFQUFFLENBQUEsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUM5QyxFQUFFO1FBQ0MsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO0tBQ2xCLENBQUMsQ0FBQztBQUNQLENBQUM7QUFFRCxPQUFPLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7QUFDaEQsT0FBTyxDQUFDLDJCQUEyQixHQUFHLDJCQUEyQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvbm9kZV9tb2R1bGVzL0B0ZXN0aW5nLWxpYnJhcnkvdXNlci1ldmVudC9kaXN0L2Nqcy91dGlscy9kYXRhVHJhbnNmZXIvRGF0YVRyYW5zZmVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIEZpbGVMaXN0ID0gcmVxdWlyZSgnLi9GaWxlTGlzdC5qcycpO1xuXG5mdW5jdGlvbiBfZGVmaW5lX3Byb3BlcnR5KG9iaiwga2V5LCB2YWx1ZSkge1xuICAgIGlmIChrZXkgaW4gb2JqKSB7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvYmosIGtleSwge1xuICAgICAgICAgICAgdmFsdWU6IHZhbHVlLFxuICAgICAgICAgICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICAgIHdyaXRhYmxlOiB0cnVlXG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIG9ialtrZXldID0gdmFsdWU7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG4vLyBEYXRhVHJhbnNmZXIgaXMgbm90IGltcGxlbWVudGVkIGluIGpzZG9tLlxuLy8gRGF0YVRyYW5zZmVyIHdpdGggRmlsZUxpc3QgaXMgYmVpbmcgY3JlYXRlZCBieSB0aGUgYnJvd3NlciBvbiBjZXJ0YWluIGV2ZW50cy5cbmNsYXNzIERhdGFUcmFuc2Zlckl0ZW1TdHViIHtcbiAgICBnZXRBc0ZpbGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbGU7XG4gICAgfVxuICAgIGdldEFzU3RyaW5nKGNhbGxiYWNrKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5kYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyB3ZWJraXRHZXRBc0VudHJ5KCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ25vdCBpbXBsZW1lbnRlZCcpO1xuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihkYXRhT3JGaWxlLCB0eXBlKXtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImtpbmRcIiwgdW5kZWZpbmVkKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcInR5cGVcIiwgdW5kZWZpbmVkKTtcbiAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImZpbGVcIiwgbnVsbCk7XG4gICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJkYXRhXCIsIHVuZGVmaW5lZCk7XG4gICAgICAgIGlmICh0eXBlb2YgZGF0YU9yRmlsZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIHRoaXMua2luZCA9ICdzdHJpbmcnO1xuICAgICAgICAgICAgdGhpcy50eXBlID0gU3RyaW5nKHR5cGUpO1xuICAgICAgICAgICAgdGhpcy5kYXRhID0gZGF0YU9yRmlsZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMua2luZCA9ICdmaWxlJztcbiAgICAgICAgICAgIHRoaXMudHlwZSA9IGRhdGFPckZpbGUudHlwZTtcbiAgICAgICAgICAgIHRoaXMuZmlsZSA9IGRhdGFPckZpbGU7XG4gICAgICAgIH1cbiAgICB9XG59XG5jbGFzcyBEYXRhVHJhbnNmZXJJdGVtTGlzdFN0dWIgZXh0ZW5kcyBBcnJheSB7XG4gICAgYWRkKC4uLmFyZ3MpIHtcbiAgICAgICAgY29uc3QgaXRlbSA9IG5ldyBEYXRhVHJhbnNmZXJJdGVtU3R1YihhcmdzWzBdLCBhcmdzWzFdKTtcbiAgICAgICAgdGhpcy5wdXNoKGl0ZW0pO1xuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9XG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMuc3BsaWNlKDAsIHRoaXMubGVuZ3RoKTtcbiAgICB9XG4gICAgcmVtb3ZlKGluZGV4KSB7XG4gICAgICAgIHRoaXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRUeXBlTWF0Y2hlcih0eXBlLCBleGFjdCkge1xuICAgIGNvbnN0IFtncm91cCwgc3ViXSA9IHR5cGUuc3BsaXQoJy8nKTtcbiAgICBjb25zdCBpc0dyb3VwID0gIXN1YiB8fCBzdWIgPT09ICcqJztcbiAgICByZXR1cm4gKGl0ZW0pPT57XG4gICAgICAgIHJldHVybiBleGFjdCA/IGl0ZW0udHlwZSA9PT0gKGlzR3JvdXAgPyBncm91cCA6IHR5cGUpIDogaXNHcm91cCA/IGl0ZW0udHlwZS5zdGFydHNXaXRoKGAke2dyb3VwfS9gKSA6IGl0ZW0udHlwZSA9PT0gZ3JvdXA7XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURhdGFUcmFuc2ZlclN0dWIod2luZG93KSB7XG4gICAgcmV0dXJuIG5ldyBjbGFzcyBEYXRhVHJhbnNmZXJTdHViIHtcbiAgICAgICAgZ2V0RGF0YShmb3JtYXQpIHtcbiAgICAgICAgICAgIHZhciBfdGhpc19pdGVtc19maW5kO1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSAoX3RoaXNfaXRlbXNfZmluZCA9IHRoaXMuaXRlbXMuZmluZChnZXRUeXBlTWF0Y2hlcihmb3JtYXQsIHRydWUpKSkgIT09IG51bGwgJiYgX3RoaXNfaXRlbXNfZmluZCAhPT0gdW5kZWZpbmVkID8gX3RoaXNfaXRlbXNfZmluZCA6IHRoaXMuaXRlbXMuZmluZChnZXRUeXBlTWF0Y2hlcihmb3JtYXQsIGZhbHNlKSk7XG4gICAgICAgICAgICBsZXQgdGV4dCA9ICcnO1xuICAgICAgICAgICAgbWF0Y2ggPT09IG51bGwgfHwgbWF0Y2ggPT09IHVuZGVmaW5lZCA/IHVuZGVmaW5lZCA6IG1hdGNoLmdldEFzU3RyaW5nKCh0KT0+e1xuICAgICAgICAgICAgICAgIHRleHQgPSB0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdGV4dDtcbiAgICAgICAgfVxuICAgICAgICBzZXREYXRhKGZvcm1hdCwgZGF0YSkge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2hJbmRleCA9IHRoaXMuaXRlbXMuZmluZEluZGV4KGdldFR5cGVNYXRjaGVyKGZvcm1hdCwgdHJ1ZSkpO1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IG5ldyBEYXRhVHJhbnNmZXJJdGVtU3R1YihkYXRhLCBmb3JtYXQpO1xuICAgICAgICAgICAgaWYgKG1hdGNoSW5kZXggPj0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMuc3BsaWNlKG1hdGNoSW5kZXgsIDEsIGl0ZW0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1zLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY2xlYXJEYXRhKGZvcm1hdCkge1xuICAgICAgICAgICAgaWYgKGZvcm1hdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoSW5kZXggPSB0aGlzLml0ZW1zLmZpbmRJbmRleChnZXRUeXBlTWF0Y2hlcihmb3JtYXQsIHRydWUpKTtcbiAgICAgICAgICAgICAgICBpZiAobWF0Y2hJbmRleCA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuaXRlbXMucmVtb3ZlKG1hdGNoSW5kZXgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pdGVtcy5jbGVhcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGdldCB0eXBlcygpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgIGlmICh0aGlzLmZpbGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHQucHVzaCgnRmlsZXMnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuaXRlbXMuZm9yRWFjaCgoaSk9PnQucHVzaChpLnR5cGUpKTtcbiAgICAgICAgICAgIE9iamVjdC5mcmVlemUodCk7XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfVxuICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgbmV4dCAqLyBzZXREcmFnSW1hZ2UoKSB7fVxuICAgICAgICBjb25zdHJ1Y3Rvcigpe1xuICAgICAgICAgICAgX2RlZmluZV9wcm9wZXJ0eSh0aGlzLCBcImRyb3BFZmZlY3RcIiwgJ25vbmUnKTtcbiAgICAgICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJlZmZlY3RBbGxvd2VkXCIsICd1bmluaXRpYWxpemVkJyk7XG4gICAgICAgICAgICBfZGVmaW5lX3Byb3BlcnR5KHRoaXMsIFwiaXRlbXNcIiwgbmV3IERhdGFUcmFuc2Zlckl0ZW1MaXN0U3R1YigpKTtcbiAgICAgICAgICAgIF9kZWZpbmVfcHJvcGVydHkodGhpcywgXCJmaWxlc1wiLCBGaWxlTGlzdC5jcmVhdGVGaWxlTGlzdCh3aW5kb3csIFtdKSk7XG4gICAgICAgIH1cbiAgICB9KCk7XG59XG5mdW5jdGlvbiBjcmVhdGVEYXRhVHJhbnNmZXIod2luZG93LCBmaWxlcyA9IFtdKSB7XG4gICAgLy8gVXNlIHJlYWwgRGF0YVRyYW5zZmVyIGlmIGF2YWlsYWJsZVxuICAgIGNvbnN0IGR0ID0gdHlwZW9mIHdpbmRvdy5EYXRhVHJhbnNmZXIgPT09ICd1bmRlZmluZWQnID8gY3JlYXRlRGF0YVRyYW5zZmVyU3R1Yih3aW5kb3cpIDogLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi8gbmV3IHdpbmRvdy5EYXRhVHJhbnNmZXIoKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZHQsICdmaWxlcycsIHtcbiAgICAgICAgZ2V0OiAoKT0+RmlsZUxpc3QuY3JlYXRlRmlsZUxpc3Qod2luZG93LCBmaWxlcylcbiAgICB9KTtcbiAgICByZXR1cm4gZHQ7XG59XG5hc3luYyBmdW5jdGlvbiBnZXRCbG9iRnJvbURhdGFUcmFuc2Zlckl0ZW0od2luZG93LCBpdGVtKSB7XG4gICAgaWYgKGl0ZW0ua2luZCA9PT0gJ2ZpbGUnKSB7XG4gICAgICAgIHJldHVybiBpdGVtLmdldEFzRmlsZSgpO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IHdpbmRvdy5CbG9iKFtcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UoKHIpPT5pdGVtLmdldEFzU3RyaW5nKHIpKVxuICAgIF0sIHtcbiAgICAgICAgdHlwZTogaXRlbS50eXBlXG4gICAgfSk7XG59XG5cbmV4cG9ydHMuY3JlYXRlRGF0YVRyYW5zZmVyID0gY3JlYXRlRGF0YVRyYW5zZmVyO1xuZXhwb3J0cy5nZXRCbG9iRnJvbURhdGFUcmFuc2Zlckl0ZW0gPSBnZXRCbG9iRnJvbURhdGFUcmFuc2Zlckl0ZW07XG4iXSwidmVyc2lvbiI6M30=