89c60b68f051dc09378cbc78a2e5c085
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.queryByRole = exports.queryAllByRole = exports.getByRole = exports.getAllByRole = exports.findByRole = exports.findAllByRole = void 0;
var _domAccessibilityApi = require("dom-accessibility-api");
var _ariaQuery = require("aria-query");
var _roleHelpers = require("../role-helpers");
var _queryHelpers = require("../query-helpers");
var _helpers = require("../helpers");
var _allUtils = require("./all-utils");
/* eslint-disable complexity */
const queryAllByRole = (container, role, { hidden = (0, _allUtils.getConfig)().defaultHidden, name, description, queryFallbacks = false, selected, busy, checked, pressed, current, level, expanded, value: { now: valueNow, min: valueMin, max: valueMax, text: valueText } = {} } = {}) => {
    (0, _helpers.checkContainerType)(container);
    if (selected !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-selected'] === undefined) {
            throw new Error(`"aria-selected" is not supported on role "${role}".`);
        }
    }
    if (busy !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-busy'] === undefined) {
            throw new Error(`"aria-busy" is not supported on role "${role}".`);
        }
    }
    if (checked !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-checked'] === undefined) {
            throw new Error(`"aria-checked" is not supported on role "${role}".`);
        }
    }
    if (pressed !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-pressed'] === undefined) {
            throw new Error(`"aria-pressed" is not supported on role "${role}".`);
        }
    }
    if (current !== undefined) {
        /* istanbul ignore next */
        // guard against unknown roles
        // All currently released ARIA versions support `aria-current` on all roles.
        // Leaving this for symmetry and forward compatibility
        if (_ariaQuery.roles.get(role)?.props['aria-current'] === undefined) {
            throw new Error(`"aria-current" is not supported on role "${role}".`);
        }
    }
    if (level !== undefined) {
        // guard against using `level` option with any role other than `heading`
        if (role !== 'heading') {
            throw new Error(`Role "${role}" cannot have "level" property.`);
        }
    }
    if (valueNow !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-valuenow'] === undefined) {
            throw new Error(`"aria-valuenow" is not supported on role "${role}".`);
        }
    }
    if (valueMax !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-valuemax'] === undefined) {
            throw new Error(`"aria-valuemax" is not supported on role "${role}".`);
        }
    }
    if (valueMin !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-valuemin'] === undefined) {
            throw new Error(`"aria-valuemin" is not supported on role "${role}".`);
        }
    }
    if (valueText !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-valuetext'] === undefined) {
            throw new Error(`"aria-valuetext" is not supported on role "${role}".`);
        }
    }
    if (expanded !== undefined) {
        // guard against unknown roles
        if (_ariaQuery.roles.get(role)?.props['aria-expanded'] === undefined) {
            throw new Error(`"aria-expanded" is not supported on role "${role}".`);
        }
    }
    const subtreeIsInaccessibleCache = new WeakMap();
    function cachedIsSubtreeInaccessible(element) {
        if (!subtreeIsInaccessibleCache.has(element)) {
            subtreeIsInaccessibleCache.set(element, (0, _roleHelpers.isSubtreeInaccessible)(element));
        }
        return subtreeIsInaccessibleCache.get(element);
    }
    return Array.from(container.querySelectorAll(
    // Only query elements that can be matched by the following filters
    makeRoleSelector(role))).filter(node => {
        const isRoleSpecifiedExplicitly = node.hasAttribute('role');
        if (isRoleSpecifiedExplicitly) {
            const roleValue = node.getAttribute('role');
            if (queryFallbacks) {
                return roleValue.split(' ').filter(Boolean).some(roleAttributeToken => roleAttributeToken === role);
            }
            // other wise only send the first token to match
            const [firstRoleAttributeToken] = roleValue.split(' ');
            return firstRoleAttributeToken === role;
        }
        const implicitRoles = (0, _roleHelpers.getImplicitAriaRoles)(node);
        return implicitRoles.some(implicitRole => {
            return implicitRole === role;
        });
    }).filter(element => {
        if (selected !== undefined) {
            return selected === (0, _roleHelpers.computeAriaSelected)(element);
        }
        if (busy !== undefined) {
            return busy === (0, _roleHelpers.computeAriaBusy)(element);
        }
        if (checked !== undefined) {
            return checked === (0, _roleHelpers.computeAriaChecked)(element);
        }
        if (pressed !== undefined) {
            return pressed === (0, _roleHelpers.computeAriaPressed)(element);
        }
        if (current !== undefined) {
            return current === (0, _roleHelpers.computeAriaCurrent)(element);
        }
        if (expanded !== undefined) {
            return expanded === (0, _roleHelpers.computeAriaExpanded)(element);
        }
        if (level !== undefined) {
            return level === (0, _roleHelpers.computeHeadingLevel)(element);
        }
        if (valueNow !== undefined || valueMax !== undefined || valueMin !== undefined || valueText !== undefined) {
            let valueMatches = true;
            if (valueNow !== undefined) {
                valueMatches && (valueMatches = valueNow === (0, _roleHelpers.computeAriaValueNow)(element));
            }
            if (valueMax !== undefined) {
                valueMatches && (valueMatches = valueMax === (0, _roleHelpers.computeAriaValueMax)(element));
            }
            if (valueMin !== undefined) {
                valueMatches && (valueMatches = valueMin === (0, _roleHelpers.computeAriaValueMin)(element));
            }
            if (valueText !== undefined) {
                valueMatches && (valueMatches = (0, _allUtils.matches)((0, _roleHelpers.computeAriaValueText)(element) ?? null, element, valueText, text => text));
            }
            return valueMatches;
        }
        // don't care if aria attributes are unspecified
        return true;
    }).filter(element => {
        if (name === undefined) {
            // Don't care
            return true;
        }
        return (0, _allUtils.matches)((0, _domAccessibilityApi.computeAccessibleName)(element, {
            computedStyleSupportsPseudoElements: (0, _allUtils.getConfig)().computedStyleSupportsPseudoElements
        }), element, name, text => text);
    }).filter(element => {
        if (description === undefined) {
            // Don't care
            return true;
        }
        return (0, _allUtils.matches)((0, _domAccessibilityApi.computeAccessibleDescription)(element, {
            computedStyleSupportsPseudoElements: (0, _allUtils.getConfig)().computedStyleSupportsPseudoElements
        }), element, description, text => text);
    }).filter(element => {
        return hidden === false ? (0, _roleHelpers.isInaccessible)(element, {
            isSubtreeInaccessible: cachedIsSubtreeInaccessible
        }) === false : true;
    });
};
function makeRoleSelector(role) {
    const explicitRoleSelector = `*[role~="${role}"]`;
    const roleRelations = _ariaQuery.roleElements.get(role) ?? new Set();
    const implicitRoleSelectors = new Set(Array.from(roleRelations).map(({ name }) => name));
    // Current transpilation config sometimes assumes `...` is always applied to arrays.
    // `...` is equivalent to `Array.prototype.concat` for arrays.
    // If you replace this code with `[explicitRoleSelector, ...implicitRoleSelectors]`, make sure every transpilation target retains the `...` in favor of `Array.prototype.concat`.
    return [explicitRoleSelector].concat(Array.from(implicitRoleSelectors)).join(',');
}
const getNameHint = name => {
    let nameHint = '';
    if (name === undefined) {
        nameHint = '';
    }
    else if (typeof name === 'string') {
        nameHint = ` and name "${name}"`;
    }
    else {
        nameHint = ` and name \`${name}\``;
    }
    return nameHint;
};
const getMultipleError = (c, role, { name } = {}) => {
    return `Found multiple elements with the role "${role}"${getNameHint(name)}`;
};
const getMissingError = (container, role, { hidden = (0, _allUtils.getConfig)().defaultHidden, name, description } = {}) => {
    if ((0, _allUtils.getConfig)()._disableExpensiveErrorDiagnostics) {
        return `Unable to find role="${role}"${getNameHint(name)}`;
    }
    let roles = '';
    Array.from(container.children).forEach(childElement => {
        roles += (0, _roleHelpers.prettyRoles)(childElement, {
            hidden,
            includeDescription: description !== undefined
        });
    });
    let roleMessage;
    if (roles.length === 0) {
        if (hidden === false) {
            roleMessage = 'There are no accessible roles. But there might be some inaccessible roles. ' + 'If you wish to access them, then set the `hidden` option to `true`. ' + 'Learn more about this here: https://testing-library.com/docs/dom-testing-library/api-queries#byrole';
        }
        else {
            roleMessage = 'There are no available roles.';
        }
    }
    else {
        roleMessage = `
Here are the ${hidden === false ? 'accessible' : 'available'} roles:

  ${roles.replace(/\n/g, '\n  ').replace(/\n\s\s\n/g, '\n\n')}
`.trim();
    }
    let nameHint = '';
    if (name === undefined) {
        nameHint = '';
    }
    else if (typeof name === 'string') {
        nameHint = ` and name "${name}"`;
    }
    else {
        nameHint = ` and name \`${name}\``;
    }
    let descriptionHint = '';
    if (description === undefined) {
        descriptionHint = '';
    }
    else if (typeof description === 'string') {
        descriptionHint = ` and description "${description}"`;
    }
    else {
        descriptionHint = ` and description \`${description}\``;
    }
    return `
Unable to find an ${hidden === false ? 'accessible ' : ''}element with the role "${role}"${nameHint}${descriptionHint}

${roleMessage}`.trim();
};
const queryAllByRoleWithSuggestions = exports.queryAllByRole = (0, _queryHelpers.wrapAllByQueryWithSuggestion)(queryAllByRole, queryAllByRole.name, 'queryAll');
const [queryByRole, getAllByRole, getByRole, findAllByRole, findByRole] = (0, _allUtils.buildQueries)(queryAllByRole, getMultipleError, getMissingError);
exports.findByRole = findByRole;
exports.findAllByRole = findAllByRole;
exports.getByRole = getByRole;
exports.getAllByRole = getAllByRole;
exports.queryByRole = queryByRole;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9xdWVyaWVzL3JvbGUuanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0lBQzNDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQyxDQUFDO0FBQ0gsT0FBTyxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FBQyxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUMsVUFBVSxHQUFHLE9BQU8sQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDLENBQUM7QUFDOUksSUFBSSxvQkFBb0IsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUM1RCxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDdkMsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDOUMsSUFBSSxhQUFhLEdBQUcsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDaEQsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3JDLElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN2QywrQkFBK0I7QUFFL0IsTUFBTSxjQUFjLEdBQUcsQ0FBQyxTQUFTLEVBQUUsSUFBSSxFQUFFLEVBQ3ZDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRSxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxhQUFhLEVBQ2pELElBQUksRUFDSixXQUFXLEVBQ1gsY0FBYyxHQUFHLEtBQUssRUFDdEIsUUFBUSxFQUNSLElBQUksRUFDSixPQUFPLEVBQ1AsT0FBTyxFQUNQLE9BQU8sRUFDUCxLQUFLLEVBQ0wsUUFBUSxFQUNSLEtBQUssRUFBRSxFQUNMLEdBQUcsRUFBRSxRQUFRLEVBQ2IsR0FB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Q0FBQyxXQUFXLEVBQUUsWUFBWSxFQUFFLFNBQVMsRUFBRSxhQUFhLEVBQUUsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDLGNBQWMsRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLENBQUMsQ0FBQztBQUN6SixPQUFPLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztBQUNoQyxPQUFPLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztBQUN0QyxPQUFPLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztBQUM5QixPQUFPLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztBQUNwQyxPQUFPLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL25vZGVfbW9kdWxlcy9AdGVzdGluZy1saWJyYXJ5L2RvbS9kaXN0L3F1ZXJpZXMvcm9sZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMucXVlcnlCeVJvbGUgPSBleHBvcnRzLnF1ZXJ5QWxsQnlSb2xlID0gZXhwb3J0cy5nZXRCeVJvbGUgPSBleHBvcnRzLmdldEFsbEJ5Um9sZSA9IGV4cG9ydHMuZmluZEJ5Um9sZSA9IGV4cG9ydHMuZmluZEFsbEJ5Um9sZSA9IHZvaWQgMDtcbnZhciBfZG9tQWNjZXNzaWJpbGl0eUFwaSA9IHJlcXVpcmUoXCJkb20tYWNjZXNzaWJpbGl0eS1hcGlcIik7XG52YXIgX2FyaWFRdWVyeSA9IHJlcXVpcmUoXCJhcmlhLXF1ZXJ5XCIpO1xudmFyIF9yb2xlSGVscGVycyA9IHJlcXVpcmUoXCIuLi9yb2xlLWhlbHBlcnNcIik7XG52YXIgX3F1ZXJ5SGVscGVycyA9IHJlcXVpcmUoXCIuLi9xdWVyeS1oZWxwZXJzXCIpO1xudmFyIF9oZWxwZXJzID0gcmVxdWlyZShcIi4uL2hlbHBlcnNcIik7XG52YXIgX2FsbFV0aWxzID0gcmVxdWlyZShcIi4vYWxsLXV0aWxzXCIpO1xuLyogZXNsaW50LWRpc2FibGUgY29tcGxleGl0eSAqL1xuXG5jb25zdCBxdWVyeUFsbEJ5Um9sZSA9IChjb250YWluZXIsIHJvbGUsIHtcbiAgaGlkZGVuID0gKDAsIF9hbGxVdGlscy5nZXRDb25maWcpKCkuZGVmYXVsdEhpZGRlbixcbiAgbmFtZSxcbiAgZGVzY3JpcHRpb24sXG4gIHF1ZXJ5RmFsbGJhY2tzID0gZmFsc2UsXG4gIHNlbGVjdGVkLFxuICBidXN5LFxuICBjaGVja2VkLFxuICBwcmVzc2VkLFxuICBjdXJyZW50LFxuICBsZXZlbCxcbiAgZXhwYW5kZWQsXG4gIHZhbHVlOiB7XG4gICAgbm93OiB2YWx1ZU5vdyxcbiAgICBtaW46IHZhbHVlTWluLFxuICAgIG1heDogdmFsdWVNYXgsXG4gICAgdGV4dDogdmFsdWVUZXh0XG4gIH0gPSB7fVxufSA9IHt9KSA9PiB7XG4gICgwLCBfaGVscGVycy5jaGVja0NvbnRhaW5lclR5cGUpKGNvbnRhaW5lcik7XG4gIGlmIChzZWxlY3RlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gZ3VhcmQgYWdhaW5zdCB1bmtub3duIHJvbGVzXG4gICAgaWYgKF9hcmlhUXVlcnkucm9sZXMuZ2V0KHJvbGUpPy5wcm9wc1snYXJpYS1zZWxlY3RlZCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgXCJhcmlhLXNlbGVjdGVkXCIgaXMgbm90IHN1cHBvcnRlZCBvbiByb2xlIFwiJHtyb2xlfVwiLmApO1xuICAgIH1cbiAgfVxuICBpZiAoYnVzeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gZ3VhcmQgYWdhaW5zdCB1bmtub3duIHJvbGVzXG4gICAgaWYgKF9hcmlhUXVlcnkucm9sZXMuZ2V0KHJvbGUpPy5wcm9wc1snYXJpYS1idXN5J10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBcImFyaWEtYnVzeVwiIGlzIG5vdCBzdXBwb3J0ZWQgb24gcm9sZSBcIiR7cm9sZX1cIi5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKGNoZWNrZWQgIT09IHVuZGVmaW5lZCkge1xuICAgIC8vIGd1YXJkIGFnYWluc3QgdW5rbm93biByb2xlc1xuICAgIGlmIChfYXJpYVF1ZXJ5LnJvbGVzLmdldChyb2xlKT8ucHJvcHNbJ2FyaWEtY2hlY2tlZCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgXCJhcmlhLWNoZWNrZWRcIiBpcyBub3Qgc3VwcG9ydGVkIG9uIHJvbGUgXCIke3JvbGV9XCIuYCk7XG4gICAgfVxuICB9XG4gIGlmIChwcmVzc2VkICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVua25vd24gcm9sZXNcbiAgICBpZiAoX2FyaWFRdWVyeS5yb2xlcy5nZXQocm9sZSk/LnByb3BzWydhcmlhLXByZXNzZWQnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFwiYXJpYS1wcmVzc2VkXCIgaXMgbm90IHN1cHBvcnRlZCBvbiByb2xlIFwiJHtyb2xlfVwiLmApO1xuICAgIH1cbiAgfVxuICBpZiAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLyogaXN0YW5idWwgaWdub3JlIG5leHQgKi9cbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVua25vd24gcm9sZXNcbiAgICAvLyBBbGwgY3VycmVudGx5IHJlbGVhc2VkIEFSSUEgdmVyc2lvbnMgc3VwcG9ydCBgYXJpYS1jdXJyZW50YCBvbiBhbGwgcm9sZXMuXG4gICAgLy8gTGVhdmluZyB0aGlzIGZvciBzeW1tZXRyeSBhbmQgZm9yd2FyZCBjb21wYXRpYmlsaXR5XG4gICAgaWYgKF9hcmlhUXVlcnkucm9sZXMuZ2V0KHJvbGUpPy5wcm9wc1snYXJpYS1jdXJyZW50J10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBcImFyaWEtY3VycmVudFwiIGlzIG5vdCBzdXBwb3J0ZWQgb24gcm9sZSBcIiR7cm9sZX1cIi5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKGxldmVsICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVzaW5nIGBsZXZlbGAgb3B0aW9uIHdpdGggYW55IHJvbGUgb3RoZXIgdGhhbiBgaGVhZGluZ2BcbiAgICBpZiAocm9sZSAhPT0gJ2hlYWRpbmcnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFJvbGUgXCIke3JvbGV9XCIgY2Fubm90IGhhdmUgXCJsZXZlbFwiIHByb3BlcnR5LmApO1xuICAgIH1cbiAgfVxuICBpZiAodmFsdWVOb3cgIT09IHVuZGVmaW5lZCkge1xuICAgIC8vIGd1YXJkIGFnYWluc3QgdW5rbm93biByb2xlc1xuICAgIGlmIChfYXJpYVF1ZXJ5LnJvbGVzLmdldChyb2xlKT8ucHJvcHNbJ2FyaWEtdmFsdWVub3cnXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFwiYXJpYS12YWx1ZW5vd1wiIGlzIG5vdCBzdXBwb3J0ZWQgb24gcm9sZSBcIiR7cm9sZX1cIi5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKHZhbHVlTWF4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVua25vd24gcm9sZXNcbiAgICBpZiAoX2FyaWFRdWVyeS5yb2xlcy5nZXQocm9sZSk/LnByb3BzWydhcmlhLXZhbHVlbWF4J10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBcImFyaWEtdmFsdWVtYXhcIiBpcyBub3Qgc3VwcG9ydGVkIG9uIHJvbGUgXCIke3JvbGV9XCIuYCk7XG4gICAgfVxuICB9XG4gIGlmICh2YWx1ZU1pbiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgLy8gZ3VhcmQgYWdhaW5zdCB1bmtub3duIHJvbGVzXG4gICAgaWYgKF9hcmlhUXVlcnkucm9sZXMuZ2V0KHJvbGUpPy5wcm9wc1snYXJpYS12YWx1ZW1pbiddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgXCJhcmlhLXZhbHVlbWluXCIgaXMgbm90IHN1cHBvcnRlZCBvbiByb2xlIFwiJHtyb2xlfVwiLmApO1xuICAgIH1cbiAgfVxuICBpZiAodmFsdWVUZXh0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVua25vd24gcm9sZXNcbiAgICBpZiAoX2FyaWFRdWVyeS5yb2xlcy5nZXQocm9sZSk/LnByb3BzWydhcmlhLXZhbHVldGV4dCddID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgXCJhcmlhLXZhbHVldGV4dFwiIGlzIG5vdCBzdXBwb3J0ZWQgb24gcm9sZSBcIiR7cm9sZX1cIi5gKTtcbiAgICB9XG4gIH1cbiAgaWYgKGV4cGFuZGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAvLyBndWFyZCBhZ2FpbnN0IHVua25vd24gcm9sZXNcbiAgICBpZiAoX2FyaWFRdWVyeS5yb2xlcy5nZXQocm9sZSk/LnByb3BzWydhcmlhLWV4cGFuZGVkJ10gPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBcImFyaWEtZXhwYW5kZWRcIiBpcyBub3Qgc3VwcG9ydGVkIG9uIHJvbGUgXCIke3JvbGV9XCIuYCk7XG4gICAgfVxuICB9XG4gIGNvbnN0IHN1YnRyZWVJc0luYWNjZXNzaWJsZUNhY2hlID0gbmV3IFdlYWtNYXAoKTtcbiAgZnVuY3Rpb24gY2FjaGVkSXNTdWJ0cmVlSW5hY2Nlc3NpYmxlKGVsZW1lbnQpIHtcbiAgICBpZiAoIXN1YnRyZWVJc0luYWNjZXNzaWJsZUNhY2hlLmhhcyhlbGVtZW50KSkge1xuICAgICAgc3VidHJlZUlzSW5hY2Nlc3NpYmxlQ2FjaGUuc2V0KGVsZW1lbnQsICgwLCBfcm9sZUhlbHBlcnMuaXNTdWJ0cmVlSW5hY2Nlc3NpYmxlKShlbGVtZW50KSk7XG4gICAgfVxuICAgIHJldHVybiBzdWJ0cmVlSXNJbmFjY2Vzc2libGVDYWNoZS5nZXQoZWxlbWVudCk7XG4gIH1cbiAgcmV0dXJuIEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoXG4gIC8vIE9ubHkgcXVlcnkgZWxlbWVudHMgdGhhdCBjYW4gYmUgbWF0Y2hlZCBieSB0aGUgZm9sbG93aW5nIGZpbHRlcnNcbiAgbWFrZVJvbGVTZWxlY3Rvcihyb2xlKSkpLmZpbHRlcihub2RlID0+IHtcbiAgICBjb25zdCBpc1JvbGVTcGVjaWZpZWRFeHBsaWNpdGx5ID0gbm9kZS5oYXNBdHRyaWJ1dGUoJ3JvbGUnKTtcbiAgICBpZiAoaXNSb2xlU3BlY2lmaWVkRXhwbGljaXRseSkge1xuICAgICAgY29uc3Qgcm9sZVZhbHVlID0gbm9kZS5nZXRBdHRyaWJ1dGUoJ3JvbGUnKTtcbiAgICAgIGlmIChxdWVyeUZhbGxiYWNrcykge1xuICAgICAgICByZXR1cm4gcm9sZVZhbHVlLnNwbGl0KCcgJykuZmlsdGVyKEJvb2xlYW4pLnNvbWUocm9sZUF0dHJpYnV0ZVRva2VuID0+IHJvbGVBdHRyaWJ1dGVUb2tlbiA9PT0gcm9sZSk7XG4gICAgICB9XG4gICAgICAvLyBvdGhlciB3aXNlIG9ubHkgc2VuZCB0aGUgZmlyc3QgdG9rZW4gdG8gbWF0Y2hcbiAgICAgIGNvbnN0IFtmaXJzdFJvbGVBdHRyaWJ1dGVUb2tlbl0gPSByb2xlVmFsdWUuc3BsaXQoJyAnKTtcbiAgICAgIHJldHVybiBmaXJzdFJvbGVBdHRyaWJ1dGVUb2tlbiA9PT0gcm9sZTtcbiAgICB9XG4gICAgY29uc3QgaW1wbGljaXRSb2xlcyA9ICgwLCBfcm9sZUhlbHBlcnMuZ2V0SW1wbGljaXRBcmlhUm9sZXMpKG5vZGUpO1xuICAgIHJldHVybiBpbXBsaWNpdFJvbGVzLnNvbWUoaW1wbGljaXRSb2xlID0+IHtcbiAgICAgIHJldHVybiBpbXBsaWNpdFJvbGUgPT09IHJvbGU7XG4gICAgfSk7XG4gIH0pLmZpbHRlcihlbGVtZW50ID0+IHtcbiAgICBpZiAoc2VsZWN0ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIHNlbGVjdGVkID09PSAoMCwgX3JvbGVIZWxwZXJzLmNvbXB1dGVBcmlhU2VsZWN0ZWQpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoYnVzeSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gYnVzeSA9PT0gKDAsIF9yb2xlSGVscGVycy5jb21wdXRlQXJpYUJ1c3kpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoY2hlY2tlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gY2hlY2tlZCA9PT0gKDAsIF9yb2xlSGVscGVycy5jb21wdXRlQXJpYUNoZWNrZWQpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAocHJlc3NlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gcHJlc3NlZCA9PT0gKDAsIF9yb2xlSGVscGVycy5jb21wdXRlQXJpYVByZXNzZWQpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gY3VycmVudCA9PT0gKDAsIF9yb2xlSGVscGVycy5jb21wdXRlQXJpYUN1cnJlbnQpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAoZXhwYW5kZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGV4cGFuZGVkID09PSAoMCwgX3JvbGVIZWxwZXJzLmNvbXB1dGVBcmlhRXhwYW5kZWQpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAobGV2ZWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIGxldmVsID09PSAoMCwgX3JvbGVIZWxwZXJzLmNvbXB1dGVIZWFkaW5nTGV2ZWwpKGVsZW1lbnQpO1xuICAgIH1cbiAgICBpZiAodmFsdWVOb3cgIT09IHVuZGVmaW5lZCB8fCB2YWx1ZU1heCAhPT0gdW5kZWZpbmVkIHx8IHZhbHVlTWluICE9PSB1bmRlZmluZWQgfHwgdmFsdWVUZXh0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGxldCB2YWx1ZU1hdGNoZXMgPSB0cnVlO1xuICAgICAgaWYgKHZhbHVlTm93ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFsdWVNYXRjaGVzICYmPSB2YWx1ZU5vdyA9PT0gKDAsIF9yb2xlSGVscGVycy5jb21wdXRlQXJpYVZhbHVlTm93KShlbGVtZW50KTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZU1heCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhbHVlTWF0Y2hlcyAmJj0gdmFsdWVNYXggPT09ICgwLCBfcm9sZUhlbHBlcnMuY29tcHV0ZUFyaWFWYWx1ZU1heCkoZWxlbWVudCk7XG4gICAgICB9XG4gICAgICBpZiAodmFsdWVNaW4gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB2YWx1ZU1hdGNoZXMgJiY9IHZhbHVlTWluID09PSAoMCwgX3JvbGVIZWxwZXJzLmNvbXB1dGVBcmlhVmFsdWVNaW4pKGVsZW1lbnQpO1xuICAgICAgfVxuICAgICAgaWYgKHZhbHVlVGV4dCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhbHVlTWF0Y2hlcyAmJj0gKDAsIF9hbGxVdGlscy5tYXRjaGVzKSgoMCwgX3JvbGVIZWxwZXJzLmNvbXB1dGVBcmlhVmFsdWVUZXh0KShlbGVtZW50KSA/PyBudWxsLCBlbGVtZW50LCB2YWx1ZVRleHQsIHRleHQgPT4gdGV4dCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdmFsdWVNYXRjaGVzO1xuICAgIH1cbiAgICAvLyBkb24ndCBjYXJlIGlmIGFyaWEgYXR0cmlidXRlcyBhcmUgdW5zcGVjaWZpZWRcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfSkuZmlsdGVyKGVsZW1lbnQgPT4ge1xuICAgIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICAgIC8vIERvbid0IGNhcmVcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gKDAsIF9hbGxVdGlscy5tYXRjaGVzKSgoMCwgX2RvbUFjY2Vzc2liaWxpdHlBcGkuY29tcHV0ZUFjY2Vzc2libGVOYW1lKShlbGVtZW50LCB7XG4gICAgICBjb21wdXRlZFN0eWxlU3VwcG9ydHNQc2V1ZG9FbGVtZW50czogKDAsIF9hbGxVdGlscy5nZXRDb25maWcpKCkuY29tcHV0ZWRTdHlsZVN1cHBvcnRzUHNldWRvRWxlbWVudHNcbiAgICB9KSwgZWxlbWVudCwgbmFtZSwgdGV4dCA9PiB0ZXh0KTtcbiAgfSkuZmlsdGVyKGVsZW1lbnQgPT4ge1xuICAgIGlmIChkZXNjcmlwdGlvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBEb24ndCBjYXJlXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuICgwLCBfYWxsVXRpbHMubWF0Y2hlcykoKDAsIF9kb21BY2Nlc3NpYmlsaXR5QXBpLmNvbXB1dGVBY2Nlc3NpYmxlRGVzY3JpcHRpb24pKGVsZW1lbnQsIHtcbiAgICAgIGNvbXB1dGVkU3R5bGVTdXBwb3J0c1BzZXVkb0VsZW1lbnRzOiAoMCwgX2FsbFV0aWxzLmdldENvbmZpZykoKS5jb21wdXRlZFN0eWxlU3VwcG9ydHNQc2V1ZG9FbGVtZW50c1xuICAgIH0pLCBlbGVtZW50LCBkZXNjcmlwdGlvbiwgdGV4dCA9PiB0ZXh0KTtcbiAgfSkuZmlsdGVyKGVsZW1lbnQgPT4ge1xuICAgIHJldHVybiBoaWRkZW4gPT09IGZhbHNlID8gKDAsIF9yb2xlSGVscGVycy5pc0luYWNjZXNzaWJsZSkoZWxlbWVudCwge1xuICAgICAgaXNTdWJ0cmVlSW5hY2Nlc3NpYmxlOiBjYWNoZWRJc1N1YnRyZWVJbmFjY2Vzc2libGVcbiAgICB9KSA9PT0gZmFsc2UgOiB0cnVlO1xuICB9KTtcbn07XG5mdW5jdGlvbiBtYWtlUm9sZVNlbGVjdG9yKHJvbGUpIHtcbiAgY29uc3QgZXhwbGljaXRSb2xlU2VsZWN0b3IgPSBgKltyb2xlfj1cIiR7cm9sZX1cIl1gO1xuICBjb25zdCByb2xlUmVsYXRpb25zID0gX2FyaWFRdWVyeS5yb2xlRWxlbWVudHMuZ2V0KHJvbGUpID8/IG5ldyBTZXQoKTtcbiAgY29uc3QgaW1wbGljaXRSb2xlU2VsZWN0b3JzID0gbmV3IFNldChBcnJheS5mcm9tKHJvbGVSZWxhdGlvbnMpLm1hcCgoe1xuICAgIG5hbWVcbiAgfSkgPT4gbmFtZSkpO1xuXG4gIC8vIEN1cnJlbnQgdHJhbnNwaWxhdGlvbiBjb25maWcgc29tZXRpbWVzIGFzc3VtZXMgYC4uLmAgaXMgYWx3YXlzIGFwcGxpZWQgdG8gYXJyYXlzLlxuICAvLyBgLi4uYCBpcyBlcXVpdmFsZW50IHRvIGBBcnJheS5wcm90b3R5cGUuY29uY2F0YCBmb3IgYXJyYXlzLlxuICAvLyBJZiB5b3UgcmVwbGFjZSB0aGlzIGNvZGUgd2l0aCBgW2V4cGxpY2l0Um9sZVNlbGVjdG9yLCAuLi5pbXBsaWNpdFJvbGVTZWxlY3RvcnNdYCwgbWFrZSBzdXJlIGV2ZXJ5IHRyYW5zcGlsYXRpb24gdGFyZ2V0IHJldGFpbnMgdGhlIGAuLi5gIGluIGZhdm9yIG9mIGBBcnJheS5wcm90b3R5cGUuY29uY2F0YC5cbiAgcmV0dXJuIFtleHBsaWNpdFJvbGVTZWxlY3Rvcl0uY29uY2F0KEFycmF5LmZyb20oaW1wbGljaXRSb2xlU2VsZWN0b3JzKSkuam9pbignLCcpO1xufVxuY29uc3QgZ2V0TmFtZUhpbnQgPSBuYW1lID0+IHtcbiAgbGV0IG5hbWVIaW50ID0gJyc7XG4gIGlmIChuYW1lID09PSB1bmRlZmluZWQpIHtcbiAgICBuYW1lSGludCA9ICcnO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBuYW1lID09PSAnc3RyaW5nJykge1xuICAgIG5hbWVIaW50ID0gYCBhbmQgbmFtZSBcIiR7bmFtZX1cImA7XG4gIH0gZWxzZSB7XG4gICAgbmFtZUhpbnQgPSBgIGFuZCBuYW1lIFxcYCR7bmFtZX1cXGBgO1xuICB9XG4gIHJldHVybiBuYW1lSGludDtcbn07XG5jb25zdCBnZXRNdWx0aXBsZUVycm9yID0gKGMsIHJvbGUsIHtcbiAgbmFtZVxufSA9IHt9KSA9PiB7XG4gIHJldHVybiBgRm91bmQgbXVsdGlwbGUgZWxlbWVudHMgd2l0aCB0aGUgcm9sZSBcIiR7cm9sZX1cIiR7Z2V0TmFtZUhpbnQobmFtZSl9YDtcbn07XG5jb25zdCBnZXRNaXNzaW5nRXJyb3IgPSAoY29udGFpbmVyLCByb2xlLCB7XG4gIGhpZGRlbiA9ICgwLCBfYWxsVXRpbHMuZ2V0Q29uZmlnKSgpLmRlZmF1bHRIaWRkZW4sXG4gIG5hbWUsXG4gIGRlc2NyaXB0aW9uXG59ID0ge30pID0+IHtcbiAgaWYgKCgwLCBfYWxsVXRpbHMuZ2V0Q29uZmlnKSgpLl9kaXNhYmxlRXhwZW5zaXZlRXJyb3JEaWFnbm9zdGljcykge1xuICAgIHJldHVybiBgVW5hYmxlIHRvIGZpbmQgcm9sZT1cIiR7cm9sZX1cIiR7Z2V0TmFtZUhpbnQobmFtZSl9YDtcbiAgfVxuICBsZXQgcm9sZXMgPSAnJztcbiAgQXJyYXkuZnJvbShjb250YWluZXIuY2hpbGRyZW4pLmZvckVhY2goY2hpbGRFbGVtZW50ID0+IHtcbiAgICByb2xlcyArPSAoMCwgX3JvbGVIZWxwZXJzLnByZXR0eVJvbGVzKShjaGlsZEVsZW1lbnQsIHtcbiAgICAgIGhpZGRlbixcbiAgICAgIGluY2x1ZGVEZXNjcmlwdGlvbjogZGVzY3JpcHRpb24gIT09IHVuZGVmaW5lZFxuICAgIH0pO1xuICB9KTtcbiAgbGV0IHJvbGVNZXNzYWdlO1xuICBpZiAocm9sZXMubGVuZ3RoID09PSAwKSB7XG4gICAgaWYgKGhpZGRlbiA9PT0gZmFsc2UpIHtcbiAgICAgIHJvbGVNZXNzYWdlID0gJ1RoZXJlIGFyZSBubyBhY2Nlc3NpYmxlIHJvbGVzLiBCdXQgdGhlcmUgbWlnaHQgYmUgc29tZSBpbmFjY2Vzc2libGUgcm9sZXMuICcgKyAnSWYgeW91IHdpc2ggdG8gYWNjZXNzIHRoZW0sIHRoZW4gc2V0IHRoZSBgaGlkZGVuYCBvcHRpb24gdG8gYHRydWVgLiAnICsgJ0xlYXJuIG1vcmUgYWJvdXQgdGhpcyBoZXJlOiBodHRwczovL3Rlc3RpbmctbGlicmFyeS5jb20vZG9jcy9kb20tdGVzdGluZy1saWJyYXJ5L2FwaS1xdWVyaWVzI2J5cm9sZSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvbGVNZXNzYWdlID0gJ1RoZXJlIGFyZSBubyBhdmFpbGFibGUgcm9sZXMuJztcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgcm9sZU1lc3NhZ2UgPSBgXG5IZXJlIGFyZSB0aGUgJHtoaWRkZW4gPT09IGZhbHNlID8gJ2FjY2Vzc2libGUnIDogJ2F2YWlsYWJsZSd9IHJvbGVzOlxuXG4gICR7cm9sZXMucmVwbGFjZSgvXFxuL2csICdcXG4gICcpLnJlcGxhY2UoL1xcblxcc1xcc1xcbi9nLCAnXFxuXFxuJyl9XG5gLnRyaW0oKTtcbiAgfVxuICBsZXQgbmFtZUhpbnQgPSAnJztcbiAgaWYgKG5hbWUgPT09IHVuZGVmaW5lZCkge1xuICAgIG5hbWVIaW50ID0gJyc7XG4gIH0gZWxzZSBpZiAodHlwZW9mIG5hbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgbmFtZUhpbnQgPSBgIGFuZCBuYW1lIFwiJHtuYW1lfVwiYDtcbiAgfSBlbHNlIHtcbiAgICBuYW1lSGludCA9IGAgYW5kIG5hbWUgXFxgJHtuYW1lfVxcYGA7XG4gIH1cbiAgbGV0IGRlc2NyaXB0aW9uSGludCA9ICcnO1xuICBpZiAoZGVzY3JpcHRpb24gPT09IHVuZGVmaW5lZCkge1xuICAgIGRlc2NyaXB0aW9uSGludCA9ICcnO1xuICB9IGVsc2UgaWYgKHR5cGVvZiBkZXNjcmlwdGlvbiA9PT0gJ3N0cmluZycpIHtcbiAgICBkZXNjcmlwdGlvbkhpbnQgPSBgIGFuZCBkZXNjcmlwdGlvbiBcIiR7ZGVzY3JpcHRpb259XCJgO1xuICB9IGVsc2Uge1xuICAgIGRlc2NyaXB0aW9uSGludCA9IGAgYW5kIGRlc2NyaXB0aW9uIFxcYCR7ZGVzY3JpcHRpb259XFxgYDtcbiAgfVxuICByZXR1cm4gYFxuVW5hYmxlIHRvIGZpbmQgYW4gJHtoaWRkZW4gPT09IGZhbHNlID8gJ2FjY2Vzc2libGUgJyA6ICcnfWVsZW1lbnQgd2l0aCB0aGUgcm9sZSBcIiR7cm9sZX1cIiR7bmFtZUhpbnR9JHtkZXNjcmlwdGlvbkhpbnR9XG5cbiR7cm9sZU1lc3NhZ2V9YC50cmltKCk7XG59O1xuY29uc3QgcXVlcnlBbGxCeVJvbGVXaXRoU3VnZ2VzdGlvbnMgPSBleHBvcnRzLnF1ZXJ5QWxsQnlSb2xlID0gKDAsIF9xdWVyeUhlbHBlcnMud3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbikocXVlcnlBbGxCeVJvbGUsIHF1ZXJ5QWxsQnlSb2xlLm5hbWUsICdxdWVyeUFsbCcpO1xuY29uc3QgW3F1ZXJ5QnlSb2xlLCBnZXRBbGxCeVJvbGUsIGdldEJ5Um9sZSwgZmluZEFsbEJ5Um9sZSwgZmluZEJ5Um9sZV0gPSAoMCwgX2FsbFV0aWxzLmJ1aWxkUXVlcmllcykocXVlcnlBbGxCeVJvbGUsIGdldE11bHRpcGxlRXJyb3IsIGdldE1pc3NpbmdFcnJvcik7XG5leHBvcnRzLmZpbmRCeVJvbGUgPSBmaW5kQnlSb2xlO1xuZXhwb3J0cy5maW5kQWxsQnlSb2xlID0gZmluZEFsbEJ5Um9sZTtcbmV4cG9ydHMuZ2V0QnlSb2xlID0gZ2V0QnlSb2xlO1xuZXhwb3J0cy5nZXRBbGxCeVJvbGUgPSBnZXRBbGxCeVJvbGU7XG5leHBvcnRzLnF1ZXJ5QnlSb2xlID0gcXVlcnlCeVJvbGU7Il0sInZlcnNpb24iOjN9