{"file":"/home/runner/workspace/client/src/components/forms/DocumentFormBase.tsx","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA,4CA+KC;;AA3ND,+CAAmD;AAEnD,mDAAgD;AAChD,+CAAgF;AAChF,+CAA4C;AAC5C,iEAA6D;AAC7D,iEAA4D;AAC5D,0EAAkE;AAClE,+CAA2D;AAE3D,uDAAmD;AA0BnD;;;;;;;GAOG;AACH,SAAgB,gBAAgB,CAAqC,EACnE,KAAK,EACL,MAAM,EACN,aAAa,EACb,WAAW,EACX,QAAQ,EACR,IAAI,GAAG,QAAQ,EACf,MAAM,EACN,UAAU,EACV,WAAW,EACX,SAAS,EACT,QAAQ,EACR,eAAe,EACf,QAAQ,EACR,oBAAoB,EACpB,aAAa,EACb,QAAQ,GAAG,IAAI,EACf,aAAa,EAAE,MAAM,GACI;IACzB,MAAM,EAAE,CAAC,EAAE,GAAG,IAAA,0BAAW,GAAE,CAAC;IAC5B,MAAM,CAAC,gBAAgB,EAAE,mBAAmB,CAAC,GAAG,IAAA,gBAAQ,EAAgB,IAAI,CAAC,CAAC;IAC9E,MAAM,CAAC,cAAc,EAAE,iBAAiB,CAAC,GAAG,IAAA,gBAAQ,EAAC,KAAK,CAAC,CAAC;IAE5D,yCAAyC;IACzC,MAAM,YAAY,GAAG,IAAA,mCAAe,EAAC;QACnC,MAAM;QACN,aAAa;QACb,WAAW;QACX,QAAQ;QACR,IAAI;QACJ,MAAM;QACN,SAAS;QACT,eAAe;KAChB,CAAC,CAAC;IAEH,MAAM,oBAAoB,GAAG,CAAC,UAAkB,EAAE,IAAU,EAAE,EAAE;QAC9D,mBAAmB,CAAC,UAAU,CAAC,CAAC;QAEhC,qCAAqC;QACrC,IAAI,IAAI,CAAC,IAAI,KAAK,iBAAiB,IAAI,oBAAoB,EAAE,CAAC;YAC5D,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAC1B,CAAC;IACH,CAAC,CAAC;IAEF,MAAM,oBAAoB,GAAG,GAAG,EAAE;QAChC,mBAAmB,CAAC,IAAI,CAAC,CAAC;QAC1B,iBAAiB,CAAC,KAAK,CAAC,CAAC;IAC3B,CAAC,CAAC;IAEF,MAAM,QAAQ,GAAG,CAAC,IAAgB,EAAE,EAAE;QACpC,MAAM,QAAQ,GAAG;YACf,GAAG,IAAI;YACP,UAAU;YACV,WAAW;YACX,UAAU,EAAE,gBAAgB,IAAI,SAAS;SAC1C,CAAC;QACF,YAAY,CAAC,cAAc,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC;IAC/C,CAAC,CAAC;IAEF,MAAM,WAAW,GAAG,CAClB,gCAAK,SAAS,EAAC,WAAW,YACxB,uBAAC,WAAI,OAAK,YAAY,CAAC,IAAI,YACzB,kCAAM,QAAQ,EAAE,YAAY,CAAC,YAAY,CAAC,QAAQ,CAAC,EAAE,SAAS,EAAC,WAAW,aACvE,QAAQ,CAAC,YAAY,CAAC,EAEvB,iCAAK,SAAS,EAAC,0CAA0C,aACtD,QAAQ,IAAI,CACX,wBAAC,eAAM,IACL,IAAI,EAAC,QAAQ,EACb,OAAO,EAAC,SAAS,EACjB,OAAO,EAAE,QAAQ,iBACL,eAAe,aAE3B,uBAAC,gBAAC,IAAC,SAAS,EAAC,cAAc,GAAG,cAEvB,CACV,EACD,wBAAC,eAAM,IACL,IAAI,EAAC,QAAQ,EACb,QAAQ,EAAE,YAAY,CAAC,YAAY,iBACvB,eAAe,aAE3B,uBAAC,mBAAI,IAAC,SAAS,EAAC,cAAc,GAAG,EAChC,YAAY,CAAC,YAAY;wCACxB,CAAC,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,aAAa,CAAC;wCACrD,CAAC,CAAC,CAAC,IAAI,KAAK,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,QAAQ,CAAC,IAEtC,IACL,IACD,GACF,GACH,CACP,CAAC;IAEF,IAAI,CAAC,QAAQ,EAAE,CAAC;QACd,OAAO,CACL,uBAAC,4BAAY,IACX,KAAK,EAAE,KAAK,EACZ,SAAS,EAAC,mBAAmB,iBAChB,MAAM,YAElB,WAAW,GACC,CAChB,CAAC;IACJ,CAAC;IAED,OAAO,CACL,wBAAC,4BAAY,IACX,KAAK,EAAE,KAAK,EACZ,SAAS,EAAC,mBAAmB,iBAChB,MAAM,aAEnB,wBAAC,WAAI,IAAC,YAAY,EAAC,MAAM,EAAC,SAAS,EAAC,QAAQ,aAC1C,wBAAC,eAAQ,IAAC,SAAS,EAAC,yBAAyB,aAC3C,wBAAC,kBAAW,IAAC,KAAK,EAAC,MAAM,iBAAa,UAAU,aAC9C,uBAAC,uBAAQ,IAAC,SAAS,EAAC,cAAc,GAAG,kBAEzB,EACd,wBAAC,kBAAW,IAAC,KAAK,EAAC,IAAI,EAAC,QAAQ,EAAE,CAAC,oBAAoB,iBAAc,QAAQ,aAC3E,uBAAC,uBAAQ,IAAC,SAAS,EAAC,cAAc,GAAG,kBAEzB,IACL,EAEX,uBAAC,kBAAW,IAAC,KAAK,EAAC,MAAM,EAAC,SAAS,EAAC,MAAM,YACvC,WAAW,GACA,EAEd,uBAAC,kBAAW,IAAC,KAAK,EAAC,IAAI,EAAC,SAAS,EAAC,MAAM,YACrC,oBAAoB,IAAI,CACvB,iCAAK,SAAS,EAAC,WAAW,aACvB,oBAAoB,EACpB,cAAc,IAAI,CACjB,iCAAK,SAAS,EAAC,kBAAkB,aAC/B,gCAAK,SAAS,EAAC,sEAAsE,GAAO,EAC5F,8BAAG,SAAS,EAAC,4BAA4B,uCAA2B,IAChE,CACP,IACG,CACP,GACW,IACT,EAEN,aAAa,IAAI,CAChB,iCAAK,SAAS,EAAC,oBAAoB,aACjC,uBAAC,oCAAc,IACb,gBAAgB,EAAE,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE;4BAC/B,IAAI,IAAI,EAAE,CAAC;gCACT,oBAAoB,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;4BACxC,CAAC;wBACH,CAAC,EACD,gBAAgB,EAAE,CAAC,iBAAiB,EAAE,YAAY,EAAE,WAAW,EAAE,WAAW,CAAC,EAC7E,WAAW,EAAE,EAAE,EACf,SAAS,EAAC,MAAM,GAChB,EAED,gBAAgB,IAAI,CACnB,gCAAK,SAAS,EAAC,gCAAgC,YAC7C,iCAAK,SAAS,EAAC,mCAAmC,aAChD,iCAAM,SAAS,EAAC,qBAAqB,kCAAyB,EAC9D,uBAAC,eAAM,IACL,OAAO,EAAC,OAAO,EACf,IAAI,EAAC,IAAI,EACT,OAAO,EAAE,oBAAoB,iBACjB,wBAAwB,YAEpC,uBAAC,gBAAC,IAAC,SAAS,EAAC,SAAS,GAAG,GAClB,IACL,GACF,CACP,IACG,CACP,IACY,CAChB,CAAC;AACJ,CAAC","names":[],"sources":["/home/runner/workspace/client/src/components/forms/DocumentFormBase.tsx"],"sourcesContent":["import React, { ReactNode, useState } from 'react';\nimport { z } from 'zod';\nimport { Button } from '@/components/ui/button';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { Form } from '@/components/ui/form';\nimport { StandardCard } from '@/components/ui/standard-card';\nimport { useStandardForm } from '@/hooks/use-standard-form';\nimport { SharedUploader } from '@/components/document-management';\nimport { FileText, Sparkles, Save, X } from 'lucide-react';\nimport { cn } from '@/lib/utils';\nimport { useLanguage } from '@/hooks/use-language';\nimport type { UploadContext } from '@shared/config/upload-config';\n\ninterface DocumentFormBaseProps<T extends z.ZodType<any, any, any>> {\n  title: string;\n  schema: T;\n  defaultValues: Partial<z.infer<T>>;\n  apiEndpoint: string;\n  queryKey: string[];\n  mode?: 'create' | 'edit';\n  itemId?: string;\n  buildingId?: string;\n  residenceId?: string;\n  onSuccess?: () => void;\n  onCancel?: () => void;\n  successMessages?: {\n    create?: string;\n    update?: string;\n  };\n  children: (formControls: ReturnType<typeof useStandardForm<T>>) => ReactNode;\n  aiExtractorComponent?: ReactNode;\n  uploadContext?: UploadContext;\n  showTabs?: boolean;\n  'data-testid'?: string;\n}\n\n/**\n * Base component for document-based forms (Bills, Invoices, etc.).\n * Provides common structure including AI extraction, file upload, and form submission.\n * Consolidates patterns from ModularBillForm and InvoiceForm.\n * \n * @param props - Configuration and render props for the document form\n * @returns Standardized document form with consistent UX patterns\n */\nexport function DocumentFormBase<T extends z.ZodType<any, any, any>>({\n  title,\n  schema,\n  defaultValues,\n  apiEndpoint,\n  queryKey,\n  mode = 'create',\n  itemId,\n  buildingId,\n  residenceId,\n  onSuccess,\n  onCancel,\n  successMessages,\n  children,\n  aiExtractorComponent,\n  uploadContext,\n  showTabs = true,\n  'data-testid': testId,\n}: DocumentFormBaseProps<T>) {\n  const { t } = useLanguage();\n  const [uploadedDocument, setUploadedDocument] = useState<string | null>(null);\n  const [isAiProcessing, setIsAiProcessing] = useState(false);\n\n  // Initialize form with standard patterns\n  const formControls = useStandardForm({\n    schema,\n    defaultValues,\n    apiEndpoint,\n    queryKey,\n    mode,\n    itemId,\n    onSuccess,\n    successMessages,\n  });\n\n  const handleDocumentUpload = (documentId: string, file: File) => {\n    setUploadedDocument(documentId);\n    \n    // Trigger AI processing if available\n    if (file.type === 'application/pdf' && aiExtractorComponent) {\n      setIsAiProcessing(true);\n    }\n  };\n\n  const handleDocumentRemove = () => {\n    setUploadedDocument(null);\n    setIsAiProcessing(false);\n  };\n\n  const onSubmit = (data: z.infer<T>) => {\n    const formData = {\n      ...data,\n      buildingId,\n      residenceId,\n      documentId: uploadedDocument || undefined,\n    };\n    formControls.submitMutation.mutate(formData);\n  };\n\n  const formContent = (\n    <div className=\"space-y-6\">\n      <Form {...formControls.form}>\n        <form onSubmit={formControls.handleSubmit(onSubmit)} className=\"space-y-6\">\n          {children(formControls)}\n          \n          <div className=\"flex justify-end space-x-3 pt-6 border-t\">\n            {onCancel && (\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={onCancel}\n                data-testid=\"button-cancel\"\n              >\n                <X className=\"w-4 h-4 mr-2\" />\n                Cancel\n              </Button>\n            )}\n            <Button\n              type=\"submit\"\n              disabled={formControls.isSubmitting}\n              data-testid=\"button-submit\"\n            >\n              <Save className=\"w-4 h-4 mr-2\" />\n              {formControls.isSubmitting \n                ? (mode === 'create' ? 'Creating...' : 'Updating...') \n                : (mode === 'create' ? 'Create' : 'Update')\n              }\n            </Button>\n          </div>\n        </form>\n      </Form>\n    </div>\n  );\n\n  if (!showTabs) {\n    return (\n      <StandardCard\n        title={title}\n        className=\"max-w-4xl mx-auto\"\n        data-testid={testId}\n      >\n        {formContent}\n      </StandardCard>\n    );\n  }\n\n  return (\n    <StandardCard\n      title={title}\n      className=\"max-w-4xl mx-auto\"\n      data-testid={testId}\n    >\n      <Tabs defaultValue=\"form\" className=\"w-full\">\n        <TabsList className=\"grid w-full grid-cols-2\">\n          <TabsTrigger value=\"form\" data-testid=\"tab-form\">\n            <FileText className=\"w-4 h-4 mr-2\" />\n            Form Entry\n          </TabsTrigger>\n          <TabsTrigger value=\"ai\" disabled={!aiExtractorComponent} data-testid=\"tab-ai\">\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            AI Extract\n          </TabsTrigger>\n        </TabsList>\n        \n        <TabsContent value=\"form\" className=\"mt-6\">\n          {formContent}\n        </TabsContent>\n        \n        <TabsContent value=\"ai\" className=\"mt-6\">\n          {aiExtractorComponent && (\n            <div className=\"space-y-6\">\n              {aiExtractorComponent}\n              {isAiProcessing && (\n                <div className=\"text-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto\"></div>\n                  <p className=\"mt-2 text-sm text-gray-600\">Processing document...</p>\n                </div>\n              )}\n            </div>\n          )}\n        </TabsContent>\n      </Tabs>\n      \n      {uploadContext && (\n        <div className=\"mt-6 pt-6 border-t\">\n          <SharedUploader\n            onDocumentChange={(file, text) => {\n              if (file) {\n                handleDocumentUpload(file.name, file);\n              }\n            }}\n            allowedFileTypes={['application/pdf', 'image/jpeg', 'image/png', 'image/jpg']}\n            maxFileSize={10}\n            className=\"mt-4\"\n          />\n          \n          {uploadedDocument && (\n            <div className=\"mt-4 p-4 bg-gray-50 rounded-lg\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-sm font-medium\">Document uploaded</span>\n                <Button\n                  variant=\"ghost\"\n                  size=\"sm\"\n                  onClick={handleDocumentRemove}\n                  data-testid=\"button-remove-document\"\n                >\n                  <X className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </StandardCard>\n  );\n}"],"version":3}