{"file":"/home/runner/workspace/client/src/pages/residents/ResidenceDocuments.tsx","mappings":"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","names":[],"sources":["/home/runner/workspace/client/src/pages/residents/ResidenceDocuments.tsx"],"sourcesContent":["import { useQuery } from '@tanstack/react-query';\nimport { useLocation, useParams } from 'wouter';\nimport { apiRequest } from '@/lib/queryClient';\nimport DocumentManager from '@/components/common/DocumentManager';\nimport { Button } from '@/components/ui/button';\nimport { ArrowLeft } from 'lucide-react';\nimport { useLanguage } from '@/hooks/use-language';\n\nexport default function ResidenceDocuments() {\n  const [, navigate] = useLocation();\n  const params = useParams();\n  const { t } = useLanguage();\n\n  // Get residenceId from URL (both path param and query param)\n  const urlParams = new URLSearchParams(window.location.search);\n  const residenceId = (params as any).residenceId || urlParams.get('residenceId');\n\n  // Get current user\n  const { data: user } = useQuery({\n    queryKey: ['/api/auth/user'],\n    queryFn: () => apiRequest('GET', '/api/auth/user') as Promise<any>,\n  });\n\n  // Get residence info\n  const {\n    data: residence,\n    isError: residenceError,\n    error,\n  } = useQuery({\n    queryKey: ['/api/residences', residenceId],\n    queryFn: async () => {\n      console.log('üîç ResidenceDocuments: Fetching residence data for ID:', residenceId);\n      const response = await fetch(`/api/residences/${residenceId}`, {\n        credentials: 'include',\n      });\n      if (!response.ok) {\n        if (response.status === 404) {\n          throw new Error('RESIDENCE_NOT_FOUND');\n        }\n        throw new Error('Failed to fetch residence');\n      }\n      const data = await response.json();\n      console.log('üîç ResidenceDocuments: Residence API response:', data);\n      return data;\n    },\n    enabled: !!residenceId,\n    retry: false, // Don't retry on 404s\n  });\n\n  if (!residenceId) {\n    return (\n      <div className='flex-1 flex flex-col overflow-hidden'>\n        <div className='flex-1 flex items-center justify-center'>\n          <div className='text-center'>\n            <p className='text-gray-500 mb-4'>Residence ID is required</p>\n            <Button\n              variant='outline'\n              onClick={() => navigate('/residents/residence')}\n              data-testid='button-back-to-residences'\n            >\n              <ArrowLeft className='w-4 h-4 mr-2' />\n              Back to Residences\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Handle residence not found\n  if (residenceError && error?.message === 'RESIDENCE_NOT_FOUND') {\n    return (\n      <div className='flex-1 flex flex-col overflow-hidden'>\n        <div className='flex-1 flex items-center justify-center'>\n          <div className='text-center max-w-md'>\n            <h2 className='text-xl font-semibold mb-4'>Residence Not Found</h2>\n            <p className='text-gray-500 mb-4'>\n              The residence ID \"{residenceId}\" doesn't exist in the development database.\n            </p>\n            <p className='text-sm text-gray-400 mb-6'>\n              This might be a production database ID. Please use a valid development residence ID.\n            </p>\n            <div className='space-y-2'>\n              <Button\n                variant='default'\n                onClick={() => navigate('/residents/residence')}\n                data-testid='button-back-to-residences'\n                className='w-full'\n              >\n                <ArrowLeft className='w-4 h-4 mr-2' />\n                Back to Residences\n              </Button>\n              <Button\n                variant='outline'\n                onClick={() =>\n                  navigate('/residents/residences/e27ac924-8120-4904-a791-d1e9db544d58/documents')\n                }\n                data-testid='button-go-to-valid-residence'\n                className='w-full'\n              >\n                Go to Unit 101 (Test Residence)\n              </Button>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const isUserTenant = user?.role === 'tenant';\n  const residenceName =\n    residence?.unitNumber || residence?.unit_number\n      ? `Unit ${residence.unitNumber || residence.unit_number}`\n      : 'Residence';\n\n  return (\n    <div className='flex-1 flex flex-col overflow-hidden'>\n      {/* Back button */}\n      <div className='p-6 pb-0'>\n        <Button\n          variant='outline'\n          onClick={() => navigate('/residents/residence')}\n          className='mb-4'\n          data-testid='button-back'\n        >\n          <ArrowLeft className='w-4 h-4 mr-2' />\n          {t('backToResidences')}\n        </Button>\n      </div>\n\n      <DocumentManager\n        config={{\n          type: 'residence',\n          userRole: 'resident',\n          entityId: residenceId,\n          entityName: residenceName,\n          entityAddress: residence?.address,\n          allowCreate: !isUserTenant,\n          allowEdit: !isUserTenant,\n          allowDelete: !isUserTenant,\n          showVisibilityToggle: !isUserTenant,\n        }}\n      />\n    </div>\n  );\n}\n"],"version":3}