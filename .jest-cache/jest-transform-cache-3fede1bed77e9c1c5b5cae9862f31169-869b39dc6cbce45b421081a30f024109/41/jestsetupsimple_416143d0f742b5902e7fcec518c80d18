cb7606c761e71ba078efbe938f2bed78
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Mock basic hooks with proper ES module export
jest.mock('@/hooks/use-language', () => {
    const mockUseLanguage = () => ({
        t: (key) => key,
        language: 'en',
        setLanguage: jest.fn(),
        toggleLanguage: jest.fn(),
    });
    return {
        __esModule: true,
        useLanguage: mockUseLanguage,
        LanguageProvider: ({ children }) => children,
        default: mockUseLanguage,
    };
});
jest.mock('@/hooks/use-toast', () => ({
    __esModule: true,
    useToast: () => ({
        toast: jest.fn(),
    }),
}));
jest.mock('@/hooks/use-auth', () => ({
    __esModule: true,
    useAuth: () => ({
        user: { id: '1', username: 'test', role: 'admin' },
        isAuthenticated: true,
        login: jest.fn(),
        logout: jest.fn(),
    }),
}));
// Mock useMobileMenu hook
jest.mock('@/hooks/use-mobile-menu', () => ({
    __esModule: true,
    useMobileMenu: () => ({
        isMobileMenuOpen: false,
        toggleMobileMenu: jest.fn(),
    }),
}));
// Mock drizzle-zod to fix compatibility issues
jest.mock('drizzle-zod', () => ({
    createInsertSchema: jest.fn().mockImplementation(() => ({
        parse: jest.fn(),
        safeParse: jest.fn().mockReturnValue({ success: true, data: {} }),
        omit: jest.fn().mockReturnThis(),
        extend: jest.fn().mockReturnThis(),
    })),
    createSelectSchema: jest.fn().mockImplementation(() => ({
        parse: jest.fn(),
        safeParse: jest.fn().mockReturnValue({ success: true, data: {} }),
    })),
}));
// Mock database operations simply
jest.mock('drizzle-orm', () => ({
    eq: jest.fn(),
    and: jest.fn(),
    or: jest.fn(),
    sql: jest.fn(),
    desc: jest.fn(),
    asc: jest.fn(),
}));
jest.mock('./server/db', () => ({
    db: mockDb,
    default: mockDb
}));
// Mock bcrypt
jest.mock('bcryptjs', () => ({
    hash: jest.fn().mockResolvedValue('mock-hashed-password'),
    compare: jest.fn().mockResolvedValue(true),
}));
// Mock query client
jest.mock('@/lib/queryClient', () => ({
    apiRequest: jest.fn().mockResolvedValue({ success: true, data: [] }),
    queryClient: {
        invalidateQueries: jest.fn(),
    },
}));
// Simplified Jest setup file - minimal mocking to prevent hanging
require("@testing-library/jest-dom");
// Fix Node.js environment issues for integration tests
if (typeof globalThis.TextEncoder === 'undefined') {
    const { TextEncoder, TextDecoder } = require('util');
    globalThis.TextEncoder = TextEncoder;
    globalThis.TextDecoder = TextDecoder;
}
// Set test environment variables
process.env.TEST_TYPE = 'unit';
process.env.USE_MOCK_DB = 'true';
process.env.NODE_ENV = 'test';
// Mock fetch for tests
global.fetch = jest.fn().mockImplementation(() => Promise.resolve({
    ok: true,
    status: 200,
    json: async () => ({ success: true, data: [] }),
    text: async () => '{"success": true, "data": []}'
}));
// Mock basic browser APIs
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: jest.fn().mockImplementation((query) => ({
        matches: false,
        media: query,
        onchange: null,
        addListener: jest.fn(),
        removeListener: jest.fn(),
        addEventListener: jest.fn(),
        removeEventListener: jest.fn(),
        dispatchEvent: jest.fn(),
    })),
});
global.ResizeObserver = jest.fn().mockImplementation(() => ({
    observe: jest.fn(),
    unobserve: jest.fn(),
    disconnect: jest.fn(),
}));
global.IntersectionObserver = jest.fn().mockImplementation(() => ({
    observe: jest.fn(),
    unobserve: jest.fn(),
    disconnect: jest.fn(),
}));
// Mock storage
const createMockStorage = () => ({
    getItem: jest.fn(() => null),
    setItem: jest.fn(),
    removeItem: jest.fn(),
    clear: jest.fn(),
    length: 0,
    key: jest.fn(() => null),
});
Object.defineProperty(window, 'sessionStorage', {
    value: createMockStorage(),
});
Object.defineProperty(window, 'localStorage', {
    value: createMockStorage(),
});
// Mock database connection
const mockDb = {
    query: jest.fn().mockResolvedValue([]),
    insert: jest.fn(() => ({
        values: jest.fn(() => ({
            returning: jest.fn().mockResolvedValue([{ id: 'mock-id' }])
        }))
    })),
    select: jest.fn(() => ({
        from: jest.fn(() => Promise.resolve([]))
    })),
    update: jest.fn(() => ({
        set: jest.fn(() => ({
            where: jest.fn(() => Promise.resolve({ affectedRows: 1 }))
        }))
    })),
    delete: jest.fn(() => ({
        where: jest.fn(() => Promise.resolve({ affectedRows: 1 }))
    })),
};
// Note: Server API route mocks are handled via moduleNameMapper in Jest config
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDM0QsQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0lBQ0gsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUNyQixLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDM0QsQ0FBQyxDQUFDO0NBQ0osQ0FBQztBQXFCRiwrRUFBK0UiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9qZXN0LnNldHVwLnNpbXBsZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBTaW1wbGlmaWVkIEplc3Qgc2V0dXAgZmlsZSAtIG1pbmltYWwgbW9ja2luZyB0byBwcmV2ZW50IGhhbmdpbmdcbmltcG9ydCAnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbSc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG4vLyBGaXggTm9kZS5qcyBlbnZpcm9ubWVudCBpc3N1ZXMgZm9yIGludGVncmF0aW9uIHRlc3RzXG5pZiAodHlwZW9mIGdsb2JhbFRoaXMuVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVGV4dEVuY29kZXIsIFRleHREZWNvZGVyIH0gPSByZXF1aXJlKCd1dGlsJyk7XG4gIGdsb2JhbFRoaXMuVGV4dEVuY29kZXIgPSBUZXh0RW5jb2RlcjtcbiAgZ2xvYmFsVGhpcy5UZXh0RGVjb2RlciA9IFRleHREZWNvZGVyO1xufVxuXG4vLyBTZXQgdGVzdCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcbnByb2Nlc3MuZW52LlRFU1RfVFlQRSA9ICd1bml0JztcbnByb2Nlc3MuZW52LlVTRV9NT0NLX0RCID0gJ3RydWUnO1xucHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG5cbi8vIE1vY2sgZmV0Y2ggZm9yIHRlc3RzXG5nbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IFxuICBQcm9taXNlLnJlc29sdmUoe1xuICAgIG9rOiB0cnVlLFxuICAgIHN0YXR1czogMjAwLFxuICAgIGpzb246IGFzeW5jICgpID0+ICh7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFtdIH0pLFxuICAgIHRleHQ6IGFzeW5jICgpID0+ICd7XCJzdWNjZXNzXCI6IHRydWUsIFwiZGF0YVwiOiBbXX0nXG4gIH0pXG4pO1xuXG4vLyBNb2NrIGJhc2ljIGJyb3dzZXIgQVBJc1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ21hdGNoTWVkaWEnLCB7XG4gIHdyaXRhYmxlOiB0cnVlLFxuICB2YWx1ZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigocXVlcnkpID0+ICh7XG4gICAgbWF0Y2hlczogZmFsc2UsXG4gICAgbWVkaWE6IHF1ZXJ5LFxuICAgIG9uY2hhbmdlOiBudWxsLFxuICAgIGFkZExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgcmVtb3ZlTGlzdGVuZXI6IGplc3QuZm4oKSxcbiAgICBhZGRFdmVudExpc3RlbmVyOiBqZXN0LmZuKCksXG4gICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogamVzdC5mbigpLFxuICAgIGRpc3BhdGNoRXZlbnQ6IGplc3QuZm4oKSxcbiAgfSkpLFxufSk7XG5cbmdsb2JhbC5SZXNpemVPYnNlcnZlciA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgb2JzZXJ2ZTogamVzdC5mbigpLFxuICB1bm9ic2VydmU6IGplc3QuZm4oKSxcbiAgZGlzY29ubmVjdDogamVzdC5mbigpLFxufSkpO1xuXG5nbG9iYWwuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gIG9ic2VydmU6IGplc3QuZm4oKSxcbiAgdW5vYnNlcnZlOiBqZXN0LmZuKCksXG4gIGRpc2Nvbm5lY3Q6IGplc3QuZm4oKSxcbn0pKTtcblxuLy8gTW9jayBzdG9yYWdlXG5jb25zdCBjcmVhdGVNb2NrU3RvcmFnZSA9ICgpID0+ICh7XG4gIGdldEl0ZW06IGplc3QuZm4oKCkgPT4gbnVsbCksXG4gIHNldEl0ZW06IGplc3QuZm4oKSxcbiAgcmVtb3ZlSXRlbTogamVzdC5mbigpLFxuICBjbGVhcjogamVzdC5mbigpLFxuICBsZW5ndGg6IDAsXG4gIGtleTogamVzdC5mbigoKSA9PiBudWxsKSxcbn0pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnc2Vzc2lvblN0b3JhZ2UnLCB7XG4gIHZhbHVlOiBjcmVhdGVNb2NrU3RvcmFnZSgpLFxufSk7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdsb2NhbFN0b3JhZ2UnLCB7XG4gIHZhbHVlOiBjcmVhdGVNb2NrU3RvcmFnZSgpLFxufSk7XG5cbi8vIE1vY2sgYmFzaWMgaG9va3Mgd2l0aCBwcm9wZXIgRVMgbW9kdWxlIGV4cG9ydFxuamVzdC5tb2NrKCdAL2hvb2tzL3VzZS1sYW5ndWFnZScsICgpID0+IHtcbiAgY29uc3QgbW9ja1VzZUxhbmd1YWdlID0gKCkgPT4gKHtcbiAgICB0OiAoa2V5OiBzdHJpbmcpID0+IGtleSxcbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICBzZXRMYW5ndWFnZTogamVzdC5mbigpLFxuICAgIHRvZ2dsZUxhbmd1YWdlOiBqZXN0LmZuKCksXG4gIH0pO1xuICBcbiAgcmV0dXJuIHtcbiAgICBfX2VzTW9kdWxlOiB0cnVlLFxuICAgIHVzZUxhbmd1YWdlOiBtb2NrVXNlTGFuZ3VhZ2UsXG4gICAgTGFuZ3VhZ2VQcm92aWRlcjogKHsgY2hpbGRyZW4gfTogeyBjaGlsZHJlbjogUmVhY3QuUmVhY3ROb2RlIH0pID0+IGNoaWxkcmVuLFxuICAgIGRlZmF1bHQ6IG1vY2tVc2VMYW5ndWFnZSxcbiAgfTtcbn0pO1xuXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlLXRvYXN0JywgKCkgPT4gKHtcbiAgX19lc01vZHVsZTogdHJ1ZSxcbiAgdXNlVG9hc3Q6ICgpID0+ICh7XG4gICAgdG9hc3Q6IGplc3QuZm4oKSxcbiAgfSksXG59KSk7XG5cbmplc3QubW9jaygnQC9ob29rcy91c2UtYXV0aCcsICgpID0+ICh7XG4gIF9fZXNNb2R1bGU6IHRydWUsXG4gIHVzZUF1dGg6ICgpID0+ICh7XG4gICAgdXNlcjogeyBpZDogJzEnLCB1c2VybmFtZTogJ3Rlc3QnLCByb2xlOiAnYWRtaW4nIH0sXG4gICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgIGxvZ2luOiBqZXN0LmZuKCksXG4gICAgbG9nb3V0OiBqZXN0LmZuKCksXG4gIH0pLFxufSkpO1xuXG4vLyBNb2NrIHVzZU1vYmlsZU1lbnUgaG9va1xuamVzdC5tb2NrKCdAL2hvb2tzL3VzZS1tb2JpbGUtbWVudScsICgpID0+ICh7XG4gIF9fZXNNb2R1bGU6IHRydWUsXG4gIHVzZU1vYmlsZU1lbnU6ICgpID0+ICh7XG4gICAgaXNNb2JpbGVNZW51T3BlbjogZmFsc2UsXG4gICAgdG9nZ2xlTW9iaWxlTWVudTogamVzdC5mbigpLFxuICB9KSxcbn0pKTtcblxuLy8gTW9jayBkcml6emxlLXpvZCB0byBmaXggY29tcGF0aWJpbGl0eSBpc3N1ZXNcbmplc3QubW9jaygnZHJpenpsZS16b2QnLCAoKSA9PiAoe1xuICBjcmVhdGVJbnNlcnRTY2hlbWE6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBwYXJzZTogamVzdC5mbigpLFxuICAgIHNhZmVQYXJzZTogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IHt9IH0pLFxuICAgIG9taXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgIGV4dGVuZDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gIH0pKSxcbiAgY3JlYXRlU2VsZWN0U2NoZW1hOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgcGFyc2U6IGplc3QuZm4oKSxcbiAgICBzYWZlUGFyc2U6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiB7fSB9KSxcbiAgfSkpLFxufSkpO1xuXG4vLyBNb2NrIGRhdGFiYXNlIG9wZXJhdGlvbnMgc2ltcGx5XG5qZXN0Lm1vY2soJ2RyaXp6bGUtb3JtJywgKCkgPT4gKHtcbiAgZXE6IGplc3QuZm4oKSxcbiAgYW5kOiBqZXN0LmZuKCksXG4gIG9yOiBqZXN0LmZuKCksXG4gIHNxbDogamVzdC5mbigpLFxuICBkZXNjOiBqZXN0LmZuKCksXG4gIGFzYzogamVzdC5mbigpLFxufSkpO1xuXG4vLyBNb2NrIGRhdGFiYXNlIGNvbm5lY3Rpb25cbmNvbnN0IG1vY2tEYiA9IHtcbiAgcXVlcnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXSksXG4gIGluc2VydDogamVzdC5mbigoKSA9PiAoe1xuICAgIHZhbHVlczogamVzdC5mbigoKSA9PiAoe1xuICAgICAgcmV0dXJuaW5nOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW3sgaWQ6ICdtb2NrLWlkJyB9XSlcbiAgICB9KSlcbiAgfSkpLFxuICBzZWxlY3Q6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBmcm9tOiBqZXN0LmZuKCgpID0+IFByb21pc2UucmVzb2x2ZShbXSkpXG4gIH0pKSxcbiAgdXBkYXRlOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgc2V0OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICB3aGVyZTogamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoeyBhZmZlY3RlZFJvd3M6IDEgfSkpXG4gICAgfSkpXG4gIH0pKSxcbiAgZGVsZXRlOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgd2hlcmU6IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKHsgYWZmZWN0ZWRSb3dzOiAxIH0pKVxuICB9KSksXG59O1xuXG5qZXN0Lm1vY2soJy4vc2VydmVyL2RiJywgKCkgPT4gKHtcbiAgZGI6IG1vY2tEYixcbiAgZGVmYXVsdDogbW9ja0RiXG59KSk7XG5cbi8vIE1vY2sgYmNyeXB0XG5qZXN0Lm1vY2soJ2JjcnlwdGpzJywgKCkgPT4gKHtcbiAgaGFzaDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdtb2NrLWhhc2hlZC1wYXNzd29yZCcpLFxuICBjb21wYXJlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG59KSk7XG5cbi8vIE1vY2sgcXVlcnkgY2xpZW50XG5qZXN0Lm1vY2soJ0AvbGliL3F1ZXJ5Q2xpZW50JywgKCkgPT4gKHtcbiAgYXBpUmVxdWVzdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogW10gfSksXG4gIHF1ZXJ5Q2xpZW50OiB7XG4gICAgaW52YWxpZGF0ZVF1ZXJpZXM6IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gTm90ZTogU2VydmVyIEFQSSByb3V0ZSBtb2NrcyBhcmUgaGFuZGxlZCB2aWEgbW9kdWxlTmFtZU1hcHBlciBpbiBKZXN0IGNvbmZpZyJdLCJ2ZXJzaW9uIjozfQ==