1b19378c8497c3e7766d845c45c9e5f6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Performance: Mock expensive external dependencies
jest.mock('@google/genai', () => ({
    GoogleGenAI: jest.fn().mockImplementation(() => ({
        getGenerativeModel: jest.fn().mockReturnValue({
            generateContent: jest.fn().mockResolvedValue({
                response: {
                    text: () => 'Mock AI response',
                },
            }),
        }),
    })),
}));
// Performance: Mock database for unit tests to avoid network calls
jest.mock('./server/db', () => {
    const { mockDb, mockSql } = require('./tests/mocks/database');
    return {
        db: mockDb,
        sql: mockSql,
        pool: mockSql,
    };
});
// Mock email service to prevent actual SendGrid calls during tests
jest.mock('./server/services/email-service', () => ({
    emailService: {
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    },
    EmailService: jest.fn().mockImplementation(() => ({
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    }))
}));
// Mock React Router hooks for component tests
jest.mock('wouter', () => ({
    useLocation: jest.fn(() => ['/', jest.fn()]),
    useParams: jest.fn(() => ({})),
    useRoute: jest.fn(() => [false, {}]),
    Link: jest.fn(({ children }) => children),
    Route: jest.fn(({ children }) => children),
    Switch: jest.fn(({ children }) => children),
    Router: jest.fn(({ children }) => children),
    Redirect: jest.fn(() => null),
}));
// Mock language hook
jest.mock('@/hooks/use-language', () => ({
    useLanguage: jest.fn(() => ({
        t: jest.fn((key) => key), // Return the key as translation
        language: 'en',
        setLanguage: jest.fn(),
    })),
}));
// Mock query client
jest.mock('@/lib/queryClient', () => ({
    apiRequest: jest.fn().mockResolvedValue({ success: true, data: [] }),
    queryClient: {
        invalidateQueries: jest.fn(),
        setQueryData: jest.fn(),
        getQueryData: jest.fn(),
    },
}));
// Performance: Mock Neon database for faster unit tests
jest.mock('@neondatabase/serverless', () => ({
    neon: jest.fn(() => {
        const { mockSql } = require('./tests/mocks/database');
        return mockSql;
    }),
}));
// Jest setup file - global test configuration
require("@testing-library/jest-dom");
require("whatwg-fetch");
// Mock fetch for network requests in tests
global.fetch = jest.fn().mockImplementation((url, options) => {
    // Mock successful API responses
    if (url.includes('/api/')) {
        return Promise.resolve({
            ok: true,
            status: 200,
            json: async () => ({ success: true, data: [] }),
            text: async () => '{"success": true, "data": []}'
        });
    }
    // Default to network request failed for external URLs
    return Promise.reject(new Error('Network request failed'));
});
// Add TransformStream polyfill for MSW compatibility
if (typeof TransformStream === 'undefined') {
    const { TransformStream } = require('stream/web');
    global.TransformStream = TransformStream;
}
// Add ReadableStream polyfill
if (typeof ReadableStream === 'undefined') {
    const { ReadableStream } = require('stream/web');
    global.ReadableStream = ReadableStream;
}
// Add WritableStream polyfill
if (typeof WritableStream === 'undefined') {
    const { WritableStream } = require('stream/web');
    global.WritableStream = WritableStream;
}
// Add BroadcastChannel polyfill for MSW
if (typeof BroadcastChannel === 'undefined') {
    global.BroadcastChannel = class {
        constructor(name) { }
        postMessage(message) { }
        addEventListener(event, handler) { }
        removeEventListener(event, handler) { }
        close() { }
    };
}
// Mock runQuery function for integration tests
global.runQuery = jest.fn(() => Promise.resolve([]));
// Set up test database URL if missing
if (!process.env.DATABASE_URL) {
    process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/koveo_test';
}
// Mock implementations for browser APIs
global.ResizeObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
global.IntersectionObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
// Add TextEncoder/TextDecoder polyfills for Node.js environment
if (typeof TextEncoder === 'undefined') {
    const { TextEncoder, TextDecoder } = require('util');
    global.TextEncoder = TextEncoder;
    global.TextDecoder = TextDecoder;
}
// Mock matchMedia
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: function (query) {
        return {
            matches: false,
            media: query,
            onchange: null,
            addListener: function () { }, // deprecated
            removeListener: function () { }, // deprecated
            addEventListener: function () { },
            removeEventListener: function () { },
            dispatchEvent: function () { },
        };
    },
});
// Mock sessionStorage and localStorage
const createMockStorage = () => ({
    getItem: function () {
        return null;
    },
    setItem: function () { },
    removeItem: function () { },
    clear: function () { },
    length: 0,
    key: function () {
        return null;
    },
});
Object.defineProperty(window, 'sessionStorage', {
    value: createMockStorage(),
});
Object.defineProperty(window, 'localStorage', {
    value: createMockStorage(),
});
// Console error suppression will be handled by individual test files if needed
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFhLENBQUM7U0FDOUIsQ0FBQztJQUNKLENBQUM7Q0FDRixDQUFDLENBQUM7QUFFSCx1Q0FBdUM7QUFDdkMsTUFBTSxpQkFBaUIsR0FBRyxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQy9CLE9BQU8sRUFBRTtRQUNQLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELE9BQU8sRUFBRSxjQUFhLENBQUM7SUFDdkIsVUFBVSxFQUFFLGNBQWEsQ0FBQztJQUMxQixLQUFLLEVBQUUsY0FBYSxDQUFDO0lBQ3JCLE1BQU0sRUFBRSxDQUFDO0lBQ1QsR0FBRyxFQUFFO1FBQ0gsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0YsQ0FBQyxDQUFDO0FBRUgsTUFBTSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsZ0JBQWdCLEVBQUU7SUFDOUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFO0NBQzNCLENBQUMsQ0FBQztBQUVILE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLGNBQWMsRUFBRTtJQUM1QyxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7Q0FDM0IsQ0FBQyxDQUFDO0FBRUgsK0VBQStFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvamVzdC5zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBKZXN0IHNldHVwIGZpbGUgLSBnbG9iYWwgdGVzdCBjb25maWd1cmF0aW9uXG5pbXBvcnQgJ0B0ZXN0aW5nLWxpYnJhcnkvamVzdC1kb20nO1xuXG4vLyBQZXJmb3JtYW5jZTogTW9jayBleHBlbnNpdmUgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ0Bnb29nbGUvZ2VuYWknLCAoKSA9PiAoe1xuICBHb29nbGVHZW5BSTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGdldEdlbmVyYXRpdmVNb2RlbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBnZW5lcmF0ZUNvbnRlbnQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgdGV4dDogKCkgPT4gJ01vY2sgQUkgcmVzcG9uc2UnLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSksXG4gIH0pKSxcbn0pKTtcblxuLy8gUGVyZm9ybWFuY2U6IE1vY2sgZGF0YWJhc2UgZm9yIHVuaXQgdGVzdHMgdG8gYXZvaWQgbmV0d29yayBjYWxsc1xuamVzdC5tb2NrKCcuL3NlcnZlci9kYicsICgpID0+IHtcbiAgY29uc3QgeyBtb2NrRGIsIG1vY2tTcWwgfSA9IHJlcXVpcmUoJy4vdGVzdHMvbW9ja3MvZGF0YWJhc2UnKTtcbiAgcmV0dXJuIHtcbiAgICBkYjogbW9ja0RiLFxuICAgIHNxbDogbW9ja1NxbCxcbiAgICBwb29sOiBtb2NrU3FsLFxuICB9O1xufSk7XG5cbi8vIE1vY2sgZW1haWwgc2VydmljZSB0byBwcmV2ZW50IGFjdHVhbCBTZW5kR3JpZCBjYWxscyBkdXJpbmcgdGVzdHNcbmplc3QubW9jaygnLi9zZXJ2ZXIvc2VydmljZXMvZW1haWwtc2VydmljZScsICgpID0+ICh7XG4gIGVtYWlsU2VydmljZToge1xuICAgIHNlbmRFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRQYXNzd29yZFJlc2V0RW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kSW52aXRhdGlvbkVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFRlc3RFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRSZW1pbmRlckVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gIH0sXG4gIEVtYWlsU2VydmljZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIHNlbmRFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRQYXNzd29yZFJlc2V0RW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kSW52aXRhdGlvbkVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFRlc3RFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRSZW1pbmRlckVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gIH0pKVxufSkpO1xuXG4vLyBNb2NrIFJlYWN0IFJvdXRlciBob29rcyBmb3IgY29tcG9uZW50IHRlc3RzXG5qZXN0Lm1vY2soJ3dvdXRlcicsICgpID0+ICh7XG4gIHVzZUxvY2F0aW9uOiBqZXN0LmZuKCgpID0+IFsnLycsIGplc3QuZm4oKV0pLFxuICB1c2VQYXJhbXM6IGplc3QuZm4oKCkgPT4gKHt9KSksXG4gIHVzZVJvdXRlOiBqZXN0LmZuKCgpID0+IFtmYWxzZSwge31dKSxcbiAgTGluazogamVzdC5mbigoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuKSxcbiAgUm91dGU6IGplc3QuZm4oKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbiksXG4gIFN3aXRjaDogamVzdC5mbigoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuKSxcbiAgUm91dGVyOiBqZXN0LmZuKCh7IGNoaWxkcmVuIH06IGFueSkgPT4gY2hpbGRyZW4pLFxuICBSZWRpcmVjdDogamVzdC5mbigoKSA9PiBudWxsKSxcbn0pKTtcblxuLy8gTW9jayBsYW5ndWFnZSBob29rXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlLWxhbmd1YWdlJywgKCkgPT4gKHtcbiAgdXNlTGFuZ3VhZ2U6IGplc3QuZm4oKCkgPT4gKHtcbiAgICB0OiBqZXN0LmZuKChrZXk6IHN0cmluZykgPT4ga2V5KSwgLy8gUmV0dXJuIHRoZSBrZXkgYXMgdHJhbnNsYXRpb25cbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICBzZXRMYW5ndWFnZTogamVzdC5mbigpLFxuICB9KSksXG59KSk7XG5cbi8vIE1vY2sgcXVlcnkgY2xpZW50XG5qZXN0Lm1vY2soJ0AvbGliL3F1ZXJ5Q2xpZW50JywgKCkgPT4gKHtcbiAgYXBpUmVxdWVzdDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogW10gfSksXG4gIHF1ZXJ5Q2xpZW50OiB7XG4gICAgaW52YWxpZGF0ZVF1ZXJpZXM6IGplc3QuZm4oKSxcbiAgICBzZXRRdWVyeURhdGE6IGplc3QuZm4oKSxcbiAgICBnZXRRdWVyeURhdGE6IGplc3QuZm4oKSxcbiAgfSxcbn0pKTtcblxuLy8gUGVyZm9ybWFuY2U6IE1vY2sgTmVvbiBkYXRhYmFzZSBmb3IgZmFzdGVyIHVuaXQgdGVzdHNcbmplc3QubW9jaygnQG5lb25kYXRhYmFzZS9zZXJ2ZXJsZXNzJywgKCkgPT4gKHtcbiAgbmVvbjogamVzdC5mbigoKSA9PiB7XG4gICAgY29uc3QgeyBtb2NrU3FsIH0gPSByZXF1aXJlKCcuL3Rlc3RzL21vY2tzL2RhdGFiYXNlJyk7XG4gICAgcmV0dXJuIG1vY2tTcWw7XG4gIH0pLFxufSkpO1xuaW1wb3J0ICd3aGF0d2ctZmV0Y2gnO1xuXG4vLyBNb2NrIGZldGNoIGZvciBuZXR3b3JrIHJlcXVlc3RzIGluIHRlc3RzXG5nbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCh1cmw6IHN0cmluZywgb3B0aW9ucz86IGFueSkgPT4ge1xuICAvLyBNb2NrIHN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlc1xuICBpZiAodXJsLmluY2x1ZGVzKCcvYXBpLycpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBvazogdHJ1ZSxcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAganNvbjogYXN5bmMgKCkgPT4gKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogW10gfSksXG4gICAgICB0ZXh0OiBhc3luYyAoKSA9PiAne1wic3VjY2Vzc1wiOiB0cnVlLCBcImRhdGFcIjogW119J1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyBEZWZhdWx0IHRvIG5ldHdvcmsgcmVxdWVzdCBmYWlsZWQgZm9yIGV4dGVybmFsIFVSTHNcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignTmV0d29yayByZXF1ZXN0IGZhaWxlZCcpKTtcbn0pO1xuXG4vLyBBZGQgVHJhbnNmb3JtU3RyZWFtIHBvbHlmaWxsIGZvciBNU1cgY29tcGF0aWJpbGl0eVxuaWYgKHR5cGVvZiBUcmFuc2Zvcm1TdHJlYW0gPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVHJhbnNmb3JtU3RyZWFtIH0gPSByZXF1aXJlKCdzdHJlYW0vd2ViJyk7XG4gIChnbG9iYWwgYXMgYW55KS5UcmFuc2Zvcm1TdHJlYW0gPSBUcmFuc2Zvcm1TdHJlYW07XG59XG5cbi8vIEFkZCBSZWFkYWJsZVN0cmVhbSBwb2x5ZmlsbFxuaWYgKHR5cGVvZiBSZWFkYWJsZVN0cmVhbSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgY29uc3QgeyBSZWFkYWJsZVN0cmVhbSB9ID0gcmVxdWlyZSgnc3RyZWFtL3dlYicpO1xuICAoZ2xvYmFsIGFzIGFueSkuUmVhZGFibGVTdHJlYW0gPSBSZWFkYWJsZVN0cmVhbTtcbn1cblxuLy8gQWRkIFdyaXRhYmxlU3RyZWFtIHBvbHlmaWxsXG5pZiAodHlwZW9mIFdyaXRhYmxlU3RyZWFtID09PSAndW5kZWZpbmVkJykge1xuICBjb25zdCB7IFdyaXRhYmxlU3RyZWFtIH0gPSByZXF1aXJlKCdzdHJlYW0vd2ViJyk7XG4gIChnbG9iYWwgYXMgYW55KS5Xcml0YWJsZVN0cmVhbSA9IFdyaXRhYmxlU3RyZWFtO1xufVxuXG4vLyBBZGQgQnJvYWRjYXN0Q2hhbm5lbCBwb2x5ZmlsbCBmb3IgTVNXXG5pZiAodHlwZW9mIEJyb2FkY2FzdENoYW5uZWwgPT09ICd1bmRlZmluZWQnKSB7XG4gIChnbG9iYWwgYXMgYW55KS5Ccm9hZGNhc3RDaGFubmVsID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge31cbiAgICBwb3N0TWVzc2FnZShtZXNzYWdlOiBhbnkpIHt9XG4gICAgYWRkRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge31cbiAgICByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7fVxuICAgIGNsb3NlKCkge31cbiAgfTtcbn1cblxuLy8gTW9jayBydW5RdWVyeSBmdW5jdGlvbiBmb3IgaW50ZWdyYXRpb24gdGVzdHNcbmdsb2JhbC5ydW5RdWVyeSA9IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKFtdKSk7XG5cbi8vIFNldCB1cCB0ZXN0IGRhdGFiYXNlIFVSTCBpZiBtaXNzaW5nXG5pZiAoIXByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCkge1xuICBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgPSAncG9zdGdyZXNxbDovL3Rlc3Q6dGVzdEBsb2NhbGhvc3Q6NTQzMi9rb3Zlb190ZXN0Jztcbn1cblxuLy8gTW9jayBpbXBsZW1lbnRhdGlvbnMgZm9yIGJyb3dzZXIgQVBJc1xuKGdsb2JhbCBhcyBhbnkpLlJlc2l6ZU9ic2VydmVyID0gZnVuY3Rpb24gKCkge1xuICByZXR1cm4ge1xuICAgIG9ic2VydmU6IGZ1bmN0aW9uICgpIHt9LFxuICAgIHVub2JzZXJ2ZTogZnVuY3Rpb24gKCkge30sXG4gICAgZGlzY29ubmVjdDogZnVuY3Rpb24gKCkge30sXG4gIH07XG59O1xuXG4oZ2xvYmFsIGFzIGFueSkuSW50ZXJzZWN0aW9uT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgb2JzZXJ2ZTogZnVuY3Rpb24gKCkge30sXG4gICAgdW5vYnNlcnZlOiBmdW5jdGlvbiAoKSB7fSxcbiAgICBkaXNjb25uZWN0OiBmdW5jdGlvbiAoKSB7fSxcbiAgfTtcbn07XG5cbi8vIEFkZCBUZXh0RW5jb2Rlci9UZXh0RGVjb2RlciBwb2x5ZmlsbHMgZm9yIE5vZGUuanMgZW52aXJvbm1lbnRcbmlmICh0eXBlb2YgVGV4dEVuY29kZXIgPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVGV4dEVuY29kZXIsIFRleHREZWNvZGVyIH0gPSByZXF1aXJlKCd1dGlsJyk7XG4gIChnbG9iYWwgYXMgYW55KS5UZXh0RW5jb2RlciA9IFRleHRFbmNvZGVyO1xuICAoZ2xvYmFsIGFzIGFueSkuVGV4dERlY29kZXIgPSBUZXh0RGVjb2Rlcjtcbn1cblxuLy8gTW9jayBtYXRjaE1lZGlhXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbWF0Y2hNZWRpYScsIHtcbiAgd3JpdGFibGU6IHRydWUsXG4gIHZhbHVlOiBmdW5jdGlvbiAocXVlcnk6IHN0cmluZykge1xuICAgIHJldHVybiB7XG4gICAgICBtYXRjaGVzOiBmYWxzZSxcbiAgICAgIG1lZGlhOiBxdWVyeSxcbiAgICAgIG9uY2hhbmdlOiBudWxsLFxuICAgICAgYWRkTGlzdGVuZXI6IGZ1bmN0aW9uICgpIHt9LCAvLyBkZXByZWNhdGVkXG4gICAgICByZW1vdmVMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sIC8vIGRlcHJlY2F0ZWRcbiAgICAgIGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICgpIHt9LFxuICAgICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sXG4gICAgICBkaXNwYXRjaEV2ZW50OiBmdW5jdGlvbiAoKSB7fSxcbiAgICB9O1xuICB9LFxufSk7XG5cbi8vIE1vY2sgc2Vzc2lvblN0b3JhZ2UgYW5kIGxvY2FsU3RvcmFnZVxuY29uc3QgY3JlYXRlTW9ja1N0b3JhZ2UgPSAoKSA9PiAoe1xuICBnZXRJdGVtOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG4gIHNldEl0ZW06IGZ1bmN0aW9uICgpIHt9LFxuICByZW1vdmVJdGVtOiBmdW5jdGlvbiAoKSB7fSxcbiAgY2xlYXI6IGZ1bmN0aW9uICgpIHt9LFxuICBsZW5ndGg6IDAsXG4gIGtleTogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBudWxsO1xuICB9LFxufSk7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdzZXNzaW9uU3RvcmFnZScsIHtcbiAgdmFsdWU6IGNyZWF0ZU1vY2tTdG9yYWdlKCksXG59KTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ2xvY2FsU3RvcmFnZScsIHtcbiAgdmFsdWU6IGNyZWF0ZU1vY2tTdG9yYWdlKCksXG59KTtcblxuLy8gQ29uc29sZSBlcnJvciBzdXBwcmVzc2lvbiB3aWxsIGJlIGhhbmRsZWQgYnkgaW5kaXZpZHVhbCB0ZXN0IGZpbGVzIGlmIG5lZWRlZFxuIl0sInZlcnNpb24iOjN9