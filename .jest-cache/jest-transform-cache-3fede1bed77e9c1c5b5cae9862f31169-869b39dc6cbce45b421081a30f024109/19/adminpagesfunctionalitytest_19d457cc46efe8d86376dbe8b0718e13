b71a647963f601cbc008d3dab010463d
"use strict";
/**
 * Integration Tests for Admin Pages Functionality
 *
 * Tests cover the fixes made to:
 * - /admin/roadmap page (feature-management.ts syntax errors)
 * - /admin/compliance page (law25-compliance.ts syntax errors)
 * - /admin/quality page (quality-metrics authentication issues)
 * - /admin/permissions page (overly restrictive authorization middleware)
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const express_session_1 = __importDefault(require("express-session"));
const routes_1 = require("../../server/routes");
const storage_1 = require("../../server/storage");
const test_utils_1 = require("../utils/test-utils");
// Mock storage
const mockStorage = new storage_1.MemStorage();
// Create test Express app
const createTestApp = () => {
    const app = (0, express_1.default)();
    // Setup middleware
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Session middleware for authentication
    app.use((0, express_session_1.default)({
        secret: 'test-secret',
        resave: false,
        saveUninitialized: false,
        cookie: { secure: false, maxAge: 24 * 60 * 60 * 1000 },
    }));
    // Register API routes
    (0, routes_1.registerApiRoutes)(app);
    return app;
};
(0, globals_1.describe)('Admin Pages Functionality', () => {
    let app;
    let adminUser;
    let regularUser;
    let adminAgent;
    let userAgent;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Create test users
        adminUser = await (0, test_utils_1.createTestUser)({
            email: 'admin@test.com',
            role: 'admin',
            firstName: 'Admin',
            lastName: 'User'
        });
        regularUser = await (0, test_utils_1.createTestUser)({
            email: 'user@test.com',
            role: 'resident',
            firstName: 'Regular',
            lastName: 'User'
        });
        // Create authenticated agents
        adminAgent = supertest_1.default.agent(app);
        userAgent = supertest_1.default.agent(app);
        // Login as admin
        await adminAgent
            .post('/api/auth/login')
            .send({
            email: 'admin@test.com',
            password: 'password123'
        });
        // Login as regular user
        await userAgent
            .post('/api/auth/login')
            .send({
            email: 'user@test.com',
            password: 'password123'
        });
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.clearAllMocks();
    });
    (0, globals_1.describe)('Admin Roadmap Page (/admin/roadmap)', () => {
        (0, globals_1.it)('should successfully load roadmap data for admin users', async () => {
            const response = await adminAgent
                .get('/api/feature-management/features')
                .expect(200);
            (0, globals_1.expect)(response.body).toBeDefined();
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
        });
        (0, globals_1.it)('should deny access to non-admin users', async () => {
            await userAgent
                .get('/api/feature-management/features')
                .expect(403);
        });
        (0, globals_1.it)('should handle feature creation without syntax errors', async () => {
            const newFeature = {
                title: 'Test Feature',
                description: 'Test Description',
                category: 'enhancement',
                priority: 'medium',
                estimatedEffort: 5,
                targetQuarter: 'Q1 2025',
                status: 'planned'
            };
            const response = await adminAgent
                .post('/api/feature-management/features')
                .send(newFeature)
                .expect(201);
            (0, globals_1.expect)(response.body.title).toBe(newFeature.title);
            (0, globals_1.expect)(response.body.status).toBe('planned');
        });
        (0, globals_1.it)('should handle feature updates without errors', async () => {
            // First create a feature
            const createResponse = await adminAgent
                .post('/api/feature-management/features')
                .send({
                title: 'Update Test',
                description: 'Test Description',
                category: 'enhancement',
                priority: 'medium',
                estimatedEffort: 3,
                targetQuarter: 'Q2 2025',
                status: 'planned'
            });
            const featureId = createResponse.body.id;
            // Then update it
            const updateResponse = await adminAgent
                .patch(`/api/feature-management/features/${featureId}`)
                .send({
                status: 'in_progress',
                priority: 'high'
            })
                .expect(200);
            (0, globals_1.expect)(updateResponse.body.status).toBe('in_progress');
            (0, globals_1.expect)(updateResponse.body.priority).toBe('high');
        });
    });
    (0, globals_1.describe)('Admin Compliance Page (/admin/compliance)', () => {
        (0, globals_1.it)('should successfully load compliance data for admin users', async () => {
            const response = await adminAgent
                .get('/api/law25-compliance')
                .expect(200);
            (0, globals_1.expect)(response.body).toBeDefined();
            (0, globals_1.expect)(response.body.overallStatus).toBeDefined();
        });
        (0, globals_1.it)('should deny access to non-admin users', async () => {
            await userAgent
                .get('/api/law25-compliance')
                .expect(403);
        });
        (0, globals_1.it)('should return proper compliance status structure', async () => {
            const response = await adminAgent
                .get('/api/law25-compliance')
                .expect(200);
            (0, globals_1.expect)(response.body).toHaveProperty('overallStatus');
            (0, globals_1.expect)(response.body).toHaveProperty('categories');
            (0, globals_1.expect)(response.body).toHaveProperty('recommendations');
            (0, globals_1.expect)(typeof response.body.overallStatus).toBe('string');
            (0, globals_1.expect)(Array.isArray(response.body.categories)).toBe(true);
        });
        (0, globals_1.it)('should handle compliance audit requests without syntax errors', async () => {
            const response = await adminAgent
                .post('/api/law25-compliance/audit')
                .send({
                auditType: 'full',
                includeSensitiveData: true
            })
                .expect(200);
            (0, globals_1.expect)(response.body.auditId).toBeDefined();
            (0, globals_1.expect)(response.body.status).toBe('initiated');
        });
    });
    (0, globals_1.describe)('Admin Quality Page (/admin/quality)', () => {
        (0, globals_1.it)('should successfully load quality metrics for authenticated admin users', async () => {
            const response = await adminAgent
                .get('/api/quality-metrics')
                .expect(200);
            (0, globals_1.expect)(response.body).toBeDefined();
            (0, globals_1.expect)(response.body.metrics).toBeDefined();
        });
        (0, globals_1.it)('should deny access to unauthenticated users', async () => {
            await (0, supertest_1.default)(app)
                .get('/api/quality-metrics')
                .expect(401);
        });
        (0, globals_1.it)('should deny access to non-admin users', async () => {
            await userAgent
                .get('/api/quality-metrics')
                .expect(403);
        });
        (0, globals_1.it)('should return properly structured quality metrics', async () => {
            const response = await adminAgent
                .get('/api/quality-metrics')
                .expect(200);
            (0, globals_1.expect)(response.body.metrics).toBeDefined();
            (0, globals_1.expect)(response.body.metrics.overall).toBeDefined();
            (0, globals_1.expect)(response.body.metrics.categories).toBeDefined();
            (0, globals_1.expect)(Array.isArray(response.body.metrics.categories)).toBe(true);
        });
        (0, globals_1.it)('should handle quality metric updates without authentication issues', async () => {
            const updateData = {
                category: 'performance',
                metric: 'response_time',
                value: 250,
                threshold: 300
            };
            const response = await adminAgent
                .post('/api/quality-metrics/update')
                .send(updateData)
                .expect(200);
            (0, globals_1.expect)(response.body.success).toBe(true);
        });
    });
    (0, globals_1.describe)('Admin Permissions Page (/admin/permissions)', () => {
        (0, globals_1.it)('should successfully load permissions data for admin users', async () => {
            const response = await adminAgent
                .get('/api/permissions')
                .expect(200);
            (0, globals_1.expect)(response.body).toBeDefined();
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
        });
        (0, globals_1.it)('should allow admin access without overly restrictive middleware', async () => {
            // This test ensures the authorization middleware fix
            const response = await adminAgent
                .get('/api/permissions')
                .expect(200);
            (0, globals_1.expect)(response.status).toBe(200);
            (0, globals_1.expect)(response.body).toBeDefined();
        });
        (0, globals_1.it)('should still deny access to non-admin users', async () => {
            await userAgent
                .get('/api/permissions')
                .expect(403);
        });
        (0, globals_1.it)('should handle permission updates for admin users', async () => {
            const permissionUpdate = {
                userId: regularUser.id,
                permissions: ['read_documents', 'create_demands'],
                role: 'resident'
            };
            const response = await adminAgent
                .patch('/api/permissions/user')
                .send(permissionUpdate)
                .expect(200);
            (0, globals_1.expect)(response.body.success).toBe(true);
        });
        (0, globals_1.it)('should handle role-based permission queries', async () => {
            const response = await adminAgent
                .get('/api/permissions?role=manager')
                .expect(200);
            (0, globals_1.expect)(Array.isArray(response.body)).toBe(true);
        });
    });
    (0, globals_1.describe)('Cross-Page Error Handling', () => {
        (0, globals_1.it)('should handle malformed requests gracefully across all admin endpoints', async () => {
            const endpoints = [
                '/api/feature-management/features',
                '/api/law25-compliance',
                '/api/quality-metrics',
                '/api/permissions'
            ];
            for (const endpoint of endpoints) {
                const response = await adminAgent
                    .post(endpoint)
                    .send({ malformed: 'data', invalid: true })
                    .expect(400);
                (0, globals_1.expect)(response.body.error).toBeDefined();
            }
        });
        (0, globals_1.it)('should return consistent error formats across admin pages', async () => {
            const response = await userAgent
                .get('/api/feature-management/features')
                .expect(403);
            (0, globals_1.expect)(response.body).toHaveProperty('error');
            (0, globals_1.expect)(response.body).toHaveProperty('message');
            (0, globals_1.expect)(response.body.error).toBe('Forbidden');
        });
    });
    (0, globals_1.describe)('Admin Page Authentication Flow', () => {
        (0, globals_1.it)('should require authentication for all admin endpoints', async () => {
            const endpoints = [
                '/api/feature-management/features',
                '/api/law25-compliance',
                '/api/quality-metrics',
                '/api/permissions'
            ];
            for (const endpoint of endpoints) {
                await (0, supertest_1.default)(app)
                    .get(endpoint)
                    .expect(401);
            }
        });
        (0, globals_1.it)('should maintain session across admin page requests', async () => {
            // Make multiple requests to ensure session persistence
            await adminAgent
                .get('/api/feature-management/features')
                .expect(200);
            await adminAgent
                .get('/api/law25-compliance')
                .expect(200);
            await adminAgent
                .get('/api/quality-metrics')
                .expect(200);
            await adminAgent
                .get('/api/permissions')
                .expect(200);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9hZG1pbi1wYWdlcy1mdW5jdGlvbmFsaXR5LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7OztHQVFHOzs7OztBQUVILDJDQUFrRjtBQUNsRiwwREFBZ0M7QUFDaEMsc0RBQThCO0FBQzlCLHNFQUFzQztBQUN0QyxnREFBd0Q7QUFDeEQsa0RBQWtEO0FBQ2xELG9EQUF3RTtBQUV4RSxlQUFlO0FBQ2YsTUFBTSxXQUFXLEdBQUcsSUFBSSxvQkFBVSxFQUFFLENBQUM7QUFFckMsMEJBQTBCO0FBQzFCLE1BQU0sYUFBYSxHQUFHLEdBQUcsRUFBRTtJQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQztJQUV0QixtQkFBbUI7SUFDbkIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxpQkFBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDeEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFaEQsd0NBQXdDO0lBQ3hDLEdBQUcsQ0FBQyxHQUFHLENBQ0wsSUFBQSx5QkFBTyxFQUFDO1FBQ04sTUFBTSxFQUFFLGFBQWE7UUFDckIsTUFBTSxFQUFFLEtBQUs7UUFDYixpQkFBaUIsRUFBRSxLQUFLO1FBQ3hCLE1BQU0sRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksRUFBRTtLQUN2RCxDQUFDLENBQ0gsQ0FBQztJQUVGLHNCQUFzQjtJQUN0QixJQUFBLDBCQUFpQixFQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXZCLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyxDQUFDO0FBRUYsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtJQUN6QyxJQUFJLEdBQXdCLENBQUM7SUFDN0IsSUFBSSxTQUFj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QUVILElBQUEsa0JBQVEsRUFBQyxnQ0FBZ0MsRUFBRSxHQUFHLEVBQUU7UUFDOUMsSUFBQSxZQUFFLEVBQUMsdURBQXVELEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDckUsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCLGtDQUFrQztnQkFDbEMsdUJBQXVCO2dCQUN2QixzQkFBc0I7Z0JBQ3RCLGtCQUFrQjthQUNuQixDQUFDO1lBRUYsS0FBSyxNQUFNLFFBQVEsSUFBSSxTQUFTLEVBQUUsQ0FBQztnQkFDakMsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO3FCQUNmLEdBQUcsQ0FBQyxRQUFRLENBQUM7cUJBQ2IsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2pCLENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsWUFBRSxFQUFDLG9EQUFvRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2xFLHVEQUF1RDtZQUN2RCxNQUFNLFVBQVU7aUJBQ2IsR0FBRyxDQUFDLGtDQUFrQyxDQUFDO2lCQUN2QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixNQUFNLFVBQVU7aUJBQ2IsR0FBRyxDQUFDLHVCQUF1QixDQUFDO2lCQUM1QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixNQUFNLFVBQVU7aUJBQ2IsR0FBRyxDQUFDLHNCQUFzQixDQUFDO2lCQUMzQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixNQUFNLFVBQVU7aUJBQ2IsR0FBRyxDQUFDLGtCQUFrQixDQUFDO2lCQUN2QixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvaW50ZWdyYXRpb24vYWRtaW4tcGFnZXMtZnVuY3Rpb25hbGl0eS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSW50ZWdyYXRpb24gVGVzdHMgZm9yIEFkbWluIFBhZ2VzIEZ1bmN0aW9uYWxpdHlcbiAqIFxuICogVGVzdHMgY292ZXIgdGhlIGZpeGVzIG1hZGUgdG86XG4gKiAtIC9hZG1pbi9yb2FkbWFwIHBhZ2UgKGZlYXR1cmUtbWFuYWdlbWVudC50cyBzeW50YXggZXJyb3JzKVxuICogLSAvYWRtaW4vY29tcGxpYW5jZSBwYWdlIChsYXcyNS1jb21wbGlhbmNlLnRzIHN5bnRheCBlcnJvcnMpXG4gKiAtIC9hZG1pbi9xdWFsaXR5IHBhZ2UgKHF1YWxpdHktbWV0cmljcyBhdXRoZW50aWNhdGlvbiBpc3N1ZXMpXG4gKiAtIC9hZG1pbi9wZXJtaXNzaW9ucyBwYWdlIChvdmVybHkgcmVzdHJpY3RpdmUgYXV0aG9yaXphdGlvbiBtaWRkbGV3YXJlKVxuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2gsIGplc3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCBzZXNzaW9uIGZyb20gJ2V4cHJlc3Mtc2Vzc2lvbic7XG5pbXBvcnQgeyByZWdpc3RlckFwaVJvdXRlcyB9IGZyb20gJy4uLy4uL3NlcnZlci9yb3V0ZXMnO1xuaW1wb3J0IHsgTWVtU3RvcmFnZSB9IGZyb20gJy4uLy4uL3NlcnZlci9zdG9yYWdlJztcbmltcG9ydCB7IGNyZWF0ZVRlc3RVc2VyLCBjcmVhdGVUZXN0U2Vzc2lvbiB9IGZyb20gJy4uL3V0aWxzL3Rlc3QtdXRpbHMnO1xuXG4vLyBNb2NrIHN0b3JhZ2VcbmNvbnN0IG1vY2tTdG9yYWdlID0gbmV3IE1lbVN0b3JhZ2UoKTtcblxuLy8gQ3JlYXRlIHRlc3QgRXhwcmVzcyBhcHBcbmNvbnN0IGNyZWF0ZVRlc3RBcHAgPSAoKSA9PiB7XG4gIGNvbnN0IGFwcCA9IGV4cHJlc3MoKTtcbiAgXG4gIC8vIFNldHVwIG1pZGRsZXdhcmVcbiAgYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG4gIGFwcC51c2UoZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSkpO1xuICBcbiAgLy8gU2Vzc2lvbiBtaWRkbGV3YXJlIGZvciBhdXRoZW50aWNhdGlvblxuICBhcHAudXNlKFxuICAgIHNlc3Npb24oe1xuICAgICAgc2VjcmV0OiAndGVzdC1zZWNyZXQnLFxuICAgICAgcmVzYXZlOiBmYWxzZSxcbiAgICAgIHNhdmVVbmluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgIGNvb2tpZTogeyBzZWN1cmU6IGZhbHNlLCBtYXhBZ2U6IDI0ICogNjAgKiA2MCAqIDEwMDAgfSxcbiAgICB9KVxuICApO1xuICBcbiAgLy8gUmVnaXN0ZXIgQVBJIHJvdXRlc1xuICByZWdpc3RlckFwaVJvdXRlcyhhcHApO1xuICBcbiAgcmV0dXJuIGFwcDtcbn07XG5cbmRlc2NyaWJlKCdBZG1pbiBQYWdlcyBGdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICBsZXQgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uO1xuICBsZXQgYWRtaW5Vc2VyOiBhbnk7XG4gIGxldCByZWd1bGFyVXNlcjogYW55O1xuICBsZXQgYWRtaW5BZ2VudDogcmVxdWVzdC5TdXBlckFnZW50VGVzdDtcbiAgbGV0IHVzZXJBZ2VudDogcmVxdWVzdC5TdXBlckFnZW50VGVzdDtcblxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhcHAgPSBjcmVhdGVUZXN0QXBwKCk7XG4gICAgXG4gICAgLy8gQ3JlYXRlIHRlc3QgdXNlcnNcbiAgICBhZG1pblVzZXIgPSBhd2FpdCBjcmVhdGVUZXN0VXNlcih7XG4gICAgICBlbWFpbDogJ2FkbWluQHRlc3QuY29tJyxcbiAgICAgIHJvbGU6ICdhZG1pbicsXG4gICAgICBmaXJzdE5hbWU6ICdBZG1pbicsXG4gICAgICBsYXN0TmFtZTogJ1VzZXInXG4gICAgfSk7XG4gICAgXG4gICAgcmVndWxhclVzZXIgPSBhd2FpdCBjcmVhdGVUZXN0VXNlcih7XG4gICAgICBlbWFpbDogJ3VzZXJAdGVzdC5jb20nLFxuICAgICAgcm9sZTogJ3Jlc2lkZW50JyxcbiAgICAgIGZpcnN0TmFtZTogJ1JlZ3VsYXInLFxuICAgICAgbGFzdE5hbWU6ICdVc2VyJ1xuICAgIH0pO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhdXRoZW50aWNhdGVkIGFnZW50c1xuICAgIGFkbWluQWdlbnQgPSByZXF1ZXN0LmFnZW50KGFwcCk7XG4gICAgdXNlckFnZW50ID0gcmVxdWVzdC5hZ2VudChhcHApO1xuICAgIFxuICAgIC8vIExvZ2luIGFzIGFkbWluXG4gICAgYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgLnBvc3QoJy9hcGkvYXV0aC9sb2dpbicpXG4gICAgICAuc2VuZCh7XG4gICAgICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAvLyBMb2dpbiBhcyByZWd1bGFyIHVzZXJcbiAgICBhd2FpdCB1c2VyQWdlbnRcbiAgICAgIC5wb3N0KCcvYXBpL2F1dGgvbG9naW4nKVxuICAgICAgLnNlbmQoe1xuICAgICAgICBlbWFpbDogJ3VzZXJAdGVzdC5jb20nLFxuICAgICAgICBwYXNzd29yZDogJ3Bhc3N3b3JkMTIzJ1xuICAgICAgfSk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBZG1pbiBSb2FkbWFwIFBhZ2UgKC9hZG1pbi9yb2FkbWFwKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2Nlc3NmdWxseSBsb2FkIHJvYWRtYXAgZGF0YSBmb3IgYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9mZWF0dXJlLW1hbmFnZW1lbnQvZmVhdHVyZXMnKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG4gICAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZS5ib2R5KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBhY2Nlc3MgdG8gbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdXNlckFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvZmVhdHVyZS1tYW5hZ2VtZW50L2ZlYXR1cmVzJylcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZmVhdHVyZSBjcmVhdGlvbiB3aXRob3V0IHN5bnRheCBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBuZXdGZWF0dXJlID0ge1xuICAgICAgICB0aXRsZTogJ1Rlc3QgRmVhdHVyZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBEZXNjcmlwdGlvbicsXG4gICAgICAgIGNhdGVnb3J5OiAnZW5oYW5jZW1lbnQnLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIGVzdGltYXRlZEVmZm9ydDogNSxcbiAgICAgICAgdGFyZ2V0UXVhcnRlcjogJ1ExIDIwMjUnLFxuICAgICAgICBzdGF0dXM6ICdwbGFubmVkJ1xuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5wb3N0KCcvYXBpL2ZlYXR1cmUtbWFuYWdlbWVudC9mZWF0dXJlcycpXG4gICAgICAgIC5zZW5kKG5ld0ZlYXR1cmUpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS50aXRsZSkudG9CZShuZXdGZWF0dXJlLnRpdGxlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN0YXR1cykudG9CZSgncGxhbm5lZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZmVhdHVyZSB1cGRhdGVzIHdpdGhvdXQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgY3JlYXRlIGEgZmVhdHVyZVxuICAgICAgY29uc3QgY3JlYXRlUmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5wb3N0KCcvYXBpL2ZlYXR1cmUtbWFuYWdlbWVudC9mZWF0dXJlcycpXG4gICAgICAgIC5zZW5kKHtcbiAgICAgICAgICB0aXRsZTogJ1VwZGF0ZSBUZXN0JyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgRGVzY3JpcHRpb24nLFxuICAgICAgICAgIGNhdGVnb3J5OiAnZW5oYW5jZW1lbnQnLFxuICAgICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgICBlc3RpbWF0ZWRFZmZvcnQ6IDMsXG4gICAgICAgICAgdGFyZ2V0UXVhcnRlcjogJ1EyIDIwMjUnLFxuICAgICAgICAgIHN0YXR1czogJ3BsYW5uZWQnXG4gICAgICAgIH0pO1xuXG4gICAgICBjb25zdCBmZWF0dXJlSWQgPSBjcmVhdGVSZXNwb25zZS5ib2R5LmlkO1xuICAgICAgXG4gICAgICAvLyBUaGVuIHVwZGF0ZSBpdFxuICAgICAgY29uc3QgdXBkYXRlUmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5wYXRjaChgL2FwaS9mZWF0dXJlLW1hbmFnZW1lbnQvZmVhdHVyZXMvJHtmZWF0dXJlSWR9YClcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIHN0YXR1czogJ2luX3Byb2dyZXNzJyxcbiAgICAgICAgICBwcmlvcml0eTogJ2hpZ2gnXG4gICAgICAgIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QodXBkYXRlUmVzcG9uc2UuYm9keS5zdGF0dXMpLnRvQmUoJ2luX3Byb2dyZXNzJyk7XG4gICAgICBleHBlY3QodXBkYXRlUmVzcG9uc2UuYm9keS5wcmlvcml0eSkudG9CZSgnaGlnaCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWRtaW4gQ29tcGxpYW5jZSBQYWdlICgvYWRtaW4vY29tcGxpYW5jZSknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdWNjZXNzZnVsbHkgbG9hZCBjb21wbGlhbmNlIGRhdGEgZm9yIGFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvbGF3MjUtY29tcGxpYW5jZScpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm92ZXJhbGxTdGF0dXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHRvIG5vbi1hZG1pbiB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGF3YWl0IHVzZXJBZ2VudFxuICAgICAgICAuZ2V0KCcvYXBpL2xhdzI1LWNvbXBsaWFuY2UnKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXIgY29tcGxpYW5jZSBzdGF0dXMgc3RydWN0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvbGF3MjUtY29tcGxpYW5jZScpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9IYXZlUHJvcGVydHkoJ292ZXJhbGxTdGF0dXMnKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnY2F0ZWdvcmllcycpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvSGF2ZVByb3BlcnR5KCdyZWNvbW1lbmRhdGlvbnMnKTtcbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVzcG9uc2UuYm9keS5vdmVyYWxsU3RhdHVzKS50b0JlKCdzdHJpbmcnKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkuY2F0ZWdvcmllcykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBjb21wbGlhbmNlIGF1ZGl0IHJlcXVlc3RzIHdpdGhvdXQgc3ludGF4IGVycm9ycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAucG9zdCgnL2FwaS9sYXcyNS1jb21wbGlhbmNlL2F1ZGl0JylcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIGF1ZGl0VHlwZTogJ2Z1bGwnLFxuICAgICAgICAgIGluY2x1ZGVTZW5zaXRpdmVEYXRhOiB0cnVlXG4gICAgICAgIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5hdWRpdElkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3RhdHVzKS50b0JlKCdpbml0aWF0ZWQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FkbWluIFF1YWxpdHkgUGFnZSAoL2FkbWluL3F1YWxpdHkpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGxvYWQgcXVhbGl0eSBtZXRyaWNzIGZvciBhdXRoZW50aWNhdGVkIGFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvcXVhbGl0eS1tZXRyaWNzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWV0cmljcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBhY2Nlc3MgdG8gdW5hdXRoZW50aWNhdGVkIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvcXVhbGl0eS1tZXRyaWNzJylcbiAgICAgICAgLmV4cGVjdCg0MDEpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZW55IGFjY2VzcyB0byBub24tYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCB1c2VyQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9xdWFsaXR5LW1ldHJpY3MnKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBwcm9wZXJseSBzdHJ1Y3R1cmVkIHF1YWxpdHkgbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAuZ2V0KCcvYXBpL3F1YWxpdHktbWV0cmljcycpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXRyaWNzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWV0cmljcy5vdmVyYWxsKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWV0cmljcy5jYXRlZ29yaWVzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5tZXRyaWNzLmNhdGVnb3JpZXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcXVhbGl0eSBtZXRyaWMgdXBkYXRlcyB3aXRob3V0IGF1dGhlbnRpY2F0aW9uIGlzc3VlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGEgPSB7XG4gICAgICAgIGNhdGVnb3J5OiAncGVyZm9ybWFuY2UnLFxuICAgICAgICBtZXRyaWM6ICdyZXNwb25zZV90aW1lJyxcbiAgICAgICAgdmFsdWU6IDI1MCxcbiAgICAgICAgdGhyZXNob2xkOiAzMDBcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAucG9zdCgnL2FwaS9xdWFsaXR5LW1ldHJpY3MvdXBkYXRlJylcbiAgICAgICAgLnNlbmQodXBkYXRlRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBZG1pbiBQZXJtaXNzaW9ucyBQYWdlICgvYWRtaW4vcGVybWlzc2lvbnMpJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGxvYWQgcGVybWlzc2lvbnMgZGF0YSBmb3IgYWRtaW4gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9wZXJtaXNzaW9ucycpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChBcnJheS5pc0FycmF5KHJlc3BvbnNlLmJvZHkpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiBhY2Nlc3Mgd2l0aG91dCBvdmVybHkgcmVzdHJpY3RpdmUgbWlkZGxld2FyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRoaXMgdGVzdCBlbnN1cmVzIHRoZSBhdXRob3JpemF0aW9uIG1pZGRsZXdhcmUgZml4XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9wZXJtaXNzaW9ucycpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QocmVzcG9uc2Uuc3RhdHVzKS50b0JlKDIwMCk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc3RpbGwgZGVueSBhY2Nlc3MgdG8gbm9uLWFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgdXNlckFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvcGVybWlzc2lvbnMnKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwZXJtaXNzaW9uIHVwZGF0ZXMgZm9yIGFkbWluIHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGVybWlzc2lvblVwZGF0ZSA9IHtcbiAgICAgICAgdXNlcklkOiByZWd1bGFyVXNlci5pZCxcbiAgICAgICAgcGVybWlzc2lvbnM6IFsncmVhZF9kb2N1bWVudHMnLCAnY3JlYXRlX2RlbWFuZHMnXSxcbiAgICAgICAgcm9sZTogJ3Jlc2lkZW50J1xuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5wYXRjaCgnL2FwaS9wZXJtaXNzaW9ucy91c2VyJylcbiAgICAgICAgLnNlbmQocGVybWlzc2lvblVwZGF0ZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSByb2xlLWJhc2VkIHBlcm1pc3Npb24gcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAuZ2V0KCcvYXBpL3Blcm1pc3Npb25zP3JvbGU9bWFuYWdlcicpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcbiAgICAgICAgXG4gICAgICBleHBlY3QoQXJyYXkuaXNBcnJheShyZXNwb25zZS5ib2R5KSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Nyb3NzLVBhZ2UgRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIHJlcXVlc3RzIGdyYWNlZnVsbHkgYWNyb3NzIGFsbCBhZG1pbiBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlbmRwb2ludHMgPSBbXG4gICAgICAgICcvYXBpL2ZlYXR1cmUtbWFuYWdlbWVudC9mZWF0dXJlcycsXG4gICAgICAgICcvYXBpL2xhdzI1LWNvbXBsaWFuY2UnLFxuICAgICAgICAnL2FwaS9xdWFsaXR5LW1ldHJpY3MnLFxuICAgICAgICAnL2FwaS9wZXJtaXNzaW9ucydcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgZW5kcG9pbnQgb2YgZW5kcG9pbnRzKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAgIC5wb3N0KGVuZHBvaW50KVxuICAgICAgICAgIC5zZW5kKHsgbWFsZm9ybWVkOiAnZGF0YScsIGludmFsaWQ6IHRydWUgfSlcbiAgICAgICAgICAuZXhwZWN0KDQwMCk7XG4gICAgICAgICAgXG4gICAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmVycm9yKS50b0JlRGVmaW5lZCgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29uc2lzdGVudCBlcnJvciBmb3JtYXRzIGFjcm9zcyBhZG1pbiBwYWdlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgdXNlckFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvZmVhdHVyZS1tYW5hZ2VtZW50L2ZlYXR1cmVzJylcbiAgICAgICAgLmV4cGVjdCg0MDMpO1xuICAgICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnZXJyb3InKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnbWVzc2FnZScpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuZXJyb3IpLnRvQmUoJ0ZvcmJpZGRlbicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWRtaW4gUGFnZSBBdXRoZW50aWNhdGlvbiBGbG93JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBhdXRoZW50aWNhdGlvbiBmb3IgYWxsIGFkbWluIGVuZHBvaW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGVuZHBvaW50cyA9IFtcbiAgICAgICAgJy9hcGkvZmVhdHVyZS1tYW5hZ2VtZW50L2ZlYXR1cmVzJyxcbiAgICAgICAgJy9hcGkvbGF3MjUtY29tcGxpYW5jZScsXG4gICAgICAgICcvYXBpL3F1YWxpdHktbWV0cmljcycsXG4gICAgICAgICcvYXBpL3Blcm1pc3Npb25zJ1xuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBlbmRwb2ludCBvZiBlbmRwb2ludHMpIHtcbiAgICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgICAgLmdldChlbmRwb2ludClcbiAgICAgICAgICAuZXhwZWN0KDQwMSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1haW50YWluIHNlc3Npb24gYWNyb3NzIGFkbWluIHBhZ2UgcmVxdWVzdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNYWtlIG11bHRpcGxlIHJlcXVlc3RzIHRvIGVuc3VyZSBzZXNzaW9uIHBlcnNpc3RlbmNlXG4gICAgICBhd2FpdCBhZG1pbkFnZW50XG4gICAgICAgIC5nZXQoJy9hcGkvZmVhdHVyZS1tYW5hZ2VtZW50L2ZlYXR1cmVzJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9sYXcyNS1jb21wbGlhbmNlJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgICAgICBcbiAgICAgIGF3YWl0IGFkbWluQWdlbnRcbiAgICAgICAgLmdldCgnL2FwaS9xdWFsaXR5LW1ldHJpY3MnKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG4gICAgICAgIFxuICAgICAgYXdhaXQgYWRtaW5BZ2VudFxuICAgICAgICAuZ2V0KCcvYXBpL3Blcm1pc3Npb25zJylcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==