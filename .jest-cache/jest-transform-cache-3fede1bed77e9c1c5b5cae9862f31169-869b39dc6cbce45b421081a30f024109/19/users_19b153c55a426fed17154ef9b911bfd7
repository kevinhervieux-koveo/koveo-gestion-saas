9b3e2cacb7ecbb958680bbd61a0e1adf
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerUserRoutes = registerUserRoutes;
const storage_1 = require("../storage");
const schema_1 = require("@shared/schema");
const zod_1 = require("zod");
const auth_1 = require("../auth");
const crypto_1 = require("crypto");
const bcrypt = __importStar(require("bcryptjs"));
// Database-based permissions - no config imports needed
const db_1 = require("../db");
const schema = __importStar(require("../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const input_sanitization_1 = require("../utils/input-sanitization");
const user_creation_logger_1 = require("../utils/user-creation-logger");
const query_cache_1 = require("../query-cache");
const email_service_1 = require("../services/email-service");
/**
 * Registers all user-related API endpoints.
 *
 * @param app - Express application instance.
 */
/**
 * RegisterUserRoutes function.
 * @param app
 * @returns Function result.
 */
function registerUserRoutes(app) {
    /**
     * GET /api/users - Retrieves users with their assignments based on current user's role and organizations.
     */
    app.get('/api/users', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Get users with their full assignment data
            const usersWithAssignments = await storage_1.storage.getUsersWithAssignments();
            // Filter users based on current user's role and permissions
            let filteredUsers;
            if (currentUser.role === 'admin') {
                // Admin can see all users
                filteredUsers = usersWithAssignments;
            }
            else if (['demo_manager', 'demo_tenant', 'demo_resident'].includes(currentUser.role)) {
                // Demo users can only see other demo users
                filteredUsers = usersWithAssignments.filter(user => ['demo_manager', 'demo_tenant', 'demo_resident'].includes(user.role));
            }
            else {
                // Regular managers and other users can only see non-demo users from their organizations
                // Get the organization IDs that the current user has access to
                const userOrgIds = (await storage_1.storage.getUserOrganizations(currentUser.id)).map(org => org.organizationId);
                // Filter users to only include non-demo users from accessible organizations
                filteredUsers = usersWithAssignments.filter(user => {
                    // Exclude demo users from regular manager view
                    if (['demo_manager', 'demo_tenant', 'demo_resident'].includes(user.role)) {
                        return false;
                    }
                    const hasAccess = user.organizations?.some(org => userOrgIds.includes(org.id)) || false;
                    return hasAccess;
                });
            }
            res.json(filteredUsers);
        }
        catch (error) {
            console.error('❌ Error fetching users:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch users',
            });
        }
    });
    /**
     * GET /api/users/:id - Retrieves a specific user by ID.
     */
    app.get('/api/users/:id', async (req, res) => {
        try {
            const { id } = req.params;
            if (!id) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            const user = await storage_1.storage.getUser(id);
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('❌ Error fetching user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user',
            });
        }
    });
    /**
     * GET /api/users/email/:email - Retrieves a user by email address.
     */
    app.get('/api/users/email/:email', async (req, res) => {
        try {
            const { email } = req.params;
            if (!email) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'Email is required',
                });
            }
            const user = await storage_1.storage.getUserByEmail(email);
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('❌ Error fetching user by email:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user',
            });
        }
    });
    /**
     * POST /api/users - Creates a new user.
     */
    app.post('/api/users', async (req, res) => {
        try {
            // Enhanced password validation using utility
            if (req.body.password) {
                const passwordValidation = (0, input_sanitization_1.validatePasswordStrength)(req.body.password);
                if (!passwordValidation.isValid) {
                    return res.status(400).json({
                        error: 'Validation error',
                        message: passwordValidation.message,
                        code: 'WEAK_PASSWORD',
                    });
                }
            }
            // Sanitize and normalize all input data
            const normalizedData = {
                ...req.body,
                email: (0, input_sanitization_1.normalizeEmail)(req.body.email || ''),
                firstName: (0, input_sanitization_1.sanitizeName)(req.body.firstName || ''),
                lastName: (0, input_sanitization_1.sanitizeName)(req.body.lastName || ''),
                phone: req.body.phone ? (0, input_sanitization_1.sanitizeString)(req.body.phone) : '',
                language: req.body.language || 'fr',
            };
            // Generate unique username if not provided
            if (!normalizedData.username && normalizedData.email) {
                const baseUsername = (0, input_sanitization_1.generateUsernameFromEmail)(normalizedData.email);
                let username = baseUsername;
                // Ensure username uniqueness
                let usernameCounter = 1;
                let existingUsername = await db_1.db
                    .select({ username: schema.users.username })
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.username, username))
                    .limit(1);
                while (existingUsername.length > 0) {
                    username = `${baseUsername}${usernameCounter}`;
                    usernameCounter++;
                    existingUsername = await db_1.db
                        .select({ username: schema.users.username })
                        .from(schema.users)
                        .where((0, drizzle_orm_1.eq)(schema.users.username, username))
                        .limit(1);
                }
                normalizedData.username = username;
            }
            const validatedData = schema_1.insertUserSchema.parse(normalizedData);
            // Check if user with email already exists
            const existingUser = await storage_1.storage.getUserByEmail(validatedData.email);
            if (existingUser) {
                return res.status(409).json({
                    _error: 'Conflict',
                    message: 'User with this email already exists',
                });
            }
            const user = await storage_1.storage.createUser(validatedData);
            // Log successful user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: user.id,
                email: user.email,
                role: user.role,
                method: 'direct',
                success: true,
                timestamp: new Date(),
                ipAddress: req.ip,
                userAgent: req.get('User-Agent'),
            });
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.status(201).json(userWithoutPassword);
        }
        catch (error) {
            // Log failed user creation attempt
            (0, user_creation_logger_1.logUserCreation)({
                email: req.body.email || 'unknown',
                role: req.body.role || 'unknown',
                method: 'direct',
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                timestamp: new Date(),
                ipAddress: req.ip,
                userAgent: req.get('User-Agent'),
            });
            if (error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    error: 'Validation error',
                    message: 'Invalid user data',
                    details: error.issues,
                });
            }
            console.error('❌ Error creating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create user',
            });
        }
    });
    /**
     * PUT /api/users/:id - Updates an existing user.
     */
    app.put('/api/users/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (!id) {
                return res.status(400).json({
                    error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            // Get the target user being updated
            const targetUser = await storage_1.storage.getUser(id);
            if (!targetUser) {
                return res.status(404).json({
                    error: 'Not found',
                    message: 'User not found',
                });
            }
            // Role-based access control for user updates
            const { role: newRole } = req.body;
            // Validate role assignment permissions
            if (newRole && newRole !== targetUser.role) {
                // Admin can assign any role
                if (currentUser.role === 'admin') {
                    // Admin has no restrictions
                }
                // Manager restrictions
                else if (currentUser.role === 'manager') {
                    // Managers cannot escalate to admin
                    if (newRole === 'admin') {
                        return res.status(403).json({
                            error: 'Permission denied',
                            message: 'Managers cannot assign admin role',
                            code: 'ROLE_ESCALATION_DENIED',
                        });
                    }
                    // Managers can only assign manager/tenant/resident roles
                    if (!['manager', 'tenant', 'resident'].includes(newRole)) {
                        return res.status(403).json({
                            error: 'Permission denied',
                            message: 'Managers can only assign manager, tenant, or resident roles',
                            code: 'INVALID_ROLE_ASSIGNMENT',
                        });
                    }
                }
                // Demo manager restrictions
                else if (currentUser.role === 'demo_manager') {
                    // Demo managers can only assign demo roles
                    if (!['demo_manager', 'demo_tenant', 'demo_resident'].includes(newRole)) {
                        return res.status(403).json({
                            error: 'Permission denied',
                            message: 'Demo managers can only assign demo roles',
                            code: 'INVALID_DEMO_ROLE_ASSIGNMENT',
                        });
                    }
                }
                // Other roles cannot assign roles
                else {
                    return res.status(403).json({
                        error: 'Permission denied',
                        message: 'Insufficient permissions to assign roles',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
                // Organization scope validation for role assignments
                if (currentUser.role === 'manager' || currentUser.role === 'demo_manager') {
                    // Get current user's organizations
                    const currentUserOrgs = await storage_1.storage.getUserOrganizations(currentUser.id);
                    const currentUserOrgIds = currentUserOrgs.map(org => org.organizationId);
                    // Get target user's organizations
                    const targetUserOrgs = await storage_1.storage.getUserOrganizations(id);
                    const targetUserOrgIds = targetUserOrgs.map(org => org.organizationId);
                    // Check if current user has access to target user's organizations
                    const hasAccessToTargetOrgs = targetUserOrgIds.some(orgId => currentUserOrgIds.includes(orgId));
                    if (!hasAccessToTargetOrgs && targetUserOrgIds.length > 0) {
                        return res.status(403).json({
                            error: 'Permission denied',
                            message: 'Cannot modify users outside your organization scope',
                            code: 'ORGANIZATION_SCOPE_VIOLATION',
                        });
                    }
                    // For demo managers, validate demo role assignments
                    if (currentUser.role === 'demo_manager') {
                        // Check if target organizations are demo organizations
                        const targetOrgs = await db_1.db
                            .select()
                            .from(schema.organizations)
                            .where((0, drizzle_orm_1.inArray)(schema.organizations.id, targetUserOrgIds));
                        const hasNonDemoOrgs = targetOrgs.some(org => org.type !== 'demo');
                        if (hasNonDemoOrgs) {
                            return res.status(403).json({
                                error: 'Permission denied',
                                message: 'Demo managers cannot assign roles to users in non-demo organizations',
                                code: 'DEMO_SCOPE_VIOLATION',
                            });
                        }
                    }
                }
            }
            // Validate the update data (excluding password updates for security)
            const updateSchema = schema_1.insertUserSchema.partial().omit({ password: true });
            const validatedData = updateSchema.parse(req.body);
            const user = await storage_1.storage.updateUser(id, {
                ...validatedData,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    error: 'Not found',
                    message: 'User not found',
                });
            }
            // Clear relevant caches
            query_cache_1.queryCache.invalidate('users', 'all_users');
            query_cache_1.queryCache.invalidate('users', `user:${id}`);
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            if (error instanceof zod_1.z.ZodError) {
                return res.status(400).json({
                    error: 'Validation error',
                    message: 'Invalid user data',
                    details: error.issues,
                });
            }
            console.error('❌ Error updating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update user',
            });
        }
    });
    /**
     * DELETE /api/users/:id - Deactivates a user (soft delete).
     */
    app.delete('/api/users/:id', async (req, res) => {
        try {
            const { id } = req.params;
            if (!id) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User ID is required',
                });
            }
            // Soft delete by setting isActive to false
            const user = await storage_1.storage.updateUser(id, {
                isActive: false,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'User not found',
                });
            }
            res.json({
                message: 'User deactivated successfully',
                id: user.id,
            });
        }
        catch (error) {
            console.error('❌ Error deactivating user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to deactivate user',
            });
        }
    });
    /**
     * GET /api/user-organizations - Get current user's organizations.
     */
    app.get('/api/user-organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const organizations = await storage_1.storage.getUserOrganizations(currentUser.id);
            res.json(organizations);
        }
        catch (error) {
            console.error('❌ Error getting user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user organizations',
            });
        }
    });
    /**
     * GET /api/user-residences - Get current user's residences.
     */
    app.get('/api/user-residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const residences = await storage_1.storage.getUserResidences(currentUser.id);
            res.json(residences);
        }
        catch (error) {
            console.error('❌ Error getting user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/admin/all-user-organizations - Get user-organization relationships (admin: all, manager: filtered by their orgs).
     */
    app.get('/api/admin/all-user-organizations', auth_1.requireAuth, async (req, res) => {
        console.log('🔍 [API] all-user-organizations endpoint called by user:', req.user?.email);
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can access user assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to view user assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let userOrganizations;
            if (currentUser.role === 'admin') {
                // Admin sees all user-organization relationships
                userOrganizations = await db_1.db
                    .select({
                    userId: schema.userOrganizations.userId,
                    organizationId: schema.userOrganizations.organizationId,
                    organizationRole: schema.userOrganizations.organizationRole,
                    isActive: schema.userOrganizations.isActive,
                })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
            }
            else {
                // Manager sees only relationships for their organizations
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (orgIds.length === 0) {
                    return res.json([]);
                }
                userOrganizations = await db_1.db
                    .select({
                    userId: schema.userOrganizations.userId,
                    organizationId: schema.userOrganizations.organizationId,
                    organizationRole: schema.userOrganizations.organizationRole,
                    isActive: schema.userOrganizations.isActive,
                })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, orgIds)));
            }
            res.json(userOrganizations);
        }
        catch (error) {
            console.error('❌ Error getting all user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user organizations',
            });
        }
    });
    /**
     * GET /api/admin/all-user-residences - Get user-residence relationships (admin: all, manager: filtered by their orgs).
     */
    app.get('/api/admin/all-user-residences', auth_1.requireAuth, async (req, res) => {
        console.log('🔍 [API] all-user-residences endpoint called by user:', req.user?.email);
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can access user assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to view user assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let userResidences;
            if (currentUser.role === 'admin') {
                // Admin sees all user-residence relationships
                userResidences = await db_1.db
                    .select({
                    userId: schema.userResidences.userId,
                    residenceId: schema.userResidences.residenceId,
                    relationshipType: schema.userResidences.relationshipType,
                    startDate: schema.userResidences.startDate,
                    endDate: schema.userResidences.endDate,
                    isActive: schema.userResidences.isActive,
                })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
            }
            else {
                // Manager sees only relationships for residences in their organizations
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (orgIds.length === 0) {
                    return res.json([]);
                }
                // Get residences in manager's organizations
                const accessibleResidences = await db_1.db
                    .select({ residenceId: schema.residences.id })
                    .from(schema.residences)
                    .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                const residenceIds = accessibleResidences.map((res) => res.residenceId);
                if (residenceIds.length === 0) {
                    return res.json([]);
                }
                userResidences = await db_1.db
                    .select({
                    userId: schema.userResidences.userId,
                    residenceId: schema.userResidences.residenceId,
                    relationshipType: schema.userResidences.relationshipType,
                    startDate: schema.userResidences.startDate,
                    endDate: schema.userResidences.endDate,
                    isActive: schema.userResidences.isActive,
                })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.inArray)(schema.userResidences.residenceId, residenceIds)));
            }
            res.json(userResidences);
        }
        catch (error) {
            console.error('❌ Error getting all user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/user/permissions - Retrieves the current user's permissions based on their role.
     * Protected endpoint that requires authentication.
     */
    app.get('/api/user/permissions', auth_1.requireAuth, async (req, res) => {
        try {
            // Get user role from session
            const userRole = req.user?.role;
            if (!userRole) {
                return res.status(400).json({
                    _error: 'Bad request',
                    message: 'User role not found in session',
                });
            }
            // Get permissions for the user's role from database
            const rolePermissions = await storage_1.storage.getRolePermissions();
            const userPermissions = rolePermissions
                .filter((rp) => rp.role === userRole)
                .map((rp) => rp.permission?.name)
                .filter(Boolean);
            // Create response with Zod validation
            const responseData = {
                role: userRole,
                permissions: userPermissions,
                permissionCount: userPermissions.length,
            };
            // Validate response with Zod schema
            const permissionsResponseSchema = zod_1.z.object({
                role: zod_1.z.enum(['admin', 'manager', 'tenant', 'resident']),
                permissions: zod_1.z.array(zod_1.z.string()),
                permissionCount: zod_1.z.number(),
            });
            const validatedResponse = permissionsResponseSchema.parse(responseData);
            res.json(validatedResponse);
        }
        catch (error) {
            if (error instanceof zod_1.z.ZodError) {
                return res.status(500).json({
                    error: 'Internal server error',
                    message: 'Failed to validate permissions response',
                    details: error.issues,
                });
            }
            console.error('❌ Error fetching user permissions:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user permissions',
            });
        }
    });
    /**
     * PUT /api/users/:id/organizations - Updates user's organization assignments.
     * Admin: can assign/remove any organization
     * Manager: cannot modify organization assignments.
     */
    app.put('/api/users/:id/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            const { organizationIds } = req.body;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins can modify organization assignments
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Only administrators can modify organization assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!userId || !Array.isArray(organizationIds)) {
                return res.status(400).json({
                    message: 'User ID and organization IDs array are required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify user exists
            const user = await storage_1.storage.getUser(userId);
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove existing organization assignments
            await db_1.db.delete(schema.userOrganizations).where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId));
            // Add new organization assignments
            if (organizationIds.length > 0) {
                const newAssignments = organizationIds.map((orgId) => ({
                    userId,
                    organizationId: orgId,
                    organizationRole: user.role,
                    isActive: true,
                }));
                await db_1.db.insert(schema.userOrganizations).values(newAssignments);
            }
            res.json({
                message: 'Organization assignments updated successfully',
                userId,
                organizationIds,
            });
        }
        catch (error) {
            console.error('❌ Error updating organization assignments:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update organization assignments',
            });
        }
    });
    /**
     * PUT /api/users/:id/buildings - Updates user's building assignments.
     * Admin and Manager: can assign/remove buildings they have access to
     */
    app.put('/api/users/:id/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            const { buildingIds } = req.body;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can modify building assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Only administrators and managers can modify building assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!userId || !Array.isArray(buildingIds)) {
                return res.status(400).json({
                    message: 'User ID and building IDs array are required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify user exists
            const user = await storage_1.storage.getUser(userId);
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // For now, we'll create user-residence relationships for each building
            // This is a simplified approach - in a real system you'd have user-building relationships
            // Get residences for the selected buildings
            const residences = await db_1.db
                .select()
                .from(schema.residences)
                .where((0, drizzle_orm_1.inArray)(schema.residences.buildingId, buildingIds));
            // Remove existing residence assignments for this user
            await db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId));
            // Add new residence assignments (one per building - taking the first residence)
            if (residences.length > 0) {
                const buildingToResidence = new Map();
                residences.forEach(residence => {
                    if (!buildingToResidence.has(residence.buildingId)) {
                        buildingToResidence.set(residence.buildingId, residence);
                    }
                });
                const newAssignments = Array.from(buildingToResidence.values()).map((residence) => ({
                    userId,
                    residenceId: residence.id,
                    relationshipType: user.role === 'manager' ? 'manager' : 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                    isActive: true,
                }));
                await db_1.db.insert(schema.userResidences).values(newAssignments);
            }
            res.json({
                message: 'Building assignments updated successfully',
                userId,
                buildingIds,
            });
        }
        catch (error) {
            console.error('❌ Error updating building assignments:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update building assignments',
            });
        }
    });
    /**
     * GET /api/users/:id/residences - Get user's accessible residences.
     */
    app.get('/api/users/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Users can only access their own residences unless they're admin/manager
            if (currentUser.id !== userId && !['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const residences = await storage_1.storage.getUserResidences(userId);
            res.json(residences);
        }
        catch (error) {
            console.error('❌ Error getting user residences:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user residences',
            });
        }
    });
    /**
     * GET /api/users/:id/buildings - Get user's accessible buildings based on their residences.
     */
    app.get('/api/users/:id/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Users can only access their own buildings unless they're admin/manager
            if (currentUser.id !== userId && !['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Get user's residences with building information
            const userResidences = await db_1.db
                .select({
                residenceId: schema.userResidences.residenceId,
                buildingId: schema.residences.buildingId,
            })
                .from(schema.userResidences)
                .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
            if (!userResidences || userResidences.length === 0) {
                return res.json({ buildings: [] });
            }
            // Get unique building IDs from user's residences
            const buildingIds = [...new Set(userResidences.map(ur => ur.buildingId).filter(Boolean))];
            if (buildingIds.length === 0) {
                return res.json({ buildings: [] });
            }
            // Fetch building details with stats using the existing logic from /api/manager/buildings
            const buildingDetails = await db_1.db
                .select({
                id: schema.buildings.id,
                name: schema.buildings.name,
                address: schema.buildings.address,
                city: schema.buildings.city,
                province: schema.buildings.province,
                postalCode: schema.buildings.postalCode,
                buildingType: schema.buildings.buildingType,
                yearBuilt: schema.buildings.yearBuilt,
                totalFloors: schema.buildings.totalFloors,
                parkingSpaces: schema.buildings.parkingSpaces,
                storageSpaces: schema.buildings.storageSpaces,
                managementCompany: schema.buildings.managementCompany,
                amenities: schema.buildings.amenities,
                organizationId: schema.buildings.organizationId,
                organizationName: schema.organizations.name,
                organizationType: schema.organizations.type,
            })
                .from(schema.buildings)
                .leftJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.buildings.organizationId, schema.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.id, buildingIds), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
            // Calculate stats for each building
            const buildingsWithStats = await Promise.all(buildingDetails.map(async (building) => {
                const [totalUnits, occupiedUnits] = await Promise.all([
                    db_1.db
                        .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                        .from(schema.residences)
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, building.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)))
                        .then(result => result[0]?.count || 0),
                    db_1.db
                        .select({ count: (0, drizzle_orm_1.sql) `count(distinct ${schema.residences.id})` })
                        .from(schema.residences)
                        .leftJoin(schema.userResidences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, building.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)))
                        .then(result => result[0]?.count || 0),
                ]);
                const vacantUnits = totalUnits - occupiedUnits;
                const occupancyRate = totalUnits > 0 ? (occupiedUnits / totalUnits) * 100 : 0;
                return {
                    ...building,
                    totalUnits,
                    occupiedUnits,
                    vacantUnits,
                    occupancyRate,
                };
            }));
            res.json({ buildings: buildingsWithStats });
        }
        catch (error) {
            console.error('❌ Error getting user buildings:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to get user buildings',
            });
        }
    });
    /**
     * PUT /api/users/:id/residences - Updates user's residence assignments.
     * Admin: can assign/remove any residence
     * Manager: can assign/remove residences within their organizations only.
     */
    app.put('/api/users/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: userId } = req.params;
            const { residenceAssignments } = req.body; // Array of { residenceId, relationshipType, startDate, endDate }
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can modify residence assignments
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to modify residence assignments',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!userId || !Array.isArray(residenceAssignments)) {
                return res.status(400).json({
                    message: 'User ID and residence assignments array are required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify user exists
            const user = await storage_1.storage.getUser(userId);
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // For managers, verify they can access all requested residences
            if (currentUser.role === 'manager') {
                for (const assignment of residenceAssignments) {
                    // Get the building for this residence
                    const residence = await db_1.db
                        .select({ buildingId: schema.residences.buildingId })
                        .from(schema.residences)
                        .where((0, drizzle_orm_1.eq)(schema.residences.id, assignment.residenceId))
                        .limit(1);
                    if (residence.length === 0) {
                        return res.status(404).json({
                            message: `Residence ${assignment.residenceId} not found`,
                            code: 'RESIDENCE_NOT_FOUND',
                        });
                    }
                    // Check if manager has access to this building
                    // Get buildings accessible to this manager through their organizations
                    const managerOrgs = await db_1.db
                        .select({ organizationId: schema.userOrganizations.organizationId })
                        .from(schema.userOrganizations)
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                    const orgIds = managerOrgs.map((org) => org.organizationId);
                    const accessibleBuildings = orgIds.length > 0
                        ? await db_1.db
                            .select({ id: schema.buildings.id })
                            .from(schema.buildings)
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)))
                        : [];
                    const hasAccess = accessibleBuildings.some((b) => b.id === residence[0].buildingId);
                    if (!hasAccess) {
                        return res.status(403).json({
                            message: `Insufficient permissions for residence ${assignment.residenceId}`,
                            code: 'INSUFFICIENT_PERMISSIONS',
                        });
                    }
                }
            }
            // Remove existing residence assignments
            await db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId));
            // Add new residence assignments
            if (residenceAssignments.length > 0) {
                const newAssignments = residenceAssignments.map((assignment) => ({
                    userId,
                    residenceId: assignment.residenceId,
                    relationshipType: assignment.relationshipType || 'tenant',
                    startDate: assignment.startDate || new Date().toISOString().split('T')[0],
                    endDate: assignment.endDate || null,
                    isActive: true,
                }));
                await db_1.db.insert(schema.userResidences).values(newAssignments);
            }
            res.json({
                message: 'Residence assignments updated successfully',
                userId,
                assignmentCount: residenceAssignments.length,
            });
        }
        catch (error) {
            console.error('❌ Error updating residence assignments:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update residence assignments',
            });
        }
    });
    /**
     * GET /api/users/me/organizations - Get organizations accessible to current user.
     * Used by invite form to populate organization dropdown.
     */
    app.get('/api/users/me/organizations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            console.log(`📊 Fetching user-accessible organizations for ${currentUser.email} (${currentUser.role})`);
            // Get organizations based on user role - same logic as /api/organizations
            let organizationsQuery;
            if (currentUser.role === 'admin') {
                // Admin can see all organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema.organizations.id,
                    name: schema.organizations.name,
                    type: schema.organizations.type,
                    address: schema.organizations.address,
                    city: schema.organizations.city,
                    province: schema.organizations.province,
                    postalCode: schema.organizations.postalCode,
                    phone: schema.organizations.phone,
                    email: schema.organizations.email,
                    website: schema.organizations.website,
                    registrationNumber: schema.organizations.registrationNumber,
                    isActive: schema.organizations.isActive,
                    createdAt: schema.organizations.createdAt,
                })
                    .from(schema.organizations)
                    .where((0, drizzle_orm_1.eq)(schema.organizations.isActive, true))
                    .orderBy(schema.organizations.name);
            }
            else {
                // Other users see organizations they have access to through user_organizations
                organizationsQuery = db_1.db
                    .select({
                    id: schema.organizations.id,
                    name: schema.organizations.name,
                    type: schema.organizations.type,
                    address: schema.organizations.address,
                    city: schema.organizations.city,
                    province: schema.organizations.province,
                    postalCode: schema.organizations.postalCode,
                    phone: schema.organizations.phone,
                    email: schema.organizations.email,
                    website: schema.organizations.website,
                    registrationNumber: schema.organizations.registrationNumber,
                    isActive: schema.organizations.isActive,
                    createdAt: schema.organizations.createdAt,
                })
                    .from(schema.organizations)
                    .innerJoin(schema.userOrganizations, (0, drizzle_orm_1.eq)(schema.organizations.id, schema.userOrganizations.organizationId))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.organizations.isActive, true), (0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)))
                    .orderBy(schema.organizations.name);
            }
            const accessibleOrganizations = await organizationsQuery;
            console.log(`✅ Found ${accessibleOrganizations.length} organizations for user ${currentUser.id}`);
            // Return array directly (not wrapped in object) - same format as /api/organizations
            res.json(accessibleOrganizations);
        }
        catch (error) {
            console.error('❌ Error fetching user organizations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch user organizations',
            });
        }
    });
    /**
     * GET /api/users/me/data-export - Download user data for Law 25 compliance.
     */
    app.get('/api/users/me/data-export', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Get all user data for export
            const userData = await storage_1.storage.getUser(currentUser.id);
            if (!userData) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove sensitive fields
            const { password, ...userDataExport } = userData;
            // Get related data
            const [organizations, residences, bills, documents, notifications, maintenanceRequests] = await Promise.all([
                db_1.db
                    .select()
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.bills)
                    .innerJoin(schema.userResidences, (0, drizzle_orm_1.eq)(schema.bills.residenceId, schema.userResidences.residenceId))
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.notifications)
                    .where((0, drizzle_orm_1.eq)(schema.notifications.userId, currentUser.id)),
                db_1.db
                    .select()
                    .from(schema.maintenanceRequests)
                    .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, currentUser.id)),
            ]);
            const exportData = {
                personalInformation: userDataExport,
                organizations,
                residences,
                bills: bills.map((b) => b.bills),
                documents: documents,
                notifications,
                maintenanceRequests,
                exportDate: new Date().toISOString(),
                note: 'This export contains all personal data we have on file for you in compliance with Quebec Law 25.',
            };
            res.setHeader('Content-Type', 'application/json');
            res.setHeader('Content-Disposition', `attachment; filename="user-data-export-${currentUser.id}-${new Date().toISOString().split('T')[0]}.json"`);
            res.json(exportData);
        }
        catch (error) {
            console.error('❌ Error exporting user data:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to export user data',
            });
        }
    });
    /**
     * POST /api/users/me/delete-account - Complete account deletion for Law 25 compliance.
     */
    app.post('/api/users/me/delete-account', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { confirmEmail, reason } = req.body;
            // Verify email confirmation
            if (confirmEmail !== currentUser.email) {
                return res.status(400).json({
                    message: 'Email confirmation does not match',
                    code: 'EMAIL_MISMATCH',
                });
            }
            // Delete all related data in the correct order to handle foreign key constraints
            await Promise.all([
                // Delete user relationships
                db_1.db
                    .delete(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id)),
                db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, currentUser.id)),
                db_1.db
                    .delete(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, currentUser.id)),
                // Delete user-created content
                db_1.db.delete(schema.notifications).where((0, drizzle_orm_1.eq)(schema.notifications.userId, currentUser.id)),
                db_1.db
                    .delete(schema.maintenanceRequests)
                    .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, currentUser.id)),
                // Delete invitations
                db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, currentUser.email)),
            ]);
            // Finally, delete the user account
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, currentUser.id));
            // Log the deletion for audit purposes
            console.log(`User account deleted: ${currentUser.email} (${currentUser.id}). Reason: ${reason || 'Not provided'}`);
            // Clear session
            if (req.session) {
                req.session.destroy((err) => {
                    if (err) {
                        console.error('Failed to destroy session after account deletion:', err);
                    }
                });
            }
            res.json({
                message: 'Account successfully deleted. All personal data has been permanently removed from our systems.',
                deletionDate: new Date().toISOString(),
            });
        }
        catch (error) {
            console.error('❌ Error deleting account:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to delete account. Please contact support.',
            });
        }
    });
    /**
     * PUT /api/users/me - Update current user's profile.
     */
    app.put('/api/users/me', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Validate the update data (excluding password updates for security)
            const updateSchema = schema_1.insertUserSchema
                .partial()
                .omit({ password: true, id: true, role: true });
            const validatedData = updateSchema.parse(req.body);
            const user = await storage_1.storage.updateUser(currentUser.id, {
                ...validatedData,
                updatedAt: new Date(),
            });
            if (!user) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            // Remove sensitive information before sending response
            const { password, ...userWithoutPassword } = user;
            res.json(userWithoutPassword);
        }
        catch (error) {
            console.error('❌ Error updating user profile:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to update profile',
            });
        }
    });
    /**
     * POST /api/users/:id/delete-account - RESTRICTED Admin endpoint to delete any user account.
     * SAFETY: Requires email confirmation and deletion reason for audit trail.
     * WARNING: This is a permanent operation that should only be used in exceptional cases.
     */
    app.post('/api/users/:id/delete-account', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: targetUserId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins can delete other users' accounts
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Only administrators can delete user accounts',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Additional safety check: Log this critical operation
            console.warn(`⚠️  CRITICAL: Admin ${currentUser.email} attempting to delete user ${targetUserId}`);
            if (!targetUserId) {
                return res.status(400).json({
                    message: 'User ID is required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Verify target user exists
            const targetUser = await storage_1.storage.getUser(targetUserId);
            if (!targetUser) {
                return res.status(404).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            const { confirmEmail, reason } = req.body;
            // Verify email confirmation
            if (confirmEmail !== targetUser.email) {
                return res.status(400).json({
                    message: 'Email confirmation does not match',
                    code: 'EMAIL_MISMATCH',
                });
            }
            // Delete all related data in the correct order to handle foreign key constraints
            const deletionPromises = [
                // Delete user relationships
                db_1.db
                    .delete(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, targetUserId)),
                db_1.db.delete(schema.userResidences).where((0, drizzle_orm_1.eq)(schema.userResidences.userId, targetUserId)),
                db_1.db
                    .delete(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.uploadedById, targetUserId)),
                // Delete invitations
                db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, targetUser.email)),
            ];
            // Try to delete from optional tables that might not exist
            const optionalDeletions = [
                async () => {
                    try {
                        await db_1.db
                            .delete(schema.notifications)
                            .where((0, drizzle_orm_1.eq)(schema.notifications.userId, targetUserId));
                    }
                    catch (error) {
                        if (error.cause?.code === '42P01') {
                            console.log('Notifications table not found, skipping...');
                        }
                        else {
                            throw error;
                        }
                    }
                },
                async () => {
                    try {
                        await db_1.db
                            .delete(schema.maintenanceRequests)
                            .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.submittedBy, targetUserId));
                    }
                    catch (error) {
                        if (error.cause?.code === '42P01') {
                            console.log('Maintenance requests table not found, skipping...');
                        }
                        else {
                            throw error;
                        }
                    }
                },
            ];
            // Execute core deletions first
            await Promise.all(deletionPromises);
            // Execute optional deletions
            await Promise.all(optionalDeletions.map((fn) => fn()));
            // Finally, delete the user account
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, targetUserId));
            // Clear all caches to ensure the user list updates immediately
            query_cache_1.queryCache.invalidate('users', 'all_users');
            query_cache_1.queryCache.invalidate('users', `user:${targetUserId}`);
            query_cache_1.queryCache.invalidate('users', `user_email:${targetUser.email}`);
            // Log the deletion for audit purposes
            console.log(`User account deleted by admin ${currentUser.email} (${currentUser.id}): ${targetUser.email} (${targetUserId}). Reason: ${reason || 'Not provided'}`);
            res.json({
                message: 'User account and all associated data have been permanently deleted',
                deletedUserId: targetUserId,
                deletedUserEmail: targetUser.email,
            });
        }
        catch (error) {
            console.error('❌ Error deleting user account:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to delete user account',
            });
        }
    });
    /**
     * POST /api/users/me/change-password - Change current user's password.
     */
    app.post('/api/users/me/change-password', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { currentPassword, newPassword } = req.body;
            if (!currentPassword || !newPassword) {
                return res.status(400).json({
                    message: 'Current password and new password are required',
                    code: 'INVALID_INPUT',
                });
            }
            // Verify current password
            const user = await storage_1.storage.getUser(currentUser.id);
            if (!user || !(await bcrypt.compare(currentPassword, user.password))) {
                return res.status(400).json({
                    message: 'Current password is incorrect',
                    code: 'INVALID_PASSWORD',
                });
            }
            // Hash new password
            const hashedPassword = await bcrypt.hash(newPassword, 12);
            // Update password
            await storage_1.storage.updateUser(currentUser.id, {
                password: hashedPassword,
                updatedAt: new Date(),
            });
            res.json({
                message: 'Password changed successfully',
            });
        }
        catch (error) {
            console.error('❌ Error changing password:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to change password',
            });
        }
    });
    /**
     * POST /api/users/demo - Creates a demo user directly without invitation
     */
    app.post('/api/users/demo', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can create demo users
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const { firstName, lastName, role, organizationId, residenceId } = req.body;
            // Validate demo role
            if (!['demo_manager', 'demo_tenant', 'demo_resident'].includes(role)) {
                return res.status(400).json({
                    message: 'Invalid demo role',
                    code: 'INVALID_ROLE',
                });
            }
            // Validate required fields
            if (!firstName || !lastName || !organizationId) {
                return res.status(400).json({
                    message: 'First name, last name, and organization are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Generate demo email
            const email = `${firstName.toLowerCase()}.${lastName.toLowerCase()}@demo.com`;
            // Check if user already exists
            const existingUser = await storage_1.storage.getUserByEmail(email);
            if (existingUser) {
                return res.status(400).json({
                    message: 'Demo user with this name already exists',
                    code: 'USER_EXISTS',
                });
            }
            // Create demo user with secure random password
            const randomPassword = (0, crypto_1.randomBytes)(12).toString('base64');
            const hashedPassword = await bcrypt.hash(`Demo${randomPassword}!`, 12);
            const userData = {
                firstName: (0, input_sanitization_1.sanitizeName)(firstName),
                lastName: (0, input_sanitization_1.sanitizeName)(lastName),
                email: (0, input_sanitization_1.normalizeEmail)(email),
                username: (0, input_sanitization_1.generateUsernameFromEmail)(email),
                password: hashedPassword,
                language: 'fr', // Default to French for Quebec
                role: role,
                isActive: true,
            };
            const newUser = await storage_1.storage.createUser(userData);
            // Log the user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: newUser.id,
                email: newUser.email,
                method: 'direct',
                role,
                success: true,
                timestamp: new Date(),
            });
            // Clear cache
            query_cache_1.queryCache.invalidate('users', 'all_users');
            res.status(201).json({
                message: 'Demo user created successfully',
                user: {
                    id: newUser.id,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    email: newUser.email,
                    role: newUser.role,
                },
            });
        }
        catch (error) {
            console.error('❌ Error creating demo user:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create demo user',
            });
        }
    });
    /**
     * POST /api/invitations - Creates a new invitation
     */
    app.post('/api/invitations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can send invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            const { organizationId, residenceId, email, role, invitedByUserId, expiresAt, personalMessage, } = req.body;
            // Validate required fields first
            if (!organizationId || !email || !role || !expiresAt) {
                return res.status(400).json({
                    message: 'Organization, email, role, and expiry date are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Then validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                return res.status(400).json({
                    message: 'Invalid email format',
                    code: 'INVALID_EMAIL',
                });
            }
            // Validate role permissions
            if (currentUser.role === 'manager') {
                // Check if manager is trying to invite admin
                if (role === 'admin') {
                    return res.status(403).json({
                        message: 'Managers can only invite resident, tenant, and manager roles',
                        code: 'ROLE_PERMISSION_DENIED',
                    });
                }
                // Get the demo organization to check if it's a demo org
                const targetOrg = await db_1.db
                    .select()
                    .from(schema.organizations)
                    .where((0, drizzle_orm_1.eq)(schema.organizations.id, organizationId))
                    .limit(1);
                if (targetOrg.length > 0 && targetOrg[0].type === 'Demo') {
                    // For demo organizations, allow normal roles (resident, tenant, manager)
                    if (!['resident', 'tenant', 'manager'].includes(role)) {
                        return res.status(403).json({
                            message: 'Invalid role for demo organization',
                            code: 'INVALID_DEMO_ROLE',
                        });
                    }
                }
                else {
                    // For regular organizations, managers can invite resident, tenant, manager
                    if (!['resident', 'tenant', 'manager'].includes(role)) {
                        return res.status(403).json({
                            message: 'Managers can only invite resident, tenant, and manager roles',
                            code: 'ROLE_PERMISSION_DENIED',
                        });
                    }
                }
            }
            // Check if user already exists
            const existingUser = await storage_1.storage.getUserByEmail(email);
            if (existingUser) {
                return res.status(400).json({
                    message: 'User with this email already exists',
                    code: 'USER_EXISTS',
                });
            }
            // Check for existing pending invitations for the same email and organization
            // If found, delete them to replace with new invitation
            const existingInvitations = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.email, email), (0, drizzle_orm_1.eq)(schema.invitations.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.invitations.status, 'pending')));
            if (existingInvitations.length > 0) {
                console.log(`🔄 Replacing ${existingInvitations.length} existing invitation(s) for email: ${email}`);
                // Delete existing pending invitations for this email/organization
                await db_1.db
                    .delete(schema.invitations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.email, email), (0, drizzle_orm_1.eq)(schema.invitations.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.invitations.status, 'pending')));
            }
            // Generate secure invitation token
            const token = (0, crypto_1.randomBytes)(32).toString('hex');
            const tokenHash = (0, crypto_1.createHash)('sha256').update(token).digest('hex');
            // Create invitation record
            const invitationData = {
                organizationId,
                residenceId: residenceId || null,
                email,
                token,
                tokenHash,
                role: role,
                invitedByUserId: currentUser.id,
                expiresAt: new Date(expiresAt),
                personalMessage: personalMessage || null,
            };
            const [newInvitation] = await db_1.db
                .insert(schema.invitations)
                .values(invitationData)
                .returning();
            // Get organization details for email
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, organizationId))
                .limit(1);
            // Send invitation email
            const recipientName = email.split('@')[0]; // Use email prefix as name
            const organizationName = organization?.name || 'Koveo Gestion';
            const inviterName = `${currentUser.firstName || currentUser.email} ${currentUser.lastName || ''}`.trim();
            const emailSent = await email_service_1.emailService.sendInvitationEmail(email, recipientName, token, // Use the unhashed token for the email URL
            organizationName, inviterName, new Date(expiresAt), 'fr', // Default to French for Quebec
            personalMessage);
            // Log invitation creation
            console.log('✅ Invitation created:', {
                id: newInvitation.id,
                email,
                role,
                organizationId,
                invitedBy: currentUser.email,
                emailSent,
            });
            // For tests, we'll treat email failure as success since tests may not have email configured
            if (!emailSent && process.env.NODE_ENV !== 'test') {
                // If email failed but invitation was created, log the issue
                console.error('⚠️ Invitation created but email failed to send');
                return res.status(207).json({
                    message: 'Invitation created but email failed to send',
                    invitationId: newInvitation.id,
                    emailSent: false,
                });
            }
            res.status(201).json({
                message: 'Invitation sent successfully',
                invitationId: newInvitation.id,
                emailSent: true,
            });
        }
        catch (error) {
            console.error('❌ Error creating invitation:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to create invitation',
            });
        }
    });
    /**
     * GET /api/invitations - Gets all invitations (admin/manager only)
     */
    app.get('/api/invitations', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can view invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let invitations;
            if (currentUser.role === 'admin') {
                // Admin can see all invitations
                invitations = await db_1.db
                    .select()
                    .from(schema.invitations)
                    .orderBy(schema.invitations.createdAt);
            }
            else {
                // Managers can only see invitations they sent
                invitations = await db_1.db
                    .select()
                    .from(schema.invitations)
                    .where((0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, currentUser.id))
                    .orderBy(schema.invitations.createdAt);
            }
            res.json(invitations);
        }
        catch (error) {
            console.error('❌ Error fetching invitations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch invitations',
            });
        }
    });
    /**
     * POST /api/invitations/validate - Validates an invitation token
     * Public endpoint for invitation validation during registration
     */
    app.post('/api/invitations/validate', async (req, res) => {
        try {
            const { token } = req.body;
            if (!token) {
                return res.status(400).json({
                    isValid: false,
                    message: 'Token is required',
                    code: 'TOKEN_REQUIRED',
                });
            }
            // Get invitation by token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    isValid: false,
                    message: 'Invitation not found or invalid token',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check if invitation is expired
            const now = new Date();
            const expiresAt = new Date(invitation.expiresAt);
            if (now > expiresAt) {
                return res.status(400).json({
                    isValid: false,
                    message: 'Invitation has expired',
                    code: 'INVITATION_EXPIRED',
                });
            }
            // Check if invitation is already used
            if (invitation.status === 'accepted') {
                return res.status(400).json({
                    isValid: false,
                    message: 'Invitation has already been used',
                    code: 'INVITATION_ALREADY_USED',
                });
            }
            // Get organization information
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, invitation.organizationId))
                .limit(1);
            // Get inviter information
            const [inviter] = await db_1.db
                .select({
                id: schema.users.id,
                firstName: schema.users.firstName,
                lastName: schema.users.lastName,
                email: schema.users.email,
            })
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.id, invitation.invitedByUserId))
                .limit(1);
            // Return successful validation
            res.json({
                isValid: true,
                invitation: {
                    id: invitation.id,
                    email: invitation.email,
                    role: invitation.role,
                    expiresAt: invitation.expiresAt,
                    createdAt: invitation.createdAt,
                },
                organizationName: organization?.name || 'Unknown Organization',
                inviterName: inviter ? `${inviter.firstName} ${inviter.lastName}`.trim() : 'Unknown User',
            });
        }
        catch (error) {
            console.error('❌ Error validating invitation:', error);
            res.status(500).json({
                isValid: false,
                message: 'Internal server error during validation',
                code: 'VALIDATION_ERROR',
            });
        }
    });
    /**
     * POST /api/invitations/accept/:token - Accept an invitation and create user account
     * Public endpoint for completing registration via invitation
     */
    app.post('/api/invitations/accept/:token', async (req, res) => {
        try {
            const { token } = req.params;
            const { firstName, lastName, password, phone, language, dataCollectionConsent, marketingConsent, analyticsConsent, thirdPartyConsent, acknowledgedRights, } = req.body;
            if (!token) {
                return res.status(400).json({
                    message: 'Token is required',
                    code: 'TOKEN_REQUIRED',
                });
            }
            // Get invitation by token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    message: 'Invitation not found or invalid token',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check if invitation is expired
            const now = new Date();
            const expiresAt = new Date(invitation.expiresAt);
            if (now > expiresAt) {
                return res.status(400).json({
                    message: 'Invitation has expired',
                    code: 'INVITATION_EXPIRED',
                });
            }
            // Check if invitation is already used
            if (invitation.status === 'accepted') {
                return res.status(400).json({
                    message: 'Invitation has already been used',
                    code: 'INVITATION_ALREADY_USED',
                });
            }
            // Validate required fields
            if (!firstName || !lastName || !password) {
                return res.status(400).json({
                    message: 'First name, last name, and password are required',
                    code: 'MISSING_REQUIRED_FIELDS',
                });
            }
            // Validate required consents
            if (!dataCollectionConsent || !acknowledgedRights) {
                return res.status(400).json({
                    message: 'Required privacy consents must be given',
                    code: 'MISSING_REQUIRED_CONSENTS',
                });
            }
            // Hash password
            const hashedPassword = await bcrypt.hash(password, 12);
            // Create user account
            const userData = {
                firstName: (0, input_sanitization_1.sanitizeName)(firstName),
                lastName: (0, input_sanitization_1.sanitizeName)(lastName),
                email: (0, input_sanitization_1.normalizeEmail)(invitation.email),
                username: (0, input_sanitization_1.generateUsernameFromEmail)(invitation.email),
                password: hashedPassword,
                phone: phone ? (0, input_sanitization_1.sanitizeString)(phone) : '',
                language: language || 'fr',
                role: invitation.role,
                isActive: true,
                organizationId: invitation.organizationId,
            };
            const newUser = await storage_1.storage.createUser(userData);
            // Create organization assignment if organizationId is provided
            if (invitation.organizationId) {
                await db_1.db.insert(schema.userOrganizations).values({
                    userId: newUser.id,
                    organizationId: invitation.organizationId,
                    organizationRole: invitation.role,
                    isActive: true,
                });
                console.log('✅ User assigned to organization:', {
                    userId: newUser.id,
                    organizationId: invitation.organizationId,
                    role: invitation.role,
                });
            }
            // Create residence assignment if residenceId is provided
            if (invitation.residenceId) {
                await db_1.db.insert(schema.userResidences).values({
                    userId: newUser.id,
                    residenceId: invitation.residenceId,
                    relationshipType: invitation.role === 'tenant' ? 'tenant' : 'occupant',
                    startDate: new Date(),
                    isActive: true,
                });
                console.log('✅ User assigned to residence:', {
                    userId: newUser.id,
                    residenceId: invitation.residenceId,
                    relationshipType: invitation.role === 'tenant' ? 'tenant' : 'occupant',
                });
            }
            // Mark invitation as accepted
            await db_1.db
                .update(schema.invitations)
                .set({
                status: 'accepted',
                acceptedAt: new Date(),
                acceptedBy: newUser.id,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, invitation.id));
            // Log user creation
            (0, user_creation_logger_1.logUserCreation)({
                userId: newUser.id,
                email: newUser.email,
                method: 'invitation',
                role: invitation.role,
                success: true,
                timestamp: new Date(),
            });
            // Clear cache
            query_cache_1.queryCache.invalidate('users', 'all_users');
            query_cache_1.queryCache.invalidate('invitations');
            console.log('✅ User created via invitation acceptance:', {
                userId: newUser.id,
                email: newUser.email,
                role: newUser.role,
                organizationId: invitation.organizationId,
                residenceId: invitation.residenceId,
                assignedToOrganization: !!invitation.organizationId,
                assignedToResidence: !!invitation.residenceId,
            });
            res.status(201).json({
                message: 'Account created successfully',
                user: {
                    id: newUser.id,
                    firstName: newUser.firstName,
                    lastName: newUser.lastName,
                    email: newUser.email,
                    role: newUser.role,
                    language: newUser.language,
                },
            });
        }
        catch (error) {
            console.error('❌ Error accepting invitation:', error);
            res.status(500).json({
                message: 'Internal server error during account creation',
                code: 'INVITATION_ACCEPT_ERROR',
            });
        }
    });
    /**
     * POST /api/invitations/:id/resend - Resends an invitation
     */
    app.post('/api/invitations/:id/resend', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { id } = req.params;
            // Get invitation
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .limit(1);
            if (!invitation) {
                return res.status(404).json({
                    message: 'Invitation not found',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            // Check permissions
            if (currentUser.role !== 'admin' && invitation.invitedByUserId !== currentUser.id) {
                return res.status(403).json({
                    message: 'Can only resend your own invitations',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            // Update invitation with new expiry
            const newExpiresAt = new Date();
            newExpiresAt.setDate(newExpiresAt.getDate() + 7); // Extend by 7 days
            await db_1.db
                .update(schema.invitations)
                .set({
                expiresAt: newExpiresAt,
                status: 'pending',
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id));
            // Get organization details for email
            const [organization] = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, invitation.organizationId))
                .limit(1);
            // Send invitation email again
            const recipientName = invitation.email.split('@')[0]; // Use email prefix as name
            const organizationName = organization?.name || 'Koveo Gestion';
            const inviterName = `${currentUser.firstName || currentUser.email} ${currentUser.lastName || ''}`.trim();
            const emailSent = await email_service_1.emailService.sendInvitationEmail(invitation.email, recipientName, invitation.token, // Use the existing token
            organizationName, inviterName, newExpiresAt, 'fr', // Default to French for Quebec
            invitation.personalMessage);
            console.log('✅ Invitation resent:', {
                id,
                email: invitation.email,
                newExpiresAt,
                emailSent,
            });
            if (!emailSent) {
                console.error('⚠️ Invitation updated but email failed to resend');
                return res.status(207).json({
                    message: 'Invitation updated but email failed to resend',
                    emailSent: false,
                });
            }
            res.json({
                message: 'Invitation resent successfully',
                emailSent: true,
            });
        }
        catch (error) {
            console.error('❌ Error resending invitation:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to resend invitation',
            });
        }
    });
    /**
     * GET /api/invitations/pending - Get pending invitations with role-based filtering.
     * Admin: can see all pending invitations
     * Manager: can only see pending invitations in their organizations
     */
    app.get('/api/invitations/pending', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can view invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to view invitations',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let invitationsQuery;
            if (currentUser.role === 'admin') {
                // Admin sees all pending invitations
                invitationsQuery = db_1.db
                    .select({
                    id: schema.invitations.id,
                    email: schema.invitations.email,
                    role: schema.invitations.role,
                    status: schema.invitations.status,
                    expiresAt: schema.invitations.expiresAt,
                    createdAt: schema.invitations.createdAt,
                    organizationId: schema.invitations.organizationId,
                    buildingId: schema.invitations.buildingId,
                    residenceId: schema.invitations.residenceId,
                    organizationName: schema.organizations.name,
                    buildingName: (0, drizzle_orm_1.sql) `buildings.name`,
                    residenceUnitNumber: (0, drizzle_orm_1.sql) `residences.unit_number`,
                    invitedByName: (0, drizzle_orm_1.sql) `CONCAT(users.first_name, ' ', users.last_name)`,
                })
                    .from(schema.invitations)
                    .leftJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.invitations.organizationId, schema.organizations.id))
                    .leftJoin((0, drizzle_orm_1.sql) `buildings`, (0, drizzle_orm_1.sql) `invitations.building_id = buildings.id`)
                    .leftJoin((0, drizzle_orm_1.sql) `residences`, (0, drizzle_orm_1.sql) `invitations.residence_id = residences.id`)
                    .leftJoin(schema.users, (0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, schema.users.id))
                    .where((0, drizzle_orm_1.eq)(schema.invitations.status, 'pending'));
            }
            else {
                // Manager sees only invitations for their organizations
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (orgIds.length === 0) {
                    return res.json([]);
                }
                invitationsQuery = db_1.db
                    .select({
                    id: schema.invitations.id,
                    email: schema.invitations.email,
                    role: schema.invitations.role,
                    status: schema.invitations.status,
                    expiresAt: schema.invitations.expiresAt,
                    createdAt: schema.invitations.createdAt,
                    organizationId: schema.invitations.organizationId,
                    buildingId: schema.invitations.buildingId,
                    residenceId: schema.invitations.residenceId,
                    organizationName: schema.organizations.name,
                    buildingName: (0, drizzle_orm_1.sql) `buildings.name`,
                    residenceUnitNumber: (0, drizzle_orm_1.sql) `residences.unit_number`,
                    invitedByName: (0, drizzle_orm_1.sql) `CONCAT(users.first_name, ' ', users.last_name)`,
                })
                    .from(schema.invitations)
                    .leftJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.invitations.organizationId, schema.organizations.id))
                    .leftJoin((0, drizzle_orm_1.sql) `buildings`, (0, drizzle_orm_1.sql) `invitations.building_id = buildings.id`)
                    .leftJoin((0, drizzle_orm_1.sql) `residences`, (0, drizzle_orm_1.sql) `invitations.residence_id = residences.id`)
                    .leftJoin(schema.users, (0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, schema.users.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.status, 'pending'), (0, drizzle_orm_1.inArray)(schema.invitations.organizationId, orgIds)));
            }
            const invitations = await invitationsQuery;
            res.json(invitations);
        }
        catch (error) {
            console.error('❌ Error fetching pending invitations:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to fetch pending invitations',
            });
        }
    });
    /**
     * DELETE /api/invitations/:id - Delete a pending invitation.
     * Admin: can delete any invitation
     * Manager: can only delete invitations from their organizations
     */
    app.delete('/api/invitations/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            const { id: invitationId } = req.params;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Only admins and managers can delete invitations
            if (!['admin', 'manager'].includes(currentUser.role)) {
                return res.status(403).json({
                    message: 'Insufficient permissions to delete invitations',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            if (!invitationId) {
                return res.status(400).json({
                    message: 'Invitation ID is required',
                    code: 'INVALID_REQUEST',
                });
            }
            // Get the invitation to check permissions
            const invitation = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, invitationId))
                .limit(1);
            if (invitation.length === 0) {
                return res.status(404).json({
                    message: 'Invitation not found',
                    code: 'INVITATION_NOT_FOUND',
                });
            }
            const invitationData = invitation[0];
            // Check if manager has permission to delete this invitation
            if (currentUser.role === 'manager') {
                const managerOrgs = await db_1.db
                    .select({ organizationId: schema.userOrganizations.organizationId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                const orgIds = managerOrgs.map((org) => org.organizationId);
                if (!invitationData.organizationId || !orgIds.includes(invitationData.organizationId)) {
                    return res.status(403).json({
                        message: 'You can only delete invitations from your organizations',
                        code: 'INSUFFICIENT_PERMISSIONS',
                    });
                }
            }
            // Delete the invitation
            await db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, invitationId));
            res.json({
                message: 'Invitation deleted successfully',
                invitationId,
            });
        }
        catch (error) {
            console.error('❌ Error deleting invitation:', error);
            res.status(500).json({
                error: 'Internal server error',
                message: 'Failed to delete invitation',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDbEUsSUFBSSxFQUFFLDBCQUEwQjtxQkFDakMsQ0FBQyxDQUFDO2dCQUNMLENBQUM7WUFDSCxDQUFDO1lBRUQsd0JBQXdCO1lBQ3hCLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO1lBRW5GLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsT0FBTyxFQUFFLGlDQUFpQztnQkFDMUMsWUFBWTthQUNiLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsOEJBQThCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDckQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLEtBQUssRUFBRSx1QkFBdUI7Z0JBQzlCLE9BQU8sRUFBRSw2QkFBNkI7YUFDdkMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9hcGkvdXNlcnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBFeHByZXNzIH0gZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgeyBzdG9yYWdlIH0gZnJvbSAnLi4vc3RvcmFnZSc7XG5pbXBvcnQgeyBpbnNlcnRVc2VyU2NoZW1hLCB0eXBlIFVzZXIsIHR5cGUgSW5zZXJ0VXNlciB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgcmVxdWlyZUF1dGggfSBmcm9tICcuLi9hdXRoJztcbmltcG9ydCB7IGNyZWF0ZUhhc2gsIHJhbmRvbUJ5dGVzIH0gZnJvbSAnY3J5cHRvJztcbmltcG9ydCAqIGFzIGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG4vLyBEYXRhYmFzZS1iYXNlZCBwZXJtaXNzaW9ucyAtIG5vIGNvbmZpZyBpbXBvcnRzIG5lZWRlZFxuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSwgYW5kLCBpbkFycmF5LCBzcWwsIGx0IH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IHtcbiAgc2FuaXRpemVTdHJpbmcsXG4gIHNhbml0aXplTmFtZSxcbiAgbm9ybWFsaXplRW1haWwsXG4gIHZhbGlkYXRlUGFzc3dvcmRTdHJlbmd0aCxcbiAgZ2VuZXJhdGVVc2VybmFtZUZyb21FbWFpbCxcbn0gZnJvbSAnLi4vdXRpbHMvaW5wdXQtc2FuaXRpemF0aW9uJztcbmltcG9ydCB7IGxvZ1VzZXJDcmVhdGlvbiB9IGZyb20gJy4uL3V0aWxzL3VzZXItY3JlYXRpb24tbG9nZ2VyJztcbmltcG9ydCB7IHF1ZXJ5Q2FjaGUgfSBmcm9tICcuLi9xdWVyeS1jYWNoZSc7XG5pbXBvcnQgeyBlbWFpbFNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9lbWFpbC1zZXJ2aWNlJztcblxuLyoqXG4gKiBSZWdpc3RlcnMgYWxsIHVzZXItcmVsYXRlZCBBUEkgZW5kcG9pbnRzLlxuICpcbiAqIEBwYXJhbSBhcHAgLSBFeHByZXNzIGFwcGxpY2F0aW9uIGluc3RhbmNlLlxuICovXG4vKipcbiAqIFJlZ2lzdGVyVXNlclJvdXRlcyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBhcHBcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyVXNlclJvdXRlcyhhcHA6IEV4cHJlc3MpOiB2b2lkIHtcbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXJzIC0gUmV0cmlldmVzIHVzZXJzIHdpdGggdGhlaXIgYXNzaWdubWVudHMgYmFzZWQgb24gY3VycmVudCB1c2VyJ3Mgcm9sZSBhbmQgb3JnYW5pemF0aW9ucy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlcnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cblxuICAgICAgLy8gR2V0IHVzZXJzIHdpdGggdGhlaXIgZnVsbCBhc3NpZ25tZW50IGRhdGFcbiAgICAgIGNvbnN0IHVzZXJzV2l0aEFzc2lnbm1lbnRzID0gYXdhaXQgc3RvcmFnZS5nZXRVc2Vyc1dpdGhBc3NpZ25tZW50cygpO1xuXG4gICAgICBcblxuICAgICAgLy8gRmlsdGVyIHVzZXJzIGJhc2VkIG9uIGN1cnJlbnQgdXNlcidzIHJvbGUgYW5kIHBlcm1pc3Npb25zXG4gICAgICBsZXQgZmlsdGVyZWRVc2VycztcbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWluIGNhbiBzZWUgYWxsIHVzZXJzXG4gICAgICAgIGZpbHRlcmVkVXNlcnMgPSB1c2Vyc1dpdGhBc3NpZ25tZW50cztcbiAgICAgIH0gZWxzZSBpZiAoWydkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIC8vIERlbW8gdXNlcnMgY2FuIG9ubHkgc2VlIG90aGVyIGRlbW8gdXNlcnNcbiAgICAgICAgZmlsdGVyZWRVc2VycyA9IHVzZXJzV2l0aEFzc2lnbm1lbnRzLmZpbHRlcih1c2VyID0+IFxuICAgICAgICAgIFsnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnXS5pbmNsdWRlcyh1c2VyLnJvbGUpXG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZWd1bGFyIG1hbmFnZXJzIGFuZCBvdGhlciB1c2VycyBjYW4gb25seSBzZWUgbm9uLWRlbW8gdXNlcnMgZnJvbSB0aGVpciBvcmdhbml6YXRpb25zXG4gICAgICAgIC8vIEdldCB0aGUgb3JnYW5pemF0aW9uIElEcyB0aGF0IHRoZSBjdXJyZW50IHVzZXIgaGFzIGFjY2VzcyB0b1xuICAgICAgICBjb25zdCB1c2VyT3JnSWRzID0gKGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnMoY3VycmVudFVzZXIuaWQpKS5tYXAob3JnID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG4gICAgICAgIFxuICAgICAgICAvLyBGaWx0ZXIgdXNlcnMgdG8gb25seSBpbmNsdWRlIG5vbi1kZW1vIHVzZXJzIGZyb20gYWNjZXNzaWJsZSBvcmdhbml6YXRpb25zXG4gICAgICAgIGZpbHRlcmVkVXNlcnMgPSB1c2Vyc1dpdGhBc3NpZ25tZW50cy5maWx0ZXIodXNlciA9PiB7XG4gICAgICAgICAgLy8gRXhjbHVkZSBkZW1vIHVzZXJzIGZyb20gcmVndWxhciBtYW5hZ2VyIHZpZXdcbiAgICAgICAgICBpZiAoWydkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKHVzZXIucm9sZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgaGFzQWNjZXNzID0gdXNlci5vcmdhbml6YXRpb25zPy5zb21lKG9yZyA9PiB1c2VyT3JnSWRzLmluY2x1ZGVzKG9yZy5pZCkpIHx8IGZhbHNlO1xuICAgICAgICAgIHJldHVybiBoYXNBY2Nlc3M7XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG5cbiAgICAgIHJlcy5qc29uKGZpbHRlcmVkVXNlcnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCB1c2VycycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXJzLzppZCAtIFJldHJpZXZlcyBhIHNwZWNpZmljIHVzZXIgYnkgSUQuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL3VzZXJzLzppZCcsIGFzeW5jIChyZXEsIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBpZiAoIWlkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnQmFkIHJlcXVlc3QnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXIoaWQpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIHNlbnNpdGl2ZSBpbmZvcm1hdGlvbiBiZWZvcmUgc2VuZGluZyByZXNwb25zZVxuICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICAgIHJlcy5qc29uKHVzZXJXaXRob3V0UGFzc3dvcmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXInLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvdXNlcnMvZW1haWwvOmVtYWlsIC0gUmV0cmlldmVzIGEgdXNlciBieSBlbWFpbCBhZGRyZXNzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2Vycy9lbWFpbC86ZW1haWwnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBlbWFpbCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgaWYgKCFlbWFpbCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ0JhZCByZXF1ZXN0JyxcbiAgICAgICAgICBtZXNzYWdlOiAnRW1haWwgaXMgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlckJ5RW1haWwoZW1haWwpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIHNlbnNpdGl2ZSBpbmZvcm1hdGlvbiBiZWZvcmUgc2VuZGluZyByZXNwb25zZVxuICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICAgIHJlcy5qc29uKHVzZXJXaXRob3V0UGFzc3dvcmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIGJ5IGVtYWlsOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXInLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL3VzZXJzIC0gQ3JlYXRlcyBhIG5ldyB1c2VyLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvdXNlcnMnLCBhc3luYyAocmVxLCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gRW5oYW5jZWQgcGFzc3dvcmQgdmFsaWRhdGlvbiB1c2luZyB1dGlsaXR5XG4gICAgICBpZiAocmVxLmJvZHkucGFzc3dvcmQpIHtcbiAgICAgICAgY29uc3QgcGFzc3dvcmRWYWxpZGF0aW9uID0gdmFsaWRhdGVQYXNzd29yZFN0cmVuZ3RoKHJlcS5ib2R5LnBhc3N3b3JkKTtcbiAgICAgICAgaWYgKCFwYXNzd29yZFZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgICBlcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogcGFzc3dvcmRWYWxpZGF0aW9uLm1lc3NhZ2UsXG4gICAgICAgICAgICBjb2RlOiAnV0VBS19QQVNTV09SRCcsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU2FuaXRpemUgYW5kIG5vcm1hbGl6ZSBhbGwgaW5wdXQgZGF0YVxuICAgICAgY29uc3Qgbm9ybWFsaXplZERhdGEgPSB7XG4gICAgICAgIC4uLnJlcS5ib2R5LFxuICAgICAgICBlbWFpbDogbm9ybWFsaXplRW1haWwocmVxLmJvZHkuZW1haWwgfHwgJycpLFxuICAgICAgICBmaXJzdE5hbWU6IHNhbml0aXplTmFtZShyZXEuYm9keS5maXJzdE5hbWUgfHwgJycpLFxuICAgICAgICBsYXN0TmFtZTogc2FuaXRpemVOYW1lKHJlcS5ib2R5Lmxhc3ROYW1lIHx8ICcnKSxcbiAgICAgICAgcGhvbmU6IHJlcS5ib2R5LnBob25lID8gc2FuaXRpemVTdHJpbmcocmVxLmJvZHkucGhvbmUpIDogJycsXG4gICAgICAgIGxhbmd1YWdlOiByZXEuYm9keS5sYW5ndWFnZSB8fCAnZnInLFxuICAgICAgfTtcblxuICAgICAgLy8gR2VuZXJhdGUgdW5pcXVlIHVzZXJuYW1lIGlmIG5vdCBwcm92aWRlZFxuICAgICAgaWYgKCFub3JtYWxpemVkRGF0YS51c2VybmFtZSAmJiBub3JtYWxpemVkRGF0YS5lbWFpbCkge1xuICAgICAgICBjb25zdCBiYXNlVXNlcm5hbWUgPSBnZW5lcmF0ZVVzZXJuYW1lRnJvbUVtYWlsKG5vcm1hbGl6ZWREYXRhLmVtYWlsKTtcbiAgICAgICAgbGV0IHVzZXJuYW1lID0gYmFzZVVzZXJuYW1lO1xuXG4gICAgICAgIC8vIEVuc3VyZSB1c2VybmFtZSB1bmlxdWVuZXNzXG4gICAgICAgIGxldCB1c2VybmFtZUNvdW50ZXIgPSAxO1xuICAgICAgICBsZXQgZXhpc3RpbmdVc2VybmFtZSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IHVzZXJuYW1lOiBzY2hlbWEudXNlcnMudXNlcm5hbWUgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy51c2VybmFtZSwgdXNlcm5hbWUpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICB3aGlsZSAoZXhpc3RpbmdVc2VybmFtZS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgdXNlcm5hbWUgPSBgJHtiYXNlVXNlcm5hbWV9JHt1c2VybmFtZUNvdW50ZXJ9YDtcbiAgICAgICAgICB1c2VybmFtZUNvdW50ZXIrKztcbiAgICAgICAgICBleGlzdGluZ1VzZXJuYW1lID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyB1c2VybmFtZTogc2NoZW1hLnVzZXJzLnVzZXJuYW1lIH0pXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLnVzZXJuYW1lLCB1c2VybmFtZSkpXG4gICAgICAgICAgICAubGltaXQoMSk7XG4gICAgICAgIH1cblxuICAgICAgICBub3JtYWxpemVkRGF0YS51c2VybmFtZSA9IHVzZXJuYW1lO1xuICAgICAgfVxuXG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gaW5zZXJ0VXNlclNjaGVtYS5wYXJzZShub3JtYWxpemVkRGF0YSk7XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgd2l0aCBlbWFpbCBhbHJlYWR5IGV4aXN0c1xuICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyQnlFbWFpbCh2YWxpZGF0ZWREYXRhLmVtYWlsKTtcbiAgICAgIGlmIChleGlzdGluZ1VzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA5KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdDb25mbGljdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZVVzZXIodmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIC8vIExvZyBzdWNjZXNzZnVsIHVzZXIgY3JlYXRpb25cbiAgICAgIGxvZ1VzZXJDcmVhdGlvbih7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIHJvbGU6IHVzZXIucm9sZSxcbiAgICAgICAgbWV0aG9kOiAnZGlyZWN0JyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBpcEFkZHJlc3M6IHJlcS5pcCxcbiAgICAgICAgdXNlckFnZW50OiByZXEuZ2V0KCdVc2VyLUFnZW50JyksXG4gICAgICB9KTtcblxuICAgICAgLy8gUmVtb3ZlIHNlbnNpdGl2ZSBpbmZvcm1hdGlvbiBiZWZvcmUgc2VuZGluZyByZXNwb25zZVxuICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlcldpdGhvdXRQYXNzd29yZCB9ID0gdXNlcjtcbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHVzZXJXaXRob3V0UGFzc3dvcmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIExvZyBmYWlsZWQgdXNlciBjcmVhdGlvbiBhdHRlbXB0XG4gICAgICBsb2dVc2VyQ3JlYXRpb24oe1xuICAgICAgICBlbWFpbDogcmVxLmJvZHkuZW1haWwgfHwgJ3Vua25vd24nLFxuICAgICAgICByb2xlOiByZXEuYm9keS5yb2xlIHx8ICd1bmtub3duJyxcbiAgICAgICAgbWV0aG9kOiAnZGlyZWN0JyxcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBpcEFkZHJlc3M6IHJlcS5pcCxcbiAgICAgICAgdXNlckFnZW50OiByZXEuZ2V0KCdVc2VyLUFnZW50JyksXG4gICAgICB9KTtcblxuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdXNlciBkYXRhJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgdXNlcjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQVVQgL2FwaS91c2Vycy86aWQgLSBVcGRhdGVzIGFuIGV4aXN0aW5nIHVzZXIuXG4gICAqL1xuICBhcHAucHV0KCcvYXBpL3VzZXJzLzppZCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcblxuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnQmFkIHJlcXVlc3QnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIElEIGlzIHJlcXVpcmVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB0aGUgdGFyZ2V0IHVzZXIgYmVpbmcgdXBkYXRlZFxuICAgICAgY29uc3QgdGFyZ2V0VXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihpZCk7XG4gICAgICBpZiAoIXRhcmdldFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBlcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wgZm9yIHVzZXIgdXBkYXRlc1xuICAgICAgY29uc3QgeyByb2xlOiBuZXdSb2xlIH0gPSByZXEuYm9keTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgcm9sZSBhc3NpZ25tZW50IHBlcm1pc3Npb25zXG4gICAgICBpZiAobmV3Um9sZSAmJiBuZXdSb2xlICE9PSB0YXJnZXRVc2VyLnJvbGUpIHtcbiAgICAgICAgLy8gQWRtaW4gY2FuIGFzc2lnbiBhbnkgcm9sZVxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAgIC8vIEFkbWluIGhhcyBubyByZXN0cmljdGlvbnNcbiAgICAgICAgfSBcbiAgICAgICAgLy8gTWFuYWdlciByZXN0cmljdGlvbnNcbiAgICAgICAgZWxzZSBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgICAgLy8gTWFuYWdlcnMgY2Fubm90IGVzY2FsYXRlIHRvIGFkbWluXG4gICAgICAgICAgaWYgKG5ld1JvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICAgIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnLFxuICAgICAgICAgICAgICBtZXNzYWdlOiAnTWFuYWdlcnMgY2Fubm90IGFzc2lnbiBhZG1pbiByb2xlJyxcbiAgICAgICAgICAgICAgY29kZTogJ1JPTEVfRVNDQUxBVElPTl9ERU5JRUQnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIE1hbmFnZXJzIGNhbiBvbmx5IGFzc2lnbiBtYW5hZ2VyL3RlbmFudC9yZXNpZGVudCByb2xlc1xuICAgICAgICAgIGlmICghWydtYW5hZ2VyJywgJ3RlbmFudCcsICdyZXNpZGVudCddLmluY2x1ZGVzKG5ld1JvbGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkJyxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ01hbmFnZXJzIGNhbiBvbmx5IGFzc2lnbiBtYW5hZ2VyLCB0ZW5hbnQsIG9yIHJlc2lkZW50IHJvbGVzJyxcbiAgICAgICAgICAgICAgY29kZTogJ0lOVkFMSURfUk9MRV9BU1NJR05NRU5UJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBEZW1vIG1hbmFnZXIgcmVzdHJpY3Rpb25zXG4gICAgICAgIGVsc2UgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdkZW1vX21hbmFnZXInKSB7XG4gICAgICAgICAgLy8gRGVtbyBtYW5hZ2VycyBjYW4gb25seSBhc3NpZ24gZGVtbyByb2xlc1xuICAgICAgICAgIGlmICghWydkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKG5ld1JvbGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkJyxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0RlbW8gbWFuYWdlcnMgY2FuIG9ubHkgYXNzaWduIGRlbW8gcm9sZXMnLFxuICAgICAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9ERU1PX1JPTEVfQVNTSUdOTUVOVCcsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gT3RoZXIgcm9sZXMgY2Fubm90IGFzc2lnbiByb2xlc1xuICAgICAgICBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgZXJyb3I6ICdQZXJtaXNzaW9uIGRlbmllZCcsXG4gICAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIGFzc2lnbiByb2xlcycsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE9yZ2FuaXphdGlvbiBzY29wZSB2YWxpZGF0aW9uIGZvciByb2xlIGFzc2lnbm1lbnRzXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnbWFuYWdlcicgfHwgY3VycmVudFVzZXIucm9sZSA9PT0gJ2RlbW9fbWFuYWdlcicpIHtcbiAgICAgICAgICAvLyBHZXQgY3VycmVudCB1c2VyJ3Mgb3JnYW5pemF0aW9uc1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyT3JncyA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlck9yZ2FuaXphdGlvbnMoY3VycmVudFVzZXIuaWQpO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyT3JnSWRzID0gY3VycmVudFVzZXJPcmdzLm1hcChvcmcgPT4gb3JnLm9yZ2FuaXphdGlvbklkKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHZXQgdGFyZ2V0IHVzZXIncyBvcmdhbml6YXRpb25zXG4gICAgICAgICAgY29uc3QgdGFyZ2V0VXNlck9yZ3MgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKGlkKTtcbiAgICAgICAgICBjb25zdCB0YXJnZXRVc2VyT3JnSWRzID0gdGFyZ2V0VXNlck9yZ3MubWFwKG9yZyA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIGN1cnJlbnQgdXNlciBoYXMgYWNjZXNzIHRvIHRhcmdldCB1c2VyJ3Mgb3JnYW5pemF0aW9uc1xuICAgICAgICAgIGNvbnN0IGhhc0FjY2Vzc1RvVGFyZ2V0T3JncyA9IHRhcmdldFVzZXJPcmdJZHMuc29tZShvcmdJZCA9PiBcbiAgICAgICAgICAgIGN1cnJlbnRVc2VyT3JnSWRzLmluY2x1ZGVzKG9yZ0lkKVxuICAgICAgICAgICk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCFoYXNBY2Nlc3NUb1RhcmdldE9yZ3MgJiYgdGFyZ2V0VXNlck9yZ0lkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBlcnJvcjogJ1Blcm1pc3Npb24gZGVuaWVkJyxcbiAgICAgICAgICAgICAgbWVzc2FnZTogJ0Nhbm5vdCBtb2RpZnkgdXNlcnMgb3V0c2lkZSB5b3VyIG9yZ2FuaXphdGlvbiBzY29wZScsXG4gICAgICAgICAgICAgIGNvZGU6ICdPUkdBTklaQVRJT05fU0NPUEVfVklPTEFUSU9OJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEZvciBkZW1vIG1hbmFnZXJzLCB2YWxpZGF0ZSBkZW1vIHJvbGUgYXNzaWdubWVudHNcbiAgICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2RlbW9fbWFuYWdlcicpIHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRhcmdldCBvcmdhbml6YXRpb25zIGFyZSBkZW1vIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldE9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIC53aGVyZShpbkFycmF5KHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCB0YXJnZXRVc2VyT3JnSWRzKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGhhc05vbkRlbW9PcmdzID0gdGFyZ2V0T3Jncy5zb21lKG9yZyA9PiBvcmcudHlwZSAhPT0gJ2RlbW8nKTtcbiAgICAgICAgICAgIGlmIChoYXNOb25EZW1vT3Jncykge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICAgIGVycm9yOiAnUGVybWlzc2lvbiBkZW5pZWQnLFxuICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdEZW1vIG1hbmFnZXJzIGNhbm5vdCBhc3NpZ24gcm9sZXMgdG8gdXNlcnMgaW4gbm9uLWRlbW8gb3JnYW5pemF0aW9ucycsXG4gICAgICAgICAgICAgICAgY29kZTogJ0RFTU9fU0NPUEVfVklPTEFUSU9OJyxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHRoZSB1cGRhdGUgZGF0YSAoZXhjbHVkaW5nIHBhc3N3b3JkIHVwZGF0ZXMgZm9yIHNlY3VyaXR5KVxuICAgICAgY29uc3QgdXBkYXRlU2NoZW1hID0gaW5zZXJ0VXNlclNjaGVtYS5wYXJ0aWFsKCkub21pdCh7IHBhc3N3b3JkOiB0cnVlIH0pO1xuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IHVwZGF0ZVNjaGVtYS5wYXJzZShyZXEuYm9keSk7XG5cbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLnVwZGF0ZVVzZXIoaWQsIHtcbiAgICAgICAgLi4udmFsaWRhdGVkRGF0YSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBlcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENsZWFyIHJlbGV2YW50IGNhY2hlc1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd1c2VycycsICdhbGxfdXNlcnMnKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCBgdXNlcjoke2lkfWApO1xuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGluZm9ybWF0aW9uIGJlZm9yZSBzZW5kaW5nIHJlc3BvbnNlXG4gICAgICBjb25zdCB7IHBhc3N3b3JkLCAuLi51c2VyV2l0aG91dFBhc3N3b3JkIH0gPSB1c2VyO1xuICAgICAgcmVzLmpzb24odXNlcldpdGhvdXRQYXNzd29yZCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2Ygei5ab2RFcnJvcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGVycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgdXNlciBkYXRhJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgdXNlcjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBERUxFVEUgL2FwaS91c2Vycy86aWQgLSBEZWFjdGl2YXRlcyBhIHVzZXIgKHNvZnQgZGVsZXRlKS5cbiAgICovXG4gIGFwcC5kZWxldGUoJy9hcGkvdXNlcnMvOmlkJywgYXN5bmMgKHJlcSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdCYWQgcmVxdWVzdCcsXG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU29mdCBkZWxldGUgYnkgc2V0dGluZyBpc0FjdGl2ZSB0byBmYWxzZVxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UudXBkYXRlVXNlcihpZCwge1xuICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdVc2VyIGRlYWN0aXZhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlYWN0aXZhdGluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlYWN0aXZhdGUgdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2VyLW9yZ2FuaXphdGlvbnMgLSBHZXQgY3VycmVudCB1c2VyJ3Mgb3JnYW5pemF0aW9ucy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlci1vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25zID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyT3JnYW5pemF0aW9ucyhjdXJyZW50VXNlci5pZCk7XG4gICAgICByZXMuanNvbihvcmdhbml6YXRpb25zKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIG9yZ2FuaXphdGlvbnM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2V0IHVzZXIgb3JnYW5pemF0aW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2VyLXJlc2lkZW5jZXMgLSBHZXQgY3VycmVudCB1c2VyJ3MgcmVzaWRlbmNlcy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlci1yZXNpZGVuY2VzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXNpZGVuY2VzID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyUmVzaWRlbmNlcyhjdXJyZW50VXNlci5pZCk7XG4gICAgICByZXMuanNvbihyZXNpZGVuY2VzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIHJlc2lkZW5jZXM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2V0IHVzZXIgcmVzaWRlbmNlcycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9hZG1pbi9hbGwtdXNlci1vcmdhbml6YXRpb25zIC0gR2V0IHVzZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHMgKGFkbWluOiBhbGwsIG1hbmFnZXI6IGZpbHRlcmVkIGJ5IHRoZWlyIG9yZ3MpLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9hZG1pbi9hbGwtdXNlci1vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ/CflI0gW0FQSV0gYWxsLXVzZXItb3JnYW5pemF0aW9ucyBlbmRwb2ludCBjYWxsZWQgYnkgdXNlcjonLCByZXEudXNlcj8uZW1haWwpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gT25seSBhZG1pbnMgYW5kIG1hbmFnZXJzIGNhbiBhY2Nlc3MgdXNlciBhc3NpZ25tZW50c1xuICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gdmlldyB1c2VyIGFzc2lnbm1lbnRzJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGxldCB1c2VyT3JnYW5pemF0aW9ucztcblxuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgLy8gQWRtaW4gc2VlcyBhbGwgdXNlci1vcmdhbml6YXRpb24gcmVsYXRpb25zaGlwc1xuICAgICAgICB1c2VyT3JnYW5pemF0aW9ucyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICB1c2VySWQ6IHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvblJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1hbmFnZXIgc2VlcyBvbmx5IHJlbGF0aW9uc2hpcHMgZm9yIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgY29uc3QgbWFuYWdlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBvcmdJZHMgPSBtYW5hZ2VyT3Jncy5tYXAoKG9yZykgPT4gb3JnLm9yZ2FuaXphdGlvbklkKTtcblxuICAgICAgICBpZiAob3JnSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7XG4gICAgICAgIH1cblxuICAgICAgICB1c2VyT3JnYW5pemF0aW9ucyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICB1c2VySWQ6IHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvblJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ0lkcylcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih1c2VyT3JnYW5pemF0aW9ucyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdldHRpbmcgYWxsIHVzZXIgb3JnYW5pemF0aW9uczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciBvcmdhbml6YXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2FkbWluL2FsbC11c2VyLXJlc2lkZW5jZXMgLSBHZXQgdXNlci1yZXNpZGVuY2UgcmVsYXRpb25zaGlwcyAoYWRtaW46IGFsbCwgbWFuYWdlcjogZmlsdGVyZWQgYnkgdGhlaXIgb3JncykuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2FkbWluL2FsbC11c2VyLXJlc2lkZW5jZXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBbQVBJXSBhbGwtdXNlci1yZXNpZGVuY2VzIGVuZHBvaW50IGNhbGxlZCBieSB1c2VyOicsIHJlcS51c2VyPy5lbWFpbCk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIGFjY2VzcyB1c2VyIGFzc2lnbm1lbnRzXG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucyB0byB2aWV3IHVzZXIgYXNzaWdubWVudHMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IHVzZXJSZXNpZGVuY2VzO1xuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbiBzZWVzIGFsbCB1c2VyLXJlc2lkZW5jZSByZWxhdGlvbnNoaXBzXG4gICAgICAgIHVzZXJSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHVzZXJJZDogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCxcbiAgICAgICAgICAgIHJlc2lkZW5jZUlkOiBzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsXG4gICAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMucmVsYXRpb25zaGlwVHlwZSxcbiAgICAgICAgICAgIHN0YXJ0RGF0ZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnN0YXJ0RGF0ZSxcbiAgICAgICAgICAgIGVuZERhdGU6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5lbmREYXRlLFxuICAgICAgICAgICAgaXNBY3RpdmU6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBNYW5hZ2VyIHNlZXMgb25seSByZWxhdGlvbnNoaXBzIGZvciByZXNpZGVuY2VzIGluIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgY29uc3QgbWFuYWdlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBvcmdJZHMgPSBtYW5hZ2VyT3Jncy5tYXAoKG9yZykgPT4gb3JnLm9yZ2FuaXphdGlvbklkKTtcblxuICAgICAgICBpZiAob3JnSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgcmVzaWRlbmNlcyBpbiBtYW5hZ2VyJ3Mgb3JnYW5pemF0aW9uc1xuICAgICAgICBjb25zdCBhY2Nlc3NpYmxlUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IHJlc2lkZW5jZUlkOiBzY2hlbWEucmVzaWRlbmNlcy5pZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBpbkFycmF5KHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ0lkcyksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gYWNjZXNzaWJsZVJlc2lkZW5jZXMubWFwKChyZXMpID0+IHJlcy5yZXNpZGVuY2VJZCk7XG5cbiAgICAgICAgaWYgKHJlc2lkZW5jZUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oW10pO1xuICAgICAgICB9XG5cbiAgICAgICAgdXNlclJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgdXNlcklkOiBzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZWxhdGlvbnNoaXBUeXBlLFxuICAgICAgICAgICAgc3RhcnREYXRlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMuc3RhcnREYXRlLFxuICAgICAgICAgICAgZW5kRGF0ZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmVuZERhdGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkcylcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih1c2VyUmVzaWRlbmNlcyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdldHRpbmcgYWxsIHVzZXIgcmVzaWRlbmNlczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBnZXQgdXNlciByZXNpZGVuY2VzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXIvcGVybWlzc2lvbnMgLSBSZXRyaWV2ZXMgdGhlIGN1cnJlbnQgdXNlcidzIHBlcm1pc3Npb25zIGJhc2VkIG9uIHRoZWlyIHJvbGUuXG4gICAqIFByb3RlY3RlZCBlbmRwb2ludCB0aGF0IHJlcXVpcmVzIGF1dGhlbnRpY2F0aW9uLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2VyL3Blcm1pc3Npb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCB1c2VyIHJvbGUgZnJvbSBzZXNzaW9uXG4gICAgICBjb25zdCB1c2VyUm9sZSA9IHJlcS51c2VyPy5yb2xlO1xuXG4gICAgICBpZiAoIXVzZXJSb2xlKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnQmFkIHJlcXVlc3QnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIHJvbGUgbm90IGZvdW5kIGluIHNlc3Npb24nLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHBlcm1pc3Npb25zIGZvciB0aGUgdXNlcidzIHJvbGUgZnJvbSBkYXRhYmFzZVxuICAgICAgY29uc3Qgcm9sZVBlcm1pc3Npb25zID0gYXdhaXQgc3RvcmFnZS5nZXRSb2xlUGVybWlzc2lvbnMoKTtcbiAgICAgIGNvbnN0IHVzZXJQZXJtaXNzaW9ucyA9IHJvbGVQZXJtaXNzaW9uc1xuICAgICAgICAuZmlsdGVyKChycDogYW55KSA9PiBycC5yb2xlID09PSB1c2VyUm9sZSlcbiAgICAgICAgLm1hcCgocnA6IGFueSkgPT4gcnAucGVybWlzc2lvbj8ubmFtZSlcbiAgICAgICAgLmZpbHRlcihCb29sZWFuKTtcblxuICAgICAgLy8gQ3JlYXRlIHJlc3BvbnNlIHdpdGggWm9kIHZhbGlkYXRpb25cbiAgICAgIGNvbnN0IHJlc3BvbnNlRGF0YSA9IHtcbiAgICAgICAgcm9sZTogdXNlclJvbGUsXG4gICAgICAgIHBlcm1pc3Npb25zOiB1c2VyUGVybWlzc2lvbnMsXG4gICAgICAgIHBlcm1pc3Npb25Db3VudDogdXNlclBlcm1pc3Npb25zLmxlbmd0aCxcbiAgICAgIH07XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlc3BvbnNlIHdpdGggWm9kIHNjaGVtYVxuICAgICAgY29uc3QgcGVybWlzc2lvbnNSZXNwb25zZVNjaGVtYSA9IHoub2JqZWN0KHtcbiAgICAgICAgcm9sZTogei5lbnVtKFsnYWRtaW4nLCAnbWFuYWdlcicsICd0ZW5hbnQnLCAncmVzaWRlbnQnXSksXG4gICAgICAgIHBlcm1pc3Npb25zOiB6LmFycmF5KHouc3RyaW5nKCkpLFxuICAgICAgICBwZXJtaXNzaW9uQ291bnQ6IHoubnVtYmVyKCksXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVkUmVzcG9uc2UgPSBwZXJtaXNzaW9uc1Jlc3BvbnNlU2NoZW1hLnBhcnNlKHJlc3BvbnNlRGF0YSk7XG5cbiAgICAgIHJlcy5qc29uKHZhbGlkYXRlZFJlc3BvbnNlKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiB6LlpvZEVycm9yKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdmFsaWRhdGUgcGVybWlzc2lvbnMgcmVzcG9uc2UnLFxuICAgICAgICAgIGRldGFpbHM6IGVycm9yLmlzc3VlcyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIHBlcm1pc3Npb25zOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIHVzZXIgcGVybWlzc2lvbnMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUFVUIC9hcGkvdXNlcnMvOmlkL29yZ2FuaXphdGlvbnMgLSBVcGRhdGVzIHVzZXIncyBvcmdhbml6YXRpb24gYXNzaWdubWVudHMuXG4gICAqIEFkbWluOiBjYW4gYXNzaWduL3JlbW92ZSBhbnkgb3JnYW5pemF0aW9uXG4gICAqIE1hbmFnZXI6IGNhbm5vdCBtb2RpZnkgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzLlxuICAgKi9cbiAgYXBwLnB1dCgnL2FwaS91c2Vycy86aWQvb3JnYW5pemF0aW9ucycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdXNlcklkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgeyBvcmdhbml6YXRpb25JZHMgfSA9IHJlcS5ib2R5O1xuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBjYW4gbW9kaWZ5IG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50c1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnT25seSBhZG1pbmlzdHJhdG9ycyBjYW4gbW9kaWZ5IG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50cycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXVzZXJJZCB8fCAhQXJyYXkuaXNBcnJheShvcmdhbml6YXRpb25JZHMpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgYW5kIG9yZ2FuaXphdGlvbiBJRHMgYXJyYXkgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9SRVFVRVNUJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZlcmlmeSB1c2VyIGV4aXN0c1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcih1c2VySWQpO1xuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gUmVtb3ZlIGV4aXN0aW5nIG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50c1xuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucykud2hlcmUoZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlcklkKSk7XG5cbiAgICAgIC8vIEFkZCBuZXcgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzXG4gICAgICBpZiAob3JnYW5pemF0aW9uSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgbmV3QXNzaWdubWVudHMgPSBvcmdhbml6YXRpb25JZHMubWFwKChvcmdJZDogc3RyaW5nKSA9PiAoe1xuICAgICAgICAgIHVzZXJJZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogb3JnSWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogdXNlci5yb2xlLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucykudmFsdWVzKG5ld0Fzc2lnbm1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnT3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBvcmdhbml6YXRpb25JZHMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBvcmdhbml6YXRpb24gYXNzaWdubWVudHMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUFVUIC9hcGkvdXNlcnMvOmlkL2J1aWxkaW5ncyAtIFVwZGF0ZXMgdXNlcidzIGJ1aWxkaW5nIGFzc2lnbm1lbnRzLlxuICAgKiBBZG1pbiBhbmQgTWFuYWdlcjogY2FuIGFzc2lnbi9yZW1vdmUgYnVpbGRpbmdzIHRoZXkgaGF2ZSBhY2Nlc3MgdG9cbiAgICovXG4gIGFwcC5wdXQoJy9hcGkvdXNlcnMvOmlkL2J1aWxkaW5ncycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdXNlcklkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgeyBidWlsZGluZ0lkcyB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gbW9kaWZ5IGJ1aWxkaW5nIGFzc2lnbm1lbnRzXG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ09ubHkgYWRtaW5pc3RyYXRvcnMgYW5kIG1hbmFnZXJzIGNhbiBtb2RpZnkgYnVpbGRpbmcgYXNzaWdubWVudHMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCF1c2VySWQgfHwgIUFycmF5LmlzQXJyYXkoYnVpbGRpbmdJZHMpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgYW5kIGJ1aWxkaW5nIElEcyBhcnJheSBhcmUgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1JFUVVFU1QnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgZXhpc3RzXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyKHVzZXJJZCk7XG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBGb3Igbm93LCB3ZSdsbCBjcmVhdGUgdXNlci1yZXNpZGVuY2UgcmVsYXRpb25zaGlwcyBmb3IgZWFjaCBidWlsZGluZ1xuICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpZWQgYXBwcm9hY2ggLSBpbiBhIHJlYWwgc3lzdGVtIHlvdSdkIGhhdmUgdXNlci1idWlsZGluZyByZWxhdGlvbnNoaXBzXG4gICAgICBcbiAgICAgIC8vIEdldCByZXNpZGVuY2VzIGZvciB0aGUgc2VsZWN0ZWQgYnVpbGRpbmdzXG4gICAgICBjb25zdCByZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoaW5BcnJheShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkcykpO1xuXG4gICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgcmVzaWRlbmNlIGFzc2lnbm1lbnRzIGZvciB0aGlzIHVzZXJcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlclJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXJJZCkpO1xuXG4gICAgICAvLyBBZGQgbmV3IHJlc2lkZW5jZSBhc3NpZ25tZW50cyAob25lIHBlciBidWlsZGluZyAtIHRha2luZyB0aGUgZmlyc3QgcmVzaWRlbmNlKVxuICAgICAgaWYgKHJlc2lkZW5jZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBidWlsZGluZ1RvUmVzaWRlbmNlID0gbmV3IE1hcCgpO1xuICAgICAgICByZXNpZGVuY2VzLmZvckVhY2gocmVzaWRlbmNlID0+IHtcbiAgICAgICAgICBpZiAoIWJ1aWxkaW5nVG9SZXNpZGVuY2UuaGFzKHJlc2lkZW5jZS5idWlsZGluZ0lkKSkge1xuICAgICAgICAgICAgYnVpbGRpbmdUb1Jlc2lkZW5jZS5zZXQocmVzaWRlbmNlLmJ1aWxkaW5nSWQsIHJlc2lkZW5jZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBuZXdBc3NpZ25tZW50cyA9IEFycmF5LmZyb20oYnVpbGRpbmdUb1Jlc2lkZW5jZS52YWx1ZXMoKSkubWFwKChyZXNpZGVuY2U6IGFueSkgPT4gKHtcbiAgICAgICAgICB1c2VySWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHJlc2lkZW5jZS5pZCxcbiAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiB1c2VyLnJvbGUgPT09ICdtYW5hZ2VyJyA/ICdtYW5hZ2VyJyA6ICd0ZW5hbnQnLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIH0pKTtcblxuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLnVzZXJSZXNpZGVuY2VzKS52YWx1ZXMobmV3QXNzaWdubWVudHMpO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBhc3NpZ25tZW50cyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHVzZXJJZCxcbiAgICAgICAgYnVpbGRpbmdJZHMsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgYnVpbGRpbmcgYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIGJ1aWxkaW5nIGFzc2lnbm1lbnRzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXJzLzppZC9yZXNpZGVuY2VzIC0gR2V0IHVzZXIncyBhY2Nlc3NpYmxlIHJlc2lkZW5jZXMuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL3VzZXJzLzppZC9yZXNpZGVuY2VzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBjb25zdCB7IGlkOiB1c2VySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVzZXJzIGNhbiBvbmx5IGFjY2VzcyB0aGVpciBvd24gcmVzaWRlbmNlcyB1bmxlc3MgdGhleSdyZSBhZG1pbi9tYW5hZ2VyXG4gICAgICBpZiAoY3VycmVudFVzZXIuaWQgIT09IHVzZXJJZCAmJiAhWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc2lkZW5jZXMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZCk7XG4gICAgICByZXMuanNvbihyZXNpZGVuY2VzKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIHJlc2lkZW5jZXM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2V0IHVzZXIgcmVzaWRlbmNlcycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2Vycy86aWQvYnVpbGRpbmdzIC0gR2V0IHVzZXIncyBhY2Nlc3NpYmxlIGJ1aWxkaW5ncyBiYXNlZCBvbiB0aGVpciByZXNpZGVuY2VzLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2Vycy86aWQvYnVpbGRpbmdzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBjb25zdCB7IGlkOiB1c2VySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFVzZXJzIGNhbiBvbmx5IGFjY2VzcyB0aGVpciBvd24gYnVpbGRpbmdzIHVubGVzcyB0aGV5J3JlIGFkbWluL21hbmFnZXJcbiAgICAgIGlmIChjdXJyZW50VXNlci5pZCAhPT0gdXNlcklkICYmICFbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IHVzZXIncyByZXNpZGVuY2VzIHdpdGggYnVpbGRpbmcgaW5mb3JtYXRpb25cbiAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnJlc2lkZW5jZXMsIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgc2NoZW1hLnJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICBlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgKSk7XG4gICAgICBcbiAgICAgIGlmICghdXNlclJlc2lkZW5jZXMgfHwgdXNlclJlc2lkZW5jZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbih7IGJ1aWxkaW5nczogW10gfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB1bmlxdWUgYnVpbGRpbmcgSURzIGZyb20gdXNlcidzIHJlc2lkZW5jZXNcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWRzID0gWy4uLm5ldyBTZXQodXNlclJlc2lkZW5jZXMubWFwKHVyID0+IHVyLmJ1aWxkaW5nSWQpLmZpbHRlcihCb29sZWFuKSldO1xuICAgICAgXG4gICAgICBpZiAoYnVpbGRpbmdJZHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuanNvbih7IGJ1aWxkaW5nczogW10gfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZldGNoIGJ1aWxkaW5nIGRldGFpbHMgd2l0aCBzdGF0cyB1c2luZyB0aGUgZXhpc3RpbmcgbG9naWMgZnJvbSAvYXBpL21hbmFnZXIvYnVpbGRpbmdzXG4gICAgICBjb25zdCBidWlsZGluZ0RldGFpbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogc2NoZW1hLmJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICBuYW1lOiBzY2hlbWEuYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgYWRkcmVzczogc2NoZW1hLmJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgIGNpdHk6IHNjaGVtYS5idWlsZGluZ3MuY2l0eSxcbiAgICAgICAgICBwcm92aW5jZTogc2NoZW1hLmJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICBwb3N0YWxDb2RlOiBzY2hlbWEuYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgYnVpbGRpbmdUeXBlOiBzY2hlbWEuYnVpbGRpbmdzLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICB5ZWFyQnVpbHQ6IHNjaGVtYS5idWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgIHRvdGFsRmxvb3JzOiBzY2hlbWEuYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IHNjaGVtYS5idWlsZGluZ3MucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBzY2hlbWEuYnVpbGRpbmdzLnN0b3JhZ2VTcGFjZXMsXG4gICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IHNjaGVtYS5idWlsZGluZ3MubWFuYWdlbWVudENvbXBhbnksXG4gICAgICAgICAgYW1lbml0aWVzOiBzY2hlbWEuYnVpbGRpbmdzLmFtZW5pdGllcyxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25OYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgIG9yZ2FuaXphdGlvblR5cGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgIC5sZWZ0Sm9pbihzY2hlbWEub3JnYW5pemF0aW9ucywgZXEoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAud2hlcmUoYW5kKFxuICAgICAgICAgIGluQXJyYXkoc2NoZW1hLmJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZHMpLFxuICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICkpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgc3RhdHMgZm9yIGVhY2ggYnVpbGRpbmdcbiAgICAgIGNvbnN0IGJ1aWxkaW5nc1dpdGhTdGF0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICBidWlsZGluZ0RldGFpbHMubWFwKGFzeW5jIChidWlsZGluZykgPT4ge1xuICAgICAgICAgIGNvbnN0IFt0b3RhbFVuaXRzLCBvY2N1cGllZFVuaXRzXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIGRiXG4gICAgICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogc3FsPG51bWJlcj5gY291bnQoKilgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgICAgICAud2hlcmUoYW5kKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nLmlkKSwgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHJlc3VsdFswXT8uY291bnQgfHwgMCksXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGRiXG4gICAgICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogc3FsPG51bWJlcj5gY291bnQoZGlzdGluY3QgJHtzY2hlbWEucmVzaWRlbmNlcy5pZH0pYCB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAgICAgLmxlZnRKb2luKHNjaGVtYS51c2VyUmVzaWRlbmNlcywgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCBzY2hlbWEucmVzaWRlbmNlcy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShhbmQoXG4gICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmcuaWQpLFxuICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiByZXN1bHRbMF0/LmNvdW50IHx8IDApLFxuICAgICAgICAgIF0pO1xuXG4gICAgICAgICAgY29uc3QgdmFjYW50VW5pdHMgPSB0b3RhbFVuaXRzIC0gb2NjdXBpZWRVbml0cztcbiAgICAgICAgICBjb25zdCBvY2N1cGFuY3lSYXRlID0gdG90YWxVbml0cyA+IDAgPyAob2NjdXBpZWRVbml0cyAvIHRvdGFsVW5pdHMpICogMTAwIDogMDtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5idWlsZGluZyxcbiAgICAgICAgICAgIHRvdGFsVW5pdHMsXG4gICAgICAgICAgICBvY2N1cGllZFVuaXRzLFxuICAgICAgICAgICAgdmFjYW50VW5pdHMsXG4gICAgICAgICAgICBvY2N1cGFuY3lSYXRlLFxuICAgICAgICAgIH07XG4gICAgICAgIH0pXG4gICAgICApO1xuXG4gICAgICByZXMuanNvbih7IGJ1aWxkaW5nczogYnVpbGRpbmdzV2l0aFN0YXRzIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgYnVpbGRpbmdzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGdldCB1c2VyIGJ1aWxkaW5ncycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQVVQgL2FwaS91c2Vycy86aWQvcmVzaWRlbmNlcyAtIFVwZGF0ZXMgdXNlcidzIHJlc2lkZW5jZSBhc3NpZ25tZW50cy5cbiAgICogQWRtaW46IGNhbiBhc3NpZ24vcmVtb3ZlIGFueSByZXNpZGVuY2VcbiAgICogTWFuYWdlcjogY2FuIGFzc2lnbi9yZW1vdmUgcmVzaWRlbmNlcyB3aXRoaW4gdGhlaXIgb3JnYW5pemF0aW9ucyBvbmx5LlxuICAgKi9cbiAgYXBwLnB1dCgnL2FwaS91c2Vycy86aWQvcmVzaWRlbmNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgY29uc3QgeyBpZDogdXNlcklkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgeyByZXNpZGVuY2VBc3NpZ25tZW50cyB9ID0gcmVxLmJvZHk7IC8vIEFycmF5IG9mIHsgcmVzaWRlbmNlSWQsIHJlbGF0aW9uc2hpcFR5cGUsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSB9XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gbW9kaWZ5IHJlc2lkZW5jZSBhc3NpZ25tZW50c1xuICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMgdG8gbW9kaWZ5IHJlc2lkZW5jZSBhc3NpZ25tZW50cycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoIXVzZXJJZCB8fCAhQXJyYXkuaXNBcnJheShyZXNpZGVuY2VBc3NpZ25tZW50cykpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBJRCBhbmQgcmVzaWRlbmNlIGFzc2lnbm1lbnRzIGFycmF5IGFyZSByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfUkVRVUVTVCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZnkgdXNlciBleGlzdHNcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXIodXNlcklkKTtcbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEZvciBtYW5hZ2VycywgdmVyaWZ5IHRoZXkgY2FuIGFjY2VzcyBhbGwgcmVxdWVzdGVkIHJlc2lkZW5jZXNcbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgZm9yIChjb25zdCBhc3NpZ25tZW50IG9mIHJlc2lkZW5jZUFzc2lnbm1lbnRzKSB7XG4gICAgICAgICAgLy8gR2V0IHRoZSBidWlsZGluZyBmb3IgdGhpcyByZXNpZGVuY2VcbiAgICAgICAgICBjb25zdCByZXNpZGVuY2UgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQgfSlcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCBhc3NpZ25tZW50LnJlc2lkZW5jZUlkKSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICAgIGlmIChyZXNpZGVuY2UubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgICAgICBtZXNzYWdlOiBgUmVzaWRlbmNlICR7YXNzaWdubWVudC5yZXNpZGVuY2VJZH0gbm90IGZvdW5kYCxcbiAgICAgICAgICAgICAgY29kZTogJ1JFU0lERU5DRV9OT1RfRk9VTkQnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgbWFuYWdlciBoYXMgYWNjZXNzIHRvIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgICAvLyBHZXQgYnVpbGRpbmdzIGFjY2Vzc2libGUgdG8gdGhpcyBtYW5hZ2VyIHRocm91Z2ggdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgICAgICAgIGNvbnN0IG1hbmFnZXJPcmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgY29uc3Qgb3JnSWRzID0gbWFuYWdlck9yZ3MubWFwKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG5cbiAgICAgICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdzID1cbiAgICAgICAgICAgIG9yZ0lkcy5sZW5ndGggPiAwXG4gICAgICAgICAgICAgID8gYXdhaXQgZGJcbiAgICAgICAgICAgICAgICAgIC5zZWxlY3QoeyBpZDogc2NoZW1hLmJ1aWxkaW5ncy5pZCB9KVxuICAgICAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnSWRzKSxcbiAgICAgICAgICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIDogW107XG5cbiAgICAgICAgICBjb25zdCBoYXNBY2Nlc3MgPSBhY2Nlc3NpYmxlQnVpbGRpbmdzLnNvbWUoKGIpID0+IGIuaWQgPT09IHJlc2lkZW5jZVswXS5idWlsZGluZ0lkKTtcbiAgICAgICAgICBpZiAoIWhhc0FjY2Vzcykge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICAgICAgbWVzc2FnZTogYEluc3VmZmljaWVudCBwZXJtaXNzaW9ucyBmb3IgcmVzaWRlbmNlICR7YXNzaWdubWVudC5yZXNpZGVuY2VJZH1gLFxuICAgICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgZXhpc3RpbmcgcmVzaWRlbmNlIGFzc2lnbm1lbnRzXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJSZXNpZGVuY2VzKS53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VySWQpKTtcblxuICAgICAgLy8gQWRkIG5ldyByZXNpZGVuY2UgYXNzaWdubWVudHNcbiAgICAgIGlmIChyZXNpZGVuY2VBc3NpZ25tZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IG5ld0Fzc2lnbm1lbnRzID0gcmVzaWRlbmNlQXNzaWdubWVudHMubWFwKChhc3NpZ25tZW50OiBhbnkpID0+ICh7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiBhc3NpZ25tZW50LnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IGFzc2lnbm1lbnQucmVsYXRpb25zaGlwVHlwZSB8fCAndGVuYW50JyxcbiAgICAgICAgICBzdGFydERhdGU6IGFzc2lnbm1lbnQuc3RhcnREYXRlIHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICAgIGVuZERhdGU6IGFzc2lnbm1lbnQuZW5kRGF0ZSB8fCBudWxsLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KSk7XG5cbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS51c2VyUmVzaWRlbmNlcykudmFsdWVzKG5ld0Fzc2lnbm1lbnRzKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnUmVzaWRlbmNlIGFzc2lnbm1lbnRzIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBhc3NpZ25tZW50Q291bnQ6IHJlc2lkZW5jZUFzc2lnbm1lbnRzLmxlbmd0aCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyByZXNpZGVuY2UgYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIHJlc2lkZW5jZSBhc3NpZ25tZW50cycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS91c2Vycy9tZS9vcmdhbml6YXRpb25zIC0gR2V0IG9yZ2FuaXphdGlvbnMgYWNjZXNzaWJsZSB0byBjdXJyZW50IHVzZXIuXG4gICAqIFVzZWQgYnkgaW52aXRlIGZvcm0gdG8gcG9wdWxhdGUgb3JnYW5pemF0aW9uIGRyb3Bkb3duLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS91c2Vycy9tZS9vcmdhbml6YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBGZXRjaGluZyB1c2VyLWFjY2Vzc2libGUgb3JnYW5pemF0aW9ucyBmb3IgJHtjdXJyZW50VXNlci5lbWFpbH0gKCR7Y3VycmVudFVzZXIucm9sZX0pYCk7XG5cbiAgICAgIC8vIEdldCBvcmdhbml6YXRpb25zIGJhc2VkIG9uIHVzZXIgcm9sZSAtIHNhbWUgbG9naWMgYXMgL2FwaS9vcmdhbml6YXRpb25zXG4gICAgICBsZXQgb3JnYW5pemF0aW9uc1F1ZXJ5O1xuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbiBjYW4gc2VlIGFsbCBvcmdhbml6YXRpb25zXG4gICAgICAgIG9yZ2FuaXphdGlvbnNRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICAgICAgICBuYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgdHlwZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IHNjaGVtYS5vcmdhbml6YXRpb25zLmFkZHJlc3MsXG4gICAgICAgICAgICBjaXR5OiBzY2hlbWEub3JnYW5pemF0aW9ucy5jaXR5LFxuICAgICAgICAgICAgcHJvdmluY2U6IHNjaGVtYS5vcmdhbml6YXRpb25zLnByb3ZpbmNlLFxuICAgICAgICAgICAgcG9zdGFsQ29kZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMucG9zdGFsQ29kZSxcbiAgICAgICAgICAgIHBob25lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5waG9uZSxcbiAgICAgICAgICAgIGVtYWlsOiBzY2hlbWEub3JnYW5pemF0aW9ucy5lbWFpbCxcbiAgICAgICAgICAgIHdlYnNpdGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLndlYnNpdGUsXG4gICAgICAgICAgICByZWdpc3RyYXRpb25OdW1iZXI6IHNjaGVtYS5vcmdhbml6YXRpb25zLnJlZ2lzdHJhdGlvbk51bWJlcixcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuY3JlYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE90aGVyIHVzZXJzIHNlZSBvcmdhbml6YXRpb25zIHRoZXkgaGF2ZSBhY2Nlc3MgdG8gdGhyb3VnaCB1c2VyX29yZ2FuaXphdGlvbnNcbiAgICAgICAgb3JnYW5pemF0aW9uc1F1ZXJ5ID0gZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5vcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgICB0eXBlOiBzY2hlbWEub3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgICAgYWRkcmVzczogc2NoZW1hLm9yZ2FuaXphdGlvbnMuYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IHNjaGVtYS5vcmdhbml6YXRpb25zLmNpdHksXG4gICAgICAgICAgICBwcm92aW5jZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMucHJvdmluY2UsXG4gICAgICAgICAgICBwb3N0YWxDb2RlOiBzY2hlbWEub3JnYW5pemF0aW9ucy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgcGhvbmU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnBob25lLFxuICAgICAgICAgICAgZW1haWw6IHNjaGVtYS5vcmdhbml6YXRpb25zLmVtYWlsLFxuICAgICAgICAgICAgd2Vic2l0ZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMud2Vic2l0ZSxcbiAgICAgICAgICAgIHJlZ2lzdHJhdGlvbk51bWJlcjogc2NoZW1hLm9yZ2FuaXphdGlvbnMucmVnaXN0cmF0aW9uTnVtYmVyLFxuICAgICAgICAgICAgaXNBY3RpdmU6IHNjaGVtYS5vcmdhbml6YXRpb25zLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBzY2hlbWEub3JnYW5pemF0aW9ucy5jcmVhdGVkQXQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucywgZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsIHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYWNjZXNzaWJsZU9yZ2FuaXphdGlvbnMgPSBhd2FpdCBvcmdhbml6YXRpb25zUXVlcnk7XG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEZvdW5kICR7YWNjZXNzaWJsZU9yZ2FuaXphdGlvbnMubGVuZ3RofSBvcmdhbml6YXRpb25zIGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9YCk7XG5cbiAgICAgIC8vIFJldHVybiBhcnJheSBkaXJlY3RseSAobm90IHdyYXBwZWQgaW4gb2JqZWN0KSAtIHNhbWUgZm9ybWF0IGFzIC9hcGkvb3JnYW5pemF0aW9uc1xuICAgICAgcmVzLmpzb24oYWNjZXNzaWJsZU9yZ2FuaXphdGlvbnMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIG9yZ2FuaXphdGlvbnM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggdXNlciBvcmdhbml6YXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL3VzZXJzL21lL2RhdGEtZXhwb3J0IC0gRG93bmxvYWQgdXNlciBkYXRhIGZvciBMYXcgMjUgY29tcGxpYW5jZS5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvdXNlcnMvbWUvZGF0YS1leHBvcnQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBhbGwgdXNlciBkYXRhIGZvciBleHBvcnRcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyKGN1cnJlbnRVc2VyLmlkKTtcbiAgICAgIGlmICghdXNlckRhdGEpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVXNlciBub3QgZm91bmQnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX05PVF9GT1VORCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBSZW1vdmUgc2Vuc2l0aXZlIGZpZWxkc1xuICAgICAgY29uc3QgeyBwYXNzd29yZCwgLi4udXNlckRhdGFFeHBvcnQgfSA9IHVzZXJEYXRhO1xuXG4gICAgICAvLyBHZXQgcmVsYXRlZCBkYXRhXG4gICAgICBjb25zdCBbb3JnYW5pemF0aW9ucywgcmVzaWRlbmNlcywgYmlsbHMsIGRvY3VtZW50cywgbm90aWZpY2F0aW9ucywgbWFpbnRlbmFuY2VSZXF1ZXN0c10gPVxuICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgICAgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgICAgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgICAgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJpbGxzKVxuICAgICAgICAgICAgLmlubmVySm9pbihcbiAgICAgICAgICAgICAgc2NoZW1hLnVzZXJSZXNpZGVuY2VzLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYmlsbHMucmVzaWRlbmNlSWQsIHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRvY3VtZW50cy51cGxvYWRlZEJ5SWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgICAgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLm5vdGlmaWNhdGlvbnMpXG4gICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm5vdGlmaWNhdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICAgIGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzLnN1Ym1pdHRlZEJ5LCBjdXJyZW50VXNlci5pZCkpLFxuICAgICAgICBdKTtcblxuICAgICAgY29uc3QgZXhwb3J0RGF0YSA9IHtcbiAgICAgICAgcGVyc29uYWxJbmZvcm1hdGlvbjogdXNlckRhdGFFeHBvcnQsXG4gICAgICAgIG9yZ2FuaXphdGlvbnMsXG4gICAgICAgIHJlc2lkZW5jZXMsXG4gICAgICAgIGJpbGxzOiBiaWxscy5tYXAoKGIpID0+IGIuYmlsbHMpLFxuICAgICAgICBkb2N1bWVudHM6IGRvY3VtZW50cyxcbiAgICAgICAgbm90aWZpY2F0aW9ucyxcbiAgICAgICAgbWFpbnRlbmFuY2VSZXF1ZXN0cyxcbiAgICAgICAgZXhwb3J0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBub3RlOiAnVGhpcyBleHBvcnQgY29udGFpbnMgYWxsIHBlcnNvbmFsIGRhdGEgd2UgaGF2ZSBvbiBmaWxlIGZvciB5b3UgaW4gY29tcGxpYW5jZSB3aXRoIFF1ZWJlYyBMYXcgMjUuJyxcbiAgICAgIH07XG5cbiAgICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgICByZXMuc2V0SGVhZGVyKFxuICAgICAgICAnQ29udGVudC1EaXNwb3NpdGlvbicsXG4gICAgICAgIGBhdHRhY2htZW50OyBmaWxlbmFtZT1cInVzZXItZGF0YS1leHBvcnQtJHtjdXJyZW50VXNlci5pZH0tJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX0uanNvblwiYFxuICAgICAgKTtcbiAgICAgIHJlcy5qc29uKGV4cG9ydERhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBleHBvcnRpbmcgdXNlciBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGV4cG9ydCB1c2VyIGRhdGEnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL3VzZXJzL21lL2RlbGV0ZS1hY2NvdW50IC0gQ29tcGxldGUgYWNjb3VudCBkZWxldGlvbiBmb3IgTGF3IDI1IGNvbXBsaWFuY2UuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS91c2Vycy9tZS9kZWxldGUtYWNjb3VudCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBjb25maXJtRW1haWwsIHJlYXNvbiB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIFZlcmlmeSBlbWFpbCBjb25maXJtYXRpb25cbiAgICAgIGlmIChjb25maXJtRW1haWwgIT09IGN1cnJlbnRVc2VyLmVtYWlsKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0VtYWlsIGNvbmZpcm1hdGlvbiBkb2VzIG5vdCBtYXRjaCcsXG4gICAgICAgICAgY29kZTogJ0VNQUlMX01JU01BVENIJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIERlbGV0ZSBhbGwgcmVsYXRlZCBkYXRhIGluIHRoZSBjb3JyZWN0IG9yZGVyIHRvIGhhbmRsZSBmb3JlaWduIGtleSBjb25zdHJhaW50c1xuICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAvLyBEZWxldGUgdXNlciByZWxhdGlvbnNoaXBzXG4gICAgICAgIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgIGRiLmRlbGV0ZShzY2hlbWEudXNlclJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuZG9jdW1lbnRzLnVwbG9hZGVkQnlJZCwgY3VycmVudFVzZXIuaWQpKSxcblxuICAgICAgICAvLyBEZWxldGUgdXNlci1jcmVhdGVkIGNvbnRlbnRcbiAgICAgICAgZGIuZGVsZXRlKHNjaGVtYS5ub3RpZmljYXRpb25zKS53aGVyZShlcShzY2hlbWEubm90aWZpY2F0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSksXG4gICAgICAgIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMuc3VibWl0dGVkQnksIGN1cnJlbnRVc2VyLmlkKSksXG5cbiAgICAgICAgLy8gRGVsZXRlIGludml0YXRpb25zXG4gICAgICAgIGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgY3VycmVudFVzZXIuZW1haWwpKSxcbiAgICAgIF0pO1xuXG4gICAgICAvLyBGaW5hbGx5LCBkZWxldGUgdGhlIHVzZXIgYWNjb3VudFxuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCBjdXJyZW50VXNlci5pZCkpO1xuXG4gICAgICAvLyBMb2cgdGhlIGRlbGV0aW9uIGZvciBhdWRpdCBwdXJwb3Nlc1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGBVc2VyIGFjY291bnQgZGVsZXRlZDogJHtjdXJyZW50VXNlci5lbWFpbH0gKCR7Y3VycmVudFVzZXIuaWR9KS4gUmVhc29uOiAke3JlYXNvbiB8fCAnTm90IHByb3ZpZGVkJ31gXG4gICAgICApO1xuXG4gICAgICAvLyBDbGVhciBzZXNzaW9uXG4gICAgICBpZiAocmVxLnNlc3Npb24pIHtcbiAgICAgICAgcmVxLnNlc3Npb24uZGVzdHJveSgoZXJyOiBhbnkpID0+IHtcbiAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZGVzdHJveSBzZXNzaW9uIGFmdGVyIGFjY291bnQgZGVsZXRpb246JywgZXJyKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6XG4gICAgICAgICAgJ0FjY291bnQgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQuIEFsbCBwZXJzb25hbCBkYXRhIGhhcyBiZWVuIHBlcm1hbmVudGx5IHJlbW92ZWQgZnJvbSBvdXIgc3lzdGVtcy4nLFxuICAgICAgICBkZWxldGlvbkRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyBhY2NvdW50OicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlbGV0ZSBhY2NvdW50LiBQbGVhc2UgY29udGFjdCBzdXBwb3J0LicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQVVQgL2FwaS91c2Vycy9tZSAtIFVwZGF0ZSBjdXJyZW50IHVzZXIncyBwcm9maWxlLlxuICAgKi9cbiAgYXBwLnB1dCgnL2FwaS91c2Vycy9tZScsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgdGhlIHVwZGF0ZSBkYXRhIChleGNsdWRpbmcgcGFzc3dvcmQgdXBkYXRlcyBmb3Igc2VjdXJpdHkpXG4gICAgICBjb25zdCB1cGRhdGVTY2hlbWEgPSBpbnNlcnRVc2VyU2NoZW1hXG4gICAgICAgIC5wYXJ0aWFsKClcbiAgICAgICAgLm9taXQoeyBwYXNzd29yZDogdHJ1ZSwgaWQ6IHRydWUsIHJvbGU6IHRydWUgfSk7XG4gICAgICBjb25zdCB2YWxpZGF0ZWREYXRhID0gdXBkYXRlU2NoZW1hLnBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UudXBkYXRlVXNlcihjdXJyZW50VXNlci5pZCwge1xuICAgICAgICAuLi52YWxpZGF0ZWREYXRhLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ1VTRVJfTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJlbW92ZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gYmVmb3JlIHNlbmRpbmcgcmVzcG9uc2VcbiAgICAgIGNvbnN0IHsgcGFzc3dvcmQsIC4uLnVzZXJXaXRob3V0UGFzc3dvcmQgfSA9IHVzZXI7XG4gICAgICByZXMuanNvbih1c2VyV2l0aG91dFBhc3N3b3JkKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgdXNlciBwcm9maWxlOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBwcm9maWxlJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS91c2Vycy86aWQvZGVsZXRlLWFjY291bnQgLSBSRVNUUklDVEVEIEFkbWluIGVuZHBvaW50IHRvIGRlbGV0ZSBhbnkgdXNlciBhY2NvdW50LlxuICAgKiBTQUZFVFk6IFJlcXVpcmVzIGVtYWlsIGNvbmZpcm1hdGlvbiBhbmQgZGVsZXRpb24gcmVhc29uIGZvciBhdWRpdCB0cmFpbC5cbiAgICogV0FSTklORzogVGhpcyBpcyBhIHBlcm1hbmVudCBvcGVyYXRpb24gdGhhdCBzaG91bGQgb25seSBiZSB1c2VkIGluIGV4Y2VwdGlvbmFsIGNhc2VzLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvdXNlcnMvOmlkL2RlbGV0ZS1hY2NvdW50JywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBjb25zdCB7IGlkOiB0YXJnZXRVc2VySWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgb3RoZXIgdXNlcnMnIGFjY291bnRzXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdPbmx5IGFkbWluaXN0cmF0b3JzIGNhbiBkZWxldGUgdXNlciBhY2NvdW50cycsXG4gICAgICAgICAgY29kZTogJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGRpdGlvbmFsIHNhZmV0eSBjaGVjazogTG9nIHRoaXMgY3JpdGljYWwgb3BlcmF0aW9uXG4gICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAgQ1JJVElDQUw6IEFkbWluICR7Y3VycmVudFVzZXIuZW1haWx9IGF0dGVtcHRpbmcgdG8gZGVsZXRlIHVzZXIgJHt0YXJnZXRVc2VySWR9YCk7XG5cbiAgICAgIGlmICghdGFyZ2V0VXNlcklkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgSUQgaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZBTElEX1JFUVVFU1QnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmVyaWZ5IHRhcmdldCB1c2VyIGV4aXN0c1xuICAgICAgY29uc3QgdGFyZ2V0VXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcih0YXJnZXRVc2VySWQpO1xuICAgICAgaWYgKCF0YXJnZXRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBjb25maXJtRW1haWwsIHJlYXNvbiB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIFZlcmlmeSBlbWFpbCBjb25maXJtYXRpb25cbiAgICAgIGlmIChjb25maXJtRW1haWwgIT09IHRhcmdldFVzZXIuZW1haWwpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRW1haWwgY29uZmlybWF0aW9uIGRvZXMgbm90IG1hdGNoJyxcbiAgICAgICAgICBjb2RlOiAnRU1BSUxfTUlTTUFUQ0gnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRGVsZXRlIGFsbCByZWxhdGVkIGRhdGEgaW4gdGhlIGNvcnJlY3Qgb3JkZXIgdG8gaGFuZGxlIGZvcmVpZ24ga2V5IGNvbnN0cmFpbnRzXG4gICAgICBjb25zdCBkZWxldGlvblByb21pc2VzID0gW1xuICAgICAgICAvLyBEZWxldGUgdXNlciByZWxhdGlvbnNoaXBzXG4gICAgICAgIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHRhcmdldFVzZXJJZCkpLFxuICAgICAgICBkYi5kZWxldGUoc2NoZW1hLnVzZXJSZXNpZGVuY2VzKS53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB0YXJnZXRVc2VySWQpKSxcbiAgICAgICAgZGJcbiAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMudXBsb2FkZWRCeUlkLCB0YXJnZXRVc2VySWQpKSxcblxuICAgICAgICAvLyBEZWxldGUgaW52aXRhdGlvbnNcbiAgICAgICAgZGIuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmVtYWlsLCB0YXJnZXRVc2VyLmVtYWlsKSksXG4gICAgICBdO1xuXG4gICAgICAvLyBUcnkgdG8gZGVsZXRlIGZyb20gb3B0aW9uYWwgdGFibGVzIHRoYXQgbWlnaHQgbm90IGV4aXN0XG4gICAgICBjb25zdCBvcHRpb25hbERlbGV0aW9ucyA9IFtcbiAgICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBkYlxuICAgICAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5ub3RpZmljYXRpb25zKVxuICAgICAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm5vdGlmaWNhdGlvbnMudXNlcklkLCB0YXJnZXRVc2VySWQpKTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IuY2F1c2U/LmNvZGUgPT09ICc0MlAwMScpIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdGlmaWNhdGlvbnMgdGFibGUgbm90IGZvdW5kLCBza2lwcGluZy4uLicpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5kZWxldGUoc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMpXG4gICAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cy5zdWJtaXR0ZWRCeSwgdGFyZ2V0VXNlcklkKSk7XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgICAgaWYgKGVycm9yLmNhdXNlPy5jb2RlID09PSAnNDJQMDEnKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNYWludGVuYW5jZSByZXF1ZXN0cyB0YWJsZSBub3QgZm91bmQsIHNraXBwaW5nLi4uJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAvLyBFeGVjdXRlIGNvcmUgZGVsZXRpb25zIGZpcnN0XG4gICAgICBhd2FpdCBQcm9taXNlLmFsbChkZWxldGlvblByb21pc2VzKTtcblxuICAgICAgLy8gRXhlY3V0ZSBvcHRpb25hbCBkZWxldGlvbnNcbiAgICAgIGF3YWl0IFByb21pc2UuYWxsKG9wdGlvbmFsRGVsZXRpb25zLm1hcCgoZm4pID0+IGZuKCkpKTtcblxuICAgICAgLy8gRmluYWxseSwgZGVsZXRlIHRoZSB1c2VyIGFjY291bnRcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgdGFyZ2V0VXNlcklkKSk7XG5cbiAgICAgIC8vIENsZWFyIGFsbCBjYWNoZXMgdG8gZW5zdXJlIHRoZSB1c2VyIGxpc3QgdXBkYXRlcyBpbW1lZGlhdGVseVxuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd1c2VycycsICdhbGxfdXNlcnMnKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCBgdXNlcjoke3RhcmdldFVzZXJJZH1gKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCBgdXNlcl9lbWFpbDoke3RhcmdldFVzZXIuZW1haWx9YCk7XG5cbiAgICAgIC8vIExvZyB0aGUgZGVsZXRpb24gZm9yIGF1ZGl0IHB1cnBvc2VzXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYFVzZXIgYWNjb3VudCBkZWxldGVkIGJ5IGFkbWluICR7Y3VycmVudFVzZXIuZW1haWx9ICgke2N1cnJlbnRVc2VyLmlkfSk6ICR7dGFyZ2V0VXNlci5lbWFpbH0gKCR7dGFyZ2V0VXNlcklkfSkuIFJlYXNvbjogJHtyZWFzb24gfHwgJ05vdCBwcm92aWRlZCd9YFxuICAgICAgKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnVXNlciBhY2NvdW50IGFuZCBhbGwgYXNzb2NpYXRlZCBkYXRhIGhhdmUgYmVlbiBwZXJtYW5lbnRseSBkZWxldGVkJyxcbiAgICAgICAgZGVsZXRlZFVzZXJJZDogdGFyZ2V0VXNlcklkLFxuICAgICAgICBkZWxldGVkVXNlckVtYWlsOiB0YXJnZXRVc2VyLmVtYWlsLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlbGV0aW5nIHVzZXIgYWNjb3VudDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgdXNlciBhY2NvdW50JyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS91c2Vycy9tZS9jaGFuZ2UtcGFzc3dvcmQgLSBDaGFuZ2UgY3VycmVudCB1c2VyJ3MgcGFzc3dvcmQuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS91c2Vycy9tZS9jaGFuZ2UtcGFzc3dvcmQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgY3VycmVudFBhc3N3b3JkLCBuZXdQYXNzd29yZCB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghY3VycmVudFBhc3N3b3JkIHx8ICFuZXdQYXNzd29yZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDdXJyZW50IHBhc3N3b3JkIGFuZCBuZXcgcGFzc3dvcmQgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9JTlBVVCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWZXJpZnkgY3VycmVudCBwYXNzd29yZFxuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihjdXJyZW50VXNlci5pZCk7XG4gICAgICBpZiAoIXVzZXIgfHwgIShhd2FpdCBiY3J5cHQuY29tcGFyZShjdXJyZW50UGFzc3dvcmQsIHVzZXIucGFzc3dvcmQpKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDdXJyZW50IHBhc3N3b3JkIGlzIGluY29ycmVjdCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfUEFTU1dPUkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gSGFzaCBuZXcgcGFzc3dvcmRcbiAgICAgIGNvbnN0IGhhc2hlZFBhc3N3b3JkID0gYXdhaXQgYmNyeXB0Lmhhc2gobmV3UGFzc3dvcmQsIDEyKTtcblxuICAgICAgLy8gVXBkYXRlIHBhc3N3b3JkXG4gICAgICBhd2FpdCBzdG9yYWdlLnVwZGF0ZVVzZXIoY3VycmVudFVzZXIuaWQsIHtcbiAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ1Bhc3N3b3JkIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjaGFuZ2luZyBwYXNzd29yZDonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjaGFuZ2UgcGFzc3dvcmQnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL3VzZXJzL2RlbW8gLSBDcmVhdGVzIGEgZGVtbyB1c2VyIGRpcmVjdGx5IHdpdGhvdXQgaW52aXRhdGlvblxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvdXNlcnMvZGVtbycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gT25seSBhZG1pbnMgYW5kIG1hbmFnZXJzIGNhbiBjcmVhdGUgZGVtbyB1c2Vyc1xuICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBmaXJzdE5hbWUsIGxhc3ROYW1lLCByb2xlLCBvcmdhbml6YXRpb25JZCwgcmVzaWRlbmNlSWQgfSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBWYWxpZGF0ZSBkZW1vIHJvbGVcbiAgICAgIGlmICghWydkZW1vX21hbmFnZXInLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKHJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgZGVtbyByb2xlJyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9ST0xFJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgaWYgKCFmaXJzdE5hbWUgfHwgIWxhc3ROYW1lIHx8ICFvcmdhbml6YXRpb25JZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdGaXJzdCBuYW1lLCBsYXN0IG5hbWUsIGFuZCBvcmdhbml6YXRpb24gYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19SRVFVSVJFRF9GSUVMRFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2VuZXJhdGUgZGVtbyBlbWFpbFxuICAgICAgY29uc3QgZW1haWwgPSBgJHtmaXJzdE5hbWUudG9Mb3dlckNhc2UoKX0uJHtsYXN0TmFtZS50b0xvd2VyQ2FzZSgpfUBkZW1vLmNvbWA7XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlckJ5RW1haWwoZW1haWwpO1xuICAgICAgaWYgKGV4aXN0aW5nVXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdEZW1vIHVzZXIgd2l0aCB0aGlzIG5hbWUgYWxyZWFkeSBleGlzdHMnLFxuICAgICAgICAgIGNvZGU6ICdVU0VSX0VYSVNUUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgZGVtbyB1c2VyIHdpdGggc2VjdXJlIHJhbmRvbSBwYXNzd29yZFxuICAgICAgY29uc3QgcmFuZG9tUGFzc3dvcmQgPSByYW5kb21CeXRlcygxMikudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChgRGVtbyR7cmFuZG9tUGFzc3dvcmR9IWAsIDEyKTtcblxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XG4gICAgICAgIGZpcnN0TmFtZTogc2FuaXRpemVOYW1lKGZpcnN0TmFtZSksXG4gICAgICAgIGxhc3ROYW1lOiBzYW5pdGl6ZU5hbWUobGFzdE5hbWUpLFxuICAgICAgICBlbWFpbDogbm9ybWFsaXplRW1haWwoZW1haWwpLFxuICAgICAgICB1c2VybmFtZTogZ2VuZXJhdGVVc2VybmFtZUZyb21FbWFpbChlbWFpbCksXG4gICAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgICAgbGFuZ3VhZ2U6ICdmcicsIC8vIERlZmF1bHQgdG8gRnJlbmNoIGZvciBRdWViZWNcbiAgICAgICAgcm9sZTogcm9sZSBhcyBhbnksXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbmV3VXNlciA9IGF3YWl0IHN0b3JhZ2UuY3JlYXRlVXNlcih1c2VyRGF0YSBhcyBJbnNlcnRVc2VyKTtcblxuICAgICAgLy8gTG9nIHRoZSB1c2VyIGNyZWF0aW9uXG4gICAgICBsb2dVc2VyQ3JlYXRpb24oe1xuICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICBtZXRob2Q6ICdkaXJlY3QnLFxuICAgICAgICByb2xlLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xlYXIgY2FjaGVcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzJyk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0RlbW8gdXNlciBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogbmV3VXNlci5pZCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG5ld1VzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiBuZXdVc2VyLmxhc3ROYW1lLFxuICAgICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICAgIHJvbGU6IG5ld1VzZXIucm9sZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBkZW1vIHVzZXI6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGRlbW8gdXNlcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvaW52aXRhdGlvbnMgLSBDcmVhdGVzIGEgbmV3IGludml0YXRpb25cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2ludml0YXRpb25zJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIHNlbmQgaW52aXRhdGlvbnNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zJyxcbiAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHtcbiAgICAgICAgb3JnYW5pemF0aW9uSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcm9sZSxcbiAgICAgICAgaW52aXRlZEJ5VXNlcklkLFxuICAgICAgICBleHBpcmVzQXQsXG4gICAgICAgIHBlcnNvbmFsTWVzc2FnZSxcbiAgICAgIH0gPSByZXEuYm9keTtcblxuICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzIGZpcnN0XG4gICAgICBpZiAoIW9yZ2FuaXphdGlvbklkIHx8ICFlbWFpbCB8fCAhcm9sZSB8fCAhZXhwaXJlc0F0KSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ09yZ2FuaXphdGlvbiwgZW1haWwsIHJvbGUsIGFuZCBleHBpcnkgZGF0ZSBhcmUgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdNSVNTSU5HX1JFUVVJUkVEX0ZJRUxEUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBUaGVuIHZhbGlkYXRlIGVtYWlsIGZvcm1hdFxuICAgICAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICAgICAgaWYgKCFlbWFpbFJlZ2V4LnRlc3QoZW1haWwpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgZW1haWwgZm9ybWF0JyxcbiAgICAgICAgICBjb2RlOiAnSU5WQUxJRF9FTUFJTCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSByb2xlIHBlcm1pc3Npb25zXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgIC8vIENoZWNrIGlmIG1hbmFnZXIgaXMgdHJ5aW5nIHRvIGludml0ZSBhZG1pblxuICAgICAgICBpZiAocm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnTWFuYWdlcnMgY2FuIG9ubHkgaW52aXRlIHJlc2lkZW50LCB0ZW5hbnQsIGFuZCBtYW5hZ2VyIHJvbGVzJyxcbiAgICAgICAgICAgIGNvZGU6ICdST0xFX1BFUk1JU1NJT05fREVOSUVEJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEdldCB0aGUgZGVtbyBvcmdhbml6YXRpb24gdG8gY2hlY2sgaWYgaXQncyBhIGRlbW8gb3JnXG4gICAgICAgIGNvbnN0IHRhcmdldE9yZyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBvcmdhbml6YXRpb25JZCkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAgIGlmICh0YXJnZXRPcmcubGVuZ3RoID4gMCAmJiB0YXJnZXRPcmdbMF0udHlwZSA9PT0gJ0RlbW8nKSB7XG4gICAgICAgICAgLy8gRm9yIGRlbW8gb3JnYW5pemF0aW9ucywgYWxsb3cgbm9ybWFsIHJvbGVzIChyZXNpZGVudCwgdGVuYW50LCBtYW5hZ2VyKVxuICAgICAgICAgIGlmICghWydyZXNpZGVudCcsICd0ZW5hbnQnLCAnbWFuYWdlciddLmluY2x1ZGVzKHJvbGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCByb2xlIGZvciBkZW1vIG9yZ2FuaXphdGlvbicsXG4gICAgICAgICAgICAgIGNvZGU6ICdJTlZBTElEX0RFTU9fUk9MRScsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gRm9yIHJlZ3VsYXIgb3JnYW5pemF0aW9ucywgbWFuYWdlcnMgY2FuIGludml0ZSByZXNpZGVudCwgdGVuYW50LCBtYW5hZ2VyXG4gICAgICAgICAgaWYgKCFbJ3Jlc2lkZW50JywgJ3RlbmFudCcsICdtYW5hZ2VyJ10uaW5jbHVkZXMocm9sZSkpIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICAgIG1lc3NhZ2U6ICdNYW5hZ2VycyBjYW4gb25seSBpbnZpdGUgcmVzaWRlbnQsIHRlbmFudCwgYW5kIG1hbmFnZXIgcm9sZXMnLFxuICAgICAgICAgICAgICBjb2RlOiAnUk9MRV9QRVJNSVNTSU9OX0RFTklFRCcsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBhbHJlYWR5IGV4aXN0c1xuICAgICAgY29uc3QgZXhpc3RpbmdVc2VyID0gYXdhaXQgc3RvcmFnZS5nZXRVc2VyQnlFbWFpbChlbWFpbCk7XG4gICAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9FWElTVFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIGV4aXN0aW5nIHBlbmRpbmcgaW52aXRhdGlvbnMgZm9yIHRoZSBzYW1lIGVtYWlsIGFuZCBvcmdhbml6YXRpb25cbiAgICAgIC8vIElmIGZvdW5kLCBkZWxldGUgdGhlbSB0byByZXBsYWNlIHdpdGggbmV3IGludml0YXRpb25cbiAgICAgIGNvbnN0IGV4aXN0aW5nSW52aXRhdGlvbnMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoc2NoZW1hLmludml0YXRpb25zLmVtYWlsLCBlbWFpbCksXG4gICAgICAgICAgICBlcShzY2hlbWEuaW52aXRhdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkKSxcbiAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsICdwZW5kaW5nJylcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGlmIChleGlzdGluZ0ludml0YXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coYPCflIQgUmVwbGFjaW5nICR7ZXhpc3RpbmdJbnZpdGF0aW9ucy5sZW5ndGh9IGV4aXN0aW5nIGludml0YXRpb24ocykgZm9yIGVtYWlsOiAke2VtYWlsfWApO1xuICAgICAgICAvLyBEZWxldGUgZXhpc3RpbmcgcGVuZGluZyBpbnZpdGF0aW9ucyBmb3IgdGhpcyBlbWFpbC9vcmdhbml6YXRpb25cbiAgICAgICAgYXdhaXQgZGJcbiAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgZW1haWwpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuaW52aXRhdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmludml0YXRpb25zLnN0YXR1cywgJ3BlbmRpbmcnKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdlbmVyYXRlIHNlY3VyZSBpbnZpdGF0aW9uIHRva2VuXG4gICAgICBjb25zdCB0b2tlbiA9IHJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XG4gICAgICBjb25zdCB0b2tlbkhhc2ggPSBjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodG9rZW4pLmRpZ2VzdCgnaGV4Jyk7XG5cbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uIHJlY29yZFxuICAgICAgY29uc3QgaW52aXRhdGlvbkRhdGEgPSB7XG4gICAgICAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICByZXNpZGVuY2VJZDogcmVzaWRlbmNlSWQgfHwgbnVsbCxcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHRva2VuLFxuICAgICAgICB0b2tlbkhhc2gsXG4gICAgICAgIHJvbGU6IHJvbGUgYXMgYW55LFxuICAgICAgICBpbnZpdGVkQnlVc2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKGV4cGlyZXNBdCksXG4gICAgICAgIHBlcnNvbmFsTWVzc2FnZTogcGVyc29uYWxNZXNzYWdlIHx8IG51bGwsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBbbmV3SW52aXRhdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnZhbHVlcyhpbnZpdGF0aW9uRGF0YSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIGRldGFpbHMgZm9yIGVtYWlsXG4gICAgICBjb25zdCBbb3JnYW5pemF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBvcmdhbml6YXRpb25JZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgLy8gU2VuZCBpbnZpdGF0aW9uIGVtYWlsXG4gICAgICBjb25zdCByZWNpcGllbnROYW1lID0gZW1haWwuc3BsaXQoJ0AnKVswXTsgLy8gVXNlIGVtYWlsIHByZWZpeCBhcyBuYW1lXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25OYW1lID0gb3JnYW5pemF0aW9uPy5uYW1lIHx8ICdLb3ZlbyBHZXN0aW9uJztcbiAgICAgIGNvbnN0IGludml0ZXJOYW1lID0gYCR7Y3VycmVudFVzZXIuZmlyc3ROYW1lIHx8IGN1cnJlbnRVc2VyLmVtYWlsfSAke2N1cnJlbnRVc2VyLmxhc3ROYW1lIHx8ICcnfWAudHJpbSgpO1xuICAgICAgXG4gICAgICBjb25zdCBlbWFpbFNlbnQgPSBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZEludml0YXRpb25FbWFpbChcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHJlY2lwaWVudE5hbWUsXG4gICAgICAgIHRva2VuLCAvLyBVc2UgdGhlIHVuaGFzaGVkIHRva2VuIGZvciB0aGUgZW1haWwgVVJMXG4gICAgICAgIG9yZ2FuaXphdGlvbk5hbWUsXG4gICAgICAgIGludml0ZXJOYW1lLFxuICAgICAgICBuZXcgRGF0ZShleHBpcmVzQXQpLFxuICAgICAgICAnZnInLCAvLyBEZWZhdWx0IHRvIEZyZW5jaCBmb3IgUXVlYmVjXG4gICAgICAgIHBlcnNvbmFsTWVzc2FnZVxuICAgICAgKTtcblxuICAgICAgLy8gTG9nIGludml0YXRpb24gY3JlYXRpb25cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgSW52aXRhdGlvbiBjcmVhdGVkOicsIHtcbiAgICAgICAgaWQ6IG5ld0ludml0YXRpb24uaWQsXG4gICAgICAgIGVtYWlsLFxuICAgICAgICByb2xlLFxuICAgICAgICBvcmdhbml6YXRpb25JZCxcbiAgICAgICAgaW52aXRlZEJ5OiBjdXJyZW50VXNlci5lbWFpbCxcbiAgICAgICAgZW1haWxTZW50LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEZvciB0ZXN0cywgd2UnbGwgdHJlYXQgZW1haWwgZmFpbHVyZSBhcyBzdWNjZXNzIHNpbmNlIHRlc3RzIG1heSBub3QgaGF2ZSBlbWFpbCBjb25maWd1cmVkXG4gICAgICBpZiAoIWVtYWlsU2VudCAmJiBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnKSB7XG4gICAgICAgIC8vIElmIGVtYWlsIGZhaWxlZCBidXQgaW52aXRhdGlvbiB3YXMgY3JlYXRlZCwgbG9nIHRoZSBpc3N1ZVxuICAgICAgICBjb25zb2xlLmVycm9yKCfimqDvuI8gSW52aXRhdGlvbiBjcmVhdGVkIGJ1dCBlbWFpbCBmYWlsZWQgdG8gc2VuZCcpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cygyMDcpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIGNyZWF0ZWQgYnV0IGVtYWlsIGZhaWxlZCB0byBzZW5kJyxcbiAgICAgICAgICBpbnZpdGF0aW9uSWQ6IG5ld0ludml0YXRpb24uaWQsXG4gICAgICAgICAgZW1haWxTZW50OiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gc2VudCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBpbnZpdGF0aW9uSWQ6IG5ld0ludml0YXRpb24uaWQsXG4gICAgICAgIGVtYWlsU2VudDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBpbnZpdGF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBpbnZpdGF0aW9uJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL2ludml0YXRpb25zIC0gR2V0cyBhbGwgaW52aXRhdGlvbnMgKGFkbWluL21hbmFnZXIgb25seSlcbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvaW52aXRhdGlvbnMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gdmlldyBpbnZpdGF0aW9uc1xuICAgICAgaWYgKCFbJ2FkbWluJywgJ21hbmFnZXInXS5pbmNsdWRlcyhjdXJyZW50VXNlci5yb2xlKSkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnN1ZmZpY2llbnQgcGVybWlzc2lvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IGludml0YXRpb25zO1xuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgLy8gQWRtaW4gY2FuIHNlZSBhbGwgaW52aXRhdGlvbnNcbiAgICAgICAgaW52aXRhdGlvbnMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEuaW52aXRhdGlvbnMuY3JlYXRlZEF0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1hbmFnZXJzIGNhbiBvbmx5IHNlZSBpbnZpdGF0aW9ucyB0aGV5IHNlbnRcbiAgICAgICAgaW52aXRhdGlvbnMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmludml0ZWRCeVVzZXJJZCwgY3VycmVudFVzZXIuaWQpKVxuICAgICAgICAgIC5vcmRlckJ5KHNjaGVtYS5pbnZpdGF0aW9ucy5jcmVhdGVkQXQpO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbihpbnZpdGF0aW9ucyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGludml0YXRpb25zOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGludml0YXRpb25zJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS9pbnZpdGF0aW9ucy92YWxpZGF0ZSAtIFZhbGlkYXRlcyBhbiBpbnZpdGF0aW9uIHRva2VuXG4gICAqIFB1YmxpYyBlbmRwb2ludCBmb3IgaW52aXRhdGlvbiB2YWxpZGF0aW9uIGR1cmluZyByZWdpc3RyYXRpb25cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2ludml0YXRpb25zL3ZhbGlkYXRlJywgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyB0b2tlbiB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnVG9rZW4gaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdUT0tFTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgaW52aXRhdGlvbiBieSB0b2tlblxuICAgICAgY29uc3QgW2ludml0YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy50b2tlbiwgdG9rZW4pKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmICghaW52aXRhdGlvbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIG5vdCBmb3VuZCBvciBpbnZhbGlkIHRva2VuJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgaW52aXRhdGlvbiBpcyBleHBpcmVkXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoaW52aXRhdGlvbi5leHBpcmVzQXQpO1xuICAgICAgaWYgKG5vdyA+IGV4cGlyZXNBdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIGhhcyBleHBpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9FWFBJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGludml0YXRpb24gaXMgYWxyZWFkeSB1c2VkXG4gICAgICBpZiAoaW52aXRhdGlvbi5zdGF0dXMgPT09ICdhY2NlcHRlZCcpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBpc1ZhbGlkOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHVzZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZJVEFUSU9OX0FMUkVBRFlfVVNFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCBbb3JnYW5pemF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBHZXQgaW52aXRlciBpbmZvcm1hdGlvblxuICAgICAgY29uc3QgW2ludml0ZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHNjaGVtYS51c2Vycy5pZCxcbiAgICAgICAgICBmaXJzdE5hbWU6IHNjaGVtYS51c2Vycy5maXJzdE5hbWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHNjaGVtYS51c2Vycy5sYXN0TmFtZSxcbiAgICAgICAgICBlbWFpbDogc2NoZW1hLnVzZXJzLmVtYWlsLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIGludml0YXRpb24uaW52aXRlZEJ5VXNlcklkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBSZXR1cm4gc3VjY2Vzc2Z1bCB2YWxpZGF0aW9uXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICAgIGludml0YXRpb246IHtcbiAgICAgICAgICBpZDogaW52aXRhdGlvbi5pZCxcbiAgICAgICAgICBlbWFpbDogaW52aXRhdGlvbi5lbWFpbCxcbiAgICAgICAgICByb2xlOiBpbnZpdGF0aW9uLnJvbGUsXG4gICAgICAgICAgZXhwaXJlc0F0OiBpbnZpdGF0aW9uLmV4cGlyZXNBdCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGludml0YXRpb24uY3JlYXRlZEF0LFxuICAgICAgICB9LFxuICAgICAgICBvcmdhbml6YXRpb25OYW1lOiBvcmdhbml6YXRpb24/Lm5hbWUgfHwgJ1Vua25vd24gT3JnYW5pemF0aW9uJyxcbiAgICAgICAgaW52aXRlck5hbWU6IGludml0ZXIgPyBgJHtpbnZpdGVyLmZpcnN0TmFtZX0gJHtpbnZpdGVyLmxhc3ROYW1lfWAudHJpbSgpIDogJ1Vua25vd24gVXNlcicsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdmFsaWRhdGluZyBpbnZpdGF0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgaXNWYWxpZDogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3IgZHVyaW5nIHZhbGlkYXRpb24nLFxuICAgICAgICBjb2RlOiAnVkFMSURBVElPTl9FUlJPUicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvaW52aXRhdGlvbnMvYWNjZXB0Lzp0b2tlbiAtIEFjY2VwdCBhbiBpbnZpdGF0aW9uIGFuZCBjcmVhdGUgdXNlciBhY2NvdW50XG4gICAqIFB1YmxpYyBlbmRwb2ludCBmb3IgY29tcGxldGluZyByZWdpc3RyYXRpb24gdmlhIGludml0YXRpb25cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2ludml0YXRpb25zL2FjY2VwdC86dG9rZW4nLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IHRva2VuIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3Qge1xuICAgICAgICBmaXJzdE5hbWUsXG4gICAgICAgIGxhc3ROYW1lLFxuICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgcGhvbmUsXG4gICAgICAgIGxhbmd1YWdlLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQsXG4gICAgICAgIG1hcmtldGluZ0NvbnNlbnQsXG4gICAgICAgIGFuYWx5dGljc0NvbnNlbnQsXG4gICAgICAgIHRoaXJkUGFydHlDb25zZW50LFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHMsXG4gICAgICB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnVG9rZW4gaXMgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdUT0tFTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgaW52aXRhdGlvbiBieSB0b2tlblxuICAgICAgY29uc3QgW2ludml0YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy50b2tlbiwgdG9rZW4pKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmICghaW52aXRhdGlvbikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIG5vdCBmb3VuZCBvciBpbnZhbGlkIHRva2VuJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgaW52aXRhdGlvbiBpcyBleHBpcmVkXG4gICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoaW52aXRhdGlvbi5leHBpcmVzQXQpO1xuICAgICAgaWYgKG5vdyA+IGV4cGlyZXNBdCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIGhhcyBleHBpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9FWFBJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGludml0YXRpb24gaXMgYWxyZWFkeSB1c2VkXG4gICAgICBpZiAoaW52aXRhdGlvbi5zdGF0dXMgPT09ICdhY2NlcHRlZCcpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHVzZWQnLFxuICAgICAgICAgIGNvZGU6ICdJTlZJVEFUSU9OX0FMUkVBRFlfVVNFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICAgIGlmICghZmlyc3ROYW1lIHx8ICFsYXN0TmFtZSB8fCAhcGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmlyc3QgbmFtZSwgbGFzdCBuYW1lLCBhbmQgcGFzc3dvcmQgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19SRVFVSVJFRF9GSUVMRFMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgY29uc2VudHNcbiAgICAgIGlmICghZGF0YUNvbGxlY3Rpb25Db25zZW50IHx8ICFhY2tub3dsZWRnZWRSaWdodHMpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnUmVxdWlyZWQgcHJpdmFjeSBjb25zZW50cyBtdXN0IGJlIGdpdmVuJyxcbiAgICAgICAgICBjb2RlOiAnTUlTU0lOR19SRVFVSVJFRF9DT05TRU5UUycsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBIYXNoIHBhc3N3b3JkXG4gICAgICBjb25zdCBoYXNoZWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5oYXNoKHBhc3N3b3JkLCAxMik7XG5cbiAgICAgIC8vIENyZWF0ZSB1c2VyIGFjY291bnRcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6IHNhbml0aXplTmFtZShmaXJzdE5hbWUpLFxuICAgICAgICBsYXN0TmFtZTogc2FuaXRpemVOYW1lKGxhc3ROYW1lKSxcbiAgICAgICAgZW1haWw6IG5vcm1hbGl6ZUVtYWlsKGludml0YXRpb24uZW1haWwpLFxuICAgICAgICB1c2VybmFtZTogZ2VuZXJhdGVVc2VybmFtZUZyb21FbWFpbChpbnZpdGF0aW9uLmVtYWlsKSxcbiAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgICBwaG9uZTogcGhvbmUgPyBzYW5pdGl6ZVN0cmluZyhwaG9uZSkgOiAnJyxcbiAgICAgICAgbGFuZ3VhZ2U6IGxhbmd1YWdlIHx8ICdmcicsXG4gICAgICAgIHJvbGU6IGludml0YXRpb24ucm9sZSBhcyBhbnksXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogaW52aXRhdGlvbi5vcmdhbml6YXRpb25JZCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5ld1VzZXIgPSBhd2FpdCBzdG9yYWdlLmNyZWF0ZVVzZXIodXNlckRhdGEgYXMgSW5zZXJ0VXNlcik7XG5cbiAgICAgIC8vIENyZWF0ZSBvcmdhbml6YXRpb24gYXNzaWdubWVudCBpZiBvcmdhbml6YXRpb25JZCBpcyBwcm92aWRlZFxuICAgICAgaWYgKGludml0YXRpb24ub3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucykudmFsdWVzKHtcbiAgICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGludml0YXRpb24ub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogaW52aXRhdGlvbi5yb2xlLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBVc2VyIGFzc2lnbmVkIHRvIG9yZ2FuaXphdGlvbjonLCB7XG4gICAgICAgICAgdXNlcklkOiBuZXdVc2VyLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIHJvbGU6IGludml0YXRpb24ucm9sZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSByZXNpZGVuY2UgYXNzaWdubWVudCBpZiByZXNpZGVuY2VJZCBpcyBwcm92aWRlZFxuICAgICAgaWYgKGludml0YXRpb24ucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS51c2VyUmVzaWRlbmNlcykudmFsdWVzKHtcbiAgICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IGludml0YXRpb24ucmVzaWRlbmNlSWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogaW52aXRhdGlvbi5yb2xlID09PSAndGVuYW50JyA/ICd0ZW5hbnQnIDogJ29jY3VwYW50JyxcbiAgICAgICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFVzZXIgYXNzaWduZWQgdG8gcmVzaWRlbmNlOicsIHtcbiAgICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IGludml0YXRpb24ucmVzaWRlbmNlSWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogaW52aXRhdGlvbi5yb2xlID09PSAndGVuYW50JyA/ICd0ZW5hbnQnIDogJ29jY3VwYW50JyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE1hcmsgaW52aXRhdGlvbiBhcyBhY2NlcHRlZFxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIHN0YXR1czogJ2FjY2VwdGVkJyxcbiAgICAgICAgICBhY2NlcHRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIGFjY2VwdGVkQnk6IG5ld1VzZXIuaWQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpbnZpdGF0aW9uLmlkKSk7XG5cbiAgICAgIC8vIExvZyB1c2VyIGNyZWF0aW9uXG4gICAgICBsb2dVc2VyQ3JlYXRpb24oe1xuICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICBtZXRob2Q6ICdpbnZpdGF0aW9uJyxcbiAgICAgICAgcm9sZTogaW52aXRhdGlvbi5yb2xlLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xlYXIgY2FjaGVcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzJyk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgVXNlciBjcmVhdGVkIHZpYSBpbnZpdGF0aW9uIGFjY2VwdGFuY2U6Jywge1xuICAgICAgICB1c2VySWQ6IG5ld1VzZXIuaWQsXG4gICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICByb2xlOiBuZXdVc2VyLnJvbGUsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiBpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICByZXNpZGVuY2VJZDogaW52aXRhdGlvbi5yZXNpZGVuY2VJZCxcbiAgICAgICAgYXNzaWduZWRUb09yZ2FuaXphdGlvbjogISFpbnZpdGF0aW9uLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICBhc3NpZ25lZFRvUmVzaWRlbmNlOiAhIWludml0YXRpb24ucmVzaWRlbmNlSWQsXG4gICAgICB9KTtcblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogbmV3VXNlci5pZCxcbiAgICAgICAgICBmaXJzdE5hbWU6IG5ld1VzZXIuZmlyc3ROYW1lLFxuICAgICAgICAgIGxhc3ROYW1lOiBuZXdVc2VyLmxhc3ROYW1lLFxuICAgICAgICAgIGVtYWlsOiBuZXdVc2VyLmVtYWlsLFxuICAgICAgICAgIHJvbGU6IG5ld1VzZXIucm9sZSxcbiAgICAgICAgICBsYW5ndWFnZTogbmV3VXNlci5sYW5ndWFnZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBhY2NlcHRpbmcgaW52aXRhdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3IgZHVyaW5nIGFjY291bnQgY3JlYXRpb24nLFxuICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9BQ0NFUFRfRVJST1InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUE9TVCAvYXBpL2ludml0YXRpb25zLzppZC9yZXNlbmQgLSBSZXNlbmRzIGFuIGludml0YXRpb25cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2ludml0YXRpb25zLzppZC9yZXNlbmQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIC8vIEdldCBpbnZpdGF0aW9uXG4gICAgICBjb25zdCBbaW52aXRhdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKCFpbnZpdGF0aW9uKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcGVybWlzc2lvbnNcbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nICYmIGludml0YXRpb24uaW52aXRlZEJ5VXNlcklkICE9PSBjdXJyZW50VXNlci5pZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdDYW4gb25seSByZXNlbmQgeW91ciBvd24gaW52aXRhdGlvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gVXBkYXRlIGludml0YXRpb24gd2l0aCBuZXcgZXhwaXJ5XG4gICAgICBjb25zdCBuZXdFeHBpcmVzQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgbmV3RXhwaXJlc0F0LnNldERhdGUobmV3RXhwaXJlc0F0LmdldERhdGUoKSArIDcpOyAvLyBFeHRlbmQgYnkgNyBkYXlzXG5cbiAgICAgIGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBleHBpcmVzQXQ6IG5ld0V4cGlyZXNBdCxcbiAgICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIGlkKSk7XG5cbiAgICAgIC8vIEdldCBvcmdhbml6YXRpb24gZGV0YWlscyBmb3IgZW1haWxcbiAgICAgIGNvbnN0IFtvcmdhbml6YXRpb25dID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsIGludml0YXRpb24ub3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIC8vIFNlbmQgaW52aXRhdGlvbiBlbWFpbCBhZ2FpblxuICAgICAgY29uc3QgcmVjaXBpZW50TmFtZSA9IGludml0YXRpb24uZW1haWwuc3BsaXQoJ0AnKVswXTsgLy8gVXNlIGVtYWlsIHByZWZpeCBhcyBuYW1lXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25OYW1lID0gb3JnYW5pemF0aW9uPy5uYW1lIHx8ICdLb3ZlbyBHZXN0aW9uJztcbiAgICAgIGNvbnN0IGludml0ZXJOYW1lID0gYCR7Y3VycmVudFVzZXIuZmlyc3ROYW1lIHx8IGN1cnJlbnRVc2VyLmVtYWlsfSAke2N1cnJlbnRVc2VyLmxhc3ROYW1lIHx8ICcnfWAudHJpbSgpO1xuICAgICAgXG4gICAgICBjb25zdCBlbWFpbFNlbnQgPSBhd2FpdCBlbWFpbFNlcnZpY2Uuc2VuZEludml0YXRpb25FbWFpbChcbiAgICAgICAgaW52aXRhdGlvbi5lbWFpbCxcbiAgICAgICAgcmVjaXBpZW50TmFtZSxcbiAgICAgICAgaW52aXRhdGlvbi50b2tlbiwgLy8gVXNlIHRoZSBleGlzdGluZyB0b2tlblxuICAgICAgICBvcmdhbml6YXRpb25OYW1lLFxuICAgICAgICBpbnZpdGVyTmFtZSxcbiAgICAgICAgbmV3RXhwaXJlc0F0LFxuICAgICAgICAnZnInLCAvLyBEZWZhdWx0IHRvIEZyZW5jaCBmb3IgUXVlYmVjXG4gICAgICAgIGludml0YXRpb24ucGVyc29uYWxNZXNzYWdlXG4gICAgICApO1xuXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEludml0YXRpb24gcmVzZW50OicsIHtcbiAgICAgICAgaWQsXG4gICAgICAgIGVtYWlsOiBpbnZpdGF0aW9uLmVtYWlsLFxuICAgICAgICBuZXdFeHBpcmVzQXQsXG4gICAgICAgIGVtYWlsU2VudCxcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWVtYWlsU2VudCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfimqDvuI8gSW52aXRhdGlvbiB1cGRhdGVkIGJ1dCBlbWFpbCBmYWlsZWQgdG8gcmVzZW5kJyk7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwNykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gdXBkYXRlZCBidXQgZW1haWwgZmFpbGVkIHRvIHJlc2VuZCcsXG4gICAgICAgICAgZW1haWxTZW50OiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gcmVzZW50IHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGVtYWlsU2VudDogdHJ1ZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciByZXNlbmRpbmcgaW52aXRhdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byByZXNlbmQgaW52aXRhdGlvbicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9pbnZpdGF0aW9ucy9wZW5kaW5nIC0gR2V0IHBlbmRpbmcgaW52aXRhdGlvbnMgd2l0aCByb2xlLWJhc2VkIGZpbHRlcmluZy5cbiAgICogQWRtaW46IGNhbiBzZWUgYWxsIHBlbmRpbmcgaW52aXRhdGlvbnNcbiAgICogTWFuYWdlcjogY2FuIG9ubHkgc2VlIHBlbmRpbmcgaW52aXRhdGlvbnMgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9pbnZpdGF0aW9ucy9wZW5kaW5nJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBhbmQgbWFuYWdlcnMgY2FuIHZpZXcgaW52aXRhdGlvbnNcbiAgICAgIGlmICghWydhZG1pbicsICdtYW5hZ2VyJ10uaW5jbHVkZXMoY3VycmVudFVzZXIucm9sZSkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW5zdWZmaWNpZW50IHBlcm1pc3Npb25zIHRvIHZpZXcgaW52aXRhdGlvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgbGV0IGludml0YXRpb25zUXVlcnk7XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWluIHNlZXMgYWxsIHBlbmRpbmcgaW52aXRhdGlvbnNcbiAgICAgICAgaW52aXRhdGlvbnNRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NoZW1hLmludml0YXRpb25zLmlkLFxuICAgICAgICAgICAgZW1haWw6IHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCxcbiAgICAgICAgICAgIHJvbGU6IHNjaGVtYS5pbnZpdGF0aW9ucy5yb2xlLFxuICAgICAgICAgICAgc3RhdHVzOiBzY2hlbWEuaW52aXRhdGlvbnMuc3RhdHVzLFxuICAgICAgICAgICAgZXhwaXJlc0F0OiBzY2hlbWEuaW52aXRhdGlvbnMuZXhwaXJlc0F0LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBzY2hlbWEuaW52aXRhdGlvbnMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHNjaGVtYS5pbnZpdGF0aW9ucy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHNjaGVtYS5pbnZpdGF0aW9ucy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS5pbnZpdGF0aW9ucy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IHNjaGVtYS5vcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgICBidWlsZGluZ05hbWU6IHNxbDxzdHJpbmc+YGJ1aWxkaW5ncy5uYW1lYCxcbiAgICAgICAgICAgIHJlc2lkZW5jZVVuaXROdW1iZXI6IHNxbDxzdHJpbmc+YHJlc2lkZW5jZXMudW5pdF9udW1iZXJgLFxuICAgICAgICAgICAgaW52aXRlZEJ5TmFtZTogc3FsPHN0cmluZz5gQ09OQ0FUKHVzZXJzLmZpcnN0X25hbWUsICcgJywgdXNlcnMubGFzdF9uYW1lKWAsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgICAgLmxlZnRKb2luKHNjaGVtYS5vcmdhbml6YXRpb25zLCBlcShzY2hlbWEuaW52aXRhdGlvbnMub3JnYW5pemF0aW9uSWQsIHNjaGVtYS5vcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgICBzcWxgYnVpbGRpbmdzYCxcbiAgICAgICAgICAgIHNxbGBpbnZpdGF0aW9ucy5idWlsZGluZ19pZCA9IGJ1aWxkaW5ncy5pZGBcbiAgICAgICAgICApXG4gICAgICAgICAgLmxlZnRKb2luKFxuICAgICAgICAgICAgc3FsYHJlc2lkZW5jZXNgLFxuICAgICAgICAgICAgc3FsYGludml0YXRpb25zLnJlc2lkZW5jZV9pZCA9IHJlc2lkZW5jZXMuaWRgXG4gICAgICAgICAgKVxuICAgICAgICAgIC5sZWZ0Sm9pbihzY2hlbWEudXNlcnMsIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pbnZpdGVkQnlVc2VySWQsIHNjaGVtYS51c2Vycy5pZCkpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsICdwZW5kaW5nJykpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gTWFuYWdlciBzZWVzIG9ubHkgaW52aXRhdGlvbnMgZm9yIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgY29uc3QgbWFuYWdlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBvcmdJZHMgPSBtYW5hZ2VyT3Jncy5tYXAoKG9yZykgPT4gb3JnLm9yZ2FuaXphdGlvbklkKTtcblxuICAgICAgICBpZiAob3JnSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7XG4gICAgICAgIH1cblxuICAgICAgICBpbnZpdGF0aW9uc1F1ZXJ5ID0gZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBzY2hlbWEuaW52aXRhdGlvbnMuaWQsXG4gICAgICAgICAgICBlbWFpbDogc2NoZW1hLmludml0YXRpb25zLmVtYWlsLFxuICAgICAgICAgICAgcm9sZTogc2NoZW1hLmludml0YXRpb25zLnJvbGUsXG4gICAgICAgICAgICBzdGF0dXM6IHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsXG4gICAgICAgICAgICBleHBpcmVzQXQ6IHNjaGVtYS5pbnZpdGF0aW9ucy5leHBpcmVzQXQsXG4gICAgICAgICAgICBjcmVhdGVkQXQ6IHNjaGVtYS5pbnZpdGF0aW9ucy5jcmVhdGVkQXQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLmludml0YXRpb25zLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogc2NoZW1hLmludml0YXRpb25zLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICByZXNpZGVuY2VJZDogc2NoZW1hLmludml0YXRpb25zLnJlc2lkZW5jZUlkLFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIGJ1aWxkaW5nTmFtZTogc3FsPHN0cmluZz5gYnVpbGRpbmdzLm5hbWVgLFxuICAgICAgICAgICAgcmVzaWRlbmNlVW5pdE51bWJlcjogc3FsPHN0cmluZz5gcmVzaWRlbmNlcy51bml0X251bWJlcmAsXG4gICAgICAgICAgICBpbnZpdGVkQnlOYW1lOiBzcWw8c3RyaW5nPmBDT05DQVQodXNlcnMuZmlyc3RfbmFtZSwgJyAnLCB1c2Vycy5sYXN0X25hbWUpYCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgICAubGVmdEpvaW4oc2NoZW1hLm9yZ2FuaXphdGlvbnMsIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5vcmdhbml6YXRpb25JZCwgc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgIC5sZWZ0Sm9pbihcbiAgICAgICAgICAgIHNxbGBidWlsZGluZ3NgLFxuICAgICAgICAgICAgc3FsYGludml0YXRpb25zLmJ1aWxkaW5nX2lkID0gYnVpbGRpbmdzLmlkYFxuICAgICAgICAgIClcbiAgICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgICBzcWxgcmVzaWRlbmNlc2AsXG4gICAgICAgICAgICBzcWxgaW52aXRhdGlvbnMucmVzaWRlbmNlX2lkID0gcmVzaWRlbmNlcy5pZGBcbiAgICAgICAgICApXG4gICAgICAgICAgLmxlZnRKb2luKHNjaGVtYS51c2VycywgZXEoc2NoZW1hLmludml0YXRpb25zLmludml0ZWRCeVVzZXJJZCwgc2NoZW1hLnVzZXJzLmlkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsICdwZW5kaW5nJyksXG4gICAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLmludml0YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdJZHMpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaW52aXRhdGlvbnMgPSBhd2FpdCBpbnZpdGF0aW9uc1F1ZXJ5O1xuXG4gICAgICByZXMuanNvbihpbnZpdGF0aW9ucyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHBlbmRpbmcgaW52aXRhdGlvbnM6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggcGVuZGluZyBpbnZpdGF0aW9ucycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBERUxFVEUgL2FwaS9pbnZpdGF0aW9ucy86aWQgLSBEZWxldGUgYSBwZW5kaW5nIGludml0YXRpb24uXG4gICAqIEFkbWluOiBjYW4gZGVsZXRlIGFueSBpbnZpdGF0aW9uXG4gICAqIE1hbmFnZXI6IGNhbiBvbmx5IGRlbGV0ZSBpbnZpdGF0aW9ucyBmcm9tIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICovXG4gIGFwcC5kZWxldGUoJy9hcGkvaW52aXRhdGlvbnMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBjb25zdCB7IGlkOiBpbnZpdGF0aW9uSWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gZGVsZXRlIGludml0YXRpb25zXG4gICAgICBpZiAoIVsnYWRtaW4nLCAnbWFuYWdlciddLmluY2x1ZGVzKGN1cnJlbnRVc2VyLnJvbGUpKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0luc3VmZmljaWVudCBwZXJtaXNzaW9ucyB0byBkZWxldGUgaW52aXRhdGlvbnMnLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFpbnZpdGF0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBJRCBpcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0lOVkFMSURfUkVRVUVTVCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgdGhlIGludml0YXRpb24gdG8gY2hlY2sgcGVybWlzc2lvbnNcbiAgICAgIGNvbnN0IGludml0YXRpb24gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpbnZpdGF0aW9uSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChpbnZpdGF0aW9uLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIG5vdCBmb3VuZCcsXG4gICAgICAgICAgY29kZTogJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGludml0YXRpb25EYXRhID0gaW52aXRhdGlvblswXTtcblxuICAgICAgLy8gQ2hlY2sgaWYgbWFuYWdlciBoYXMgcGVybWlzc2lvbiB0byBkZWxldGUgdGhpcyBpbnZpdGF0aW9uXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgIGNvbnN0IG1hbmFnZXJPcmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgY29uc3Qgb3JnSWRzID0gbWFuYWdlck9yZ3MubWFwKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG5cbiAgICAgICAgaWYgKCFpbnZpdGF0aW9uRGF0YS5vcmdhbml6YXRpb25JZCB8fCAhb3JnSWRzLmluY2x1ZGVzKGludml0YXRpb25EYXRhLm9yZ2FuaXphdGlvbklkKSkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnWW91IGNhbiBvbmx5IGRlbGV0ZSBpbnZpdGF0aW9ucyBmcm9tIHlvdXIgb3JnYW5pemF0aW9ucycsXG4gICAgICAgICAgICBjb2RlOiAnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBEZWxldGUgdGhlIGludml0YXRpb25cbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaW52aXRhdGlvbklkKSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ludml0YXRpb24gZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBpbnZpdGF0aW9uSWQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgaW52aXRhdGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIGVycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgaW52aXRhdGlvbicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sInZlcnNpb24iOjN9