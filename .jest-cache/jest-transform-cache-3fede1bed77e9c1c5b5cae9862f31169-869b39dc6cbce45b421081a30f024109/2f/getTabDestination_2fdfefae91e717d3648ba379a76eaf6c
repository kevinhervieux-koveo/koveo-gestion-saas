025b19cccc6779639c30edae27df1915
'use strict';
var isDisabled = require('../misc/isDisabled.js');
var isElementType = require('../misc/isElementType.js');
var isVisible = require('../misc/isVisible.js');
var selector = require('./selector.js');
function getTabDestination(activeElement, shift) {
    const document = activeElement.ownerDocument;
    const focusableElements = document.querySelectorAll(selector.FOCUSABLE_SELECTOR);
    const enabledElements = Array.from(focusableElements).filter((el) => el === activeElement || !(Number(el.getAttribute('tabindex')) < 0 || isDisabled.isDisabled(el)));
    // tabindex has no effect if the active element has negative tabindex
    if (Number(activeElement.getAttribute('tabindex')) >= 0) {
        enabledElements.sort((a, b) => {
            const i = Number(a.getAttribute('tabindex'));
            const j = Number(b.getAttribute('tabindex'));
            if (i === j) {
                return 0;
            }
            else if (i === 0) {
                return 1;
            }
            else if (j === 0) {
                return -1;
            }
            return i - j;
        });
    }
    const checkedRadio = {};
    let prunedElements = [
        document.body
    ];
    const activeRadioGroup = isElementType.isElementType(activeElement, 'input', {
        type: 'radio'
    }) ? activeElement.name : undefined;
    enabledElements.forEach((currentElement) => {
        const el = currentElement;
        // For radio groups keep only the active radio
        // If there is no active radio, keep only the checked radio
        // If there is no checked radio, treat like everything else
        if (isElementType.isElementType(el, 'input', {
            type: 'radio'
        }) && el.name) {
            // If the active element is part of the group, add only that
            if (el === activeElement) {
                prunedElements.push(el);
                return;
            }
            else if (el.name === activeRadioGroup) {
                return;
            }
            // If we stumble upon a checked radio, remove the others
            if (el.checked) {
                prunedElements = prunedElements.filter((e) => !isElementType.isElementType(e, 'input', {
                    type: 'radio',
                    name: el.name
                }));
                prunedElements.push(el);
                checkedRadio[el.name] = el;
                return;
            }
            // If we already found the checked one, skip
            if (typeof checkedRadio[el.name] !== 'undefined') {
                return;
            }
        }
        prunedElements.push(el);
    });
    for (let index = prunedElements.findIndex((el) => el === activeElement);;) {
        index += shift ? -1 : 1;
        // loop at overflow
        if (index === prunedElements.length) {
            index = 0;
        }
        else if (index === -1) {
            index = prunedElements.length - 1;
        }
        if (prunedElements[index] === activeElement || prunedElements[index] === document.body || isVisible.isVisible(prunedElements[index])) {
            return prunedElements[index];
        }
    }
}
exports.getTabDestination = getTabDestination;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50L2Rpc3QvY2pzL3V0aWxzL2ZvY3VzL2dldFRhYkRlc3RpbmF0aW9uLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ2xELElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0FBQ3hELElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0FBQ2hELElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUV4QyxTQUFTLGlCQUFpQixDQUFDLGFBQWEsRUFBRSxLQUFLO0lBQzNDLE1BQU0sUUFBUSxHQUFHLGFBQWEsQ0FBQyxhQUFhLENBQUM7SUFDN0MsTUFBTSxpQkFBaUIsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLENBQUM7SUFDakYsTUFBTSxlQUFlLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEVBQUUsRUFBQyxFQUFFLENBQUEsRUFBRSxLQUFLLGFBQWEsSUFBSSxDQUFDLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsR0FBRyxDQUFDLElBQUksVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDcEsscUVBQXFFO0lBQ3JFLElBQUksTUFBTSxDQUFDLGFBQWEsQ0FBQyxZQUFZLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUN0RCxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBQyxFQUFFO1lBQ3pCLE1BQU0sQ0FBQyxHQUFHLE1BQU0sQ0FBQyxDQUFDLENBQUMsWUFB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LEtBQUssS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDO1lBQ3RCLEtBQUssR0FBRyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQztRQUN0QyxDQUFDO1FBQ0QsSUFBSSxjQUFjLENBQUMsS0FBSyxDQUFDLEtBQUssYUFBYSxJQUFJLGNBQWMsQ0FBQyxLQUFLLENBQUMsS0FBSyxRQUFRLENBQUMsSUFBSSxJQUFJLFNBQVMsQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNuSSxPQUFPLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxDQUFDO0lBQ0wsQ0FBQztBQUNMLENBQUM7QUFFRCxPQUFPLENBQUMsaUJBQWlCLEdBQUcsaUJBQWlCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50L2Rpc3QvY2pzL3V0aWxzL2ZvY3VzL2dldFRhYkRlc3RpbmF0aW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIGlzRGlzYWJsZWQgPSByZXF1aXJlKCcuLi9taXNjL2lzRGlzYWJsZWQuanMnKTtcbnZhciBpc0VsZW1lbnRUeXBlID0gcmVxdWlyZSgnLi4vbWlzYy9pc0VsZW1lbnRUeXBlLmpzJyk7XG52YXIgaXNWaXNpYmxlID0gcmVxdWlyZSgnLi4vbWlzYy9pc1Zpc2libGUuanMnKTtcbnZhciBzZWxlY3RvciA9IHJlcXVpcmUoJy4vc2VsZWN0b3IuanMnKTtcblxuZnVuY3Rpb24gZ2V0VGFiRGVzdGluYXRpb24oYWN0aXZlRWxlbWVudCwgc2hpZnQpIHtcbiAgICBjb25zdCBkb2N1bWVudCA9IGFjdGl2ZUVsZW1lbnQub3duZXJEb2N1bWVudDtcbiAgICBjb25zdCBmb2N1c2FibGVFbGVtZW50cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IuRk9DVVNBQkxFX1NFTEVDVE9SKTtcbiAgICBjb25zdCBlbmFibGVkRWxlbWVudHMgPSBBcnJheS5mcm9tKGZvY3VzYWJsZUVsZW1lbnRzKS5maWx0ZXIoKGVsKT0+ZWwgPT09IGFjdGl2ZUVsZW1lbnQgfHwgIShOdW1iZXIoZWwuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKSA8IDAgfHwgaXNEaXNhYmxlZC5pc0Rpc2FibGVkKGVsKSkpO1xuICAgIC8vIHRhYmluZGV4IGhhcyBubyBlZmZlY3QgaWYgdGhlIGFjdGl2ZSBlbGVtZW50IGhhcyBuZWdhdGl2ZSB0YWJpbmRleFxuICAgIGlmIChOdW1iZXIoYWN0aXZlRWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpID49IDApIHtcbiAgICAgICAgZW5hYmxlZEVsZW1lbnRzLnNvcnQoKGEsIGIpPT57XG4gICAgICAgICAgICBjb25zdCBpID0gTnVtYmVyKGEuZ2V0QXR0cmlidXRlKCd0YWJpbmRleCcpKTtcbiAgICAgICAgICAgIGNvbnN0IGogPSBOdW1iZXIoYi5nZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JykpO1xuICAgICAgICAgICAgaWYgKGkgPT09IGopIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoaSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChqID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGkgLSBqO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgY2hlY2tlZFJhZGlvID0ge307XG4gICAgbGV0IHBydW5lZEVsZW1lbnRzID0gW1xuICAgICAgICBkb2N1bWVudC5ib2R5XG4gICAgXTtcbiAgICBjb25zdCBhY3RpdmVSYWRpb0dyb3VwID0gaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGFjdGl2ZUVsZW1lbnQsICdpbnB1dCcsIHtcbiAgICAgICAgdHlwZTogJ3JhZGlvJ1xuICAgIH0pID8gYWN0aXZlRWxlbWVudC5uYW1lIDogdW5kZWZpbmVkO1xuICAgIGVuYWJsZWRFbGVtZW50cy5mb3JFYWNoKChjdXJyZW50RWxlbWVudCk9PntcbiAgICAgICAgY29uc3QgZWwgPSBjdXJyZW50RWxlbWVudDtcbiAgICAgICAgLy8gRm9yIHJhZGlvIGdyb3VwcyBrZWVwIG9ubHkgdGhlIGFjdGl2ZSByYWRpb1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBhY3RpdmUgcmFkaW8sIGtlZXAgb25seSB0aGUgY2hlY2tlZCByYWRpb1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBubyBjaGVja2VkIHJhZGlvLCB0cmVhdCBsaWtlIGV2ZXJ5dGhpbmcgZWxzZVxuICAgICAgICBpZiAoaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGVsLCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAncmFkaW8nXG4gICAgICAgIH0pICYmIGVsLm5hbWUpIHtcbiAgICAgICAgICAgIC8vIElmIHRoZSBhY3RpdmUgZWxlbWVudCBpcyBwYXJ0IG9mIHRoZSBncm91cCwgYWRkIG9ubHkgdGhhdFxuICAgICAgICAgICAgaWYgKGVsID09PSBhY3RpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgcHJ1bmVkRWxlbWVudHMucHVzaChlbCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChlbC5uYW1lID09PSBhY3RpdmVSYWRpb0dyb3VwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSWYgd2Ugc3R1bWJsZSB1cG9uIGEgY2hlY2tlZCByYWRpbywgcmVtb3ZlIHRoZSBvdGhlcnNcbiAgICAgICAgICAgIGlmIChlbC5jaGVja2VkKSB7XG4gICAgICAgICAgICAgICAgcHJ1bmVkRWxlbWVudHMgPSBwcnVuZWRFbGVtZW50cy5maWx0ZXIoKGUpPT4haXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKGUsICdpbnB1dCcsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdyYWRpbycsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBlbC5uYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgICAgICBwcnVuZWRFbGVtZW50cy5wdXNoKGVsKTtcbiAgICAgICAgICAgICAgICBjaGVja2VkUmFkaW9bZWwubmFtZV0gPSBlbDtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiB3ZSBhbHJlYWR5IGZvdW5kIHRoZSBjaGVja2VkIG9uZSwgc2tpcFxuICAgICAgICAgICAgaWYgKHR5cGVvZiBjaGVja2VkUmFkaW9bZWwubmFtZV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBydW5lZEVsZW1lbnRzLnB1c2goZWwpO1xuICAgIH0pO1xuICAgIGZvcihsZXQgaW5kZXggPSBwcnVuZWRFbGVtZW50cy5maW5kSW5kZXgoKGVsKT0+ZWwgPT09IGFjdGl2ZUVsZW1lbnQpOzspe1xuICAgICAgICBpbmRleCArPSBzaGlmdCA/IC0xIDogMTtcbiAgICAgICAgLy8gbG9vcCBhdCBvdmVyZmxvd1xuICAgICAgICBpZiAoaW5kZXggPT09IHBydW5lZEVsZW1lbnRzLmxlbmd0aCkge1xuICAgICAgICAgICAgaW5kZXggPSAwO1xuICAgICAgICB9IGVsc2UgaWYgKGluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgaW5kZXggPSBwcnVuZWRFbGVtZW50cy5sZW5ndGggLSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChwcnVuZWRFbGVtZW50c1tpbmRleF0gPT09IGFjdGl2ZUVsZW1lbnQgfHwgcHJ1bmVkRWxlbWVudHNbaW5kZXhdID09PSBkb2N1bWVudC5ib2R5IHx8IGlzVmlzaWJsZS5pc1Zpc2libGUocHJ1bmVkRWxlbWVudHNbaW5kZXhdKSkge1xuICAgICAgICAgICAgcmV0dXJuIHBydW5lZEVsZW1lbnRzW2luZGV4XTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0cy5nZXRUYWJEZXN0aW5hdGlvbiA9IGdldFRhYkRlc3RpbmF0aW9uO1xuIl0sInZlcnNpb24iOjN9