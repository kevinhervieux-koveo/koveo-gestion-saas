0e6915d734d0980adb05b90d7ae5b127
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = MyBuilding;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = require("react");
const react_query_1 = require("@tanstack/react-query");
const wouter_1 = require("wouter");
const header_1 = require("@/components/layout/header");
const card_1 = require("@/components/ui/card");
const button_1 = require("@/components/ui/button");
const badge_1 = require("@/components/ui/badge");
const label_1 = require("@/components/ui/label");
const lucide_react_1 = require("lucide-react");
const queryClient_1 = require("@/lib/queryClient");
const use_language_1 = require("@/hooks/use-language");
/**
 *
 */
function MyBuilding() {
    const [, navigate] = (0, wouter_1.useLocation)();
    const { t } = (0, use_language_1.useLanguage)();
    const [currentPage, setCurrentPage] = (0, react_1.useState)(1);
    const itemsPerPage = 10;
    // Fetch current user
    const { data: user } = (0, react_query_1.useQuery)({
        queryKey: ['/api/auth/user'],
        queryFn: () => (0, queryClient_1.apiRequest)('GET', '/api/auth/user'),
    });
    // Fetch buildings accessible to the user based on their residences
    const { data: buildingsData, isLoading: isLoadingBuildings, error: buildingsError, } = (0, react_query_1.useQuery)({
        queryKey: ['/api/users/buildings', user?.id],
        queryFn: async () => {
            if (!user?.id) {
                return { buildings: [] };
            }
            const response = await (0, queryClient_1.apiRequest)('GET', `/api/users/${user.id}/buildings`);
            return response.json();
        },
        enabled: !!user?.id,
    });
    const buildings = buildingsData?.buildings || [];
    // Pagination calculations
    const totalPages = Math.ceil(buildings.length / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const currentBuildings = buildings.slice(startIndex, endIndex);
    const handlePreviousPage = () => {
        setCurrentPage((prev) => Math.max(1, prev - 1));
    };
    const handleNextPage = () => {
        setCurrentPage((prev) => Math.min(totalPages, prev + 1));
    };
    const handlePageClick = (page) => {
        setCurrentPage(page);
    };
    const handleViewDocuments = (buildingId) => {
        navigate(`/residents/building/documents?buildingId=${buildingId}`);
    };
    if (isLoadingBuildings) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: t('myBuildings'), subtitle: t('viewBuildingsAccess') }), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsx)("div", { className: 'max-w-4xl mx-auto', children: (0, jsx_runtime_1.jsxs)("div", { className: 'text-center py-8', children: [(0, jsx_runtime_1.jsx)("div", { className: 'animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full mx-auto' }), (0, jsx_runtime_1.jsx)("p", { className: 'text-muted-foreground mt-2', children: "Loading building information..." })] }) }) })] }));
    }
    if (buildings.length === 0) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: t('myBuildings'), subtitle: t('viewBuildingsAccess') }), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsx)("div", { className: 'max-w-4xl mx-auto', children: (0, jsx_runtime_1.jsx)(card_1.Card, { children: (0, jsx_runtime_1.jsxs)(card_1.CardContent, { className: 'p-8 text-center', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Building, { className: 'w-16 h-16 mx-auto text-gray-400 mb-4' }), (0, jsx_runtime_1.jsx)("h3", { className: 'text-lg font-semibold text-gray-600 mb-2', children: t('noBuildingsFound') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-gray-500', children: "You don't have access to any buildings yet." })] }) }) }) })] }));
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: 'My Buildings', subtitle: 'View buildings you have access to' }), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsxs)("div", { className: 'max-w-7xl mx-auto space-y-6', children: [(0, jsx_runtime_1.jsx)("div", { className: 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6', children: currentBuildings.map((building) => ((0, jsx_runtime_1.jsxs)(card_1.Card, { className: 'hover:shadow-lg transition-shadow', children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { children: [(0, jsx_runtime_1.jsxs)(card_1.CardTitle, { className: 'flex items-center gap-2', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Building, { className: 'w-5 h-5' }), building.name] }), (0, jsx_runtime_1.jsx)("div", { className: 'text-sm text-muted-foreground', children: building.organizationName })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { className: 'space-y-4', children: [(0, jsx_runtime_1.jsxs)("div", { className: 'grid grid-cols-1 gap-3', children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('address') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-start gap-2', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.MapPin, { className: 'w-3 h-3 mt-0.5' }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700', children: building.address }), (0, jsx_runtime_1.jsxs)("p", { className: 'text-sm text-gray-700', children: [building.city, ", ", building.province, " ", building.postalCode] })] })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: 'grid grid-cols-2 gap-3', children: [(0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('buildingType') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700 capitalize', children: building.buildingType })] }), building.yearBuilt && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('yearBuilt') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: 'w-3 h-3' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: building.yearBuilt })] })] })), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('totalUnits') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Home, { className: 'w-3 h-3' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: building.totalUnits })] })] }), building.totalFloors && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('totalFloors') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700', children: building.totalFloors })] }))] }), (building.parkingSpaces || building.storageSpaces) && ((0, jsx_runtime_1.jsxs)("div", { className: 'grid grid-cols-2 gap-3', children: [building.parkingSpaces && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('parking') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Car, { className: 'w-3 h-3' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: building.parkingSpaces })] })] })), building.storageSpaces && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('storage') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Package, { className: 'w-3 h-3' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: building.storageSpaces })] })] }))] })), building.managementCompany && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('managementCompany') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700', children: building.managementCompany })] })), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('occupancy') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-2 text-sm', children: [(0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: 'outline', className: 'text-xs', children: [building.occupiedUnits, "/", building.totalUnits, " ", t('units')] }), (0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: building.occupancyRate >= 90
                                                                            ? 'default'
                                                                            : building.occupancyRate >= 70
                                                                                ? 'secondary'
                                                                                : 'destructive', className: 'text-xs', children: [Math.round(building.occupancyRate), "% ", t('occupied')] })] })] }), building.amenities && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('amenities') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex flex-wrap gap-1 mt-1', children: [(() => {
                                                                        try {
                                                                            const amenities = typeof building.amenities === 'string'
                                                                                ? JSON.parse(building.amenities)
                                                                                : building.amenities;
                                                                            return Array.isArray(amenities)
                                                                                ? amenities.slice(0, 3).map((amenity, index) => ((0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: 'outline', className: 'text-xs', children: amenity }, index)))
                                                                                : null;
                                                                        }
                                                                        catch (_e) {
                                                                            return ((0, jsx_runtime_1.jsx)("span", { className: 'text-xs text-muted-foreground', children: t('unableToDisplayAmenities') }));
                                                                        }
                                                                    })(), (() => {
                                                                        try {
                                                                            const amenities = typeof building.amenities === 'string'
                                                                                ? JSON.parse(building.amenities)
                                                                                : building.amenities;
                                                                            if (Array.isArray(amenities) && amenities.length > 3) {
                                                                                return ((0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: 'outline', className: 'text-xs', children: ["+", amenities.length - 3, " ", t('moreAmenities')] }));
                                                                            }
                                                                        }
                                                                        catch (_e) {
                                                                            // Ignore error
                                                                        }
                                                                        return null;
                                                                    })()] })] }))] }), (0, jsx_runtime_1.jsx)("div", { className: 'pt-4 border-t', children: (0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: () => handleViewDocuments(building.id), variant: 'outline', size: 'sm', className: 'w-full justify-start', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: 'w-4 h-4 mr-2' }), t('viewDocumentsButton')] }) })] })] }, building.id))) }), totalPages > 1 && ((0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center justify-center gap-2 mt-8', children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'outline', size: 'sm', onClick: handlePreviousPage, disabled: currentPage === 1, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ChevronLeft, { className: 'h-4 w-4' }), t('previous')] }), (0, jsx_runtime_1.jsx)("div", { className: 'flex gap-1', children: Array.from({ length: Math.min(5, totalPages) }, (_, i) => {
                                        let pageNum;
                                        if (totalPages <= 5) {
                                            pageNum = i + 1;
                                        }
                                        else if (currentPage <= 3) {
                                            pageNum = i + 1;
                                        }
                                        else if (currentPage >= totalPages - 2) {
                                            pageNum = totalPages - 4 + i;
                                        }
                                        else {
                                            pageNum = currentPage - 2 + i;
                                        }
                                        return ((0, jsx_runtime_1.jsx)(button_1.Button, { variant: currentPage === pageNum ? 'default' : 'outline', size: 'sm', onClick: () => handlePageClick(pageNum), children: pageNum }, pageNum));
                                    }) }), (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'outline', size: 'sm', onClick: handleNextPage, disabled: currentPage === totalPages, children: [t('next'), (0, jsx_runtime_1.jsx)(lucide_react_1.ChevronRight, { className: 'h-4 w-4' })] })] })), (0, jsx_runtime_1.jsxs)("div", { className: 'text-center text-sm text-muted-foreground mt-4', children: [t('showing'), " ", startIndex + 1, " to ", Math.min(endIndex, buildings.length), " of ", buildings.length, ' ', t('buildings')] })] }) })] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL3BhZ2VzL3Jlc2lkZW50cy9idWlsZGluZy50c3giLCJtYXBwaW5ncyI6Ijs7QUF5Q0EsNkJBd1ZDOztBQWpZRCxpQ0FBaUM7QUFDakMsdURBQWlEO0FBQ2pELG1DQUFxQztBQUNyQyx1REFBb0Q7QUFDcEQsK0NBQWdGO0FBQ2hGLG1EQUFnRDtBQUNoRCxpREFBOEM7QUFDOUMsaURBQThDO0FBQzlDLCtDQWFzQjtBQUV0QixtREFBK0M7QUFDL0MsdURBQW1EO0FBY25EOztHQUVHO0FBQ0gsU0FBd0IsVUFBVTtJQUNoQyxNQUFNLENBQUMsRUFBRSxRQUFRLENBQUMsR0FBRyxJQUFBLG9CQUFXLEdBQUUsQ0FBQztJQUNuQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEdBQUcsSUFBQSwwQkFBVyxHQUFFLENBQUM7SUFDNUIsTUFBTSxDQUFDLFdBQVcsRUFBRSxjQUFjLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEQsTUFBTSxZQUFZLEdBQUcsRUFBRSxDQUFDO0lBRXhCLHFCQUFxQjtJQUNyQixNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUEsc0JBQVEsRUFBQztRQUM5QixRQUFRLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQztRQUM1QixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBQSx3QkFBVSxFQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBaUI7S0FDbkUsQ0FBQyxDQUFDO0lBRUgsbUVBQW1FO0lBQ25FLE1BQU0sRUFDSixJQUFJLEVBQUUsYUFBYSxFQUNuQixTQUFTLEVBQUUsa0JBQWtCLEVBQzdCLEtBQUssRUFBRSxjQUFjLEdBQ3RCLEdBQUcsSUFBQSxzQkFBUSxFQUdUO1FBQ0QsUUFBUSxFQUFFLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQztRQUM1QyxPQUFPLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEIsSUFBSSxDQUFDLElBQUksRUFBRSxFQUFF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RCxJQUFJLEVBQUMsSUFBSSxFQUNULE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLFlBRXRDLE9BQU8sSUFMSCxPQUFPLENBTUwsQ0FDVixDQUFDO29DQUNKLENBQUMsQ0FBQyxHQUNFLEVBRU4sd0JBQUMsZUFBTSxJQUNMLE9BQU8sRUFBQyxTQUFTLEVBQ2pCLElBQUksRUFBQyxJQUFJLEVBQ1QsT0FBTyxFQUFFLGNBQWMsRUFDdkIsUUFBUSxFQUFFLFdBQVcsS0FBSyxVQUFVLGFBRW5DLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFDVix1QkFBQywyQkFBWSxJQUFDLFNBQVMsRUFBQyxTQUFTLEdBQUcsSUFDN0IsSUFDTCxDQUNQLEVBR0QsaUNBQUssU0FBUyxFQUFDLGdEQUFnRCxhQUM1RCxDQUFDLENBQUMsU0FBUyxDQUFDLE9BQUcsVUFBVSxHQUFHLENBQUMsVUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsRUFBRSxTQUFTLENBQUMsTUFBTSxDQUFDLFVBQU0sU0FBUyxDQUFDLE1BQU0sRUFBRSxHQUFHLEVBQ2xHLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFDWCxJQUNGLEdBQ0YsSUFDRixDQUNQLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvY2xpZW50L3NyYy9wYWdlcy9yZXNpZGVudHMvYnVpbGRpbmcudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlUXVlcnkgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtcXVlcnknO1xuaW1wb3J0IHsgdXNlTG9jYXRpb24gfSBmcm9tICd3b3V0ZXInO1xuaW1wb3J0IHsgSGVhZGVyIH0gZnJvbSAnQC9jb21wb25lbnRzL2xheW91dC9oZWFkZXInO1xuaW1wb3J0IHsgQ2FyZCwgQ2FyZENvbnRlbnQsIENhcmRIZWFkZXIsIENhcmRUaXRsZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9jYXJkJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9idXR0b24nO1xuaW1wb3J0IHsgQmFkZ2UgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvYmFkZ2UnO1xuaW1wb3J0IHsgTGFiZWwgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvbGFiZWwnO1xuaW1wb3J0IHtcbiAgQnVpbGRpbmcsXG4gIE1hcFBpbixcbiAgQ2FsZW5kYXIsXG4gIFVzZXJzLFxuICBQaG9uZSxcbiAgTWFpbCxcbiAgRmlsZVRleHQsXG4gIEhvbWUsXG4gIENhcixcbiAgUGFja2FnZSxcbiAgQ2hldnJvbkxlZnQsXG4gIENoZXZyb25SaWdodCxcbn0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IEJ1aWxkaW5nIGFzIEJ1aWxkaW5nVHlwZSwgQ29udGFjdCB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGFwaVJlcXVlc3QgfSBmcm9tICdAL2xpYi9xdWVyeUNsaWVudCc7XG5pbXBvcnQgeyB1c2VMYW5ndWFnZSB9IGZyb20gJ0AvaG9va3MvdXNlLWxhbmd1YWdlJztcblxuLyoqXG4gKlxuICovXG5pbnRlcmZhY2UgQnVpbGRpbmdXaXRoU3RhdHMgZXh0ZW5kcyBCdWlsZGluZ1R5cGUge1xuICBvcmdhbml6YXRpb25OYW1lOiBzdHJpbmc7XG4gIG9yZ2FuaXphdGlvblR5cGU6IHN0cmluZztcbiAgdG90YWxVbml0czogbnVtYmVyO1xuICBvY2N1cGllZFVuaXRzOiBudW1iZXI7XG4gIG9jY3VwYW5jeVJhdGU6IG51bWJlcjtcbiAgdmFjYW50VW5pdHM6IG51bWJlcjtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNeUJ1aWxkaW5nKCkge1xuICBjb25zdCBbLCBuYXZpZ2F0ZV0gPSB1c2VMb2NhdGlvbigpO1xuICBjb25zdCB7IHQgfSA9IHVzZUxhbmd1YWdlKCk7XG4gIGNvbnN0IFtjdXJyZW50UGFnZSwgc2V0Q3VycmVudFBhZ2VdID0gdXNlU3RhdGUoMSk7XG4gIGNvbnN0IGl0ZW1zUGVyUGFnZSA9IDEwO1xuXG4gIC8vIEZldGNoIGN1cnJlbnQgdXNlclxuICBjb25zdCB7IGRhdGE6IHVzZXIgfSA9IHVzZVF1ZXJ5KHtcbiAgICBxdWVyeUtleTogWycvYXBpL2F1dGgvdXNlciddLFxuICAgIHF1ZXJ5Rm46ICgpID0+IGFwaVJlcXVlc3QoJ0dFVCcsICcvYXBpL2F1dGgvdXNlcicpIGFzIFByb21pc2U8YW55PixcbiAgfSk7XG5cbiAgLy8gRmV0Y2ggYnVpbGRpbmdzIGFjY2Vzc2libGUgdG8gdGhlIHVzZXIgYmFzZWQgb24gdGhlaXIgcmVzaWRlbmNlc1xuICBjb25zdCB7XG4gICAgZGF0YTogYnVpbGRpbmdzRGF0YSxcbiAgICBpc0xvYWRpbmc6IGlzTG9hZGluZ0J1aWxkaW5ncyxcbiAgICBlcnJvcjogYnVpbGRpbmdzRXJyb3IsXG4gIH0gPSB1c2VRdWVyeTx7XG4gICAgYnVpbGRpbmdzOiBCdWlsZGluZ1dpdGhTdGF0c1tdO1xuICAgIG1ldGE/OiBhbnk7XG4gIH0+KHtcbiAgICBxdWVyeUtleTogWycvYXBpL3VzZXJzL2J1aWxkaW5ncycsIHVzZXI/LmlkXSxcbiAgICBxdWVyeUZuOiBhc3luYyAoKSA9PiB7XG4gICAgICBpZiAoIXVzZXI/LmlkKSB7XG4gICAgICAgIHJldHVybiB7IGJ1aWxkaW5nczogW10gfTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYXBpUmVxdWVzdCgnR0VUJywgYC9hcGkvdXNlcnMvJHt1c2VyLmlkfS9idWlsZGluZ3NgKTtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSxcbiAgICBlbmFibGVkOiAhIXVzZXI/LmlkLFxuICB9KTtcblxuICBjb25zdCBidWlsZGluZ3M6IEJ1aWxkaW5nV2l0aFN0YXRzW10gPSBidWlsZGluZ3NEYXRhPy5idWlsZGluZ3MgfHwgW107XG5cbiAgLy8gUGFnaW5hdGlvbiBjYWxjdWxhdGlvbnNcbiAgY29uc3QgdG90YWxQYWdlcyA9IE1hdGguY2VpbChidWlsZGluZ3MubGVuZ3RoIC8gaXRlbXNQZXJQYWdlKTtcbiAgY29uc3Qgc3RhcnRJbmRleCA9IChjdXJyZW50UGFnZSAtIDEpICogaXRlbXNQZXJQYWdlO1xuICBjb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyBpdGVtc1BlclBhZ2U7XG4gIGNvbnN0IGN1cnJlbnRCdWlsZGluZ3MgPSBidWlsZGluZ3Muc2xpY2Uoc3RhcnRJbmRleCwgZW5kSW5kZXgpO1xuXG4gIGNvbnN0IGhhbmRsZVByZXZpb3VzUGFnZSA9ICgpID0+IHtcbiAgICBzZXRDdXJyZW50UGFnZSgocHJldikgPT4gTWF0aC5tYXgoMSwgcHJldiAtIDEpKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVOZXh0UGFnZSA9ICgpID0+IHtcbiAgICBzZXRDdXJyZW50UGFnZSgocHJldikgPT4gTWF0aC5taW4odG90YWxQYWdlcywgcHJldiArIDEpKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVQYWdlQ2xpY2sgPSAocGFnZTogbnVtYmVyKSA9PiB7XG4gICAgc2V0Q3VycmVudFBhZ2UocGFnZSk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlVmlld0RvY3VtZW50cyA9IChidWlsZGluZ0lkOiBzdHJpbmcpID0+IHtcbiAgICBuYXZpZ2F0ZShgL3Jlc2lkZW50cy9idWlsZGluZy9kb2N1bWVudHM/YnVpbGRpbmdJZD0ke2J1aWxkaW5nSWR9YCk7XG4gIH07XG5cbiAgaWYgKGlzTG9hZGluZ0J1aWxkaW5ncykge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleC0xIGZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuJz5cbiAgICAgICAgPEhlYWRlciB0aXRsZT17dCgnbXlCdWlsZGluZ3MnKX0gc3VidGl0bGU9e3QoJ3ZpZXdCdWlsZGluZ3NBY2Nlc3MnKX0gLz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBvdmVyZmxvdy1hdXRvIHAtNic+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9J21heC13LTR4bCBteC1hdXRvJz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSd0ZXh0LWNlbnRlciBweS04Jz5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2FuaW1hdGUtc3BpbiB3LTYgaC02IGJvcmRlci0yIGJvcmRlci1wcmltYXJ5IGJvcmRlci10LXRyYW5zcGFyZW50IHJvdW5kZWQtZnVsbCBteC1hdXRvJz48L2Rpdj5cbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSd0ZXh0LW11dGVkLWZvcmVncm91bmQgbXQtMic+TG9hZGluZyBidWlsZGluZyBpbmZvcm1hdGlvbi4uLjwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBpZiAoYnVpbGRpbmdzLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleC0xIGZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuJz5cbiAgICAgICAgPEhlYWRlciB0aXRsZT17dCgnbXlCdWlsZGluZ3MnKX0gc3VidGl0bGU9e3QoJ3ZpZXdCdWlsZGluZ3NBY2Nlc3MnKX0gLz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBvdmVyZmxvdy1hdXRvIHAtNic+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9J21heC13LTR4bCBteC1hdXRvJz5cbiAgICAgICAgICAgIDxDYXJkPlxuICAgICAgICAgICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSdwLTggdGV4dC1jZW50ZXInPlxuICAgICAgICAgICAgICAgIDxCdWlsZGluZyBjbGFzc05hbWU9J3ctMTYgaC0xNiBteC1hdXRvIHRleHQtZ3JheS00MDAgbWItNCcgLz5cbiAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPSd0ZXh0LWxnIGZvbnQtc2VtaWJvbGQgdGV4dC1ncmF5LTYwMCBtYi0yJz5cbiAgICAgICAgICAgICAgICAgIHt0KCdub0J1aWxkaW5nc0ZvdW5kJyl9XG4gICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtZ3JheS01MDAnPllvdSBkb24ndCBoYXZlIGFjY2VzcyB0byBhbnkgYnVpbGRpbmdzIHlldC48L3A+XG4gICAgICAgICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbic+XG4gICAgICA8SGVhZGVyIHRpdGxlPSdNeSBCdWlsZGluZ3MnIHN1YnRpdGxlPSdWaWV3IGJ1aWxkaW5ncyB5b3UgaGF2ZSBhY2Nlc3MgdG8nIC8+XG5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4LTEgb3ZlcmZsb3ctYXV0byBwLTYnPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbWF4LXctN3hsIG14LWF1dG8gc3BhY2UteS02Jz5cbiAgICAgICAgICB7LyogQnVpbGRpbmcgQ2FyZHMgKi99XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2dyaWQgZ3JpZC1jb2xzLTEgbWQ6Z3JpZC1jb2xzLTIgbGc6Z3JpZC1jb2xzLTMgZ2FwLTYnPlxuICAgICAgICAgICAge2N1cnJlbnRCdWlsZGluZ3MubWFwKChidWlsZGluZykgPT4gKFxuICAgICAgICAgICAgICA8Q2FyZCBrZXk9e2J1aWxkaW5nLmlkfSBjbGFzc05hbWU9J2hvdmVyOnNoYWRvdy1sZyB0cmFuc2l0aW9uLXNoYWRvdyc+XG4gICAgICAgICAgICAgICAgPENhcmRIZWFkZXI+XG4gICAgICAgICAgICAgICAgICA8Q2FyZFRpdGxlIGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTInPlxuICAgICAgICAgICAgICAgICAgICA8QnVpbGRpbmcgY2xhc3NOYW1lPSd3LTUgaC01JyAvPlxuICAgICAgICAgICAgICAgICAgICB7YnVpbGRpbmcubmFtZX1cbiAgICAgICAgICAgICAgICAgIDwvQ2FyZFRpdGxlPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1tdXRlZC1mb3JlZ3JvdW5kJz57YnVpbGRpbmcub3JnYW5pemF0aW9uTmFtZX08L2Rpdj5cbiAgICAgICAgICAgICAgICA8L0NhcmRIZWFkZXI+XG4gICAgICAgICAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT0nc3BhY2UteS00Jz5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdncmlkIGdyaWQtY29scy0xIGdhcC0zJz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPnt0KCdhZGRyZXNzJyl9PC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1zdGFydCBnYXAtMic+XG4gICAgICAgICAgICAgICAgICAgICAgICA8TWFwUGluIGNsYXNzTmFtZT0ndy0zIGgtMyBtdC0wLjUnIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+e2J1aWxkaW5nLmFkZHJlc3N9PC9wPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge2J1aWxkaW5nLmNpdHl9LCB7YnVpbGRpbmcucHJvdmluY2V9IHtidWlsZGluZy5wb3N0YWxDb2RlfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2dyaWQgZ3JpZC1jb2xzLTIgZ2FwLTMnPlxuICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICB7dCgnYnVpbGRpbmdUeXBlJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSd0ZXh0LXNtIHRleHQtZ3JheS03MDAgY2FwaXRhbGl6ZSc+e2J1aWxkaW5nLmJ1aWxkaW5nVHlwZX08L3A+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAge2J1aWxkaW5nLnllYXJCdWlsdCAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0KCd5ZWFyQnVpbHQnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXggaXRlbXMtY2VudGVyIGdhcC0xJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Q2FsZW5kYXIgY2xhc3NOYW1lPSd3LTMgaC0zJyAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ndGV4dC1zbSB0ZXh0LWdyYXktNzAwJz57YnVpbGRpbmcueWVhckJ1aWx0fTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICB7dCgndG90YWxVbml0cycpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxIb21lIGNsYXNzTmFtZT0ndy0zIGgtMycgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSd0ZXh0LXNtIHRleHQtZ3JheS03MDAnPntidWlsZGluZy50b3RhbFVuaXRzfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIHtidWlsZGluZy50b3RhbEZsb29ycyAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0KCd0b3RhbEZsb29ycycpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+e2J1aWxkaW5nLnRvdGFsRmxvb3JzfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIHsoYnVpbGRpbmcucGFya2luZ1NwYWNlcyB8fCBidWlsZGluZy5zdG9yYWdlU3BhY2VzKSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2dyaWQgZ3JpZC1jb2xzLTIgZ2FwLTMnPlxuICAgICAgICAgICAgICAgICAgICAgICAge2J1aWxkaW5nLnBhcmtpbmdTcGFjZXMgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9J3RleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCc+e3QoJ3BhcmtpbmcnKX08L0xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMSc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Q2FyIGNsYXNzTmFtZT0ndy0zIGgtMycgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ndGV4dC1zbSB0ZXh0LWdyYXktNzAwJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2J1aWxkaW5nLnBhcmtpbmdTcGFjZXN9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIHtidWlsZGluZy5zdG9yYWdlU3BhY2VzICYmIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPnt0KCdzdG9yYWdlJyl9PC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTEnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPFBhY2thZ2UgY2xhc3NOYW1lPSd3LTMgaC0zJyAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSd0ZXh0LXNtIHRleHQtZ3JheS03MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YnVpbGRpbmcuc3RvcmFnZVNwYWNlc31cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICApfVxuXG4gICAgICAgICAgICAgICAgICAgIHtidWlsZGluZy5tYW5hZ2VtZW50Q29tcGFueSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9J3RleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHt0KCdtYW5hZ2VtZW50Q29tcGFueScpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0ndGV4dC1zbSB0ZXh0LWdyYXktNzAwJz57YnVpbGRpbmcubWFuYWdlbWVudENvbXBhbnl9PC9wPlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICApfVxuXG4gICAgICAgICAgICAgICAgICAgIHsvKiBPY2N1cGFuY3kgU3RhdHMgKi99XG4gICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgPExhYmVsIGNsYXNzTmFtZT0ndGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNTAwJz57dCgnb2NjdXBhbmN5Jyl9PC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgdGV4dC1zbSc+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD0nb3V0bGluZScgY2xhc3NOYW1lPSd0ZXh0LXhzJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge2J1aWxkaW5nLm9jY3VwaWVkVW5pdHN9L3tidWlsZGluZy50b3RhbFVuaXRzfSB7dCgndW5pdHMnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQmFkZ2U+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QmFkZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyaWFudD17XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVpbGRpbmcub2NjdXBhbmN5UmF0ZSA+PSA5MFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPyAnZGVmYXVsdCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYnVpbGRpbmcub2NjdXBhbmN5UmF0ZSA+PSA3MFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdzZWNvbmRhcnknXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJ2Rlc3RydWN0aXZlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ndGV4dC14cydcbiAgICAgICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge01hdGgucm91bmQoYnVpbGRpbmcub2NjdXBhbmN5UmF0ZSl9JSB7dCgnb2NjdXBpZWQnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvQmFkZ2U+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgICAgIHtidWlsZGluZy5hbWVuaXRpZXMgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPnt0KCdhbWVuaXRpZXMnKX08L0xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXggZmxleC13cmFwIGdhcC0xIG10LTEnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICB7KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW1lbml0aWVzID1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZW9mIGJ1aWxkaW5nLmFtZW5pdGllcyA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UoYnVpbGRpbmcuYW1lbml0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogYnVpbGRpbmcuYW1lbml0aWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYW1lbml0aWVzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IGFtZW5pdGllcy5zbGljZSgwLCAzKS5tYXAoKGFtZW5pdHk6IHN0cmluZywgaW5kZXg6IG51bWJlcikgPT4gKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJhZGdlIGtleT17aW5kZXh9IHZhcmlhbnQ9J291dGxpbmUnIGNsYXNzTmFtZT0ndGV4dC14cyc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHthbWVuaXR5fVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9CYWRnZT5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICApKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoX2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ndGV4dC14cyB0ZXh0LW11dGVkLWZvcmVncm91bmQnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHt0KCd1bmFibGVUb0Rpc3BsYXlBbWVuaXRpZXMnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pKCl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHsoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbWVuaXRpZXMgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgYnVpbGRpbmcuYW1lbml0aWVzID09PSAnc3RyaW5nJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gSlNPTi5wYXJzZShidWlsZGluZy5hbWVuaXRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgOiBidWlsZGluZy5hbWVuaXRpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhbWVuaXRpZXMpICYmIGFtZW5pdGllcy5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPEJhZGdlIHZhcmlhbnQ9J291dGxpbmUnIGNsYXNzTmFtZT0ndGV4dC14cyc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAre2FtZW5pdGllcy5sZW5ndGggLSAzfSB7dCgnbW9yZUFtZW5pdGllcycpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvQmFkZ2U+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoX2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElnbm9yZSBlcnJvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkoKX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdwdC00IGJvcmRlci10Jz5cbiAgICAgICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IGhhbmRsZVZpZXdEb2N1bWVudHMoYnVpbGRpbmcuaWQpfVxuICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9J291dGxpbmUnXG4gICAgICAgICAgICAgICAgICAgICAgc2l6ZT0nc20nXG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSd3LWZ1bGwganVzdGlmeS1zdGFydCdcbiAgICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICAgIDxGaWxlVGV4dCBjbGFzc05hbWU9J3ctNCBoLTQgbXItMicgLz5cbiAgICAgICAgICAgICAgICAgICAgICB7dCgndmlld0RvY3VtZW50c0J1dHRvbicpfVxuICAgICAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICAgICAgICAgIDwvQ2FyZD5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgey8qIFBhZ2luYXRpb24gKi99XG4gICAgICAgICAge3RvdGFsUGFnZXMgPiAxICYmIChcbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtMiBtdC04Jz5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9J291dGxpbmUnXG4gICAgICAgICAgICAgICAgc2l6ZT0nc20nXG4gICAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlUHJldmlvdXNQYWdlfVxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtjdXJyZW50UGFnZSA9PT0gMX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIDxDaGV2cm9uTGVmdCBjbGFzc05hbWU9J2gtNCB3LTQnIC8+XG4gICAgICAgICAgICAgICAge3QoJ3ByZXZpb3VzJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuXG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGdhcC0xJz5cbiAgICAgICAgICAgICAgICB7QXJyYXkuZnJvbSh7IGxlbmd0aDogTWF0aC5taW4oNSwgdG90YWxQYWdlcykgfSwgKF8sIGkpID0+IHtcbiAgICAgICAgICAgICAgICAgIGxldCBwYWdlTnVtO1xuICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsUGFnZXMgPD0gNSkge1xuICAgICAgICAgICAgICAgICAgICBwYWdlTnVtID0gaSArIDE7XG4gICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRQYWdlIDw9IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bSA9IGkgKyAxO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChjdXJyZW50UGFnZSA+PSB0b3RhbFBhZ2VzIC0gMikge1xuICAgICAgICAgICAgICAgICAgICBwYWdlTnVtID0gdG90YWxQYWdlcyAtIDQgKyBpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGFnZU51bSA9IGN1cnJlbnRQYWdlIC0gMiArIGk7XG4gICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICBrZXk9e3BhZ2VOdW19XG4gICAgICAgICAgICAgICAgICAgICAgdmFyaWFudD17Y3VycmVudFBhZ2UgPT09IHBhZ2VOdW0gPyAnZGVmYXVsdCcgOiAnb3V0bGluZSd9XG4gICAgICAgICAgICAgICAgICAgICAgc2l6ZT0nc20nXG4gICAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gaGFuZGxlUGFnZUNsaWNrKHBhZ2VOdW0pfVxuICAgICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgICAge3BhZ2VOdW19XG4gICAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9KX1cbiAgICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9J291dGxpbmUnXG4gICAgICAgICAgICAgICAgc2l6ZT0nc20nXG4gICAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlTmV4dFBhZ2V9XG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2N1cnJlbnRQYWdlID09PSB0b3RhbFBhZ2VzfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3QoJ25leHQnKX1cbiAgICAgICAgICAgICAgICA8Q2hldnJvblJpZ2h0IGNsYXNzTmFtZT0naC00IHctNCcgLz5cbiAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICApfVxuXG4gICAgICAgICAgey8qIFBhZ2UgaW5mbyAqL31cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ndGV4dC1jZW50ZXIgdGV4dC1zbSB0ZXh0LW11dGVkLWZvcmVncm91bmQgbXQtNCc+XG4gICAgICAgICAgICB7dCgnc2hvd2luZycpfSB7c3RhcnRJbmRleCArIDF9IHRvIHtNYXRoLm1pbihlbmRJbmRleCwgYnVpbGRpbmdzLmxlbmd0aCl9IG9mIHtidWlsZGluZ3MubGVuZ3RofXsnICd9XG4gICAgICAgICAgICB7dCgnYnVpbGRpbmdzJyl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59XG4iXSwidmVyc2lvbiI6M30=