06ca89777961ce3a53b78df159cbc3f0
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = createDOMElementFilter;
exports.test = void 0;
/**
 * Source: https://github.com/facebook/jest/blob/e7bb6a1e26ffab90611b2593912df15b69315611/packages/pretty-format/src/plugins/DOMElement.ts
 */
/* eslint-disable -- trying to stay as close to the original as possible */
/* istanbul ignore file */
function escapeHTML(str) {
    return str.replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
// Return empty string if keys is empty.
const printProps = (keys, props, config, indentation, depth, refs, printer) => {
    const indentationNext = indentation + config.indent;
    const colors = config.colors;
    return keys.map(key => {
        const value = props[key];
        let printed = printer(value, config, indentationNext, depth, refs);
        if (typeof value !== 'string') {
            if (printed.indexOf('\n') !== -1) {
                printed = config.spacingOuter + indentationNext + printed + config.spacingOuter + indentation;
            }
            printed = '{' + printed + '}';
        }
        return config.spacingInner + indentation + colors.prop.open + key + colors.prop.close + '=' + colors.value.open + printed + colors.value.close;
    }).join('');
};
// https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType#node_type_constants
const NodeTypeTextNode = 3;
// Return empty string if children is empty.
const printChildren = (children, config, indentation, depth, refs, printer) => children.map(child => {
    const printedChild = typeof child === 'string' ? printText(child, config) : printer(child, config, indentation, depth, refs);
    if (printedChild === '' && typeof child === 'object' && child !== null && child.nodeType !== NodeTypeTextNode) {
        // A plugin serialized this Node to '' meaning we should ignore it.
        return '';
    }
    return config.spacingOuter + indentation + printedChild;
}).join('');
const printText = (text, config) => {
    const contentColor = config.colors.content;
    return contentColor.open + escapeHTML(text) + contentColor.close;
};
const printComment = (comment, config) => {
    const commentColor = config.colors.comment;
    return commentColor.open + '<!--' + escapeHTML(comment) + '-->' + commentColor.close;
};
// Separate the functions to format props, children, and element,
// so a plugin could override a particular function, if needed.
// Too bad, so sad: the traditional (but unnecessary) space
// in a self-closing tagColor requires a second test of printedProps.
const printElement = (type, printedProps, printedChildren, config, indentation) => {
    const tagColor = config.colors.tag;
    return tagColor.open + '<' + type + (printedProps && tagColor.close + printedProps + config.spacingOuter + indentation + tagColor.open) + (printedChildren ? '>' + tagColor.close + printedChildren + config.spacingOuter + indentation + tagColor.open + '</' + type : (printedProps && !config.min ? '' : ' ') + '/') + '>' + tagColor.close;
};
const printElementAsLeaf = (type, config) => {
    const tagColor = config.colors.tag;
    return tagColor.open + '<' + type + tagColor.close + ' â€¦' + tagColor.open + ' />' + tagColor.close;
};
const ELEMENT_NODE = 1;
const TEXT_NODE = 3;
const COMMENT_NODE = 8;
const FRAGMENT_NODE = 11;
const ELEMENT_REGEXP = /^((HTML|SVG)\w*)?Element$/;
const isCustomElement = val => {
    const { tagName } = val;
    return Boolean(typeof tagName === 'string' && tagName.includes('-') || typeof val.hasAttribute === 'function' && val.hasAttribute('is'));
};
const testNode = val => {
    const constructorName = val.constructor.name;
    const { nodeType } = val;
    return nodeType === ELEMENT_NODE && (ELEMENT_REGEXP.test(constructorName) || isCustomElement(val)) || nodeType === TEXT_NODE && constructorName === 'Text' || nodeType === COMMENT_NODE && constructorName === 'Comment' || nodeType === FRAGMENT_NODE && constructorName === 'DocumentFragment';
};
const test = val => (val?.constructor?.name || isCustomElement(val)) && testNode(val);
exports.test = test;
function nodeIsText(node) {
    return node.nodeType === TEXT_NODE;
}
function nodeIsComment(node) {
    return node.nodeType === COMMENT_NODE;
}
function nodeIsFragment(node) {
    return node.nodeType === FRAGMENT_NODE;
}
function createDOMElementFilter(filterNode) {
    return {
        test: val => (val?.constructor?.name || isCustomElement(val)) && testNode(val),
        serialize: (node, config, indentation, depth, refs, printer) => {
            if (nodeIsText(node)) {
                return printText(node.data, config);
            }
            if (nodeIsComment(node)) {
                return printComment(node.data, config);
            }
            const type = nodeIsFragment(node) ? `DocumentFragment` : node.tagName.toLowerCase();
            if (++depth > config.maxDepth) {
                return printElementAsLeaf(type, config);
            }
            return printElement(type, printProps(nodeIsFragment(node) ? [] : Array.from(node.attributes).map(attr => attr.name).sort(), nodeIsFragment(node) ? {} : Array.from(node.attributes).reduce((props, attribute) => {
                props[attribute.name] = attribute.value;
                return props;
            }, {}), config, indentation + config.indent, depth, refs, printer), printChildren(Array.prototype.slice.call(node.childNodes || node.children).filter(filterNode), config, indentation + config.indent, depth, refs, printer), config, indentation);
        }
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9ET01FbGVtZW50RmlsdGVyLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRTtJQUMzQyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUMsQ0FBQztBQUNILE9BQU8sQ0FBQyxPQUFPLEdBQUcsc0JBQXNCLENBQUM7QUFDekMsT0FBTyxDQUFDLElBQUksR0FBRyxLQUFLLENBQUMsQ0FBQztBQUN0Qjs7R0FFRztBQUNILDJFQUEyRTtBQUMzRSwwQkFBMEI7QUFFMUIsU0FBUyxVQUFVLENBQUMsR0FBRztJQUNyQixPQUFPLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDekQsQ0FBQztBQUNELHdDQUF3QztBQUN4QyxNQUFNLFVBQVUsR0FBRyxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxFQUFFO0lBQzVFLE1BQU0sZUFBZSxHQUFHLFdBQVcsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDO0lBQ3BELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUM7SUFDN0IsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ3BCLE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QixJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFDO1FBQ25FLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDOUIsSUFBSSxPQUFPLENBQUMsT0FBTyxDQUFDLElB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QUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxFQUFFO2dCQUM5TSxLQUFLLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxHQUFHLFNBQVMsQ0FBQyxLQUFLLENBQUM7Z0JBQ3hDLE9BQU8sS0FBSyxDQUFDO1lBQ2YsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxFQUFFLGFBQWEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxXQUFXLEdBQUcsTUFBTSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxXQUFXLENBQUMsQ0FBQztRQUN0UCxDQUFDO0tBQ0YsQ0FBQztBQUNKLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9ET01FbGVtZW50RmlsdGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gY3JlYXRlRE9NRWxlbWVudEZpbHRlcjtcbmV4cG9ydHMudGVzdCA9IHZvaWQgMDtcbi8qKlxuICogU291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svamVzdC9ibG9iL2U3YmI2YTFlMjZmZmFiOTA2MTFiMjU5MzkxMmRmMTViNjkzMTU2MTEvcGFja2FnZXMvcHJldHR5LWZvcm1hdC9zcmMvcGx1Z2lucy9ET01FbGVtZW50LnRzXG4gKi9cbi8qIGVzbGludC1kaXNhYmxlIC0tIHRyeWluZyB0byBzdGF5IGFzIGNsb3NlIHRvIHRoZSBvcmlnaW5hbCBhcyBwb3NzaWJsZSAqL1xuLyogaXN0YW5idWwgaWdub3JlIGZpbGUgKi9cblxuZnVuY3Rpb24gZXNjYXBlSFRNTChzdHIpIHtcbiAgcmV0dXJuIHN0ci5yZXBsYWNlKC88L2csICcmbHQ7JykucmVwbGFjZSgvPi9nLCAnJmd0OycpO1xufVxuLy8gUmV0dXJuIGVtcHR5IHN0cmluZyBpZiBrZXlzIGlzIGVtcHR5LlxuY29uc3QgcHJpbnRQcm9wcyA9IChrZXlzLCBwcm9wcywgY29uZmlnLCBpbmRlbnRhdGlvbiwgZGVwdGgsIHJlZnMsIHByaW50ZXIpID0+IHtcbiAgY29uc3QgaW5kZW50YXRpb25OZXh0ID0gaW5kZW50YXRpb24gKyBjb25maWcuaW5kZW50O1xuICBjb25zdCBjb2xvcnMgPSBjb25maWcuY29sb3JzO1xuICByZXR1cm4ga2V5cy5tYXAoa2V5ID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IHByb3BzW2tleV07XG4gICAgbGV0IHByaW50ZWQgPSBwcmludGVyKHZhbHVlLCBjb25maWcsIGluZGVudGF0aW9uTmV4dCwgZGVwdGgsIHJlZnMpO1xuICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKSB7XG4gICAgICBpZiAocHJpbnRlZC5pbmRleE9mKCdcXG4nKSAhPT0gLTEpIHtcbiAgICAgICAgcHJpbnRlZCA9IGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbk5leHQgKyBwcmludGVkICsgY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uO1xuICAgICAgfVxuICAgICAgcHJpbnRlZCA9ICd7JyArIHByaW50ZWQgKyAnfSc7XG4gICAgfVxuICAgIHJldHVybiBjb25maWcuc3BhY2luZ0lubmVyICsgaW5kZW50YXRpb24gKyBjb2xvcnMucHJvcC5vcGVuICsga2V5ICsgY29sb3JzLnByb3AuY2xvc2UgKyAnPScgKyBjb2xvcnMudmFsdWUub3BlbiArIHByaW50ZWQgKyBjb2xvcnMudmFsdWUuY2xvc2U7XG4gIH0pLmpvaW4oJycpO1xufTtcblxuLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL05vZGUvbm9kZVR5cGUjbm9kZV90eXBlX2NvbnN0YW50c1xuY29uc3QgTm9kZVR5cGVUZXh0Tm9kZSA9IDM7XG5cbi8vIFJldHVybiBlbXB0eSBzdHJpbmcgaWYgY2hpbGRyZW4gaXMgZW1wdHkuXG5jb25zdCBwcmludENoaWxkcmVuID0gKGNoaWxkcmVuLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcikgPT4gY2hpbGRyZW4ubWFwKGNoaWxkID0+IHtcbiAgY29uc3QgcHJpbnRlZENoaWxkID0gdHlwZW9mIGNoaWxkID09PSAnc3RyaW5nJyA/IHByaW50VGV4dChjaGlsZCwgY29uZmlnKSA6IHByaW50ZXIoY2hpbGQsIGNvbmZpZywgaW5kZW50YXRpb24sIGRlcHRoLCByZWZzKTtcbiAgaWYgKHByaW50ZWRDaGlsZCA9PT0gJycgJiYgdHlwZW9mIGNoaWxkID09PSAnb2JqZWN0JyAmJiBjaGlsZCAhPT0gbnVsbCAmJiBjaGlsZC5ub2RlVHlwZSAhPT0gTm9kZVR5cGVUZXh0Tm9kZSkge1xuICAgIC8vIEEgcGx1Z2luIHNlcmlhbGl6ZWQgdGhpcyBOb2RlIHRvICcnIG1lYW5pbmcgd2Ugc2hvdWxkIGlnbm9yZSBpdC5cbiAgICByZXR1cm4gJyc7XG4gIH1cbiAgcmV0dXJuIGNvbmZpZy5zcGFjaW5nT3V0ZXIgKyBpbmRlbnRhdGlvbiArIHByaW50ZWRDaGlsZDtcbn0pLmpvaW4oJycpO1xuY29uc3QgcHJpbnRUZXh0ID0gKHRleHQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBjb250ZW50Q29sb3IgPSBjb25maWcuY29sb3JzLmNvbnRlbnQ7XG4gIHJldHVybiBjb250ZW50Q29sb3Iub3BlbiArIGVzY2FwZUhUTUwodGV4dCkgKyBjb250ZW50Q29sb3IuY2xvc2U7XG59O1xuY29uc3QgcHJpbnRDb21tZW50ID0gKGNvbW1lbnQsIGNvbmZpZykgPT4ge1xuICBjb25zdCBjb21tZW50Q29sb3IgPSBjb25maWcuY29sb3JzLmNvbW1lbnQ7XG4gIHJldHVybiBjb21tZW50Q29sb3Iub3BlbiArICc8IS0tJyArIGVzY2FwZUhUTUwoY29tbWVudCkgKyAnLS0+JyArIGNvbW1lbnRDb2xvci5jbG9zZTtcbn07XG5cbi8vIFNlcGFyYXRlIHRoZSBmdW5jdGlvbnMgdG8gZm9ybWF0IHByb3BzLCBjaGlsZHJlbiwgYW5kIGVsZW1lbnQsXG4vLyBzbyBhIHBsdWdpbiBjb3VsZCBvdmVycmlkZSBhIHBhcnRpY3VsYXIgZnVuY3Rpb24sIGlmIG5lZWRlZC5cbi8vIFRvbyBiYWQsIHNvIHNhZDogdGhlIHRyYWRpdGlvbmFsIChidXQgdW5uZWNlc3NhcnkpIHNwYWNlXG4vLyBpbiBhIHNlbGYtY2xvc2luZyB0YWdDb2xvciByZXF1aXJlcyBhIHNlY29uZCB0ZXN0IG9mIHByaW50ZWRQcm9wcy5cbmNvbnN0IHByaW50RWxlbWVudCA9ICh0eXBlLCBwcmludGVkUHJvcHMsIHByaW50ZWRDaGlsZHJlbiwgY29uZmlnLCBpbmRlbnRhdGlvbikgPT4ge1xuICBjb25zdCB0YWdDb2xvciA9IGNvbmZpZy5jb2xvcnMudGFnO1xuICByZXR1cm4gdGFnQ29sb3Iub3BlbiArICc8JyArIHR5cGUgKyAocHJpbnRlZFByb3BzICYmIHRhZ0NvbG9yLmNsb3NlICsgcHJpbnRlZFByb3BzICsgY29uZmlnLnNwYWNpbmdPdXRlciArIGluZGVudGF0aW9uICsgdGFnQ29sb3Iub3BlbikgKyAocHJpbnRlZENoaWxkcmVuID8gJz4nICsgdGFnQ29sb3IuY2xvc2UgKyBwcmludGVkQ2hpbGRyZW4gKyBjb25maWcuc3BhY2luZ091dGVyICsgaW5kZW50YXRpb24gKyB0YWdDb2xvci5vcGVuICsgJzwvJyArIHR5cGUgOiAocHJpbnRlZFByb3BzICYmICFjb25maWcubWluID8gJycgOiAnICcpICsgJy8nKSArICc+JyArIHRhZ0NvbG9yLmNsb3NlO1xufTtcbmNvbnN0IHByaW50RWxlbWVudEFzTGVhZiA9ICh0eXBlLCBjb25maWcpID0+IHtcbiAgY29uc3QgdGFnQ29sb3IgPSBjb25maWcuY29sb3JzLnRhZztcbiAgcmV0dXJuIHRhZ0NvbG9yLm9wZW4gKyAnPCcgKyB0eXBlICsgdGFnQ29sb3IuY2xvc2UgKyAnIOKApicgKyB0YWdDb2xvci5vcGVuICsgJyAvPicgKyB0YWdDb2xvci5jbG9zZTtcbn07XG5jb25zdCBFTEVNRU5UX05PREUgPSAxO1xuY29uc3QgVEVYVF9OT0RFID0gMztcbmNvbnN0IENPTU1FTlRfTk9ERSA9IDg7XG5jb25zdCBGUkFHTUVOVF9OT0RFID0gMTE7XG5jb25zdCBFTEVNRU5UX1JFR0VYUCA9IC9eKChIVE1MfFNWRylcXHcqKT9FbGVtZW50JC87XG5jb25zdCBpc0N1c3RvbUVsZW1lbnQgPSB2YWwgPT4ge1xuICBjb25zdCB7XG4gICAgdGFnTmFtZVxuICB9ID0gdmFsO1xuICByZXR1cm4gQm9vbGVhbih0eXBlb2YgdGFnTmFtZSA9PT0gJ3N0cmluZycgJiYgdGFnTmFtZS5pbmNsdWRlcygnLScpIHx8IHR5cGVvZiB2YWwuaGFzQXR0cmlidXRlID09PSAnZnVuY3Rpb24nICYmIHZhbC5oYXNBdHRyaWJ1dGUoJ2lzJykpO1xufTtcbmNvbnN0IHRlc3ROb2RlID0gdmFsID0+IHtcbiAgY29uc3QgY29uc3RydWN0b3JOYW1lID0gdmFsLmNvbnN0cnVjdG9yLm5hbWU7XG4gIGNvbnN0IHtcbiAgICBub2RlVHlwZVxuICB9ID0gdmFsO1xuICByZXR1cm4gbm9kZVR5cGUgPT09IEVMRU1FTlRfTk9ERSAmJiAoRUxFTUVOVF9SRUdFWFAudGVzdChjb25zdHJ1Y3Rvck5hbWUpIHx8IGlzQ3VzdG9tRWxlbWVudCh2YWwpKSB8fCBub2RlVHlwZSA9PT0gVEVYVF9OT0RFICYmIGNvbnN0cnVjdG9yTmFtZSA9PT0gJ1RleHQnIHx8IG5vZGVUeXBlID09PSBDT01NRU5UX05PREUgJiYgY29uc3RydWN0b3JOYW1lID09PSAnQ29tbWVudCcgfHwgbm9kZVR5cGUgPT09IEZSQUdNRU5UX05PREUgJiYgY29uc3RydWN0b3JOYW1lID09PSAnRG9jdW1lbnRGcmFnbWVudCc7XG59O1xuY29uc3QgdGVzdCA9IHZhbCA9PiAodmFsPy5jb25zdHJ1Y3Rvcj8ubmFtZSB8fCBpc0N1c3RvbUVsZW1lbnQodmFsKSkgJiYgdGVzdE5vZGUodmFsKTtcbmV4cG9ydHMudGVzdCA9IHRlc3Q7XG5mdW5jdGlvbiBub2RlSXNUZXh0KG5vZGUpIHtcbiAgcmV0dXJuIG5vZGUubm9kZVR5cGUgPT09IFRFWFRfTk9ERTtcbn1cbmZ1bmN0aW9uIG5vZGVJc0NvbW1lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gQ09NTUVOVF9OT0RFO1xufVxuZnVuY3Rpb24gbm9kZUlzRnJhZ21lbnQobm9kZSkge1xuICByZXR1cm4gbm9kZS5ub2RlVHlwZSA9PT0gRlJBR01FTlRfTk9ERTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZURPTUVsZW1lbnRGaWx0ZXIoZmlsdGVyTm9kZSkge1xuICByZXR1cm4ge1xuICAgIHRlc3Q6IHZhbCA9PiAodmFsPy5jb25zdHJ1Y3Rvcj8ubmFtZSB8fCBpc0N1c3RvbUVsZW1lbnQodmFsKSkgJiYgdGVzdE5vZGUodmFsKSxcbiAgICBzZXJpYWxpemU6IChub2RlLCBjb25maWcsIGluZGVudGF0aW9uLCBkZXB0aCwgcmVmcywgcHJpbnRlcikgPT4ge1xuICAgICAgaWYgKG5vZGVJc1RleHQobm9kZSkpIHtcbiAgICAgICAgcmV0dXJuIHByaW50VGV4dChub2RlLmRhdGEsIGNvbmZpZyk7XG4gICAgICB9XG4gICAgICBpZiAobm9kZUlzQ29tbWVudChub2RlKSkge1xuICAgICAgICByZXR1cm4gcHJpbnRDb21tZW50KG5vZGUuZGF0YSwgY29uZmlnKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHR5cGUgPSBub2RlSXNGcmFnbWVudChub2RlKSA/IGBEb2N1bWVudEZyYWdtZW50YCA6IG5vZGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKCsrZGVwdGggPiBjb25maWcubWF4RGVwdGgpIHtcbiAgICAgICAgcmV0dXJuIHByaW50RWxlbWVudEFzTGVhZih0eXBlLCBjb25maWcpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHByaW50RWxlbWVudCh0eXBlLCBwcmludFByb3BzKG5vZGVJc0ZyYWdtZW50KG5vZGUpID8gW10gOiBBcnJheS5mcm9tKG5vZGUuYXR0cmlidXRlcykubWFwKGF0dHIgPT4gYXR0ci5uYW1lKS5zb3J0KCksIG5vZGVJc0ZyYWdtZW50KG5vZGUpID8ge30gOiBBcnJheS5mcm9tKG5vZGUuYXR0cmlidXRlcykucmVkdWNlKChwcm9wcywgYXR0cmlidXRlKSA9PiB7XG4gICAgICAgIHByb3BzW2F0dHJpYnV0ZS5uYW1lXSA9IGF0dHJpYnV0ZS52YWx1ZTtcbiAgICAgICAgcmV0dXJuIHByb3BzO1xuICAgICAgfSwge30pLCBjb25maWcsIGluZGVudGF0aW9uICsgY29uZmlnLmluZGVudCwgZGVwdGgsIHJlZnMsIHByaW50ZXIpLCBwcmludENoaWxkcmVuKEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKG5vZGUuY2hpbGROb2RlcyB8fCBub2RlLmNoaWxkcmVuKS5maWx0ZXIoZmlsdGVyTm9kZSksIGNvbmZpZywgaW5kZW50YXRpb24gKyBjb25maWcuaW5kZW50LCBkZXB0aCwgcmVmcywgcHJpbnRlciksIGNvbmZpZywgaW5kZW50YXRpb24pO1xuICAgIH1cbiAgfTtcbn0iXSwidmVyc2lvbiI6M30=