799bf45b31e54b32f7b4f55326449b15
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createGetModifiers = createGetModifiers;
const UI_js_1 = require("../UI.js");
const dateMatchModifiers_js_1 = require("../utils/dateMatchModifiers.js");
/**
 * Creates a function to retrieve the modifiers for a given day.
 *
 * This function calculates both internal and custom modifiers for each day
 * based on the provided calendar days and DayPicker props.
 *
 * @private
 * @param days The array of `CalendarDay` objects to process.
 * @param props The DayPicker props, including modifiers and configuration
 *   options.
 * @param dateLib The date library to use for date manipulation.
 * @returns A function that retrieves the modifiers for a given `CalendarDay`.
 */
function createGetModifiers(days, props, navStart, navEnd, dateLib) {
    const { disabled, hidden, modifiers, showOutsideDays, broadcastCalendar, today, } = props;
    const { isSameDay, isSameMonth, startOfMonth, isBefore, endOfMonth, isAfter, } = dateLib;
    const computedNavStart = navStart && startOfMonth(navStart);
    const computedNavEnd = navEnd && endOfMonth(navEnd);
    const internalModifiersMap = {
        [UI_js_1.DayFlag.focused]: [],
        [UI_js_1.DayFlag.outside]: [],
        [UI_js_1.DayFlag.disabled]: [],
        [UI_js_1.DayFlag.hidden]: [],
        [UI_js_1.DayFlag.today]: [],
    };
    const customModifiersMap = {};
    for (const day of days) {
        const { date, displayMonth } = day;
        const isOutside = Boolean(displayMonth && !isSameMonth(date, displayMonth));
        const isBeforeNavStart = Boolean(computedNavStart && isBefore(date, computedNavStart));
        const isAfterNavEnd = Boolean(computedNavEnd && isAfter(date, computedNavEnd));
        const isDisabled = Boolean(disabled && (0, dateMatchModifiers_js_1.dateMatchModifiers)(date, disabled, dateLib));
        const isHidden = Boolean(hidden && (0, dateMatchModifiers_js_1.dateMatchModifiers)(date, hidden, dateLib)) ||
            isBeforeNavStart ||
            isAfterNavEnd ||
            // Broadcast calendar will show outside days as default
            (!broadcastCalendar && !showOutsideDays && isOutside) ||
            (broadcastCalendar && showOutsideDays === false && isOutside);
        const isToday = isSameDay(date, today ?? dateLib.today());
        if (isOutside)
            internalModifiersMap.outside.push(day);
        if (isDisabled)
            internalModifiersMap.disabled.push(day);
        if (isHidden)
            internalModifiersMap.hidden.push(day);
        if (isToday)
            internalModifiersMap.today.push(day);
        // Add custom modifiers
        if (modifiers) {
            Object.keys(modifiers).forEach((name) => {
                const modifierValue = modifiers?.[name];
                const isMatch = modifierValue
                    ? (0, dateMatchModifiers_js_1.dateMatchModifiers)(date, modifierValue, dateLib)
                    : false;
                if (!isMatch)
                    return;
                if (customModifiersMap[name]) {
                    customModifiersMap[name].push(day);
                }
                else {
                    customModifiersMap[name] = [day];
                }
            });
        }
    }
    return (day) => {
        // Initialize all the modifiers to false
        const dayFlags = {
            [UI_js_1.DayFlag.focused]: false,
            [UI_js_1.DayFlag.disabled]: false,
            [UI_js_1.DayFlag.hidden]: false,
            [UI_js_1.DayFlag.outside]: false,
            [UI_js_1.DayFlag.today]: false,
        };
        const customModifiers = {};
        // Find the modifiers for the given day
        for (const name in internalModifiersMap) {
            const days = internalModifiersMap[name];
            dayFlags[name] = days.some((d) => d === day);
        }
        for (const name in customModifiersMap) {
            customModifiers[name] = customModifiersMap[name].some((d) => d === day);
        }
        return {
            ...dayFlags,
            // custom modifiers should override all the previous ones
            ...customModifiers,
        };
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvcmVhY3QtZGF5LXBpY2tlci9kaXN0L2Nqcy9oZWxwZXJzL2NyZWF0ZUdldE1vZGlmaWVycy5qcyIsIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUFDYixNQUFNLENBQUMsY0FBYyxDQUFDLE9BQU8sRUFBRSxZQUFZLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUM5RCxPQUFPLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7QUFDaEQsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ3BDLE1BQU0sdUJBQXVCLEdBQUcsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDMUU7Ozs7Ozs7Ozs7OztHQVlHO0FBQ0gsU0FBUyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsT0FBTztJQUM5RCxNQUFNLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsZUFBZSxFQUFFLGlCQUFpQixFQUFFLEtBQUssR0FBRyxHQUFHLEtBQUssQ0FBQztJQUMxRixNQUFNLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLFVBQVUsRUFBRSxPQUFPLEdBQUcsR0FBRyxPQUFPLENBQUM7SUFDekYsTUFBTSxnQkFBZ0IsR0FBRyxRQUFRLElBQUksWUFBWSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzVELE1BQU0sY0FBYyxHQUFHLE1BQU0sSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUM7SUFDcEQsTUFBTSxvQkFBb0IsR0FBRztRQUN6QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRTtRQUM3QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsRUFBRTtRQUM3QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRTtRQUM5QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRTtRQUM1QixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRTtLQUM5QixDQUFDO0lBQ0YsTUFBTSxrQkFBa0IsR0FBRyxFQUFFLENBQUM7SUFDOUIsS0FBSyxNQUFNLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztRQUNyQixNQUFNLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxHQUFHLEdBQUcsQ0FBQztRQUNuQyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsWUFBWSxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFDO1FBQzVFLE1BQU0sZ0JBQWdCLEdBQUcsT0FBTyxDQUFDLGdCQUFnQixJQUFJLFFBQVEsQ0FBQyxJQUFJLEVBQUUsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDO1FBQ3ZGLE1BQU0sYUFBYSxHQUFHLE9BQU8sQ0FBQyxjQUFjLElBQUksT0FBTyxDQUFDLElBQUksRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDO1FBQy9FLE1BQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyxRQUFRLElBQUksQ0FBQyxDQUFDLEVBQUUsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDakgsTUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsRUFBRSx1QkFBdUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLElBQUksRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLENBQUM7WUFDdEcsZ0JBQWdCO1lBQ2hCLGFBQWE7WUFDYix1REFBdUQ7WUFDdkQsQ0FBQyxDQUFDLGlCQUFpQixJQUFJLENBQUMsZUFBZSxJQUFJLFNBQVMsQ0FBQztZQUNyRCxDQUFDLGlCQUFpQixJQUFJLGVBQWUsS0FBSyxLQUFLLElBQUksU0FBUyxDQUFDLENBQUM7UUFDbEUsTUFBTSxPQUFPLEdBQUcsU0FBUyxDQUFDLElBQUksRUFBRSxLQUFLLElBQUksT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7UUFDMUQsSUFBSSxTQUFTO1lBQ1Qsb0JBQW9CLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUMzQyxJQUFJLFVBQVU7WUFDVixvQkFBb0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLElBQUksUUFBUTtZQUNSLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDMUMsSUFBSSxPQUFPO1lBQ1Asb0JBQW9CLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6Qyx1QkFBdUI7UUFDdkIsSUFBSSxTQUFTLEVBQUUsQ0FBQztZQUNaLE1BQU0sQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ3BDLE1BQU0sYUFBYSxHQUFHLFNBQVMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUN4QyxNQUFNLE9BQU8sR0FBRyxhQUFhO29CQUN6QixDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxJQUFJLEVBQUUsYUFBYSxFQUFFLE9BQU8sQ0FBQztvQkFDL0UsQ0FBQyxDQUFDLEtBQUssQ0FBQztnQkFDWixJQUFJLENBQUMsT0FBTztvQkFDUixPQUFPO2dCQUNYLElBQUksa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztvQkFDM0Isa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUN2QyxDQUFDO3FCQUNJLENBQUM7b0JBQ0Ysa0JBQWtCLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDckMsQ0FBQztZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQztJQUNMLENBQUM7SUFDRCxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUU7UUFDWCx3Q0FBd0M7UUFDeEMsTUFBTSxRQUFRLEdBQUc7WUFDYixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSztZQUNoQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDLEVBQUUsS0FBSztZQUNqQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsS0FBSztZQUMvQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsS0FBSztZQUNoQyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLEVBQUUsS0FBSztTQUNqQyxDQUFDO1FBQ0YsTUFBTSxlQUFlLEdBQUcsRUFBRSxDQUFDO1FBQzNCLHVDQUF1QztRQUN2QyxLQUFLLE1BQU0sSUFBSSxJQUFJLG9CQUFvQixFQUFFLENBQUM7WUFDdEMsTUFBTSxJQUFJLEdBQUcsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDeEMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNqRCxDQUFDO1FBQ0QsS0FBSyxNQUFNLElBQUksSUFBSSxrQkFBa0IsRUFBRSxDQUFDO1lBQ3BDLGVBQWUsQ0FBQyxJQUFJLENBQUMsR0FBRyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUM1RSxDQUFDO1FBQ0QsT0FBTztZQUNILEdBQUcsUUFBUTtZQUNYLHlEQUF5RDtZQUN6RCxHQUFHLGVBQWU7U0FDckIsQ0FBQztJQUNOLENBQUMsQ0FBQztBQUNOLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvcmVhY3QtZGF5LXBpY2tlci9kaXN0L2Nqcy9oZWxwZXJzL2NyZWF0ZUdldE1vZGlmaWVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMuY3JlYXRlR2V0TW9kaWZpZXJzID0gY3JlYXRlR2V0TW9kaWZpZXJzO1xuY29uc3QgVUlfanNfMSA9IHJlcXVpcmUoXCIuLi9VSS5qc1wiKTtcbmNvbnN0IGRhdGVNYXRjaE1vZGlmaWVyc19qc18xID0gcmVxdWlyZShcIi4uL3V0aWxzL2RhdGVNYXRjaE1vZGlmaWVycy5qc1wiKTtcbi8qKlxuICogQ3JlYXRlcyBhIGZ1bmN0aW9uIHRvIHJldHJpZXZlIHRoZSBtb2RpZmllcnMgZm9yIGEgZ2l2ZW4gZGF5LlxuICpcbiAqIFRoaXMgZnVuY3Rpb24gY2FsY3VsYXRlcyBib3RoIGludGVybmFsIGFuZCBjdXN0b20gbW9kaWZpZXJzIGZvciBlYWNoIGRheVxuICogYmFzZWQgb24gdGhlIHByb3ZpZGVkIGNhbGVuZGFyIGRheXMgYW5kIERheVBpY2tlciBwcm9wcy5cbiAqXG4gKiBAcHJpdmF0ZVxuICogQHBhcmFtIGRheXMgVGhlIGFycmF5IG9mIGBDYWxlbmRhckRheWAgb2JqZWN0cyB0byBwcm9jZXNzLlxuICogQHBhcmFtIHByb3BzIFRoZSBEYXlQaWNrZXIgcHJvcHMsIGluY2x1ZGluZyBtb2RpZmllcnMgYW5kIGNvbmZpZ3VyYXRpb25cbiAqICAgb3B0aW9ucy5cbiAqIEBwYXJhbSBkYXRlTGliIFRoZSBkYXRlIGxpYnJhcnkgdG8gdXNlIGZvciBkYXRlIG1hbmlwdWxhdGlvbi5cbiAqIEByZXR1cm5zIEEgZnVuY3Rpb24gdGhhdCByZXRyaWV2ZXMgdGhlIG1vZGlmaWVycyBmb3IgYSBnaXZlbiBgQ2FsZW5kYXJEYXlgLlxuICovXG5mdW5jdGlvbiBjcmVhdGVHZXRNb2RpZmllcnMoZGF5cywgcHJvcHMsIG5hdlN0YXJ0LCBuYXZFbmQsIGRhdGVMaWIpIHtcbiAgICBjb25zdCB7IGRpc2FibGVkLCBoaWRkZW4sIG1vZGlmaWVycywgc2hvd091dHNpZGVEYXlzLCBicm9hZGNhc3RDYWxlbmRhciwgdG9kYXksIH0gPSBwcm9wcztcbiAgICBjb25zdCB7IGlzU2FtZURheSwgaXNTYW1lTW9udGgsIHN0YXJ0T2ZNb250aCwgaXNCZWZvcmUsIGVuZE9mTW9udGgsIGlzQWZ0ZXIsIH0gPSBkYXRlTGliO1xuICAgIGNvbnN0IGNvbXB1dGVkTmF2U3RhcnQgPSBuYXZTdGFydCAmJiBzdGFydE9mTW9udGgobmF2U3RhcnQpO1xuICAgIGNvbnN0IGNvbXB1dGVkTmF2RW5kID0gbmF2RW5kICYmIGVuZE9mTW9udGgobmF2RW5kKTtcbiAgICBjb25zdCBpbnRlcm5hbE1vZGlmaWVyc01hcCA9IHtcbiAgICAgICAgW1VJX2pzXzEuRGF5RmxhZy5mb2N1c2VkXTogW10sXG4gICAgICAgIFtVSV9qc18xLkRheUZsYWcub3V0c2lkZV06IFtdLFxuICAgICAgICBbVUlfanNfMS5EYXlGbGFnLmRpc2FibGVkXTogW10sXG4gICAgICAgIFtVSV9qc18xLkRheUZsYWcuaGlkZGVuXTogW10sXG4gICAgICAgIFtVSV9qc18xLkRheUZsYWcudG9kYXldOiBbXSxcbiAgICB9O1xuICAgIGNvbnN0IGN1c3RvbU1vZGlmaWVyc01hcCA9IHt9O1xuICAgIGZvciAoY29uc3QgZGF5IG9mIGRheXMpIHtcbiAgICAgICAgY29uc3QgeyBkYXRlLCBkaXNwbGF5TW9udGggfSA9IGRheTtcbiAgICAgICAgY29uc3QgaXNPdXRzaWRlID0gQm9vbGVhbihkaXNwbGF5TW9udGggJiYgIWlzU2FtZU1vbnRoKGRhdGUsIGRpc3BsYXlNb250aCkpO1xuICAgICAgICBjb25zdCBpc0JlZm9yZU5hdlN0YXJ0ID0gQm9vbGVhbihjb21wdXRlZE5hdlN0YXJ0ICYmIGlzQmVmb3JlKGRhdGUsIGNvbXB1dGVkTmF2U3RhcnQpKTtcbiAgICAgICAgY29uc3QgaXNBZnRlck5hdkVuZCA9IEJvb2xlYW4oY29tcHV0ZWROYXZFbmQgJiYgaXNBZnRlcihkYXRlLCBjb21wdXRlZE5hdkVuZCkpO1xuICAgICAgICBjb25zdCBpc0Rpc2FibGVkID0gQm9vbGVhbihkaXNhYmxlZCAmJiAoMCwgZGF0ZU1hdGNoTW9kaWZpZXJzX2pzXzEuZGF0ZU1hdGNoTW9kaWZpZXJzKShkYXRlLCBkaXNhYmxlZCwgZGF0ZUxpYikpO1xuICAgICAgICBjb25zdCBpc0hpZGRlbiA9IEJvb2xlYW4oaGlkZGVuICYmICgwLCBkYXRlTWF0Y2hNb2RpZmllcnNfanNfMS5kYXRlTWF0Y2hNb2RpZmllcnMpKGRhdGUsIGhpZGRlbiwgZGF0ZUxpYikpIHx8XG4gICAgICAgICAgICBpc0JlZm9yZU5hdlN0YXJ0IHx8XG4gICAgICAgICAgICBpc0FmdGVyTmF2RW5kIHx8XG4gICAgICAgICAgICAvLyBCcm9hZGNhc3QgY2FsZW5kYXIgd2lsbCBzaG93IG91dHNpZGUgZGF5cyBhcyBkZWZhdWx0XG4gICAgICAgICAgICAoIWJyb2FkY2FzdENhbGVuZGFyICYmICFzaG93T3V0c2lkZURheXMgJiYgaXNPdXRzaWRlKSB8fFxuICAgICAgICAgICAgKGJyb2FkY2FzdENhbGVuZGFyICYmIHNob3dPdXRzaWRlRGF5cyA9PT0gZmFsc2UgJiYgaXNPdXRzaWRlKTtcbiAgICAgICAgY29uc3QgaXNUb2RheSA9IGlzU2FtZURheShkYXRlLCB0b2RheSA/PyBkYXRlTGliLnRvZGF5KCkpO1xuICAgICAgICBpZiAoaXNPdXRzaWRlKVxuICAgICAgICAgICAgaW50ZXJuYWxNb2RpZmllcnNNYXAub3V0c2lkZS5wdXNoKGRheSk7XG4gICAgICAgIGlmIChpc0Rpc2FibGVkKVxuICAgICAgICAgICAgaW50ZXJuYWxNb2RpZmllcnNNYXAuZGlzYWJsZWQucHVzaChkYXkpO1xuICAgICAgICBpZiAoaXNIaWRkZW4pXG4gICAgICAgICAgICBpbnRlcm5hbE1vZGlmaWVyc01hcC5oaWRkZW4ucHVzaChkYXkpO1xuICAgICAgICBpZiAoaXNUb2RheSlcbiAgICAgICAgICAgIGludGVybmFsTW9kaWZpZXJzTWFwLnRvZGF5LnB1c2goZGF5KTtcbiAgICAgICAgLy8gQWRkIGN1c3RvbSBtb2RpZmllcnNcbiAgICAgICAgaWYgKG1vZGlmaWVycykge1xuICAgICAgICAgICAgT2JqZWN0LmtleXMobW9kaWZpZXJzKS5mb3JFYWNoKChuYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbW9kaWZpZXJWYWx1ZSA9IG1vZGlmaWVycz8uW25hbWVdO1xuICAgICAgICAgICAgICAgIGNvbnN0IGlzTWF0Y2ggPSBtb2RpZmllclZhbHVlXG4gICAgICAgICAgICAgICAgICAgID8gKDAsIGRhdGVNYXRjaE1vZGlmaWVyc19qc18xLmRhdGVNYXRjaE1vZGlmaWVycykoZGF0ZSwgbW9kaWZpZXJWYWx1ZSwgZGF0ZUxpYilcbiAgICAgICAgICAgICAgICAgICAgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZiAoIWlzTWF0Y2gpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICBpZiAoY3VzdG9tTW9kaWZpZXJzTWFwW25hbWVdKSB7XG4gICAgICAgICAgICAgICAgICAgIGN1c3RvbU1vZGlmaWVyc01hcFtuYW1lXS5wdXNoKGRheSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjdXN0b21Nb2RpZmllcnNNYXBbbmFtZV0gPSBbZGF5XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gKGRheSkgPT4ge1xuICAgICAgICAvLyBJbml0aWFsaXplIGFsbCB0aGUgbW9kaWZpZXJzIHRvIGZhbHNlXG4gICAgICAgIGNvbnN0IGRheUZsYWdzID0ge1xuICAgICAgICAgICAgW1VJX2pzXzEuRGF5RmxhZy5mb2N1c2VkXTogZmFsc2UsXG4gICAgICAgICAgICBbVUlfanNfMS5EYXlGbGFnLmRpc2FibGVkXTogZmFsc2UsXG4gICAgICAgICAgICBbVUlfanNfMS5EYXlGbGFnLmhpZGRlbl06IGZhbHNlLFxuICAgICAgICAgICAgW1VJX2pzXzEuRGF5RmxhZy5vdXRzaWRlXTogZmFsc2UsXG4gICAgICAgICAgICBbVUlfanNfMS5EYXlGbGFnLnRvZGF5XTogZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGN1c3RvbU1vZGlmaWVycyA9IHt9O1xuICAgICAgICAvLyBGaW5kIHRoZSBtb2RpZmllcnMgZm9yIHRoZSBnaXZlbiBkYXlcbiAgICAgICAgZm9yIChjb25zdCBuYW1lIGluIGludGVybmFsTW9kaWZpZXJzTWFwKSB7XG4gICAgICAgICAgICBjb25zdCBkYXlzID0gaW50ZXJuYWxNb2RpZmllcnNNYXBbbmFtZV07XG4gICAgICAgICAgICBkYXlGbGFnc1tuYW1lXSA9IGRheXMuc29tZSgoZCkgPT4gZCA9PT0gZGF5KTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IG5hbWUgaW4gY3VzdG9tTW9kaWZpZXJzTWFwKSB7XG4gICAgICAgICAgICBjdXN0b21Nb2RpZmllcnNbbmFtZV0gPSBjdXN0b21Nb2RpZmllcnNNYXBbbmFtZV0uc29tZSgoZCkgPT4gZCA9PT0gZGF5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4uZGF5RmxhZ3MsXG4gICAgICAgICAgICAvLyBjdXN0b20gbW9kaWZpZXJzIHNob3VsZCBvdmVycmlkZSBhbGwgdGhlIHByZXZpb3VzIG9uZXNcbiAgICAgICAgICAgIC4uLmN1c3RvbU1vZGlmaWVycyxcbiAgICAgICAgfTtcbiAgICB9O1xufVxuIl0sInZlcnNpb24iOjN9