0d47f57db6673a41c3cb693c9117e523
"use strict";
/**
 * @file Demand Submission Integration Tests
 * @description Comprehensive tests for the entire demand submission workflow
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const db_1 = require("../../server/db");
const schema_1 = require("../../shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
// Create test app instance
function createTestApp() {
    const express = require('express');
    const app = express();
    // Apply middleware
    app.use(express.json());
    // Import and setup routes
    const { registerRoutes } = require('../../server/routes');
    registerRoutes(app);
    return app;
}
(0, globals_1.describe)('Demand Submission Integration Tests', () => {
    let app;
    let testUser;
    let testBuilding;
    let testResidence;
    let testOrganization;
    let authCookie;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Create test organization
        const orgResult = await db_1.db.insert(schema_1.organizations).values({
            name: 'Test Organization',
            type: 'residential',
            address: '123 Test St',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H1H 1H1',
            isActive: true,
        }).returning();
        testOrganization = orgResult[0];
        // Create test building
        const buildingResult = await db_1.db.insert(schema_1.buildings).values({
            name: 'Test Building',
            address: '456 Test Ave',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H2H 2H2',
            buildingType: 'condo',
            organizationId: testOrganization.id,
            totalUnits: 10,
            isActive: true,
        }).returning();
        testBuilding = buildingResult[0];
        // Create test residence
        const residenceResult = await db_1.db.insert(schema_1.residences).values({
            buildingId: testBuilding.id,
            unitNumber: '101',
            floor: 1,
            squareFootage: '1000',
            bedrooms: 2,
            bathrooms: '1',
            balcony: false,
            isActive: true,
        }).returning();
        testResidence = residenceResult[0];
        // Create test user
        const userResult = await db_1.db.insert(schema_1.users).values({
            username: 'testuser',
            firstName: 'Test',
            lastName: 'User',
            email: 'test@example.com',
            password: 'hashed_password',
            role: 'resident',
            isActive: true,
        }).returning();
        testUser = userResult[0];
        // Associate user with residence
        await db_1.db.insert(schema_1.userResidences).values({
            userId: testUser.id,
            residenceId: testResidence.id,
            relationshipType: 'resident',
            startDate: new Date().toISOString().split('T')[0],
            isActive: true,
        });
        // Mock authentication
        authCookie = 'test-session-cookie';
    });
    (0, globals_1.afterEach)(async () => {
        // Clean up test data
        try {
            await db_1.db.delete(schema_1.userResidences).where((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, testUser.id));
            await db_1.db.delete(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.submitterId, testUser.id));
            await db_1.db.delete(schema_1.users).where((0, drizzle_orm_1.eq)(schema_1.users.id, testUser.id));
            await db_1.db.delete(schema_1.residences).where((0, drizzle_orm_1.eq)(schema_1.residences.id, testResidence.id));
            await db_1.db.delete(schema_1.buildings).where((0, drizzle_orm_1.eq)(schema_1.buildings.id, testBuilding.id));
            await db_1.db.delete(schema_1.organizations).where((0, drizzle_orm_1.eq)(schema_1.organizations.id, testOrganization.id));
        }
        catch (error) {
            console.error('Cleanup error:', error);
        }
    });
    (0, globals_1.describe)('POST /api/demands', () => {
        (0, globals_1.it)('should successfully create a demand with all fields provided', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Water leak in bathroom ceiling',
                buildingId: testBuilding.id,
                residenceId: testResidence.id,
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                type: 'maintenance',
                description: 'Water leak in bathroom ceiling',
                buildingId: testBuilding.id,
                residenceId: testResidence.id,
                submitterId: testUser.id,
                status: 'submitted',
            });
            (0, globals_1.expect)(response.body.id).toBeDefined();
            (0, globals_1.expect)(response.body.createdAt).toBeDefined();
        });
        (0, globals_1.it)('should auto-populate building and residence from user data when not provided', async () => {
            const demandData = {
                type: 'complaint',
                description: 'Noise complaint from upstairs neighbor',
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                type: 'complaint',
                description: 'Noise complaint from upstairs neighbor',
                buildingId: testBuilding.id,
                residenceId: testResidence.id,
                submitterId: testUser.id,
                status: 'submitted',
            });
        });
        (0, globals_1.it)('should accept only buildingId and auto-populate residenceId', async () => {
            const demandData = {
                type: 'information',
                description: 'Question about building policies',
                buildingId: testBuilding.id,
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                type: 'information',
                description: 'Question about building policies',
                buildingId: testBuilding.id,
                residenceId: testResidence.id,
                submitterId: testUser.id,
                status: 'submitted',
            });
        });
        (0, globals_1.it)('should accept only residenceId and auto-populate buildingId', async () => {
            const demandData = {
                type: 'other',
                description: 'General inquiry about residence',
                residenceId: testResidence.id,
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                type: 'other',
                description: 'General inquiry about residence',
                buildingId: testBuilding.id,
                residenceId: testResidence.id,
                submitterId: testUser.id,
                status: 'submitted',
            });
        });
        (0, globals_1.it)('should require authentication', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Test demand without auth',
            };
            await (0, supertest_1.default)(app)
                .post('/api/demands')
                .send(demandData)
                .expect(401);
        });
        (0, globals_1.it)('should validate required fields', async () => {
            const invalidDemands = [
                { type: 'maintenance' }, // Missing description
                { description: 'Test' }, // Missing type
                { type: 'invalid_type', description: 'Test' }, // Invalid type
                { type: 'maintenance', description: 'Short' }, // Description too short
            ];
            for (const invalidDemand of invalidDemands) {
                await (0, supertest_1.default)(app)
                    .post('/api/demands')
                    .set('Cookie', authCookie)
                    .send(invalidDemand)
                    .expect(400);
            }
        });
        (0, globals_1.it)('should handle assignation fields properly', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Maintenance request with assignation',
                assignationBuildingId: testBuilding.id,
                assignationResidenceId: testResidence.id,
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                type: 'maintenance',
                description: 'Maintenance request with assignation',
                assignationBuildingId: testBuilding.id,
                assignationResidenceId: testResidence.id,
                submitterId: testUser.id,
                status: 'submitted',
            });
        });
        (0, globals_1.it)('should handle special characters in description', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Réparation nécessaire avec caractères spéciaux: éàùç! 🏠',
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body.description).toBe('Réparation nécessaire avec caractères spéciaux: éàùç! 🏠');
        });
        (0, globals_1.it)('should default to submitted status when not provided', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Test demand without status',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body.status).toBe('submitted');
        });
        (0, globals_1.it)('should validate description length boundaries', async () => {
            const validMinDescription = 'a'.repeat(10); // Minimum valid
            const validMaxDescription = 'a'.repeat(2000); // Maximum valid
            const invalidShortDescription = 'a'.repeat(9); // Too short
            const invalidLongDescription = 'a'.repeat(2001); // Too long
            // Valid cases
            for (const description of [validMinDescription, validMaxDescription]) {
                await (0, supertest_1.default)(app)
                    .post('/api/demands')
                    .set('Cookie', authCookie)
                    .send({
                    type: 'maintenance',
                    description,
                })
                    .expect(201);
            }
            // Invalid cases
            for (const description of [invalidShortDescription, invalidLongDescription]) {
                await (0, supertest_1.default)(app)
                    .post('/api/demands')
                    .set('Cookie', authCookie)
                    .send({
                    type: 'maintenance',
                    description,
                })
                    .expect(400);
            }
        });
    });
    (0, globals_1.describe)('GET /api/demands', () => {
        (0, globals_1.it)('should retrieve user demands after creation', async () => {
            // Create a demand first
            const demandData = {
                type: 'maintenance',
                description: 'Test demand for retrieval',
                status: 'submitted',
            };
            const createResponse = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            // Retrieve demands
            const getResponse = await (0, supertest_1.default)(app)
                .get('/api/demands')
                .set('Cookie', authCookie)
                .expect(200);
            (0, globals_1.expect)(getResponse.body).toBeInstanceOf(Array);
            (0, globals_1.expect)(getResponse.body.length).toBeGreaterThan(0);
            const retrievedDemand = getResponse.body.find((d) => d.id === createResponse.body.id);
            (0, globals_1.expect)(retrievedDemand).toMatchObject({
                type: 'maintenance',
                description: 'Test demand for retrieval',
                submitterId: testUser.id,
                status: 'submitted',
            });
        });
        (0, globals_1.it)('should include related data in demand retrieval', async () => {
            // Create a demand
            await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send({
                type: 'maintenance',
                description: 'Test demand with relations',
            })
                .expect(201);
            // Retrieve demands
            const response = await (0, supertest_1.default)(app)
                .get('/api/demands')
                .set('Cookie', authCookie)
                .expect(200);
            (0, globals_1.expect)(response.body.length).toBeGreaterThan(0);
            const demand = response.body[0];
            // Check related data is included
            (0, globals_1.expect)(demand.submitter).toBeDefined();
            (0, globals_1.expect)(demand.submitter.email).toBe(testUser.email);
            (0, globals_1.expect)(demand.building).toBeDefined();
            (0, globals_1.expect)(demand.building.name).toBe(testBuilding.name);
            (0, globals_1.expect)(demand.residence).toBeDefined();
            (0, globals_1.expect)(demand.residence.unitNumber).toBe(testResidence.unitNumber);
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should handle database errors gracefully', async () => {
            // Test with invalid UUID format
            const demandData = {
                type: 'maintenance',
                description: 'Test with invalid UUID',
                buildingId: 'invalid-uuid',
            };
            await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(400);
        });
        (0, globals_1.it)('should handle user without residence assignment', async () => {
            // Remove user-residence association
            await db_1.db.delete(schema_1.userResidences).where((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, testUser.id));
            const demandData = {
                type: 'maintenance',
                description: 'Test without residence',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(400);
            (0, globals_1.expect)(response.body.message).toContain('residence');
        });
    });
    (0, globals_1.describe)('Frontend Form Compatibility', () => {
        (0, globals_1.it)('should handle empty string fields like frontend forms', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Test with empty string fields',
                buildingId: '', // Empty string should be treated as undefined
                residenceId: '',
                assignationBuildingId: '',
                assignationResidenceId: '',
                status: 'submitted',
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            // Should auto-populate building and residence
            (0, globals_1.expect)(response.body.buildingId).toBe(testBuilding.id);
            (0, globals_1.expect)(response.body.residenceId).toBe(testResidence.id);
        });
        (0, globals_1.it)('should handle undefined optional fields', async () => {
            const demandData = {
                type: 'maintenance',
                description: 'Test with undefined fields',
                buildingId: undefined,
                residenceId: undefined,
                assignationBuildingId: undefined,
                assignationResidenceId: undefined,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/demands')
                .set('Cookie', authCookie)
                .send(demandData)
                .expect(201);
            (0, globals_1.expect)(response.body.buildingId).toBe(testBuilding.id);
            (0, globals_1.expect)(response.body.residenceId).toBe(testResidence.id);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9kZW1hbmQtc3VibWlzc2lvbi1mbG93LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7QUFFSCwyQ0FBNEU7QUFDNUUsMERBQWdDO0FBQ2hDLHdDQUFxQztBQUNyQyxnREFBMkc7QUFDM0csNkNBQWlDO0FBRWpDLDJCQUEyQjtBQUMzQixTQUFTLGFBQWE7SUFDcEIsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ25DLE1BQU0sR0FBRyxHQUFHLE9BQU8sRUFBRSxDQUFDO0lBRXRCLG1CQUFtQjtJQUNuQixHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBRXhCLDBCQUEwQjtJQUMxQixNQUFNLEVBQUUsY0FBYyxFQUFFLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDMUQsY0FBYyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXBCLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQztBQUVELElBQUEsa0JBQVEsRUFBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUU7SUFDbkQsSUFBSSxHQUFRLENBQUM7SUFDYixJQUFJLFFBQWEsQ0FBQztJQUNsQixJQUFJLFlBQWlCLENBQUM7SUFDdEIsSUFBSSxhQUFrQixDQUFDO0lBQ3ZCLElBQUksZ0JBQXFCLENBQUM7SUFDMUIsSUFBSSxVQUFrQixDQUFDO0lBRXZCLElBQUEsb0JBQVUsRUFBQyxLQUFLLElBQUksRUFBRTtRQUNwQixHQUFHLEdBQUcsYUFBYSxFQUFFLENBQUM7UUFFdEIsMkJBQTJCO1FBQzNCLE1BQU0sU0FBUyxHQUFHLE1BQU0sT0FBRSxDQUFDLE1BQU0sQ0FBQyxzQkFBYSxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ3RELElBQUksRUFBRSxtQkFBbUI7WUFDekIsSUFBSSxFQUFFLGFBQWE7WUFDbkIsT0FBTyxFQUFFLGFBQWE7WUFDdEIsSUFBSSxFQUFFLFdBQVc7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aW9uL2RlbWFuZC1zdWJtaXNzaW9uLWZsb3cudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBmaWxlIERlbWFuZCBTdWJtaXNzaW9uIEludGVncmF0aW9uIFRlc3RzXG4gKiBAZGVzY3JpcHRpb24gQ29tcHJlaGVuc2l2ZSB0ZXN0cyBmb3IgdGhlIGVudGlyZSBkZW1hbmQgc3VibWlzc2lvbiB3b3JrZmxvd1xuICovXG5cbmltcG9ydCB7IGRlc2NyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCBhZnRlckVhY2ggfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgeyBkYiB9IGZyb20gJy4uLy4uL3NlcnZlci9kYic7XG5pbXBvcnQgeyBkZW1hbmRzLCB1c2VycywgcmVzaWRlbmNlcywgYnVpbGRpbmdzLCBvcmdhbml6YXRpb25zLCB1c2VyUmVzaWRlbmNlcyB9IGZyb20gJy4uLy4uL3NoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgZXEgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8vIENyZWF0ZSB0ZXN0IGFwcCBpbnN0YW5jZVxuZnVuY3Rpb24gY3JlYXRlVGVzdEFwcCgpIHtcbiAgY29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuICBcbiAgLy8gQXBwbHkgbWlkZGxld2FyZVxuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgXG4gIC8vIEltcG9ydCBhbmQgc2V0dXAgcm91dGVzXG4gIGNvbnN0IHsgcmVnaXN0ZXJSb3V0ZXMgfSA9IHJlcXVpcmUoJy4uLy4uL3NlcnZlci9yb3V0ZXMnKTtcbiAgcmVnaXN0ZXJSb3V0ZXMoYXBwKTtcbiAgXG4gIHJldHVybiBhcHA7XG59XG5cbmRlc2NyaWJlKCdEZW1hbmQgU3VibWlzc2lvbiBJbnRlZ3JhdGlvbiBUZXN0cycsICgpID0+IHtcbiAgbGV0IGFwcDogYW55O1xuICBsZXQgdGVzdFVzZXI6IGFueTtcbiAgbGV0IHRlc3RCdWlsZGluZzogYW55O1xuICBsZXQgdGVzdFJlc2lkZW5jZTogYW55O1xuICBsZXQgdGVzdE9yZ2FuaXphdGlvbjogYW55O1xuICBsZXQgYXV0aENvb2tpZTogc3RyaW5nO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGFwcCA9IGNyZWF0ZVRlc3RBcHAoKTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IG9yZ2FuaXphdGlvblxuICAgIGNvbnN0IG9yZ1Jlc3VsdCA9IGF3YWl0IGRiLmluc2VydChvcmdhbml6YXRpb25zKS52YWx1ZXMoe1xuICAgICAgbmFtZTogJ1Rlc3QgT3JnYW5pemF0aW9uJyxcbiAgICAgIHR5cGU6ICdyZXNpZGVudGlhbCcsXG4gICAgICBhZGRyZXNzOiAnMTIzIFRlc3QgU3QnLFxuICAgICAgY2l0eTogJ1Rlc3QgQ2l0eScsXG4gICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6ICdIMUggMUgxJyxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgIH0pLnJldHVybmluZygpO1xuICAgIHRlc3RPcmdhbml6YXRpb24gPSBvcmdSZXN1bHRbMF07XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBidWlsZGluZ1xuICAgIGNvbnN0IGJ1aWxkaW5nUmVzdWx0ID0gYXdhaXQgZGIuaW5zZXJ0KGJ1aWxkaW5ncykudmFsdWVzKHtcbiAgICAgIG5hbWU6ICdUZXN0IEJ1aWxkaW5nJyxcbiAgICAgIGFkZHJlc3M6ICc0NTYgVGVzdCBBdmUnLFxuICAgICAgY2l0eTogJ1Rlc3QgQ2l0eScsXG4gICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6ICdIMkggMkgyJyxcbiAgICAgIGJ1aWxkaW5nVHlwZTogJ2NvbmRvJyxcbiAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgdG90YWxVbml0czogMTAsXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICB9KS5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0QnVpbGRpbmcgPSBidWlsZGluZ1Jlc3VsdFswXTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IHJlc2lkZW5jZVxuICAgIGNvbnN0IHJlc2lkZW5jZVJlc3VsdCA9IGF3YWl0IGRiLmluc2VydChyZXNpZGVuY2VzKS52YWx1ZXMoe1xuICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgdW5pdE51bWJlcjogJzEwMScsXG4gICAgICBmbG9vcjogMSxcbiAgICAgIHNxdWFyZUZvb3RhZ2U6ICcxMDAwJyxcbiAgICAgIGJlZHJvb21zOiAyLFxuICAgICAgYmF0aHJvb21zOiAnMScsXG4gICAgICBiYWxjb255OiBmYWxzZSxcbiAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgIH0pLnJldHVybmluZygpO1xuICAgIHRlc3RSZXNpZGVuY2UgPSByZXNpZGVuY2VSZXN1bHRbMF07XG5cbiAgICAvLyBDcmVhdGUgdGVzdCB1c2VyXG4gICAgY29uc3QgdXNlclJlc3VsdCA9IGF3YWl0IGRiLmluc2VydCh1c2VycykudmFsdWVzKHtcbiAgICAgIHVzZXJuYW1lOiAndGVzdHVzZXInLFxuICAgICAgZmlyc3ROYW1lOiAnVGVzdCcsXG4gICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgZW1haWw6ICd0ZXN0QGV4YW1wbGUuY29tJyxcbiAgICAgIHBhc3N3b3JkOiAnaGFzaGVkX3Bhc3N3b3JkJyxcbiAgICAgIHJvbGU6ICdyZXNpZGVudCcsXG4gICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICB9KS5yZXR1cm5pbmcoKTtcbiAgICB0ZXN0VXNlciA9IHVzZXJSZXN1bHRbMF07XG5cbiAgICAvLyBBc3NvY2lhdGUgdXNlciB3aXRoIHJlc2lkZW5jZVxuICAgIGF3YWl0IGRiLmluc2VydCh1c2VyUmVzaWRlbmNlcykudmFsdWVzKHtcbiAgICAgIHVzZXJJZDogdGVzdFVzZXIuaWQsXG4gICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICdyZXNpZGVudCcsXG4gICAgICBzdGFydERhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgfSk7XG5cbiAgICAvLyBNb2NrIGF1dGhlbnRpY2F0aW9uXG4gICAgYXV0aENvb2tpZSA9ICd0ZXN0LXNlc3Npb24tY29va2llJztcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB0ZXN0IGRhdGFcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZGIuZGVsZXRlKHVzZXJSZXNpZGVuY2VzKS53aGVyZShlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIHRlc3RVc2VyLmlkKSk7XG4gICAgICBhd2FpdCBkYi5kZWxldGUoZGVtYW5kcykud2hlcmUoZXEoZGVtYW5kcy5zdWJtaXR0ZXJJZCwgdGVzdFVzZXIuaWQpKTtcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZSh1c2Vycykud2hlcmUoZXEodXNlcnMuaWQsIHRlc3RVc2VyLmlkKSk7XG4gICAgICBhd2FpdCBkYi5kZWxldGUocmVzaWRlbmNlcykud2hlcmUoZXEocmVzaWRlbmNlcy5pZCwgdGVzdFJlc2lkZW5jZS5pZCkpO1xuICAgICAgYXdhaXQgZGIuZGVsZXRlKGJ1aWxkaW5ncykud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCB0ZXN0QnVpbGRpbmcuaWQpKTtcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShvcmdhbml6YXRpb25zKS53aGVyZShlcShvcmdhbml6YXRpb25zLmlkLCB0ZXN0T3JnYW5pemF0aW9uLmlkKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0NsZWFudXAgZXJyb3I6JywgZXJyb3IpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1BPU1QgL2FwaS9kZW1hbmRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgc3VjY2Vzc2Z1bGx5IGNyZWF0ZSBhIGRlbWFuZCB3aXRoIGFsbCBmaWVsZHMgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1dhdGVyIGxlYWsgaW4gYmF0aHJvb20gY2VpbGluZycsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IHRlc3RCdWlsZGluZy5pZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UuaWQsXG4gICAgICAgIHN0YXR1czogJ3N1Ym1pdHRlZCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoZGVtYW5kRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnV2F0ZXIgbGVhayBpbiBiYXRocm9vbSBjZWlsaW5nJyxcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY3JlYXRlZEF0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhdXRvLXBvcHVsYXRlIGJ1aWxkaW5nIGFuZCByZXNpZGVuY2UgZnJvbSB1c2VyIGRhdGEgd2hlbiBub3QgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnY29tcGxhaW50JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdOb2lzZSBjb21wbGFpbnQgZnJvbSB1cHN0YWlycyBuZWlnaGJvcicsXG4gICAgICAgIHN0YXR1czogJ3N1Ym1pdHRlZCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoZGVtYW5kRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHR5cGU6ICdjb21wbGFpbnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ05vaXNlIGNvbXBsYWludCBmcm9tIHVwc3RhaXJzIG5laWdoYm9yJyxcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBvbmx5IGJ1aWxkaW5nSWQgYW5kIGF1dG8tcG9wdWxhdGUgcmVzaWRlbmNlSWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnaW5mb3JtYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1F1ZXN0aW9uIGFib3V0IGJ1aWxkaW5nIHBvbGljaWVzJyxcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5zZW5kKGRlbWFuZERhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB0eXBlOiAnaW5mb3JtYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1F1ZXN0aW9uIGFib3V0IGJ1aWxkaW5nIHBvbGljaWVzJyxcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBvbmx5IHJlc2lkZW5jZUlkIGFuZCBhdXRvLXBvcHVsYXRlIGJ1aWxkaW5nSWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnb3RoZXInLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0dlbmVyYWwgaW5xdWlyeSBhYm91dCByZXNpZGVuY2UnLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2RlbWFuZHMnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZChkZW1hbmREYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgdHlwZTogJ290aGVyJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdHZW5lcmFsIGlucXVpcnkgYWJvdXQgcmVzaWRlbmNlJyxcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcXVpcmUgYXV0aGVudGljYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgZGVtYW5kIHdpdGhvdXQgYXV0aCcsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZW5kKGRlbWFuZERhdGEpXG4gICAgICAgIC5leHBlY3QoNDAxKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZERlbWFuZHMgPSBbXG4gICAgICAgIHsgdHlwZTogJ21haW50ZW5hbmNlJyB9LCAvLyBNaXNzaW5nIGRlc2NyaXB0aW9uXG4gICAgICAgIHsgZGVzY3JpcHRpb246ICdUZXN0JyB9LCAvLyBNaXNzaW5nIHR5cGVcbiAgICAgICAgeyB0eXBlOiAnaW52YWxpZF90eXBlJywgZGVzY3JpcHRpb246ICdUZXN0JyB9LCAvLyBJbnZhbGlkIHR5cGVcbiAgICAgICAgeyB0eXBlOiAnbWFpbnRlbmFuY2UnLCBkZXNjcmlwdGlvbjogJ1Nob3J0JyB9LCAvLyBEZXNjcmlwdGlvbiB0b28gc2hvcnRcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgaW52YWxpZERlbWFuZCBvZiBpbnZhbGlkRGVtYW5kcykge1xuICAgICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAgIC5zZW5kKGludmFsaWREZW1hbmQpXG4gICAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYXNzaWduYXRpb24gZmllbGRzIHByb3Blcmx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGVtYW5kRGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdNYWludGVuYW5jZSByZXF1ZXN0IHdpdGggYXNzaWduYXRpb24nLFxuICAgICAgICBhc3NpZ25hdGlvbkJ1aWxkaW5nSWQ6IHRlc3RCdWlsZGluZy5pZCxcbiAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2RlbWFuZHMnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZChkZW1hbmREYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdNYWludGVuYW5jZSByZXF1ZXN0IHdpdGggYXNzaWduYXRpb24nLFxuICAgICAgICBhc3NpZ25hdGlvbkJ1aWxkaW5nSWQ6IHRlc3RCdWlsZGluZy5pZCxcbiAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZS5pZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gZGVzY3JpcHRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1LDqXBhcmF0aW9uIG7DqWNlc3NhaXJlIGF2ZWMgY2FyYWN0w6hyZXMgc3DDqWNpYXV4OiDDqcOgw7nDpyEg8J+PoCcsXG4gICAgICAgIHN0YXR1czogJ3N1Ym1pdHRlZCcsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoZGVtYW5kRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5kZXNjcmlwdGlvbikudG9CZSgnUsOpcGFyYXRpb24gbsOpY2Vzc2FpcmUgYXZlYyBjYXJhY3TDqHJlcyBzcMOpY2lhdXg6IMOpw6DDucOnISDwn4+gJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlZmF1bHQgdG8gc3VibWl0dGVkIHN0YXR1cyB3aGVuIG5vdCBwcm92aWRlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbWFuZERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBkZW1hbmQgd2l0aG91dCBzdGF0dXMnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5zZW5kKGRlbWFuZERhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3RhdHVzKS50b0JlKCdzdWJtaXR0ZWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZGVzY3JpcHRpb24gbGVuZ3RoIGJvdW5kYXJpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZE1pbkRlc2NyaXB0aW9uID0gJ2EnLnJlcGVhdCgxMCk7IC8vIE1pbmltdW0gdmFsaWRcbiAgICAgIGNvbnN0IHZhbGlkTWF4RGVzY3JpcHRpb24gPSAnYScucmVwZWF0KDIwMDApOyAvLyBNYXhpbXVtIHZhbGlkXG4gICAgICBjb25zdCBpbnZhbGlkU2hvcnREZXNjcmlwdGlvbiA9ICdhJy5yZXBlYXQoOSk7IC8vIFRvbyBzaG9ydFxuICAgICAgY29uc3QgaW52YWxpZExvbmdEZXNjcmlwdGlvbiA9ICdhJy5yZXBlYXQoMjAwMSk7IC8vIFRvbyBsb25nXG5cbiAgICAgIC8vIFZhbGlkIGNhc2VzXG4gICAgICBmb3IgKGNvbnN0IGRlc2NyaXB0aW9uIG9mIFt2YWxpZE1pbkRlc2NyaXB0aW9uLCB2YWxpZE1heERlc2NyaXB0aW9uXSkge1xuICAgICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAgIC5zZW5kKHtcbiAgICAgICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5leHBlY3QoMjAxKTtcbiAgICAgIH1cblxuICAgICAgLy8gSW52YWxpZCBjYXNlc1xuICAgICAgZm9yIChjb25zdCBkZXNjcmlwdGlvbiBvZiBbaW52YWxpZFNob3J0RGVzY3JpcHRpb24sIGludmFsaWRMb25nRGVzY3JpcHRpb25dKSB7XG4gICAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAgIC5wb3N0KCcvYXBpL2RlbWFuZHMnKVxuICAgICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgICAgLnNlbmQoe1xuICAgICAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmV4cGVjdCg0MDApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnR0VUIC9hcGkvZGVtYW5kcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHJpZXZlIHVzZXIgZGVtYW5kcyBhZnRlciBjcmVhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhIGRlbWFuZCBmaXJzdFxuICAgICAgY29uc3QgZGVtYW5kRGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGRlbWFuZCBmb3IgcmV0cmlldmFsJyxcbiAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IGNyZWF0ZVJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2RlbWFuZHMnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZChkZW1hbmREYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIC8vIFJldHJpZXZlIGRlbWFuZHNcbiAgICAgIGNvbnN0IGdldFJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KGdldFJlc3BvbnNlLmJvZHkpLnRvQmVJbnN0YW5jZU9mKEFycmF5KTtcbiAgICAgIGV4cGVjdChnZXRSZXNwb25zZS5ib2R5Lmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgXG4gICAgICBjb25zdCByZXRyaWV2ZWREZW1hbmQgPSBnZXRSZXNwb25zZS5ib2R5LmZpbmQoKGQ6IGFueSkgPT4gZC5pZCA9PT0gY3JlYXRlUmVzcG9uc2UuYm9keS5pZCk7XG4gICAgICBleHBlY3QocmV0cmlldmVkRGVtYW5kKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGRlbWFuZCBmb3IgcmV0cmlldmFsJyxcbiAgICAgICAgc3VibWl0dGVySWQ6IHRlc3RVc2VyLmlkLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcmVsYXRlZCBkYXRhIGluIGRlbWFuZCByZXRyaWV2YWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSBkZW1hbmRcbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoe1xuICAgICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGRlbWFuZCB3aXRoIHJlbGF0aW9ucycsXG4gICAgICAgIH0pXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gUmV0cmlldmUgZGVtYW5kc1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGNvbnN0IGRlbWFuZCA9IHJlc3BvbnNlLmJvZHlbMF07XG5cbiAgICAgIC8vIENoZWNrIHJlbGF0ZWQgZGF0YSBpcyBpbmNsdWRlZFxuICAgICAgZXhwZWN0KGRlbWFuZC5zdWJtaXR0ZXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoZGVtYW5kLnN1Ym1pdHRlci5lbWFpbCkudG9CZSh0ZXN0VXNlci5lbWFpbCk7XG4gICAgICBleHBlY3QoZGVtYW5kLmJ1aWxkaW5nKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRlbWFuZC5idWlsZGluZy5uYW1lKS50b0JlKHRlc3RCdWlsZGluZy5uYW1lKTtcbiAgICAgIGV4cGVjdChkZW1hbmQucmVzaWRlbmNlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGRlbWFuZC5yZXNpZGVuY2UudW5pdE51bWJlcikudG9CZSh0ZXN0UmVzaWRlbmNlLnVuaXROdW1iZXIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGF0YWJhc2UgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBUZXN0IHdpdGggaW52YWxpZCBVVUlEIGZvcm1hdFxuICAgICAgY29uc3QgZGVtYW5kRGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IHdpdGggaW52YWxpZCBVVUlEJyxcbiAgICAgICAgYnVpbGRpbmdJZDogJ2ludmFsaWQtdXVpZCcsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5zZW5kKGRlbWFuZERhdGEpXG4gICAgICAgIC5leHBlY3QoNDAwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHVzZXIgd2l0aG91dCByZXNpZGVuY2UgYXNzaWdubWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFJlbW92ZSB1c2VyLXJlc2lkZW5jZSBhc3NvY2lhdGlvblxuICAgICAgYXdhaXQgZGIuZGVsZXRlKHVzZXJSZXNpZGVuY2VzKS53aGVyZShlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIHRlc3RVc2VyLmlkKSk7XG5cbiAgICAgIGNvbnN0IGRlbWFuZERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCB3aXRob3V0IHJlc2lkZW5jZScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9kZW1hbmRzJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYXV0aENvb2tpZSlcbiAgICAgICAgLnNlbmQoZGVtYW5kRGF0YSlcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0NvbnRhaW4oJ3Jlc2lkZW5jZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRnJvbnRlbmQgRm9ybSBDb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0cmluZyBmaWVsZHMgbGlrZSBmcm9udGVuZCBmb3JtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbWFuZERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCB3aXRoIGVtcHR5IHN0cmluZyBmaWVsZHMnLFxuICAgICAgICBidWlsZGluZ0lkOiAnJywgLy8gRW1wdHkgc3RyaW5nIHNob3VsZCBiZSB0cmVhdGVkIGFzIHVuZGVmaW5lZFxuICAgICAgICByZXNpZGVuY2VJZDogJycsXG4gICAgICAgIGFzc2lnbmF0aW9uQnVpbGRpbmdJZDogJycsXG4gICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6ICcnLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvZGVtYW5kcycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGF1dGhDb29raWUpXG4gICAgICAgIC5zZW5kKGRlbWFuZERhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gU2hvdWxkIGF1dG8tcG9wdWxhdGUgYnVpbGRpbmcgYW5kIHJlc2lkZW5jZVxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuYnVpbGRpbmdJZCkudG9CZSh0ZXN0QnVpbGRpbmcuaWQpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkucmVzaWRlbmNlSWQpLnRvQmUodGVzdFJlc2lkZW5jZS5pZCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1bmRlZmluZWQgb3B0aW9uYWwgZmllbGRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZGVtYW5kRGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IHdpdGggdW5kZWZpbmVkIGZpZWxkcycsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgYXNzaWduYXRpb25CdWlsZGluZ0lkOiB1bmRlZmluZWQsXG4gICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6IHVuZGVmaW5lZCxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2RlbWFuZHMnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhdXRoQ29va2llKVxuICAgICAgICAuc2VuZChkZW1hbmREYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmJ1aWxkaW5nSWQpLnRvQmUodGVzdEJ1aWxkaW5nLmlkKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnJlc2lkZW5jZUlkKS50b0JlKHRlc3RSZXNpZGVuY2UuaWQpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==