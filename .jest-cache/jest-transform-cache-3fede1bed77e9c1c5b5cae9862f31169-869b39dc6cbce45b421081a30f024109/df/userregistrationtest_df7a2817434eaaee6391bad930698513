86c8fd15d42891deb411427672945210
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const express_1 = __importDefault(require("express"));
const supertest_1 = __importDefault(require("supertest"));
const routes_1 = require("../../../server/routes");
const db_1 = require("../../../server/db");
const schema = __importStar(require("../../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const bcryptjs_1 = __importDefault(require("bcryptjs"));
const crypto_1 = require("crypto");
/**
 * User Registration Test Suite
 *
 * Tests the complete invitation-based user registration flow including:
 * - Token validation and security
 * - User account creation with proper data
 * - Password hashing and security
 * - Quebec Law 25 privacy consent handling
 * - Organization assignment
 * - Invitation status updates
 */
// Create test app
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    (0, routes_1.registerRoutes)(app);
    return app;
};
(0, globals_1.describe)('User Registration via Invitation', () => {
    let app;
    let testInvitation;
    let testOrganization;
    let inviterUser;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Skip database operations in test environment - use mock data instead
        if (process.env.TEST_TYPE === 'unit') {
            // Mock test data for unit tests
            testOrganization = [{
                    id: 'mock-org-id-123',
                    name: 'Test Registration Org',
                    type: 'syndicate',
                    address: '123 Test St',
                    city: 'Montreal',
                    province: 'QC',
                    postalCode: 'H1A 1A1',
                }];
        }
        else {
            // Real database operations for integration tests
            // Clean up any existing test data
            await db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, 'test-registration@example.com'));
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'test-registration@example.com'));
            // Create test organization
            testOrganization = await db_1.db
                .insert(schema.organizations)
                .values({
                name: 'Test Registration Org',
                type: 'syndicate',
                address: '123 Test St',
                city: 'Montreal',
                province: 'QC',
                postalCode: 'H1A 1A1',
            })
                .returning();
        }
        // Create inviter user and invitation
        if (process.env.TEST_TYPE === 'unit') {
            // Mock test data for unit tests
            inviterUser = [{
                    id: 'mock-inviter-id-123',
                    username: 'testinviter',
                    email: 'inviter@test.com',
                    firstName: 'Test',
                    lastName: 'Inviter',
                    password: 'mock-hashed-password',
                    role: 'admin',
                }];
            const token = 'test-registration-token-123';
            const tokenHash = (0, crypto_1.createHash)('sha256').update(token).digest('hex');
            testInvitation = [{
                    id: 'mock-invitation-id-123',
                    email: 'test-registration@example.com',
                    token,
                    tokenHash,
                    role: 'manager',
                    organizationId: testOrganization[0].id,
                    invitedByUserId: inviterUser[0].id,
                    expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days
                    status: 'pending',
                }];
        }
        else {
            // Real database operations for integration tests
            inviterUser = await db_1.db
                .insert(schema.users)
                .values({
                username: 'testinviter',
                email: 'inviter@test.com',
                firstName: 'Test',
                lastName: 'Inviter',
                password: await bcryptjs_1.default.hash('password123', 12),
                role: 'admin',
            })
                .returning();
            // Create test invitation
            const token = 'test-registration-token-123';
            const tokenHash = (0, crypto_1.createHash)('sha256').update(token).digest('hex');
            testInvitation = await db_1.db
                .insert(schema.invitations)
                .values({
                email: 'test-registration@example.com',
                token,
                tokenHash,
                role: 'manager',
                organizationId: testOrganization[0].id,
                invitedByUserId: inviterUser[0].id,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000), // 7 days
                status: 'pending',
            })
                .returning();
        }
    });
    (0, globals_1.afterEach)(async () => {
        // Clean up test data
        if (process.env.TEST_TYPE === 'unit') {
            // Skip cleanup for unit tests - no real data was created
            return;
        }
        // Real database cleanup for integration tests
        await db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, 'test-registration@example.com'));
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'test-registration@example.com'));
        await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'inviter@test.com'));
        if (testOrganization?.[0]?.id) {
            await db_1.db.delete(schema.userOrganizations).where((0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, testOrganization[0].id));
            await db_1.db.delete(schema.organizations).where((0, drizzle_orm_1.eq)(schema.organizations.id, testOrganization[0].id));
        }
    });
    (0, globals_1.describe)('Invitation Token Validation', () => {
        (0, globals_1.it)('should validate a valid invitation token', async () => {
            const response = await (0, supertest_1.default)(app)
                .get(`/api/invitations/validate/test-registration-token-123`)
                .expect(200);
            (0, globals_1.expect)(response.body).toMatchObject({
                valid: true,
                invitation: {
                    id: testInvitation[0].id,
                    email: 'test-registration@example.com',
                    role: 'manager',
                    organizationId: testOrganization[0].id,
                    status: 'pending',
                },
            });
        });
        (0, globals_1.it)('should reject invalid invitation token', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/invitations/validate/invalid-token')
                .expect(404);
            (0, globals_1.expect)(response.body).toMatchObject({
                valid: false,
                message: 'Invitation not found or invalid',
                code: 'INVITATION_NOT_FOUND',
            });
        });
        (0, globals_1.it)('should reject expired invitation token', async () => {
            // Update invitation to be expired
            await db_1.db
                .update(schema.invitations)
                .set({ expiresAt: new Date(Date.now() - 1000) })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation[0].id));
            const response = await (0, supertest_1.default)(app)
                .get('/api/invitations/validate/test-registration-token-123')
                .expect(410);
            (0, globals_1.expect)(response.body).toMatchObject({
                valid: false,
                message: 'Invitation has expired',
                code: 'INVITATION_EXPIRED',
            });
        });
        (0, globals_1.it)('should reject already accepted invitation', async () => {
            // Mark invitation as accepted
            await db_1.db
                .update(schema.invitations)
                .set({ status: 'accepted', acceptedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation[0].id));
            const response = await (0, supertest_1.default)(app)
                .get('/api/invitations/validate/test-registration-token-123')
                .expect(410);
            (0, globals_1.expect)(response.body).toMatchObject({
                valid: false,
                message: 'Invitation has already been used',
                code: 'INVITATION_USED',
            });
        });
    });
    (0, globals_1.describe)('User Account Creation', () => {
        (0, globals_1.it)('should create new user account with valid invitation', async () => {
            const registrationData = {
                firstName: 'John',
                lastName: 'Doe',
                password: 'SecurePass123!',
                phone: '+1-514-555-0123',
                language: 'en',
                dataCollectionConsent: true,
                marketingConsent: false,
                analyticsConsent: true,
                thirdPartyConsent: false,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Account created successfully',
                user: {
                    id: globals_1.expect.any(String),
                    username: 'test-registration',
                    email: 'test-registration@example.com',
                    firstName: 'John',
                    lastName: 'Doe',
                    role: 'manager',
                    language: 'en',
                    phone: '+1-514-555-0123',
                },
            });
            // Verify user was created in database
            const createdUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'test-registration@example.com'))
                .limit(1);
            (0, globals_1.expect)(createdUser).toHaveLength(1);
            (0, globals_1.expect)(createdUser[0]).toMatchObject({
                email: 'test-registration@example.com',
                firstName: 'John',
                lastName: 'Doe',
                role: 'manager',
                language: 'en',
                isActive: true,
            });
            // Verify password is properly hashed
            const isValidPassword = await bcryptjs_1.default.compare('SecurePass123!', createdUser[0].password);
            (0, globals_1.expect)(isValidPassword).toBe(true);
        });
        (0, globals_1.it)('should require all mandatory fields for registration', async () => {
            const incompleteData = {
                firstName: 'John',
                // Missing lastName, password
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(incompleteData)
                .expect(400);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'First name, last name, and password are required',
                code: 'MISSING_REQUIRED_FIELDS',
            });
        });
        (0, globals_1.it)('should require Quebec Law 25 privacy consents', async () => {
            const dataWithoutConsent = {
                firstName: 'John',
                lastName: 'Doe',
                password: 'SecurePass123!',
                language: 'en',
                // Missing dataCollectionConsent and acknowledgedRights
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(dataWithoutConsent)
                .expect(400);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Data collection consent and privacy rights acknowledgment are required',
                code: 'CONSENT_REQUIRED',
            });
        });
        (0, globals_1.it)('should generate unique username from email', async () => {
            const registrationData = {
                firstName: 'Jane',
                lastName: 'Smith',
                password: 'AnotherPass456!',
                language: 'fr',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            (0, globals_1.expect)(response.body.user.username).toBe('test-registration');
            (0, globals_1.expect)(response.body.user.email).toBe('test-registration@example.com');
        });
        (0, globals_1.it)('should update invitation status to accepted', async () => {
            const registrationData = {
                firstName: 'Test',
                lastName: 'User',
                password: 'TestPass789!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            // Verify invitation is marked as accepted
            const updatedInvitation = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation[0].id))
                .limit(1);
            (0, globals_1.expect)(updatedInvitation[0]).toMatchObject({
                status: 'accepted',
                acceptedAt: globals_1.expect.any(Date),
                acceptedBy: globals_1.expect.any(String),
            });
        });
        (0, globals_1.it)('should prevent registration with already used invitation', async () => {
            // First registration
            const firstRegistration = {
                firstName: 'First',
                lastName: 'User',
                password: 'FirstPass123!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(firstRegistration)
                .expect(201);
            // Second registration attempt with same token
            const secondRegistration = {
                firstName: 'Second',
                lastName: 'User',
                password: 'SecondPass456!',
                language: 'fr',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(secondRegistration)
                .expect(410);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Invitation has already been used',
                code: 'INVITATION_USED',
            });
        });
        (0, globals_1.it)('should prevent registration if user already exists with email', async () => {
            // Create existing user with same email
            await db_1.db.insert(schema.users).values({
                username: 'existinguser',
                email: 'test-registration@example.com',
                firstName: 'Existing',
                lastName: 'User',
                password: await bcryptjs_1.default.hash('ExistingPass123!', 12),
                role: 'tenant',
            });
            const registrationData = {
                firstName: 'New',
                lastName: 'User',
                password: 'NewPass123!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(409);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'User already exists with this email',
                code: 'USER_EXISTS',
            });
            // Clean up
            await db_1.db.delete(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'test-registration@example.com'));
        });
    });
    (0, globals_1.describe)('Password Security', () => {
        (0, globals_1.it)('should properly hash passwords using bcrypt', async () => {
            const registrationData = {
                firstName: 'Security',
                lastName: 'Test',
                password: 'SecurityTest123!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            const createdUser = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'test-registration@example.com'))
                .limit(1);
            // Password should be hashed, not plain text
            (0, globals_1.expect)(createdUser[0].password).not.toBe('SecurityTest123!');
            (0, globals_1.expect)(createdUser[0].password.startsWith('$2b$')).toBe(true);
            // Should be able to verify password
            const isValid = await bcryptjs_1.default.compare('SecurityTest123!', createdUser[0].password);
            (0, globals_1.expect)(isValid).toBe(true);
        });
    });
    (0, globals_1.describe)('Quebec Law 25 Compliance', () => {
        (0, globals_1.it)('should store all privacy consent preferences', async () => {
            const registrationData = {
                firstName: 'Privacy',
                lastName: 'Test',
                password: 'PrivacyTest123!',
                language: 'fr',
                dataCollectionConsent: true,
                marketingConsent: false,
                analyticsConsent: true,
                thirdPartyConsent: false,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            (0, globals_1.expect)(response.body.user).toMatchObject({
                language: 'fr',
                dataCollectionConsent: true,
                marketingConsent: false,
                analyticsConsent: true,
                thirdPartyConsent: false,
                acknowledgedRights: true,
            });
        });
        (0, globals_1.it)('should support both French and English languages', async () => {
            const frenchRegistration = {
                firstName: 'François',
                lastName: 'Dubois',
                password: 'MotDePasse123!',
                language: 'fr',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(frenchRegistration)
                .expect(201);
            (0, globals_1.expect)(response.body.user.language).toBe('fr');
            (0, globals_1.expect)(response.body.user.firstName).toBe('François');
        });
    });
    (0, globals_1.describe)('Organization Assignment', () => {
        (0, globals_1.it)('should assign user to invitation organization', async () => {
            const registrationData = {
                firstName: 'Organization',
                lastName: 'Test',
                password: 'OrgTest123!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/test-registration-token-123')
                .send(registrationData)
                .expect(201);
            // Verify user is assigned to correct organization
            const userOrgs = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, response.body.user.id));
            (0, globals_1.expect)(userOrgs).toHaveLength(1);
            (0, globals_1.expect)(userOrgs[0].organizationId).toBe(testOrganization[0].id);
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should handle database errors gracefully', async () => {
            // Create invitation with invalid organization ID to trigger error
            const invalidInvitation = await db_1.db
                .insert(schema.invitations)
                .values({
                id: 'inv-invalid-org',
                email: 'invalid-org@example.com',
                token: 'invalid-org-token',
                tokenHash: (0, crypto_1.createHash)('sha256').update('invalid-org-token').digest('hex'),
                role: 'manager',
                organizationId: 'non-existent-org',
                invitedByUserId: inviterUser[0].id,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
                status: 'pending',
            })
                .returning();
            const registrationData = {
                firstName: 'Error',
                lastName: 'Test',
                password: 'ErrorTest123!',
                language: 'en',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post('/api/invitations/accept/invalid-org-token')
                .send(registrationData)
                .expect(500);
            (0, globals_1.expect)(response.body).toMatchObject({
                message: 'Internal server error during account creation',
                code: 'INVITATION_ACCEPT_ERROR',
            });
            // Clean up
            await db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, invalidInvitation[0].id));
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2F1dGgvdXNlci1yZWdpc3RyYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDJDQUE0RTtBQUM1RSxzREFBOEI7QUFDOUIsMERBQWdDO0FBQ2hDLG1EQUF3RDtBQUN4RCwyQ0FBd0M7QUFDeEMsK0RBQWlEO0FBQ2pELDZDQUFpQztBQUNqQyx3REFBOEI7QUFDOUIsbUNBQW9DO0FBRXBDOzs7Ozs7Ozs7O0dBVUc7QUFFSCxrQkFBa0I7QUFDbEIsTUFBTSxhQUFhLEdBQUcsR0FBRyxFQUFFO0lBQ3pCLE1BQU0sR0FBRyxHQUFHLElBQUEsaUJBQU8sR0FBRSxDQUFDO0lBQ3RCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO0lBQ3hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsaUJBQU8sQ0FBQyxVQUFVLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2hELElBQUEsdUJBQWMsRUFBQyxHQUFHLENBQUMsQ0FBQztJQUNwQixPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMsQ0FBQztBQUVGLElBQUEsa0JBQVEsRUFBQyxrQ0FBa0MsRUFBRSxHQUFHLEVBQUU7SUFDaEQsSUFBSSxHQUF3QixDQUFDO0lBQzdCLElBQUksY0FBbUIsQ0FBQztJQUN4QixJQUFJLGdCQUFxQixDQUFDO0lBQzFCLElBQUksV0FBZ0IsQ0FBQztJQUVyQixJQUFBLG9CQUFVLEVBQUMsS0FBSyxJQUFJLEVBQUU7UUFDcEIsR0FBRyxHQUFHLGFBQWEsRUFBRSxDQUFDO1FBRXRCLHVFQUF1RTtRQUN2RSxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUyxLQUFLLE1BQU0sRUFBRSxDQUFDO1lBQ3JDLGdDQUFnQztZQUNoQyxnQkFBZ0IsR0FBRyxDQUFDO29CQUNsQixFQUFFLEVBQUUsaUJBQWlCO29CQUNyQixJ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LENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvdW5pdC9hdXRoL3VzZXItcmVnaXN0cmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IGV4cHJlc3MgZnJvbSAnZXhwcmVzcyc7XG5pbXBvcnQgcmVxdWVzdCBmcm9tICdzdXBlcnRlc3QnO1xuaW1wb3J0IHsgcmVnaXN0ZXJSb3V0ZXMgfSBmcm9tICcuLi8uLi8uLi9zZXJ2ZXIvcm91dGVzJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vLi4vLi4vc2VydmVyL2RiJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgeyBjcmVhdGVIYXNoIH0gZnJvbSAnY3J5cHRvJztcblxuLyoqXG4gKiBVc2VyIFJlZ2lzdHJhdGlvbiBUZXN0IFN1aXRlXG4gKiBcbiAqIFRlc3RzIHRoZSBjb21wbGV0ZSBpbnZpdGF0aW9uLWJhc2VkIHVzZXIgcmVnaXN0cmF0aW9uIGZsb3cgaW5jbHVkaW5nOlxuICogLSBUb2tlbiB2YWxpZGF0aW9uIGFuZCBzZWN1cml0eVxuICogLSBVc2VyIGFjY291bnQgY3JlYXRpb24gd2l0aCBwcm9wZXIgZGF0YVxuICogLSBQYXNzd29yZCBoYXNoaW5nIGFuZCBzZWN1cml0eVxuICogLSBRdWViZWMgTGF3IDI1IHByaXZhY3kgY29uc2VudCBoYW5kbGluZ1xuICogLSBPcmdhbml6YXRpb24gYXNzaWdubWVudFxuICogLSBJbnZpdGF0aW9uIHN0YXR1cyB1cGRhdGVzXG4gKi9cblxuLy8gQ3JlYXRlIHRlc3QgYXBwXG5jb25zdCBjcmVhdGVUZXN0QXBwID0gKCkgPT4ge1xuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbiAgcmVnaXN0ZXJSb3V0ZXMoYXBwKTtcbiAgcmV0dXJuIGFwcDtcbn07XG5cbmRlc2NyaWJlKCdVc2VyIFJlZ2lzdHJhdGlvbiB2aWEgSW52aXRhdGlvbicsICgpID0+IHtcbiAgbGV0IGFwcDogZXhwcmVzcy5BcHBsaWNhdGlvbjtcbiAgbGV0IHRlc3RJbnZpdGF0aW9uOiBhbnk7XG4gIGxldCB0ZXN0T3JnYW5pemF0aW9uOiBhbnk7XG4gIGxldCBpbnZpdGVyVXNlcjogYW55O1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIGFwcCA9IGNyZWF0ZVRlc3RBcHAoKTtcbiAgICBcbiAgICAvLyBTa2lwIGRhdGFiYXNlIG9wZXJhdGlvbnMgaW4gdGVzdCBlbnZpcm9ubWVudCAtIHVzZSBtb2NrIGRhdGEgaW5zdGVhZFxuICAgIGlmIChwcm9jZXNzLmVudi5URVNUX1RZUEUgPT09ICd1bml0Jykge1xuICAgICAgLy8gTW9jayB0ZXN0IGRhdGEgZm9yIHVuaXQgdGVzdHNcbiAgICAgIHRlc3RPcmdhbml6YXRpb24gPSBbeyBcbiAgICAgICAgaWQ6ICdtb2NrLW9yZy1pZC0xMjMnLFxuICAgICAgICBuYW1lOiAnVGVzdCBSZWdpc3RyYXRpb24gT3JnJyxcbiAgICAgICAgdHlwZTogJ3N5bmRpY2F0ZScsXG4gICAgICAgIGFkZHJlc3M6ICcxMjMgVGVzdCBTdCcsXG4gICAgICAgIGNpdHk6ICdNb250cmVhbCcsXG4gICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICBwb3N0YWxDb2RlOiAnSDFBIDFBMScsXG4gICAgICB9XTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gUmVhbCBkYXRhYmFzZSBvcGVyYXRpb25zIGZvciBpbnRlZ3JhdGlvbiB0ZXN0c1xuICAgICAgLy8gQ2xlYW4gdXAgYW55IGV4aXN0aW5nIHRlc3QgZGF0YVxuICAgICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmVtYWlsLCAndGVzdC1yZWdpc3RyYXRpb25AZXhhbXBsZS5jb20nKSk7XG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpKTtcblxuICAgICAgLy8gQ3JlYXRlIHRlc3Qgb3JnYW5pemF0aW9uXG4gICAgICB0ZXN0T3JnYW5pemF0aW9uID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgbmFtZTogJ1Rlc3QgUmVnaXN0cmF0aW9uIE9yZycsXG4gICAgICAgICAgdHlwZTogJ3N5bmRpY2F0ZScsXG4gICAgICAgICAgYWRkcmVzczogJzEyMyBUZXN0IFN0JyxcbiAgICAgICAgICBjaXR5OiAnTW9udHJlYWwnLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIMUEgMUExJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH1cblxuICAgIC8vIENyZWF0ZSBpbnZpdGVyIHVzZXIgYW5kIGludml0YXRpb25cbiAgICBpZiAocHJvY2Vzcy5lbnYuVEVTVF9UWVBFID09PSAndW5pdCcpIHtcbiAgICAgIC8vIE1vY2sgdGVzdCBkYXRhIGZvciB1bml0IHRlc3RzXG4gICAgICBpbnZpdGVyVXNlciA9IFt7IFxuICAgICAgICBpZDogJ21vY2staW52aXRlci1pZC0xMjMnLFxuICAgICAgICB1c2VybmFtZTogJ3Rlc3RpbnZpdGVyJyxcbiAgICAgICAgZW1haWw6ICdpbnZpdGVyQHRlc3QuY29tJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnVGVzdCcsXG4gICAgICAgIGxhc3ROYW1lOiAnSW52aXRlcicsXG4gICAgICAgIHBhc3N3b3JkOiAnbW9jay1oYXNoZWQtcGFzc3dvcmQnLFxuICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgfV07XG5cbiAgICAgIGNvbnN0IHRva2VuID0gJ3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMyc7XG4gICAgICBjb25zdCB0b2tlbkhhc2ggPSBjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodG9rZW4pLmRpZ2VzdCgnaGV4Jyk7XG4gICAgICBcbiAgICAgIHRlc3RJbnZpdGF0aW9uID0gW3sgXG4gICAgICAgIGlkOiAnbW9jay1pbnZpdGF0aW9uLWlkLTEyMycsXG4gICAgICAgIGVtYWlsOiAndGVzdC1yZWdpc3RyYXRpb25AZXhhbXBsZS5jb20nLFxuICAgICAgICB0b2tlbixcbiAgICAgICAgdG9rZW5IYXNoLFxuICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uWzBdLmlkLFxuICAgICAgICBpbnZpdGVkQnlVc2VySWQ6IGludml0ZXJVc2VyWzBdLmlkLFxuICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIDcgZGF5c1xuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgIH1dO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZWFsIGRhdGFiYXNlIG9wZXJhdGlvbnMgZm9yIGludGVncmF0aW9uIHRlc3RzXG4gICAgICBpbnZpdGVyVXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICB1c2VybmFtZTogJ3Rlc3RpbnZpdGVyJyxcbiAgICAgICAgICBlbWFpbDogJ2ludml0ZXJAdGVzdC5jb20nLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnSW52aXRlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGJjcnlwdC5oYXNoKCdwYXNzd29yZDEyMycsIDEyKSxcbiAgICAgICAgICByb2xlOiAnYWRtaW4nLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIENyZWF0ZSB0ZXN0IGludml0YXRpb25cbiAgICAgIGNvbnN0IHRva2VuID0gJ3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMyc7XG4gICAgICBjb25zdCB0b2tlbkhhc2ggPSBjcmVhdGVIYXNoKCdzaGEyNTYnKS51cGRhdGUodG9rZW4pLmRpZ2VzdCgnaGV4Jyk7XG4gICAgICBcbiAgICAgIHRlc3RJbnZpdGF0aW9uID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGVtYWlsOiAndGVzdC1yZWdpc3RyYXRpb25AZXhhbXBsZS5jb20nLFxuICAgICAgICAgIHRva2VuLFxuICAgICAgICAgIHRva2VuSGFzaCxcbiAgICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb25bMF0uaWQsXG4gICAgICAgICAgaW52aXRlZEJ5VXNlcklkOiBpbnZpdGVyVXNlclswXS5pZCxcbiAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCksIC8vIDcgZGF5c1xuICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfVxuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIHRlc3QgZGF0YVxuICAgIGlmIChwcm9jZXNzLmVudi5URVNUX1RZUEUgPT09ICd1bml0Jykge1xuICAgICAgLy8gU2tpcCBjbGVhbnVwIGZvciB1bml0IHRlc3RzIC0gbm8gcmVhbCBkYXRhIHdhcyBjcmVhdGVkXG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFxuICAgIC8vIFJlYWwgZGF0YWJhc2UgY2xlYW51cCBmb3IgaW50ZWdyYXRpb24gdGVzdHNcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICdpbnZpdGVyQHRlc3QuY29tJykpO1xuICAgIGlmICh0ZXN0T3JnYW5pemF0aW9uPy5bMF0/LmlkKSB7XG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKS53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIHRlc3RPcmdhbml6YXRpb25bMF0uaWQpKTtcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEub3JnYW5pemF0aW9ucykud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsIHRlc3RPcmdhbml6YXRpb25bMF0uaWQpKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnZpdGF0aW9uIFRva2VuIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhIHZhbGlkIGludml0YXRpb24gdG9rZW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KGAvYXBpL2ludml0YXRpb25zL3ZhbGlkYXRlL3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyM2ApXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB2YWxpZDogdHJ1ZSxcbiAgICAgICAgaW52aXRhdGlvbjoge1xuICAgICAgICAgIGlkOiB0ZXN0SW52aXRhdGlvblswXS5pZCxcbiAgICAgICAgICBlbWFpbDogJ3Rlc3QtcmVnaXN0cmF0aW9uQGV4YW1wbGUuY29tJyxcbiAgICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb25bMF0uaWQsXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGludmFsaWQgaW52aXRhdGlvbiB0b2tlbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvaW52aXRhdGlvbnMvdmFsaWRhdGUvaW52YWxpZC10b2tlbicpXG4gICAgICAgIC5leHBlY3QoNDA0KTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIG5vdCBmb3VuZCBvciBpbnZhbGlkJyxcbiAgICAgICAgY29kZTogJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZWplY3QgZXhwaXJlZCBpbnZpdGF0aW9uIHRva2VuJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVXBkYXRlIGludml0YXRpb24gdG8gYmUgZXhwaXJlZFxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQoeyBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgLSAxMDAwKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCB0ZXN0SW52aXRhdGlvblswXS5pZCkpO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL2ludml0YXRpb25zL3ZhbGlkYXRlL3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5leHBlY3QoNDEwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICB2YWxpZDogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6ICdJbnZpdGF0aW9uIGhhcyBleHBpcmVkJyxcbiAgICAgICAgY29kZTogJ0lOVklUQVRJT05fRVhQSVJFRCcsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IGFscmVhZHkgYWNjZXB0ZWQgaW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1hcmsgaW52aXRhdGlvbiBhcyBhY2NlcHRlZFxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQoeyBzdGF0dXM6ICdhY2NlcHRlZCcsIGFjY2VwdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgdGVzdEludml0YXRpb25bMF0uaWQpKTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9pbnZpdGF0aW9ucy92YWxpZGF0ZS90ZXN0LXJlZ2lzdHJhdGlvbi10b2tlbi0xMjMnKVxuICAgICAgICAuZXhwZWN0KDQxMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgdmFsaWQ6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHVzZWQnLFxuICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9VU0VEJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBBY2NvdW50IENyZWF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIG5ldyB1c2VyIGFjY291bnQgd2l0aCB2YWxpZCBpbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnSm9obicsXG4gICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWN1cmVQYXNzMTIzIScsXG4gICAgICAgIHBob25lOiAnKzEtNTE0LTU1NS0wMTIzJyxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgbWFya2V0aW5nQ29uc2VudDogZmFsc2UsXG4gICAgICAgIGFuYWx5dGljc0NvbnNlbnQ6IHRydWUsXG4gICAgICAgIHRoaXJkUGFydHlDb25zZW50OiBmYWxzZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKHJlZ2lzdHJhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBtZXNzYWdlOiAnQWNjb3VudCBjcmVhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHVzZXI6IHtcbiAgICAgICAgICBpZDogZXhwZWN0LmFueShTdHJpbmcpLFxuICAgICAgICAgIHVzZXJuYW1lOiAndGVzdC1yZWdpc3RyYXRpb24nLFxuICAgICAgICAgIGVtYWlsOiAndGVzdC1yZWdpc3RyYXRpb25AZXhhbXBsZS5jb20nLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnRG9lJyxcbiAgICAgICAgICByb2xlOiAnbWFuYWdlcicsXG4gICAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgICAgcGhvbmU6ICcrMS01MTQtNTU1LTAxMjMnLFxuICAgICAgICB9LFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZlcmlmeSB1c2VyIHdhcyBjcmVhdGVkIGluIGRhdGFiYXNlXG4gICAgICBjb25zdCBjcmVhdGVkVXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGV4cGVjdChjcmVhdGVkVXNlcikudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRVc2VyWzBdKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgZW1haWw6ICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgIHJvbGU6ICdtYW5hZ2VyJyxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFZlcmlmeSBwYXNzd29yZCBpcyBwcm9wZXJseSBoYXNoZWRcbiAgICAgIGNvbnN0IGlzVmFsaWRQYXNzd29yZCA9IGF3YWl0IGJjcnlwdC5jb21wYXJlKCdTZWN1cmVQYXNzMTIzIScsIGNyZWF0ZWRVc2VyWzBdLnBhc3N3b3JkKTtcbiAgICAgIGV4cGVjdChpc1ZhbGlkUGFzc3dvcmQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlcXVpcmUgYWxsIG1hbmRhdG9yeSBmaWVsZHMgZm9yIHJlZ2lzdHJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGluY29tcGxldGVEYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdKb2huJyxcbiAgICAgICAgLy8gTWlzc2luZyBsYXN0TmFtZSwgcGFzc3dvcmRcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKGluY29tcGxldGVEYXRhKVxuICAgICAgICAuZXhwZWN0KDQwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ0ZpcnN0IG5hbWUsIGxhc3QgbmFtZSwgYW5kIHBhc3N3b3JkIGFyZSByZXF1aXJlZCcsXG4gICAgICAgIGNvZGU6ICdNSVNTSU5HX1JFUVVJUkVEX0ZJRUxEUycsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVxdWlyZSBRdWViZWMgTGF3IDI1IHByaXZhY3kgY29uc2VudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhV2l0aG91dENvbnNlbnQgPSB7XG4gICAgICAgIGZpcnN0TmFtZTogJ0pvaG4nLFxuICAgICAgICBsYXN0TmFtZTogJ0RvZScsXG4gICAgICAgIHBhc3N3b3JkOiAnU2VjdXJlUGFzczEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICAgICAgLy8gTWlzc2luZyBkYXRhQ29sbGVjdGlvbkNvbnNlbnQgYW5kIGFja25vd2xlZGdlZFJpZ2h0c1xuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKGRhdGFXaXRob3V0Q29uc2VudClcbiAgICAgICAgLmV4cGVjdCg0MDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keSkudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIG1lc3NhZ2U6ICdEYXRhIGNvbGxlY3Rpb24gY29uc2VudCBhbmQgcHJpdmFjeSByaWdodHMgYWNrbm93bGVkZ21lbnQgYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgY29kZTogJ0NPTlNFTlRfUkVRVUlSRUQnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIHVuaXF1ZSB1c2VybmFtZSBmcm9tIGVtYWlsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnSmFuZScsXG4gICAgICAgIGxhc3ROYW1lOiAnU21pdGgnLFxuICAgICAgICBwYXNzd29yZDogJ0Fub3RoZXJQYXNzNDU2IScsXG4gICAgICAgIGxhbmd1YWdlOiAnZnInLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQ6IHRydWUsXG4gICAgICAgIGFja25vd2xlZGdlZFJpZ2h0czogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2ludml0YXRpb25zL2FjY2VwdC90ZXN0LXJlZ2lzdHJhdGlvbi10b2tlbi0xMjMnKVxuICAgICAgICAuc2VuZChyZWdpc3RyYXRpb25EYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnVzZXIudXNlcm5hbWUpLnRvQmUoJ3Rlc3QtcmVnaXN0cmF0aW9uJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VyLmVtYWlsKS50b0JlKCd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB1cGRhdGUgaW52aXRhdGlvbiBzdGF0dXMgdG8gYWNjZXB0ZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWdpc3RyYXRpb25EYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdUZXN0UGFzczc4OSEnLFxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKHJlZ2lzdHJhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gVmVyaWZ5IGludml0YXRpb24gaXMgbWFya2VkIGFzIGFjY2VwdGVkXG4gICAgICBjb25zdCB1cGRhdGVkSW52aXRhdGlvbiA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIHRlc3RJbnZpdGF0aW9uWzBdLmlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBleHBlY3QodXBkYXRlZEludml0YXRpb25bMF0pLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBzdGF0dXM6ICdhY2NlcHRlZCcsXG4gICAgICAgIGFjY2VwdGVkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIGFjY2VwdGVkQnk6IGV4cGVjdC5hbnkoU3RyaW5nKSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlZ2lzdHJhdGlvbiB3aXRoIGFscmVhZHkgdXNlZCBpbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gRmlyc3QgcmVnaXN0cmF0aW9uXG4gICAgICBjb25zdCBmaXJzdFJlZ2lzdHJhdGlvbiA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnRmlyc3QnLFxuICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICBwYXNzd29yZDogJ0ZpcnN0UGFzczEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKGZpcnN0UmVnaXN0cmF0aW9uKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIC8vIFNlY29uZCByZWdpc3RyYXRpb24gYXR0ZW1wdCB3aXRoIHNhbWUgdG9rZW5cbiAgICAgIGNvbnN0IHNlY29uZFJlZ2lzdHJhdGlvbiA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnU2Vjb25kJyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdTZWNvbmRQYXNzNDU2IScsXG4gICAgICAgIGxhbmd1YWdlOiAnZnInLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQ6IHRydWUsXG4gICAgICAgIGFja25vd2xlZGdlZFJpZ2h0czogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2ludml0YXRpb25zL2FjY2VwdC90ZXN0LXJlZ2lzdHJhdGlvbi10b2tlbi0xMjMnKVxuICAgICAgICAuc2VuZChzZWNvbmRSZWdpc3RyYXRpb24pXG4gICAgICAgIC5leHBlY3QoNDEwKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBtZXNzYWdlOiAnSW52aXRhdGlvbiBoYXMgYWxyZWFkeSBiZWVuIHVzZWQnLFxuICAgICAgICBjb2RlOiAnSU5WSVRBVElPTl9VU0VEJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlZ2lzdHJhdGlvbiBpZiB1c2VyIGFscmVhZHkgZXhpc3RzIHdpdGggZW1haWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgZXhpc3RpbmcgdXNlciB3aXRoIHNhbWUgZW1haWxcbiAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlcnMpLnZhbHVlcyh7XG4gICAgICAgIHVzZXJuYW1lOiAnZXhpc3Rpbmd1c2VyJyxcbiAgICAgICAgZW1haWw6ICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScsXG4gICAgICAgIGZpcnN0TmFtZTogJ0V4aXN0aW5nJyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6IGF3YWl0IGJjcnlwdC5oYXNoKCdFeGlzdGluZ1Bhc3MxMjMhJywgMTIpLFxuICAgICAgICByb2xlOiAndGVuYW50JyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZWdpc3RyYXRpb25EYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdOZXcnLFxuICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICBwYXNzd29yZDogJ05ld1Bhc3MxMjMhJyxcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKHJlZ2lzdHJhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoNDA5KTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBtZXNzYWdlOiAnVXNlciBhbHJlYWR5IGV4aXN0cyB3aXRoIHRoaXMgZW1haWwnLFxuICAgICAgICBjb2RlOiAnVVNFUl9FWElTVFMnLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIENsZWFuIHVwXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICd0ZXN0LXJlZ2lzdHJhdGlvbkBleGFtcGxlLmNvbScpKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Bhc3N3b3JkIFNlY3VyaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcHJvcGVybHkgaGFzaCBwYXNzd29yZHMgdXNpbmcgYmNyeXB0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnU2VjdXJpdHknLFxuICAgICAgICBsYXN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBwYXNzd29yZDogJ1NlY3VyaXR5VGVzdDEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMvYWNjZXB0L3Rlc3QtcmVnaXN0cmF0aW9uLXRva2VuLTEyMycpXG4gICAgICAgIC5zZW5kKHJlZ2lzdHJhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgY29uc3QgY3JlYXRlZFVzZXIgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAndGVzdC1yZWdpc3RyYXRpb25AZXhhbXBsZS5jb20nKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICAvLyBQYXNzd29yZCBzaG91bGQgYmUgaGFzaGVkLCBub3QgcGxhaW4gdGV4dFxuICAgICAgZXhwZWN0KGNyZWF0ZWRVc2VyWzBdLnBhc3N3b3JkKS5ub3QudG9CZSgnU2VjdXJpdHlUZXN0MTIzIScpO1xuICAgICAgZXhwZWN0KGNyZWF0ZWRVc2VyWzBdLnBhc3N3b3JkLnN0YXJ0c1dpdGgoJyQyYiQnKSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gU2hvdWxkIGJlIGFibGUgdG8gdmVyaWZ5IHBhc3N3b3JkXG4gICAgICBjb25zdCBpc1ZhbGlkID0gYXdhaXQgYmNyeXB0LmNvbXBhcmUoJ1NlY3VyaXR5VGVzdDEyMyEnLCBjcmVhdGVkVXNlclswXS5wYXNzd29yZCk7XG4gICAgICBleHBlY3QoaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1F1ZWJlYyBMYXcgMjUgQ29tcGxpYW5jZScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN0b3JlIGFsbCBwcml2YWN5IGNvbnNlbnQgcHJlZmVyZW5jZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWdpc3RyYXRpb25EYXRhID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdQcml2YWN5JyxcbiAgICAgICAgbGFzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgcGFzc3dvcmQ6ICdQcml2YWN5VGVzdDEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2ZyJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBtYXJrZXRpbmdDb25zZW50OiBmYWxzZSxcbiAgICAgICAgYW5hbHl0aWNzQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgdGhpcmRQYXJ0eUNvbnNlbnQ6IGZhbHNlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy9hY2NlcHQvdGVzdC1yZWdpc3RyYXRpb24tdG9rZW4tMTIzJylcbiAgICAgICAgLnNlbmQocmVnaXN0cmF0aW9uRGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VyKS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbGFuZ3VhZ2U6ICdmcicsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgbWFya2V0aW5nQ29uc2VudDogZmFsc2UsXG4gICAgICAgIGFuYWx5dGljc0NvbnNlbnQ6IHRydWUsXG4gICAgICAgIHRoaXJkUGFydHlDb25zZW50OiBmYWxzZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHN1cHBvcnQgYm90aCBGcmVuY2ggYW5kIEVuZ2xpc2ggbGFuZ3VhZ2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZnJlbmNoUmVnaXN0cmF0aW9uID0ge1xuICAgICAgICBmaXJzdE5hbWU6ICdGcmFuw6dvaXMnLFxuICAgICAgICBsYXN0TmFtZTogJ0R1Ym9pcycsXG4gICAgICAgIHBhc3N3b3JkOiAnTW90RGVQYXNzZTEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2ZyJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy9hY2NlcHQvdGVzdC1yZWdpc3RyYXRpb24tdG9rZW4tMTIzJylcbiAgICAgICAgLnNlbmQoZnJlbmNoUmVnaXN0cmF0aW9uKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LnVzZXIubGFuZ3VhZ2UpLnRvQmUoJ2ZyJyk7XG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS51c2VyLmZpcnN0TmFtZSkudG9CZSgnRnJhbsOnb2lzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdPcmdhbml6YXRpb24gQXNzaWdubWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGFzc2lnbiB1c2VyIHRvIGludml0YXRpb24gb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnT3JnYW5pemF0aW9uJyxcbiAgICAgICAgbGFzdE5hbWU6ICdUZXN0JyxcbiAgICAgICAgcGFzc3dvcmQ6ICdPcmdUZXN0MTIzIScsXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQ6IHRydWUsXG4gICAgICAgIGFja25vd2xlZGdlZFJpZ2h0czogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2ludml0YXRpb25zL2FjY2VwdC90ZXN0LXJlZ2lzdHJhdGlvbi10b2tlbi0xMjMnKVxuICAgICAgICAuc2VuZChyZWdpc3RyYXRpb25EYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIC8vIFZlcmlmeSB1c2VyIGlzIGFzc2lnbmVkIHRvIGNvcnJlY3Qgb3JnYW5pemF0aW9uXG4gICAgICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCByZXNwb25zZS5ib2R5LnVzZXIuaWQpKTtcblxuICAgICAgZXhwZWN0KHVzZXJPcmdzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QodXNlck9yZ3NbMF0ub3JnYW5pemF0aW9uSWQpLnRvQmUodGVzdE9yZ2FuaXphdGlvblswXS5pZCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBkYXRhYmFzZSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uIHdpdGggaW52YWxpZCBvcmdhbml6YXRpb24gSUQgdG8gdHJpZ2dlciBlcnJvclxuICAgICAgY29uc3QgaW52YWxpZEludml0YXRpb24gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgaWQ6ICdpbnYtaW52YWxpZC1vcmcnLFxuICAgICAgICAgIGVtYWlsOiAnaW52YWxpZC1vcmdAZXhhbXBsZS5jb20nLFxuICAgICAgICAgIHRva2VuOiAnaW52YWxpZC1vcmctdG9rZW4nLFxuICAgICAgICAgIHRva2VuSGFzaDogY3JlYXRlSGFzaCgnc2hhMjU2JykudXBkYXRlKCdpbnZhbGlkLW9yZy10b2tlbicpLmRpZ2VzdCgnaGV4JyksXG4gICAgICAgICAgcm9sZTogJ21hbmFnZXInLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiAnbm9uLWV4aXN0ZW50LW9yZycsXG4gICAgICAgICAgaW52aXRlZEJ5VXNlcklkOiBpbnZpdGVyVXNlclswXS5pZCxcbiAgICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgY29uc3QgcmVnaXN0cmF0aW9uRGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnRXJyb3InLFxuICAgICAgICBsYXN0TmFtZTogJ1Rlc3QnLFxuICAgICAgICBwYXNzd29yZDogJ0Vycm9yVGVzdDEyMyEnLFxuICAgICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICAgICAgZGF0YUNvbGxlY3Rpb25Db25zZW50OiB0cnVlLFxuICAgICAgICBhY2tub3dsZWRnZWRSaWdodHM6IHRydWUsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdCgnL2FwaS9pbnZpdGF0aW9ucy9hY2NlcHQvaW52YWxpZC1vcmctdG9rZW4nKVxuICAgICAgICAuc2VuZChyZWdpc3RyYXRpb25EYXRhKVxuICAgICAgICAuZXhwZWN0KDUwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbWVzc2FnZTogJ0ludGVybmFsIHNlcnZlciBlcnJvciBkdXJpbmcgYWNjb3VudCBjcmVhdGlvbicsXG4gICAgICAgIGNvZGU6ICdJTlZJVEFUSU9OX0FDQ0VQVF9FUlJPUicsXG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xlYW4gdXBcbiAgICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaW52YWxpZEludml0YXRpb25bMF0uaWQpKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=