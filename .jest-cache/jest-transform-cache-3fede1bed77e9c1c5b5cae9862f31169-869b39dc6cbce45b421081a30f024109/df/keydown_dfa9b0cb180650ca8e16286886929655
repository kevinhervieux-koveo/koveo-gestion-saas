b9edab3157c8f0f32e89978e1ce0687f
'use strict';
var UI = require('../../document/UI.js');
var getValueOrTextContent = require('../../document/getValueOrTextContent.js');
var isElementType = require('../../utils/misc/isElementType.js');
require('../../utils/dataTransfer/Clipboard.js');
var isContentEditable = require('../../utils/edit/isContentEditable.js');
var isEditable = require('../../utils/edit/isEditable.js');
var getTabDestination = require('../../utils/focus/getTabDestination.js');
var selection = require('../../utils/focus/selection.js');
var focus = require('../focus.js');
var input = require('../input.js');
var moveSelection = require('../selection/moveSelection.js');
var selectAll = require('../selection/selectAll.js');
var setSelectionRange = require('../selection/setSelectionRange.js');
var radio = require('../radio.js');
var registry = require('./registry.js');
registry.behavior.keydown = (event, target, instance) => {
    var _keydownBehavior_event_key;
    var _keydownBehavior_event_key1;
    return (_keydownBehavior_event_key1 = (_keydownBehavior_event_key = keydownBehavior[event.key]) === null || _keydownBehavior_event_key === undefined ? undefined : _keydownBehavior_event_key.call(keydownBehavior, event, target, instance)) !== null && _keydownBehavior_event_key1 !== undefined ? _keydownBehavior_event_key1 : combinationBehavior(event, target, instance);
};
const keydownBehavior = {
    ArrowDown: (event, target, instance) => {
        /* istanbul ignore else */ if (isElementType.isElementType(target, 'input', {
            type: 'radio'
        })) {
            return () => radio.walkRadio(instance, target, 1);
        }
    },
    ArrowLeft: (event, target, instance) => {
        if (isElementType.isElementType(target, 'input', {
            type: 'radio'
        })) {
            return () => radio.walkRadio(instance, target, -1);
        }
        return () => moveSelection.moveSelection(target, -1);
    },
    ArrowRight: (event, target, instance) => {
        if (isElementType.isElementType(target, 'input', {
            type: 'radio'
        })) {
            return () => radio.walkRadio(instance, target, 1);
        }
        return () => moveSelection.moveSelection(target, 1);
    },
    ArrowUp: (event, target, instance) => {
        /* istanbul ignore else */ if (isElementType.isElementType(target, 'input', {
            type: 'radio'
        })) {
            return () => radio.walkRadio(instance, target, -1);
        }
    },
    Backspace: (event, target, instance) => {
        if (isEditable.isEditable(target)) {
            return () => {
                input.input(instance, target, '', 'deleteContentBackward');
            };
        }
    },
    Delete: (event, target, instance) => {
        if (isEditable.isEditable(target)) {
            return () => {
                input.input(instance, target, '', 'deleteContentForward');
            };
        }
    },
    End: (event, target) => {
        if (isElementType.isElementType(target, [
            'input',
            'textarea'
        ]) || isContentEditable.isContentEditable(target)) {
            return () => {
                var _getValueOrTextContent;
                var _getValueOrTextContent_length;
                const newPos = (_getValueOrTextContent_length = (_getValueOrTextContent = getValueOrTextContent.getValueOrTextContent(target)) === null || _getValueOrTextContent === undefined ? undefined : _getValueOrTextContent.length) !== null && _getValueOrTextContent_length !== undefined ? _getValueOrTextContent_length : /* istanbul ignore next */ 0;
                setSelectionRange.setSelectionRange(target, newPos, newPos);
            };
        }
    },
    Home: (event, target) => {
        if (isElementType.isElementType(target, [
            'input',
            'textarea'
        ]) || isContentEditable.isContentEditable(target)) {
            return () => {
                setSelectionRange.setSelectionRange(target, 0, 0);
            };
        }
    },
    PageDown: (event, target) => {
        if (isElementType.isElementType(target, [
            'input'
        ])) {
            return () => {
                const newPos = UI.getUIValue(target).length;
                setSelectionRange.setSelectionRange(target, newPos, newPos);
            };
        }
    },
    PageUp: (event, target) => {
        if (isElementType.isElementType(target, [
            'input'
        ])) {
            return () => {
                setSelectionRange.setSelectionRange(target, 0, 0);
            };
        }
    },
    Tab: (event, target, instance) => {
        return () => {
            const dest = getTabDestination.getTabDestination(target, instance.system.keyboard.modifiers.Shift);
            focus.focusElement(dest);
            if (selection.hasOwnSelection(dest)) {
                UI.setUISelection(dest, {
                    anchorOffset: 0,
                    focusOffset: dest.value.length
                });
            }
        };
    }
};
const combinationBehavior = (event, target, instance) => {
    if (event.code === 'KeyA' && instance.system.keyboard.modifiers.Control) {
        return () => selectAll.selectAll(target);
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50L2Rpc3QvY2pzL2V2ZW50L2JlaGF2aW9yL2tleWRvd24uanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsSUFBSSxFQUFFLEdBQUcsT0FBTyxDQUFDLHNCQUFzQixDQUFDLENBQUM7QUFDekMsSUFBSSxxQkFBcUIsR0FBRyxPQUFPLENBQUMseUNBQXlDLENBQUMsQ0FBQztBQUMvRSxJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMsbUNBQW1DLENBQUMsQ0FBQztBQUNqRSxPQUFPLENBQUMsdUNBQXVDLENBQUMsQ0FBQztBQUNqRCxJQUFJLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyx1Q0FBdUMsQ0FBQyxDQUFDO0FBQ3pFLElBQUksVUFBVSxHQUFHLE9BQU8sQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO0FBQzNELElBQUksaUJBQWlCLEdBQUcsT0FBTyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7QUFDMUUsSUFBSSxTQUFTLEdBQUcsT0FBTyxDQUFDLGdDQUFnQyxDQUFDLENBQUM7QUFDMUQsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ25DLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNuQyxJQUFJLGFBQWEsR0FBRyxPQUFPLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUM3RCxJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsMkJBQTJCLENBQUMsQ0FBQztBQUNyRCxJQUFJLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0FBQ3JFLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUNuQyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFFeEMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFF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LE1BQU0sSUFBSSxHQUFHLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLE1BQU0sRUFBRSxRQUFRLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDbkcsS0FBSyxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN6QixJQUFJLFNBQVMsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDbEMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLEVBQUU7b0JBQ3BCLFlBQVksRUFBRSxDQUFDO29CQUNmLFdBQVcsRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07aUJBQ2pDLENBQUMsQ0FBQztZQUNQLENBQUM7UUFDTCxDQUFDLENBQUM7SUFDTixDQUFDO0NBQ0osQ0FBQztBQUNGLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxLQUFLLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBQyxFQUFFO0lBQ25ELElBQUksS0FBSyxDQUFDLElBQUksS0FBSyxNQUFNLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3RFLE9BQU8sR0FBRSxFQUFFLENBQUEsU0FBUyxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMzQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvbm9kZV9tb2R1bGVzL0B0ZXN0aW5nLWxpYnJhcnkvdXNlci1ldmVudC9kaXN0L2Nqcy9ldmVudC9iZWhhdmlvci9rZXlkb3duLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxudmFyIFVJID0gcmVxdWlyZSgnLi4vLi4vZG9jdW1lbnQvVUkuanMnKTtcbnZhciBnZXRWYWx1ZU9yVGV4dENvbnRlbnQgPSByZXF1aXJlKCcuLi8uLi9kb2N1bWVudC9nZXRWYWx1ZU9yVGV4dENvbnRlbnQuanMnKTtcbnZhciBpc0VsZW1lbnRUeXBlID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvbWlzYy9pc0VsZW1lbnRUeXBlLmpzJyk7XG5yZXF1aXJlKCcuLi8uLi91dGlscy9kYXRhVHJhbnNmZXIvQ2xpcGJvYXJkLmpzJyk7XG52YXIgaXNDb250ZW50RWRpdGFibGUgPSByZXF1aXJlKCcuLi8uLi91dGlscy9lZGl0L2lzQ29udGVudEVkaXRhYmxlLmpzJyk7XG52YXIgaXNFZGl0YWJsZSA9IHJlcXVpcmUoJy4uLy4uL3V0aWxzL2VkaXQvaXNFZGl0YWJsZS5qcycpO1xudmFyIGdldFRhYkRlc3RpbmF0aW9uID0gcmVxdWlyZSgnLi4vLi4vdXRpbHMvZm9jdXMvZ2V0VGFiRGVzdGluYXRpb24uanMnKTtcbnZhciBzZWxlY3Rpb24gPSByZXF1aXJlKCcuLi8uLi91dGlscy9mb2N1cy9zZWxlY3Rpb24uanMnKTtcbnZhciBmb2N1cyA9IHJlcXVpcmUoJy4uL2ZvY3VzLmpzJyk7XG52YXIgaW5wdXQgPSByZXF1aXJlKCcuLi9pbnB1dC5qcycpO1xudmFyIG1vdmVTZWxlY3Rpb24gPSByZXF1aXJlKCcuLi9zZWxlY3Rpb24vbW92ZVNlbGVjdGlvbi5qcycpO1xudmFyIHNlbGVjdEFsbCA9IHJlcXVpcmUoJy4uL3NlbGVjdGlvbi9zZWxlY3RBbGwuanMnKTtcbnZhciBzZXRTZWxlY3Rpb25SYW5nZSA9IHJlcXVpcmUoJy4uL3NlbGVjdGlvbi9zZXRTZWxlY3Rpb25SYW5nZS5qcycpO1xudmFyIHJhZGlvID0gcmVxdWlyZSgnLi4vcmFkaW8uanMnKTtcbnZhciByZWdpc3RyeSA9IHJlcXVpcmUoJy4vcmVnaXN0cnkuanMnKTtcblxucmVnaXN0cnkuYmVoYXZpb3Iua2V5ZG93biA9IChldmVudCwgdGFyZ2V0LCBpbnN0YW5jZSk9PntcbiAgICB2YXIgX2tleWRvd25CZWhhdmlvcl9ldmVudF9rZXk7XG4gICAgdmFyIF9rZXlkb3duQmVoYXZpb3JfZXZlbnRfa2V5MTtcbiAgICByZXR1cm4gKF9rZXlkb3duQmVoYXZpb3JfZXZlbnRfa2V5MSA9IChfa2V5ZG93bkJlaGF2aW9yX2V2ZW50X2tleSA9IGtleWRvd25CZWhhdmlvcltldmVudC5rZXldKSA9PT0gbnVsbCB8fCBfa2V5ZG93bkJlaGF2aW9yX2V2ZW50X2tleSA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogX2tleWRvd25CZWhhdmlvcl9ldmVudF9rZXkuY2FsbChrZXlkb3duQmVoYXZpb3IsIGV2ZW50LCB0YXJnZXQsIGluc3RhbmNlKSkgIT09IG51bGwgJiYgX2tleWRvd25CZWhhdmlvcl9ldmVudF9rZXkxICE9PSB1bmRlZmluZWQgPyBfa2V5ZG93bkJlaGF2aW9yX2V2ZW50X2tleTEgOiBjb21iaW5hdGlvbkJlaGF2aW9yKGV2ZW50LCB0YXJnZXQsIGluc3RhbmNlKTtcbn07XG5jb25zdCBrZXlkb3duQmVoYXZpb3IgPSB7XG4gICAgQXJyb3dEb3duOiAoZXZlbnQsIHRhcmdldCwgaW5zdGFuY2UpPT57XG4gICAgICAgIC8qIGlzdGFuYnVsIGlnbm9yZSBlbHNlICovIGlmIChpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUodGFyZ2V0LCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAncmFkaW8nXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PnJhZGlvLndhbGtSYWRpbyhpbnN0YW5jZSwgdGFyZ2V0LCAxKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgQXJyb3dMZWZ0OiAoZXZlbnQsIHRhcmdldCwgaW5zdGFuY2UpPT57XG4gICAgICAgIGlmIChpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUodGFyZ2V0LCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAncmFkaW8nXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PnJhZGlvLndhbGtSYWRpbyhpbnN0YW5jZSwgdGFyZ2V0LCAtMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgpPT5tb3ZlU2VsZWN0aW9uLm1vdmVTZWxlY3Rpb24odGFyZ2V0LCAtMSk7XG4gICAgfSxcbiAgICBBcnJvd1JpZ2h0OiAoZXZlbnQsIHRhcmdldCwgaW5zdGFuY2UpPT57XG4gICAgICAgIGlmIChpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUodGFyZ2V0LCAnaW5wdXQnLCB7XG4gICAgICAgICAgICB0eXBlOiAncmFkaW8nXG4gICAgICAgIH0pKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PnJhZGlvLndhbGtSYWRpbyhpbnN0YW5jZSwgdGFyZ2V0LCAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCk9Pm1vdmVTZWxlY3Rpb24ubW92ZVNlbGVjdGlvbih0YXJnZXQsIDEpO1xuICAgIH0sXG4gICAgQXJyb3dVcDogKGV2ZW50LCB0YXJnZXQsIGluc3RhbmNlKT0+e1xuICAgICAgICAvKiBpc3RhbmJ1bCBpZ25vcmUgZWxzZSAqLyBpZiAoaXNFbGVtZW50VHlwZS5pc0VsZW1lbnRUeXBlKHRhcmdldCwgJ2lucHV0Jywge1xuICAgICAgICAgICAgdHlwZTogJ3JhZGlvJ1xuICAgICAgICB9KSkge1xuICAgICAgICAgICAgcmV0dXJuICgpPT5yYWRpby53YWxrUmFkaW8oaW5zdGFuY2UsIHRhcmdldCwgLTEpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBCYWNrc3BhY2U6IChldmVudCwgdGFyZ2V0LCBpbnN0YW5jZSk9PntcbiAgICAgICAgaWYgKGlzRWRpdGFibGUuaXNFZGl0YWJsZSh0YXJnZXQpKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PntcbiAgICAgICAgICAgICAgICBpbnB1dC5pbnB1dChpbnN0YW5jZSwgdGFyZ2V0LCAnJywgJ2RlbGV0ZUNvbnRlbnRCYWNrd2FyZCcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgRGVsZXRlOiAoZXZlbnQsIHRhcmdldCwgaW5zdGFuY2UpPT57XG4gICAgICAgIGlmIChpc0VkaXRhYmxlLmlzRWRpdGFibGUodGFyZ2V0KSkge1xuICAgICAgICAgICAgcmV0dXJuICgpPT57XG4gICAgICAgICAgICAgICAgaW5wdXQuaW5wdXQoaW5zdGFuY2UsIHRhcmdldCwgJycsICdkZWxldGVDb250ZW50Rm9yd2FyZCcpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgRW5kOiAoZXZlbnQsIHRhcmdldCk9PntcbiAgICAgICAgaWYgKGlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZSh0YXJnZXQsIFtcbiAgICAgICAgICAgICdpbnB1dCcsXG4gICAgICAgICAgICAndGV4dGFyZWEnXG4gICAgICAgIF0pIHx8IGlzQ29udGVudEVkaXRhYmxlLmlzQ29udGVudEVkaXRhYmxlKHRhcmdldCkpIHtcbiAgICAgICAgICAgIHJldHVybiAoKT0+e1xuICAgICAgICAgICAgICAgIHZhciBfZ2V0VmFsdWVPclRleHRDb250ZW50O1xuICAgICAgICAgICAgICAgIHZhciBfZ2V0VmFsdWVPclRleHRDb250ZW50X2xlbmd0aDtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQb3MgPSAoX2dldFZhbHVlT3JUZXh0Q29udGVudF9sZW5ndGggPSAoX2dldFZhbHVlT3JUZXh0Q29udGVudCA9IGdldFZhbHVlT3JUZXh0Q29udGVudC5nZXRWYWx1ZU9yVGV4dENvbnRlbnQodGFyZ2V0KSkgPT09IG51bGwgfHwgX2dldFZhbHVlT3JUZXh0Q29udGVudCA9PT0gdW5kZWZpbmVkID8gdW5kZWZpbmVkIDogX2dldFZhbHVlT3JUZXh0Q29udGVudC5sZW5ndGgpICE9PSBudWxsICYmIF9nZXRWYWx1ZU9yVGV4dENvbnRlbnRfbGVuZ3RoICE9PSB1bmRlZmluZWQgPyBfZ2V0VmFsdWVPclRleHRDb250ZW50X2xlbmd0aCA6IC8qIGlzdGFuYnVsIGlnbm9yZSBuZXh0ICovIDA7XG4gICAgICAgICAgICAgICAgc2V0U2VsZWN0aW9uUmFuZ2Uuc2V0U2VsZWN0aW9uUmFuZ2UodGFyZ2V0LCBuZXdQb3MsIG5ld1Bvcyk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSxcbiAgICBIb21lOiAoZXZlbnQsIHRhcmdldCk9PntcbiAgICAgICAgaWYgKGlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZSh0YXJnZXQsIFtcbiAgICAgICAgICAgICdpbnB1dCcsXG4gICAgICAgICAgICAndGV4dGFyZWEnXG4gICAgICAgIF0pIHx8IGlzQ29udGVudEVkaXRhYmxlLmlzQ29udGVudEVkaXRhYmxlKHRhcmdldCkpIHtcbiAgICAgICAgICAgIHJldHVybiAoKT0+e1xuICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblJhbmdlLnNldFNlbGVjdGlvblJhbmdlKHRhcmdldCwgMCwgMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSxcbiAgICBQYWdlRG93bjogKGV2ZW50LCB0YXJnZXQpPT57XG4gICAgICAgIGlmIChpc0VsZW1lbnRUeXBlLmlzRWxlbWVudFR5cGUodGFyZ2V0LCBbXG4gICAgICAgICAgICAnaW5wdXQnXG4gICAgICAgIF0pKSB7XG4gICAgICAgICAgICByZXR1cm4gKCk9PntcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdQb3MgPSBVSS5nZXRVSVZhbHVlKHRhcmdldCkubGVuZ3RoO1xuICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblJhbmdlLnNldFNlbGVjdGlvblJhbmdlKHRhcmdldCwgbmV3UG9zLCBuZXdQb3MpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgUGFnZVVwOiAoZXZlbnQsIHRhcmdldCk9PntcbiAgICAgICAgaWYgKGlzRWxlbWVudFR5cGUuaXNFbGVtZW50VHlwZSh0YXJnZXQsIFtcbiAgICAgICAgICAgICdpbnB1dCdcbiAgICAgICAgXSkpIHtcbiAgICAgICAgICAgIHJldHVybiAoKT0+e1xuICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblJhbmdlLnNldFNlbGVjdGlvblJhbmdlKHRhcmdldCwgMCwgMCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSxcbiAgICBUYWI6IChldmVudCwgdGFyZ2V0LCBpbnN0YW5jZSk9PntcbiAgICAgICAgcmV0dXJuICgpPT57XG4gICAgICAgICAgICBjb25zdCBkZXN0ID0gZ2V0VGFiRGVzdGluYXRpb24uZ2V0VGFiRGVzdGluYXRpb24odGFyZ2V0LCBpbnN0YW5jZS5zeXN0ZW0ua2V5Ym9hcmQubW9kaWZpZXJzLlNoaWZ0KTtcbiAgICAgICAgICAgIGZvY3VzLmZvY3VzRWxlbWVudChkZXN0KTtcbiAgICAgICAgICAgIGlmIChzZWxlY3Rpb24uaGFzT3duU2VsZWN0aW9uKGRlc3QpKSB7XG4gICAgICAgICAgICAgICAgVUkuc2V0VUlTZWxlY3Rpb24oZGVzdCwge1xuICAgICAgICAgICAgICAgICAgICBhbmNob3JPZmZzZXQ6IDAsXG4gICAgICAgICAgICAgICAgICAgIGZvY3VzT2Zmc2V0OiBkZXN0LnZhbHVlLmxlbmd0aFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn07XG5jb25zdCBjb21iaW5hdGlvbkJlaGF2aW9yID0gKGV2ZW50LCB0YXJnZXQsIGluc3RhbmNlKT0+e1xuICAgIGlmIChldmVudC5jb2RlID09PSAnS2V5QScgJiYgaW5zdGFuY2Uuc3lzdGVtLmtleWJvYXJkLm1vZGlmaWVycy5Db250cm9sKSB7XG4gICAgICAgIHJldHVybiAoKT0+c2VsZWN0QWxsLnNlbGVjdEFsbCh0YXJnZXQpO1xuICAgIH1cbn07XG4iXSwidmVyc2lvbiI6M30=