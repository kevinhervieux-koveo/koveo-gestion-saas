fc13b64e447b5f68a9dcc875f15ec284
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const globals_1 = require("@jest/globals");
globals_1.jest.mock('wouter', () => ({
    useLocation: () => [mockCurrentLocation, mockSetLocation],
    useSearch: () => mockCurrentSearch,
}));
/**
 * Hierarchical Navigation User Flow Tests
 * Tests complete user scenarios and flows through the hierarchical navigation system
 */
const react_1 = __importStar(require("react"));
const react_2 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
const withHierarchicalSelection_1 = require("@/components/hoc/withHierarchicalSelection");
require("@testing-library/jest-dom");
// Mock wouter
const mockSetLocation = globals_1.jest.fn();
let mockCurrentLocation = '/residents/building';
let mockCurrentSearch = '';
// Mock fetch for API calls
const mockFetch = globals_1.jest.fn();
global.fetch = mockFetch;
// Mock building data scenarios
const SINGLE_BUILDING_USER_DATA = [
    { id: 'building-1', name: 'Building A', address: '123 Main St' }
];
const MULTIPLE_BUILDINGS_USER_DATA = [
    { id: 'building-1', name: 'Building A', address: '123 Main St' },
    { id: 'building-2', name: 'Building B', address: '456 Oak Ave' },
    { id: 'building-3', name: 'Building C', address: '789 Pine Rd' }
];
const SINGLE_BUILDING_DETAILS = {
    id: 'building-1',
    name: 'Building A',
    address: '123 Main St',
    city: 'Montreal',
    province: 'QC',
    postalCode: 'H1A 1A1',
    totalUnits: 50,
    occupiedUnits: 45,
    occupancyRate: 90,
    buildingType: 'residential',
    yearBuilt: 2020,
};
// Mock page components that use hierarchical navigation
const MockBuildingPage = () => {
    const [showSelection, setShowSelection] = react_1.default.useState(true);
    const [selectedBuilding, setSelectedBuilding] = react_1.default.useState(null);
    const [buildings, setBuildings] = react_1.default.useState([]);
    const [isLoading, setIsLoading] = react_1.default.useState(true);
    react_1.default.useEffect(() => {
        // Simulate API call based on URL
        const urlParams = new URLSearchParams(mockCurrentSearch);
        const buildingId = urlParams.get('building');
        if (buildingId) {
            setSelectedBuilding(buildingId);
            setShowSelection(false);
        }
        else {
            setShowSelection(true);
        }
        // Mock API call delay
        setTimeout(() => {
            setBuildings(MULTIPLE_BUILDINGS_USER_DATA);
            setIsLoading(false);
        }, 100);
    }, [mockCurrentSearch]);
    const handleBuildingSelect = (buildingId) => {
        setSelectedBuilding(buildingId);
        setShowSelection(false);
        mockCurrentSearch = `?building=${buildingId}`;
        mockSetLocation(`/residents/building?building=${buildingId}`);
    };
    const handleBack = () => {
        setSelectedBuilding(null);
        setShowSelection(true);
        mockCurrentSearch = '';
        mockSetLocation('/residents/building');
    };
    if (isLoading) {
        return ((0, jsx_runtime_1.jsx)("div", { "data-testid": "loading-state", children: (0, jsx_runtime_1.jsx)("div", { "data-testid": "loading-spinner", children: "Loading..." }) }));
    }
    if (showSelection) {
        return ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "building-selection-screen", children: [(0, jsx_runtime_1.jsx)("h1", { "data-testid": "selection-title", children: "Select Building" }), (0, jsx_runtime_1.jsx)("div", { "data-testid": "buildings-grid", children: buildings.map((building) => ((0, jsx_runtime_1.jsxs)("button", { "data-testid": `building-card-${building.id}`, onClick: () => handleBuildingSelect(building.id), className: "building-card", children: [(0, jsx_runtime_1.jsx)("h3", { children: building.name }), (0, jsx_runtime_1.jsx)("p", { children: building.address })] }, building.id))) })] }));
    }
    return ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "building-details-screen", children: [(0, jsx_runtime_1.jsxs)("div", { "data-testid": "header-with-back", children: [buildings.length > 1 && ((0, jsx_runtime_1.jsx)("button", { "data-testid": "back-to-buildings", onClick: handleBack, children: "Back to Buildings" })), (0, jsx_runtime_1.jsx)("h1", { "data-testid": "building-title", children: "Building Details" })] }), (0, jsx_runtime_1.jsxs)("div", { "data-testid": "building-info", children: [(0, jsx_runtime_1.jsx)("p", { "data-testid": "selected-building-id", children: selectedBuilding }), (0, jsx_runtime_1.jsx)("p", { children: "Building information and details" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": "view-documents-btn", children: "View Documents" })] })] }));
};
// Mock single building scenario
const MockSingleBuildingPage = () => {
    const [selectedBuilding, setSelectedBuilding] = react_1.default.useState('building-1');
    const [buildings] = react_1.default.useState(SINGLE_BUILDING_USER_DATA);
    // Auto-forward for single building user
    react_1.default.useEffect(() => {
        if (buildings.length === 1 && !mockCurrentSearch.includes('building=')) {
            mockCurrentSearch = `?building=${buildings[0].id}`;
            mockSetLocation(`/residents/building?building=${buildings[0].id}`);
        }
    }, [buildings]);
    return ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "single-building-details-screen", children: [(0, jsx_runtime_1.jsx)("div", { "data-testid": "header-no-back", children: (0, jsx_runtime_1.jsx)("h1", { "data-testid": "building-title", children: "Building Details" }) }), (0, jsx_runtime_1.jsxs)("div", { "data-testid": "building-info", children: [(0, jsx_runtime_1.jsx)("p", { "data-testid": "selected-building-id", children: selectedBuilding }), (0, jsx_runtime_1.jsx)("p", { children: "Single building - no back button" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": "view-documents-btn", children: "View Documents" })] })] }));
};
(0, globals_1.describe)('Hierarchical Navigation User Flows', () => {
    let queryClient;
    (0, globals_1.beforeEach)(() => {
        queryClient = new react_query_1.QueryClient({
            defaultOptions: {
                queries: {
                    retry: false,
                },
            },
        });
        // Reset mocks and state
        globals_1.jest.clearAllMocks();
        mockSetLocation.mockClear();
        mockCurrentLocation = '/residents/building';
        mockCurrentSearch = '';
        // Mock window.history
        Object.defineProperty(window, 'history', {
            value: {
                pushState: globals_1.jest.fn(),
            },
            writable: true,
        });
        // Mock successful API responses
        mockFetch.mockResolvedValue({
            ok: true,
            json: async () => MULTIPLE_BUILDINGS_USER_DATA,
        });
    });
    (0, globals_1.afterEach)(() => {
        globals_1.jest.resetAllMocks();
    });
    const renderWithProviders = (component) => {
        return (0, react_2.render)((0, jsx_runtime_1.jsx)(react_query_1.QueryClientProvider, { client: queryClient, children: component }));
    };
    (0, globals_1.describe)('Multiple Buildings User Flow', () => {
        (0, globals_1.test)('should complete full user flow: landing → selection → details → back', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            // 1. Initial landing - should show loading then selection
            (0, globals_1.expect)(react_2.screen.getByTestId('loading-state')).toBeInTheDocument();
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Building');
            (0, globals_1.expect)(react_2.screen.getByTestId('buildings-grid')).toBeInTheDocument();
            // Should show all available buildings
            (0, globals_1.expect)(react_2.screen.getByTestId('building-card-building-1')).toHaveTextContent('Building A');
            (0, globals_1.expect)(react_2.screen.getByTestId('building-card-building-2')).toHaveTextContent('Building B');
            (0, globals_1.expect)(react_2.screen.getByTestId('building-card-building-3')).toHaveTextContent('Building C');
            // 2. User selects a building
            const building2Card = react_2.screen.getByTestId('building-card-building-2');
            react_2.fireEvent.click(building2Card);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Should show building details with back button
            (0, globals_1.expect)(react_2.screen.getByTestId('building-title')).toHaveTextContent('Building Details');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-2');
            (0, globals_1.expect)(react_2.screen.getByTestId('back-to-buildings')).toBeInTheDocument();
            // Should update router
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building?building=building-2');
            // 3. User clicks back
            const backButton = react_2.screen.getByTestId('back-to-buildings');
            react_2.fireEvent.click(backButton);
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            // Should return to selection screen
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Building');
            (0, globals_1.expect)(react_2.screen.getByTestId('buildings-grid')).toBeInTheDocument();
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building');
        });
        (0, globals_1.test)('should handle direct URL navigation to building details', async () => {
            // Simulate direct navigation to building details
            mockCurrentSearch = '?building=building-1';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Should land directly on building details
            (0, globals_1.expect)(react_2.screen.getByTestId('building-title')).toHaveTextContent('Building Details');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-1');
            (0, globals_1.expect)(react_2.screen.getByTestId('back-to-buildings')).toBeInTheDocument();
        });
        (0, globals_1.test)('should show back button only when multiple buildings are available', async () => {
            mockCurrentSearch = '?building=building-2';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // With multiple buildings, should show back button
            (0, globals_1.expect)(react_2.screen.getByTestId('back-to-buildings')).toBeInTheDocument();
        });
        (0, globals_1.test)('should handle building selection errors gracefully', async () => {
            // Mock API failure
            mockFetch.mockRejectedValue(new Error('API Error'));
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            // Should handle loading state
            (0, globals_1.expect)(react_2.screen.getByTestId('loading-state')).toBeInTheDocument();
            // After timeout, should still show selection screen (even with empty data)
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.queryByTestId('loading-spinner')).not.toBeInTheDocument();
            });
        });
    });
    (0, globals_1.describe)('Single Building User Flow', () => {
        (0, globals_1.test)('should auto-forward single building users to details', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(MockSingleBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('single-building-details-screen')).toBeInTheDocument();
            });
            // Should land directly on details, no selection screen
            (0, globals_1.expect)(react_2.screen.getByTestId('building-title')).toHaveTextContent('Building Details');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-1');
            // Should NOT show back button (single building)
            (0, globals_1.expect)(react_2.screen.queryByTestId('back-to-buildings')).not.toBeInTheDocument();
            (0, globals_1.expect)(react_2.screen.getByTestId('header-no-back')).toBeInTheDocument();
            // Should auto-forward URL
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building?building=building-1');
        });
        (0, globals_1.test)('should handle single building direct URL access', async () => {
            // User directly accesses with building param
            mockCurrentSearch = '?building=building-1';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockSingleBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('single-building-details-screen')).toBeInTheDocument();
            });
            // Should show details without back button
            (0, globals_1.expect)(react_2.screen.getByTestId('building-title')).toHaveTextContent('Building Details');
            (0, globals_1.expect)(react_2.screen.queryByTestId('back-to-buildings')).not.toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('URL State Management', () => {
        (0, globals_1.test)('should maintain URL consistency throughout navigation', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            // Start with base URL
            (0, globals_1.expect)(mockCurrentLocation).toBe('/residents/building');
            (0, globals_1.expect)(mockCurrentSearch).toBe('');
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            // Select building - should update URL
            const buildingCard = react_2.screen.getByTestId('building-card-building-1');
            react_2.fireEvent.click(buildingCard);
            (0, globals_1.expect)(mockCurrentSearch).toBe('?building=building-1');
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building?building=building-1');
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Go back - should clear URL parameters
            const backButton = react_2.screen.getByTestId('back-to-buildings');
            react_2.fireEvent.click(backButton);
            (0, globals_1.expect)(mockCurrentSearch).toBe('');
            (0, globals_1.expect)(mockSetLocation).toHaveBeenCalledWith('/residents/building');
        });
        (0, globals_1.test)('should handle malformed URL parameters', async () => {
            // Simulate malformed or non-existent building ID
            mockCurrentSearch = '?building=nonexistent-id';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Should still attempt to show details (graceful degradation)
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('nonexistent-id');
        });
        (0, globals_1.test)('should handle multiple URL parameters correctly', async () => {
            // Simulate URL with extra parameters
            mockCurrentSearch = '?building=building-1&extra=param&another=value';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Should extract building parameter correctly
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-1');
        });
    });
    (0, globals_1.describe)('User Experience Scenarios', () => {
        (0, globals_1.test)('should handle quick back-and-forth navigation', async () => {
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            // Quick selection
            react_2.fireEvent.click(react_2.screen.getByTestId('building-card-building-1'));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
            });
            // Quick back
            react_2.fireEvent.click(react_2.screen.getByTestId('back-to-buildings'));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            // Select different building
            react_2.fireEvent.click(react_2.screen.getByTestId('building-card-building-3'));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
                (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-3');
            });
        });
        (0, globals_1.test)('should preserve selection when navigating away and back', async () => {
            // Simulate user navigating to building details
            mockCurrentSearch = '?building=building-2';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-details-screen')).toBeInTheDocument();
                (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-2');
            });
            // Simulate user navigating away (e.g., to another page) and back
            // In a real app, this would be handled by route changes
            mockCurrentSearch = '';
            // Simulate returning to the page
            renderWithProviders((0, jsx_runtime_1.jsx)(MockBuildingPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            // Should show selection screen (no preserved state without URL params)
            (0, globals_1.expect)(react_2.screen.getByTestId('buildings-grid')).toBeInTheDocument();
        });
    });
    (0, globals_1.describe)('Manager Residences Page Navigation Flow', () => {
        // Mock Manager Residences page component with organization → building hierarchy
        const MockManagerResidencesPage = (0, withHierarchicalSelection_1.withHierarchicalSelection)(() => {
            const { organizationId, buildingId, showBackButton, onBack } = (0, react_1.useContext)(withHierarchicalSelection_1.HierarchyContext);
            return ((0, jsx_runtime_1.jsxs)("div", { "data-testid": "manager-residences-screen", children: [(0, jsx_runtime_1.jsx)("div", { "data-testid": "residences-title", children: "Manager Residences" }), (0, jsx_runtime_1.jsx)("div", { "data-testid": "selected-organization-id", children: organizationId || 'none' }), (0, jsx_runtime_1.jsx)("div", { "data-testid": "selected-building-id", children: buildingId || 'none' }), showBackButton && ((0, jsx_runtime_1.jsx)("button", { "data-testid": "back-to-selection", onClick: onBack, children: "Back to Selection" }))] }));
        }, {
            hierarchy: ['organization', 'building']
        });
        (0, globals_1.test)('should navigate through organization → building flow for manager residences', async () => {
            // Mock API responses for organizations and buildings
            const mockOrganizationsData = [
                { id: 'org-1', name: 'Organization A' },
                { id: 'org-2', name: 'Organization B' },
            ];
            const mockBuildingsData = [
                { id: 'building-1', name: 'Building A', organizationId: 'org-1' },
                { id: 'building-2', name: 'Building B', organizationId: 'org-1' },
            ];
            let apiCallCount = 0;
            mockFetch.mockImplementation((url) => {
                apiCallCount++;
                if (url.includes('/api/organizations')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => mockOrganizationsData,
                    });
                }
                if (url.includes('/api/manager/buildings')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => ({ buildings: mockBuildingsData }),
                    });
                }
                return Promise.reject(new Error(`Unexpected URL: ${url}`));
            });
            renderWithProviders((0, jsx_runtime_1.jsx)(MockManagerResidencesPage, {}));
            // 1. Should start with organization selection
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('organization-selection-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Organization');
            (0, globals_1.expect)(react_2.screen.getByTestId('org-card-org-1')).toHaveTextContent('Organization A');
            (0, globals_1.expect)(react_2.screen.getByTestId('org-card-org-2')).toHaveTextContent('Organization B');
            // 2. Select an organization
            react_2.fireEvent.click(react_2.screen.getByTestId('org-card-org-1'));
            // 3. Should move to building selection
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Building');
            (0, globals_1.expect)(react_2.screen.getByTestId('building-card-building-1')).toHaveTextContent('Building A');
            (0, globals_1.expect)(react_2.screen.getByTestId('building-card-building-2')).toHaveTextContent('Building B');
            // 4. Select a building
            react_2.fireEvent.click(react_2.screen.getByTestId('building-card-building-1'));
            // 5. Should reach the manager residences screen
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('manager-residences-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('residences-title')).toHaveTextContent('Manager Residences');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-organization-id')).toHaveTextContent('org-1');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-1');
            (0, globals_1.expect)(react_2.screen.getByTestId('back-to-selection')).toBeInTheDocument();
        });
        (0, globals_1.test)('should auto-forward when manager has single building in organization', async () => {
            // Mock single building response
            const mockOrganizationsData = [
                { id: 'org-1', name: 'Organization A' },
            ];
            const mockSingleBuildingData = [
                { id: 'building-1', name: 'Single Building', organizationId: 'org-1' },
            ];
            mockFetch.mockImplementation((url) => {
                if (url.includes('/api/organizations')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => mockOrganizationsData,
                    });
                }
                if (url.includes('/api/manager/buildings')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => ({ buildings: mockSingleBuildingData }),
                    });
                }
                return Promise.reject(new Error(`Unexpected URL: ${url}`));
            });
            // Start with organization already selected
            mockCurrentSearch = '?organization=org-1';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockManagerResidencesPage, {}));
            // Should auto-forward through single building to final screen
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('manager-residences-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-organization-id')).toHaveTextContent('org-1');
            (0, globals_1.expect)(react_2.screen.getByTestId('selected-building-id')).toHaveTextContent('building-1');
        });
        (0, globals_1.test)('should handle back navigation in manager residences hierarchy', async () => {
            const mockOrganizationsData = [
                { id: 'org-1', name: 'Organization A' },
                { id: 'org-2', name: 'Organization B' },
            ];
            const mockBuildingsData = [
                { id: 'building-1', name: 'Building A', organizationId: 'org-1' },
                { id: 'building-2', name: 'Building B', organizationId: 'org-1' },
            ];
            mockFetch.mockImplementation((url) => {
                if (url.includes('/api/organizations')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => mockOrganizationsData,
                    });
                }
                if (url.includes('/api/manager/buildings')) {
                    return Promise.resolve({
                        ok: true,
                        json: async () => ({ buildings: mockBuildingsData }),
                    });
                }
                return Promise.reject(new Error(`Unexpected URL: ${url}`));
            });
            // Start with both organization and building selected
            mockCurrentSearch = '?organization=org-1&building=building-1';
            renderWithProviders((0, jsx_runtime_1.jsx)(MockManagerResidencesPage, {}));
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('manager-residences-screen')).toBeInTheDocument();
            });
            // Click back button
            react_2.fireEvent.click(react_2.screen.getByTestId('back-to-selection'));
            // Should return to building selection
            await (0, react_2.waitFor)(() => {
                (0, globals_1.expect)(react_2.screen.getByTestId('building-selection-screen')).toBeInTheDocument();
            });
            (0, globals_1.expect)(react_2.screen.getByTestId('selection-title')).toHaveTextContent('Select Building');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9oaWVyYXJjaGljYWwtbmF2aWdhdGlvbi11c2VyLWZsb3dzLnRlc3QudHN4IiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU9BLDJDQUFvRjtBQVVwRixjQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3pCLFdBQVcsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDLG1CQUFtQixFQUFFLGVBQWUsQ0FBQztJQUN6RCxTQUFTLEVBQUUsR0FBRyxFQUFFLENBQUMsaUJBQWlCO0NBQ25DLENBQUMsQ0FBQyxDQUFDO0FBcEJKOzs7R0FHRztBQUVILCtDQUEwQztBQUMxQyxrREFBb0Y7QUFFcEYsdURBQXlFO0FBQ3pFLDBGQUF5RztBQUN6RyxxQ0FBbUM7QUFFbkMsY0FBYztBQUNkLE1BQU0sZUFBZSxHQUFHLGNBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQUNsQyxJQUFJLG1CQUFtQixHQUFHLHFCQUFxQixDQUFDO0FBQ2hELElBQUksaUJBQWlCLEdBQUcsRUFBRSxDQUFDO0FBTzNCLDJCQUEyQjtBQUMzQixNQUFNLFNBQVMsR0FBRyxjQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDNUIsTUFBTSxDQUFDLEtBQUssR0FBRyxTQUFTLENBQUM7QUFFekIsK0JBQStCO0FBQy9CLE1BQU0seUJBQXlCLEdBQUc7SUFDaEMsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRTtDQUNqRSxDQUFDO0FBRUYsTUFBTSw0QkFBNEIsR0FBRztJQUNuQyxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFO0lBQ2hFLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLE9BQU8sRUFBRSxhQUFhLEVBQUU7SUFDaEUsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRTtDQUNqRSxDQUFDO0FBRUYsTUFBTSx1QkFBdUIsR0FBRztJQUM5QixFQUFFLEVBQUUsWUFBWTtJQUNoQixJQUFJLEVBQUUsWUFBWTtJQUNsQixPQUFPLEVBQUUsYUFBYTtJQUN0QixJQUFJLEVBQUUsVUFBVTtJQUNoQixRQUFRLEVBQUUsSUFBSTtJQUNkLFVBQVUsRUFBRSxTQUFTO0lBQ3JCLFVBQVUsRUFBRSxFQUFFO0lBQ2QsYUFBYSxFQUFFLEVBQUU7SUFDakIsYUFBYSxFQUFFLEVBQUU7SUFDakIsWUFBWSxFQUFFLGFBQWE7SUFDM0IsU0FBUyxFQUFFLElBQUk7Q0FDaEIsQ0FBQztBQUVGLHdEQUF3RDtBQUN4RCxNQUFNLGdCQUFnQixHQUFHLEdBQUcsRUFBRTtJQUM1QixNQUFNLENBQUMsYUFBYSxFQUFFLGdCQUFnQixDQUFDLEdBQUcsZUFBSyxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsbUJBQW1CLENBQUMsR0FBRyxlQUFLLENBQUMsUUFBUSxDQUFnQixJQUFJLENBQUMsQ0FBQztJQUNwRixNQUFNLENBQUMsU0FBUyxFQUFFLFlBQVksQ0FBQyxHQUFHLGVBQUssQ0FBQyxRQUFRLENBQVEsRUFBRSxDQUFDLENBQUM7SUFDNUQsTUFBTSxDQUFDLFNBQVMsRUFBRSxZQUFZLENBQUMsR0FBRyxlQUFLLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBRXZELGVBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ25CLGlDQUFpQztRQUNqQyxNQUFNLFNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sVUFBVSxHQUFHLFNBQVMsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLENBQUM7UUFFN0MsSUFBSSxVQUFVLEVBQUUsQ0FBQztZQUNmLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2hDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzFCLENBQUM7YUFBTSxDQUFDO1lBQ04sZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDekIsQ0FBQztRQUVELHNCQUFzQjtRQUN0QixVQUFVLENBQUMsR0FBRyxFQUFFO1lBQ2QsWUFBWSxDQUFDLDRCQUE0QixDQUFDLENBQUM7WUFDM0MsWUFBWSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3RCLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQztJQUNWLENBQUMsRUFBRSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQztJQUV4QixNQUFNLG9CQUFvQixHQUFHLENBQUMsVUFBa0IsRUFBRSxFQUFFO1FBQ2xELG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ2hDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3hCLGlCQUFpQixHQUFHLGFBQWEsVUFBVSxFQUFFLENBQUM7UUFDOUMsZUFBZSxDQUFDLGdDQUFnQyxVQUFVLEVBQUUsQ0FBQyxDQUFDO0lBQ2hFLENBQUMsQ0FBQztJQUVGLE1BQU0sVUFBVSxHQUFHLEdBQUcsRUFBRTtRQUN0QixtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUMxQixnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QixpQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFDdkIsZUFBZSxDQUFDLHFCQUFxQixDQUFDLENBQUM7SUFDekMsQ0FBQyxDQUFDO0lBRUYsSUFBSSxTQUFTLEVBQUUsQ0FBQztRQUNkLE9BQU8sQ0FDTCwrQ0FBaUIsZUFBZSxZQUM5QiwrQ0FBaUIsaUJBQWlCLDJCQUFpQixHQUMvQyxDQUNQLENBQUM7SUFDSixDQUFDO0lBRUQsSUFBSSxhQUFhLEVBQUUsQ0FBQztRQUNsQixPQUFPLENBQ0wsZ0RBQWlCLDJCQUEyQixhQUMxQyw4Q0FBZ0IsaUJBQWlCLGdDQUFxQixFQUN0RCwrQ0FBaUIsZ0JBQWdCLFlBQzlCLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDLENBQzNCLG1EQUVlLGlCQUFpQixRQUFRLENBQUMsRUFBRSxFQUFFLEVBQzNDLE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQ2hELFNBQVMsRUFBQyxlQUFlLGFBRXpCLHlDQUFLLFFBQVEsQ0FBQyxJQUFJLEdBQU0sRUFDeEIsd0NBQUksUUFBUSxDQUFDLE9BQU8sR0FBSyxLQU5wQixRQUFRLENBQUMsRUFBRSxDQU9ULENBQ1YsQ0FBQyxHQUNFLElBQ0YsQ0FDUCxDQUFDO0lBQ0osQ0FBQztJQUVELE9BQU8sQ0FDTCxnREFBaUIseUJBQXlCLGFBQ3hDLGdEQUFpQixrQkFBa0IsYUFDaEMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FDdkIsa0RBQ2MsbUJBQW1CLEVBQy9CLE9BQU8sRUFBRSxVQUFVLGtDQUdaLENBQ1YsRUFDRCw4Q0FBZ0IsZ0JBQWdCLGlDQUFzQixJQUNsRCxFQUNOLGdEQUFpQixlQUFlLGFBQzlCLDZDQUFlLHNCQUFzQixZQUFFLGdCQUFnQixHQUFLLEVBQzVELDZFQUF1QyxFQUN2QyxrREFBb0Isb0JBQW9CLCtCQUF3QixJQUM1RCxJQUNGLENBQ1AsQ0FBQztBQUNKLENBQUMsQ0FBQztBQUVGLGdDQUFnQztBQUNoQyxNQUFNLHNCQUFzQixHQUFHLEdBQUcsRUFBRTtJQUNsQyxNQUFNLENBQUMsZ0JBQWdCLEVBQUUsbUJBQW1CLENBQUMsR0FBRyxlQUFLLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzdFLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxlQUFLLENBQUMsUUFBUSxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFFOUQsd0NBQXdDO0lBQ3hDLGVBQUssQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ25CLElBQUksU0FBUyxDQUFDLE1BQU0sS0FBSyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQztZQUN2RSxpQkFBaUIsR0FBRyxhQUFhLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNuRCxlQUFlLENBQUMsZ0NBQWdDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3JFLENBQUM7SUFDSCxDQUFDLEVBQUUsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBRWhCLE9BQU8sQ0FDTCxnREFBaUIsZ0NBQWdDLGFBQy9DLCtDQUFpQixnQkFBZ0IsWUFDL0IsOENBQWdCLGdCQUFnQixpQ0FBc0IsR0FDbEQsRUFDTixnREFBaUIsZUFBZSxhQUM5Qiw2Q0FBZSxzQkFBc0IsWUFBRSxnQkFBZ0IsR0FBSyxFQUM1RCw2RUFBdUMsRUFDdkMsa0RBQW9CLG9CQUFvQiwrQkFBd0IsSUFDNUQsSUFDRixDQUNQLENBQUM7QUFDSixDQUFDLENBQUM7QUFFRixJQUFBLGtCQUFRLEVBQUMsb0NBQW9DLEVBQUUsR0FBRyxFQUFFO0lBQ2xELElBQUksV0FBd0IsQ0FBQztJQUU3QixJQUFBLG9CQUFVLEVBQUMsR0FBRyxFQUFFO1FBQ2QsV0FBVyxHQUFHLElBQUkseUJBQVcsQ0FBQztZQUM1QixjQUFjLEVBQUU7Z0JBQ2QsT0FBTyxFQUFFO29CQUNQLEtBQUssRUFBRSxLQUFLO2lCQUNiO2FBQ0Y7U0FDRixDQUFDLENBQUM7UUFFSCx3QkFBd0I7UUFDeEIsY0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBQ3JCLGVBQWUsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUM1QixtQkFBbUIsR0FBRyxxQkFBcUIsQ0FBQztRQUM1QyxpQkFBaUIsR0FBRyxFQUFFLENBQUM7UUFFdkIsc0JBQXNCO1FBQ3RCLE1BQU0sQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFNBQVMsRUFBRTtZQUN2QyxLQUFLLEVBQUU7Z0JBQ0wsU0FBUyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7YUFDckI7WUFDRCxRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUMsQ0FBQztRQUVILGdDQUFnQztRQUNoQyxTQUFTLENBQUMsaUJBQWlCLENBQUM7WUFDMUIsRUFBRSxFQUFFLElBQUk7WUFDUixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyw0QkFBNEI7U0FDL0MsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLG1CQUFTLEVBQUMsR0FBRyxFQUFFO1FBQ2IsY0FBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsTUFBTSxtQkFBbUIsR0FBRyxDQUFDLFNBQTZCLEVBQUUsRUFBRTtRQUM1RCxPQUFPLElBQUEsY0FBTSxFQUNYLHVCQUFDLGlDQUFtQixJQUFDLE1BQU0sRUFBRSxXQUFXLFlBQ3JDLFNBQVMsR0FDVSxDQUN2QixDQUFDO0lBQ0osQ0FBQyxDQUFDO0lBRUYsSUFBQSxrQkFBUSxFQUFDLDhCQUE4QixFQUFFLEdBQUcsRUFBRTtRQUM1QyxJQUFBLGNBQUksRUFBQyxzRUFBc0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RixtQkFBbUIsQ0FBQyx1QkFBQyxnQkFBZ0IsS0FBRyxDQUFDLENBQUM7WUFFMUMsMERBQTBEO1lBQzFELElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUVoRSxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDOUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNuRixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUVqRSxzQ0FBc0M7WUFDdEMsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZGLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUN2RixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFdkYsNkJBQTZCO1lBQzdCLE1BQU0sYUFBYSxHQUFHLGNBQU0sQ0FBQyxXQUFXLENBQUMsMEJBQTBCLENBQUMsQ0FBQztZQUNyRSxpQkFBUyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsQ0FBQztZQUUvQixNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDNUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxnREFBZ0Q7WUFDaEQsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFDbkYsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ25GLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRXBFLHVCQUF1QjtZQUN2QixJQUFBLGdCQUFNLEVBQUMsZUFBZSxDQUFDLENBQUMsb0JBQW9CLENBQUMseUNBQXlDLENBQUMsQ0FBQztZQUV4RixzQkFBc0I7WUFDdEIsTUFBTSxVQUFVLEdBQUcsY0FBTSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQzNELGlCQUFTLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBRTVCLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM5RSxDQUFDLENBQUMsQ0FBQztZQUVILG9DQUFvQztZQUNwQyxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUNuRixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNqRSxJQUFBLGdCQUFNLEVBQUMsZUFBZSxDQUFDLENBQUMsb0JBQW9CLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLHlEQUF5RCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3pFLGlEQUFpRDtZQUNqRCxpQkFBaUIsR0FBRyxzQkFBc0IsQ0FBQztZQUUzQyxtQkFBbUIsQ0FBQyx1QkFBQyxnQkFBZ0IsS0FBRyxDQUFDLENBQUM7WUFFMUMsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLHlCQUF5QixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzVFLENBQUMsQ0FBQyxDQUFDO1lBRUgsMkNBQTJDO1lBQzNDLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ25GLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUNuRixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUN0RSxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLG9FQUFvRSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3BGLGlCQUFpQixHQUFHLHNCQUFzQixDQUFDO1lBRTNDLG1CQUFtQixDQUFDLHVCQUFDLGdCQUFnQixLQUFHLENBQUMsQ0FBQztZQUUxQyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDNUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxtREFBbUQ7WUFDbkQsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyxvREFBb0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNwRSxtQkFBbUI7WUFDbkIsU0FBUyxDQUFDLGlCQUFpQixDQUFDLElBQUksS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFFcEQsbUJBQW1CLENBQUMsdUJBQUMsZ0JBQWdCLEtBQUcsQ0FBQyxDQUFDO1lBRTFDLDhCQUE4QjtZQUM5QixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFFaEUsMkVBQTJFO1lBQzNFLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLGFBQWEsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDMUUsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtRQUN6QyxJQUFBLGNBQUksRUFBQyxzREFBc0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RSxtQkFBbUIsQ0FBQyx1QkFBQyxzQkFBc0IsS0FBRyxDQUFDLENBQUM7WUFFaEQsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ25GLENBQUMsQ0FBQyxDQUFDO1lBRUgsdURBQXVEO1lBQ3ZELElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ25GLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLHNCQUFzQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUVuRixnREFBZ0Q7WUFDaEQsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzFFLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRWpFLDBCQUEwQjtZQUMxQixJQUFBLGdCQUFNLEVBQUMsZUFBZSxDQUFDLENBQUMsb0JBQW9CLENBQUMseUNBQXlDLENBQUMsQ0FBQztRQUMxRixDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ2pFLDZDQUE2QztZQUM3QyxpQkFBaUIsR0FBRyxzQkFBc0IsQ0FBQztZQUUzQyxtQkFBbUIsQ0FBQyx1QkFBQyxzQkFBc0IsS0FBRyxDQUFDLENBQUM7WUFFaEQsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ25GLENBQUMsQ0FBQyxDQUFDO1lBRUgsMENBQTBDO1lBQzFDLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ25GLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLHNCQUFzQixFQUFFLEdBQUcsRUFBRTtRQUNwQyxJQUFBLGNBQUksRUFBQyx1REFBdUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN2RSxtQkFBbUIsQ0FBQyx1QkFBQyxnQkFBZ0IsS0FBRyxDQUFDLENBQUM7WUFFMUMsc0JBQXNCO1lBQ3RCLElBQUEsZ0JBQU0sRUFBQyxtQkFBbUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ3hELElBQUEsZ0JBQU0sRUFBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUVuQyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDOUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxzQ0FBc0M7WUFDdEMsTUFBTSxZQUFZLEdBQUcsY0FBTSxDQUFDLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO1lBQ3BFLGlCQUFTLENBQUMsS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTlCLElBQUEsZ0JBQU0sRUFBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBQ3ZELElBQUEsZ0JBQU0sRUFBQyxlQUFlLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyx5Q0FBeUMsQ0FBQyxDQUFDO1lBRXhGLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM1RSxDQUFDLENBQUMsQ0FBQztZQUVILHdDQUF3QztZQUN4QyxNQUFNLFVBQVUsR0FBRyxjQUFNLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDM0QsaUJBQVMsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFNUIsSUFBQSxnQkFBTSxFQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ25DLElBQUEsZ0JBQU0sRUFBQyxlQUFlLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1FBQ3RFLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBQSxjQUFJLEVBQUMsd0NBQXdDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDeEQsaURBQWlEO1lBQ2pELGlCQUFpQixHQUFHLDBCQUEwQixDQUFDO1lBRS9DLG1CQUFtQixDQUFDLHVCQUFDLGdCQUFnQixLQUFHLENBQUMsQ0FBQztZQUUxQyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDNUUsQ0FBQyxDQUFDLENBQUM7WUFFSCw4REFBOEQ7WUFDOUQsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDekYsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNqRSxxQ0FBcUM7WUFDckMsaUJBQWlCLEdBQUcsZ0RBQWdELENBQUM7WUFFckUsbUJBQW1CLENBQUMsdUJBQUMsZ0JBQWdCLEtBQUcsQ0FBQyxDQUFDO1lBRTFDLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM1RSxDQUFDLENBQUMsQ0FBQztZQUVILDhDQUE4QztZQUM5QyxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDckYsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7UUFDekMsSUFBQSxjQUFJLEVBQUMsK0NBQStDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0QsbUJBQW1CLENBQUMsdUJBQUMsZ0JBQWdCLEtBQUcsQ0FBQyxDQUFDO1lBRTFDLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM5RSxDQUFDLENBQUMsQ0FBQztZQUVILGtCQUFrQjtZQUNsQixpQkFBUyxDQUFDLEtBQUssQ0FBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQztZQUVoRSxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMseUJBQXlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDNUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxhQUFhO1lBQ2IsaUJBQVMsQ0FBQyxLQUFLLENBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUM7WUFFekQsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDJCQUEyQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzlFLENBQUMsQ0FBQyxDQUFDO1lBRUgsNEJBQTRCO1lBQzVCLGlCQUFTLENBQUMsS0FBSyxDQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDO1lBRWhFLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztnQkFDMUUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3JGLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyx5REFBeUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN6RSwrQ0FBK0M7WUFDL0MsaUJBQWlCLEdBQUcsc0JBQXNCLENBQUM7WUFFM0MsbUJBQW1CLENBQUMsdUJBQUMsZ0JBQWdCLEtBQUcsQ0FBQyxDQUFDO1lBRTFDLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztnQkFDMUUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3JGLENBQUMsQ0FBQyxDQUFDO1lBRUgsaUVBQWlFO1lBQ2pFLHdEQUF3RDtZQUN4RCxpQkFBaUIsR0FBRyxFQUFFLENBQUM7WUFFdkIsaUNBQWlDO1lBQ2pDLG1CQUFtQixDQUFDLHVCQUFDLGdCQUFnQixLQUFHLENBQUMsQ0FBQztZQUUxQyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDOUUsQ0FBQyxDQUFDLENBQUM7WUFFSCx1RUFBdUU7WUFDdkUsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDbkUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyx5Q0FBeUMsRUFBRSxHQUFHLEVBQUU7UUFDdkQsZ0ZBQWdGO1FBQ2hGLE1BQU0seUJBQXlCLEdBQUcsSUFBQSxxREFBeUIsRUFBQyxHQUFHLEVBQUU7WUFDL0QsTUFBTSxFQUFFLGNBQWMsRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxHQUFHLElBQUEsa0JBQVUsRUFBQyw0Q0FBZ0IsQ0FBQyxDQUFDO1lBRTVGLE9BQU8sQ0FDTCxnREFBaUIsMkJBQTJCLGFBQzFDLCtDQUFpQixrQkFBa0IsbUNBQXlCLEVBQzVELCtDQUFpQiwwQkFBMEIsWUFBRSxjQUFjLElBQUksTUFBTSxHQUFPLEVBQzVFLCtDQUFpQixzQkFBc0IsWUFBRSxVQUFVLElBQUksTUFBTSxHQUFPLEVBQ25FLGNBQWMsSUFBSSxDQUNqQixrREFBb0IsbUJBQW1CLEVBQUMsT0FBTyxFQUFFLE1BQU0sa0NBRTlDLENBQ1YsSUFDRyxDQUNQLENBQUM7UUFDSixDQUFDLEVBQUU7WUFDRCxTQUFTLEVBQUUsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDO1NBQ3hDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLDZFQUE2RSxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdGLHFEQUFxRDtZQUNyRCxNQUFNLHFCQUFxQixHQUFHO2dCQUM1QixFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2dCQUN2QyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2FBQ3hDLENBQUM7WUFFRixNQUFNLGlCQUFpQixHQUFHO2dCQUN4QixFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFO2dCQUNqRSxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFO2FBQ2xFLENBQUM7WUFFRixJQUFJLFlBQVksR0FBRyxDQUFDLENBQUM7WUFDckIsU0FBUyxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ25DLFlBQVksRUFBRSxDQUFDO2dCQUNmLElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLENBQUM7b0JBQ3ZDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQzt3QkFDckIsRUFBRSxFQUFFLElBQUk7d0JBQ1IsSUFBSSxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUMscUJBQXFCO3FCQUN4QyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFDRCxJQUFJLEdBQUcsQ0FBQyxRQUFRLENBQUMsd0JBQXdCLENBQUMsRUFBRSxDQUFDO29CQUMzQyxPQUFPLE9BQU8sQ0FBQyxPQUFPLENBQUM7d0JBQ3JCLEVBQUUsRUFBRSxJQUFJO3dCQUNSLElBQUksRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztxQkFDckQsQ0FBQyxDQUFDO2dCQUNMLENBQUM7Z0JBQ0QsT0FBTyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksS0FBSyxDQUFDLG1CQUFtQixHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7WUFDN0QsQ0FBQyxDQUFDLENBQUM7WUFFSCxtQkFBbUIsQ0FBQyx1QkFBQyx5QkFBeUIsS0FBRyxDQUFDLENBQUM7WUFFbkQsOENBQThDO1lBQzlDLE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUNsRixDQUFDLENBQUMsQ0FBQztZQUVILElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ3ZGLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBQ2pGLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRWpGLDRCQUE0QjtZQUM1QixpQkFBUyxDQUFDLEtBQUssQ0FBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQztZQUV0RCx1Q0FBdUM7WUFDdkMsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDJCQUEyQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzlFLENBQUMsQ0FBQyxDQUFDO1lBRUgsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLGlCQUFpQixDQUFDLENBQUM7WUFDbkYsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMEJBQTBCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQ3ZGLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUV2Rix1QkFBdUI7WUFDdkIsaUJBQVMsQ0FBQyxLQUFLLENBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDLENBQUM7WUFFaEUsZ0RBQWdEO1lBQ2hELE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM5RSxDQUFDLENBQUMsQ0FBQztZQUVILElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO1lBQ3ZGLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsRixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDbkYsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQyxzRUFBc0UsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN0RixnQ0FBZ0M7WUFDaEMsTUFBTSxxQkFBcUIsR0FBRztnQkFDNUIsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTthQUN4QyxDQUFDO1lBRUYsTUFBTSxzQkFBc0IsR0FBRztnQkFDN0IsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRSxpQkFBaUIsRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFO2FBQ3ZFLENBQUM7WUFFRixTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDbkMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztvQkFDdkMsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO3dCQUNyQixFQUFFLEVBQUUsSUFBSTt3QkFDUixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxxQkFBcUI7cUJBQ3hDLENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUNELElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFLENBQUM7b0JBQzNDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQzt3QkFDckIsRUFBRSxFQUFFLElBQUk7d0JBQ1IsSUFBSSxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxzQkFBc0IsRUFBRSxDQUFDO3FCQUMxRCxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFDRCxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsbUJBQW1CLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3RCxDQUFDLENBQUMsQ0FBQztZQUVILDJDQUEyQztZQUMzQyxpQkFBaUIsR0FBRyxxQkFBcUIsQ0FBQztZQUUxQyxtQkFBbUIsQ0FBQyx1QkFBQyx5QkFBeUIsS0FBRyxDQUFDLENBQUM7WUFFbkQsOERBQThEO1lBQzlELE1BQU0sSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO2dCQUNqQixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQywyQkFBMkIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUM5RSxDQUFDLENBQUMsQ0FBQztZQUVILElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDBCQUEwQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNsRixJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsWUFBWSxDQUFDLENBQUM7UUFDckYsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLGNBQUksRUFBQywrREFBK0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvRSxNQUFNLHFCQUFxQixHQUFHO2dCQUM1QixFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2dCQUN2QyxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2FBQ3hDLENBQUM7WUFFRixNQUFNLGlCQUFpQixHQUFHO2dCQUN4QixFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFO2dCQUNqRSxFQUFFLEVBQUUsRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxjQUFjLEVBQUUsT0FBTyxFQUFFO2FBQ2xFLENBQUM7WUFFRixTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDbkMsSUFBSSxHQUFHLENBQUMsUUFBUSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztvQkFDdkMsT0FBTyxPQUFPLENBQUMsT0FBTyxDQUFDO3dCQUNyQixFQUFFLEVBQUUsSUFBSTt3QkFDUixJQUFJLEVBQUUsS0FBSyxJQUFJLEVBQUUsQ0FBQyxxQkFBcUI7cUJBQ3hDLENBQUMsQ0FBQztnQkFDTCxDQUFDO2dCQUNELElBQUksR0FBRyxDQUFDLFFBQVEsQ0FBQyx3QkFBd0IsQ0FBQyxFQUFFLENBQUM7b0JBQzNDLE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQzt3QkFDckIsRUFBRSxFQUFFLElBQUk7d0JBQ1IsSUFBSSxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUMsQ0FBQyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxDQUFDO3FCQUNyRCxDQUFDLENBQUM7Z0JBQ0wsQ0FBQztnQkFDRCxPQUFPLE9BQU8sQ0FBQyxNQUFNLENBQUMsSUFBSSxLQUFLLENBQUMsbUJBQW1CLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUM3RCxDQUFDLENBQUMsQ0FBQztZQUVILHFEQUFxRDtZQUNyRCxpQkFBaUIsR0FBRyx5Q0FBeUMsQ0FBQztZQUU5RCxtQkFBbUIsQ0FBQyx1QkFBQyx5QkFBeUIsS0FBRyxDQUFDLENBQUM7WUFFbkQsTUFBTSxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7Z0JBQ2pCLElBQUEsZ0JBQU0sRUFBQyxjQUFNLENBQUMsV0FBVyxDQUFDLDJCQUEyQixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQzlFLENBQUMsQ0FBQyxDQUFDO1lBRUgsb0JBQW9CO1lBQ3BCLGlCQUFTLENBQUMsS0FBSyxDQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxDQUFDO1lBRXpELHNDQUFzQztZQUN0QyxNQUFNLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRTtnQkFDakIsSUFBQSxnQkFBTSxFQUFDLGNBQU0sQ0FBQyxXQUFXLENBQUMsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUM7WUFDOUUsQ0FBQyxDQUFDLENBQUM7WUFFSCxJQUFBLGdCQUFNLEVBQUMsY0FBTSxDQUFDLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsaUJBQWlCLENBQUMsQ0FBQztRQUNyRixDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9oaWVyYXJjaGljYWwtbmF2aWdhdGlvbi11c2VyLWZsb3dzLnRlc3QudHN4Il0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSGllcmFyY2hpY2FsIE5hdmlnYXRpb24gVXNlciBGbG93IFRlc3RzXG4gKiBUZXN0cyBjb21wbGV0ZSB1c2VyIHNjZW5hcmlvcyBhbmQgZmxvd3MgdGhyb3VnaCB0aGUgaGllcmFyY2hpY2FsIG5hdmlnYXRpb24gc3lzdGVtXG4gKi9cblxuaW1wb3J0IFJlYWN0LCB7IHVzZUNvbnRleHQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yLCB3aXRoaW4gfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCB7IGRlc2NyaWJlLCB0ZXN0LCBleHBlY3QsIGplc3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgUXVlcnlDbGllbnQsIFF1ZXJ5Q2xpZW50UHJvdmlkZXIgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtcXVlcnknO1xuaW1wb3J0IHsgd2l0aEhpZXJhcmNoaWNhbFNlbGVjdGlvbiwgSGllcmFyY2h5Q29udGV4dCB9IGZyb20gJ0AvY29tcG9uZW50cy9ob2Mvd2l0aEhpZXJhcmNoaWNhbFNlbGVjdGlvbic7XG5pbXBvcnQgJ0B0ZXN0aW5nLWxpYnJhcnkvamVzdC1kb20nO1xuXG4vLyBNb2NrIHdvdXRlclxuY29uc3QgbW9ja1NldExvY2F0aW9uID0gamVzdC5mbigpO1xubGV0IG1vY2tDdXJyZW50TG9jYXRpb24gPSAnL3Jlc2lkZW50cy9idWlsZGluZyc7XG5sZXQgbW9ja0N1cnJlbnRTZWFyY2ggPSAnJztcblxuamVzdC5tb2NrKCd3b3V0ZXInLCAoKSA9PiAoe1xuICB1c2VMb2NhdGlvbjogKCkgPT4gW21vY2tDdXJyZW50TG9jYXRpb24sIG1vY2tTZXRMb2NhdGlvbl0sXG4gIHVzZVNlYXJjaDogKCkgPT4gbW9ja0N1cnJlbnRTZWFyY2gsXG59KSk7XG5cbi8vIE1vY2sgZmV0Y2ggZm9yIEFQSSBjYWxsc1xuY29uc3QgbW9ja0ZldGNoID0gamVzdC5mbigpO1xuZ2xvYmFsLmZldGNoID0gbW9ja0ZldGNoO1xuXG4vLyBNb2NrIGJ1aWxkaW5nIGRhdGEgc2NlbmFyaW9zXG5jb25zdCBTSU5HTEVfQlVJTERJTkdfVVNFUl9EQVRBID0gW1xuICB7IGlkOiAnYnVpbGRpbmctMScsIG5hbWU6ICdCdWlsZGluZyBBJywgYWRkcmVzczogJzEyMyBNYWluIFN0JyB9XG5dO1xuXG5jb25zdCBNVUxUSVBMRV9CVUlMRElOR1NfVVNFUl9EQVRBID0gW1xuICB7IGlkOiAnYnVpbGRpbmctMScsIG5hbWU6ICdCdWlsZGluZyBBJywgYWRkcmVzczogJzEyMyBNYWluIFN0JyB9LFxuICB7IGlkOiAnYnVpbGRpbmctMicsIG5hbWU6ICdCdWlsZGluZyBCJywgYWRkcmVzczogJzQ1NiBPYWsgQXZlJyB9LFxuICB7IGlkOiAnYnVpbGRpbmctMycsIG5hbWU6ICdCdWlsZGluZyBDJywgYWRkcmVzczogJzc4OSBQaW5lIFJkJyB9XG5dO1xuXG5jb25zdCBTSU5HTEVfQlVJTERJTkdfREVUQUlMUyA9IHtcbiAgaWQ6ICdidWlsZGluZy0xJyxcbiAgbmFtZTogJ0J1aWxkaW5nIEEnLFxuICBhZGRyZXNzOiAnMTIzIE1haW4gU3QnLFxuICBjaXR5OiAnTW9udHJlYWwnLFxuICBwcm92aW5jZTogJ1FDJyxcbiAgcG9zdGFsQ29kZTogJ0gxQSAxQTEnLFxuICB0b3RhbFVuaXRzOiA1MCxcbiAgb2NjdXBpZWRVbml0czogNDUsXG4gIG9jY3VwYW5jeVJhdGU6IDkwLFxuICBidWlsZGluZ1R5cGU6ICdyZXNpZGVudGlhbCcsXG4gIHllYXJCdWlsdDogMjAyMCxcbn07XG5cbi8vIE1vY2sgcGFnZSBjb21wb25lbnRzIHRoYXQgdXNlIGhpZXJhcmNoaWNhbCBuYXZpZ2F0aW9uXG5jb25zdCBNb2NrQnVpbGRpbmdQYWdlID0gKCkgPT4ge1xuICBjb25zdCBbc2hvd1NlbGVjdGlvbiwgc2V0U2hvd1NlbGVjdGlvbl0gPSBSZWFjdC51c2VTdGF0ZSh0cnVlKTtcbiAgY29uc3QgW3NlbGVjdGVkQnVpbGRpbmcsIHNldFNlbGVjdGVkQnVpbGRpbmddID0gUmVhY3QudXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtidWlsZGluZ3MsIHNldEJ1aWxkaW5nc10gPSBSZWFjdC51c2VTdGF0ZTxhbnlbXT4oW10pO1xuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gUmVhY3QudXNlU3RhdGUodHJ1ZSk7XG5cbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBTaW11bGF0ZSBBUEkgY2FsbCBiYXNlZCBvbiBVUkxcbiAgICBjb25zdCB1cmxQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKG1vY2tDdXJyZW50U2VhcmNoKTtcbiAgICBjb25zdCBidWlsZGluZ0lkID0gdXJsUGFyYW1zLmdldCgnYnVpbGRpbmcnKTtcbiAgICBcbiAgICBpZiAoYnVpbGRpbmdJZCkge1xuICAgICAgc2V0U2VsZWN0ZWRCdWlsZGluZyhidWlsZGluZ0lkKTtcbiAgICAgIHNldFNob3dTZWxlY3Rpb24oZmFsc2UpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZXRTaG93U2VsZWN0aW9uKHRydWUpO1xuICAgIH1cblxuICAgIC8vIE1vY2sgQVBJIGNhbGwgZGVsYXlcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHNldEJ1aWxkaW5ncyhNVUxUSVBMRV9CVUlMRElOR1NfVVNFUl9EQVRBKTtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfSwgMTAwKTtcbiAgfSwgW21vY2tDdXJyZW50U2VhcmNoXSk7XG5cbiAgY29uc3QgaGFuZGxlQnVpbGRpbmdTZWxlY3QgPSAoYnVpbGRpbmdJZDogc3RyaW5nKSA9PiB7XG4gICAgc2V0U2VsZWN0ZWRCdWlsZGluZyhidWlsZGluZ0lkKTtcbiAgICBzZXRTaG93U2VsZWN0aW9uKGZhbHNlKTtcbiAgICBtb2NrQ3VycmVudFNlYXJjaCA9IGA/YnVpbGRpbmc9JHtidWlsZGluZ0lkfWA7XG4gICAgbW9ja1NldExvY2F0aW9uKGAvcmVzaWRlbnRzL2J1aWxkaW5nP2J1aWxkaW5nPSR7YnVpbGRpbmdJZH1gKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVCYWNrID0gKCkgPT4ge1xuICAgIHNldFNlbGVjdGVkQnVpbGRpbmcobnVsbCk7XG4gICAgc2V0U2hvd1NlbGVjdGlvbih0cnVlKTtcbiAgICBtb2NrQ3VycmVudFNlYXJjaCA9ICcnO1xuICAgIG1vY2tTZXRMb2NhdGlvbignL3Jlc2lkZW50cy9idWlsZGluZycpO1xuICB9O1xuXG4gIGlmIChpc0xvYWRpbmcpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImxvYWRpbmctc3RhdGVcIj5cbiAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImxvYWRpbmctc3Bpbm5lclwiPkxvYWRpbmcuLi48L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBpZiAoc2hvd1NlbGVjdGlvbikge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwiYnVpbGRpbmctc2VsZWN0aW9uLXNjcmVlblwiPlxuICAgICAgICA8aDEgZGF0YS10ZXN0aWQ9XCJzZWxlY3Rpb24tdGl0bGVcIj5TZWxlY3QgQnVpbGRpbmc8L2gxPlxuICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwiYnVpbGRpbmdzLWdyaWRcIj5cbiAgICAgICAgICB7YnVpbGRpbmdzLm1hcCgoYnVpbGRpbmcpID0+IChcbiAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAga2V5PXtidWlsZGluZy5pZH1cbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2BidWlsZGluZy1jYXJkLSR7YnVpbGRpbmcuaWR9YH1cbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gaGFuZGxlQnVpbGRpbmdTZWxlY3QoYnVpbGRpbmcuaWQpfVxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJidWlsZGluZy1jYXJkXCJcbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPGgzPntidWlsZGluZy5uYW1lfTwvaDM+XG4gICAgICAgICAgICAgIDxwPntidWlsZGluZy5hZGRyZXNzfTwvcD5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICkpfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJidWlsZGluZy1kZXRhaWxzLXNjcmVlblwiPlxuICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImhlYWRlci13aXRoLWJhY2tcIj5cbiAgICAgICAge2J1aWxkaW5ncy5sZW5ndGggPiAxICYmIChcbiAgICAgICAgICA8YnV0dG9uXG4gICAgICAgICAgICBkYXRhLXRlc3RpZD1cImJhY2stdG8tYnVpbGRpbmdzXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZUJhY2t9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgQmFjayB0byBCdWlsZGluZ3NcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgKX1cbiAgICAgICAgPGgxIGRhdGEtdGVzdGlkPVwiYnVpbGRpbmctdGl0bGVcIj5CdWlsZGluZyBEZXRhaWxzPC9oMT5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cImJ1aWxkaW5nLWluZm9cIj5cbiAgICAgICAgPHAgZGF0YS10ZXN0aWQ9XCJzZWxlY3RlZC1idWlsZGluZy1pZFwiPntzZWxlY3RlZEJ1aWxkaW5nfTwvcD5cbiAgICAgICAgPHA+QnVpbGRpbmcgaW5mb3JtYXRpb24gYW5kIGRldGFpbHM8L3A+XG4gICAgICAgIDxidXR0b24gZGF0YS10ZXN0aWQ9XCJ2aWV3LWRvY3VtZW50cy1idG5cIj5WaWV3IERvY3VtZW50czwvYnV0dG9uPlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICk7XG59O1xuXG4vLyBNb2NrIHNpbmdsZSBidWlsZGluZyBzY2VuYXJpb1xuY29uc3QgTW9ja1NpbmdsZUJ1aWxkaW5nUGFnZSA9ICgpID0+IHtcbiAgY29uc3QgW3NlbGVjdGVkQnVpbGRpbmcsIHNldFNlbGVjdGVkQnVpbGRpbmddID0gUmVhY3QudXNlU3RhdGUoJ2J1aWxkaW5nLTEnKTtcbiAgY29uc3QgW2J1aWxkaW5nc10gPSBSZWFjdC51c2VTdGF0ZShTSU5HTEVfQlVJTERJTkdfVVNFUl9EQVRBKTtcbiAgXG4gIC8vIEF1dG8tZm9yd2FyZCBmb3Igc2luZ2xlIGJ1aWxkaW5nIHVzZXJcbiAgUmVhY3QudXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoYnVpbGRpbmdzLmxlbmd0aCA9PT0gMSAmJiAhbW9ja0N1cnJlbnRTZWFyY2guaW5jbHVkZXMoJ2J1aWxkaW5nPScpKSB7XG4gICAgICBtb2NrQ3VycmVudFNlYXJjaCA9IGA/YnVpbGRpbmc9JHtidWlsZGluZ3NbMF0uaWR9YDtcbiAgICAgIG1vY2tTZXRMb2NhdGlvbihgL3Jlc2lkZW50cy9idWlsZGluZz9idWlsZGluZz0ke2J1aWxkaW5nc1swXS5pZH1gKTtcbiAgICB9XG4gIH0sIFtidWlsZGluZ3NdKTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJzaW5nbGUtYnVpbGRpbmctZGV0YWlscy1zY3JlZW5cIj5cbiAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJoZWFkZXItbm8tYmFja1wiPlxuICAgICAgICA8aDEgZGF0YS10ZXN0aWQ9XCJidWlsZGluZy10aXRsZVwiPkJ1aWxkaW5nIERldGFpbHM8L2gxPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwiYnVpbGRpbmctaW5mb1wiPlxuICAgICAgICA8cCBkYXRhLXRlc3RpZD1cInNlbGVjdGVkLWJ1aWxkaW5nLWlkXCI+e3NlbGVjdGVkQnVpbGRpbmd9PC9wPlxuICAgICAgICA8cD5TaW5nbGUgYnVpbGRpbmcgLSBubyBiYWNrIGJ1dHRvbjwvcD5cbiAgICAgICAgPGJ1dHRvbiBkYXRhLXRlc3RpZD1cInZpZXctZG9jdW1lbnRzLWJ0blwiPlZpZXcgRG9jdW1lbnRzPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn07XG5cbmRlc2NyaWJlKCdIaWVyYXJjaGljYWwgTmF2aWdhdGlvbiBVc2VyIEZsb3dzJywgKCkgPT4ge1xuICBsZXQgcXVlcnlDbGllbnQ6IFF1ZXJ5Q2xpZW50O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHF1ZXJ5Q2xpZW50ID0gbmV3IFF1ZXJ5Q2xpZW50KHtcbiAgICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgIHF1ZXJpZXM6IHtcbiAgICAgICAgICByZXRyeTogZmFsc2UsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0pO1xuXG4gICAgLy8gUmVzZXQgbW9ja3MgYW5kIHN0YXRlXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgbW9ja1NldExvY2F0aW9uLm1vY2tDbGVhcigpO1xuICAgIG1vY2tDdXJyZW50TG9jYXRpb24gPSAnL3Jlc2lkZW50cy9idWlsZGluZyc7XG4gICAgbW9ja0N1cnJlbnRTZWFyY2ggPSAnJztcblxuICAgIC8vIE1vY2sgd2luZG93Lmhpc3RvcnlcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnaGlzdG9yeScsIHtcbiAgICAgIHZhbHVlOiB7XG4gICAgICAgIHB1c2hTdGF0ZTogamVzdC5mbigpLFxuICAgICAgfSxcbiAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgIH0pO1xuXG4gICAgLy8gTW9jayBzdWNjZXNzZnVsIEFQSSByZXNwb25zZXNcbiAgICBtb2NrRmV0Y2gubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgb2s6IHRydWUsXG4gICAgICBqc29uOiBhc3luYyAoKSA9PiBNVUxUSVBMRV9CVUlMRElOR1NfVVNFUl9EQVRBLFxuICAgIH0pO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGplc3QucmVzZXRBbGxNb2NrcygpO1xuICB9KTtcblxuICBjb25zdCByZW5kZXJXaXRoUHJvdmlkZXJzID0gKGNvbXBvbmVudDogUmVhY3QuUmVhY3RFbGVtZW50KSA9PiB7XG4gICAgcmV0dXJuIHJlbmRlcihcbiAgICAgIDxRdWVyeUNsaWVudFByb3ZpZGVyIGNsaWVudD17cXVlcnlDbGllbnR9PlxuICAgICAgICB7Y29tcG9uZW50fVxuICAgICAgPC9RdWVyeUNsaWVudFByb3ZpZGVyPlxuICAgICk7XG4gIH07XG5cbiAgZGVzY3JpYmUoJ011bHRpcGxlIEJ1aWxkaW5ncyBVc2VyIEZsb3cnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNvbXBsZXRlIGZ1bGwgdXNlciBmbG93OiBsYW5kaW5nIOKGkiBzZWxlY3Rpb24g4oaSIGRldGFpbHMg4oaSIGJhY2snLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrQnVpbGRpbmdQYWdlIC8+KTtcblxuICAgICAgLy8gMS4gSW5pdGlhbCBsYW5kaW5nIC0gc2hvdWxkIHNob3cgbG9hZGluZyB0aGVuIHNlbGVjdGlvblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnbG9hZGluZy1zdGF0ZScpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctc2VsZWN0aW9uLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NlbGVjdGlvbi10aXRsZScpKS50b0hhdmVUZXh0Q29udGVudCgnU2VsZWN0IEJ1aWxkaW5nJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZ3MtZ3JpZCcpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuXG4gICAgICAvLyBTaG91bGQgc2hvdyBhbGwgYXZhaWxhYmxlIGJ1aWxkaW5nc1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctY2FyZC1idWlsZGluZy0xJykpLnRvSGF2ZVRleHRDb250ZW50KCdCdWlsZGluZyBBJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1jYXJkLWJ1aWxkaW5nLTInKSkudG9IYXZlVGV4dENvbnRlbnQoJ0J1aWxkaW5nIEInKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWNhcmQtYnVpbGRpbmctMycpKS50b0hhdmVUZXh0Q29udGVudCgnQnVpbGRpbmcgQycpO1xuXG4gICAgICAvLyAyLiBVc2VyIHNlbGVjdHMgYSBidWlsZGluZ1xuICAgICAgY29uc3QgYnVpbGRpbmcyQ2FyZCA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctY2FyZC1idWlsZGluZy0yJyk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2soYnVpbGRpbmcyQ2FyZCk7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1kZXRhaWxzLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCBzaG93IGJ1aWxkaW5nIGRldGFpbHMgd2l0aCBiYWNrIGJ1dHRvblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctdGl0bGUnKSkudG9IYXZlVGV4dENvbnRlbnQoJ0J1aWxkaW5nIERldGFpbHMnKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NlbGVjdGVkLWJ1aWxkaW5nLWlkJykpLnRvSGF2ZVRleHRDb250ZW50KCdidWlsZGluZy0yJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdiYWNrLXRvLWJ1aWxkaW5ncycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuXG4gICAgICAvLyBTaG91bGQgdXBkYXRlIHJvdXRlclxuICAgICAgZXhwZWN0KG1vY2tTZXRMb2NhdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9yZXNpZGVudHMvYnVpbGRpbmc/YnVpbGRpbmc9YnVpbGRpbmctMicpO1xuXG4gICAgICAvLyAzLiBVc2VyIGNsaWNrcyBiYWNrXG4gICAgICBjb25zdCBiYWNrQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdiYWNrLXRvLWJ1aWxkaW5ncycpO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKGJhY2tCdXR0b24pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctc2VsZWN0aW9uLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCByZXR1cm4gdG8gc2VsZWN0aW9uIHNjcmVlblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0aW9uLXRpdGxlJykpLnRvSGF2ZVRleHRDb250ZW50KCdTZWxlY3QgQnVpbGRpbmcnKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5ncy1ncmlkJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3QobW9ja1NldExvY2F0aW9uKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL3Jlc2lkZW50cy9idWlsZGluZycpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBkaXJlY3QgVVJMIG5hdmlnYXRpb24gdG8gYnVpbGRpbmcgZGV0YWlscycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIGRpcmVjdCBuYXZpZ2F0aW9uIHRvIGJ1aWxkaW5nIGRldGFpbHNcbiAgICAgIG1vY2tDdXJyZW50U2VhcmNoID0gJz9idWlsZGluZz1idWlsZGluZy0xJztcbiAgICAgIFxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja0J1aWxkaW5nUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1kZXRhaWxzLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCBsYW5kIGRpcmVjdGx5IG9uIGJ1aWxkaW5nIGRldGFpbHNcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLXRpdGxlJykpLnRvSGF2ZVRleHRDb250ZW50KCdCdWlsZGluZyBEZXRhaWxzJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1idWlsZGluZy1pZCcpKS50b0hhdmVUZXh0Q29udGVudCgnYnVpbGRpbmctMScpO1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYmFjay10by1idWlsZGluZ3MnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBzaG93IGJhY2sgYnV0dG9uIG9ubHkgd2hlbiBtdWx0aXBsZSBidWlsZGluZ3MgYXJlIGF2YWlsYWJsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tDdXJyZW50U2VhcmNoID0gJz9idWlsZGluZz1idWlsZGluZy0yJztcbiAgICAgIFxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja0J1aWxkaW5nUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1kZXRhaWxzLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFdpdGggbXVsdGlwbGUgYnVpbGRpbmdzLCBzaG91bGQgc2hvdyBiYWNrIGJ1dHRvblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYmFjay10by1idWlsZGluZ3MnKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYnVpbGRpbmcgc2VsZWN0aW9uIGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBBUEkgZmFpbHVyZVxuICAgICAgbW9ja0ZldGNoLm1vY2tSZWplY3RlZFZhbHVlKG5ldyBFcnJvcignQVBJIEVycm9yJykpO1xuICAgICAgXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrQnVpbGRpbmdQYWdlIC8+KTtcblxuICAgICAgLy8gU2hvdWxkIGhhbmRsZSBsb2FkaW5nIHN0YXRlXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdsb2FkaW5nLXN0YXRlJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG5cbiAgICAgIC8vIEFmdGVyIHRpbWVvdXQsIHNob3VsZCBzdGlsbCBzaG93IHNlbGVjdGlvbiBzY3JlZW4gKGV2ZW4gd2l0aCBlbXB0eSBkYXRhKVxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4ucXVlcnlCeVRlc3RJZCgnbG9hZGluZy1zcGlubmVyJykpLm5vdC50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdTaW5nbGUgQnVpbGRpbmcgVXNlciBGbG93JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBhdXRvLWZvcndhcmQgc2luZ2xlIGJ1aWxkaW5nIHVzZXJzIHRvIGRldGFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrU2luZ2xlQnVpbGRpbmdQYWdlIC8+KTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NpbmdsZS1idWlsZGluZy1kZXRhaWxzLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCBsYW5kIGRpcmVjdGx5IG9uIGRldGFpbHMsIG5vIHNlbGVjdGlvbiBzY3JlZW5cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLXRpdGxlJykpLnRvSGF2ZVRleHRDb250ZW50KCdCdWlsZGluZyBEZXRhaWxzJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1idWlsZGluZy1pZCcpKS50b0hhdmVUZXh0Q29udGVudCgnYnVpbGRpbmctMScpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgTk9UIHNob3cgYmFjayBidXR0b24gKHNpbmdsZSBidWlsZGluZylcbiAgICAgIGV4cGVjdChzY3JlZW4ucXVlcnlCeVRlc3RJZCgnYmFjay10by1idWlsZGluZ3MnKSkubm90LnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdoZWFkZXItbm8tYmFjaycpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuXG4gICAgICAvLyBTaG91bGQgYXV0by1mb3J3YXJkIFVSTFxuICAgICAgZXhwZWN0KG1vY2tTZXRMb2NhdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9yZXNpZGVudHMvYnVpbGRpbmc/YnVpbGRpbmc9YnVpbGRpbmctMScpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGhhbmRsZSBzaW5nbGUgYnVpbGRpbmcgZGlyZWN0IFVSTCBhY2Nlc3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2VyIGRpcmVjdGx5IGFjY2Vzc2VzIHdpdGggYnVpbGRpbmcgcGFyYW1cbiAgICAgIG1vY2tDdXJyZW50U2VhcmNoID0gJz9idWlsZGluZz1idWlsZGluZy0xJztcbiAgICAgIFxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja1NpbmdsZUJ1aWxkaW5nUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzaW5nbGUtYnVpbGRpbmctZGV0YWlscy1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgc2hvdyBkZXRhaWxzIHdpdGhvdXQgYmFjayBidXR0b25cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLXRpdGxlJykpLnRvSGF2ZVRleHRDb250ZW50KCdCdWlsZGluZyBEZXRhaWxzJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLnF1ZXJ5QnlUZXN0SWQoJ2JhY2stdG8tYnVpbGRpbmdzJykpLm5vdC50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVVJMIFN0YXRlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIG1haW50YWluIFVSTCBjb25zaXN0ZW5jeSB0aHJvdWdob3V0IG5hdmlnYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrQnVpbGRpbmdQYWdlIC8+KTtcblxuICAgICAgLy8gU3RhcnQgd2l0aCBiYXNlIFVSTFxuICAgICAgZXhwZWN0KG1vY2tDdXJyZW50TG9jYXRpb24pLnRvQmUoJy9yZXNpZGVudHMvYnVpbGRpbmcnKTtcbiAgICAgIGV4cGVjdChtb2NrQ3VycmVudFNlYXJjaCkudG9CZSgnJyk7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1zZWxlY3Rpb24tc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2VsZWN0IGJ1aWxkaW5nIC0gc2hvdWxkIHVwZGF0ZSBVUkxcbiAgICAgIGNvbnN0IGJ1aWxkaW5nQ2FyZCA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctY2FyZC1idWlsZGluZy0xJyk7XG4gICAgICBmaXJlRXZlbnQuY2xpY2soYnVpbGRpbmdDYXJkKTtcblxuICAgICAgZXhwZWN0KG1vY2tDdXJyZW50U2VhcmNoKS50b0JlKCc/YnVpbGRpbmc9YnVpbGRpbmctMScpO1xuICAgICAgZXhwZWN0KG1vY2tTZXRMb2NhdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9yZXNpZGVudHMvYnVpbGRpbmc/YnVpbGRpbmc9YnVpbGRpbmctMScpO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctZGV0YWlscy1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBHbyBiYWNrIC0gc2hvdWxkIGNsZWFyIFVSTCBwYXJhbWV0ZXJzXG4gICAgICBjb25zdCBiYWNrQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdiYWNrLXRvLWJ1aWxkaW5ncycpO1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKGJhY2tCdXR0b24pO1xuXG4gICAgICBleHBlY3QobW9ja0N1cnJlbnRTZWFyY2gpLnRvQmUoJycpO1xuICAgICAgZXhwZWN0KG1vY2tTZXRMb2NhdGlvbikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9yZXNpZGVudHMvYnVpbGRpbmcnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIFVSTCBwYXJhbWV0ZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgbWFsZm9ybWVkIG9yIG5vbi1leGlzdGVudCBidWlsZGluZyBJRFxuICAgICAgbW9ja0N1cnJlbnRTZWFyY2ggPSAnP2J1aWxkaW5nPW5vbmV4aXN0ZW50LWlkJztcbiAgICAgIFxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja0J1aWxkaW5nUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1kZXRhaWxzLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFNob3VsZCBzdGlsbCBhdHRlbXB0IHRvIHNob3cgZGV0YWlscyAoZ3JhY2VmdWwgZGVncmFkYXRpb24pXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1idWlsZGluZy1pZCcpKS50b0hhdmVUZXh0Q29udGVudCgnbm9uZXhpc3RlbnQtaWQnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgbXVsdGlwbGUgVVJMIHBhcmFtZXRlcnMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gU2ltdWxhdGUgVVJMIHdpdGggZXh0cmEgcGFyYW1ldGVyc1xuICAgICAgbW9ja0N1cnJlbnRTZWFyY2ggPSAnP2J1aWxkaW5nPWJ1aWxkaW5nLTEmZXh0cmE9cGFyYW0mYW5vdGhlcj12YWx1ZSc7XG4gICAgICBcbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPE1vY2tCdWlsZGluZ1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctZGV0YWlscy1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgZXh0cmFjdCBidWlsZGluZyBwYXJhbWV0ZXIgY29ycmVjdGx5XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1idWlsZGluZy1pZCcpKS50b0hhdmVUZXh0Q29udGVudCgnYnVpbGRpbmctMScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBFeHBlcmllbmNlIFNjZW5hcmlvcycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIHF1aWNrIGJhY2stYW5kLWZvcnRoIG5hdmlnYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrQnVpbGRpbmdQYWdlIC8+KTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLXNlbGVjdGlvbi1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBRdWljayBzZWxlY3Rpb25cbiAgICAgIGZpcmVFdmVudC5jbGljayhzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWNhcmQtYnVpbGRpbmctMScpKTtcblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWRldGFpbHMtc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gUXVpY2sgYmFja1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHNjcmVlbi5nZXRCeVRlc3RJZCgnYmFjay10by1idWlsZGluZ3MnKSk7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1zZWxlY3Rpb24tc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2VsZWN0IGRpZmZlcmVudCBidWlsZGluZ1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctY2FyZC1idWlsZGluZy0zJykpO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctZGV0YWlscy1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0ZWQtYnVpbGRpbmctaWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ2J1aWxkaW5nLTMnKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHByZXNlcnZlIHNlbGVjdGlvbiB3aGVuIG5hdmlnYXRpbmcgYXdheSBhbmQgYmFjaycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIHVzZXIgbmF2aWdhdGluZyB0byBidWlsZGluZyBkZXRhaWxzXG4gICAgICBtb2NrQ3VycmVudFNlYXJjaCA9ICc/YnVpbGRpbmc9YnVpbGRpbmctMic7XG4gICAgICBcbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcnMoPE1vY2tCdWlsZGluZ1BhZ2UgLz4pO1xuXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctZGV0YWlscy1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0ZWQtYnVpbGRpbmctaWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ2J1aWxkaW5nLTInKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaW11bGF0ZSB1c2VyIG5hdmlnYXRpbmcgYXdheSAoZS5nLiwgdG8gYW5vdGhlciBwYWdlKSBhbmQgYmFja1xuICAgICAgLy8gSW4gYSByZWFsIGFwcCwgdGhpcyB3b3VsZCBiZSBoYW5kbGVkIGJ5IHJvdXRlIGNoYW5nZXNcbiAgICAgIG1vY2tDdXJyZW50U2VhcmNoID0gJyc7XG4gICAgICBcbiAgICAgIC8vIFNpbXVsYXRlIHJldHVybmluZyB0byB0aGUgcGFnZVxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja0J1aWxkaW5nUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1zZWxlY3Rpb24tc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2hvdWxkIHNob3cgc2VsZWN0aW9uIHNjcmVlbiAobm8gcHJlc2VydmVkIHN0YXRlIHdpdGhvdXQgVVJMIHBhcmFtcylcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5ncy1ncmlkJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdNYW5hZ2VyIFJlc2lkZW5jZXMgUGFnZSBOYXZpZ2F0aW9uIEZsb3cnLCAoKSA9PiB7XG4gICAgLy8gTW9jayBNYW5hZ2VyIFJlc2lkZW5jZXMgcGFnZSBjb21wb25lbnQgd2l0aCBvcmdhbml6YXRpb24g4oaSIGJ1aWxkaW5nIGhpZXJhcmNoeVxuICAgIGNvbnN0IE1vY2tNYW5hZ2VyUmVzaWRlbmNlc1BhZ2UgPSB3aXRoSGllcmFyY2hpY2FsU2VsZWN0aW9uKCgpID0+IHtcbiAgICAgIGNvbnN0IHsgb3JnYW5pemF0aW9uSWQsIGJ1aWxkaW5nSWQsIHNob3dCYWNrQnV0dG9uLCBvbkJhY2sgfSA9IHVzZUNvbnRleHQoSGllcmFyY2h5Q29udGV4dCk7XG4gICAgICBcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxkaXYgZGF0YS10ZXN0aWQ9XCJtYW5hZ2VyLXJlc2lkZW5jZXMtc2NyZWVuXCI+XG4gICAgICAgICAgPGRpdiBkYXRhLXRlc3RpZD1cInJlc2lkZW5jZXMtdGl0bGVcIj5NYW5hZ2VyIFJlc2lkZW5jZXM8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwic2VsZWN0ZWQtb3JnYW5pemF0aW9uLWlkXCI+e29yZ2FuaXphdGlvbklkIHx8ICdub25lJ308L2Rpdj5cbiAgICAgICAgICA8ZGl2IGRhdGEtdGVzdGlkPVwic2VsZWN0ZWQtYnVpbGRpbmctaWRcIj57YnVpbGRpbmdJZCB8fCAnbm9uZSd9PC9kaXY+XG4gICAgICAgICAge3Nob3dCYWNrQnV0dG9uICYmIChcbiAgICAgICAgICAgIDxidXR0b24gZGF0YS10ZXN0aWQ9XCJiYWNrLXRvLXNlbGVjdGlvblwiIG9uQ2xpY2s9e29uQmFja30+XG4gICAgICAgICAgICAgIEJhY2sgdG8gU2VsZWN0aW9uXG4gICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG4gICAgfSwge1xuICAgICAgaGllcmFyY2h5OiBbJ29yZ2FuaXphdGlvbicsICdidWlsZGluZyddXG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbmF2aWdhdGUgdGhyb3VnaCBvcmdhbml6YXRpb24g4oaSIGJ1aWxkaW5nIGZsb3cgZm9yIG1hbmFnZXIgcmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgQVBJIHJlc3BvbnNlcyBmb3Igb3JnYW5pemF0aW9ucyBhbmQgYnVpbGRpbmdzXG4gICAgICBjb25zdCBtb2NrT3JnYW5pemF0aW9uc0RhdGEgPSBbXG4gICAgICAgIHsgaWQ6ICdvcmctMScsIG5hbWU6ICdPcmdhbml6YXRpb24gQScgfSxcbiAgICAgICAgeyBpZDogJ29yZy0yJywgbmFtZTogJ09yZ2FuaXphdGlvbiBCJyB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja0J1aWxkaW5nc0RhdGEgPSBbXG4gICAgICAgIHsgaWQ6ICdidWlsZGluZy0xJywgbmFtZTogJ0J1aWxkaW5nIEEnLCBvcmdhbml6YXRpb25JZDogJ29yZy0xJyB9LFxuICAgICAgICB7IGlkOiAnYnVpbGRpbmctMicsIG5hbWU6ICdCdWlsZGluZyBCJywgb3JnYW5pemF0aW9uSWQ6ICdvcmctMScgfSxcbiAgICAgIF07XG5cbiAgICAgIGxldCBhcGlDYWxsQ291bnQgPSAwO1xuICAgICAgbW9ja0ZldGNoLm1vY2tJbXBsZW1lbnRhdGlvbigodXJsKSA9PiB7XG4gICAgICAgIGFwaUNhbGxDb3VudCsrO1xuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCcvYXBpL29yZ2FuaXphdGlvbnMnKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgICBqc29uOiBhc3luYyAoKSA9PiBtb2NrT3JnYW5pemF0aW9uc0RhdGEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVybC5pbmNsdWRlcygnL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncycpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7IGJ1aWxkaW5nczogbW9ja0J1aWxkaW5nc0RhdGEgfSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgVW5leHBlY3RlZCBVUkw6ICR7dXJsfWApKTtcbiAgICAgIH0pO1xuXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrTWFuYWdlclJlc2lkZW5jZXNQYWdlIC8+KTtcblxuICAgICAgLy8gMS4gU2hvdWxkIHN0YXJ0IHdpdGggb3JnYW5pemF0aW9uIHNlbGVjdGlvblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ29yZ2FuaXphdGlvbi1zZWxlY3Rpb24tc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0aW9uLXRpdGxlJykpLnRvSGF2ZVRleHRDb250ZW50KCdTZWxlY3QgT3JnYW5pemF0aW9uJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdvcmctY2FyZC1vcmctMScpKS50b0hhdmVUZXh0Q29udGVudCgnT3JnYW5pemF0aW9uIEEnKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ29yZy1jYXJkLW9yZy0yJykpLnRvSGF2ZVRleHRDb250ZW50KCdPcmdhbml6YXRpb24gQicpO1xuXG4gICAgICAvLyAyLiBTZWxlY3QgYW4gb3JnYW5pemF0aW9uXG4gICAgICBmaXJlRXZlbnQuY2xpY2soc2NyZWVuLmdldEJ5VGVzdElkKCdvcmctY2FyZC1vcmctMScpKTtcblxuICAgICAgLy8gMy4gU2hvdWxkIG1vdmUgdG8gYnVpbGRpbmcgc2VsZWN0aW9uXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctc2VsZWN0aW9uLXNjcmVlbicpKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ3NlbGVjdGlvbi10aXRsZScpKS50b0hhdmVUZXh0Q29udGVudCgnU2VsZWN0IEJ1aWxkaW5nJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdidWlsZGluZy1jYXJkLWJ1aWxkaW5nLTEnKSkudG9IYXZlVGV4dENvbnRlbnQoJ0J1aWxkaW5nIEEnKTtcbiAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLWNhcmQtYnVpbGRpbmctMicpKS50b0hhdmVUZXh0Q29udGVudCgnQnVpbGRpbmcgQicpO1xuXG4gICAgICAvLyA0LiBTZWxlY3QgYSBidWlsZGluZ1xuICAgICAgZmlyZUV2ZW50LmNsaWNrKHNjcmVlbi5nZXRCeVRlc3RJZCgnYnVpbGRpbmctY2FyZC1idWlsZGluZy0xJykpO1xuXG4gICAgICAvLyA1LiBTaG91bGQgcmVhY2ggdGhlIG1hbmFnZXIgcmVzaWRlbmNlcyBzY3JlZW5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdtYW5hZ2VyLXJlc2lkZW5jZXMtc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgncmVzaWRlbmNlcy10aXRsZScpKS50b0hhdmVUZXh0Q29udGVudCgnTWFuYWdlciBSZXNpZGVuY2VzJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1vcmdhbml6YXRpb24taWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ29yZy0xJyk7XG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3RlZC1idWlsZGluZy1pZCcpKS50b0hhdmVUZXh0Q29udGVudCgnYnVpbGRpbmctMScpO1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnYmFjay10by1zZWxlY3Rpb24nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBhdXRvLWZvcndhcmQgd2hlbiBtYW5hZ2VyIGhhcyBzaW5nbGUgYnVpbGRpbmcgaW4gb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBzaW5nbGUgYnVpbGRpbmcgcmVzcG9uc2VcbiAgICAgIGNvbnN0IG1vY2tPcmdhbml6YXRpb25zRGF0YSA9IFtcbiAgICAgICAgeyBpZDogJ29yZy0xJywgbmFtZTogJ09yZ2FuaXphdGlvbiBBJyB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja1NpbmdsZUJ1aWxkaW5nRGF0YSA9IFtcbiAgICAgICAgeyBpZDogJ2J1aWxkaW5nLTEnLCBuYW1lOiAnU2luZ2xlIEJ1aWxkaW5nJywgb3JnYW5pemF0aW9uSWQ6ICdvcmctMScgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tGZXRjaC5tb2NrSW1wbGVtZW50YXRpb24oKHVybCkgPT4ge1xuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCcvYXBpL29yZ2FuaXphdGlvbnMnKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgICBqc29uOiBhc3luYyAoKSA9PiBtb2NrT3JnYW5pemF0aW9uc0RhdGEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVybC5pbmNsdWRlcygnL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncycpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7IGJ1aWxkaW5nczogbW9ja1NpbmdsZUJ1aWxkaW5nRGF0YSB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKGBVbmV4cGVjdGVkIFVSTDogJHt1cmx9YCkpO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0YXJ0IHdpdGggb3JnYW5pemF0aW9uIGFscmVhZHkgc2VsZWN0ZWRcbiAgICAgIG1vY2tDdXJyZW50U2VhcmNoID0gJz9vcmdhbml6YXRpb249b3JnLTEnO1xuICAgICAgXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXJzKDxNb2NrTWFuYWdlclJlc2lkZW5jZXNQYWdlIC8+KTtcblxuICAgICAgLy8gU2hvdWxkIGF1dG8tZm9yd2FyZCB0aHJvdWdoIHNpbmdsZSBidWlsZGluZyB0byBmaW5hbCBzY3JlZW5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdtYW5hZ2VyLXJlc2lkZW5jZXMtc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0ZWQtb3JnYW5pemF0aW9uLWlkJykpLnRvSGF2ZVRleHRDb250ZW50KCdvcmctMScpO1xuICAgICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgnc2VsZWN0ZWQtYnVpbGRpbmctaWQnKSkudG9IYXZlVGV4dENvbnRlbnQoJ2J1aWxkaW5nLTEnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgYmFjayBuYXZpZ2F0aW9uIGluIG1hbmFnZXIgcmVzaWRlbmNlcyBoaWVyYXJjaHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JnYW5pemF0aW9uc0RhdGEgPSBbXG4gICAgICAgIHsgaWQ6ICdvcmctMScsIG5hbWU6ICdPcmdhbml6YXRpb24gQScgfSxcbiAgICAgICAgeyBpZDogJ29yZy0yJywgbmFtZTogJ09yZ2FuaXphdGlvbiBCJyB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgbW9ja0J1aWxkaW5nc0RhdGEgPSBbXG4gICAgICAgIHsgaWQ6ICdidWlsZGluZy0xJywgbmFtZTogJ0J1aWxkaW5nIEEnLCBvcmdhbml6YXRpb25JZDogJ29yZy0xJyB9LFxuICAgICAgICB7IGlkOiAnYnVpbGRpbmctMicsIG5hbWU6ICdCdWlsZGluZyBCJywgb3JnYW5pemF0aW9uSWQ6ICdvcmctMScgfSxcbiAgICAgIF07XG5cbiAgICAgIG1vY2tGZXRjaC5tb2NrSW1wbGVtZW50YXRpb24oKHVybCkgPT4ge1xuICAgICAgICBpZiAodXJsLmluY2x1ZGVzKCcvYXBpL29yZ2FuaXphdGlvbnMnKSkge1xuICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgb2s6IHRydWUsXG4gICAgICAgICAgICBqc29uOiBhc3luYyAoKSA9PiBtb2NrT3JnYW5pemF0aW9uc0RhdGEsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVybC5pbmNsdWRlcygnL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncycpKSB7XG4gICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICAgICAgICBvazogdHJ1ZSxcbiAgICAgICAgICAgIGpzb246IGFzeW5jICgpID0+ICh7IGJ1aWxkaW5nczogbW9ja0J1aWxkaW5nc0RhdGEgfSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcihgVW5leHBlY3RlZCBVUkw6ICR7dXJsfWApKTtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTdGFydCB3aXRoIGJvdGggb3JnYW5pemF0aW9uIGFuZCBidWlsZGluZyBzZWxlY3RlZFxuICAgICAgbW9ja0N1cnJlbnRTZWFyY2ggPSAnP29yZ2FuaXphdGlvbj1vcmctMSZidWlsZGluZz1idWlsZGluZy0xJztcbiAgICAgIFxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVycyg8TW9ja01hbmFnZXJSZXNpZGVuY2VzUGFnZSAvPik7XG5cbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdtYW5hZ2VyLXJlc2lkZW5jZXMtc2NyZWVuJykpLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcblxuICAgICAgLy8gQ2xpY2sgYmFjayBidXR0b25cbiAgICAgIGZpcmVFdmVudC5jbGljayhzY3JlZW4uZ2V0QnlUZXN0SWQoJ2JhY2stdG8tc2VsZWN0aW9uJykpO1xuXG4gICAgICAvLyBTaG91bGQgcmV0dXJuIHRvIGJ1aWxkaW5nIHNlbGVjdGlvblxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1aWxkaW5nLXNlbGVjdGlvbi1zY3JlZW4nKSkudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3Qoc2NyZWVuLmdldEJ5VGVzdElkKCdzZWxlY3Rpb24tdGl0bGUnKSkudG9IYXZlVGV4dENvbnRlbnQoJ1NlbGVjdCBCdWlsZGluZycpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==