72808e58885fb4e10e0570e9b5401e37
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerDemandRoutes = registerDemandRoutes;
const db_1 = require("../db");
const schema_1 = require("../../shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
const index_1 = require("../auth/index");
const operations_1 = require("../../shared/schemas/operations");
/**
 * Register demand routes for managing resident demands and complaints.
 *
 * @param app - Express application instance.
 */
/**
 * RegisterDemandRoutes function.
 * @param app
 * @returns Function result.
 */
function registerDemandRoutes(app) {
    // Get demands for a user (residents and managers)
    app.get('/api/demands', index_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const { buildingId, residenceId, type, status, search } = req.query;
            // Base query with joins
            let query = db_1.db
                .select({
                id: schema_1.demands.id,
                submitterId: schema_1.demands.submitterId,
                type: schema_1.demands.type,
                assignationResidenceId: schema_1.demands.assignationResidenceId,
                assignationBuildingId: schema_1.demands.assignationBuildingId,
                description: schema_1.demands.description,
                attachments: schema_1.demands.attachments,
                residenceId: schema_1.demands.residenceId,
                buildingId: schema_1.demands.buildingId,
                status: schema_1.demands.status,
                reviewedBy: schema_1.demands.reviewedBy,
                reviewedAt: schema_1.demands.reviewedAt,
                reviewNotes: schema_1.demands.reviewNotes,
                createdAt: schema_1.demands.createdAt,
                updatedAt: schema_1.demands.updatedAt,
                submitter: {
                    id: schema_1.users.id,
                    firstName: schema_1.users.firstName,
                    lastName: schema_1.users.lastName,
                    email: schema_1.users.email,
                },
                residence: {
                    id: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    buildingId: schema_1.residences.buildingId,
                },
                building: {
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                },
            })
                .from(schema_1.demands)
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.demands.submitterId, schema_1.users.id))
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.demands.residenceId, schema_1.residences.id))
                .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.demands.buildingId, schema_1.buildings.id));
            // Apply role-based access control
            const conditions = [];
            if (user.role === 'admin') {
                // Admins can see all demands - no additional conditions needed
            }
            else if (user.role === 'manager') {
                // Managers can see demands from their organization's buildings
                const userOrganizationData = await db_1.db
                    .select({ organizationId: schema_1.userOrganizations.organizationId })
                    .from(schema_1.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, user.id));
                if (userOrganizationData.length > 0) {
                    const organizationId = userOrganizationData[0].organizationId;
                    // Get buildings belonging to the manager's organization
                    const organizationBuildings = await db_1.db
                        .select({ buildingId: schema_1.buildings.id })
                        .from(schema_1.buildings)
                        .where((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationId));
                    if (organizationBuildings.length > 0) {
                        const buildingIds = organizationBuildings.map(b => b.buildingId);
                        conditions.push((0, drizzle_orm_1.inArray)(schema_1.demands.buildingId, buildingIds));
                    }
                    else {
                        // Manager has no buildings - return empty results
                        conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.id, 'never-match'));
                    }
                }
                else {
                    // Manager not assigned to any organization - return empty results
                    conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.id, 'never-match'));
                }
            }
            else {
                // Residents and tenants can only see demands they created
                conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.submitterId, user.id));
            }
            // Add filter conditions
            if (buildingId) {
                conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.buildingId, buildingId));
            }
            if (residenceId) {
                conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.residenceId, residenceId));
            }
            if (type) {
                conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.type, type));
            }
            if (status) {
                conditions.push((0, drizzle_orm_1.eq)(schema_1.demands.status, status));
            }
            // Apply conditions to query if any exist
            let finalQuery;
            if (conditions.length > 0) {
                finalQuery = query.where((0, drizzle_orm_1.and)(...conditions));
            }
            else {
                finalQuery = query;
            }
            const results = await finalQuery.orderBy((0, drizzle_orm_1.desc)(schema_1.demands.createdAt));
            // Filter by search term if provided
            let filteredResults = results;
            if (search) {
                const searchTerm = search.toLowerCase();
                filteredResults = results.filter((demand) => demand.description.toLowerCase().includes(searchTerm) ||
                    demand.submitter.firstName?.toLowerCase().includes(searchTerm) ||
                    demand.submitter.lastName?.toLowerCase().includes(searchTerm) ||
                    demand.residence.unitNumber.toLowerCase().includes(searchTerm) ||
                    demand.building.name.toLowerCase().includes(searchTerm));
            }
            res.json(filteredResults);
        }
        catch (error) {
            res.status(500).json({ message: 'Failed to fetch demands' });
        }
    });
    // Get a specific demand
    app.get('/api/demands/:id', index_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const user = req.user;
            const demand = await db_1.db
                .select({
                id: schema_1.demands.id,
                submitterId: schema_1.demands.submitterId,
                type: schema_1.demands.type,
                assignationResidenceId: schema_1.demands.assignationResidenceId,
                assignationBuildingId: schema_1.demands.assignationBuildingId,
                description: schema_1.demands.description,
                attachments: schema_1.demands.attachments,
                residenceId: schema_1.demands.residenceId,
                buildingId: schema_1.demands.buildingId,
                status: schema_1.demands.status,
                reviewedBy: schema_1.demands.reviewedBy,
                reviewedAt: schema_1.demands.reviewedAt,
                reviewNotes: schema_1.demands.reviewNotes,
                createdAt: schema_1.demands.createdAt,
                updatedAt: schema_1.demands.updatedAt,
                submitter: {
                    id: schema_1.users.id,
                    firstName: schema_1.users.firstName,
                    lastName: schema_1.users.lastName,
                    email: schema_1.users.email,
                },
                residence: {
                    id: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    buildingId: schema_1.residences.buildingId,
                },
                building: {
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                },
            })
                .from(schema_1.demands)
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.demands.submitterId, schema_1.users.id))
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.demands.residenceId, schema_1.residences.id))
                .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.demands.buildingId, schema_1.buildings.id))
                .where((0, drizzle_orm_1.eq)(schema_1.demands.id, id))
                .limit(1);
            if (demand.length === 0) {
                return res.status(404).json({ message: 'Demand not found' });
            }
            const demandData = demand[0];
            // Check access permissions based on user role
            let hasAccess = false;
            if (user.role === 'admin') {
                // Admins can view all demands
                hasAccess = true;
            }
            else if (user.role === 'manager') {
                // Managers can view demands from their organization's buildings
                const userOrganizationData = await db_1.db
                    .select({ organizationId: schema_1.userOrganizations.organizationId })
                    .from(schema_1.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, user.id));
                if (userOrganizationData.length > 0) {
                    const organizationId = userOrganizationData[0].organizationId;
                    // Check if the demand's building belongs to the manager's organization
                    const buildingOrganization = await db_1.db
                        .select({ organizationId: schema_1.buildings.organizationId })
                        .from(schema_1.buildings)
                        .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, demandData.buildingId))
                        .limit(1);
                    if (buildingOrganization.length > 0 && buildingOrganization[0].organizationId === organizationId) {
                        hasAccess = true;
                    }
                }
            }
            else {
                // Residents and tenants can only view their own demands
                hasAccess = demandData.submitterId === user.id;
            }
            if (!hasAccess) {
                return res.status(403).json({ message: 'Access denied' });
            }
            res.json(demandData);
        }
        catch (error) {
            res.status(500).json({ message: 'Failed to fetch demand' });
        }
    });
    // Create a new demand
    app.post('/api/demands', index_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const demandData = req.body;
            // Validate input using the corrected schema that already has optional fields
            const demandInputSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            // Validate input
            const validatedData = demandInputSchema.parse(demandData);
            console.log('✅ Demand validation passed:', validatedData);
            // Auto-populate residence and building from user's primary residence if not provided
            if (!validatedData.residenceId || !validatedData.buildingId) {
                const userResidenceData = await db_1.db
                    .select({
                    residenceId: schema_1.userResidences.residenceId,
                    buildingId: schema_1.residences.buildingId,
                })
                    .from(schema_1.userResidences)
                    .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                    .where((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, user.id))
                    .limit(1);
                if (userResidenceData.length === 0) {
                    return res
                        .status(400)
                        .json({ message: 'User must be assigned to a residence to create demands' });
                }
                validatedData.residenceId = validatedData.residenceId || userResidenceData[0].residenceId;
                validatedData.buildingId = validatedData.buildingId || userResidenceData[0].buildingId;
            }
            // Ensure required fields are present after auto-population
            if (!validatedData.buildingId || !validatedData.residenceId) {
                return res.status(400).json({
                    message: 'Building and residence are required to create a demand'
                });
            }
            console.log('✅ Final demand data before insertion:', {
                buildingId: validatedData.buildingId,
                residenceId: validatedData.residenceId,
                type: validatedData.type,
                description: validatedData.description
            });
            const demandInsertData = {
                ...validatedData,
                buildingId: validatedData.buildingId,
                residenceId: validatedData.residenceId,
                submitterId: user.id,
                status: validatedData.status || 'submitted',
            };
            const newDemand = await db_1.db.insert(schema_1.demands).values([demandInsertData]).returning();
            res.status(201).json(newDemand[0]);
        }
        catch (error) {
            if (error.name === 'ZodError') {
                return res.status(400).json({ message: 'Invalid demand data', errors: error.errors });
            }
            res.status(500).json({ message: 'Failed to create demand' });
        }
    });
    // Update a demand
    app.put('/api/demands/:id', index_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const user = req.user;
            const updates = req.body;
            // Get the current demand
            const currentDemand = await db_1.db.select().from(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.id, id)).limit(1);
            if (currentDemand.length === 0) {
                return res.status(404).json({ message: 'Demand not found' });
            }
            const demand = currentDemand[0];
            // Check permissions based on user role and update type
            let canUpdate = false;
            let allowedFields = [];
            if (user.role === 'admin') {
                // Admins can update any demand and any field
                canUpdate = true;
                allowedFields = ['status', 'reviewNotes', 'reviewedBy', 'reviewedAt', 'description', 'type'];
            }
            else if (user.role === 'manager') {
                // Managers can update demands from their organization's buildings (status/review fields only)
                const userOrganizationData = await db_1.db
                    .select({ organizationId: schema_1.userOrganizations.organizationId })
                    .from(schema_1.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, user.id));
                if (userOrganizationData.length > 0) {
                    const organizationId = userOrganizationData[0].organizationId;
                    // Check if the demand's building belongs to the manager's organization
                    const buildingOrganization = await db_1.db
                        .select({ organizationId: schema_1.buildings.organizationId })
                        .from(schema_1.buildings)
                        .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, demand.buildingId))
                        .limit(1);
                    if (buildingOrganization.length > 0 && buildingOrganization[0].organizationId === organizationId) {
                        canUpdate = true;
                        allowedFields = ['status', 'reviewNotes', 'reviewedBy', 'reviewedAt'];
                    }
                }
            }
            else if (demand.submitterId === user.id) {
                // Residents and tenants can only update their own demands (limited fields)
                canUpdate = true;
                allowedFields = ['description', 'type'];
            }
            if (!canUpdate) {
                return res.status(403).json({ message: 'Access denied' });
            }
            // Filter updates to only allowed fields
            const filteredUpdates = {};
            for (const [key, value] of Object.entries(updates)) {
                if (allowedFields.includes(key)) {
                    filteredUpdates[key] = value;
                }
            }
            // Add metadata for manager/admin updates
            if (user.role === 'admin' || user.role === 'manager') {
                if (updates.status && updates.status !== demand.status) {
                    filteredUpdates['reviewedBy'] = user.id;
                    filteredUpdates['reviewedAt'] = new Date();
                }
            }
            const updatedDemand = await db_1.db
                .update(schema_1.demands)
                .set({ ...filteredUpdates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema_1.demands.id, id))
                .returning();
            res.json(updatedDemand[0]);
        }
        catch (error) {
            res.status(500).json({ message: 'Failed to update demand' });
        }
    });
    // Delete a demand
    app.delete('/api/demands/:id', index_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const user = req.user;
            // Get the current demand
            const currentDemand = await db_1.db.select().from(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.id, id)).limit(1);
            if (currentDemand.length === 0) {
                return res.status(404).json({ message: 'Demand not found' });
            }
            const demand = currentDemand[0];
            // Check permissions - users can only delete their own demands
            if (demand.submitterId !== user.id) {
                return res.status(403).json({ message: 'Access denied' });
            }
            await db_1.db.delete(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.id, id));
            res.json({ message: 'Demand deleted successfully' });
        }
        catch (error) {
            res.status(500).json({ message: 'Failed to delete demand' });
        }
    });
    // Get comments for a demand
    app.get('/api/demands/:id/comments', index_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const user = req.user;
            // First check if user has access to the demand
            const demand = await db_1.db.select().from(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.id, id)).limit(1);
            if (demand.length === 0) {
                return res.status(404).json({ message: 'Demand not found' });
            }
            // Check access permissions (same logic as get demand)
            // ... (permission check logic similar to get demand endpoint)
            const comments = await db_1.db
                .select({
                id: schema_1.demandComments.id,
                demandId: schema_1.demandComments.demandId,
                commentText: schema_1.demandComments.commentText,
                commentType: schema_1.demandComments.commentType,
                isInternal: schema_1.demandComments.isInternal,
                commenterId: schema_1.demandComments.commenterId,
                createdAt: schema_1.demandComments.createdAt,
                author: {
                    id: schema_1.users.id,
                    firstName: schema_1.users.firstName,
                    lastName: schema_1.users.lastName,
                    email: schema_1.users.email,
                },
            })
                .from(schema_1.demandComments)
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.demandComments.commenterId, schema_1.users.id))
                .where((0, drizzle_orm_1.eq)(schema_1.demandComments.demandId, id))
                .orderBy((0, drizzle_orm_1.asc)(schema_1.demandComments.createdAt));
            res.json(comments);
        }
        catch (error) {
            res.status(500).json({ message: 'Failed to fetch demand comments' });
        }
    });
    // Create a comment on a demand
    app.post('/api/demands/:id/comments', index_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const user = req.user;
            const commentData = req.body;
            // Validate input
            const validatedData = operations_1.insertDemandCommentSchema.parse({
                ...commentData,
                demandId: id,
                commenterId: user.id,
            });
            // Check if user has access to the demand (similar logic as above)
            const demand = await db_1.db.select().from(schema_1.demands).where((0, drizzle_orm_1.eq)(schema_1.demands.id, id)).limit(1);
            if (demand.length === 0) {
                return res.status(404).json({ message: 'Demand not found' });
            }
            const newComment = await db_1.db.insert(schema_1.demandComments).values(validatedData).returning();
            res.status(201).json(newComment[0]);
        }
        catch (error) {
            if (error.name === 'ZodError') {
                return res.status(400).json({ message: 'Invalid comment data', errors: error.errors });
            }
            res.status(500).json({ message: 'Failed to create comment' });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7WUFFckYsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEMsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsSUFBSSxLQUFLLENBQUMsSUFBSSxLQUFLLFVBQVUsRUFBRSxDQUFDO2dCQUM5QixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUN6RixDQUFDO1lBQ0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQyxDQUFDO1FBQ2hFLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2RlbWFuZHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhwcmVzcyB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQge1xuICBkZW1hbmRzLFxuICBkZW1hbmRDb21tZW50cyxcbiAgcmVzaWRlbmNlcyxcbiAgYnVpbGRpbmdzLFxuICB1c2VycyxcbiAgdXNlclJlc2lkZW5jZXMsXG4gIHVzZXJPcmdhbml6YXRpb25zLFxuICBvcmdhbml6YXRpb25zLFxufSBmcm9tICcuLi8uLi9zaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQsIG9yLCBpbkFycmF5LCBkZXNjLCBhc2MgfSBmcm9tICdkcml6emxlLW9ybSc7XG5pbXBvcnQgeyByZXF1aXJlQXV0aCB9IGZyb20gJy4uL2F1dGgvaW5kZXgnO1xuaW1wb3J0IHsgaW5zZXJ0RGVtYW5kU2NoZW1hLCBpbnNlcnREZW1hbmRDb21tZW50U2NoZW1hIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYXMvb3BlcmF0aW9ucyc7XG5pbXBvcnQgeyB6IH0gZnJvbSAnem9kJztcblxuLyoqXG4gKiBSZWdpc3RlciBkZW1hbmQgcm91dGVzIGZvciBtYW5hZ2luZyByZXNpZGVudCBkZW1hbmRzIGFuZCBjb21wbGFpbnRzLlxuICpcbiAqIEBwYXJhbSBhcHAgLSBFeHByZXNzIGFwcGxpY2F0aW9uIGluc3RhbmNlLlxuICovXG4vKipcbiAqIFJlZ2lzdGVyRGVtYW5kUm91dGVzIGZ1bmN0aW9uLlxuICogQHBhcmFtIGFwcFxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJEZW1hbmRSb3V0ZXMoYXBwOiBFeHByZXNzKSB7XG4gIC8vIEdldCBkZW1hbmRzIGZvciBhIHVzZXIgKHJlc2lkZW50cyBhbmQgbWFuYWdlcnMpXG4gIGFwcC5nZXQoJy9hcGkvZGVtYW5kcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IHsgYnVpbGRpbmdJZCwgcmVzaWRlbmNlSWQsIHR5cGUsIHN0YXR1cywgc2VhcmNoIH0gPSByZXEucXVlcnk7XG5cbiAgICAgIC8vIEJhc2UgcXVlcnkgd2l0aCBqb2luc1xuICAgICAgbGV0IHF1ZXJ5ID0gZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGRlbWFuZHMuaWQsXG4gICAgICAgICAgc3VibWl0dGVySWQ6IGRlbWFuZHMuc3VibWl0dGVySWQsXG4gICAgICAgICAgdHlwZTogZGVtYW5kcy50eXBlLFxuICAgICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6IGRlbWFuZHMuYXNzaWduYXRpb25SZXNpZGVuY2VJZCxcbiAgICAgICAgICBhc3NpZ25hdGlvbkJ1aWxkaW5nSWQ6IGRlbWFuZHMuYXNzaWduYXRpb25CdWlsZGluZ0lkLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBkZW1hbmRzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGF0dGFjaG1lbnRzOiBkZW1hbmRzLmF0dGFjaG1lbnRzLFxuICAgICAgICAgIHJlc2lkZW5jZUlkOiBkZW1hbmRzLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGRlbWFuZHMuYnVpbGRpbmdJZCxcbiAgICAgICAgICBzdGF0dXM6IGRlbWFuZHMuc3RhdHVzLFxuICAgICAgICAgIHJldmlld2VkQnk6IGRlbWFuZHMucmV2aWV3ZWRCeSxcbiAgICAgICAgICByZXZpZXdlZEF0OiBkZW1hbmRzLnJldmlld2VkQXQsXG4gICAgICAgICAgcmV2aWV3Tm90ZXM6IGRlbWFuZHMucmV2aWV3Tm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEF0OiBkZW1hbmRzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGRlbWFuZHMudXBkYXRlZEF0LFxuICAgICAgICAgIHN1Ym1pdHRlcjoge1xuICAgICAgICAgICAgaWQ6IHVzZXJzLmlkLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiB1c2Vycy5maXJzdE5hbWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogdXNlcnMubGFzdE5hbWUsXG4gICAgICAgICAgICBlbWFpbDogdXNlcnMuZW1haWwsXG4gICAgICAgICAgfSxcbiAgICAgICAgICByZXNpZGVuY2U6IHtcbiAgICAgICAgICAgIGlkOiByZXNpZGVuY2VzLmlkLFxuICAgICAgICAgICAgdW5pdE51bWJlcjogcmVzaWRlbmNlcy51bml0TnVtYmVyLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogcmVzaWRlbmNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYnVpbGRpbmc6IHtcbiAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGRlbWFuZHMpXG4gICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKGRlbWFuZHMuc3VibWl0dGVySWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLmlubmVySm9pbihyZXNpZGVuY2VzLCBlcShkZW1hbmRzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGRlbWFuZHMuYnVpbGRpbmdJZCwgYnVpbGRpbmdzLmlkKSk7XG5cbiAgICAgIC8vIEFwcGx5IHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2xcbiAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcbiAgICAgIFxuICAgICAgaWYgKHVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbnMgY2FuIHNlZSBhbGwgZGVtYW5kcyAtIG5vIGFkZGl0aW9uYWwgY29uZGl0aW9ucyBuZWVkZWRcbiAgICAgIH0gZWxzZSBpZiAodXNlci5yb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgLy8gTWFuYWdlcnMgY2FuIHNlZSBkZW1hbmRzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uJ3MgYnVpbGRpbmdzXG4gICAgICAgIGNvbnN0IHVzZXJPcmdhbml6YXRpb25EYXRhID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20odXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCkpO1xuICAgICAgICAgIFxuICAgICAgICBpZiAodXNlck9yZ2FuaXphdGlvbkRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gdXNlck9yZ2FuaXphdGlvbkRhdGFbMF0ub3JnYW5pemF0aW9uSWQ7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gR2V0IGJ1aWxkaW5ncyBiZWxvbmdpbmcgdG8gdGhlIG1hbmFnZXIncyBvcmdhbml6YXRpb25cbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25CdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IGJ1aWxkaW5nSWQ6IGJ1aWxkaW5ncy5pZCB9KVxuICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgIGlmIChvcmdhbml6YXRpb25CdWlsZGluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBvcmdhbml6YXRpb25CdWlsZGluZ3MubWFwKGIgPT4gYi5idWlsZGluZ0lkKTtcbiAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChpbkFycmF5KGRlbWFuZHMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZHMpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gTWFuYWdlciBoYXMgbm8gYnVpbGRpbmdzIC0gcmV0dXJuIGVtcHR5IHJlc3VsdHNcbiAgICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShkZW1hbmRzLmlkLCAnbmV2ZXItbWF0Y2gnKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE1hbmFnZXIgbm90IGFzc2lnbmVkIHRvIGFueSBvcmdhbml6YXRpb24gLSByZXR1cm4gZW1wdHkgcmVzdWx0c1xuICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShkZW1hbmRzLmlkLCAnbmV2ZXItbWF0Y2gnKSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlc2lkZW50cyBhbmQgdGVuYW50cyBjYW4gb25seSBzZWUgZGVtYW5kcyB0aGV5IGNyZWF0ZWRcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGRlbWFuZHMuc3VibWl0dGVySWQsIHVzZXIuaWQpKTtcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGZpbHRlciBjb25kaXRpb25zXG4gICAgICBpZiAoYnVpbGRpbmdJZCkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoZGVtYW5kcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSk7XG4gICAgICB9XG4gICAgICBpZiAocmVzaWRlbmNlSWQpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGRlbWFuZHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkKSk7XG4gICAgICB9XG4gICAgICBpZiAodHlwZSkge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoZGVtYW5kcy50eXBlLCB0eXBlKSk7XG4gICAgICB9XG4gICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShkZW1hbmRzLnN0YXR1cywgc3RhdHVzKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEFwcGx5IGNvbmRpdGlvbnMgdG8gcXVlcnkgaWYgYW55IGV4aXN0XG4gICAgICBsZXQgZmluYWxRdWVyeTtcbiAgICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgZmluYWxRdWVyeSA9IHF1ZXJ5LndoZXJlKGFuZCguLi5jb25kaXRpb25zKSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmaW5hbFF1ZXJ5ID0gcXVlcnk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBmaW5hbFF1ZXJ5Lm9yZGVyQnkoZGVzYyhkZW1hbmRzLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAvLyBGaWx0ZXIgYnkgc2VhcmNoIHRlcm0gaWYgcHJvdmlkZWRcbiAgICAgIGxldCBmaWx0ZXJlZFJlc3VsdHMgPSByZXN1bHRzO1xuICAgICAgaWYgKHNlYXJjaCkge1xuICAgICAgICBjb25zdCBzZWFyY2hUZXJtID0gc2VhcmNoLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGZpbHRlcmVkUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKFxuICAgICAgICAgIChkZW1hbmQpID0+XG4gICAgICAgICAgICBkZW1hbmQuZGVzY3JpcHRpb24udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtKSB8fFxuICAgICAgICAgICAgZGVtYW5kLnN1Ym1pdHRlci5maXJzdE5hbWU/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSkgfHxcbiAgICAgICAgICAgIGRlbWFuZC5zdWJtaXR0ZXIubGFzdE5hbWU/LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybSkgfHxcbiAgICAgICAgICAgIGRlbWFuZC5yZXNpZGVuY2UudW5pdE51bWJlci50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0pIHx8XG4gICAgICAgICAgICBkZW1hbmQuYnVpbGRpbmcubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaFRlcm0pXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKGZpbHRlcmVkUmVzdWx0cyk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGRlbWFuZHMnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gR2V0IGEgc3BlY2lmaWMgZGVtYW5kXG4gIGFwcC5nZXQoJy9hcGkvZGVtYW5kcy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuXG4gICAgICBjb25zdCBkZW1hbmQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogZGVtYW5kcy5pZCxcbiAgICAgICAgICBzdWJtaXR0ZXJJZDogZGVtYW5kcy5zdWJtaXR0ZXJJZCxcbiAgICAgICAgICB0eXBlOiBkZW1hbmRzLnR5cGUsXG4gICAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogZGVtYW5kcy5hc3NpZ25hdGlvblJlc2lkZW5jZUlkLFxuICAgICAgICAgIGFzc2lnbmF0aW9uQnVpbGRpbmdJZDogZGVtYW5kcy5hc3NpZ25hdGlvbkJ1aWxkaW5nSWQsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGRlbWFuZHMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgYXR0YWNobWVudHM6IGRlbWFuZHMuYXR0YWNobWVudHMsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IGRlbWFuZHMucmVzaWRlbmNlSWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogZGVtYW5kcy5idWlsZGluZ0lkLFxuICAgICAgICAgIHN0YXR1czogZGVtYW5kcy5zdGF0dXMsXG4gICAgICAgICAgcmV2aWV3ZWRCeTogZGVtYW5kcy5yZXZpZXdlZEJ5LFxuICAgICAgICAgIHJldmlld2VkQXQ6IGRlbWFuZHMucmV2aWV3ZWRBdCxcbiAgICAgICAgICByZXZpZXdOb3RlczogZGVtYW5kcy5yZXZpZXdOb3RlcyxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGRlbWFuZHMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogZGVtYW5kcy51cGRhdGVkQXQsXG4gICAgICAgICAgc3VibWl0dGVyOiB7XG4gICAgICAgICAgICBpZDogdXNlcnMuaWQsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHVzZXJzLmZpcnN0TmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB1c2Vycy5sYXN0TmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHJlc2lkZW5jZToge1xuICAgICAgICAgICAgaWQ6IHJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICBidWlsZGluZ0lkOiByZXNpZGVuY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBidWlsZGluZzoge1xuICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgYWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oZGVtYW5kcylcbiAgICAgICAgLmlubmVySm9pbih1c2VycywgZXEoZGVtYW5kcy5zdWJtaXR0ZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAuaW5uZXJKb2luKHJlc2lkZW5jZXMsIGVxKGRlbWFuZHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAuaW5uZXJKb2luKGJ1aWxkaW5ncywgZXEoZGVtYW5kcy5idWlsZGluZ0lkLCBidWlsZGluZ3MuaWQpKVxuICAgICAgICAud2hlcmUoZXEoZGVtYW5kcy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChkZW1hbmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEZW1hbmQgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGVtYW5kRGF0YSA9IGRlbWFuZFswXTtcblxuICAgICAgLy8gQ2hlY2sgYWNjZXNzIHBlcm1pc3Npb25zIGJhc2VkIG9uIHVzZXIgcm9sZVxuICAgICAgbGV0IGhhc0FjY2VzcyA9IGZhbHNlO1xuICAgICAgXG4gICAgICBpZiAodXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWlucyBjYW4gdmlldyBhbGwgZGVtYW5kc1xuICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgfSBlbHNlIGlmICh1c2VyLnJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAvLyBNYW5hZ2VycyBjYW4gdmlldyBkZW1hbmRzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uJ3MgYnVpbGRpbmdzXG4gICAgICAgIGNvbnN0IHVzZXJPcmdhbml6YXRpb25EYXRhID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20odXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCkpO1xuICAgICAgICAgIFxuICAgICAgICBpZiAodXNlck9yZ2FuaXphdGlvbkRhdGEubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gdXNlck9yZ2FuaXphdGlvbkRhdGFbMF0ub3JnYW5pemF0aW9uSWQ7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGRlbWFuZCdzIGJ1aWxkaW5nIGJlbG9uZ3MgdG8gdGhlIG1hbmFnZXIncyBvcmdhbml6YXRpb25cbiAgICAgICAgICBjb25zdCBidWlsZGluZ09yZ2FuaXphdGlvbiA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgZGVtYW5kRGF0YS5idWlsZGluZ0lkKSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgIGlmIChidWlsZGluZ09yZ2FuaXphdGlvbi5sZW5ndGggPiAwICYmIGJ1aWxkaW5nT3JnYW5pemF0aW9uWzBdLm9yZ2FuaXphdGlvbklkID09PSBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIFJlc2lkZW50cyBhbmQgdGVuYW50cyBjYW4gb25seSB2aWV3IHRoZWlyIG93biBkZW1hbmRzXG4gICAgICAgIGhhc0FjY2VzcyA9IGRlbWFuZERhdGEuc3VibWl0dGVySWQgPT09IHVzZXIuaWQ7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oZGVtYW5kRGF0YSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGRlbWFuZCcgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBDcmVhdGUgYSBuZXcgZGVtYW5kXG4gIGFwcC5wb3N0KCcvYXBpL2RlbWFuZHMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICBjb25zdCBkZW1hbmREYXRhID0gcmVxLmJvZHk7XG4gICAgICBcblxuICAgICAgLy8gVmFsaWRhdGUgaW5wdXQgdXNpbmcgdGhlIGNvcnJlY3RlZCBzY2hlbWEgdGhhdCBhbHJlYWR5IGhhcyBvcHRpb25hbCBmaWVsZHNcbiAgICAgIGNvbnN0IGRlbWFuZElucHV0U2NoZW1hID0gaW5zZXJ0RGVtYW5kU2NoZW1hLm9taXQoeyBzdWJtaXR0ZXJJZDogdHJ1ZSB9KTtcbiAgICAgIFxuICAgICAgLy8gVmFsaWRhdGUgaW5wdXRcbiAgICAgIGNvbnN0IHZhbGlkYXRlZERhdGEgPSBkZW1hbmRJbnB1dFNjaGVtYS5wYXJzZShkZW1hbmREYXRhKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KchSBEZW1hbmQgdmFsaWRhdGlvbiBwYXNzZWQ6JywgdmFsaWRhdGVkRGF0YSk7XG5cbiAgICAgIC8vIEF1dG8tcG9wdWxhdGUgcmVzaWRlbmNlIGFuZCBidWlsZGluZyBmcm9tIHVzZXIncyBwcmltYXJ5IHJlc2lkZW5jZSBpZiBub3QgcHJvdmlkZWRcbiAgICAgIGlmICghdmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZCB8fCAhdmFsaWRhdGVkRGF0YS5idWlsZGluZ0lkKSB7XG4gICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VEYXRhID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHJlc2lkZW5jZUlkOiB1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC5pbm5lckpvaW4ocmVzaWRlbmNlcywgZXEodXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgIC53aGVyZShlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpKVxuICAgICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgICBpZiAodXNlclJlc2lkZW5jZURhdGEubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc1xuICAgICAgICAgICAgLnN0YXR1cyg0MDApXG4gICAgICAgICAgICAuanNvbih7IG1lc3NhZ2U6ICdVc2VyIG11c3QgYmUgYXNzaWduZWQgdG8gYSByZXNpZGVuY2UgdG8gY3JlYXRlIGRlbWFuZHMnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZCA9IHZhbGlkYXRlZERhdGEucmVzaWRlbmNlSWQgfHwgdXNlclJlc2lkZW5jZURhdGFbMF0ucmVzaWRlbmNlSWQ7XG4gICAgICAgIHZhbGlkYXRlZERhdGEuYnVpbGRpbmdJZCA9IHZhbGlkYXRlZERhdGEuYnVpbGRpbmdJZCB8fCB1c2VyUmVzaWRlbmNlRGF0YVswXS5idWlsZGluZ0lkO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgcmVxdWlyZWQgZmllbGRzIGFyZSBwcmVzZW50IGFmdGVyIGF1dG8tcG9wdWxhdGlvblxuICAgICAgaWYgKCF2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWQgfHwgIXZhbGlkYXRlZERhdGEucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIGFuZCByZXNpZGVuY2UgYXJlIHJlcXVpcmVkIHRvIGNyZWF0ZSBhIGRlbWFuZCcgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEZpbmFsIGRlbWFuZCBkYXRhIGJlZm9yZSBpbnNlcnRpb246Jywge1xuICAgICAgICBidWlsZGluZ0lkOiB2YWxpZGF0ZWREYXRhLmJ1aWxkaW5nSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkOiB2YWxpZGF0ZWREYXRhLnJlc2lkZW5jZUlkLFxuICAgICAgICB0eXBlOiB2YWxpZGF0ZWREYXRhLnR5cGUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiB2YWxpZGF0ZWREYXRhLmRlc2NyaXB0aW9uXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZGVtYW5kSW5zZXJ0RGF0YSA9IHtcbiAgICAgICAgLi4udmFsaWRhdGVkRGF0YSxcbiAgICAgICAgYnVpbGRpbmdJZDogdmFsaWRhdGVkRGF0YS5idWlsZGluZ0lkLFxuICAgICAgICByZXNpZGVuY2VJZDogdmFsaWRhdGVkRGF0YS5yZXNpZGVuY2VJZCxcbiAgICAgICAgc3VibWl0dGVySWQ6IHVzZXIuaWQsXG4gICAgICAgIHN0YXR1czogKHZhbGlkYXRlZERhdGEuc3RhdHVzIGFzICdzdWJtaXR0ZWQnIHwgJ3VuZGVyX3JldmlldycgfCAnYXBwcm92ZWQnIHwgJ3JlamVjdGVkJyB8ICdpbl9wcm9ncmVzcycgfCAnY29tcGxldGVkJyB8ICdjYW5jZWxsZWQnKSB8fCAnc3VibWl0dGVkJyxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG5ld0RlbWFuZCA9IGF3YWl0IGRiLmluc2VydChkZW1hbmRzKS52YWx1ZXMoW2RlbWFuZEluc2VydERhdGFdKS5yZXR1cm5pbmcoKTtcblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24obmV3RGVtYW5kWzBdKTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBpZiAoZXJyb3IubmFtZSA9PT0gJ1pvZEVycm9yJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAnSW52YWxpZCBkZW1hbmQgZGF0YScsIGVycm9yczogZXJyb3IuZXJyb3JzIH0pO1xuICAgICAgfVxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBkZW1hbmQnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gVXBkYXRlIGEgZGVtYW5kXG4gIGFwcC5wdXQoJy9hcGkvZGVtYW5kcy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgdXBkYXRlcyA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgZGVtYW5kXG4gICAgICBjb25zdCBjdXJyZW50RGVtYW5kID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShkZW1hbmRzKS53aGVyZShlcShkZW1hbmRzLmlkLCBpZCkpLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoY3VycmVudERlbWFuZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0RlbWFuZCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkZW1hbmQgPSBjdXJyZW50RGVtYW5kWzBdO1xuXG4gICAgICAvLyBDaGVjayBwZXJtaXNzaW9ucyBiYXNlZCBvbiB1c2VyIHJvbGUgYW5kIHVwZGF0ZSB0eXBlXG4gICAgICBsZXQgY2FuVXBkYXRlID0gZmFsc2U7XG4gICAgICBsZXQgYWxsb3dlZEZpZWxkcyA9IFtdO1xuICAgICAgXG4gICAgICBpZiAodXNlci5yb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgIC8vIEFkbWlucyBjYW4gdXBkYXRlIGFueSBkZW1hbmQgYW5kIGFueSBmaWVsZFxuICAgICAgICBjYW5VcGRhdGUgPSB0cnVlO1xuICAgICAgICBhbGxvd2VkRmllbGRzID0gWydzdGF0dXMnLCAncmV2aWV3Tm90ZXMnLCAncmV2aWV3ZWRCeScsICdyZXZpZXdlZEF0JywgJ2Rlc2NyaXB0aW9uJywgJ3R5cGUnXTtcbiAgICAgIH0gZWxzZSBpZiAodXNlci5yb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgLy8gTWFuYWdlcnMgY2FuIHVwZGF0ZSBkZW1hbmRzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uJ3MgYnVpbGRpbmdzIChzdGF0dXMvcmV2aWV3IGZpZWxkcyBvbmx5KVxuICAgICAgICBjb25zdCB1c2VyT3JnYW5pemF0aW9uRGF0YSA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IG9yZ2FuaXphdGlvbklkOiB1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgICAgIC5mcm9tKHVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpKTtcbiAgICAgICAgICBcbiAgICAgICAgaWYgKHVzZXJPcmdhbml6YXRpb25EYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCBvcmdhbml6YXRpb25JZCA9IHVzZXJPcmdhbml6YXRpb25EYXRhWzBdLm9yZ2FuaXphdGlvbklkO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIENoZWNrIGlmIHRoZSBkZW1hbmQncyBidWlsZGluZyBiZWxvbmdzIHRvIHRoZSBtYW5hZ2VyJ3Mgb3JnYW5pemF0aW9uXG4gICAgICAgICAgY29uc3QgYnVpbGRpbmdPcmdhbml6YXRpb24gPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7IG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQgfSlcbiAgICAgICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGRlbWFuZC5idWlsZGluZ0lkKSlcbiAgICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgIGlmIChidWlsZGluZ09yZ2FuaXphdGlvbi5sZW5ndGggPiAwICYmIGJ1aWxkaW5nT3JnYW5pemF0aW9uWzBdLm9yZ2FuaXphdGlvbklkID09PSBvcmdhbml6YXRpb25JZCkge1xuICAgICAgICAgICAgY2FuVXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgIGFsbG93ZWRGaWVsZHMgPSBbJ3N0YXR1cycsICdyZXZpZXdOb3RlcycsICdyZXZpZXdlZEJ5JywgJ3Jldmlld2VkQXQnXTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoZGVtYW5kLnN1Ym1pdHRlcklkID09PSB1c2VyLmlkKSB7XG4gICAgICAgIC8vIFJlc2lkZW50cyBhbmQgdGVuYW50cyBjYW4gb25seSB1cGRhdGUgdGhlaXIgb3duIGRlbWFuZHMgKGxpbWl0ZWQgZmllbGRzKVxuICAgICAgICBjYW5VcGRhdGUgPSB0cnVlO1xuICAgICAgICBhbGxvd2VkRmllbGRzID0gWydkZXNjcmlwdGlvbicsICd0eXBlJ107XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICghY2FuVXBkYXRlKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkJyB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRmlsdGVyIHVwZGF0ZXMgdG8gb25seSBhbGxvd2VkIGZpZWxkc1xuICAgICAgY29uc3QgZmlsdGVyZWRVcGRhdGVzID0ge307XG4gICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyh1cGRhdGVzKSkge1xuICAgICAgICBpZiAoYWxsb3dlZEZpZWxkcy5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgICAgZmlsdGVyZWRVcGRhdGVzW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBBZGQgbWV0YWRhdGEgZm9yIG1hbmFnZXIvYWRtaW4gdXBkYXRlc1xuICAgICAgaWYgKHVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyLnJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICBpZiAodXBkYXRlcy5zdGF0dXMgJiYgdXBkYXRlcy5zdGF0dXMgIT09IGRlbWFuZC5zdGF0dXMpIHtcbiAgICAgICAgICBmaWx0ZXJlZFVwZGF0ZXNbJ3Jldmlld2VkQnknXSA9IHVzZXIuaWQ7XG4gICAgICAgICAgZmlsdGVyZWRVcGRhdGVzWydyZXZpZXdlZEF0J10gPSBuZXcgRGF0ZSgpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHVwZGF0ZWREZW1hbmQgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKGRlbWFuZHMpXG4gICAgICAgIC5zZXQoeyAuLi5maWx0ZXJlZFVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoZGVtYW5kcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWREZW1hbmRbMF0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgZGVtYW5kJyB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIERlbGV0ZSBhIGRlbWFuZFxuICBhcHAuZGVsZXRlKCcvYXBpL2RlbWFuZHMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcblxuICAgICAgLy8gR2V0IHRoZSBjdXJyZW50IGRlbWFuZFxuICAgICAgY29uc3QgY3VycmVudERlbWFuZCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oZGVtYW5kcykud2hlcmUoZXEoZGVtYW5kcy5pZCwgaWQpKS5saW1pdCgxKTtcblxuICAgICAgaWYgKGN1cnJlbnREZW1hbmQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdEZW1hbmQgbm90IGZvdW5kJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZGVtYW5kID0gY3VycmVudERlbWFuZFswXTtcblxuICAgICAgLy8gQ2hlY2sgcGVybWlzc2lvbnMgLSB1c2VycyBjYW4gb25seSBkZWxldGUgdGhlaXIgb3duIGRlbWFuZHNcbiAgICAgIGlmIChkZW1hbmQuc3VibWl0dGVySWQgIT09IHVzZXIuaWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICBhd2FpdCBkYi5kZWxldGUoZGVtYW5kcykud2hlcmUoZXEoZGVtYW5kcy5pZCwgaWQpKTtcblxuICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnRGVtYW5kIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5JyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIGRlbWFuZCcgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBHZXQgY29tbWVudHMgZm9yIGEgZGVtYW5kXG4gIGFwcC5nZXQoJy9hcGkvZGVtYW5kcy86aWQvY29tbWVudHMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuXG4gICAgICAvLyBGaXJzdCBjaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhlIGRlbWFuZFxuICAgICAgY29uc3QgZGVtYW5kID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShkZW1hbmRzKS53aGVyZShlcShkZW1hbmRzLmlkLCBpZCkpLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoZGVtYW5kLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnRGVtYW5kIG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGFjY2VzcyBwZXJtaXNzaW9ucyAoc2FtZSBsb2dpYyBhcyBnZXQgZGVtYW5kKVxuICAgICAgLy8gLi4uIChwZXJtaXNzaW9uIGNoZWNrIGxvZ2ljIHNpbWlsYXIgdG8gZ2V0IGRlbWFuZCBlbmRwb2ludClcblxuICAgICAgY29uc3QgY29tbWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogZGVtYW5kQ29tbWVudHMuaWQsXG4gICAgICAgICAgZGVtYW5kSWQ6IGRlbWFuZENvbW1lbnRzLmRlbWFuZElkLFxuICAgICAgICAgIGNvbW1lbnRUZXh0OiBkZW1hbmRDb21tZW50cy5jb21tZW50VGV4dCxcbiAgICAgICAgICBjb21tZW50VHlwZTogZGVtYW5kQ29tbWVudHMuY29tbWVudFR5cGUsXG4gICAgICAgICAgaXNJbnRlcm5hbDogZGVtYW5kQ29tbWVudHMuaXNJbnRlcm5hbCxcbiAgICAgICAgICBjb21tZW50ZXJJZDogZGVtYW5kQ29tbWVudHMuY29tbWVudGVySWQsXG4gICAgICAgICAgY3JlYXRlZEF0OiBkZW1hbmRDb21tZW50cy5jcmVhdGVkQXQsXG4gICAgICAgICAgYXV0aG9yOiB7XG4gICAgICAgICAgICBpZDogdXNlcnMuaWQsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHVzZXJzLmZpcnN0TmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiB1c2Vycy5sYXN0TmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiB1c2Vycy5lbWFpbCxcbiAgICAgICAgICB9LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShkZW1hbmRDb21tZW50cylcbiAgICAgICAgLmlubmVySm9pbih1c2VycywgZXEoZGVtYW5kQ29tbWVudHMuY29tbWVudGVySWQsIHVzZXJzLmlkKSlcbiAgICAgICAgLndoZXJlKGVxKGRlbWFuZENvbW1lbnRzLmRlbWFuZElkLCBpZCkpXG4gICAgICAgIC5vcmRlckJ5KGFzYyhkZW1hbmRDb21tZW50cy5jcmVhdGVkQXQpKTtcblxuICAgICAgcmVzLmpzb24oY29tbWVudHMpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBkZW1hbmQgY29tbWVudHMnIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIGEgY29tbWVudCBvbiBhIGRlbWFuZFxuICBhcHAucG9zdCgnL2FwaS9kZW1hbmRzLzppZC9jb21tZW50cycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICBjb25zdCBjb21tZW50RGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBWYWxpZGF0ZSBpbnB1dFxuICAgICAgY29uc3QgdmFsaWRhdGVkRGF0YSA9IGluc2VydERlbWFuZENvbW1lbnRTY2hlbWEucGFyc2Uoe1xuICAgICAgICAuLi5jb21tZW50RGF0YSxcbiAgICAgICAgZGVtYW5kSWQ6IGlkLFxuICAgICAgICBjb21tZW50ZXJJZDogdXNlci5pZCxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhY2Nlc3MgdG8gdGhlIGRlbWFuZCAoc2ltaWxhciBsb2dpYyBhcyBhYm92ZSlcbiAgICAgIGNvbnN0IGRlbWFuZCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oZGVtYW5kcykud2hlcmUoZXEoZGVtYW5kcy5pZCwgaWQpKS5saW1pdCgxKTtcblxuICAgICAgaWYgKGRlbWFuZC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ0RlbWFuZCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBuZXdDb21tZW50ID0gYXdhaXQgZGIuaW5zZXJ0KGRlbWFuZENvbW1lbnRzKS52YWx1ZXModmFsaWRhdGVkRGF0YSkucmV0dXJuaW5nKCk7XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKG5ld0NvbW1lbnRbMF0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGlmIChlcnJvci5uYW1lID09PSAnWm9kRXJyb3InKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdJbnZhbGlkIGNvbW1lbnQgZGF0YScsIGVycm9yczogZXJyb3IuZXJyb3JzIH0pO1xuICAgICAgfVxuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBjb21tZW50JyB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sInZlcnNpb24iOjN9