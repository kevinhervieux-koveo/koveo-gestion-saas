f8641738b5cc36915b311b4759cb9f64
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importDefault(require("react"));
const react_query_1 = require("@tanstack/react-query");
const wouter_1 = require("wouter");
const header_1 = require("@/components/layout/header");
const card_1 = require("@/components/ui/card");
const button_1 = require("@/components/ui/button");
const badge_1 = require("@/components/ui/badge");
const label_1 = require("@/components/ui/label");
const lucide_react_1 = require("lucide-react");
const use_language_1 = require("@/hooks/use-language");
const withHierarchicalSelection_1 = require("@/components/hoc/withHierarchicalSelection");
function MyBuilding({ buildingId, showBackButton, backButtonLabel, onBack }) {
    const [, navigate] = (0, wouter_1.useLocation)();
    const { t } = (0, use_language_1.useLanguage)();
    // Fetch user's accessible buildings and find the specific one
    const { data: userBuildings, isLoading: isLoadingBuilding, } = (0, react_query_1.useQuery)({
        queryKey: ['/api/users/me/buildings'],
        queryFn: async () => {
            const response = await fetch('/api/users/me/buildings');
            if (!response.ok) {
                throw new Error('Failed to fetch buildings');
            }
            return response.json();
        },
        enabled: !!buildingId,
    });
    // Find the specific building from user's accessible buildings
    const buildingData = react_1.default.useMemo(() => {
        if (!userBuildings || !buildingId)
            return null;
        const building = userBuildings.find((building) => building.id === buildingId);
        if (!building)
            return null;
        // Map API response to our interface
        return {
            ...building,
            province: building.state || building.province,
            postalCode: building.postal_code || building.postalCode,
        };
    }, [userBuildings, buildingId]);
    const handleViewDocuments = (targetBuildingId) => {
        navigate(`/residents/building/documents?buildingId=${targetBuildingId}`);
    };
    if (isLoadingBuilding) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: 'My Building', subtitle: 'View building information and documents' }), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsx)("div", { className: 'max-w-4xl mx-auto', children: (0, jsx_runtime_1.jsxs)("div", { className: 'text-center py-8', children: [(0, jsx_runtime_1.jsx)("div", { className: 'animate-spin w-6 h-6 border-2 border-primary border-t-transparent rounded-full mx-auto' }), (0, jsx_runtime_1.jsx)("p", { className: 'text-muted-foreground mt-2', children: "Loading building information..." })] }) }) })] }));
    }
    if (!buildingData) {
        return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: 'My Building', subtitle: 'View building information and documents' }), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsx)("div", { className: 'max-w-4xl mx-auto', children: (0, jsx_runtime_1.jsx)(card_1.Card, { children: (0, jsx_runtime_1.jsxs)(card_1.CardContent, { className: 'p-8 text-center', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Building, { className: 'w-16 h-16 mx-auto text-gray-400 mb-4' }), (0, jsx_runtime_1.jsx)("h3", { className: 'text-lg font-semibold text-gray-600 mb-2', children: "Building Not Found" }), (0, jsx_runtime_1.jsx)("p", { className: 'text-gray-500', children: "Unable to load building information." })] }) }) }) })] }));
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)(header_1.Header, { title: 'My Building', subtitle: 'View building information and documents' }), showBackButton && onBack && ((0, jsx_runtime_1.jsx)("div", { className: 'border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60', children: (0, jsx_runtime_1.jsx)("div", { className: 'flex items-center px-6 py-4', children: (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'outline', size: 'sm', onClick: onBack, className: 'flex items-center gap-2', "data-testid": 'button-back-to-building', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: 'w-4 h-4' }), backButtonLabel] }) }) })), (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 overflow-auto p-6', children: (0, jsx_runtime_1.jsx)("div", { className: 'max-w-4xl mx-auto space-y-6', children: (0, jsx_runtime_1.jsxs)(card_1.Card, { className: 'hover:shadow-lg transition-shadow', children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsxs)(card_1.CardTitle, { className: 'flex items-center gap-2', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Building, { className: 'w-5 h-5' }), buildingData.name] }) }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { className: 'space-y-6', children: [(0, jsx_runtime_1.jsx)("div", { className: 'space-y-3', children: (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('address') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-start gap-2 mt-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.MapPin, { className: 'w-4 h-4 mt-0.5 text-muted-foreground' }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700', children: buildingData.address }), (0, jsx_runtime_1.jsxs)("p", { className: 'text-sm text-gray-700', children: [buildingData.city, ", ", buildingData.province || buildingData.state, " ", buildingData.postalCode || buildingData.postal_code] })] })] })] }) }), (0, jsx_runtime_1.jsxs)("div", { className: 'grid grid-cols-1 md:grid-cols-2 gap-6', children: [(0, jsx_runtime_1.jsxs)("div", { className: 'space-y-3', children: [buildingData.buildingType && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('buildingType') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700 capitalize', children: buildingData.buildingType })] })), buildingData.yearBuilt && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('yearBuilt') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-2 mt-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Calendar, { className: 'w-4 h-4 text-muted-foreground' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: buildingData.yearBuilt })] })] })), buildingData.managementCompany && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('managementCompany') }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-700', children: buildingData.managementCompany })] }))] }), (0, jsx_runtime_1.jsxs)("div", { className: 'space-y-3', children: [buildingData.totalFloors && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('totalFloors') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-2 mt-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Building, { className: 'w-4 h-4 text-muted-foreground' }), (0, jsx_runtime_1.jsx)("span", { className: 'text-sm text-gray-700', children: buildingData.totalFloors })] })] })), (buildingData.parkingSpaces || buildingData.storageSpaces) && ((0, jsx_runtime_1.jsxs)("div", { className: 'space-y-2', children: [buildingData.parkingSpaces && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('parking') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-2 mt-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Car, { className: 'w-4 h-4 text-muted-foreground' }), (0, jsx_runtime_1.jsxs)("span", { className: 'text-sm text-gray-700', children: [buildingData.parkingSpaces, " ", t('spaces')] })] })] })), buildingData.storageSpaces && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('storage') }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center gap-2 mt-1', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Package, { className: 'w-4 h-4 text-muted-foreground' }), (0, jsx_runtime_1.jsxs)("span", { className: 'text-sm text-gray-700', children: [buildingData.storageSpaces, " ", t('units')] })] })] }))] }))] })] }), buildingData.amenities && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)(label_1.Label, { className: 'text-xs font-medium text-gray-500', children: t('amenities') }), (0, jsx_runtime_1.jsx)("div", { className: 'flex flex-wrap gap-2 mt-1', children: (() => {
                                                    try {
                                                        const amenities = typeof buildingData.amenities === 'string'
                                                            ? JSON.parse(buildingData.amenities)
                                                            : buildingData.amenities;
                                                        return Array.isArray(amenities)
                                                            ? amenities.map((amenity, index) => ((0, jsx_runtime_1.jsx)(badge_1.Badge, { variant: 'outline', className: 'text-xs', children: amenity }, index)))
                                                            : null;
                                                    }
                                                    catch (_e) {
                                                        return ((0, jsx_runtime_1.jsx)("span", { className: 'text-xs text-muted-foreground', children: t('unableToDisplayAmenities') }));
                                                    }
                                                })() })] })), (0, jsx_runtime_1.jsx)("div", { className: 'pt-4 border-t', children: (0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: () => handleViewDocuments(buildingData.id), className: 'w-full justify-start', "data-testid": 'button-view-documents', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.FileText, { className: 'w-4 h-4 mr-2' }), t('viewDocumentsButton')] }) })] })] }) }) })] }));
}
// Export the component wrapped with hierarchical selection
exports.default = (0, withHierarchicalSelection_1.withHierarchicalSelection)(MyBuilding, {
    hierarchy: ['organization', 'building'],
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL3BhZ2VzL3Jlc2lkZW50cy9idWlsZGluZy50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsa0RBQTBCO0FBQzFCLHVEQUFpRDtBQUNqRCxtQ0FBcUM7QUFDckMsdURBQW9EO0FBQ3BELCtDQUFnRjtBQUNoRixtREFBZ0Q7QUFDaEQsaURBQThDO0FBQzlDLGlEQUE4QztBQUM5QywrQ0FTc0I7QUFDdEIsdURBQW1EO0FBQ25ELDBGQUF1RjtBQTRCdkYsU0FBUyxVQUFVLENBQUMsRUFBRSxVQUFVLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQW1CO0lBQzFGLE1BQU0sQ0FBQyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUEsb0JBQVcsR0FBRSxDQUFDO0lBQ25DLE1BQU0sRUFBRSxDQUFDLEVBQUUsR0FBRyxJQUFBLDBCQUFXLEdBQUUsQ0FBQztJQUU1Qiw4REFBOEQ7SUFDOUQsTUFBTSxFQUNKLElBQUksRUFBRSxhQUFhLEVBQ25CLFNBQVMsRUFBRSxpQkFBaUIsR0FDN0IsR0FBRyxJQUFBLHNCQUFRLEVBQUM7UUFDWCxRQUFRLEVBQUUsQ0FBQyx5QkFBeUIsQ0FBQztRQUNyQyxPQUFPLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDbEIsTUFBTSxRQUFRLEdBQUcsTUFBTSxLQUFLLENBQUMseUJBQXlCLENBQUMsQ0FBQztZQUN4RCxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUNqQixNQUFNLElBQUksS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7WUFDL0MsQ0FBQztZQUNELE9BQU8sUUFBUSxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ3pCLENBQUM7UUFDRCxPQUFPLEVBQUUsQ0FBQyxDQUFDLFVBQVU7S0FDdEIsQ0FBQyxDQUFDO0lBRUgsOERBQThEO0lBQzlELE1BQU0sWUFBWSxHQUF3QixlQUFLLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRTtRQUMzRCxJQUFJLENBQUMsYUFBYSxJQUFJLENB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QUNGLENBQ1AsRUFHRCxnQ0FBSyxTQUFTLEVBQUMsZUFBZSxZQUM1Qix3QkFBQyxlQUFNLElBQ0wsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUMsRUFDbkQsU0FBUyxFQUFDLHNCQUFzQixpQkFDcEIsdUJBQXVCLGFBRW5DLHVCQUFDLHVCQUFRLElBQUMsU0FBUyxFQUFDLGNBQWMsR0FBRyxFQUNwQyxDQUFDLENBQUMscUJBQXFCLENBQUMsSUFDbEIsR0FDTCxJQUNNLElBQ1QsR0FDSCxHQUNGLElBQ0YsQ0FDUCxDQUFDO0FBQ0osQ0FBQztBQUVELDJEQUEyRDtBQUMzRCxrQkFBZSxJQUFBLHFEQUF5QixFQUFDLFVBQVUsRUFBRTtJQUNuRCxTQUFTLEVBQUUsQ0FBQyxjQUFjLEVBQUUsVUFBVSxDQUFDO0NBQ3hDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvcGFnZXMvcmVzaWRlbnRzL2J1aWxkaW5nLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlUXVlcnkgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtcXVlcnknO1xuaW1wb3J0IHsgdXNlTG9jYXRpb24gfSBmcm9tICd3b3V0ZXInO1xuaW1wb3J0IHsgSGVhZGVyIH0gZnJvbSAnQC9jb21wb25lbnRzL2xheW91dC9oZWFkZXInO1xuaW1wb3J0IHsgQ2FyZCwgQ2FyZENvbnRlbnQsIENhcmRIZWFkZXIsIENhcmRUaXRsZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9jYXJkJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9idXR0b24nO1xuaW1wb3J0IHsgQmFkZ2UgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvYmFkZ2UnO1xuaW1wb3J0IHsgTGFiZWwgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvbGFiZWwnO1xuaW1wb3J0IHtcbiAgQnVpbGRpbmcgYXMgQnVpbGRpbmdJY29uLFxuICBNYXBQaW4sXG4gIENhbGVuZGFyLFxuICBGaWxlVGV4dCxcbiAgSG9tZSxcbiAgQ2FyLFxuICBQYWNrYWdlLFxuICBBcnJvd0xlZnQsXG59IGZyb20gJ2x1Y2lkZS1yZWFjdCc7XG5pbXBvcnQgeyB1c2VMYW5ndWFnZSB9IGZyb20gJ0AvaG9va3MvdXNlLWxhbmd1YWdlJztcbmltcG9ydCB7IHdpdGhIaWVyYXJjaGljYWxTZWxlY3Rpb24gfSBmcm9tICdAL2NvbXBvbmVudHMvaG9jL3dpdGhIaWVyYXJjaGljYWxTZWxlY3Rpb24nO1xuXG5pbnRlcmZhY2UgQnVpbGRpbmdEYXRhIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBhZGRyZXNzOiBzdHJpbmc7XG4gIGNpdHk6IHN0cmluZztcbiAgc3RhdGU/OiBzdHJpbmc7XG4gIHBvc3RhbF9jb2RlOiBzdHJpbmc7XG4gIG9yZ2FuaXphdGlvbl9pZDogc3RyaW5nO1xuICBwcm92aW5jZT86IHN0cmluZztcbiAgcG9zdGFsQ29kZT86IHN0cmluZztcbiAgYnVpbGRpbmdUeXBlPzogc3RyaW5nO1xuICB5ZWFyQnVpbHQ/OiBudW1iZXI7XG4gIG1hbmFnZW1lbnRDb21wYW55Pzogc3RyaW5nO1xuICB0b3RhbEZsb29ycz86IG51bWJlcjtcbiAgcGFya2luZ1NwYWNlcz86IG51bWJlcjtcbiAgc3RvcmFnZVNwYWNlcz86IG51bWJlcjtcbiAgYW1lbml0aWVzPzogc3RyaW5nIHwgc3RyaW5nW107XG59XG5cbmludGVyZmFjZSBNeUJ1aWxkaW5nUHJvcHMge1xuICBidWlsZGluZ0lkPzogc3RyaW5nO1xuICBzaG93QmFja0J1dHRvbj86IGJvb2xlYW47XG4gIGJhY2tCdXR0b25MYWJlbD86IHN0cmluZztcbiAgb25CYWNrPzogKCkgPT4gdm9pZDtcbn1cblxuZnVuY3Rpb24gTXlCdWlsZGluZyh7IGJ1aWxkaW5nSWQsIHNob3dCYWNrQnV0dG9uLCBiYWNrQnV0dG9uTGFiZWwsIG9uQmFjayB9OiBNeUJ1aWxkaW5nUHJvcHMpIHtcbiAgY29uc3QgWywgbmF2aWdhdGVdID0gdXNlTG9jYXRpb24oKTtcbiAgY29uc3QgeyB0IH0gPSB1c2VMYW5ndWFnZSgpO1xuXG4gIC8vIEZldGNoIHVzZXIncyBhY2Nlc3NpYmxlIGJ1aWxkaW5ncyBhbmQgZmluZCB0aGUgc3BlY2lmaWMgb25lXG4gIGNvbnN0IHtcbiAgICBkYXRhOiB1c2VyQnVpbGRpbmdzLFxuICAgIGlzTG9hZGluZzogaXNMb2FkaW5nQnVpbGRpbmcsXG4gIH0gPSB1c2VRdWVyeSh7XG4gICAgcXVlcnlLZXk6IFsnL2FwaS91c2Vycy9tZS9idWlsZGluZ3MnXSxcbiAgICBxdWVyeUZuOiBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL3VzZXJzL21lL2J1aWxkaW5ncycpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBmZXRjaCBidWlsZGluZ3MnKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSxcbiAgICBlbmFibGVkOiAhIWJ1aWxkaW5nSWQsXG4gIH0pO1xuXG4gIC8vIEZpbmQgdGhlIHNwZWNpZmljIGJ1aWxkaW5nIGZyb20gdXNlcidzIGFjY2Vzc2libGUgYnVpbGRpbmdzXG4gIGNvbnN0IGJ1aWxkaW5nRGF0YTogQnVpbGRpbmdEYXRhIHwgbnVsbCA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgIGlmICghdXNlckJ1aWxkaW5ncyB8fCAhYnVpbGRpbmdJZCkgcmV0dXJuIG51bGw7XG4gICAgY29uc3QgYnVpbGRpbmcgPSB1c2VyQnVpbGRpbmdzLmZpbmQoKGJ1aWxkaW5nOiBhbnkpID0+IGJ1aWxkaW5nLmlkID09PSBidWlsZGluZ0lkKTtcbiAgICBpZiAoIWJ1aWxkaW5nKSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICAvLyBNYXAgQVBJIHJlc3BvbnNlIHRvIG91ciBpbnRlcmZhY2VcbiAgICByZXR1cm4ge1xuICAgICAgLi4uYnVpbGRpbmcsXG4gICAgICBwcm92aW5jZTogYnVpbGRpbmcuc3RhdGUgfHwgYnVpbGRpbmcucHJvdmluY2UsXG4gICAgICBwb3N0YWxDb2RlOiBidWlsZGluZy5wb3N0YWxfY29kZSB8fCBidWlsZGluZy5wb3N0YWxDb2RlLFxuICAgIH07XG4gIH0sIFt1c2VyQnVpbGRpbmdzLCBidWlsZGluZ0lkXSk7XG5cbiAgY29uc3QgaGFuZGxlVmlld0RvY3VtZW50cyA9ICh0YXJnZXRCdWlsZGluZ0lkOiBzdHJpbmcpID0+IHtcbiAgICBuYXZpZ2F0ZShgL3Jlc2lkZW50cy9idWlsZGluZy9kb2N1bWVudHM/YnVpbGRpbmdJZD0ke3RhcmdldEJ1aWxkaW5nSWR9YCk7XG4gIH07XG5cbiAgaWYgKGlzTG9hZGluZ0J1aWxkaW5nKSB7XG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4LTEgZmxleCBmbGV4LWNvbCBvdmVyZmxvdy1oaWRkZW4nPlxuICAgICAgICA8SGVhZGVyIHRpdGxlPSdNeSBCdWlsZGluZycgc3VidGl0bGU9J1ZpZXcgYnVpbGRpbmcgaW5mb3JtYXRpb24gYW5kIGRvY3VtZW50cycgLz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBvdmVyZmxvdy1hdXRvIHAtNic+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9J21heC13LTR4bCBteC1hdXRvJz5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSd0ZXh0LWNlbnRlciBweS04Jz5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2FuaW1hdGUtc3BpbiB3LTYgaC02IGJvcmRlci0yIGJvcmRlci1wcmltYXJ5IGJvcmRlci10LXRyYW5zcGFyZW50IHJvdW5kZWQtZnVsbCBteC1hdXRvJz48L2Rpdj5cbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSd0ZXh0LW11dGVkLWZvcmVncm91bmQgbXQtMic+TG9hZGluZyBidWlsZGluZyBpbmZvcm1hdGlvbi4uLjwvcD5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICBpZiAoIWJ1aWxkaW5nRGF0YSkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleC0xIGZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuJz5cbiAgICAgICAgPEhlYWRlciB0aXRsZT0nTXkgQnVpbGRpbmcnIHN1YnRpdGxlPSdWaWV3IGJ1aWxkaW5nIGluZm9ybWF0aW9uIGFuZCBkb2N1bWVudHMnIC8+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4LTEgb3ZlcmZsb3ctYXV0byBwLTYnPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdtYXgtdy00eGwgbXgtYXV0byc+XG4gICAgICAgICAgICA8Q2FyZD5cbiAgICAgICAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT0ncC04IHRleHQtY2VudGVyJz5cbiAgICAgICAgICAgICAgICA8QnVpbGRpbmdJY29uIGNsYXNzTmFtZT0ndy0xNiBoLTE2IG14LWF1dG8gdGV4dC1ncmF5LTQwMCBtYi00JyAvPlxuICAgICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9J3RleHQtbGcgZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktNjAwIG1iLTInPlxuICAgICAgICAgICAgICAgICAgQnVpbGRpbmcgTm90IEZvdW5kXG4gICAgICAgICAgICAgICAgPC9oMz5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtZ3JheS01MDAnPlVuYWJsZSB0byBsb2FkIGJ1aWxkaW5nIGluZm9ybWF0aW9uLjwvcD5cbiAgICAgICAgICAgICAgPC9DYXJkQ29udGVudD5cbiAgICAgICAgICAgIDwvQ2FyZD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICApO1xuICB9XG5cbiAgcmV0dXJuIChcbiAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleC0xIGZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuJz5cbiAgICAgIDxIZWFkZXIgdGl0bGU9J015IEJ1aWxkaW5nJyBzdWJ0aXRsZT0nVmlldyBidWlsZGluZyBpbmZvcm1hdGlvbiBhbmQgZG9jdW1lbnRzJyAvPlxuXG4gICAgICB7c2hvd0JhY2tCdXR0b24gJiYgb25CYWNrICYmIChcbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2JvcmRlci1iIGJnLWJhY2tncm91bmQvOTUgYmFja2Ryb3AtYmx1ciBzdXBwb3J0cy1bYmFja2Ryb3AtZmlsdGVyXTpiZy1iYWNrZ3JvdW5kLzYwJz5cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgcHgtNiBweS00Jz5cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgdmFyaWFudD0nb3V0bGluZSdcbiAgICAgICAgICAgICAgc2l6ZT0nc20nXG4gICAgICAgICAgICAgIG9uQ2xpY2s9e29uQmFja31cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMidcbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9J2J1dHRvbi1iYWNrLXRvLWJ1aWxkaW5nJ1xuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8QXJyb3dMZWZ0IGNsYXNzTmFtZT0ndy00IGgtNCcgLz5cbiAgICAgICAgICAgICAge2JhY2tCdXR0b25MYWJlbH1cbiAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgICl9XG5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4LTEgb3ZlcmZsb3ctYXV0byBwLTYnPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbWF4LXctNHhsIG14LWF1dG8gc3BhY2UteS02Jz5cbiAgICAgICAgICB7LyogQnVpbGRpbmcgRGV0YWlscyBDYXJkICovfVxuICAgICAgICAgIDxDYXJkIGNsYXNzTmFtZT0naG92ZXI6c2hhZG93LWxnIHRyYW5zaXRpb24tc2hhZG93Jz5cbiAgICAgICAgICAgIDxDYXJkSGVhZGVyPlxuICAgICAgICAgICAgICA8Q2FyZFRpdGxlIGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTInPlxuICAgICAgICAgICAgICAgIDxCdWlsZGluZ0ljb24gY2xhc3NOYW1lPSd3LTUgaC01JyAvPlxuICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEubmFtZX1cbiAgICAgICAgICAgICAgPC9DYXJkVGl0bGU+XG4gICAgICAgICAgICA8L0NhcmRIZWFkZXI+XG4gICAgICAgICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSdzcGFjZS15LTYnPlxuICAgICAgICAgICAgICB7LyogQWRkcmVzcyBTZWN0aW9uICovfVxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc3BhY2UteS0zJz5cbiAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgPExhYmVsIGNsYXNzTmFtZT0ndGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNTAwJz57dCgnYWRkcmVzcycpfTwvTGFiZWw+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1zdGFydCBnYXAtMiBtdC0xJz5cbiAgICAgICAgICAgICAgICAgICAgPE1hcFBpbiBjbGFzc05hbWU9J3ctNCBoLTQgbXQtMC41IHRleHQtbXV0ZWQtZm9yZWdyb3VuZCcgLz5cbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+e2J1aWxkaW5nRGF0YS5hZGRyZXNzfTwvcD5cbiAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+XG4gICAgICAgICAgICAgICAgICAgICAgICB7YnVpbGRpbmdEYXRhLmNpdHl9LCB7YnVpbGRpbmdEYXRhLnByb3ZpbmNlIHx8IGJ1aWxkaW5nRGF0YS5zdGF0ZX0ge2J1aWxkaW5nRGF0YS5wb3N0YWxDb2RlIHx8IGJ1aWxkaW5nRGF0YS5wb3N0YWxfY29kZX1cbiAgICAgICAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgIHsvKiBCdWlsZGluZyBEZXRhaWxzIEdyaWQgKi99XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdncmlkIGdyaWQtY29scy0xIG1kOmdyaWQtY29scy0yIGdhcC02Jz5cbiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc3BhY2UteS0zJz5cbiAgICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEuYnVpbGRpbmdUeXBlICYmIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAge3QoJ2J1aWxkaW5nVHlwZScpfVxuICAgICAgICAgICAgICAgICAgICAgIDwvTGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSd0ZXh0LXNtIHRleHQtZ3JheS03MDAgY2FwaXRhbGl6ZSc+e2J1aWxkaW5nRGF0YS5idWlsZGluZ1R5cGV9PC9wPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEueWVhckJ1aWx0ICYmIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAge3QoJ3llYXJCdWlsdCcpfVxuICAgICAgICAgICAgICAgICAgICAgIDwvTGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXggaXRlbXMtY2VudGVyIGdhcC0yIG10LTEnPlxuICAgICAgICAgICAgICAgICAgICAgICAgPENhbGVuZGFyIGNsYXNzTmFtZT0ndy00IGgtNCB0ZXh0LW11dGVkLWZvcmVncm91bmQnIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+e2J1aWxkaW5nRGF0YS55ZWFyQnVpbHR9PC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICl9XG5cbiAgICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEubWFuYWdlbWVudENvbXBhbnkgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9J3RleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCc+XG4gICAgICAgICAgICAgICAgICAgICAgICB7dCgnbWFuYWdlbWVudENvbXBhbnknKX1cbiAgICAgICAgICAgICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0ndGV4dC1zbSB0ZXh0LWdyYXktNzAwJz57YnVpbGRpbmdEYXRhLm1hbmFnZW1lbnRDb21wYW55fTwvcD5cbiAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICAgIDwvZGl2PlxuXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3NwYWNlLXktMyc+XG4gICAgICAgICAgICAgICAgICB7YnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzICYmIChcbiAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPlxuICAgICAgICAgICAgICAgICAgICAgICAge3QoJ3RvdGFsRmxvb3JzJyl9XG4gICAgICAgICAgICAgICAgICAgICAgPC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgbXQtMSc+XG4gICAgICAgICAgICAgICAgICAgICAgICA8QnVpbGRpbmdJY29uIGNsYXNzTmFtZT0ndy00IGgtNCB0ZXh0LW11dGVkLWZvcmVncm91bmQnIC8+XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+e2J1aWxkaW5nRGF0YS50b3RhbEZsb29yc308L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgKX1cblxuICAgICAgICAgICAgICAgICAgey8qIFBhcmtpbmcgYW5kIFN0b3JhZ2UgKi99XG4gICAgICAgICAgICAgICAgICB7KGJ1aWxkaW5nRGF0YS5wYXJraW5nU3BhY2VzIHx8IGJ1aWxkaW5nRGF0YS5zdG9yYWdlU3BhY2VzKSAmJiAoXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdzcGFjZS15LTInPlxuICAgICAgICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEucGFya2luZ1NwYWNlcyAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8TGFiZWwgY2xhc3NOYW1lPSd0ZXh0LXhzIGZvbnQtbWVkaXVtIHRleHQtZ3JheS01MDAnPnt0KCdwYXJraW5nJyl9PC9MYWJlbD5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXggaXRlbXMtY2VudGVyIGdhcC0yIG10LTEnPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxDYXIgY2xhc3NOYW1lPSd3LTQgaC00IHRleHQtbXV0ZWQtZm9yZWdyb3VuZCcgLz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTcwMCc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7YnVpbGRpbmdEYXRhLnBhcmtpbmdTcGFjZXN9IHt0KCdzcGFjZXMnKX1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgICB7YnVpbGRpbmdEYXRhLnN0b3JhZ2VTcGFjZXMgJiYgKFxuICAgICAgICAgICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgPExhYmVsIGNsYXNzTmFtZT0ndGV4dC14cyBmb250LW1lZGl1bSB0ZXh0LWdyYXktNTAwJz57dCgnc3RvcmFnZScpfTwvTGFiZWw+XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiBtdC0xJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8UGFja2FnZSBjbGFzc05hbWU9J3ctNCBoLTQgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kJyAvPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0ndGV4dC1zbSB0ZXh0LWdyYXktNzAwJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtidWlsZGluZ0RhdGEuc3RvcmFnZVNwYWNlc30ge3QoJ3VuaXRzJyl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPC9kaXY+XG5cblxuICAgICAgICAgICAgICB7LyogQW1lbml0aWVzICovfVxuICAgICAgICAgICAgICB7YnVpbGRpbmdEYXRhLmFtZW5pdGllcyAmJiAoXG4gICAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICAgIDxMYWJlbCBjbGFzc05hbWU9J3RleHQteHMgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTUwMCc+e3QoJ2FtZW5pdGllcycpfTwvTGFiZWw+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBmbGV4LXdyYXAgZ2FwLTIgbXQtMSc+XG4gICAgICAgICAgICAgICAgICAgIHsoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbWVuaXRpZXMgPVxuICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgYnVpbGRpbmdEYXRhLmFtZW5pdGllcyA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UoYnVpbGRpbmdEYXRhLmFtZW5pdGllcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6IGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXkuaXNBcnJheShhbWVuaXRpZXMpXG4gICAgICAgICAgICAgICAgICAgICAgICAgID8gYW1lbml0aWVzLm1hcCgoYW1lbml0eTogc3RyaW5nLCBpbmRleDogbnVtYmVyKSA9PiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8QmFkZ2Uga2V5PXtpbmRleH0gdmFyaWFudD0nb3V0bGluZScgY2xhc3NOYW1lPSd0ZXh0LXhzJz5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge2FtZW5pdHl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L0JhZGdlPlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChfZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSd0ZXh0LXhzIHRleHQtbXV0ZWQtZm9yZWdyb3VuZCc+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3QoJ3VuYWJsZVRvRGlzcGxheUFtZW5pdGllcycpfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSkoKX1cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICApfVxuXG4gICAgICAgICAgICAgIHsvKiBBY3Rpb25zICovfVxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ncHQtNCBib3JkZXItdCc+XG4gICAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gaGFuZGxlVmlld0RvY3VtZW50cyhidWlsZGluZ0RhdGEuaWQpfVxuICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSd3LWZ1bGwganVzdGlmeS1zdGFydCdcbiAgICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPSdidXR0b24tdmlldy1kb2N1bWVudHMnXG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgPEZpbGVUZXh0IGNsYXNzTmFtZT0ndy00IGgtNCBtci0yJyAvPlxuICAgICAgICAgICAgICAgICAge3QoJ3ZpZXdEb2N1bWVudHNCdXR0b24nKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICA8L0NhcmRDb250ZW50PlxuICAgICAgICAgIDwvQ2FyZD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgKTtcbn1cblxuLy8gRXhwb3J0IHRoZSBjb21wb25lbnQgd3JhcHBlZCB3aXRoIGhpZXJhcmNoaWNhbCBzZWxlY3Rpb25cbmV4cG9ydCBkZWZhdWx0IHdpdGhIaWVyYXJjaGljYWxTZWxlY3Rpb24oTXlCdWlsZGluZywge1xuICBoaWVyYXJjaHk6IFsnb3JnYW5pemF0aW9uJywgJ2J1aWxkaW5nJ10sXG59KTsiXSwidmVyc2lvbiI6M30=