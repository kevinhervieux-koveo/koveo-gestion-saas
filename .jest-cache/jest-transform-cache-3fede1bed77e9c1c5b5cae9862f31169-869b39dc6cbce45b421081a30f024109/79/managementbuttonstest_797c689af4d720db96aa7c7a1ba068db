0d2a749b6efb1fe2fe193319ac56e8b4
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
jest.mock('../../../client/src/lib/queryClient', () => ({
    apiRequest: mockApiRequest,
    queryClient: new (jest.requireActual('@tanstack/react-query').QueryClient)(),
}));
// Mock authentication context
jest.mock('../../../client/src/contexts/AuthContext', () => ({
    useAuth: () => ({
        user: { id: '1', email: 'test@test.com', role: 'admin' },
        isAuthenticated: true,
        login: jest.fn(),
        logout: jest.fn(),
    }),
}));
jest.mock('../../../client/src/hooks/use-toast', () => ({
    useToast: () => ({
        toast: mockToast,
    }),
}));
/**
 * Management Button Functionality Tests
 * Tests all management buttons (approve, reject, delete, edit, block, etc.)
 */
const react_1 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
require("@testing-library/jest-dom");
const user_event_1 = __importDefault(require("@testing-library/user-event"));
const react_2 = __importDefault(require("react"));
// Mock API requests
const mockApiRequest = jest.fn();
// Mock toast notifications
const mockToast = jest.fn();
describe('Management Buttons Functionality', () => {
    let queryClient;
    let user;
    beforeEach(() => {
        queryClient = new react_query_1.QueryClient({
            defaultOptions: {
                queries: { retry: false },
                mutations: { retry: false },
            },
        });
        user = user_event_1.default.setup();
        jest.clearAllMocks();
        mockApiRequest.mockResolvedValue({ ok: true, json: () => Promise.resolve({}) });
    });
    const renderWithProvider = (component) => {
        return (0, react_1.render)((0, jsx_runtime_1.jsx)(react_query_1.QueryClientProvider, { client: queryClient, children: component }));
    };
    describe('Demand Management Buttons', () => {
        it('should handle demand approval', async () => {
            const demandId = 'test-demand-id';
            const MockDemandCard = () => ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": `button-approve-${demandId}`, onClick: () => mockApiRequest(`/api/demands/${demandId}/approve`, { method: 'PATCH' }), children: "Approve" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-reject-${demandId}`, onClick: () => mockApiRequest(`/api/demands/${demandId}/reject`, { method: 'PATCH' }), children: "Reject" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-view-${demandId}`, onClick: () => mockApiRequest(`/api/demands/${demandId}`, { method: 'GET' }), children: "View" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-edit-${demandId}`, onClick: () => mockApiRequest(`/api/demands/${demandId}`, { method: 'GET' }), children: "Edit" })] }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockDemandCard, {}));
            const approveButton = react_1.screen.getByTestId(`button-approve-${demandId}`);
            const rejectButton = react_1.screen.getByTestId(`button-reject-${demandId}`);
            const viewButton = react_1.screen.getByTestId(`button-view-${demandId}`);
            const editButton = react_1.screen.getByTestId(`button-edit-${demandId}`);
            expect(approveButton).toBeInTheDocument();
            expect(rejectButton).toBeInTheDocument();
            expect(viewButton).toBeInTheDocument();
            expect(editButton).toBeInTheDocument();
            await user.click(approveButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/demands/${demandId}/approve`, { method: 'PATCH' });
            await user.click(rejectButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/demands/${demandId}/reject`, { method: 'PATCH' });
            await user.click(viewButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/demands/${demandId}`, { method: 'GET' });
            await user.click(editButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/demands/${demandId}`, { method: 'GET' });
        });
    });
    describe('User Management Buttons', () => {
        it('should handle user blocking and unblocking', async () => {
            const userId = 'test-user-id';
            const MockUserManagement = () => ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": `button-block-${userId}`, onClick: () => mockApiRequest(`/api/users/${userId}/block`, { method: 'POST' }), children: "Block User" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-unblock-${userId}`, onClick: () => mockApiRequest(`/api/users/${userId}/unblock`, { method: 'POST' }), children: "Unblock User" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-time-limit-${userId}`, onClick: () => mockApiRequest(`/api/users/${userId}/time-limits`, { method: 'POST' }), children: "Set Time Limit" })] }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockUserManagement, {}));
            const blockButton = react_1.screen.getByTestId(`button-block-${userId}`);
            const unblockButton = react_1.screen.getByTestId(`button-unblock-${userId}`);
            const timeLimitButton = react_1.screen.getByTestId(`button-time-limit-${userId}`);
            expect(blockButton).toBeInTheDocument();
            expect(unblockButton).toBeInTheDocument();
            expect(timeLimitButton).toBeInTheDocument();
            await user.click(blockButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/users/${userId}/block`, { method: 'POST' });
            await user.click(unblockButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/users/${userId}/unblock`, { method: 'POST' });
            await user.click(timeLimitButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/users/${userId}/time-limits`, { method: 'POST' });
        });
    });
    describe('Delete and Confirmation Buttons', () => {
        it('should handle delete confirmation flow', async () => {
            const bugId = 'test-bug-id';
            const invitationId = 'test-invitation-id';
            const MockDeleteFlow = () => {
                const [showConfirmation, setShowConfirmation] = react_2.default.useState(false);
                return ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": `button-delete-${bugId}`, onClick: () => setShowConfirmation(true), children: "Delete Bug" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-delete-invitation-${invitationId}`, onClick: () => setShowConfirmation(true), children: "Delete Invitation" }), showConfirmation && ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": "button-cancel-delete-invitation", onClick: () => setShowConfirmation(false), children: "Cancel" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": "button-confirm-delete-invitation", onClick: () => {
                                        mockApiRequest('/api/delete', { method: 'DELETE' });
                                        setShowConfirmation(false);
                                    }, children: "Confirm Delete" })] }))] }));
            };
            renderWithProvider((0, jsx_runtime_1.jsx)(MockDeleteFlow, {}));
            const deleteBugButton = react_1.screen.getByTestId(`button-delete-${bugId}`);
            const deleteInvitationButton = react_1.screen.getByTestId(`button-delete-invitation-${invitationId}`);
            expect(deleteBugButton).toBeInTheDocument();
            expect(deleteInvitationButton).toBeInTheDocument();
            // Test delete confirmation flow
            await user.click(deleteInvitationButton);
            await (0, react_1.waitFor)(() => {
                const cancelButton = react_1.screen.getByTestId('button-cancel-delete-invitation');
                const confirmButton = react_1.screen.getByTestId('button-confirm-delete-invitation');
                expect(cancelButton).toBeInTheDocument();
                expect(confirmButton).toBeInTheDocument();
            });
            const confirmButton = react_1.screen.getByTestId('button-confirm-delete-invitation');
            await user.click(confirmButton);
            expect(mockApiRequest).toHaveBeenCalledWith('/api/delete', { method: 'DELETE' });
        });
    });
    describe('Edit and Cancel Buttons', () => {
        it('should handle edit and cancel actions', async () => {
            const MockEditForm = () => {
                const [isEditing, setIsEditing] = react_2.default.useState(false);
                return ((0, jsx_runtime_1.jsx)("div", { children: !isEditing ? ((0, jsx_runtime_1.jsx)("button", { "data-testid": "button-edit-space", onClick: () => setIsEditing(true), children: "Edit Space" })) : ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": "button-cancel-edit", onClick: () => setIsEditing(false), children: "Cancel Edit" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": "button-save-edit", onClick: () => {
                                    mockApiRequest('/api/save', { method: 'PATCH' });
                                    setIsEditing(false);
                                }, children: "Save Edit" })] })) }));
            };
            renderWithProvider((0, jsx_runtime_1.jsx)(MockEditForm, {}));
            const editButton = react_1.screen.getByTestId('button-edit-space');
            expect(editButton).toBeInTheDocument();
            await user.click(editButton);
            await (0, react_1.waitFor)(() => {
                const cancelButton = react_1.screen.getByTestId('button-cancel-edit');
                const saveButton = react_1.screen.getByTestId('button-save-edit');
                expect(cancelButton).toBeInTheDocument();
                expect(saveButton).toBeInTheDocument();
            });
            const saveButton = react_1.screen.getByTestId('button-save-edit');
            await user.click(saveButton);
            expect(mockApiRequest).toHaveBeenCalledWith('/api/save', { method: 'PATCH' });
        });
    });
    describe('Upvote and Menu Buttons', () => {
        it('should handle upvote and menu actions', async () => {
            const requestId = 'test-request-id';
            const MockFeatureRequest = () => ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": `button-upvote-${requestId}`, onClick: () => mockApiRequest(`/api/feature-requests/${requestId}/upvote`, { method: 'POST' }), children: "Upvote" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": `button-menu-${requestId}`, onClick: () => console.log('Menu opened'), children: "Menu" })] }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockFeatureRequest, {}));
            const upvoteButton = react_1.screen.getByTestId(`button-upvote-${requestId}`);
            const menuButton = react_1.screen.getByTestId(`button-menu-${requestId}`);
            expect(upvoteButton).toBeInTheDocument();
            expect(menuButton).toBeInTheDocument();
            await user.click(upvoteButton);
            expect(mockApiRequest).toHaveBeenCalledWith(`/api/feature-requests/${requestId}/upvote`, { method: 'POST' });
            await user.click(menuButton);
            // Menu button functionality would be tested in integration tests
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2J1dHRvbi1mdW5jdGlvbmFsaXR5L21hbmFnZW1lbnQtYnV0dG9ucy50ZXN0LnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7QUFhQSxJQUFJLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDdEQsVUFBVSxFQUFFLGNBQWM7SUFDMUIsV0FBVyxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLHVCQUF1QixDQUFDLENBQUMsV0FBVyxDQUFDLEVBQUU7Q0FDN0UsQ0FBQyxDQUFDLENBQUM7QUFFSiw4QkFBOEI7QUFDOUIsSUFBSSxDQUFDLElBQUksQ0FBQywwQ0FBMEMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzNELE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2QsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUU7UUFDeEQsZUFBZSxFQUFFLElBQUk7UUFDckIsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDaEIsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDbEIsQ0FBQztDQUNILENBQUMsQ0FBQyxDQUFDO0FBSUosSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2YsS0FBSyxFQUFFLFNBQVM7S0FDakIsQ0FBQztDQUNILENBQUMsQ0FBQyxDQUFDO0FBbENKOzs7R0FHRztBQUVILGtEQUE0RTtBQUM1RSx1REFBeUU7QUFDekUscUNBQW1DO0FBQ25DLDZFQUFvRDtBQUNwRCxrREFBMEI7QUFFMUIsb0JBQW9CO0FBQ3BCLE1BQU0sY0FBYyxHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQztBQWdCakMsMkJBQTJCO0FBQzNCLE1B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QUFrQixLQUFHLENBQUMsQ0FBQztZQUUzQyxNQUFNLFlBQVksR0FBRyxjQUFNLENBQUMsV0FBVyxDQUFDLGlCQUFpQixTQUFTLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sVUFBVSxHQUFHLGNBQU0sQ0FBQyxXQUFXLENBQUMsZUFBZSxTQUFTLEVBQUUsQ0FBQyxDQUFDO1lBRWxFLE1BQU0sQ0FBQyxZQUFZLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBQ3pDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRXZDLE1BQU0sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUMvQixNQUFNLENBQUMsY0FBYyxDQUFDLENBQUMsb0JBQW9CLENBQUMseUJBQXlCLFNBQVMsU0FBUyxFQUFFLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFFN0csTUFBTSxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQzdCLGlFQUFpRTtRQUNuRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2J1dHRvbi1mdW5jdGlvbmFsaXR5L21hbmFnZW1lbnQtYnV0dG9ucy50ZXN0LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1hbmFnZW1lbnQgQnV0dG9uIEZ1bmN0aW9uYWxpdHkgVGVzdHNcbiAqIFRlc3RzIGFsbCBtYW5hZ2VtZW50IGJ1dHRvbnMgKGFwcHJvdmUsIHJlamVjdCwgZGVsZXRlLCBlZGl0LCBibG9jaywgZXRjLilcbiAqL1xuXG5pbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50LCB3YWl0Rm9yIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCc7XG5pbXBvcnQgeyBRdWVyeUNsaWVudCwgUXVlcnlDbGllbnRQcm92aWRlciB9IGZyb20gJ0B0YW5zdGFjay9yZWFjdC1xdWVyeSc7XG5pbXBvcnQgJ0B0ZXN0aW5nLWxpYnJhcnkvamVzdC1kb20nO1xuaW1wb3J0IHVzZXJFdmVudCBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3VzZXItZXZlbnQnO1xuaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcblxuLy8gTW9jayBBUEkgcmVxdWVzdHNcbmNvbnN0IG1vY2tBcGlSZXF1ZXN0ID0gamVzdC5mbigpO1xuamVzdC5tb2NrKCcuLi8uLi8uLi9jbGllbnQvc3JjL2xpYi9xdWVyeUNsaWVudCcsICgpID0+ICh7XG4gIGFwaVJlcXVlc3Q6IG1vY2tBcGlSZXF1ZXN0LFxuICBxdWVyeUNsaWVudDogbmV3IChqZXN0LnJlcXVpcmVBY3R1YWwoJ0B0YW5zdGFjay9yZWFjdC1xdWVyeScpLlF1ZXJ5Q2xpZW50KSgpLFxufSkpO1xuXG4vLyBNb2NrIGF1dGhlbnRpY2F0aW9uIGNvbnRleHRcbmplc3QubW9jaygnLi4vLi4vLi4vY2xpZW50L3NyYy9jb250ZXh0cy9BdXRoQ29udGV4dCcsICgpID0+ICh7XG4gIHVzZUF1dGg6ICgpID0+ICh7XG4gICAgdXNlcjogeyBpZDogJzEnLCBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nLCByb2xlOiAnYWRtaW4nIH0sXG4gICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgIGxvZ2luOiBqZXN0LmZuKCksXG4gICAgbG9nb3V0OiBqZXN0LmZuKCksXG4gIH0pLFxufSkpO1xuXG4vLyBNb2NrIHRvYXN0IG5vdGlmaWNhdGlvbnNcbmNvbnN0IG1vY2tUb2FzdCA9IGplc3QuZm4oKTtcbmplc3QubW9jaygnLi4vLi4vLi4vY2xpZW50L3NyYy9ob29rcy91c2UtdG9hc3QnLCAoKSA9PiAoe1xuICB1c2VUb2FzdDogKCkgPT4gKHtcbiAgICB0b2FzdDogbW9ja1RvYXN0LFxuICB9KSxcbn0pKTtcblxuZGVzY3JpYmUoJ01hbmFnZW1lbnQgQnV0dG9ucyBGdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICBsZXQgcXVlcnlDbGllbnQ6IFF1ZXJ5Q2xpZW50O1xuICBsZXQgdXNlcjogYW55O1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHF1ZXJ5Q2xpZW50ID0gbmV3IFF1ZXJ5Q2xpZW50KHtcbiAgICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICAgIHF1ZXJpZXM6IHsgcmV0cnk6IGZhbHNlIH0sXG4gICAgICAgIG11dGF0aW9uczogeyByZXRyeTogZmFsc2UgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdXNlciA9IHVzZXJFdmVudC5zZXR1cCgpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIG1vY2tBcGlSZXF1ZXN0Lm1vY2tSZXNvbHZlZFZhbHVlKHsgb2s6IHRydWUsIGpzb246ICgpID0+IFByb21pc2UucmVzb2x2ZSh7fSkgfSk7XG4gIH0pO1xuXG4gIGNvbnN0IHJlbmRlcldpdGhQcm92aWRlciA9IChjb21wb25lbnQ6IFJlYWN0LlJlYWN0RWxlbWVudCkgPT4ge1xuICAgIHJldHVybiByZW5kZXIoXG4gICAgICA8UXVlcnlDbGllbnRQcm92aWRlciBjbGllbnQ9e3F1ZXJ5Q2xpZW50fT5cbiAgICAgICAge2NvbXBvbmVudH1cbiAgICAgIDwvUXVlcnlDbGllbnRQcm92aWRlcj5cbiAgICApO1xuICB9O1xuXG4gIGRlc2NyaWJlKCdEZW1hbmQgTWFuYWdlbWVudCBCdXR0b25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbWFuZCBhcHByb3ZhbCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbWFuZElkID0gJ3Rlc3QtZGVtYW5kLWlkJztcbiAgICAgIGNvbnN0IE1vY2tEZW1hbmRDYXJkID0gKCkgPT4gKFxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICBkYXRhLXRlc3RpZD17YGJ1dHRvbi1hcHByb3ZlLSR7ZGVtYW5kSWR9YH1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG1vY2tBcGlSZXF1ZXN0KGAvYXBpL2RlbWFuZHMvJHtkZW1hbmRJZH0vYXBwcm92ZWAsIHsgbWV0aG9kOiAnUEFUQ0gnIH0pfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIEFwcHJvdmVcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2BidXR0b24tcmVqZWN0LSR7ZGVtYW5kSWR9YH1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG1vY2tBcGlSZXF1ZXN0KGAvYXBpL2RlbWFuZHMvJHtkZW1hbmRJZH0vcmVqZWN0YCwgeyBtZXRob2Q6ICdQQVRDSCcgfSl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgUmVqZWN0XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPXtgYnV0dG9uLXZpZXctJHtkZW1hbmRJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja0FwaVJlcXVlc3QoYC9hcGkvZGVtYW5kcy8ke2RlbWFuZElkfWAsIHsgbWV0aG9kOiAnR0VUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBWaWV3XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPXtgYnV0dG9uLWVkaXQtJHtkZW1hbmRJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja0FwaVJlcXVlc3QoYC9hcGkvZGVtYW5kcy8ke2RlbWFuZElkfWAsIHsgbWV0aG9kOiAnR0VUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBFZGl0XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgKTtcblxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVyKDxNb2NrRGVtYW5kQ2FyZCAvPik7XG4gICAgICBcbiAgICAgIGNvbnN0IGFwcHJvdmVCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoYGJ1dHRvbi1hcHByb3ZlLSR7ZGVtYW5kSWR9YCk7XG4gICAgICBjb25zdCByZWplY3RCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoYGJ1dHRvbi1yZWplY3QtJHtkZW1hbmRJZH1gKTtcbiAgICAgIGNvbnN0IHZpZXdCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoYGJ1dHRvbi12aWV3LSR7ZGVtYW5kSWR9YCk7XG4gICAgICBjb25zdCBlZGl0QnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKGBidXR0b24tZWRpdC0ke2RlbWFuZElkfWApO1xuICAgICAgXG4gICAgICBleHBlY3QoYXBwcm92ZUJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChyZWplY3RCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3Qodmlld0J1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChlZGl0QnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGFwcHJvdmVCdXR0b24pO1xuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgL2FwaS9kZW1hbmRzLyR7ZGVtYW5kSWR9L2FwcHJvdmVgLCB7IG1ldGhvZDogJ1BBVENIJyB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhyZWplY3RCdXR0b24pO1xuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgL2FwaS9kZW1hbmRzLyR7ZGVtYW5kSWR9L3JlamVjdGAsIHsgbWV0aG9kOiAnUEFUQ0gnIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHZpZXdCdXR0b24pO1xuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgL2FwaS9kZW1hbmRzLyR7ZGVtYW5kSWR9YCwgeyBtZXRob2Q6ICdHRVQnIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGVkaXRCdXR0b24pO1xuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgL2FwaS9kZW1hbmRzLyR7ZGVtYW5kSWR9YCwgeyBtZXRob2Q6ICdHRVQnIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVXNlciBNYW5hZ2VtZW50IEJ1dHRvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdXNlciBibG9ja2luZyBhbmQgdW5ibG9ja2luZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHVzZXJJZCA9ICd0ZXN0LXVzZXItaWQnO1xuICAgICAgY29uc3QgTW9ja1VzZXJNYW5hZ2VtZW50ID0gKCkgPT4gKFxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICBkYXRhLXRlc3RpZD17YGJ1dHRvbi1ibG9jay0ke3VzZXJJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja0FwaVJlcXVlc3QoYC9hcGkvdXNlcnMvJHt1c2VySWR9L2Jsb2NrYCwgeyBtZXRob2Q6ICdQT1NUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBCbG9jayBVc2VyXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPXtgYnV0dG9uLXVuYmxvY2stJHt1c2VySWR9YH1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG1vY2tBcGlSZXF1ZXN0KGAvYXBpL3VzZXJzLyR7dXNlcklkfS91bmJsb2NrYCwgeyBtZXRob2Q6ICdQT1NUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBVbmJsb2NrIFVzZXJcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2BidXR0b24tdGltZS1saW1pdC0ke3VzZXJJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja0FwaVJlcXVlc3QoYC9hcGkvdXNlcnMvJHt1c2VySWR9L3RpbWUtbGltaXRzYCwgeyBtZXRob2Q6ICdQT1NUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBTZXQgVGltZSBMaW1pdFxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja1VzZXJNYW5hZ2VtZW50IC8+KTtcbiAgICAgIFxuICAgICAgY29uc3QgYmxvY2tCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoYGJ1dHRvbi1ibG9jay0ke3VzZXJJZH1gKTtcbiAgICAgIGNvbnN0IHVuYmxvY2tCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoYGJ1dHRvbi11bmJsb2NrLSR7dXNlcklkfWApO1xuICAgICAgY29uc3QgdGltZUxpbWl0QnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKGBidXR0b24tdGltZS1saW1pdC0ke3VzZXJJZH1gKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGJsb2NrQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgZXhwZWN0KHVuYmxvY2tCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3QodGltZUxpbWl0QnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGJsb2NrQnV0dG9uKTtcbiAgICAgIGV4cGVjdChtb2NrQXBpUmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoYC9hcGkvdXNlcnMvJHt1c2VySWR9L2Jsb2NrYCwgeyBtZXRob2Q6ICdQT1NUJyB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayh1bmJsb2NrQnV0dG9uKTtcbiAgICAgIGV4cGVjdChtb2NrQXBpUmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoYC9hcGkvdXNlcnMvJHt1c2VySWR9L3VuYmxvY2tgLCB7IG1ldGhvZDogJ1BPU1QnIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHRpbWVMaW1pdEJ1dHRvbik7XG4gICAgICBleHBlY3QobW9ja0FwaVJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGAvYXBpL3VzZXJzLyR7dXNlcklkfS90aW1lLWxpbWl0c2AsIHsgbWV0aG9kOiAnUE9TVCcgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEZWxldGUgYW5kIENvbmZpcm1hdGlvbiBCdXR0b25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGRlbGV0ZSBjb25maXJtYXRpb24gZmxvdycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1Z0lkID0gJ3Rlc3QtYnVnLWlkJztcbiAgICAgIGNvbnN0IGludml0YXRpb25JZCA9ICd0ZXN0LWludml0YXRpb24taWQnO1xuICAgICAgXG4gICAgICBjb25zdCBNb2NrRGVsZXRlRmxvdyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgW3Nob3dDb25maXJtYXRpb24sIHNldFNob3dDb25maXJtYXRpb25dID0gUmVhY3QudXNlU3RhdGUoZmFsc2UpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2BidXR0b24tZGVsZXRlLSR7YnVnSWR9YH1cbiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0U2hvd0NvbmZpcm1hdGlvbih0cnVlKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgRGVsZXRlIEJ1Z1xuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgICBkYXRhLXRlc3RpZD17YGJ1dHRvbi1kZWxldGUtaW52aXRhdGlvbi0ke2ludml0YXRpb25JZH1gfVxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRTaG93Q29uZmlybWF0aW9uKHRydWUpfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICBEZWxldGUgSW52aXRhdGlvblxuICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHtzaG93Q29uZmlybWF0aW9uICYmIChcbiAgICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJidXR0b24tY2FuY2VsLWRlbGV0ZS1pbnZpdGF0aW9uXCJcbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldFNob3dDb25maXJtYXRpb24oZmFsc2UpfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIENhbmNlbFxuICAgICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICAgICAgICBkYXRhLXRlc3RpZD1cImJ1dHRvbi1jb25maXJtLWRlbGV0ZS1pbnZpdGF0aW9uXCJcbiAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbW9ja0FwaVJlcXVlc3QoJy9hcGkvZGVsZXRlJywgeyBtZXRob2Q6ICdERUxFVEUnIH0pO1xuICAgICAgICAgICAgICAgICAgICBzZXRTaG93Q29uZmlybWF0aW9uKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgQ29uZmlybSBEZWxldGVcbiAgICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApO1xuICAgICAgfTtcblxuICAgICAgcmVuZGVyV2l0aFByb3ZpZGVyKDxNb2NrRGVsZXRlRmxvdyAvPik7XG4gICAgICBcbiAgICAgIGNvbnN0IGRlbGV0ZUJ1Z0J1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZChgYnV0dG9uLWRlbGV0ZS0ke2J1Z0lkfWApO1xuICAgICAgY29uc3QgZGVsZXRlSW52aXRhdGlvbkJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZChgYnV0dG9uLWRlbGV0ZS1pbnZpdGF0aW9uLSR7aW52aXRhdGlvbklkfWApO1xuICAgICAgXG4gICAgICBleHBlY3QoZGVsZXRlQnVnQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgZXhwZWN0KGRlbGV0ZUludml0YXRpb25CdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBcbiAgICAgIC8vIFRlc3QgZGVsZXRlIGNvbmZpcm1hdGlvbiBmbG93XG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGRlbGV0ZUludml0YXRpb25CdXR0b24pO1xuICAgICAgXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgY29uc3QgY2FuY2VsQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tY2FuY2VsLWRlbGV0ZS1pbnZpdGF0aW9uJyk7XG4gICAgICAgIGNvbnN0IGNvbmZpcm1CdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1dHRvbi1jb25maXJtLWRlbGV0ZS1pbnZpdGF0aW9uJyk7XG4gICAgICAgIFxuICAgICAgICBleHBlY3QoY2FuY2VsQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgICBleHBlY3QoY29uZmlybUJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb25maXJtQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tY29uZmlybS1kZWxldGUtaW52aXRhdGlvbicpO1xuICAgICAgYXdhaXQgdXNlci5jbGljayhjb25maXJtQnV0dG9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2FwaS9kZWxldGUnLCB7IG1ldGhvZDogJ0RFTEVURScgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGl0IGFuZCBDYW5jZWwgQnV0dG9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBlZGl0IGFuZCBjYW5jZWwgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IE1vY2tFZGl0Rm9ybSA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgW2lzRWRpdGluZywgc2V0SXNFZGl0aW5nXSA9IFJlYWN0LnVzZVN0YXRlKGZhbHNlKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIHshaXNFZGl0aW5nID8gKFxuICAgICAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLWVkaXQtc3BhY2VcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldElzRWRpdGluZyh0cnVlKX1cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIEVkaXQgU3BhY2VcbiAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICA8ZGl2PlxuICAgICAgICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICAgICAgICBkYXRhLXRlc3RpZD1cImJ1dHRvbi1jYW5jZWwtZWRpdFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRJc0VkaXRpbmcoZmFsc2UpfVxuICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgIENhbmNlbCBFZGl0XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLXNhdmUtZWRpdFwiXG4gICAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG1vY2tBcGlSZXF1ZXN0KCcvYXBpL3NhdmUnLCB7IG1ldGhvZDogJ1BBVENIJyB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2V0SXNFZGl0aW5nKGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgU2F2ZSBFZGl0XG4gICAgICAgICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja0VkaXRGb3JtIC8+KTtcbiAgICAgIFxuICAgICAgY29uc3QgZWRpdEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLWVkaXQtc3BhY2UnKTtcbiAgICAgIGV4cGVjdChlZGl0QnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKGVkaXRCdXR0b24pO1xuICAgICAgXG4gICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgY29uc3QgY2FuY2VsQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tY2FuY2VsLWVkaXQnKTtcbiAgICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLXNhdmUtZWRpdCcpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KGNhbmNlbEJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgZXhwZWN0KHNhdmVCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc2F2ZUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLXNhdmUtZWRpdCcpO1xuICAgICAgYXdhaXQgdXNlci5jbGljayhzYXZlQnV0dG9uKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnL2FwaS9zYXZlJywgeyBtZXRob2Q6ICdQQVRDSCcgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdVcHZvdGUgYW5kIE1lbnUgQnV0dG9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSB1cHZvdGUgYW5kIG1lbnUgYWN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3RJZCA9ICd0ZXN0LXJlcXVlc3QtaWQnO1xuICAgICAgXG4gICAgICBjb25zdCBNb2NrRmVhdHVyZVJlcXVlc3QgPSAoKSA9PiAoXG4gICAgICAgIDxkaXY+XG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPXtgYnV0dG9uLXVwdm90ZS0ke3JlcXVlc3RJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja0FwaVJlcXVlc3QoYC9hcGkvZmVhdHVyZS1yZXF1ZXN0cy8ke3JlcXVlc3RJZH0vdXB2b3RlYCwgeyBtZXRob2Q6ICdQT1NUJyB9KX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBVcHZvdGVcbiAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2BidXR0b24tbWVudS0ke3JlcXVlc3RJZH1gfVxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gY29uc29sZS5sb2coJ01lbnUgb3BlbmVkJyl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgTWVudVxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja0ZlYXR1cmVSZXF1ZXN0IC8+KTtcbiAgICAgIFxuICAgICAgY29uc3QgdXB2b3RlQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKGBidXR0b24tdXB2b3RlLSR7cmVxdWVzdElkfWApO1xuICAgICAgY29uc3QgbWVudUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZChgYnV0dG9uLW1lbnUtJHtyZXF1ZXN0SWR9YCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCh1cHZvdGVCdXR0b24pLnRvQmVJblRoZURvY3VtZW50KCk7XG4gICAgICBleHBlY3QobWVudUJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayh1cHZvdGVCdXR0b24pO1xuICAgICAgZXhwZWN0KG1vY2tBcGlSZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChgL2FwaS9mZWF0dXJlLXJlcXVlc3RzLyR7cmVxdWVzdElkfS91cHZvdGVgLCB7IG1ldGhvZDogJ1BPU1QnIH0pO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKG1lbnVCdXR0b24pO1xuICAgICAgLy8gTWVudSBidXR0b24gZnVuY3Rpb25hbGl0eSB3b3VsZCBiZSB0ZXN0ZWQgaW4gaW50ZWdyYXRpb24gdGVzdHNcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=