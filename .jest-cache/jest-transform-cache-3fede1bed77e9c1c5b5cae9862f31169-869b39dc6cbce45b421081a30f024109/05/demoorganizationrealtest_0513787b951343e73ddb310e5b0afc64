276d8cf8a82a3c5a93c707d6472d1e8a
"use strict";
/**
 * Demo Organization Integration Tests with Real Data
 * Tests API endpoints using actual demo organization data from the database
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const routes_1 = require("../../server/routes");
// Create a simple test server
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Register all routes
    (0, routes_1.registerRoutes)(app);
    return app;
};
(0, globals_1.describe)('Demo Organization Integration Tests with Real Data', () => {
    let app;
    (0, globals_1.beforeAll)(async () => {
        app = createTestApp();
    });
    (0, globals_1.describe)('Organization API Endpoints', () => {
        (0, globals_1.it)('should fetch organizations successfully', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/organizations')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            // Should return some data or handle authentication properly
            (0, globals_1.expect)([200, 401, 403].includes(response.status)).toBe(true);
        });
        (0, globals_1.it)('should handle demo organization queries', async () => {
            // Use dynamic lookup instead of hardcoded ID to avoid conflicts
            const response = await (0, supertest_1.default)(app)
                .get('/api/demo/users')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            // Should return demo users or handle properly (doesn't modify data)
            (0, globals_1.expect)([200, 401, 403, 404].includes(response.status)).toBe(true);
        });
    });
    (0, globals_1.describe)('Buildings API Endpoints', () => {
        (0, globals_1.it)('should fetch buildings successfully', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/buildings')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            (0, globals_1.expect)([200, 401, 403].includes(response.status)).toBe(true);
        });
        (0, globals_1.it)('should handle specific building queries', async () => {
            const buildingId = 'd084392f-facb-40a6-8685-3b40dcdd4b68'; // Koveo Tower
            const response = await (0, supertest_1.default)(app)
                .get(`/api/buildings/${buildingId}`)
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            (0, globals_1.expect)([200, 401, 403, 404].includes(response.status)).toBe(true);
        });
    });
    (0, globals_1.describe)('Users API Endpoints', () => {
        (0, globals_1.it)('should handle user authentication endpoints', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/users/me')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            // Should either return user data or require authentication
            (0, globals_1.expect)([200, 401, 403].includes(response.status)).toBe(true);
        });
    });
    (0, globals_1.describe)('Health Check Endpoints', () => {
        (0, globals_1.it)('should respond to health check', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/health')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThanOrEqual(200);
            });
            (0, globals_1.expect)(response.status).toBe(200);
            (0, globals_1.expect)(response.body).toHaveProperty('status');
        });
        (0, globals_1.it)('should respond to status check', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/health')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThanOrEqual(200);
            });
            (0, globals_1.expect)([200, 503].includes(response.status)).toBe(true);
        });
    });
    (0, globals_1.describe)('Demo Data Validation', () => {
        (0, globals_1.it)('should validate demo users exist', async () => {
            // Test that demo users can be queried
            const demoUserEmail = 'emma.cote@demo.com';
            // Try to get user info - should handle appropriately
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .query({ email: demoUserEmail })
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            (0, globals_1.expect)([200, 401, 403, 404].includes(response.status)).toBe(true);
        });
        (0, globals_1.it)('should validate demo organization structure', async () => {
            // Verify that demo organization endpoints are accessible
            const response = await (0, supertest_1.default)(app)
                .get('/api/organizations')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            (0, globals_1.expect)([200, 401, 403].includes(response.status)).toBe(true);
        });
    });
    (0, globals_1.describe)('Error Handling', () => {
        (0, globals_1.it)('should handle invalid routes gracefully', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/nonexistent')
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeGreaterThanOrEqual(404);
            });
            (0, globals_1.expect)(response.status).toBe(404);
        });
        (0, globals_1.it)('should handle malformed requests', async () => {
            const response = await (0, supertest_1.default)(app)
                .post('/api/organizations')
                .send({ invalid: 'data' })
                .expect((res) => {
                (0, globals_1.expect)(res.status).toBeLessThan(500);
            });
            // Should reject with 400/401/403 but not crash
            (0, globals_1.expect)([400, 401, 403, 422].includes(response.status)).toBe(true);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi9kZW1vLW9yZ2FuaXphdGlvbi1yZWFsLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7QUFFSCwyQ0FBMEU7QUFDMUUsMERBQWdDO0FBQ2hDLHNEQUE4QjtBQUM5QixnREFBcUQ7QUFFckQsOEJBQThCO0FBQzlCLE1BQU0sYUFBYSxHQUFHLEdBQUcsRUFBRTtJQUN6QixNQUFNLEdBQUcsR0FBRyxJQUFBLGlCQUFPLEdBQUUsQ0FBQztJQUN0QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztJQUN4QixHQUFHLENBQUMsR0FBRyxDQUFDLGlCQUFPLENBQUMsVUFBVSxDQUFDLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztJQUVoRCxzQkFBc0I7SUFDdEIsSUFBQSx1QkFBYyxFQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXBCLE9BQU8sR0FBRyxDQUFDO0FBQ2IsQ0FBQyxDQUFDO0FBRUYsSUFBQSxrQkFBUSxFQUFDLG9EQUFvRCxFQUFFLEdBQUcsRUFBRTtJQUNsRSxJQUFJLEdBQXdCLENBQUM7SUFFN0IsSUFBQSxtQkFBUyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLEdBQUcsR0FBRyxhQUFhLEVBQUUsQ0FBQztJQUN4QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsa0JBQVEsRUFBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7UUFDMUMsSUFBQSxZQUFFLEVBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsTUFBTSxRQUFRLEdBQUcsTUFBTSxJQUFBLG1CQUFPLEVBQUMsR0FBRyxDQUFDO2lCQUNoQyxHQUFHLENBQUMsb0JBQW9CLENBQUM7aUJBQ3pCLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFO2dCQUNkLElBQUEsZ0JBQU0sRUFBQyxHQUFHLENBQUMsTUFBTSxDQUFDLENBQUMsWUFBWSxDQUFDLEdB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T0FBTyxFQUFFLE1BQU0sRUFBRSxDQUFDO2lCQUN6QixNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtnQkFDZCxJQUFBLGdCQUFNLEVBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUN2QyxDQUFDLENBQUMsQ0FBQztZQUVMLCtDQUErQztZQUMvQyxJQUFBLGdCQUFNLEVBQUMsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3Rlc3RzL2ludGVncmF0aW9uL2RlbW8tb3JnYW5pemF0aW9uLXJlYWwudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIERlbW8gT3JnYW5pemF0aW9uIEludGVncmF0aW9uIFRlc3RzIHdpdGggUmVhbCBEYXRhXG4gKiBUZXN0cyBBUEkgZW5kcG9pbnRzIHVzaW5nIGFjdHVhbCBkZW1vIG9yZ2FuaXphdGlvbiBkYXRhIGZyb20gdGhlIGRhdGFiYXNlXG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUFsbCwgYWZ0ZXJBbGwgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG5pbXBvcnQgZXhwcmVzcyBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IHJlZ2lzdGVyUm91dGVzIH0gZnJvbSAnLi4vLi4vc2VydmVyL3JvdXRlcyc7XG5cbi8vIENyZWF0ZSBhIHNpbXBsZSB0ZXN0IHNlcnZlclxuY29uc3QgY3JlYXRlVGVzdEFwcCA9ICgpID0+IHtcbiAgY29uc3QgYXBwID0gZXhwcmVzcygpO1xuICBhcHAudXNlKGV4cHJlc3MuanNvbigpKTtcbiAgYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogdHJ1ZSB9KSk7XG4gIFxuICAvLyBSZWdpc3RlciBhbGwgcm91dGVzXG4gIHJlZ2lzdGVyUm91dGVzKGFwcCk7XG4gIFxuICByZXR1cm4gYXBwO1xufTtcblxuZGVzY3JpYmUoJ0RlbW8gT3JnYW5pemF0aW9uIEludGVncmF0aW9uIFRlc3RzIHdpdGggUmVhbCBEYXRhJywgKCkgPT4ge1xuICBsZXQgYXBwOiBleHByZXNzLkFwcGxpY2F0aW9uO1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xuICB9KTtcblxuICBkZXNjcmliZSgnT3JnYW5pemF0aW9uIEFQSSBFbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBmZXRjaCBvcmdhbml6YXRpb25zIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvb3JnYW5pemF0aW9ucycpXG4gICAgICAgIC5leHBlY3QoKHJlcykgPT4ge1xuICAgICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlTGVzc1RoYW4oNTAwKTtcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCByZXR1cm4gc29tZSBkYXRhIG9yIGhhbmRsZSBhdXRoZW50aWNhdGlvbiBwcm9wZXJseVxuICAgICAgZXhwZWN0KFsyMDAsIDQwMSwgNDAzXS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZGVtbyBvcmdhbml6YXRpb24gcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFVzZSBkeW5hbWljIGxvb2t1cCBpbnN0ZWFkIG9mIGhhcmRjb2RlZCBJRCB0byBhdm9pZCBjb25mbGljdHNcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvZGVtby91c2VycycpXG4gICAgICAgIC5leHBlY3QoKHJlcykgPT4ge1xuICAgICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlTGVzc1RoYW4oNTAwKTtcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCByZXR1cm4gZGVtbyB1c2VycyBvciBoYW5kbGUgcHJvcGVybHkgKGRvZXNuJ3QgbW9kaWZ5IGRhdGEpXG4gICAgICBleHBlY3QoWzIwMCwgNDAxLCA0MDMsIDQwNF0uaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0J1aWxkaW5ncyBBUEkgRW5kcG9pbnRzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZmV0Y2ggYnVpbGRpbmdzIHN1Y2Nlc3NmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvYnVpbGRpbmdzJylcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KFsyMDAsIDQwMSwgNDAzXS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgc3BlY2lmaWMgYnVpbGRpbmcgcXVlcmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSAnZDA4NDM5MmYtZmFjYi00MGE2LTg2ODUtM2I0MGRjZGQ0YjY4JzsgLy8gS292ZW8gVG93ZXJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoYC9hcGkvYnVpbGRpbmdzLyR7YnVpbGRpbmdJZH1gKVxuICAgICAgICAuZXhwZWN0KChyZXMpID0+IHtcbiAgICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZUxlc3NUaGFuKDUwMCk7XG4gICAgICAgIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QoWzIwMCwgNDAxLCA0MDMsIDQwNF0uaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1VzZXJzIEFQSSBFbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdXNlciBhdXRoZW50aWNhdGlvbiBlbmRwb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3VzZXJzL21lJylcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gU2hvdWxkIGVpdGhlciByZXR1cm4gdXNlciBkYXRhIG9yIHJlcXVpcmUgYXV0aGVudGljYXRpb25cbiAgICAgIGV4cGVjdChbMjAwLCA0MDEsIDQwM10uaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0hlYWx0aCBDaGVjayBFbmRwb2ludHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXNwb25kIHRvIGhlYWx0aCBjaGVjaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvaGVhbHRoJylcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMjAwKTtcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoMjAwKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5KS50b0hhdmVQcm9wZXJ0eSgnc3RhdHVzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJlc3BvbmQgdG8gc3RhdHVzIGNoZWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9oZWFsdGgnKVxuICAgICAgICAuZXhwZWN0KChyZXMpID0+IHtcbiAgICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZUxlc3NUaGFuT3JFcXVhbCgyMDApO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KFsyMDAsIDUwM10uaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0RlbW8gRGF0YSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZGVtbyB1c2VycyBleGlzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFRlc3QgdGhhdCBkZW1vIHVzZXJzIGNhbiBiZSBxdWVyaWVkXG4gICAgICBjb25zdCBkZW1vVXNlckVtYWlsID0gJ2VtbWEuY290ZUBkZW1vLmNvbSc7XG4gICAgICBcbiAgICAgIC8vIFRyeSB0byBnZXQgdXNlciBpbmZvIC0gc2hvdWxkIGhhbmRsZSBhcHByb3ByaWF0ZWx5XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3VzZXJzJylcbiAgICAgICAgLnF1ZXJ5KHsgZW1haWw6IGRlbW9Vc2VyRW1haWwgfSlcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KFsyMDAsIDQwMSwgNDAzLCA0MDRdLmluY2x1ZGVzKHJlc3BvbnNlLnN0YXR1cykpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGRlbW8gb3JnYW5pemF0aW9uIHN0cnVjdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFZlcmlmeSB0aGF0IGRlbW8gb3JnYW5pemF0aW9uIGVuZHBvaW50cyBhcmUgYWNjZXNzaWJsZVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLmdldCgnL2FwaS9vcmdhbml6YXRpb25zJylcbiAgICAgICAgLmV4cGVjdCgocmVzKSA9PiB7XG4gICAgICAgICAgZXhwZWN0KHJlcy5zdGF0dXMpLnRvQmVMZXNzVGhhbig1MDApO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KFsyMDAsIDQwMSwgNDAzXS5pbmNsdWRlcyhyZXNwb25zZS5zdGF0dXMpKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52YWxpZCByb3V0ZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvbm9uZXhpc3RlbnQnKVxuICAgICAgICAuZXhwZWN0KChyZXMpID0+IHtcbiAgICAgICAgICBleHBlY3QocmVzLnN0YXR1cykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCg0MDQpO1xuICAgICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDQpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWFsZm9ybWVkIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvb3JnYW5pemF0aW9ucycpXG4gICAgICAgIC5zZW5kKHsgaW52YWxpZDogJ2RhdGEnIH0pXG4gICAgICAgIC5leHBlY3QoKHJlcykgPT4ge1xuICAgICAgICAgIGV4cGVjdChyZXMuc3RhdHVzKS50b0JlTGVzc1RoYW4oNTAwKTtcbiAgICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCByZWplY3Qgd2l0aCA0MDAvNDAxLzQwMyBidXQgbm90IGNyYXNoXG4gICAgICBleHBlY3QoWzQwMCwgNDAxLCA0MDMsIDQyMl0uaW5jbHVkZXMocmVzcG9uc2Uuc3RhdHVzKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=