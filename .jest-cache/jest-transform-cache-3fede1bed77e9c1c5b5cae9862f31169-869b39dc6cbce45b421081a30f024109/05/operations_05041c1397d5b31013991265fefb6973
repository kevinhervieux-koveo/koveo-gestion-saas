04264903d9b7322444cae5a22479229b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createBuilding = createBuilding;
exports.adjustResidenceCount = adjustResidenceCount;
exports.addResidencesAutomatically = addResidencesAutomatically;
exports.getResidencesForSelection = getResidencesForSelection;
exports.deleteSelectedResidences = deleteSelectedResidences;
exports.updateBuilding = updateBuilding;
exports.deleteBuilding = deleteBuilding;
exports.cascadeDeleteBuilding = cascadeDeleteBuilding;
exports.buildingExists = buildingExists;
const db_1 = require("../../db");
const schema_1 = require("@shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
const crypto_1 = __importDefault(require("crypto"));
/**
 * Creates a new building with auto-generated residences.
 * @param buildingData
 */
/**
 * CreateBuilding function.
 * @param buildingData
 * @returns Function result.
 */
async function createBuilding(buildingData) {
    const buildingId = crypto_1.default.randomUUID();
    const newBuilding = await db_1.db
        .insert(schema_1.buildings)
        .values({
        name: buildingData.name,
        address: buildingData.address || '',
        city: buildingData.city || '',
        province: buildingData.province || 'QC',
        postalCode: buildingData.postalCode || '',
        buildingType: buildingData.buildingType || 'condo',
        yearBuilt: buildingData.yearBuilt,
        totalUnits: buildingData.totalUnits || 0,
        totalFloors: buildingData.totalFloors,
        parkingSpaces: buildingData.parkingSpaces,
        storageSpaces: buildingData.storageSpaces,
        amenities: buildingData.amenities,
        managementCompany: buildingData.managementCompany,
        organizationId: buildingData.organizationId,
        isActive: true,
    })
        .returning();
    // Auto-generate residences if totalUnits is specified and <= 300
    if (buildingData.totalUnits && buildingData.totalUnits > 0 && buildingData.totalUnits <= 300) {
        try {
            const totalUnits = buildingData.totalUnits;
            const totalFloors = buildingData.totalFloors || 1;
            const unitsPerFloor = Math.ceil(totalUnits / totalFloors);
            const residencesToCreate = [];
            for (let unit = 1; unit <= totalUnits; unit++) {
                const floor = Math.ceil(unit / unitsPerFloor);
                const unitOnFloor = ((unit - 1) % unitsPerFloor) + 1;
                const unitNumber = `${floor}${unitOnFloor.toString().padStart(2, '0')}`;
                residencesToCreate.push({
                    buildingId: newBuilding[0].id,
                    unitNumber,
                    floor,
                    isActive: true,
                });
            }
            // Insert all residences at once
            const createdResidences = await db_1.db.insert(schema_1.residences).values(residencesToCreate).returning();
        }
        catch (___residenceError) {
            console.error('‚ö†Ô∏è Error auto-generating residences:', ___residenceError);
            // Don't fail the building creation if residence generation fails
        }
    }
    return newBuilding[0];
}
/**
 * Updates a building.
 * @param buildingId
 * @param buildingData
 */
/**
 * UpdateBuilding function.
 * @param buildingId
 * @param buildingData
 * @returns Function result.
 */
/**
 * Adjusts residence count when building totalUnits changes.
 * For increases: Auto-generates residences with names like 'unit 109'
 * For decreases: Returns list of deletable residences for user selection
 */
async function adjustResidenceCount(buildingId, organizationId, newTotalUnits, currentTotalUnits, totalFloors) {
    // Get current active residence count
    const currentActiveResidences = await db_1.db
        .select({ id: schema_1.residences.id, unitNumber: schema_1.residences.unitNumber })
        .from(schema_1.residences)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
    const currentActiveCount = currentActiveResidences.length;
    if (newTotalUnits > currentActiveCount) {
        // Need to add residences - do it automatically
        await addResidencesAutomatically(buildingId, newTotalUnits - currentActiveCount, totalFloors, currentActiveResidences);
        return { action: 'increased' };
    }
    else if (newTotalUnits < currentActiveCount) {
        // Need to reduce residences - return list for user selection
        const deletableResidences = await getResidencesForSelection(buildingId, currentActiveCount - newTotalUnits);
        return { action: 'decreased', residencesToSelect: deletableResidences };
    }
    return { action: 'none' };
}
/**
 * Automatically adds residences when building count increases
 */
async function addResidencesAutomatically(buildingId, residencesToAdd, totalFloors, existingResidences) {
    const existingUnitNumbers = new Set(existingResidences.map(r => r.unitNumber));
    const unitsPerFloor = Math.ceil((existingResidences.length + residencesToAdd) / totalFloors);
    const residencesToCreate = [];
    let unitCounter = 1;
    let created = 0;
    // Find available unit numbers and create residences
    while (created < residencesToAdd) {
        const floor = Math.ceil(unitCounter / unitsPerFloor);
        const unitOnFloor = ((unitCounter - 1) % unitsPerFloor) + 1;
        const unitNumber = `${floor}${unitOnFloor.toString().padStart(2, '0')}`;
        if (!existingUnitNumbers.has(unitNumber)) {
            residencesToCreate.push({
                buildingId,
                unitNumber,
                floor,
                isActive: true,
            });
            existingUnitNumbers.add(unitNumber);
            created++;
        }
        unitCounter++;
    }
    if (residencesToCreate.length > 0) {
        await db_1.db.insert(schema_1.residences).values(residencesToCreate);
        console.log(`‚úÖ Auto-created ${residencesToCreate.length} residences for building ${buildingId}`);
    }
}
/**
 * Gets list of residences that can be selected for deletion
 * Returns residences with metadata about documents and users
 */
async function getResidencesForSelection(buildingId, maxToSelect) {
    const allActiveResidences = await db_1.db
        .select({
        id: schema_1.residences.id,
        unitNumber: schema_1.residences.unitNumber,
        floor: schema_1.residences.floor
    })
        .from(schema_1.residences)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)))
        .orderBy(schema_1.residences.unitNumber);
    // Check each residence for documents and user relationships
    const residenceDetails = await Promise.all(allActiveResidences.map(async (residence) => {
        // Check for documents
        const docs = await db_1.db
            .select({ id: schema_1.documents.id })
            .from(schema_1.documents)
            .where((0, drizzle_orm_1.eq)(schema_1.documents.residenceId, residence.id))
            .limit(1);
        // Check for active user relationships
        const userRels = await db_1.db
            .select({ id: schema_1.userResidences.id })
            .from(schema_1.userResidences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, residence.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
            .limit(1);
        return {
            id: residence.id,
            unitNumber: residence.unitNumber,
            hasDocuments: docs.length > 0,
            hasUsers: userRels.length > 0,
        };
    }));
    // Prioritize empty residences first (no documents or users)
    return residenceDetails.sort((a, b) => {
        const aScore = (a.hasDocuments ? 1 : 0) + (a.hasUsers ? 1 : 0);
        const bScore = (b.hasDocuments ? 1 : 0) + (b.hasUsers ? 1 : 0);
        return aScore - bScore; // Empty residences first
    });
}
/**
 * Deletes selected residences and their related documents
 * Only admins can call this function
 */
async function deleteSelectedResidences(buildingId, residenceIds, userRole) {
    if (userRole !== 'admin') {
        throw new Error('Only admins can delete residences');
    }
    // Count documents that will be deleted
    const documentsToDelete = await db_1.db
        .select({ id: schema_1.documents.id })
        .from(schema_1.documents)
        .where((0, drizzle_orm_1.inArray)(schema_1.documents.residenceId, residenceIds));
    // Delete documents (hard delete since no isActive field)
    await db_1.db
        .delete(schema_1.documents)
        .where((0, drizzle_orm_1.inArray)(schema_1.documents.residenceId, residenceIds));
    // Soft delete user-residence relationships
    await db_1.db
        .update(schema_1.userResidences)
        .set({ isActive: false, updatedAt: new Date() })
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema_1.userResidences.residenceId, residenceIds), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
    // Soft delete residences
    await db_1.db
        .update(schema_1.residences)
        .set({ isActive: false, updatedAt: new Date() })
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds), (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId)));
    console.log(`üóëÔ∏è Deleted ${residenceIds.length} residences and ${documentsToDelete.length} documents for building ${buildingId}`);
    return {
        deletedCount: residenceIds.length,
        documentsDeleted: documentsToDelete.length
    };
}
async function updateBuilding(buildingId, buildingData) {
    // Get current building to check for residence count changes
    const currentBuilding = await db_1.db
        .select({ totalUnits: schema_1.buildings.totalUnits, totalFloors: schema_1.buildings.totalFloors, organizationId: schema_1.buildings.organizationId })
        .from(schema_1.buildings)
        .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
        .limit(1);
    if (currentBuilding.length === 0) {
        throw new Error('Building not found');
    }
    const updatedBuilding = await db_1.db
        .update(schema_1.buildings)
        .set({
        name: buildingData.name,
        address: buildingData.address || '',
        city: buildingData.city || '',
        province: buildingData.province || 'QC',
        postalCode: buildingData.postalCode || '',
        buildingType: buildingData.buildingType || 'condo',
        yearBuilt: buildingData.yearBuilt,
        totalUnits: buildingData.totalUnits || 0,
        totalFloors: buildingData.totalFloors,
        parkingSpaces: buildingData.parkingSpaces,
        storageSpaces: buildingData.storageSpaces,
        amenities: buildingData.amenities ? JSON.stringify(buildingData.amenities) : null,
        managementCompany: buildingData.managementCompany,
        organizationId: buildingData.organizationId,
        updatedAt: new Date(),
    })
        .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
        .returning();
    // Handle residence count changes if totalUnits changed
    if (buildingData.totalUnits && buildingData.totalUnits !== currentBuilding[0].totalUnits) {
        await adjustResidenceCount(buildingId, currentBuilding[0].organizationId, buildingData.totalUnits, currentBuilding[0].totalUnits, buildingData.totalFloors || currentBuilding[0].totalFloors || 1);
    }
    return updatedBuilding[0];
}
/**
 * Soft deletes a building.
 * @param buildingId
 */
/**
 * DeleteBuilding function.
 * @param buildingId
 * @returns Function result.
 */
async function deleteBuilding(buildingId) {
    const deletedBuilding = await db_1.db
        .update(schema_1.buildings)
        .set({
        isActive: false,
        updatedAt: new Date(),
    })
        .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
        .returning();
    return deletedBuilding[0];
}
/**
 * Performs cascade delete of a building and all related entities.
 * @param buildingId
 */
/**
 * CascadeDeleteBuilding function.
 * @param buildingId
 * @returns Function result.
 */
async function cascadeDeleteBuilding(buildingId) {
    // Check if building exists
    const building = await db_1.db
        .select({ id: schema_1.buildings.id, name: schema_1.buildings.name })
        .from(schema_1.buildings)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
        .limit(1);
    if (building.length === 0) {
        throw new Error('Building not found');
    }
    // Start transaction for cascading delete
    await db_1.db.transaction(async (tx) => {
        // 1. Get all residences in this building
        const buildingResidences = await tx
            .select({ id: schema_1.residences.id })
            .from(schema_1.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
        const residenceIds = buildingResidences.map((r) => r.id);
        if (residenceIds.length > 0) {
            // 2. Delete documents associated with building or its residences
            // Note: Document table uses boolean flags, not foreign keys
            await tx.delete(schema_1.documents).where((0, drizzle_orm_1.inArray)(schema_1.documents.residenceId, residenceIds));
            // 3. Soft delete user-residence relationships
            await tx
                .update(schema_1.userResidences)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.inArray)(schema_1.userResidences.residenceId, residenceIds));
            // 4. Find and soft delete orphaned users (users who now have no active relationships)
            const orphanedUsers = await tx
                .select({ id: schema_1.users.id })
                .from(schema_1.users)
                .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userOrganizations.userId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userResidences.userId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userOrganizations.userId), (0, drizzle_orm_1.isNull)(schema_1.userResidences.userId)));
            if (orphanedUsers.length > 0) {
                const orphanedUserIds = orphanedUsers.map((u) => u.id);
                await tx
                    .update(schema_1.users)
                    .set({ isActive: false, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.inArray)(schema_1.users.id, orphanedUserIds));
            }
            // 5. Soft delete residences
            await tx
                .update(schema_1.residences)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds));
        }
        // 6. Finally, soft delete the building
        await tx
            .update(schema_1.buildings)
            .set({ isActive: false, updatedAt: new Date() })
            .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
    });
    return building[0];
}
/**
 * Checks if a building exists and is active.
 * @param buildingId
 */
/**
 * BuildingExists function.
 * @param buildingId
 * @returns Function result.
 */
async function buildingExists(buildingId) {
    const result = await db_1.db
        .select({ id: schema_1.buildings.id })
        .from(schema_1.buildings)
        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
        .limit(1);
    return result.length > 0;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2J1aWxkaW5ncy9vcGVyYXRpb25zLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBaURBLHdDQXNEQztBQW1CRCxvREE2QkM7QUFLRCxnRUFvQ0M7QUFNRCw4REE4Q0M7QUFNRCw0REFzQ0M7QUFFRCx3Q0E4Q0M7QUFXRCx3Q0FXQztBQVdELHNEQTRFQztBQVdELHdDQVFDO0FBaGRELGlDQUE4QjtBQUM5QiwyQ0FPd0I7QUFDeEIsNkNBQXVEO0FBQ3ZELG9EQUE0QjtBQThCNUI7OztHQUdHO0FBQ0g7Ozs7R0FJRztBQUNJLEtBQUssVUFBVSxjQUFjLENBQUMsWUFBZ0M7SUFDbkUsTUFBTSxVQUFVLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUV2QyxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7U0FDekIsTUFBTSxDQUFDLGtCQUFTLENBQUM7U0FDakIsTUFBTSxDQUFDO1FBQ04sSUFBSSxFQUFFLFlBQVksQ0FBQyxJQUFJO1FBQ3ZCLE9BQU8sRUFBRSxZQUFZLENBQUMsT0FBTyxJQUFJLEVBQUU7UUFDbkMsSUFBSSxFQUFFLFlBQVksQ0FBQyxJQUFJLElBQUksRUFBRTtRQUM3QixRQUFRLEVBQUUsWUFBWSxDQUFDLFFBQVEsSUFBSSxJQUFJO1FBQ3ZDLFVBQVUsRUFBRSxZQUFZLENBQUMsVUFBVSxJQUFJLEVBQUU7UUFDekMsWUFBWSxFQUFHLFlBQVksQ0FBQyxZQUFpRCxJQUFJLE9BQU87UUFDeEYsU0FBUyxFQUFFLFlBQVksQ0FBQyxTQUFTO1FBQ2pDLFVBQVUsRUFBRSxZQUFZLENBQUMsVUFBVSxJQUFJLENBQUM7UUFDeEMsV0FBVyxFQUFFLFlBQVksQ0FBQyxXQUFXO1FBQ3JDLGFBQWEsRUFBRSxZQUFZLENBQUMsYUFBYTtRQUN6QyxhQUFhLEVBQUUsWUFBWSxDQUFDLGFBQWE7UUFDekMsU0FBUyxFQUFFLFlBQVksQ0FBQyxTQUFTO1FBQ2pDLGlCQUFpQixFQUFFLFlBQVksQ0FBQyxpQkFBaUI7UUFDakQsY0FB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QztJQUN6QyxDQUFDLENBQUMsQ0FBQztJQUVILE9BQU8sUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ3JCLENBQUM7QUFFRDs7O0dBR0c7QUFDSDs7OztHQUlHO0FBQ0ksS0FBSyxVQUFVLGNBQWMsQ0FBQyxVQUFrQjtJQUNyRCxNQUFNLE1BQU0sR0FBRyxNQUFNLE9BQUU7U0FDcEIsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLGtCQUFTLENBQUMsRUFBRSxFQUFFLENBQUM7U0FDNUIsSUFBSSxDQUFDLGtCQUFTLENBQUM7U0FDZixLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztTQUN0RSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFWixPQUFPLE1BQU0sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDO0FBQzNCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2J1aWxkaW5ncy9vcGVyYXRpb25zLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRiIH0gZnJvbSAnLi4vLi4vZGInO1xuaW1wb3J0IHtcbiAgYnVpbGRpbmdzLFxuICByZXNpZGVuY2VzLFxuICB1c2VyUmVzaWRlbmNlcyxcbiAgdXNlcnMsXG4gIHVzZXJPcmdhbml6YXRpb25zLFxuICBkb2N1bWVudHMsXG59IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQsIGluQXJyYXksIGlzTnVsbCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuLyoqXG4gKiBCdWlsZGluZyBjcmVhdGlvbiBkYXRhLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkaW5nQ3JlYXRlRGF0YSB7XG4gIG5hbWU6IHN0cmluZztcbiAgYWRkcmVzcz86IHN0cmluZztcbiAgY2l0eT86IHN0cmluZztcbiAgcHJvdmluY2U/OiBzdHJpbmc7XG4gIHBvc3RhbENvZGU/OiBzdHJpbmc7XG4gIGJ1aWxkaW5nVHlwZT86ICdhcGFydG1lbnQnIHwgJ2NvbmRvJyB8ICdyZW50YWwnO1xuICB5ZWFyQnVpbHQ/OiBudW1iZXI7XG4gIHRvdGFsVW5pdHM/OiBudW1iZXI7XG4gIHRvdGFsRmxvb3JzPzogbnVtYmVyO1xuICBwYXJraW5nU3BhY2VzPzogbnVtYmVyO1xuICBzdG9yYWdlU3BhY2VzPzogbnVtYmVyO1xuICBhbWVuaXRpZXM/OiBhbnk7XG4gIG1hbmFnZW1lbnRDb21wYW55Pzogc3RyaW5nO1xuICBvcmdhbml6YXRpb25JZDogc3RyaW5nO1xufVxuXG4vKipcbiAqIEJ1aWxkaW5nIHVwZGF0ZSBkYXRhLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkaW5nVXBkYXRlRGF0YSBleHRlbmRzIFBhcnRpYWw8QnVpbGRpbmdDcmVhdGVEYXRhPiB7XG4gIG5hbWU6IHN0cmluZztcbiAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZztcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGJ1aWxkaW5nIHdpdGggYXV0by1nZW5lcmF0ZWQgcmVzaWRlbmNlcy5cbiAqIEBwYXJhbSBidWlsZGluZ0RhdGFcbiAqL1xuLyoqXG4gKiBDcmVhdGVCdWlsZGluZyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBidWlsZGluZ0RhdGFcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUJ1aWxkaW5nKGJ1aWxkaW5nRGF0YTogQnVpbGRpbmdDcmVhdGVEYXRhKSB7XG4gIGNvbnN0IGJ1aWxkaW5nSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuXG4gIGNvbnN0IG5ld0J1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAuaW5zZXJ0KGJ1aWxkaW5ncylcbiAgICAudmFsdWVzKHtcbiAgICAgIG5hbWU6IGJ1aWxkaW5nRGF0YS5uYW1lLFxuICAgICAgYWRkcmVzczogYnVpbGRpbmdEYXRhLmFkZHJlc3MgfHwgJycsXG4gICAgICBjaXR5OiBidWlsZGluZ0RhdGEuY2l0eSB8fCAnJyxcbiAgICAgIHByb3ZpbmNlOiBidWlsZGluZ0RhdGEucHJvdmluY2UgfHwgJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5nRGF0YS5wb3N0YWxDb2RlIHx8ICcnLFxuICAgICAgYnVpbGRpbmdUeXBlOiAoYnVpbGRpbmdEYXRhLmJ1aWxkaW5nVHlwZSBhcyAnYXBhcnRtZW50JyB8ICdjb25kbycgfCAncmVudGFsJykgfHwgJ2NvbmRvJyxcbiAgICAgIHllYXJCdWlsdDogYnVpbGRpbmdEYXRhLnllYXJCdWlsdCxcbiAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzIHx8IDAsXG4gICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzLFxuICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdEYXRhLnBhcmtpbmdTcGFjZXMsXG4gICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ0RhdGEuc3RvcmFnZVNwYWNlcyxcbiAgICAgIGFtZW5pdGllczogYnVpbGRpbmdEYXRhLmFtZW5pdGllcyxcbiAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZ0RhdGEubWFuYWdlbWVudENvbXBhbnksXG4gICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdEYXRhLm9yZ2FuaXphdGlvbklkLFxuICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgfSlcbiAgICAucmV0dXJuaW5nKCk7XG5cbiAgLy8gQXV0by1nZW5lcmF0ZSByZXNpZGVuY2VzIGlmIHRvdGFsVW5pdHMgaXMgc3BlY2lmaWVkIGFuZCA8PSAzMDBcbiAgaWYgKGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzICYmIGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzID4gMCAmJiBidWlsZGluZ0RhdGEudG90YWxVbml0cyA8PSAzMDApIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG90YWxVbml0cyA9IGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzO1xuICAgICAgY29uc3QgdG90YWxGbG9vcnMgPSBidWlsZGluZ0RhdGEudG90YWxGbG9vcnMgfHwgMTtcbiAgICAgIGNvbnN0IHVuaXRzUGVyRmxvb3IgPSBNYXRoLmNlaWwodG90YWxVbml0cyAvIHRvdGFsRmxvb3JzKTtcblxuICAgICAgY29uc3QgcmVzaWRlbmNlc1RvQ3JlYXRlID0gW107XG4gICAgICBmb3IgKGxldCB1bml0ID0gMTsgdW5pdCA8PSB0b3RhbFVuaXRzOyB1bml0KyspIHtcbiAgICAgICAgY29uc3QgZmxvb3IgPSBNYXRoLmNlaWwodW5pdCAvIHVuaXRzUGVyRmxvb3IpO1xuICAgICAgICBjb25zdCB1bml0T25GbG9vciA9ICgodW5pdCAtIDEpICUgdW5pdHNQZXJGbG9vcikgKyAxO1xuICAgICAgICBjb25zdCB1bml0TnVtYmVyID0gYCR7Zmxvb3J9JHt1bml0T25GbG9vci50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDtcblxuICAgICAgICByZXNpZGVuY2VzVG9DcmVhdGUucHVzaCh7XG4gICAgICAgICAgYnVpbGRpbmdJZDogbmV3QnVpbGRpbmdbMF0uaWQsXG4gICAgICAgICAgdW5pdE51bWJlcixcbiAgICAgICAgICBmbG9vcixcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEluc2VydCBhbGwgcmVzaWRlbmNlcyBhdCBvbmNlXG4gICAgICBjb25zdCBjcmVhdGVkUmVzaWRlbmNlcyA9IGF3YWl0IGRiLmluc2VydChyZXNpZGVuY2VzKS52YWx1ZXMocmVzaWRlbmNlc1RvQ3JlYXRlKS5yZXR1cm5pbmcoKTtcbiAgICB9IGNhdGNoIChfX19yZXNpZGVuY2VFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4pqg77iPIEVycm9yIGF1dG8tZ2VuZXJhdGluZyByZXNpZGVuY2VzOicsIF9fX3Jlc2lkZW5jZUVycm9yKTtcbiAgICAgIC8vIERvbid0IGZhaWwgdGhlIGJ1aWxkaW5nIGNyZWF0aW9uIGlmIHJlc2lkZW5jZSBnZW5lcmF0aW9uIGZhaWxzXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG5ld0J1aWxkaW5nWzBdO1xufVxuXG4vKipcbiAqIFVwZGF0ZXMgYSBidWlsZGluZy5cbiAqIEBwYXJhbSBidWlsZGluZ0lkXG4gKiBAcGFyYW0gYnVpbGRpbmdEYXRhXG4gKi9cbi8qKlxuICogVXBkYXRlQnVpbGRpbmcgZnVuY3Rpb24uXG4gKiBAcGFyYW0gYnVpbGRpbmdJZFxuICogQHBhcmFtIGJ1aWxkaW5nRGF0YVxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5cbi8qKlxuICogQWRqdXN0cyByZXNpZGVuY2UgY291bnQgd2hlbiBidWlsZGluZyB0b3RhbFVuaXRzIGNoYW5nZXMuXG4gKiBGb3IgaW5jcmVhc2VzOiBBdXRvLWdlbmVyYXRlcyByZXNpZGVuY2VzIHdpdGggbmFtZXMgbGlrZSAndW5pdCAxMDknXG4gKiBGb3IgZGVjcmVhc2VzOiBSZXR1cm5zIGxpc3Qgb2YgZGVsZXRhYmxlIHJlc2lkZW5jZXMgZm9yIHVzZXIgc2VsZWN0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGp1c3RSZXNpZGVuY2VDb3VudChcbiAgYnVpbGRpbmdJZDogc3RyaW5nLFxuICBvcmdhbml6YXRpb25JZDogc3RyaW5nLFxuICBuZXdUb3RhbFVuaXRzOiBudW1iZXIsXG4gIGN1cnJlbnRUb3RhbFVuaXRzOiBudW1iZXIsXG4gIHRvdGFsRmxvb3JzOiBudW1iZXJcbik6IFByb21pc2U8eyBcbiAgYWN0aW9uOiAnaW5jcmVhc2VkJyB8ICdkZWNyZWFzZWQnIHwgJ25vbmUnLFxuICByZXNpZGVuY2VzVG9TZWxlY3Q/OiB7IGlkOiBzdHJpbmcsIHVuaXROdW1iZXI6IHN0cmluZywgaGFzRG9jdW1lbnRzOiBib29sZWFuLCBoYXNVc2VyczogYm9vbGVhbiB9W11cbn0+IHtcbiAgLy8gR2V0IGN1cnJlbnQgYWN0aXZlIHJlc2lkZW5jZSBjb3VudFxuICBjb25zdCBjdXJyZW50QWN0aXZlUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlkOiByZXNpZGVuY2VzLmlkLCB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIgfSlcbiAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgIC53aGVyZShhbmQoZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICBjb25zdCBjdXJyZW50QWN0aXZlQ291bnQgPSBjdXJyZW50QWN0aXZlUmVzaWRlbmNlcy5sZW5ndGg7XG5cbiAgaWYgKG5ld1RvdGFsVW5pdHMgPiBjdXJyZW50QWN0aXZlQ291bnQpIHtcbiAgICAvLyBOZWVkIHRvIGFkZCByZXNpZGVuY2VzIC0gZG8gaXQgYXV0b21hdGljYWxseVxuICAgIGF3YWl0IGFkZFJlc2lkZW5jZXNBdXRvbWF0aWNhbGx5KGJ1aWxkaW5nSWQsIG5ld1RvdGFsVW5pdHMgLSBjdXJyZW50QWN0aXZlQ291bnQsIHRvdGFsRmxvb3JzLCBjdXJyZW50QWN0aXZlUmVzaWRlbmNlcyk7XG4gICAgcmV0dXJuIHsgYWN0aW9uOiAnaW5jcmVhc2VkJyB9O1xuICB9IGVsc2UgaWYgKG5ld1RvdGFsVW5pdHMgPCBjdXJyZW50QWN0aXZlQ291bnQpIHtcbiAgICAvLyBOZWVkIHRvIHJlZHVjZSByZXNpZGVuY2VzIC0gcmV0dXJuIGxpc3QgZm9yIHVzZXIgc2VsZWN0aW9uXG4gICAgY29uc3QgZGVsZXRhYmxlUmVzaWRlbmNlcyA9IGF3YWl0IGdldFJlc2lkZW5jZXNGb3JTZWxlY3Rpb24oYnVpbGRpbmdJZCwgY3VycmVudEFjdGl2ZUNvdW50IC0gbmV3VG90YWxVbml0cyk7XG4gICAgcmV0dXJuIHsgYWN0aW9uOiAnZGVjcmVhc2VkJywgcmVzaWRlbmNlc1RvU2VsZWN0OiBkZWxldGFibGVSZXNpZGVuY2VzIH07XG4gIH1cblxuICByZXR1cm4geyBhY3Rpb246ICdub25lJyB9O1xufVxuXG4vKipcbiAqIEF1dG9tYXRpY2FsbHkgYWRkcyByZXNpZGVuY2VzIHdoZW4gYnVpbGRpbmcgY291bnQgaW5jcmVhc2VzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhZGRSZXNpZGVuY2VzQXV0b21hdGljYWxseShcbiAgYnVpbGRpbmdJZDogc3RyaW5nLFxuICByZXNpZGVuY2VzVG9BZGQ6IG51bWJlcixcbiAgdG90YWxGbG9vcnM6IG51bWJlcixcbiAgZXhpc3RpbmdSZXNpZGVuY2VzOiB7IGlkOiBzdHJpbmcsIHVuaXROdW1iZXI6IHN0cmluZyB9W11cbik6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBleGlzdGluZ1VuaXROdW1iZXJzID0gbmV3IFNldChleGlzdGluZ1Jlc2lkZW5jZXMubWFwKHIgPT4gci51bml0TnVtYmVyKSk7XG4gIGNvbnN0IHVuaXRzUGVyRmxvb3IgPSBNYXRoLmNlaWwoKGV4aXN0aW5nUmVzaWRlbmNlcy5sZW5ndGggKyByZXNpZGVuY2VzVG9BZGQpIC8gdG90YWxGbG9vcnMpO1xuICBcbiAgY29uc3QgcmVzaWRlbmNlc1RvQ3JlYXRlID0gW107XG4gIGxldCB1bml0Q291bnRlciA9IDE7XG4gIGxldCBjcmVhdGVkID0gMDtcblxuICAvLyBGaW5kIGF2YWlsYWJsZSB1bml0IG51bWJlcnMgYW5kIGNyZWF0ZSByZXNpZGVuY2VzXG4gIHdoaWxlIChjcmVhdGVkIDwgcmVzaWRlbmNlc1RvQWRkKSB7XG4gICAgY29uc3QgZmxvb3IgPSBNYXRoLmNlaWwodW5pdENvdW50ZXIgLyB1bml0c1BlckZsb29yKTtcbiAgICBjb25zdCB1bml0T25GbG9vciA9ICgodW5pdENvdW50ZXIgLSAxKSAlIHVuaXRzUGVyRmxvb3IpICsgMTtcbiAgICBjb25zdCB1bml0TnVtYmVyID0gYCR7Zmxvb3J9JHt1bml0T25GbG9vci50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDtcblxuICAgIGlmICghZXhpc3RpbmdVbml0TnVtYmVycy5oYXModW5pdE51bWJlcikpIHtcbiAgICAgIHJlc2lkZW5jZXNUb0NyZWF0ZS5wdXNoKHtcbiAgICAgICAgYnVpbGRpbmdJZCxcbiAgICAgICAgdW5pdE51bWJlcixcbiAgICAgICAgZmxvb3IsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBleGlzdGluZ1VuaXROdW1iZXJzLmFkZCh1bml0TnVtYmVyKTtcbiAgICAgIGNyZWF0ZWQrKztcbiAgICB9XG4gICAgdW5pdENvdW50ZXIrKztcbiAgfVxuXG4gIGlmIChyZXNpZGVuY2VzVG9DcmVhdGUubGVuZ3RoID4gMCkge1xuICAgIGF3YWl0IGRiLmluc2VydChyZXNpZGVuY2VzKS52YWx1ZXMocmVzaWRlbmNlc1RvQ3JlYXRlKTtcbiAgICBjb25zb2xlLmxvZyhg4pyFIEF1dG8tY3JlYXRlZCAke3Jlc2lkZW5jZXNUb0NyZWF0ZS5sZW5ndGh9IHJlc2lkZW5jZXMgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gKTtcbiAgfVxufVxuXG4vKipcbiAqIEdldHMgbGlzdCBvZiByZXNpZGVuY2VzIHRoYXQgY2FuIGJlIHNlbGVjdGVkIGZvciBkZWxldGlvblxuICogUmV0dXJucyByZXNpZGVuY2VzIHdpdGggbWV0YWRhdGEgYWJvdXQgZG9jdW1lbnRzIGFuZCB1c2Vyc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0UmVzaWRlbmNlc0ZvclNlbGVjdGlvbihcbiAgYnVpbGRpbmdJZDogc3RyaW5nLFxuICBtYXhUb1NlbGVjdDogbnVtYmVyXG4pOiBQcm9taXNlPHsgaWQ6IHN0cmluZywgdW5pdE51bWJlcjogc3RyaW5nLCBoYXNEb2N1bWVudHM6IGJvb2xlYW4sIGhhc1VzZXJzOiBib29sZWFuIH1bXT4ge1xuICBjb25zdCBhbGxBY3RpdmVSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHsgXG4gICAgICBpZDogcmVzaWRlbmNlcy5pZCwgXG4gICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICBmbG9vcjogcmVzaWRlbmNlcy5mbG9vciBcbiAgICB9KVxuICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgLndoZXJlKGFuZChlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBlcShyZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgLm9yZGVyQnkocmVzaWRlbmNlcy51bml0TnVtYmVyKTtcblxuICAvLyBDaGVjayBlYWNoIHJlc2lkZW5jZSBmb3IgZG9jdW1lbnRzIGFuZCB1c2VyIHJlbGF0aW9uc2hpcHNcbiAgY29uc3QgcmVzaWRlbmNlRGV0YWlscyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgIGFsbEFjdGl2ZVJlc2lkZW5jZXMubWFwKGFzeW5jIChyZXNpZGVuY2UpID0+IHtcbiAgICAgIC8vIENoZWNrIGZvciBkb2N1bWVudHNcbiAgICAgIGNvbnN0IGRvY3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgaWQ6IGRvY3VtZW50cy5pZCB9KVxuICAgICAgICAuZnJvbShkb2N1bWVudHMpXG4gICAgICAgIC53aGVyZShlcShkb2N1bWVudHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZS5pZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgLy8gQ2hlY2sgZm9yIGFjdGl2ZSB1c2VyIHJlbGF0aW9uc2hpcHNcbiAgICAgIGNvbnN0IHVzZXJSZWxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGlkOiB1c2VyUmVzaWRlbmNlcy5pZCB9KVxuICAgICAgICAuZnJvbSh1c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGFuZChlcSh1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlLmlkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBpZDogcmVzaWRlbmNlLmlkLFxuICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2UudW5pdE51bWJlcixcbiAgICAgICAgaGFzRG9jdW1lbnRzOiBkb2NzLmxlbmd0aCA+IDAsXG4gICAgICAgIGhhc1VzZXJzOiB1c2VyUmVscy5sZW5ndGggPiAwLFxuICAgICAgfTtcbiAgICB9KVxuICApO1xuXG4gIC8vIFByaW9yaXRpemUgZW1wdHkgcmVzaWRlbmNlcyBmaXJzdCAobm8gZG9jdW1lbnRzIG9yIHVzZXJzKVxuICByZXR1cm4gcmVzaWRlbmNlRGV0YWlscy5zb3J0KChhLCBiKSA9PiB7XG4gICAgY29uc3QgYVNjb3JlID0gKGEuaGFzRG9jdW1lbnRzID8gMSA6IDApICsgKGEuaGFzVXNlcnMgPyAxIDogMCk7XG4gICAgY29uc3QgYlNjb3JlID0gKGIuaGFzRG9jdW1lbnRzID8gMSA6IDApICsgKGIuaGFzVXNlcnMgPyAxIDogMCk7XG4gICAgcmV0dXJuIGFTY29yZSAtIGJTY29yZTsgLy8gRW1wdHkgcmVzaWRlbmNlcyBmaXJzdFxuICB9KTtcbn1cblxuLyoqXG4gKiBEZWxldGVzIHNlbGVjdGVkIHJlc2lkZW5jZXMgYW5kIHRoZWlyIHJlbGF0ZWQgZG9jdW1lbnRzXG4gKiBPbmx5IGFkbWlucyBjYW4gY2FsbCB0aGlzIGZ1bmN0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVTZWxlY3RlZFJlc2lkZW5jZXMoXG4gIGJ1aWxkaW5nSWQ6IHN0cmluZyxcbiAgcmVzaWRlbmNlSWRzOiBzdHJpbmdbXSxcbiAgdXNlclJvbGU6IHN0cmluZ1xuKTogUHJvbWlzZTx7IGRlbGV0ZWRDb3VudDogbnVtYmVyLCBkb2N1bWVudHNEZWxldGVkOiBudW1iZXIgfT4ge1xuICBpZiAodXNlclJvbGUgIT09ICdhZG1pbicpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ09ubHkgYWRtaW5zIGNhbiBkZWxldGUgcmVzaWRlbmNlcycpO1xuICB9XG5cbiAgLy8gQ291bnQgZG9jdW1lbnRzIHRoYXQgd2lsbCBiZSBkZWxldGVkXG4gIGNvbnN0IGRvY3VtZW50c1RvRGVsZXRlID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHsgaWQ6IGRvY3VtZW50cy5pZCB9KVxuICAgIC5mcm9tKGRvY3VtZW50cylcbiAgICAud2hlcmUoaW5BcnJheShkb2N1bWVudHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkcykpO1xuXG4gIC8vIERlbGV0ZSBkb2N1bWVudHMgKGhhcmQgZGVsZXRlIHNpbmNlIG5vIGlzQWN0aXZlIGZpZWxkKVxuICBhd2FpdCBkYlxuICAgIC5kZWxldGUoZG9jdW1lbnRzKVxuICAgIC53aGVyZShpbkFycmF5KGRvY3VtZW50cy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWRzKSk7XG5cbiAgLy8gU29mdCBkZWxldGUgdXNlci1yZXNpZGVuY2UgcmVsYXRpb25zaGlwc1xuICBhd2FpdCBkYlxuICAgIC51cGRhdGUodXNlclJlc2lkZW5jZXMpXG4gICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgLndoZXJlKGFuZChpbkFycmF5KHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZHMpLCBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAvLyBTb2Z0IGRlbGV0ZSByZXNpZGVuY2VzXG4gIGF3YWl0IGRiXG4gICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgIC53aGVyZShhbmQoaW5BcnJheShyZXNpZGVuY2VzLmlkLCByZXNpZGVuY2VJZHMpLCBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpKSk7XG5cbiAgY29uc29sZS5sb2coYPCfl5HvuI8gRGVsZXRlZCAke3Jlc2lkZW5jZUlkcy5sZW5ndGh9IHJlc2lkZW5jZXMgYW5kICR7ZG9jdW1lbnRzVG9EZWxldGUubGVuZ3RofSBkb2N1bWVudHMgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZGVsZXRlZENvdW50OiByZXNpZGVuY2VJZHMubGVuZ3RoLFxuICAgIGRvY3VtZW50c0RlbGV0ZWQ6IGRvY3VtZW50c1RvRGVsZXRlLmxlbmd0aFxuICB9O1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdXBkYXRlQnVpbGRpbmcoYnVpbGRpbmdJZDogc3RyaW5nLCBidWlsZGluZ0RhdGE6IEJ1aWxkaW5nVXBkYXRlRGF0YSkge1xuICAvLyBHZXQgY3VycmVudCBidWlsZGluZyB0byBjaGVjayBmb3IgcmVzaWRlbmNlIGNvdW50IGNoYW5nZXNcbiAgY29uc3QgY3VycmVudEJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAuc2VsZWN0KHsgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQgfSlcbiAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgLmxpbWl0KDEpO1xuXG4gIGlmIChjdXJyZW50QnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdCdWlsZGluZyBub3QgZm91bmQnKTtcbiAgfVxuXG4gIGNvbnN0IHVwZGF0ZWRCdWlsZGluZyA9IGF3YWl0IGRiXG4gICAgLnVwZGF0ZShidWlsZGluZ3MpXG4gICAgLnNldCh7XG4gICAgICBuYW1lOiBidWlsZGluZ0RhdGEubmFtZSxcbiAgICAgIGFkZHJlc3M6IGJ1aWxkaW5nRGF0YS5hZGRyZXNzIHx8ICcnLFxuICAgICAgY2l0eTogYnVpbGRpbmdEYXRhLmNpdHkgfHwgJycsXG4gICAgICBwcm92aW5jZTogYnVpbGRpbmdEYXRhLnByb3ZpbmNlIHx8ICdRQycsXG4gICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ0RhdGEucG9zdGFsQ29kZSB8fCAnJyxcbiAgICAgIGJ1aWxkaW5nVHlwZTogKGJ1aWxkaW5nRGF0YS5idWlsZGluZ1R5cGUgYXMgJ2FwYXJ0bWVudCcgfCAnY29uZG8nIHwgJ3JlbnRhbCcpIHx8ICdjb25kbycsXG4gICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5nRGF0YS55ZWFyQnVpbHQsXG4gICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ0RhdGEudG90YWxVbml0cyB8fCAwLFxuICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5nRGF0YS50b3RhbEZsb29ycyxcbiAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5nRGF0YS5wYXJraW5nU3BhY2VzLFxuICAgICAgc3RvcmFnZVNwYWNlczogYnVpbGRpbmdEYXRhLnN0b3JhZ2VTcGFjZXMsXG4gICAgICBhbWVuaXRpZXM6IGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXMgPyBKU09OLnN0cmluZ2lmeShidWlsZGluZ0RhdGEuYW1lbml0aWVzKSA6IG51bGwsXG4gICAgICBtYW5hZ2VtZW50Q29tcGFueTogYnVpbGRpbmdEYXRhLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5nRGF0YS5vcmdhbml6YXRpb25JZCxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9KVxuICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKVxuICAgIC5yZXR1cm5pbmcoKTtcblxuICAvLyBIYW5kbGUgcmVzaWRlbmNlIGNvdW50IGNoYW5nZXMgaWYgdG90YWxVbml0cyBjaGFuZ2VkXG4gIGlmIChidWlsZGluZ0RhdGEudG90YWxVbml0cyAmJiBidWlsZGluZ0RhdGEudG90YWxVbml0cyAhPT0gY3VycmVudEJ1aWxkaW5nWzBdLnRvdGFsVW5pdHMpIHtcbiAgICBhd2FpdCBhZGp1c3RSZXNpZGVuY2VDb3VudChcbiAgICAgIGJ1aWxkaW5nSWQsXG4gICAgICBjdXJyZW50QnVpbGRpbmdbMF0ub3JnYW5pemF0aW9uSWQsXG4gICAgICBidWlsZGluZ0RhdGEudG90YWxVbml0cyxcbiAgICAgIGN1cnJlbnRCdWlsZGluZ1swXS50b3RhbFVuaXRzLFxuICAgICAgYnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzIHx8IGN1cnJlbnRCdWlsZGluZ1swXS50b3RhbEZsb29ycyB8fCAxXG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiB1cGRhdGVkQnVpbGRpbmdbMF07XG59XG5cbi8qKlxuICogU29mdCBkZWxldGVzIGEgYnVpbGRpbmcuXG4gKiBAcGFyYW0gYnVpbGRpbmdJZFxuICovXG4vKipcbiAqIERlbGV0ZUJ1aWxkaW5nIGZ1bmN0aW9uLlxuICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUJ1aWxkaW5nKGJ1aWxkaW5nSWQ6IHN0cmluZykge1xuICBjb25zdCBkZWxldGVkQnVpbGRpbmcgPSBhd2FpdCBkYlxuICAgIC51cGRhdGUoYnVpbGRpbmdzKVxuICAgIC5zZXQoe1xuICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgIH0pXG4gICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgLnJldHVybmluZygpO1xuXG4gIHJldHVybiBkZWxldGVkQnVpbGRpbmdbMF07XG59XG5cbi8qKlxuICogUGVyZm9ybXMgY2FzY2FkZSBkZWxldGUgb2YgYSBidWlsZGluZyBhbmQgYWxsIHJlbGF0ZWQgZW50aXRpZXMuXG4gKiBAcGFyYW0gYnVpbGRpbmdJZFxuICovXG4vKipcbiAqIENhc2NhZGVEZWxldGVCdWlsZGluZyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBidWlsZGluZ0lkXG4gKiBAcmV0dXJucyBGdW5jdGlvbiByZXN1bHQuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYXNjYWRlRGVsZXRlQnVpbGRpbmcoYnVpbGRpbmdJZDogc3RyaW5nKSB7XG4gIC8vIENoZWNrIGlmIGJ1aWxkaW5nIGV4aXN0c1xuICBjb25zdCBidWlsZGluZyA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQsIG5hbWU6IGJ1aWxkaW5ncy5uYW1lIH0pXG4gICAgLmZyb20oYnVpbGRpbmdzKVxuICAgIC53aGVyZShhbmQoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSwgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgLmxpbWl0KDEpO1xuXG4gIGlmIChidWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0J1aWxkaW5nIG5vdCBmb3VuZCcpO1xuICB9XG5cbiAgLy8gU3RhcnQgdHJhbnNhY3Rpb24gZm9yIGNhc2NhZGluZyBkZWxldGVcbiAgYXdhaXQgZGIudHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgLy8gMS4gR2V0IGFsbCByZXNpZGVuY2VzIGluIHRoaXMgYnVpbGRpbmdcbiAgICBjb25zdCBidWlsZGluZ1Jlc2lkZW5jZXMgPSBhd2FpdCB0eFxuICAgICAgLnNlbGVjdCh7IGlkOiByZXNpZGVuY2VzLmlkIH0pXG4gICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgLndoZXJlKGFuZChlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBlcShyZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgY29uc3QgcmVzaWRlbmNlSWRzID0gYnVpbGRpbmdSZXNpZGVuY2VzLm1hcCgocikgPT4gci5pZCk7XG5cbiAgICBpZiAocmVzaWRlbmNlSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIDIuIERlbGV0ZSBkb2N1bWVudHMgYXNzb2NpYXRlZCB3aXRoIGJ1aWxkaW5nIG9yIGl0cyByZXNpZGVuY2VzXG4gICAgICAvLyBOb3RlOiBEb2N1bWVudCB0YWJsZSB1c2VzIGJvb2xlYW4gZmxhZ3MsIG5vdCBmb3JlaWduIGtleXNcbiAgICAgIGF3YWl0IHR4LmRlbGV0ZShkb2N1bWVudHMpLndoZXJlKGluQXJyYXkoZG9jdW1lbnRzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZHMpKTtcblxuICAgICAgLy8gMy4gU29mdCBkZWxldGUgdXNlci1yZXNpZGVuY2UgcmVsYXRpb25zaGlwc1xuICAgICAgYXdhaXQgdHhcbiAgICAgICAgLnVwZGF0ZSh1c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShpbkFycmF5KHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZHMpKTtcblxuICAgICAgLy8gNC4gRmluZCBhbmQgc29mdCBkZWxldGUgb3JwaGFuZWQgdXNlcnMgKHVzZXJzIHdobyBub3cgaGF2ZSBubyBhY3RpdmUgcmVsYXRpb25zaGlwcylcbiAgICAgIGNvbnN0IG9ycGhhbmVkVXNlcnMgPSBhd2FpdCB0eFxuICAgICAgICAuc2VsZWN0KHsgaWQ6IHVzZXJzLmlkIH0pXG4gICAgICAgIC5mcm9tKHVzZXJzKVxuICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgdXNlck9yZ2FuaXphdGlvbnMsXG4gICAgICAgICAgYW5kKGVxKHVzZXJzLmlkLCB1c2VyT3JnYW5pemF0aW9ucy51c2VySWQpLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luKFxuICAgICAgICAgIHVzZXJSZXNpZGVuY2VzLFxuICAgICAgICAgIGFuZChlcSh1c2Vycy5pZCwgdXNlclJlc2lkZW5jZXMudXNlcklkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICApXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBpc051bGwodXNlck9yZ2FuaXphdGlvbnMudXNlcklkKSxcbiAgICAgICAgICAgIGlzTnVsbCh1c2VyUmVzaWRlbmNlcy51c2VySWQpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBpZiAob3JwaGFuZWRVc2Vycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IG9ycGhhbmVkVXNlcklkcyA9IG9ycGhhbmVkVXNlcnMubWFwKCh1KSA9PiB1LmlkKTtcbiAgICAgICAgYXdhaXQgdHhcbiAgICAgICAgICAudXBkYXRlKHVzZXJzKVxuICAgICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAgIC53aGVyZShpbkFycmF5KHVzZXJzLmlkLCBvcnBoYW5lZFVzZXJJZHMpKTtcbiAgICAgIH1cblxuICAgICAgLy8gNS4gU29mdCBkZWxldGUgcmVzaWRlbmNlc1xuICAgICAgYXdhaXQgdHhcbiAgICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGluQXJyYXkocmVzaWRlbmNlcy5pZCwgcmVzaWRlbmNlSWRzKSk7XG4gICAgfVxuXG4gICAgLy8gNi4gRmluYWxseSwgc29mdCBkZWxldGUgdGhlIGJ1aWxkaW5nXG4gICAgYXdhaXQgdHhcbiAgICAgIC51cGRhdGUoYnVpbGRpbmdzKVxuICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSk7XG4gIH0pO1xuXG4gIHJldHVybiBidWlsZGluZ1swXTtcbn1cblxuLyoqXG4gKiBDaGVja3MgaWYgYSBidWlsZGluZyBleGlzdHMgYW5kIGlzIGFjdGl2ZS5cbiAqIEBwYXJhbSBidWlsZGluZ0lkXG4gKi9cbi8qKlxuICogQnVpbGRpbmdFeGlzdHMgZnVuY3Rpb24uXG4gKiBAcGFyYW0gYnVpbGRpbmdJZFxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gYnVpbGRpbmdFeGlzdHMoYnVpbGRpbmdJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQgfSlcbiAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgLndoZXJlKGFuZChlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpLCBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAubGltaXQoMSk7XG5cbiAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xufVxuIl0sInZlcnNpb24iOjN9