127fd2db090fb2225fc62d6831ad4039
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Performance: Mock expensive external dependencies
jest.mock('@google/genai', () => ({
    GoogleGenAI: jest.fn().mockImplementation(() => ({
        getGenerativeModel: jest.fn().mockReturnValue({
            generateContent: jest.fn().mockResolvedValue({
                response: {
                    text: () => 'Mock AI response',
                },
            }),
        }),
    })),
}));
// Performance: Mock database for unit tests to avoid network calls
jest.mock('./server/db', () => {
    const { mockDb, mockSql } = require('./tests/mocks/database');
    return {
        db: mockDb,
        sql: mockSql,
        pool: mockSql,
    };
});
// Mock the schema tables that tests import directly
jest.mock('./shared/schema', () => {
    const { mockSchemaObject } = require('./tests/mocks/database');
    return {
        ...mockSchemaObject,
        // Also export all the original exports for other imports
        ...jest.requireActual('./shared/schema')
    };
});
// Mock email service to prevent actual SendGrid calls during tests
jest.mock('./server/services/email-service', () => ({
    emailService: {
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    },
    EmailService: jest.fn().mockImplementation(() => ({
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    }))
}));
// Mock React Router hooks for component tests
jest.mock('wouter', () => ({
    useLocation: jest.fn(() => ['/', jest.fn()]),
    useParams: jest.fn(() => ({})),
    useRoute: jest.fn(() => [false, {}]),
    Link: jest.fn(({ children }) => children),
    Route: jest.fn(({ children }) => children),
    Switch: jest.fn(({ children }) => children),
    Router: jest.fn(({ children }) => children),
    Redirect: jest.fn(() => null),
}));
// Mock language hook and provider
jest.mock('@/hooks/use-language', () => ({
    useLanguage: jest.fn(() => ({
        t: jest.fn((key) => key), // Return the key as translation
        language: 'en',
        setLanguage: jest.fn(),
    })),
    LanguageProvider: ({ children }) => children,
}));
// Mock auth provider
jest.mock('@/hooks/use-auth', () => ({
    useAuth: jest.fn(() => ({
        user: { id: '1', username: 'test', role: 'admin' },
        isAuthenticated: true,
        login: jest.fn(),
        logout: jest.fn(),
    })),
    AuthProvider: ({ children }) => children,
}));
// Mock mobile menu provider
jest.mock('@/hooks/use-mobile-menu', () => ({
    useMobileMenu: jest.fn(() => ({
        isOpen: false,
        open: jest.fn(),
        close: jest.fn(),
        toggle: jest.fn(),
    })),
    MobileMenuProvider: ({ children }) => children,
}));
// Mock query client
jest.mock('@/lib/queryClient', () => ({
    apiRequest: jest.fn().mockResolvedValue({ success: true, data: [] }),
    queryClient: {
        invalidateQueries: jest.fn(),
        setQueryData: jest.fn(),
        getQueryData: jest.fn(),
    },
}));
// Performance: Mock Neon database for faster unit tests
jest.mock('@neondatabase/serverless', () => ({
    neon: jest.fn(() => {
        const { mockSql } = require('./tests/mocks/database');
        return mockSql;
    }),
    Pool: jest.fn().mockImplementation(() => ({
        connect: jest.fn().mockResolvedValue({
            query: jest.fn().mockResolvedValue({ rows: [] }),
            release: jest.fn(),
        }),
        end: jest.fn().mockResolvedValue(undefined),
    }))
}));
// Jest setup file - global test configuration
require("@testing-library/jest-dom");
require("whatwg-fetch");
// Mock fetch for network requests in tests
global.fetch = jest.fn().mockImplementation((url, options) => {
    // Mock successful API responses
    if (url.includes('/api/')) {
        return Promise.resolve({
            ok: true,
            status: 200,
            json: async () => ({ success: true, data: [] }),
            text: async () => '{"success": true, "data": []}'
        });
    }
    // Default to network request failed for external URLs
    return Promise.reject(new Error('Network request failed'));
});
// Add TransformStream polyfill for MSW compatibility
if (typeof TransformStream === 'undefined') {
    const { TransformStream } = require('stream/web');
    global.TransformStream = TransformStream;
}
// Add ReadableStream polyfill
if (typeof ReadableStream === 'undefined') {
    const { ReadableStream } = require('stream/web');
    global.ReadableStream = ReadableStream;
}
// Add WritableStream polyfill
if (typeof WritableStream === 'undefined') {
    const { WritableStream } = require('stream/web');
    global.WritableStream = WritableStream;
}
// Add BroadcastChannel polyfill for MSW
if (typeof BroadcastChannel === 'undefined') {
    global.BroadcastChannel = class {
        constructor(name) { }
        postMessage(message) { }
        addEventListener(event, handler) { }
        removeEventListener(event, handler) { }
        close() { }
    };
}
// Mock runQuery function for integration tests
global.runQuery = jest.fn(() => Promise.resolve([]));
// Set up test database URL if missing
if (!process.env.DATABASE_URL) {
    process.env.DATABASE_URL = 'postgresql://test:test@localhost:5432/koveo_test';
}
// Mock implementations for browser APIs
global.ResizeObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
global.IntersectionObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
// Add TextEncoder/TextDecoder polyfills for Node.js environment
if (typeof TextEncoder === 'undefined') {
    const { TextEncoder, TextDecoder } = require('util');
    global.TextEncoder = TextEncoder;
    global.TextDecoder = TextDecoder;
}
// Mock matchMedia
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: function (query) {
        return {
            matches: false,
            media: query,
            onchange: null,
            addListener: function () { }, // deprecated
            removeListener: function () { }, // deprecated
            addEventListener: function () { },
            removeEventListener: function () { },
            dispatchEvent: function () { },
        };
    },
});
// Mock sessionStorage and localStorage
const createMockStorage = () => ({
    getItem: function () {
        return null;
    },
    setItem: function () { },
    removeItem: function () { },
    clear: function () { },
    length: 0,
    key: function () {
        return null;
    },
});
Object.defineProperty(window, 'sessionStorage', {
    value: createMockStorage(),
});
Object.defineProperty(window, 'localStorage', {
    value: createMockStorage(),
});
// Console error suppression will be handled by individual test files if needed
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RUFBRTtJQUM1QyxLQUFLLEVBQUUsaUJBQWlCLEVBQUU7Q0FDM0IsQ0FBQyxDQUFDO0FBRUgsK0VBQStFIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvamVzdC5zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBKZXN0IHNldHVwIGZpbGUgLSBnbG9iYWwgdGVzdCBjb25maWd1cmF0aW9uXG5pbXBvcnQgJ0B0ZXN0aW5nLWxpYnJhcnkvamVzdC1kb20nO1xuXG4vLyBQZXJmb3JtYW5jZTogTW9jayBleHBlbnNpdmUgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJ0Bnb29nbGUvZ2VuYWknLCAoKSA9PiAoe1xuICBHb29nbGVHZW5BSTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGdldEdlbmVyYXRpdmVNb2RlbDogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh7XG4gICAgICBnZW5lcmF0ZUNvbnRlbnQ6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIHJlc3BvbnNlOiB7XG4gICAgICAgICAgdGV4dDogKCkgPT4gJ01vY2sgQUkgcmVzcG9uc2UnLFxuICAgICAgICB9LFxuICAgICAgfSksXG4gICAgfSksXG4gIH0pKSxcbn0pKTtcblxuLy8gUGVyZm9ybWFuY2U6IE1vY2sgZGF0YWJhc2UgZm9yIHVuaXQgdGVzdHMgdG8gYXZvaWQgbmV0d29yayBjYWxsc1xuamVzdC5tb2NrKCcuL3NlcnZlci9kYicsICgpID0+IHtcbiAgY29uc3QgeyBtb2NrRGIsIG1vY2tTcWwgfSA9IHJlcXVpcmUoJy4vdGVzdHMvbW9ja3MvZGF0YWJhc2UnKTtcbiAgcmV0dXJuIHtcbiAgICBkYjogbW9ja0RiLFxuICAgIHNxbDogbW9ja1NxbCxcbiAgICBwb29sOiBtb2NrU3FsLFxuICB9O1xufSk7XG5cbi8vIE1vY2sgdGhlIHNjaGVtYSB0YWJsZXMgdGhhdCB0ZXN0cyBpbXBvcnQgZGlyZWN0bHlcbmplc3QubW9jaygnLi9zaGFyZWQvc2NoZW1hJywgKCkgPT4ge1xuICBjb25zdCB7IG1vY2tTY2hlbWFPYmplY3QgfSA9IHJlcXVpcmUoJy4vdGVzdHMvbW9ja3MvZGF0YWJhc2UnKTtcbiAgcmV0dXJuIHtcbiAgICAuLi5tb2NrU2NoZW1hT2JqZWN0LFxuICAgIC8vIEFsc28gZXhwb3J0IGFsbCB0aGUgb3JpZ2luYWwgZXhwb3J0cyBmb3Igb3RoZXIgaW1wb3J0c1xuICAgIC4uLmplc3QucmVxdWlyZUFjdHVhbCgnLi9zaGFyZWQvc2NoZW1hJylcbiAgfTtcbn0pO1xuXG4vLyBNb2NrIGVtYWlsIHNlcnZpY2UgdG8gcHJldmVudCBhY3R1YWwgU2VuZEdyaWQgY2FsbHMgZHVyaW5nIHRlc3RzXG5qZXN0Lm1vY2soJy4vc2VydmVyL3NlcnZpY2VzL2VtYWlsLXNlcnZpY2UnLCAoKSA9PiAoe1xuICBlbWFpbFNlcnZpY2U6IHtcbiAgICBzZW5kRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZEludml0YXRpb25FbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRUZXN0RW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kUmVtaW5kZXJFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICB9LFxuICBFbWFpbFNlcnZpY2U6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBzZW5kRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kUGFzc3dvcmRSZXNldEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZEludml0YXRpb25FbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRUZXN0RW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kUmVtaW5kZXJFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICB9KSlcbn0pKTtcblxuLy8gTW9jayBSZWFjdCBSb3V0ZXIgaG9va3MgZm9yIGNvbXBvbmVudCB0ZXN0c1xuamVzdC5tb2NrKCd3b3V0ZXInLCAoKSA9PiAoe1xuICB1c2VMb2NhdGlvbjogamVzdC5mbigoKSA9PiBbJy8nLCBqZXN0LmZuKCldKSxcbiAgdXNlUGFyYW1zOiBqZXN0LmZuKCgpID0+ICh7fSkpLFxuICB1c2VSb3V0ZTogamVzdC5mbigoKSA9PiBbZmFsc2UsIHt9XSksXG4gIExpbms6IGplc3QuZm4oKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbiksXG4gIFJvdXRlOiBqZXN0LmZuKCh7IGNoaWxkcmVuIH06IGFueSkgPT4gY2hpbGRyZW4pLFxuICBTd2l0Y2g6IGplc3QuZm4oKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbiksXG4gIFJvdXRlcjogamVzdC5mbigoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuKSxcbiAgUmVkaXJlY3Q6IGplc3QuZm4oKCkgPT4gbnVsbCksXG59KSk7XG5cbi8vIE1vY2sgbGFuZ3VhZ2UgaG9vayBhbmQgcHJvdmlkZXJcbmplc3QubW9jaygnQC9ob29rcy91c2UtbGFuZ3VhZ2UnLCAoKSA9PiAoe1xuICB1c2VMYW5ndWFnZTogamVzdC5mbigoKSA9PiAoe1xuICAgIHQ6IGplc3QuZm4oKGtleTogc3RyaW5nKSA9PiBrZXkpLCAvLyBSZXR1cm4gdGhlIGtleSBhcyB0cmFuc2xhdGlvblxuICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIHNldExhbmd1YWdlOiBqZXN0LmZuKCksXG4gIH0pKSxcbiAgTGFuZ3VhZ2VQcm92aWRlcjogKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbixcbn0pKTtcblxuLy8gTW9jayBhdXRoIHByb3ZpZGVyXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlLWF1dGgnLCAoKSA9PiAoe1xuICB1c2VBdXRoOiBqZXN0LmZuKCgpID0+ICh7XG4gICAgdXNlcjogeyBpZDogJzEnLCB1c2VybmFtZTogJ3Rlc3QnLCByb2xlOiAnYWRtaW4nIH0sXG4gICAgaXNBdXRoZW50aWNhdGVkOiB0cnVlLFxuICAgIGxvZ2luOiBqZXN0LmZuKCksXG4gICAgbG9nb3V0OiBqZXN0LmZuKCksXG4gIH0pKSxcbiAgQXV0aFByb3ZpZGVyOiAoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuLFxufSkpO1xuXG4vLyBNb2NrIG1vYmlsZSBtZW51IHByb3ZpZGVyXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlLW1vYmlsZS1tZW51JywgKCkgPT4gKHtcbiAgdXNlTW9iaWxlTWVudTogamVzdC5mbigoKSA9PiAoe1xuICAgIGlzT3BlbjogZmFsc2UsXG4gICAgb3BlbjogamVzdC5mbigpLFxuICAgIGNsb3NlOiBqZXN0LmZuKCksXG4gICAgdG9nZ2xlOiBqZXN0LmZuKCksXG4gIH0pKSxcbiAgTW9iaWxlTWVudVByb3ZpZGVyOiAoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuLFxufSkpO1xuXG4vLyBNb2NrIHF1ZXJ5IGNsaWVudFxuamVzdC5tb2NrKCdAL2xpYi9xdWVyeUNsaWVudCcsICgpID0+ICh7XG4gIGFwaVJlcXVlc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFtdIH0pLFxuICBxdWVyeUNsaWVudDoge1xuICAgIGludmFsaWRhdGVRdWVyaWVzOiBqZXN0LmZuKCksXG4gICAgc2V0UXVlcnlEYXRhOiBqZXN0LmZuKCksXG4gICAgZ2V0UXVlcnlEYXRhOiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbi8vIFBlcmZvcm1hbmNlOiBNb2NrIE5lb24gZGF0YWJhc2UgZm9yIGZhc3RlciB1bml0IHRlc3RzXG5qZXN0Lm1vY2soJ0BuZW9uZGF0YWJhc2Uvc2VydmVybGVzcycsICgpID0+ICh7XG4gIG5lb246IGplc3QuZm4oKCkgPT4ge1xuICAgIGNvbnN0IHsgbW9ja1NxbCB9ID0gcmVxdWlyZSgnLi90ZXN0cy9tb2Nrcy9kYXRhYmFzZScpO1xuICAgIHJldHVybiBtb2NrU3FsO1xuICB9KSxcbiAgUG9vbDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgIGNvbm5lY3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICBxdWVyeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgcm93czogW10gfSksXG4gICAgICByZWxlYXNlOiBqZXN0LmZuKCksXG4gICAgfSksXG4gICAgZW5kOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKSxcbiAgfSkpXG59KSk7XG5pbXBvcnQgJ3doYXR3Zy1mZXRjaCc7XG5cbi8vIE1vY2sgZmV0Y2ggZm9yIG5ldHdvcmsgcmVxdWVzdHMgaW4gdGVzdHNcbmdsb2JhbC5mZXRjaCA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKHVybDogc3RyaW5nLCBvcHRpb25zPzogYW55KSA9PiB7XG4gIC8vIE1vY2sgc3VjY2Vzc2Z1bCBBUEkgcmVzcG9uc2VzXG4gIGlmICh1cmwuaW5jbHVkZXMoJy9hcGkvJykpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgIG9rOiB0cnVlLFxuICAgICAgc3RhdHVzOiAyMDAsXG4gICAgICBqc29uOiBhc3luYyAoKSA9PiAoeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBbXSB9KSxcbiAgICAgIHRleHQ6IGFzeW5jICgpID0+ICd7XCJzdWNjZXNzXCI6IHRydWUsIFwiZGF0YVwiOiBbXX0nXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIERlZmF1bHQgdG8gbmV0d29yayByZXF1ZXN0IGZhaWxlZCBmb3IgZXh0ZXJuYWwgVVJMc1xuICByZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IEVycm9yKCdOZXR3b3JrIHJlcXVlc3QgZmFpbGVkJykpO1xufSk7XG5cbi8vIEFkZCBUcmFuc2Zvcm1TdHJlYW0gcG9seWZpbGwgZm9yIE1TVyBjb21wYXRpYmlsaXR5XG5pZiAodHlwZW9mIFRyYW5zZm9ybVN0cmVhbSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgY29uc3QgeyBUcmFuc2Zvcm1TdHJlYW0gfSA9IHJlcXVpcmUoJ3N0cmVhbS93ZWInKTtcbiAgKGdsb2JhbCBhcyBhbnkpLlRyYW5zZm9ybVN0cmVhbSA9IFRyYW5zZm9ybVN0cmVhbTtcbn1cblxuLy8gQWRkIFJlYWRhYmxlU3RyZWFtIHBvbHlmaWxsXG5pZiAodHlwZW9mIFJlYWRhYmxlU3RyZWFtID09PSAndW5kZWZpbmVkJykge1xuICBjb25zdCB7IFJlYWRhYmxlU3RyZWFtIH0gPSByZXF1aXJlKCdzdHJlYW0vd2ViJyk7XG4gIChnbG9iYWwgYXMgYW55KS5SZWFkYWJsZVN0cmVhbSA9IFJlYWRhYmxlU3RyZWFtO1xufVxuXG4vLyBBZGQgV3JpdGFibGVTdHJlYW0gcG9seWZpbGxcbmlmICh0eXBlb2YgV3JpdGFibGVTdHJlYW0gPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgV3JpdGFibGVTdHJlYW0gfSA9IHJlcXVpcmUoJ3N0cmVhbS93ZWInKTtcbiAgKGdsb2JhbCBhcyBhbnkpLldyaXRhYmxlU3RyZWFtID0gV3JpdGFibGVTdHJlYW07XG59XG5cbi8vIEFkZCBCcm9hZGNhc3RDaGFubmVsIHBvbHlmaWxsIGZvciBNU1dcbmlmICh0eXBlb2YgQnJvYWRjYXN0Q2hhbm5lbCA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgKGdsb2JhbCBhcyBhbnkpLkJyb2FkY2FzdENoYW5uZWwgPSBjbGFzcyB7XG4gICAgY29uc3RydWN0b3IobmFtZTogc3RyaW5nKSB7fVxuICAgIHBvc3RNZXNzYWdlKG1lc3NhZ2U6IGFueSkge31cbiAgICBhZGRFdmVudExpc3RlbmVyKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7fVxuICAgIHJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQ6IHN0cmluZywgaGFuZGxlcjogRnVuY3Rpb24pIHt9XG4gICAgY2xvc2UoKSB7fVxuICB9O1xufVxuXG4vLyBNb2NrIHJ1blF1ZXJ5IGZ1bmN0aW9uIGZvciBpbnRlZ3JhdGlvbiB0ZXN0c1xuZ2xvYmFsLnJ1blF1ZXJ5ID0gamVzdC5mbigoKSA9PiBQcm9taXNlLnJlc29sdmUoW10pKTtcblxuLy8gU2V0IHVwIHRlc3QgZGF0YWJhc2UgVVJMIGlmIG1pc3NpbmdcbmlmICghcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMKSB7XG4gIHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCA9ICdwb3N0Z3Jlc3FsOi8vdGVzdDp0ZXN0QGxvY2FsaG9zdDo1NDMyL2tvdmVvX3Rlc3QnO1xufVxuXG4vLyBNb2NrIGltcGxlbWVudGF0aW9ucyBmb3IgYnJvd3NlciBBUElzXG4oZ2xvYmFsIGFzIGFueSkuUmVzaXplT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgb2JzZXJ2ZTogZnVuY3Rpb24gKCkge30sXG4gICAgdW5vYnNlcnZlOiBmdW5jdGlvbiAoKSB7fSxcbiAgICBkaXNjb25uZWN0OiBmdW5jdGlvbiAoKSB7fSxcbiAgfTtcbn07XG5cbihnbG9iYWwgYXMgYW55KS5JbnRlcnNlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICBvYnNlcnZlOiBmdW5jdGlvbiAoKSB7fSxcbiAgICB1bm9ic2VydmU6IGZ1bmN0aW9uICgpIHt9LFxuICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uICgpIHt9LFxuICB9O1xufTtcblxuLy8gQWRkIFRleHRFbmNvZGVyL1RleHREZWNvZGVyIHBvbHlmaWxscyBmb3IgTm9kZS5qcyBlbnZpcm9ubWVudFxuaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgY29uc3QgeyBUZXh0RW5jb2RlciwgVGV4dERlY29kZXIgfSA9IHJlcXVpcmUoJ3V0aWwnKTtcbiAgKGdsb2JhbCBhcyBhbnkpLlRleHRFbmNvZGVyID0gVGV4dEVuY29kZXI7XG4gIChnbG9iYWwgYXMgYW55KS5UZXh0RGVjb2RlciA9IFRleHREZWNvZGVyO1xufVxuXG4vLyBNb2NrIG1hdGNoTWVkaWFcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdtYXRjaE1lZGlhJywge1xuICB3cml0YWJsZTogdHJ1ZSxcbiAgdmFsdWU6IGZ1bmN0aW9uIChxdWVyeTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hdGNoZXM6IGZhbHNlLFxuICAgICAgbWVkaWE6IHF1ZXJ5LFxuICAgICAgb25jaGFuZ2U6IG51bGwsXG4gICAgICBhZGRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sIC8vIGRlcHJlY2F0ZWRcbiAgICAgIHJlbW92ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7fSwgLy8gZGVwcmVjYXRlZFxuICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoKSB7fSxcbiAgICAgIGRpc3BhdGNoRXZlbnQ6IGZ1bmN0aW9uICgpIHt9LFxuICAgIH07XG4gIH0sXG59KTtcblxuLy8gTW9jayBzZXNzaW9uU3RvcmFnZSBhbmQgbG9jYWxTdG9yYWdlXG5jb25zdCBjcmVhdGVNb2NrU3RvcmFnZSA9ICgpID0+ICh7XG4gIGdldEl0ZW06IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgc2V0SXRlbTogZnVuY3Rpb24gKCkge30sXG4gIHJlbW92ZUl0ZW06IGZ1bmN0aW9uICgpIHt9LFxuICBjbGVhcjogZnVuY3Rpb24gKCkge30sXG4gIGxlbmd0aDogMCxcbiAga2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG59KTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ3Nlc3Npb25TdG9yYWdlJywge1xuICB2YWx1ZTogY3JlYXRlTW9ja1N0b3JhZ2UoKSxcbn0pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYWxTdG9yYWdlJywge1xuICB2YWx1ZTogY3JlYXRlTW9ja1N0b3JhZ2UoKSxcbn0pO1xuXG4vLyBDb25zb2xlIGVycm9yIHN1cHByZXNzaW9uIHdpbGwgYmUgaGFuZGxlZCBieSBpbmRpdmlkdWFsIHRlc3QgZmlsZXMgaWYgbmVlZGVkXG4iXSwidmVyc2lvbiI6M30=