30fb5f08278db6cd2bc6723dc2751019
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// Performance: Mock expensive external dependencies
jest.mock('@google/genai', () => ({
    GoogleGenAI: jest.fn().mockImplementation(() => ({
        getGenerativeModel: jest.fn().mockReturnValue({
            generateContent: jest.fn().mockResolvedValue({
                response: {
                    text: () => 'Mock AI response',
                },
            }),
        }),
    })),
}));
// Performance: Mock database for unit tests to avoid network calls
jest.mock('./server/db', () => {
    const mockDb = {
        query: jest.fn().mockResolvedValue([]),
        insert: jest.fn().mockImplementation(() => ({
            values: jest.fn().mockImplementation(() => ({
                returning: jest.fn().mockResolvedValue([{ id: 'mock-id' }])
            }))
        })),
        select: jest.fn().mockImplementation(() => ({
            from: jest.fn().mockImplementation(() => ({
                where: jest.fn().mockResolvedValue([])
            }))
        })),
        update: jest.fn().mockImplementation(() => ({
            set: jest.fn().mockImplementation(() => ({
                where: jest.fn().mockResolvedValue({ affectedRows: 0 })
            }))
        })),
        delete: jest.fn().mockImplementation(() => ({
            where: jest.fn().mockResolvedValue({ affectedRows: 0 })
        }))
    };
    const mockSql = jest.fn().mockResolvedValue([]);
    return {
        db: mockDb,
        sql: mockSql,
        pool: mockSql,
    };
});
// Don't mock the shared schema - let tests import real schema objects
// The database operations themselves are mocked through ./server/db mock
// Mock email service to prevent actual SendGrid calls during tests
jest.mock('./server/services/email-service', () => ({
    emailService: {
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    },
    EmailService: jest.fn().mockImplementation(() => ({
        sendEmail: jest.fn().mockResolvedValue(true),
        sendPasswordResetEmail: jest.fn().mockResolvedValue(true),
        sendInvitationEmail: jest.fn().mockResolvedValue(true),
        sendTestEmail: jest.fn().mockResolvedValue(true),
        sendReminderEmail: jest.fn().mockResolvedValue(true),
    }))
}));
// Mock React Router hooks for component tests
jest.mock('wouter', () => ({
    useLocation: jest.fn(() => ['/', jest.fn()]),
    useParams: jest.fn(() => ({})),
    useRoute: jest.fn(() => [false, {}]),
    Link: jest.fn(({ children }) => children),
    Route: jest.fn(({ children }) => children),
    Switch: jest.fn(({ children }) => children),
    Router: jest.fn(({ children }) => children),
    Redirect: jest.fn(() => null),
}));
// Mock language hook and provider
jest.mock('@/hooks/use-language', () => ({
    useLanguage: jest.fn(() => ({
        t: jest.fn((key) => key), // Return the key as translation
        language: 'en',
        setLanguage: jest.fn(),
    })),
    LanguageProvider: ({ children }) => children,
}));
// Mock auth provider
jest.mock('@/hooks/use-auth', () => ({
    useAuth: jest.fn(() => ({
        user: { id: '1', username: 'test', role: 'admin' },
        isAuthenticated: true,
        login: jest.fn(),
        logout: jest.fn(),
    })),
    AuthProvider: ({ children }) => children,
}));
// Mock mobile menu provider
jest.mock('@/hooks/use-mobile-menu', () => ({
    useMobileMenu: jest.fn(() => ({
        isOpen: false,
        open: jest.fn(),
        close: jest.fn(),
        toggle: jest.fn(),
    })),
    MobileMenuProvider: ({ children }) => children,
}));
// Mock query client with proper TanStack Query setup
jest.mock('@/lib/queryClient', () => {
    const { QueryClient } = require('@tanstack/react-query');
    const mockQueryClient = new QueryClient({
        defaultOptions: {
            queries: {
                retry: false,
                queryFn: jest.fn().mockResolvedValue([]),
            },
        },
    });
    return {
        apiRequest: jest.fn().mockResolvedValue({ success: true, data: [] }),
        queryClient: mockQueryClient,
    };
});
// Performance: Mock Neon database for faster unit tests
jest.mock('@neondatabase/serverless', () => ({
    neon: jest.fn(() => {
        const mockSql = jest.fn().mockResolvedValue([{ version: 'Mock PostgreSQL 16.0' }]);
        // Add setTypeParser mock to prevent undefined errors
        mockSql.setTypeParser = jest.fn();
        return mockSql;
    }),
    Pool: jest.fn().mockImplementation(() => ({
        connect: jest.fn().mockResolvedValue({
            query: jest.fn().mockResolvedValue({ rows: [] }),
            release: jest.fn(),
        }),
        end: jest.fn().mockResolvedValue(undefined),
    }))
}));
// Jest setup file - global test configuration
require("@testing-library/jest-dom");
require("whatwg-fetch");
// Mock fetch for network requests in tests
global.fetch = jest.fn().mockImplementation((url, options) => {
    // Mock successful API responses
    if (url.includes('/api/')) {
        return Promise.resolve({
            ok: true,
            status: 200,
            json: async () => ({ success: true, data: [] }),
            text: async () => '{"success": true, "data": []}'
        });
    }
    // Default to network request failed for external URLs
    return Promise.reject(new Error('Network request failed'));
});
// Add TransformStream polyfill for MSW compatibility
if (typeof TransformStream === 'undefined') {
    const { TransformStream } = require('stream/web');
    global.TransformStream = TransformStream;
}
// Add ReadableStream polyfill
if (typeof ReadableStream === 'undefined') {
    const { ReadableStream } = require('stream/web');
    global.ReadableStream = ReadableStream;
}
// Add WritableStream polyfill
if (typeof WritableStream === 'undefined') {
    const { WritableStream } = require('stream/web');
    global.WritableStream = WritableStream;
}
// Add BroadcastChannel polyfill for MSW
if (typeof BroadcastChannel === 'undefined') {
    global.BroadcastChannel = class {
        constructor(name) { }
        postMessage(message) { }
        addEventListener(event, handler) { }
        removeEventListener(event, handler) { }
        close() { }
    };
}
// Mock runQuery function for integration tests
global.runQuery = jest.fn(() => Promise.resolve([]));
// Database URL is now set in global setup, don't override here
// Mock implementations for browser APIs
global.ResizeObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
global.IntersectionObserver = function () {
    return {
        observe: function () { },
        unobserve: function () { },
        disconnect: function () { },
    };
};
// Add TextEncoder/TextDecoder polyfills for Node.js environment
if (typeof TextEncoder === 'undefined') {
    const { TextEncoder, TextDecoder } = require('util');
    global.TextEncoder = TextEncoder;
    global.TextDecoder = TextDecoder;
}
// Mock matchMedia
Object.defineProperty(window, 'matchMedia', {
    writable: true,
    value: function (query) {
        return {
            matches: false,
            media: query,
            onchange: null,
            addListener: function () { }, // deprecated
            removeListener: function () { }, // deprecated
            addEventListener: function () { },
            removeEventListener: function () { },
            dispatchEvent: function () { },
        };
    },
});
// Mock sessionStorage and localStorage
const createMockStorage = () => ({
    getItem: function () {
        return null;
    },
    setItem: function () { },
    removeItem: function () { },
    clear: function () { },
    length: 0,
    key: function () {
        return null;
    },
});
Object.defineProperty(window, 'sessionStorage', {
    value: createMockStorage(),
});
Object.defineProperty(window, 'localStorage', {
    value: createMockStorage(),
});
// Console error suppression will be handled by individual test files if needed
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBaUIsRUFBRTtDQUMzQixDQUFDLENBQUM7QUFFSCxNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxjQUFjLEVBQUU7SUFDNUMsS0FBSyxFQUFFLGlCQUFpQixFQUFFO0NBQzNCLENBQUMsQ0FBQztBQUVILCtFQUErRSIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2plc3Quc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSmVzdCBzZXR1cCBmaWxlIC0gZ2xvYmFsIHRlc3QgY29uZmlndXJhdGlvblxuaW1wb3J0ICdAdGVzdGluZy1saWJyYXJ5L2plc3QtZG9tJztcblxuLy8gUGVyZm9ybWFuY2U6IE1vY2sgZXhwZW5zaXZlIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdAZ29vZ2xlL2dlbmFpJywgKCkgPT4gKHtcbiAgR29vZ2xlR2VuQUk6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBnZXRHZW5lcmF0aXZlTW9kZWw6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoe1xuICAgICAgZ2VuZXJhdGVDb250ZW50OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICByZXNwb25zZToge1xuICAgICAgICAgIHRleHQ6ICgpID0+ICdNb2NrIEFJIHJlc3BvbnNlJyxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIH0pLFxuICB9KSksXG59KSk7XG5cbi8vIFBlcmZvcm1hbmNlOiBNb2NrIGRhdGFiYXNlIGZvciB1bml0IHRlc3RzIHRvIGF2b2lkIG5ldHdvcmsgY2FsbHNcbmplc3QubW9jaygnLi9zZXJ2ZXIvZGInLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tEYiA9IHtcbiAgICBxdWVyeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKSxcbiAgICBpbnNlcnQ6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHZhbHVlczogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgICByZXR1cm5pbmc6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbeyBpZDogJ21vY2staWQnIH1dKVxuICAgICAgfSkpXG4gICAgfSkpLFxuICAgIHNlbGVjdDogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgZnJvbTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgICB3aGVyZTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKVxuICAgICAgfSkpXG4gICAgfSkpLFxuICAgIHVwZGF0ZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiAoe1xuICAgICAgc2V0OiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgICAgIHdoZXJlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBhZmZlY3RlZFJvd3M6IDAgfSlcbiAgICAgIH0pKVxuICAgIH0pKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICAgIHdoZXJlOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoeyBhZmZlY3RlZFJvd3M6IDAgfSlcbiAgICB9KSlcbiAgfTtcbiAgXG4gIGNvbnN0IG1vY2tTcWwgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoW10pO1xuICBcbiAgcmV0dXJuIHtcbiAgICBkYjogbW9ja0RiLFxuICAgIHNxbDogbW9ja1NxbCxcbiAgICBwb29sOiBtb2NrU3FsLFxuICB9O1xufSk7XG5cbi8vIERvbid0IG1vY2sgdGhlIHNoYXJlZCBzY2hlbWEgLSBsZXQgdGVzdHMgaW1wb3J0IHJlYWwgc2NoZW1hIG9iamVjdHNcbi8vIFRoZSBkYXRhYmFzZSBvcGVyYXRpb25zIHRoZW1zZWx2ZXMgYXJlIG1vY2tlZCB0aHJvdWdoIC4vc2VydmVyL2RiIG1vY2tcblxuLy8gTW9jayBlbWFpbCBzZXJ2aWNlIHRvIHByZXZlbnQgYWN0dWFsIFNlbmRHcmlkIGNhbGxzIGR1cmluZyB0ZXN0c1xuamVzdC5tb2NrKCcuL3NlcnZlci9zZXJ2aWNlcy9lbWFpbC1zZXJ2aWNlJywgKCkgPT4gKHtcbiAgZW1haWxTZXJ2aWNlOiB7XG4gICAgc2VuZEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFBhc3N3b3JkUmVzZXRFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRJbnZpdGF0aW9uRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kVGVzdEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFJlbWluZGVyRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgfSxcbiAgRW1haWxTZXJ2aWNlOiBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICh7XG4gICAgc2VuZEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFBhc3N3b3JkUmVzZXRFbWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxuICAgIHNlbmRJbnZpdGF0aW9uRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgICBzZW5kVGVzdEVtYWlsOiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodHJ1ZSksXG4gICAgc2VuZFJlbWluZGVyRW1haWw6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgfSkpXG59KSk7XG5cbi8vIE1vY2sgUmVhY3QgUm91dGVyIGhvb2tzIGZvciBjb21wb25lbnQgdGVzdHNcbmplc3QubW9jaygnd291dGVyJywgKCkgPT4gKHtcbiAgdXNlTG9jYXRpb246IGplc3QuZm4oKCkgPT4gWycvJywgamVzdC5mbigpXSksXG4gIHVzZVBhcmFtczogamVzdC5mbigoKSA9PiAoe30pKSxcbiAgdXNlUm91dGU6IGplc3QuZm4oKCkgPT4gW2ZhbHNlLCB7fV0pLFxuICBMaW5rOiBqZXN0LmZuKCh7IGNoaWxkcmVuIH06IGFueSkgPT4gY2hpbGRyZW4pLFxuICBSb3V0ZTogamVzdC5mbigoeyBjaGlsZHJlbiB9OiBhbnkpID0+IGNoaWxkcmVuKSxcbiAgU3dpdGNoOiBqZXN0LmZuKCh7IGNoaWxkcmVuIH06IGFueSkgPT4gY2hpbGRyZW4pLFxuICBSb3V0ZXI6IGplc3QuZm4oKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbiksXG4gIFJlZGlyZWN0OiBqZXN0LmZuKCgpID0+IG51bGwpLFxufSkpO1xuXG4vLyBNb2NrIGxhbmd1YWdlIGhvb2sgYW5kIHByb3ZpZGVyXG5qZXN0Lm1vY2soJ0AvaG9va3MvdXNlLWxhbmd1YWdlJywgKCkgPT4gKHtcbiAgdXNlTGFuZ3VhZ2U6IGplc3QuZm4oKCkgPT4gKHtcbiAgICB0OiBqZXN0LmZuKChrZXk6IHN0cmluZykgPT4ga2V5KSwgLy8gUmV0dXJuIHRoZSBrZXkgYXMgdHJhbnNsYXRpb25cbiAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICBzZXRMYW5ndWFnZTogamVzdC5mbigpLFxuICB9KSksXG4gIExhbmd1YWdlUHJvdmlkZXI6ICh7IGNoaWxkcmVuIH06IGFueSkgPT4gY2hpbGRyZW4sXG59KSk7XG5cbi8vIE1vY2sgYXV0aCBwcm92aWRlclxuamVzdC5tb2NrKCdAL2hvb2tzL3VzZS1hdXRoJywgKCkgPT4gKHtcbiAgdXNlQXV0aDogamVzdC5mbigoKSA9PiAoe1xuICAgIHVzZXI6IHsgaWQ6ICcxJywgdXNlcm5hbWU6ICd0ZXN0Jywgcm9sZTogJ2FkbWluJyB9LFxuICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICBsb2dpbjogamVzdC5mbigpLFxuICAgIGxvZ291dDogamVzdC5mbigpLFxuICB9KSksXG4gIEF1dGhQcm92aWRlcjogKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbixcbn0pKTtcblxuLy8gTW9jayBtb2JpbGUgbWVudSBwcm92aWRlclxuamVzdC5tb2NrKCdAL2hvb2tzL3VzZS1tb2JpbGUtbWVudScsICgpID0+ICh7XG4gIHVzZU1vYmlsZU1lbnU6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBpc09wZW46IGZhbHNlLFxuICAgIG9wZW46IGplc3QuZm4oKSxcbiAgICBjbG9zZTogamVzdC5mbigpLFxuICAgIHRvZ2dsZTogamVzdC5mbigpLFxuICB9KSksXG4gIE1vYmlsZU1lbnVQcm92aWRlcjogKHsgY2hpbGRyZW4gfTogYW55KSA9PiBjaGlsZHJlbixcbn0pKTtcblxuLy8gTW9jayBxdWVyeSBjbGllbnQgd2l0aCBwcm9wZXIgVGFuU3RhY2sgUXVlcnkgc2V0dXBcbmplc3QubW9jaygnQC9saWIvcXVlcnlDbGllbnQnLCAoKSA9PiB7XG4gIGNvbnN0IHsgUXVlcnlDbGllbnQgfSA9IHJlcXVpcmUoJ0B0YW5zdGFjay9yZWFjdC1xdWVyeScpO1xuICBjb25zdCBtb2NrUXVlcnlDbGllbnQgPSBuZXcgUXVlcnlDbGllbnQoe1xuICAgIGRlZmF1bHRPcHRpb25zOiB7XG4gICAgICBxdWVyaWVzOiB7XG4gICAgICAgIHJldHJ5OiBmYWxzZSxcbiAgICAgICAgcXVlcnlGbjogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKFtdKSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG4gIFxuICByZXR1cm4ge1xuICAgIGFwaVJlcXVlc3Q6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFtdIH0pLFxuICAgIHF1ZXJ5Q2xpZW50OiBtb2NrUXVlcnlDbGllbnQsXG4gIH07XG59KTtcblxuLy8gUGVyZm9ybWFuY2U6IE1vY2sgTmVvbiBkYXRhYmFzZSBmb3IgZmFzdGVyIHVuaXQgdGVzdHNcbmplc3QubW9jaygnQG5lb25kYXRhYmFzZS9zZXJ2ZXJsZXNzJywgKCkgPT4gKHtcbiAgbmVvbjogamVzdC5mbigoKSA9PiB7XG4gICAgY29uc3QgbW9ja1NxbCA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbeyB2ZXJzaW9uOiAnTW9jayBQb3N0Z3JlU1FMIDE2LjAnIH1dKTtcbiAgICAvLyBBZGQgc2V0VHlwZVBhcnNlciBtb2NrIHRvIHByZXZlbnQgdW5kZWZpbmVkIGVycm9yc1xuICAgIG1vY2tTcWwuc2V0VHlwZVBhcnNlciA9IGplc3QuZm4oKTtcbiAgICByZXR1cm4gbW9ja1NxbDtcbiAgfSksXG4gIFBvb2w6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gKHtcbiAgICBjb25uZWN0OiBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgcXVlcnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7IHJvd3M6IFtdIH0pLFxuICAgICAgcmVsZWFzZTogamVzdC5mbigpLFxuICAgIH0pLFxuICAgIGVuZDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCksXG4gIH0pKVxufSkpO1xuaW1wb3J0ICd3aGF0d2ctZmV0Y2gnO1xuXG4vLyBNb2NrIGZldGNoIGZvciBuZXR3b3JrIHJlcXVlc3RzIGluIHRlc3RzXG5nbG9iYWwuZmV0Y2ggPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCh1cmw6IHN0cmluZywgb3B0aW9ucz86IGFueSkgPT4ge1xuICAvLyBNb2NrIHN1Y2Nlc3NmdWwgQVBJIHJlc3BvbnNlc1xuICBpZiAodXJsLmluY2x1ZGVzKCcvYXBpLycpKSB7XG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7XG4gICAgICBvazogdHJ1ZSxcbiAgICAgIHN0YXR1czogMjAwLFxuICAgICAganNvbjogYXN5bmMgKCkgPT4gKHsgc3VjY2VzczogdHJ1ZSwgZGF0YTogW10gfSksXG4gICAgICB0ZXh0OiBhc3luYyAoKSA9PiAne1wic3VjY2Vzc1wiOiB0cnVlLCBcImRhdGFcIjogW119J1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyBEZWZhdWx0IHRvIG5ldHdvcmsgcmVxdWVzdCBmYWlsZWQgZm9yIGV4dGVybmFsIFVSTHNcbiAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignTmV0d29yayByZXF1ZXN0IGZhaWxlZCcpKTtcbn0pO1xuXG4vLyBBZGQgVHJhbnNmb3JtU3RyZWFtIHBvbHlmaWxsIGZvciBNU1cgY29tcGF0aWJpbGl0eVxuaWYgKHR5cGVvZiBUcmFuc2Zvcm1TdHJlYW0gPT09ICd1bmRlZmluZWQnKSB7XG4gIGNvbnN0IHsgVHJhbnNmb3JtU3RyZWFtIH0gPSByZXF1aXJlKCdzdHJlYW0vd2ViJyk7XG4gIChnbG9iYWwgYXMgYW55KS5UcmFuc2Zvcm1TdHJlYW0gPSBUcmFuc2Zvcm1TdHJlYW07XG59XG5cbi8vIEFkZCBSZWFkYWJsZVN0cmVhbSBwb2x5ZmlsbFxuaWYgKHR5cGVvZiBSZWFkYWJsZVN0cmVhbSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgY29uc3QgeyBSZWFkYWJsZVN0cmVhbSB9ID0gcmVxdWlyZSgnc3RyZWFtL3dlYicpO1xuICAoZ2xvYmFsIGFzIGFueSkuUmVhZGFibGVTdHJlYW0gPSBSZWFkYWJsZVN0cmVhbTtcbn1cblxuLy8gQWRkIFdyaXRhYmxlU3RyZWFtIHBvbHlmaWxsXG5pZiAodHlwZW9mIFdyaXRhYmxlU3RyZWFtID09PSAndW5kZWZpbmVkJykge1xuICBjb25zdCB7IFdyaXRhYmxlU3RyZWFtIH0gPSByZXF1aXJlKCdzdHJlYW0vd2ViJyk7XG4gIChnbG9iYWwgYXMgYW55KS5Xcml0YWJsZVN0cmVhbSA9IFdyaXRhYmxlU3RyZWFtO1xufVxuXG4vLyBBZGQgQnJvYWRjYXN0Q2hhbm5lbCBwb2x5ZmlsbCBmb3IgTVNXXG5pZiAodHlwZW9mIEJyb2FkY2FzdENoYW5uZWwgPT09ICd1bmRlZmluZWQnKSB7XG4gIChnbG9iYWwgYXMgYW55KS5Ccm9hZGNhc3RDaGFubmVsID0gY2xhc3Mge1xuICAgIGNvbnN0cnVjdG9yKG5hbWU6IHN0cmluZykge31cbiAgICBwb3N0TWVzc2FnZShtZXNzYWdlOiBhbnkpIHt9XG4gICAgYWRkRXZlbnRMaXN0ZW5lcihldmVudDogc3RyaW5nLCBoYW5kbGVyOiBGdW5jdGlvbikge31cbiAgICByZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50OiBzdHJpbmcsIGhhbmRsZXI6IEZ1bmN0aW9uKSB7fVxuICAgIGNsb3NlKCkge31cbiAgfTtcbn1cblxuLy8gTW9jayBydW5RdWVyeSBmdW5jdGlvbiBmb3IgaW50ZWdyYXRpb24gdGVzdHNcbmdsb2JhbC5ydW5RdWVyeSA9IGplc3QuZm4oKCkgPT4gUHJvbWlzZS5yZXNvbHZlKFtdKSk7XG5cbi8vIERhdGFiYXNlIFVSTCBpcyBub3cgc2V0IGluIGdsb2JhbCBzZXR1cCwgZG9uJ3Qgb3ZlcnJpZGUgaGVyZVxuXG4vLyBNb2NrIGltcGxlbWVudGF0aW9ucyBmb3IgYnJvd3NlciBBUElzXG4oZ2xvYmFsIGFzIGFueSkuUmVzaXplT2JzZXJ2ZXIgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiB7XG4gICAgb2JzZXJ2ZTogZnVuY3Rpb24gKCkge30sXG4gICAgdW5vYnNlcnZlOiBmdW5jdGlvbiAoKSB7fSxcbiAgICBkaXNjb25uZWN0OiBmdW5jdGlvbiAoKSB7fSxcbiAgfTtcbn07XG5cbihnbG9iYWwgYXMgYW55KS5JbnRlcnNlY3Rpb25PYnNlcnZlciA9IGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIHtcbiAgICBvYnNlcnZlOiBmdW5jdGlvbiAoKSB7fSxcbiAgICB1bm9ic2VydmU6IGZ1bmN0aW9uICgpIHt9LFxuICAgIGRpc2Nvbm5lY3Q6IGZ1bmN0aW9uICgpIHt9LFxuICB9O1xufTtcblxuLy8gQWRkIFRleHRFbmNvZGVyL1RleHREZWNvZGVyIHBvbHlmaWxscyBmb3IgTm9kZS5qcyBlbnZpcm9ubWVudFxuaWYgKHR5cGVvZiBUZXh0RW5jb2RlciA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgY29uc3QgeyBUZXh0RW5jb2RlciwgVGV4dERlY29kZXIgfSA9IHJlcXVpcmUoJ3V0aWwnKTtcbiAgKGdsb2JhbCBhcyBhbnkpLlRleHRFbmNvZGVyID0gVGV4dEVuY29kZXI7XG4gIChnbG9iYWwgYXMgYW55KS5UZXh0RGVjb2RlciA9IFRleHREZWNvZGVyO1xufVxuXG4vLyBNb2NrIG1hdGNoTWVkaWFcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eSh3aW5kb3csICdtYXRjaE1lZGlhJywge1xuICB3cml0YWJsZTogdHJ1ZSxcbiAgdmFsdWU6IGZ1bmN0aW9uIChxdWVyeTogc3RyaW5nKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIG1hdGNoZXM6IGZhbHNlLFxuICAgICAgbWVkaWE6IHF1ZXJ5LFxuICAgICAgb25jaGFuZ2U6IG51bGwsXG4gICAgICBhZGRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sIC8vIGRlcHJlY2F0ZWRcbiAgICAgIHJlbW92ZUxpc3RlbmVyOiBmdW5jdGlvbiAoKSB7fSwgLy8gZGVwcmVjYXRlZFxuICAgICAgYWRkRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCkge30sXG4gICAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoKSB7fSxcbiAgICAgIGRpc3BhdGNoRXZlbnQ6IGZ1bmN0aW9uICgpIHt9LFxuICAgIH07XG4gIH0sXG59KTtcblxuLy8gTW9jayBzZXNzaW9uU3RvcmFnZSBhbmQgbG9jYWxTdG9yYWdlXG5jb25zdCBjcmVhdGVNb2NrU3RvcmFnZSA9ICgpID0+ICh7XG4gIGdldEl0ZW06IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfSxcbiAgc2V0SXRlbTogZnVuY3Rpb24gKCkge30sXG4gIHJlbW92ZUl0ZW06IGZ1bmN0aW9uICgpIHt9LFxuICBjbGVhcjogZnVuY3Rpb24gKCkge30sXG4gIGxlbmd0aDogMCxcbiAga2V5OiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH0sXG59KTtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KHdpbmRvdywgJ3Nlc3Npb25TdG9yYWdlJywge1xuICB2YWx1ZTogY3JlYXRlTW9ja1N0b3JhZ2UoKSxcbn0pO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkod2luZG93LCAnbG9jYWxTdG9yYWdlJywge1xuICB2YWx1ZTogY3JlYXRlTW9ja1N0b3JhZ2UoKSxcbn0pO1xuXG4vLyBDb25zb2xlIGVycm9yIHN1cHByZXNzaW9uIHdpbGwgYmUgaGFuZGxlZCBieSBpbmRpdmlkdWFsIHRlc3QgZmlsZXMgaWYgbmVlZGVkXG4iXSwidmVyc2lvbiI6M30=