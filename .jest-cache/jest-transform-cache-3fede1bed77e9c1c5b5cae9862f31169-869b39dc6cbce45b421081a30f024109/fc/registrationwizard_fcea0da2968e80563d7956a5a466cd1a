d2aef33ad1fb7819c4f6d833ccb82671
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.RegistrationWizard = RegistrationWizard;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importStar(require("react"));
const card_1 = require("@/components/ui/card");
const button_1 = require("@/components/ui/button");
const progress_1 = require("@/components/ui/progress");
const badge_1 = require("@/components/ui/badge");
const lucide_react_1 = require("lucide-react");
const use_language_1 = require("@/hooks/use-language");
/**
 * Multi-Step Registration Wizard Component.
 *
 * Provides a guided registration flow with step validation,
 * progress tracking, and Quebec compliance features.
 * @param root0 - Component props object.
 * @param root0.steps - Array of wizard steps to render.
 * @param root0.initialData - Initial data for the wizard.
 * @param root0.onComplete - Function called when wizard is completed.
 * @param root0.onCancel - Function called when wizard is cancelled.
 * @param root0.title - Optional title for the wizard.
 * @param root0.className - Optional CSS class name.
 * @returns JSX element for the registration wizard.
 */
function RegistrationWizard({ steps: initialSteps, initialData = {}, onComplete, onCancel, title = 'Inscription', className = '', }) {
    const { t: _t } = (0, use_language_1.useLanguage)();
    const [currentStepIndex, setCurrentStepIndex] = (0, react_1.useState)(0);
    const [steps, setSteps] = (0, react_1.useState)(initialSteps);
    const [wizardData, setWizardData] = (0, react_1.useState)(initialData);
    const [isSubmitting, setIsSubmitting] = (0, react_1.useState)(false);
    const currentStep = steps[currentStepIndex];
    const isFirstStep = currentStepIndex === 0;
    const isLastStep = currentStepIndex === steps.length - 1;
    const completedSteps = steps.filter((step) => step.isComplete).length;
    const progress = (completedSteps / steps.length) * 100;
    // Update step validation status
    const updateStepValidation = (stepId, isValid) => {
        setSteps((prevSteps) => prevSteps.map((step) => (step.id === stepId ? { ...step, isValid } : step)));
    };
    // Update step completion status
    const updateStepCompletion = (stepId, isComplete) => {
        setSteps((prevSteps) => prevSteps.map((step) => (step.id === stepId ? { ...step, isComplete } : step)));
    };
    // Handle data changes from step components - memoized to prevent infinite loops
    const handleDataChange = (0, react_1.useCallback)((stepData) => {
        setWizardData((prevData) => ({
            ...prevData,
            [currentStep.id]: stepData,
        }));
    }, [currentStep.id]);
    // Handle validation changes from step components - memoized to prevent infinite loops
    const handleValidationChange = (0, react_1.useCallback)((isValid) => {
        setSteps((prevSteps) => prevSteps.map((step) => (step.id === currentStep.id ? { ...step, isValid } : step)));
        // Auto-complete step if valid and has required data
        if (isValid) {
            setSteps((prevSteps) => prevSteps.map((step) => (step.id === currentStep.id ? { ...step, isComplete: true } : step)));
        }
    }, [currentStep.id]);
    // Navigate to next step
    const handleNext = () => {
        if (currentStep.isValid && !isLastStep) {
            updateStepCompletion(currentStep.id, true);
            setCurrentStepIndex((prev) => prev + 1);
        }
        else if (isLastStep && currentStep.isValid) {
            handleComplete();
        }
    };
    // Navigate to previous step
    const handlePrevious = () => {
        if (!isFirstStep) {
            setCurrentStepIndex((prev) => prev - 1);
        }
    };
    // Complete the wizard
    const handleComplete = async () => {
        setIsSubmitting(true);
        try {
            // Combine all wizard data
            const completeData = {
                ...wizardData,
                [currentStep.id]: wizardData[currentStep.id] || {},
            };
            await onComplete(completeData);
            // Only mark final step as complete after successful submission
            updateStepCompletion(currentStep.id, true);
        }
        catch (error) {
            // Wizard completion error
            // Reset step completion on error to allow retry
            updateStepCompletion(currentStep.id, false);
        }
        finally {
            setIsSubmitting(false);
        }
    };
    // Jump to specific step (only if previous steps are complete)
    const jumpToStep = (stepIndex) => {
        // Can only go to completed steps or the next uncompleted step
        const canJump = stepIndex <= currentStepIndex || steps.slice(0, stepIndex).every((step) => step.isComplete);
        if (canJump) {
            setCurrentStepIndex(stepIndex);
        }
    };
    return ((0, jsx_runtime_1.jsx)("div", { className: `max-w-4xl mx-auto p-6 ${className}`, children: (0, jsx_runtime_1.jsxs)(card_1.Card, { className: 'shadow-xl border-0', children: [(0, jsx_runtime_1.jsxs)(card_1.CardHeader, { className: 'text-center pb-6', children: [(0, jsx_runtime_1.jsx)(card_1.CardTitle, { className: 'text-2xl font-bold text-gray-900', children: title }), (0, jsx_runtime_1.jsxs)("div", { className: 'mt-4', children: [(0, jsx_runtime_1.jsx)(progress_1.Progress, { value: progress, className: 'h-2' }), (0, jsx_runtime_1.jsxs)("p", { className: 'text-sm text-gray-600 mt-2', children: ["\u00C9tape ", currentStepIndex + 1, " sur ", steps.length, " \u2022 ", Math.round(progress), "% termin\u00E9"] })] })] }), (0, jsx_runtime_1.jsxs)(card_1.CardContent, { className: 'space-y-6', children: [(0, jsx_runtime_1.jsx)("div", { className: 'flex justify-center', children: (0, jsx_runtime_1.jsx)("div", { className: 'flex items-center space-x-2 md:space-x-4 overflow-x-auto pb-2', children: steps.map((step, _index) => ((0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center', children: [(0, jsx_runtime_1.jsx)("button", { onClick: () => jumpToStep(_index), disabled: _index > currentStepIndex &&
                                                !steps.slice(0, _index).every((s) => s.isComplete), className: `
                      flex items-center justify-center w-8 h-8 rounded-full border-2 transition-all
                      ${_index === currentStepIndex
                                                ? 'border-primary bg-primary text-white'
                                                : step.isComplete
                                                    ? 'border-green-500 bg-green-500 text-white cursor-pointer hover:bg-green-600'
                                                    : 'border-gray-300 bg-white text-gray-400'}
                      ${_index <= currentStepIndex || step.isComplete ? 'cursor-pointer' : 'cursor-not-allowed'}
                    `, "aria-label": `${step.title} - ${step.isComplete ? 'TerminÃ©' : _index === currentStepIndex ? 'En cours' : 'En attente'}`, children: step.isComplete ? ((0, jsx_runtime_1.jsx)(lucide_react_1.CheckCircle, { className: 'w-5 h-5' })) : ((0, jsx_runtime_1.jsx)("span", { className: 'text-sm font-medium', children: _index + 1 })) }), _index < steps.length - 1 && ((0, jsx_runtime_1.jsx)("div", { className: `w-8 md:w-16 h-0.5 ${steps[_index + 1].isComplete || _index < currentStepIndex
                                                ? 'bg-green-500'
                                                : 'bg-gray-300'}` }))] }, step.id))) }) }), (0, jsx_runtime_1.jsxs)("div", { className: 'min-h-[400px]', children: [(0, jsx_runtime_1.jsxs)("div", { className: 'text-center mb-6', children: [(0, jsx_runtime_1.jsx)("h3", { className: 'text-xl font-semibold text-gray-900 mb-2', children: currentStep.title }), (0, jsx_runtime_1.jsx)("p", { className: 'text-gray-600', children: currentStep.description }), currentStep.isValid && ((0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: 'secondary', className: 'mt-2 bg-green-100 text-green-800', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.CheckCircle, { className: 'w-4 h-4 mr-1' }), "Valid\u00E9"] }))] }), (0, jsx_runtime_1.jsx)(currentStep.component, { _data: wizardData[currentStep.id] || {}, onDataChange: handleDataChange, onValidationChange: handleValidationChange, onNext: handleNext, onPrevious: handlePrevious, isActive: true })] }), (0, jsx_runtime_1.jsxs)("div", { className: 'flex items-center justify-between pt-6 border-t border-gray-200', children: [(0, jsx_runtime_1.jsxs)("div", { className: 'flex space-x-3', children: [!isFirstStep && ((0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: handlePrevious, variant: 'outline', className: 'flex items-center', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: 'w-4 h-4 mr-2' }), "Pr\u00E9c\u00E9dent"] })), (0, jsx_runtime_1.jsx)(button_1.Button, { onClick: onCancel, variant: 'ghost', className: 'text-gray-600', children: "Annuler" })] }), (0, jsx_runtime_1.jsx)(button_1.Button, { onClick: handleNext, disabled: !currentStep.isValid || isSubmitting, className: 'flex items-center min-w-[120px]', children: isSubmitting ? ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(0, jsx_runtime_1.jsx)("div", { className: 'animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2' }), "Traitement..."] })) : isLastStep ? ('Terminer') : ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: ["Suivant", (0, jsx_runtime_1.jsx)(lucide_react_1.ArrowRight, { className: 'w-4 h-4 ml-2' })] })) })] })] })] }) }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvYXV0aC9yZWdpc3RyYXRpb24td2l6YXJkLnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQThEQSxnREFvT0M7O0FBbFNELCtDQUFxRDtBQUNyRCwrQ0FBZ0Y7QUFDaEYsbURBQWdEO0FBQ2hELHVEQUFvRDtBQUNwRCxpREFBOEM7QUFDOUMsK0NBQWtFO0FBQ2xFLHVEQUFtRDtBQTBDbkQ7Ozs7Ozs7Ozs7Ozs7R0FhRztBQUNILFNBQWdCLGtCQUFrQixDQUFDLEVBQ2pDLEtBQUssRUFBRSxZQUFZLEVBQ25CLFdBQVcsR0FBRyxFQUFFLEVBQ2hCLFVBQVUsRUFDVixRQUFRLEVBQ1IsS0FBSyxHQUFHLGFBQWEsRUFDckIsU0FBUyxHQUFHLEVBQUUsR0FDVTtJQUN4QixNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxHQUFHLElBQUEsMEJBQVcsR0FBRSxDQUFDO0lBQ2hDLE1BQU0sQ0FBQyxnQkFBZ0IsRUFBRSxtQkFBbUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxDQUFDLENBQUMsQ0FBQztJQUM1RCxNQUFNLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBZSxZQUFZLENBQUMsQ0FBQztJQUMvRCxNQUFNLENBQUMsVUFBVSxFQUFFLGFBQWEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxXQUFXLENBQUMsQ0FBQztJQUMxRCxNQUFNLENBQUMsWUFBWSxFQUFFLGVBQWUsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUV4RCxNQUFNLFdBQVcsR0FBRyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUM1QyxNQUFNLFdBQVcsR0FBRyxnQkFBZ0IsS0FBSyxDQUFDLENBQUM7SUFDM0MsTUFBTSxVQUFVLEdBQUcsZ0JBQWdCLEtBQUssS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7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QUMsQ0FBQyxDQUFDLENBQ2QsNkRBQ0UsZ0NBQUssU0FBUyxFQUFDLGdFQUFnRSxHQUFHLHFCQUVqRixDQUNKLENBQUMsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FDZixVQUFVLENBQ1gsQ0FBQyxDQUFDLENBQUMsQ0FDRix3RUFFRSx1QkFBQyx5QkFBVSxJQUFDLFNBQVMsRUFBQyxjQUFjLEdBQUcsSUFDdEMsQ0FDSixHQUNNLElBQ0wsSUFDTSxJQUNULEdBQ0gsQ0FDUCxDQUFDO0FBQ0osQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvY29tcG9uZW50cy9hdXRoL3JlZ2lzdHJhdGlvbi13aXphcmQudHN4Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBSZWFjdCwgeyB1c2VTdGF0ZSwgdXNlQ2FsbGJhY2sgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBDYXJkLCBDYXJkQ29udGVudCwgQ2FyZEhlYWRlciwgQ2FyZFRpdGxlIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2NhcmQnO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2J1dHRvbic7XG5pbXBvcnQgeyBQcm9ncmVzcyB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9wcm9ncmVzcyc7XG5pbXBvcnQgeyBCYWRnZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9iYWRnZSc7XG5pbXBvcnQgeyBDaGVja0NpcmNsZSwgQXJyb3dMZWZ0LCBBcnJvd1JpZ2h0IH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IHVzZUxhbmd1YWdlIH0gZnJvbSAnQC9ob29rcy91c2UtbGFuZ3VhZ2UnO1xuXG4vKipcbiAqIFJlcHJlc2VudHMgYSBzaW5nbGUgc3RlcCBpbiB0aGUgcmVnaXN0cmF0aW9uIHdpemFyZCBwcm9jZXNzLlxuICogQ29udGFpbnMgbWV0YWRhdGEgYW5kIHZhbGlkYXRpb24gc3RhdGUgZm9yIGVhY2ggc3RlcC5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBXaXphcmRTdGVwIHtcbiAgaWQ6IHN0cmluZztcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgY29tcG9uZW50OiBSZWFjdC5Db21wb25lbnRUeXBlPFdpemFyZFN0ZXBQcm9wcz47XG4gIGlzQ29tcGxldGU6IGJvb2xlYW47XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGNhblNraXA/OiBib29sZWFuO1xufVxuXG4vKipcbiAqIFByb3BzIHBhc3NlZCB0byBlYWNoIHdpemFyZCBzdGVwIGNvbXBvbmVudC5cbiAqIFByb3ZpZGVzIGRhdGEgaGFuZGxpbmcgYW5kIG5hdmlnYXRpb24gY2FsbGJhY2tzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFdpemFyZFN0ZXBQcm9wcyB7XG4gIF9kYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgb25EYXRhQ2hhbmdlOiAoX2RhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB2b2lkO1xuICBvblZhbGlkYXRpb25DaGFuZ2U6IChfaXNWYWxpZDogYm9vbGVhbikgPT4gdm9pZDtcbiAgb25OZXh0OiAoKSA9PiB2b2lkO1xuICBvblByZXZpb3VzOiAoKSA9PiB2b2lkO1xuICBpc0FjdGl2ZTogYm9vbGVhbjtcbn1cblxuLyoqXG4gKiBQcm9wcyBmb3IgdGhlIG1haW4gUmVnaXN0cmF0aW9uV2l6YXJkIGNvbXBvbmVudC5cbiAqIENvbmZpZ3VyZXMgdGhlIHdpemFyZCBzdGVwcyBhbmQgY29tcGxldGlvbiBoYW5kbGVycy5cbiAqL1xuaW50ZXJmYWNlIFJlZ2lzdHJhdGlvbldpemFyZFByb3BzIHtcbiAgc3RlcHM6IFdpemFyZFN0ZXBbXTtcbiAgaW5pdGlhbERhdGE/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgb25Db21wbGV0ZTogKF9kYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4gdm9pZDtcbiAgb25DYW5jZWw6ICgpID0+IHZvaWQ7XG4gIHRpdGxlPzogc3RyaW5nO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogTXVsdGktU3RlcCBSZWdpc3RyYXRpb24gV2l6YXJkIENvbXBvbmVudC5cbiAqXG4gKiBQcm92aWRlcyBhIGd1aWRlZCByZWdpc3RyYXRpb24gZmxvdyB3aXRoIHN0ZXAgdmFsaWRhdGlvbixcbiAqIHByb2dyZXNzIHRyYWNraW5nLCBhbmQgUXVlYmVjIGNvbXBsaWFuY2UgZmVhdHVyZXMuXG4gKiBAcGFyYW0gcm9vdDAgLSBDb21wb25lbnQgcHJvcHMgb2JqZWN0LlxuICogQHBhcmFtIHJvb3QwLnN0ZXBzIC0gQXJyYXkgb2Ygd2l6YXJkIHN0ZXBzIHRvIHJlbmRlci5cbiAqIEBwYXJhbSByb290MC5pbml0aWFsRGF0YSAtIEluaXRpYWwgZGF0YSBmb3IgdGhlIHdpemFyZC5cbiAqIEBwYXJhbSByb290MC5vbkNvbXBsZXRlIC0gRnVuY3Rpb24gY2FsbGVkIHdoZW4gd2l6YXJkIGlzIGNvbXBsZXRlZC5cbiAqIEBwYXJhbSByb290MC5vbkNhbmNlbCAtIEZ1bmN0aW9uIGNhbGxlZCB3aGVuIHdpemFyZCBpcyBjYW5jZWxsZWQuXG4gKiBAcGFyYW0gcm9vdDAudGl0bGUgLSBPcHRpb25hbCB0aXRsZSBmb3IgdGhlIHdpemFyZC5cbiAqIEBwYXJhbSByb290MC5jbGFzc05hbWUgLSBPcHRpb25hbCBDU1MgY2xhc3MgbmFtZS5cbiAqIEByZXR1cm5zIEpTWCBlbGVtZW50IGZvciB0aGUgcmVnaXN0cmF0aW9uIHdpemFyZC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIFJlZ2lzdHJhdGlvbldpemFyZCh7XG4gIHN0ZXBzOiBpbml0aWFsU3RlcHMsXG4gIGluaXRpYWxEYXRhID0ge30sXG4gIG9uQ29tcGxldGUsXG4gIG9uQ2FuY2VsLFxuICB0aXRsZSA9ICdJbnNjcmlwdGlvbicsXG4gIGNsYXNzTmFtZSA9ICcnLFxufTogUmVnaXN0cmF0aW9uV2l6YXJkUHJvcHMpIHtcbiAgY29uc3QgeyB0OiBfdCB9ID0gdXNlTGFuZ3VhZ2UoKTtcbiAgY29uc3QgW2N1cnJlbnRTdGVwSW5kZXgsIHNldEN1cnJlbnRTdGVwSW5kZXhdID0gdXNlU3RhdGUoMCk7XG4gIGNvbnN0IFtzdGVwcywgc2V0U3RlcHNdID0gdXNlU3RhdGU8V2l6YXJkU3RlcFtdPihpbml0aWFsU3RlcHMpO1xuICBjb25zdCBbd2l6YXJkRGF0YSwgc2V0V2l6YXJkRGF0YV0gPSB1c2VTdGF0ZShpbml0aWFsRGF0YSk7XG4gIGNvbnN0IFtpc1N1Ym1pdHRpbmcsIHNldElzU3VibWl0dGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgY29uc3QgY3VycmVudFN0ZXAgPSBzdGVwc1tjdXJyZW50U3RlcEluZGV4XTtcbiAgY29uc3QgaXNGaXJzdFN0ZXAgPSBjdXJyZW50U3RlcEluZGV4ID09PSAwO1xuICBjb25zdCBpc0xhc3RTdGVwID0gY3VycmVudFN0ZXBJbmRleCA9PT0gc3RlcHMubGVuZ3RoIC0gMTtcbiAgY29uc3QgY29tcGxldGVkU3RlcHMgPSBzdGVwcy5maWx0ZXIoKHN0ZXApID0+IHN0ZXAuaXNDb21wbGV0ZSkubGVuZ3RoO1xuICBjb25zdCBwcm9ncmVzcyA9IChjb21wbGV0ZWRTdGVwcyAvIHN0ZXBzLmxlbmd0aCkgKiAxMDA7XG5cbiAgLy8gVXBkYXRlIHN0ZXAgdmFsaWRhdGlvbiBzdGF0dXNcbiAgY29uc3QgdXBkYXRlU3RlcFZhbGlkYXRpb24gPSAoc3RlcElkOiBzdHJpbmcsIGlzVmFsaWQ6IGJvb2xlYW4pID0+IHtcbiAgICBzZXRTdGVwcygocHJldlN0ZXBzKSA9PlxuICAgICAgcHJldlN0ZXBzLm1hcCgoc3RlcCkgPT4gKHN0ZXAuaWQgPT09IHN0ZXBJZCA/IHsgLi4uc3RlcCwgaXNWYWxpZCB9IDogc3RlcCkpXG4gICAgKTtcbiAgfTtcblxuICAvLyBVcGRhdGUgc3RlcCBjb21wbGV0aW9uIHN0YXR1c1xuICBjb25zdCB1cGRhdGVTdGVwQ29tcGxldGlvbiA9IChzdGVwSWQ6IHN0cmluZywgaXNDb21wbGV0ZTogYm9vbGVhbikgPT4ge1xuICAgIHNldFN0ZXBzKChwcmV2U3RlcHMpID0+XG4gICAgICBwcmV2U3RlcHMubWFwKChzdGVwKSA9PiAoc3RlcC5pZCA9PT0gc3RlcElkID8geyAuLi5zdGVwLCBpc0NvbXBsZXRlIH0gOiBzdGVwKSlcbiAgICApO1xuICB9O1xuXG4gIC8vIEhhbmRsZSBkYXRhIGNoYW5nZXMgZnJvbSBzdGVwIGNvbXBvbmVudHMgLSBtZW1vaXplZCB0byBwcmV2ZW50IGluZmluaXRlIGxvb3BzXG4gIGNvbnN0IGhhbmRsZURhdGFDaGFuZ2UgPSB1c2VDYWxsYmFjaygoc3RlcERhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiB7XG4gICAgc2V0V2l6YXJkRGF0YSgocHJldkRhdGE6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSA9PiAoe1xuICAgICAgLi4ucHJldkRhdGEsXG4gICAgICBbY3VycmVudFN0ZXAuaWRdOiBzdGVwRGF0YSxcbiAgICB9KSk7XG4gIH0sIFtjdXJyZW50U3RlcC5pZF0pO1xuXG4gIC8vIEhhbmRsZSB2YWxpZGF0aW9uIGNoYW5nZXMgZnJvbSBzdGVwIGNvbXBvbmVudHMgLSBtZW1vaXplZCB0byBwcmV2ZW50IGluZmluaXRlIGxvb3BzXG4gIGNvbnN0IGhhbmRsZVZhbGlkYXRpb25DaGFuZ2UgPSB1c2VDYWxsYmFjaygoaXNWYWxpZDogYm9vbGVhbikgPT4ge1xuICAgIHNldFN0ZXBzKChwcmV2U3RlcHMpID0+XG4gICAgICBwcmV2U3RlcHMubWFwKChzdGVwKSA9PiAoc3RlcC5pZCA9PT0gY3VycmVudFN0ZXAuaWQgPyB7IC4uLnN0ZXAsIGlzVmFsaWQgfSA6IHN0ZXApKVxuICAgICk7XG4gICAgLy8gQXV0by1jb21wbGV0ZSBzdGVwIGlmIHZhbGlkIGFuZCBoYXMgcmVxdWlyZWQgZGF0YVxuICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICBzZXRTdGVwcygocHJldlN0ZXBzKSA9PlxuICAgICAgICBwcmV2U3RlcHMubWFwKChzdGVwKSA9PiAoc3RlcC5pZCA9PT0gY3VycmVudFN0ZXAuaWQgPyB7IC4uLnN0ZXAsIGlzQ29tcGxldGU6IHRydWUgfSA6IHN0ZXApKVxuICAgICAgKTtcbiAgICB9XG4gIH0sIFtjdXJyZW50U3RlcC5pZF0pO1xuXG4gIC8vIE5hdmlnYXRlIHRvIG5leHQgc3RlcFxuICBjb25zdCBoYW5kbGVOZXh0ID0gKCkgPT4ge1xuICAgIGlmIChjdXJyZW50U3RlcC5pc1ZhbGlkICYmICFpc0xhc3RTdGVwKSB7XG4gICAgICB1cGRhdGVTdGVwQ29tcGxldGlvbihjdXJyZW50U3RlcC5pZCwgdHJ1ZSk7XG4gICAgICBzZXRDdXJyZW50U3RlcEluZGV4KChwcmV2KSA9PiBwcmV2ICsgMSk7XG4gICAgfSBlbHNlIGlmIChpc0xhc3RTdGVwICYmIGN1cnJlbnRTdGVwLmlzVmFsaWQpIHtcbiAgICAgIGhhbmRsZUNvbXBsZXRlKCk7XG4gICAgfVxuICB9O1xuXG4gIC8vIE5hdmlnYXRlIHRvIHByZXZpb3VzIHN0ZXBcbiAgY29uc3QgaGFuZGxlUHJldmlvdXMgPSAoKSA9PiB7XG4gICAgaWYgKCFpc0ZpcnN0U3RlcCkge1xuICAgICAgc2V0Q3VycmVudFN0ZXBJbmRleCgocHJldikgPT4gcHJldiAtIDEpO1xuICAgIH1cbiAgfTtcblxuICAvLyBDb21wbGV0ZSB0aGUgd2l6YXJkXG4gIGNvbnN0IGhhbmRsZUNvbXBsZXRlID0gYXN5bmMgKCkgPT4ge1xuICAgIHNldElzU3VibWl0dGluZyh0cnVlKTtcbiAgICB0cnkge1xuICAgICAgLy8gQ29tYmluZSBhbGwgd2l6YXJkIGRhdGFcbiAgICAgIGNvbnN0IGNvbXBsZXRlRGF0YSA9IHtcbiAgICAgICAgLi4ud2l6YXJkRGF0YSxcbiAgICAgICAgW2N1cnJlbnRTdGVwLmlkXTogd2l6YXJkRGF0YVtjdXJyZW50U3RlcC5pZF0gfHwge30sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBvbkNvbXBsZXRlKGNvbXBsZXRlRGF0YSk7XG5cbiAgICAgIC8vIE9ubHkgbWFyayBmaW5hbCBzdGVwIGFzIGNvbXBsZXRlIGFmdGVyIHN1Y2Nlc3NmdWwgc3VibWlzc2lvblxuICAgICAgdXBkYXRlU3RlcENvbXBsZXRpb24oY3VycmVudFN0ZXAuaWQsIHRydWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBXaXphcmQgY29tcGxldGlvbiBlcnJvclxuICAgICAgLy8gUmVzZXQgc3RlcCBjb21wbGV0aW9uIG9uIGVycm9yIHRvIGFsbG93IHJldHJ5XG4gICAgICB1cGRhdGVTdGVwQ29tcGxldGlvbihjdXJyZW50U3RlcC5pZCwgZmFsc2UpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc1N1Ym1pdHRpbmcoZmFsc2UpO1xuICAgIH1cbiAgfTtcblxuICAvLyBKdW1wIHRvIHNwZWNpZmljIHN0ZXAgKG9ubHkgaWYgcHJldmlvdXMgc3RlcHMgYXJlIGNvbXBsZXRlKVxuICBjb25zdCBqdW1wVG9TdGVwID0gKHN0ZXBJbmRleDogbnVtYmVyKSA9PiB7XG4gICAgLy8gQ2FuIG9ubHkgZ28gdG8gY29tcGxldGVkIHN0ZXBzIG9yIHRoZSBuZXh0IHVuY29tcGxldGVkIHN0ZXBcbiAgICBjb25zdCBjYW5KdW1wID1cbiAgICAgIHN0ZXBJbmRleCA8PSBjdXJyZW50U3RlcEluZGV4IHx8IHN0ZXBzLnNsaWNlKDAsIHN0ZXBJbmRleCkuZXZlcnkoKHN0ZXApID0+IHN0ZXAuaXNDb21wbGV0ZSk7XG5cbiAgICBpZiAoY2FuSnVtcCkge1xuICAgICAgc2V0Q3VycmVudFN0ZXBJbmRleChzdGVwSW5kZXgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gKFxuICAgIDxkaXYgY2xhc3NOYW1lPXtgbWF4LXctNHhsIG14LWF1dG8gcC02ICR7Y2xhc3NOYW1lfWB9PlxuICAgICAgPENhcmQgY2xhc3NOYW1lPSdzaGFkb3cteGwgYm9yZGVyLTAnPlxuICAgICAgICA8Q2FyZEhlYWRlciBjbGFzc05hbWU9J3RleHQtY2VudGVyIHBiLTYnPlxuICAgICAgICAgIDxDYXJkVGl0bGUgY2xhc3NOYW1lPSd0ZXh0LTJ4bCBmb250LWJvbGQgdGV4dC1ncmF5LTkwMCc+e3RpdGxlfTwvQ2FyZFRpdGxlPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdtdC00Jz5cbiAgICAgICAgICAgIDxQcm9ncmVzcyB2YWx1ZT17cHJvZ3Jlc3N9IGNsYXNzTmFtZT0naC0yJyAvPlxuICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSd0ZXh0LXNtIHRleHQtZ3JheS02MDAgbXQtMic+XG4gICAgICAgICAgICAgIMOJdGFwZSB7Y3VycmVudFN0ZXBJbmRleCArIDF9IHN1ciB7c3RlcHMubGVuZ3RofSDigKIge01hdGgucm91bmQocHJvZ3Jlc3MpfSUgdGVybWluw6lcbiAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9DYXJkSGVhZGVyPlxuXG4gICAgICAgIDxDYXJkQ29udGVudCBjbGFzc05hbWU9J3NwYWNlLXktNic+XG4gICAgICAgICAgey8qIFN0ZXAgTmF2aWdhdGlvbiAqL31cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBqdXN0aWZ5LWNlbnRlcic+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0yIG1kOnNwYWNlLXgtNCBvdmVyZmxvdy14LWF1dG8gcGItMic+XG4gICAgICAgICAgICAgIHtzdGVwcy5tYXAoKHN0ZXAsIF9pbmRleCkgPT4gKFxuICAgICAgICAgICAgICAgIDxkaXYga2V5PXtzdGVwLmlkfSBjbGFzc05hbWU9J2ZsZXggaXRlbXMtY2VudGVyJz5cbiAgICAgICAgICAgICAgICAgIDxidXR0b25cbiAgICAgICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4ganVtcFRvU3RlcChfaW5kZXgpfVxuICAgICAgICAgICAgICAgICAgICBkaXNhYmxlZD17XG4gICAgICAgICAgICAgICAgICAgICAgX2luZGV4ID4gY3VycmVudFN0ZXBJbmRleCAmJlxuICAgICAgICAgICAgICAgICAgICAgICFzdGVwcy5zbGljZSgwLCBfaW5kZXgpLmV2ZXJ5KChzKSA9PiBzLmlzQ29tcGxldGUpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgXG4gICAgICAgICAgICAgICAgICAgICAgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdy04IGgtOCByb3VuZGVkLWZ1bGwgYm9yZGVyLTIgdHJhbnNpdGlvbi1hbGxcbiAgICAgICAgICAgICAgICAgICAgICAke1xuICAgICAgICAgICAgICAgICAgICAgICAgX2luZGV4ID09PSBjdXJyZW50U3RlcEluZGV4XG4gICAgICAgICAgICAgICAgICAgICAgICAgID8gJ2JvcmRlci1wcmltYXJ5IGJnLXByaW1hcnkgdGV4dC13aGl0ZSdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgOiBzdGVwLmlzQ29tcGxldGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdib3JkZXItZ3JlZW4tNTAwIGJnLWdyZWVuLTUwMCB0ZXh0LXdoaXRlIGN1cnNvci1wb2ludGVyIGhvdmVyOmJnLWdyZWVuLTYwMCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA6ICdib3JkZXItZ3JheS0zMDAgYmctd2hpdGUgdGV4dC1ncmF5LTQwMCdcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgJHtfaW5kZXggPD0gY3VycmVudFN0ZXBJbmRleCB8fCBzdGVwLmlzQ29tcGxldGUgPyAnY3Vyc29yLXBvaW50ZXInIDogJ2N1cnNvci1ub3QtYWxsb3dlZCd9XG4gICAgICAgICAgICAgICAgICAgIGB9XG4gICAgICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9e2Ake3N0ZXAudGl0bGV9IC0gJHtzdGVwLmlzQ29tcGxldGUgPyAnVGVybWluw6knIDogX2luZGV4ID09PSBjdXJyZW50U3RlcEluZGV4ID8gJ0VuIGNvdXJzJyA6ICdFbiBhdHRlbnRlJ31gfVxuICAgICAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgICAgICB7c3RlcC5pc0NvbXBsZXRlID8gKFxuICAgICAgICAgICAgICAgICAgICAgIDxDaGVja0NpcmNsZSBjbGFzc05hbWU9J3ctNSBoLTUnIC8+XG4gICAgICAgICAgICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSd0ZXh0LXNtIGZvbnQtbWVkaXVtJz57X2luZGV4ICsgMX08L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICA8L2J1dHRvbj5cblxuICAgICAgICAgICAgICAgICAge19pbmRleCA8IHN0ZXBzLmxlbmd0aCAtIDEgJiYgKFxuICAgICAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgdy04IG1kOnctMTYgaC0wLjUgJHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0ZXBzW19pbmRleCArIDFdLmlzQ29tcGxldGUgfHwgX2luZGV4IDwgY3VycmVudFN0ZXBJbmRleFxuICAgICAgICAgICAgICAgICAgICAgICAgICA/ICdiZy1ncmVlbi01MDAnXG4gICAgICAgICAgICAgICAgICAgICAgICAgIDogJ2JnLWdyYXktMzAwJ1xuICAgICAgICAgICAgICAgICAgICAgIH1gfVxuICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgKSl9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8L2Rpdj5cblxuICAgICAgICAgIHsvKiBDdXJyZW50IFN0ZXAgQ29udGVudCAqL31cbiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nbWluLWgtWzQwMHB4XSc+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ndGV4dC1jZW50ZXIgbWItNic+XG4gICAgICAgICAgICAgIDxoMyBjbGFzc05hbWU9J3RleHQteGwgZm9udC1zZW1pYm9sZCB0ZXh0LWdyYXktOTAwIG1iLTInPntjdXJyZW50U3RlcC50aXRsZX08L2gzPlxuICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtZ3JheS02MDAnPntjdXJyZW50U3RlcC5kZXNjcmlwdGlvbn08L3A+XG4gICAgICAgICAgICAgIHtjdXJyZW50U3RlcC5pc1ZhbGlkICYmIChcbiAgICAgICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD0nc2Vjb25kYXJ5JyBjbGFzc05hbWU9J210LTIgYmctZ3JlZW4tMTAwIHRleHQtZ3JlZW4tODAwJz5cbiAgICAgICAgICAgICAgICAgIDxDaGVja0NpcmNsZSBjbGFzc05hbWU9J3ctNCBoLTQgbXItMScgLz5cbiAgICAgICAgICAgICAgICAgIFZhbGlkw6lcbiAgICAgICAgICAgICAgICA8L0JhZGdlPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIHsvKiBSZW5kZXIgY3VycmVudCBzdGVwIGNvbXBvbmVudCAqL31cbiAgICAgICAgICAgIDxjdXJyZW50U3RlcC5jb21wb25lbnRcbiAgICAgICAgICAgICAgX2RhdGE9eyh3aXphcmREYXRhW2N1cnJlbnRTdGVwLmlkXSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgfHwge319XG4gICAgICAgICAgICAgIG9uRGF0YUNoYW5nZT17aGFuZGxlRGF0YUNoYW5nZX1cbiAgICAgICAgICAgICAgb25WYWxpZGF0aW9uQ2hhbmdlPXtoYW5kbGVWYWxpZGF0aW9uQ2hhbmdlfVxuICAgICAgICAgICAgICBvbk5leHQ9e2hhbmRsZU5leHR9XG4gICAgICAgICAgICAgIG9uUHJldmlvdXM9e2hhbmRsZVByZXZpb3VzfVxuICAgICAgICAgICAgICBpc0FjdGl2ZT17dHJ1ZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICB7LyogTmF2aWdhdGlvbiBCdXR0b25zICovfVxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWJldHdlZW4gcHQtNiBib3JkZXItdCBib3JkZXItZ3JheS0yMDAnPlxuICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXggc3BhY2UteC0zJz5cbiAgICAgICAgICAgICAgeyFpc0ZpcnN0U3RlcCAmJiAoXG4gICAgICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXtoYW5kbGVQcmV2aW91c30gdmFyaWFudD0nb3V0bGluZScgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlcic+XG4gICAgICAgICAgICAgICAgICA8QXJyb3dMZWZ0IGNsYXNzTmFtZT0ndy00IGgtNCBtci0yJyAvPlxuICAgICAgICAgICAgICAgICAgUHLDqWPDqWRlbnRcbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgKX1cblxuICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e29uQ2FuY2VsfSB2YXJpYW50PSdnaG9zdCcgY2xhc3NOYW1lPSd0ZXh0LWdyYXktNjAwJz5cbiAgICAgICAgICAgICAgICBBbm51bGVyXG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG5cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgb25DbGljaz17aGFuZGxlTmV4dH1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFjdXJyZW50U3RlcC5pc1ZhbGlkIHx8IGlzU3VibWl0dGluZ31cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPSdmbGV4IGl0ZW1zLWNlbnRlciBtaW4tdy1bMTIwcHhdJ1xuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICB7aXNTdWJtaXR0aW5nID8gKFxuICAgICAgICAgICAgICAgIDw+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nYW5pbWF0ZS1zcGluIHJvdW5kZWQtZnVsbCBoLTQgdy00IGJvcmRlci1iLTIgYm9yZGVyLXdoaXRlIG1yLTInIC8+XG4gICAgICAgICAgICAgICAgICBUcmFpdGVtZW50Li4uXG4gICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICkgOiBpc0xhc3RTdGVwID8gKFxuICAgICAgICAgICAgICAgICdUZXJtaW5lcidcbiAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICA8PlxuICAgICAgICAgICAgICAgICAgU3VpdmFudFxuICAgICAgICAgICAgICAgICAgPEFycm93UmlnaHQgY2xhc3NOYW1lPSd3LTQgaC00IG1sLTInIC8+XG4gICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9DYXJkQ29udGVudD5cbiAgICAgIDwvQ2FyZD5cbiAgICA8L2Rpdj5cbiAgKTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==