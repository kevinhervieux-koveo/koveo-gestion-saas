31c7edb85e3229432c9236584b67812b
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerBuildingRoutes = registerBuildingRoutes;
const db_1 = require("../db");
const schema_1 = require("@shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
const auth_1 = require("../auth");
const crypto_1 = __importDefault(require("crypto"));
/**
 * Handles creating or deleting residences when building totalUnits changes
 */
async function handleResidenceChanges(buildingId, organizationId, newTotalUnits, currentResidenceCount, totalFloors) {
    try {
        // Object storage hierarchy will be created automatically when documents are uploaded
        if (newTotalUnits > currentResidenceCount) {
            // Need to create more residences
            const residencesToCreate = newTotalUnits - currentResidenceCount;
            // Get existing residence numbers to avoid conflicts
            const existingResidences = await db_1.db
                .select({ unitNumber: schema_1.residences.unitNumber })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId));
            const existingUnitNumbers = new Set(existingResidences.map((r) => r.unitNumber));
            const floors = totalFloors || 1;
            const unitsPerFloor = Math.ceil(newTotalUnits / floors);
            const newResidences = [];
            let unitCounter = 1;
            for (let residenceIndex = 0; residenceIndex < residencesToCreate; residenceIndex++) {
                // Find next available unit number
                while (existingUnitNumbers.has(unitCounter.toString())) {
                    unitCounter++;
                }
                const floor = Math.ceil(unitCounter / unitsPerFloor);
                const unitNumber = unitCounter.toString();
                newResidences.push({
                    buildingId,
                    unitNumber,
                    floor: floor,
                    isActive: true,
                });
                existingUnitNumbers.add(unitNumber);
                unitCounter++;
            }
            // Create residences in batch
            if (newResidences.length > 0) {
                const createdResidences = await db_1.db.insert(schema_1.residences).values(newResidences).returning();
                // Create object storage hierarchy for each new residence
                for (const residence of createdResidences) {
                    try {
                        // TODO: Object storage service integration
                        // await objectStorageService.createResidenceHierarchy(
                        //   organizationId,
                        //   buildingId,
                        //   residence.id
                        // );
                    }
                    catch (storageError) {
                        console.error(`‚ö†Ô∏è Error creating storage hierarchy for residence ${residence.id}:`, storageError);
                        // Don't fail the whole operation for storage errors
                    }
                }
                console.log(`‚úÖ Created ${createdResidences.length} new residences for building ${buildingId}`);
            }
        }
        else if (newTotalUnits < currentResidenceCount) {
            // Need to delete some residences
            const residencesToDelete = currentResidenceCount - newTotalUnits;
            console.log(`üìâ Marking ${residencesToDelete} residences as inactive for building ${buildingId}`);
            // Get residences that can be safely deleted (no active user relationships)
            const deletableResidences = await db_1.db
                .select({ id: schema_1.residences.id, unitNumber: schema_1.residences.unitNumber })
                .from(schema_1.residences)
                .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userResidences.id) // No active user relationships
            ))
                .orderBy((0, drizzle_orm_1.sql) `${schema_1.residences.unitNumber}::integer DESC`) // Delete highest unit numbers first
                .limit(residencesToDelete);
            if (deletableResidences.length > 0) {
                const residenceIdsToDelete = deletableResidences.map((r) => r.id);
                // Soft delete residences (mark as inactive)
                await db_1.db
                    .update(schema_1.residences)
                    .set({
                    isActive: false,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIdsToDelete));
                console.log(`‚úÖ Marked ${deletableResidences.length} residences as inactive for building ${buildingId}`);
                // Log which residences couldn't be deleted due to user relationships
                const protectedCount = residencesToDelete - deletableResidences.length;
                if (protectedCount > 0) {
                    console.log(`‚ö†Ô∏è Could not delete ${protectedCount} residences - they have active user relationships`);
                }
            }
            else {
            }
        }
        else {
            console.log(`‚úì No residence changes needed - building ${buildingId} already has ${currentResidenceCount} residences`);
        }
        // Don't throw the error to avoid breaking the building update
    }
    catch (error) {
        console.error('‚ùå Error updating residence count:', error);
        // Don't throw the error to avoid breaking the building update
    }
}
/**
 *
 * @param app
 */
/**
 * RegisterBuildingRoutes function.
 * @param app
 * @returns Function result.
 */
function registerBuildingRoutes(app) {
    /**
     * GET /api/buildings - Retrieves buildings based on user role and organization access.
     * Used by bills page and other components.
     *
     * Access Control Logic:
     * - Admin: Can see all buildings if they have global access, or buildings in their organizations
     * - Manager: Can see only buildings in their organizations
     * - Others: No access to buildings list.
     */
    app.get('/api/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Role-based access control for buildings
            if (![
                'admin',
                'manager',
                'demo_manager',
                'demo_tenant',
                'demo_resident',
                'tenant',
                'resident',
            ].includes(user.role)) {
                return res.status(403).json({
                    message: 'Access denied. Insufficient permissions.',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            let buildingsQuery;
            // Admin users should always have access to all buildings, regardless of organization assignments
            if (user.role === 'admin') {
                buildingsQuery = db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    organizationName: schema_1.organizations.name,
                })
                    .from(schema_1.buildings)
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true))
                    .orderBy(schema_1.organizations.name, schema_1.buildings.name);
            }
            else {
                // Managers and other roles: only buildings from their organizations
                console.log(`üîç [BUILDINGS DEBUG] Non-admin user (${user.role}) - checking organization access. User ${user.id} organizations:`, user.organizations);
                if (!user.organizations || user.organizations.length === 0) {
                    console.log(`üîç [BUILDINGS DEBUG] User ${user.id} has no organizations, checking residence access...`);
                    // For tenant/resident roles: Get buildings through their residences
                    if (['tenant', 'resident', 'demo_tenant', 'demo_resident'].includes(user.role)) {
                        const userResidencesList = await db_1.db
                            .select({
                            buildingId: schema_1.residences.buildingId,
                        })
                            .from(schema_1.userResidences)
                            .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
                        console.log(`üîç [BUILDINGS DEBUG] Found ${userResidencesList.length} residences for user ${user.id}`);
                        if (userResidencesList.length === 0) {
                            return res.json([]); // No residences = no buildings
                        }
                        const accessibleBuildingIds = [
                            ...new Set(userResidencesList.map((ur) => ur.buildingId)),
                        ];
                        console.log(`üîç [BUILDINGS DEBUG] Accessible building IDs:`, accessibleBuildingIds);
                        buildingsQuery = db_1.db
                            .select({
                            id: schema_1.buildings.id,
                            name: schema_1.buildings.name,
                            address: schema_1.buildings.address,
                            city: schema_1.buildings.city,
                            province: schema_1.buildings.province,
                            postalCode: schema_1.buildings.postalCode,
                            buildingType: schema_1.buildings.buildingType,
                            yearBuilt: schema_1.buildings.yearBuilt,
                            totalUnits: schema_1.buildings.totalUnits,
                            totalFloors: schema_1.buildings.totalFloors,
                            parkingSpaces: schema_1.buildings.parkingSpaces,
                            storageSpaces: schema_1.buildings.storageSpaces,
                            organizationId: schema_1.buildings.organizationId,
                            isActive: schema_1.buildings.isActive,
                            createdAt: schema_1.buildings.createdAt,
                            organizationName: schema_1.organizations.name,
                        })
                            .from(schema_1.buildings)
                            .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.inArray)(schema_1.buildings.id, accessibleBuildingIds)))
                            .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                    }
                    else {
                        console.log(`üîç [BUILDINGS DEBUG] Manager/other role user ${user.id} has no organizations - returning empty result`);
                        return res.json([]); // No organizations = no buildings for managers/others
                    }
                }
                else {
                    // User has organizations - use organization-based access
                    buildingsQuery = db_1.db
                        .select({
                        id: schema_1.buildings.id,
                        name: schema_1.buildings.name,
                        address: schema_1.buildings.address,
                        city: schema_1.buildings.city,
                        province: schema_1.buildings.province,
                        postalCode: schema_1.buildings.postalCode,
                        buildingType: schema_1.buildings.buildingType,
                        yearBuilt: schema_1.buildings.yearBuilt,
                        totalUnits: schema_1.buildings.totalUnits,
                        totalFloors: schema_1.buildings.totalFloors,
                        parkingSpaces: schema_1.buildings.parkingSpaces,
                        storageSpaces: schema_1.buildings.storageSpaces,
                        organizationId: schema_1.buildings.organizationId,
                        isActive: schema_1.buildings.isActive,
                        createdAt: schema_1.buildings.createdAt,
                        organizationName: schema_1.organizations.name,
                    })
                        .from(schema_1.buildings)
                        .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, user.organizations)))
                        .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                }
            }
            const result = await buildingsQuery;
            res.json(result);
        }
        catch (error) {
            console.error('‚ùå Error fetching buildings:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch buildings',
            });
        }
    });
    /**
     * GET /api/manager/buildings - Retrieves buildings based on user role and associations.
     *
     * Access Control Logic:
     * - Admin: Can see all buildings in their organization + buildings where they have residences
     * - Manager: Can see all buildings in their organization + buildings where they have residences
     * - Resident/Tenant: Can see only buildings where they have residences (role is not used, only residence links).
     */
    app.get('/api/manager/buildings', async (req, res) => {
        // Authentication check
        if (!req.session?.userId && !req.session?.user) {
            return res.status(401).json({
                message: 'Authentication required',
                code: 'AUTH_REQUIRED',
            });
        }
        try {
            // Check for organizationId filter parameter
            const organizationIdFilter = req.query.organizationId;
            // Use session data directly for now
            let currentUser = req.user || req.session?.user;
            // If we only have userId, we need to fetch the user
            if (!currentUser && req.session?.userId) {
                // Import storage from the auth route pattern
                const { storage } = await Promise.resolve().then(() => __importStar(require('../storage')));
                currentUser = await storage.getUser(req.session.userId);
            }
            if (!currentUser) {
                return res.status(401).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            const accessibleBuildings = [];
            const buildingIds = new Set();
            // Check if user belongs to Koveo organization (special global access)
            const userOrgs = await db_1.db
                .select({
                organizationId: schema_1.userOrganizations.organizationId,
                organizationName: schema_1.organizations.name,
                canAccessAllOrganizations: schema_1.userOrganizations.canAccessAllOrganizations,
            })
                .from(schema_1.userOrganizations)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)));
            const hasGlobalAccess = currentUser.role === 'admin' ||
                userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
            if (hasGlobalAccess) {
                // Koveo users can see ALL buildings from ALL organizations (or filtered by organizationId)
                const whereConditions = [(0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)];
                if (organizationIdFilter) {
                    whereConditions.push((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationIdFilter));
                }
                const allBuildings = await db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    amenities: schema_1.buildings.amenities,
                    managementCompany: schema_1.buildings.managementCompany,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    updatedAt: schema_1.buildings.updatedAt,
                    organizationName: schema_1.organizations.name,
                    organizationType: schema_1.organizations.type,
                })
                    .from(schema_1.buildings)
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.and)(...whereConditions))
                    .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                // Add all buildings with special Koveo access type
                allBuildings.forEach((building) => {
                    if (!buildingIds.has(building.id)) {
                        buildingIds.add(building.id);
                        accessibleBuildings.push({
                            ...building,
                            accessType: 'koveo-global', // Special access type for Koveo users
                        });
                    }
                });
            }
            else {
                // Regular users: For Admin and Manager roles: Get buildings from their organizations only
                if (currentUser.role === 'admin' || currentUser.role === 'manager' || currentUser.role === 'demo_manager') {
                    if (userOrgs.length > 0) {
                        const orgIds = userOrgs.map((uo) => uo.organizationId);
                        // Get all buildings from these organizations (or filtered by organizationId)
                        const whereConditions = [(0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)];
                        if (organizationIdFilter) {
                            // Filter to specific organization if requested
                            whereConditions.push((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationIdFilter));
                        }
                        else {
                            // Otherwise show all organizations user has access to
                            whereConditions.push((0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, orgIds));
                        }
                        const orgBuildings = await db_1.db
                            .select({
                            id: schema_1.buildings.id,
                            name: schema_1.buildings.name,
                            address: schema_1.buildings.address,
                            city: schema_1.buildings.city,
                            province: schema_1.buildings.province,
                            postalCode: schema_1.buildings.postalCode,
                            buildingType: schema_1.buildings.buildingType,
                            yearBuilt: schema_1.buildings.yearBuilt,
                            totalUnits: schema_1.buildings.totalUnits,
                            totalFloors: schema_1.buildings.totalFloors,
                            parkingSpaces: schema_1.buildings.parkingSpaces,
                            storageSpaces: schema_1.buildings.storageSpaces,
                            amenities: schema_1.buildings.amenities,
                            managementCompany: schema_1.buildings.managementCompany,
                            organizationId: schema_1.buildings.organizationId,
                            isActive: schema_1.buildings.isActive,
                            createdAt: schema_1.buildings.createdAt,
                            updatedAt: schema_1.buildings.updatedAt,
                            organizationName: schema_1.organizations.name,
                            organizationType: schema_1.organizations.type,
                        })
                            .from(schema_1.buildings)
                            .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                            .where((0, drizzle_orm_1.and)(...whereConditions));
                        orgBuildings.forEach((building) => {
                            if (!buildingIds.has(building.id)) {
                                buildingIds.add(building.id);
                                accessibleBuildings.push({
                                    ...building,
                                    accessType: 'organization', // Track how user has access
                                });
                            }
                        });
                    }
                }
            }
            // For ALL roles (Admin, Manager, Resident, Tenant): Get buildings from their residences
            // This is the many-to-many relationship - users can have residences in different buildings
            const userResidenceRecords = await db_1.db
                .select({
                residenceId: schema_1.userResidences.residenceId,
                relationshipType: schema_1.userResidences.relationshipType,
            })
                .from(schema_1.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
            if (userResidenceRecords.length > 0) {
                const residenceIds = userResidenceRecords.map((ur) => ur.residenceId);
                // Get buildings through residences (filtered by organizationId if specified)
                const whereConditions = [(0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)];
                if (organizationIdFilter) {
                    whereConditions.push((0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, organizationIdFilter));
                }
                const residenceBuildings = await db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    amenities: schema_1.buildings.amenities,
                    managementCompany: schema_1.buildings.managementCompany,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    updatedAt: schema_1.buildings.updatedAt,
                    organizationName: schema_1.organizations.name,
                    organizationType: schema_1.organizations.type,
                    residenceId: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    floor: schema_1.residences.floor,
                })
                    .from(schema_1.residences)
                    .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, schema_1.buildings.id))
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.and)(...whereConditions));
                // Add residence-based buildings (avoid duplicates)
                residenceBuildings.forEach((building) => {
                    if (!buildingIds.has(building.id)) {
                        buildingIds.add(building.id);
                        accessibleBuildings.push({
                            id: building.id,
                            name: building.name,
                            address: building.address,
                            city: building.city,
                            province: building.province,
                            postalCode: building.postalCode,
                            buildingType: building.buildingType,
                            yearBuilt: building.yearBuilt,
                            totalUnits: building.totalUnits,
                            totalFloors: building.totalFloors,
                            parkingSpaces: building.parkingSpaces,
                            storageSpaces: building.storageSpaces,
                            amenities: building.amenities,
                            managementCompany: building.managementCompany,
                            organizationId: building.organizationId,
                            isActive: building.isActive,
                            createdAt: building.createdAt,
                            updatedAt: building.updatedAt,
                            organizationName: building.organizationName,
                            organizationType: building.organizationType,
                            accessType: 'residence', // Track how user has access
                            userResidence: {
                                residenceId: building.residenceId,
                                unitNumber: building.unitNumber,
                                floor: building.floor,
                            },
                        });
                    }
                    else {
                        // Building already exists, but we might want to add residence info
                        const existingBuilding = accessibleBuildings.find((b) => b.id === building.id);
                        if (existingBuilding && !existingBuilding.userResidence) {
                            existingBuilding.userResidence = {
                                residenceId: building.residenceId,
                                unitNumber: building.unitNumber,
                                floor: building.floor,
                            };
                            // Update access type if this is from both organization and residence
                            if (existingBuilding.accessType === 'organization') {
                                existingBuilding.accessType = 'both';
                            }
                        }
                    }
                });
            }
            // CRITICAL FIX: Skip statistics processing to avoid async errors
            // Just return buildings directly without complex statistics calculation
            const buildingsWithStats = accessibleBuildings.map(building => ({
                ...building,
                statistics: {
                    totalUnits: building.totalUnits || 0,
                    occupiedUnits: 0,
                    occupancyRate: 0,
                    vacantUnits: building.totalUnits || 0,
                },
            }));
            // Sort buildings by name
            buildingsWithStats.sort((a, b) => a.name.localeCompare(b.name));
            res.json({
                buildings: buildingsWithStats,
                meta: {
                    total: buildingsWithStats.length,
                    userRole: currentUser.role,
                    userId: currentUser.id,
                    organizationFilter: organizationIdFilter || null,
                },
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching manager buildings:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch buildings',
            });
        }
    });
    /**
     * GET /api/manager/buildings/:id - Get a specific building with detailed information
     * Uses the same access control logic as the list endpoint.
     */
    app.get('/api/manager/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user;
            const buildingId = req.params.id;
            if (!currentUser) {
                return res.status(401).json({
                    _error: 'Unauthorized',
                    message: 'Authentication required',
                });
            }
            console.log(`üìä Fetching building ${buildingId} for user ${currentUser.id} with role ${currentUser.role}`);
            let hasAccess = false;
            let accessType = '';
            // Check if user belongs to Koveo organization (special global access)
            const userOrgs = await db_1.db
                .select({
                organizationId: schema_1.userOrganizations.organizationId,
                organizationName: schema_1.organizations.name,
                canAccessAllOrganizations: schema_1.userOrganizations.canAccessAllOrganizations,
            })
                .from(schema_1.userOrganizations)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)));
            const hasGlobalAccess = currentUser.role === 'admin' ||
                userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
            if (hasGlobalAccess) {
                hasAccess = true;
                accessType = 'global';
            }
            else {
                // Check organization-based access for Admin and Manager
                if (currentUser.role === 'admin' || currentUser.role === 'manager') {
                    if (userOrgs.length > 0) {
                        const orgIds = userOrgs.map((uo) => uo.organizationId);
                        // Check if building belongs to user's organizations
                        const buildingOrg = await db_1.db
                            .select({ id: schema_1.buildings.id })
                            .from(schema_1.buildings)
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)));
                        if (buildingOrg.length > 0) {
                            hasAccess = true;
                            accessType = 'organization';
                        }
                    }
                }
            }
            // Check residence-based access for all roles
            if (!hasAccess) {
                const userResidenceAccess = await db_1.db
                    .select({ residenceId: schema_1.userResidences.residenceId })
                    .from(schema_1.userResidences)
                    .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
                if (userResidenceAccess.length > 0) {
                    hasAccess = true;
                    accessType = accessType ? 'both' : 'residence';
                }
            }
            if (!hasAccess) {
                return res.status(403).json({
                    _error: 'Forbidden',
                    message: 'You do not have access to this building',
                });
            }
            // Get building details
            const buildingData = await db_1.db
                .select({
                id: schema_1.buildings.id,
                name: schema_1.buildings.name,
                address: schema_1.buildings.address,
                city: schema_1.buildings.city,
                province: schema_1.buildings.province,
                postalCode: schema_1.buildings.postalCode,
                buildingType: schema_1.buildings.buildingType,
                yearBuilt: schema_1.buildings.yearBuilt,
                totalUnits: schema_1.buildings.totalUnits,
                totalFloors: schema_1.buildings.totalFloors,
                parkingSpaces: schema_1.buildings.parkingSpaces,
                storageSpaces: schema_1.buildings.storageSpaces,
                amenities: schema_1.buildings.amenities,
                managementCompany: schema_1.buildings.managementCompany,
                organizationId: schema_1.buildings.organizationId,
                isActive: schema_1.buildings.isActive,
                createdAt: schema_1.buildings.createdAt,
                updatedAt: schema_1.buildings.updatedAt,
                organizationName: schema_1.organizations.name,
                organizationType: schema_1.organizations.type,
                organizationAddress: schema_1.organizations.address,
                organizationCity: schema_1.organizations.city,
                organizationPhone: schema_1.organizations.phone,
                organizationEmail: schema_1.organizations.email,
            })
                .from(schema_1.buildings)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            if (buildingData.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            const building = buildingData[0];
            // Get all residences for this building
            const buildingResidences = await db_1.db
                .select({
                id: schema_1.residences.id,
                unitNumber: schema_1.residences.unitNumber,
                floor: schema_1.residences.floor,
                squareFootage: schema_1.residences.squareFootage,
                bedrooms: schema_1.residences.bedrooms,
                bathrooms: schema_1.residences.bathrooms,
                balcony: schema_1.residences.balcony,
                parkingSpaceNumbers: schema_1.residences.parkingSpaceNumbers,
                storageSpaceNumbers: schema_1.residences.storageSpaceNumbers,
                monthlyFees: schema_1.residences.monthlyFees,
                isActive: schema_1.residences.isActive,
            })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            // Get user's residences in this building if any
            let userResidencesInBuilding = [];
            const userResidenceRecords = await db_1.db
                .select({
                residenceId: schema_1.userResidences.residenceId,
                relationshipType: schema_1.userResidences.relationshipType,
                startDate: schema_1.userResidences.startDate,
                endDate: schema_1.userResidences.endDate,
            })
                .from(schema_1.userResidences)
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
            if (userResidenceRecords.length > 0) {
                userResidencesInBuilding = userResidenceRecords.map((ur) => {
                    const residence = buildingResidences.find((r) => r.id === ur.residenceId);
                    return {
                        ...residence,
                        relationshipType: ur.relationshipType,
                        startDate: ur.startDate,
                        endDate: ur.endDate,
                    };
                });
            }
            // Calculate statistics
            const occupiedUnits = buildingResidences.length;
            const occupancyRate = building.totalUnits > 0 ? Math.round((occupiedUnits / building.totalUnits) * 100) : 0;
            res.json({
                ...building,
                accessType,
                statistics: {
                    totalUnits: building.totalUnits,
                    occupiedUnits,
                    occupancyRate,
                    vacantUnits: building.totalUnits - occupiedUnits,
                    totalResidences: buildingResidences.length,
                },
                userResidences: userResidencesInBuilding,
                // Only include full residence list for managers/admins
                residences: currentUser.role === 'admin' || currentUser.role === 'manager'
                    ? buildingResidences
                    : undefined,
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching building details:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch building details',
            });
        }
    });
    /**
     * POST /api/admin/buildings - Create a new building (Admin only).
     */
    app.post('/api/admin/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingData = req.body;
            // Validate required fields
            if (!buildingData.name || !buildingData.organizationId) {
                return res.status(400).json({
                    _error: 'Validation error',
                    message: 'Building name and organization are required',
                });
            }
            // Create building with ID
            const buildingId = crypto_1.default.randomUUID();
            const newBuilding = await db_1.db
                .insert(schema_1.buildings)
                .values({
                id: buildingId,
                name: buildingData.name,
                address: buildingData.address || '',
                city: buildingData.city || '',
                province: buildingData.province || 'QC',
                postalCode: buildingData.postalCode || '',
                buildingType: buildingData.buildingType || 'condo',
                yearBuilt: buildingData.yearBuilt,
                totalUnits: buildingData.totalUnits || 0,
                totalFloors: buildingData.totalFloors,
                parkingSpaces: buildingData.parkingSpaces,
                storageSpaces: buildingData.storageSpaces,
                amenities: buildingData.amenities ? JSON.stringify(buildingData.amenities) : null,
                managementCompany: buildingData.managementCompany,
                organizationId: buildingData.organizationId,
                isActive: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            })
                .returning();
            // Building storage hierarchy will be created automatically when documents are uploaded
            console.log('Building created - storage hierarchy will be created on first document upload');
            // Auto-generate residences if totalUnits is specified and <= 300
            if (buildingData.totalUnits &&
                buildingData.totalUnits > 0 &&
                buildingData.totalUnits <= 300) {
                try {
                    const totalUnits = buildingData.totalUnits;
                    const totalFloors = buildingData.totalFloors || 1;
                    const unitsPerFloor = Math.ceil(totalUnits / totalFloors);
                    const residencesToCreate = [];
                    for (let unit = 1; unit <= totalUnits; unit++) {
                        const floor = Math.ceil(unit / unitsPerFloor);
                        const unitOnFloor = ((unit - 1) % unitsPerFloor) + 1;
                        const unitNumber = `${floor}${unitOnFloor.toString().padStart(2, '0')}`;
                        residencesToCreate.push({
                            buildingId: buildingId,
                            unitNumber,
                            floor,
                            isActive: true,
                        });
                    }
                    // Insert all residences at once
                    const createdResidences = await db_1.db
                        .insert(schema_1.residences)
                        .values(residencesToCreate)
                        .returning();
                    console.log(`‚úÖ Auto-generated ${createdResidences.length} residences for building ${buildingId}`);
                    // TODO: Object storage service integration
                    // Create object storage hierarchy for each residence
                    // for (const residence of createdResidences) {
                    //   await objectStorageService.createResidenceHierarchy(
                    //     buildingData.organizationId,
                    //     buildingId,
                    //     residence.id
                    //   );
                    // }
                }
                catch (___residenceError) {
                    console.error('‚ö†Ô∏è Error auto-generating residences:', ___residenceError);
                    // Don't fail the building creation if residence generation fails
                }
            }
            res.status(201).json({
                message: 'Building created successfully',
                building: newBuilding[0],
            });
        }
        catch (error) {
            console.error('‚ùå Error creating building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to create building',
            });
        }
    });
    /**
     * GET /api/buildings/:id/residences-for-deletion - Get list of residences that can be selected for deletion
     * Only admins can access this endpoint
     */
    app.get('/api/buildings/:id/residences-for-deletion', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const buildingId = req.params.id;
            const maxToSelect = parseInt(req.query.maxToSelect) || 10;
            if (!user) {
                return res.status(401).json({ message: 'Authentication required' });
            }
            // Only admins can delete residences
            if (user.role !== 'admin') {
                return res.status(403).json({ message: 'Only admins can access residence deletion options' });
            }
            const { getResidencesForSelection } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
            const residencesToSelect = await getResidencesForSelection(buildingId, maxToSelect);
            res.json({
                residences: residencesToSelect,
                message: `Found ${residencesToSelect.length} residences available for deletion`
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching residences for deletion:', error);
            res.status(500).json({ message: 'Failed to fetch residences for deletion' });
        }
    });
    /**
     * DELETE /api/buildings/:id/residences - Delete selected residences
     * Only admins can delete residences
     */
    app.delete('/api/buildings/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const buildingId = req.params.id;
            const { residenceIds } = req.body;
            if (!user) {
                return res.status(401).json({ message: 'Authentication required' });
            }
            // Only admins can delete residences
            if (user.role !== 'admin') {
                return res.status(403).json({ message: 'Only admins can delete residences' });
            }
            if (!Array.isArray(residenceIds) || residenceIds.length === 0) {
                return res.status(400).json({ message: 'residenceIds array is required' });
            }
            const { deleteSelectedResidences } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
            const result = await deleteSelectedResidences(buildingId, residenceIds, user.role);
            res.json({
                success: true,
                deletedCount: result.deletedCount,
                documentsDeleted: result.documentsDeleted,
                message: `Successfully deleted ${result.deletedCount} residences and ${result.documentsDeleted} associated documents`
            });
        }
        catch (error) {
            console.error('‚ùå Error deleting residences:', error);
            res.status(500).json({ message: error.message || 'Failed to delete residences' });
        }
    });
    /**
     * PUT /api/admin/buildings/:id - Update a building (Admin and Manager).
     */
    app.put('/api/admin/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin or manager
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin' && currentUser.role !== 'manager') {
                return res.status(403).json({
                    message: 'Admin or Manager access required',
                    code: 'ADMIN_MANAGER_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            const buildingData = req.body;
            // Validate required fields
            if (!buildingData.name || !buildingData.organizationId) {
                return res.status(400).json({
                    _error: 'Validation error',
                    message: 'Building name and organization are required',
                });
            }
            // Check if building exists
            const existingBuilding = await db_1.db
                .select()
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (existingBuilding.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Check current number of active residences
            const currentResidences = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)::int` })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            const currentResidenceCount = currentResidences[0]?.count || 0;
            const newTotalUnits = buildingData.totalUnits || 0;
            const previousTotalUnits = existingBuilding[0].totalUnits || 0;
            console.log(`üîÑ Building ${buildingId}: ${previousTotalUnits} ‚Üí ${newTotalUnits} units (currently has ${currentResidenceCount} active residences)`);
            // Update building
            const updatedBuilding = await db_1.db
                .update(schema_1.buildings)
                .set({
                name: buildingData.name,
                address: buildingData.address || '',
                city: buildingData.city || '',
                province: buildingData.province || 'QC',
                postalCode: buildingData.postalCode || '',
                buildingType: buildingData.buildingType || 'condo',
                yearBuilt: buildingData.yearBuilt,
                totalUnits: newTotalUnits,
                totalFloors: buildingData.totalFloors,
                parkingSpaces: buildingData.parkingSpaces,
                storageSpaces: buildingData.storageSpaces,
                amenities: buildingData.amenities ? JSON.stringify(buildingData.amenities) : null,
                managementCompany: buildingData.managementCompany,
                organizationId: buildingData.organizationId,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .returning();
            // Handle residence count changes with new admin-only functionality
            if (newTotalUnits !== previousTotalUnits) {
                console.log(`üè† Building units changed from ${previousTotalUnits} to ${newTotalUnits}, adjusting residences...`);
                // Only admins can adjust residence counts
                if (currentUser.role !== 'admin') {
                    return res.status(403).json({
                        message: 'Only admins can increase or decrease building residence counts',
                        code: 'ADMIN_REQUIRED_FOR_RESIDENCE_CHANGES',
                    });
                }
                const { adjustResidenceCount } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
                const adjustmentResult = await adjustResidenceCount(buildingId, existingBuilding[0].organizationId, newTotalUnits, previousTotalUnits, buildingData.totalFloors || existingBuilding[0].totalFloors || 1);
                // If residences need to be decreased, return the selection list to user
                if (adjustmentResult.action === 'decreased' && adjustmentResult.residencesToSelect) {
                    return res.json({
                        message: 'Building updated, but residence count needs to be reduced',
                        buildingUpdated: true,
                        needsResidenceSelection: true,
                        residencesToSelect: adjustmentResult.residencesToSelect,
                        instruction: `Please select ${previousTotalUnits - newTotalUnits} residences to delete from the list provided. Use DELETE /api/buildings/${buildingId}/residences with the selected residence IDs.`
                    });
                }
            }
            res.json({
                message: 'Building updated successfully',
                building: updatedBuilding[0],
            });
        }
        catch (error) {
            console.error('‚ùå Error updating building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to update building',
            });
        }
    });
    /**
     * DELETE /api/admin/buildings/:id - Delete a building (Admin only).
     */
    app.delete('/api/admin/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const existingBuilding = await db_1.db
                .select()
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (existingBuilding.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Soft delete by setting isActive to false
            await db_1.db
                .update(schema_1.buildings)
                .set({
                isActive: false,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            // Object storage cleanup will be handled automatically
            console.log('Building deleted - storage cleanup will be handled automatically');
            res.json({
                message: 'Building deleted successfully',
            });
        }
        catch (error) {
            console.error('‚ùå Error deleting building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to delete building',
            });
        }
    });
    /**
     * GET /api/admin/buildings/:id/deletion-impact - Get deletion impact analysis
     * Shows what will be deleted when removing a building.
     */
    app.get('/api/admin/buildings/:id/deletion-impact', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const building = await db_1.db
                .select({ id: schema_1.buildings.id, name: schema_1.buildings.name })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Count residences in this building
            const residencesCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            // Count documents associated with this building or its residences
            const documentsCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema_1.documents)
                .where((0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId), (0, drizzle_orm_1.sql) `${schema_1.documents.residenceId} IN (SELECT id FROM residences WHERE building_id = ${buildingId})`));
            // Count users who will become orphaned (only have relationships with residences in this building)
            const potentialOrphansCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(distinct ${schema_1.userResidences.userId})` })
                .from(schema_1.userResidences)
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.userResidences.userId, schema_1.users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema_1.users.isActive, true)));
            const impact = {
                building: building[0],
                residences: residencesCount[0]?.count || 0,
                documents: documentsCount[0]?.count || 0,
                potentialOrphanedUsers: potentialOrphansCount[0]?.count || 0,
            };
            res.json(impact);
        }
        catch (error) {
            console.error('‚ùå Error analyzing deletion impact:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to analyze deletion impact',
            });
        }
    });
    /**
     * DELETE /api/admin/buildings/:id/cascade - Cascade delete a building
     * Replaces the simple delete with cascading delete that removes residences and documents. Users are preserved for data safety.
     */
    app.delete('/api/admin/buildings/:id/cascade', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const building = await db_1.db
                .select({ id: schema_1.buildings.id, name: schema_1.buildings.name })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Start transaction for cascading delete
            await db_1.db.transaction(async (tx) => {
                // 1. Get all residences in this building
                const buildingResidences = await tx
                    .select({ id: schema_1.residences.id })
                    .from(schema_1.residences)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
                const residenceIds = buildingResidences.map((r) => r.id);
                if (residenceIds.length > 0) {
                    // 2. Delete documents associated with building or its residences
                    await tx
                        .delete(schema_1.documents)
                        .where((0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId), (0, drizzle_orm_1.inArray)(schema_1.documents.residenceId, residenceIds)));
                    // 3. Soft delete user-residence relationships
                    await tx
                        .update(schema_1.userResidences)
                        .set({ isActive: false, updatedAt: new Date() })
                        .where((0, drizzle_orm_1.inArray)(schema_1.userResidences.residenceId, residenceIds));
                    // 4. DISABLED: User deletion prohibited for data safety
                    const orphanedUsers = await tx
                        .select({ id: schema_1.users.id })
                        .from(schema_1.users)
                        .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userOrganizations.userId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                        .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userResidences.userId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userOrganizations.userId), (0, drizzle_orm_1.isNull)(schema_1.userResidences.userId)));
                    if (orphanedUsers.length > 0) {
                        const orphanedUserIds = orphanedUsers.map((u) => u.id);
                        await tx
                            .update(schema_1.users)
                            .set({ isActive: false, updatedAt: new Date() })
                            .where((0, drizzle_orm_1.inArray)(schema_1.users.id, orphanedUserIds));
                    }
                    // 5. Soft delete residences
                    await tx
                        .update(schema_1.residences)
                        .set({ isActive: false, updatedAt: new Date() })
                        .where((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds));
                }
                else {
                    // Still delete documents associated directly with the building
                    await tx.delete(schema_1.documents).where((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId));
                }
                // 6. Finally, soft delete the building
                await tx
                    .update(schema_1.buildings)
                    .set({ isActive: false, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            });
            // Clean up object storage hierarchy for the deleted building
            // Get organization ID from building before deletion
            const buildingOrg = await db_1.db
                .select({ organizationId: schema_1.buildings.organizationId })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (buildingOrg.length > 0) {
                // Object storage cleanup will be handled automatically
                console.log('Building deleted - storage cleanup will be handled automatically');
            }
            res.json({
                message: 'Building and related entities deleted successfully',
                deletedBuilding: building[0].name,
            });
        }
        catch (error) {
            console.error('‚ùå Error during cascade delete:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to delete building and related entities',
            });
        }
    });
    /**
     * GET /api/buildings/:buildingId/residences - Get residences within a specific building
     * Returns residences that the authenticated user has access to within the specified building
     */
    app.get('/api/buildings/:buildingId/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            const { buildingId } = req.params;
            console.log(`üìä Fetching residences for building ${buildingId} by user ${currentUser.id} with role ${currentUser.role}`);
            // First, verify the user has access to this building
            const userBuildingAccess = await db_1.db
                .select({
                id: schema_1.buildings.id,
                organizationId: schema_1.buildings.organizationId
            })
                .from(schema_1.buildings)
                .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.buildings.organizationId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                .leftJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, schema_1.buildings.id))
                .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(currentUser.role, 'admin'), // Admin can access any building
            (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), // User linked to organization
            (0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id) // User has residence in building
            )))
                .limit(1);
            if (userBuildingAccess.length === 0) {
                return res.status(403).json({
                    message: 'Access denied to this building',
                    code: 'BUILDING_ACCESS_DENIED',
                });
            }
            // Get residences within the building that the user can access
            let residencesQuery;
            if (currentUser.role === 'admin') {
                // Admin can see all residences in the building
                residencesQuery = db_1.db
                    .select({
                    id: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    floor: schema_1.residences.floor,
                    buildingId: schema_1.residences.buildingId,
                })
                    .from(schema_1.residences)
                    .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.buildings.id, schema_1.residences.buildingId))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)))
                    .orderBy(schema_1.residences.unitNumber);
            }
            else {
                // Non-admin users can only see residences they have access to
                residencesQuery = db_1.db
                    .select({
                    id: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    floor: schema_1.residences.floor,
                    buildingId: schema_1.residences.buildingId,
                })
                    .from(schema_1.residences)
                    .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.buildings.id, schema_1.residences.buildingId))
                    .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                    .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.buildings.organizationId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), // User has this residence
                (0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id) // User is linked to organization (managers can see all residences)
                )))
                    .orderBy(schema_1.residences.unitNumber);
            }
            const residencesList = await residencesQuery;
            // Add building name to each residence for better UX
            const buildingInfo = await db_1.db
                .select({ name: schema_1.buildings.name })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            const residencesWithBuildingName = residencesList.map(residence => ({
                ...residence,
                buildingName: buildingInfo[0]?.name || 'Unknown Building'
            }));
            console.log(`‚úÖ Found ${residencesList.length} residences for user ${currentUser.id} in building ${buildingId}`);
            res.json(residencesWithBuildingName);
        }
        catch (error) {
            console.error('‚ùå Error fetching building residences:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch residences for building',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2J1aWxkaW5ncy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1LQSx3REFxNkNDO0FBdmtERCw4QkFBMkI7QUFDM0IsMkNBUXdCO0FBQ3hCLDZDQUF1RTtBQUN2RSxrQ0FBc0M7QUFDdEMsb0RBQTRCO0FBRTVCOztHQUVHO0FBQ0gsS0FBSyxVQUFVLHNCQUFzQixDQUNuQyxVQUFrQixFQUNsQixjQUFzQixFQUN0QixhQUFxQixFQUNyQixxQkFBNkIsRUFDN0IsV0FBb0I7SUFFcEIsSUFBSSxDQUFDO1FBQ0gscUZBQXFGO1FBRXJGLElBQUksYUFBYSxHQUFHLHFCQUFxQixFQUFFLENBQUM7WUFDMUMsaUNBQWlDO1lBQ2pDLE1BQU0sa0JBQWtCLEdBQUcsYUFBYSxHQUFHLHFCQUFxQixDQUFDO1lBRWpFLG9EQUFvRDtZQUNwRCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sT0FBRTtpQkFDaEMsTUFBTSxDQUFDLEVBQUUsVUFBVSxFQUFFLG1CQUFVLENBQUMsVUFBVSxFQUFFLENBQUM7aUJBQzdDLElBQUksQ0FBQyxtQkFBVSxDQUFDO2lCQUNoQixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFFaEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBRWpGLE1BQU0sTUFBTSxHQUFHLFdBQVcsSUFBSSxDQUFDLENBQUM7WUFDaEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDLENBQUM7WUFFeEQsTUFBTSxhQUFhLEdBQUcsRUFBRSxDQUFDO1lBQ3pCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztZQUVw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QyxFQUFFLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUksRUFBRSxDQUFDO2lCQUNoQyxJQUFJLENBQUMsa0JBQVMsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDO2lCQUNuQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFWixNQUFNLDBCQUEwQixHQUFHLGNBQWMsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNsRSxHQUFHLFNBQVM7Z0JBQ1osWUFBWSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLElBQUksa0JBQWtCO2FBQzFELENBQUMsQ0FBQyxDQUFDO1lBRUosT0FBTyxDQUFDLEdBQUcsQ0FBQyxXQUFXLGNBQWMsQ0FBQyxNQUFNLHdCQUF3QixXQUFXLENBQUMsRUFBRSxnQkFBZ0IsVUFBVSxFQUFFLENBQUMsQ0FBQztZQUVoSCxHQUFHLENBQUMsSUFBSSxDQUFDLDBCQUEwQixDQUFDLENBQUM7UUFDdkMsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM5RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsTUFBTSxFQUFFLHVCQUF1QjtnQkFDL0IsT0FBTyxFQUFFLHlDQUF5QzthQUNuRCxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvc2VydmVyL2FwaS9idWlsZGluZ3MudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhwcmVzcyB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQge1xuICBidWlsZGluZ3MsXG4gIG9yZ2FuaXphdGlvbnMsXG4gIHJlc2lkZW5jZXMsXG4gIHVzZXJSZXNpZGVuY2VzLFxuICB1c2VyT3JnYW5pemF0aW9ucyxcbiAgdXNlcnMsXG4gIGRvY3VtZW50cyxcbn0gZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgZXEsIGFuZCwgb3IsIGluQXJyYXksIHNxbCwgaXNOdWxsLCBjb3VudCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbi8qKlxuICogSGFuZGxlcyBjcmVhdGluZyBvciBkZWxldGluZyByZXNpZGVuY2VzIHdoZW4gYnVpbGRpbmcgdG90YWxVbml0cyBjaGFuZ2VzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlc2lkZW5jZUNoYW5nZXMoXG4gIGJ1aWxkaW5nSWQ6IHN0cmluZyxcbiAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyxcbiAgbmV3VG90YWxVbml0czogbnVtYmVyLFxuICBjdXJyZW50UmVzaWRlbmNlQ291bnQ6IG51bWJlcixcbiAgdG90YWxGbG9vcnM/OiBudW1iZXJcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIC8vIE9iamVjdCBzdG9yYWdlIGhpZXJhcmNoeSB3aWxsIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSB3aGVuIGRvY3VtZW50cyBhcmUgdXBsb2FkZWRcblxuICAgIGlmIChuZXdUb3RhbFVuaXRzID4gY3VycmVudFJlc2lkZW5jZUNvdW50KSB7XG4gICAgICAvLyBOZWVkIHRvIGNyZWF0ZSBtb3JlIHJlc2lkZW5jZXNcbiAgICAgIGNvbnN0IHJlc2lkZW5jZXNUb0NyZWF0ZSA9IG5ld1RvdGFsVW5pdHMgLSBjdXJyZW50UmVzaWRlbmNlQ291bnQ7XG5cbiAgICAgIC8vIEdldCBleGlzdGluZyByZXNpZGVuY2UgbnVtYmVycyB0byBhdm9pZCBjb25mbGljdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIgfSlcbiAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCkpO1xuXG4gICAgICBjb25zdCBleGlzdGluZ1VuaXROdW1iZXJzID0gbmV3IFNldChleGlzdGluZ1Jlc2lkZW5jZXMubWFwKChyKSA9PiByLnVuaXROdW1iZXIpKTtcblxuICAgICAgY29uc3QgZmxvb3JzID0gdG90YWxGbG9vcnMgfHwgMTtcbiAgICAgIGNvbnN0IHVuaXRzUGVyRmxvb3IgPSBNYXRoLmNlaWwobmV3VG90YWxVbml0cyAvIGZsb29ycyk7XG5cbiAgICAgIGNvbnN0IG5ld1Jlc2lkZW5jZXMgPSBbXTtcbiAgICAgIGxldCB1bml0Q291bnRlciA9IDE7XG5cbiAgICAgIGZvciAobGV0IHJlc2lkZW5jZUluZGV4ID0gMDsgcmVzaWRlbmNlSW5kZXggPCByZXNpZGVuY2VzVG9DcmVhdGU7IHJlc2lkZW5jZUluZGV4KyspIHtcbiAgICAgICAgLy8gRmluZCBuZXh0IGF2YWlsYWJsZSB1bml0IG51bWJlclxuICAgICAgICB3aGlsZSAoZXhpc3RpbmdVbml0TnVtYmVycy5oYXModW5pdENvdW50ZXIudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgICB1bml0Q291bnRlcisrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmxvb3IgPSBNYXRoLmNlaWwodW5pdENvdW50ZXIgLyB1bml0c1BlckZsb29yKTtcbiAgICAgICAgY29uc3QgdW5pdE51bWJlciA9IHVuaXRDb3VudGVyLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgbmV3UmVzaWRlbmNlcy5wdXNoKHtcbiAgICAgICAgICBidWlsZGluZ0lkLFxuICAgICAgICAgIHVuaXROdW1iZXIsXG4gICAgICAgICAgZmxvb3I6IGZsb29yLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICBleGlzdGluZ1VuaXROdW1iZXJzLmFkZCh1bml0TnVtYmVyKTtcbiAgICAgICAgdW5pdENvdW50ZXIrKztcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHJlc2lkZW5jZXMgaW4gYmF0Y2hcbiAgICAgIGlmIChuZXdSZXNpZGVuY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgY3JlYXRlZFJlc2lkZW5jZXMgPSBhd2FpdCBkYi5pbnNlcnQocmVzaWRlbmNlcykudmFsdWVzKG5ld1Jlc2lkZW5jZXMpLnJldHVybmluZygpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBvYmplY3Qgc3RvcmFnZSBoaWVyYXJjaHkgZm9yIGVhY2ggbmV3IHJlc2lkZW5jZVxuICAgICAgICBmb3IgKGNvbnN0IHJlc2lkZW5jZSBvZiBjcmVhdGVkUmVzaWRlbmNlcykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPYmplY3Qgc3RvcmFnZSBzZXJ2aWNlIGludGVncmF0aW9uXG4gICAgICAgICAgICAvLyBhd2FpdCBvYmplY3RTdG9yYWdlU2VydmljZS5jcmVhdGVSZXNpZGVuY2VIaWVyYXJjaHkoXG4gICAgICAgICAgICAvLyAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgLy8gICBidWlsZGluZ0lkLFxuICAgICAgICAgICAgLy8gICByZXNpZGVuY2UuaWRcbiAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgfSBjYXRjaCAoc3RvcmFnZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgICBg4pqg77iPIEVycm9yIGNyZWF0aW5nIHN0b3JhZ2UgaGllcmFyY2h5IGZvciByZXNpZGVuY2UgJHtyZXNpZGVuY2UuaWR9OmAsXG4gICAgICAgICAgICAgIHN0b3JhZ2VFcnJvclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIHdob2xlIG9wZXJhdGlvbiBmb3Igc3RvcmFnZSBlcnJvcnNcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg4pyFIENyZWF0ZWQgJHtjcmVhdGVkUmVzaWRlbmNlcy5sZW5ndGh9IG5ldyByZXNpZGVuY2VzIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmV3VG90YWxVbml0cyA8IGN1cnJlbnRSZXNpZGVuY2VDb3VudCkge1xuICAgICAgLy8gTmVlZCB0byBkZWxldGUgc29tZSByZXNpZGVuY2VzXG4gICAgICBjb25zdCByZXNpZGVuY2VzVG9EZWxldGUgPSBjdXJyZW50UmVzaWRlbmNlQ291bnQgLSBuZXdUb3RhbFVuaXRzO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5OJIE1hcmtpbmcgJHtyZXNpZGVuY2VzVG9EZWxldGV9IHJlc2lkZW5jZXMgYXMgaW5hY3RpdmUgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gXG4gICAgICApO1xuXG4gICAgICAvLyBHZXQgcmVzaWRlbmNlcyB0aGF0IGNhbiBiZSBzYWZlbHkgZGVsZXRlZCAobm8gYWN0aXZlIHVzZXIgcmVsYXRpb25zaGlwcylcbiAgICAgIGNvbnN0IGRlbGV0YWJsZVJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgaWQ6IHJlc2lkZW5jZXMuaWQsIHVuaXROdW1iZXI6IHJlc2lkZW5jZXMudW5pdE51bWJlciB9KVxuICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgdXNlclJlc2lkZW5jZXMsXG4gICAgICAgICAgYW5kKGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICApXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBpc051bGwodXNlclJlc2lkZW5jZXMuaWQpIC8vIE5vIGFjdGl2ZSB1c2VyIHJlbGF0aW9uc2hpcHNcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLm9yZGVyQnkoc3FsYCR7cmVzaWRlbmNlcy51bml0TnVtYmVyfTo6aW50ZWdlciBERVNDYCkgLy8gRGVsZXRlIGhpZ2hlc3QgdW5pdCBudW1iZXJzIGZpcnN0XG4gICAgICAgIC5saW1pdChyZXNpZGVuY2VzVG9EZWxldGUpO1xuXG4gICAgICBpZiAoZGVsZXRhYmxlUmVzaWRlbmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHJlc2lkZW5jZUlkc1RvRGVsZXRlID0gZGVsZXRhYmxlUmVzaWRlbmNlcy5tYXAoKHIpID0+IHIuaWQpO1xuXG4gICAgICAgIC8vIFNvZnQgZGVsZXRlIHJlc2lkZW5jZXMgKG1hcmsgYXMgaW5hY3RpdmUpXG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGluQXJyYXkocmVzaWRlbmNlcy5pZCwgcmVzaWRlbmNlSWRzVG9EZWxldGUpKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg4pyFIE1hcmtlZCAke2RlbGV0YWJsZVJlc2lkZW5jZXMubGVuZ3RofSByZXNpZGVuY2VzIGFzIGluYWN0aXZlIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIExvZyB3aGljaCByZXNpZGVuY2VzIGNvdWxkbid0IGJlIGRlbGV0ZWQgZHVlIHRvIHVzZXIgcmVsYXRpb25zaGlwc1xuICAgICAgICBjb25zdCBwcm90ZWN0ZWRDb3VudCA9IHJlc2lkZW5jZXNUb0RlbGV0ZSAtIGRlbGV0YWJsZVJlc2lkZW5jZXMubGVuZ3RoO1xuICAgICAgICBpZiAocHJvdGVjdGVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg4pqg77iPIENvdWxkIG5vdCBkZWxldGUgJHtwcm90ZWN0ZWRDb3VudH0gcmVzaWRlbmNlcyAtIHRoZXkgaGF2ZSBhY3RpdmUgdXNlciByZWxhdGlvbnNoaXBzYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg4pyTIE5vIHJlc2lkZW5jZSBjaGFuZ2VzIG5lZWRlZCAtIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH0gYWxyZWFkeSBoYXMgJHtjdXJyZW50UmVzaWRlbmNlQ291bnR9IHJlc2lkZW5jZXNgXG4gICAgICApO1xuICAgIH1cbiAgICAvLyBEb24ndCB0aHJvdyB0aGUgZXJyb3IgdG8gYXZvaWQgYnJlYWtpbmcgdGhlIGJ1aWxkaW5nIHVwZGF0ZVxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHJlc2lkZW5jZSBjb3VudDonLCBlcnJvcik7XG4gICAgLy8gRG9uJ3QgdGhyb3cgdGhlIGVycm9yIHRvIGF2b2lkIGJyZWFraW5nIHRoZSBidWlsZGluZyB1cGRhdGVcbiAgfVxufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gYXBwXG4gKi9cbi8qKlxuICogUmVnaXN0ZXJCdWlsZGluZ1JvdXRlcyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBhcHBcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQnVpbGRpbmdSb3V0ZXMoYXBwOiBFeHByZXNzKTogdm9pZCB7XG4gIC8qKlxuICAgKiBHRVQgL2FwaS9idWlsZGluZ3MgLSBSZXRyaWV2ZXMgYnVpbGRpbmdzIGJhc2VkIG9uIHVzZXIgcm9sZSBhbmQgb3JnYW5pemF0aW9uIGFjY2Vzcy5cbiAgICogVXNlZCBieSBiaWxscyBwYWdlIGFuZCBvdGhlciBjb21wb25lbnRzLlxuICAgKlxuICAgKiBBY2Nlc3MgQ29udHJvbCBMb2dpYzpcbiAgICogLSBBZG1pbjogQ2FuIHNlZSBhbGwgYnVpbGRpbmdzIGlmIHRoZXkgaGF2ZSBnbG9iYWwgYWNjZXNzLCBvciBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgKiAtIE1hbmFnZXI6IENhbiBzZWUgb25seSBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgKiAtIE90aGVyczogTm8gYWNjZXNzIHRvIGJ1aWxkaW5ncyBsaXN0LlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9idWlsZGluZ3MnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wgZm9yIGJ1aWxkaW5nc1xuICAgICAgaWYgKFxuICAgICAgICAhW1xuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICAgJ21hbmFnZXInLFxuICAgICAgICAgICdkZW1vX21hbmFnZXInLFxuICAgICAgICAgICdkZW1vX3RlbmFudCcsXG4gICAgICAgICAgJ2RlbW9fcmVzaWRlbnQnLFxuICAgICAgICAgICd0ZW5hbnQnLFxuICAgICAgICAgICdyZXNpZGVudCcsXG4gICAgICAgIF0uaW5jbHVkZXModXNlci5yb2xlKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQuIEluc3VmZmljaWVudCBwZXJtaXNzaW9ucy4nLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuXG4gICAgICBsZXQgYnVpbGRpbmdzUXVlcnk7XG5cbiAgICAgIC8vIEFkbWluIHVzZXJzIHNob3VsZCBhbHdheXMgaGF2ZSBhY2Nlc3MgdG8gYWxsIGJ1aWxkaW5ncywgcmVnYXJkbGVzcyBvZiBvcmdhbml6YXRpb24gYXNzaWdubWVudHNcbiAgICAgIGlmICh1c2VyLnJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgYnVpbGRpbmdzUXVlcnkgPSBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgYWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgICAgICBjaXR5OiBidWlsZGluZ3MuY2l0eSxcbiAgICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ3MucHJvdmluY2UsXG4gICAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ3MucG9zdGFsQ29kZSxcbiAgICAgICAgICAgIGJ1aWxkaW5nVHlwZTogYnVpbGRpbmdzLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICAgIHllYXJCdWlsdDogYnVpbGRpbmdzLnllYXJCdWlsdCxcbiAgICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5ncy50b3RhbFVuaXRzLFxuICAgICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5ncy50b3RhbEZsb29ycyxcbiAgICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5ncy5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgICAgc3RvcmFnZVNwYWNlczogYnVpbGRpbmdzLnN0b3JhZ2VTcGFjZXMsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lLCBidWlsZGluZ3MubmFtZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBNYW5hZ2VycyBhbmQgb3RoZXIgcm9sZXM6IG9ubHkgYnVpbGRpbmdzIGZyb20gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg8J+UjSBbQlVJTERJTkdTIERFQlVHXSBOb24tYWRtaW4gdXNlciAoJHt1c2VyLnJvbGV9KSAtIGNoZWNraW5nIG9yZ2FuaXphdGlvbiBhY2Nlc3MuIFVzZXIgJHt1c2VyLmlkfSBvcmdhbml6YXRpb25zOmAsXG4gICAgICAgICAgdXNlci5vcmdhbml6YXRpb25zXG4gICAgICAgICk7XG4gICAgICAgIGlmICghdXNlci5vcmdhbml6YXRpb25zIHx8IHVzZXIub3JnYW5pemF0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDwn5SNIFtCVUlMRElOR1MgREVCVUddIFVzZXIgJHt1c2VyLmlkfSBoYXMgbm8gb3JnYW5pemF0aW9ucywgY2hlY2tpbmcgcmVzaWRlbmNlIGFjY2Vzcy4uLmBcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gRm9yIHRlbmFudC9yZXNpZGVudCByb2xlczogR2V0IGJ1aWxkaW5ncyB0aHJvdWdoIHRoZWlyIHJlc2lkZW5jZXNcbiAgICAgICAgICBpZiAoWyd0ZW5hbnQnLCAncmVzaWRlbnQnLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKHVzZXIucm9sZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VzTGlzdCA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20odXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4ocmVzaWRlbmNlcywgZXEodXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoYW5kKGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCksIGVxKHVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgYPCflI0gW0JVSUxESU5HUyBERUJVR10gRm91bmQgJHt1c2VyUmVzaWRlbmNlc0xpc3QubGVuZ3RofSByZXNpZGVuY2VzIGZvciB1c2VyICR7dXNlci5pZH1gXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAodXNlclJlc2lkZW5jZXNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oW10pOyAvLyBObyByZXNpZGVuY2VzID0gbm8gYnVpbGRpbmdzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IFtcbiAgICAgICAgICAgICAgLi4ubmV3IFNldCh1c2VyUmVzaWRlbmNlc0xpc3QubWFwKCh1cikgPT4gdXIuYnVpbGRpbmdJZCkpLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5SNIFtCVUlMRElOR1MgREVCVUddIEFjY2Vzc2libGUgYnVpbGRpbmcgSURzOmAsIGFjY2Vzc2libGVCdWlsZGluZ0lkcyk7XG5cbiAgICAgICAgICAgIGJ1aWxkaW5nc1F1ZXJ5ID0gZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgICAgICBjaXR5OiBidWlsZGluZ3MuY2l0eSxcbiAgICAgICAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdzLnByb3ZpbmNlLFxuICAgICAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nVHlwZTogYnVpbGRpbmdzLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5ncy55ZWFyQnVpbHQsXG4gICAgICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5ncy50b3RhbEZsb29ycyxcbiAgICAgICAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ3MucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICAgIGlzQWN0aXZlOiBidWlsZGluZ3MuaXNBY3RpdmUsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSwgaW5BcnJheShidWlsZGluZ3MuaWQsIGFjY2Vzc2libGVCdWlsZGluZ0lkcykpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lLCBidWlsZGluZ3MubmFtZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5SNIFtCVUlMRElOR1MgREVCVUddIE1hbmFnZXIvb3RoZXIgcm9sZSB1c2VyICR7dXNlci5pZH0gaGFzIG5vIG9yZ2FuaXphdGlvbnMgLSByZXR1cm5pbmcgZW1wdHkgcmVzdWx0YCk7XG4gICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oW10pOyAvLyBObyBvcmdhbml6YXRpb25zID0gbm8gYnVpbGRpbmdzIGZvciBtYW5hZ2Vycy9vdGhlcnNcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gVXNlciBoYXMgb3JnYW5pemF0aW9ucyAtIHVzZSBvcmdhbml6YXRpb24tYmFzZWQgYWNjZXNzXG4gICAgICAgICAgYnVpbGRpbmdzUXVlcnkgPSBkYlxuICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgICAgY2l0eTogYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ3MucHJvdmluY2UsXG4gICAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgICAgIHllYXJCdWlsdDogYnVpbGRpbmdzLnllYXJCdWlsdCxcbiAgICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsXG4gICAgICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5ncy5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25OYW1lOiBvcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgLmlubmVySm9pbihvcmdhbml6YXRpb25zLCBlcShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICBpbkFycmF5KGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgdXNlci5vcmdhbml6YXRpb25zKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAub3JkZXJCeShvcmdhbml6YXRpb25zLm5hbWUsIGJ1aWxkaW5ncy5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZGluZ3NRdWVyeTtcblxuICAgICAgcmVzLmpzb24ocmVzdWx0KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYnVpbGRpbmdzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBidWlsZGluZ3MnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvbWFuYWdlci9idWlsZGluZ3MgLSBSZXRyaWV2ZXMgYnVpbGRpbmdzIGJhc2VkIG9uIHVzZXIgcm9sZSBhbmQgYXNzb2NpYXRpb25zLlxuICAgKlxuICAgKiBBY2Nlc3MgQ29udHJvbCBMb2dpYzpcbiAgICogLSBBZG1pbjogQ2FuIHNlZSBhbGwgYnVpbGRpbmdzIGluIHRoZWlyIG9yZ2FuaXphdGlvbiArIGJ1aWxkaW5ncyB3aGVyZSB0aGV5IGhhdmUgcmVzaWRlbmNlc1xuICAgKiAtIE1hbmFnZXI6IENhbiBzZWUgYWxsIGJ1aWxkaW5ncyBpbiB0aGVpciBvcmdhbml6YXRpb24gKyBidWlsZGluZ3Mgd2hlcmUgdGhleSBoYXZlIHJlc2lkZW5jZXNcbiAgICogLSBSZXNpZGVudC9UZW5hbnQ6IENhbiBzZWUgb25seSBidWlsZGluZ3Mgd2hlcmUgdGhleSBoYXZlIHJlc2lkZW5jZXMgKHJvbGUgaXMgbm90IHVzZWQsIG9ubHkgcmVzaWRlbmNlIGxpbmtzKS5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvbWFuYWdlci9idWlsZGluZ3MnLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIC8vIEF1dGhlbnRpY2F0aW9uIGNoZWNrXG4gICAgaWYgKCFyZXEuc2Vzc2lvbj8udXNlcklkICYmICFyZXEuc2Vzc2lvbj8udXNlcikge1xuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGZvciBvcmdhbml6YXRpb25JZCBmaWx0ZXIgcGFyYW1ldGVyXG4gICAgICBjb25zdCBvcmdhbml6YXRpb25JZEZpbHRlciA9IHJlcS5xdWVyeS5vcmdhbml6YXRpb25JZCBhcyBzdHJpbmc7XG4gICAgICBcbiAgICAgIFxuICAgICAgLy8gVXNlIHNlc3Npb24gZGF0YSBkaXJlY3RseSBmb3Igbm93XG4gICAgICBsZXQgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcblxuICAgICAgLy8gSWYgd2Ugb25seSBoYXZlIHVzZXJJZCwgd2UgbmVlZCB0byBmZXRjaCB0aGUgdXNlclxuICAgICAgaWYgKCFjdXJyZW50VXNlciAmJiByZXEuc2Vzc2lvbj8udXNlcklkKSB7XG4gICAgICAgIC8vIEltcG9ydCBzdG9yYWdlIGZyb20gdGhlIGF1dGggcm91dGUgcGF0dGVyblxuICAgICAgICBjb25zdCB7IHN0b3JhZ2UgfSA9IGF3YWl0IGltcG9ydCgnLi4vc3RvcmFnZScpO1xuICAgICAgICBjdXJyZW50VXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihyZXEuc2Vzc2lvbi51c2VySWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuXG4gICAgICBjb25zdCBhY2Nlc3NpYmxlQnVpbGRpbmdzOiBhbnlbXSA9IFtdO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZHMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBiZWxvbmdzIHRvIEtvdmVvIG9yZ2FuaXphdGlvbiAoc3BlY2lhbCBnbG9iYWwgYWNjZXNzKVxuICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogdXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgIGNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnM6IHVzZXJPcmdhbml6YXRpb25zLmNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnMsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSwgZXEodXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBoYXNHbG9iYWxBY2Nlc3MgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nIHx8XG4gICAgICAgIHVzZXJPcmdzLnNvbWUoKG9yZykgPT4gb3JnLm9yZ2FuaXphdGlvbk5hbWUgPT09ICdLb3ZlbycgfHwgb3JnLmNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnMpO1xuXG4gICAgICBpZiAoaGFzR2xvYmFsQWNjZXNzKSB7XG5cbiAgICAgICAgLy8gS292ZW8gdXNlcnMgY2FuIHNlZSBBTEwgYnVpbGRpbmdzIGZyb20gQUxMIG9yZ2FuaXphdGlvbnMgKG9yIGZpbHRlcmVkIGJ5IG9yZ2FuaXphdGlvbklkKVxuICAgICAgICBjb25zdCB3aGVyZUNvbmRpdGlvbnMgPSBbZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKV07XG4gICAgICAgIGlmIChvcmdhbml6YXRpb25JZEZpbHRlcikge1xuICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWRGaWx0ZXIpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgYWxsQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgICAgY2l0eTogYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdzLnByb3ZpbmNlLFxuICAgICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5ncy55ZWFyQnVpbHQsXG4gICAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ3MudG90YWxVbml0cyxcbiAgICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsXG4gICAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ3MucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgICAgYW1lbml0aWVzOiBidWlsZGluZ3MuYW1lbml0aWVzLFxuICAgICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IGJ1aWxkaW5ncy5tYW5hZ2VtZW50Q29tcGFueSxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBidWlsZGluZ3MudXBkYXRlZEF0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uVHlwZTogb3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgIC5pbm5lckpvaW4ob3JnYW5pemF0aW9ucywgZXEoYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgICAud2hlcmUoYW5kKC4uLndoZXJlQ29uZGl0aW9ucykpXG4gICAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lLCBidWlsZGluZ3MubmFtZSk7XG5cbiAgICAgICAgLy8gQWRkIGFsbCBidWlsZGluZ3Mgd2l0aCBzcGVjaWFsIEtvdmVvIGFjY2VzcyB0eXBlXG4gICAgICAgIGFsbEJ1aWxkaW5ncy5mb3JFYWNoKChidWlsZGluZykgPT4ge1xuICAgICAgICAgIGlmICghYnVpbGRpbmdJZHMuaGFzKGJ1aWxkaW5nLmlkKSkge1xuICAgICAgICAgICAgYnVpbGRpbmdJZHMuYWRkKGJ1aWxkaW5nLmlkKTtcbiAgICAgICAgICAgIGFjY2Vzc2libGVCdWlsZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgIC4uLmJ1aWxkaW5nLFxuICAgICAgICAgICAgICBhY2Nlc3NUeXBlOiAna292ZW8tZ2xvYmFsJywgLy8gU3BlY2lhbCBhY2Nlc3MgdHlwZSBmb3IgS292ZW8gdXNlcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZWd1bGFyIHVzZXJzOiBGb3IgQWRtaW4gYW5kIE1hbmFnZXIgcm9sZXM6IEdldCBidWlsZGluZ3MgZnJvbSB0aGVpciBvcmdhbml6YXRpb25zIG9ubHlcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicgfHwgY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInIHx8IGN1cnJlbnRVc2VyLnJvbGUgPT09ICdkZW1vX21hbmFnZXInKSB7XG4gICAgICAgICAgaWYgKHVzZXJPcmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG9yZ0lkcyA9IHVzZXJPcmdzLm1hcCgodW8pID0+IHVvLm9yZ2FuaXphdGlvbklkKTtcblxuICAgICAgICAgICAgLy8gR2V0IGFsbCBidWlsZGluZ3MgZnJvbSB0aGVzZSBvcmdhbml6YXRpb25zIChvciBmaWx0ZXJlZCBieSBvcmdhbml6YXRpb25JZClcbiAgICAgICAgICAgIGNvbnN0IHdoZXJlQ29uZGl0aW9ucyA9IFtlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXTtcbiAgICAgICAgICAgIGlmIChvcmdhbml6YXRpb25JZEZpbHRlcikge1xuICAgICAgICAgICAgICAvLyBGaWx0ZXIgdG8gc3BlY2lmaWMgb3JnYW5pemF0aW9uIGlmIHJlcXVlc3RlZFxuICAgICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChlcShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkRmlsdGVyKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAvLyBPdGhlcndpc2Ugc2hvdyBhbGwgb3JnYW5pemF0aW9ucyB1c2VyIGhhcyBhY2Nlc3MgdG9cbiAgICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goaW5BcnJheShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ0lkcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICBjb25zdCBvcmdCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgICAgICAgIGNpdHk6IGJ1aWxkaW5ncy5jaXR5LFxuICAgICAgICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ3MucHJvdmluY2UsXG4gICAgICAgICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ3MuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgICAgICAgIHllYXJCdWlsdDogYnVpbGRpbmdzLnllYXJCdWlsdCxcbiAgICAgICAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ3MudG90YWxVbml0cyxcbiAgICAgICAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5ncy5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdzLmFtZW5pdGllcyxcbiAgICAgICAgICAgICAgICBtYW5hZ2VtZW50Q29tcGFueTogYnVpbGRpbmdzLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICAgICAgICBjcmVhdGVkQXQ6IGJ1aWxkaW5ncy5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgICAgdXBkYXRlZEF0OiBidWlsZGluZ3MudXBkYXRlZEF0LFxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgICBvcmdhbml6YXRpb25UeXBlOiBvcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihvcmdhbml6YXRpb25zLCBlcShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoYW5kKC4uLndoZXJlQ29uZGl0aW9ucykpO1xuXG4gICAgICAgICAgICBvcmdCdWlsZGluZ3MuZm9yRWFjaCgoYnVpbGRpbmcpID0+IHtcbiAgICAgICAgICAgICAgaWYgKCFidWlsZGluZ0lkcy5oYXMoYnVpbGRpbmcuaWQpKSB7XG4gICAgICAgICAgICAgICAgYnVpbGRpbmdJZHMuYWRkKGJ1aWxkaW5nLmlkKTtcbiAgICAgICAgICAgICAgICBhY2Nlc3NpYmxlQnVpbGRpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgLi4uYnVpbGRpbmcsXG4gICAgICAgICAgICAgICAgICBhY2Nlc3NUeXBlOiAnb3JnYW5pemF0aW9uJywgLy8gVHJhY2sgaG93IHVzZXIgaGFzIGFjY2Vzc1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gRm9yIEFMTCByb2xlcyAoQWRtaW4sIE1hbmFnZXIsIFJlc2lkZW50LCBUZW5hbnQpOiBHZXQgYnVpbGRpbmdzIGZyb20gdGhlaXIgcmVzaWRlbmNlc1xuICAgICAgLy8gVGhpcyBpcyB0aGUgbWFueS10by1tYW55IHJlbGF0aW9uc2hpcCAtIHVzZXJzIGNhbiBoYXZlIHJlc2lkZW5jZXMgaW4gZGlmZmVyZW50IGJ1aWxkaW5nc1xuICAgICAgY29uc3QgdXNlclJlc2lkZW5jZVJlY29yZHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICByZXNpZGVuY2VJZDogdXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogdXNlclJlc2lkZW5jZXMucmVsYXRpb25zaGlwVHlwZSxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20odXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShhbmQoZXEodXNlclJlc2lkZW5jZXMudXNlcklkLCBjdXJyZW50VXNlci5pZCksIGVxKHVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICBpZiAodXNlclJlc2lkZW5jZVJlY29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCByZXNpZGVuY2VJZHMgPSB1c2VyUmVzaWRlbmNlUmVjb3Jkcy5tYXAoKHVyKSA9PiB1ci5yZXNpZGVuY2VJZCk7XG5cbiAgICAgICAgLy8gR2V0IGJ1aWxkaW5ncyB0aHJvdWdoIHJlc2lkZW5jZXMgKGZpbHRlcmVkIGJ5IG9yZ2FuaXphdGlvbklkIGlmIHNwZWNpZmllZClcbiAgICAgICAgY29uc3Qgd2hlcmVDb25kaXRpb25zID0gW2luQXJyYXkocmVzaWRlbmNlcy5pZCwgcmVzaWRlbmNlSWRzKSwgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKV07XG4gICAgICAgIGlmIChvcmdhbml6YXRpb25JZEZpbHRlcikge1xuICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWRGaWx0ZXIpKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc3QgcmVzaWRlbmNlQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgICAgY2l0eTogYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdzLnByb3ZpbmNlLFxuICAgICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5ncy55ZWFyQnVpbHQsXG4gICAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ3MudG90YWxVbml0cyxcbiAgICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsXG4gICAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ3MucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgICAgYW1lbml0aWVzOiBidWlsZGluZ3MuYW1lbml0aWVzLFxuICAgICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IGJ1aWxkaW5ncy5tYW5hZ2VtZW50Q29tcGFueSxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBidWlsZGluZ3MudXBkYXRlZEF0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uVHlwZTogb3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICBmbG9vcjogcmVzaWRlbmNlcy5mbG9vcixcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgLndoZXJlKGFuZCguLi53aGVyZUNvbmRpdGlvbnMpKTtcblxuICAgICAgICAvLyBBZGQgcmVzaWRlbmNlLWJhc2VkIGJ1aWxkaW5ncyAoYXZvaWQgZHVwbGljYXRlcylcbiAgICAgICAgcmVzaWRlbmNlQnVpbGRpbmdzLmZvckVhY2goKGJ1aWxkaW5nKSA9PiB7XG4gICAgICAgICAgaWYgKCFidWlsZGluZ0lkcy5oYXMoYnVpbGRpbmcuaWQpKSB7XG4gICAgICAgICAgICBidWlsZGluZ0lkcy5hZGQoYnVpbGRpbmcuaWQpO1xuICAgICAgICAgICAgYWNjZXNzaWJsZUJ1aWxkaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgaWQ6IGJ1aWxkaW5nLmlkLFxuICAgICAgICAgICAgICBuYW1lOiBidWlsZGluZy5uYW1lLFxuICAgICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZy5hZGRyZXNzLFxuICAgICAgICAgICAgICBjaXR5OiBidWlsZGluZy5jaXR5LFxuICAgICAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmcucHJvdmluY2UsXG4gICAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5nLnBvc3RhbENvZGUsXG4gICAgICAgICAgICAgIGJ1aWxkaW5nVHlwZTogYnVpbGRpbmcuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5nLnllYXJCdWlsdCxcbiAgICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmcudG90YWxVbml0cyxcbiAgICAgICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5nLnRvdGFsRmxvb3JzLFxuICAgICAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZy5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgICAgICBhbWVuaXRpZXM6IGJ1aWxkaW5nLmFtZW5pdGllcyxcbiAgICAgICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IGJ1aWxkaW5nLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmcub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICAgIGlzQWN0aXZlOiBidWlsZGluZy5pc0FjdGl2ZSxcbiAgICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZy5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgIHVwZGF0ZWRBdDogYnVpbGRpbmcudXBkYXRlZEF0LFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25OYW1lOiBidWlsZGluZy5vcmdhbml6YXRpb25OYW1lLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25UeXBlOiBidWlsZGluZy5vcmdhbml6YXRpb25UeXBlLFxuICAgICAgICAgICAgICBhY2Nlc3NUeXBlOiAncmVzaWRlbmNlJywgLy8gVHJhY2sgaG93IHVzZXIgaGFzIGFjY2Vzc1xuICAgICAgICAgICAgICB1c2VyUmVzaWRlbmNlOiB7XG4gICAgICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IGJ1aWxkaW5nLnJlc2lkZW5jZUlkLFxuICAgICAgICAgICAgICAgIHVuaXROdW1iZXI6IGJ1aWxkaW5nLnVuaXROdW1iZXIsXG4gICAgICAgICAgICAgICAgZmxvb3I6IGJ1aWxkaW5nLmZsb29yLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIEJ1aWxkaW5nIGFscmVhZHkgZXhpc3RzLCBidXQgd2UgbWlnaHQgd2FudCB0byBhZGQgcmVzaWRlbmNlIGluZm9cbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nQnVpbGRpbmcgPSBhY2Nlc3NpYmxlQnVpbGRpbmdzLmZpbmQoKGIpID0+IGIuaWQgPT09IGJ1aWxkaW5nLmlkKTtcbiAgICAgICAgICAgIGlmIChleGlzdGluZ0J1aWxkaW5nICYmICFleGlzdGluZ0J1aWxkaW5nLnVzZXJSZXNpZGVuY2UpIHtcbiAgICAgICAgICAgICAgZXhpc3RpbmdCdWlsZGluZy51c2VyUmVzaWRlbmNlID0ge1xuICAgICAgICAgICAgICAgIHJlc2lkZW5jZUlkOiBidWlsZGluZy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgICAgICB1bml0TnVtYmVyOiBidWlsZGluZy51bml0TnVtYmVyLFxuICAgICAgICAgICAgICAgIGZsb29yOiBidWlsZGluZy5mbG9vcixcbiAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgLy8gVXBkYXRlIGFjY2VzcyB0eXBlIGlmIHRoaXMgaXMgZnJvbSBib3RoIG9yZ2FuaXphdGlvbiBhbmQgcmVzaWRlbmNlXG4gICAgICAgICAgICAgIGlmIChleGlzdGluZ0J1aWxkaW5nLmFjY2Vzc1R5cGUgPT09ICdvcmdhbml6YXRpb24nKSB7XG4gICAgICAgICAgICAgICAgZXhpc3RpbmdCdWlsZGluZy5hY2Nlc3NUeXBlID0gJ2JvdGgnO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ1JJVElDQUwgRklYOiBTa2lwIHN0YXRpc3RpY3MgcHJvY2Vzc2luZyB0byBhdm9pZCBhc3luYyBlcnJvcnNcbiAgICAgIC8vIEp1c3QgcmV0dXJuIGJ1aWxkaW5ncyBkaXJlY3RseSB3aXRob3V0IGNvbXBsZXggc3RhdGlzdGljcyBjYWxjdWxhdGlvblxuICAgICAgXG4gICAgICBjb25zdCBidWlsZGluZ3NXaXRoU3RhdHMgPSBhY2Nlc3NpYmxlQnVpbGRpbmdzLm1hcChidWlsZGluZyA9PiAoe1xuICAgICAgICAuLi5idWlsZGluZyxcbiAgICAgICAgc3RhdGlzdGljczoge1xuICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5nLnRvdGFsVW5pdHMgfHwgMCxcbiAgICAgICAgICBvY2N1cGllZFVuaXRzOiAwLFxuICAgICAgICAgIG9jY3VwYW5jeVJhdGU6IDAsXG4gICAgICAgICAgdmFjYW50VW5pdHM6IGJ1aWxkaW5nLnRvdGFsVW5pdHMgfHwgMCxcbiAgICAgICAgfSxcbiAgICAgIH0pKTtcblxuICAgICAgLy8gU29ydCBidWlsZGluZ3MgYnkgbmFtZVxuICAgICAgYnVpbGRpbmdzV2l0aFN0YXRzLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xuXG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgYnVpbGRpbmdzOiBidWlsZGluZ3NXaXRoU3RhdHMsXG4gICAgICAgIG1ldGE6IHtcbiAgICAgICAgICB0b3RhbDogYnVpbGRpbmdzV2l0aFN0YXRzLmxlbmd0aCxcbiAgICAgICAgICB1c2VyUm9sZTogY3VycmVudFVzZXIucm9sZSxcbiAgICAgICAgICB1c2VySWQ6IGN1cnJlbnRVc2VyLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbkZpbHRlcjogb3JnYW5pemF0aW9uSWRGaWx0ZXIgfHwgbnVsbCxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBtYW5hZ2VyIGJ1aWxkaW5nczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIF9lcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYnVpbGRpbmdzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdFVCAvYXBpL21hbmFnZXIvYnVpbGRpbmdzLzppZCAtIEdldCBhIHNwZWNpZmljIGJ1aWxkaW5nIHdpdGggZGV0YWlsZWQgaW5mb3JtYXRpb25cbiAgICogVXNlcyB0aGUgc2FtZSBhY2Nlc3MgY29udHJvbCBsb2dpYyBhcyB0aGUgbGlzdCBlbmRwb2ludC5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvbWFuYWdlci9idWlsZGluZ3MvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXI7XG4gICAgICBjb25zdCBidWlsZGluZ0lkID0gcmVxLnBhcmFtcy5pZDtcblxuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ1VuYXV0aG9yaXplZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+TiiBGZXRjaGluZyBidWlsZGluZyAke2J1aWxkaW5nSWR9IGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9IHdpdGggcm9sZSAke2N1cnJlbnRVc2VyLnJvbGV9YFxuICAgICAgKTtcblxuICAgICAgbGV0IGhhc0FjY2VzcyA9IGZhbHNlO1xuICAgICAgbGV0IGFjY2Vzc1R5cGUgPSAnJztcblxuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBiZWxvbmdzIHRvIEtvdmVvIG9yZ2FuaXphdGlvbiAoc3BlY2lhbCBnbG9iYWwgYWNjZXNzKVxuICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogdXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgIGNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnM6IHVzZXJPcmdhbml6YXRpb25zLmNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnMsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSwgZXEodXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBoYXNHbG9iYWxBY2Nlc3MgPVxuICAgICAgICBjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nIHx8XG4gICAgICAgIHVzZXJPcmdzLnNvbWUoKG9yZykgPT4gb3JnLm9yZ2FuaXphdGlvbk5hbWUgPT09ICdLb3ZlbycgfHwgb3JnLmNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnMpO1xuXG4gICAgICBpZiAoaGFzR2xvYmFsQWNjZXNzKSB7XG4gICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgIGFjY2Vzc1R5cGUgPSAnZ2xvYmFsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIENoZWNrIG9yZ2FuaXphdGlvbi1iYXNlZCBhY2Nlc3MgZm9yIEFkbWluIGFuZCBNYW5hZ2VyXG4gICAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlID09PSAnYWRtaW4nIHx8IGN1cnJlbnRVc2VyLnJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICAgIGlmICh1c2VyT3Jncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBvcmdJZHMgPSB1c2VyT3Jncy5tYXAoKHVvKSA9PiB1by5vcmdhbml6YXRpb25JZCk7XG5cbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGJ1aWxkaW5nIGJlbG9uZ3MgdG8gdXNlcidzIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IGJ1aWxkaW5nT3JnID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQgfSlcbiAgICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSxcbiAgICAgICAgICAgICAgICAgIGluQXJyYXkoYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCBvcmdJZHMpLFxuICAgICAgICAgICAgICAgICAgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaWYgKGJ1aWxkaW5nT3JnLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgYWNjZXNzVHlwZSA9ICdvcmdhbml6YXRpb24nO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayByZXNpZGVuY2UtYmFzZWQgYWNjZXNzIGZvciBhbGwgcm9sZXNcbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VBY2Nlc3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyByZXNpZGVuY2VJZDogdXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQgfSlcbiAgICAgICAgICAuZnJvbSh1c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAuaW5uZXJKb2luKHJlc2lkZW5jZXMsIGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgICBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuXG4gICAgICAgIGlmICh1c2VyUmVzaWRlbmNlQWNjZXNzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgIGFjY2Vzc1R5cGUgPSBhY2Nlc3NUeXBlID8gJ2JvdGgnIDogJ3Jlc2lkZW5jZSc7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdGb3JiaWRkZW4nLFxuICAgICAgICAgIG1lc3NhZ2U6ICdZb3UgZG8gbm90IGhhdmUgYWNjZXNzIHRvIHRoaXMgYnVpbGRpbmcnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGJ1aWxkaW5nIGRldGFpbHNcbiAgICAgIGNvbnN0IGJ1aWxkaW5nRGF0YSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgYWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgICAgY2l0eTogYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ3MucG9zdGFsQ29kZSxcbiAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5ncy50b3RhbFVuaXRzLFxuICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsXG4gICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgc3RvcmFnZVNwYWNlczogYnVpbGRpbmdzLnN0b3JhZ2VTcGFjZXMsXG4gICAgICAgICAgYW1lbml0aWVzOiBidWlsZGluZ3MuYW1lbml0aWVzLFxuICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZ3MubWFuYWdlbWVudENvbXBhbnksXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGJ1aWxkaW5ncy51cGRhdGVkQXQsXG4gICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgIG9yZ2FuaXphdGlvblR5cGU6IG9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICBvcmdhbml6YXRpb25BZGRyZXNzOiBvcmdhbml6YXRpb25zLmFkZHJlc3MsXG4gICAgICAgICAgb3JnYW5pemF0aW9uQ2l0eTogb3JnYW5pemF0aW9ucy5jaXR5LFxuICAgICAgICAgIG9yZ2FuaXphdGlvblBob25lOiBvcmdhbml6YXRpb25zLnBob25lLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbkVtYWlsOiBvcmdhbml6YXRpb25zLmVtYWlsLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC5pbm5lckpvaW4ob3JnYW5pemF0aW9ucywgZXEoYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpO1xuXG4gICAgICBpZiAoYnVpbGRpbmdEYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidWlsZGluZyA9IGJ1aWxkaW5nRGF0YVswXTtcblxuICAgICAgLy8gR2V0IGFsbCByZXNpZGVuY2VzIGZvciB0aGlzIGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZ1Jlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogcmVzaWRlbmNlcy5pZCxcbiAgICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgZmxvb3I6IHJlc2lkZW5jZXMuZmxvb3IsXG4gICAgICAgICAgc3F1YXJlRm9vdGFnZTogcmVzaWRlbmNlcy5zcXVhcmVGb290YWdlLFxuICAgICAgICAgIGJlZHJvb21zOiByZXNpZGVuY2VzLmJlZHJvb21zLFxuICAgICAgICAgIGJhdGhyb29tczogcmVzaWRlbmNlcy5iYXRocm9vbXMsXG4gICAgICAgICAgYmFsY29ueTogcmVzaWRlbmNlcy5iYWxjb255LFxuICAgICAgICAgIHBhcmtpbmdTcGFjZU51bWJlcnM6IHJlc2lkZW5jZXMucGFya2luZ1NwYWNlTnVtYmVycyxcbiAgICAgICAgICBzdG9yYWdlU3BhY2VOdW1iZXJzOiByZXNpZGVuY2VzLnN0b3JhZ2VTcGFjZU51bWJlcnMsXG4gICAgICAgICAgbW9udGhseUZlZXM6IHJlc2lkZW5jZXMubW9udGhseUZlZXMsXG4gICAgICAgICAgaXNBY3RpdmU6IHJlc2lkZW5jZXMuaXNBY3RpdmUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShhbmQoZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAgICAgLy8gR2V0IHVzZXIncyByZXNpZGVuY2VzIGluIHRoaXMgYnVpbGRpbmcgaWYgYW55XG4gICAgICBsZXQgdXNlclJlc2lkZW5jZXNJbkJ1aWxkaW5nOiB1bmtub3duW10gPSBbXTtcbiAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VSZWNvcmRzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IHVzZXJSZXNpZGVuY2VzLnJlbGF0aW9uc2hpcFR5cGUsXG4gICAgICAgICAgc3RhcnREYXRlOiB1c2VyUmVzaWRlbmNlcy5zdGFydERhdGUsXG4gICAgICAgICAgZW5kRGF0ZTogdXNlclJlc2lkZW5jZXMuZW5kRGF0ZSxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20odXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC5pbm5lckpvaW4ocmVzaWRlbmNlcywgZXEodXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBpZiAodXNlclJlc2lkZW5jZVJlY29yZHMubGVuZ3RoID4gMCkge1xuICAgICAgICB1c2VyUmVzaWRlbmNlc0luQnVpbGRpbmcgPSB1c2VyUmVzaWRlbmNlUmVjb3Jkcy5tYXAoKHVyKSA9PiB7XG4gICAgICAgICAgY29uc3QgcmVzaWRlbmNlID0gYnVpbGRpbmdSZXNpZGVuY2VzLmZpbmQoKHIpID0+IHIuaWQgPT09IHVyLnJlc2lkZW5jZUlkKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgLi4ucmVzaWRlbmNlLFxuICAgICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogdXIucmVsYXRpb25zaGlwVHlwZSxcbiAgICAgICAgICAgIHN0YXJ0RGF0ZTogdXIuc3RhcnREYXRlLFxuICAgICAgICAgICAgZW5kRGF0ZTogdXIuZW5kRGF0ZSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2FsY3VsYXRlIHN0YXRpc3RpY3NcbiAgICAgIGNvbnN0IG9jY3VwaWVkVW5pdHMgPSBidWlsZGluZ1Jlc2lkZW5jZXMubGVuZ3RoO1xuICAgICAgY29uc3Qgb2NjdXBhbmN5UmF0ZSA9XG4gICAgICAgIGJ1aWxkaW5nLnRvdGFsVW5pdHMgPiAwID8gTWF0aC5yb3VuZCgob2NjdXBpZWRVbml0cyAvIGJ1aWxkaW5nLnRvdGFsVW5pdHMpICogMTAwKSA6IDA7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgLi4uYnVpbGRpbmcsXG4gICAgICAgIGFjY2Vzc1R5cGUsXG4gICAgICAgIHN0YXRpc3RpY3M6IHtcbiAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZy50b3RhbFVuaXRzLFxuICAgICAgICAgIG9jY3VwaWVkVW5pdHMsXG4gICAgICAgICAgb2NjdXBhbmN5UmF0ZSxcbiAgICAgICAgICB2YWNhbnRVbml0czogYnVpbGRpbmcudG90YWxVbml0cyAtIG9jY3VwaWVkVW5pdHMsXG4gICAgICAgICAgdG90YWxSZXNpZGVuY2VzOiBidWlsZGluZ1Jlc2lkZW5jZXMubGVuZ3RoLFxuICAgICAgICB9LFxuICAgICAgICB1c2VyUmVzaWRlbmNlczogdXNlclJlc2lkZW5jZXNJbkJ1aWxkaW5nLFxuICAgICAgICAvLyBPbmx5IGluY2x1ZGUgZnVsbCByZXNpZGVuY2UgbGlzdCBmb3IgbWFuYWdlcnMvYWRtaW5zXG4gICAgICAgIHJlc2lkZW5jZXM6XG4gICAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fCBjdXJyZW50VXNlci5yb2xlID09PSAnbWFuYWdlcidcbiAgICAgICAgICAgID8gYnVpbGRpbmdSZXNpZGVuY2VzXG4gICAgICAgICAgICA6IHVuZGVmaW5lZCxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBidWlsZGluZyBkZXRhaWxzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBidWlsZGluZyBkZXRhaWxzJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFBPU1QgL2FwaS9hZG1pbi9idWlsZGluZ3MgLSBDcmVhdGUgYSBuZXcgYnVpbGRpbmcgKEFkbWluIG9ubHkpLlxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvYWRtaW4vYnVpbGRpbmdzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidWlsZGluZ0RhdGEgPSByZXEuYm9keTtcblxuICAgICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXG4gICAgICBpZiAoIWJ1aWxkaW5nRGF0YS5uYW1lIHx8ICFidWlsZGluZ0RhdGEub3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdWYWxpZGF0aW9uIGVycm9yJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgbmFtZSBhbmQgb3JnYW5pemF0aW9uIGFyZSByZXF1aXJlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgYnVpbGRpbmcgd2l0aCBJRFxuICAgICAgY29uc3QgYnVpbGRpbmdJZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG5cbiAgICAgIGNvbnN0IG5ld0J1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChidWlsZGluZ3MpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGlkOiBidWlsZGluZ0lkLFxuICAgICAgICAgIG5hbWU6IGJ1aWxkaW5nRGF0YS5uYW1lLFxuICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5nRGF0YS5hZGRyZXNzIHx8ICcnLFxuICAgICAgICAgIGNpdHk6IGJ1aWxkaW5nRGF0YS5jaXR5IHx8ICcnLFxuICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ0RhdGEucHJvdmluY2UgfHwgJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ0RhdGEucG9zdGFsQ29kZSB8fCAnJyxcbiAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5nRGF0YS5idWlsZGluZ1R5cGUgfHwgJ2NvbmRvJyxcbiAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5nRGF0YS55ZWFyQnVpbHQsXG4gICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdEYXRhLnRvdGFsVW5pdHMgfHwgMCxcbiAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzLFxuICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5nRGF0YS5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5nRGF0YS5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdEYXRhLmFtZW5pdGllcyA/IEpTT04uc3RyaW5naWZ5KGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXMpIDogbnVsbCxcbiAgICAgICAgICBtYW5hZ2VtZW50Q29tcGFueTogYnVpbGRpbmdEYXRhLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ0RhdGEub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG5cbiAgICAgIC8vIEJ1aWxkaW5nIHN0b3JhZ2UgaGllcmFyY2h5IHdpbGwgYmUgY3JlYXRlZCBhdXRvbWF0aWNhbGx5IHdoZW4gZG9jdW1lbnRzIGFyZSB1cGxvYWRlZFxuICAgICAgY29uc29sZS5sb2coJ0J1aWxkaW5nIGNyZWF0ZWQgLSBzdG9yYWdlIGhpZXJhcmNoeSB3aWxsIGJlIGNyZWF0ZWQgb24gZmlyc3QgZG9jdW1lbnQgdXBsb2FkJyk7XG5cbiAgICAgIC8vIEF1dG8tZ2VuZXJhdGUgcmVzaWRlbmNlcyBpZiB0b3RhbFVuaXRzIGlzIHNwZWNpZmllZCBhbmQgPD0gMzAwXG4gICAgICBpZiAoXG4gICAgICAgIGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzICYmXG4gICAgICAgIGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzID4gMCAmJlxuICAgICAgICBidWlsZGluZ0RhdGEudG90YWxVbml0cyA8PSAzMDBcbiAgICAgICkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHRvdGFsVW5pdHMgPSBidWlsZGluZ0RhdGEudG90YWxVbml0cztcbiAgICAgICAgICBjb25zdCB0b3RhbEZsb29ycyA9IGJ1aWxkaW5nRGF0YS50b3RhbEZsb29ycyB8fCAxO1xuICAgICAgICAgIGNvbnN0IHVuaXRzUGVyRmxvb3IgPSBNYXRoLmNlaWwodG90YWxVbml0cyAvIHRvdGFsRmxvb3JzKTtcblxuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZXNUb0NyZWF0ZSA9IFtdO1xuICAgICAgICAgIGZvciAobGV0IHVuaXQgPSAxOyB1bml0IDw9IHRvdGFsVW5pdHM7IHVuaXQrKykge1xuICAgICAgICAgICAgY29uc3QgZmxvb3IgPSBNYXRoLmNlaWwodW5pdCAvIHVuaXRzUGVyRmxvb3IpO1xuICAgICAgICAgICAgY29uc3QgdW5pdE9uRmxvb3IgPSAoKHVuaXQgLSAxKSAlIHVuaXRzUGVyRmxvb3IpICsgMTtcbiAgICAgICAgICAgIGNvbnN0IHVuaXROdW1iZXIgPSBgJHtmbG9vcn0ke3VuaXRPbkZsb29yLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgJzAnKX1gO1xuXG4gICAgICAgICAgICByZXNpZGVuY2VzVG9DcmVhdGUucHVzaCh7XG4gICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJ1aWxkaW5nSWQsXG4gICAgICAgICAgICAgIHVuaXROdW1iZXIsXG4gICAgICAgICAgICAgIGZsb29yLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEluc2VydCBhbGwgcmVzaWRlbmNlcyBhdCBvbmNlXG4gICAgICAgICAgY29uc3QgY3JlYXRlZFJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLmluc2VydChyZXNpZGVuY2VzKVxuICAgICAgICAgICAgLnZhbHVlcyhyZXNpZGVuY2VzVG9DcmVhdGUpXG4gICAgICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDinIUgQXV0by1nZW5lcmF0ZWQgJHtjcmVhdGVkUmVzaWRlbmNlcy5sZW5ndGh9IHJlc2lkZW5jZXMgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIFRPRE86IE9iamVjdCBzdG9yYWdlIHNlcnZpY2UgaW50ZWdyYXRpb25cbiAgICAgICAgICAvLyBDcmVhdGUgb2JqZWN0IHN0b3JhZ2UgaGllcmFyY2h5IGZvciBlYWNoIHJlc2lkZW5jZVxuICAgICAgICAgIC8vIGZvciAoY29uc3QgcmVzaWRlbmNlIG9mIGNyZWF0ZWRSZXNpZGVuY2VzKSB7XG4gICAgICAgICAgLy8gICBhd2FpdCBvYmplY3RTdG9yYWdlU2VydmljZS5jcmVhdGVSZXNpZGVuY2VIaWVyYXJjaHkoXG4gICAgICAgICAgLy8gICAgIGJ1aWxkaW5nRGF0YS5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICAvLyAgICAgYnVpbGRpbmdJZCxcbiAgICAgICAgICAvLyAgICAgcmVzaWRlbmNlLmlkXG4gICAgICAgICAgLy8gICApO1xuICAgICAgICAgIC8vIH1cbiAgICAgICAgfSBjYXRjaCAoX19fcmVzaWRlbmNlRXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfimqDvuI8gRXJyb3IgYXV0by1nZW5lcmF0aW5nIHJlc2lkZW5jZXM6JywgX19fcmVzaWRlbmNlRXJyb3IpO1xuICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIGJ1aWxkaW5nIGNyZWF0aW9uIGlmIHJlc2lkZW5jZSBnZW5lcmF0aW9uIGZhaWxzXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBidWlsZGluZzogbmV3QnVpbGRpbmdbMF0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgYnVpbGRpbmc6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGNyZWF0ZSBidWlsZGluZycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9idWlsZGluZ3MvOmlkL3Jlc2lkZW5jZXMtZm9yLWRlbGV0aW9uIC0gR2V0IGxpc3Qgb2YgcmVzaWRlbmNlcyB0aGF0IGNhbiBiZSBzZWxlY3RlZCBmb3IgZGVsZXRpb25cbiAgICogT25seSBhZG1pbnMgY2FuIGFjY2VzcyB0aGlzIGVuZHBvaW50XG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2J1aWxkaW5ncy86aWQvcmVzaWRlbmNlcy1mb3ItZGVsZXRpb24nLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCBtYXhUb1NlbGVjdCA9IHBhcnNlSW50KHJlcS5xdWVyeS5tYXhUb1NlbGVjdCBhcyBzdHJpbmcpIHx8IDEwO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHsgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gT25seSBhZG1pbnMgY2FuIGRlbGV0ZSByZXNpZGVuY2VzXG4gICAgICBpZiAodXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7IG1lc3NhZ2U6ICdPbmx5IGFkbWlucyBjYW4gYWNjZXNzIHJlc2lkZW5jZSBkZWxldGlvbiBvcHRpb25zJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBnZXRSZXNpZGVuY2VzRm9yU2VsZWN0aW9uIH0gPSBhd2FpdCBpbXBvcnQoJy4vYnVpbGRpbmdzL29wZXJhdGlvbnMnKTtcbiAgICAgIGNvbnN0IHJlc2lkZW5jZXNUb1NlbGVjdCA9IGF3YWl0IGdldFJlc2lkZW5jZXNGb3JTZWxlY3Rpb24oYnVpbGRpbmdJZCwgbWF4VG9TZWxlY3QpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIHJlc2lkZW5jZXM6IHJlc2lkZW5jZXNUb1NlbGVjdCxcbiAgICAgICAgbWVzc2FnZTogYEZvdW5kICR7cmVzaWRlbmNlc1RvU2VsZWN0Lmxlbmd0aH0gcmVzaWRlbmNlcyBhdmFpbGFibGUgZm9yIGRlbGV0aW9uYFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHJlc2lkZW5jZXMgZm9yIGRlbGV0aW9uOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCByZXNpZGVuY2VzIGZvciBkZWxldGlvbicgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogREVMRVRFIC9hcGkvYnVpbGRpbmdzLzppZC9yZXNpZGVuY2VzIC0gRGVsZXRlIHNlbGVjdGVkIHJlc2lkZW5jZXNcbiAgICogT25seSBhZG1pbnMgY2FuIGRlbGV0ZSByZXNpZGVuY2VzXG4gICAqL1xuICBhcHAuZGVsZXRlKCcvYXBpL2J1aWxkaW5ncy86aWQvcmVzaWRlbmNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB1c2VyID0gcmVxLnVzZXI7XG4gICAgICBjb25zdCBidWlsZGluZ0lkID0gcmVxLnBhcmFtcy5pZDtcbiAgICAgIGNvbnN0IHsgcmVzaWRlbmNlSWRzIH0gPSByZXEuYm9keTtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgcmVzaWRlbmNlc1xuICAgICAgaWYgKHVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnT25seSBhZG1pbnMgY2FuIGRlbGV0ZSByZXNpZGVuY2VzJyB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlc2lkZW5jZUlkcykgfHwgcmVzaWRlbmNlSWRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBtZXNzYWdlOiAncmVzaWRlbmNlSWRzIGFycmF5IGlzIHJlcXVpcmVkJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBkZWxldGVTZWxlY3RlZFJlc2lkZW5jZXMgfSA9IGF3YWl0IGltcG9ydCgnLi9idWlsZGluZ3Mvb3BlcmF0aW9ucycpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGVsZXRlU2VsZWN0ZWRSZXNpZGVuY2VzKGJ1aWxkaW5nSWQsIHJlc2lkZW5jZUlkcywgdXNlci5yb2xlKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkZWxldGVkQ291bnQ6IHJlc3VsdC5kZWxldGVkQ291bnQsXG4gICAgICAgIGRvY3VtZW50c0RlbGV0ZWQ6IHJlc3VsdC5kb2N1bWVudHNEZWxldGVkLFxuICAgICAgICBtZXNzYWdlOiBgU3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgJHtyZXN1bHQuZGVsZXRlZENvdW50fSByZXNpZGVuY2VzIGFuZCAke3Jlc3VsdC5kb2N1bWVudHNEZWxldGVkfSBhc3NvY2lhdGVkIGRvY3VtZW50c2BcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyByZXNpZGVuY2VzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGRlbGV0ZSByZXNpZGVuY2VzJyB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQVVQgL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkIC0gVXBkYXRlIGEgYnVpbGRpbmcgKEFkbWluIGFuZCBNYW5hZ2VyKS5cbiAgICovXG4gIGFwcC5wdXQoJy9hcGkvYWRtaW4vYnVpbGRpbmdzLzppZCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFkbWluIG9yIG1hbmFnZXJcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJyAmJiBjdXJyZW50VXNlci5yb2xlICE9PSAnbWFuYWdlcicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWRtaW4gb3IgTWFuYWdlciBhY2Nlc3MgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9NQU5BR0VSX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgYnVpbGRpbmdEYXRhID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgaWYgKCFidWlsZGluZ0RhdGEubmFtZSB8fCAhYnVpbGRpbmdEYXRhLm9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5hbWUgYW5kIG9yZ2FuaXphdGlvbiBhcmUgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgYnVpbGRpbmcgZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ0J1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGV4aXN0aW5nQnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGN1cnJlbnQgbnVtYmVyIG9mIGFjdGl2ZSByZXNpZGVuY2VzXG4gICAgICBjb25zdCBjdXJyZW50UmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogc3FsPG51bWJlcj5gY291bnQoKik6OmludGAgfSlcbiAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGFuZChlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBlcShyZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICBjb25zdCBjdXJyZW50UmVzaWRlbmNlQ291bnQgPSBjdXJyZW50UmVzaWRlbmNlc1swXT8uY291bnQgfHwgMDtcbiAgICAgIGNvbnN0IG5ld1RvdGFsVW5pdHMgPSBidWlsZGluZ0RhdGEudG90YWxVbml0cyB8fCAwO1xuICAgICAgY29uc3QgcHJldmlvdXNUb3RhbFVuaXRzID0gZXhpc3RpbmdCdWlsZGluZ1swXS50b3RhbFVuaXRzIHx8IDA7XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+UhCBCdWlsZGluZyAke2J1aWxkaW5nSWR9OiAke3ByZXZpb3VzVG90YWxVbml0c30g4oaSICR7bmV3VG90YWxVbml0c30gdW5pdHMgKGN1cnJlbnRseSBoYXMgJHtjdXJyZW50UmVzaWRlbmNlQ291bnR9IGFjdGl2ZSByZXNpZGVuY2VzKWBcbiAgICAgICk7XG5cbiAgICAgIC8vIFVwZGF0ZSBidWlsZGluZ1xuICAgICAgY29uc3QgdXBkYXRlZEJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShidWlsZGluZ3MpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIG5hbWU6IGJ1aWxkaW5nRGF0YS5uYW1lLFxuICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5nRGF0YS5hZGRyZXNzIHx8ICcnLFxuICAgICAgICAgIGNpdHk6IGJ1aWxkaW5nRGF0YS5jaXR5IHx8ICcnLFxuICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ0RhdGEucHJvdmluY2UgfHwgJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ0RhdGEucG9zdGFsQ29kZSB8fCAnJyxcbiAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5nRGF0YS5idWlsZGluZ1R5cGUgfHwgJ2NvbmRvJyxcbiAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5nRGF0YS55ZWFyQnVpbHQsXG4gICAgICAgICAgdG90YWxVbml0czogbmV3VG90YWxVbml0cyxcbiAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzLFxuICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5nRGF0YS5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5nRGF0YS5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdEYXRhLmFtZW5pdGllcyA/IEpTT04uc3RyaW5naWZ5KGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXMpIDogbnVsbCxcbiAgICAgICAgICBtYW5hZ2VtZW50Q29tcGFueTogYnVpbGRpbmdEYXRhLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ0RhdGEub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBIYW5kbGUgcmVzaWRlbmNlIGNvdW50IGNoYW5nZXMgd2l0aCBuZXcgYWRtaW4tb25seSBmdW5jdGlvbmFsaXR5XG4gICAgICBpZiAobmV3VG90YWxVbml0cyAhPT0gcHJldmlvdXNUb3RhbFVuaXRzKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn4+gIEJ1aWxkaW5nIHVuaXRzIGNoYW5nZWQgZnJvbSAke3ByZXZpb3VzVG90YWxVbml0c30gdG8gJHtuZXdUb3RhbFVuaXRzfSwgYWRqdXN0aW5nIHJlc2lkZW5jZXMuLi5gKTtcbiAgICAgICAgXG4gICAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBhZGp1c3QgcmVzaWRlbmNlIGNvdW50c1xuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgICBtZXNzYWdlOiAnT25seSBhZG1pbnMgY2FuIGluY3JlYXNlIG9yIGRlY3JlYXNlIGJ1aWxkaW5nIHJlc2lkZW5jZSBjb3VudHMnLFxuICAgICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEX0ZPUl9SRVNJREVOQ0VfQ0hBTkdFUycsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB7IGFkanVzdFJlc2lkZW5jZUNvdW50IH0gPSBhd2FpdCBpbXBvcnQoJy4vYnVpbGRpbmdzL29wZXJhdGlvbnMnKTtcbiAgICAgICAgY29uc3QgYWRqdXN0bWVudFJlc3VsdCA9IGF3YWl0IGFkanVzdFJlc2lkZW5jZUNvdW50KFxuICAgICAgICAgIGJ1aWxkaW5nSWQsXG4gICAgICAgICAgZXhpc3RpbmdCdWlsZGluZ1swXS5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICBuZXdUb3RhbFVuaXRzLFxuICAgICAgICAgIHByZXZpb3VzVG90YWxVbml0cyxcbiAgICAgICAgICBidWlsZGluZ0RhdGEudG90YWxGbG9vcnMgfHwgZXhpc3RpbmdCdWlsZGluZ1swXS50b3RhbEZsb29ycyB8fCAxXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gSWYgcmVzaWRlbmNlcyBuZWVkIHRvIGJlIGRlY3JlYXNlZCwgcmV0dXJuIHRoZSBzZWxlY3Rpb24gbGlzdCB0byB1c2VyXG4gICAgICAgIGlmIChhZGp1c3RtZW50UmVzdWx0LmFjdGlvbiA9PT0gJ2RlY3JlYXNlZCcgJiYgYWRqdXN0bWVudFJlc3VsdC5yZXNpZGVuY2VzVG9TZWxlY3QpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIHVwZGF0ZWQsIGJ1dCByZXNpZGVuY2UgY291bnQgbmVlZHMgdG8gYmUgcmVkdWNlZCcsXG4gICAgICAgICAgICBidWlsZGluZ1VwZGF0ZWQ6IHRydWUsXG4gICAgICAgICAgICBuZWVkc1Jlc2lkZW5jZVNlbGVjdGlvbjogdHJ1ZSxcbiAgICAgICAgICAgIHJlc2lkZW5jZXNUb1NlbGVjdDogYWRqdXN0bWVudFJlc3VsdC5yZXNpZGVuY2VzVG9TZWxlY3QsXG4gICAgICAgICAgICBpbnN0cnVjdGlvbjogYFBsZWFzZSBzZWxlY3QgJHtwcmV2aW91c1RvdGFsVW5pdHMgLSBuZXdUb3RhbFVuaXRzfSByZXNpZGVuY2VzIHRvIGRlbGV0ZSBmcm9tIHRoZSBsaXN0IHByb3ZpZGVkLiBVc2UgREVMRVRFIC9hcGkvYnVpbGRpbmdzLyR7YnVpbGRpbmdJZH0vcmVzaWRlbmNlcyB3aXRoIHRoZSBzZWxlY3RlZCByZXNpZGVuY2UgSURzLmBcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuXG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIHVwZGF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgYnVpbGRpbmc6IHVwZGF0ZWRCdWlsZGluZ1swXSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBidWlsZGluZzonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIF9lcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gdXBkYXRlIGJ1aWxkaW5nJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERFTEVURSAvYXBpL2FkbWluL2J1aWxkaW5ncy86aWQgLSBEZWxldGUgYSBidWlsZGluZyAoQWRtaW4gb25seSkuXG4gICAqL1xuICBhcHAuZGVsZXRlKCcvYXBpL2FkbWluL2J1aWxkaW5ncy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhZG1pblxuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSByZXEucGFyYW1zLmlkO1xuXG4gICAgICAvLyBDaGVjayBpZiBidWlsZGluZyBleGlzdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nQnVpbGRpbmcgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoZXhpc3RpbmdCdWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU29mdCBkZWxldGUgYnkgc2V0dGluZyBpc0FjdGl2ZSB0byBmYWxzZVxuICAgICAgYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShidWlsZGluZ3MpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIGlzQWN0aXZlOiBmYWxzZSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKTtcblxuXG4gICAgICAvLyBPYmplY3Qgc3RvcmFnZSBjbGVhbnVwIHdpbGwgYmUgaGFuZGxlZCBhdXRvbWF0aWNhbGx5XG4gICAgICBjb25zb2xlLmxvZygnQnVpbGRpbmcgZGVsZXRlZCAtIHN0b3JhZ2UgY2xlYW51cCB3aWxsIGJlIGhhbmRsZWQgYXV0b21hdGljYWxseScpO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgYnVpbGRpbmc6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlbGV0ZSBidWlsZGluZycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkL2RlbGV0aW9uLWltcGFjdCAtIEdldCBkZWxldGlvbiBpbXBhY3QgYW5hbHlzaXNcbiAgICogU2hvd3Mgd2hhdCB3aWxsIGJlIGRlbGV0ZWQgd2hlbiByZW1vdmluZyBhIGJ1aWxkaW5nLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkL2RlbGV0aW9uLWltcGFjdCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQURNSU5fUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYnVpbGRpbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XG5cbiAgICAgIC8vIENoZWNrIGlmIGJ1aWxkaW5nIGV4aXN0c1xuICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgaWQ6IGJ1aWxkaW5ncy5pZCwgbmFtZTogYnVpbGRpbmdzLm5hbWUgfSlcbiAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCksIGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChidWlsZGluZy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ291bnQgcmVzaWRlbmNlcyBpbiB0aGlzIGJ1aWxkaW5nXG4gICAgICBjb25zdCByZXNpZGVuY2VzQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KCopYCB9KVxuICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSk7XG5cbiAgICAgIC8vIENvdW50IGRvY3VtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhpcyBidWlsZGluZyBvciBpdHMgcmVzaWRlbmNlc1xuICAgICAgY29uc3QgZG9jdW1lbnRzQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KCopYCB9KVxuICAgICAgICAuZnJvbShkb2N1bWVudHMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBvcihcbiAgICAgICAgICAgIGVxKGRvY3VtZW50cy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSxcbiAgICAgICAgICAgIHNxbGAke2RvY3VtZW50cy5yZXNpZGVuY2VJZH0gSU4gKFNFTEVDVCBpZCBGUk9NIHJlc2lkZW5jZXMgV0hFUkUgYnVpbGRpbmdfaWQgPSAke2J1aWxkaW5nSWR9KWBcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIC8vIENvdW50IHVzZXJzIHdobyB3aWxsIGJlY29tZSBvcnBoYW5lZCAob25seSBoYXZlIHJlbGF0aW9uc2hpcHMgd2l0aCByZXNpZGVuY2VzIGluIHRoaXMgYnVpbGRpbmcpXG4gICAgICBjb25zdCBwb3RlbnRpYWxPcnBoYW5zQ291bnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KGRpc3RpbmN0ICR7dXNlclJlc2lkZW5jZXMudXNlcklkfSlgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAuaW5uZXJKb2luKHJlc2lkZW5jZXMsIGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgLmlubmVySm9pbih1c2VycywgZXEodXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2Vycy5pZCkpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGNvbnN0IGltcGFjdCA9IHtcbiAgICAgICAgYnVpbGRpbmc6IGJ1aWxkaW5nWzBdLFxuICAgICAgICByZXNpZGVuY2VzOiByZXNpZGVuY2VzQ291bnRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIGRvY3VtZW50czogZG9jdW1lbnRzQ291bnRbMF0/LmNvdW50IHx8IDAsXG4gICAgICAgIHBvdGVudGlhbE9ycGhhbmVkVXNlcnM6IHBvdGVudGlhbE9ycGhhbnNDb3VudFswXT8uY291bnQgfHwgMCxcbiAgICAgIH07XG5cbiAgICAgIHJlcy5qc29uKGltcGFjdCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGFuYWx5emluZyBkZWxldGlvbiBpbXBhY3Q6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGFuYWx5emUgZGVsZXRpb24gaW1wYWN0JyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERFTEVURSAvYXBpL2FkbWluL2J1aWxkaW5ncy86aWQvY2FzY2FkZSAtIENhc2NhZGUgZGVsZXRlIGEgYnVpbGRpbmdcbiAgICogUmVwbGFjZXMgdGhlIHNpbXBsZSBkZWxldGUgd2l0aCBjYXNjYWRpbmcgZGVsZXRlIHRoYXQgcmVtb3ZlcyByZXNpZGVuY2VzIGFuZCBkb2N1bWVudHMuIFVzZXJzIGFyZSBwcmVzZXJ2ZWQgZm9yIGRhdGEgc2FmZXR5LlxuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkL2Nhc2NhZGUnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSByZXEucGFyYW1zLmlkO1xuXG4gICAgICAvLyBDaGVjayBpZiBidWlsZGluZyBleGlzdHNcbiAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQsIG5hbWU6IGJ1aWxkaW5ncy5uYW1lIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGFuZChlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpLCBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0YXJ0IHRyYW5zYWN0aW9uIGZvciBjYXNjYWRpbmcgZGVsZXRlXG4gICAgICBhd2FpdCBkYi50cmFuc2FjdGlvbihhc3luYyAodHgpID0+IHtcbiAgICAgICAgLy8gMS4gR2V0IGFsbCByZXNpZGVuY2VzIGluIHRoaXMgYnVpbGRpbmdcbiAgICAgICAgY29uc3QgYnVpbGRpbmdSZXNpZGVuY2VzID0gYXdhaXQgdHhcbiAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHJlc2lkZW5jZXMuaWQgfSlcbiAgICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShhbmQoZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAgICAgICBjb25zdCByZXNpZGVuY2VJZHMgPSBidWlsZGluZ1Jlc2lkZW5jZXMubWFwKChyKSA9PiByLmlkKTtcblxuICAgICAgICBpZiAocmVzaWRlbmNlSWRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyAyLiBEZWxldGUgZG9jdW1lbnRzIGFzc29jaWF0ZWQgd2l0aCBidWlsZGluZyBvciBpdHMgcmVzaWRlbmNlc1xuICAgICAgICAgIGF3YWl0IHR4XG4gICAgICAgICAgICAuZGVsZXRlKGRvY3VtZW50cylcbiAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgb3IoZXEoZG9jdW1lbnRzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBpbkFycmF5KGRvY3VtZW50cy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWRzKSlcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyAzLiBTb2Z0IGRlbGV0ZSB1c2VyLXJlc2lkZW5jZSByZWxhdGlvbnNoaXBzXG4gICAgICAgICAgYXdhaXQgdHhcbiAgICAgICAgICAgIC51cGRhdGUodXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgICAgIC53aGVyZShpbkFycmF5KHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZHMpKTtcblxuICAgICAgICAgIC8vIDQuIERJU0FCTEVEOiBVc2VyIGRlbGV0aW9uIHByb2hpYml0ZWQgZm9yIGRhdGEgc2FmZXR5XG4gICAgICAgICAgY29uc3Qgb3JwaGFuZWRVc2VycyA9IGF3YWl0IHR4XG4gICAgICAgICAgICAuc2VsZWN0KHsgaWQ6IHVzZXJzLmlkIH0pXG4gICAgICAgICAgICAuZnJvbSh1c2VycylcbiAgICAgICAgICAgIC5sZWZ0Sm9pbihcbiAgICAgICAgICAgICAgdXNlck9yZ2FuaXphdGlvbnMsXG4gICAgICAgICAgICAgIGFuZChlcSh1c2Vycy5pZCwgdXNlck9yZ2FuaXphdGlvbnMudXNlcklkKSwgZXEodXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLmxlZnRKb2luKFxuICAgICAgICAgICAgICB1c2VyUmVzaWRlbmNlcyxcbiAgICAgICAgICAgICAgYW5kKGVxKHVzZXJzLmlkLCB1c2VyUmVzaWRlbmNlcy51c2VySWQpLCBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICBlcSh1c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgaXNOdWxsKHVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCksXG4gICAgICAgICAgICAgICAgaXNOdWxsKHVzZXJSZXNpZGVuY2VzLnVzZXJJZClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgIGlmIChvcnBoYW5lZFVzZXJzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG9ycGhhbmVkVXNlcklkcyA9IG9ycGhhbmVkVXNlcnMubWFwKCh1KSA9PiB1LmlkKTtcbiAgICAgICAgICAgIGF3YWl0IHR4XG4gICAgICAgICAgICAgIC51cGRhdGUodXNlcnMpXG4gICAgICAgICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAgICAgICAud2hlcmUoaW5BcnJheSh1c2Vycy5pZCwgb3JwaGFuZWRVc2VySWRzKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gNS4gU29mdCBkZWxldGUgcmVzaWRlbmNlc1xuICAgICAgICAgIGF3YWl0IHR4XG4gICAgICAgICAgICAudXBkYXRlKHJlc2lkZW5jZXMpXG4gICAgICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgICAgIC53aGVyZShpbkFycmF5KHJlc2lkZW5jZXMuaWQsIHJlc2lkZW5jZUlkcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIFN0aWxsIGRlbGV0ZSBkb2N1bWVudHMgYXNzb2NpYXRlZCBkaXJlY3RseSB3aXRoIHRoZSBidWlsZGluZ1xuICAgICAgICAgIGF3YWl0IHR4LmRlbGV0ZShkb2N1bWVudHMpLndoZXJlKGVxKGRvY3VtZW50cy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyA2LiBGaW5hbGx5LCBzb2Z0IGRlbGV0ZSB0aGUgYnVpbGRpbmdcbiAgICAgICAgYXdhaXQgdHhcbiAgICAgICAgICAudXBkYXRlKGJ1aWxkaW5ncylcbiAgICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSk7XG4gICAgICB9KTtcblxuXG4gICAgICAvLyBDbGVhbiB1cCBvYmplY3Qgc3RvcmFnZSBoaWVyYXJjaHkgZm9yIHRoZSBkZWxldGVkIGJ1aWxkaW5nXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIElEIGZyb20gYnVpbGRpbmcgYmVmb3JlIGRlbGV0aW9uXG4gICAgICBjb25zdCBidWlsZGluZ09yZyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGJ1aWxkaW5nT3JnLmxlbmd0aCA+IDApIHtcbiAgICAgICAgLy8gT2JqZWN0IHN0b3JhZ2UgY2xlYW51cCB3aWxsIGJlIGhhbmRsZWQgYXV0b21hdGljYWxseVxuICAgICAgICBjb25zb2xlLmxvZygnQnVpbGRpbmcgZGVsZXRlZCAtIHN0b3JhZ2UgY2xlYW51cCB3aWxsIGJlIGhhbmRsZWQgYXV0b21hdGljYWxseScpO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBhbmQgcmVsYXRlZCBlbnRpdGllcyBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRlbGV0ZWRCdWlsZGluZzogYnVpbGRpbmdbMF0ubmFtZSxcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkdXJpbmcgY2FzY2FkZSBkZWxldGU6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGRlbGV0ZSBidWlsZGluZyBhbmQgcmVsYXRlZCBlbnRpdGllcycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9idWlsZGluZ3MvOmJ1aWxkaW5nSWQvcmVzaWRlbmNlcyAtIEdldCByZXNpZGVuY2VzIHdpdGhpbiBhIHNwZWNpZmljIGJ1aWxkaW5nXG4gICAqIFJldHVybnMgcmVzaWRlbmNlcyB0aGF0IHRoZSBhdXRoZW50aWNhdGVkIHVzZXIgaGFzIGFjY2VzcyB0byB3aXRoaW4gdGhlIHNwZWNpZmllZCBidWlsZGluZ1xuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9idWlsZGluZ3MvOmJ1aWxkaW5nSWQvcmVzaWRlbmNlcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgeyBidWlsZGluZ0lkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYPCfk4ogRmV0Y2hpbmcgcmVzaWRlbmNlcyBmb3IgYnVpbGRpbmcgJHtidWlsZGluZ0lkfSBieSB1c2VyICR7Y3VycmVudFVzZXIuaWR9IHdpdGggcm9sZSAke2N1cnJlbnRVc2VyLnJvbGV9YFxuICAgICAgKTtcblxuICAgICAgLy8gRmlyc3QsIHZlcmlmeSB0aGUgdXNlciBoYXMgYWNjZXNzIHRvIHRoaXMgYnVpbGRpbmdcbiAgICAgIGNvbnN0IHVzZXJCdWlsZGluZ0FjY2VzcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBcbiAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQgXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLmxlZnRKb2luKFxuICAgICAgICAgIHVzZXJPcmdhbml6YXRpb25zLFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQpLFxuICAgICAgICAgICAgZXEodXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLmxlZnRKb2luKHJlc2lkZW5jZXMsIGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgLmxlZnRKb2luKFxuICAgICAgICAgIHVzZXJSZXNpZGVuY2VzLFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSxcbiAgICAgICAgICAgIGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgIG9yKFxuICAgICAgICAgICAgICBlcShjdXJyZW50VXNlci5yb2xlLCAnYWRtaW4nKSwgLy8gQWRtaW4gY2FuIGFjY2VzcyBhbnkgYnVpbGRpbmdcbiAgICAgICAgICAgICAgZXEodXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksIC8vIFVzZXIgbGlua2VkIHRvIG9yZ2FuaXphdGlvblxuICAgICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSAvLyBVc2VyIGhhcyByZXNpZGVuY2UgaW4gYnVpbGRpbmdcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAodXNlckJ1aWxkaW5nQWNjZXNzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBY2Nlc3MgZGVuaWVkIHRvIHRoaXMgYnVpbGRpbmcnLFxuICAgICAgICAgIGNvZGU6ICdCVUlMRElOR19BQ0NFU1NfREVOSUVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCByZXNpZGVuY2VzIHdpdGhpbiB0aGUgYnVpbGRpbmcgdGhhdCB0aGUgdXNlciBjYW4gYWNjZXNzXG4gICAgICBsZXQgcmVzaWRlbmNlc1F1ZXJ5O1xuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAvLyBBZG1pbiBjYW4gc2VlIGFsbCByZXNpZGVuY2VzIGluIHRoZSBidWlsZGluZ1xuICAgICAgICByZXNpZGVuY2VzUXVlcnkgPSBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICBmbG9vcjogcmVzaWRlbmNlcy5mbG9vcixcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGJ1aWxkaW5ncy5pZCwgcmVzaWRlbmNlcy5idWlsZGluZ0lkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksXG4gICAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vcmRlckJ5KHJlc2lkZW5jZXMudW5pdE51bWJlcik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBOb24tYWRtaW4gdXNlcnMgY2FuIG9ubHkgc2VlIHJlc2lkZW5jZXMgdGhleSBoYXZlIGFjY2VzcyB0b1xuICAgICAgICByZXNpZGVuY2VzUXVlcnkgPSBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgaWQ6IHJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgICB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICBmbG9vcjogcmVzaWRlbmNlcy5mbG9vcixcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihidWlsZGluZ3MsIGVxKGJ1aWxkaW5ncy5pZCwgcmVzaWRlbmNlcy5idWlsZGluZ0lkKSlcbiAgICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgICB1c2VyUmVzaWRlbmNlcyxcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpLFxuICAgICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSxcbiAgICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5sZWZ0Sm9pbihcbiAgICAgICAgICAgIHVzZXJPcmdhbml6YXRpb25zLFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcSh1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkKSxcbiAgICAgICAgICAgICAgZXEodXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksXG4gICAgICAgICAgICAgIGVxKHVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksXG4gICAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICBvcihcbiAgICAgICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSwgLy8gVXNlciBoYXMgdGhpcyByZXNpZGVuY2VcbiAgICAgICAgICAgICAgICBlcSh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSAvLyBVc2VyIGlzIGxpbmtlZCB0byBvcmdhbml6YXRpb24gKG1hbmFnZXJzIGNhbiBzZWUgYWxsIHJlc2lkZW5jZXMpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkocmVzaWRlbmNlcy51bml0TnVtYmVyKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzaWRlbmNlc0xpc3QgPSBhd2FpdCByZXNpZGVuY2VzUXVlcnk7XG5cbiAgICAgIC8vIEFkZCBidWlsZGluZyBuYW1lIHRvIGVhY2ggcmVzaWRlbmNlIGZvciBiZXR0ZXIgVVhcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSW5mbyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBuYW1lOiBidWlsZGluZ3MubmFtZSB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGNvbnN0IHJlc2lkZW5jZXNXaXRoQnVpbGRpbmdOYW1lID0gcmVzaWRlbmNlc0xpc3QubWFwKHJlc2lkZW5jZSA9PiAoe1xuICAgICAgICAuLi5yZXNpZGVuY2UsXG4gICAgICAgIGJ1aWxkaW5nTmFtZTogYnVpbGRpbmdJbmZvWzBdPy5uYW1lIHx8ICdVbmtub3duIEJ1aWxkaW5nJ1xuICAgICAgfSkpO1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEZvdW5kICR7cmVzaWRlbmNlc0xpc3QubGVuZ3RofSByZXNpZGVuY2VzIGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9IGluIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gKTtcblxuICAgICAgcmVzLmpzb24ocmVzaWRlbmNlc1dpdGhCdWlsZGluZ05hbWUpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBidWlsZGluZyByZXNpZGVuY2VzOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCByZXNpZGVuY2VzIGZvciBidWlsZGluZycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sInZlcnNpb24iOjN9