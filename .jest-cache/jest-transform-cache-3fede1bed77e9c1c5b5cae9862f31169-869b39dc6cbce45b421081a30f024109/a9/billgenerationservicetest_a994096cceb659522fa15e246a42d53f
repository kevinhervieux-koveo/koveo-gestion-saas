f8ee736b6a2bce2a6671ff3178d154fb
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const bill_generation_service_1 = require("../../server/services/bill-generation-service");
const db_1 = require("../../server/db");
const schema_1 = require("../../shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
/**
 * Comprehensive test suite for the Bill Generation Service
 * Tests all aspects of sophisticated bill management including:
 * - Future bill instance generation
 * - Complex payment scenarios (60% now, 40% later)
 * - Multiple payment plans and installments
 * - Parent-child bill relationships
 * - 25-year projection capabilities
 * - Auto-generated bill management.
 */
(0, globals_1.describe)('BillGenerationService', () => {
    const mockSystemUser = {
        id: 'test-user-123',
        email: 'system@test.com',
        role: 'admin',
    };
    const mockBuilding = {
        id: 'building-123',
        organizationId: 'org-123',
    };
    (0, globals_1.beforeAll)(async () => {
        // Clean up any existing test data
        await db_1.db.delete(schema_1.bills).where((0, drizzle_orm_1.eq)(schema_1.bills.buildingId, mockBuilding.id));
    });
    (0, globals_1.afterAll)(async () => {
        // Clean up test data
        await db_1.db.delete(schema_1.bills).where((0, drizzle_orm_1.eq)(schema_1.bills.buildingId, mockBuilding.id));
    });
    (0, globals_1.describe)('generateFutureBillInstances', () => {
        (0, globals_1.it)('should generate monthly recurring bill instances for 25 years', async () => {
            const parentBill = {
                id: 'parent-bill-1',
                buildingId: mockBuilding.id,
                billNumber: 'MONTHLY-2024-001',
                title: 'Monthly Maintenance Fee',
                description: 'Regular building maintenance',
                category: 'maintenance',
                vendor: 'Maintenance Corp',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                scheduleCustom: null,
                costs: ['1200.00'],
                totalAmount: '1200.00',
                startDate: '2024-01-01',
                endDate: null,
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Should generate approximately 300 bills (25 years * 12 months)
            (0, globals_1.expect)(result.billsCreated).toBeGreaterThan(250);
            (0, globals_1.expect)(result.billsCreated).toBeLessThan(350);
            (0, globals_1.expect)(result.generatedUntil).toBeDefined();
            // Verify bills were actually created in database
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            (0, globals_1.expect)(generatedBills.length).toBe(result.billsCreated);
            // Check first generated bill properties
            const firstBill = generatedBills[0];
            (0, globals_1.expect)(firstBill.title).toContain('Monthly Maintenance Fee');
            (0, globals_1.expect)(firstBill.paymentType).toBe('unique');
            (0, globals_1.expect)(firstBill.autoGenerated).toBe(true);
            (0, globals_1.expect)(firstBill.reference).toBe(parentBill.id);
            (0, globals_1.expect)(firstBill.billNumber).toMatch(/MONTHLY-2024-001-\d{4}-\d{2}/);
        });
        (0, globals_1.it)('should handle complex payment scenarios - 60% now, 40% in 2 months', async () => {
            const parentBill = {
                id: 'parent-bill-complex',
                buildingId: mockBuilding.id,
                billNumber: 'COMPLEX-2024-001',
                title: 'Annual Insurance Premium',
                description: 'Split payment insurance',
                category: 'insurance',
                vendor: 'Insurance Corp',
                paymentType: 'recurrent',
                schedulePayment: 'yearly',
                scheduleCustom: null,
                costs: ['6000.00', '4000.00'], // 60% now, 40% later
                totalAmount: '10000.00',
                startDate: '2024-01-01',
                endDate: '2029-01-01', // 5 years
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Should generate 10 bills (5 years * 2 payments per year)
            (0, globals_1.expect)(result.billsCreated).toBe(10);
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)))
                .orderBy(schema_1.bills.startDate);
            // Verify payment amounts and timing
            (0, globals_1.expect)(parseFloat(generatedBills[0].totalAmount)).toBe(6000); // First payment 60%
            (0, globals_1.expect)(parseFloat(generatedBills[1].totalAmount)).toBe(4000); // Second payment 40%
            // Verify payment dates are 1 month apart
            const firstDate = new Date(generatedBills[0].startDate);
            const secondDate = new Date(generatedBills[1].startDate);
            const monthsDiff = (secondDate.getFullYear() - firstDate.getFullYear()) * 12 +
                (secondDate.getMonth() - firstDate.getMonth());
            (0, globals_1.expect)(monthsDiff).toBe(1);
            // Verify bill titles indicate payment parts
            (0, globals_1.expect)(generatedBills[0].title).toContain('Part 1/2');
            (0, globals_1.expect)(generatedBills[1].title).toContain('Part 2/2');
        });
        (0, globals_1.it)('should handle quarterly payments with custom dates', async () => {
            const parentBill = {
                id: 'parent-bill-quarterly',
                buildingId: mockBuilding.id,
                billNumber: 'QUARTERLY-2024-001',
                title: 'Quarterly Utilities',
                description: 'Seasonal utility payments',
                category: 'utilities',
                vendor: 'Utility Corp',
                paymentType: 'recurrent',
                schedulePayment: 'custom',
                scheduleCustom: ['2024-03-15', '2024-06-15', '2024-09-15', '2024-12-15'],
                costs: ['800.00'],
                totalAmount: '800.00',
                startDate: '2024-01-01',
                endDate: '2026-12-31', // 3 years
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Should generate 12 bills (3 years * 4 quarters)
            (0, globals_1.expect)(result.billsCreated).toBe(12);
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)))
                .orderBy(schema_1.bills.startDate);
            // Verify custom dates are respected
            (0, globals_1.expect)(generatedBills[0].startDate).toBe('2024-03-15');
            (0, globals_1.expect)(generatedBills[1].startDate).toBe('2024-06-15');
            (0, globals_1.expect)(generatedBills[2].startDate).toBe('2024-09-15');
            (0, globals_1.expect)(generatedBills[3].startDate).toBe('2024-12-15');
        });
        (0, globals_1.it)('should handle weekly recurring payments', async () => {
            const parentBill = {
                id: 'parent-bill-weekly',
                buildingId: mockBuilding.id,
                billNumber: 'WEEKLY-2024-001',
                title: 'Weekly Cleaning Service',
                description: 'Regular cleaning',
                category: 'cleaning',
                vendor: 'Clean Corp',
                paymentType: 'recurrent',
                schedulePayment: 'weekly',
                scheduleCustom: null,
                costs: ['150.00'],
                totalAmount: '150.00',
                startDate: '2024-01-01',
                endDate: '2024-03-31', // 3 months to limit test data
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Should generate approximately 13 bills (3 months * 4.33 weeks per month)
            (0, globals_1.expect)(result.billsCreated).toBeGreaterThan(10);
            (0, globals_1.expect)(result.billsCreated).toBeLessThan(16);
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)))
                .orderBy(schema_1.bills.startDate);
            // Verify weekly intervals
            const firstDate = new Date(generatedBills[0].startDate);
            const secondDate = new Date(generatedBills[1].startDate);
            const daysDiff = (secondDate.getTime() - firstDate.getTime()) / (1000 * 60 * 60 * 24);
            (0, globals_1.expect)(daysDiff).toBe(7);
        });
        (0, globals_1.it)('should reject non-recurrent bills', async () => {
            const uniqueBill = {
                id: 'unique-bill-1',
                buildingId: mockBuilding.id,
                paymentType: 'unique',
                schedulePayment: null,
                title: 'One-time bill',
            };
            await (0, globals_1.expect)(bill_generation_service_1.billGenerationService.generateFutureBillInstances(uniqueBill)).rejects.toThrow('Only recurrent bills can generate future instances');
        });
        (0, globals_1.it)('should clean up existing generated bills before creating new ones', async () => {
            const parentBill = {
                id: 'parent-bill-cleanup',
                buildingId: mockBuilding.id,
                billNumber: 'CLEANUP-2024-001',
                title: 'Test Cleanup Bill',
                description: 'Testing cleanup',
                category: 'maintenance',
                vendor: 'Test Corp',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                scheduleCustom: null,
                costs: ['500.00'],
                totalAmount: '500.00',
                startDate: '2024-01-01',
                endDate: '2024-06-30', // 6 months
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            // Generate bills first time
            const firstResult = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            (0, globals_1.expect)(firstResult.billsCreated).toBe(6);
            // Generate again - should clean up and recreate
            const secondResult = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            (0, globals_1.expect)(secondResult.billsCreated).toBe(6);
            // Should still only have 6 bills total, not 12
            const finalBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            (0, globals_1.expect)(finalBills.length).toBe(6);
        });
    });
    (0, globals_1.describe)('updateGeneratedBillsFromParent', () => {
        (0, globals_1.it)('should update all generated bills when parent is modified', async () => {
            const parentBill = {
                id: 'parent-bill-update',
                buildingId: mockBuilding.id,
                billNumber: 'UPDATE-2024-001',
                title: 'Original Title',
                description: 'Original description',
                category: 'maintenance',
                vendor: 'Original Vendor',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                scheduleCustom: null,
                costs: ['300.00'],
                totalAmount: '300.00',
                startDate: '2024-01-01',
                endDate: '2024-04-30', // 4 months
                status: 'active',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
                createdAt: new Date(),
                updatedAt: new Date(),
            };
            // Generate initial bills
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Update parent bill information
            const updates = {
                title: 'Updated Title',
                category: 'utilities',
                vendor: 'New Vendor Corp',
                notes: 'Updated via cascade',
            };
            const result = await bill_generation_service_1.billGenerationService.updateGeneratedBillsFromParent(parentBill.id, updates);
            (0, globals_1.expect)(result.billsUpdated).toBe(4);
            // Verify bills were updated
            const updatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            updatedBills.forEach((bill) => {
                (0, globals_1.expect)(bill.title).toContain('Updated Title');
                (0, globals_1.expect)(bill.category).toBe('utilities');
                (0, globals_1.expect)(bill.vendor).toBe('New Vendor Corp');
                (0, globals_1.expect)(bill.notes).toContain('Updated via cascade');
            });
        });
        (0, globals_1.it)('should preserve date and part information in titles when updating', async () => {
            const parentBill = {
                id: 'parent-bill-title-preserve',
                buildingId: mockBuilding.id,
                billNumber: 'PRESERVE-2024-001',
                title: 'Original Complex Bill',
                category: 'utilities',
                vendor: 'Test Vendor',
                paymentType: 'recurrent',
                schedulePayment: 'yearly',
                costs: ['2000.00', '1000.00'], // Two payments
                totalAmount: '3000.00',
                startDate: '2024-01-01',
                endDate: '2025-01-01',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
            };
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            const updates = { title: 'Updated Complex Bill' };
            await bill_generation_service_1.billGenerationService.updateGeneratedBillsFromParent(parentBill.id, updates);
            const updatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)))
                .orderBy(schema_1.bills.startDate);
            // Should preserve the date and part information
            (0, globals_1.expect)(updatedBills[0].title).toMatch(/Updated Complex Bill - .* \(Part 1\/2\)/);
            (0, globals_1.expect)(updatedBills[1].title).toMatch(/Updated Complex Bill - .* \(Part 2\/2\)/);
        });
    });
    (0, globals_1.describe)('markBillAsPaid', () => {
        (0, globals_1.it)('should mark a bill as paid with payment date', async () => {
            const testBill = {
                id: 'test-bill-paid',
                buildingId: mockBuilding.id,
                billNumber: 'PAID-2024-001',
                title: 'Test Payment Bill',
                status: 'sent',
                totalAmount: '500.00',
                autoGenerated: true,
                reference: 'parent-bill-id',
                createdBy: mockSystemUser.id,
            };
            // Insert test bill
            await db_1.db.insert(schema_1.bills).values(testBill);
            const paymentDate = new Date('2024-02-15');
            await bill_generation_service_1.billGenerationService.markBillAsPaid(testBill.id, paymentDate);
            // Verify bill was marked as paid
            const [updatedBill] = await db_1.db.select().from(schema_1.bills).where((0, drizzle_orm_1.eq)(schema_1.bills.id, testBill.id));
            (0, globals_1.expect)(updatedBill.status).toBe('paid');
            (0, globals_1.expect)(updatedBill.notes).toContain('Payment confirmed on 2/15/2024');
        });
        (0, globals_1.it)('should use current date when no payment date provided', async () => {
            const testBill = {
                id: 'test-bill-paid-auto',
                buildingId: mockBuilding.id,
                billNumber: 'PAID-AUTO-2024-001',
                title: 'Auto Date Payment Bill',
                status: 'sent',
                totalAmount: '750.00',
                autoGenerated: true,
                reference: 'parent-bill-id',
                createdBy: mockSystemUser.id,
            };
            await db_1.db.insert(schema_1.bills).values(testBill);
            await bill_generation_service_1.billGenerationService.markBillAsPaid(testBill.id);
            const [updatedBill] = await db_1.db.select().from(schema_1.bills).where((0, drizzle_orm_1.eq)(schema_1.bills.id, testBill.id));
            (0, globals_1.expect)(updatedBill.status).toBe('paid');
            (0, globals_1.expect)(updatedBill.notes).toContain('Payment confirmed on');
        });
    });
    (0, globals_1.describe)('getGeneratedBillsStats', () => {
        (0, globals_1.it)('should return comprehensive statistics for generated bills', async () => {
            const parentBill = {
                id: 'parent-bill-stats',
                buildingId: mockBuilding.id,
                billNumber: 'STATS-2024-001',
                title: 'Statistics Test Bill',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                costs: ['400.00'],
                totalAmount: '400.00',
                startDate: '2024-01-01',
                endDate: '2024-06-30', // 6 months
                createdBy: mockSystemUser.id,
            };
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            // Mark some bills as paid
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            // Mark first 2 bills as paid
            for (let i = 0; i < 2; i++) {
                await bill_generation_service_1.billGenerationService.markBillAsPaid(generatedBills[i].id);
            }
            const stats = await bill_generation_service_1.billGenerationService.getGeneratedBillsStats(parentBill.id);
            (0, globals_1.expect)(stats.totalGenerated).toBe(6);
            (0, globals_1.expect)(stats.paidBills).toBe(2);
            (0, globals_1.expect)(stats.pendingBills).toBeGreaterThan(0);
            (0, globals_1.expect)(stats.futureBills).toBeGreaterThan(0);
            (0, globals_1.expect)(stats.totalAmount).toBe(2400); // 6 bills * $400
            (0, globals_1.expect)(stats.paidAmount).toBe(800); // 2 bills * $400
        });
        (0, globals_1.it)('should categorize bills by date correctly', async () => {
            const today = new Date();
            const pastDate = new Date(today);
            pastDate.setMonth(pastDate.getMonth() - 1);
            const futureDate = new Date(today);
            futureDate.setMonth(futureDate.getMonth() + 1);
            const parentBill = {
                id: 'parent-bill-date-stats',
                buildingId: mockBuilding.id,
                billNumber: 'DATE-STATS-2024-001',
                title: 'Date Statistics Test',
                paymentType: 'recurrent',
                schedulePayment: 'custom',
                scheduleCustom: [
                    pastDate.toISOString().split('T')[0],
                    today.toISOString().split('T')[0],
                    futureDate.toISOString().split('T')[0],
                ],
                costs: ['200.00'],
                totalAmount: '200.00',
                startDate: pastDate.toISOString().split('T')[0],
                endDate: futureDate.toISOString().split('T')[0],
                createdBy: mockSystemUser.id,
            };
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            const stats = await bill_generation_service_1.billGenerationService.getGeneratedBillsStats(parentBill.id);
            (0, globals_1.expect)(stats.totalGenerated).toBe(3);
            (0, globals_1.expect)(stats.futureBills).toBe(1); // Only future date bill
            (0, globals_1.expect)(stats.pendingBills).toBe(2); // Past and today bills
        });
    });
    (0, globals_1.describe)('deleteGeneratedBills', () => {
        (0, globals_1.it)('should delete only unpaid bills by default', async () => {
            const parentBill = {
                id: 'parent-bill-delete',
                buildingId: mockBuilding.id,
                billNumber: 'DELETE-2024-001',
                title: 'Delete Test Bill',
                category: 'maintenance',
                vendor: 'Test Vendor',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                costs: ['350.00'],
                totalAmount: '350.00',
                startDate: '2024-01-01',
                endDate: '2024-05-31', // 5 months
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
            };
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            // Mark first bill as paid
            await bill_generation_service_1.billGenerationService.markBillAsPaid(generatedBills[0].id);
            const result = await bill_generation_service_1.billGenerationService.deleteGeneratedBills(parentBill.id, false);
            // Should delete 4 unpaid bills, keep 1 paid bill
            (0, globals_1.expect)(result.billsDeleted).toBe(4);
            const remainingBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            (0, globals_1.expect)(remainingBills.length).toBe(1);
            (0, globals_1.expect)(remainingBills[0].status).toBe('paid');
        });
        (0, globals_1.it)('should delete all future bills when deleteAllFuture is true', async () => {
            const parentBill = {
                id: 'parent-bill-delete-all',
                buildingId: mockBuilding.id,
                billNumber: 'DELETE-ALL-2024-001',
                title: 'Delete All Test Bill',
                category: 'maintenance',
                vendor: 'Test Vendor',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                costs: ['250.00'],
                totalAmount: '250.00',
                startDate: '2024-06-01', // Future date
                endDate: '2024-10-31', // 5 months in future
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
            };
            await bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill);
            const generatedBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            // Mark first bill as paid
            await bill_generation_service_1.billGenerationService.markBillAsPaid(generatedBills[0].id);
            const result = await bill_generation_service_1.billGenerationService.deleteGeneratedBills(parentBill.id, true);
            // Should delete all bills including paid ones (since they're in the future)
            (0, globals_1.expect)(result.billsDeleted).toBe(5);
            const remainingBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            (0, globals_1.expect)(remainingBills.length).toBe(0);
        });
    });
    (0, globals_1.describe)('Edge Cases and Error Handling', () => {
        (0, globals_1.it)('should handle bills with no costs array', async () => {
            const invalidBill = {
                id: 'invalid-bill-1',
                buildingId: mockBuilding.id,
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                costs: [], // Empty costs array
                startDate: '2024-01-01',
                endDate: '2024-03-31',
                createdBy: mockSystemUser.id,
            };
            await (0, globals_1.expect)(bill_generation_service_1.billGenerationService.generateFutureBillInstances(invalidBill)).rejects.toThrow();
        });
        (0, globals_1.it)('should handle very long projection periods safely', async () => {
            const longTermBill = {
                id: 'long-term-bill',
                buildingId: mockBuilding.id,
                billNumber: 'LONG-2024-001',
                title: 'Long Term Bill',
                paymentType: 'recurrent',
                schedulePayment: 'weekly',
                costs: ['50.00'],
                totalAmount: '50.00',
                startDate: '2024-01-01',
                endDate: null, // No end date - should limit to 25 years
                createdBy: mockSystemUser.id,
            };
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(longTermBill);
            // Should not generate more than 10,000 bills (safety limit)
            (0, globals_1.expect)(result.billsCreated).toBeLessThan(10000);
            (0, globals_1.expect)(result.billsCreated).toBeGreaterThan(1000); // But should generate many for 25 years
        });
        (0, globals_1.it)('should handle invalid schedule types gracefully', async () => {
            const invalidScheduleBill = {
                id: 'invalid-schedule-bill',
                buildingId: mockBuilding.id,
                paymentType: 'recurrent',
                schedulePayment: 'invalid-schedule',
                costs: ['100.00'],
                startDate: '2024-01-01',
                endDate: '2024-12-31',
                createdBy: mockSystemUser.id,
            };
            await (0, globals_1.expect)(bill_generation_service_1.billGenerationService.generateFutureBillInstances(invalidScheduleBill)).rejects.toThrow('Unknown schedule type: invalid-schedule');
        });
        (0, globals_1.it)('should handle concurrent generation requests', async () => {
            const parentBill = {
                id: 'concurrent-bill',
                buildingId: mockBuilding.id,
                billNumber: 'CONCURRENT-2024-001',
                title: 'Concurrent Test Bill',
                category: 'utilities',
                vendor: 'Test Vendor',
                paymentType: 'recurrent',
                schedulePayment: 'monthly',
                costs: ['100.00'],
                totalAmount: '100.00',
                startDate: '2024-01-01',
                endDate: '2024-06-30',
                autoGenerated: false,
                reference: null,
                createdBy: mockSystemUser.id,
            };
            // Run generation concurrently
            const [result1, result2] = await Promise.all([
                bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill),
                bill_generation_service_1.billGenerationService.generateFutureBillInstances(parentBill),
            ]);
            // Both should succeed, but only one set of bills should exist
            (0, globals_1.expect)(result1.billsCreated).toBe(6);
            (0, globals_1.expect)(result2.billsCreated).toBe(6);
            const finalBills = await db_1.db
                .select()
                .from(schema_1.bills)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.bills.reference, parentBill.id), (0, drizzle_orm_1.eq)(schema_1.bills.autoGenerated, true)));
            // Should not have duplicates
            (0, globals_1.expect)(finalBills.length).toBe(6);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2JpbGwtZ2VuZXJhdGlvbi1zZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQ0FTdUI7QUFDdkIsMkZBQXNGO0FBQ3RGLHdDQUFxQztBQUNyQyxnREFBNkQ7QUFDN0QsNkNBQXNDO0FBRXRDOzs7Ozs7Ozs7R0FTRztBQUVILElBQUEsa0JBQVEsRUFBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7SUFDckMsTUFBTSxjQUFjLEdBQUc7UUFDckIsRUFBRSxFQUFFLGVBQWU7UUFDbkIsS0FBSyxFQUFFLGlCQUFpQjtRQUN4QixJQUFJLEVBQUUsT0FBTztLQUNkLENBQUM7SUFFRixNQUFNLFlBQVksR0FBRztRQUNuQixFQUFFLEVBQUUsY0FBYztRQUNsQixjQUFjLEVBQUUsU0FBUztLQUMxQixDQUFDO0lBRUYsSUFBQSxtQkFBUyxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ25CLGtDQUFrQztRQUNsQyxNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsY0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxjQUFLLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ2xCLHFCQUFxQjtRQUNyQixNQUFNLE9BQUUsQ0FBQyxNQUFNLENBQUMsY0FBSyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxjQUFLLENBQUMsVUFBVSxFQUFFLFlBQVksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3RFLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtRQUMzQyxJQUFBLFlBQUUsRUFBQywrREFBK0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RSxNQUFNLFVBQVUsR0FBRztnQkFDakIsRUFBRSxFQUFFLGVB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QixNQUFNLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQztnQkFDM0MsK0NBQXFCLENBQUMsMkJBQTJCLENBQUMsVUFBaUIsQ0FBQztnQkFDcEUsK0NBQXFCLENBQUMsMkJBQTJCLENBQUMsVUFBaUIsQ0FBQzthQUNyRSxDQUFDLENBQUM7WUFFSCw4REFBOEQ7WUFDOUQsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsSUFBQSxnQkFBTSxFQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFckMsTUFBTSxVQUFVLEdBQUcsTUFBTSxPQUFFO2lCQUN4QixNQUFNLEVBQUU7aUJBQ1IsSUFBSSxDQUFDLGNBQUssQ0FBQztpQkFDWCxLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxjQUFLLENBQUMsU0FBUyxFQUFFLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsY0FBSyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFakYsNkJBQTZCO1lBQzdCLElBQUEsZ0JBQU0sRUFBQyxVQUFVLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3Rlc3RzL3VuaXQvYmlsbC1nZW5lcmF0aW9uLXNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBkZXNjcmliZSxcbiAgaXQsXG4gIGV4cGVjdCxcbiAgYmVmb3JlRWFjaCBhcyBfYmVmb3JlRWFjaCxcbiAgYWZ0ZXJFYWNoIGFzIF9hZnRlckVhY2gsXG4gIGplc3QgYXMgX2plc3QsXG4gIGJlZm9yZUFsbCxcbiAgYWZ0ZXJBbGwsXG59IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHsgYmlsbEdlbmVyYXRpb25TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmVyL3NlcnZpY2VzL2JpbGwtZ2VuZXJhdGlvbi1zZXJ2aWNlJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vLi4vc2VydmVyL2RiJztcbmltcG9ydCB7IGJpbGxzLCB1c2VycyBhcyBfdXNlcnMgfSBmcm9tICcuLi8uLi9zaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8qKlxuICogQ29tcHJlaGVuc2l2ZSB0ZXN0IHN1aXRlIGZvciB0aGUgQmlsbCBHZW5lcmF0aW9uIFNlcnZpY2VcbiAqIFRlc3RzIGFsbCBhc3BlY3RzIG9mIHNvcGhpc3RpY2F0ZWQgYmlsbCBtYW5hZ2VtZW50IGluY2x1ZGluZzpcbiAqIC0gRnV0dXJlIGJpbGwgaW5zdGFuY2UgZ2VuZXJhdGlvblxuICogLSBDb21wbGV4IHBheW1lbnQgc2NlbmFyaW9zICg2MCUgbm93LCA0MCUgbGF0ZXIpXG4gKiAtIE11bHRpcGxlIHBheW1lbnQgcGxhbnMgYW5kIGluc3RhbGxtZW50c1xuICogLSBQYXJlbnQtY2hpbGQgYmlsbCByZWxhdGlvbnNoaXBzXG4gKiAtIDI1LXllYXIgcHJvamVjdGlvbiBjYXBhYmlsaXRpZXNcbiAqIC0gQXV0by1nZW5lcmF0ZWQgYmlsbCBtYW5hZ2VtZW50LlxuICovXG5cbmRlc2NyaWJlKCdCaWxsR2VuZXJhdGlvblNlcnZpY2UnLCAoKSA9PiB7XG4gIGNvbnN0IG1vY2tTeXN0ZW1Vc2VyID0ge1xuICAgIGlkOiAndGVzdC11c2VyLTEyMycsXG4gICAgZW1haWw6ICdzeXN0ZW1AdGVzdC5jb20nLFxuICAgIHJvbGU6ICdhZG1pbicsXG4gIH07XG5cbiAgY29uc3QgbW9ja0J1aWxkaW5nID0ge1xuICAgIGlkOiAnYnVpbGRpbmctMTIzJyxcbiAgICBvcmdhbml6YXRpb25JZDogJ29yZy0xMjMnLFxuICB9O1xuXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgLy8gQ2xlYW4gdXAgYW55IGV4aXN0aW5nIHRlc3QgZGF0YVxuICAgIGF3YWl0IGRiLmRlbGV0ZShiaWxscykud2hlcmUoZXEoYmlsbHMuYnVpbGRpbmdJZCwgbW9ja0J1aWxkaW5nLmlkKSk7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbiB1cCB0ZXN0IGRhdGFcbiAgICBhd2FpdCBkYi5kZWxldGUoYmlsbHMpLndoZXJlKGVxKGJpbGxzLmJ1aWxkaW5nSWQsIG1vY2tCdWlsZGluZy5pZCkpO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgbW9udGhseSByZWN1cnJpbmcgYmlsbCBpbnN0YW5jZXMgZm9yIDI1IHllYXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFyZW50QmlsbCA9IHtcbiAgICAgICAgaWQ6ICdwYXJlbnQtYmlsbC0xJyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnTU9OVEhMWS0yMDI0LTAwMScsXG4gICAgICAgIHRpdGxlOiAnTW9udGhseSBNYWludGVuYW5jZSBGZWUnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1JlZ3VsYXIgYnVpbGRpbmcgbWFpbnRlbmFuY2UnLFxuICAgICAgICBjYXRlZ29yeTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgdmVuZG9yOiAnTWFpbnRlbmFuY2UgQ29ycCcsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAnbW9udGhseScsXG4gICAgICAgIHNjaGVkdWxlQ3VzdG9tOiBudWxsLFxuICAgICAgICBjb3N0czogWycxMjAwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnMTIwMC4wMCcsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDEnLFxuICAgICAgICBlbmREYXRlOiBudWxsLFxuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBhdXRvR2VuZXJhdGVkOiBmYWxzZSxcbiAgICAgICAgcmVmZXJlbmNlOiBudWxsLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZUZ1dHVyZUJpbGxJbnN0YW5jZXMocGFyZW50QmlsbCBhcyBhbnkpO1xuXG4gICAgICAvLyBTaG91bGQgZ2VuZXJhdGUgYXBwcm94aW1hdGVseSAzMDAgYmlsbHMgKDI1IHllYXJzICogMTIgbW9udGhzKVxuICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsc0NyZWF0ZWQpLnRvQmVHcmVhdGVyVGhhbigyNTApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsc0NyZWF0ZWQpLnRvQmVMZXNzVGhhbigzNTApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5nZW5lcmF0ZWRVbnRpbCkudG9CZURlZmluZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IGJpbGxzIHdlcmUgYWN0dWFsbHkgY3JlYXRlZCBpbiBkYXRhYmFzZVxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKTtcblxuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzLmxlbmd0aCkudG9CZShyZXN1bHQuYmlsbHNDcmVhdGVkKTtcblxuICAgICAgLy8gQ2hlY2sgZmlyc3QgZ2VuZXJhdGVkIGJpbGwgcHJvcGVydGllc1xuICAgICAgY29uc3QgZmlyc3RCaWxsID0gZ2VuZXJhdGVkQmlsbHNbMF07XG4gICAgICBleHBlY3QoZmlyc3RCaWxsLnRpdGxlKS50b0NvbnRhaW4oJ01vbnRobHkgTWFpbnRlbmFuY2UgRmVlJyk7XG4gICAgICBleHBlY3QoZmlyc3RCaWxsLnBheW1lbnRUeXBlKS50b0JlKCd1bmlxdWUnKTtcbiAgICAgIGV4cGVjdChmaXJzdEJpbGwuYXV0b0dlbmVyYXRlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChmaXJzdEJpbGwucmVmZXJlbmNlKS50b0JlKHBhcmVudEJpbGwuaWQpO1xuICAgICAgZXhwZWN0KGZpcnN0QmlsbC5iaWxsTnVtYmVyKS50b01hdGNoKC9NT05USExZLTIwMjQtMDAxLVxcZHs0fS1cXGR7Mn0vKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbXBsZXggcGF5bWVudCBzY2VuYXJpb3MgLSA2MCUgbm93LCA0MCUgaW4gMiBtb250aHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJlbnRCaWxsID0ge1xuICAgICAgICBpZDogJ3BhcmVudC1iaWxsLWNvbXBsZXgnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdDT01QTEVYLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdBbm51YWwgSW5zdXJhbmNlIFByZW1pdW0nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1NwbGl0IHBheW1lbnQgaW5zdXJhbmNlJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdpbnN1cmFuY2UnLFxuICAgICAgICB2ZW5kb3I6ICdJbnN1cmFuY2UgQ29ycCcsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAneWVhcmx5JyxcbiAgICAgICAgc2NoZWR1bGVDdXN0b206IG51bGwsXG4gICAgICAgIGNvc3RzOiBbJzYwMDAuMDAnLCAnNDAwMC4wMCddLCAvLyA2MCUgbm93LCA0MCUgbGF0ZXJcbiAgICAgICAgdG90YWxBbW91bnQ6ICcxMDAwMC4wMCcsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDEnLFxuICAgICAgICBlbmREYXRlOiAnMjAyOS0wMS0wMScsIC8vIDUgeWVhcnNcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgYXV0b0dlbmVyYXRlZDogZmFsc2UsXG4gICAgICAgIHJlZmVyZW5jZTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHBhcmVudEJpbGwgYXMgYW55KTtcblxuICAgICAgLy8gU2hvdWxkIGdlbmVyYXRlIDEwIGJpbGxzICg1IHllYXJzICogMiBwYXltZW50cyBwZXIgeWVhcilcbiAgICAgIGV4cGVjdChyZXN1bHQuYmlsbHNDcmVhdGVkKS50b0JlKDEwKTtcblxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKVxuICAgICAgICAub3JkZXJCeShiaWxscy5zdGFydERhdGUpO1xuXG4gICAgICAvLyBWZXJpZnkgcGF5bWVudCBhbW91bnRzIGFuZCB0aW1pbmdcbiAgICAgIGV4cGVjdChwYXJzZUZsb2F0KGdlbmVyYXRlZEJpbGxzWzBdLnRvdGFsQW1vdW50KSkudG9CZSg2MDAwKTsgLy8gRmlyc3QgcGF5bWVudCA2MCVcbiAgICAgIGV4cGVjdChwYXJzZUZsb2F0KGdlbmVyYXRlZEJpbGxzWzFdLnRvdGFsQW1vdW50KSkudG9CZSg0MDAwKTsgLy8gU2Vjb25kIHBheW1lbnQgNDAlXG5cbiAgICAgIC8vIFZlcmlmeSBwYXltZW50IGRhdGVzIGFyZSAxIG1vbnRoIGFwYXJ0XG4gICAgICBjb25zdCBmaXJzdERhdGUgPSBuZXcgRGF0ZShnZW5lcmF0ZWRCaWxsc1swXS5zdGFydERhdGUpO1xuICAgICAgY29uc3Qgc2Vjb25kRGF0ZSA9IG5ldyBEYXRlKGdlbmVyYXRlZEJpbGxzWzFdLnN0YXJ0RGF0ZSk7XG4gICAgICBjb25zdCBtb250aHNEaWZmID1cbiAgICAgICAgKHNlY29uZERhdGUuZ2V0RnVsbFllYXIoKSAtIGZpcnN0RGF0ZS5nZXRGdWxsWWVhcigpKSAqIDEyICtcbiAgICAgICAgKHNlY29uZERhdGUuZ2V0TW9udGgoKSAtIGZpcnN0RGF0ZS5nZXRNb250aCgpKTtcbiAgICAgIGV4cGVjdChtb250aHNEaWZmKS50b0JlKDEpO1xuXG4gICAgICAvLyBWZXJpZnkgYmlsbCB0aXRsZXMgaW5kaWNhdGUgcGF5bWVudCBwYXJ0c1xuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzWzBdLnRpdGxlKS50b0NvbnRhaW4oJ1BhcnQgMS8yJyk7XG4gICAgICBleHBlY3QoZ2VuZXJhdGVkQmlsbHNbMV0udGl0bGUpLnRvQ29udGFpbignUGFydCAyLzInKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHF1YXJ0ZXJseSBwYXltZW50cyB3aXRoIGN1c3RvbSBkYXRlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudEJpbGwgPSB7XG4gICAgICAgIGlkOiAncGFyZW50LWJpbGwtcXVhcnRlcmx5JyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnUVVBUlRFUkxZLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdRdWFydGVybHkgVXRpbGl0aWVzJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdTZWFzb25hbCB1dGlsaXR5IHBheW1lbnRzJyxcbiAgICAgICAgY2F0ZWdvcnk6ICd1dGlsaXRpZXMnLFxuICAgICAgICB2ZW5kb3I6ICdVdGlsaXR5IENvcnAnLFxuICAgICAgICBwYXltZW50VHlwZTogJ3JlY3VycmVudCcsXG4gICAgICAgIHNjaGVkdWxlUGF5bWVudDogJ2N1c3RvbScsXG4gICAgICAgIHNjaGVkdWxlQ3VzdG9tOiBbJzIwMjQtMDMtMTUnLCAnMjAyNC0wNi0xNScsICcyMDI0LTA5LTE1JywgJzIwMjQtMTItMTUnXSxcbiAgICAgICAgY29zdHM6IFsnODAwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnODAwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI2LTEyLTMxJywgLy8gMyB5ZWFyc1xuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBhdXRvR2VuZXJhdGVkOiBmYWxzZSxcbiAgICAgICAgcmVmZXJlbmNlOiBudWxsLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZUZ1dHVyZUJpbGxJbnN0YW5jZXMocGFyZW50QmlsbCBhcyBhbnkpO1xuXG4gICAgICAvLyBTaG91bGQgZ2VuZXJhdGUgMTIgYmlsbHMgKDMgeWVhcnMgKiA0IHF1YXJ0ZXJzKVxuICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsc0NyZWF0ZWQpLnRvQmUoMTIpO1xuXG4gICAgICBjb25zdCBnZW5lcmF0ZWRCaWxscyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKGFuZChlcShiaWxscy5yZWZlcmVuY2UsIHBhcmVudEJpbGwuaWQpLCBlcShiaWxscy5hdXRvR2VuZXJhdGVkLCB0cnVlKSkpXG4gICAgICAgIC5vcmRlckJ5KGJpbGxzLnN0YXJ0RGF0ZSk7XG5cbiAgICAgIC8vIFZlcmlmeSBjdXN0b20gZGF0ZXMgYXJlIHJlc3BlY3RlZFxuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzWzBdLnN0YXJ0RGF0ZSkudG9CZSgnMjAyNC0wMy0xNScpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzWzFdLnN0YXJ0RGF0ZSkudG9CZSgnMjAyNC0wNi0xNScpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzWzJdLnN0YXJ0RGF0ZSkudG9CZSgnMjAyNC0wOS0xNScpO1xuICAgICAgZXhwZWN0KGdlbmVyYXRlZEJpbGxzWzNdLnN0YXJ0RGF0ZSkudG9CZSgnMjAyNC0xMi0xNScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgd2Vla2x5IHJlY3VycmluZyBwYXltZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudEJpbGwgPSB7XG4gICAgICAgIGlkOiAncGFyZW50LWJpbGwtd2Vla2x5JyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnV0VFS0xZLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdXZWVrbHkgQ2xlYW5pbmcgU2VydmljZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUmVndWxhciBjbGVhbmluZycsXG4gICAgICAgIGNhdGVnb3J5OiAnY2xlYW5pbmcnLFxuICAgICAgICB2ZW5kb3I6ICdDbGVhbiBDb3JwJyxcbiAgICAgICAgcGF5bWVudFR5cGU6ICdyZWN1cnJlbnQnLFxuICAgICAgICBzY2hlZHVsZVBheW1lbnQ6ICd3ZWVrbHknLFxuICAgICAgICBzY2hlZHVsZUN1c3RvbTogbnVsbCxcbiAgICAgICAgY29zdHM6IFsnMTUwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnMTUwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTAzLTMxJywgLy8gMyBtb250aHMgdG8gbGltaXQgdGVzdCBkYXRhXG4gICAgICAgIHN0YXR1czogJ2FjdGl2ZScsXG4gICAgICAgIGF1dG9HZW5lcmF0ZWQ6IGZhbHNlLFxuICAgICAgICByZWZlcmVuY2U6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRCeTogbW9ja1N5c3RlbVVzZXIuaWQsXG4gICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhwYXJlbnRCaWxsIGFzIGFueSk7XG5cbiAgICAgIC8vIFNob3VsZCBnZW5lcmF0ZSBhcHByb3hpbWF0ZWx5IDEzIGJpbGxzICgzIG1vbnRocyAqIDQuMzMgd2Vla3MgcGVyIG1vbnRoKVxuICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsc0NyZWF0ZWQpLnRvQmVHcmVhdGVyVGhhbigxMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmJpbGxzQ3JlYXRlZCkudG9CZUxlc3NUaGFuKDE2KTtcblxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKVxuICAgICAgICAub3JkZXJCeShiaWxscy5zdGFydERhdGUpO1xuXG4gICAgICAvLyBWZXJpZnkgd2Vla2x5IGludGVydmFsc1xuICAgICAgY29uc3QgZmlyc3REYXRlID0gbmV3IERhdGUoZ2VuZXJhdGVkQmlsbHNbMF0uc3RhcnREYXRlKTtcbiAgICAgIGNvbnN0IHNlY29uZERhdGUgPSBuZXcgRGF0ZShnZW5lcmF0ZWRCaWxsc1sxXS5zdGFydERhdGUpO1xuICAgICAgY29uc3QgZGF5c0RpZmYgPSAoc2Vjb25kRGF0ZS5nZXRUaW1lKCkgLSBmaXJzdERhdGUuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCAqIDI0KTtcbiAgICAgIGV4cGVjdChkYXlzRGlmZikudG9CZSg3KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVqZWN0IG5vbi1yZWN1cnJlbnQgYmlsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB1bmlxdWVCaWxsID0ge1xuICAgICAgICBpZDogJ3VuaXF1ZS1iaWxsLTEnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIHBheW1lbnRUeXBlOiAndW5pcXVlJyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiBudWxsLFxuICAgICAgICB0aXRsZTogJ09uZS10aW1lIGJpbGwnLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHVuaXF1ZUJpbGwgYXMgYW55KVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ09ubHkgcmVjdXJyZW50IGJpbGxzIGNhbiBnZW5lcmF0ZSBmdXR1cmUgaW5zdGFuY2VzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNsZWFuIHVwIGV4aXN0aW5nIGdlbmVyYXRlZCBiaWxscyBiZWZvcmUgY3JlYXRpbmcgbmV3IG9uZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJlbnRCaWxsID0ge1xuICAgICAgICBpZDogJ3BhcmVudC1iaWxsLWNsZWFudXAnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdDTEVBTlVQLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdUZXN0IENsZWFudXAgQmlsbCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdGluZyBjbGVhbnVwJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdtYWludGVuYW5jZScsXG4gICAgICAgIHZlbmRvcjogJ1Rlc3QgQ29ycCcsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAnbW9udGhseScsXG4gICAgICAgIHNjaGVkdWxlQ3VzdG9tOiBudWxsLFxuICAgICAgICBjb3N0czogWyc1MDAuMDAnXSxcbiAgICAgICAgdG90YWxBbW91bnQ6ICc1MDAuMDAnLFxuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDYtMzAnLCAvLyA2IG1vbnRoc1xuICAgICAgICBzdGF0dXM6ICdhY3RpdmUnLFxuICAgICAgICBhdXRvR2VuZXJhdGVkOiBmYWxzZSxcbiAgICAgICAgcmVmZXJlbmNlOiBudWxsLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIEdlbmVyYXRlIGJpbGxzIGZpcnN0IHRpbWVcbiAgICAgIGNvbnN0IGZpcnN0UmVzdWx0ID0gYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhcbiAgICAgICAgcGFyZW50QmlsbCBhcyBhbnlcbiAgICAgICk7XG4gICAgICBleHBlY3QoZmlyc3RSZXN1bHQuYmlsbHNDcmVhdGVkKS50b0JlKDYpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSBhZ2FpbiAtIHNob3VsZCBjbGVhbiB1cCBhbmQgcmVjcmVhdGVcbiAgICAgIGNvbnN0IHNlY29uZFJlc3VsdCA9IGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZUZ1dHVyZUJpbGxJbnN0YW5jZXMoXG4gICAgICAgIHBhcmVudEJpbGwgYXMgYW55XG4gICAgICApO1xuICAgICAgZXhwZWN0KHNlY29uZFJlc3VsdC5iaWxsc0NyZWF0ZWQpLnRvQmUoNik7XG5cbiAgICAgIC8vIFNob3VsZCBzdGlsbCBvbmx5IGhhdmUgNiBiaWxscyB0b3RhbCwgbm90IDEyXG4gICAgICBjb25zdCBmaW5hbEJpbGxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJpbGxzLnJlZmVyZW5jZSwgcGFyZW50QmlsbC5pZCksIGVxKGJpbGxzLmF1dG9HZW5lcmF0ZWQsIHRydWUpKSk7XG5cbiAgICAgIGV4cGVjdChmaW5hbEJpbGxzLmxlbmd0aCkudG9CZSg2KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3VwZGF0ZUdlbmVyYXRlZEJpbGxzRnJvbVBhcmVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVwZGF0ZSBhbGwgZ2VuZXJhdGVkIGJpbGxzIHdoZW4gcGFyZW50IGlzIG1vZGlmaWVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFyZW50QmlsbCA9IHtcbiAgICAgICAgaWQ6ICdwYXJlbnQtYmlsbC11cGRhdGUnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdVUERBVEUtMjAyNC0wMDEnLFxuICAgICAgICB0aXRsZTogJ09yaWdpbmFsIFRpdGxlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdPcmlnaW5hbCBkZXNjcmlwdGlvbicsXG4gICAgICAgIGNhdGVnb3J5OiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICB2ZW5kb3I6ICdPcmlnaW5hbCBWZW5kb3InLFxuICAgICAgICBwYXltZW50VHlwZTogJ3JlY3VycmVudCcsXG4gICAgICAgIHNjaGVkdWxlUGF5bWVudDogJ21vbnRobHknLFxuICAgICAgICBzY2hlZHVsZUN1c3RvbTogbnVsbCxcbiAgICAgICAgY29zdHM6IFsnMzAwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnMzAwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTA0LTMwJywgLy8gNCBtb250aHNcbiAgICAgICAgc3RhdHVzOiAnYWN0aXZlJyxcbiAgICAgICAgYXV0b0dlbmVyYXRlZDogZmFsc2UsXG4gICAgICAgIHJlZmVyZW5jZTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBHZW5lcmF0ZSBpbml0aWFsIGJpbGxzXG4gICAgICBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHBhcmVudEJpbGwgYXMgYW55KTtcblxuICAgICAgLy8gVXBkYXRlIHBhcmVudCBiaWxsIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCB1cGRhdGVzID0ge1xuICAgICAgICB0aXRsZTogJ1VwZGF0ZWQgVGl0bGUnLFxuICAgICAgICBjYXRlZ29yeTogJ3V0aWxpdGllcycsXG4gICAgICAgIHZlbmRvcjogJ05ldyBWZW5kb3IgQ29ycCcsXG4gICAgICAgIG5vdGVzOiAnVXBkYXRlZCB2aWEgY2FzY2FkZScsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UudXBkYXRlR2VuZXJhdGVkQmlsbHNGcm9tUGFyZW50KFxuICAgICAgICBwYXJlbnRCaWxsLmlkLFxuICAgICAgICB1cGRhdGVzXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmJpbGxzVXBkYXRlZCkudG9CZSg0KTtcblxuICAgICAgLy8gVmVyaWZ5IGJpbGxzIHdlcmUgdXBkYXRlZFxuICAgICAgY29uc3QgdXBkYXRlZEJpbGxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJpbGxzLnJlZmVyZW5jZSwgcGFyZW50QmlsbC5pZCksIGVxKGJpbGxzLmF1dG9HZW5lcmF0ZWQsIHRydWUpKSk7XG5cbiAgICAgIHVwZGF0ZWRCaWxscy5mb3JFYWNoKChiaWxsKSA9PiB7XG4gICAgICAgIGV4cGVjdChiaWxsLnRpdGxlKS50b0NvbnRhaW4oJ1VwZGF0ZWQgVGl0bGUnKTtcbiAgICAgICAgZXhwZWN0KGJpbGwuY2F0ZWdvcnkpLnRvQmUoJ3V0aWxpdGllcycpO1xuICAgICAgICBleHBlY3QoYmlsbC52ZW5kb3IpLnRvQmUoJ05ldyBWZW5kb3IgQ29ycCcpO1xuICAgICAgICBleHBlY3QoYmlsbC5ub3RlcykudG9Db250YWluKCdVcGRhdGVkIHZpYSBjYXNjYWRlJyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJlc2VydmUgZGF0ZSBhbmQgcGFydCBpbmZvcm1hdGlvbiBpbiB0aXRsZXMgd2hlbiB1cGRhdGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudEJpbGwgPSB7XG4gICAgICAgIGlkOiAncGFyZW50LWJpbGwtdGl0bGUtcHJlc2VydmUnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdQUkVTRVJWRS0yMDI0LTAwMScsXG4gICAgICAgIHRpdGxlOiAnT3JpZ2luYWwgQ29tcGxleCBCaWxsJyxcbiAgICAgICAgY2F0ZWdvcnk6ICd1dGlsaXRpZXMnLFxuICAgICAgICB2ZW5kb3I6ICdUZXN0IFZlbmRvcicsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAneWVhcmx5JyxcbiAgICAgICAgY29zdHM6IFsnMjAwMC4wMCcsICcxMDAwLjAwJ10sIC8vIFR3byBwYXltZW50c1xuICAgICAgICB0b3RhbEFtb3VudDogJzMwMDAuMDAnLFxuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjUtMDEtMDEnLFxuICAgICAgICBhdXRvR2VuZXJhdGVkOiBmYWxzZSxcbiAgICAgICAgcmVmZXJlbmNlOiBudWxsLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhwYXJlbnRCaWxsIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7IHRpdGxlOiAnVXBkYXRlZCBDb21wbGV4IEJpbGwnIH07XG4gICAgICBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UudXBkYXRlR2VuZXJhdGVkQmlsbHNGcm9tUGFyZW50KHBhcmVudEJpbGwuaWQsIHVwZGF0ZXMpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKVxuICAgICAgICAub3JkZXJCeShiaWxscy5zdGFydERhdGUpO1xuXG4gICAgICAvLyBTaG91bGQgcHJlc2VydmUgdGhlIGRhdGUgYW5kIHBhcnQgaW5mb3JtYXRpb25cbiAgICAgIGV4cGVjdCh1cGRhdGVkQmlsbHNbMF0udGl0bGUpLnRvTWF0Y2goL1VwZGF0ZWQgQ29tcGxleCBCaWxsIC0gLiogXFwoUGFydCAxXFwvMlxcKS8pO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRCaWxsc1sxXS50aXRsZSkudG9NYXRjaCgvVXBkYXRlZCBDb21wbGV4IEJpbGwgLSAuKiBcXChQYXJ0IDJcXC8yXFwpLyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtYXJrQmlsbEFzUGFpZCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hcmsgYSBiaWxsIGFzIHBhaWQgd2l0aCBwYXltZW50IGRhdGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0QmlsbCA9IHtcbiAgICAgICAgaWQ6ICd0ZXN0LWJpbGwtcGFpZCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IG1vY2tCdWlsZGluZy5pZCxcbiAgICAgICAgYmlsbE51bWJlcjogJ1BBSUQtMjAyNC0wMDEnLFxuICAgICAgICB0aXRsZTogJ1Rlc3QgUGF5bWVudCBCaWxsJyxcbiAgICAgICAgc3RhdHVzOiAnc2VudCcsXG4gICAgICAgIHRvdGFsQW1vdW50OiAnNTAwLjAwJyxcbiAgICAgICAgYXV0b0dlbmVyYXRlZDogdHJ1ZSxcbiAgICAgICAgcmVmZXJlbmNlOiAncGFyZW50LWJpbGwtaWQnLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgfTtcblxuICAgICAgLy8gSW5zZXJ0IHRlc3QgYmlsbFxuICAgICAgYXdhaXQgZGIuaW5zZXJ0KGJpbGxzKS52YWx1ZXModGVzdEJpbGwgYXMgYW55KTtcblxuICAgICAgY29uc3QgcGF5bWVudERhdGUgPSBuZXcgRGF0ZSgnMjAyNC0wMi0xNScpO1xuICAgICAgYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLm1hcmtCaWxsQXNQYWlkKHRlc3RCaWxsLmlkLCBwYXltZW50RGF0ZSk7XG5cbiAgICAgIC8vIFZlcmlmeSBiaWxsIHdhcyBtYXJrZWQgYXMgcGFpZFxuICAgICAgY29uc3QgW3VwZGF0ZWRCaWxsXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oYmlsbHMpLndoZXJlKGVxKGJpbGxzLmlkLCB0ZXN0QmlsbC5pZCkpO1xuXG4gICAgICBleHBlY3QodXBkYXRlZEJpbGwuc3RhdHVzKS50b0JlKCdwYWlkJyk7XG4gICAgICBleHBlY3QodXBkYXRlZEJpbGwubm90ZXMpLnRvQ29udGFpbignUGF5bWVudCBjb25maXJtZWQgb24gMi8xNS8yMDI0Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHVzZSBjdXJyZW50IGRhdGUgd2hlbiBubyBwYXltZW50IGRhdGUgcHJvdmlkZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0QmlsbCA9IHtcbiAgICAgICAgaWQ6ICd0ZXN0LWJpbGwtcGFpZC1hdXRvJyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnUEFJRC1BVVRPLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdBdXRvIERhdGUgUGF5bWVudCBCaWxsJyxcbiAgICAgICAgc3RhdHVzOiAnc2VudCcsXG4gICAgICAgIHRvdGFsQW1vdW50OiAnNzUwLjAwJyxcbiAgICAgICAgYXV0b0dlbmVyYXRlZDogdHJ1ZSxcbiAgICAgICAgcmVmZXJlbmNlOiAncGFyZW50LWJpbGwtaWQnLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgZGIuaW5zZXJ0KGJpbGxzKS52YWx1ZXModGVzdEJpbGwgYXMgYW55KTtcblxuICAgICAgYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLm1hcmtCaWxsQXNQYWlkKHRlc3RCaWxsLmlkKTtcblxuICAgICAgY29uc3QgW3VwZGF0ZWRCaWxsXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oYmlsbHMpLndoZXJlKGVxKGJpbGxzLmlkLCB0ZXN0QmlsbC5pZCkpO1xuXG4gICAgICBleHBlY3QodXBkYXRlZEJpbGwuc3RhdHVzKS50b0JlKCdwYWlkJyk7XG4gICAgICBleHBlY3QodXBkYXRlZEJpbGwubm90ZXMpLnRvQ29udGFpbignUGF5bWVudCBjb25maXJtZWQgb24nKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2dldEdlbmVyYXRlZEJpbGxzU3RhdHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gY29tcHJlaGVuc2l2ZSBzdGF0aXN0aWNzIGZvciBnZW5lcmF0ZWQgYmlsbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBwYXJlbnRCaWxsID0ge1xuICAgICAgICBpZDogJ3BhcmVudC1iaWxsLXN0YXRzJyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnU1RBVFMtMjAyNC0wMDEnLFxuICAgICAgICB0aXRsZTogJ1N0YXRpc3RpY3MgVGVzdCBCaWxsJyxcbiAgICAgICAgcGF5bWVudFR5cGU6ICdyZWN1cnJlbnQnLFxuICAgICAgICBzY2hlZHVsZVBheW1lbnQ6ICdtb250aGx5JyxcbiAgICAgICAgY29zdHM6IFsnNDAwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnNDAwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTA2LTMwJywgLy8gNiBtb250aHNcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5nZW5lcmF0ZUZ1dHVyZUJpbGxJbnN0YW5jZXMocGFyZW50QmlsbCBhcyBhbnkpO1xuXG4gICAgICAvLyBNYXJrIHNvbWUgYmlsbHMgYXMgcGFpZFxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKTtcblxuICAgICAgLy8gTWFyayBmaXJzdCAyIGJpbGxzIGFzIHBhaWRcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgaSsrKSB7XG4gICAgICAgIGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5tYXJrQmlsbEFzUGFpZChnZW5lcmF0ZWRCaWxsc1tpXS5pZCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0YXRzID0gYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdldEdlbmVyYXRlZEJpbGxzU3RhdHMocGFyZW50QmlsbC5pZCk7XG5cbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbEdlbmVyYXRlZCkudG9CZSg2KTtcbiAgICAgIGV4cGVjdChzdGF0cy5wYWlkQmlsbHMpLnRvQmUoMik7XG4gICAgICBleHBlY3Qoc3RhdHMucGVuZGluZ0JpbGxzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3Qoc3RhdHMuZnV0dXJlQmlsbHMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdGF0cy50b3RhbEFtb3VudCkudG9CZSgyNDAwKTsgLy8gNiBiaWxscyAqICQ0MDBcbiAgICAgIGV4cGVjdChzdGF0cy5wYWlkQW1vdW50KS50b0JlKDgwMCk7IC8vIDIgYmlsbHMgKiAkNDAwXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNhdGVnb3JpemUgYmlsbHMgYnkgZGF0ZSBjb3JyZWN0bHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCk7XG4gICAgICBjb25zdCBwYXN0RGF0ZSA9IG5ldyBEYXRlKHRvZGF5KTtcbiAgICAgIHBhc3REYXRlLnNldE1vbnRoKHBhc3REYXRlLmdldE1vbnRoKCkgLSAxKTtcbiAgICAgIGNvbnN0IGZ1dHVyZURhdGUgPSBuZXcgRGF0ZSh0b2RheSk7XG4gICAgICBmdXR1cmVEYXRlLnNldE1vbnRoKGZ1dHVyZURhdGUuZ2V0TW9udGgoKSArIDEpO1xuXG4gICAgICBjb25zdCBwYXJlbnRCaWxsID0ge1xuICAgICAgICBpZDogJ3BhcmVudC1iaWxsLWRhdGUtc3RhdHMnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdEQVRFLVNUQVRTLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdEYXRlIFN0YXRpc3RpY3MgVGVzdCcsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAnY3VzdG9tJyxcbiAgICAgICAgc2NoZWR1bGVDdXN0b206IFtcbiAgICAgICAgICBwYXN0RGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgICAgdG9kYXkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICAgIGZ1dHVyZURhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdLFxuICAgICAgICBdLFxuICAgICAgICBjb3N0czogWycyMDAuMDAnXSxcbiAgICAgICAgdG90YWxBbW91bnQ6ICcyMDAuMDAnLFxuICAgICAgICBzdGFydERhdGU6IHBhc3REYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgZW5kRGF0ZTogZnV0dXJlRGF0ZS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgIGNyZWF0ZWRCeTogbW9ja1N5c3RlbVVzZXIuaWQsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHBhcmVudEJpbGwgYXMgYW55KTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2V0R2VuZXJhdGVkQmlsbHNTdGF0cyhwYXJlbnRCaWxsLmlkKTtcblxuICAgICAgZXhwZWN0KHN0YXRzLnRvdGFsR2VuZXJhdGVkKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRzLmZ1dHVyZUJpbGxzKS50b0JlKDEpOyAvLyBPbmx5IGZ1dHVyZSBkYXRlIGJpbGxcbiAgICAgIGV4cGVjdChzdGF0cy5wZW5kaW5nQmlsbHMpLnRvQmUoMik7IC8vIFBhc3QgYW5kIHRvZGF5IGJpbGxzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZWxldGVHZW5lcmF0ZWRCaWxscycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGRlbGV0ZSBvbmx5IHVucGFpZCBiaWxscyBieSBkZWZhdWx0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFyZW50QmlsbCA9IHtcbiAgICAgICAgaWQ6ICdwYXJlbnQtYmlsbC1kZWxldGUnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdERUxFVEUtMjAyNC0wMDEnLFxuICAgICAgICB0aXRsZTogJ0RlbGV0ZSBUZXN0IEJpbGwnLFxuICAgICAgICBjYXRlZ29yeTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgdmVuZG9yOiAnVGVzdCBWZW5kb3InLFxuICAgICAgICBwYXltZW50VHlwZTogJ3JlY3VycmVudCcsXG4gICAgICAgIHNjaGVkdWxlUGF5bWVudDogJ21vbnRobHknLFxuICAgICAgICBjb3N0czogWyczNTAuMDAnXSxcbiAgICAgICAgdG90YWxBbW91bnQ6ICczNTAuMDAnLFxuICAgICAgICBzdGFydERhdGU6ICcyMDI0LTAxLTAxJyxcbiAgICAgICAgZW5kRGF0ZTogJzIwMjQtMDUtMzEnLCAvLyA1IG1vbnRoc1xuICAgICAgICBhdXRvR2VuZXJhdGVkOiBmYWxzZSxcbiAgICAgICAgcmVmZXJlbmNlOiBudWxsLFxuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhwYXJlbnRCaWxsIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGdlbmVyYXRlZEJpbGxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJpbGxzLnJlZmVyZW5jZSwgcGFyZW50QmlsbC5pZCksIGVxKGJpbGxzLmF1dG9HZW5lcmF0ZWQsIHRydWUpKSk7XG5cbiAgICAgIC8vIE1hcmsgZmlyc3QgYmlsbCBhcyBwYWlkXG4gICAgICBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UubWFya0JpbGxBc1BhaWQoZ2VuZXJhdGVkQmlsbHNbMF0uaWQpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZGVsZXRlR2VuZXJhdGVkQmlsbHMocGFyZW50QmlsbC5pZCwgZmFsc2UpO1xuXG4gICAgICAvLyBTaG91bGQgZGVsZXRlIDQgdW5wYWlkIGJpbGxzLCBrZWVwIDEgcGFpZCBiaWxsXG4gICAgICBleHBlY3QocmVzdWx0LmJpbGxzRGVsZXRlZCkudG9CZSg0KTtcblxuICAgICAgY29uc3QgcmVtYWluaW5nQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKTtcblxuICAgICAgZXhwZWN0KHJlbWFpbmluZ0JpbGxzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZW1haW5pbmdCaWxsc1swXS5zdGF0dXMpLnRvQmUoJ3BhaWQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVsZXRlIGFsbCBmdXR1cmUgYmlsbHMgd2hlbiBkZWxldGVBbGxGdXR1cmUgaXMgdHJ1ZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudEJpbGwgPSB7XG4gICAgICAgIGlkOiAncGFyZW50LWJpbGwtZGVsZXRlLWFsbCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IG1vY2tCdWlsZGluZy5pZCxcbiAgICAgICAgYmlsbE51bWJlcjogJ0RFTEVURS1BTEwtMjAyNC0wMDEnLFxuICAgICAgICB0aXRsZTogJ0RlbGV0ZSBBbGwgVGVzdCBCaWxsJyxcbiAgICAgICAgY2F0ZWdvcnk6ICdtYWludGVuYW5jZScsXG4gICAgICAgIHZlbmRvcjogJ1Rlc3QgVmVuZG9yJyxcbiAgICAgICAgcGF5bWVudFR5cGU6ICdyZWN1cnJlbnQnLFxuICAgICAgICBzY2hlZHVsZVBheW1lbnQ6ICdtb250aGx5JyxcbiAgICAgICAgY29zdHM6IFsnMjUwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnMjUwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wNi0wMScsIC8vIEZ1dHVyZSBkYXRlXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTEwLTMxJywgLy8gNSBtb250aHMgaW4gZnV0dXJlXG4gICAgICAgIGF1dG9HZW5lcmF0ZWQ6IGZhbHNlLFxuICAgICAgICByZWZlcmVuY2U6IG51bGwsXG4gICAgICAgIGNyZWF0ZWRCeTogbW9ja1N5c3RlbVVzZXIuaWQsXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHBhcmVudEJpbGwgYXMgYW55KTtcblxuICAgICAgY29uc3QgZ2VuZXJhdGVkQmlsbHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYmlsbHMucmVmZXJlbmNlLCBwYXJlbnRCaWxsLmlkKSwgZXEoYmlsbHMuYXV0b0dlbmVyYXRlZCwgdHJ1ZSkpKTtcblxuICAgICAgLy8gTWFyayBmaXJzdCBiaWxsIGFzIHBhaWRcbiAgICAgIGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5tYXJrQmlsbEFzUGFpZChnZW5lcmF0ZWRCaWxsc1swXS5pZCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJpbGxHZW5lcmF0aW9uU2VydmljZS5kZWxldGVHZW5lcmF0ZWRCaWxscyhwYXJlbnRCaWxsLmlkLCB0cnVlKTtcblxuICAgICAgLy8gU2hvdWxkIGRlbGV0ZSBhbGwgYmlsbHMgaW5jbHVkaW5nIHBhaWQgb25lcyAoc2luY2UgdGhleSdyZSBpbiB0aGUgZnV0dXJlKVxuICAgICAgZXhwZWN0KHJlc3VsdC5iaWxsc0RlbGV0ZWQpLnRvQmUoNSk7XG5cbiAgICAgIGNvbnN0IHJlbWFpbmluZ0JpbGxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKGJpbGxzLnJlZmVyZW5jZSwgcGFyZW50QmlsbC5pZCksIGVxKGJpbGxzLmF1dG9HZW5lcmF0ZWQsIHRydWUpKSk7XG5cbiAgICAgIGV4cGVjdChyZW1haW5pbmdCaWxscy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFZGdlIENhc2VzIGFuZCBFcnJvciBIYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBiaWxscyB3aXRoIG5vIGNvc3RzIGFycmF5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52YWxpZEJpbGwgPSB7XG4gICAgICAgIGlkOiAnaW52YWxpZC1iaWxsLTEnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAnbW9udGhseScsXG4gICAgICAgIGNvc3RzOiBbXSwgLy8gRW1wdHkgY29zdHMgYXJyYXlcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTAzLTMxJyxcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhpbnZhbGlkQmlsbCBhcyBhbnkpXG4gICAgICApLnJlamVjdHMudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgdmVyeSBsb25nIHByb2plY3Rpb24gcGVyaW9kcyBzYWZlbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBsb25nVGVybUJpbGwgPSB7XG4gICAgICAgIGlkOiAnbG9uZy10ZXJtLWJpbGwnLFxuICAgICAgICBidWlsZGluZ0lkOiBtb2NrQnVpbGRpbmcuaWQsXG4gICAgICAgIGJpbGxOdW1iZXI6ICdMT05HLTIwMjQtMDAxJyxcbiAgICAgICAgdGl0bGU6ICdMb25nIFRlcm0gQmlsbCcsXG4gICAgICAgIHBheW1lbnRUeXBlOiAncmVjdXJyZW50JyxcbiAgICAgICAgc2NoZWR1bGVQYXltZW50OiAnd2Vla2x5JyxcbiAgICAgICAgY29zdHM6IFsnNTAuMDAnXSxcbiAgICAgICAgdG90YWxBbW91bnQ6ICc1MC4wMCcsXG4gICAgICAgIHN0YXJ0RGF0ZTogJzIwMjQtMDEtMDEnLFxuICAgICAgICBlbmREYXRlOiBudWxsLCAvLyBObyBlbmQgZGF0ZSAtIHNob3VsZCBsaW1pdCB0byAyNSB5ZWFyc1xuICAgICAgICBjcmVhdGVkQnk6IG1vY2tTeXN0ZW1Vc2VyLmlkLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhsb25nVGVybUJpbGwgYXMgYW55KTtcblxuICAgICAgLy8gU2hvdWxkIG5vdCBnZW5lcmF0ZSBtb3JlIHRoYW4gMTAsMDAwIGJpbGxzIChzYWZldHkgbGltaXQpXG4gICAgICBleHBlY3QocmVzdWx0LmJpbGxzQ3JlYXRlZCkudG9CZUxlc3NUaGFuKDEwMDAwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYmlsbHNDcmVhdGVkKS50b0JlR3JlYXRlclRoYW4oMTAwMCk7IC8vIEJ1dCBzaG91bGQgZ2VuZXJhdGUgbWFueSBmb3IgMjUgeWVhcnNcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgc2NoZWR1bGUgdHlwZXMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludmFsaWRTY2hlZHVsZUJpbGwgPSB7XG4gICAgICAgIGlkOiAnaW52YWxpZC1zY2hlZHVsZS1iaWxsJyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBwYXltZW50VHlwZTogJ3JlY3VycmVudCcsXG4gICAgICAgIHNjaGVkdWxlUGF5bWVudDogJ2ludmFsaWQtc2NoZWR1bGUnLFxuICAgICAgICBjb3N0czogWycxMDAuMDAnXSxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTEyLTMxJyxcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhpbnZhbGlkU2NoZWR1bGVCaWxsIGFzIGFueSlcbiAgICAgICkucmVqZWN0cy50b1Rocm93KCdVbmtub3duIHNjaGVkdWxlIHR5cGU6IGludmFsaWQtc2NoZWR1bGUnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgZ2VuZXJhdGlvbiByZXF1ZXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHBhcmVudEJpbGwgPSB7XG4gICAgICAgIGlkOiAnY29uY3VycmVudC1iaWxsJyxcbiAgICAgICAgYnVpbGRpbmdJZDogbW9ja0J1aWxkaW5nLmlkLFxuICAgICAgICBiaWxsTnVtYmVyOiAnQ09OQ1VSUkVOVC0yMDI0LTAwMScsXG4gICAgICAgIHRpdGxlOiAnQ29uY3VycmVudCBUZXN0IEJpbGwnLFxuICAgICAgICBjYXRlZ29yeTogJ3V0aWxpdGllcycsXG4gICAgICAgIHZlbmRvcjogJ1Rlc3QgVmVuZG9yJyxcbiAgICAgICAgcGF5bWVudFR5cGU6ICdyZWN1cnJlbnQnLFxuICAgICAgICBzY2hlZHVsZVBheW1lbnQ6ICdtb250aGx5JyxcbiAgICAgICAgY29zdHM6IFsnMTAwLjAwJ10sXG4gICAgICAgIHRvdGFsQW1vdW50OiAnMTAwLjAwJyxcbiAgICAgICAgc3RhcnREYXRlOiAnMjAyNC0wMS0wMScsXG4gICAgICAgIGVuZERhdGU6ICcyMDI0LTA2LTMwJyxcbiAgICAgICAgYXV0b0dlbmVyYXRlZDogZmFsc2UsXG4gICAgICAgIHJlZmVyZW5jZTogbnVsbCxcbiAgICAgICAgY3JlYXRlZEJ5OiBtb2NrU3lzdGVtVXNlci5pZCxcbiAgICAgIH07XG5cbiAgICAgIC8vIFJ1biBnZW5lcmF0aW9uIGNvbmN1cnJlbnRseVxuICAgICAgY29uc3QgW3Jlc3VsdDEsIHJlc3VsdDJdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKHBhcmVudEJpbGwgYXMgYW55KSxcbiAgICAgICAgYmlsbEdlbmVyYXRpb25TZXJ2aWNlLmdlbmVyYXRlRnV0dXJlQmlsbEluc3RhbmNlcyhwYXJlbnRCaWxsIGFzIGFueSksXG4gICAgICBdKTtcblxuICAgICAgLy8gQm90aCBzaG91bGQgc3VjY2VlZCwgYnV0IG9ubHkgb25lIHNldCBvZiBiaWxscyBzaG91bGQgZXhpc3RcbiAgICAgIGV4cGVjdChyZXN1bHQxLmJpbGxzQ3JlYXRlZCkudG9CZSg2KTtcbiAgICAgIGV4cGVjdChyZXN1bHQyLmJpbGxzQ3JlYXRlZCkudG9CZSg2KTtcblxuICAgICAgY29uc3QgZmluYWxCaWxscyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKGFuZChlcShiaWxscy5yZWZlcmVuY2UsIHBhcmVudEJpbGwuaWQpLCBlcShiaWxscy5hdXRvR2VuZXJhdGVkLCB0cnVlKSkpO1xuXG4gICAgICAvLyBTaG91bGQgbm90IGhhdmUgZHVwbGljYXRlc1xuICAgICAgZXhwZWN0KGZpbmFsQmlsbHMubGVuZ3RoKS50b0JlKDYpO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9