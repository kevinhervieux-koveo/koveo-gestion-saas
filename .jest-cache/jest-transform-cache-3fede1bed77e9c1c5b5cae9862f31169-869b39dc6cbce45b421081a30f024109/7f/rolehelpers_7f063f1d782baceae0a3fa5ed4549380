fd49d20417c7b537823d8ac7bfcb370a
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.computeAriaBusy = computeAriaBusy;
exports.computeAriaChecked = computeAriaChecked;
exports.computeAriaCurrent = computeAriaCurrent;
exports.computeAriaExpanded = computeAriaExpanded;
exports.computeAriaPressed = computeAriaPressed;
exports.computeAriaSelected = computeAriaSelected;
exports.computeAriaValueMax = computeAriaValueMax;
exports.computeAriaValueMin = computeAriaValueMin;
exports.computeAriaValueNow = computeAriaValueNow;
exports.computeAriaValueText = computeAriaValueText;
exports.computeHeadingLevel = computeHeadingLevel;
exports.getImplicitAriaRoles = getImplicitAriaRoles;
exports.getRoles = getRoles;
exports.isInaccessible = isInaccessible;
exports.isSubtreeInaccessible = isSubtreeInaccessible;
exports.logRoles = void 0;
exports.prettyRoles = prettyRoles;
var _ariaQuery = require("aria-query");
var _domAccessibilityApi = require("dom-accessibility-api");
var _prettyDom = require("./pretty-dom");
var _config = require("./config");
const elementRoleList = buildElementRoleList(_ariaQuery.elementRoles);
/**
 * @param {Element} element -
 * @returns {boolean} - `true` if `element` and its subtree are inaccessible
 */
function isSubtreeInaccessible(element) {
    if (element.hidden === true) {
        return true;
    }
    if (element.getAttribute('aria-hidden') === 'true') {
        return true;
    }
    const window = element.ownerDocument.defaultView;
    if (window.getComputedStyle(element).display === 'none') {
        return true;
    }
    return false;
}
/**
 * Partial implementation https://www.w3.org/TR/wai-aria-1.2/#tree_exclusion
 * which should only be used for elements with a non-presentational role i.e.
 * `role="none"` and `role="presentation"` will not be excluded.
 *
 * Implements aria-hidden semantics (i.e. parent overrides child)
 * Ignores "Child Presentational: True" characteristics
 *
 * @param {Element} element -
 * @param {object} [options] -
 * @param {function (element: Element): boolean} options.isSubtreeInaccessible -
 * can be used to return cached results from previous isSubtreeInaccessible calls
 * @returns {boolean} true if excluded, otherwise false
 */
function isInaccessible(element, options = {}) {
    const { isSubtreeInaccessible: isSubtreeInaccessibleImpl = isSubtreeInaccessible } = options;
    const window = element.ownerDocument.defaultView;
    // since visibility is inherited we can exit early
    if (window.getComputedStyle(element).visibility === 'hidden') {
        return true;
    }
    let currentElement = element;
    while (currentElement) {
        if (isSubtreeInaccessibleImpl(currentElement)) {
            return true;
        }
        currentElement = currentElement.parentElement;
    }
    return false;
}
function getImplicitAriaRoles(currentNode) {
    // eslint bug here:
    // eslint-disable-next-line no-unused-vars
    for (const { match, roles } of elementRoleList) {
        if (match(currentNode)) {
            return [...roles];
        }
    }
    return [];
}
function buildElementRoleList(elementRolesMap) {
    function makeElementSelector({ name, attributes }) {
        return `${name}${attributes.map(({ name: attributeName, value, constraints = [] }) => {
            const shouldNotExist = constraints.indexOf('undefined') !== -1;
            const shouldBeNonEmpty = constraints.indexOf('set') !== -1;
            const hasExplicitValue = typeof value !== 'undefined';
            if (hasExplicitValue) {
                return `[${attributeName}="${value}"]`;
            }
            else if (shouldNotExist) {
                return `:not([${attributeName}])`;
            }
            else if (shouldBeNonEmpty) {
                return `[${attributeName}]:not([${attributeName}=""])`;
            }
            return `[${attributeName}]`;
        }).join('')}`;
    }
    function getSelectorSpecificity({ attributes = [] }) {
        return attributes.length;
    }
    function bySelectorSpecificity({ specificity: leftSpecificity }, { specificity: rightSpecificity }) {
        return rightSpecificity - leftSpecificity;
    }
    function match(element) {
        let { attributes = [] } = element;
        // https://github.com/testing-library/dom-testing-library/issues/814
        const typeTextIndex = attributes.findIndex(attribute => attribute.value && attribute.name === 'type' && attribute.value === 'text');
        if (typeTextIndex >= 0) {
            // not using splice to not mutate the attributes array
            attributes = [...attributes.slice(0, typeTextIndex), ...attributes.slice(typeTextIndex + 1)];
        }
        const selector = makeElementSelector({
            ...element,
            attributes
        });
        return node => {
            if (typeTextIndex >= 0 && node.type !== 'text') {
                return false;
            }
            return node.matches(selector);
        };
    }
    let result = [];
    // eslint bug here:
    // eslint-disable-next-line no-unused-vars
    for (const [element, roles] of elementRolesMap.entries()) {
        result = [...result, {
                match: match(element),
                roles: Array.from(roles),
                specificity: getSelectorSpecificity(element)
            }];
    }
    return result.sort(bySelectorSpecificity);
}
function getRoles(container, { hidden = false } = {}) {
    function flattenDOM(node) {
        return [node, ...Array.from(node.children).reduce((acc, child) => [...acc, ...flattenDOM(child)], [])];
    }
    return flattenDOM(container).filter(element => {
        return hidden === false ? isInaccessible(element) === false : true;
    }).reduce((acc, node) => {
        let roles = [];
        // TODO: This violates html-aria which does not allow any role on every element
        if (node.hasAttribute('role')) {
            roles = node.getAttribute('role').split(' ').slice(0, 1);
        }
        else {
            roles = getImplicitAriaRoles(node);
        }
        return roles.reduce((rolesAcc, role) => Array.isArray(rolesAcc[role]) ? {
            ...rolesAcc,
            [role]: [...rolesAcc[role], node]
        } : {
            ...rolesAcc,
            [role]: [node]
        }, acc);
    }, {});
}
function prettyRoles(dom, { hidden, includeDescription }) {
    const roles = getRoles(dom, {
        hidden
    });
    // We prefer to skip generic role, we don't recommend it
    return Object.entries(roles).filter(([role]) => role !== 'generic').map(([role, elements]) => {
        const delimiterBar = '-'.repeat(50);
        const elementsString = elements.map(el => {
            const nameString = `Name "${(0, _domAccessibilityApi.computeAccessibleName)(el, {
                computedStyleSupportsPseudoElements: (0, _config.getConfig)().computedStyleSupportsPseudoElements
            })}":\n`;
            const domString = (0, _prettyDom.prettyDOM)(el.cloneNode(false));
            if (includeDescription) {
                const descriptionString = `Description "${(0, _domAccessibilityApi.computeAccessibleDescription)(el, {
                    computedStyleSupportsPseudoElements: (0, _config.getConfig)().computedStyleSupportsPseudoElements
                })}":\n`;
                return `${nameString}${descriptionString}${domString}`;
            }
            return `${nameString}${domString}`;
        }).join('\n\n');
        return `${role}:\n\n${elementsString}\n\n${delimiterBar}`;
    }).join('\n');
}
const logRoles = (dom, { hidden = false } = {}) => console.log(prettyRoles(dom, {
    hidden
}));
/**
 * @param {Element} element -
 * @returns {boolean | undefined} - false/true if (not)selected, undefined if not selectable
 */
exports.logRoles = logRoles;
function computeAriaSelected(element) {
    // implicit value from html-aam mappings: https://www.w3.org/TR/html-aam-1.0/#html-attribute-state-and-property-mappings
    // https://www.w3.org/TR/html-aam-1.0/#details-id-97
    if (element.tagName === 'OPTION') {
        return element.selected;
    }
    // explicit value
    return checkBooleanAttribute(element, 'aria-selected');
}
/**
 * @param {Element} element -
 * @returns {boolean} -
 */
function computeAriaBusy(element) {
    // https://www.w3.org/TR/wai-aria-1.1/#aria-busy
    return element.getAttribute('aria-busy') === 'true';
}
/**
 * @param {Element} element -
 * @returns {boolean | undefined} - false/true if (not)checked, undefined if not checked-able
 */
function computeAriaChecked(element) {
    // implicit value from html-aam mappings: https://www.w3.org/TR/html-aam-1.0/#html-attribute-state-and-property-mappings
    // https://www.w3.org/TR/html-aam-1.0/#details-id-56
    // https://www.w3.org/TR/html-aam-1.0/#details-id-67
    if ('indeterminate' in element && element.indeterminate) {
        return undefined;
    }
    if ('checked' in element) {
        return element.checked;
    }
    // explicit value
    return checkBooleanAttribute(element, 'aria-checked');
}
/**
 * @param {Element} element -
 * @returns {boolean | undefined} - false/true if (not)pressed, undefined if not press-able
 */
function computeAriaPressed(element) {
    // https://www.w3.org/TR/wai-aria-1.1/#aria-pressed
    return checkBooleanAttribute(element, 'aria-pressed');
}
/**
 * @param {Element} element -
 * @returns {boolean | string | null} -
 */
function computeAriaCurrent(element) {
    // https://www.w3.org/TR/wai-aria-1.1/#aria-current
    return checkBooleanAttribute(element, 'aria-current') ?? element.getAttribute('aria-current') ?? false;
}
/**
 * @param {Element} element -
 * @returns {boolean | undefined} - false/true if (not)expanded, undefined if not expand-able
 */
function computeAriaExpanded(element) {
    // https://www.w3.org/TR/wai-aria-1.1/#aria-expanded
    return checkBooleanAttribute(element, 'aria-expanded');
}
function checkBooleanAttribute(element, attribute) {
    const attributeValue = element.getAttribute(attribute);
    if (attributeValue === 'true') {
        return true;
    }
    if (attributeValue === 'false') {
        return false;
    }
    return undefined;
}
/**
 * @param {Element} element -
 * @returns {number | undefined} - number if implicit heading or aria-level present, otherwise undefined
 */
function computeHeadingLevel(element) {
    // https://w3c.github.io/html-aam/#el-h1-h6
    // https://w3c.github.io/html-aam/#el-h1-h6
    const implicitHeadingLevels = {
        H1: 1,
        H2: 2,
        H3: 3,
        H4: 4,
        H5: 5,
        H6: 6
    };
    // explicit aria-level value
    // https://www.w3.org/TR/wai-aria-1.2/#aria-level
    const ariaLevelAttribute = element.getAttribute('aria-level') && Number(element.getAttribute('aria-level'));
    return ariaLevelAttribute || implicitHeadingLevels[element.tagName];
}
/**
 * @param {Element} element -
 * @returns {number | undefined} -
 */
function computeAriaValueNow(element) {
    const valueNow = element.getAttribute('aria-valuenow');
    return valueNow === null ? undefined : +valueNow;
}
/**
 * @param {Element} element -
 * @returns {number | undefined} -
 */
function computeAriaValueMax(element) {
    const valueMax = element.getAttribute('aria-valuemax');
    return valueMax === null ? undefined : +valueMax;
}
/**
 * @param {Element} element -
 * @returns {number | undefined} -
 */
function computeAriaValueMin(element) {
    const valueMin = element.getAttribute('aria-valuemin');
    return valueMin === null ? undefined : +valueMin;
}
/**
 * @param {Element} element -
 * @returns {string | undefined} -
 */
function computeAriaValueText(element) {
    const valueText = element.getAttribute('aria-valuetext');
    return valueText === null ? undefined : valueText;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9yb2xlLWhlbHBlcnMuanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0lBQzNDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQyxDQUFDO0FBQ0gsT0FBTyxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7QUFDMUMsT0FBTyxDQUFDLGtCQUFrQixHQUFHLGtCQUFrQixDQUFDO0FBQ2hELE9BQU8sQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQztBQUNoRCxPQUFPLENBQUMsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxDQUFDLGtCQUFrQixHQUFHLGtCQUFrQixDQUFDO0FBQ2hELE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLENBQUMsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxtQkFBbUIsQ0FBQztBQUNsRCxPQUFPLENBQUMsb0JBQW9CLEdBQUcsb0JBQW9CLENBQUM7QUFDcEQsT0FBTyxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO0FBQ2xELE9BQU8sQ0FBQyxvQkFBb0IsR0FBRyxvQkFBb0IsQ0FBQztBQUNwRCxPQUFPLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztBQUM1QixPQUFPLENBQUMsY0FBYyxHQUFHLGNBQWMsQ0FBQztBQUN4QyxPQUFPLENBQUMscUJBQXFCLEdBQUcscUJBQXFCLENBQUM7QUFDdEQsT0FBTyxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUMxQixPQUFPLENBQUMsV0FBVyxHQUFHLFdBQVcsQ0FBQztBQUNsQyxJQUFJLFVBQVUsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFD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QUFTLG9CQUFvQixDQUFDLE9BQU87SUFDbkMsTUFBTSxTQUFTLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3pELE9BQU8sU0FBUyxLQUFLLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUM7QUFDcEQsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL25vZGVfbW9kdWxlcy9AdGVzdGluZy1saWJyYXJ5L2RvbS9kaXN0L3JvbGUtaGVscGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuY29tcHV0ZUFyaWFCdXN5ID0gY29tcHV0ZUFyaWFCdXN5O1xuZXhwb3J0cy5jb21wdXRlQXJpYUNoZWNrZWQgPSBjb21wdXRlQXJpYUNoZWNrZWQ7XG5leHBvcnRzLmNvbXB1dGVBcmlhQ3VycmVudCA9IGNvbXB1dGVBcmlhQ3VycmVudDtcbmV4cG9ydHMuY29tcHV0ZUFyaWFFeHBhbmRlZCA9IGNvbXB1dGVBcmlhRXhwYW5kZWQ7XG5leHBvcnRzLmNvbXB1dGVBcmlhUHJlc3NlZCA9IGNvbXB1dGVBcmlhUHJlc3NlZDtcbmV4cG9ydHMuY29tcHV0ZUFyaWFTZWxlY3RlZCA9IGNvbXB1dGVBcmlhU2VsZWN0ZWQ7XG5leHBvcnRzLmNvbXB1dGVBcmlhVmFsdWVNYXggPSBjb21wdXRlQXJpYVZhbHVlTWF4O1xuZXhwb3J0cy5jb21wdXRlQXJpYVZhbHVlTWluID0gY29tcHV0ZUFyaWFWYWx1ZU1pbjtcbmV4cG9ydHMuY29tcHV0ZUFyaWFWYWx1ZU5vdyA9IGNvbXB1dGVBcmlhVmFsdWVOb3c7XG5leHBvcnRzLmNvbXB1dGVBcmlhVmFsdWVUZXh0ID0gY29tcHV0ZUFyaWFWYWx1ZVRleHQ7XG5leHBvcnRzLmNvbXB1dGVIZWFkaW5nTGV2ZWwgPSBjb21wdXRlSGVhZGluZ0xldmVsO1xuZXhwb3J0cy5nZXRJbXBsaWNpdEFyaWFSb2xlcyA9IGdldEltcGxpY2l0QXJpYVJvbGVzO1xuZXhwb3J0cy5nZXRSb2xlcyA9IGdldFJvbGVzO1xuZXhwb3J0cy5pc0luYWNjZXNzaWJsZSA9IGlzSW5hY2Nlc3NpYmxlO1xuZXhwb3J0cy5pc1N1YnRyZWVJbmFjY2Vzc2libGUgPSBpc1N1YnRyZWVJbmFjY2Vzc2libGU7XG5leHBvcnRzLmxvZ1JvbGVzID0gdm9pZCAwO1xuZXhwb3J0cy5wcmV0dHlSb2xlcyA9IHByZXR0eVJvbGVzO1xudmFyIF9hcmlhUXVlcnkgPSByZXF1aXJlKFwiYXJpYS1xdWVyeVwiKTtcbnZhciBfZG9tQWNjZXNzaWJpbGl0eUFwaSA9IHJlcXVpcmUoXCJkb20tYWNjZXNzaWJpbGl0eS1hcGlcIik7XG52YXIgX3ByZXR0eURvbSA9IHJlcXVpcmUoXCIuL3ByZXR0eS1kb21cIik7XG52YXIgX2NvbmZpZyA9IHJlcXVpcmUoXCIuL2NvbmZpZ1wiKTtcbmNvbnN0IGVsZW1lbnRSb2xlTGlzdCA9IGJ1aWxkRWxlbWVudFJvbGVMaXN0KF9hcmlhUXVlcnkuZWxlbWVudFJvbGVzKTtcblxuLyoqXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgLVxuICogQHJldHVybnMge2Jvb2xlYW59IC0gYHRydWVgIGlmIGBlbGVtZW50YCBhbmQgaXRzIHN1YnRyZWUgYXJlIGluYWNjZXNzaWJsZVxuICovXG5mdW5jdGlvbiBpc1N1YnRyZWVJbmFjY2Vzc2libGUoZWxlbWVudCkge1xuICBpZiAoZWxlbWVudC5oaWRkZW4gPT09IHRydWUpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtaGlkZGVuJykgPT09ICd0cnVlJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGNvbnN0IHdpbmRvdyA9IGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldztcbiAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsZW1lbnQpLmRpc3BsYXkgPT09ICdub25lJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBQYXJ0aWFsIGltcGxlbWVudGF0aW9uIGh0dHBzOi8vd3d3LnczLm9yZy9UUi93YWktYXJpYS0xLjIvI3RyZWVfZXhjbHVzaW9uXG4gKiB3aGljaCBzaG91bGQgb25seSBiZSB1c2VkIGZvciBlbGVtZW50cyB3aXRoIGEgbm9uLXByZXNlbnRhdGlvbmFsIHJvbGUgaS5lLlxuICogYHJvbGU9XCJub25lXCJgIGFuZCBgcm9sZT1cInByZXNlbnRhdGlvblwiYCB3aWxsIG5vdCBiZSBleGNsdWRlZC5cbiAqXG4gKiBJbXBsZW1lbnRzIGFyaWEtaGlkZGVuIHNlbWFudGljcyAoaS5lLiBwYXJlbnQgb3ZlcnJpZGVzIGNoaWxkKVxuICogSWdub3JlcyBcIkNoaWxkIFByZXNlbnRhdGlvbmFsOiBUcnVlXCIgY2hhcmFjdGVyaXN0aWNzXG4gKlxuICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC1cbiAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9uc10gLVxuICogQHBhcmFtIHtmdW5jdGlvbiAoZWxlbWVudDogRWxlbWVudCk6IGJvb2xlYW59IG9wdGlvbnMuaXNTdWJ0cmVlSW5hY2Nlc3NpYmxlIC1cbiAqIGNhbiBiZSB1c2VkIHRvIHJldHVybiBjYWNoZWQgcmVzdWx0cyBmcm9tIHByZXZpb3VzIGlzU3VidHJlZUluYWNjZXNzaWJsZSBjYWxsc1xuICogQHJldHVybnMge2Jvb2xlYW59IHRydWUgaWYgZXhjbHVkZWQsIG90aGVyd2lzZSBmYWxzZVxuICovXG5mdW5jdGlvbiBpc0luYWNjZXNzaWJsZShlbGVtZW50LCBvcHRpb25zID0ge30pIHtcbiAgY29uc3Qge1xuICAgIGlzU3VidHJlZUluYWNjZXNzaWJsZTogaXNTdWJ0cmVlSW5hY2Nlc3NpYmxlSW1wbCA9IGlzU3VidHJlZUluYWNjZXNzaWJsZVxuICB9ID0gb3B0aW9ucztcbiAgY29uc3Qgd2luZG93ID0gZWxlbWVudC5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3O1xuICAvLyBzaW5jZSB2aXNpYmlsaXR5IGlzIGluaGVyaXRlZCB3ZSBjYW4gZXhpdCBlYXJseVxuICBpZiAod2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkudmlzaWJpbGl0eSA9PT0gJ2hpZGRlbicpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBsZXQgY3VycmVudEVsZW1lbnQgPSBlbGVtZW50O1xuICB3aGlsZSAoY3VycmVudEVsZW1lbnQpIHtcbiAgICBpZiAoaXNTdWJ0cmVlSW5hY2Nlc3NpYmxlSW1wbChjdXJyZW50RWxlbWVudCkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjdXJyZW50RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQ7XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufVxuZnVuY3Rpb24gZ2V0SW1wbGljaXRBcmlhUm9sZXMoY3VycmVudE5vZGUpIHtcbiAgLy8gZXNsaW50IGJ1ZyBoZXJlOlxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tdW51c2VkLXZhcnNcbiAgZm9yIChjb25zdCB7XG4gICAgbWF0Y2gsXG4gICAgcm9sZXNcbiAgfSBvZiBlbGVtZW50Um9sZUxpc3QpIHtcbiAgICBpZiAobWF0Y2goY3VycmVudE5vZGUpKSB7XG4gICAgICByZXR1cm4gWy4uLnJvbGVzXTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIFtdO1xufVxuZnVuY3Rpb24gYnVpbGRFbGVtZW50Um9sZUxpc3QoZWxlbWVudFJvbGVzTWFwKSB7XG4gIGZ1bmN0aW9uIG1ha2VFbGVtZW50U2VsZWN0b3Ioe1xuICAgIG5hbWUsXG4gICAgYXR0cmlidXRlc1xuICB9KSB7XG4gICAgcmV0dXJuIGAke25hbWV9JHthdHRyaWJ1dGVzLm1hcCgoe1xuICAgICAgbmFtZTogYXR0cmlidXRlTmFtZSxcbiAgICAgIHZhbHVlLFxuICAgICAgY29uc3RyYWludHMgPSBbXVxuICAgIH0pID0+IHtcbiAgICAgIGNvbnN0IHNob3VsZE5vdEV4aXN0ID0gY29uc3RyYWludHMuaW5kZXhPZigndW5kZWZpbmVkJykgIT09IC0xO1xuICAgICAgY29uc3Qgc2hvdWxkQmVOb25FbXB0eSA9IGNvbnN0cmFpbnRzLmluZGV4T2YoJ3NldCcpICE9PSAtMTtcbiAgICAgIGNvbnN0IGhhc0V4cGxpY2l0VmFsdWUgPSB0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnO1xuICAgICAgaWYgKGhhc0V4cGxpY2l0VmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIGBbJHthdHRyaWJ1dGVOYW1lfT1cIiR7dmFsdWV9XCJdYDtcbiAgICAgIH0gZWxzZSBpZiAoc2hvdWxkTm90RXhpc3QpIHtcbiAgICAgICAgcmV0dXJuIGA6bm90KFske2F0dHJpYnV0ZU5hbWV9XSlgO1xuICAgICAgfSBlbHNlIGlmIChzaG91bGRCZU5vbkVtcHR5KSB7XG4gICAgICAgIHJldHVybiBgWyR7YXR0cmlidXRlTmFtZX1dOm5vdChbJHthdHRyaWJ1dGVOYW1lfT1cIlwiXSlgO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGBbJHthdHRyaWJ1dGVOYW1lfV1gO1xuICAgIH0pLmpvaW4oJycpfWA7XG4gIH1cbiAgZnVuY3Rpb24gZ2V0U2VsZWN0b3JTcGVjaWZpY2l0eSh7XG4gICAgYXR0cmlidXRlcyA9IFtdXG4gIH0pIHtcbiAgICByZXR1cm4gYXR0cmlidXRlcy5sZW5ndGg7XG4gIH1cbiAgZnVuY3Rpb24gYnlTZWxlY3RvclNwZWNpZmljaXR5KHtcbiAgICBzcGVjaWZpY2l0eTogbGVmdFNwZWNpZmljaXR5XG4gIH0sIHtcbiAgICBzcGVjaWZpY2l0eTogcmlnaHRTcGVjaWZpY2l0eVxuICB9KSB7XG4gICAgcmV0dXJuIHJpZ2h0U3BlY2lmaWNpdHkgLSBsZWZ0U3BlY2lmaWNpdHk7XG4gIH1cbiAgZnVuY3Rpb24gbWF0Y2goZWxlbWVudCkge1xuICAgIGxldCB7XG4gICAgICBhdHRyaWJ1dGVzID0gW11cbiAgICB9ID0gZWxlbWVudDtcblxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS90ZXN0aW5nLWxpYnJhcnkvZG9tLXRlc3RpbmctbGlicmFyeS9pc3N1ZXMvODE0XG4gICAgY29uc3QgdHlwZVRleHRJbmRleCA9IGF0dHJpYnV0ZXMuZmluZEluZGV4KGF0dHJpYnV0ZSA9PiBhdHRyaWJ1dGUudmFsdWUgJiYgYXR0cmlidXRlLm5hbWUgPT09ICd0eXBlJyAmJiBhdHRyaWJ1dGUudmFsdWUgPT09ICd0ZXh0Jyk7XG4gICAgaWYgKHR5cGVUZXh0SW5kZXggPj0gMCkge1xuICAgICAgLy8gbm90IHVzaW5nIHNwbGljZSB0byBub3QgbXV0YXRlIHRoZSBhdHRyaWJ1dGVzIGFycmF5XG4gICAgICBhdHRyaWJ1dGVzID0gWy4uLmF0dHJpYnV0ZXMuc2xpY2UoMCwgdHlwZVRleHRJbmRleCksIC4uLmF0dHJpYnV0ZXMuc2xpY2UodHlwZVRleHRJbmRleCArIDEpXTtcbiAgICB9XG4gICAgY29uc3Qgc2VsZWN0b3IgPSBtYWtlRWxlbWVudFNlbGVjdG9yKHtcbiAgICAgIC4uLmVsZW1lbnQsXG4gICAgICBhdHRyaWJ1dGVzXG4gICAgfSk7XG4gICAgcmV0dXJuIG5vZGUgPT4ge1xuICAgICAgaWYgKHR5cGVUZXh0SW5kZXggPj0gMCAmJiBub2RlLnR5cGUgIT09ICd0ZXh0Jykge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gbm9kZS5tYXRjaGVzKHNlbGVjdG9yKTtcbiAgICB9O1xuICB9XG4gIGxldCByZXN1bHQgPSBbXTtcblxuICAvLyBlc2xpbnQgYnVnIGhlcmU6XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby11bnVzZWQtdmFyc1xuICBmb3IgKGNvbnN0IFtlbGVtZW50LCByb2xlc10gb2YgZWxlbWVudFJvbGVzTWFwLmVudHJpZXMoKSkge1xuICAgIHJlc3VsdCA9IFsuLi5yZXN1bHQsIHtcbiAgICAgIG1hdGNoOiBtYXRjaChlbGVtZW50KSxcbiAgICAgIHJvbGVzOiBBcnJheS5mcm9tKHJvbGVzKSxcbiAgICAgIHNwZWNpZmljaXR5OiBnZXRTZWxlY3RvclNwZWNpZmljaXR5KGVsZW1lbnQpXG4gICAgfV07XG4gIH1cbiAgcmV0dXJuIHJlc3VsdC5zb3J0KGJ5U2VsZWN0b3JTcGVjaWZpY2l0eSk7XG59XG5mdW5jdGlvbiBnZXRSb2xlcyhjb250YWluZXIsIHtcbiAgaGlkZGVuID0gZmFsc2Vcbn0gPSB7fSkge1xuICBmdW5jdGlvbiBmbGF0dGVuRE9NKG5vZGUpIHtcbiAgICByZXR1cm4gW25vZGUsIC4uLkFycmF5LmZyb20obm9kZS5jaGlsZHJlbikucmVkdWNlKChhY2MsIGNoaWxkKSA9PiBbLi4uYWNjLCAuLi5mbGF0dGVuRE9NKGNoaWxkKV0sIFtdKV07XG4gIH1cbiAgcmV0dXJuIGZsYXR0ZW5ET00oY29udGFpbmVyKS5maWx0ZXIoZWxlbWVudCA9PiB7XG4gICAgcmV0dXJuIGhpZGRlbiA9PT0gZmFsc2UgPyBpc0luYWNjZXNzaWJsZShlbGVtZW50KSA9PT0gZmFsc2UgOiB0cnVlO1xuICB9KS5yZWR1Y2UoKGFjYywgbm9kZSkgPT4ge1xuICAgIGxldCByb2xlcyA9IFtdO1xuICAgIC8vIFRPRE86IFRoaXMgdmlvbGF0ZXMgaHRtbC1hcmlhIHdoaWNoIGRvZXMgbm90IGFsbG93IGFueSByb2xlIG9uIGV2ZXJ5IGVsZW1lbnRcbiAgICBpZiAobm9kZS5oYXNBdHRyaWJ1dGUoJ3JvbGUnKSkge1xuICAgICAgcm9sZXMgPSBub2RlLmdldEF0dHJpYnV0ZSgncm9sZScpLnNwbGl0KCcgJykuc2xpY2UoMCwgMSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJvbGVzID0gZ2V0SW1wbGljaXRBcmlhUm9sZXMobm9kZSk7XG4gICAgfVxuICAgIHJldHVybiByb2xlcy5yZWR1Y2UoKHJvbGVzQWNjLCByb2xlKSA9PiBBcnJheS5pc0FycmF5KHJvbGVzQWNjW3JvbGVdKSA/IHtcbiAgICAgIC4uLnJvbGVzQWNjLFxuICAgICAgW3JvbGVdOiBbLi4ucm9sZXNBY2Nbcm9sZV0sIG5vZGVdXG4gICAgfSA6IHtcbiAgICAgIC4uLnJvbGVzQWNjLFxuICAgICAgW3JvbGVdOiBbbm9kZV1cbiAgICB9LCBhY2MpO1xuICB9LCB7fSk7XG59XG5mdW5jdGlvbiBwcmV0dHlSb2xlcyhkb20sIHtcbiAgaGlkZGVuLFxuICBpbmNsdWRlRGVzY3JpcHRpb25cbn0pIHtcbiAgY29uc3Qgcm9sZXMgPSBnZXRSb2xlcyhkb20sIHtcbiAgICBoaWRkZW5cbiAgfSk7XG4gIC8vIFdlIHByZWZlciB0byBza2lwIGdlbmVyaWMgcm9sZSwgd2UgZG9uJ3QgcmVjb21tZW5kIGl0XG4gIHJldHVybiBPYmplY3QuZW50cmllcyhyb2xlcykuZmlsdGVyKChbcm9sZV0pID0+IHJvbGUgIT09ICdnZW5lcmljJykubWFwKChbcm9sZSwgZWxlbWVudHNdKSA9PiB7XG4gICAgY29uc3QgZGVsaW1pdGVyQmFyID0gJy0nLnJlcGVhdCg1MCk7XG4gICAgY29uc3QgZWxlbWVudHNTdHJpbmcgPSBlbGVtZW50cy5tYXAoZWwgPT4ge1xuICAgICAgY29uc3QgbmFtZVN0cmluZyA9IGBOYW1lIFwiJHsoMCwgX2RvbUFjY2Vzc2liaWxpdHlBcGkuY29tcHV0ZUFjY2Vzc2libGVOYW1lKShlbCwge1xuICAgICAgICBjb21wdXRlZFN0eWxlU3VwcG9ydHNQc2V1ZG9FbGVtZW50czogKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmNvbXB1dGVkU3R5bGVTdXBwb3J0c1BzZXVkb0VsZW1lbnRzXG4gICAgICB9KX1cIjpcXG5gO1xuICAgICAgY29uc3QgZG9tU3RyaW5nID0gKDAsIF9wcmV0dHlEb20ucHJldHR5RE9NKShlbC5jbG9uZU5vZGUoZmFsc2UpKTtcbiAgICAgIGlmIChpbmNsdWRlRGVzY3JpcHRpb24pIHtcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb25TdHJpbmcgPSBgRGVzY3JpcHRpb24gXCIkeygwLCBfZG9tQWNjZXNzaWJpbGl0eUFwaS5jb21wdXRlQWNjZXNzaWJsZURlc2NyaXB0aW9uKShlbCwge1xuICAgICAgICAgIGNvbXB1dGVkU3R5bGVTdXBwb3J0c1BzZXVkb0VsZW1lbnRzOiAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkuY29tcHV0ZWRTdHlsZVN1cHBvcnRzUHNldWRvRWxlbWVudHNcbiAgICAgICAgfSl9XCI6XFxuYDtcbiAgICAgICAgcmV0dXJuIGAke25hbWVTdHJpbmd9JHtkZXNjcmlwdGlvblN0cmluZ30ke2RvbVN0cmluZ31gO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGAke25hbWVTdHJpbmd9JHtkb21TdHJpbmd9YDtcbiAgICB9KS5qb2luKCdcXG5cXG4nKTtcbiAgICByZXR1cm4gYCR7cm9sZX06XFxuXFxuJHtlbGVtZW50c1N0cmluZ31cXG5cXG4ke2RlbGltaXRlckJhcn1gO1xuICB9KS5qb2luKCdcXG4nKTtcbn1cbmNvbnN0IGxvZ1JvbGVzID0gKGRvbSwge1xuICBoaWRkZW4gPSBmYWxzZVxufSA9IHt9KSA9PiBjb25zb2xlLmxvZyhwcmV0dHlSb2xlcyhkb20sIHtcbiAgaGlkZGVuXG59KSk7XG5cbi8qKlxuICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC1cbiAqIEByZXR1cm5zIHtib29sZWFuIHwgdW5kZWZpbmVkfSAtIGZhbHNlL3RydWUgaWYgKG5vdClzZWxlY3RlZCwgdW5kZWZpbmVkIGlmIG5vdCBzZWxlY3RhYmxlXG4gKi9cbmV4cG9ydHMubG9nUm9sZXMgPSBsb2dSb2xlcztcbmZ1bmN0aW9uIGNvbXB1dGVBcmlhU2VsZWN0ZWQoZWxlbWVudCkge1xuICAvLyBpbXBsaWNpdCB2YWx1ZSBmcm9tIGh0bWwtYWFtIG1hcHBpbmdzOiBodHRwczovL3d3dy53My5vcmcvVFIvaHRtbC1hYW0tMS4wLyNodG1sLWF0dHJpYnV0ZS1zdGF0ZS1hbmQtcHJvcGVydHktbWFwcGluZ3NcbiAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2h0bWwtYWFtLTEuMC8jZGV0YWlscy1pZC05N1xuICBpZiAoZWxlbWVudC50YWdOYW1lID09PSAnT1BUSU9OJykge1xuICAgIHJldHVybiBlbGVtZW50LnNlbGVjdGVkO1xuICB9XG5cbiAgLy8gZXhwbGljaXQgdmFsdWVcbiAgcmV0dXJuIGNoZWNrQm9vbGVhbkF0dHJpYnV0ZShlbGVtZW50LCAnYXJpYS1zZWxlY3RlZCcpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gLVxuICovXG5mdW5jdGlvbiBjb21wdXRlQXJpYUJ1c3koZWxlbWVudCkge1xuICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEtMS4xLyNhcmlhLWJ1c3lcbiAgcmV0dXJuIGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdhcmlhLWJ1c3knKSA9PT0gJ3RydWUnO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtXG4gKiBAcmV0dXJucyB7Ym9vbGVhbiB8IHVuZGVmaW5lZH0gLSBmYWxzZS90cnVlIGlmIChub3QpY2hlY2tlZCwgdW5kZWZpbmVkIGlmIG5vdCBjaGVja2VkLWFibGVcbiAqL1xuZnVuY3Rpb24gY29tcHV0ZUFyaWFDaGVja2VkKGVsZW1lbnQpIHtcbiAgLy8gaW1wbGljaXQgdmFsdWUgZnJvbSBodG1sLWFhbSBtYXBwaW5nczogaHR0cHM6Ly93d3cudzMub3JnL1RSL2h0bWwtYWFtLTEuMC8jaHRtbC1hdHRyaWJ1dGUtc3RhdGUtYW5kLXByb3BlcnR5LW1hcHBpbmdzXG4gIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi9odG1sLWFhbS0xLjAvI2RldGFpbHMtaWQtNTZcbiAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL2h0bWwtYWFtLTEuMC8jZGV0YWlscy1pZC02N1xuICBpZiAoJ2luZGV0ZXJtaW5hdGUnIGluIGVsZW1lbnQgJiYgZWxlbWVudC5pbmRldGVybWluYXRlKSB7XG4gICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgfVxuICBpZiAoJ2NoZWNrZWQnIGluIGVsZW1lbnQpIHtcbiAgICByZXR1cm4gZWxlbWVudC5jaGVja2VkO1xuICB9XG5cbiAgLy8gZXhwbGljaXQgdmFsdWVcbiAgcmV0dXJuIGNoZWNrQm9vbGVhbkF0dHJpYnV0ZShlbGVtZW50LCAnYXJpYS1jaGVja2VkJyk7XG59XG5cbi8qKlxuICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC1cbiAqIEByZXR1cm5zIHtib29sZWFuIHwgdW5kZWZpbmVkfSAtIGZhbHNlL3RydWUgaWYgKG5vdClwcmVzc2VkLCB1bmRlZmluZWQgaWYgbm90IHByZXNzLWFibGVcbiAqL1xuZnVuY3Rpb24gY29tcHV0ZUFyaWFQcmVzc2VkKGVsZW1lbnQpIHtcbiAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dhaS1hcmlhLTEuMS8jYXJpYS1wcmVzc2VkXG4gIHJldHVybiBjaGVja0Jvb2xlYW5BdHRyaWJ1dGUoZWxlbWVudCwgJ2FyaWEtcHJlc3NlZCcpO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtXG4gKiBAcmV0dXJucyB7Ym9vbGVhbiB8IHN0cmluZyB8IG51bGx9IC1cbiAqL1xuZnVuY3Rpb24gY29tcHV0ZUFyaWFDdXJyZW50KGVsZW1lbnQpIHtcbiAgLy8gaHR0cHM6Ly93d3cudzMub3JnL1RSL3dhaS1hcmlhLTEuMS8jYXJpYS1jdXJyZW50XG4gIHJldHVybiBjaGVja0Jvb2xlYW5BdHRyaWJ1dGUoZWxlbWVudCwgJ2FyaWEtY3VycmVudCcpID8/IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnKSA/PyBmYWxzZTtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgLVxuICogQHJldHVybnMge2Jvb2xlYW4gfCB1bmRlZmluZWR9IC0gZmFsc2UvdHJ1ZSBpZiAobm90KWV4cGFuZGVkLCB1bmRlZmluZWQgaWYgbm90IGV4cGFuZC1hYmxlXG4gKi9cbmZ1bmN0aW9uIGNvbXB1dGVBcmlhRXhwYW5kZWQoZWxlbWVudCkge1xuICAvLyBodHRwczovL3d3dy53My5vcmcvVFIvd2FpLWFyaWEtMS4xLyNhcmlhLWV4cGFuZGVkXG4gIHJldHVybiBjaGVja0Jvb2xlYW5BdHRyaWJ1dGUoZWxlbWVudCwgJ2FyaWEtZXhwYW5kZWQnKTtcbn1cbmZ1bmN0aW9uIGNoZWNrQm9vbGVhbkF0dHJpYnV0ZShlbGVtZW50LCBhdHRyaWJ1dGUpIHtcbiAgY29uc3QgYXR0cmlidXRlVmFsdWUgPSBlbGVtZW50LmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpO1xuICBpZiAoYXR0cmlidXRlVmFsdWUgPT09ICd0cnVlJykge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIGlmIChhdHRyaWJ1dGVWYWx1ZSA9PT0gJ2ZhbHNlJykge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtXG4gKiBAcmV0dXJucyB7bnVtYmVyIHwgdW5kZWZpbmVkfSAtIG51bWJlciBpZiBpbXBsaWNpdCBoZWFkaW5nIG9yIGFyaWEtbGV2ZWwgcHJlc2VudCwgb3RoZXJ3aXNlIHVuZGVmaW5lZFxuICovXG5mdW5jdGlvbiBjb21wdXRlSGVhZGluZ0xldmVsKGVsZW1lbnQpIHtcbiAgLy8gaHR0cHM6Ly93M2MuZ2l0aHViLmlvL2h0bWwtYWFtLyNlbC1oMS1oNlxuICAvLyBodHRwczovL3czYy5naXRodWIuaW8vaHRtbC1hYW0vI2VsLWgxLWg2XG4gIGNvbnN0IGltcGxpY2l0SGVhZGluZ0xldmVscyA9IHtcbiAgICBIMTogMSxcbiAgICBIMjogMixcbiAgICBIMzogMyxcbiAgICBINDogNCxcbiAgICBINTogNSxcbiAgICBINjogNlxuICB9O1xuICAvLyBleHBsaWNpdCBhcmlhLWxldmVsIHZhbHVlXG4gIC8vIGh0dHBzOi8vd3d3LnczLm9yZy9UUi93YWktYXJpYS0xLjIvI2FyaWEtbGV2ZWxcbiAgY29uc3QgYXJpYUxldmVsQXR0cmlidXRlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGV2ZWwnKSAmJiBOdW1iZXIoZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtbGV2ZWwnKSk7XG4gIHJldHVybiBhcmlhTGV2ZWxBdHRyaWJ1dGUgfHwgaW1wbGljaXRIZWFkaW5nTGV2ZWxzW2VsZW1lbnQudGFnTmFtZV07XG59XG5cbi8qKlxuICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC1cbiAqIEByZXR1cm5zIHtudW1iZXIgfCB1bmRlZmluZWR9IC1cbiAqL1xuZnVuY3Rpb24gY29tcHV0ZUFyaWFWYWx1ZU5vdyhlbGVtZW50KSB7XG4gIGNvbnN0IHZhbHVlTm93ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ2FyaWEtdmFsdWVub3cnKTtcbiAgcmV0dXJuIHZhbHVlTm93ID09PSBudWxsID8gdW5kZWZpbmVkIDogK3ZhbHVlTm93O1xufVxuXG4vKipcbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudCAtXG4gKiBAcmV0dXJucyB7bnVtYmVyIHwgdW5kZWZpbmVkfSAtXG4gKi9cbmZ1bmN0aW9uIGNvbXB1dGVBcmlhVmFsdWVNYXgoZWxlbWVudCkge1xuICBjb25zdCB2YWx1ZU1heCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCdhcmlhLXZhbHVlbWF4Jyk7XG4gIHJldHVybiB2YWx1ZU1heCA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6ICt2YWx1ZU1heDtcbn1cblxuLyoqXG4gKiBAcGFyYW0ge0VsZW1lbnR9IGVsZW1lbnQgLVxuICogQHJldHVybnMge251bWJlciB8IHVuZGVmaW5lZH0gLVxuICovXG5mdW5jdGlvbiBjb21wdXRlQXJpYVZhbHVlTWluKGVsZW1lbnQpIHtcbiAgY29uc3QgdmFsdWVNaW4gPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZW1pbicpO1xuICByZXR1cm4gdmFsdWVNaW4gPT09IG51bGwgPyB1bmRlZmluZWQgOiArdmFsdWVNaW47XG59XG5cbi8qKlxuICogQHBhcmFtIHtFbGVtZW50fSBlbGVtZW50IC1cbiAqIEByZXR1cm5zIHtzdHJpbmcgfCB1bmRlZmluZWR9IC1cbiAqL1xuZnVuY3Rpb24gY29tcHV0ZUFyaWFWYWx1ZVRleHQoZWxlbWVudCkge1xuICBjb25zdCB2YWx1ZVRleHQgPSBlbGVtZW50LmdldEF0dHJpYnV0ZSgnYXJpYS12YWx1ZXRleHQnKTtcbiAgcmV0dXJuIHZhbHVlVGV4dCA9PT0gbnVsbCA/IHVuZGVmaW5lZCA6IHZhbHVlVGV4dDtcbn0iXSwidmVyc2lvbiI6M30=