9150563223c14681ce6c26eb2ff48b91
"use strict";
/**
 * Form Validation Fixes Test Suite
 *
 * This test suite identifies and validates fixes for form submission issues
 * including UUID handling, empty field validation, and data transformation.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const operations_1 = require("../../shared/schemas/operations");
const validations_1 = require("../../client/src/lib/validations");
(0, globals_1.describe)('Form Validation Fixes', () => {
    (0, globals_1.describe)('Demand Schema Validation', () => {
        (0, globals_1.it)('should handle empty string UUIDs correctly', () => {
            const testData = {
                type: 'maintenance',
                description: 'Test description for validation',
                buildingId: '',
                residenceId: '',
                assignationBuildingId: '',
                assignationResidenceId: ''
            };
            // Transform empty strings to undefined for optional fields
            const transformedData = {
                ...testData,
                buildingId: testData.buildingId || undefined,
                residenceId: testData.residenceId || undefined,
                assignationBuildingId: testData.assignationBuildingId || undefined,
                assignationResidenceId: testData.assignationResidenceId || undefined
            };
            // Create a validation schema that omits submitterId (auto-populated)
            const validationSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            // This should not throw validation errors
            (0, globals_1.expect)(() => {
                validationSchema.parse(transformedData);
            }).not.toThrow();
        });
        (0, globals_1.it)('should validate required description field', () => {
            const testData = {
                type: 'maintenance',
                description: '', // Empty description should fail
                buildingId: 'valid-uuid-string'
            };
            const validationSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            (0, globals_1.expect)(() => {
                validationSchema.parse(testData);
            }).toThrow();
        });
        (0, globals_1.it)('should validate description length limits', () => {
            const testData = {
                type: 'maintenance',
                description: 'A'.repeat(2001), // Too long
                buildingId: 'valid-uuid-string'
            };
            const validationSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            (0, globals_1.expect)(() => {
                validationSchema.parse(testData);
            }).toThrow();
        });
        (0, globals_1.it)('should validate minimum description length', () => {
            const testData = {
                type: 'maintenance',
                description: 'Short', // Too short (less than 10 chars)
                buildingId: 'valid-uuid-string'
            };
            const validationSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            (0, globals_1.expect)(() => {
                validationSchema.parse(testData);
            }).toThrow();
        });
        (0, globals_1.it)('should validate valid UUIDs when provided', () => {
            const testData = {
                type: 'maintenance',
                description: 'Valid description with proper length',
                buildingId: 'not-a-valid-uuid',
                residenceId: 'also-not-valid'
            };
            const validationSchema = operations_1.insertDemandSchema.omit({ submitterId: true });
            (0, globals_1.expect)(() => {
                validationSchema.parse(testData);
            }).toThrow();
        });
    });
    (0, globals_1.describe)('Frontend Form Validation', () => {
        (0, globals_1.it)('should validate demand form with proper schema', () => {
            const demandSchema = validations_1.schemas.demand;
            const validData = {
                type: 'maintenance',
                description: 'This is a valid description with proper length',
                buildingId: '123e4567-e89b-12d3-a456-426614174000',
                residenceId: undefined,
                assignationBuildingId: undefined,
                assignationResidenceId: undefined
            };
            (0, globals_1.expect)(() => {
                demandSchema.parse(validData);
            }).not.toThrow();
        });
        (0, globals_1.it)('should handle optional fields correctly', () => {
            const demandSchema = validations_1.schemas.demand;
            const dataWithOptionalFields = {
                type: 'complaint',
                description: 'This complaint has all optional fields populated',
                buildingId: '123e4567-e89b-12d3-a456-426614174000',
                residenceId: '123e4567-e89b-12d3-a456-426614174001',
                assignationBuildingId: '123e4567-e89b-12d3-a456-426614174002',
                assignationResidenceId: '123e4567-e89b-12d3-a456-426614174003'
            };
            (0, globals_1.expect)(() => {
                demandSchema.parse(dataWithOptionalFields);
            }).not.toThrow();
        });
    });
    (0, globals_1.describe)('Form Data Transformation', () => {
        (0, globals_1.it)('should transform form data correctly for API submission', () => {
            const formData = {
                type: 'maintenance',
                description: 'Test maintenance request',
                buildingId: '',
                residenceId: '',
                assignationBuildingId: '',
                assignationResidenceId: ''
            };
            // This is the transformation logic from ResidentDemandsPage
            const transformedData = {
                ...formData,
                status: 'submitted',
                residenceId: formData.residenceId || undefined,
                assignationBuildingId: formData.assignationBuildingId || undefined,
                assignationResidenceId: formData.assignationResidenceId || undefined
            };
            (0, globals_1.expect)(transformedData.residenceId).toBeUndefined();
            (0, globals_1.expect)(transformedData.assignationBuildingId).toBeUndefined();
            (0, globals_1.expect)(transformedData.assignationResidenceId).toBeUndefined();
            (0, globals_1.expect)(transformedData.status).toBe('submitted');
        });
        (0, globals_1.it)('should preserve valid UUID values', () => {
            const formData = {
                type: 'information',
                description: 'Test information request',
                buildingId: '123e4567-e89b-12d3-a456-426614174000',
                residenceId: '123e4567-e89b-12d3-a456-426614174001',
                assignationBuildingId: '123e4567-e89b-12d3-a456-426614174002',
                assignationResidenceId: '123e4567-e89b-12d3-a456-426614174003'
            };
            const transformedData = {
                ...formData,
                status: 'submitted',
                residenceId: formData.residenceId || undefined,
                assignationBuildingId: formData.assignationBuildingId || undefined,
                assignationResidenceId: formData.assignationResidenceId || undefined
            };
            (0, globals_1.expect)(transformedData.residenceId).toBe('123e4567-e89b-12d3-a456-426614174001');
            (0, globals_1.expect)(transformedData.assignationBuildingId).toBe('123e4567-e89b-12d3-a456-426614174002');
            (0, globals_1.expect)(transformedData.assignationResidenceId).toBe('123e4567-e89b-12d3-a456-426614174003');
        });
    });
    (0, globals_1.describe)('Error Message Validation', () => {
        (0, globals_1.it)('should provide helpful error messages for validation failures', () => {
            const demandSchema = validations_1.schemas.demand;
            const invalidData = {
                type: 'maintenance',
                description: 'Short', // Too short
                buildingId: 'invalid-uuid'
            };
            try {
                demandSchema.parse(invalidData);
                fail('Should have thrown validation error');
            }
            catch (error) {
                (0, globals_1.expect)(error.errors).toBeDefined();
                (0, globals_1.expect)(error.errors.length).toBeGreaterThan(0);
                // Should have specific error messages
                const descriptionError = error.errors.find((e) => e.path.includes('description'));
                (0, globals_1.expect)(descriptionError).toBeDefined();
                (0, globals_1.expect)(descriptionError.message).toContain('at least');
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2Zvcm0tdmFsaWRhdGlvbi1maXhlcy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7QUFFSCwyQ0FBcUQ7QUFFckQsZ0VBQXFFO0FBQ3JFLGtFQUEyRDtBQUUzRCxJQUFBLGtCQUFRLEVBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFO0lBQ3JDLElBQUEsa0JBQVEsRUFBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsSUFBQSxZQUFFLEVBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ3BELE1BQU0sUUFBUSxHQUFHO2dCQUNmLElBQUksRUFBRSxhQUFhO2dCQUNuQixXQUFXLEVBQUUsaUNBQWlDO2dCQUM5QyxVQUFVLEVBQUUsRUFBRTtnQkFDZCxXQUFXLEVBQUUsRUFBRTtnQkFDZixxQkFBcUIsRUFBRSxFQUFFO2dCQUN6QixzQkFBc0IsRUFBRSxFQUFFO2FBQzNCLENBQUM7WUFFRiwyREFBMkQ7WUFDM0QsTUFBTSxlQUFlLEdBQUc7Z0JBQ3RCLEdBQUcsUUFBUTtnQkFDWCxVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVUsSUFBSSxTQUFTO2dCQUM1QyxXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVcsSUFBSSxTQUFTO2dCQUM5QyxxQkFBcUIsRUFBRSxRQUFRLENBQUMscUJBQXFCLElBQUksU0FBUztnQkFDbEUsc0JBQXNCLEVBQUUsUUFBUSxDQUFDLHNCQUFzQixJQUFJLFNBQVM7YUFDckUsQ0FBQztZQUVGLHFFQUFxRTtZQUNyRSxNQUFNLGdCQUFnQixHQUFHLCtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXhFLDBDQUEwQztZQUMxQyxJQUFBLGdCQUFNLEVBQUMsR0FBRyxFQUFFO2dCQUNWLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxlQUFlLENBQUMsQ0FBQztZQUMxQyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxFQUFFLENBQUM7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TSxFQUFDLGdCQUFnQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ3ZDLElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDekQsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3Rlc3RzL3VuaXQvZm9ybS12YWxpZGF0aW9uLWZpeGVzLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBGb3JtIFZhbGlkYXRpb24gRml4ZXMgVGVzdCBTdWl0ZVxuICogXG4gKiBUaGlzIHRlc3Qgc3VpdGUgaWRlbnRpZmllcyBhbmQgdmFsaWRhdGVzIGZpeGVzIGZvciBmb3JtIHN1Ym1pc3Npb24gaXNzdWVzXG4gKiBpbmNsdWRpbmcgVVVJRCBoYW5kbGluZywgZW1wdHkgZmllbGQgdmFsaWRhdGlvbiwgYW5kIGRhdGEgdHJhbnNmb3JtYXRpb24uXG4gKi9cblxuaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcbmltcG9ydCB7IHogfSBmcm9tICd6b2QnO1xuaW1wb3J0IHsgaW5zZXJ0RGVtYW5kU2NoZW1hIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NjaGVtYXMvb3BlcmF0aW9ucyc7XG5pbXBvcnQgeyBzY2hlbWFzIH0gZnJvbSAnLi4vLi4vY2xpZW50L3NyYy9saWIvdmFsaWRhdGlvbnMnO1xuXG5kZXNjcmliZSgnRm9ybSBWYWxpZGF0aW9uIEZpeGVzJywgKCkgPT4ge1xuICBkZXNjcmliZSgnRGVtYW5kIFNjaGVtYSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGVtcHR5IHN0cmluZyBVVUlEcyBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0RGF0YSA9IHtcbiAgICAgICAgdHlwZTogJ21haW50ZW5hbmNlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGRlc2NyaXB0aW9uIGZvciB2YWxpZGF0aW9uJyxcbiAgICAgICAgYnVpbGRpbmdJZDogJycsXG4gICAgICAgIHJlc2lkZW5jZUlkOiAnJyxcbiAgICAgICAgYXNzaWduYXRpb25CdWlsZGluZ0lkOiAnJyxcbiAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogJydcbiAgICAgIH07XG5cbiAgICAgIC8vIFRyYW5zZm9ybSBlbXB0eSBzdHJpbmdzIHRvIHVuZGVmaW5lZCBmb3Igb3B0aW9uYWwgZmllbGRzXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZERhdGEgPSB7XG4gICAgICAgIC4uLnRlc3REYXRhLFxuICAgICAgICBidWlsZGluZ0lkOiB0ZXN0RGF0YS5idWlsZGluZ0lkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3REYXRhLnJlc2lkZW5jZUlkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgYXNzaWduYXRpb25CdWlsZGluZ0lkOiB0ZXN0RGF0YS5hc3NpZ25hdGlvbkJ1aWxkaW5nSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhc3NpZ25hdGlvblJlc2lkZW5jZUlkOiB0ZXN0RGF0YS5hc3NpZ25hdGlvblJlc2lkZW5jZUlkIHx8IHVuZGVmaW5lZFxuICAgICAgfTtcblxuICAgICAgLy8gQ3JlYXRlIGEgdmFsaWRhdGlvbiBzY2hlbWEgdGhhdCBvbWl0cyBzdWJtaXR0ZXJJZCAoYXV0by1wb3B1bGF0ZWQpXG4gICAgICBjb25zdCB2YWxpZGF0aW9uU2NoZW1hID0gaW5zZXJ0RGVtYW5kU2NoZW1hLm9taXQoeyBzdWJtaXR0ZXJJZDogdHJ1ZSB9KTtcbiAgICAgIFxuICAgICAgLy8gVGhpcyBzaG91bGQgbm90IHRocm93IHZhbGlkYXRpb24gZXJyb3JzXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0aW9uU2NoZW1hLnBhcnNlKHRyYW5zZm9ybWVkRGF0YSk7XG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSByZXF1aXJlZCBkZXNjcmlwdGlvbiBmaWVsZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJycsIC8vIEVtcHR5IGRlc2NyaXB0aW9uIHNob3VsZCBmYWlsXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICd2YWxpZC11dWlkLXN0cmluZydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25TY2hlbWEgPSBpbnNlcnREZW1hbmRTY2hlbWEub21pdCh7IHN1Ym1pdHRlcklkOiB0cnVlIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0aW9uU2NoZW1hLnBhcnNlKHRlc3REYXRhKTtcbiAgICAgIH0pLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZGVzY3JpcHRpb24gbGVuZ3RoIGxpbWl0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0EnLnJlcGVhdCgyMDAxKSwgLy8gVG9vIGxvbmdcbiAgICAgICAgYnVpbGRpbmdJZDogJ3ZhbGlkLXV1aWQtc3RyaW5nJ1xuICAgICAgfTtcblxuICAgICAgY29uc3QgdmFsaWRhdGlvblNjaGVtYSA9IGluc2VydERlbWFuZFNjaGVtYS5vbWl0KHsgc3VibWl0dGVySWQ6IHRydWUgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdCgoKSA9PiB7XG4gICAgICAgIHZhbGlkYXRpb25TY2hlbWEucGFyc2UodGVzdERhdGEpO1xuICAgICAgfSkudG9UaHJvdygpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBtaW5pbXVtIGRlc2NyaXB0aW9uIGxlbmd0aCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Nob3J0JywgLy8gVG9vIHNob3J0IChsZXNzIHRoYW4gMTAgY2hhcnMpXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICd2YWxpZC11dWlkLXN0cmluZydcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25TY2hlbWEgPSBpbnNlcnREZW1hbmRTY2hlbWEub21pdCh7IHN1Ym1pdHRlcklkOiB0cnVlIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0aW9uU2NoZW1hLnBhcnNlKHRlc3REYXRhKTtcbiAgICAgIH0pLnRvVGhyb3coKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgdmFsaWQgVVVJRHMgd2hlbiBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3REYXRhID0ge1xuICAgICAgICB0eXBlOiAnbWFpbnRlbmFuY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1ZhbGlkIGRlc2NyaXB0aW9uIHdpdGggcHJvcGVyIGxlbmd0aCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICdub3QtYS12YWxpZC11dWlkJyxcbiAgICAgICAgcmVzaWRlbmNlSWQ6ICdhbHNvLW5vdC12YWxpZCdcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25TY2hlbWEgPSBpbnNlcnREZW1hbmRTY2hlbWEub21pdCh7IHN1Ym1pdHRlcklkOiB0cnVlIH0pO1xuICAgICAgXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICB2YWxpZGF0aW9uU2NoZW1hLnBhcnNlKHRlc3REYXRhKTtcbiAgICAgIH0pLnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0Zyb250ZW5kIEZvcm0gVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGRlbWFuZCBmb3JtIHdpdGggcHJvcGVyIHNjaGVtYScsICgpID0+IHtcbiAgICAgIGNvbnN0IGRlbWFuZFNjaGVtYSA9IHNjaGVtYXMuZGVtYW5kO1xuICAgICAgXG4gICAgICBjb25zdCB2YWxpZERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGhpcyBpcyBhIHZhbGlkIGRlc2NyaXB0aW9uIHdpdGggcHJvcGVyIGxlbmd0aCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgICByZXNpZGVuY2VJZDogdW5kZWZpbmVkLFxuICAgICAgICBhc3NpZ25hdGlvbkJ1aWxkaW5nSWQ6IHVuZGVmaW5lZCxcbiAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogdW5kZWZpbmVkXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBkZW1hbmRTY2hlbWEucGFyc2UodmFsaWREYXRhKTtcbiAgICAgIH0pLm5vdC50b1Rocm93KCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBvcHRpb25hbCBmaWVsZHMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgZGVtYW5kU2NoZW1hID0gc2NoZW1hcy5kZW1hbmQ7XG4gICAgICBcbiAgICAgIGNvbnN0IGRhdGFXaXRoT3B0aW9uYWxGaWVsZHMgPSB7XG4gICAgICAgIHR5cGU6ICdjb21wbGFpbnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1RoaXMgY29tcGxhaW50IGhhcyBhbGwgb3B0aW9uYWwgZmllbGRzIHBvcHVsYXRlZCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgICByZXNpZGVuY2VJZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXG4gICAgICAgIGFzc2lnbmF0aW9uQnVpbGRpbmdJZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMicsXG4gICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDMnXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoKCkgPT4ge1xuICAgICAgICBkZW1hbmRTY2hlbWEucGFyc2UoZGF0YVdpdGhPcHRpb25hbEZpZWxkcyk7XG4gICAgICB9KS5ub3QudG9UaHJvdygpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRm9ybSBEYXRhIFRyYW5zZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhbnNmb3JtIGZvcm0gZGF0YSBjb3JyZWN0bHkgZm9yIEFQSSBzdWJtaXNzaW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgZm9ybURhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBtYWludGVuYW5jZSByZXF1ZXN0JyxcbiAgICAgICAgYnVpbGRpbmdJZDogJycsXG4gICAgICAgIHJlc2lkZW5jZUlkOiAnJyxcbiAgICAgICAgYXNzaWduYXRpb25CdWlsZGluZ0lkOiAnJyxcbiAgICAgICAgYXNzaWduYXRpb25SZXNpZGVuY2VJZDogJydcbiAgICAgIH07XG5cbiAgICAgIC8vIFRoaXMgaXMgdGhlIHRyYW5zZm9ybWF0aW9uIGxvZ2ljIGZyb20gUmVzaWRlbnREZW1hbmRzUGFnZVxuICAgICAgY29uc3QgdHJhbnNmb3JtZWREYXRhID0ge1xuICAgICAgICAuLi5mb3JtRGF0YSxcbiAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IGZvcm1EYXRhLnJlc2lkZW5jZUlkIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgYXNzaWduYXRpb25CdWlsZGluZ0lkOiBmb3JtRGF0YS5hc3NpZ25hdGlvbkJ1aWxkaW5nSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhc3NpZ25hdGlvblJlc2lkZW5jZUlkOiBmb3JtRGF0YS5hc3NpZ25hdGlvblJlc2lkZW5jZUlkIHx8IHVuZGVmaW5lZFxuICAgICAgfTtcblxuICAgICAgZXhwZWN0KHRyYW5zZm9ybWVkRGF0YS5yZXNpZGVuY2VJZCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRyYW5zZm9ybWVkRGF0YS5hc3NpZ25hdGlvbkJ1aWxkaW5nSWQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0cmFuc2Zvcm1lZERhdGEuYXNzaWduYXRpb25SZXNpZGVuY2VJZCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHRyYW5zZm9ybWVkRGF0YS5zdGF0dXMpLnRvQmUoJ3N1Ym1pdHRlZCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmVzZXJ2ZSB2YWxpZCBVVUlEIHZhbHVlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGZvcm1EYXRhID0ge1xuICAgICAgICB0eXBlOiAnaW5mb3JtYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgaW5mb3JtYXRpb24gcmVxdWVzdCcsXG4gICAgICAgIGJ1aWxkaW5nSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDAnLFxuICAgICAgICByZXNpZGVuY2VJZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMScsXG4gICAgICAgIGFzc2lnbmF0aW9uQnVpbGRpbmdJZDogJzEyM2U0NTY3LWU4OWItMTJkMy1hNDU2LTQyNjYxNDE3NDAwMicsXG4gICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6ICcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDMnXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB0cmFuc2Zvcm1lZERhdGEgPSB7XG4gICAgICAgIC4uLmZvcm1EYXRhLFxuICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgICByZXNpZGVuY2VJZDogZm9ybURhdGEucmVzaWRlbmNlSWQgfHwgdW5kZWZpbmVkLFxuICAgICAgICBhc3NpZ25hdGlvbkJ1aWxkaW5nSWQ6IGZvcm1EYXRhLmFzc2lnbmF0aW9uQnVpbGRpbmdJZCB8fCB1bmRlZmluZWQsXG4gICAgICAgIGFzc2lnbmF0aW9uUmVzaWRlbmNlSWQ6IGZvcm1EYXRhLmFzc2lnbmF0aW9uUmVzaWRlbmNlSWQgfHwgdW5kZWZpbmVkXG4gICAgICB9O1xuXG4gICAgICBleHBlY3QodHJhbnNmb3JtZWREYXRhLnJlc2lkZW5jZUlkKS50b0JlKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDEnKTtcbiAgICAgIGV4cGVjdCh0cmFuc2Zvcm1lZERhdGEuYXNzaWduYXRpb25CdWlsZGluZ0lkKS50b0JlKCcxMjNlNDU2Ny1lODliLTEyZDMtYTQ1Ni00MjY2MTQxNzQwMDInKTtcbiAgICAgIGV4cGVjdCh0cmFuc2Zvcm1lZERhdGEuYXNzaWduYXRpb25SZXNpZGVuY2VJZCkudG9CZSgnMTIzZTQ1NjctZTg5Yi0xMmQzLWE0NTYtNDI2NjE0MTc0MDAzJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdFcnJvciBNZXNzYWdlIFZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcm92aWRlIGhlbHBmdWwgZXJyb3IgbWVzc2FnZXMgZm9yIHZhbGlkYXRpb24gZmFpbHVyZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkZW1hbmRTY2hlbWEgPSBzY2hlbWFzLmRlbWFuZDtcbiAgICAgIFxuICAgICAgY29uc3QgaW52YWxpZERhdGEgPSB7XG4gICAgICAgIHR5cGU6ICdtYWludGVuYW5jZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnU2hvcnQnLCAvLyBUb28gc2hvcnRcbiAgICAgICAgYnVpbGRpbmdJZDogJ2ludmFsaWQtdXVpZCdcbiAgICAgIH07XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGRlbWFuZFNjaGVtYS5wYXJzZShpbnZhbGlkRGF0YSk7XG4gICAgICAgIGZhaWwoJ1Nob3VsZCBoYXZlIHRocm93biB2YWxpZGF0aW9uIGVycm9yJyk7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGV4cGVjdChlcnJvci5lcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICAgIGV4cGVjdChlcnJvci5lcnJvcnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICAgIC8vIFNob3VsZCBoYXZlIHNwZWNpZmljIGVycm9yIG1lc3NhZ2VzXG4gICAgICAgIGNvbnN0IGRlc2NyaXB0aW9uRXJyb3IgPSBlcnJvci5lcnJvcnMuZmluZCgoZTogYW55KSA9PiBlLnBhdGguaW5jbHVkZXMoJ2Rlc2NyaXB0aW9uJykpO1xuICAgICAgICBleHBlY3QoZGVzY3JpcHRpb25FcnJvcikudG9CZURlZmluZWQoKTtcbiAgICAgICAgZXhwZWN0KGRlc2NyaXB0aW9uRXJyb3IubWVzc2FnZSkudG9Db250YWluKCdhdCBsZWFzdCcpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9