5bb0dbabff58095eb36f3530927a444e
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = ModularBuildingDocuments;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_1 = __importStar(require("react"));
const react_query_1 = require("@tanstack/react-query");
const wouter_1 = require("wouter");
const lucide_react_1 = require("lucide-react");
const button_1 = require("@/components/ui/button");
const input_1 = require("@/components/ui/input");
const card_1 = require("@/components/ui/card");
const badge_1 = require("@/components/ui/badge");
const queryClient_1 = require("@/lib/queryClient");
const document_management_1 = require("@/components/document-management");
/**
 * ModularBuildingDocuments - Example integration of new modular document components
 * Demonstrates how to use the new reusable components instead of the monolithic DocumentManager
 */
function ModularBuildingDocuments() {
    const [, navigate] = (0, wouter_1.useLocation)();
    const params = (0, wouter_1.useParams)();
    const buildingId = params.buildingId;
    const queryClient = (0, react_query_1.useQueryClient)();
    // State for modals and interactions
    const [isViewModalOpen, setIsViewModalOpen] = (0, react_1.useState)(false);
    const [isEditModalOpen, setIsEditModalOpen] = (0, react_1.useState)(false);
    const [selectedDocumentId, setSelectedDocumentId] = (0, react_1.useState)(null);
    const [isCreating, setIsCreating] = (0, react_1.useState)(false);
    const [searchTerm, setSearchTerm] = (0, react_1.useState)('');
    const [viewMode, setViewMode] = (0, react_1.useState)('grid');
    // Fetch building info
    const { data: building } = (0, react_query_1.useQuery)({
        queryKey: ['/api/manager/buildings', buildingId],
        enabled: !!buildingId,
    });
    // Fetch documents for this building
    const { data: documentResponse, isLoading } = (0, react_query_1.useQuery)({
        queryKey: ['/api/documents', 'building', buildingId],
        queryFn: async () => {
            const response = await (0, queryClient_1.apiRequest)('GET', `/api/documents?buildingId=${buildingId}`);
            return response.json();
        },
        enabled: !!buildingId,
    });
    // Extract documents array from API response
    const documents = Array.isArray(documentResponse?.documents) ? documentResponse.documents : [];
    // Get current user for permissions
    const { data: user } = (0, react_query_1.useQuery)({
        queryKey: ['/api/auth/user'],
        queryFn: () => (0, queryClient_1.apiRequest)('GET', '/api/auth/user'),
    });
    // Determine user permissions based on role
    const userPermissions = {
        canView: true,
        canDownload: true,
        canEdit: user?.role === 'manager' || user?.role === 'admin',
        canDelete: user?.role === 'manager' || user?.role === 'admin',
        canCreate: user?.role === 'manager' || user?.role === 'admin',
    };
    // Filter documents based on search
    const filteredDocuments = Array.isArray(documents) ? documents.filter(doc => doc.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
        doc.description?.toLowerCase().includes(searchTerm.toLowerCase())) : [];
    // Handle document interactions
    const handleDocumentView = (documentId) => {
        setSelectedDocumentId(documentId);
        setIsViewModalOpen(true);
    };
    const handleDocumentEdit = (documentId) => {
        setSelectedDocumentId(documentId);
        setIsEditModalOpen(true);
        setIsViewModalOpen(false);
    };
    const handleCreateDocument = () => {
        setSelectedDocumentId(null);
        setIsCreating(true);
        setIsEditModalOpen(true);
    };
    const handleDocumentSuccess = (documentId, action) => {
        console.log(`Document ${action}:`, documentId);
        setIsEditModalOpen(false);
        setIsViewModalOpen(false);
        setIsCreating(false);
        setSelectedDocumentId(null);
        // Refresh the document list to show the new/updated document
        queryClient.invalidateQueries({
            queryKey: ['/api/documents', 'building', buildingId],
        });
        // Also invalidate general documents cache
        queryClient.invalidateQueries({
            queryKey: ['/api/documents'],
        });
    };
    const handleBack = () => {
        navigate('/manager/buildings');
    };
    if (!buildingId) {
        return ((0, jsx_runtime_1.jsx)("div", { className: "flex-1 flex items-center justify-center", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)("p", { className: "text-gray-500 mb-4", children: "Building ID is required" }), (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: "outline", onClick: handleBack, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Back to Buildings"] })] }) }));
    }
    return ((0, jsx_runtime_1.jsxs)("div", { className: "flex-1 flex flex-col overflow-hidden p-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col space-y-4 mb-6", children: [(0, jsx_runtime_1.jsxs)("div", { className: "flex items-center justify-between", children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { variant: "outline", onClick: handleBack, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: "w-4 h-4 mr-2" }), "Back to Buildings"] }), userPermissions.canCreate && ((0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: handleCreateDocument, "data-testid": "button-create-document", children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Plus, { className: "w-4 h-4 mr-2" }), "Add Document"] }))] }), (0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsxs)("h1", { className: "text-2xl font-bold", children: [building?.name || 'Building', " Documents"] }), (0, jsx_runtime_1.jsxs)("p", { className: "text-gray-600 dark:text-gray-400", children: ["Manage documents for ", building?.name || 'this building'] })] })] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex flex-col sm:flex-row gap-4 mb-6", children: [(0, jsx_runtime_1.jsx)("div", { className: "flex-1", children: (0, jsx_runtime_1.jsx)(input_1.Input, { placeholder: "Search documents...", value: searchTerm, onChange: (e) => setSearchTerm(e.target.value), "data-testid": "input-search-documents" }) }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsx)(button_1.Button, { variant: viewMode === 'grid' ? 'default' : 'outline', size: "sm", onClick: () => setViewMode('grid'), "data-testid": "button-grid-view", children: (0, jsx_runtime_1.jsx)(lucide_react_1.Grid, { className: "w-4 h-4" }) }), (0, jsx_runtime_1.jsx)(button_1.Button, { variant: viewMode === 'list' ? 'default' : 'outline', size: "sm", onClick: () => setViewMode('list'), "data-testid": "button-list-view", children: (0, jsx_runtime_1.jsx)(lucide_react_1.List, { className: "w-4 h-4" }) })] })] }), (0, jsx_runtime_1.jsx)("div", { className: "flex-1 overflow-auto", children: isLoading ? ((0, jsx_runtime_1.jsx)("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4", children: [...Array(6)].map((_, i) => ((0, jsx_runtime_1.jsxs)(card_1.Card, { className: "animate-pulse", children: [(0, jsx_runtime_1.jsx)(card_1.CardHeader, { children: (0, jsx_runtime_1.jsx)("div", { className: "h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4" }) }), (0, jsx_runtime_1.jsx)(card_1.CardContent, { children: (0, jsx_runtime_1.jsx)("div", { className: "h-3 bg-gray-200 dark:bg-gray-700 rounded w-1/2" }) })] }, i))) })) : filteredDocuments.length === 0 ? ((0, jsx_runtime_1.jsx)(card_1.Card, { children: (0, jsx_runtime_1.jsx)(card_1.CardContent, { className: "flex flex-col items-center justify-center py-12", children: (0, jsx_runtime_1.jsxs)("div", { className: "text-center", children: [(0, jsx_runtime_1.jsx)("h3", { className: "text-lg font-medium mb-2", children: "No documents found" }), (0, jsx_runtime_1.jsx)("p", { className: "text-gray-500 mb-4", children: searchTerm ? 'No documents match your search.' : 'No documents have been uploaded yet.' }), userPermissions.canCreate && !searchTerm && ((0, jsx_runtime_1.jsxs)(button_1.Button, { onClick: handleCreateDocument, children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Plus, { className: "w-4 h-4 mr-2" }), "Add First Document"] }))] }) }) })) : ((0, jsx_runtime_1.jsx)("div", { className: viewMode === 'grid'
                        ? "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"
                        : "space-y-4", children: filteredDocuments.map((document) => ((0, jsx_runtime_1.jsx)(document_management_1.DocumentCard, { title: document.name, documentId: document.id, onViewClick: handleDocumentView, documentType: document.documentType, description: document.description, createdAt: document.createdAt, fileSize: document.fileSize ? Number(document.fileSize) : undefined, mimeType: document.mimeType, uploadedBy: document.uploadedBy?.firstName && document.uploadedBy?.lastName
                            ? `${document.uploadedBy.firstName} ${document.uploadedBy.lastName}`
                            : document.uploadedBy?.email, isVisibleToTenants: document.isVisibleToTenants, compact: viewMode === 'list', showMetadata: true, "data-testid": `document-card-${document.id}` }, document.id))) })) }), filteredDocuments.length > 0 && ((0, jsx_runtime_1.jsxs)("div", { className: "flex justify-between items-center mt-6 pt-4 border-t", children: [(0, jsx_runtime_1.jsxs)("p", { className: "text-sm text-gray-500", children: ["Showing ", filteredDocuments.length, " of ", Array.isArray(documents) ? documents.length : 0, " documents"] }), (0, jsx_runtime_1.jsxs)("div", { className: "flex gap-2", children: [(0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: "outline", children: [Array.isArray(documents) ? documents.filter(d => d.isVisibleToTenants).length : 0, " visible to tenants"] }), (0, jsx_runtime_1.jsxs)(badge_1.Badge, { variant: "outline", children: [Array.isArray(documents) ? documents.filter(d => d.documentType === 'bylaw').length : 0, " bylaws"] })] })] })), (0, jsx_runtime_1.jsx)(document_management_1.DocumentViewModal, { documentId: selectedDocumentId || '', userPermissions: userPermissions, onEditClick: handleDocumentEdit, isOpen: isViewModalOpen, onOpenChange: setIsViewModalOpen }), (0, jsx_runtime_1.jsx)(document_management_1.DocumentEditModal, { documentId: isCreating ? undefined : selectedDocumentId || undefined, entityType: "building", entityId: buildingId, isOpen: isEditModalOpen, onOpenChange: setIsEditModalOpen, onSuccess: handleDocumentSuccess })] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL3BhZ2VzL21hbmFnZXIvTW9kdWxhckJ1aWxkaW5nRG9jdW1lbnRzLnRzeCIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNCQSwyQ0EwUUM7O0FBaFNELCtDQUF3QztBQUN4Qyx1REFBaUU7QUFDakUsbUNBQWdEO0FBQ2hELCtDQUEyRDtBQUMzRCxtREFBZ0Q7QUFDaEQsaURBQThDO0FBQzlDLCtDQUFnRjtBQUVoRixpREFBOEM7QUFDOUMsbURBQStDO0FBQy9DLDBFQUswQztBQUcxQzs7O0dBR0c7QUFDSCxTQUF3Qix3QkFBd0I7SUFDOUMsTUFBTSxDQUFDLEVBQUUsUUFBUSxDQUFDLEdBQUcsSUFBQSxvQkFBVyxHQUFFLENBQUM7SUFDbkMsTUFBTSxNQUFNLEdBQUcsSUFBQSxrQkFBUyxHQUFFLENBQUM7SUFDM0IsTUFBTSxVQUFVLEdBQUksTUFBYyxDQUFDLFVBQVUsQ0FBQztJQUM5QyxNQUFNLFdBQVcsR0FBRyxJQUFBLDRCQUFjLEdBQUUsQ0FBQztJQUVyQyxvQ0FBb0M7SUFDcEMsTUFBTSxDQUFDLGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBQyxLQUFLLENBQUMsQ0FBQztJQUM5RCxNQUFNLENBQUMsZUFBZSxFQUFFLGtCQUFrQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFDLEtBQUssQ0FBQyxDQUFDO0lBQzlELE1BQU0sQ0FBQyxrQkFBa0IsRUFBRSxxQkFBcUIsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBZ0IsSUFBSSxDQUFDLENBQUM7SUFDbEYsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsS0FBSyxDQUFDLENBQUM7SUFDcEQsTUFBTSxDQUFDLFVBQVUsRUFBRSxhQUFhLENBQUMsR0FBRyxJQUFBLGdCQUFRLEVBQUMsRUFBRSxDQUFDLENBQUM7SUFDakQsTUFBTSxDQUFDLFFBQVEsRUFBRSxX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dUNBQWlCLElBQ2hCLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLElBQUksU0FBUyxFQUNwRSxVQUFVLEVBQUMsVUFBVSxFQUNyQixRQUFRLEVBQUUsVUFBVSxFQUNwQixNQUFNLEVBQUUsZUFBZSxFQUN2QixZQUFZLEVBQUUsa0JBQWtCLEVBQ2hDLFNBQVMsRUFBRSxxQkFBcUIsR0FDaEMsSUFDRSxDQUNQLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvY2xpZW50L3NyYy9wYWdlcy9tYW5hZ2VyL01vZHVsYXJCdWlsZGluZ0RvY3VtZW50cy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlUXVlcnksIHVzZVF1ZXJ5Q2xpZW50IH0gZnJvbSAnQHRhbnN0YWNrL3JlYWN0LXF1ZXJ5JztcbmltcG9ydCB7IHVzZVBhcmFtcywgdXNlTG9jYXRpb24gfSBmcm9tICd3b3V0ZXInO1xuaW1wb3J0IHsgR3JpZCwgTGlzdCwgQXJyb3dMZWZ0LCBQbHVzIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9idXR0b24nO1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvaW5wdXQnO1xuaW1wb3J0IHsgQ2FyZCwgQ2FyZENvbnRlbnQsIENhcmRIZWFkZXIsIENhcmRUaXRsZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9jYXJkJztcbmltcG9ydCB7IFRhYnMsIFRhYnNDb250ZW50LCBUYWJzTGlzdCwgVGFic1RyaWdnZXIgfSBmcm9tICdAL2NvbXBvbmVudHMvdWkvdGFicyc7XG5pbXBvcnQgeyBCYWRnZSB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9iYWRnZSc7XG5pbXBvcnQgeyBhcGlSZXF1ZXN0IH0gZnJvbSAnQC9saWIvcXVlcnlDbGllbnQnO1xuaW1wb3J0IHtcbiAgU2hhcmVkVXBsb2FkZXIsXG4gIERvY3VtZW50Q2FyZCxcbiAgRG9jdW1lbnRWaWV3TW9kYWwsXG4gIERvY3VtZW50RWRpdE1vZGFsXG59IGZyb20gJ0AvY29tcG9uZW50cy9kb2N1bWVudC1tYW5hZ2VtZW50JztcbmltcG9ydCB0eXBlIHsgRG9jdW1lbnRXaXRoTWV0YWRhdGEsIERvY3VtZW50UGVybWlzc2lvbnMgfSBmcm9tICdAc2hhcmVkL3NjaGVtYXMvZG9jdW1lbnRzJztcblxuLyoqXG4gKiBNb2R1bGFyQnVpbGRpbmdEb2N1bWVudHMgLSBFeGFtcGxlIGludGVncmF0aW9uIG9mIG5ldyBtb2R1bGFyIGRvY3VtZW50IGNvbXBvbmVudHNcbiAqIERlbW9uc3RyYXRlcyBob3cgdG8gdXNlIHRoZSBuZXcgcmV1c2FibGUgY29tcG9uZW50cyBpbnN0ZWFkIG9mIHRoZSBtb25vbGl0aGljIERvY3VtZW50TWFuYWdlclxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNb2R1bGFyQnVpbGRpbmdEb2N1bWVudHMoKSB7XG4gIGNvbnN0IFssIG5hdmlnYXRlXSA9IHVzZUxvY2F0aW9uKCk7XG4gIGNvbnN0IHBhcmFtcyA9IHVzZVBhcmFtcygpO1xuICBjb25zdCBidWlsZGluZ0lkID0gKHBhcmFtcyBhcyBhbnkpLmJ1aWxkaW5nSWQ7XG4gIGNvbnN0IHF1ZXJ5Q2xpZW50ID0gdXNlUXVlcnlDbGllbnQoKTtcblxuICAvLyBTdGF0ZSBmb3IgbW9kYWxzIGFuZCBpbnRlcmFjdGlvbnNcbiAgY29uc3QgW2lzVmlld01vZGFsT3Blbiwgc2V0SXNWaWV3TW9kYWxPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2lzRWRpdE1vZGFsT3Blbiwgc2V0SXNFZGl0TW9kYWxPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW3NlbGVjdGVkRG9jdW1lbnRJZCwgc2V0U2VsZWN0ZWREb2N1bWVudElkXSA9IHVzZVN0YXRlPHN0cmluZyB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbaXNDcmVhdGluZywgc2V0SXNDcmVhdGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtzZWFyY2hUZXJtLCBzZXRTZWFyY2hUZXJtXSA9IHVzZVN0YXRlKCcnKTtcbiAgY29uc3QgW3ZpZXdNb2RlLCBzZXRWaWV3TW9kZV0gPSB1c2VTdGF0ZTwnZ3JpZCcgfCAnbGlzdCc+KCdncmlkJyk7XG5cbiAgLy8gRmV0Y2ggYnVpbGRpbmcgaW5mb1xuICBjb25zdCB7IGRhdGE6IGJ1aWxkaW5nIH0gPSB1c2VRdWVyeSh7XG4gICAgcXVlcnlLZXk6IFsnL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncycsIGJ1aWxkaW5nSWRdLFxuICAgIGVuYWJsZWQ6ICEhYnVpbGRpbmdJZCxcbiAgfSk7XG5cbiAgLy8gRmV0Y2ggZG9jdW1lbnRzIGZvciB0aGlzIGJ1aWxkaW5nXG4gIGNvbnN0IHsgZGF0YTogZG9jdW1lbnRSZXNwb25zZSwgaXNMb2FkaW5nIH0gPSB1c2VRdWVyeSh7XG4gICAgcXVlcnlLZXk6IFsnL2FwaS9kb2N1bWVudHMnLCAnYnVpbGRpbmcnLCBidWlsZGluZ0lkXSxcbiAgICBxdWVyeUZuOiBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFwaVJlcXVlc3QoJ0dFVCcsIGAvYXBpL2RvY3VtZW50cz9idWlsZGluZ0lkPSR7YnVpbGRpbmdJZH1gKTtcbiAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4gICAgfSxcbiAgICBlbmFibGVkOiAhIWJ1aWxkaW5nSWQsXG4gIH0pO1xuXG4gIC8vIEV4dHJhY3QgZG9jdW1lbnRzIGFycmF5IGZyb20gQVBJIHJlc3BvbnNlXG4gIGNvbnN0IGRvY3VtZW50cyA9IEFycmF5LmlzQXJyYXkoZG9jdW1lbnRSZXNwb25zZT8uZG9jdW1lbnRzKSA/IGRvY3VtZW50UmVzcG9uc2UuZG9jdW1lbnRzIDogW107XG5cbiAgLy8gR2V0IGN1cnJlbnQgdXNlciBmb3IgcGVybWlzc2lvbnNcbiAgY29uc3QgeyBkYXRhOiB1c2VyIH0gPSB1c2VRdWVyeSh7XG4gICAgcXVlcnlLZXk6IFsnL2FwaS9hdXRoL3VzZXInXSxcbiAgICBxdWVyeUZuOiAoKSA9PiBhcGlSZXF1ZXN0KCdHRVQnLCAnL2FwaS9hdXRoL3VzZXInKSxcbiAgfSk7XG5cbiAgLy8gRGV0ZXJtaW5lIHVzZXIgcGVybWlzc2lvbnMgYmFzZWQgb24gcm9sZVxuICBjb25zdCB1c2VyUGVybWlzc2lvbnM6IERvY3VtZW50UGVybWlzc2lvbnMgPSB7XG4gICAgY2FuVmlldzogdHJ1ZSxcbiAgICBjYW5Eb3dubG9hZDogdHJ1ZSxcbiAgICBjYW5FZGl0OiB1c2VyPy5yb2xlID09PSAnbWFuYWdlcicgfHwgdXNlcj8ucm9sZSA9PT0gJ2FkbWluJyxcbiAgICBjYW5EZWxldGU6IHVzZXI/LnJvbGUgPT09ICdtYW5hZ2VyJyB8fCB1c2VyPy5yb2xlID09PSAnYWRtaW4nLFxuICAgIGNhbkNyZWF0ZTogdXNlcj8ucm9sZSA9PT0gJ21hbmFnZXInIHx8IHVzZXI/LnJvbGUgPT09ICdhZG1pbicsXG4gIH07XG5cbiAgLy8gRmlsdGVyIGRvY3VtZW50cyBiYXNlZCBvbiBzZWFyY2hcbiAgY29uc3QgZmlsdGVyZWREb2N1bWVudHMgPSBBcnJheS5pc0FycmF5KGRvY3VtZW50cykgPyBkb2N1bWVudHMuZmlsdGVyKGRvYyA9PlxuICAgIGRvYy5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoVGVybS50b0xvd2VyQ2FzZSgpKSB8fFxuICAgIGRvYy5kZXNjcmlwdGlvbj8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hUZXJtLnRvTG93ZXJDYXNlKCkpXG4gICkgOiBbXTtcblxuXG4gIC8vIEhhbmRsZSBkb2N1bWVudCBpbnRlcmFjdGlvbnNcbiAgY29uc3QgaGFuZGxlRG9jdW1lbnRWaWV3ID0gKGRvY3VtZW50SWQ6IHN0cmluZykgPT4ge1xuICAgIHNldFNlbGVjdGVkRG9jdW1lbnRJZChkb2N1bWVudElkKTtcbiAgICBzZXRJc1ZpZXdNb2RhbE9wZW4odHJ1ZSk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlRG9jdW1lbnRFZGl0ID0gKGRvY3VtZW50SWQ6IHN0cmluZykgPT4ge1xuICAgIHNldFNlbGVjdGVkRG9jdW1lbnRJZChkb2N1bWVudElkKTtcbiAgICBzZXRJc0VkaXRNb2RhbE9wZW4odHJ1ZSk7XG4gICAgc2V0SXNWaWV3TW9kYWxPcGVuKGZhbHNlKTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVDcmVhdGVEb2N1bWVudCA9ICgpID0+IHtcbiAgICBzZXRTZWxlY3RlZERvY3VtZW50SWQobnVsbCk7XG4gICAgc2V0SXNDcmVhdGluZyh0cnVlKTtcbiAgICBzZXRJc0VkaXRNb2RhbE9wZW4odHJ1ZSk7XG4gIH07XG5cbiAgY29uc3QgaGFuZGxlRG9jdW1lbnRTdWNjZXNzID0gKGRvY3VtZW50SWQ6IHN0cmluZywgYWN0aW9uOiAnY3JlYXRlZCcgfCAndXBkYXRlZCcgfCAnZGVsZXRlZCcpID0+IHtcbiAgICBjb25zb2xlLmxvZyhgRG9jdW1lbnQgJHthY3Rpb259OmAsIGRvY3VtZW50SWQpO1xuICAgIHNldElzRWRpdE1vZGFsT3BlbihmYWxzZSk7XG4gICAgc2V0SXNWaWV3TW9kYWxPcGVuKGZhbHNlKTtcbiAgICBzZXRJc0NyZWF0aW5nKGZhbHNlKTtcbiAgICBzZXRTZWxlY3RlZERvY3VtZW50SWQobnVsbCk7XG4gICAgXG4gICAgLy8gUmVmcmVzaCB0aGUgZG9jdW1lbnQgbGlzdCB0byBzaG93IHRoZSBuZXcvdXBkYXRlZCBkb2N1bWVudFxuICAgIHF1ZXJ5Q2xpZW50LmludmFsaWRhdGVRdWVyaWVzKHtcbiAgICAgIHF1ZXJ5S2V5OiBbJy9hcGkvZG9jdW1lbnRzJywgJ2J1aWxkaW5nJywgYnVpbGRpbmdJZF0sXG4gICAgfSk7XG4gICAgXG4gICAgLy8gQWxzbyBpbnZhbGlkYXRlIGdlbmVyYWwgZG9jdW1lbnRzIGNhY2hlXG4gICAgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoe1xuICAgICAgcXVlcnlLZXk6IFsnL2FwaS9kb2N1bWVudHMnXSxcbiAgICB9KTtcbiAgfTtcblxuICBjb25zdCBoYW5kbGVCYWNrID0gKCkgPT4ge1xuICAgIG5hdmlnYXRlKCcvbWFuYWdlci9idWlsZGluZ3MnKTtcbiAgfTtcblxuICBpZiAoIWJ1aWxkaW5nSWQpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTEgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXJcIj5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlclwiPlxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtZ3JheS01MDAgbWItNFwiPkJ1aWxkaW5nIElEIGlzIHJlcXVpcmVkPC9wPlxuICAgICAgICAgIDxCdXR0b24gdmFyaWFudD1cIm91dGxpbmVcIiBvbkNsaWNrPXtoYW5kbGVCYWNrfT5cbiAgICAgICAgICAgIDxBcnJvd0xlZnQgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yXCIgLz5cbiAgICAgICAgICAgIEJhY2sgdG8gQnVpbGRpbmdzXG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTEgZmxleCBmbGV4LWNvbCBvdmVyZmxvdy1oaWRkZW4gcC02XCI+XG4gICAgICB7LyogSGVhZGVyICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIHNwYWNlLXktNCBtYi02XCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuXCI+XG4gICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PVwib3V0bGluZVwiIG9uQ2xpY2s9e2hhbmRsZUJhY2t9PlxuICAgICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9XCJ3LTQgaC00IG1yLTJcIiAvPlxuICAgICAgICAgICAgQmFjayB0byBCdWlsZGluZ3NcbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICBcbiAgICAgICAgICB7dXNlclBlcm1pc3Npb25zLmNhbkNyZWF0ZSAmJiAoXG4gICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2hhbmRsZUNyZWF0ZURvY3VtZW50fSBkYXRhLXRlc3RpZD1cImJ1dHRvbi1jcmVhdGUtZG9jdW1lbnRcIj5cbiAgICAgICAgICAgICAgPFBsdXMgY2xhc3NOYW1lPVwidy00IGgtNCBtci0yXCIgLz5cbiAgICAgICAgICAgICAgQWRkIERvY3VtZW50XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICApfVxuICAgICAgICA8L2Rpdj5cblxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxoMSBjbGFzc05hbWU9XCJ0ZXh0LTJ4bCBmb250LWJvbGRcIj5cbiAgICAgICAgICAgIHtidWlsZGluZz8ubmFtZSB8fCAnQnVpbGRpbmcnfSBEb2N1bWVudHNcbiAgICAgICAgICA8L2gxPlxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cInRleHQtZ3JheS02MDAgZGFyazp0ZXh0LWdyYXktNDAwXCI+XG4gICAgICAgICAgICBNYW5hZ2UgZG9jdW1lbnRzIGZvciB7YnVpbGRpbmc/Lm5hbWUgfHwgJ3RoaXMgYnVpbGRpbmcnfVxuICAgICAgICAgIDwvcD5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIFNlYXJjaCBhbmQgVmlldyBDb250cm9scyAqL31cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBmbGV4LWNvbCBzbTpmbGV4LXJvdyBnYXAtNCBtYi02XCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleC0xXCI+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlNlYXJjaCBkb2N1bWVudHMuLi5cIlxuICAgICAgICAgICAgdmFsdWU9e3NlYXJjaFRlcm19XG4gICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHNldFNlYXJjaFRlcm0oZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJpbnB1dC1zZWFyY2gtZG9jdW1lbnRzXCJcbiAgICAgICAgICAvPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBnYXAtMlwiPlxuICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgIHZhcmlhbnQ9e3ZpZXdNb2RlID09PSAnZ3JpZCcgPyAnZGVmYXVsdCcgOiAnb3V0bGluZSd9XG4gICAgICAgICAgICBzaXplPVwic21cIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0Vmlld01vZGUoJ2dyaWQnKX1cbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLWdyaWQtdmlld1wiXG4gICAgICAgICAgPlxuICAgICAgICAgICAgPEdyaWQgY2xhc3NOYW1lPVwidy00IGgtNFwiIC8+XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgdmFyaWFudD17dmlld01vZGUgPT09ICdsaXN0JyA/ICdkZWZhdWx0JyA6ICdvdXRsaW5lJ31cbiAgICAgICAgICAgIHNpemU9XCJzbVwiXG4gICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRWaWV3TW9kZSgnbGlzdCcpfVxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJidXR0b24tbGlzdC12aWV3XCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICA8TGlzdCBjbGFzc05hbWU9XCJ3LTQgaC00XCIgLz5cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cblxuICAgICAgey8qIERvY3VtZW50cyBEaXNwbGF5ICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4LTEgb3ZlcmZsb3ctYXV0b1wiPlxuICAgICAgICB7aXNMb2FkaW5nID8gKFxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBsZzpncmlkLWNvbHMtMyBnYXAtNFwiPlxuICAgICAgICAgICAge1suLi5BcnJheSg2KV0ubWFwKChfLCBpKSA9PiAoXG4gICAgICAgICAgICAgIDxDYXJkIGtleT17aX0gY2xhc3NOYW1lPVwiYW5pbWF0ZS1wdWxzZVwiPlxuICAgICAgICAgICAgICAgIDxDYXJkSGVhZGVyPlxuICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJoLTQgYmctZ3JheS0yMDAgZGFyazpiZy1ncmF5LTcwMCByb3VuZGVkIHctMy80XCI+PC9kaXY+XG4gICAgICAgICAgICAgICAgPC9DYXJkSGVhZGVyPlxuICAgICAgICAgICAgICAgIDxDYXJkQ29udGVudD5cbiAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiaC0zIGJnLWdyYXktMjAwIGRhcms6YmctZ3JheS03MDAgcm91bmRlZCB3LTEvMlwiPjwvZGl2PlxuICAgICAgICAgICAgICAgIDwvQ2FyZENvbnRlbnQ+XG4gICAgICAgICAgICAgIDwvQ2FyZD5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApIDogZmlsdGVyZWREb2N1bWVudHMubGVuZ3RoID09PSAwID8gKFxuICAgICAgICAgIDxDYXJkPlxuICAgICAgICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT1cImZsZXggZmxleC1jb2wgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHB5LTEyXCI+XG4gICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1jZW50ZXJcIj5cbiAgICAgICAgICAgICAgICA8aDMgY2xhc3NOYW1lPVwidGV4dC1sZyBmb250LW1lZGl1bSBtYi0yXCI+Tm8gZG9jdW1lbnRzIGZvdW5kPC9oMz5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LWdyYXktNTAwIG1iLTRcIj5cbiAgICAgICAgICAgICAgICAgIHtzZWFyY2hUZXJtID8gJ05vIGRvY3VtZW50cyBtYXRjaCB5b3VyIHNlYXJjaC4nIDogJ05vIGRvY3VtZW50cyBoYXZlIGJlZW4gdXBsb2FkZWQgeWV0Lid9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICAgIHt1c2VyUGVybWlzc2lvbnMuY2FuQ3JlYXRlICYmICFzZWFyY2hUZXJtICYmIChcbiAgICAgICAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17aGFuZGxlQ3JlYXRlRG9jdW1lbnR9PlxuICAgICAgICAgICAgICAgICAgICA8UGx1cyBjbGFzc05hbWU9XCJ3LTQgaC00IG1yLTJcIiAvPlxuICAgICAgICAgICAgICAgICAgICBBZGQgRmlyc3QgRG9jdW1lbnRcbiAgICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPC9DYXJkQ29udGVudD5cbiAgICAgICAgICA8L0NhcmQ+XG4gICAgICAgICkgOiAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e3ZpZXdNb2RlID09PSAnZ3JpZCcgXG4gICAgICAgICAgICA/IFwiZ3JpZCBncmlkLWNvbHMtMSBtZDpncmlkLWNvbHMtMiBsZzpncmlkLWNvbHMtMyBnYXAtNFwiXG4gICAgICAgICAgICA6IFwic3BhY2UteS00XCJcbiAgICAgICAgICB9PlxuICAgICAgICAgICAge2ZpbHRlcmVkRG9jdW1lbnRzLm1hcCgoZG9jdW1lbnQpID0+IChcbiAgICAgICAgICAgICAgPERvY3VtZW50Q2FyZFxuICAgICAgICAgICAgICAgIGtleT17ZG9jdW1lbnQuaWR9XG4gICAgICAgICAgICAgICAgdGl0bGU9e2RvY3VtZW50Lm5hbWV9XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRJZD17ZG9jdW1lbnQuaWR9XG4gICAgICAgICAgICAgICAgb25WaWV3Q2xpY2s9e2hhbmRsZURvY3VtZW50Vmlld31cbiAgICAgICAgICAgICAgICBkb2N1bWVudFR5cGU9e2RvY3VtZW50LmRvY3VtZW50VHlwZX1cbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17ZG9jdW1lbnQuZGVzY3JpcHRpb259XG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0PXtkb2N1bWVudC5jcmVhdGVkQXR9XG4gICAgICAgICAgICAgICAgZmlsZVNpemU9e2RvY3VtZW50LmZpbGVTaXplID8gTnVtYmVyKGRvY3VtZW50LmZpbGVTaXplKSA6IHVuZGVmaW5lZH1cbiAgICAgICAgICAgICAgICBtaW1lVHlwZT17ZG9jdW1lbnQubWltZVR5cGV9XG4gICAgICAgICAgICAgICAgdXBsb2FkZWRCeT17ZG9jdW1lbnQudXBsb2FkZWRCeT8uZmlyc3ROYW1lICYmIGRvY3VtZW50LnVwbG9hZGVkQnk/Lmxhc3ROYW1lIFxuICAgICAgICAgICAgICAgICAgPyBgJHtkb2N1bWVudC51cGxvYWRlZEJ5LmZpcnN0TmFtZX0gJHtkb2N1bWVudC51cGxvYWRlZEJ5Lmxhc3ROYW1lfWBcbiAgICAgICAgICAgICAgICAgIDogZG9jdW1lbnQudXBsb2FkZWRCeT8uZW1haWxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaXNWaXNpYmxlVG9UZW5hbnRzPXtkb2N1bWVudC5pc1Zpc2libGVUb1RlbmFudHN9XG4gICAgICAgICAgICAgICAgY29tcGFjdD17dmlld01vZGUgPT09ICdsaXN0J31cbiAgICAgICAgICAgICAgICBzaG93TWV0YWRhdGE9e3RydWV9XG4gICAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e2Bkb2N1bWVudC1jYXJkLSR7ZG9jdW1lbnQuaWR9YH1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICApfVxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBTdGF0aXN0aWNzICovfVxuICAgICAge2ZpbHRlcmVkRG9jdW1lbnRzLmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgganVzdGlmeS1iZXR3ZWVuIGl0ZW1zLWNlbnRlciBtdC02IHB0LTQgYm9yZGVyLXRcIj5cbiAgICAgICAgICA8cCBjbGFzc05hbWU9XCJ0ZXh0LXNtIHRleHQtZ3JheS01MDBcIj5cbiAgICAgICAgICAgIFNob3dpbmcge2ZpbHRlcmVkRG9jdW1lbnRzLmxlbmd0aH0gb2Yge0FycmF5LmlzQXJyYXkoZG9jdW1lbnRzKSA/IGRvY3VtZW50cy5sZW5ndGggOiAwfSBkb2N1bWVudHNcbiAgICAgICAgICA8L3A+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGdhcC0yXCI+XG4gICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD1cIm91dGxpbmVcIj5cbiAgICAgICAgICAgICAge0FycmF5LmlzQXJyYXkoZG9jdW1lbnRzKSA/IGRvY3VtZW50cy5maWx0ZXIoZCA9PiBkLmlzVmlzaWJsZVRvVGVuYW50cykubGVuZ3RoIDogMH0gdmlzaWJsZSB0byB0ZW5hbnRzXG4gICAgICAgICAgICA8L0JhZGdlPlxuICAgICAgICAgICAgPEJhZGdlIHZhcmlhbnQ9XCJvdXRsaW5lXCI+XG4gICAgICAgICAgICAgIHtBcnJheS5pc0FycmF5KGRvY3VtZW50cykgPyBkb2N1bWVudHMuZmlsdGVyKGQgPT4gZC5kb2N1bWVudFR5cGUgPT09ICdieWxhdycpLmxlbmd0aCA6IDB9IGJ5bGF3c1xuICAgICAgICAgICAgPC9CYWRnZT5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuXG4gICAgICB7LyogTW9kYWxzICovfVxuICAgICAgPERvY3VtZW50Vmlld01vZGFsXG4gICAgICAgIGRvY3VtZW50SWQ9e3NlbGVjdGVkRG9jdW1lbnRJZCB8fCAnJ31cbiAgICAgICAgdXNlclBlcm1pc3Npb25zPXt1c2VyUGVybWlzc2lvbnN9XG4gICAgICAgIG9uRWRpdENsaWNrPXtoYW5kbGVEb2N1bWVudEVkaXR9XG4gICAgICAgIGlzT3Blbj17aXNWaWV3TW9kYWxPcGVufVxuICAgICAgICBvbk9wZW5DaGFuZ2U9e3NldElzVmlld01vZGFsT3Blbn1cbiAgICAgIC8+XG5cbiAgICAgIDxEb2N1bWVudEVkaXRNb2RhbFxuICAgICAgICBkb2N1bWVudElkPXtpc0NyZWF0aW5nID8gdW5kZWZpbmVkIDogc2VsZWN0ZWREb2N1bWVudElkIHx8IHVuZGVmaW5lZH1cbiAgICAgICAgZW50aXR5VHlwZT1cImJ1aWxkaW5nXCJcbiAgICAgICAgZW50aXR5SWQ9e2J1aWxkaW5nSWR9XG4gICAgICAgIGlzT3Blbj17aXNFZGl0TW9kYWxPcGVufVxuICAgICAgICBvbk9wZW5DaGFuZ2U9e3NldElzRWRpdE1vZGFsT3Blbn1cbiAgICAgICAgb25TdWNjZXNzPXtoYW5kbGVEb2N1bWVudFN1Y2Nlc3N9XG4gICAgICAvPlxuICAgIDwvZGl2PlxuICApO1xufSJdLCJ2ZXJzaW9uIjozfQ==