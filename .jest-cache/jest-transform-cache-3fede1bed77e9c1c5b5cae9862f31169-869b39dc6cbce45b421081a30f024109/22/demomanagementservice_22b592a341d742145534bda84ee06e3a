037596a1591449578f5df34af3e35fa7
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
exports.DemoManagementService = void 0;
/**
 * Demo Management Service.
 *
 * Provides backend services for managing demo organizations in production.
 * This service ensures demo data is always available and properly synchronized.
 */
class DemoManagementService {
    /**
     * Check if demo organizations are healthy and properly configured.
     */
    static async checkDemoHealth() {
        return {
            healthy: true,
            status: { message: 'Demo sync functionality removed' },
            message: 'Demo organizations managed locally only',
            timestamp: new Date().toISOString(),
        };
    }
    /**
     * Ensure demo organizations exist and are properly configured.
     * This is a safe operation that can be called during application startup.
     * DISABLED: Demo organization creation has been disabled per user request.
     */
    static async ensureDemoOrganizations() {
        // Demo organizations functionality disabled per user request - no database operations
        console.log('‚úÖ Demo organizations functionality disabled (skipped)');
        return {
            success: true,
            message: 'Demo organizations functionality disabled - skipping all database operations',
        };
    }
    /**
     * Force recreation of demo organizations.
     * DISABLED: Demo organization functionality has been disabled per user request.
     */
    static async recreateDemoOrganizations() {
        console.log('‚úÖ Demo organizations recreation skipped (disabled)');
        return {
            success: true,
            message: 'Demo organizations functionality disabled - recreation skipped',
        };
    }
    /**
     * Get demo organization information.
     * DISABLED: Demo organization functionality has been disabled per user request.
     */
    static async getDemoOrganizationInfo() {
        console.log('‚úÖ Demo organizations info retrieval skipped (disabled)');
        return {
            stats: {
                demoBuildings: 0,
                demoUsers: 0,
                openDemoBuildings: 0,
                openDemoUsers: 0,
            },
        };
    }
    /**
     * Initialize demo organizations during application startup.
     * DISABLED: Demo organization functionality has been disabled per user request.
     */
    static async initializeDemoOrganizations() {
        console.log('‚úÖ Demo organizations initialization skipped (disabled)');
        // Demo organizations functionality disabled per user request
        return;
    }
    /**
     * PRODUCTION FIX: Create basic demo organizations if they don't exist.
     * This ensures the database has the required organizations for production.
     */
    static async createBasicOrganizationsIfMissing() {
        try {
            const { Pool } = await Promise.resolve().then(() => __importStar(require('@neondatabase/serverless')));
            const { drizzle } = await Promise.resolve().then(() => __importStar(require('drizzle-orm/neon-serverless')));
            const { eq } = await Promise.resolve().then(() => __importStar(require('drizzle-orm')));
            const schema = await Promise.resolve().then(() => __importStar(require('../../shared/schema')));
            // Use shared database connection to avoid multiple pools
            const { db } = await Promise.resolve().then(() => __importStar(require('../db')));
            // Check if Demo organization exists
            const existingDemo = await db
                .select()
                .from(schema.organizations)
                .where(eq(schema.organizations.name, 'Demo'))
                .limit(1);
            if (existingDemo.length === 0) {
                console.log('üìù Creating Demo organization...');
                await db.insert(schema.organizations).values({
                    name: 'Demo',
                    type: 'demo',
                    address: '123 Demo Street',
                    city: 'Montreal',
                    province: 'QC',
                    postalCode: 'H1A 1A1',
                    isActive: true,
                });
            }
            // Check if Open Demo organization exists
            const existingOpenDemo = await db
                .select()
                .from(schema.organizations)
                .where(eq(schema.organizations.name, 'Open Demo'))
                .limit(1);
            if (existingOpenDemo.length === 0) {
                console.log('üìù Creating Open Demo organization...');
                await db.insert(schema.organizations).values({
                    name: 'Open Demo',
                    type: 'demo',
                    address: '456 Demo Avenue',
                    city: 'Montreal',
                    province: 'QC',
                    postalCode: 'H1B 1B1',
                    isActive: true,
                });
            }
            console.log('‚úÖ Demo organizations are properly configured');
        }
        catch (error) {
            // Continue anyway - this is not critical for production functionality
            console.log('‚ö†Ô∏è Demo organizations setup failed, but continuing...');
        }
    }
    /**
     * Scheduled maintenance for demo organizations.
     * This can be called periodically to ensure demo data stays fresh.
     */
    static async scheduledMaintenance() {
        const actions = [];
        try {
            console.log('üîß Running scheduled demo maintenance...');
            // Check current health
            const health = await this.checkDemoHealth();
            actions.push(`Health check: ${health.healthy ? 'HEALTHY' : 'UNHEALTHY'}`);
            if (!health.healthy) {
                // Note: Demo sync to production has been removed
                actions.push('Demo sync functionality removed - local management only');
                // Re-check health
                const newHealth = await this.checkDemoHealth();
                actions.push(`Post-sync health: ${newHealth.healthy ? 'HEALTHY' : 'STILL_UNHEALTHY'}`);
            }
            console.log('‚úÖ Scheduled demo maintenance completed');
            return {
                success: true,
                message: 'Scheduled maintenance completed successfully',
                actions,
            };
        }
        catch (error) {
            return {
                success: false,
                message: `Scheduled maintenance failed: ${error instanceof Error ? error.message : 'Unknown error'}`,
                actions,
            };
        }
    }
}
exports.DemoManagementService = DemoManagementService;
DemoManagementService.DEMO_ORG_NAME = 'Demo';
DemoManagementService.OPEN_DEMO_ORG_NAME = 'Open Demo';
exports.default = DemoManagementService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvc2VydmljZXMvZGVtby1tYW5hZ2VtZW50LXNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBS0E7Ozs7O0dBS0c7QUFDSCxNQUFhLHFCQUFxQjtJQUloQzs7T0FFRztJQUNJLE1BQU0sQ0FBQyxLQUFLLENBQUMsZUFBZTtRQU1qQyxPQUFPO1lBQ0wsT0FBTyxFQUFFLElBQUk7WUFDYixNQUFNLEVBQUUsRUFBRSxPQUFPLEVBQUUsaUNBQWlDLEVBQUU7WUFDdEQsT0FBTyxFQUFFLHlDQUF5QztZQUNsRCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7U0FDcEMsQ0FBQztJQUNKLENBQUM7SUFFRDs7OztPQUlHO0lBQ0ksTUFBTSxDQUFDLEtBQUssQ0FBQyx1QkFBdUI7UUFNekMsc0ZBQXNGO1FBQ3RGLE9BQU8sQ0FBQyxHQUFHLENBQUMsdURBQXVELENBQUMsQ0FBQztRQUVyRSxPQUFPO1lBQ0wsT0FBTyxFQUFFLElBQUk7WUFDYixPQUFPLEVBQUUsOEVBQThFO1NBQ3hGLENBQUM7SUFDSixDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLEtBQUssQ0FBQyx5QkFBeUI7UUFNM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvREFBb0QsQ0FBQyxDQUFDO1FBRWxFLE9BQU87WUFDTCxPQUFPLEVBQUUsSUFBSTtZQUNiLE9BQU8sRUFBRSxnRUFBZ0U7U0FDMUUsQ0FBQztJQUNKLENBQUM7SUFFRDs7O09BR0c7SUFDSSxNQUFNLENBQUMsS0FBSyxDQUFDLHVCQUF1QjtRQVV6QyxPQUFPLENBQUMsR0FBRyxDQUFDLHdEQUF3RCxDQUFDLENBQUM7UUFFdEUsT0FBTztZQUNMLEtBQUssRUFBRTtnQkFDTCxhQUFhLEVBQUUsQ0FBQztnQkFDaEIsU0FBUyxFQUFFLENBQUM7Z0JBQ1osaUJBQWlCLEVBQUUsQ0FBQztnQkFDcEIsYUFBYSxFQUFFLENBQUM7YUFDakI7U0FDRixDQUFDO0lBQ0osQ0FBQztJQUVEOzs7T0FHRztJQUNJLE1BQU0sQ0FBQyxLQUFLLENBQUMsMkJBQTJCO1FBQzdDLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0RBQXdELENBQUMsQ0FBQztRQUN0RSw2REFBNkQ7UUFDN0QsT0FBTztJQUNULENBQUM7SUFFRDs7O09BR0c7SUFDSyxNQUFNLENBQUMsS0FBSyxDQUFDLGlDQUFpQztRQUNwRCxJQUFJLENBQUM7WUFDSCxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsd0RBQWEsMEJBQTBCLEdBQUMsQ0FBQztZQUMxRCxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsd0RBQWEsNkJBQTZCLEdBQUMsQ0FBQztZQUNoRSxNQUFNLEVBQUUsRUFBRSxFQUFFLEdBQUcsd0RBQWEsYUFBYSxHQUFDLENBQUM7WUFDM0MsTUFBTSxNQUFNLEdBQUcsd0RBQWEscUJBQXFCLEdBQUMsQ0FBQztZQUVuRCx5REFBeUQ7WUFDekQsTUFBTSxFQUFFLEVBQUUsRUFBRSxHQUFHLHdEQUFhLE9BQU8sR0FBQyxDQUFDO1lBRXJDLG9DQUFvQztZQUNwQyxNQUFNLFlBQVksR0FBRyxNQUFNLEVBQUU7aUJBQzFCLE1BQU0sRUFBRTtpQkFDUixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztpQkFDMUIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxNQUFNLENBQUMsQ0FBQztpQkFDNUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxZQUFZLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLGtDQUFrQyxDQUFDLENBQUM7Z0JBQ2hELE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsTUFBTSxDQUFDO29CQUMzQyxJQUFJLEVBQUUsTUFBTTtvQkFDWixJQUFJLEVBQUUsTUFBTTtvQkFDWixPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixJQUFJLEVBQUUsVUFBVTtvQkFDaEIsUUFBUSxFQUFFLElBQUk7b0JBQ2QsVUFBVSxFQUFFLFNBQVM7b0JBQ3JCLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCx5Q0FBeUM7WUFDekMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLEVBQUU7aUJBQzlCLE1BQU0sRUFBRTtpQkFDUixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQztpQkFDMUIsS0FBSyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxXQUFXLENBQUMsQ0FBQztpQkFDakQsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLENBQUMsQ0FBQztnQkFDckQsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsQ0FBQyxNQUFNLENBQUM7b0JBQzNDLElBQUksRUFBRSxXQUFXO29CQUNqQixJQUFJLEVBQUUsTUFBTTtvQkFDWixPQUFPLEVBQUUsaUJBQWlCO29CQUMxQixJQUFJLEVBQUUsVUFBVTtvQkFDaEIsUUFBUSxFQUFFLElBQUk7b0JBQ2QsVUFBVSxFQUFFLFNBQVM7b0JBQ3JCLFFBQVEsRUFBRSxJQUFJO2lCQUNmLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLDhDQUE4QyxDQUFDLENBQUM7UUFDOUQsQ0FBQztRQUFDLE9BQU8sS0FBSyxFQUFFLENBQUM7WUFDZixzRUFBc0U7WUFDdEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO1FBQ3ZFLENBQUM7SUFDSCxDQUFDO0lBRUQ7OztPQUdHO0lBQ0ksTUFBTSxDQUFDLEtBQUssQ0FBQyxvQkFBb0I7UUFLdEMsTUFBTSxPQUFPLEdBQWEsRUFBRSxDQUFDO1FBRTdCLElBQUksQ0FBQztZQUNILE9BQU8sQ0FBQyxHQUFHLENBQUMsMENBQTBDLENBQUMsQ0FBQztZQUV4RCx1QkFBdUI7WUFDdkIsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7WUFDNUMsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBRTFFLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7Z0JBQ3BCLGlEQUFpRDtnQkFDakQsT0FBTyxDQUFDLElBQUksQ0FBQyx5REFBeUQsQ0FBQyxDQUFDO2dCQUV4RSxrQkFBa0I7Z0JBQ2xCLE1BQU0sU0FBUyxHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO2dCQUMvQyxPQUFPLENBQUMsSUFBSSxDQUFDLHFCQUFxQixTQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLGlCQUFpQixFQUFFLENBQUMsQ0FBQztZQUN6RixDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1lBRXRELE9BQU87Z0JBQ0wsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsT0FBTyxFQUFFLDhDQUE4QztnQkFDdkQsT0FBTzthQUNSLENBQUM7UUFDSixDQUFDO1FBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztZQUNmLE9BQU87Z0JBQ0wsT0FBTyxFQUFFLEtBQUs7Z0JBQ2QsT0FBTyxFQUFFLGlDQUFpQyxLQUFLLFlBQVksS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxlQUFlLEVBQUU7Z0JBQ3BHLE9BQU87YUFDUixDQUFDO1FBQ0osQ0FBQztJQUNILENBQUM7O0FBck1ILHNEQXNNQztBQXJNeUIsbUNBQWEsR0FBRyxNQUFNLENBQUM7QUFDdkIsd0NBQWtCLEdBQUcsV0FBVyxDQUFDO0FBc00zRCxrQkFBZSxxQkFBcUIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9zZXJ2aWNlcy9kZW1vLW1hbmFnZW1lbnQtc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQb29sIH0gZnJvbSAnQG5lb25kYXRhYmFzZS9zZXJ2ZXJsZXNzJztcbmltcG9ydCB7IGRyaXp6bGUgfSBmcm9tICdkcml6emxlLW9ybS9uZW9uLXNlcnZlcmxlc3MnO1xuaW1wb3J0ICogYXMgc2NoZW1hIGZyb20gJy4uLy4uL3NoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgZXEgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8qKlxuICogRGVtbyBNYW5hZ2VtZW50IFNlcnZpY2UuXG4gKlxuICogUHJvdmlkZXMgYmFja2VuZCBzZXJ2aWNlcyBmb3IgbWFuYWdpbmcgZGVtbyBvcmdhbml6YXRpb25zIGluIHByb2R1Y3Rpb24uXG4gKiBUaGlzIHNlcnZpY2UgZW5zdXJlcyBkZW1vIGRhdGEgaXMgYWx3YXlzIGF2YWlsYWJsZSBhbmQgcHJvcGVybHkgc3luY2hyb25pemVkLlxuICovXG5leHBvcnQgY2xhc3MgRGVtb01hbmFnZW1lbnRTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgREVNT19PUkdfTkFNRSA9ICdEZW1vJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgT1BFTl9ERU1PX09SR19OQU1FID0gJ09wZW4gRGVtbyc7XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIGRlbW8gb3JnYW5pemF0aW9ucyBhcmUgaGVhbHRoeSBhbmQgcHJvcGVybHkgY29uZmlndXJlZC5cbiAgICovXG4gIHB1YmxpYyBzdGF0aWMgYXN5bmMgY2hlY2tEZW1vSGVhbHRoKCk6IFByb21pc2U8e1xuICAgIGhlYWx0aHk6IGJvb2xlYW47XG4gICAgc3RhdHVzOiBhbnk7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogc3RyaW5nO1xuICB9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGhlYWx0aHk6IHRydWUsXG4gICAgICBzdGF0dXM6IHsgbWVzc2FnZTogJ0RlbW8gc3luYyBmdW5jdGlvbmFsaXR5IHJlbW92ZWQnIH0sXG4gICAgICBtZXNzYWdlOiAnRGVtbyBvcmdhbml6YXRpb25zIG1hbmFnZWQgbG9jYWxseSBvbmx5JyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRW5zdXJlIGRlbW8gb3JnYW5pemF0aW9ucyBleGlzdCBhbmQgYXJlIHByb3Blcmx5IGNvbmZpZ3VyZWQuXG4gICAqIFRoaXMgaXMgYSBzYWZlIG9wZXJhdGlvbiB0aGF0IGNhbiBiZSBjYWxsZWQgZHVyaW5nIGFwcGxpY2F0aW9uIHN0YXJ0dXAuXG4gICAqIERJU0FCTEVEOiBEZW1vIG9yZ2FuaXphdGlvbiBjcmVhdGlvbiBoYXMgYmVlbiBkaXNhYmxlZCBwZXIgdXNlciByZXF1ZXN0LlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyBlbnN1cmVEZW1vT3JnYW5pemF0aW9ucygpOiBQcm9taXNlPHtcbiAgICBzdWNjZXNzOiBib29sZWFuO1xuICAgIG1lc3NhZ2U6IHN0cmluZztcbiAgICBkZW1vT3JnSWQ/OiBzdHJpbmc7XG4gICAgb3BlbkRlbW9PcmdJZD86IHN0cmluZztcbiAgfT4ge1xuICAgIC8vIERlbW8gb3JnYW5pemF0aW9ucyBmdW5jdGlvbmFsaXR5IGRpc2FibGVkIHBlciB1c2VyIHJlcXVlc3QgLSBubyBkYXRhYmFzZSBvcGVyYXRpb25zXG4gICAgY29uc29sZS5sb2coJ+KchSBEZW1vIG9yZ2FuaXphdGlvbnMgZnVuY3Rpb25hbGl0eSBkaXNhYmxlZCAoc2tpcHBlZCknKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ0RlbW8gb3JnYW5pemF0aW9ucyBmdW5jdGlvbmFsaXR5IGRpc2FibGVkIC0gc2tpcHBpbmcgYWxsIGRhdGFiYXNlIG9wZXJhdGlvbnMnLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRm9yY2UgcmVjcmVhdGlvbiBvZiBkZW1vIG9yZ2FuaXphdGlvbnMuXG4gICAqIERJU0FCTEVEOiBEZW1vIG9yZ2FuaXphdGlvbiBmdW5jdGlvbmFsaXR5IGhhcyBiZWVuIGRpc2FibGVkIHBlciB1c2VyIHJlcXVlc3QuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIHJlY3JlYXRlRGVtb09yZ2FuaXphdGlvbnMoKTogUHJvbWlzZTx7XG4gICAgc3VjY2VzczogYm9vbGVhbjtcbiAgICBtZXNzYWdlOiBzdHJpbmc7XG4gICAgZGVtb09yZ0lkPzogc3RyaW5nO1xuICAgIG9wZW5EZW1vT3JnSWQ/OiBzdHJpbmc7XG4gIH0+IHtcbiAgICBjb25zb2xlLmxvZygn4pyFIERlbW8gb3JnYW5pemF0aW9ucyByZWNyZWF0aW9uIHNraXBwZWQgKGRpc2FibGVkKScpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBtZXNzYWdlOiAnRGVtbyBvcmdhbml6YXRpb25zIGZ1bmN0aW9uYWxpdHkgZGlzYWJsZWQgLSByZWNyZWF0aW9uIHNraXBwZWQnLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IGRlbW8gb3JnYW5pemF0aW9uIGluZm9ybWF0aW9uLlxuICAgKiBESVNBQkxFRDogRGVtbyBvcmdhbml6YXRpb24gZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiBkaXNhYmxlZCBwZXIgdXNlciByZXF1ZXN0LlxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBhc3luYyBnZXREZW1vT3JnYW5pemF0aW9uSW5mbygpOiBQcm9taXNlPHtcbiAgICBkZW1vPzogYW55O1xuICAgIG9wZW5EZW1vPzogYW55O1xuICAgIHN0YXRzOiB7XG4gICAgICBkZW1vQnVpbGRpbmdzOiBudW1iZXI7XG4gICAgICBkZW1vVXNlcnM6IG51bWJlcjtcbiAgICAgIG9wZW5EZW1vQnVpbGRpbmdzOiBudW1iZXI7XG4gICAgICBvcGVuRGVtb1VzZXJzOiBudW1iZXI7XG4gICAgfTtcbiAgfT4ge1xuICAgIGNvbnNvbGUubG9nKCfinIUgRGVtbyBvcmdhbml6YXRpb25zIGluZm8gcmV0cmlldmFsIHNraXBwZWQgKGRpc2FibGVkKScpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXRzOiB7XG4gICAgICAgIGRlbW9CdWlsZGluZ3M6IDAsXG4gICAgICAgIGRlbW9Vc2VyczogMCxcbiAgICAgICAgb3BlbkRlbW9CdWlsZGluZ3M6IDAsXG4gICAgICAgIG9wZW5EZW1vVXNlcnM6IDAsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZSBkZW1vIG9yZ2FuaXphdGlvbnMgZHVyaW5nIGFwcGxpY2F0aW9uIHN0YXJ0dXAuXG4gICAqIERJU0FCTEVEOiBEZW1vIG9yZ2FuaXphdGlvbiBmdW5jdGlvbmFsaXR5IGhhcyBiZWVuIGRpc2FibGVkIHBlciB1c2VyIHJlcXVlc3QuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIGluaXRpYWxpemVEZW1vT3JnYW5pemF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn4pyFIERlbW8gb3JnYW5pemF0aW9ucyBpbml0aWFsaXphdGlvbiBza2lwcGVkIChkaXNhYmxlZCknKTtcbiAgICAvLyBEZW1vIG9yZ2FuaXphdGlvbnMgZnVuY3Rpb25hbGl0eSBkaXNhYmxlZCBwZXIgdXNlciByZXF1ZXN0XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIFBST0RVQ1RJT04gRklYOiBDcmVhdGUgYmFzaWMgZGVtbyBvcmdhbml6YXRpb25zIGlmIHRoZXkgZG9uJ3QgZXhpc3QuXG4gICAqIFRoaXMgZW5zdXJlcyB0aGUgZGF0YWJhc2UgaGFzIHRoZSByZXF1aXJlZCBvcmdhbml6YXRpb25zIGZvciBwcm9kdWN0aW9uLlxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgY3JlYXRlQmFzaWNPcmdhbml6YXRpb25zSWZNaXNzaW5nKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IFBvb2wgfSA9IGF3YWl0IGltcG9ydCgnQG5lb25kYXRhYmFzZS9zZXJ2ZXJsZXNzJyk7XG4gICAgICBjb25zdCB7IGRyaXp6bGUgfSA9IGF3YWl0IGltcG9ydCgnZHJpenpsZS1vcm0vbmVvbi1zZXJ2ZXJsZXNzJyk7XG4gICAgICBjb25zdCB7IGVxIH0gPSBhd2FpdCBpbXBvcnQoJ2RyaXp6bGUtb3JtJyk7XG4gICAgICBjb25zdCBzY2hlbWEgPSBhd2FpdCBpbXBvcnQoJy4uLy4uL3NoYXJlZC9zY2hlbWEnKTtcblxuICAgICAgLy8gVXNlIHNoYXJlZCBkYXRhYmFzZSBjb25uZWN0aW9uIHRvIGF2b2lkIG11bHRpcGxlIHBvb2xzXG4gICAgICBjb25zdCB7IGRiIH0gPSBhd2FpdCBpbXBvcnQoJy4uL2RiJyk7XG5cbiAgICAgIC8vIENoZWNrIGlmIERlbW8gb3JnYW5pemF0aW9uIGV4aXN0c1xuICAgICAgY29uc3QgZXhpc3RpbmdEZW1vID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSwgJ0RlbW8nKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoZXhpc3RpbmdEZW1vLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZygn8J+TnSBDcmVhdGluZyBEZW1vIG9yZ2FuaXphdGlvbi4uLicpO1xuICAgICAgICBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLm9yZ2FuaXphdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgICAgbmFtZTogJ0RlbW8nLFxuICAgICAgICAgIHR5cGU6ICdkZW1vJyxcbiAgICAgICAgICBhZGRyZXNzOiAnMTIzIERlbW8gU3RyZWV0JyxcbiAgICAgICAgICBjaXR5OiAnTW9udHJlYWwnLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIMUEgMUExJyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIE9wZW4gRGVtbyBvcmdhbml6YXRpb24gZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ09wZW5EZW1vID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSwgJ09wZW4gRGVtbycpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChleGlzdGluZ09wZW5EZW1vLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLmxvZygn8J+TnSBDcmVhdGluZyBPcGVuIERlbW8gb3JnYW5pemF0aW9uLi4uJyk7XG4gICAgICAgIGF3YWl0IGRiLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucykudmFsdWVzKHtcbiAgICAgICAgICBuYW1lOiAnT3BlbiBEZW1vJyxcbiAgICAgICAgICB0eXBlOiAnZGVtbycsXG4gICAgICAgICAgYWRkcmVzczogJzQ1NiBEZW1vIEF2ZW51ZScsXG4gICAgICAgICAgY2l0eTogJ01vbnRyZWFsJyxcbiAgICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiAnSDFCIDFCMScsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygn4pyFIERlbW8gb3JnYW5pemF0aW9ucyBhcmUgcHJvcGVybHkgY29uZmlndXJlZCcpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBDb250aW51ZSBhbnl3YXkgLSB0aGlzIGlzIG5vdCBjcml0aWNhbCBmb3IgcHJvZHVjdGlvbiBmdW5jdGlvbmFsaXR5XG4gICAgICBjb25zb2xlLmxvZygn4pqg77iPIERlbW8gb3JnYW5pemF0aW9ucyBzZXR1cCBmYWlsZWQsIGJ1dCBjb250aW51aW5nLi4uJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjaGVkdWxlZCBtYWludGVuYW5jZSBmb3IgZGVtbyBvcmdhbml6YXRpb25zLlxuICAgKiBUaGlzIGNhbiBiZSBjYWxsZWQgcGVyaW9kaWNhbGx5IHRvIGVuc3VyZSBkZW1vIGRhdGEgc3RheXMgZnJlc2guXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGFzeW5jIHNjaGVkdWxlZE1haW50ZW5hbmNlKCk6IFByb21pc2U8e1xuICAgIHN1Y2Nlc3M6IGJvb2xlYW47XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIGFjdGlvbnM6IHN0cmluZ1tdO1xuICB9PiB7XG4gICAgY29uc3QgYWN0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBSdW5uaW5nIHNjaGVkdWxlZCBkZW1vIG1haW50ZW5hbmNlLi4uJyk7XG5cbiAgICAgIC8vIENoZWNrIGN1cnJlbnQgaGVhbHRoXG4gICAgICBjb25zdCBoZWFsdGggPSBhd2FpdCB0aGlzLmNoZWNrRGVtb0hlYWx0aCgpO1xuICAgICAgYWN0aW9ucy5wdXNoKGBIZWFsdGggY2hlY2s6ICR7aGVhbHRoLmhlYWx0aHkgPyAnSEVBTFRIWScgOiAnVU5IRUFMVEhZJ31gKTtcblxuICAgICAgaWYgKCFoZWFsdGguaGVhbHRoeSkge1xuICAgICAgICAvLyBOb3RlOiBEZW1vIHN5bmMgdG8gcHJvZHVjdGlvbiBoYXMgYmVlbiByZW1vdmVkXG4gICAgICAgIGFjdGlvbnMucHVzaCgnRGVtbyBzeW5jIGZ1bmN0aW9uYWxpdHkgcmVtb3ZlZCAtIGxvY2FsIG1hbmFnZW1lbnQgb25seScpO1xuXG4gICAgICAgIC8vIFJlLWNoZWNrIGhlYWx0aFxuICAgICAgICBjb25zdCBuZXdIZWFsdGggPSBhd2FpdCB0aGlzLmNoZWNrRGVtb0hlYWx0aCgpO1xuICAgICAgICBhY3Rpb25zLnB1c2goYFBvc3Qtc3luYyBoZWFsdGg6ICR7bmV3SGVhbHRoLmhlYWx0aHkgPyAnSEVBTFRIWScgOiAnU1RJTExfVU5IRUFMVEhZJ31gKTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBTY2hlZHVsZWQgZGVtbyBtYWludGVuYW5jZSBjb21wbGV0ZWQnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1NjaGVkdWxlZCBtYWludGVuYW5jZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgYWN0aW9ucyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBgU2NoZWR1bGVkIG1haW50ZW5hbmNlIGZhaWxlZDogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICBhY3Rpb25zLFxuICAgICAgfTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgRGVtb01hbmFnZW1lbnRTZXJ2aWNlO1xuIl0sInZlcnNpb24iOjN9