4e1cc6b14b5e262176e8294b161b272e
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jsx_runtime_1 = require("react/jsx-runtime");
jest.mock('../../../client/src/lib/queryClient', () => ({
    apiRequest: mockApiRequest,
    queryClient: new (jest.requireActual('@tanstack/react-query').QueryClient)(),
}));
jest.mock('../../../client/src/hooks/use-auth', () => ({
    useAuth: () => ({
        user: null,
        isAuthenticated: false,
        login: mockLogin,
        logout: mockLogout,
    }),
}));
/**
 * Authentication Button Functionality Tests
 * Tests all authentication-related buttons (login, logout, password toggle, etc.)
 */
const react_1 = require("@testing-library/react");
const react_query_1 = require("@tanstack/react-query");
require("@testing-library/jest-dom");
const user_event_1 = __importDefault(require("@testing-library/user-event"));
const react_2 = __importDefault(require("react"));
// Mock API requests
const mockApiRequest = jest.fn();
// Mock authentication context
const mockLogin = jest.fn();
const mockLogout = jest.fn();
describe('Authentication Buttons Functionality', () => {
    let queryClient;
    let user;
    beforeEach(() => {
        queryClient = new react_query_1.QueryClient({
            defaultOptions: {
                queries: { retry: false },
                mutations: { retry: false },
            },
        });
        user = user_event_1.default.setup();
        jest.clearAllMocks();
        mockApiRequest.mockResolvedValue({ ok: true, json: () => Promise.resolve({}) });
    });
    const renderWithProvider = (component) => {
        return (0, react_1.render)((0, jsx_runtime_1.jsx)(react_query_1.QueryClientProvider, { client: queryClient, children: component }));
    };
    describe('Password Toggle Buttons', () => {
        const passwordToggleTestIds = [
            'button-toggle-password',
            'button-toggle-confirm-password',
        ];
        passwordToggleTestIds.forEach(testId => {
            it(`should toggle password visibility for ${testId}`, async () => {
                const MockPasswordField = () => {
                    const [showPassword, setShowPassword] = react_2.default.useState(false);
                    return ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("input", { type: showPassword ? 'text' : 'password', "data-testid": "password-input", defaultValue: "testpassword" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": testId, onClick: () => setShowPassword(!showPassword), children: showPassword ? 'Hide' : 'Show' })] }));
                };
                renderWithProvider((0, jsx_runtime_1.jsx)(MockPasswordField, {}));
                const passwordInput = react_1.screen.getByTestId('password-input');
                const toggleButton = react_1.screen.getByTestId(testId);
                expect(passwordInput.type).toBe('password');
                expect(toggleButton).toBeInTheDocument();
                await user.click(toggleButton);
                await (0, react_1.waitFor)(() => {
                    expect(passwordInput.type).toBe('text');
                });
                await user.click(toggleButton);
                await (0, react_1.waitFor)(() => {
                    expect(passwordInput.type).toBe('password');
                });
            });
        });
    });
    describe('Language Toggle Buttons', () => {
        it('should switch to English when EN button is clicked', async () => {
            const mockSetLanguage = jest.fn();
            const MockLanguageSwitcher = () => ((0, jsx_runtime_1.jsxs)("div", { children: [(0, jsx_runtime_1.jsx)("button", { "data-testid": "button-language-en", onClick: () => mockSetLanguage('en'), children: "EN" }), (0, jsx_runtime_1.jsx)("button", { "data-testid": "button-language-fr", onClick: () => mockSetLanguage('fr'), children: "FR" })] }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockLanguageSwitcher, {}));
            const enButton = react_1.screen.getByTestId('button-language-en');
            const frButton = react_1.screen.getByTestId('button-language-fr');
            expect(enButton).toBeInTheDocument();
            expect(frButton).toBeInTheDocument();
            await user.click(enButton);
            expect(mockSetLanguage).toHaveBeenCalledWith('en');
            await user.click(frButton);
            expect(mockSetLanguage).toHaveBeenCalledWith('fr');
        });
    });
    describe('Login Form Buttons', () => {
        it('should handle login form submission', async () => {
            const MockLoginForm = () => {
                const handleSubmit = (e) => {
                    e.preventDefault();
                    mockLogin({ email: 'test@test.com', password: 'password' });
                };
                return ((0, jsx_runtime_1.jsxs)("form", { onSubmit: handleSubmit, children: [(0, jsx_runtime_1.jsx)("input", { type: "email", name: "email", defaultValue: "test@test.com" }), (0, jsx_runtime_1.jsx)("input", { type: "password", name: "password", defaultValue: "password" }), (0, jsx_runtime_1.jsx)("button", { type: "submit", "data-testid": "button-login", children: "Login" })] }));
            };
            renderWithProvider((0, jsx_runtime_1.jsx)(MockLoginForm, {}));
            const loginButton = react_1.screen.getByTestId('button-login');
            expect(loginButton).toBeInTheDocument();
            await user.click(loginButton);
            await (0, react_1.waitFor)(() => {
                expect(mockLogin).toHaveBeenCalledWith({
                    email: 'test@test.com',
                    password: 'password'
                });
            });
        });
    });
    describe('Registration Buttons', () => {
        it('should handle registration navigation', async () => {
            const mockNavigate = jest.fn();
            const MockRegisterButton = () => ((0, jsx_runtime_1.jsx)("button", { "data-testid": "button-register", onClick: () => mockNavigate('/auth/register'), children: "Register" }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockRegisterButton, {}));
            const registerButton = react_1.screen.getByTestId('button-register');
            expect(registerButton).toBeInTheDocument();
            await user.click(registerButton);
            expect(mockNavigate).toHaveBeenCalledWith('/auth/register');
        });
    });
    describe('Password Reset Buttons', () => {
        it('should handle password reset request', async () => {
            const MockPasswordResetForm = () => {
                const handleReset = (e) => {
                    e.preventDefault();
                    mockApiRequest('/api/auth/reset-password', {
                        method: 'POST',
                        body: JSON.stringify({ email: 'test@test.com' })
                    });
                };
                return ((0, jsx_runtime_1.jsxs)("form", { onSubmit: handleReset, children: [(0, jsx_runtime_1.jsx)("input", { type: "email", name: "email", defaultValue: "test@test.com" }), (0, jsx_runtime_1.jsx)("button", { type: "submit", "data-testid": "button-reset-password", children: "Reset Password" })] }));
            };
            renderWithProvider((0, jsx_runtime_1.jsx)(MockPasswordResetForm, {}));
            const resetButton = react_1.screen.getByTestId('button-reset-password');
            expect(resetButton).toBeInTheDocument();
            await user.click(resetButton);
            await (0, react_1.waitFor)(() => {
                expect(mockApiRequest).toHaveBeenCalledWith('/api/auth/reset-password', {
                    method: 'POST',
                    body: JSON.stringify({ email: 'test@test.com' })
                });
            });
        });
    });
    describe('Logout Buttons', () => {
        it('should handle logout action', async () => {
            const MockLogoutButton = () => ((0, jsx_runtime_1.jsx)("button", { "data-testid": "button-logout", onClick: mockLogout, children: "Logout" }));
            renderWithProvider((0, jsx_runtime_1.jsx)(MockLogoutButton, {}));
            const logoutButton = react_1.screen.getByTestId('button-logout');
            expect(logoutButton).toBeInTheDocument();
            await user.click(logoutButton);
            expect(mockLogout).toHaveBeenCalled();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2J1dHRvbi1mdW5jdGlvbmFsaXR5L2F1dGhlbnRpY2F0aW9uLWJ1dHRvbnMudGVzdC50c3giLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBYUEsSUFBSSxDQUFDLElBQUksQ0FBQyxxQ0FBcUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3RELFVBQVUsRUFBRSxjQUFjO0lBQzFCLFdBQVcsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxFQUFFO0NBQzdFLENBQUMsQ0FBQyxDQUFDO0FBS0osSUFBSSxDQUFDLElBQUksQ0FBQyxvQ0FBb0MsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JELE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ2QsSUFBSSxFQUFFLElBQUk7UUFDVixlQUFlLEVBQUUsS0FBSztRQUN0QixLQUFLLEVBQUUsU0FBUztRQUNoQixNQUFNLEVBQUUsVUFBVTtLQUNuQixDQUFDO0NBQ0gsQ0FBQyxDQUFDLENBQUM7QUE1Qko7OztHQUdHO0FBRUgsa0RBQTRFO0FBQzVFLHVEQUF5RTtBQUN6RSxxQ0FBbUM7QUFDbkMsNkVBQW9EO0FBQ3BELGtEQUEwQjtBQUUxQixvQkFBb0I7QUFDcEIsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBTWpDLDhCQUE4QjtBQUM5QixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7QUFDNUIsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO0FBVTdCLFFBQVEsQ0FBQyxzQ0FBc0MsRUFBRSxHQUFHLEVBQUU7SUFDcEQsSUFBSSxXQUF3QixDQUFDO0lBQzdCLElBQUksSUFBUyxDQUFDO0lBRWQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFdBQVcsR0FBRyxJQUFJLHlCQUFXLENBQUM7WUFDNUIsY0FBYyxFQUFFO2dCQUNkLE9B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QUFNLENBQUMsVUFBVSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2J1dHRvbi1mdW5jdGlvbmFsaXR5L2F1dGhlbnRpY2F0aW9uLWJ1dHRvbnMudGVzdC50c3giXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBdXRoZW50aWNhdGlvbiBCdXR0b24gRnVuY3Rpb25hbGl0eSBUZXN0c1xuICogVGVzdHMgYWxsIGF1dGhlbnRpY2F0aW9uLXJlbGF0ZWQgYnV0dG9ucyAobG9naW4sIGxvZ291dCwgcGFzc3dvcmQgdG9nZ2xlLCBldGMuKVxuICovXG5cbmltcG9ydCB7IHJlbmRlciwgc2NyZWVuLCBmaXJlRXZlbnQsIHdhaXRGb3IgfSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCB7IFF1ZXJ5Q2xpZW50LCBRdWVyeUNsaWVudFByb3ZpZGVyIH0gZnJvbSAnQHRhbnN0YWNrL3JlYWN0LXF1ZXJ5JztcbmltcG9ydCAnQHRlc3RpbmctbGlicmFyeS9qZXN0LWRvbSc7XG5pbXBvcnQgdXNlckV2ZW50IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvdXNlci1ldmVudCc7XG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuXG4vLyBNb2NrIEFQSSByZXF1ZXN0c1xuY29uc3QgbW9ja0FwaVJlcXVlc3QgPSBqZXN0LmZuKCk7XG5qZXN0Lm1vY2soJy4uLy4uLy4uL2NsaWVudC9zcmMvbGliL3F1ZXJ5Q2xpZW50JywgKCkgPT4gKHtcbiAgYXBpUmVxdWVzdDogbW9ja0FwaVJlcXVlc3QsXG4gIHF1ZXJ5Q2xpZW50OiBuZXcgKGplc3QucmVxdWlyZUFjdHVhbCgnQHRhbnN0YWNrL3JlYWN0LXF1ZXJ5JykuUXVlcnlDbGllbnQpKCksXG59KSk7XG5cbi8vIE1vY2sgYXV0aGVudGljYXRpb24gY29udGV4dFxuY29uc3QgbW9ja0xvZ2luID0gamVzdC5mbigpO1xuY29uc3QgbW9ja0xvZ291dCA9IGplc3QuZm4oKTtcbmplc3QubW9jaygnLi4vLi4vLi4vY2xpZW50L3NyYy9ob29rcy91c2UtYXV0aCcsICgpID0+ICh7XG4gIHVzZUF1dGg6ICgpID0+ICh7XG4gICAgdXNlcjogbnVsbCxcbiAgICBpc0F1dGhlbnRpY2F0ZWQ6IGZhbHNlLFxuICAgIGxvZ2luOiBtb2NrTG9naW4sXG4gICAgbG9nb3V0OiBtb2NrTG9nb3V0LFxuICB9KSxcbn0pKTtcblxuZGVzY3JpYmUoJ0F1dGhlbnRpY2F0aW9uIEJ1dHRvbnMgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgbGV0IHF1ZXJ5Q2xpZW50OiBRdWVyeUNsaWVudDtcbiAgbGV0IHVzZXI6IGFueTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBxdWVyeUNsaWVudCA9IG5ldyBRdWVyeUNsaWVudCh7XG4gICAgICBkZWZhdWx0T3B0aW9uczoge1xuICAgICAgICBxdWVyaWVzOiB7IHJldHJ5OiBmYWxzZSB9LFxuICAgICAgICBtdXRhdGlvbnM6IHsgcmV0cnk6IGZhbHNlIH0sXG4gICAgICB9LFxuICAgIH0pO1xuICAgIHVzZXIgPSB1c2VyRXZlbnQuc2V0dXAoKTtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgICBtb2NrQXBpUmVxdWVzdC5tb2NrUmVzb2x2ZWRWYWx1ZSh7IG9rOiB0cnVlLCBqc29uOiAoKSA9PiBQcm9taXNlLnJlc29sdmUoe30pIH0pO1xuICB9KTtcblxuICBjb25zdCByZW5kZXJXaXRoUHJvdmlkZXIgPSAoY29tcG9uZW50OiBSZWFjdC5SZWFjdEVsZW1lbnQpID0+IHtcbiAgICByZXR1cm4gcmVuZGVyKFxuICAgICAgPFF1ZXJ5Q2xpZW50UHJvdmlkZXIgY2xpZW50PXtxdWVyeUNsaWVudH0+XG4gICAgICAgIHtjb21wb25lbnR9XG4gICAgICA8L1F1ZXJ5Q2xpZW50UHJvdmlkZXI+XG4gICAgKTtcbiAgfTtcblxuICBkZXNjcmliZSgnUGFzc3dvcmQgVG9nZ2xlIEJ1dHRvbnMnLCAoKSA9PiB7XG4gICAgY29uc3QgcGFzc3dvcmRUb2dnbGVUZXN0SWRzID0gW1xuICAgICAgJ2J1dHRvbi10b2dnbGUtcGFzc3dvcmQnLFxuICAgICAgJ2J1dHRvbi10b2dnbGUtY29uZmlybS1wYXNzd29yZCcsXG4gICAgXTtcblxuICAgIHBhc3N3b3JkVG9nZ2xlVGVzdElkcy5mb3JFYWNoKHRlc3RJZCA9PiB7XG4gICAgICBpdChgc2hvdWxkIHRvZ2dsZSBwYXNzd29yZCB2aXNpYmlsaXR5IGZvciAke3Rlc3RJZH1gLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IE1vY2tQYXNzd29yZEZpZWxkID0gKCkgPT4ge1xuICAgICAgICAgIGNvbnN0IFtzaG93UGFzc3dvcmQsIHNldFNob3dQYXNzd29yZF0gPSBSZWFjdC51c2VTdGF0ZShmYWxzZSk7XG5cbiAgICAgICAgICByZXR1cm4gKFxuICAgICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgICAgPGlucHV0IFxuICAgICAgICAgICAgICAgIHR5cGU9e3Nob3dQYXNzd29yZCA/ICd0ZXh0JyA6ICdwYXNzd29yZCd9IFxuICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwicGFzc3dvcmQtaW5wdXRcIlxuICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT1cInRlc3RwYXNzd29yZFwiXG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxidXR0b24gXG4gICAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9e3Rlc3RJZH1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRTaG93UGFzc3dvcmQoIXNob3dQYXNzd29yZCl9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7c2hvd1Bhc3N3b3JkID8gJ0hpZGUnIDogJ1Nob3cnfVxuICAgICAgICAgICAgICA8L2J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVuZGVyV2l0aFByb3ZpZGVyKDxNb2NrUGFzc3dvcmRGaWVsZCAvPik7XG4gICAgICAgIFxuICAgICAgICBjb25zdCBwYXNzd29yZElucHV0ID0gc2NyZWVuLmdldEJ5VGVzdElkKCdwYXNzd29yZC1pbnB1dCcpIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgIGNvbnN0IHRvZ2dsZUJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCh0ZXN0SWQpO1xuICAgICAgICBcbiAgICAgICAgZXhwZWN0KHBhc3N3b3JkSW5wdXQudHlwZSkudG9CZSgncGFzc3dvcmQnKTtcbiAgICAgICAgZXhwZWN0KHRvZ2dsZUJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHVzZXIuY2xpY2sodG9nZ2xlQnV0dG9uKTtcbiAgICAgICAgXG4gICAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICAgIGV4cGVjdChwYXNzd29yZElucHV0LnR5cGUpLnRvQmUoJ3RleHQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCB1c2VyLmNsaWNrKHRvZ2dsZUJ1dHRvbik7XG4gICAgICAgIFxuICAgICAgICBhd2FpdCB3YWl0Rm9yKCgpID0+IHtcbiAgICAgICAgICBleHBlY3QocGFzc3dvcmRJbnB1dC50eXBlKS50b0JlKCdwYXNzd29yZCcpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTGFuZ3VhZ2UgVG9nZ2xlIEJ1dHRvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzd2l0Y2ggdG8gRW5nbGlzaCB3aGVuIEVOIGJ1dHRvbiBpcyBjbGlja2VkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1NldExhbmd1YWdlID0gamVzdC5mbigpO1xuICAgICAgXG4gICAgICBjb25zdCBNb2NrTGFuZ3VhZ2VTd2l0Y2hlciA9ICgpID0+IChcbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgICAgZGF0YS10ZXN0aWQ9XCJidXR0b24tbGFuZ3VhZ2UtZW5cIlxuICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja1NldExhbmd1YWdlKCdlbicpfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIEVOXG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLWxhbmd1YWdlLWZyXCJcbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG1vY2tTZXRMYW5ndWFnZSgnZnInKX1cbiAgICAgICAgICA+XG4gICAgICAgICAgICBGUlxuICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja0xhbmd1YWdlU3dpdGNoZXIgLz4pO1xuICAgICAgXG4gICAgICBjb25zdCBlbkJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLWxhbmd1YWdlLWVuJyk7XG4gICAgICBjb25zdCBmckJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLWxhbmd1YWdlLWZyJyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChlbkJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIGV4cGVjdChmckJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhlbkJ1dHRvbik7XG4gICAgICBleHBlY3QobW9ja1NldExhbmd1YWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZW4nKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhmckJ1dHRvbik7XG4gICAgICBleHBlY3QobW9ja1NldExhbmd1YWdlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZnInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xvZ2luIEZvcm0gQnV0dG9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBsb2dpbiBmb3JtIHN1Ym1pc3Npb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBNb2NrTG9naW5Gb3JtID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSAoZTogUmVhY3QuRm9ybUV2ZW50KSA9PiB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIG1vY2tMb2dpbih7IGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsIHBhc3N3b3JkOiAncGFzc3dvcmQnIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGZvcm0gb25TdWJtaXQ9e2hhbmRsZVN1Ym1pdH0+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cImVtYWlsXCIgbmFtZT1cImVtYWlsXCIgZGVmYXVsdFZhbHVlPVwidGVzdEB0ZXN0LmNvbVwiIC8+XG4gICAgICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgZGVmYXVsdFZhbHVlPVwicGFzc3dvcmRcIiAvPlxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgZGF0YS10ZXN0aWQ9XCJidXR0b24tbG9naW5cIj5cbiAgICAgICAgICAgICAgTG9naW5cbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja0xvZ2luRm9ybSAvPik7XG4gICAgICBcbiAgICAgIGNvbnN0IGxvZ2luQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tbG9naW4nKTtcbiAgICAgIGV4cGVjdChsb2dpbkJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhsb2dpbkJ1dHRvbik7XG4gICAgICBcbiAgICAgIGF3YWl0IHdhaXRGb3IoKCkgPT4ge1xuICAgICAgICBleHBlY3QobW9ja0xvZ2luKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7IFxuICAgICAgICAgIGVtYWlsOiAndGVzdEB0ZXN0LmNvbScsIFxuICAgICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQnIFxuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUmVnaXN0cmF0aW9uIEJ1dHRvbnMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgcmVnaXN0cmF0aW9uIG5hdmlnYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTmF2aWdhdGUgPSBqZXN0LmZuKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IE1vY2tSZWdpc3RlckJ1dHRvbiA9ICgpID0+IChcbiAgICAgICAgPGJ1dHRvbiBcbiAgICAgICAgICBkYXRhLXRlc3RpZD1cImJ1dHRvbi1yZWdpc3RlclwiXG4gICAgICAgICAgb25DbGljaz17KCkgPT4gbW9ja05hdmlnYXRlKCcvYXV0aC9yZWdpc3RlcicpfVxuICAgICAgICA+XG4gICAgICAgICAgUmVnaXN0ZXJcbiAgICAgICAgPC9idXR0b24+XG4gICAgICApO1xuXG4gICAgICByZW5kZXJXaXRoUHJvdmlkZXIoPE1vY2tSZWdpc3RlckJ1dHRvbiAvPik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlZ2lzdGVyQnV0dG9uID0gc2NyZWVuLmdldEJ5VGVzdElkKCdidXR0b24tcmVnaXN0ZXInKTtcbiAgICAgIGV4cGVjdChyZWdpc3RlckJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhyZWdpc3RlckJ1dHRvbik7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrTmF2aWdhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvYXV0aC9yZWdpc3RlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnUGFzc3dvcmQgUmVzZXQgQnV0dG9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBwYXNzd29yZCByZXNldCByZXF1ZXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgTW9ja1Bhc3N3b3JkUmVzZXRGb3JtID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBoYW5kbGVSZXNldCA9IChlOiBSZWFjdC5Gb3JtRXZlbnQpID0+IHtcbiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgbW9ja0FwaVJlcXVlc3QoJy9hcGkvYXV0aC9yZXNldC1wYXNzd29yZCcsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlbWFpbDogJ3Rlc3RAdGVzdC5jb20nIH0pXG4gICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17aGFuZGxlUmVzZXR9PlxuICAgICAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIG5hbWU9XCJlbWFpbFwiIGRlZmF1bHRWYWx1ZT1cInRlc3RAdGVzdC5jb21cIiAvPlxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCIgZGF0YS10ZXN0aWQ9XCJidXR0b24tcmVzZXQtcGFzc3dvcmRcIj5cbiAgICAgICAgICAgICAgUmVzZXQgUGFzc3dvcmRcbiAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgIDwvZm9ybT5cbiAgICAgICAgKTtcbiAgICAgIH07XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja1Bhc3N3b3JkUmVzZXRGb3JtIC8+KTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzZXRCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXN0SWQoJ2J1dHRvbi1yZXNldC1wYXNzd29yZCcpO1xuICAgICAgZXhwZWN0KHJlc2V0QnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpO1xuICAgICAgXG4gICAgICBhd2FpdCB1c2VyLmNsaWNrKHJlc2V0QnV0dG9uKTtcbiAgICAgIFxuICAgICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7XG4gICAgICAgIGV4cGVjdChtb2NrQXBpUmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy9hcGkvYXV0aC9yZXNldC1wYXNzd29yZCcsIHtcbiAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVtYWlsOiAndGVzdEB0ZXN0LmNvbScgfSlcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0xvZ291dCBCdXR0b25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGxvZ291dCBhY3Rpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBNb2NrTG9nb3V0QnV0dG9uID0gKCkgPT4gKFxuICAgICAgICA8YnV0dG9uIFxuICAgICAgICAgIGRhdGEtdGVzdGlkPVwiYnV0dG9uLWxvZ291dFwiXG4gICAgICAgICAgb25DbGljaz17bW9ja0xvZ291dH1cbiAgICAgICAgPlxuICAgICAgICAgIExvZ291dFxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgICk7XG5cbiAgICAgIHJlbmRlcldpdGhQcm92aWRlcig8TW9ja0xvZ291dEJ1dHRvbiAvPik7XG4gICAgICBcbiAgICAgIGNvbnN0IGxvZ291dEJ1dHRvbiA9IHNjcmVlbi5nZXRCeVRlc3RJZCgnYnV0dG9uLWxvZ291dCcpO1xuICAgICAgZXhwZWN0KGxvZ291dEJ1dHRvbikudG9CZUluVGhlRG9jdW1lbnQoKTtcbiAgICAgIFxuICAgICAgYXdhaXQgdXNlci5jbGljayhsb2dvdXRCdXR0b24pO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0xvZ291dCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==