c5f61b8bbee4bdedb7b97b6cb944791e
"use strict";
/**
 * Optimized database storage with caching and performance monitoring.
 * Replaces decorators with direct implementation for better compatibility.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.OptimizedDatabaseStorage = void 0;
const drizzle_orm_1 = require("drizzle-orm");
// Use shared database connection to avoid multiple pools in production
const db_1 = require("./db");
const crypto_1 = __importDefault(require("crypto"));
const schema = __importStar(require("@shared/schema"));
const database_optimization_1 = require("./database-optimization");
const query_cache_1 = require("./query-cache");
const performance_monitoring_1 = require("./performance-monitoring");
const drizzle_orm_2 = require("drizzle-orm");
// Database connection imported from shared db.ts
/**
 * Enhanced database storage with built-in caching and performance monitoring.
 */
class OptimizedDatabaseStorage {
    /**
     *
     */
    constructor() {
        // Skip optimizations in test environment
        if (process.env.TEST_ENV !== 'integration' &&
            !process.env.DISABLE_DB_OPTIMIZATIONS &&
            process.env.NODE_ENV !== 'test' &&
            !process.env.JEST_WORKER_ID) {
            this.initializeOptimizations();
        }
    }
    /**
     * Initializes database optimizations.
     */
    async initializeOptimizations() {
        // Skip database optimization during tests
        if (process.env.NODE_ENV === 'test' ||
            process.env.JEST_WORKER_ID ||
            process.env.SKIP_DB_OPTIMIZATION) {
            // Database optimizations skipped in test environment
            return;
        }
        try {
            await database_optimization_1.QueryOptimizer.applyCoreOptimizations();
            // Database optimizations applied
        }
        catch (error) {
            console.error('‚ùå Error initializing database optimizations:', error);
        }
    }
    /**
     * Wrapper for performance tracking and caching.
     * @param operation
     * @param cacheKey
     * @param cacheType
     * @param fn
     */
    async withOptimizations(operation, cacheKey, cacheType, fn) {
        // Try cache first
        if (cacheKey) {
            const cached = query_cache_1.queryCache.get(cacheType, cacheKey);
            if (cached !== undefined) {
                return cached;
            }
        }
        // Execute with performance tracking
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery(operation, fn);
        // Cache result
        if (cacheKey && result !== undefined) {
            query_cache_1.queryCache.set(cacheType, cacheKey, result);
        }
        return result;
    }
    /**
     * Enhanced logging function for storage operations
     */
    logStorageOperation(operation, data, level = 'INFO') {
        const timestamp = new Date().toISOString();
        const emoji = {
            INFO: 'üìä',
            ERROR: '‚ùå',
            DEBUG: 'üîç',
            WARN: '‚ö†Ô∏è'
        }[level];
        console.log(`[${timestamp}] ${emoji} [STORAGE ${operation.toUpperCase()}] ${level}:`, data);
    }
    // User operations with optimization
    /**
     * Retrieves all active users with caching and performance tracking.
     */
    async getUsers() {
        return this.withOptimizations('getUsers', 'all_users', 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .limit(100) // Always use LIMIT for large result sets
            .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt)));
    }
    /**
     * Retrieves all active users with their assignments (organizations, buildings, residences).
     * OPTIMIZED: Uses single query with JOINs and aggregation instead of N+1 queries.
     */
    async getUsersWithAssignments() {
        return this.withOptimizations('getUsersWithAssignments', 'all_users_assignments_optimized_v4', 'users', async () => {
            try {
                // Single optimized query using CTEs and aggregation
                const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
            WITH user_orgs AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', o.id,
                      'name', o.name,
                      'type', o.type
                    )
                  ) FILTER (WHERE o.id IS NOT NULL),
                  '[]'::json
                ) as organizations
              FROM user_organizations uo
              INNER JOIN organizations o ON uo.organization_id = o.id
              WHERE uo.is_active = true AND o.is_active = true
              GROUP BY uo.user_id
            ),
            user_buildings AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', buildings_distinct.id,
                      'name', buildings_distinct.name
                    )
                  ),
                  '[]'::json
                ) as buildings
              FROM user_organizations uo
              INNER JOIN (
                SELECT DISTINCT uo2.user_id, b.id, b.name
                FROM user_organizations uo2
                INNER JOIN buildings b ON uo2.organization_id = b.organization_id
                WHERE uo2.is_active = true AND b.is_active = true
              ) buildings_distinct ON uo.user_id = buildings_distinct.user_id
              WHERE uo.is_active = true
              GROUP BY uo.user_id
            ),
            user_residences AS (
              SELECT 
                ur.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', r.id,
                      'unitNumber', r.unit_number,
                      'buildingId', r.building_id,
                      'buildingName', b.name
                    )
                  ) FILTER (WHERE r.id IS NOT NULL),
                  '[]'::json
                ) as residences
              FROM user_residences ur
              INNER JOIN residences r ON ur.residence_id = r.id
              INNER JOIN buildings b ON r.building_id = b.id
              WHERE ur.is_active = true AND r.is_active = true
              GROUP BY ur.user_id
            )
            SELECT 
              u.*,
              COALESCE(uo.organizations, '[]'::json) as organizations,
              COALESCE(ub.buildings, '[]'::json) as buildings,
              COALESCE(ur.residences, '[]'::json) as residences
            FROM users u
            LEFT JOIN user_orgs uo ON u.id = uo.user_id
            LEFT JOIN user_buildings ub ON u.id = ub.user_id
            LEFT JOIN user_residences ur ON u.id = ur.user_id
            WHERE u.is_active = true
            ORDER BY u.created_at DESC
            LIMIT 100
          `);
                // Transform the raw SQL result to match the expected TypeScript types
                return result.rows.map((row) => ({
                    id: row.id,
                    username: row.username,
                    password: row.password,
                    email: row.email,
                    firstName: row.first_name,
                    lastName: row.last_name,
                    phone: row.phone,
                    profileImage: row.profile_image,
                    language: row.language,
                    role: row.role,
                    isActive: row.is_active,
                    lastLoginAt: row.last_login_at,
                    createdAt: row.created_at,
                    updatedAt: row.updated_at,
                    organizations: typeof row.organizations === 'string'
                        ? JSON.parse(row.organizations)
                        : row.organizations || [],
                    buildings: typeof row.buildings === 'string'
                        ? JSON.parse(row.buildings)
                        : row.buildings || [],
                    residences: typeof row.residences === 'string'
                        ? JSON.parse(row.residences)
                        : row.residences || []
                }));
            }
            catch (error) {
                console.error('‚ùå Error in optimized getUsersWithAssignments:', error);
                // Fallback to the original implementation if optimized query fails
                console.log('üîÑ Falling back to original implementation...');
                return this.getUsersWithAssignmentsFallback();
            }
        });
    }
    /**
     * Retrieves paginated active users with their assignments (organizations, buildings, residences).
     * OPTIMIZED: Uses single query with JOINs, aggregation, and LIMIT/OFFSET for pagination.
     */
    async getUsersWithAssignmentsPaginated(offset = 0, limit = 10, filters = {}) {
        return this.withOptimizations('getUsersWithAssignmentsPaginated', `paginated_users_${offset}_${limit}_${JSON.stringify(filters)}_v4`, 'users', async () => {
            try {
                console.log('üîç [DB FILTER] Input filters:', JSON.stringify(filters, null, 2));
                // Build WHERE conditions for filtering
                let whereConditions = [];
                let countWhereConditions = [];
                if (filters.role) {
                    if (filters.role === 'null') {
                        whereConditions.push('u.role IS NULL');
                        countWhereConditions.push('role IS NULL');
                    }
                    else {
                        whereConditions.push(`u.role = '${filters.role}'`);
                        countWhereConditions.push(`role = '${filters.role}'`);
                    }
                }
                if (filters.status) {
                    if (filters.status === 'null') {
                        whereConditions.push('u.is_active IS NULL');
                        countWhereConditions.push('is_active IS NULL');
                    }
                    else {
                        const isActive = filters.status === 'true';
                        whereConditions.push(`u.is_active = ${isActive}`);
                        countWhereConditions.push(`is_active = ${isActive}`);
                    }
                }
                else {
                    // Default: only show active users if no status filter is applied
                    whereConditions.push('u.is_active = true');
                    countWhereConditions.push('is_active = true');
                }
                // Demo-only filter for demo users
                if (filters.demoOnly === 'true') {
                    whereConditions.push("(u.role LIKE 'demo_%')");
                    countWhereConditions.push("(role LIKE 'demo_%')");
                }
                // Search filter for name/email
                if (filters.search && filters.search.trim()) {
                    const searchTerm = filters.search.trim().toLowerCase();
                    whereConditions.push(`(
              LOWER(u.first_name || ' ' || u.last_name) LIKE '%${searchTerm}%' OR 
              LOWER(u.email) LIKE '%${searchTerm}%' OR 
              LOWER(u.username) LIKE '%${searchTerm}%'
            )`);
                    countWhereConditions.push(`(
              LOWER(first_name || ' ' || last_name) LIKE '%${searchTerm}%' OR 
              LOWER(email) LIKE '%${searchTerm}%' OR 
              LOWER(username) LIKE '%${searchTerm}%'
            )`);
                    console.log('üîç [SEARCH FILTER] Applied search for:', searchTerm);
                }
                // Manager organizations filter - only show users from specific organizations
                if (filters.managerOrganizations && filters.managerOrganizations.trim()) {
                    const orgIds = filters.managerOrganizations.split(',').map(id => `'${id.trim()}'`).join(',');
                    whereConditions.push(`EXISTS (
              SELECT 1 FROM user_organizations uo_mgr 
              WHERE uo_mgr.user_id = u.id 
              AND uo_mgr.organization_id IN (${orgIds})
              AND uo_mgr.is_active = true
            )`);
                    countWhereConditions.push(`EXISTS (
              SELECT 1 FROM user_organizations uo_mgr 
              WHERE uo_mgr.user_id = users.id 
              AND uo_mgr.organization_id IN (${orgIds})
              AND uo_mgr.is_active = true
            )`);
                    console.log('üëî [MANAGER FILTER] Applied organization filter for:', orgIds);
                }
                // First get total count for pagination metadata with filters
                const countQuery = `
            SELECT COUNT(*) as total 
            FROM users 
            WHERE ${countWhereConditions.length > 0 ? countWhereConditions.join(' AND ') : '1=1'}
            ${filters.organization && filters.organization.trim() ? `AND EXISTS (
              SELECT 1 FROM user_organizations uo_filter 
              WHERE uo_filter.user_id = users.id 
              AND uo_filter.organization_id = '${filters.organization.trim()}'
              AND uo_filter.is_active = true
            )` : ''}
            ${!filters.organization && filters.orphan === 'true' ? `AND NOT EXISTS (
              SELECT 1 FROM user_organizations uo_count_orphan 
              WHERE uo_count_orphan.user_id = users.id AND uo_count_orphan.is_active = true
            ) AND NOT EXISTS (
              SELECT 1 FROM user_residences ur_count_orphan 
              WHERE ur_count_orphan.user_id = users.id AND ur_count_orphan.is_active = true
            )` : ''}
            ${!filters.organization && filters.orphan === 'false' ? `AND (EXISTS (
              SELECT 1 FROM user_organizations uo_count_assigned 
              WHERE uo_count_assigned.user_id = users.id AND uo_count_assigned.is_active = true
            ) OR EXISTS (
              SELECT 1 FROM user_residences ur_count_assigned 
              WHERE ur_count_assigned.user_id = users.id AND ur_count_assigned.is_active = true
            ))` : ''}
            ${filters.search && filters.search.trim() ? `AND (
              LOWER(first_name || ' ' || last_name) LIKE '%${filters.search.trim().toLowerCase()}%' OR 
              LOWER(email) LIKE '%${filters.search.trim().toLowerCase()}%' OR 
              LOWER(username) LIKE '%${filters.search.trim().toLowerCase()}%'
            )` : ''}
          `;
                console.log('üìä [COUNT SQL]:', countQuery);
                const countResult = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
                const total = parseInt(countResult.rows[0]?.total || '0');
                console.log('üìä [COUNT RESULT]:', total);
                // Single optimized query using CTEs and aggregation with pagination and filters
                const mainQuery = `
            WITH user_orgs AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', o.id,
                      'name', o.name,
                      'type', o.type
                    )
                  ) FILTER (WHERE o.id IS NOT NULL),
                  '[]'::json
                ) as organizations
              FROM user_organizations uo
              INNER JOIN organizations o ON uo.organization_id = o.id
              WHERE uo.is_active = true AND o.is_active = true
              GROUP BY uo.user_id
            ),
            user_buildings AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', buildings_distinct.id,
                      'name', buildings_distinct.name
                    )
                  ),
                  '[]'::json
                ) as buildings
              FROM user_organizations uo
              INNER JOIN (
                SELECT DISTINCT uo2.user_id, b.id, b.name
                FROM user_organizations uo2
                INNER JOIN buildings b ON uo2.organization_id = b.organization_id
                WHERE uo2.is_active = true AND b.is_active = true
              ) buildings_distinct ON uo.user_id = buildings_distinct.user_id
              WHERE uo.is_active = true
              GROUP BY uo.user_id
            ),
            user_residences AS (
              SELECT 
                ur.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', r.id,
                      'unitNumber', r.unit_number,
                      'buildingId', r.building_id,
                      'buildingName', b.name
                    )
                  ) FILTER (WHERE r.id IS NOT NULL),
                  '[]'::json
                ) as residences
              FROM user_residences ur
              INNER JOIN residences r ON ur.residence_id = r.id
              INNER JOIN buildings b ON r.building_id = b.id
              WHERE ur.is_active = true AND r.is_active = true
              GROUP BY ur.user_id
            )
            SELECT 
              u.*,
              COALESCE(uo.organizations, '[]'::json) as organizations,
              COALESCE(ub.buildings, '[]'::json) as buildings,
              COALESCE(ur.residences, '[]'::json) as residences
            FROM users u
            LEFT JOIN user_orgs uo ON u.id = uo.user_id
            LEFT JOIN user_buildings ub ON u.id = ub.user_id
            LEFT JOIN user_residences ur ON u.id = ur.user_id
            WHERE ${whereConditions.length > 0 ? whereConditions.join(' AND ') : '1=1'}
            ${filters.organization && filters.organization.trim() ? (() => {
                    console.log('üè¢ [ORG FILTER] Applying organization filter:', filters.organization.trim());
                    return `AND EXISTS (
                SELECT 1 FROM user_organizations uo_filter 
                WHERE uo_filter.user_id = u.id 
                AND uo_filter.organization_id = '${filters.organization.trim()}'
                AND uo_filter.is_active = true
              )`;
                })() : (() => {
                    console.log('üè¢ [ORG FILTER] No organization filter applied (empty or undefined)');
                    return '';
                })()}
            ${!filters.organization && filters.orphan === 'true' ? (() => {
                    console.log('üëª [ORPHAN FILTER] Applying orphan filter: true (users with no assignments)');
                    return `AND NOT EXISTS (
                SELECT 1 FROM user_organizations uo_filter_orphan 
                WHERE uo_filter_orphan.user_id = u.id AND uo_filter_orphan.is_active = true
              ) AND NOT EXISTS (
                SELECT 1 FROM user_residences ur_filter_orphan 
                WHERE ur_filter_orphan.user_id = u.id AND ur_filter_orphan.is_active = true
              )`;
                })() : !filters.organization && filters.orphan === 'false' ? (() => {
                    console.log('üëª [ORPHAN FILTER] Applying orphan filter: false (users with assignments)');
                    return `AND (EXISTS (
                SELECT 1 FROM user_organizations uo_filter_assigned 
                WHERE uo_filter_assigned.user_id = u.id AND uo_filter_assigned.is_active = true
              ) OR EXISTS (
                SELECT 1 FROM user_residences ur_filter_assigned 
                WHERE ur_filter_assigned.user_id = u.id AND ur_filter_assigned.is_active = true
              ))`;
                })() : filters.organization && filters.orphan ? (() => {
                    console.log('üëª [ORPHAN FILTER] Ignoring orphan filter - conflicts with organization filter');
                    return '';
                })() : (() => {
                    console.log('üëª [ORPHAN FILTER] No orphan filter applied (empty or undefined)');
                    return '';
                })()}
            ORDER BY u.created_at DESC
            LIMIT ${limit} OFFSET ${offset}
          `;
                console.log('üìä [MAIN SQL]:', mainQuery);
                const result = await db_1.db.execute(drizzle_orm_1.sql.raw(mainQuery));
                console.log('üìä [MAIN RESULT]:', result.rows.length, 'users found');
                // Transform the raw SQL result to match the expected TypeScript types
                const users = result.rows.map((row) => ({
                    id: row.id,
                    username: row.username,
                    password: row.password,
                    email: row.email,
                    firstName: row.first_name,
                    lastName: row.last_name,
                    phone: row.phone,
                    profileImage: row.profile_image,
                    language: row.language,
                    role: row.role,
                    isActive: row.is_active,
                    lastLoginAt: row.last_login_at,
                    createdAt: row.created_at,
                    updatedAt: row.updated_at,
                    organizations: typeof row.organizations === 'string'
                        ? JSON.parse(row.organizations)
                        : row.organizations || [],
                    buildings: typeof row.buildings === 'string'
                        ? JSON.parse(row.buildings)
                        : row.buildings || [],
                    residences: typeof row.residences === 'string'
                        ? JSON.parse(row.residences)
                        : row.residences || []
                }));
                return { users, total };
            }
            catch (error) {
                console.error('‚ùå Error in optimized getUsersWithAssignmentsPaginated:', error);
                // Fallback to paginated version of the original implementation if optimized query fails
                console.log('üîÑ Falling back to paginated original implementation...');
                return this.getUsersWithAssignmentsPaginatedFallback(offset, limit, filters);
            }
        });
    }
    /**
     * Fallback implementation for getUsersWithAssignments if optimized version fails.
     * This is the original N+1 query implementation kept for reliability.
     */
    async getUsersWithAssignmentsFallback() {
        try {
            // Get all users first
            const users = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
                .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt));
            // For each user, fetch their assignments with limited concurrency to prevent connection issues
            const batchSize = 5; // Process 5 users at a time to avoid connection pool exhaustion
            const usersWithAssignments = [];
            for (let i = 0; i < users.length; i += batchSize) {
                const batch = users.slice(i, i + batchSize);
                const batchResults = await Promise.all(batch.map(async (user) => {
                    try {
                        // Get user organizations
                        const userOrgs = await db_1.db
                            .select({
                            id: schema.organizations.id,
                            name: schema.organizations.name,
                            type: schema.organizations.type,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
                        // Get user buildings (through organization relationships)
                        const userBuildings = await db_1.db
                            .select({
                            id: schema.buildings.id,
                            name: schema.buildings.name,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.buildings.organizationId))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
                        // Get user residences
                        const userResidences = await db_1.db
                            .select({
                            id: schema.residences.id,
                            unitNumber: schema.residences.unitNumber,
                            buildingId: schema.residences.buildingId,
                            buildingName: schema.buildings.name,
                        })
                            .from(schema.userResidences)
                            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                        return {
                            ...user,
                            organizations: userOrgs || [],
                            buildings: userBuildings || [],
                            residences: userResidences || [],
                        };
                    }
                    catch (error) {
                        console.error('‚ùå Error getting user assignments:', error);
                        // Return user with empty assignments if there's an error
                        return {
                            ...user,
                            organizations: [],
                            buildings: [],
                            residences: [],
                        };
                    }
                }));
                usersWithAssignments.push(...batchResults);
            }
            return usersWithAssignments;
        }
        catch (error) {
            console.error('‚ùå Critical error getting users with assignments:', error);
            // Return empty array on critical error
            return [];
        }
    }
    /**
     * Paginated fallback implementation for getUsersWithAssignmentsPaginated if optimized version fails.
     * This is the original N+1 query implementation with pagination support.
     */
    async getUsersWithAssignmentsPaginatedFallback(offset = 0, limit = 10, filters = {}) {
        try {
            // Build WHERE conditions for filtering
            let whereConditions = [];
            if (filters.role) {
                if (filters.role === 'null') {
                    whereConditions.push((0, drizzle_orm_1.isNull)(schema.users.role));
                }
                else {
                    whereConditions.push((0, drizzle_orm_1.eq)(schema.users.role, filters.role));
                }
            }
            if (filters.status) {
                if (filters.status === 'null') {
                    whereConditions.push((0, drizzle_orm_1.isNull)(schema.users.isActive));
                }
                else {
                    const isActive = filters.status === 'true';
                    whereConditions.push((0, drizzle_orm_1.eq)(schema.users.isActive, isActive));
                }
            }
            else {
                // Default: only show active users if no status filter is applied
                whereConditions.push((0, drizzle_orm_1.eq)(schema.users.isActive, true));
            }
            // Demo-only filter for demo users
            if (filters.demoOnly === 'true') {
                whereConditions.push((0, drizzle_orm_1.sql) `${schema.users.role} LIKE 'demo_%'`);
            }
            // Search filter for name/email
            if (filters.search && filters.search.trim()) {
                const searchTerm = `%${filters.search.trim().toLowerCase()}%`;
                whereConditions.push((0, drizzle_orm_1.or)((0, drizzle_orm_1.sql) `LOWER(${schema.users.firstName} || ' ' || ${schema.users.lastName}) LIKE ${searchTerm}`, (0, drizzle_orm_1.sql) `LOWER(${schema.users.email}) LIKE ${searchTerm}`, (0, drizzle_orm_1.sql) `LOWER(${schema.users.username}) LIKE ${searchTerm}`));
                console.log('üîç [SEARCH FILTER FALLBACK] Applied search for:', filters.search.trim());
            }
            // Manager organizations filter
            if (filters.managerOrganizations) {
                const orgIds = filters.managerOrganizations.split(',');
                const orgFilterQuery = db_1.db
                    .select({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                whereConditions.push((0, drizzle_orm_1.inArray)(schema.users.id, orgFilterQuery));
            }
            // Orphan filter implementation for fallback
            if (filters.orphan === 'true') {
                // Users with no organization AND no residence assignments
                console.log('üëª [FALLBACK] Applying orphan filter: true (users with no assignments)');
                const usersWithOrgs = db_1.db
                    .selectDistinct({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
                const usersWithResidences = db_1.db
                    .selectDistinct({ userId: schema.userResidences.userId })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
                // Users who are NOT in either of these subqueries
                whereConditions.push((0, drizzle_orm_1.and)((0, drizzle_orm_1.notInArray)(schema.users.id, usersWithOrgs), (0, drizzle_orm_1.notInArray)(schema.users.id, usersWithResidences)));
            }
            else if (filters.orphan === 'false') {
                // Users with at least one organization OR residence assignment
                console.log('üëª [FALLBACK] Applying orphan filter: false (users with assignments)');
                const usersWithOrgs = db_1.db
                    .selectDistinct({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
                const usersWithResidences = db_1.db
                    .selectDistinct({ userId: schema.userResidences.userId })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
                // Users who are in at least one of these subqueries
                whereConditions.push((0, drizzle_orm_1.or)((0, drizzle_orm_1.inArray)(schema.users.id, usersWithOrgs), (0, drizzle_orm_1.inArray)(schema.users.id, usersWithResidences)));
            }
            // First get total count with filters
            const totalResult = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema.users)
                .where((0, drizzle_orm_1.and)(...whereConditions));
            const total = Number(totalResult[0]?.count || 0);
            // Get paginated users with filters
            const users = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.and)(...whereConditions))
                .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt))
                .limit(limit)
                .offset(offset);
            // For each user, fetch their assignments with limited concurrency to prevent connection issues
            const batchSize = 5; // Process 5 users at a time to avoid connection pool exhaustion
            const usersWithAssignments = [];
            for (let i = 0; i < users.length; i += batchSize) {
                const batch = users.slice(i, i + batchSize);
                const batchResults = await Promise.all(batch.map(async (user) => {
                    try {
                        // Get user organizations
                        const userOrgs = await db_1.db
                            .select({
                            id: schema.organizations.id,
                            name: schema.organizations.name,
                            type: schema.organizations.type,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
                        // Get user buildings (through organization relationships)
                        const userBuildings = await db_1.db
                            .select({
                            id: schema.buildings.id,
                            name: schema.buildings.name,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.buildings.organizationId))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
                        // Get user residences
                        const userResidences = await db_1.db
                            .select({
                            id: schema.residences.id,
                            unitNumber: schema.residences.unitNumber,
                            buildingId: schema.residences.buildingId,
                            buildingName: schema.buildings.name,
                        })
                            .from(schema.userResidences)
                            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                        return {
                            ...user,
                            organizations: userOrgs || [],
                            buildings: userBuildings || [],
                            residences: userResidences || [],
                        };
                    }
                    catch (error) {
                        console.error('‚ùå Error getting user assignments:', error);
                        // Return user with empty assignments if there's an error
                        return {
                            ...user,
                            organizations: [],
                            buildings: [],
                            residences: [],
                        };
                    }
                }));
                usersWithAssignments.push(...batchResults);
            }
            return { users: usersWithAssignments, total };
        }
        catch (error) {
            console.error('‚ùå Critical error getting paginated users with assignments:', error);
            // Return empty result on critical error
            return { users: [], total: 0 };
        }
    }
    /**
     * Retrieves users from organizations that a specific user has access to.
     * @param userId
     */
    async getUsersByOrganizations(userId) {
        return this.withOptimizations('getUsersByOrganizations', `users_by_org:${userId}`, 'users', async () => {
            // First, get organization IDs that the user has access to
            const userOrgs = await db_1.db
                .select({ organizationId: schema.userOrganizations.organizationId })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            if (userOrgs.length === 0) {
                return [];
            }
            const organizationIds = userOrgs.map((org) => org.organizationId);
            // Then get all users from those organizations
            return db_1.db
                .select({
                id: schema.users.id,
                username: schema.users.username,
                password: schema.users.password,
                email: schema.users.email,
                firstName: schema.users.firstName,
                lastName: schema.users.lastName,
                phone: schema.users.phone,
                profileImage: schema.users.profileImage,
                language: schema.users.language,
                role: schema.users.role,
                isActive: schema.users.isActive,
                lastLoginAt: schema.users.lastLoginAt,
                createdAt: schema.users.createdAt,
                updatedAt: schema.users.updatedAt,
            })
                .from(schema.users)
                .innerJoin(schema.userOrganizations, (0, drizzle_orm_1.eq)(schema.users.id, schema.userOrganizations.userId))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, organizationIds)))
                .orderBy(schema.users.firstName, schema.users.lastName);
        });
    }
    /**
     * Gets paginated users with optimized query structure.
     * @param options
     * @param _options
     */
    async getPaginatedUsers(_options) {
        database_optimization_1.PaginationHelper.validatePagination(_options);
        const cacheKey = `paginated_users:${_options.page}:${_options.pageSize}:${_options.sortBy}:${_options.sortDirection}`;
        // Try cache first
        const cached = query_cache_1.queryCache.get('users', cacheKey);
        if (cached) {
            return cached;
        }
        // Get total count using covering index
        const [{ count: total }] = await db_1.db
            .select({ count: (0, drizzle_orm_1.count)() })
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true));
        // Get paginated results with LIMIT and optimized ORDER BY
        const users = await db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .orderBy(_options.sortDirection === 'DESC' ? (0, drizzle_orm_1.desc)(schema.users.createdAt) : schema.users.createdAt)
            .limit(_options.pageSize)
            .offset((_options.page - 1) * _options.pageSize);
        const result = { users, total };
        query_cache_1.queryCache.set('users', cacheKey, result);
        return result;
    }
    /**
     * Gets buildings with residents using EXISTS instead of IN subquery.
     * @param organizationId
     * @param limit
     */
    async getBuildingsWithResidents(organizationId, limit = 50) {
        const cacheKey = `buildings_with_residents:${organizationId}:${limit}`;
        return this.withOptimizations('getBuildingsWithResidents', cacheKey, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true), (0, drizzle_orm_2.exists)(db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true))))))
            .limit(limit) // Always use LIMIT for large result sets
        );
    }
    /**
     * Searches users with optimized covering index and LIMIT.
     * @param query
     * @param limit
     */
    async searchUsers(query, limit = 20) {
        const cacheKey = `search_users:${query}:${limit}`;
        return this.withOptimizations('searchUsers', cacheKey, 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.or)((0, drizzle_orm_1.like)(schema.users.email, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.firstName, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.lastName, `%${query}%`))))
            .limit(limit) // Always limit search results
            .orderBy(schema.users.lastName, schema.users.firstName));
    }
    /**
     * Gets financial summary using materialized view for complex aggregations.
     * @param buildingId
     */
    async getFinancialSummary(buildingId) {
        const cacheKey = `financial_summary:${buildingId}`;
        return this.withOptimizations('getFinancialSummary', cacheKey, 'financial', async () => {
            // Use materialized view for complex aggregations
            const summary = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_financial_summary WHERE building_id = ${buildingId} ORDER BY month DESC LIMIT 12`);
            return summary.rows;
        });
    }
    /**
     * Gets building statistics using materialized view.
     * @param buildingId
     */
    async getBuildingStats(buildingId) {
        const cacheKey = `building_stats:${buildingId}`;
        return this.withOptimizations('getBuildingStats', cacheKey, 'buildings', async () => {
            // Use materialized view for dashboard statistics
            const stats = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_building_stats WHERE building_id = ${buildingId}`);
            return stats.rows[0];
        });
    }
    /**
     * Retrieves a specific user by ID with caching.
     * @param id
     */
    async getUser(id) {
        return this.withOptimizations('getUser', `user:${id}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, id));
            // User lookup completed
            return result[0];
        });
    }
    /**
     * Retrieves a user by email with caching.
     * @param email
     */
    async getUserByEmail(email) {
        return this.withOptimizations('getUserByEmail', `user_email:${email}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, email));
            return result[0];
        });
    }
    /**
     * Creates a new user with cache invalidation.
     * @param insertUser
     */
    async createUser(insertUser) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createUser', async () => {
            // Automatically set demo password for demo role users
            let password = insertUser.password;
            const isDemoRole = ['demo_manager', 'demo_tenant', 'demo_resident'].includes(insertUser.role);
            if (isDemoRole) {
                // Always set the standard demo password hash for demo users, regardless of provided password
                password = '$2b$12$cOc/QjMjzlhqAQqF2b/MTOZr2QAtERbXJGd4OSa1CXMlF04FC3F02'; // demo123456
                console.log('üé≠ Setting demo password for user with role:', insertUser.role);
            }
            // Ensure username uniqueness with random numbers if collision occurs
            let uniqueUsername = insertUser.username;
            let attempts = 0;
            const maxAttempts = 10;
            // Check for username collision
            let existingUser = await db_1.db
                .select({ username: schema.users.username })
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.username, uniqueUsername))
                .limit(1);
            while (existingUser.length > 0 && attempts < maxAttempts) {
                // Generate random 4-digit suffix
                const randomSuffix = Math.floor(1000 + Math.random() * 9000);
                uniqueUsername = `${insertUser.username}${randomSuffix}`;
                attempts++;
                existingUser = await db_1.db
                    .select({ username: schema.users.username })
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.username, uniqueUsername))
                    .limit(1);
            }
            if (attempts >= maxAttempts && existingUser.length > 0) {
                throw new Error('Unable to generate unique username after maximum attempts');
            }
            // Filter only the fields that exist in the database schema
            const userData = {
                username: uniqueUsername,
                email: insertUser.email,
                password,
                firstName: insertUser.firstName,
                lastName: insertUser.lastName,
                phone: insertUser.phone || '',
                profileImage: insertUser.profileImage,
                language: insertUser.language || 'fr',
                role: insertUser.role,
                isActive: true, // Default value for new users
            };
            try {
                const inserted = await db_1.db.insert(schema.users).values([userData]).returning();
                return inserted;
            }
            catch (error) {
                console.error('‚ùå Error creating user:', error);
                throw error;
            }
        });
        // Invalidate related caches
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    /**
     * Updates a user with cache invalidation.
     * @param id
     * @param updates
     */
    async updateUser(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateUser', async () => {
            return db_1.db
                .update(schema.users)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.users.id, id))
                .returning();
        });
        // Invalidate specific user caches
        query_cache_1.CacheInvalidator.invalidateUserCaches(id);
        return result[0];
    }
    /**
     * Retrieves organizations for a specific user.
     * @param userId
     */
    async getUserOrganizations(userId) {
        return this.withOptimizations('getUserOrganizations', `user_orgs:${userId}`, 'users', async () => {
            const result = await db_1.db
                .select({
                organizationId: schema.userOrganizations.organizationId,
            })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            return result;
        });
    }
    /**
     * Retrieves residences for a specific user.
     * @param userId
     */
    async getUserResidences(userId) {
        return this.withOptimizations('getUserResidences', `user_residences:${userId}`, 'residences', async () => {
            const result = await db_1.db
                .select({
                residenceId: schema.userResidences.residenceId,
            })
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)));
            return result;
        });
    }
    // Organization operations with optimization
    /**
     * Retrieves all active organizations with caching.
     */
    async getOrganizations() {
        return this.withOptimizations('getOrganizations', 'all_organizations', 'organizations', () => db_1.db.select().from(schema.organizations).where((0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
    }
    /**
     * Retrieves an organization by ID with caching.
     * @param id
     */
    async getOrganization(id) {
        return this.withOptimizations('getOrganization', `organization:${id}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new organization with cache invalidation.
     * @param insertOrganization
     */
    async createOrganization(insertOrganization) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createOrganization', async () => {
            return db_1.db.insert(schema.organizations).values(insertOrganization).returning();
        });
        // Invalidate organization caches
        query_cache_1.queryCache.invalidate('organizations');
        return result[0];
    }
    // Building operations with optimization
    /**
     * Retrieves buildings by organization with caching.
     * @param organizationId
     */
    async getBuildingsByOrganization(organizationId) {
        return this.withOptimizations('getBuildingsByOrganization', `org_buildings:${organizationId}`, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true))));
    }
    /**
     * Retrieves a building by ID with caching.
     * @param id
     */
    async getBuilding(id) {
        return this.withOptimizations('getBuilding', `building:${id}`, 'buildings', async () => {
            const result = await db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new building with cache invalidation.
     * @param insertBuilding
     */
    async createBuilding(insertBuilding) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createBuilding', async () => {
            return db_1.db.insert(schema.buildings).values([insertBuilding]).returning();
        });
        // Invalidate building caches
        query_cache_1.CacheInvalidator.invalidateBuildingCaches('*');
        return result[0];
    }
    // Residence operations with optimization
    /**
     * Retrieves residences by building with caching.
     * @param buildingId
     */
    async getResidencesByBuilding(buildingId) {
        return this.withOptimizations('getResidencesByBuilding', `building_residences:${buildingId}`, 'residences', () => db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)))
            .orderBy(schema.residences.unitNumber));
    }
    /**
     * Retrieves a residence by ID with caching.
     * @param id
     */
    async getResidence(id) {
        return this.withOptimizations('getResidence', `residence:${id}`, 'residences', async () => {
            const result = await db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new residence with cache invalidation.
     * @param insertResidence
     */
    async createResidence(insertResidence) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createResidence', async () => {
            return db_1.db.insert(schema.residences).values([insertResidence]).returning();
        });
        // Invalidate residence caches
        query_cache_1.CacheInvalidator.invalidateResidenceCaches('*');
        return result[0];
    }
    // Additional optimized methods for frequently accessed data
    /**
     * Gets user residences with full details - for complex residence views.
     * @param userId
     */
    async getUserResidencesWithDetails(userId) {
        return this.withOptimizations('getUserResidencesWithDetails', `user_residences_details:${userId}`, 'residences', () => db_1.db
            .select({
            residence: schema.residences,
            building: schema.buildings,
            userResidence: schema.userResidences,
        })
            .from(schema.userResidences)
            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true))));
    }
    /**
     * Gets active bills for a residence - frequently queried.
     * @param residenceId
     */
    async getActiveBillsByResidence(residenceId) {
        return this.withOptimizations('getActiveBillsByResidence', `residence_bills:${residenceId}`, 'bills', () => db_1.db
            .select()
            .from(schema.bills)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.bills.residenceId, residenceId), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema.bills.status, 'sent'), (0, drizzle_orm_1.eq)(schema.bills.status, 'overdue'))))
            .orderBy((0, drizzle_orm_1.desc)(schema.bills.dueDate)));
    }
    /**
     * Gets maintenance requests for a residence - frequently accessed.
     * @param residenceId
     */
    async getMaintenanceRequestsByResidence(residenceId) {
        return this.withOptimizations('getMaintenanceRequestsByResidence', `residence_maintenance:${residenceId}`, 'maintenance', () => db_1.db
            .select()
            .from(schema.maintenanceRequests)
            .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.residenceId, residenceId))
            .orderBy((0, drizzle_orm_1.desc)(schema.maintenanceRequests.createdAt)));
    }
    // Missing Organization operations
    /**
     * Gets organization by name with caching.
     * @param name
     */
    async getOrganizationByName(name) {
        return this.withOptimizations('getOrganizationByName', `org_name:${name}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.name, name));
            return result[0];
        });
    }
    /**
     * Updates organization with cache invalidation.
     * @param id
     * @param updates
     */
    async updateOrganization(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateOrganization', async () => {
            return db_1.db
                .update(schema.organizations)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    // Missing Building operations
    /**
     * Gets all buildings with caching.
     */
    async getBuildings() {
        return this.withOptimizations('getBuildings', 'all_buildings', 'buildings', () => db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
    }
    /**
     * Updates building with cache invalidation.
     * @param id
     * @param updates
     */
    async updateBuilding(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result[0];
    }
    /**
     * Deletes building (soft delete).
     * @param id
     */
    async deleteBuilding(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result.length > 0;
    }
    // Missing Residence operations
    /**
     * Gets all residences with caching.
     */
    async getResidences() {
        return this.withOptimizations('getResidences', 'all_residences', 'residences', () => db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
    }
    /**
     * Updates residence with cache invalidation.
     * @param id
     * @param updates
     */
    async updateResidence(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result[0];
    }
    /**
     * Deletes residence (soft delete).
     * @param id
     */
    async deleteResidence(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result.length > 0;
    }
    // Development Pillar operations
    /**
     * Gets all development pillars.
     */
    async getPillars() {
        return this.withOptimizations('getPillars', 'all_pillars', 'pillars', () => db_1.db.select().from(schema.developmentPillars));
    }
    /**
     * Gets development pillar by ID.
     * @param id
     */
    async getPillar(id) {
        return this.withOptimizations('getPillar', `pillar:${id}`, 'pillars', async () => {
            const result = await db_1.db
                .select()
                .from(schema.developmentPillars)
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id));
            return result[0];
        });
    }
    /**
     * Creates development pillar.
     * @param pillar
     */
    async createPillar(pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createPillar', async () => {
            return db_1.db.insert(schema.developmentPillars).values(pillar).returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    /**
     * Updates development pillar.
     * @param id
     * @param pillar
     */
    async updatePillar(id, pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updatePillar', async () => {
            return db_1.db
                .update(schema.developmentPillars)
                .set({ ...pillar, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    // Workspace Status operations
    /**
     * Gets all workspace statuses.
     */
    async getWorkspaceStatuses() {
        return this.withOptimizations('getWorkspaceStatuses', 'all_workspace_statuses', 'workspace_status', () => db_1.db.select().from(schema.workspaceStatus));
    }
    /**
     * Gets workspace status by component.
     * @param component
     */
    async getWorkspaceStatus(component) {
        return this.withOptimizations('getWorkspaceStatus', `workspace_status:${component}`, 'workspace_status', async () => {
            const result = await db_1.db
                .select()
                .from(schema.workspaceStatus)
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component));
            return result[0];
        });
    }
    /**
     * Creates workspace status.
     * @param status
     */
    async createWorkspaceStatus(status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createWorkspaceStatus', async () => {
            return db_1.db.insert(schema.workspaceStatus).values(status).returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    /**
     * Updates workspace status.
     * @param component
     * @param status
     */
    async updateWorkspaceStatus(component, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateWorkspaceStatus', async () => {
            return db_1.db
                .update(schema.workspaceStatus)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component))
                .returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    // Quality Metrics operations
    /**
     * Gets all quality metrics.
     */
    async getQualityMetrics() {
        return this.withOptimizations('getQualityMetrics', 'all_quality_metrics', 'quality_metrics', () => db_1.db.select().from(schema.qualityMetrics));
    }
    /**
     * Creates quality metric.
     * @param metric
     */
    async createQualityMetric(metric) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createQualityMetric', async () => {
            return db_1.db.insert(schema.qualityMetrics).values(metric).returning();
        });
        query_cache_1.queryCache.invalidate('quality_metrics');
        return result[0];
    }
    // Framework Configuration operations
    /**
     * Gets all framework configurations.
     */
    async getFrameworkConfigs() {
        return this.withOptimizations('getFrameworkConfigs', 'all_framework_configs', 'framework_configs', () => db_1.db.select().from(schema.frameworkConfiguration));
    }
    /**
     * Gets framework config by key.
     * @param key
     * @param _key
     */
    async getFrameworkConfig(_key) {
        return this.withOptimizations('getFrameworkConfig', `framework_config:${_key}`, 'framework_configs', async () => {
            const result = await db_1.db
                .select()
                .from(schema.frameworkConfiguration)
                .where((0, drizzle_orm_1.eq)(schema.frameworkConfiguration._key, _key));
            return result[0];
        });
    }
    /**
     * Sets framework configuration.
     * @param config
     */
    async setFrameworkConfig(config) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('setFrameworkConfig', async () => {
            return db_1.db
                .insert(schema.frameworkConfiguration)
                .values(config)
                .onConflictDoUpdate({
                target: schema.frameworkConfiguration._key,
                set: { _value: config._value, updatedAt: new Date() },
            })
                .returning();
        });
        query_cache_1.queryCache.invalidate('framework_configs');
        return result[0];
    }
    // Improvement Suggestions operations
    /**
     * Gets all improvement suggestions.
     */
    async getImprovementSuggestions() {
        return this.withOptimizations('getImprovementSuggestions', 'all_improvement_suggestions', 'improvement_suggestions', () => db_1.db.select().from(schema.improvementSuggestions));
    }
    /**
     * Gets top improvement suggestions.
     * @param limit
     */
    async getTopImprovementSuggestions(limit) {
        return this.withOptimizations('getTopImprovementSuggestions', `top_suggestions:${limit}`, 'improvement_suggestions', () => db_1.db
            .select()
            .from(schema.improvementSuggestions)
            .orderBy((0, drizzle_orm_1.desc)(schema.improvementSuggestions.priority), (0, drizzle_orm_1.desc)(schema.improvementSuggestions.createdAt))
            .limit(limit));
    }
    /**
     * Creates improvement suggestion.
     * @param suggestion
     */
    async createImprovementSuggestion(suggestion) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createImprovementSuggestion', async () => {
            return db_1.db
                .insert(schema.improvementSuggestions)
                .values([
                {
                    ...suggestion,
                    category: suggestion.category,
                },
            ])
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    /**
     * Clears new suggestions.
     */
    async clearNewSuggestions() {
        await performance_monitoring_1.dbPerformanceMonitor.trackQuery('clearNewSuggestions', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status: 'Acknowledged' })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.status, 'New'));
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
    }
    /**
     * Updates suggestion status.
     * @param id
     * @param status
     */
    async updateSuggestionStatus(id, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateSuggestionStatus', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    // Features operations
    /**
     * Gets all features.
     */
    async getFeatures() {
        return this.withOptimizations('getFeatures', 'all_features', 'features', () => db_1.db.select().from(schema.features));
    }
    /**
     * Gets features by status.
     * @param status
     */
    async getFeaturesByStatus(status) {
        return this.withOptimizations('getFeaturesByStatus', `features_status:${status}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.status, status)));
    }
    /**
     * Gets features by category.
     * @param category
     */
    async getFeaturesByCategory(category) {
        return this.withOptimizations('getFeaturesByCategory', `features_category:${category}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.category, category)));
    }
    /**
     * Gets public roadmap features.
     */
    async getPublicRoadmapFeatures() {
        return this.withOptimizations('getPublicRoadmapFeatures', 'public_roadmap_features', 'features', () => db_1.db.select().from(schema.features).where((0, drizzle_orm_1.eq)(schema.features.isPublicRoadmap, true)));
    }
    /**
     * Creates feature.
     * @param feature
     */
    async createFeature(feature) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeature', async () => {
            return db_1.db.insert(schema.features).values([feature]).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Updates feature.
     * @param id
     * @param updates
     */
    async updateFeature(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeature', async () => {
            return db_1.db
                .update(schema.features)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.features.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Deletes feature.
     * @param id
     */
    async deleteFeature(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteFeature', async () => {
            return db_1.db.delete(schema.features).where((0, drizzle_orm_1.eq)(schema.features.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result.length > 0;
    }
    // Actionable Items operations
    /**
     * Gets actionable items by feature.
     * @param featureId
     */
    async getActionableItemsByFeature(featureId) {
        return this.withOptimizations('getActionableItemsByFeature', `actionable_items:${featureId}`, 'actionable_items', () => db_1.db
            .select()
            .from(schema.actionableItems)
            .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId)));
    }
    /**
     * Gets actionable item by ID.
     * @param id
     */
    async getActionableItem(id) {
        return this.withOptimizations('getActionableItem', `actionable_item:${id}`, 'actionable_items', async () => {
            const result = await db_1.db
                .select()
                .from(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id));
            return result[0];
        });
    }
    /**
     * Creates actionable item.
     * @param item
     */
    async createActionableItem(item) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItem', async () => {
            return db_1.db.insert(schema.actionableItems).values([item]).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Creates multiple actionable items.
     * @param items
     */
    async createActionableItems(items) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItems', async () => {
            return db_1.db.insert(schema.actionableItems).values(items).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result;
    }
    /**
     * Updates actionable item.
     * @param id
     * @param updates
     */
    async updateActionableItem(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateActionableItem', async () => {
            return db_1.db
                .update(schema.actionableItems)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Deletes actionable item.
     * @param id
     */
    async deleteActionableItem(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItem', async () => {
            return db_1.db.delete(schema.actionableItems).where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    /**
     * Deletes actionable items by feature.
     * @param featureId
     */
    async deleteActionableItemsByFeature(featureId) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItemsByFeature', async () => {
            return db_1.db
                .delete(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    // Invitation operations
    /**
     * Gets all invitations.
     */
    async getInvitations() {
        return this.withOptimizations('getInvitations', 'all_invitations', 'invitations', () => db_1.db.select().from(schema.invitations));
    }
    /**
     * Gets invitation by ID.
     * @param id
     */
    async getInvitation(id) {
        return this.withOptimizations('getInvitation', `invitation:${id}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id));
            return result[0];
        });
    }
    /**
     * Gets invitation by token.
     * @param token
     */
    async getInvitationByToken(token) {
        return this.withOptimizations('getInvitationByToken', `invitation_token:${token}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token));
            return result[0];
        });
    }
    /**
     * Gets invitations by email.
     * @param email
     */
    async getInvitationsByEmail(email) {
        return this.withOptimizations('getInvitationsByEmail', `invitations_email:${email}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, email)));
    }
    /**
     * Gets invitations by inviter.
     * @param userId
     */
    async getInvitationsByInviter(userId) {
        return this.withOptimizations('getInvitationsByInviter', `invitations_inviter:${userId}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, userId)));
    }
    /**
     * Gets invitations by status.
     * @param status
     */
    async getInvitationsByStatus(status) {
        return this.withOptimizations('getInvitationsByStatus', `invitations_status:${status}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.status, status)));
    }
    /**
     * Creates invitation.
     * @param invitation
     */
    async createInvitation(invitation) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitation', async () => {
            return db_1.db.insert(schema.invitations).values([invitation]).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Updates invitation.
     * @param id
     * @param updates
     */
    async updateInvitation(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Accepts invitation.
     * @param token
     * @param userData
     * @param userData.firstName
     * @param ipAddress
     * @param userData.lastName
     * @param userAgent
     * @param userData.password
     */
    async acceptInvitation(token, userData, ipAddress, userAgent) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('acceptInvitation', async () => {
            const invitation = await this.getInvitationByToken(token);
            if (!invitation || invitation.status !== 'pending') {
                return null;
            }
            // Create user with required fields
            const user = await this.createUser({
                username: invitation.email.split('@')[0], // Use email prefix as username
                email: invitation.email,
                firstName: userData.firstName,
                lastName: userData.lastName,
                password: userData.password, // This should be hashed
                language: 'en', // Default language
                role: invitation.role,
            });
            // Update invitation
            const updatedInvitation = await this.updateInvitation(invitation.id, {
                status: 'accepted',
                acceptedAt: new Date(),
            });
            return { user, invitation: updatedInvitation };
        });
    }
    /**
     * Cancels invitation.
     * @param id
     * @param cancelledBy
     */
    async cancelInvitation(id, cancelledBy) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('cancelInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({
                status: 'cancelled',
                cancelledBy,
                cancelledAt: new Date(),
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Expires old invitations.
     */
    async expireInvitations() {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('expireInvitations', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({ status: 'expired', updatedAt: new Date() })
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.status, 'pending'), (0, drizzle_orm_1.lte)(schema.invitations.expiresAt, new Date())))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length;
    }
    /**
     * Deletes invitation.
     * @param id
     */
    async deleteInvitation(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteInvitation', async () => {
            return db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length > 0;
    }
    // Invitation Audit Log operations
    /**
     * Gets invitation audit logs.
     * @param invitationId
     */
    async getInvitationAuditLogs(invitationId) {
        return this.withOptimizations('getInvitationAuditLogs', `invitation_logs:${invitationId}`, 'invitation_logs', () => db_1.db
            .select()
            .from(schema.invitationAuditLog)
            .where((0, drizzle_orm_1.eq)(schema.invitationAuditLog.invitationId, invitationId))
            .orderBy((0, drizzle_orm_1.desc)(schema.invitationAuditLog.createdAt)));
    }
    /**
     * Creates invitation audit log.
     * @param logEntry
     */
    async createInvitationAuditLog(logEntry) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitationAuditLog', async () => {
            return db_1.db.insert(schema.invitationAuditLog).values(logEntry).returning();
        });
        query_cache_1.queryCache.invalidate('invitation_logs');
        return result[0];
    }
    // Permission operations
    /**
     * Gets all permissions.
     */
    async getPermissions() {
        return this.withOptimizations('getPermissions', 'permissions:all', 'permissions', () => db_1.db
            .select()
            .from(schema.permissions)
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.permissions.resourceType, schema.permissions.action));
    }
    /**
     * Gets all role permissions.
     */
    async getRolePermissions() {
        return this.withOptimizations('getRolePermissions', 'role_permissions:all', 'role_permissions', () => db_1.db
            .select()
            .from(schema.rolePermissions)
            .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.rolePermissions.permissionId, schema.permissions.id))
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.rolePermissions.role, schema.permissions.resourceType));
    }
    /**
     * Gets all user permissions.
     */
    async getUserPermissions() {
        try {
            const results = await db_1.db
                .select()
                .from(schema.userPermissions)
                .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.userPermissions.permissionId, schema.permissions.id))
                .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
                .orderBy(schema.userPermissions.userId);
            return results || [];
        }
        catch (error) {
            console.error('‚ùå Error getting user permissions:', error);
            return [];
        }
    }
    // Old building document methods removed - using unified documents table
    // Unified Document operations
    async getDocuments(filters) {
        const operationId = crypto_1.default.randomUUID();
        this.logStorageOperation('getDocuments_START', {
            operationId,
            filters: filters || {},
            cacheKey: `documents:${JSON.stringify(filters)}`
        }, 'DEBUG');
        return this.withOptimizations('getDocuments', `documents:${JSON.stringify(filters)}`, 'documents', async () => {
            this.logStorageOperation('getDocuments_QUERY_BUILD', {
                operationId,
                filters: filters || {}
            }, 'DEBUG');
            let query = db_1.db.select().from(schema.documents);
            const conditions = [];
            if (filters?.buildingId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.buildingId, filters.buildingId));
                this.logStorageOperation('getDocuments_FILTER_BUILDING', {
                    operationId,
                    buildingId: filters.buildingId
                }, 'DEBUG');
            }
            if (filters?.residenceId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.residenceId, filters.residenceId));
                this.logStorageOperation('getDocuments_FILTER_RESIDENCE', {
                    operationId,
                    residenceId: filters.residenceId
                }, 'DEBUG');
            }
            if (filters?.documentType) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.documentType, filters.documentType));
                this.logStorageOperation('getDocuments_FILTER_TYPE', {
                    operationId,
                    documentType: filters.documentType
                }, 'DEBUG');
            }
            if (conditions.length > 0) {
                query = query.where((0, drizzle_orm_1.and)(...conditions));
                this.logStorageOperation('getDocuments_CONDITIONS_APPLIED', {
                    operationId,
                    conditionCount: conditions.length
                }, 'DEBUG');
            }
            const dbStart = performance.now();
            const result = await query.orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
            const dbTime = performance.now() - dbStart;
            this.logStorageOperation('getDocuments_QUERY_EXECUTED', {
                operationId,
                resultCount: result?.length || 0,
                dbExecutionTime: `${dbTime.toFixed(2)}ms`,
                filters: filters || {}
            }, 'DEBUG');
            return result || [];
        });
    }
    async getDocument(id) {
        return this.withOptimizations('getDocument', `document:${id}`, 'documents', async () => {
            const result = await db_1.db
                .select()
                .from(schema.documents)
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .limit(1);
            return result[0];
        });
    }
    async createDocument(document) {
        const operationId = crypto_1.default.randomUUID();
        this.logStorageOperation('createDocument_START', {
            operationId,
            documentData: {
                name: document.name,
                documentType: document.documentType,
                buildingId: document.buildingId,
                residenceId: document.residenceId,
                uploadedById: document.uploadedById,
                filePath: document.filePath,
                isVisibleToTenants: document.isVisibleToTenants
            }
        }, 'INFO');
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('createDocument', async () => {
            try {
                const dbStart = performance.now();
                const result = await db_1.db.insert(schema.documents).values(document).returning();
                const dbTime = performance.now() - dbStart;
                this.logStorageOperation('createDocument_SUCCESS', {
                    operationId,
                    documentId: result[0]?.id,
                    dbExecutionTime: `${dbTime.toFixed(2)}ms`,
                    insertedData: {
                        name: result[0]?.name,
                        documentType: result[0]?.documentType,
                        filePath: result[0]?.filePath
                    }
                }, 'INFO');
                // Cache invalidation with logging
                if (document.buildingId) {
                    query_cache_1.queryCache.invalidate('documents', `*buildingId*${document.buildingId}*`);
                    this.logStorageOperation('createDocument_CACHE_INVALIDATED', {
                        operationId,
                        cachePattern: `*buildingId*${document.buildingId}*`
                    }, 'DEBUG');
                }
                if (document.residenceId) {
                    query_cache_1.queryCache.invalidate('documents', `*residenceId*${document.residenceId}*`);
                    this.logStorageOperation('createDocument_CACHE_INVALIDATED', {
                        operationId,
                        cachePattern: `*residenceId*${document.residenceId}*`
                    }, 'DEBUG');
                }
                return result[0];
            }
            catch (error) {
                this.logStorageOperation('createDocument_ERROR', {
                    operationId,
                    error: error.message,
                    errorCode: error.code,
                    documentData: {
                        name: document.name,
                        documentType: document.documentType,
                        buildingId: document.buildingId,
                        residenceId: document.residenceId
                    }
                }, 'ERROR');
                throw error;
            }
        });
    }
    async updateDocument(id, updates) {
        const operationId = crypto_1.default.randomUUID();
        this.logStorageOperation('updateDocument_START', {
            operationId,
            documentId: id,
            updates: {
                fieldsBeingUpdated: Object.keys(updates),
                hasFilePathUpdate: !!updates.filePath,
                hasNameUpdate: !!updates.name,
                hasVisibilityUpdate: !!updates.isVisibleToTenants
            }
        }, 'INFO');
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateDocument', async () => {
            try {
                const dbStart = performance.now();
                const result = await db_1.db
                    .update(schema.documents)
                    .set({ ...updates, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                    .returning();
                const dbTime = performance.now() - dbStart;
                if (result[0]) {
                    this.logStorageOperation('updateDocument_SUCCESS', {
                        operationId,
                        documentId: id,
                        dbExecutionTime: `${dbTime.toFixed(2)}ms`,
                        updatedFields: Object.keys(updates),
                        resultData: {
                            name: result[0].name,
                            documentType: result[0].documentType,
                            filePath: result[0].filePath,
                            updatedAt: result[0].updatedAt
                        }
                    }, 'INFO');
                    // Cache invalidation with logging
                    query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                    query_cache_1.queryCache.invalidate('documents', '*');
                    this.logStorageOperation('updateDocument_CACHE_INVALIDATED', {
                        operationId,
                        documentId: id,
                        cachePatterns: [`document:${id}`, '*']
                    }, 'DEBUG');
                }
                else {
                    this.logStorageOperation('updateDocument_NOT_FOUND', {
                        operationId,
                        documentId: id,
                        dbExecutionTime: `${dbTime.toFixed(2)}ms`
                    }, 'WARN');
                }
                return result[0];
            }
            catch (error) {
                this.logStorageOperation('updateDocument_ERROR', {
                    operationId,
                    documentId: id,
                    error: error.message,
                    errorCode: error.code,
                    updates: Object.keys(updates)
                }, 'ERROR');
                throw error;
            }
        });
    }
    async deleteDocument(id) {
        const operationId = crypto_1.default.randomUUID();
        this.logStorageOperation('deleteDocument_START', {
            operationId,
            documentId: id
        }, 'INFO');
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteDocument', async () => {
            try {
                // First get document info for logging
                const documentInfo = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    documentType: schema.documents.documentType,
                    filePath: schema.documents.filePath,
                    buildingId: schema.documents.buildingId,
                    residenceId: schema.documents.residenceId
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                    .limit(1);
                if (documentInfo.length === 0) {
                    this.logStorageOperation('deleteDocument_NOT_FOUND', {
                        operationId,
                        documentId: id
                    }, 'WARN');
                    return false;
                }
                const dbStart = performance.now();
                const result = await db_1.db
                    .delete(schema.documents)
                    .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                    .returning({ id: schema.documents.id });
                const dbTime = performance.now() - dbStart;
                if (result.length > 0) {
                    this.logStorageOperation('deleteDocument_SUCCESS', {
                        operationId,
                        documentId: id,
                        dbExecutionTime: `${dbTime.toFixed(2)}ms`,
                        deletedDocument: {
                            name: documentInfo[0].name,
                            documentType: documentInfo[0].documentType,
                            filePath: documentInfo[0].filePath,
                            buildingId: documentInfo[0].buildingId,
                            residenceId: documentInfo[0].residenceId
                        }
                    }, 'INFO');
                    // Cache invalidation with logging
                    query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                    query_cache_1.queryCache.invalidate('documents', '*');
                    this.logStorageOperation('deleteDocument_CACHE_INVALIDATED', {
                        operationId,
                        documentId: id,
                        cachePatterns: [`document:${id}`, '*']
                    }, 'DEBUG');
                    return true;
                }
                this.logStorageOperation('deleteDocument_FAILED', {
                    operationId,
                    documentId: id,
                    dbExecutionTime: `${dbTime.toFixed(2)}ms`
                }, 'WARN');
                return false;
            }
            catch (error) {
                this.logStorageOperation('deleteDocument_ERROR', {
                    operationId,
                    documentId: id,
                    error: error.message,
                    errorCode: error.code
                }, 'ERROR');
                throw error;
            }
        });
    }
    // Old resident document methods removed - using unified documents table
    // Legacy Document operations (kept for migration purposes)
    /**
     * Gets legacy documents for user.
     * @param userId
     * @param userRole
     * @param organizationId
     * @param residenceIds
     */
    async getDocumentsForUser(userId, userRole, organizationId, residenceIds) {
        return this.withOptimizations('getDocumentsForUser', `legacy_docs:${userId}:${userRole}`, 'documents', async () => {
            return await db_1.db.select().from(schema.documents).orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
        });
    }
    // Password reset operations
    /**
     *
     * @param token
     */
    async createPasswordResetToken(token) {
        const result = await db_1.db.insert(schema.passwordResetTokens).values(token).returning();
        // Token created successfully
        return result[0];
    }
    /**
     *
     * @param tokenValue
     */
    async getPasswordResetToken(tokenValue) {
        return this.withOptimizations('getPasswordResetToken', `token_${tokenValue}`, 'password_reset_tokens', async () => {
            const result = await db_1.db
                .select()
                .from(schema.passwordResetTokens)
                .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.token, tokenValue))
                .limit(1);
            return result[0];
        });
    }
    /**
     *
     * @param tokenId
     */
    async markPasswordResetTokenAsUsed(tokenId) {
        const result = await db_1.db
            .update(schema.passwordResetTokens)
            .set({
            isUsed: true,
            usedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.id, tokenId))
            .returning();
        // Token marked as used
        return result[0];
    }
    /**
     *
     */
    async cleanupExpiredPasswordResetTokens() {
        const result = await db_1.db
            .delete(schema.passwordResetTokens)
            .where((0, drizzle_orm_1.lte)(schema.passwordResetTokens.expiresAt, new Date()))
            .returning();
        // Expired tokens cleaned up
        return result.length;
    }
    // Contact operations
    /**
     * Gets all contacts.
     */
    async getContacts() {
        return this.withOptimizations('getContacts', 'all_contacts', 'contacts', () => db_1.db.select().from(schema.contacts).where((0, drizzle_orm_1.eq)(schema.contacts.isActive, true)));
    }
    /**
     * Gets contacts by entity.
     * @param entityId
     * @param entity
     */
    async getContactsByEntity(entityId, entity) {
        return this.withOptimizations('getContactsByEntity', `contacts_entity:${entity}_${entityId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, entityId), (0, drizzle_orm_1.eq)(schema.contacts.entity, entity), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Gets contacts for residence with user data.
     * @param residenceId
     */
    async getContactsForResidence(residenceId) {
        return this.withOptimizations('getContactsForResidence', `contacts_residence:${residenceId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .innerJoin(schema.users, (0, drizzle_orm_1.eq)(schema.contacts.name, schema.users.email))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, residenceId), (0, drizzle_orm_1.eq)(schema.contacts.entity, 'residence'), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Creates a new contact.
     * @param contact
     */
    async createContact(contact) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createContact', async () => {
            return db_1.db.insert(schema.contacts).values(contact).returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Updates a contact.
     * @param id
     * @param updates
     */
    async updateContact(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Deletes a contact.
     * @param id
     */
    async deleteContact(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set({ isActive: false })
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result.length > 0;
    }
    /**
     * Gets demands for a user.
     * @param userId
     */
    async getDemandsForUser(userId) {
        return this.withOptimizations('getDemandsForUser', `demands_user:${userId}`, 'demands', () => db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.userId, userId)));
    }
    /**
     * Gets a specific demand.
     * @param id
     */
    async getDemand(id) {
        return this.withOptimizations('getDemand', `demand:${id}`, 'demands', async () => {
            const result = await db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.id, id));
            return result[0];
        });
    }
    // Bug operations implementation
    /**
     *
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBugsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getBugsForUser', `bugs:${userRole}:${userId}`, 'bugs', async () => {
            let results;
            if (userRole === 'admin') {
                // Admin can see all bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else if (userRole === 'manager' && organizationId) {
                // For managers, return all bugs for now (can be refined later)
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else {
                // For residents and tenants, return only their own bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .where((0, drizzle_orm_1.eq)(schema.bugs.createdBy, userId))
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            // Get attachment counts and details for each bug
            const bugsWithAttachments = await Promise.all(results.map(async (bug) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    fileName: schema.documents.fileName,
                    fileSize: schema.documents.fileSize,
                    filePath: schema.documents.filePath,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'bug'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, bug.id)));
                return {
                    ...bug,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.fileName || att.name,
                        size: parseInt(att.fileSize || '0'),
                        url: `/api/documents/${att.id}/file`,
                        type: att.fileName ? att.fileName.split('.').pop()?.toLowerCase() || 'unknown' : 'unknown'
                    }))
                };
            }));
            return bugsWithAttachments;
        });
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBug(id, userId, userRole, organizationId) {
        const key = `bug:${id}:user:${userId}:${userRole}`;
        console.log(`üîç getBug called with key: ${key}`);
        return (0, query_cache_1.withCache)('bug', key, async () => {
            console.log(`üìä Cache miss for ${key}, querying database...`);
            const result = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
            const bug = result[0];
            console.log(`üìã Database query result:`, bug ? { id: bug.id, title: bug.title, filePath: bug.filePath, file_path: bug.file_path } : 'undefined');
            if (!bug) {
                return undefined;
            }
            if (userRole === 'admin') {
                return bug;
            }
            if (userRole === 'manager') {
                return bug; // Managers can see all bugs for now
            }
            // Residents and tenants can only see their own bugs
            return bug.createdBy === userId ? bug : undefined;
        });
    }
    /**
     *
     * @param bugData
     */
    async createBug(bugData) {
        const result = await db_1.db
            .insert(schema.bugs)
            .values({
            ...bugData,
            id: crypto_1.default.randomUUID(),
            status: 'new',
            assignedTo: null,
            resolvedAt: null,
            resolvedBy: null,
            notes: null,
            createdAt: new Date(),
            updatedAt: new Date(),
        })
            .returning();
        // Invalidate cache for this user and specific bug queries  
        query_cache_1.queryCache.invalidate('bugs');
        query_cache_1.queryCache.invalidate('bug', `bug:${result[0].id}:*`);
        return result[0];
    }
    /**
     *
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateBug(id, updates, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return undefined;
        }
        // Access control: users can edit their own bugs, admins and managers can edit any bug
        const canEdit = userRole === 'admin' || userRole === 'manager' || existingBug.createdBy === userId;
        if (!canEdit) {
            return undefined;
        }
        const result = await db_1.db
            .update(schema.bugs)
            .set({
            ...updates,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.bugs.id, id))
            .returning();
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
        }
        return result[0];
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteBug(id, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return false;
        }
        // Access control: users can delete their own bugs, admins can delete any bug
        const canDelete = userRole === 'admin' || existingBug.createdBy === userId;
        if (!canDelete) {
            return false;
        }
        const result = await db_1.db.delete(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id)).returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
            return true;
        }
        return false;
    }
    // Feature Request operations with optimization
    /**
     * Retrieves feature requests for a user with role-based access control.
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequestsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequestsForUser', `feature_requests:${userRole}:${userId}`, 'feature_requests', async () => {
            const results = await db_1.db
                .select()
                .from(schema.featureRequests)
                .orderBy((0, drizzle_orm_1.desc)(schema.featureRequests.createdAt));
            // Get attachment counts and details for each feature request
            const requestsWithAttachments = await Promise.all(results.map(async (request) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    filePath: schema.documents.filePath,
                    fileSize: schema.documents.fileSize,
                    mimeType: schema.documents.mimeType,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'feature_request'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, request.id)));
                return {
                    ...request,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.name,
                        url: `/api/documents/${att.id}/file`,
                        size: att.fileSize ? parseInt(att.fileSize) : 0,
                        mimeType: att.mimeType,
                    })),
                };
            }));
            // All users can see all feature requests, but non-admins don't see who submitted
            if (userRole === 'admin') {
                return requestsWithAttachments;
            }
            // For non-admin users, hide the createdBy field
            return requestsWithAttachments.map((request) => ({
                ...request,
                createdBy: null,
            }));
        });
    }
    /**
     * Retrieves a specific feature request by ID with role-based access control.
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequest(id, userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequest', `feature_request:${id}:${userRole}`, 'feature_requests', async () => {
            const result = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id));
            const featureRequest = result[0];
            if (!featureRequest) {
                return undefined;
            }
            // All users can see any feature request
            if (userRole === 'admin') {
                return featureRequest;
            }
            // For non-admin users, hide the createdBy field
            return {
                ...featureRequest,
                createdBy: null,
            };
        });
    }
    /**
     * Creates a new feature request.
     * @param featureRequestData
     */
    async createFeatureRequest(featureRequestData) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeatureRequest', async () => {
            return db_1.db
                .insert(schema.featureRequests)
                .values({
                ...featureRequestData,
                id: crypto_1.default.randomUUID(),
                status: 'submitted',
                upvoteCount: 0,
                assignedTo: null,
                reviewedBy: null,
                reviewedAt: null,
                adminNotes: null,
                mergedIntoId: null,
                createdAt: new Date(),
                updatedAt: new Date(),
            })
                .returning();
        });
        // Invalidate cache
        query_cache_1.queryCache.invalidate('feature_requests');
        return result[0];
    }
    /**
     * Updates a feature request with role-based permissions.
     * Users can edit their own, managers can edit within org, admins can edit all.
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateFeatureRequest(id, updates, userId, userRole) {
        // Get existing feature request to check permissions
        const existingFeatureRequest = await db_1.db
            .select()
            .from(schema.featureRequests)
            .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
            .limit(1);
        if (!existingFeatureRequest[0]) {
            return undefined;
        }
        // Check permissions: users can edit their own, admins can edit all
        const canEdit = userRole === 'admin' || existingFeatureRequest[0].createdBy === userId;
        if (!canEdit) {
            return undefined;
        }
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeatureRequest', async () => {
            return db_1.db
                .update(schema.featureRequests)
                .set({
                ...updates,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
                .returning();
        });
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
        }
        return result[0];
    }
    /**
     * Deletes a feature request (admin only).
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteFeatureRequest(id, userId, userRole) {
        // Only admins can delete feature requests
        if (userRole !== 'admin') {
            return false;
        }
        // First delete all upvotes for this feature request
        await db_1.db
            .delete(schema.featureRequestUpvotes)
            .where((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, id));
        const result = await db_1.db
            .delete(schema.featureRequests)
            .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
            .returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return true;
        }
        return false;
    }
    /**
     * Upvotes a feature request.
     * @param upvoteData
     */
    async upvoteFeatureRequest(upvoteData) {
        const { featureRequestId, userId } = upvoteData;
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Check if user has already upvoted this feature request
            const existingUpvote = await db_1.db
                .select()
                .from(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)));
            if (existingUpvote.length > 0) {
                return {
                    success: false,
                    message: 'You have already upvoted this feature request',
                };
            }
            // Create the upvote
            const upvoteResult = await db_1.db
                .insert(schema.featureRequestUpvotes)
                .values({
                ...upvoteData,
                id: crypto_1.default.randomUUID(),
                createdAt: new Date(),
            })
                .returning();
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: (0, drizzle_orm_1.sql) `${schema.featureRequests.upvoteCount} + 1`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Feature request upvoted successfully',
                data: {
                    upvote: upvoteResult[0],
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('‚ùå Error upvoting feature request:', error);
            return {
                success: false,
                message: 'Failed to upvote feature request',
            };
        }
    }
    /**
     * Removes an upvote from a feature request.
     * @param featureRequestId
     * @param userId
     */
    async removeFeatureRequestUpvote(featureRequestId, userId) {
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Find and remove the upvote
            const removedUpvote = await db_1.db
                .delete(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)))
                .returning();
            if (removedUpvote.length === 0) {
                return {
                    success: false,
                    message: 'You have not upvoted this feature request',
                };
            }
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: (0, drizzle_orm_1.sql) `GREATEST(0, ${schema.featureRequests.upvoteCount} - 1)`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Upvote removed successfully',
                data: {
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('‚ùå Error removing feature request upvote:', error);
            return {
                success: false,
                message: 'Failed to remove upvote',
            };
        }
    }
    // Invoice operations
    async getInvoices(filters) {
        try {
            let query = db_1.db.select().from(schema.invoices);
            const conditions = [];
            if (filters) {
                if (filters.buildingId) {
                    conditions.push((0, drizzle_orm_1.eq)(schema.invoices.buildingId, filters.buildingId));
                }
                if (filters.residenceId) {
                    conditions.push((0, drizzle_orm_1.eq)(schema.invoices.residenceId, filters.residenceId));
                }
                if (filters.userId && filters.userRole) {
                    // Apply role-based filtering
                    if (filters.userRole === 'tenant' || filters.userRole === 'resident') {
                        conditions.push((0, drizzle_orm_1.eq)(schema.invoices.createdBy, filters.userId));
                    }
                    // Admin and manager can see all invoices (already filtered by building/residence above)
                }
            }
            if (conditions.length > 0) {
                query = query.where((0, drizzle_orm_1.and)(...conditions));
            }
            const invoices = await query.orderBy((0, drizzle_orm_1.desc)(schema.invoices.createdAt));
            return invoices;
        }
        catch (error) {
            console.error('‚ùå Error fetching invoices:', error);
            return [];
        }
    }
    async getInvoice(id) {
        try {
            const result = await db_1.db
                .select()
                .from(schema.invoices)
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .limit(1);
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error fetching invoice:', error);
            return undefined;
        }
    }
    async createInvoice(invoice) {
        try {
            const result = await db_1.db
                .insert(schema.invoices)
                .values(invoice)
                .returning();
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error creating invoice:', error);
            throw error;
        }
    }
    async updateInvoice(id, updates) {
        try {
            const result = await db_1.db
                .update(schema.invoices)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .returning();
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error updating invoice:', error);
            return undefined;
        }
    }
    async deleteInvoice(id) {
        try {
            const result = await db_1.db
                .delete(schema.invoices)
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .returning();
            return result.length > 0;
        }
        catch (error) {
            console.error('‚ùå Error deleting invoice:', error);
            return false;
        }
    }
    // Admin-only method to count orphan users
    async countOrphanUsers() {
        console.log('üìä [STORAGE - COUNT] ===== COUNT ORPHAN USERS STARTED =====');
        console.log('‚è∞ [STORAGE - COUNT] Timestamp:', new Date().toISOString());
        try {
            const countQuery = `
        SELECT COUNT(*) as total 
        FROM users u
        WHERE u.is_active = true
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )
      `;
            console.log('üîç [STORAGE - COUNT] Executing SQL query:', countQuery.trim());
            console.log('‚è±Ô∏è [STORAGE - COUNT] Starting database execution...');
            const startTime = Date.now();
            const result = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
            const endTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - COUNT] Database query completed in:', (endTime - startTime), 'ms');
            console.log('üìà [STORAGE - COUNT] Raw database result:', result.rows);
            const count = parseInt(result.rows[0]?.total || '0');
            console.log('üî¢ [STORAGE - COUNT] Parsed orphan count:', count);
            console.log('üìä [STORAGE - COUNT] ===== COUNT ORPHAN USERS COMPLETED =====');
            return count;
        }
        catch (error) {
            console.error('üí• [STORAGE - COUNT] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - COUNT] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - COUNT] ===== END CRITICAL ERROR =====');
            return 0;
        }
    }
    // Admin-only method to count all users except specified admin
    async countAllUsersExcept(excludeUserId) {
        console.log('üìä [STORAGE - COUNT ALL] ===== COUNT ALL USERS EXCEPT ADMIN STARTED =====');
        console.log('‚è∞ [STORAGE - COUNT ALL] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - COUNT ALL] Excluding admin user ID:', excludeUserId);
        try {
            const countQuery = `
        SELECT COUNT(*) as total 
        FROM users u
        WHERE u.is_active = true
        AND u.id != '${excludeUserId}'
      `;
            console.log('üîç [STORAGE - COUNT ALL] Executing SQL query:', countQuery.trim());
            console.log('‚è±Ô∏è [STORAGE - COUNT ALL] Starting database execution...');
            const startTime = Date.now();
            const result = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
            const endTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - COUNT ALL] Database query completed in:', (endTime - startTime), 'ms');
            console.log('üìà [STORAGE - COUNT ALL] Raw database result:', result.rows);
            const count = parseInt(result.rows[0]?.total || '0');
            console.log('üî¢ [STORAGE - COUNT ALL] Parsed user count:', count);
            console.log('üìä [STORAGE - COUNT ALL] ===== COUNT ALL USERS EXCEPT ADMIN COMPLETED =====');
            return count;
        }
        catch (error) {
            console.error('üí• [STORAGE - COUNT ALL] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - COUNT ALL] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - COUNT ALL] ===== END CRITICAL ERROR =====');
            return 0;
        }
    }
    // Admin-only method to delete all users except specified admin
    async deleteAllUsersExcept(excludeUserId) {
        console.log('üóëÔ∏è [STORAGE - DELETE ALL] ===== DELETE ALL USERS EXCEPT ADMIN STARTED =====');
        console.log('‚è∞ [STORAGE - DELETE ALL] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - DELETE ALL] Excluding admin user ID:', excludeUserId);
        try {
            // First, let's get the list of users that will be affected for debugging
            const previewQuery = (0, drizzle_orm_1.sql) `SELECT u.id, u.email, u.first_name, u.last_name, u.role
        FROM users u
        WHERE u.is_active = true
          AND u.id != ${excludeUserId}`;
            console.log('üîç [STORAGE - DELETE ALL] Getting preview of users to be deleted...');
            const previewResult = await db_1.db.execute(previewQuery);
            console.log('üë• [STORAGE - DELETE ALL] Users to be deleted:', previewResult.rows);
            // Mark all other users as inactive
            const updateQuery = (0, drizzle_orm_1.sql) `UPDATE users 
        SET is_active = false,
            updated_at = CURRENT_TIMESTAMP
        WHERE is_active = true
          AND id != ${excludeUserId}`;
            console.log('üîß [STORAGE - DELETE ALL] Executing UPDATE query to mark users as inactive...');
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Starting update operation...');
            const startTime = Date.now();
            const result = await db_1.db.execute(updateQuery);
            const updateTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Update operation completed in:', (updateTime - startTime), 'ms');
            console.log('üìä [STORAGE - DELETE ALL] Update result:', result);
            // Count the affected rows
            const countQuery = (0, drizzle_orm_1.sql) `SELECT COUNT(*) as deleted_count
        FROM users u
        WHERE u.is_active = false
          AND u.id != ${excludeUserId}
          AND u.updated_at >= CURRENT_TIMESTAMP - INTERVAL '1 minute'`;
            console.log('üîç [STORAGE - DELETE ALL] Executing count query to verify deletion...');
            const countStartTime = Date.now();
            const countResult = await db_1.db.execute(countQuery);
            const countEndTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Count query completed in:', (countEndTime - countStartTime), 'ms');
            console.log('üìà [STORAGE - DELETE ALL] Raw count result:', countResult.rows);
            const deletedCount = parseInt(countResult.rows[0]?.deleted_count || '0');
            console.log('üî¢ [STORAGE - DELETE ALL] Final deleted count:', deletedCount);
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Total operation time:', (countEndTime - startTime), 'ms');
            console.log('üóëÔ∏è [STORAGE - DELETE ALL] ===== DELETE ALL USERS EXCEPT ADMIN COMPLETED =====');
            return deletedCount;
        }
        catch (error) {
            console.error('üí• [STORAGE - DELETE ALL] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - DELETE ALL] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                excludeUserId: excludeUserId,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - DELETE ALL] ===== END CRITICAL ERROR =====');
            throw error;
        }
    }
    // Admin-only method to delete orphan users (excluding specified admin user)
    async deleteOrphanUsers(excludeUserId) {
        console.log('üóëÔ∏è [STORAGE - DELETE] ===== DELETE ORPHAN USERS STARTED =====');
        console.log('‚è∞ [STORAGE - DELETE] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - DELETE] Excluding admin user ID:', excludeUserId);
        try {
            // First, let's get the list of users that will be affected for debugging
            const previewQuery = (0, drizzle_orm_1.sql) `SELECT u.id, u.email, u.first_name, u.last_name, u.role
        FROM users u
        WHERE u.is_active = true
          AND u.id != ${excludeUserId}
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )`;
            console.log('üîç [STORAGE - DELETE] Getting preview of users to be deleted...');
            const previewResult = await db_1.db.execute(previewQuery);
            console.log('üë• [STORAGE - DELETE] Users to be deleted:', previewResult.rows);
            // Mark orphan users as inactive to avoid foreign key issues
            const updateQuery = (0, drizzle_orm_1.sql) `UPDATE users 
        SET is_active = false,
            updated_at = CURRENT_TIMESTAMP
        WHERE is_active = true
          AND id != ${excludeUserId}
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = id AND ur.is_active = true
          )`;
            console.log('üîß [STORAGE - DELETE] Executing UPDATE query to mark users as inactive...');
            console.log('‚è±Ô∏è [STORAGE - DELETE] Starting update operation...');
            const startTime = Date.now();
            const result = await db_1.db.execute(updateQuery);
            const updateTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE] Update operation completed in:', (updateTime - startTime), 'ms');
            console.log('üìä [STORAGE - DELETE] Update result:', result);
            // Count the affected rows
            const countQuery = (0, drizzle_orm_1.sql) `SELECT COUNT(*) as deleted_count
        FROM users u
        WHERE u.is_active = false
          AND u.id != ${excludeUserId}
          AND u.updated_at >= CURRENT_TIMESTAMP - INTERVAL '1 minute'
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )`;
            console.log('üîç [STORAGE - DELETE] Executing count query to verify deletion...');
            const countStartTime = Date.now();
            const countResult = await db_1.db.execute(countQuery);
            const countEndTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE] Count query completed in:', (countEndTime - countStartTime), 'ms');
            console.log('üìà [STORAGE - DELETE] Raw count result:', countResult.rows);
            const deletedCount = parseInt(countResult.rows[0]?.deleted_count || '0');
            console.log('üî¢ [STORAGE - DELETE] Final deleted count:', deletedCount);
            console.log('‚è±Ô∏è [STORAGE - DELETE] Total operation time:', (countEndTime - startTime), 'ms');
            console.log('üóëÔ∏è [STORAGE - DELETE] ===== DELETE ORPHAN USERS COMPLETED =====');
            return deletedCount;
        }
        catch (error) {
            console.error('üí• [STORAGE - DELETE] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - DELETE] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                excludeUserId: excludeUserId,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - DELETE] ===== END CRITICAL ERROR =====');
            throw error;
        }
    }
}
exports.OptimizedDatabaseStorage = OptimizedDatabaseStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvb3B0aW1pemVkLWRiLXN0b3JhZ2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsNkNBQXlHO0FBQ3pHLHVFQUF1RTtBQUN2RSw2QkFBMEI7QUFDMUIsb0RBQTRCO0FBQzVCLHVEQUF5QztBQTBDekMsbUVBQW1HO0FBQ25HLCtDQUF3RTtBQUN4RSxxRUFBZ0U7QUFDaEUsNkNBQW1EO0FBRW5ELGlEQUFpRDtBQUVqRDs7R0FFRztBQUNILE1BQWEsd0JBQXdCO0lBQ25DOztPQUVHO0lBQ0g7UUFDRSx5Q0FBeUM7UUFDekMsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhO1lBQ3RDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0I7WUFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUMzQixDQUFDO1lBQ0QsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDakMsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyx1QkFBdUI7UUFDbkMsMENBQTBDO1FBQzFDLElBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWM7WUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFDaEMsQ0FBQztZQUNELHFEQUFxRDtZQUNyRCxPQUFPO1FBQ1QsQ0FBQztRQUVELElBQUksQ0FBQztZQUNILE1BQU0sc0NBQWMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQzlDLGlDQUFpQztRQUNuQyxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDhDQUE4QyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZF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SUFBSSxDQUFDLENBQUM7WUFFekUsTUFBTSxZQUFZLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsYUFBYSxJQUFJLEdBQUcsQ0FBQyxDQUFDO1lBQ3pFLE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLEVBQUUsWUFBWSxDQUFDLENBQUM7WUFDeEUsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2Q0FBNkMsRUFBRSxDQUFDLFlBQVksR0FBRyxTQUFTLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQztZQUM3RixPQUFPLENBQUMsR0FBRyxDQUFDLGtFQUFrRSxDQUFDLENBQUM7WUFFaEYsT0FBTyxZQUFZLENBQUM7UUFDdEIsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1lBQ2xFLE9BQU8sQ0FBQyxLQUFLLENBQUMscUNBQXFDLEVBQUU7Z0JBQ25ELE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTztnQkFDdEIsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7Z0JBQ2hCLElBQUksRUFBRSxLQUFLLENBQUMsSUFBSTtnQkFDaEIsYUFBYSxFQUFFLGFBQWE7Z0JBQzVCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxDQUFDLFdBQVcsRUFBRTthQUNwQyxDQUFDLENBQUM7WUFDSCxPQUFPLENBQUMsS0FBSyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7WUFDdEUsTUFBTSxLQUFLLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBMXhIRCw0REEweEhDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvc2VydmVyL29wdGltaXplZC1kYi1zdG9yYWdlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogT3B0aW1pemVkIGRhdGFiYXNlIHN0b3JhZ2Ugd2l0aCBjYWNoaW5nIGFuZCBwZXJmb3JtYW5jZSBtb25pdG9yaW5nLlxuICogUmVwbGFjZXMgZGVjb3JhdG9ycyB3aXRoIGRpcmVjdCBpbXBsZW1lbnRhdGlvbiBmb3IgYmV0dGVyIGNvbXBhdGliaWxpdHkuXG4gKi9cblxuaW1wb3J0IHsgZXEsIGRlc2MsIGFuZCwgb3IsIGd0ZSwgbHRlLCBjb3VudCwgbGlrZSwgaW5BcnJheSwgaXNOdWxsLCBzcWwsIG5vdEluQXJyYXkgfSBmcm9tICdkcml6emxlLW9ybSc7XG4vLyBVc2Ugc2hhcmVkIGRhdGFiYXNlIGNvbm5lY3Rpb24gdG8gYXZvaWQgbXVsdGlwbGUgcG9vbHMgaW4gcHJvZHVjdGlvblxuaW1wb3J0IHsgZGIgfSBmcm9tICcuL2RiJztcbmltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgdHlwZSB7XG4gIFVzZXIsXG4gIEluc2VydFVzZXIsXG4gIE9yZ2FuaXphdGlvbixcbiAgSW5zZXJ0T3JnYW5pemF0aW9uLFxuICBCdWlsZGluZyxcbiAgSW5zZXJ0QnVpbGRpbmcsXG4gIFJlc2lkZW5jZSxcbiAgSW5zZXJ0UmVzaWRlbmNlLFxuICBEb2N1bWVudCxcbiAgSW5zZXJ0RG9jdW1lbnQsXG4gIEluc2VydFBpbGxhcixcbiAgUGlsbGFyIGFzIERldmVsb3BtZW50UGlsbGFyLFxuICBXb3Jrc3BhY2VTdGF0dXMsXG4gIEluc2VydFdvcmtzcGFjZVN0YXR1cyxcbiAgUXVhbGl0eU1ldHJpYyxcbiAgSW5zZXJ0UXVhbGl0eU1ldHJpYyxcbiAgRnJhbWV3b3JrQ29uZmlndXJhdGlvbixcbiAgSW5zZXJ0RnJhbWV3b3JrQ29uZmlndXJhdGlvbixcbiAgSW1wcm92ZW1lbnRTdWdnZXN0aW9uLFxuICBJbnNlcnRJbXByb3ZlbWVudFN1Z2dlc3Rpb24sXG4gIEZlYXR1cmUsXG4gIEluc2VydEZlYXR1cmUsXG4gIEFjdGlvbmFibGVJdGVtLFxuICBJbnNlcnRBY3Rpb25hYmxlSXRlbSxcbiAgSW52aXRhdGlvbixcbiAgSW5zZXJ0SW52aXRhdGlvbixcbiAgSW52aXRhdGlvbkF1ZGl0TG9nLFxuICBJbnNlcnRJbnZpdGF0aW9uQXVkaXRMb2csXG4gIFBlcm1pc3Npb24sXG4gIFJvbGVQZXJtaXNzaW9uLFxuICBVc2VyUGVybWlzc2lvbixcbiAgUGFzc3dvcmRSZXNldFRva2VuLFxuICBJbnNlcnRQYXNzd29yZFJlc2V0VG9rZW4sXG4gIEJ1ZyxcbiAgSW5zZXJ0QnVnLFxuICBJbnZvaWNlLFxuICBJbnNlcnRJbnZvaWNlLFxufSBmcm9tICdAc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgdHlwZSB7IElTdG9yYWdlIH0gZnJvbSAnLi9zdG9yYWdlJztcbmltcG9ydCB0eXBlIHsgUGlsbGFyIH0gZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgUXVlcnlPcHRpbWl6ZXIsIFBhZ2luYXRpb25IZWxwZXIsIHR5cGUgUGFnaW5hdGlvbk9wdGlvbnMgfSBmcm9tICcuL2RhdGFiYXNlLW9wdGltaXphdGlvbic7XG5pbXBvcnQgeyBxdWVyeUNhY2hlLCBDYWNoZUludmFsaWRhdG9yLCB3aXRoQ2FjaGUgfSBmcm9tICcuL3F1ZXJ5LWNhY2hlJztcbmltcG9ydCB7IGRiUGVyZm9ybWFuY2VNb25pdG9yIH0gZnJvbSAnLi9wZXJmb3JtYW5jZS1tb25pdG9yaW5nJztcbmltcG9ydCB7IGV4aXN0cywgc3FsIGFzIHNxbE9wIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuXG4vLyBEYXRhYmFzZSBjb25uZWN0aW9uIGltcG9ydGVkIGZyb20gc2hhcmVkIGRiLnRzXG5cbi8qKlxuICogRW5oYW5jZWQgZGF0YWJhc2Ugc3RvcmFnZSB3aXRoIGJ1aWx0LWluIGNhY2hpbmcgYW5kIHBlcmZvcm1hbmNlIG1vbml0b3JpbmcuXG4gKi9cbmV4cG9ydCBjbGFzcyBPcHRpbWl6ZWREYXRhYmFzZVN0b3JhZ2UgaW1wbGVtZW50cyBJU3RvcmFnZSB7XG4gIC8qKlxuICAgKlxuICAgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gU2tpcCBvcHRpbWl6YXRpb25zIGluIHRlc3QgZW52aXJvbm1lbnRcbiAgICBpZiAoXG4gICAgICBwcm9jZXNzLmVudi5URVNUX0VOViAhPT0gJ2ludGVncmF0aW9uJyAmJlxuICAgICAgIXByb2Nlc3MuZW52LkRJU0FCTEVfREJfT1BUSU1JWkFUSU9OUyAmJlxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0JyAmJlxuICAgICAgIXByb2Nlc3MuZW52LkpFU1RfV09SS0VSX0lEXG4gICAgKSB7XG4gICAgICB0aGlzLmluaXRpYWxpemVPcHRpbWl6YXRpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEluaXRpYWxpemVzIGRhdGFiYXNlIG9wdGltaXphdGlvbnMuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVPcHRpbWl6YXRpb25zKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIFNraXAgZGF0YWJhc2Ugb3B0aW1pemF0aW9uIGR1cmluZyB0ZXN0c1xuICAgIGlmIChcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcgfHxcbiAgICAgIHByb2Nlc3MuZW52LkpFU1RfV09SS0VSX0lEIHx8XG4gICAgICBwcm9jZXNzLmVudi5TS0lQX0RCX09QVElNSVpBVElPTlxuICAgICkge1xuICAgICAgLy8gRGF0YWJhc2Ugb3B0aW1pemF0aW9ucyBza2lwcGVkIGluIHRlc3QgZW52aXJvbm1lbnRcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgYXdhaXQgUXVlcnlPcHRpbWl6ZXIuYXBwbHlDb3JlT3B0aW1pemF0aW9ucygpO1xuICAgICAgLy8gRGF0YWJhc2Ugb3B0aW1pemF0aW9ucyBhcHBsaWVkXG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluaXRpYWxpemluZyBkYXRhYmFzZSBvcHRpbWl6YXRpb25zOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV3JhcHBlciBmb3IgcGVyZm9ybWFuY2UgdHJhY2tpbmcgYW5kIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBvcGVyYXRpb25cbiAgICogQHBhcmFtIGNhY2hlS2V5XG4gICAqIEBwYXJhbSBjYWNoZVR5cGVcbiAgICogQHBhcmFtIGZuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHdpdGhPcHRpbWl6YXRpb25zPFQ+KFxuICAgIG9wZXJhdGlvbjogc3RyaW5nLFxuICAgIGNhY2hlS2V5OiBzdHJpbmcgfCBudWxsLFxuICAgIGNhY2hlVHlwZTogc3RyaW5nLFxuICAgIGZuOiAoKSA9PiBQcm9taXNlPFQ+XG4gICk6IFByb21pc2U8VD4ge1xuICAgIC8vIFRyeSBjYWNoZSBmaXJzdFxuICAgIGlmIChjYWNoZUtleSkge1xuICAgICAgY29uc3QgY2FjaGVkID0gcXVlcnlDYWNoZS5nZXQ8VD4oY2FjaGVUeXBlLCBjYWNoZUtleSk7XG4gICAgICBpZiAoY2FjaGVkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBFeGVjdXRlIHdpdGggcGVyZm9ybWFuY2UgdHJhY2tpbmdcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KG9wZXJhdGlvbiwgZm4pO1xuXG4gICAgLy8gQ2FjaGUgcmVzdWx0XG4gICAgaWYgKGNhY2hlS2V5ICYmIHJlc3VsdCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxdWVyeUNhY2hlLnNldChjYWNoZVR5cGUsIGNhY2hlS2V5LCByZXN1bHQpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogRW5oYW5jZWQgbG9nZ2luZyBmdW5jdGlvbiBmb3Igc3RvcmFnZSBvcGVyYXRpb25zXG4gICAqL1xuICBwcml2YXRlIGxvZ1N0b3JhZ2VPcGVyYXRpb24ob3BlcmF0aW9uOiBzdHJpbmcsIGRhdGE6IGFueSwgbGV2ZWw6ICdJTkZPJyB8ICdFUlJPUicgfCAnREVCVUcnIHwgJ1dBUk4nID0gJ0lORk8nKSB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGVtb2ppID0ge1xuICAgICAgSU5GTzogJ/Cfk4onLFxuICAgICAgRVJST1I6ICfinYwnLCBcbiAgICAgIERFQlVHOiAn8J+UjScsXG4gICAgICBXQVJOOiAn4pqg77iPJ1xuICAgIH1bbGV2ZWxdO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSAke2Vtb2ppfSBbU1RPUkFHRSAke29wZXJhdGlvbi50b1VwcGVyQ2FzZSgpfV0gJHtsZXZlbH06YCwgZGF0YSk7XG4gIH1cblxuICAvLyBVc2VyIG9wZXJhdGlvbnMgd2l0aCBvcHRpbWl6YXRpb25cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFsbCBhY3RpdmUgdXNlcnMgd2l0aCBjYWNoaW5nIGFuZCBwZXJmb3JtYW5jZSB0cmFja2luZy5cbiAgICovXG4gIGFzeW5jIGdldFVzZXJzKCk6IFByb21pc2U8VXNlcltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFVzZXJzJywgJ2FsbF91c2VycycsICd1c2VycycsICgpID0+XG4gICAgICBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgLmxpbWl0KDEwMCkgLy8gQWx3YXlzIHVzZSBMSU1JVCBmb3IgbGFyZ2UgcmVzdWx0IHNldHNcbiAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEudXNlcnMuY3JlYXRlZEF0KSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbGwgYWN0aXZlIHVzZXJzIHdpdGggdGhlaXIgYXNzaWdubWVudHMgKG9yZ2FuaXphdGlvbnMsIGJ1aWxkaW5ncywgcmVzaWRlbmNlcykuXG4gICAqIE9QVElNSVpFRDogVXNlcyBzaW5nbGUgcXVlcnkgd2l0aCBKT0lOcyBhbmQgYWdncmVnYXRpb24gaW5zdGVhZCBvZiBOKzEgcXVlcmllcy5cbiAgICovXG4gIGFzeW5jIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzKCk6IFByb21pc2U8QXJyYXk8VXNlciAmIHsgb3JnYW5pemF0aW9uczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmc7IHR5cGU6IHN0cmluZyB9PjsgYnVpbGRpbmdzOiBBcnJheTx7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZyB9PjsgcmVzaWRlbmNlczogQXJyYXk8eyBpZDogc3RyaW5nOyB1bml0TnVtYmVyOiBzdHJpbmc7IGJ1aWxkaW5nSWQ6IHN0cmluZzsgYnVpbGRpbmdOYW1lOiBzdHJpbmcgfT4gfT4+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRVc2Vyc1dpdGhBc3NpZ25tZW50cycsXG4gICAgICAnYWxsX3VzZXJzX2Fzc2lnbm1lbnRzX29wdGltaXplZF92NCcsXG4gICAgICAndXNlcnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIC8vIFNpbmdsZSBvcHRpbWl6ZWQgcXVlcnkgdXNpbmcgQ1RFcyBhbmQgYWdncmVnYXRpb25cbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbGBcbiAgICAgICAgICAgIFdJVEggdXNlcl9vcmdzIEFTIChcbiAgICAgICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgICAgIHVvLnVzZXJfaWQsXG4gICAgICAgICAgICAgICAgQ09BTEVTQ0UoXG4gICAgICAgICAgICAgICAgICBqc29uX2FnZyhcbiAgICAgICAgICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgJ2lkJywgby5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAnbmFtZScsIG8ubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAndHlwZScsIG8udHlwZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApIEZJTFRFUiAoV0hFUkUgby5pZCBJUyBOT1QgTlVMTCksXG4gICAgICAgICAgICAgICAgICAnW10nOjpqc29uXG4gICAgICAgICAgICAgICAgKSBhcyBvcmdhbml6YXRpb25zXG4gICAgICAgICAgICAgIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gb3JnYW5pemF0aW9ucyBvIE9OIHVvLm9yZ2FuaXphdGlvbl9pZCA9IG8uaWRcbiAgICAgICAgICAgICAgV0hFUkUgdW8uaXNfYWN0aXZlID0gdHJ1ZSBBTkQgby5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgIEdST1VQIEJZIHVvLnVzZXJfaWRcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB1c2VyX2J1aWxkaW5ncyBBUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgICB1by51c2VyX2lkLFxuICAgICAgICAgICAgICAgIENPQUxFU0NFKFxuICAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICdpZCcsIGJ1aWxkaW5nc19kaXN0aW5jdC5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAnbmFtZScsIGJ1aWxkaW5nc19kaXN0aW5jdC5uYW1lXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICksXG4gICAgICAgICAgICAgICAgICAnW10nOjpqc29uXG4gICAgICAgICAgICAgICAgKSBhcyBidWlsZGluZ3NcbiAgICAgICAgICAgICAgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9cbiAgICAgICAgICAgICAgSU5ORVIgSk9JTiAoXG4gICAgICAgICAgICAgICAgU0VMRUNUIERJU1RJTkNUIHVvMi51c2VyX2lkLCBiLmlkLCBiLm5hbWVcbiAgICAgICAgICAgICAgICBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1bzJcbiAgICAgICAgICAgICAgICBJTk5FUiBKT0lOIGJ1aWxkaW5ncyBiIE9OIHVvMi5vcmdhbml6YXRpb25faWQgPSBiLm9yZ2FuaXphdGlvbl9pZFxuICAgICAgICAgICAgICAgIFdIRVJFIHVvMi5pc19hY3RpdmUgPSB0cnVlIEFORCBiLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgKSBidWlsZGluZ3NfZGlzdGluY3QgT04gdW8udXNlcl9pZCA9IGJ1aWxkaW5nc19kaXN0aW5jdC51c2VyX2lkXG4gICAgICAgICAgICAgIFdIRVJFIHVvLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgR1JPVVAgQlkgdW8udXNlcl9pZFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHVzZXJfcmVzaWRlbmNlcyBBUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgICB1ci51c2VyX2lkLFxuICAgICAgICAgICAgICAgIENPQUxFU0NFKFxuICAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICdpZCcsIHIuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ3VuaXROdW1iZXInLCByLnVuaXRfbnVtYmVyLFxuICAgICAgICAgICAgICAgICAgICAgICdidWlsZGluZ0lkJywgci5idWlsZGluZ19pZCxcbiAgICAgICAgICAgICAgICAgICAgICAnYnVpbGRpbmdOYW1lJywgYi5uYW1lXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICkgRklMVEVSIChXSEVSRSByLmlkIElTIE5PVCBOVUxMKSxcbiAgICAgICAgICAgICAgICAgICdbXSc6Ompzb25cbiAgICAgICAgICAgICAgICApIGFzIHJlc2lkZW5jZXNcbiAgICAgICAgICAgICAgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXJcbiAgICAgICAgICAgICAgSU5ORVIgSk9JTiByZXNpZGVuY2VzIHIgT04gdXIucmVzaWRlbmNlX2lkID0gci5pZFxuICAgICAgICAgICAgICBJTk5FUiBKT0lOIGJ1aWxkaW5ncyBiIE9OIHIuYnVpbGRpbmdfaWQgPSBiLmlkXG4gICAgICAgICAgICAgIFdIRVJFIHVyLmlzX2FjdGl2ZSA9IHRydWUgQU5EIHIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICBHUk9VUCBCWSB1ci51c2VyX2lkXG4gICAgICAgICAgICApXG4gICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgIHUuKixcbiAgICAgICAgICAgICAgQ09BTEVTQ0UodW8ub3JnYW5pemF0aW9ucywgJ1tdJzo6anNvbikgYXMgb3JnYW5pemF0aW9ucyxcbiAgICAgICAgICAgICAgQ09BTEVTQ0UodWIuYnVpbGRpbmdzLCAnW10nOjpqc29uKSBhcyBidWlsZGluZ3MsXG4gICAgICAgICAgICAgIENPQUxFU0NFKHVyLnJlc2lkZW5jZXMsICdbXSc6Ompzb24pIGFzIHJlc2lkZW5jZXNcbiAgICAgICAgICAgIEZST00gdXNlcnMgdVxuICAgICAgICAgICAgTEVGVCBKT0lOIHVzZXJfb3JncyB1byBPTiB1LmlkID0gdW8udXNlcl9pZFxuICAgICAgICAgICAgTEVGVCBKT0lOIHVzZXJfYnVpbGRpbmdzIHViIE9OIHUuaWQgPSB1Yi51c2VyX2lkXG4gICAgICAgICAgICBMRUZUIEpPSU4gdXNlcl9yZXNpZGVuY2VzIHVyIE9OIHUuaWQgPSB1ci51c2VyX2lkXG4gICAgICAgICAgICBXSEVSRSB1LmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgIE9SREVSIEJZIHUuY3JlYXRlZF9hdCBERVNDXG4gICAgICAgICAgICBMSU1JVCAxMDBcbiAgICAgICAgICBgKTtcblxuICAgICAgICAgIC8vIFRyYW5zZm9ybSB0aGUgcmF3IFNRTCByZXN1bHQgdG8gbWF0Y2ggdGhlIGV4cGVjdGVkIFR5cGVTY3JpcHQgdHlwZXNcbiAgICAgICAgICByZXR1cm4gcmVzdWx0LnJvd3MubWFwKChyb3c6IGFueSkgPT4gKHtcbiAgICAgICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgICAgICB1c2VybmFtZTogcm93LnVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHJvdy5wYXNzd29yZCxcbiAgICAgICAgICAgIGVtYWlsOiByb3cuZW1haWwsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHJvdy5maXJzdF9uYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IHJvdy5sYXN0X25hbWUsXG4gICAgICAgICAgICBwaG9uZTogcm93LnBob25lLFxuICAgICAgICAgICAgcHJvZmlsZUltYWdlOiByb3cucHJvZmlsZV9pbWFnZSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiByb3cubGFuZ3VhZ2UsXG4gICAgICAgICAgICByb2xlOiByb3cucm9sZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiByb3cuaXNfYWN0aXZlLFxuICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHJvdy5sYXN0X2xvZ2luX2F0LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRfYXQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25zOiB0eXBlb2Ygcm93Lm9yZ2FuaXphdGlvbnMgPT09ICdzdHJpbmcnIFxuICAgICAgICAgICAgICA/IEpTT04ucGFyc2Uocm93Lm9yZ2FuaXphdGlvbnMpIFxuICAgICAgICAgICAgICA6IHJvdy5vcmdhbml6YXRpb25zIHx8IFtdLFxuICAgICAgICAgICAgYnVpbGRpbmdzOiB0eXBlb2Ygcm93LmJ1aWxkaW5ncyA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gSlNPTi5wYXJzZShyb3cuYnVpbGRpbmdzKSBcbiAgICAgICAgICAgICAgOiByb3cuYnVpbGRpbmdzIHx8IFtdLFxuICAgICAgICAgICAgcmVzaWRlbmNlczogdHlwZW9mIHJvdy5yZXNpZGVuY2VzID09PSAnc3RyaW5nJyBcbiAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKHJvdy5yZXNpZGVuY2VzKSBcbiAgICAgICAgICAgICAgOiByb3cucmVzaWRlbmNlcyB8fCBbXVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBvcHRpbWl6ZWQgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHRoZSBvcmlnaW5hbCBpbXBsZW1lbnRhdGlvbiBpZiBvcHRpbWl6ZWQgcXVlcnkgZmFpbHNcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UhCBGYWxsaW5nIGJhY2sgdG8gb3JpZ2luYWwgaW1wbGVtZW50YXRpb24uLi4nKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVc2Vyc1dpdGhBc3NpZ25tZW50c0ZhbGxiYWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBwYWdpbmF0ZWQgYWN0aXZlIHVzZXJzIHdpdGggdGhlaXIgYXNzaWdubWVudHMgKG9yZ2FuaXphdGlvbnMsIGJ1aWxkaW5ncywgcmVzaWRlbmNlcykuXG4gICAqIE9QVElNSVpFRDogVXNlcyBzaW5nbGUgcXVlcnkgd2l0aCBKT0lOcywgYWdncmVnYXRpb24sIGFuZCBMSU1JVC9PRkZTRVQgZm9yIHBhZ2luYXRpb24uXG4gICAqL1xuICBhc3luYyBnZXRVc2Vyc1dpdGhBc3NpZ25tZW50c1BhZ2luYXRlZChcbiAgICBvZmZzZXQ6IG51bWJlciA9IDAsIFxuICAgIGxpbWl0OiBudW1iZXIgPSAxMCwgXG4gICAgZmlsdGVyczogeyByb2xlPzogc3RyaW5nOyBzdGF0dXM/OiBzdHJpbmc7IG9yZ2FuaXphdGlvbj86IHN0cmluZzsgb3JwaGFuPzogc3RyaW5nOyBkZW1vT25seT86IHN0cmluZzsgbWFuYWdlck9yZ2FuaXphdGlvbnM/OiBzdHJpbmc7IHNlYXJjaD86IHN0cmluZyB9ID0ge31cbiAgKTogUHJvbWlzZTx7XG4gICAgdXNlcnM6IEFycmF5PFVzZXIgJiB7IG9yZ2FuaXphdGlvbnM6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmcgfT47IGJ1aWxkaW5nczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfT47IHJlc2lkZW5jZXM6IEFycmF5PHsgaWQ6IHN0cmluZzsgdW5pdE51bWJlcjogc3RyaW5nOyBidWlsZGluZ0lkOiBzdHJpbmc7IGJ1aWxkaW5nTmFtZTogc3RyaW5nIH0+IH0+O1xuICAgIHRvdGFsOiBudW1iZXI7XG4gIH0+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRVc2Vyc1dpdGhBc3NpZ25tZW50c1BhZ2luYXRlZCcsXG4gICAgICBgcGFnaW5hdGVkX3VzZXJzXyR7b2Zmc2V0fV8ke2xpbWl0fV8ke0pTT04uc3RyaW5naWZ5KGZpbHRlcnMpfV92NGAsXG4gICAgICAndXNlcnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtEQiBGSUxURVJdIElucHV0IGZpbHRlcnM6JywgSlNPTi5zdHJpbmdpZnkoZmlsdGVycywgbnVsbCwgMikpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEJ1aWxkIFdIRVJFIGNvbmRpdGlvbnMgZm9yIGZpbHRlcmluZ1xuICAgICAgICAgIGxldCB3aGVyZUNvbmRpdGlvbnMgPSBbXTtcbiAgICAgICAgICBsZXQgY291bnRXaGVyZUNvbmRpdGlvbnMgPSBbXTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZmlsdGVycy5yb2xlKSB7XG4gICAgICAgICAgICBpZiAoZmlsdGVycy5yb2xlID09PSAnbnVsbCcpIHtcbiAgICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goJ3Uucm9sZSBJUyBOVUxMJyk7XG4gICAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goJ3JvbGUgSVMgTlVMTCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goYHUucm9sZSA9ICcke2ZpbHRlcnMucm9sZX0nYCk7XG4gICAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goYHJvbGUgPSAnJHtmaWx0ZXJzLnJvbGV9J2ApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICAgICAgICAgIGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ251bGwnKSB7XG4gICAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKCd1LmlzX2FjdGl2ZSBJUyBOVUxMJyk7XG4gICAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goJ2lzX2FjdGl2ZSBJUyBOVUxMJyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBjb25zdCBpc0FjdGl2ZSA9IGZpbHRlcnMuc3RhdHVzID09PSAndHJ1ZSc7XG4gICAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGB1LmlzX2FjdGl2ZSA9ICR7aXNBY3RpdmV9YCk7XG4gICAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goYGlzX2FjdGl2ZSA9ICR7aXNBY3RpdmV9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIERlZmF1bHQ6IG9ubHkgc2hvdyBhY3RpdmUgdXNlcnMgaWYgbm8gc3RhdHVzIGZpbHRlciBpcyBhcHBsaWVkXG4gICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaCgndS5pc19hY3RpdmUgPSB0cnVlJyk7XG4gICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKCdpc19hY3RpdmUgPSB0cnVlJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRGVtby1vbmx5IGZpbHRlciBmb3IgZGVtbyB1c2Vyc1xuICAgICAgICAgIGlmIChmaWx0ZXJzLmRlbW9Pbmx5ID09PSAndHJ1ZScpIHtcbiAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKFwiKHUucm9sZSBMSUtFICdkZW1vXyUnKVwiKTtcbiAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goXCIocm9sZSBMSUtFICdkZW1vXyUnKVwiKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBTZWFyY2ggZmlsdGVyIGZvciBuYW1lL2VtYWlsXG4gICAgICAgICAgaWYgKGZpbHRlcnMuc2VhcmNoICYmIGZpbHRlcnMuc2VhcmNoLnRyaW0oKSkge1xuICAgICAgICAgICAgY29uc3Qgc2VhcmNoVGVybSA9IGZpbHRlcnMuc2VhcmNoLnRyaW0oKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goYChcbiAgICAgICAgICAgICAgTE9XRVIodS5maXJzdF9uYW1lIHx8ICcgJyB8fCB1Lmxhc3RfbmFtZSkgTElLRSAnJSR7c2VhcmNoVGVybX0lJyBPUiBcbiAgICAgICAgICAgICAgTE9XRVIodS5lbWFpbCkgTElLRSAnJSR7c2VhcmNoVGVybX0lJyBPUiBcbiAgICAgICAgICAgICAgTE9XRVIodS51c2VybmFtZSkgTElLRSAnJSR7c2VhcmNoVGVybX0lJ1xuICAgICAgICAgICAgKWApO1xuICAgICAgICAgICAgY291bnRXaGVyZUNvbmRpdGlvbnMucHVzaChgKFxuICAgICAgICAgICAgICBMT1dFUihmaXJzdF9uYW1lIHx8ICcgJyB8fCBsYXN0X25hbWUpIExJS0UgJyUke3NlYXJjaFRlcm19JScgT1IgXG4gICAgICAgICAgICAgIExPV0VSKGVtYWlsKSBMSUtFICclJHtzZWFyY2hUZXJtfSUnIE9SIFxuICAgICAgICAgICAgICBMT1dFUih1c2VybmFtZSkgTElLRSAnJSR7c2VhcmNoVGVybX0lJ1xuICAgICAgICAgICAgKWApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NFQVJDSCBGSUxURVJdIEFwcGxpZWQgc2VhcmNoIGZvcjonLCBzZWFyY2hUZXJtKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBNYW5hZ2VyIG9yZ2FuaXphdGlvbnMgZmlsdGVyIC0gb25seSBzaG93IHVzZXJzIGZyb20gc3BlY2lmaWMgb3JnYW5pemF0aW9uc1xuICAgICAgICAgIGlmIChmaWx0ZXJzLm1hbmFnZXJPcmdhbml6YXRpb25zICYmIGZpbHRlcnMubWFuYWdlck9yZ2FuaXphdGlvbnMudHJpbSgpKSB7XG4gICAgICAgICAgICBjb25zdCBvcmdJZHMgPSBmaWx0ZXJzLm1hbmFnZXJPcmdhbml6YXRpb25zLnNwbGl0KCcsJykubWFwKGlkID0+IGAnJHtpZC50cmltKCl9J2ApLmpvaW4oJywnKTtcbiAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGBFWElTVFMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19tZ3IgXG4gICAgICAgICAgICAgIFdIRVJFIHVvX21nci51c2VyX2lkID0gdS5pZCBcbiAgICAgICAgICAgICAgQU5EIHVvX21nci5vcmdhbml6YXRpb25faWQgSU4gKCR7b3JnSWRzfSlcbiAgICAgICAgICAgICAgQU5EIHVvX21nci5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICApYCk7XG4gICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKGBFWElTVFMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19tZ3IgXG4gICAgICAgICAgICAgIFdIRVJFIHVvX21nci51c2VyX2lkID0gdXNlcnMuaWQgXG4gICAgICAgICAgICAgIEFORCB1b19tZ3Iub3JnYW5pemF0aW9uX2lkIElOICgke29yZ0lkc30pXG4gICAgICAgICAgICAgIEFORCB1b19tZ3IuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgKWApO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfkZQgW01BTkFHRVIgRklMVEVSXSBBcHBsaWVkIG9yZ2FuaXphdGlvbiBmaWx0ZXIgZm9yOicsIG9yZ0lkcyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gRmlyc3QgZ2V0IHRvdGFsIGNvdW50IGZvciBwYWdpbmF0aW9uIG1ldGFkYXRhIHdpdGggZmlsdGVyc1xuICAgICAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBgXG4gICAgICAgICAgICBTRUxFQ1QgQ09VTlQoKikgYXMgdG90YWwgXG4gICAgICAgICAgICBGUk9NIHVzZXJzIFxuICAgICAgICAgICAgV0hFUkUgJHtjb3VudFdoZXJlQ29uZGl0aW9ucy5sZW5ndGggPiAwID8gY291bnRXaGVyZUNvbmRpdGlvbnMuam9pbignIEFORCAnKSA6ICcxPTEnfVxuICAgICAgICAgICAgJHtmaWx0ZXJzLm9yZ2FuaXphdGlvbiAmJiBmaWx0ZXJzLm9yZ2FuaXphdGlvbi50cmltKCkgPyBgQU5EIEVYSVNUUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvX2ZpbHRlciBcbiAgICAgICAgICAgICAgV0hFUkUgdW9fZmlsdGVyLnVzZXJfaWQgPSB1c2Vycy5pZCBcbiAgICAgICAgICAgICAgQU5EIHVvX2ZpbHRlci5vcmdhbml6YXRpb25faWQgPSAnJHtmaWx0ZXJzLm9yZ2FuaXphdGlvbi50cmltKCl9J1xuICAgICAgICAgICAgICBBTkQgdW9fZmlsdGVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgIClgIDogJyd9XG4gICAgICAgICAgICAkeyFmaWx0ZXJzLm9yZ2FuaXphdGlvbiAmJiBmaWx0ZXJzLm9ycGhhbiA9PT0gJ3RydWUnID8gYEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9fY291bnRfb3JwaGFuIFxuICAgICAgICAgICAgICBXSEVSRSB1b19jb3VudF9vcnBoYW4udXNlcl9pZCA9IHVzZXJzLmlkIEFORCB1b19jb3VudF9vcnBoYW4uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgKSBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyX2NvdW50X29ycGhhbiBcbiAgICAgICAgICAgICAgV0hFUkUgdXJfY291bnRfb3JwaGFuLnVzZXJfaWQgPSB1c2Vycy5pZCBBTkQgdXJfY291bnRfb3JwaGFuLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgIClgIDogJyd9XG4gICAgICAgICAgICAkeyFmaWx0ZXJzLm9yZ2FuaXphdGlvbiAmJiBmaWx0ZXJzLm9ycGhhbiA9PT0gJ2ZhbHNlJyA/IGBBTkQgKEVYSVNUUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvX2NvdW50X2Fzc2lnbmVkIFxuICAgICAgICAgICAgICBXSEVSRSB1b19jb3VudF9hc3NpZ25lZC51c2VyX2lkID0gdXNlcnMuaWQgQU5EIHVvX2NvdW50X2Fzc2lnbmVkLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICkgT1IgRVhJU1RTIChcbiAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXJfY291bnRfYXNzaWduZWQgXG4gICAgICAgICAgICAgIFdIRVJFIHVyX2NvdW50X2Fzc2lnbmVkLnVzZXJfaWQgPSB1c2Vycy5pZCBBTkQgdXJfY291bnRfYXNzaWduZWQuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgKSlgIDogJyd9XG4gICAgICAgICAgICAke2ZpbHRlcnMuc2VhcmNoICYmIGZpbHRlcnMuc2VhcmNoLnRyaW0oKSA/IGBBTkQgKFxuICAgICAgICAgICAgICBMT1dFUihmaXJzdF9uYW1lIHx8ICcgJyB8fCBsYXN0X25hbWUpIExJS0UgJyUke2ZpbHRlcnMuc2VhcmNoLnRyaW0oKS50b0xvd2VyQ2FzZSgpfSUnIE9SIFxuICAgICAgICAgICAgICBMT1dFUihlbWFpbCkgTElLRSAnJSR7ZmlsdGVycy5zZWFyY2gudHJpbSgpLnRvTG93ZXJDYXNlKCl9JScgT1IgXG4gICAgICAgICAgICAgIExPV0VSKHVzZXJuYW1lKSBMSUtFICclJHtmaWx0ZXJzLnNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKX0lJ1xuICAgICAgICAgICAgKWAgOiAnJ31cbiAgICAgICAgICBgO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OKIFtDT1VOVCBTUUxdOicsIGNvdW50UXVlcnkpO1xuICAgICAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWwucmF3KGNvdW50UXVlcnkpKTtcbiAgICAgICAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0/LnRvdGFsIHx8ICcwJyk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW0NPVU5UIFJFU1VMVF06JywgdG90YWwpO1xuXG4gICAgICAgICAgLy8gU2luZ2xlIG9wdGltaXplZCBxdWVyeSB1c2luZyBDVEVzIGFuZCBhZ2dyZWdhdGlvbiB3aXRoIHBhZ2luYXRpb24gYW5kIGZpbHRlcnNcbiAgICAgICAgICBjb25zdCBtYWluUXVlcnkgPSBgXG4gICAgICAgICAgICBXSVRIIHVzZXJfb3JncyBBUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgICB1by51c2VyX2lkLFxuICAgICAgICAgICAgICAgIENPQUxFU0NFKFxuICAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICdpZCcsIG8uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ25hbWUnLCBvLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnLCBvLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIG8uaWQgSVMgTk9UIE5VTEwpLFxuICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICkgYXMgb3JnYW5pemF0aW9uc1xuICAgICAgICAgICAgICBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b1xuICAgICAgICAgICAgICBJTk5FUiBKT0lOIG9yZ2FuaXphdGlvbnMgbyBPTiB1by5vcmdhbml6YXRpb25faWQgPSBvLmlkXG4gICAgICAgICAgICAgIFdIRVJFIHVvLmlzX2FjdGl2ZSA9IHRydWUgQU5EIG8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICBHUk9VUCBCWSB1by51c2VyX2lkXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdXNlcl9idWlsZGluZ3MgQVMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgdW8udXNlcl9pZCxcbiAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAnaWQnLCBidWlsZGluZ3NfZGlzdGluY3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ25hbWUnLCBidWlsZGluZ3NfZGlzdGluY3QubmFtZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICkgYXMgYnVpbGRpbmdzXG4gICAgICAgICAgICAgIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gKFxuICAgICAgICAgICAgICAgIFNFTEVDVCBESVNUSU5DVCB1bzIudXNlcl9pZCwgYi5pZCwgYi5uYW1lXG4gICAgICAgICAgICAgICAgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW8yXG4gICAgICAgICAgICAgICAgSU5ORVIgSk9JTiBidWlsZGluZ3MgYiBPTiB1bzIub3JnYW5pemF0aW9uX2lkID0gYi5vcmdhbml6YXRpb25faWRcbiAgICAgICAgICAgICAgICBXSEVSRSB1bzIuaXNfYWN0aXZlID0gdHJ1ZSBBTkQgYi5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgICkgYnVpbGRpbmdzX2Rpc3RpbmN0IE9OIHVvLnVzZXJfaWQgPSBidWlsZGluZ3NfZGlzdGluY3QudXNlcl9pZFxuICAgICAgICAgICAgICBXSEVSRSB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgIEdST1VQIEJZIHVvLnVzZXJfaWRcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB1c2VyX3Jlc2lkZW5jZXMgQVMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgdXIudXNlcl9pZCxcbiAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAnaWQnLCByLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICd1bml0TnVtYmVyJywgci51bml0X251bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAnYnVpbGRpbmdJZCcsIHIuYnVpbGRpbmdfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ2J1aWxkaW5nTmFtZScsIGIubmFtZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApIEZJTFRFUiAoV0hFUkUgci5pZCBJUyBOT1QgTlVMTCksXG4gICAgICAgICAgICAgICAgICAnW10nOjpqc29uXG4gICAgICAgICAgICAgICAgKSBhcyByZXNpZGVuY2VzXG4gICAgICAgICAgICAgIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gcmVzaWRlbmNlcyByIE9OIHVyLnJlc2lkZW5jZV9pZCA9IHIuaWRcbiAgICAgICAgICAgICAgSU5ORVIgSk9JTiBidWlsZGluZ3MgYiBPTiByLmJ1aWxkaW5nX2lkID0gYi5pZFxuICAgICAgICAgICAgICBXSEVSRSB1ci5pc19hY3RpdmUgPSB0cnVlIEFORCByLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgR1JPVVAgQlkgdXIudXNlcl9pZFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgICB1LiosXG4gICAgICAgICAgICAgIENPQUxFU0NFKHVvLm9yZ2FuaXphdGlvbnMsICdbXSc6Ompzb24pIGFzIG9yZ2FuaXphdGlvbnMsXG4gICAgICAgICAgICAgIENPQUxFU0NFKHViLmJ1aWxkaW5ncywgJ1tdJzo6anNvbikgYXMgYnVpbGRpbmdzLFxuICAgICAgICAgICAgICBDT0FMRVNDRSh1ci5yZXNpZGVuY2VzLCAnW10nOjpqc29uKSBhcyByZXNpZGVuY2VzXG4gICAgICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgICAgIExFRlQgSk9JTiB1c2VyX29yZ3MgdW8gT04gdS5pZCA9IHVvLnVzZXJfaWRcbiAgICAgICAgICAgIExFRlQgSk9JTiB1c2VyX2J1aWxkaW5ncyB1YiBPTiB1LmlkID0gdWIudXNlcl9pZFxuICAgICAgICAgICAgTEVGVCBKT0lOIHVzZXJfcmVzaWRlbmNlcyB1ciBPTiB1LmlkID0gdXIudXNlcl9pZFxuICAgICAgICAgICAgV0hFUkUgJHt3aGVyZUNvbmRpdGlvbnMubGVuZ3RoID4gMCA/IHdoZXJlQ29uZGl0aW9ucy5qb2luKCcgQU5EICcpIDogJzE9MSd9XG4gICAgICAgICAgICAke2ZpbHRlcnMub3JnYW5pemF0aW9uICYmIGZpbHRlcnMub3JnYW5pemF0aW9uLnRyaW0oKSA/ICgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn4+iIFtPUkcgRklMVEVSXSBBcHBseWluZyBvcmdhbml6YXRpb24gZmlsdGVyOicsIGZpbHRlcnMub3JnYW5pemF0aW9uLnRyaW0oKSk7XG4gICAgICAgICAgICAgIHJldHVybiBgQU5EIEVYSVNUUyAoXG4gICAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9fZmlsdGVyIFxuICAgICAgICAgICAgICAgIFdIRVJFIHVvX2ZpbHRlci51c2VyX2lkID0gdS5pZCBcbiAgICAgICAgICAgICAgICBBTkQgdW9fZmlsdGVyLm9yZ2FuaXphdGlvbl9pZCA9ICcke2ZpbHRlcnMub3JnYW5pemF0aW9uLnRyaW0oKX0nXG4gICAgICAgICAgICAgICAgQU5EIHVvX2ZpbHRlci5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgIClgO1xuICAgICAgICAgICAgfSkoKSA6ICgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn4+iIFtPUkcgRklMVEVSXSBObyBvcmdhbml6YXRpb24gZmlsdGVyIGFwcGxpZWQgKGVtcHR5IG9yIHVuZGVmaW5lZCknKTtcbiAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSkoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHshZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcnBoYW4gPT09ICd0cnVlJyA/ICgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5G7IFtPUlBIQU4gRklMVEVSXSBBcHBseWluZyBvcnBoYW4gZmlsdGVyOiB0cnVlICh1c2VycyB3aXRoIG5vIGFzc2lnbm1lbnRzKScpO1xuICAgICAgICAgICAgICByZXR1cm4gYEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19maWx0ZXJfb3JwaGFuIFxuICAgICAgICAgICAgICAgIFdIRVJFIHVvX2ZpbHRlcl9vcnBoYW4udXNlcl9pZCA9IHUuaWQgQU5EIHVvX2ZpbHRlcl9vcnBoYW4uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1cl9maWx0ZXJfb3JwaGFuIFxuICAgICAgICAgICAgICAgIFdIRVJFIHVyX2ZpbHRlcl9vcnBoYW4udXNlcl9pZCA9IHUuaWQgQU5EIHVyX2ZpbHRlcl9vcnBoYW4uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApYDtcbiAgICAgICAgICAgIH0pKCkgOiAhZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcnBoYW4gPT09ICdmYWxzZScgPyAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+RuyBbT1JQSEFOIEZJTFRFUl0gQXBwbHlpbmcgb3JwaGFuIGZpbHRlcjogZmFsc2UgKHVzZXJzIHdpdGggYXNzaWdubWVudHMpJyk7XG4gICAgICAgICAgICAgIHJldHVybiBgQU5EIChFWElTVFMgKFxuICAgICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvX2ZpbHRlcl9hc3NpZ25lZCBcbiAgICAgICAgICAgICAgICBXSEVSRSB1b19maWx0ZXJfYXNzaWduZWQudXNlcl9pZCA9IHUuaWQgQU5EIHVvX2ZpbHRlcl9hc3NpZ25lZC5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgICkgT1IgRVhJU1RTIChcbiAgICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1cl9maWx0ZXJfYXNzaWduZWQgXG4gICAgICAgICAgICAgICAgV0hFUkUgdXJfZmlsdGVyX2Fzc2lnbmVkLnVzZXJfaWQgPSB1LmlkIEFORCB1cl9maWx0ZXJfYXNzaWduZWQuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApKWA7XG4gICAgICAgICAgICB9KSgpIDogZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcnBoYW4gPyAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+RuyBbT1JQSEFOIEZJTFRFUl0gSWdub3Jpbmcgb3JwaGFuIGZpbHRlciAtIGNvbmZsaWN0cyB3aXRoIG9yZ2FuaXphdGlvbiBmaWx0ZXInKTtcbiAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSkoKSA6ICgoKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5G7IFtPUlBIQU4gRklMVEVSXSBObyBvcnBoYW4gZmlsdGVyIGFwcGxpZWQgKGVtcHR5IG9yIHVuZGVmaW5lZCknKTtcbiAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfSkoKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgT1JERVIgQlkgdS5jcmVhdGVkX2F0IERFU0NcbiAgICAgICAgICAgIExJTUlUICR7bGltaXR9IE9GRlNFVCAke29mZnNldH1cbiAgICAgICAgICBgO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OKIFtNQUlOIFNRTF06JywgbWFpblF1ZXJ5KTtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHNxbC5yYXcobWFpblF1ZXJ5KSk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW01BSU4gUkVTVUxUXTonLCByZXN1bHQucm93cy5sZW5ndGgsICd1c2VycyBmb3VuZCcpO1xuXG4gICAgICAgICAgLy8gVHJhbnNmb3JtIHRoZSByYXcgU1FMIHJlc3VsdCB0byBtYXRjaCB0aGUgZXhwZWN0ZWQgVHlwZVNjcmlwdCB0eXBlc1xuICAgICAgICAgIGNvbnN0IHVzZXJzID0gcmVzdWx0LnJvd3MubWFwKChyb3c6IGFueSkgPT4gKHtcbiAgICAgICAgICAgIGlkOiByb3cuaWQsXG4gICAgICAgICAgICB1c2VybmFtZTogcm93LnVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHJvdy5wYXNzd29yZCxcbiAgICAgICAgICAgIGVtYWlsOiByb3cuZW1haWwsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHJvdy5maXJzdF9uYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IHJvdy5sYXN0X25hbWUsXG4gICAgICAgICAgICBwaG9uZTogcm93LnBob25lLFxuICAgICAgICAgICAgcHJvZmlsZUltYWdlOiByb3cucHJvZmlsZV9pbWFnZSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiByb3cubGFuZ3VhZ2UsXG4gICAgICAgICAgICByb2xlOiByb3cucm9sZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiByb3cuaXNfYWN0aXZlLFxuICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHJvdy5sYXN0X2xvZ2luX2F0LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiByb3cuY3JlYXRlZF9hdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogcm93LnVwZGF0ZWRfYXQsXG4gICAgICAgICAgICBvcmdhbml6YXRpb25zOiB0eXBlb2Ygcm93Lm9yZ2FuaXphdGlvbnMgPT09ICdzdHJpbmcnIFxuICAgICAgICAgICAgICA/IEpTT04ucGFyc2Uocm93Lm9yZ2FuaXphdGlvbnMpIFxuICAgICAgICAgICAgICA6IHJvdy5vcmdhbml6YXRpb25zIHx8IFtdLFxuICAgICAgICAgICAgYnVpbGRpbmdzOiB0eXBlb2Ygcm93LmJ1aWxkaW5ncyA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gSlNPTi5wYXJzZShyb3cuYnVpbGRpbmdzKSBcbiAgICAgICAgICAgICAgOiByb3cuYnVpbGRpbmdzIHx8IFtdLFxuICAgICAgICAgICAgcmVzaWRlbmNlczogdHlwZW9mIHJvdy5yZXNpZGVuY2VzID09PSAnc3RyaW5nJyBcbiAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKHJvdy5yZXNpZGVuY2VzKSBcbiAgICAgICAgICAgICAgOiByb3cucmVzaWRlbmNlcyB8fCBbXVxuICAgICAgICAgIH0pKTtcblxuICAgICAgICAgIHJldHVybiB7IHVzZXJzLCB0b3RhbCB9O1xuICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGluIG9wdGltaXplZCBnZXRVc2Vyc1dpdGhBc3NpZ25tZW50c1BhZ2luYXRlZDonLCBlcnJvcik7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gRmFsbGJhY2sgdG8gcGFnaW5hdGVkIHZlcnNpb24gb2YgdGhlIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uIGlmIG9wdGltaXplZCBxdWVyeSBmYWlsc1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SEIEZhbGxpbmcgYmFjayB0byBwYWdpbmF0ZWQgb3JpZ2luYWwgaW1wbGVtZW50YXRpb24uLi4nKTtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZXRVc2Vyc1dpdGhBc3NpZ25tZW50c1BhZ2luYXRlZEZhbGxiYWNrKG9mZnNldCwgbGltaXQsIGZpbHRlcnMpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGYWxsYmFjayBpbXBsZW1lbnRhdGlvbiBmb3IgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHMgaWYgb3B0aW1pemVkIHZlcnNpb24gZmFpbHMuXG4gICAqIFRoaXMgaXMgdGhlIG9yaWdpbmFsIE4rMSBxdWVyeSBpbXBsZW1lbnRhdGlvbiBrZXB0IGZvciByZWxpYWJpbGl0eS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNGYWxsYmFjaygpOiBQcm9taXNlPEFycmF5PFVzZXIgJiB7IG9yZ2FuaXphdGlvbnM6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmcgfT47IGJ1aWxkaW5nczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfT47IHJlc2lkZW5jZXM6IEFycmF5PHsgaWQ6IHN0cmluZzsgdW5pdE51bWJlcjogc3RyaW5nOyBidWlsZGluZ0lkOiBzdHJpbmc7IGJ1aWxkaW5nTmFtZTogc3RyaW5nIH0+IH0+PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBhbGwgdXNlcnMgZmlyc3RcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAvLyBGb3IgZWFjaCB1c2VyLCBmZXRjaCB0aGVpciBhc3NpZ25tZW50cyB3aXRoIGxpbWl0ZWQgY29uY3VycmVuY3kgdG8gcHJldmVudCBjb25uZWN0aW9uIGlzc3Vlc1xuICAgICAgY29uc3QgYmF0Y2hTaXplID0gNTsgLy8gUHJvY2VzcyA1IHVzZXJzIGF0IGEgdGltZSB0byBhdm9pZCBjb25uZWN0aW9uIHBvb2wgZXhoYXVzdGlvblxuICAgICAgY29uc3QgdXNlcnNXaXRoQXNzaWdubWVudHMgPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2Vycy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XG4gICAgICAgIGNvbnN0IGJhdGNoID0gdXNlcnMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSk7XG4gICAgICAgIGNvbnN0IGJhdGNoUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgIGJhdGNoLm1hcChhc3luYyAodXNlcikgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBHZXQgdXNlciBvcmdhbml6YXRpb25zXG4gICAgICAgICAgICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgICAgIHR5cGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEub3JnYW5pemF0aW9ucywgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEdldCB1c2VyIGJ1aWxkaW5ncyAodGhyb3VnaCBvcmdhbml6YXRpb24gcmVsYXRpb25zaGlwcylcbiAgICAgICAgICAgIGNvbnN0IHVzZXJCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLmJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEuYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEdldCB1c2VyIHJlc2lkZW5jZXNcbiAgICAgICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmlkLFxuICAgICAgICAgICAgICAgIHVuaXROdW1iZXI6IHNjaGVtYS5yZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdJZDogc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgICAgICBidWlsZGluZ05hbWU6IHNjaGVtYS5idWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5yZXNpZGVuY2VzLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHNjaGVtYS5yZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBzY2hlbWEuYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uczogdXNlck9yZ3MgfHwgW10sXG4gICAgICAgICAgICAgIGJ1aWxkaW5nczogdXNlckJ1aWxkaW5ncyB8fCBbXSxcbiAgICAgICAgICAgICAgcmVzaWRlbmNlczogdXNlclJlc2lkZW5jZXMgfHwgW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgLy8gUmV0dXJuIHVzZXIgd2l0aCBlbXB0eSBhc3NpZ25tZW50cyBpZiB0aGVyZSdzIGFuIGVycm9yXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgYnVpbGRpbmdzOiBbXSxcbiAgICAgICAgICAgICAgcmVzaWRlbmNlczogW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIHVzZXJzV2l0aEFzc2lnbm1lbnRzLnB1c2goLi4uYmF0Y2hSZXN1bHRzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVzZXJzV2l0aEFzc2lnbm1lbnRzO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBDcml0aWNhbCBlcnJvciBnZXR0aW5nIHVzZXJzIHdpdGggYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgLy8gUmV0dXJuIGVtcHR5IGFycmF5IG9uIGNyaXRpY2FsIGVycm9yXG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBhZ2luYXRlZCBmYWxsYmFjayBpbXBsZW1lbnRhdGlvbiBmb3IgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWQgaWYgb3B0aW1pemVkIHZlcnNpb24gZmFpbHMuXG4gICAqIFRoaXMgaXMgdGhlIG9yaWdpbmFsIE4rMSBxdWVyeSBpbXBsZW1lbnRhdGlvbiB3aXRoIHBhZ2luYXRpb24gc3VwcG9ydC5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWRGYWxsYmFjayhcbiAgICBvZmZzZXQ6IG51bWJlciA9IDAsIFxuICAgIGxpbWl0OiBudW1iZXIgPSAxMCwgXG4gICAgZmlsdGVyczogeyByb2xlPzogc3RyaW5nOyBzdGF0dXM/OiBzdHJpbmc7IG9yZ2FuaXphdGlvbj86IHN0cmluZzsgb3JwaGFuPzogc3RyaW5nOyBkZW1vT25seT86IHN0cmluZzsgbWFuYWdlck9yZ2FuaXphdGlvbnM/OiBzdHJpbmc7IHNlYXJjaD86IHN0cmluZyB9ID0ge31cbiAgKTogUHJvbWlzZTx7XG4gICAgdXNlcnM6IEFycmF5PFVzZXIgJiB7IG9yZ2FuaXphdGlvbnM6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmcgfT47IGJ1aWxkaW5nczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfT47IHJlc2lkZW5jZXM6IEFycmF5PHsgaWQ6IHN0cmluZzsgdW5pdE51bWJlcjogc3RyaW5nOyBidWlsZGluZ0lkOiBzdHJpbmc7IGJ1aWxkaW5nTmFtZTogc3RyaW5nIH0+IH0+O1xuICAgIHRvdGFsOiBudW1iZXI7XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQnVpbGQgV0hFUkUgY29uZGl0aW9ucyBmb3IgZmlsdGVyaW5nXG4gICAgICBsZXQgd2hlcmVDb25kaXRpb25zID0gW107XG4gICAgICBcbiAgICAgIGlmIChmaWx0ZXJzLnJvbGUpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMucm9sZSA9PT0gJ251bGwnKSB7XG4gICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goaXNOdWxsKHNjaGVtYS51c2Vycy5yb2xlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLnVzZXJzLnJvbGUsIGZpbHRlcnMucm9sZSBhcyBhbnkpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBpZiAoZmlsdGVycy5zdGF0dXMpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMuc3RhdHVzID09PSAnbnVsbCcpIHtcbiAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChpc051bGwoc2NoZW1hLnVzZXJzLmlzQWN0aXZlKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBmaWx0ZXJzLnN0YXR1cyA9PT0gJ3RydWUnO1xuICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgaXNBY3RpdmUpKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRGVmYXVsdDogb25seSBzaG93IGFjdGl2ZSB1c2VycyBpZiBubyBzdGF0dXMgZmlsdGVyIGlzIGFwcGxpZWRcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICB9XG5cbiAgICAgIC8vIERlbW8tb25seSBmaWx0ZXIgZm9yIGRlbW8gdXNlcnNcbiAgICAgIGlmIChmaWx0ZXJzLmRlbW9Pbmx5ID09PSAndHJ1ZScpIHtcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goc3FsYCR7c2NoZW1hLnVzZXJzLnJvbGV9IExJS0UgJ2RlbW9fJSdgKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2VhcmNoIGZpbHRlciBmb3IgbmFtZS9lbWFpbFxuICAgICAgaWYgKGZpbHRlcnMuc2VhcmNoICYmIGZpbHRlcnMuc2VhcmNoLnRyaW0oKSkge1xuICAgICAgICBjb25zdCBzZWFyY2hUZXJtID0gYCUke2ZpbHRlcnMuc2VhcmNoLnRyaW0oKS50b0xvd2VyQ2FzZSgpfSVgO1xuICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChcbiAgICAgICAgICBvcihcbiAgICAgICAgICAgIHNxbGBMT1dFUigke3NjaGVtYS51c2Vycy5maXJzdE5hbWV9IHx8ICcgJyB8fCAke3NjaGVtYS51c2Vycy5sYXN0TmFtZX0pIExJS0UgJHtzZWFyY2hUZXJtfWAsXG4gICAgICAgICAgICBzcWxgTE9XRVIoJHtzY2hlbWEudXNlcnMuZW1haWx9KSBMSUtFICR7c2VhcmNoVGVybX1gLFxuICAgICAgICAgICAgc3FsYExPV0VSKCR7c2NoZW1hLnVzZXJzLnVzZXJuYW1lfSkgTElLRSAke3NlYXJjaFRlcm19YFxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NFQVJDSCBGSUxURVIgRkFMTEJBQ0tdIEFwcGxpZWQgc2VhcmNoIGZvcjonLCBmaWx0ZXJzLnNlYXJjaC50cmltKCkpO1xuICAgICAgfVxuXG4gICAgICAvLyBNYW5hZ2VyIG9yZ2FuaXphdGlvbnMgZmlsdGVyXG4gICAgICBpZiAoZmlsdGVycy5tYW5hZ2VyT3JnYW5pemF0aW9ucykge1xuICAgICAgICBjb25zdCBvcmdJZHMgPSBmaWx0ZXJzLm1hbmFnZXJPcmdhbml6YXRpb25zLnNwbGl0KCcsJyk7XG4gICAgICAgIGNvbnN0IG9yZ0ZpbHRlclF1ZXJ5ID0gZGJcbiAgICAgICAgICAuc2VsZWN0KHsgdXNlcklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ0lkcyksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChpbkFycmF5KHNjaGVtYS51c2Vycy5pZCwgb3JnRmlsdGVyUXVlcnkpKTtcbiAgICAgIH1cblxuICAgICAgLy8gT3JwaGFuIGZpbHRlciBpbXBsZW1lbnRhdGlvbiBmb3IgZmFsbGJhY2tcbiAgICAgIGlmIChmaWx0ZXJzLm9ycGhhbiA9PT0gJ3RydWUnKSB7XG4gICAgICAgIC8vIFVzZXJzIHdpdGggbm8gb3JnYW5pemF0aW9uIEFORCBubyByZXNpZGVuY2UgYXNzaWdubWVudHNcbiAgICAgICAgY29uc29sZS5sb2coJ/CfkbsgW0ZBTExCQUNLXSBBcHBseWluZyBvcnBoYW4gZmlsdGVyOiB0cnVlICh1c2VycyB3aXRoIG5vIGFzc2lnbm1lbnRzKScpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdXNlcnNXaXRoT3JncyA9IGRiXG4gICAgICAgICAgLnNlbGVjdERpc3RpbmN0KHsgdXNlcklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVzZXJzV2l0aFJlc2lkZW5jZXMgPSBkYlxuICAgICAgICAgIC5zZWxlY3REaXN0aW5jdCh7IHVzZXJJZDogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBVc2VycyB3aG8gYXJlIE5PVCBpbiBlaXRoZXIgb2YgdGhlc2Ugc3VicXVlcmllc1xuICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBub3RJbkFycmF5KHNjaGVtYS51c2Vycy5pZCwgdXNlcnNXaXRoT3JncyksXG4gICAgICAgICAgICBub3RJbkFycmF5KHNjaGVtYS51c2Vycy5pZCwgdXNlcnNXaXRoUmVzaWRlbmNlcylcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICB9IGVsc2UgaWYgKGZpbHRlcnMub3JwaGFuID09PSAnZmFsc2UnKSB7XG4gICAgICAgIC8vIFVzZXJzIHdpdGggYXQgbGVhc3Qgb25lIG9yZ2FuaXphdGlvbiBPUiByZXNpZGVuY2UgYXNzaWdubWVudFxuICAgICAgICBjb25zb2xlLmxvZygn8J+RuyBbRkFMTEJBQ0tdIEFwcGx5aW5nIG9ycGhhbiBmaWx0ZXI6IGZhbHNlICh1c2VycyB3aXRoIGFzc2lnbm1lbnRzKScpO1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdXNlcnNXaXRoT3JncyA9IGRiXG4gICAgICAgICAgLnNlbGVjdERpc3RpbmN0KHsgdXNlcklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVzZXJzV2l0aFJlc2lkZW5jZXMgPSBkYlxuICAgICAgICAgIC5zZWxlY3REaXN0aW5jdCh7IHVzZXJJZDogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBVc2VycyB3aG8gYXJlIGluIGF0IGxlYXN0IG9uZSBvZiB0aGVzZSBzdWJxdWVyaWVzXG4gICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKFxuICAgICAgICAgIG9yKFxuICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlcnMuaWQsIHVzZXJzV2l0aE9yZ3MpLFxuICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlcnMuaWQsIHVzZXJzV2l0aFJlc2lkZW5jZXMpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfVxuXG4gICAgICAvLyBGaXJzdCBnZXQgdG90YWwgY291bnQgd2l0aCBmaWx0ZXJzXG4gICAgICBjb25zdCB0b3RhbFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBjb3VudDogc3FsPG51bWJlcj5gY291bnQoKilgIH0pXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGFuZCguLi53aGVyZUNvbmRpdGlvbnMpKTtcbiAgICAgIFxuICAgICAgY29uc3QgdG90YWwgPSBOdW1iZXIodG90YWxSZXN1bHRbMF0/LmNvdW50IHx8IDApO1xuXG4gICAgICAvLyBHZXQgcGFnaW5hdGVkIHVzZXJzIHdpdGggZmlsdGVyc1xuICAgICAgY29uc3QgdXNlcnMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoYW5kKC4uLndoZXJlQ29uZGl0aW9ucykpXG4gICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkpXG4gICAgICAgIC5saW1pdChsaW1pdClcbiAgICAgICAgLm9mZnNldChvZmZzZXQpO1xuXG4gICAgICAvLyBGb3IgZWFjaCB1c2VyLCBmZXRjaCB0aGVpciBhc3NpZ25tZW50cyB3aXRoIGxpbWl0ZWQgY29uY3VycmVuY3kgdG8gcHJldmVudCBjb25uZWN0aW9uIGlzc3Vlc1xuICAgICAgY29uc3QgYmF0Y2hTaXplID0gNTsgLy8gUHJvY2VzcyA1IHVzZXJzIGF0IGEgdGltZSB0byBhdm9pZCBjb25uZWN0aW9uIHBvb2wgZXhoYXVzdGlvblxuICAgICAgY29uc3QgdXNlcnNXaXRoQXNzaWdubWVudHMgPSBbXTtcbiAgICAgIFxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB1c2Vycy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XG4gICAgICAgIGNvbnN0IGJhdGNoID0gdXNlcnMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSk7XG4gICAgICAgIGNvbnN0IGJhdGNoUmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgIGJhdGNoLm1hcChhc3luYyAodXNlcikgPT4ge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBHZXQgdXNlciBvcmdhbml6YXRpb25zXG4gICAgICAgICAgICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgICAgIHR5cGU6IHNjaGVtYS5vcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEub3JnYW5pemF0aW9ucywgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEub3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEdldCB1c2VyIGJ1aWxkaW5ncyAodGhyb3VnaCBvcmdhbml6YXRpb24gcmVsYXRpb25zaGlwcylcbiAgICAgICAgICAgIGNvbnN0IHVzZXJCdWlsZGluZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLmJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEuYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQpKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIC8vIEdldCB1c2VyIHJlc2lkZW5jZXNcbiAgICAgICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmlkLFxuICAgICAgICAgICAgICAgIHVuaXROdW1iZXI6IHNjaGVtYS5yZXNpZGVuY2VzLnVuaXROdW1iZXIsXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdJZDogc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgICAgICBidWlsZGluZ05hbWU6IHNjaGVtYS5idWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5yZXNpZGVuY2VzLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHNjaGVtYS5yZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBzY2hlbWEuYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uczogdXNlck9yZ3MgfHwgW10sXG4gICAgICAgICAgICAgIGJ1aWxkaW5nczogdXNlckJ1aWxkaW5ncyB8fCBbXSxcbiAgICAgICAgICAgICAgcmVzaWRlbmNlczogdXNlclJlc2lkZW5jZXMgfHwgW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgLy8gUmV0dXJuIHVzZXIgd2l0aCBlbXB0eSBhc3NpZ25tZW50cyBpZiB0aGVyZSdzIGFuIGVycm9yXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgYnVpbGRpbmdzOiBbXSxcbiAgICAgICAgICAgICAgcmVzaWRlbmNlczogW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIHVzZXJzV2l0aEFzc2lnbm1lbnRzLnB1c2goLi4uYmF0Y2hSZXN1bHRzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgdXNlcnM6IHVzZXJzV2l0aEFzc2lnbm1lbnRzLCB0b3RhbCB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBDcml0aWNhbCBlcnJvciBnZXR0aW5nIHBhZ2luYXRlZCB1c2VycyB3aXRoIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBlbXB0eSByZXN1bHQgb24gY3JpdGljYWwgZXJyb3JcbiAgICAgIHJldHVybiB7IHVzZXJzOiBbXSwgdG90YWw6IDAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHVzZXJzIGZyb20gb3JnYW5pemF0aW9ucyB0aGF0IGEgc3BlY2lmaWMgdXNlciBoYXMgYWNjZXNzIHRvLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXRVc2Vyc0J5T3JnYW5pemF0aW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8VXNlcltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlcnNCeU9yZ2FuaXphdGlvbnMnLFxuICAgICAgYHVzZXJzX2J5X29yZzoke3VzZXJJZH1gLFxuICAgICAgJ3VzZXJzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gRmlyc3QsIGdldCBvcmdhbml6YXRpb24gSURzIHRoYXQgdGhlIHVzZXIgaGFzIGFjY2VzcyB0b1xuICAgICAgICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBpZiAodXNlck9yZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWRzID0gdXNlck9yZ3MubWFwKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25JZCk7XG5cbiAgICAgICAgLy8gVGhlbiBnZXQgYWxsIHVzZXJzIGZyb20gdGhvc2Ugb3JnYW5pemF0aW9uc1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBzY2hlbWEudXNlcnMuaWQsXG4gICAgICAgICAgICB1c2VybmFtZTogc2NoZW1hLnVzZXJzLnVzZXJuYW1lLFxuICAgICAgICAgICAgcGFzc3dvcmQ6IHNjaGVtYS51c2Vycy5wYXNzd29yZCxcbiAgICAgICAgICAgIGVtYWlsOiBzY2hlbWEudXNlcnMuZW1haWwsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHNjaGVtYS51c2Vycy5maXJzdE5hbWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogc2NoZW1hLnVzZXJzLmxhc3ROYW1lLFxuICAgICAgICAgICAgcGhvbmU6IHNjaGVtYS51c2Vycy5waG9uZSxcbiAgICAgICAgICAgIHByb2ZpbGVJbWFnZTogc2NoZW1hLnVzZXJzLnByb2ZpbGVJbWFnZSxcbiAgICAgICAgICAgIGxhbmd1YWdlOiBzY2hlbWEudXNlcnMubGFuZ3VhZ2UsXG4gICAgICAgICAgICByb2xlOiBzY2hlbWEudXNlcnMucm9sZSxcbiAgICAgICAgICAgIGlzQWN0aXZlOiBzY2hlbWEudXNlcnMuaXNBY3RpdmUsXG4gICAgICAgICAgICBsYXN0TG9naW5BdDogc2NoZW1hLnVzZXJzLmxhc3RMb2dpbkF0LFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBzY2hlbWEudXNlcnMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBzY2hlbWEudXNlcnMudXBkYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLCBlcShzY2hlbWEudXNlcnMuaWQsIHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkcylcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnVzZXJzLmZpcnN0TmFtZSwgc2NoZW1hLnVzZXJzLmxhc3ROYW1lKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgcGFnaW5hdGVkIHVzZXJzIHdpdGggb3B0aW1pemVkIHF1ZXJ5IHN0cnVjdHVyZS5cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHBhcmFtIF9vcHRpb25zXG4gICAqL1xuICBhc3luYyBnZXRQYWdpbmF0ZWRVc2Vycyhfb3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPHsgdXNlcnM6IFVzZXJbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgUGFnaW5hdGlvbkhlbHBlci52YWxpZGF0ZVBhZ2luYXRpb24oX29wdGlvbnMpO1xuXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgcGFnaW5hdGVkX3VzZXJzOiR7X29wdGlvbnMucGFnZX06JHtfb3B0aW9ucy5wYWdlU2l6ZX06JHtfb3B0aW9ucy5zb3J0Qnl9OiR7X29wdGlvbnMuc29ydERpcmVjdGlvbn1gO1xuXG4gICAgLy8gVHJ5IGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gcXVlcnlDYWNoZS5nZXQ8eyB1c2VyczogVXNlcltdOyB0b3RhbDogbnVtYmVyIH0+KCd1c2VycycsIGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIC8vIEdldCB0b3RhbCBjb3VudCB1c2luZyBjb3ZlcmluZyBpbmRleFxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbCB9XSA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKTtcblxuICAgIC8vIEdldCBwYWdpbmF0ZWQgcmVzdWx0cyB3aXRoIExJTUlUIGFuZCBvcHRpbWl6ZWQgT1JERVIgQllcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgLm9yZGVyQnkoXG4gICAgICAgIF9vcHRpb25zLnNvcnREaXJlY3Rpb24gPT09ICdERVNDJyA/IGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkgOiBzY2hlbWEudXNlcnMuY3JlYXRlZEF0XG4gICAgICApXG4gICAgICAubGltaXQoX29wdGlvbnMucGFnZVNpemUpXG4gICAgICAub2Zmc2V0KChfb3B0aW9ucy5wYWdlIC0gMSkgKiBfb3B0aW9ucy5wYWdlU2l6ZSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSB7IHVzZXJzLCB0b3RhbCB9O1xuICAgIHF1ZXJ5Q2FjaGUuc2V0KCd1c2VycycsIGNhY2hlS2V5LCByZXN1bHQpO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGJ1aWxkaW5ncyB3aXRoIHJlc2lkZW50cyB1c2luZyBFWElTVFMgaW5zdGVhZCBvZiBJTiBzdWJxdWVyeS5cbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqIEBwYXJhbSBsaW1pdFxuICAgKi9cbiAgYXN5bmMgZ2V0QnVpbGRpbmdzV2l0aFJlc2lkZW50cyhvcmdhbml6YXRpb25JZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNTApOiBQcm9taXNlPEJ1aWxkaW5nW10+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBidWlsZGluZ3Nfd2l0aF9yZXNpZGVudHM6JHtvcmdhbml6YXRpb25JZH06JHtsaW1pdH1gO1xuXG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QnVpbGRpbmdzV2l0aFJlc2lkZW50cycsXG4gICAgICBjYWNoZUtleSxcbiAgICAgICdidWlsZGluZ3MnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgZXhpc3RzKFxuICAgICAgICAgICAgICAgIGRiXG4gICAgICAgICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAubGltaXQobGltaXQpIC8vIEFsd2F5cyB1c2UgTElNSVQgZm9yIGxhcmdlIHJlc3VsdCBzZXRzXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2hlcyB1c2VycyB3aXRoIG9wdGltaXplZCBjb3ZlcmluZyBpbmRleCBhbmQgTElNSVQuXG4gICAqIEBwYXJhbSBxdWVyeVxuICAgKiBAcGFyYW0gbGltaXRcbiAgICovXG4gIGFzeW5jIHNlYXJjaFVzZXJzKHF1ZXJ5OiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAyMCk6IFByb21pc2U8VXNlcltdPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgc2VhcmNoX3VzZXJzOiR7cXVlcnl9OiR7bGltaXR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdzZWFyY2hVc2VycycsIGNhY2hlS2V5LCAndXNlcnMnLCAoKSA9PlxuICAgICAgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBvcihcbiAgICAgICAgICAgICAgbGlrZShzY2hlbWEudXNlcnMuZW1haWwsIGAlJHtxdWVyeX0lYCksXG4gICAgICAgICAgICAgIGxpa2Uoc2NoZW1hLnVzZXJzLmZpcnN0TmFtZSwgYCUke3F1ZXJ5fSVgKSxcbiAgICAgICAgICAgICAgbGlrZShzY2hlbWEudXNlcnMubGFzdE5hbWUsIGAlJHtxdWVyeX0lYClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLmxpbWl0KGxpbWl0KSAvLyBBbHdheXMgbGltaXQgc2VhcmNoIHJlc3VsdHNcbiAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnVzZXJzLmxhc3ROYW1lLCBzY2hlbWEudXNlcnMuZmlyc3ROYW1lKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBmaW5hbmNpYWwgc3VtbWFyeSB1c2luZyBtYXRlcmlhbGl6ZWQgdmlldyBmb3IgY29tcGxleCBhZ2dyZWdhdGlvbnMuXG4gICAqIEBwYXJhbSBidWlsZGluZ0lkXG4gICAqL1xuICBhc3luYyBnZXRGaW5hbmNpYWxTdW1tYXJ5KGJ1aWxkaW5nSWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBmaW5hbmNpYWxfc3VtbWFyeToke2J1aWxkaW5nSWR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRGaW5hbmNpYWxTdW1tYXJ5JywgY2FjaGVLZXksICdmaW5hbmNpYWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2UgbWF0ZXJpYWxpemVkIHZpZXcgZm9yIGNvbXBsZXggYWdncmVnYXRpb25zXG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZGIuZXhlY3V0ZShcbiAgICAgICAgc3FsT3BgU0VMRUNUICogRlJPTSBtdl9maW5hbmNpYWxfc3VtbWFyeSBXSEVSRSBidWlsZGluZ19pZCA9ICR7YnVpbGRpbmdJZH0gT1JERVIgQlkgbW9udGggREVTQyBMSU1JVCAxMmBcbiAgICAgICk7XG4gICAgICByZXR1cm4gc3VtbWFyeS5yb3dzO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYnVpbGRpbmcgc3RhdGlzdGljcyB1c2luZyBtYXRlcmlhbGl6ZWQgdmlldy5cbiAgICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5nU3RhdHMoYnVpbGRpbmdJZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBidWlsZGluZ19zdGF0czoke2J1aWxkaW5nSWR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRCdWlsZGluZ1N0YXRzJywgY2FjaGVLZXksICdidWlsZGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2UgbWF0ZXJpYWxpemVkIHZpZXcgZm9yIGRhc2hib2FyZCBzdGF0aXN0aWNzXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGRiLmV4ZWN1dGUoXG4gICAgICAgIHNxbE9wYFNFTEVDVCAqIEZST00gbXZfYnVpbGRpbmdfc3RhdHMgV0hFUkUgYnVpbGRpbmdfaWQgPSAke2J1aWxkaW5nSWR9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBzdGF0cy5yb3dzWzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIHNwZWNpZmljIHVzZXIgYnkgSUQgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldFVzZXIoaWQ6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRVc2VyJywgYHVzZXI6JHtpZH1gLCAndXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIGlkKSk7XG4gICAgICBcbiAgICAgIC8vIFVzZXIgbG9va3VwIGNvbXBsZXRlZFxuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSB1c2VyIGJ5IGVtYWlsIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGVtYWlsXG4gICAqL1xuICBhc3luYyBnZXRVc2VyQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxVc2VyIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFVzZXJCeUVtYWlsJywgYHVzZXJfZW1haWw6JHtlbWFpbH1gLCAndXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCBlbWFpbCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHVzZXIgd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpbnNlcnRVc2VyXG4gICAqL1xuICBhc3luYyBjcmVhdGVVc2VyKGluc2VydFVzZXI6IEluc2VydFVzZXIpOiBQcm9taXNlPFVzZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVVc2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQXV0b21hdGljYWxseSBzZXQgZGVtbyBwYXNzd29yZCBmb3IgZGVtbyByb2xlIHVzZXJzXG4gICAgICBsZXQgcGFzc3dvcmQgPSBpbnNlcnRVc2VyLnBhc3N3b3JkO1xuICAgICAgY29uc3QgaXNEZW1vUm9sZSA9IFsnZGVtb19tYW5hZ2VyJywgJ2RlbW9fdGVuYW50JywgJ2RlbW9fcmVzaWRlbnQnXS5pbmNsdWRlcyhpbnNlcnRVc2VyLnJvbGUpO1xuICAgICAgXG4gICAgICBpZiAoaXNEZW1vUm9sZSkge1xuICAgICAgICAvLyBBbHdheXMgc2V0IHRoZSBzdGFuZGFyZCBkZW1vIHBhc3N3b3JkIGhhc2ggZm9yIGRlbW8gdXNlcnMsIHJlZ2FyZGxlc3Mgb2YgcHJvdmlkZWQgcGFzc3dvcmRcbiAgICAgICAgcGFzc3dvcmQgPSAnJDJiJDEyJGNPYy9Rak1qemxocUFRcUYyYi9NVE9acjJRQXRFUmJYSkdkNE9TYTFDWE1sRjA0RkMzRjAyJzsgLy8gZGVtbzEyMzQ1NlxuICAgICAgICBjb25zb2xlLmxvZygn8J+OrSBTZXR0aW5nIGRlbW8gcGFzc3dvcmQgZm9yIHVzZXIgd2l0aCByb2xlOicsIGluc2VydFVzZXIucm9sZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEVuc3VyZSB1c2VybmFtZSB1bmlxdWVuZXNzIHdpdGggcmFuZG9tIG51bWJlcnMgaWYgY29sbGlzaW9uIG9jY3Vyc1xuICAgICAgbGV0IHVuaXF1ZVVzZXJuYW1lID0gaW5zZXJ0VXNlci51c2VybmFtZTtcbiAgICAgIGxldCBhdHRlbXB0cyA9IDA7XG4gICAgICBjb25zdCBtYXhBdHRlbXB0cyA9IDEwO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgdXNlcm5hbWUgY29sbGlzaW9uXG4gICAgICBsZXQgZXhpc3RpbmdVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IHVzZXJuYW1lOiBzY2hlbWEudXNlcnMudXNlcm5hbWUgfSlcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLnVzZXJuYW1lLCB1bmlxdWVVc2VybmFtZSkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgd2hpbGUgKGV4aXN0aW5nVXNlci5sZW5ndGggPiAwICYmIGF0dGVtcHRzIDwgbWF4QXR0ZW1wdHMpIHtcbiAgICAgICAgLy8gR2VuZXJhdGUgcmFuZG9tIDQtZGlnaXQgc3VmZml4XG4gICAgICAgIGNvbnN0IHJhbmRvbVN1ZmZpeCA9IE1hdGguZmxvb3IoMTAwMCArIE1hdGgucmFuZG9tKCkgKiA5MDAwKTtcbiAgICAgICAgdW5pcXVlVXNlcm5hbWUgPSBgJHtpbnNlcnRVc2VyLnVzZXJuYW1lfSR7cmFuZG9tU3VmZml4fWA7XG4gICAgICAgIGF0dGVtcHRzKys7XG4gICAgICAgIFxuICAgICAgICBleGlzdGluZ1VzZXIgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyB1c2VybmFtZTogc2NoZW1hLnVzZXJzLnVzZXJuYW1lIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMudXNlcm5hbWUsIHVuaXF1ZVVzZXJuYW1lKSlcbiAgICAgICAgICAubGltaXQoMSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChhdHRlbXB0cyA+PSBtYXhBdHRlbXB0cyAmJiBleGlzdGluZ1VzZXIubGVuZ3RoID4gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBnZW5lcmF0ZSB1bmlxdWUgdXNlcm5hbWUgYWZ0ZXIgbWF4aW11bSBhdHRlbXB0cycpO1xuICAgICAgfVxuXG4gICAgICAvLyBGaWx0ZXIgb25seSB0aGUgZmllbGRzIHRoYXQgZXhpc3QgaW4gdGhlIGRhdGFiYXNlIHNjaGVtYVxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XG4gICAgICAgIHVzZXJuYW1lOiB1bmlxdWVVc2VybmFtZSxcbiAgICAgICAgZW1haWw6IGluc2VydFVzZXIuZW1haWwsXG4gICAgICAgIHBhc3N3b3JkLFxuICAgICAgICBmaXJzdE5hbWU6IGluc2VydFVzZXIuZmlyc3ROYW1lLFxuICAgICAgICBsYXN0TmFtZTogaW5zZXJ0VXNlci5sYXN0TmFtZSxcbiAgICAgICAgcGhvbmU6IGluc2VydFVzZXIucGhvbmUgfHwgJycsXG4gICAgICAgIHByb2ZpbGVJbWFnZTogaW5zZXJ0VXNlci5wcm9maWxlSW1hZ2UsXG4gICAgICAgIGxhbmd1YWdlOiBpbnNlcnRVc2VyLmxhbmd1YWdlIHx8ICdmcicsXG4gICAgICAgIHJvbGU6IGluc2VydFVzZXIucm9sZSxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsIC8vIERlZmF1bHQgdmFsdWUgZm9yIG5ldyB1c2Vyc1xuICAgICAgfTtcblxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBpbnNlcnRlZCA9IGF3YWl0IGRiLmluc2VydChzY2hlbWEudXNlcnMpLnZhbHVlcyhbdXNlckRhdGFdKS5yZXR1cm5pbmcoKTtcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBpbnNlcnRlZDtcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIHVzZXI6JywgZXJyb3IpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZXNcbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVVc2VyQ2FjaGVzKCcqJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSB1c2VyIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVVzZXIoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxVc2VyPik6IFByb21pc2U8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZVVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEudXNlcnMpXG4gICAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIHNwZWNpZmljIHVzZXIgY2FjaGVzXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlVXNlckNhY2hlcyhpZCk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBvcmdhbml6YXRpb25zIGZvciBhIHNwZWNpZmljIHVzZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldFVzZXJPcmdhbml6YXRpb25zKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBcnJheTx7IG9yZ2FuaXphdGlvbklkOiBzdHJpbmcgfT4+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRVc2VyT3JnYW5pemF0aW9ucycsXG4gICAgICBgdXNlcl9vcmdzOiR7dXNlcklkfWAsXG4gICAgICAndXNlcnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXJJZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIHJlc2lkZW5jZXMgZm9yIGEgc3BlY2lmaWMgdXNlci5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlclJlc2lkZW5jZXModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHsgcmVzaWRlbmNlSWQ6IHN0cmluZyB9Pj4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFVzZXJSZXNpZGVuY2VzJyxcbiAgICAgIGB1c2VyX3Jlc2lkZW5jZXM6JHt1c2VySWR9YCxcbiAgICAgICdyZXNpZGVuY2VzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHJlc2lkZW5jZUlkOiBzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXJJZCksIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLy8gT3JnYW5pemF0aW9uIG9wZXJhdGlvbnMgd2l0aCBvcHRpbWl6YXRpb25cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFsbCBhY3RpdmUgb3JnYW5pemF0aW9ucyB3aXRoIGNhY2hpbmcuXG4gICAqL1xuICBhc3luYyBnZXRPcmdhbml6YXRpb25zKCk6IFByb21pc2U8T3JnYW5pemF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0T3JnYW5pemF0aW9ucycsICdhbGxfb3JnYW5pemF0aW9ucycsICdvcmdhbml6YXRpb25zJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbiBvcmdhbml6YXRpb24gYnkgSUQgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldE9yZ2FuaXphdGlvbihpZDogc3RyaW5nKTogUHJvbWlzZTxPcmdhbml6YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRPcmdhbml6YXRpb24nLFxuICAgICAgYG9yZ2FuaXphdGlvbjoke2lkfWAsXG4gICAgICAnb3JnYW5pemF0aW9ucycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBpZCkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBvcmdhbml6YXRpb24gd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpbnNlcnRPcmdhbml6YXRpb25cbiAgICovXG4gIGFzeW5jIGNyZWF0ZU9yZ2FuaXphdGlvbihpbnNlcnRPcmdhbml6YXRpb246IEluc2VydE9yZ2FuaXphdGlvbik6IFByb21pc2U8T3JnYW5pemF0aW9uPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlT3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEub3JnYW5pemF0aW9ucykudmFsdWVzKGluc2VydE9yZ2FuaXphdGlvbikucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIG9yZ2FuaXphdGlvbiBjYWNoZXNcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ29yZ2FuaXphdGlvbnMnKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBCdWlsZGluZyBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBidWlsZGluZ3MgYnkgb3JnYW5pemF0aW9uIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRCdWlsZGluZ3NCeU9yZ2FuaXphdGlvbihvcmdhbml6YXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxCdWlsZGluZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QnVpbGRpbmdzQnlPcmdhbml6YXRpb24nLFxuICAgICAgYG9yZ19idWlsZGluZ3M6JHtvcmdhbml6YXRpb25JZH1gLFxuICAgICAgJ2J1aWxkaW5ncycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25JZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGEgYnVpbGRpbmcgYnkgSUQgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5nKGlkOiBzdHJpbmcpOiBQcm9taXNlPEJ1aWxkaW5nIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldEJ1aWxkaW5nJywgYGJ1aWxkaW5nOiR7aWR9YCwgJ2J1aWxkaW5ncycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmJ1aWxkaW5ncykud2hlcmUoZXEoc2NoZW1hLmJ1aWxkaW5ncy5pZCwgaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBidWlsZGluZyB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGluc2VydEJ1aWxkaW5nXG4gICAqL1xuICBhc3luYyBjcmVhdGVCdWlsZGluZyhpbnNlcnRCdWlsZGluZzogSW5zZXJ0QnVpbGRpbmcpOiBQcm9taXNlPEJ1aWxkaW5nPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlQnVpbGRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5idWlsZGluZ3MpLnZhbHVlcyhbaW5zZXJ0QnVpbGRpbmddKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgYnVpbGRpbmcgY2FjaGVzXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlQnVpbGRpbmdDYWNoZXMoJyonKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBSZXNpZGVuY2Ugb3BlcmF0aW9ucyB3aXRoIG9wdGltaXphdGlvblxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcmVzaWRlbmNlcyBieSBidWlsZGluZyB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBidWlsZGluZ0lkXG4gICAqL1xuICBhc3luYyBnZXRSZXNpZGVuY2VzQnlCdWlsZGluZyhidWlsZGluZ0lkOiBzdHJpbmcpOiBQcm9taXNlPFJlc2lkZW5jZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0UmVzaWRlbmNlc0J5QnVpbGRpbmcnLFxuICAgICAgYGJ1aWxkaW5nX3Jlc2lkZW5jZXM6JHtidWlsZGluZ0lkfWAsXG4gICAgICAncmVzaWRlbmNlcycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgIClcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEucmVzaWRlbmNlcy51bml0TnVtYmVyKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGEgcmVzaWRlbmNlIGJ5IElEIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRSZXNpZGVuY2UoaWQ6IHN0cmluZyk6IFByb21pc2U8UmVzaWRlbmNlIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFJlc2lkZW5jZScsIGByZXNpZGVuY2U6JHtpZH1gLCAncmVzaWRlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IHJlc2lkZW5jZSB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGluc2VydFJlc2lkZW5jZVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUmVzaWRlbmNlKGluc2VydFJlc2lkZW5jZTogSW5zZXJ0UmVzaWRlbmNlKTogUHJvbWlzZTxSZXNpZGVuY2U+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVSZXNpZGVuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5yZXNpZGVuY2VzKS52YWx1ZXMoW2luc2VydFJlc2lkZW5jZV0pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSByZXNpZGVuY2UgY2FjaGVzXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlUmVzaWRlbmNlQ2FjaGVzKCcqJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gQWRkaXRpb25hbCBvcHRpbWl6ZWQgbWV0aG9kcyBmb3IgZnJlcXVlbnRseSBhY2Nlc3NlZCBkYXRhXG5cbiAgLyoqXG4gICAqIEdldHMgdXNlciByZXNpZGVuY2VzIHdpdGggZnVsbCBkZXRhaWxzIC0gZm9yIGNvbXBsZXggcmVzaWRlbmNlIHZpZXdzLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXRVc2VyUmVzaWRlbmNlc1dpdGhEZXRhaWxzKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFVzZXJSZXNpZGVuY2VzV2l0aERldGFpbHMnLFxuICAgICAgYHVzZXJfcmVzaWRlbmNlc19kZXRhaWxzOiR7dXNlcklkfWAsXG4gICAgICAncmVzaWRlbmNlcycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgcmVzaWRlbmNlOiBzY2hlbWEucmVzaWRlbmNlcyxcbiAgICAgICAgICAgIGJ1aWxkaW5nOiBzY2hlbWEuYnVpbGRpbmdzLFxuICAgICAgICAgICAgdXNlclJlc2lkZW5jZTogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnJlc2lkZW5jZXMsIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgc2NoZW1hLnJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXJJZCksIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhY3RpdmUgYmlsbHMgZm9yIGEgcmVzaWRlbmNlIC0gZnJlcXVlbnRseSBxdWVyaWVkLlxuICAgKiBAcGFyYW0gcmVzaWRlbmNlSWRcbiAgICovXG4gIGFzeW5jIGdldEFjdGl2ZUJpbGxzQnlSZXNpZGVuY2UocmVzaWRlbmNlSWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRBY3RpdmVCaWxsc0J5UmVzaWRlbmNlJyxcbiAgICAgIGByZXNpZGVuY2VfYmlsbHM6JHtyZXNpZGVuY2VJZH1gLFxuICAgICAgJ2JpbGxzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmJpbGxzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJpbGxzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZCksXG4gICAgICAgICAgICAgIG9yKGVxKHNjaGVtYS5iaWxscy5zdGF0dXMsICdzZW50JyksIGVxKHNjaGVtYS5iaWxscy5zdGF0dXMsICdvdmVyZHVlJykpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLmJpbGxzLmR1ZURhdGUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBtYWludGVuYW5jZSByZXF1ZXN0cyBmb3IgYSByZXNpZGVuY2UgLSBmcmVxdWVudGx5IGFjY2Vzc2VkLlxuICAgKiBAcGFyYW0gcmVzaWRlbmNlSWRcbiAgICovXG4gIGFzeW5jIGdldE1haW50ZW5hbmNlUmVxdWVzdHNCeVJlc2lkZW5jZShyZXNpZGVuY2VJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldE1haW50ZW5hbmNlUmVxdWVzdHNCeVJlc2lkZW5jZScsXG4gICAgICBgcmVzaWRlbmNlX21haW50ZW5hbmNlOiR7cmVzaWRlbmNlSWR9YCxcbiAgICAgICdtYWludGVuYW5jZScsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMuY3JlYXRlZEF0KSlcbiAgICApO1xuICB9XG5cbiAgLy8gTWlzc2luZyBPcmdhbml6YXRpb24gb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIG9yZ2FuaXphdGlvbiBieSBuYW1lIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIG5hbWVcbiAgICovXG4gIGFzeW5jIGdldE9yZ2FuaXphdGlvbkJ5TmFtZShuYW1lOiBzdHJpbmcpOiBQcm9taXNlPE9yZ2FuaXphdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldE9yZ2FuaXphdGlvbkJ5TmFtZScsXG4gICAgICBgb3JnX25hbWU6JHtuYW1lfWAsXG4gICAgICAnb3JnYW5pemF0aW9ucycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLm5hbWUsIG5hbWUpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgb3JnYW5pemF0aW9uIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZU9yZ2FuaXphdGlvbihcbiAgICBpZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IFBhcnRpYWw8T3JnYW5pemF0aW9uPlxuICApOiBQcm9taXNlPE9yZ2FuaXphdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZU9yZ2FuaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVVc2VyQ2FjaGVzKCcqJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIE1pc3NpbmcgQnVpbGRpbmcgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBidWlsZGluZ3Mgd2l0aCBjYWNoaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0QnVpbGRpbmdzKCk6IFByb21pc2U8QnVpbGRpbmdbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRCdWlsZGluZ3MnLCAnYWxsX2J1aWxkaW5ncycsICdidWlsZGluZ3MnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVpbGRpbmdzKS53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYnVpbGRpbmcgd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlQnVpbGRpbmcoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxCdWlsZGluZz4pOiBQcm9taXNlPEJ1aWxkaW5nIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlQnVpbGRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZUJ1aWxkaW5nQ2FjaGVzKGlkKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgYnVpbGRpbmcgKHNvZnQgZGVsZXRlKS5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBkZWxldGVCdWlsZGluZyhpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlQnVpbGRpbmcnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWlsZGluZ3MuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlQnVpbGRpbmdDYWNoZXMoaWQpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vIE1pc3NpbmcgUmVzaWRlbmNlIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgcmVzaWRlbmNlcyB3aXRoIGNhY2hpbmcuXG4gICAqL1xuICBhc3luYyBnZXRSZXNpZGVuY2VzKCk6IFByb21pc2U8UmVzaWRlbmNlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0UmVzaWRlbmNlcycsICdhbGxfcmVzaWRlbmNlcycsICdyZXNpZGVuY2VzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgcmVzaWRlbmNlIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVJlc2lkZW5jZShpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPFJlc2lkZW5jZT4pOiBQcm9taXNlPFJlc2lkZW5jZSB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZVJlc2lkZW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVSZXNpZGVuY2VDYWNoZXMoaWQpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyByZXNpZGVuY2UgKHNvZnQgZGVsZXRlKS5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBkZWxldGVSZXNpZGVuY2UoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZVJlc2lkZW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVJlc2lkZW5jZUNhY2hlcyhpZCk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gRGV2ZWxvcG1lbnQgUGlsbGFyIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgZGV2ZWxvcG1lbnQgcGlsbGFycy5cbiAgICovXG4gIGFzeW5jIGdldFBpbGxhcnMoKTogUHJvbWlzZTxEZXZlbG9wbWVudFBpbGxhcltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFBpbGxhcnMnLCAnYWxsX3BpbGxhcnMnLCAncGlsbGFycycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGRldmVsb3BtZW50IHBpbGxhciBieSBJRC5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRQaWxsYXIoaWQ6IHN0cmluZyk6IFByb21pc2U8RGV2ZWxvcG1lbnRQaWxsYXIgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0UGlsbGFyJywgYHBpbGxhcjoke2lkfWAsICdwaWxsYXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGRldmVsb3BtZW50IHBpbGxhci5cbiAgICogQHBhcmFtIHBpbGxhclxuICAgKi9cbiAgYXN5bmMgY3JlYXRlUGlsbGFyKHBpbGxhcjogSW5zZXJ0UGlsbGFyKTogUHJvbWlzZTxEZXZlbG9wbWVudFBpbGxhcj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZVBpbGxhcicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycykudmFsdWVzKHBpbGxhcikucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3BpbGxhcnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgZGV2ZWxvcG1lbnQgcGlsbGFyLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHBpbGxhclxuICAgKi9cbiAgYXN5bmMgdXBkYXRlUGlsbGFyKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgcGlsbGFyOiBQYXJ0aWFsPERldmVsb3BtZW50UGlsbGFyPlxuICApOiBQcm9taXNlPERldmVsb3BtZW50UGlsbGFyIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlUGlsbGFyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycylcbiAgICAgICAgLnNldCh7IC4uLnBpbGxhciwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncGlsbGFycycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBXb3Jrc3BhY2UgU3RhdHVzIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgd29ya3NwYWNlIHN0YXR1c2VzLlxuICAgKi9cbiAgYXN5bmMgZ2V0V29ya3NwYWNlU3RhdHVzZXMoKTogUHJvbWlzZTxXb3Jrc3BhY2VTdGF0dXNbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFdvcmtzcGFjZVN0YXR1c2VzJyxcbiAgICAgICdhbGxfd29ya3NwYWNlX3N0YXR1c2VzJyxcbiAgICAgICd3b3Jrc3BhY2Vfc3RhdHVzJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLndvcmtzcGFjZVN0YXR1cylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgd29ya3NwYWNlIHN0YXR1cyBieSBjb21wb25lbnQuXG4gICAqIEBwYXJhbSBjb21wb25lbnRcbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZVN0YXR1cyhjb21wb25lbnQ6IHN0cmluZyk6IFByb21pc2U8V29ya3NwYWNlU3RhdHVzIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0V29ya3NwYWNlU3RhdHVzJyxcbiAgICAgIGB3b3Jrc3BhY2Vfc3RhdHVzOiR7Y29tcG9uZW50fWAsXG4gICAgICAnd29ya3NwYWNlX3N0YXR1cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLndvcmtzcGFjZVN0YXR1cylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLndvcmtzcGFjZVN0YXR1cy5jb21wb25lbnQsIGNvbXBvbmVudCkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyB3b3Jrc3BhY2Ugc3RhdHVzLlxuICAgKiBAcGFyYW0gc3RhdHVzXG4gICAqL1xuICBhc3luYyBjcmVhdGVXb3Jrc3BhY2VTdGF0dXMoc3RhdHVzOiBJbnNlcnRXb3Jrc3BhY2VTdGF0dXMpOiBQcm9taXNlPFdvcmtzcGFjZVN0YXR1cz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZVdvcmtzcGFjZVN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLndvcmtzcGFjZVN0YXR1cykudmFsdWVzKHN0YXR1cykucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3dvcmtzcGFjZV9zdGF0dXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgd29ya3NwYWNlIHN0YXR1cy5cbiAgICogQHBhcmFtIGNvbXBvbmVudFxuICAgKiBAcGFyYW0gc3RhdHVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVXb3Jrc3BhY2VTdGF0dXMoXG4gICAgY29tcG9uZW50OiBzdHJpbmcsXG4gICAgc3RhdHVzOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxXb3Jrc3BhY2VTdGF0dXMgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVXb3Jrc3BhY2VTdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEud29ya3NwYWNlU3RhdHVzKVxuICAgICAgICAuc2V0KHsgc3RhdHVzIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEud29ya3NwYWNlU3RhdHVzLmNvbXBvbmVudCwgY29tcG9uZW50KSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd3b3Jrc3BhY2Vfc3RhdHVzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIFF1YWxpdHkgTWV0cmljcyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHF1YWxpdHkgbWV0cmljcy5cbiAgICovXG4gIGFzeW5jIGdldFF1YWxpdHlNZXRyaWNzKCk6IFByb21pc2U8UXVhbGl0eU1ldHJpY1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0UXVhbGl0eU1ldHJpY3MnLFxuICAgICAgJ2FsbF9xdWFsaXR5X21ldHJpY3MnLFxuICAgICAgJ3F1YWxpdHlfbWV0cmljcycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5xdWFsaXR5TWV0cmljcylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgcXVhbGl0eSBtZXRyaWMuXG4gICAqIEBwYXJhbSBtZXRyaWNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVF1YWxpdHlNZXRyaWMobWV0cmljOiBJbnNlcnRRdWFsaXR5TWV0cmljKTogUHJvbWlzZTxRdWFsaXR5TWV0cmljPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlUXVhbGl0eU1ldHJpYycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLnF1YWxpdHlNZXRyaWNzKS52YWx1ZXMobWV0cmljKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncXVhbGl0eV9tZXRyaWNzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIEZyYW1ld29yayBDb25maWd1cmF0aW9uIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgZnJhbWV3b3JrIGNvbmZpZ3VyYXRpb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0RnJhbWV3b3JrQ29uZmlncygpOiBQcm9taXNlPEZyYW1ld29ya0NvbmZpZ3VyYXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZyYW1ld29ya0NvbmZpZ3MnLFxuICAgICAgJ2FsbF9mcmFtZXdvcmtfY29uZmlncycsXG4gICAgICAnZnJhbWV3b3JrX2NvbmZpZ3MnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZnJhbWV3b3JrQ29uZmlndXJhdGlvbilcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZnJhbWV3b3JrIGNvbmZpZyBieSBrZXkuXG4gICAqIEBwYXJhbSBrZXlcbiAgICogQHBhcmFtIF9rZXlcbiAgICovXG4gIGFzeW5jIGdldEZyYW1ld29ya0NvbmZpZyhfa2V5OiBzdHJpbmcpOiBQcm9taXNlPEZyYW1ld29ya0NvbmZpZ3VyYXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGcmFtZXdvcmtDb25maWcnLFxuICAgICAgYGZyYW1ld29ya19jb25maWc6JHtfa2V5fWAsXG4gICAgICAnZnJhbWV3b3JrX2NvbmZpZ3MnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mcmFtZXdvcmtDb25maWd1cmF0aW9uKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuZnJhbWV3b3JrQ29uZmlndXJhdGlvbi5fa2V5LCBfa2V5KSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIGZyYW1ld29yayBjb25maWd1cmF0aW9uLlxuICAgKiBAcGFyYW0gY29uZmlnXG4gICAqL1xuICBhc3luYyBzZXRGcmFtZXdvcmtDb25maWcoY29uZmlnOiBJbnNlcnRGcmFtZXdvcmtDb25maWd1cmF0aW9uKTogUHJvbWlzZTxGcmFtZXdvcmtDb25maWd1cmF0aW9uPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnc2V0RnJhbWV3b3JrQ29uZmlnJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmZyYW1ld29ya0NvbmZpZ3VyYXRpb24pXG4gICAgICAgIC52YWx1ZXMoY29uZmlnKVxuICAgICAgICAub25Db25mbGljdERvVXBkYXRlKHtcbiAgICAgICAgICB0YXJnZXQ6IHNjaGVtYS5mcmFtZXdvcmtDb25maWd1cmF0aW9uLl9rZXksXG4gICAgICAgICAgc2V0OiB7IF92YWx1ZTogY29uZmlnLl92YWx1ZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0sXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZnJhbWV3b3JrX2NvbmZpZ3MnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gSW1wcm92ZW1lbnQgU3VnZ2VzdGlvbnMgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBpbXByb3ZlbWVudCBzdWdnZXN0aW9ucy5cbiAgICovXG4gIGFzeW5jIGdldEltcHJvdmVtZW50U3VnZ2VzdGlvbnMoKTogUHJvbWlzZTxJbXByb3ZlbWVudFN1Z2dlc3Rpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEltcHJvdmVtZW50U3VnZ2VzdGlvbnMnLFxuICAgICAgJ2FsbF9pbXByb3ZlbWVudF9zdWdnZXN0aW9ucycsXG4gICAgICAnaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdG9wIGltcHJvdmVtZW50IHN1Z2dlc3Rpb25zLlxuICAgKiBAcGFyYW0gbGltaXRcbiAgICovXG4gIGFzeW5jIGdldFRvcEltcHJvdmVtZW50U3VnZ2VzdGlvbnMobGltaXQ6IG51bWJlcik6IFByb21pc2U8SW1wcm92ZW1lbnRTdWdnZXN0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRUb3BJbXByb3ZlbWVudFN1Z2dlc3Rpb25zJyxcbiAgICAgIGB0b3Bfc3VnZ2VzdGlvbnM6JHtsaW1pdH1gLFxuICAgICAgJ2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMpXG4gICAgICAgICAgLm9yZGVyQnkoXG4gICAgICAgICAgICBkZXNjKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zLnByaW9yaXR5KSxcbiAgICAgICAgICAgIGRlc2Moc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMuY3JlYXRlZEF0KVxuICAgICAgICAgIClcbiAgICAgICAgICAubGltaXQobGltaXQpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGltcHJvdmVtZW50IHN1Z2dlc3Rpb24uXG4gICAqIEBwYXJhbSBzdWdnZXN0aW9uXG4gICAqL1xuICBhc3luYyBjcmVhdGVJbXByb3ZlbWVudFN1Z2dlc3Rpb24oXG4gICAgc3VnZ2VzdGlvbjogSW5zZXJ0SW1wcm92ZW1lbnRTdWdnZXN0aW9uXG4gICk6IFByb21pc2U8SW1wcm92ZW1lbnRTdWdnZXN0aW9uPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeShcbiAgICAgICdjcmVhdGVJbXByb3ZlbWVudFN1Z2dlc3Rpb24nLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAuaW5zZXJ0KHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zKVxuICAgICAgICAgIC52YWx1ZXMoW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAuLi5zdWdnZXN0aW9uLFxuICAgICAgICAgICAgICBjYXRlZ29yeTogc3VnZ2VzdGlvbi5jYXRlZ29yeSBhc1xuICAgICAgICAgICAgICAgIHwgJ0NvZGUgUXVhbGl0eSdcbiAgICAgICAgICAgICAgICB8ICdTZWN1cml0eSdcbiAgICAgICAgICAgICAgICB8ICdUZXN0aW5nJ1xuICAgICAgICAgICAgICAgIHwgJ0RvY3VtZW50YXRpb24nXG4gICAgICAgICAgICAgICAgfCAnUGVyZm9ybWFuY2UnXG4gICAgICAgICAgICAgICAgfCAnQ29udGludW91cyBJbXByb3ZlbWVudCdcbiAgICAgICAgICAgICAgICB8ICdSZXBsaXQgQUkgQWdlbnQgTW9uaXRvcmluZydcbiAgICAgICAgICAgICAgICB8ICdSZXBsaXQgQXBwJyxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFycyBuZXcgc3VnZ2VzdGlvbnMuXG4gICAqL1xuICBhc3luYyBjbGVhck5ld1N1Z2dlc3Rpb25zKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NsZWFyTmV3U3VnZ2VzdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucylcbiAgICAgICAgLnNldCh7IHN0YXR1czogJ0Fja25vd2xlZGdlZCcgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zLnN0YXR1cywgJ05ldycpKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHN1Z2dlc3Rpb24gc3RhdHVzLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlU3VnZ2VzdGlvblN0YXR1cyhcbiAgICBpZDogc3RyaW5nLFxuICAgIHN0YXR1czogJ05ldycgfCAnQWNrbm93bGVkZ2VkJyB8ICdEb25lJ1xuICApOiBQcm9taXNlPEltcHJvdmVtZW50U3VnZ2VzdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZVN1Z2dlc3Rpb25TdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucylcbiAgICAgICAgLnNldCh7IHN0YXR1cyB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbXByb3ZlbWVudF9zdWdnZXN0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBGZWF0dXJlcyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGZlYXR1cmVzLlxuICAgKi9cbiAgYXN5bmMgZ2V0RmVhdHVyZXMoKTogUHJvbWlzZTxGZWF0dXJlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0RmVhdHVyZXMnLCAnYWxsX2ZlYXR1cmVzJywgJ2ZlYXR1cmVzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmZlYXR1cmVzKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBmZWF0dXJlcyBieSBzdGF0dXMuXG4gICAqIEBwYXJhbSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVzQnlTdGF0dXMoXG4gICAgc3RhdHVzOiAnY29tcGxldGVkJyB8ICdpbi1wcm9ncmVzcycgfCAncGxhbm5lZCcgfCAnY2FuY2VsbGVkJyB8ICdyZXF1ZXN0ZWQnXG4gICk6IFByb21pc2U8RmVhdHVyZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RmVhdHVyZXNCeVN0YXR1cycsXG4gICAgICBgZmVhdHVyZXNfc3RhdHVzOiR7c3RhdHVzfWAsXG4gICAgICAnZmVhdHVyZXMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlcy5zdGF0dXMsIHN0YXR1cyBhcyBhbnkpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBmZWF0dXJlcyBieSBjYXRlZ29yeS5cbiAgICogQHBhcmFtIGNhdGVnb3J5XG4gICAqL1xuICBhc3luYyBnZXRGZWF0dXJlc0J5Q2F0ZWdvcnkoY2F0ZWdvcnk6IHN0cmluZyk6IFByb21pc2U8RmVhdHVyZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RmVhdHVyZXNCeUNhdGVnb3J5JyxcbiAgICAgIGBmZWF0dXJlc19jYXRlZ29yeToke2NhdGVnb3J5fWAsXG4gICAgICAnZmVhdHVyZXMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlcy5jYXRlZ29yeSwgY2F0ZWdvcnkgYXMgYW55KSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgcHVibGljIHJvYWRtYXAgZmVhdHVyZXMuXG4gICAqL1xuICBhc3luYyBnZXRQdWJsaWNSb2FkbWFwRmVhdHVyZXMoKTogUHJvbWlzZTxGZWF0dXJlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRQdWJsaWNSb2FkbWFwRmVhdHVyZXMnLFxuICAgICAgJ3B1YmxpY19yb2FkbWFwX2ZlYXR1cmVzJyxcbiAgICAgICdmZWF0dXJlcycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5mZWF0dXJlcykud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVzLmlzUHVibGljUm9hZG1hcCwgdHJ1ZSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGZlYXR1cmUuXG4gICAqIEBwYXJhbSBmZWF0dXJlXG4gICAqL1xuICBhc3luYyBjcmVhdGVGZWF0dXJlKGZlYXR1cmU6IEluc2VydEZlYXR1cmUpOiBQcm9taXNlPEZlYXR1cmU+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVGZWF0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuZmVhdHVyZXMpLnZhbHVlcyhbZmVhdHVyZV0pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlcycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBmZWF0dXJlLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUZlYXR1cmUoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxJbnNlcnRGZWF0dXJlPik6IFByb21pc2U8RmVhdHVyZSB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUZlYXR1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZmVhdHVyZXMpXG4gICAgICAgIC5zZXQodXBkYXRlcyBhcyBhbnkpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZXMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlcycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBmZWF0dXJlLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUZlYXR1cmUoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZUZlYXR1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuZGVsZXRlKHNjaGVtYS5mZWF0dXJlcykud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVzLmlkLCBpZCkpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlcycpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vIEFjdGlvbmFibGUgSXRlbXMgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFjdGlvbmFibGUgaXRlbXMgYnkgZmVhdHVyZS5cbiAgICogQHBhcmFtIGZlYXR1cmVJZFxuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aW9uYWJsZUl0ZW1zQnlGZWF0dXJlKGZlYXR1cmVJZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25hYmxlSXRlbVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QWN0aW9uYWJsZUl0ZW1zQnlGZWF0dXJlJyxcbiAgICAgIGBhY3Rpb25hYmxlX2l0ZW1zOiR7ZmVhdHVyZUlkfWAsXG4gICAgICAnYWN0aW9uYWJsZV9pdGVtcycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMuZmVhdHVyZUlkLCBmZWF0dXJlSWQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhY3Rpb25hYmxlIGl0ZW0gYnkgSUQuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aW9uYWJsZUl0ZW0oaWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uYWJsZUl0ZW0gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRBY3Rpb25hYmxlSXRlbScsXG4gICAgICBgYWN0aW9uYWJsZV9pdGVtOiR7aWR9YCxcbiAgICAgICdhY3Rpb25hYmxlX2l0ZW1zJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zLmlkLCBpZCkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhY3Rpb25hYmxlIGl0ZW0uXG4gICAqIEBwYXJhbSBpdGVtXG4gICAqL1xuICBhc3luYyBjcmVhdGVBY3Rpb25hYmxlSXRlbShpdGVtOiBJbnNlcnRBY3Rpb25hYmxlSXRlbSk6IFByb21pc2U8QWN0aW9uYWJsZUl0ZW0+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVBY3Rpb25hYmxlSXRlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmFjdGlvbmFibGVJdGVtcykudmFsdWVzKFtpdGVtXSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2FjdGlvbmFibGVfaXRlbXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgbXVsdGlwbGUgYWN0aW9uYWJsZSBpdGVtcy5cbiAgICogQHBhcmFtIGl0ZW1zXG4gICAqL1xuICBhc3luYyBjcmVhdGVBY3Rpb25hYmxlSXRlbXMoaXRlbXM6IEluc2VydEFjdGlvbmFibGVJdGVtW10pOiBQcm9taXNlPEFjdGlvbmFibGVJdGVtW10+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVBY3Rpb25hYmxlSXRlbXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpLnZhbHVlcyhpdGVtcykucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2FjdGlvbmFibGVfaXRlbXMnKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYWN0aW9uYWJsZSBpdGVtLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUFjdGlvbmFibGVJdGVtKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxBY3Rpb25hYmxlSXRlbT5cbiAgKTogUHJvbWlzZTxBY3Rpb25hYmxlSXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUFjdGlvbmFibGVJdGVtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmFjdGlvbmFibGVJdGVtcylcbiAgICAgICAgLnNldCh1cGRhdGVzIGFzIGFueSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdhY3Rpb25hYmxlX2l0ZW1zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGFjdGlvbmFibGUgaXRlbS5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBkZWxldGVBY3Rpb25hYmxlSXRlbShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlQWN0aW9uYWJsZUl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuZGVsZXRlKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpLndoZXJlKGVxKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2FjdGlvbmFibGVfaXRlbXMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhY3Rpb25hYmxlIGl0ZW1zIGJ5IGZlYXR1cmUuXG4gICAqIEBwYXJhbSBmZWF0dXJlSWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUFjdGlvbmFibGVJdGVtc0J5RmVhdHVyZShmZWF0dXJlSWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoXG4gICAgICAnZGVsZXRlQWN0aW9uYWJsZUl0ZW1zQnlGZWF0dXJlJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGRiXG4gICAgICAgICAgLmRlbGV0ZShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zLmZlYXR1cmVJZCwgZmVhdHVyZUlkKSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICB9XG4gICAgKTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYWN0aW9uYWJsZV9pdGVtcycpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vIEludml0YXRpb24gb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBpbnZpdGF0aW9ucy5cbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25zKCk6IFByb21pc2U8SW52aXRhdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldEludml0YXRpb25zJywgJ2FsbF9pbnZpdGF0aW9ucycsICdpbnZpdGF0aW9ucycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbiBieSBJRC5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uKGlkOiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0SW52aXRhdGlvbicsIGBpbnZpdGF0aW9uOiR7aWR9YCwgJ2ludml0YXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9uIGJ5IHRva2VuLlxuICAgKiBAcGFyYW0gdG9rZW5cbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25CeVRva2VuKHRva2VuOiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbnZpdGF0aW9uQnlUb2tlbicsXG4gICAgICBgaW52aXRhdGlvbl90b2tlbjoke3Rva2VufWAsXG4gICAgICAnaW52aXRhdGlvbnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLnRva2VuLCB0b2tlbikpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9ucyBieSBlbWFpbC5cbiAgICogQHBhcmFtIGVtYWlsXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uc0J5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW52aXRhdGlvbnNCeUVtYWlsJyxcbiAgICAgIGBpbnZpdGF0aW9uc19lbWFpbDoke2VtYWlsfWAsXG4gICAgICAnaW52aXRhdGlvbnMnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5lbWFpbCwgZW1haWwpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9ucyBieSBpbnZpdGVyLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uc0J5SW52aXRlcih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW52aXRhdGlvbnNCeUludml0ZXInLFxuICAgICAgYGludml0YXRpb25zX2ludml0ZXI6JHt1c2VySWR9YCxcbiAgICAgICdpbnZpdGF0aW9ucycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmludml0ZWRCeVVzZXJJZCwgdXNlcklkKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbnMgYnkgc3RhdHVzLlxuICAgKiBAcGFyYW0gc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uc0J5U3RhdHVzKFxuICAgIHN0YXR1czogJ3BlbmRpbmcnIHwgJ2FjY2VwdGVkJyB8ICdleHBpcmVkJyB8ICdjYW5jZWxsZWQnXG4gICk6IFByb21pc2U8SW52aXRhdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW52aXRhdGlvbnNCeVN0YXR1cycsXG4gICAgICBgaW52aXRhdGlvbnNfc3RhdHVzOiR7c3RhdHVzfWAsXG4gICAgICAnaW52aXRhdGlvbnMnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsIHN0YXR1cykpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGludml0YXRpb24uXG4gICAqIEBwYXJhbSBpbnZpdGF0aW9uXG4gICAqL1xuICBhc3luYyBjcmVhdGVJbnZpdGF0aW9uKGludml0YXRpb246IEluc2VydEludml0YXRpb24pOiBQcm9taXNlPEludml0YXRpb24+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVJbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuaW52aXRhdGlvbnMpLnZhbHVlcyhbaW52aXRhdGlvbl0pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBpbnZpdGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUludml0YXRpb24oXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEludml0YXRpb24+XG4gICk6IFByb21pc2U8SW52aXRhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQodXBkYXRlcyBhcyBhbnkpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogQWNjZXB0cyBpbnZpdGF0aW9uLlxuICAgKiBAcGFyYW0gdG9rZW5cbiAgICogQHBhcmFtIHVzZXJEYXRhXG4gICAqIEBwYXJhbSB1c2VyRGF0YS5maXJzdE5hbWVcbiAgICogQHBhcmFtIGlwQWRkcmVzc1xuICAgKiBAcGFyYW0gdXNlckRhdGEubGFzdE5hbWVcbiAgICogQHBhcmFtIHVzZXJBZ2VudFxuICAgKiBAcGFyYW0gdXNlckRhdGEucGFzc3dvcmRcbiAgICovXG4gIGFzeW5jIGFjY2VwdEludml0YXRpb24oXG4gICAgdG9rZW46IHN0cmluZyxcbiAgICB1c2VyRGF0YTogeyBmaXJzdE5hbWU6IHN0cmluZzsgbGFzdE5hbWU6IHN0cmluZzsgcGFzc3dvcmQ6IHN0cmluZyB9LFxuICAgIGlwQWRkcmVzcz86IHN0cmluZyxcbiAgICB1c2VyQWdlbnQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTx7IHVzZXI6IFVzZXI7IGludml0YXRpb246IEludml0YXRpb24gfSB8IG51bGw+IHtcbiAgICByZXR1cm4gZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnYWNjZXB0SW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGludml0YXRpb24gPSBhd2FpdCB0aGlzLmdldEludml0YXRpb25CeVRva2VuKHRva2VuKTtcbiAgICAgIGlmICghaW52aXRhdGlvbiB8fCBpbnZpdGF0aW9uLnN0YXR1cyAhPT0gJ3BlbmRpbmcnKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICAvLyBDcmVhdGUgdXNlciB3aXRoIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuY3JlYXRlVXNlcih7XG4gICAgICAgIHVzZXJuYW1lOiBpbnZpdGF0aW9uLmVtYWlsLnNwbGl0KCdAJylbMF0sIC8vIFVzZSBlbWFpbCBwcmVmaXggYXMgdXNlcm5hbWVcbiAgICAgICAgZW1haWw6IGludml0YXRpb24uZW1haWwsXG4gICAgICAgIGZpcnN0TmFtZTogdXNlckRhdGEuZmlyc3ROYW1lLFxuICAgICAgICBsYXN0TmFtZTogdXNlckRhdGEubGFzdE5hbWUsXG4gICAgICAgIHBhc3N3b3JkOiB1c2VyRGF0YS5wYXNzd29yZCwgLy8gVGhpcyBzaG91bGQgYmUgaGFzaGVkXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLCAvLyBEZWZhdWx0IGxhbmd1YWdlXG4gICAgICAgIHJvbGU6IGludml0YXRpb24ucm9sZSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBVcGRhdGUgaW52aXRhdGlvblxuICAgICAgY29uc3QgdXBkYXRlZEludml0YXRpb24gPSBhd2FpdCB0aGlzLnVwZGF0ZUludml0YXRpb24oaW52aXRhdGlvbi5pZCwge1xuICAgICAgICBzdGF0dXM6ICdhY2NlcHRlZCcsXG4gICAgICAgIGFjY2VwdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHsgdXNlciwgaW52aXRhdGlvbjogdXBkYXRlZEludml0YXRpb24hIH07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ2FuY2VscyBpbnZpdGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIGNhbmNlbGxlZEJ5XG4gICAqL1xuICBhc3luYyBjYW5jZWxJbnZpdGF0aW9uKGlkOiBzdHJpbmcsIGNhbmNlbGxlZEJ5OiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjYW5jZWxJbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBzdGF0dXM6ICdjYW5jZWxsZWQnLFxuICAgICAgICAgIGNhbmNlbGxlZEJ5LFxuICAgICAgICAgIGNhbmNlbGxlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBpcmVzIG9sZCBpbnZpdGF0aW9ucy5cbiAgICovXG4gIGFzeW5jIGV4cGlyZUludml0YXRpb25zKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZXhwaXJlSW52aXRhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQoeyBzdGF0dXM6ICdleHBpcmVkJywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEuaW52aXRhdGlvbnMuc3RhdHVzLCAncGVuZGluZycpLFxuICAgICAgICAgICAgbHRlKHNjaGVtYS5pbnZpdGF0aW9ucy5leHBpcmVzQXQsIG5ldyBEYXRlKCkpXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGludml0YXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlSW52aXRhdGlvbihpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlSW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5kZWxldGUoc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gSW52aXRhdGlvbiBBdWRpdCBMb2cgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb24gYXVkaXQgbG9ncy5cbiAgICogQHBhcmFtIGludml0YXRpb25JZFxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbkF1ZGl0TG9ncyhpbnZpdGF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbkF1ZGl0TG9nW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbnZpdGF0aW9uQXVkaXRMb2dzJyxcbiAgICAgIGBpbnZpdGF0aW9uX2xvZ3M6JHtpbnZpdGF0aW9uSWR9YCxcbiAgICAgICdpbnZpdGF0aW9uX2xvZ3MnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbkF1ZGl0TG9nKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbkF1ZGl0TG9nLmludml0YXRpb25JZCwgaW52aXRhdGlvbklkKSlcbiAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5pbnZpdGF0aW9uQXVkaXRMb2cuY3JlYXRlZEF0KSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgaW52aXRhdGlvbiBhdWRpdCBsb2cuXG4gICAqIEBwYXJhbSBsb2dFbnRyeVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlSW52aXRhdGlvbkF1ZGl0TG9nKGxvZ0VudHJ5OiBJbnNlcnRJbnZpdGF0aW9uQXVkaXRMb2cpOiBQcm9taXNlPEludml0YXRpb25BdWRpdExvZz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUludml0YXRpb25BdWRpdExvZycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmludml0YXRpb25BdWRpdExvZykudmFsdWVzKGxvZ0VudHJ5KS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbl9sb2dzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIFBlcm1pc3Npb24gb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFBlcm1pc3Npb25zKCk6IFByb21pc2U8UGVybWlzc2lvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFBlcm1pc3Npb25zJywgJ3Blcm1pc3Npb25zOmFsbCcsICdwZXJtaXNzaW9ucycsICgpID0+XG4gICAgICBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnBlcm1pc3Npb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnBlcm1pc3Npb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnBlcm1pc3Npb25zLnJlc291cmNlVHlwZSwgc2NoZW1hLnBlcm1pc3Npb25zLmFjdGlvbilcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHJvbGUgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBnZXRSb2xlUGVybWlzc2lvbnMoKTogUHJvbWlzZTxSb2xlUGVybWlzc2lvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0Um9sZVBlcm1pc3Npb25zJyxcbiAgICAgICdyb2xlX3Blcm1pc3Npb25zOmFsbCcsXG4gICAgICAncm9sZV9wZXJtaXNzaW9ucycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5yb2xlUGVybWlzc2lvbnMpXG4gICAgICAgICAgLmlubmVySm9pbihcbiAgICAgICAgICAgIHNjaGVtYS5wZXJtaXNzaW9ucyxcbiAgICAgICAgICAgIGVxKHNjaGVtYS5yb2xlUGVybWlzc2lvbnMucGVybWlzc2lvbklkLCBzY2hlbWEucGVybWlzc2lvbnMuaWQpXG4gICAgICAgICAgKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEucGVybWlzc2lvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgIC5vcmRlckJ5KHNjaGVtYS5yb2xlUGVybWlzc2lvbnMucm9sZSwgc2NoZW1hLnBlcm1pc3Npb25zLnJlc291cmNlVHlwZSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHVzZXIgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBnZXRVc2VyUGVybWlzc2lvbnMoKTogUHJvbWlzZTxVc2VyUGVybWlzc2lvbltdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJQZXJtaXNzaW9ucylcbiAgICAgICAgLmlubmVySm9pbihcbiAgICAgICAgICBzY2hlbWEucGVybWlzc2lvbnMsXG4gICAgICAgICAgZXEoc2NoZW1hLnVzZXJQZXJtaXNzaW9ucy5wZXJtaXNzaW9uSWQsIHNjaGVtYS5wZXJtaXNzaW9ucy5pZClcbiAgICAgICAgKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnBlcm1pc3Npb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnVzZXJQZXJtaXNzaW9ucy51c2VySWQpO1xuXG4gICAgICByZXR1cm4gcmVzdWx0cyB8fCBbXTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIHBlcm1pc3Npb25zOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvLyBPbGQgYnVpbGRpbmcgZG9jdW1lbnQgbWV0aG9kcyByZW1vdmVkIC0gdXNpbmcgdW5pZmllZCBkb2N1bWVudHMgdGFibGVcblxuICAvLyBVbmlmaWVkIERvY3VtZW50IG9wZXJhdGlvbnNcbiAgYXN5bmMgZ2V0RG9jdW1lbnRzKGZpbHRlcnM/OiB7XG4gICAgYnVpbGRpbmdJZD86IHN0cmluZztcbiAgICByZXNpZGVuY2VJZD86IHN0cmluZztcbiAgICBkb2N1bWVudFR5cGU/OiBzdHJpbmc7XG4gICAgdXNlcklkPzogc3RyaW5nO1xuICAgIHVzZXJSb2xlPzogc3RyaW5nO1xuICB9KTogUHJvbWlzZTxEb2N1bWVudFtdPiB7XG4gICAgY29uc3Qgb3BlcmF0aW9uSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuICAgIFxuICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZ2V0RG9jdW1lbnRzX1NUQVJUJywge1xuICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICBmaWx0ZXJzOiBmaWx0ZXJzIHx8IHt9LFxuICAgICAgY2FjaGVLZXk6IGBkb2N1bWVudHM6JHtKU09OLnN0cmluZ2lmeShmaWx0ZXJzKX1gXG4gICAgfSwgJ0RFQlVHJyk7XG5cbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXREb2N1bWVudHMnLFxuICAgICAgYGRvY3VtZW50czoke0pTT04uc3RyaW5naWZ5KGZpbHRlcnMpfWAsXG4gICAgICAnZG9jdW1lbnRzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCdnZXREb2N1bWVudHNfUVVFUllfQlVJTEQnLCB7XG4gICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgZmlsdGVyczogZmlsdGVycyB8fCB7fVxuICAgICAgICB9LCAnREVCVUcnKTtcblxuICAgICAgICBsZXQgcXVlcnkgPSBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kb2N1bWVudHMpO1xuXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcbiAgICAgICAgaWYgKGZpbHRlcnM/LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmRvY3VtZW50cy5idWlsZGluZ0lkLCBmaWx0ZXJzLmJ1aWxkaW5nSWQpKTtcbiAgICAgICAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2dldERvY3VtZW50c19GSUxURVJfQlVJTERJTkcnLCB7XG4gICAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGZpbHRlcnMuYnVpbGRpbmdJZFxuICAgICAgICAgIH0sICdERUJVRycpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXJzPy5yZXNpZGVuY2VJZCkge1xuICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzY2hlbWEuZG9jdW1lbnRzLnJlc2lkZW5jZUlkLCBmaWx0ZXJzLnJlc2lkZW5jZUlkKSk7XG4gICAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCdnZXREb2N1bWVudHNfRklMVEVSX1JFU0lERU5DRScsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IGZpbHRlcnMucmVzaWRlbmNlSWRcbiAgICAgICAgICB9LCAnREVCVUcnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycz8uZG9jdW1lbnRUeXBlKSB7XG4gICAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS5kb2N1bWVudHMuZG9jdW1lbnRUeXBlLCBmaWx0ZXJzLmRvY3VtZW50VHlwZSkpO1xuICAgICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZ2V0RG9jdW1lbnRzX0ZJTFRFUl9UWVBFJywge1xuICAgICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgICBkb2N1bWVudFR5cGU6IGZpbHRlcnMuZG9jdW1lbnRUeXBlXG4gICAgICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuICAgICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZ2V0RG9jdW1lbnRzX0NPTkRJVElPTlNfQVBQTElFRCcsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgY29uZGl0aW9uQ291bnQ6IGNvbmRpdGlvbnMubGVuZ3RoXG4gICAgICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBkYlN0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5Lm9yZGVyQnkoZGVzYyhzY2hlbWEuZG9jdW1lbnRzLmNyZWF0ZWRBdCkpO1xuICAgICAgICBjb25zdCBkYlRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIGRiU3RhcnQ7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2dldERvY3VtZW50c19RVUVSWV9FWEVDVVRFRCcsIHtcbiAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICByZXN1bHRDb3VudDogcmVzdWx0Py5sZW5ndGggfHwgMCxcbiAgICAgICAgICBkYkV4ZWN1dGlvblRpbWU6IGAke2RiVGltZS50b0ZpeGVkKDIpfW1zYCxcbiAgICAgICAgICBmaWx0ZXJzOiBmaWx0ZXJzIHx8IHt9XG4gICAgICAgIH0sICdERUJVRycpO1xuXG4gICAgICAgIHJldHVybiByZXN1bHQgfHwgW107XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGdldERvY3VtZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldERvY3VtZW50JywgYGRvY3VtZW50OiR7aWR9YCwgJ2RvY3VtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRvY3VtZW50cy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlRG9jdW1lbnQoZG9jdW1lbnQ6IEluc2VydERvY3VtZW50KTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICAgIGNvbnN0IG9wZXJhdGlvbklkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICBcbiAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2NyZWF0ZURvY3VtZW50X1NUQVJUJywge1xuICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICBkb2N1bWVudERhdGE6IHtcbiAgICAgICAgbmFtZTogZG9jdW1lbnQubmFtZSxcbiAgICAgICAgZG9jdW1lbnRUeXBlOiBkb2N1bWVudC5kb2N1bWVudFR5cGUsXG4gICAgICAgIGJ1aWxkaW5nSWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgIHJlc2lkZW5jZUlkOiBkb2N1bWVudC5yZXNpZGVuY2VJZCxcbiAgICAgICAgdXBsb2FkZWRCeUlkOiBkb2N1bWVudC51cGxvYWRlZEJ5SWQsXG4gICAgICAgIGZpbGVQYXRoOiBkb2N1bWVudC5maWxlUGF0aCxcbiAgICAgICAgaXNWaXNpYmxlVG9UZW5hbnRzOiBkb2N1bWVudC5pc1Zpc2libGVUb1RlbmFudHNcbiAgICAgIH1cbiAgICB9LCAnSU5GTycpO1xuXG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZURvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGJTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLmRvY3VtZW50cykudmFsdWVzKGRvY3VtZW50KS5yZXR1cm5pbmcoKTtcbiAgICAgICAgY29uc3QgZGJUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBkYlN0YXJ0O1xuICAgICAgICBcbiAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCdjcmVhdGVEb2N1bWVudF9TVUNDRVNTJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIGRvY3VtZW50SWQ6IHJlc3VsdFswXT8uaWQsXG4gICAgICAgICAgZGJFeGVjdXRpb25UaW1lOiBgJHtkYlRpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgICAgaW5zZXJ0ZWREYXRhOiB7XG4gICAgICAgICAgICBuYW1lOiByZXN1bHRbMF0/Lm5hbWUsXG4gICAgICAgICAgICBkb2N1bWVudFR5cGU6IHJlc3VsdFswXT8uZG9jdW1lbnRUeXBlLFxuICAgICAgICAgICAgZmlsZVBhdGg6IHJlc3VsdFswXT8uZmlsZVBhdGhcbiAgICAgICAgICB9XG4gICAgICAgIH0sICdJTkZPJyk7XG5cbiAgICAgICAgLy8gQ2FjaGUgaW52YWxpZGF0aW9uIHdpdGggbG9nZ2luZ1xuICAgICAgICBpZiAoZG9jdW1lbnQuYnVpbGRpbmdJZCkge1xuICAgICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYCpidWlsZGluZ0lkKiR7ZG9jdW1lbnQuYnVpbGRpbmdJZH0qYCk7XG4gICAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCdjcmVhdGVEb2N1bWVudF9DQUNIRV9JTlZBTElEQVRFRCcsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgY2FjaGVQYXR0ZXJuOiBgKmJ1aWxkaW5nSWQqJHtkb2N1bWVudC5idWlsZGluZ0lkfSpgXG4gICAgICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRvY3VtZW50LnJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCBgKnJlc2lkZW5jZUlkKiR7ZG9jdW1lbnQucmVzaWRlbmNlSWR9KmApO1xuICAgICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignY3JlYXRlRG9jdW1lbnRfQ0FDSEVfSU5WQUxJREFURUQnLCB7XG4gICAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICAgIGNhY2hlUGF0dGVybjogYCpyZXNpZGVuY2VJZCoke2RvY3VtZW50LnJlc2lkZW5jZUlkfSpgXG4gICAgICAgICAgfSwgJ0RFQlVHJyk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2NyZWF0ZURvY3VtZW50X0VSUk9SJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxuICAgICAgICAgIGVycm9yQ29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgICBkb2N1bWVudERhdGE6IHtcbiAgICAgICAgICAgIG5hbWU6IGRvY3VtZW50Lm5hbWUsXG4gICAgICAgICAgICBkb2N1bWVudFR5cGU6IGRvY3VtZW50LmRvY3VtZW50VHlwZSxcbiAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IGRvY3VtZW50LmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICByZXNpZGVuY2VJZDogZG9jdW1lbnQucmVzaWRlbmNlSWRcbiAgICAgICAgICB9XG4gICAgICAgIH0sICdFUlJPUicpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZURvY3VtZW50KGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8RG9jdW1lbnQ+KTogUHJvbWlzZTxEb2N1bWVudCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IG9wZXJhdGlvbklkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcbiAgICBcbiAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ3VwZGF0ZURvY3VtZW50X1NUQVJUJywge1xuICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICBkb2N1bWVudElkOiBpZCxcbiAgICAgIHVwZGF0ZXM6IHtcbiAgICAgICAgZmllbGRzQmVpbmdVcGRhdGVkOiBPYmplY3Qua2V5cyh1cGRhdGVzKSxcbiAgICAgICAgaGFzRmlsZVBhdGhVcGRhdGU6ICEhdXBkYXRlcy5maWxlUGF0aCxcbiAgICAgICAgaGFzTmFtZVVwZGF0ZTogISF1cGRhdGVzLm5hbWUsXG4gICAgICAgIGhhc1Zpc2liaWxpdHlVcGRhdGU6ICEhdXBkYXRlcy5pc1Zpc2libGVUb1RlbmFudHNcbiAgICAgIH1cbiAgICB9LCAnSU5GTycpO1xuXG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZURvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZGJTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC51cGRhdGUoc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMuaWQsIGlkKSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICAgIGNvbnN0IGRiVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gZGJTdGFydDtcblxuICAgICAgICBpZiAocmVzdWx0WzBdKSB7XG4gICAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCd1cGRhdGVEb2N1bWVudF9TVUNDRVNTJywge1xuICAgICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgICBkb2N1bWVudElkOiBpZCxcbiAgICAgICAgICAgIGRiRXhlY3V0aW9uVGltZTogYCR7ZGJUaW1lLnRvRml4ZWQoMil9bXNgLFxuICAgICAgICAgICAgdXBkYXRlZEZpZWxkczogT2JqZWN0LmtleXModXBkYXRlcyksXG4gICAgICAgICAgICByZXN1bHREYXRhOiB7XG4gICAgICAgICAgICAgIG5hbWU6IHJlc3VsdFswXS5uYW1lLFxuICAgICAgICAgICAgICBkb2N1bWVudFR5cGU6IHJlc3VsdFswXS5kb2N1bWVudFR5cGUsXG4gICAgICAgICAgICAgIGZpbGVQYXRoOiByZXN1bHRbMF0uZmlsZVBhdGgsXG4gICAgICAgICAgICAgIHVwZGF0ZWRBdDogcmVzdWx0WzBdLnVwZGF0ZWRBdFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sICdJTkZPJyk7XG5cbiAgICAgICAgICAvLyBDYWNoZSBpbnZhbGlkYXRpb24gd2l0aCBsb2dnaW5nXG4gICAgICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCBgZG9jdW1lbnQ6JHtpZH1gKTtcbiAgICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsICcqJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCd1cGRhdGVEb2N1bWVudF9DQUNIRV9JTlZBTElEQVRFRCcsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgZG9jdW1lbnRJZDogaWQsXG4gICAgICAgICAgICBjYWNoZVBhdHRlcm5zOiBbYGRvY3VtZW50OiR7aWR9YCwgJyonXVxuICAgICAgICAgIH0sICdERUJVRycpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbigndXBkYXRlRG9jdW1lbnRfTk9UX0ZPVU5EJywge1xuICAgICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgICBkb2N1bWVudElkOiBpZCxcbiAgICAgICAgICAgIGRiRXhlY3V0aW9uVGltZTogYCR7ZGJUaW1lLnRvRml4ZWQoMil9bXNgXG4gICAgICAgICAgfSwgJ1dBUk4nKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbigndXBkYXRlRG9jdW1lbnRfRVJST1InLCB7XG4gICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgZG9jdW1lbnRJZDogaWQsXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZXJyb3JDb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICAgIHVwZGF0ZXM6IE9iamVjdC5rZXlzKHVwZGF0ZXMpXG4gICAgICAgIH0sICdFUlJPUicpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZURvY3VtZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBvcGVyYXRpb25JZCA9IGNyeXB0by5yYW5kb21VVUlEKCk7XG4gICAgXG4gICAgdGhpcy5sb2dTdG9yYWdlT3BlcmF0aW9uKCdkZWxldGVEb2N1bWVudF9TVEFSVCcsIHtcbiAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgZG9jdW1lbnRJZDogaWRcbiAgICB9LCAnSU5GTycpO1xuXG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZURvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gRmlyc3QgZ2V0IGRvY3VtZW50IGluZm8gZm9yIGxvZ2dpbmdcbiAgICAgICAgY29uc3QgZG9jdW1lbnRJbmZvID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIGlkOiBzY2hlbWEuZG9jdW1lbnRzLmlkLFxuICAgICAgICAgICAgbmFtZTogc2NoZW1hLmRvY3VtZW50cy5uYW1lLFxuICAgICAgICAgICAgZG9jdW1lbnRUeXBlOiBzY2hlbWEuZG9jdW1lbnRzLmRvY3VtZW50VHlwZSxcbiAgICAgICAgICAgIGZpbGVQYXRoOiBzY2hlbWEuZG9jdW1lbnRzLmZpbGVQYXRoLFxuICAgICAgICAgICAgYnVpbGRpbmdJZDogc2NoZW1hLmRvY3VtZW50cy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS5kb2N1bWVudHMucmVzaWRlbmNlSWRcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMuaWQsIGlkKSlcbiAgICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgICAgaWYgKGRvY3VtZW50SW5mby5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2RlbGV0ZURvY3VtZW50X05PVF9GT1VORCcsIHtcbiAgICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgICAgZG9jdW1lbnRJZDogaWRcbiAgICAgICAgICB9LCAnV0FSTicpO1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRiU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMuaWQsIGlkKSlcbiAgICAgICAgICAucmV0dXJuaW5nKHsgaWQ6IHNjaGVtYS5kb2N1bWVudHMuaWQgfSk7XG4gICAgICAgIGNvbnN0IGRiVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gZGJTdGFydDtcblxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICB0aGlzLmxvZ1N0b3JhZ2VPcGVyYXRpb24oJ2RlbGV0ZURvY3VtZW50X1NVQ0NFU1MnLCB7XG4gICAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICAgIGRvY3VtZW50SWQ6IGlkLFxuICAgICAgICAgICAgZGJFeGVjdXRpb25UaW1lOiBgJHtkYlRpbWUudG9GaXhlZCgyKX1tc2AsXG4gICAgICAgICAgICBkZWxldGVkRG9jdW1lbnQ6IHtcbiAgICAgICAgICAgICAgbmFtZTogZG9jdW1lbnRJbmZvWzBdLm5hbWUsXG4gICAgICAgICAgICAgIGRvY3VtZW50VHlwZTogZG9jdW1lbnRJbmZvWzBdLmRvY3VtZW50VHlwZSxcbiAgICAgICAgICAgICAgZmlsZVBhdGg6IGRvY3VtZW50SW5mb1swXS5maWxlUGF0aCxcbiAgICAgICAgICAgICAgYnVpbGRpbmdJZDogZG9jdW1lbnRJbmZvWzBdLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICAgIHJlc2lkZW5jZUlkOiBkb2N1bWVudEluZm9bMF0ucmVzaWRlbmNlSWRcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LCAnSU5GTycpO1xuXG4gICAgICAgICAgLy8gQ2FjaGUgaW52YWxpZGF0aW9uIHdpdGggbG9nZ2luZ1xuICAgICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYGRvY3VtZW50OiR7aWR9YCk7XG4gICAgICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCAnKicpO1xuICAgICAgICAgIFxuICAgICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZGVsZXRlRG9jdW1lbnRfQ0FDSEVfSU5WQUxJREFURUQnLCB7XG4gICAgICAgICAgICBvcGVyYXRpb25JZCxcbiAgICAgICAgICAgIGRvY3VtZW50SWQ6IGlkLFxuICAgICAgICAgICAgY2FjaGVQYXR0ZXJuczogW2Bkb2N1bWVudDoke2lkfWAsICcqJ11cbiAgICAgICAgICB9LCAnREVCVUcnKTtcbiAgICAgICAgICBcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZGVsZXRlRG9jdW1lbnRfRkFJTEVEJywge1xuICAgICAgICAgIG9wZXJhdGlvbklkLFxuICAgICAgICAgIGRvY3VtZW50SWQ6IGlkLFxuICAgICAgICAgIGRiRXhlY3V0aW9uVGltZTogYCR7ZGJUaW1lLnRvRml4ZWQoMil9bXNgXG4gICAgICAgIH0sICdXQVJOJyk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIHRoaXMubG9nU3RvcmFnZU9wZXJhdGlvbignZGVsZXRlRG9jdW1lbnRfRVJST1InLCB7XG4gICAgICAgICAgb3BlcmF0aW9uSWQsXG4gICAgICAgICAgZG9jdW1lbnRJZDogaWQsXG4gICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZXJyb3JDb2RlOiBlcnJvci5jb2RlXG4gICAgICAgIH0sICdFUlJPUicpO1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8vIE9sZCByZXNpZGVudCBkb2N1bWVudCBtZXRob2RzIHJlbW92ZWQgLSB1c2luZyB1bmlmaWVkIGRvY3VtZW50cyB0YWJsZVxuXG4gIC8vIExlZ2FjeSBEb2N1bWVudCBvcGVyYXRpb25zIChrZXB0IGZvciBtaWdyYXRpb24gcHVycG9zZXMpXG5cbiAgLyoqXG4gICAqIEdldHMgbGVnYWN5IGRvY3VtZW50cyBmb3IgdXNlci5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZHNcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50c0ZvclVzZXIoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZyxcbiAgICByZXNpZGVuY2VJZHM/OiBzdHJpbmdbXVxuICApOiBQcm9taXNlPERvY3VtZW50W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXREb2N1bWVudHNGb3JVc2VyJyxcbiAgICAgIGBsZWdhY3lfZG9jczoke3VzZXJJZH06JHt1c2VyUm9sZX1gLFxuICAgICAgJ2RvY3VtZW50cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kb2N1bWVudHMpLm9yZGVyQnkoZGVzYyhzY2hlbWEuZG9jdW1lbnRzLmNyZWF0ZWRBdCkpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvLyBQYXNzd29yZCByZXNldCBvcGVyYXRpb25zXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdG9rZW5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBhc3N3b3JkUmVzZXRUb2tlbih0b2tlbjogSW5zZXJ0UGFzc3dvcmRSZXNldFRva2VuKTogUHJvbWlzZTxQYXNzd29yZFJlc2V0VG9rZW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMpLnZhbHVlcyh0b2tlbikucmV0dXJuaW5nKCk7XG5cbiAgICAvLyBUb2tlbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseVxuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdG9rZW5WYWx1ZVxuICAgKi9cbiAgYXN5bmMgZ2V0UGFzc3dvcmRSZXNldFRva2VuKHRva2VuVmFsdWU6IHN0cmluZyk6IFByb21pc2U8UGFzc3dvcmRSZXNldFRva2VuIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0UGFzc3dvcmRSZXNldFRva2VuJyxcbiAgICAgIGB0b2tlbl8ke3Rva2VuVmFsdWV9YCxcbiAgICAgICdwYXNzd29yZF9yZXNldF90b2tlbnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEucGFzc3dvcmRSZXNldFRva2Vucy50b2tlbiwgdG9rZW5WYWx1ZSkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHRva2VuSWRcbiAgICovXG4gIGFzeW5jIG1hcmtQYXNzd29yZFJlc2V0VG9rZW5Bc1VzZWQodG9rZW5JZDogc3RyaW5nKTogUHJvbWlzZTxQYXNzd29yZFJlc2V0VG9rZW4gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLnVwZGF0ZShzY2hlbWEucGFzc3dvcmRSZXNldFRva2VucylcbiAgICAgIC5zZXQoe1xuICAgICAgICBpc1VzZWQ6IHRydWUsXG4gICAgICAgIHVzZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMuaWQsIHRva2VuSWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gVG9rZW4gbWFya2VkIGFzIHVzZWRcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGNsZWFudXBFeHBpcmVkUGFzc3dvcmRSZXNldFRva2VucygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuZGVsZXRlKHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zKVxuICAgICAgLndoZXJlKGx0ZShzY2hlbWEucGFzc3dvcmRSZXNldFRva2Vucy5leHBpcmVzQXQsIG5ldyBEYXRlKCkpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gRXhwaXJlZCB0b2tlbnMgY2xlYW5lZCB1cFxuXG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGg7XG4gIH1cblxuICAvLyBDb250YWN0IG9wZXJhdGlvbnNcbiAgLyoqXG4gICAqIEdldHMgYWxsIGNvbnRhY3RzLlxuICAgKi9cbiAgYXN5bmMgZ2V0Q29udGFjdHMoKTogUHJvbWlzZTxDb250YWN0W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0Q29udGFjdHMnLCAnYWxsX2NvbnRhY3RzJywgJ2NvbnRhY3RzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmNvbnRhY3RzKS53aGVyZShlcShzY2hlbWEuY29udGFjdHMuaXNBY3RpdmUsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBjb250YWN0cyBieSBlbnRpdHkuXG4gICAqIEBwYXJhbSBlbnRpdHlJZFxuICAgKiBAcGFyYW0gZW50aXR5XG4gICAqL1xuICBhc3luYyBnZXRDb250YWN0c0J5RW50aXR5KFxuICAgIGVudGl0eUlkOiBzdHJpbmcsXG4gICAgZW50aXR5OiAnb3JnYW5pemF0aW9uJyB8ICdidWlsZGluZycgfCAncmVzaWRlbmNlJ1xuICApOiBQcm9taXNlPENvbnRhY3RbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldENvbnRhY3RzQnlFbnRpdHknLFxuICAgICAgYGNvbnRhY3RzX2VudGl0eToke2VudGl0eX1fJHtlbnRpdHlJZH1gLFxuICAgICAgJ2NvbnRhY3RzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmNvbnRhY3RzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmNvbnRhY3RzLmVudGl0eUlkLCBlbnRpdHlJZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5lbnRpdHksIGVudGl0eSksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNvbnRhY3RzIGZvciByZXNpZGVuY2Ugd2l0aCB1c2VyIGRhdGEuXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZFxuICAgKi9cbiAgYXN5bmMgZ2V0Q29udGFjdHNGb3JSZXNpZGVuY2UocmVzaWRlbmNlSWQ6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8Q29udGFjdCAmIHsgdXNlcjogVXNlciB9Pj4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldENvbnRhY3RzRm9yUmVzaWRlbmNlJyxcbiAgICAgIGBjb250YWN0c19yZXNpZGVuY2U6JHtyZXNpZGVuY2VJZH1gLFxuICAgICAgJ2NvbnRhY3RzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmNvbnRhY3RzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnVzZXJzLCBlcShzY2hlbWEuY29udGFjdHMubmFtZSwgc2NoZW1hLnVzZXJzLmVtYWlsKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5lbnRpdHlJZCwgcmVzaWRlbmNlSWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuZW50aXR5LCAncmVzaWRlbmNlJyksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IGNvbnRhY3QuXG4gICAqIEBwYXJhbSBjb250YWN0XG4gICAqL1xuICBhc3luYyBjcmVhdGVDb250YWN0KGNvbnRhY3Q6IEluc2VydENvbnRhY3QpOiBQcm9taXNlPENvbnRhY3Q+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVDb250YWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuY29udGFjdHMpLnZhbHVlcyhjb250YWN0KS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnY29udGFjdHMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSBjb250YWN0LlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUNvbnRhY3QoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxDb250YWN0Pik6IFByb21pc2U8Q29udGFjdCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUNvbnRhY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuY29udGFjdHMpXG4gICAgICAgIC5zZXQodXBkYXRlcyBhcyBhbnkpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuY29udGFjdHMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdjb250YWN0cycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIGNvbnRhY3QuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQ29udGFjdChpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlQ29udGFjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5jb250YWN0cylcbiAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmNvbnRhY3RzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnY29udGFjdHMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBkZW1hbmRzIGZvciBhIHVzZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldERlbWFuZHNGb3JVc2VyKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXREZW1hbmRzRm9yVXNlcicsIGBkZW1hbmRzX3VzZXI6JHt1c2VySWR9YCwgJ2RlbWFuZHMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZGVtYW5kcykud2hlcmUoZXEoc2NoZW1hLmRlbWFuZHMudXNlcklkLCB1c2VySWQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhIHNwZWNpZmljIGRlbWFuZC5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXREZW1hbmQoaWQ6IHN0cmluZyk6IFByb21pc2U8YW55IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldERlbWFuZCcsIGBkZW1hbmQ6JHtpZH1gLCAnZGVtYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmRlbWFuZHMpLndoZXJlKGVxKHNjaGVtYS5kZW1hbmRzLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEJ1ZyBvcGVyYXRpb25zIGltcGxlbWVudGF0aW9uXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEJ1Z3NGb3JVc2VyKHVzZXJJZDogc3RyaW5nLCB1c2VyUm9sZTogc3RyaW5nLCBvcmdhbml6YXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8QnVnW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRCdWdzRm9yVXNlcicsXG4gICAgICBgYnVnczoke3VzZXJSb2xlfToke3VzZXJJZH1gLFxuICAgICAgJ2J1Z3MnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcmVzdWx0cztcbiAgICAgICAgXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAgIC8vIEFkbWluIGNhbiBzZWUgYWxsIGJ1Z3NcbiAgICAgICAgICByZXN1bHRzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJ1Z3MpXG4gICAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5idWdzLmNyZWF0ZWRBdCkpO1xuICAgICAgICB9IGVsc2UgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicgJiYgb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgICAvLyBGb3IgbWFuYWdlcnMsIHJldHVybiBhbGwgYnVncyBmb3Igbm93IChjYW4gYmUgcmVmaW5lZCBsYXRlcilcbiAgICAgICAgICByZXN1bHRzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJ1Z3MpXG4gICAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5idWdzLmNyZWF0ZWRBdCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZvciByZXNpZGVudHMgYW5kIHRlbmFudHMsIHJldHVybiBvbmx5IHRoZWlyIG93biBidWdzXG4gICAgICAgICAgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWdzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWdzLmNyZWF0ZWRCeSwgdXNlcklkKSlcbiAgICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLmJ1Z3MuY3JlYXRlZEF0KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgYXR0YWNobWVudCBjb3VudHMgYW5kIGRldGFpbHMgZm9yIGVhY2ggYnVnXG4gICAgICAgIGNvbnN0IGJ1Z3NXaXRoQXR0YWNobWVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICByZXN1bHRzLm1hcChhc3luYyAoYnVnKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdHRhY2htZW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEuZG9jdW1lbnRzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5kb2N1bWVudHMubmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2NoZW1hLmRvY3VtZW50cy5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogc2NoZW1hLmRvY3VtZW50cy5maWxlU2l6ZSxcbiAgICAgICAgICAgICAgICBmaWxlUGF0aDogc2NoZW1hLmRvY3VtZW50cy5maWxlUGF0aCxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb1R5cGUsICdidWcnKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb0lkLCBidWcuaWQpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5idWcsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRDb3VudDogYXR0YWNobWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgICBhdHRhY2htZW50czogYXR0YWNobWVudHMubWFwKGF0dCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBhdHQuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogYXR0LmZpbGVOYW1lIHx8IGF0dC5uYW1lLFxuICAgICAgICAgICAgICAgIHNpemU6IHBhcnNlSW50KGF0dC5maWxlU2l6ZSB8fCAnMCcpLFxuICAgICAgICAgICAgICAgIHVybDogYC9hcGkvZG9jdW1lbnRzLyR7YXR0LmlkfS9maWxlYCxcbiAgICAgICAgICAgICAgICB0eXBlOiBhdHQuZmlsZU5hbWUgPyBhdHQuZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKSB8fCAndW5rbm93bicgOiAndW5rbm93bidcbiAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIGJ1Z3NXaXRoQXR0YWNobWVudHM7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRCdWcoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nLFxuICAgIG9yZ2FuaXphdGlvbklkPzogc3RyaW5nXG4gICk6IFByb21pc2U8QnVnIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3Qga2V5ID0gYGJ1Zzoke2lkfTp1c2VyOiR7dXNlcklkfToke3VzZXJSb2xlfWA7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UjSBnZXRCdWcgY2FsbGVkIHdpdGgga2V5OiAke2tleX1gKTtcblxuICAgIHJldHVybiB3aXRoQ2FjaGUoJ2J1ZycsIGtleSwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogQ2FjaGUgbWlzcyBmb3IgJHtrZXl9LCBxdWVyeWluZyBkYXRhYmFzZS4uLmApO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICAgIGNvbnN0IGJ1ZyA9IHJlc3VsdFswXTtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OLIERhdGFiYXNlIHF1ZXJ5IHJlc3VsdDpgLCBidWcgPyB7IGlkOiBidWcuaWQsIHRpdGxlOiBidWcudGl0bGUsIGZpbGVQYXRoOiBidWcuZmlsZVBhdGgsIGZpbGVfcGF0aDogKGJ1ZyBhcyBhbnkpLmZpbGVfcGF0aCB9IDogJ3VuZGVmaW5lZCcpO1xuXG4gICAgICBpZiAoIWJ1Zykge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZztcbiAgICAgIH1cblxuICAgICAgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZzsgLy8gTWFuYWdlcnMgY2FuIHNlZSBhbGwgYnVncyBmb3Igbm93XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2lkZW50cyBhbmQgdGVuYW50cyBjYW4gb25seSBzZWUgdGhlaXIgb3duIGJ1Z3NcbiAgICAgIHJldHVybiBidWcuY3JlYXRlZEJ5ID09PSB1c2VySWQgPyBidWcgOiB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGJ1Z0RhdGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUJ1ZyhidWdEYXRhOiBJbnNlcnRCdWcpOiBQcm9taXNlPEJ1Zz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5idWdzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIC4uLmJ1Z0RhdGEsXG4gICAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICBzdGF0dXM6ICduZXcnLFxuICAgICAgICBhc3NpZ25lZFRvOiBudWxsLFxuICAgICAgICByZXNvbHZlZEF0OiBudWxsLFxuICAgICAgICByZXNvbHZlZEJ5OiBudWxsLFxuICAgICAgICBub3RlczogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBjYWNoZSBmb3IgdGhpcyB1c2VyIGFuZCBzcGVjaWZpYyBidWcgcXVlcmllcyAgXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWdzJyk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWcnLCBgYnVnOiR7cmVzdWx0WzBdLmlkfToqYCk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlQnVnKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxCdWc+LFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJSb2xlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxCdWcgfCB1bmRlZmluZWQ+IHtcbiAgICAvLyBGaXJzdCBjaGVjayBpZiB0aGUgYnVnIGV4aXN0cyBhbmQgZ2V0IGl0cyBjdXJyZW50IGRhdGFcbiAgICBjb25zdCBbZXhpc3RpbmdCdWddID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nQnVnKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIEFjY2VzcyBjb250cm9sOiB1c2VycyBjYW4gZWRpdCB0aGVpciBvd24gYnVncywgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gZWRpdCBhbnkgYnVnXG4gICAgY29uc3QgY2FuRWRpdCA9XG4gICAgICB1c2VyUm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyUm9sZSA9PT0gJ21hbmFnZXInIHx8IGV4aXN0aW5nQnVnLmNyZWF0ZWRCeSA9PT0gdXNlcklkO1xuXG4gICAgaWYgKCFjYW5FZGl0KSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHNjaGVtYS5idWdzKVxuICAgICAgLnNldCh7XG4gICAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIGlmIChyZXN1bHRbMF0pIHtcbiAgICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1Z3MnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQnVnKGlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCB1c2VyUm9sZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIGJ1ZyBleGlzdHMgYW5kIGdldCBpdHMgY3VycmVudCBkYXRhXG4gICAgY29uc3QgW2V4aXN0aW5nQnVnXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmJ1Z3MpLndoZXJlKGVxKHNjaGVtYS5idWdzLmlkLCBpZCkpO1xuXG4gICAgaWYgKCFleGlzdGluZ0J1Zykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFjY2VzcyBjb250cm9sOiB1c2VycyBjYW4gZGVsZXRlIHRoZWlyIG93biBidWdzLCBhZG1pbnMgY2FuIGRlbGV0ZSBhbnkgYnVnXG4gICAgY29uc3QgY2FuRGVsZXRlID0gdXNlclJvbGUgPT09ICdhZG1pbicgfHwgZXhpc3RpbmdCdWcuY3JlYXRlZEJ5ID09PSB1c2VySWQ7XG5cbiAgICBpZiAoIWNhbkRlbGV0ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG5cbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1Z3MnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIEZlYXR1cmUgUmVxdWVzdCBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBmZWF0dXJlIHJlcXVlc3RzIGZvciBhIHVzZXIgd2l0aCByb2xlLWJhc2VkIGFjY2VzcyBjb250cm9sLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVSZXF1ZXN0c0ZvclVzZXIoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZ1xuICApOiBQcm9taXNlPEZlYXR1cmVSZXF1ZXN0W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGZWF0dXJlUmVxdWVzdHNGb3JVc2VyJyxcbiAgICAgIGBmZWF0dXJlX3JlcXVlc3RzOiR7dXNlclJvbGV9OiR7dXNlcklkfWAsXG4gICAgICAnZmVhdHVyZV9yZXF1ZXN0cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAgIC8vIEdldCBhdHRhY2htZW50IGNvdW50cyBhbmQgZGV0YWlscyBmb3IgZWFjaCBmZWF0dXJlIHJlcXVlc3RcbiAgICAgICAgY29uc3QgcmVxdWVzdHNXaXRoQXR0YWNobWVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICByZXN1bHRzLm1hcChhc3luYyAocmVxdWVzdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLmRvY3VtZW50cy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEuZG9jdW1lbnRzLm5hbWUsXG4gICAgICAgICAgICAgICAgZmlsZVBhdGg6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVBhdGgsXG4gICAgICAgICAgICAgICAgZmlsZVNpemU6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVNpemUsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IHNjaGVtYS5kb2N1bWVudHMubWltZVR5cGUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9UeXBlLCAnZmVhdHVyZV9yZXF1ZXN0JyksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9JZCwgcmVxdWVzdC5pZClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnJlcXVlc3QsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRDb3VudDogYXR0YWNobWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgICBhdHRhY2htZW50czogYXR0YWNobWVudHMubWFwKGF0dCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBhdHQuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogYXR0Lm5hbWUsXG4gICAgICAgICAgICAgICAgdXJsOiBgL2FwaS9kb2N1bWVudHMvJHthdHQuaWR9L2ZpbGVgLFxuICAgICAgICAgICAgICAgIHNpemU6IGF0dC5maWxlU2l6ZSA/IHBhcnNlSW50KGF0dC5maWxlU2l6ZSkgOiAwLFxuICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBhdHQubWltZVR5cGUsXG4gICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBbGwgdXNlcnMgY2FuIHNlZSBhbGwgZmVhdHVyZSByZXF1ZXN0cywgYnV0IG5vbi1hZG1pbnMgZG9uJ3Qgc2VlIHdobyBzdWJtaXR0ZWRcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcXVlc3RzV2l0aEF0dGFjaG1lbnRzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9yIG5vbi1hZG1pbiB1c2VycywgaGlkZSB0aGUgY3JlYXRlZEJ5IGZpZWxkXG4gICAgICAgIHJldHVybiByZXF1ZXN0c1dpdGhBdHRhY2htZW50cy5tYXAoKHJlcXVlc3QpID0+ICh7XG4gICAgICAgICAgLi4ucmVxdWVzdCxcbiAgICAgICAgICBjcmVhdGVkQnk6IG51bGwgYXMgYW55LFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSBzcGVjaWZpYyBmZWF0dXJlIHJlcXVlc3QgYnkgSUQgd2l0aCByb2xlLWJhc2VkIGFjY2VzcyBjb250cm9sLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRGZWF0dXJlUmVxdWVzdChcbiAgICBpZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJSb2xlOiBzdHJpbmcsXG4gICAgb3JnYW5pemF0aW9uSWQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxGZWF0dXJlUmVxdWVzdCB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZlYXR1cmVSZXF1ZXN0JyxcbiAgICAgIGBmZWF0dXJlX3JlcXVlc3Q6JHtpZH06JHt1c2VyUm9sZX1gLFxuICAgICAgJ2ZlYXR1cmVfcmVxdWVzdHMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGlkKSk7XG5cbiAgICAgICAgY29uc3QgZmVhdHVyZVJlcXVlc3QgPSByZXN1bHRbMF07XG4gICAgICAgIGlmICghZmVhdHVyZVJlcXVlc3QpIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWxsIHVzZXJzIGNhbiBzZWUgYW55IGZlYXR1cmUgcmVxdWVzdFxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gZmVhdHVyZVJlcXVlc3Q7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3Igbm9uLWFkbWluIHVzZXJzLCBoaWRlIHRoZSBjcmVhdGVkQnkgZmllbGRcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5mZWF0dXJlUmVxdWVzdCxcbiAgICAgICAgICBjcmVhdGVkQnk6IG51bGwgYXMgYW55LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBmZWF0dXJlIHJlcXVlc3QuXG4gICAqIEBwYXJhbSBmZWF0dXJlUmVxdWVzdERhdGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUZlYXR1cmVSZXF1ZXN0KGZlYXR1cmVSZXF1ZXN0RGF0YTogSW5zZXJ0RmVhdHVyZVJlcXVlc3QpOiBQcm9taXNlPEZlYXR1cmVSZXF1ZXN0PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlRmVhdHVyZVJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICAuLi5mZWF0dXJlUmVxdWVzdERhdGEsXG4gICAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgICAgICB1cHZvdGVDb3VudDogMCxcbiAgICAgICAgICBhc3NpZ25lZFRvOiBudWxsLFxuICAgICAgICAgIHJldmlld2VkQnk6IG51bGwsXG4gICAgICAgICAgcmV2aWV3ZWRBdDogbnVsbCxcbiAgICAgICAgICBhZG1pbk5vdGVzOiBudWxsLFxuICAgICAgICAgIG1lcmdlZEludG9JZDogbnVsbCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSBmZWF0dXJlIHJlcXVlc3Qgd2l0aCByb2xlLWJhc2VkIHBlcm1pc3Npb25zLlxuICAgKiBVc2VycyBjYW4gZWRpdCB0aGVpciBvd24sIG1hbmFnZXJzIGNhbiBlZGl0IHdpdGhpbiBvcmcsIGFkbWlucyBjYW4gZWRpdCBhbGwuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlRmVhdHVyZVJlcXVlc3QoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEZlYXR1cmVSZXF1ZXN0PixcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nXG4gICk6IFByb21pc2U8RmVhdHVyZVJlcXVlc3QgfCB1bmRlZmluZWQ+IHtcbiAgICAvLyBHZXQgZXhpc3RpbmcgZmVhdHVyZSByZXF1ZXN0IHRvIGNoZWNrIHBlcm1pc3Npb25zXG4gICAgY29uc3QgZXhpc3RpbmdGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgaWYgKCFleGlzdGluZ0ZlYXR1cmVSZXF1ZXN0WzBdKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHBlcm1pc3Npb25zOiB1c2VycyBjYW4gZWRpdCB0aGVpciBvd24sIGFkbWlucyBjYW4gZWRpdCBhbGxcbiAgICBjb25zdCBjYW5FZGl0ID0gdXNlclJvbGUgPT09ICdhZG1pbicgfHwgZXhpc3RpbmdGZWF0dXJlUmVxdWVzdFswXS5jcmVhdGVkQnkgPT09IHVzZXJJZDtcblxuICAgIGlmICghY2FuRWRpdCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVGZWF0dXJlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBpZiAocmVzdWx0WzBdKSB7XG4gICAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGUgZW50cmllc1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgZmVhdHVyZSByZXF1ZXN0IChhZG1pbiBvbmx5KS5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqL1xuICBhc3luYyBkZWxldGVGZWF0dXJlUmVxdWVzdChpZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgdXNlclJvbGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgZmVhdHVyZSByZXF1ZXN0c1xuICAgIGlmICh1c2VyUm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEZpcnN0IGRlbGV0ZSBhbGwgdXB2b3RlcyBmb3IgdGhpcyBmZWF0dXJlIHJlcXVlc3RcbiAgICBhd2FpdCBkYlxuICAgICAgLmRlbGV0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzKVxuICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgaWQpKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuZGVsZXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGUgZW50cmllc1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdF91cHZvdGVzJyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogVXB2b3RlcyBhIGZlYXR1cmUgcmVxdWVzdC5cbiAgICogQHBhcmFtIHVwdm90ZURhdGFcbiAgICovXG4gIGFzeW5jIHVwdm90ZUZlYXR1cmVSZXF1ZXN0KFxuICAgIHVwdm90ZURhdGE6IEluc2VydEZlYXR1cmVSZXF1ZXN0VXB2b3RlXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IGRhdGE/OiBhbnkgfT4ge1xuICAgIGNvbnN0IHsgZmVhdHVyZVJlcXVlc3RJZCwgdXNlcklkIH0gPSB1cHZvdGVEYXRhO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIGZlYXR1cmUgcmVxdWVzdCBleGlzdHNcbiAgICAgIGNvbnN0IGZlYXR1cmVSZXF1ZXN0UmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmlkLCBmZWF0dXJlUmVxdWVzdElkKSk7XG5cbiAgICAgIGlmIChmZWF0dXJlUmVxdWVzdFJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnRmVhdHVyZSByZXF1ZXN0IG5vdCBmb3VuZCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGFscmVhZHkgdXB2b3RlZCB0aGlzIGZlYXR1cmUgcmVxdWVzdFxuICAgICAgY29uc3QgZXhpc3RpbmdVcHZvdGUgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgZmVhdHVyZVJlcXVlc3RJZCksXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgaWYgKGV4aXN0aW5nVXB2b3RlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGhhdmUgYWxyZWFkeSB1cHZvdGVkIHRoaXMgZmVhdHVyZSByZXF1ZXN0JyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHRoZSB1cHZvdGVcbiAgICAgIGNvbnN0IHVwdm90ZVJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgLi4udXB2b3RlRGF0YSxcbiAgICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSB1cHZvdGUgY291bnQgb24gdGhlIGZlYXR1cmUgcmVxdWVzdFxuICAgICAgY29uc3QgdXBkYXRlZEZlYXR1cmVSZXF1ZXN0ID0gYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICB1cHZvdGVDb3VudDogc3FsYCR7c2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy51cHZvdGVDb3VudH0gKyAxYCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmlkLCBmZWF0dXJlUmVxdWVzdElkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdHMnKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0X3Vwdm90ZXMnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZlYXR1cmUgcmVxdWVzdCB1cHZvdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1cHZvdGU6IHVwdm90ZVJlc3VsdFswXSxcbiAgICAgICAgICBmZWF0dXJlUmVxdWVzdDogdXBkYXRlZEZlYXR1cmVSZXF1ZXN0WzBdLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXB2b3RpbmcgZmVhdHVyZSByZXF1ZXN0OicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwdm90ZSBmZWF0dXJlIHJlcXVlc3QnLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbiB1cHZvdGUgZnJvbSBhIGZlYXR1cmUgcmVxdWVzdC5cbiAgICogQHBhcmFtIGZlYXR1cmVSZXF1ZXN0SWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlRmVhdHVyZVJlcXVlc3RVcHZvdGUoXG4gICAgZmVhdHVyZVJlcXVlc3RJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IGRhdGE/OiBhbnkgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBmZWF0dXJlIHJlcXVlc3QgZXhpc3RzXG4gICAgICBjb25zdCBmZWF0dXJlUmVxdWVzdFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RJZCkpO1xuXG4gICAgICBpZiAoZmVhdHVyZVJlcXVlc3RSZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZlYXR1cmUgcmVxdWVzdCBub3QgZm91bmQnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5kIGFuZCByZW1vdmUgdGhlIHVwdm90ZVxuICAgICAgY29uc3QgcmVtb3ZlZFVwdm90ZSA9IGF3YWl0IGRiXG4gICAgICAgIC5kZWxldGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgZmVhdHVyZVJlcXVlc3RJZCksXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmIChyZW1vdmVkVXB2b3RlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdZb3UgaGF2ZSBub3QgdXB2b3RlZCB0aGlzIGZlYXR1cmUgcmVxdWVzdCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgdXB2b3RlIGNvdW50IG9uIHRoZSBmZWF0dXJlIHJlcXVlc3RcbiAgICAgIGNvbnN0IHVwZGF0ZWRGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgdXB2b3RlQ291bnQ6IHNxbGBHUkVBVEVTVCgwLCAke3NjaGVtYS5mZWF0dXJlUmVxdWVzdHMudXB2b3RlQ291bnR9IC0gMSlgLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGZlYXR1cmVSZXF1ZXN0SWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIEludmFsaWRhdGUgY2FjaGVcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0cycpO1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RfdXB2b3RlcycpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnVXB2b3RlIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZlYXR1cmVSZXF1ZXN0OiB1cGRhdGVkRmVhdHVyZVJlcXVlc3RbMF0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciByZW1vdmluZyBmZWF0dXJlIHJlcXVlc3QgdXB2b3RlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlbW92ZSB1cHZvdGUnLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBJbnZvaWNlIG9wZXJhdGlvbnNcbiAgYXN5bmMgZ2V0SW52b2ljZXMoZmlsdGVycz86IHtcbiAgICBidWlsZGluZ0lkPzogc3RyaW5nO1xuICAgIHJlc2lkZW5jZUlkPzogc3RyaW5nO1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICB1c2VyUm9sZT86IHN0cmluZztcbiAgfSk6IFByb21pc2U8SW52b2ljZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBxdWVyeSA9IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludm9pY2VzKTtcbiAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcblxuICAgICAgaWYgKGZpbHRlcnMpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMuYnVpbGRpbmdJZCkge1xuICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzY2hlbWEuaW52b2ljZXMuYnVpbGRpbmdJZCwgZmlsdGVycy5idWlsZGluZ0lkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmludm9pY2VzLnJlc2lkZW5jZUlkLCBmaWx0ZXJzLnJlc2lkZW5jZUlkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMudXNlcklkICYmIGZpbHRlcnMudXNlclJvbGUpIHtcbiAgICAgICAgICAvLyBBcHBseSByb2xlLWJhc2VkIGZpbHRlcmluZ1xuICAgICAgICAgIGlmIChmaWx0ZXJzLnVzZXJSb2xlID09PSAndGVuYW50JyB8fCBmaWx0ZXJzLnVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmludm9pY2VzLmNyZWF0ZWRCeSwgZmlsdGVycy51c2VySWQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gQWRtaW4gYW5kIG1hbmFnZXIgY2FuIHNlZSBhbGwgaW52b2ljZXMgKGFscmVhZHkgZmlsdGVyZWQgYnkgYnVpbGRpbmcvcmVzaWRlbmNlIGFib3ZlKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5Lm9yZGVyQnkoZGVzYyhzY2hlbWEuaW52b2ljZXMuY3JlYXRlZEF0KSk7XG4gICAgICByZXR1cm4gaW52b2ljZXM7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGludm9pY2VzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRJbnZvaWNlKGlkOiBzdHJpbmcpOiBQcm9taXNlPEludm9pY2UgfCB1bmRlZmluZWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZvaWNlcy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGludm9pY2U6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGVJbnZvaWNlKGludm9pY2U6IEluc2VydEludm9pY2UpOiBQcm9taXNlPEludm9pY2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuaW52b2ljZXMpXG4gICAgICAgIC52YWx1ZXMoaW52b2ljZSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBpbnZvaWNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUludm9pY2UoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxJbnZvaWNlPik6IFByb21pc2U8SW52b2ljZSB8IHVuZGVmaW5lZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludm9pY2VzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgaW52b2ljZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUludm9pY2UoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZvaWNlcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgaW52b2ljZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gQWRtaW4tb25seSBtZXRob2QgdG8gY291bnQgb3JwaGFuIHVzZXJzXG4gIGFzeW5jIGNvdW50T3JwaGFuVXNlcnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBDT1VOVCBPUlBIQU4gVVNFUlMgU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBDT1VOVF0gVGltZXN0YW1wOicsIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBgXG4gICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyB0b3RhbCBcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvIFxuICAgICAgICAgICAgV0hFUkUgdW8udXNlcl9pZCA9IHUuaWQgQU5EIHVvLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApXG4gICAgICAgICAgQU5EIE5PVCBFWElTVFMgKFxuICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXIgXG4gICAgICAgICAgICBXSEVSRSB1ci51c2VyX2lkID0gdS5pZCBBTkQgdXIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClcbiAgICAgIGA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTVE9SQUdFIC0gQ09VTlRdIEV4ZWN1dGluZyBTUUwgcXVlcnk6JywgY291bnRRdWVyeS50cmltKCkpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UXSBTdGFydGluZyBkYXRhYmFzZSBleGVjdXRpb24uLi4nKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjb3VudFF1ZXJ5KSk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UXSBEYXRhYmFzZSBxdWVyeSBjb21wbGV0ZWQgaW46JywgKGVuZFRpbWUgLSBzdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OIIFtTVE9SQUdFIC0gQ09VTlRdIFJhdyBkYXRhYmFzZSByZXN1bHQ6JywgcmVzdWx0LnJvd3MpO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KHJlc3VsdC5yb3dzWzBdPy50b3RhbCB8fCAnMCcpO1xuICAgICAgY29uc29sZS5sb2coJ/CflKIgW1NUT1JBR0UgLSBDT1VOVF0gUGFyc2VkIG9ycGhhbiBjb3VudDonLCBjb3VudCk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBDT1VOVCBPUlBIQU4gVVNFUlMgQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBjb3VudDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlRdID09PT09IENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW1NUT1JBR0UgLSBDT1VOVF0gRXJyb3IgZGV0YWlsczonLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBFTkQgQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkbWluLW9ubHkgbWV0aG9kIHRvIGNvdW50IGFsbCB1c2VycyBleGNlcHQgc3BlY2lmaWVkIGFkbWluXG4gIGFzeW5jIGNvdW50QWxsVXNlcnNFeGNlcHQoZXhjbHVkZVVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UIEFMTF0gPT09PT0gQ09VTlQgQUxMIFVTRVJTIEVYQ0VQVCBBRE1JTiBTVEFSVEVEID09PT09Jyk7XG4gICAgY29uc29sZS5sb2coJ+KPsCBbU1RPUkFHRSAtIENPVU5UIEFMTF0gVGltZXN0YW1wOicsIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSk7XG4gICAgY29uc29sZS5sb2coJ/CflJIgW1NUT1JBR0UgLSBDT1VOVCBBTExdIEV4Y2x1ZGluZyBhZG1pbiB1c2VyIElEOicsIGV4Y2x1ZGVVc2VySWQpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb3VudFF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgQ09VTlQoKikgYXMgdG90YWwgXG4gICAgICAgIEZST00gdXNlcnMgdVxuICAgICAgICBXSEVSRSB1LmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgQU5EIHUuaWQgIT0gJyR7ZXhjbHVkZVVzZXJJZH0nXG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbU1RPUkFHRSAtIENPVU5UIEFMTF0gRXhlY3V0aW5nIFNRTCBxdWVyeTonLCBjb3VudFF1ZXJ5LnRyaW0oKSk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSBTdGFydGluZyBkYXRhYmFzZSBleGVjdXRpb24uLi4nKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjb3VudFF1ZXJ5KSk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UIEFMTF0gRGF0YWJhc2UgcXVlcnkgY29tcGxldGVkIGluOicsIChlbmRUaW1lIC0gc3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiCBbU1RPUkFHRSAtIENPVU5UIEFMTF0gUmF3IGRhdGFiYXNlIHJlc3VsdDonLCByZXN1bHQucm93cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvdW50ID0gcGFyc2VJbnQocmVzdWx0LnJvd3NbMF0/LnRvdGFsIHx8ICcwJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+UoiBbU1RPUkFHRSAtIENPVU5UIEFMTF0gUGFyc2VkIHVzZXIgY291bnQ6JywgY291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW1NUT1JBR0UgLSBDT1VOVCBBTExdID09PT09IENPVU5UIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBjb3VudDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSA9PT09PSBDUklUSUNBTCBFUlJPUiA9PT09PScpO1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSBFcnJvciBkZXRhaWxzOicsIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSA9PT09PSBFTkQgQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkbWluLW9ubHkgbWV0aG9kIHRvIGRlbGV0ZSBhbGwgdXNlcnMgZXhjZXB0IHNwZWNpZmllZCBhZG1pblxuICBhc3luYyBkZWxldGVBbGxVc2Vyc0V4Y2VwdChleGNsdWRlVXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5eR77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gREVMRVRFIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBUaW1lc3RhbXA6JywgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKTtcbiAgICBjb25zb2xlLmxvZygn8J+UkiBbU1RPUkFHRSAtIERFTEVURSBBTExdIEV4Y2x1ZGluZyBhZG1pbiB1c2VyIElEOicsIGV4Y2x1ZGVVc2VySWQpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCwgbGV0J3MgZ2V0IHRoZSBsaXN0IG9mIHVzZXJzIHRoYXQgd2lsbCBiZSBhZmZlY3RlZCBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zdCBwcmV2aWV3UXVlcnkgPSBzcWxgU0VMRUNUIHUuaWQsIHUuZW1haWwsIHUuZmlyc3RfbmFtZSwgdS5sYXN0X25hbWUsIHUucm9sZVxuICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgV0hFUkUgdS5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgQU5EIHUuaWQgIT0gJHtleGNsdWRlVXNlcklkfWA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gR2V0dGluZyBwcmV2aWV3IG9mIHVzZXJzIHRvIGJlIGRlbGV0ZWQuLi4nKTtcbiAgICAgIGNvbnN0IHByZXZpZXdSZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHByZXZpZXdRdWVyeSk7XG4gICAgICBjb25zb2xlLmxvZygn8J+RpSBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVzZXJzIHRvIGJlIGRlbGV0ZWQ6JywgcHJldmlld1Jlc3VsdC5yb3dzKTtcbiAgICAgIFxuICAgICAgLy8gTWFyayBhbGwgb3RoZXIgdXNlcnMgYXMgaW5hY3RpdmVcbiAgICAgIGNvbnN0IHVwZGF0ZVF1ZXJ5ID0gc3FsYFVQREFURSB1c2VycyBcbiAgICAgICAgU0VUIGlzX2FjdGl2ZSA9IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QXG4gICAgICAgIFdIRVJFIGlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICBBTkQgaWQgIT0gJHtleGNsdWRlVXNlcklkfWA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SnIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gRXhlY3V0aW5nIFVQREFURSBxdWVyeSB0byBtYXJrIHVzZXJzIGFzIGluYWN0aXZlLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gU3RhcnRpbmcgdXBkYXRlIG9wZXJhdGlvbi4uLicpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZSh1cGRhdGVRdWVyeSk7XG4gICAgICBjb25zdCB1cGRhdGVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVwZGF0ZSBvcGVyYXRpb24gY29tcGxldGVkIGluOicsICh1cGRhdGVUaW1lIC0gc3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVwZGF0ZSByZXN1bHQ6JywgcmVzdWx0KTtcbiAgICAgIFxuICAgICAgLy8gQ291bnQgdGhlIGFmZmVjdGVkIHJvd3NcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBzcWxgU0VMRUNUIENPVU5UKCopIGFzIGRlbGV0ZWRfY291bnRcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICBBTkQgdS5pZCAhPSAke2V4Y2x1ZGVVc2VySWR9XG4gICAgICAgICAgQU5EIHUudXBkYXRlZF9hdCA+PSBDVVJSRU5UX1RJTUVTVEFNUCAtIElOVEVSVkFMICcxIG1pbnV0ZSdgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbU1RPUkFHRSAtIERFTEVURSBBTExdIEV4ZWN1dGluZyBjb3VudCBxdWVyeSB0byB2ZXJpZnkgZGVsZXRpb24uLi4nKTtcbiAgICAgIGNvbnN0IGNvdW50U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShjb3VudFF1ZXJ5KTtcbiAgICAgIGNvbnN0IGNvdW50RW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfij7HvuI8gW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBDb3VudCBxdWVyeSBjb21wbGV0ZWQgaW46JywgKGNvdW50RW5kVGltZSAtIGNvdW50U3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiCBbU1RPUkFHRSAtIERFTEVURSBBTExdIFJhdyBjb3VudCByZXN1bHQ6JywgY291bnRSZXN1bHQucm93cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRlbGV0ZWRDb3VudCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0/LmRlbGV0ZWRfY291bnQgfHwgJzAnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SiIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gRmluYWwgZGVsZXRlZCBjb3VudDonLCBkZWxldGVkQ291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURSBBTExdIFRvdGFsIG9wZXJhdGlvbiB0aW1lOicsIChjb3VudEVuZFRpbWUgLSBzdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5eR77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gREVMRVRFIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURSBBTExdID09PT09IENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBFcnJvciBkZXRhaWxzOicsIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICBleGNsdWRlVXNlcklkOiBleGNsdWRlVXNlcklkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gRU5EIENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBBZG1pbi1vbmx5IG1ldGhvZCB0byBkZWxldGUgb3JwaGFuIHVzZXJzIChleGNsdWRpbmcgc3BlY2lmaWVkIGFkbWluIHVzZXIpXG4gIGFzeW5jIGRlbGV0ZU9ycGhhblVzZXJzKGV4Y2x1ZGVVc2VySWQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc29sZS5sb2coJ/Cfl5HvuI8gW1NUT1JBR0UgLSBERUxFVEVdID09PT09IERFTEVURSBPUlBIQU4gVVNFUlMgU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBERUxFVEVdIFRpbWVzdGFtcDonLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpO1xuICAgIGNvbnNvbGUubG9nKCfwn5SSIFtTVE9SQUdFIC0gREVMRVRFXSBFeGNsdWRpbmcgYWRtaW4gdXNlciBJRDonLCBleGNsdWRlVXNlcklkKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QsIGxldCdzIGdldCB0aGUgbGlzdCBvZiB1c2VycyB0aGF0IHdpbGwgYmUgYWZmZWN0ZWQgZm9yIGRlYnVnZ2luZ1xuICAgICAgY29uc3QgcHJldmlld1F1ZXJ5ID0gc3FsYFNFTEVDVCB1LmlkLCB1LmVtYWlsLCB1LmZpcnN0X25hbWUsIHUubGFzdF9uYW1lLCB1LnJvbGVcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIEFORCB1LmlkICE9ICR7ZXhjbHVkZVVzZXJJZH1cbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSB1LmlkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgKVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyIFxuICAgICAgICAgICAgV0hFUkUgdXIudXNlcl9pZCA9IHUuaWQgQU5EIHVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApYDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NUT1JBR0UgLSBERUxFVEVdIEdldHRpbmcgcHJldmlldyBvZiB1c2VycyB0byBiZSBkZWxldGVkLi4uJyk7XG4gICAgICBjb25zdCBwcmV2aWV3UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShwcmV2aWV3UXVlcnkpO1xuICAgICAgY29uc29sZS5sb2coJ/CfkaUgW1NUT1JBR0UgLSBERUxFVEVdIFVzZXJzIHRvIGJlIGRlbGV0ZWQ6JywgcHJldmlld1Jlc3VsdC5yb3dzKTtcbiAgICAgIFxuICAgICAgLy8gTWFyayBvcnBoYW4gdXNlcnMgYXMgaW5hY3RpdmUgdG8gYXZvaWQgZm9yZWlnbiBrZXkgaXNzdWVzXG4gICAgICBjb25zdCB1cGRhdGVRdWVyeSA9IHNxbGBVUERBVEUgdXNlcnMgXG4gICAgICAgIFNFVCBpc19hY3RpdmUgPSBmYWxzZSxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgICBXSEVSRSBpc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgQU5EIGlkICE9ICR7ZXhjbHVkZVVzZXJJZH1cbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSBpZCBBTkQgdW8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClcbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1ciBcbiAgICAgICAgICAgIFdIRVJFIHVyLnVzZXJfaWQgPSBpZCBBTkQgdXIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBbU1RPUkFHRSAtIERFTEVURV0gRXhlY3V0aW5nIFVQREFURSBxdWVyeSB0byBtYXJrIHVzZXJzIGFzIGluYWN0aXZlLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFXSBTdGFydGluZyB1cGRhdGUgb3BlcmF0aW9uLi4uJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHVwZGF0ZVF1ZXJ5KTtcbiAgICAgIGNvbnN0IHVwZGF0ZVRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFXSBVcGRhdGUgb3BlcmF0aW9uIGNvbXBsZXRlZCBpbjonLCAodXBkYXRlVGltZSAtIHN0YXJ0VGltZSksICdtcycpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW1NUT1JBR0UgLSBERUxFVEVdIFVwZGF0ZSByZXN1bHQ6JywgcmVzdWx0KTtcbiAgICAgIFxuICAgICAgLy8gQ291bnQgdGhlIGFmZmVjdGVkIHJvd3NcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBzcWxgU0VMRUNUIENPVU5UKCopIGFzIGRlbGV0ZWRfY291bnRcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICBBTkQgdS5pZCAhPSAke2V4Y2x1ZGVVc2VySWR9XG4gICAgICAgICAgQU5EIHUudXBkYXRlZF9hdCA+PSBDVVJSRU5UX1RJTUVTVEFNUCAtIElOVEVSVkFMICcxIG1pbnV0ZSdcbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSB1LmlkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgKVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyIFxuICAgICAgICAgICAgV0hFUkUgdXIudXNlcl9pZCA9IHUuaWQgQU5EIHVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApYDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NUT1JBR0UgLSBERUxFVEVdIEV4ZWN1dGluZyBjb3VudCBxdWVyeSB0byB2ZXJpZnkgZGVsZXRpb24uLi4nKTtcbiAgICAgIGNvbnN0IGNvdW50U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShjb3VudFF1ZXJ5KTtcbiAgICAgIGNvbnN0IGNvdW50RW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfij7HvuI8gW1NUT1JBR0UgLSBERUxFVEVdIENvdW50IHF1ZXJ5IGNvbXBsZXRlZCBpbjonLCAoY291bnRFbmRUaW1lIC0gY291bnRTdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OIIFtTVE9SQUdFIC0gREVMRVRFXSBSYXcgY291bnQgcmVzdWx0OicsIGNvdW50UmVzdWx0LnJvd3MpO1xuICAgICAgXG4gICAgICBjb25zdCBkZWxldGVkQ291bnQgPSBwYXJzZUludChjb3VudFJlc3VsdC5yb3dzWzBdPy5kZWxldGVkX2NvdW50IHx8ICcwJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+UoiBbU1RPUkFHRSAtIERFTEVURV0gRmluYWwgZGVsZXRlZCBjb3VudDonLCBkZWxldGVkQ291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURV0gVG90YWwgb3BlcmF0aW9uIHRpbWU6JywgKGNvdW50RW5kVGltZSAtIHN0YXJ0VGltZSksICdtcycpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfl5HvuI8gW1NUT1JBR0UgLSBERUxFVEVdID09PT09IERFTEVURSBPUlBIQU4gVVNFUlMgQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURV0gPT09PT0gQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbU1RPUkFHRSAtIERFTEVURV0gRXJyb3IgZGV0YWlsczonLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgZXhjbHVkZVVzZXJJZDogZXhjbHVkZVVzZXJJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURV0gPT09PT0gRU5EIENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==