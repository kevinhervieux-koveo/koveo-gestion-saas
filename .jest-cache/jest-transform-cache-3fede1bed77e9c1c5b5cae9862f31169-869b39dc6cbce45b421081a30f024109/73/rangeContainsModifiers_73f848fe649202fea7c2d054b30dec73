2fd58c3e603aa5829ed68324c11b7fc8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.rangeContainsModifiers = rangeContainsModifiers;
const DateLib_js_1 = require("../classes/DateLib.js");
const dateMatchModifiers_js_1 = require("./dateMatchModifiers.js");
const rangeContainsDayOfWeek_js_1 = require("./rangeContainsDayOfWeek.js");
const rangeIncludesDate_js_1 = require("./rangeIncludesDate.js");
const rangeOverlaps_js_1 = require("./rangeOverlaps.js");
const typeguards_js_1 = require("./typeguards.js");
/**
 * Checks if a date range contains dates that match the given modifiers.
 *
 * @since 9.2.2
 * @param range - The date range to check.
 * @param modifiers - The modifiers to match against.
 * @param dateLib - The date utility library instance.
 * @returns `true` if the range contains matching dates, otherwise `false`.
 * @group Utilities
 */
function rangeContainsModifiers(range, modifiers, dateLib = DateLib_js_1.defaultDateLib) {
    const matchers = Array.isArray(modifiers) ? modifiers : [modifiers];
    // Defer function matchers evaluation as they are the least performant.
    const nonFunctionMatchers = matchers.filter((matcher) => typeof matcher !== "function");
    const nonFunctionMatchersResult = nonFunctionMatchers.some((matcher) => {
        if (typeof matcher === "boolean")
            return matcher;
        if (dateLib.isDate(matcher)) {
            return (0, rangeIncludesDate_js_1.rangeIncludesDate)(range, matcher, false, dateLib);
        }
        if ((0, typeguards_js_1.isDatesArray)(matcher, dateLib)) {
            return matcher.some((date) => (0, rangeIncludesDate_js_1.rangeIncludesDate)(range, date, false, dateLib));
        }
        if ((0, typeguards_js_1.isDateRange)(matcher)) {
            if (matcher.from && matcher.to) {
                return (0, rangeOverlaps_js_1.rangeOverlaps)(range, { from: matcher.from, to: matcher.to }, dateLib);
            }
            return false;
        }
        if ((0, typeguards_js_1.isDayOfWeekType)(matcher)) {
            return (0, rangeContainsDayOfWeek_js_1.rangeContainsDayOfWeek)(range, matcher.dayOfWeek, dateLib);
        }
        if ((0, typeguards_js_1.isDateInterval)(matcher)) {
            const isClosedInterval = dateLib.isAfter(matcher.before, matcher.after);
            if (isClosedInterval) {
                return (0, rangeOverlaps_js_1.rangeOverlaps)(range, {
                    from: dateLib.addDays(matcher.after, 1),
                    to: dateLib.addDays(matcher.before, -1),
                }, dateLib);
            }
            return ((0, dateMatchModifiers_js_1.dateMatchModifiers)(range.from, matcher, dateLib) ||
                (0, dateMatchModifiers_js_1.dateMatchModifiers)(range.to, matcher, dateLib));
        }
        if ((0, typeguards_js_1.isDateAfterType)(matcher) || (0, typeguards_js_1.isDateBeforeType)(matcher)) {
            return ((0, dateMatchModifiers_js_1.dateMatchModifiers)(range.from, matcher, dateLib) ||
                (0, dateMatchModifiers_js_1.dateMatchModifiers)(range.to, matcher, dateLib));
        }
        return false;
    });
    if (nonFunctionMatchersResult) {
        return true;
    }
    const functionMatchers = matchers.filter((matcher) => typeof matcher === "function");
    if (functionMatchers.length) {
        let date = range.from;
        const totalDays = dateLib.differenceInCalendarDays(range.to, range.from);
        for (let i = 0; i <= totalDays; i++) {
            if (functionMatchers.some((matcher) => matcher(date))) {
                return true;
            }
            date = dateLib.addDays(date, 1);
        }
    }
    return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvcmVhY3QtZGF5LXBpY2tlci9kaXN0L2Nqcy91dGlscy9yYW5nZUNvbnRhaW5zTW9kaWZpZXJzLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUNiLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO0FBQzlELE9BQU8sQ0FBQyxzQkFBc0IsR0FBRyxzQkFBc0IsQ0FBQztBQUN4RCxNQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUN0RCxNQUFNLHVCQUF1QixHQUFHLE9BQU8sQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQ25FLE1BQU0sMkJBQTJCLEdBQUcsT0FBTyxDQUFDLDZCQUE2QixDQUFDLENBQUM7QUFDM0UsTUFBTSxzQkFBc0IsR0FBRyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNqRSxNQUFNLGtCQUFrQixHQUFHLE9BQU8sQ0FBQyxvQkFBb0IsQ0FBQyxDQUFDO0FBQ3pELE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQ25EOzs7Ozs7Ozs7R0FTRztBQUNILFNBQVMsc0JBQXNCLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxPQUFPLEdBQUcsWUFBWSxDQUFDLGNBQWM7SUFDbkYsTUFBTSxRQUFRLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQ3BFLHVFQUF1RTtJQUN2RSxNQUFNLG1CQUFtQixHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sT0FBTyxLQUFLLFVBQVUsQ0FBQyxDQUFDO0lBQ3hGLE1BQU0seUJBQXlCLEdBQUcsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7UUFDbkUsSUFBSSxPQUFPLE9BQU8sS0FBSyxTQUFTO1lBQzVCLE9BQU8sT0FBTyxDQUFDO1FBQ25CLElBQUksT0FBTyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQzFCLE9BQU8sQ0FBQyxDQUFDLEVBQUUsc0JBQXNCLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQztRQUN6RixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUMsRUFBRSxlQUFlLENBQUMsWUFBWSxDQUFDLENBQUMsT0FBTyxFQUFFLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDdEQsT0FBTyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxzQkFBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDOUcsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDNUMsSUFBSSxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDN0IsT0FBTyxDQUFDLENBQUMsRUFBRSxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxDQUFDLElBQUksRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLEVBQUUsRUFBRSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ3pHLENBQUM7WUFDRCxPQUFPLEtBQUssQ0FBQztRQUNqQixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUMsRUFBRSxlQUFlLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNoRCxPQUFPLENBQUMsQ0FBQyxFQUFFLDJCQUEyQixDQUFDLHNCQUFzQixDQUFDLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDdEcsQ0FBQztRQUNELElBQUksQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDL0MsTUFBTSxnQkFBZ0IsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ3hFLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDbkIsT0FBTyxDQUFDLENBQUMsRUFBRSxrQkFBa0IsQ0FBQyxhQUFhLENBQUMsQ0FBQyxLQUFLLEVBQUU7b0JBQ2hELElBQUksRUFBRSxPQUFPLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsQ0FBQyxDQUFDO29CQUN2QyxFQUFFLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxDQUFDO2lCQUMxQyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQ2hCLENBQUM7WUFDRCxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUM7Z0JBQ2pGLENBQUMsQ0FBQyxFQUFFLHVCQUF1QixDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBQ0QsSUFBSSxDQUFDLENBQUMsRUFBRSxlQUFlLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsZUFBZSxDQUFDLGdCQUFnQixDQUFDLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQztZQUNsRyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsdUJBQXVCLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLENBQUM7Z0JBQ2pGLENBQUMsQ0FBQyxFQUFFLHVCQUF1QixDQUFDLGtCQUFrQixDQUFDLENBQUMsS0FBSyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDO1FBQ0QsT0FBTyxLQUFLLENBQUM7SUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDSCxJQUFJLHlCQUF5QixFQUFFLENBQUM7UUFDNUIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUNELE1BQU0sZ0JBQWdCLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxPQUFPLEtBQUssVUFBVSxDQUFDLENBQUM7SUFDckYsSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUMxQixJQUFJLElBQUksR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDO1FBQ3RCLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN6RSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDbEMsSUFBSSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQyxPQUFPLEVBQUUsRUFBRSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUM7Z0JBQ3BELE9BQU8sSUFBSSxDQUFDO1lBQ2hCLENBQUM7WUFDRCxJQUFJLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQztJQUNMLENBQUM7SUFDRCxPQUFPLEtBQUssQ0FBQztBQUNqQixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvbm9kZV9tb2R1bGVzL3JlYWN0LWRheS1waWNrZXIvZGlzdC9janMvdXRpbHMvcmFuZ2VDb250YWluc01vZGlmaWVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmV4cG9ydHMucmFuZ2VDb250YWluc01vZGlmaWVycyA9IHJhbmdlQ29udGFpbnNNb2RpZmllcnM7XG5jb25zdCBEYXRlTGliX2pzXzEgPSByZXF1aXJlKFwiLi4vY2xhc3Nlcy9EYXRlTGliLmpzXCIpO1xuY29uc3QgZGF0ZU1hdGNoTW9kaWZpZXJzX2pzXzEgPSByZXF1aXJlKFwiLi9kYXRlTWF0Y2hNb2RpZmllcnMuanNcIik7XG5jb25zdCByYW5nZUNvbnRhaW5zRGF5T2ZXZWVrX2pzXzEgPSByZXF1aXJlKFwiLi9yYW5nZUNvbnRhaW5zRGF5T2ZXZWVrLmpzXCIpO1xuY29uc3QgcmFuZ2VJbmNsdWRlc0RhdGVfanNfMSA9IHJlcXVpcmUoXCIuL3JhbmdlSW5jbHVkZXNEYXRlLmpzXCIpO1xuY29uc3QgcmFuZ2VPdmVybGFwc19qc18xID0gcmVxdWlyZShcIi4vcmFuZ2VPdmVybGFwcy5qc1wiKTtcbmNvbnN0IHR5cGVndWFyZHNfanNfMSA9IHJlcXVpcmUoXCIuL3R5cGVndWFyZHMuanNcIik7XG4vKipcbiAqIENoZWNrcyBpZiBhIGRhdGUgcmFuZ2UgY29udGFpbnMgZGF0ZXMgdGhhdCBtYXRjaCB0aGUgZ2l2ZW4gbW9kaWZpZXJzLlxuICpcbiAqIEBzaW5jZSA5LjIuMlxuICogQHBhcmFtIHJhbmdlIC0gVGhlIGRhdGUgcmFuZ2UgdG8gY2hlY2suXG4gKiBAcGFyYW0gbW9kaWZpZXJzIC0gVGhlIG1vZGlmaWVycyB0byBtYXRjaCBhZ2FpbnN0LlxuICogQHBhcmFtIGRhdGVMaWIgLSBUaGUgZGF0ZSB1dGlsaXR5IGxpYnJhcnkgaW5zdGFuY2UuXG4gKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHJhbmdlIGNvbnRhaW5zIG1hdGNoaW5nIGRhdGVzLCBvdGhlcndpc2UgYGZhbHNlYC5cbiAqIEBncm91cCBVdGlsaXRpZXNcbiAqL1xuZnVuY3Rpb24gcmFuZ2VDb250YWluc01vZGlmaWVycyhyYW5nZSwgbW9kaWZpZXJzLCBkYXRlTGliID0gRGF0ZUxpYl9qc18xLmRlZmF1bHREYXRlTGliKSB7XG4gICAgY29uc3QgbWF0Y2hlcnMgPSBBcnJheS5pc0FycmF5KG1vZGlmaWVycykgPyBtb2RpZmllcnMgOiBbbW9kaWZpZXJzXTtcbiAgICAvLyBEZWZlciBmdW5jdGlvbiBtYXRjaGVycyBldmFsdWF0aW9uIGFzIHRoZXkgYXJlIHRoZSBsZWFzdCBwZXJmb3JtYW50LlxuICAgIGNvbnN0IG5vbkZ1bmN0aW9uTWF0Y2hlcnMgPSBtYXRjaGVycy5maWx0ZXIoKG1hdGNoZXIpID0+IHR5cGVvZiBtYXRjaGVyICE9PSBcImZ1bmN0aW9uXCIpO1xuICAgIGNvbnN0IG5vbkZ1bmN0aW9uTWF0Y2hlcnNSZXN1bHQgPSBub25GdW5jdGlvbk1hdGNoZXJzLnNvbWUoKG1hdGNoZXIpID0+IHtcbiAgICAgICAgaWYgKHR5cGVvZiBtYXRjaGVyID09PSBcImJvb2xlYW5cIilcbiAgICAgICAgICAgIHJldHVybiBtYXRjaGVyO1xuICAgICAgICBpZiAoZGF0ZUxpYi5pc0RhdGUobWF0Y2hlcikpIHtcbiAgICAgICAgICAgIHJldHVybiAoMCwgcmFuZ2VJbmNsdWRlc0RhdGVfanNfMS5yYW5nZUluY2x1ZGVzRGF0ZSkocmFuZ2UsIG1hdGNoZXIsIGZhbHNlLCBkYXRlTGliKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDAsIHR5cGVndWFyZHNfanNfMS5pc0RhdGVzQXJyYXkpKG1hdGNoZXIsIGRhdGVMaWIpKSB7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlci5zb21lKChkYXRlKSA9PiAoMCwgcmFuZ2VJbmNsdWRlc0RhdGVfanNfMS5yYW5nZUluY2x1ZGVzRGF0ZSkocmFuZ2UsIGRhdGUsIGZhbHNlLCBkYXRlTGliKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgwLCB0eXBlZ3VhcmRzX2pzXzEuaXNEYXRlUmFuZ2UpKG1hdGNoZXIpKSB7XG4gICAgICAgICAgICBpZiAobWF0Y2hlci5mcm9tICYmIG1hdGNoZXIudG8pIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gKDAsIHJhbmdlT3ZlcmxhcHNfanNfMS5yYW5nZU92ZXJsYXBzKShyYW5nZSwgeyBmcm9tOiBtYXRjaGVyLmZyb20sIHRvOiBtYXRjaGVyLnRvIH0sIGRhdGVMaWIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICgoMCwgdHlwZWd1YXJkc19qc18xLmlzRGF5T2ZXZWVrVHlwZSkobWF0Y2hlcikpIHtcbiAgICAgICAgICAgIHJldHVybiAoMCwgcmFuZ2VDb250YWluc0RheU9mV2Vla19qc18xLnJhbmdlQ29udGFpbnNEYXlPZldlZWspKHJhbmdlLCBtYXRjaGVyLmRheU9mV2VlaywgZGF0ZUxpYik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgwLCB0eXBlZ3VhcmRzX2pzXzEuaXNEYXRlSW50ZXJ2YWwpKG1hdGNoZXIpKSB7XG4gICAgICAgICAgICBjb25zdCBpc0Nsb3NlZEludGVydmFsID0gZGF0ZUxpYi5pc0FmdGVyKG1hdGNoZXIuYmVmb3JlLCBtYXRjaGVyLmFmdGVyKTtcbiAgICAgICAgICAgIGlmIChpc0Nsb3NlZEludGVydmFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICgwLCByYW5nZU92ZXJsYXBzX2pzXzEucmFuZ2VPdmVybGFwcykocmFuZ2UsIHtcbiAgICAgICAgICAgICAgICAgICAgZnJvbTogZGF0ZUxpYi5hZGREYXlzKG1hdGNoZXIuYWZ0ZXIsIDEpLFxuICAgICAgICAgICAgICAgICAgICB0bzogZGF0ZUxpYi5hZGREYXlzKG1hdGNoZXIuYmVmb3JlLCAtMSksXG4gICAgICAgICAgICAgICAgfSwgZGF0ZUxpYik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gKCgwLCBkYXRlTWF0Y2hNb2RpZmllcnNfanNfMS5kYXRlTWF0Y2hNb2RpZmllcnMpKHJhbmdlLmZyb20sIG1hdGNoZXIsIGRhdGVMaWIpIHx8XG4gICAgICAgICAgICAgICAgKDAsIGRhdGVNYXRjaE1vZGlmaWVyc19qc18xLmRhdGVNYXRjaE1vZGlmaWVycykocmFuZ2UudG8sIG1hdGNoZXIsIGRhdGVMaWIpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKDAsIHR5cGVndWFyZHNfanNfMS5pc0RhdGVBZnRlclR5cGUpKG1hdGNoZXIpIHx8ICgwLCB0eXBlZ3VhcmRzX2pzXzEuaXNEYXRlQmVmb3JlVHlwZSkobWF0Y2hlcikpIHtcbiAgICAgICAgICAgIHJldHVybiAoKDAsIGRhdGVNYXRjaE1vZGlmaWVyc19qc18xLmRhdGVNYXRjaE1vZGlmaWVycykocmFuZ2UuZnJvbSwgbWF0Y2hlciwgZGF0ZUxpYikgfHxcbiAgICAgICAgICAgICAgICAoMCwgZGF0ZU1hdGNoTW9kaWZpZXJzX2pzXzEuZGF0ZU1hdGNoTW9kaWZpZXJzKShyYW5nZS50bywgbWF0Y2hlciwgZGF0ZUxpYikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgICBpZiAobm9uRnVuY3Rpb25NYXRjaGVyc1Jlc3VsdCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgY29uc3QgZnVuY3Rpb25NYXRjaGVycyA9IG1hdGNoZXJzLmZpbHRlcigobWF0Y2hlcikgPT4gdHlwZW9mIG1hdGNoZXIgPT09IFwiZnVuY3Rpb25cIik7XG4gICAgaWYgKGZ1bmN0aW9uTWF0Y2hlcnMubGVuZ3RoKSB7XG4gICAgICAgIGxldCBkYXRlID0gcmFuZ2UuZnJvbTtcbiAgICAgICAgY29uc3QgdG90YWxEYXlzID0gZGF0ZUxpYi5kaWZmZXJlbmNlSW5DYWxlbmRhckRheXMocmFuZ2UudG8sIHJhbmdlLmZyb20pO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0b3RhbERheXM7IGkrKykge1xuICAgICAgICAgICAgaWYgKGZ1bmN0aW9uTWF0Y2hlcnMuc29tZSgobWF0Y2hlcikgPT4gbWF0Y2hlcihkYXRlKSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRhdGUgPSBkYXRlTGliLmFkZERheXMoZGF0ZSwgMSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuIl0sInZlcnNpb24iOjN9