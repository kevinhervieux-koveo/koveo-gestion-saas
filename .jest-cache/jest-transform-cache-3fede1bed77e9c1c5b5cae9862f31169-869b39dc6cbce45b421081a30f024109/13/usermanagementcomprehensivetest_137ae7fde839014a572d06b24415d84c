d938debe6b2dfae8de068bbaec338d5a
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const supertest_1 = __importDefault(require("supertest"));
const express_1 = __importDefault(require("express"));
const routes_1 = require("../../server/routes");
const db_1 = require("../../server/db");
const schema = __importStar(require("../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
// Test utilities
const createTestApp = () => {
    const app = (0, express_1.default)();
    app.use(express_1.default.json());
    app.use(express_1.default.urlencoded({ extended: true }));
    // Test authentication middleware
    app.use(async (req, res, next) => {
        const testUserId = req.headers['x-test-user-id'];
        if (testUserId) {
            const [user] = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, testUserId)).limit(1);
            if (user) {
                req.session = {
                    userId: testUserId,
                    isAuthenticated: true,
                    role: user.role
                };
                req.user = user;
            }
        }
        next();
    });
    (0, routes_1.registerRoutes)(app);
    return app;
};
(0, globals_1.describe)('User Management Comprehensive Tests', () => {
    let app;
    let adminUser;
    let regularManager;
    let demoManager;
    let testOrganization;
    let demoOrganization;
    let testBuilding;
    let testResidence1;
    let testResidence2;
    (0, globals_1.beforeEach)(async () => {
        app = createTestApp();
        // Clean test data
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.invitations);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.organizations);
        // Create test organizations
        const [org1] = await db_1.db
            .insert(schema.organizations)
            .values({
            name: 'Regular Test Organization',
            type: 'Standard',
            address: '123 Test St',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H1H 1H1',
            phone: '514-555-0123',
            email: 'test@org.com',
        })
            .returning();
        testOrganization = org1;
        const [org2] = await db_1.db
            .insert(schema.organizations)
            .values({
            name: 'Demo Test Organization',
            type: 'demo',
            address: '456 Demo St',
            city: 'Demo City',
            province: 'QC',
            postalCode: 'H2H 2H2',
            phone: '514-555-0456',
            email: 'demo@org.com',
        })
            .returning();
        demoOrganization = org2;
        // Create test building
        const [building] = await db_1.db
            .insert(schema.buildings)
            .values({
            organizationId: testOrganization.id,
            name: 'Test Building',
            address: '123 Test St',
            city: 'Test City',
            province: 'QC',
            postalCode: 'H1H 1H1',
            totalUnits: 10,
            buildingType: 'apartment',
        })
            .returning();
        testBuilding = building;
        // Create test residences
        const [residence1] = await db_1.db
            .insert(schema.residences)
            .values({
            buildingId: testBuilding.id,
            unitNumber: '101',
            squareFootage: 1000,
            bedrooms: 2,
            bathrooms: 1,
        })
            .returning();
        testResidence1 = residence1;
        const [residence2] = await db_1.db
            .insert(schema.residences)
            .values({
            buildingId: testBuilding.id,
            unitNumber: '102',
            squareFootage: 1200,
            bedrooms: 3,
            bathrooms: 2,
        })
            .returning();
        testResidence2 = residence2;
        // Create admin user
        const [admin] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'admin@test.com',
            username: 'admin',
            password: 'hashedpassword123',
            firstName: 'Admin',
            lastName: 'User',
            role: 'admin',
            isActive: true,
            phone: '514-555-0001',
        })
            .returning();
        adminUser = admin;
        // Create regular manager
        const [manager] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'manager@test.com',
            username: 'manager',
            password: 'hashedpassword123',
            firstName: 'Regular',
            lastName: 'Manager',
            role: 'manager',
            isActive: true,
            phone: '514-555-0002',
        })
            .returning();
        regularManager = manager;
        // Assign regular manager to organization
        await db_1.db
            .insert(schema.userOrganizations)
            .values({
            userId: regularManager.id,
            organizationId: testOrganization.id,
            organizationRole: 'manager',
            isActive: true,
        });
        // Create demo manager
        const [demoMgr] = await db_1.db
            .insert(schema.users)
            .values({
            email: 'demo.manager@test.com',
            username: 'demo_manager',
            password: 'hashedpassword123',
            firstName: 'Demo',
            lastName: 'Manager',
            role: 'demo_manager',
            isActive: true,
            phone: '514-555-0003',
        })
            .returning();
        demoManager = demoMgr;
        // Create demo users for visibility testing
        await db_1.db
            .insert(schema.users)
            .values([
            {
                email: 'demo.tenant@test.com',
                username: 'demo_tenant',
                password: 'hashedpassword123',
                firstName: 'Demo',
                lastName: 'Tenant',
                role: 'demo_tenant',
                isActive: true,
                phone: '514-555-0004',
            },
            {
                email: 'demo.resident@test.com',
                username: 'demo_resident',
                password: 'hashedpassword123',
                firstName: 'Demo',
                lastName: 'Resident',
                role: 'demo_resident',
                isActive: true,
                phone: '514-555-0005',
            },
            {
                email: 'regular.tenant@test.com',
                username: 'regular_tenant',
                password: 'hashedpassword123',
                firstName: 'Regular',
                lastName: 'Tenant',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0006',
            }
        ]);
    });
    (0, globals_1.afterEach)(async () => {
        await db_1.db.delete(schema.userResidences);
        await db_1.db.delete(schema.userOrganizations);
        await db_1.db.delete(schema.invitations);
        await db_1.db.delete(schema.users);
        await db_1.db.delete(schema.residences);
        await db_1.db.delete(schema.buildings);
        await db_1.db.delete(schema.organizations);
    });
    (0, globals_1.describe)('Invitation Organization/Building/Residence Assignment', () => {
        (0, globals_1.it)('should assign correct organization and residence when user accepts invitation', async () => {
            // Create invitation with organization and residence
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const invitationData = {
                email: 'newuser@test.com',
                role: 'tenant',
                organizationId: testOrganization.id,
                residenceId: testResidence1.id,
                expiresAt: expiresAt.toISOString(),
                personalMessage: 'Welcome!',
            };
            // Create invitation
            const inviteResponse = await (0, supertest_1.default)(app)
                .post('/api/invitations')
                .set('x-test-user-id', adminUser.id)
                .send(invitationData)
                .expect(201);
            // Get the invitation token
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.email, 'newuser@test.com'));
            // Accept invitation
            const acceptData = {
                firstName: 'New',
                lastName: 'User',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData)
                .expect(201);
            // Verify user was created
            const [newUser] = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'newuser@test.com'));
            (0, globals_1.expect)(newUser).toBeDefined();
            (0, globals_1.expect)(newUser.role).toBe('tenant');
            // Verify organization assignment
            const orgAssignment = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, testOrganization.id)));
            (0, globals_1.expect)(orgAssignment).toHaveLength(1);
            (0, globals_1.expect)(orgAssignment[0].organizationRole).toBe('tenant');
            (0, globals_1.expect)(orgAssignment[0].isActive).toBe(true);
            // Verify residence assignment
            const residenceAssignment = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id), (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, testResidence1.id)));
            (0, globals_1.expect)(residenceAssignment).toHaveLength(1);
            (0, globals_1.expect)(residenceAssignment[0].relationshipType).toBe('tenant');
            (0, globals_1.expect)(residenceAssignment[0].isActive).toBe(true);
        });
        (0, globals_1.it)('should handle invitation with only organization (no residence)', async () => {
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const invitationData = {
                email: 'manager@test.com',
                role: 'manager',
                organizationId: testOrganization.id,
                expiresAt: expiresAt.toISOString(),
            };
            // Create invitation
            await (0, supertest_1.default)(app)
                .post('/api/invitations')
                .set('x-test-user-id', adminUser.id)
                .send(invitationData)
                .expect(201);
            const [invitation] = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.email, 'manager@test.com'));
            // Accept invitation
            const acceptData = {
                firstName: 'New',
                lastName: 'Manager',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData)
                .expect(201);
            const [newUser] = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.email, 'manager@test.com'));
            // Should have organization assignment
            const orgAssignment = await db_1.db
                .select()
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id));
            (0, globals_1.expect)(orgAssignment).toHaveLength(1);
            // Should NOT have residence assignment
            const residenceAssignment = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id));
            (0, globals_1.expect)(residenceAssignment).toHaveLength(0);
        });
    });
    (0, globals_1.describe)('Multiple Building/Residence Assignment', () => {
        (0, globals_1.it)('should allow admin to assign multiple residences to a user', async () => {
            // Create a test user first
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'multiuser@test.com',
                username: 'multiuser',
                password: 'hashedpassword123',
                firstName: 'Multi',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0007',
            })
                .returning();
            // Assign multiple residences
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
                {
                    residenceId: testResidence2.id,
                    relationshipType: 'occupant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Verify multiple assignments
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
            (0, globals_1.expect)(assignments).toHaveLength(2);
            (0, globals_1.expect)(assignments.some(a => a.residenceId === testResidence1.id)).toBe(true);
            (0, globals_1.expect)(assignments.some(a => a.residenceId === testResidence2.id)).toBe(true);
        });
        (0, globals_1.it)('should allow manager to assign residences only within their organization', async () => {
            // Create a test user
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'limiteduser@test.com',
                username: 'limiteduser',
                password: 'hashedpassword123',
                firstName: 'Limited',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0008',
            })
                .returning();
            // Manager tries to assign residence in their organization (should work)
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', regularManager.id)
                .send({ residenceAssignments })
                .expect(200);
            // Verify assignment was created
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
            (0, globals_1.expect)(assignments).toHaveLength(1);
            (0, globals_1.expect)(assignments[0].residenceId).toBe(testResidence1.id);
        });
    });
    (0, globals_1.describe)('Manager Permission Restrictions', () => {
        (0, globals_1.it)('should prevent regular manager from assigning organizations to users', async () => {
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'restricteduser@test.com',
                username: 'restricteduser',
                password: 'hashedpassword123',
                firstName: 'Restricted',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0009',
            })
                .returning();
            // Manager tries to assign organization (should fail)
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/organizations`)
                .set('x-test-user-id', regularManager.id)
                .send({ organizationIds: [testOrganization.id] })
                .expect(403);
            (0, globals_1.expect)(response.body.message).toContain('Only administrators can modify organization assignments');
        });
        (0, globals_1.it)('should prevent regular manager from creating users with organization assignments', async () => {
            // This would be tested if there's a user creation endpoint that accepts organizationIds
            // For now, we test that managers can't directly assign organizations
            const userData = {
                email: 'newmanaged@test.com',
                firstName: 'New',
                lastName: 'Managed',
                role: 'tenant',
                password: 'password123',
                organizationIds: [testOrganization.id], // Manager shouldn't be able to set this
            };
            // This test assumes there's validation in the user creation endpoint
            // The actual implementation might handle this differently
        });
        (0, globals_1.it)('should only allow manager to assign residences within their organization', async () => {
            // Create another organization and building
            const [otherOrg] = await db_1.db
                .insert(schema.organizations)
                .values({
                name: 'Other Organization',
                type: 'Standard',
                address: '789 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H3H 3H3',
                phone: '514-555-0789',
                email: 'other@org.com',
            })
                .returning();
            const [otherBuilding] = await db_1.db
                .insert(schema.buildings)
                .values({
                organizationId: otherOrg.id,
                name: 'Other Building',
                address: '789 Other St',
                city: 'Other City',
                province: 'QC',
                postalCode: 'H3H 3H3',
                totalUnits: 5,
                buildingType: 'apartment',
            })
                .returning();
            const [otherResidence] = await db_1.db
                .insert(schema.residences)
                .values({
                buildingId: otherBuilding.id,
                unitNumber: '301',
                squareFootage: 800,
                bedrooms: 1,
                bathrooms: 1,
            })
                .returning();
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'crossorguser@test.com',
                username: 'crossorguser',
                password: 'hashedpassword123',
                firstName: 'Cross',
                lastName: 'Org',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0010',
            })
                .returning();
            // Manager tries to assign residence from different organization (should fail or be filtered)
            const residenceAssignments = [
                {
                    residenceId: otherResidence.id, // This is from a different organization
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            // This should either fail with 403 or silently ignore the invalid assignment
            // depending on implementation
            const response = await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', regularManager.id)
                .send({ residenceAssignments });
            // The exact response depends on implementation, but the assignment shouldn't succeed
            if (response.status === 200) {
                // If it returns 200, verify no assignment was actually created
                const assignments = await db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id));
                (0, globals_1.expect)(assignments).toHaveLength(0);
            }
            else {
                // Should return an error status
                (0, globals_1.expect)(response.status).toBeGreaterThanOrEqual(400);
            }
        });
    });
    (0, globals_1.describe)('Demo Manager User Visibility', () => {
        (0, globals_1.it)('should show only demo users to demo manager in user management', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', demoManager.id)
                .expect(200);
            const users = response.body;
            // Demo manager should only see demo users (demo_manager, demo_tenant, demo_resident)
            const visibleRoles = users.map((user) => user.role);
            (0, globals_1.expect)(visibleRoles).toContain('demo_manager');
            (0, globals_1.expect)(visibleRoles).toContain('demo_tenant');
            (0, globals_1.expect)(visibleRoles).toContain('demo_resident');
            // Should NOT see regular roles
            (0, globals_1.expect)(visibleRoles).not.toContain('admin');
            (0, globals_1.expect)(visibleRoles).not.toContain('manager');
            (0, globals_1.expect)(visibleRoles).not.toContain('tenant');
            (0, globals_1.expect)(visibleRoles).not.toContain('resident');
        });
        (0, globals_1.it)('should allow regular manager to see non-demo users in their organization', async () => {
            // Assign the regular tenant to the same organization as the manager
            await db_1.db
                .insert(schema.userOrganizations)
                .values({
                userId: (await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, 'regular.tenant@test.com')))[0].id,
                organizationId: testOrganization.id,
                organizationRole: 'tenant',
                isActive: true,
            });
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', regularManager.id)
                .expect(200);
            const users = response.body;
            const visibleEmails = users.map((user) => user.email);
            // Should see users in their organization
            (0, globals_1.expect)(visibleEmails).toContain('regular.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('manager@test.com'); // themselves
            // Should NOT see demo users
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.resident@test.com');
            (0, globals_1.expect)(visibleEmails).not.toContain('demo.manager@test.com');
        });
        (0, globals_1.it)('should allow admin to see all users regardless of type', async () => {
            const response = await (0, supertest_1.default)(app)
                .get('/api/users')
                .set('x-test-user-id', adminUser.id)
                .expect(200);
            const users = response.body;
            const visibleEmails = users.map((user) => user.email);
            // Admin should see all users
            (0, globals_1.expect)(visibleEmails).toContain('admin@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('manager@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.manager@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.tenant@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('demo.resident@test.com');
            (0, globals_1.expect)(visibleEmails).toContain('regular.tenant@test.com');
        });
    });
    (0, globals_1.describe)('Edge Cases and Validation', () => {
        (0, globals_1.it)('should handle invitation acceptance when residence no longer exists', async () => {
            // Create invitation with residence
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 7);
            const [invitation] = await db_1.db
                .insert(schema.invitations)
                .values({
                email: 'edgecase@test.com',
                token: 'edge-case-token',
                role: 'tenant',
                status: 'pending',
                invitedByUserId: adminUser.id,
                expiresAt,
                tokenHash: 'hashed-token',
                usageCount: 0,
                maxUsageCount: 1,
                requires2fa: false,
                organizationId: testOrganization.id,
                residenceId: testResidence1.id,
            })
                .returning();
            // Delete the residence
            await db_1.db.delete(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, testResidence1.id));
            // Accept invitation - should still create user and org assignment, but skip residence
            const acceptData = {
                firstName: 'Edge',
                lastName: 'Case',
                password: 'password123',
                dataCollectionConsent: true,
                acknowledgedRights: true,
            };
            const response = await (0, supertest_1.default)(app)
                .post(`/api/invitations/accept/${invitation.token}`)
                .send(acceptData);
            // Should either succeed with warning or handle gracefully
            if (response.status === 201) {
                const [newUser] = await db_1.db
                    .select()
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.email, 'edgecase@test.com'));
                // Should have organization assignment
                const orgAssignment = await db_1.db
                    .select()
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, newUser.id));
                (0, globals_1.expect)(orgAssignment).toHaveLength(1);
                // Should NOT have residence assignment (since residence was deleted)
                const residenceAssignment = await db_1.db
                    .select()
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.userId, newUser.id));
                (0, globals_1.expect)(residenceAssignment).toHaveLength(0);
            }
        });
        (0, globals_1.it)('should prevent duplicate residence assignments', async () => {
            const [user] = await db_1.db
                .insert(schema.users)
                .values({
                email: 'duplicate@test.com',
                username: 'duplicate',
                password: 'hashedpassword123',
                firstName: 'Duplicate',
                lastName: 'User',
                role: 'tenant',
                isActive: true,
                phone: '514-555-0011',
            })
                .returning();
            // Assign residence once
            const residenceAssignments = [
                {
                    residenceId: testResidence1.id,
                    relationshipType: 'tenant',
                    startDate: new Date().toISOString().split('T')[0],
                },
            ];
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Try to assign same residence again
            await (0, supertest_1.default)(app)
                .put(`/api/users/${user.id}/residences`)
                .set('x-test-user-id', adminUser.id)
                .send({ residenceAssignments })
                .expect(200);
            // Should still only have one assignment
            const assignments = await db_1.db
                .select()
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)));
            (0, globals_1.expect)(assignments).toHaveLength(1);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9pbnRlZ3JhdGlvbi91c2VyLW1hbmFnZW1lbnQtY29tcHJlaGVuc2l2ZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTRFO0FBQzVFLDBEQUFnQztBQUNoQyxzREFBOEI7QUFDOUIsZ0RBQXFEO0FBQ3JELHdDQUFxQztBQUNyQyw0REFBOEM7QUFDOUMsNkNBQXNDO0FBRXRDLGlCQUFpQjtBQUNqQixNQUFNLGFBQWEsR0FBRyxHQUFHLEVBQUU7SUFDekIsTUFBTSxHQUFHLEdBQUcsSUFBQSxpQkFBTyxHQUFFLENBQUM7SUFDdEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxpQkFBTyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7SUFDeEIsR0FBRyxDQUFDLEdBQUcsQ0FBQyxpQkFBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFaEQsaUNBQWlDO0lBQ2pDLEdBQUcsQ0FBQyxHQUFHLENBQUMsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUU7UUFDcEMsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ2pELElBQUksVUFBVSxFQUFFLENBQUM7WUFDZixNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsTUFBTSxPQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BHLElBQUksSUFBSSxFQUFFLENBQUM7Z0JBQ1QsR0FBRyxDQUFDLE9BQU8sR0FBRztvQkFDWixNQUFNLEVBQUUsVUFBVTtvQkFD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QUMsRUFDekMsSUFBQSxnQkFBRSxFQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUN6QyxDQUNGLENBQUM7WUFFSixJQUFBLGdCQUFNLEVBQUMsV0FBVyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3Rlc3RzL2ludGVncmF0aW9uL3VzZXItbWFuYWdlbWVudC1jb21wcmVoZW5zaXZlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuaW1wb3J0IHJlcXVlc3QgZnJvbSAnc3VwZXJ0ZXN0JztcbmltcG9ydCBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgcmVnaXN0ZXJSb3V0ZXMgfSBmcm9tICcuLi8uLi9zZXJ2ZXIvcm91dGVzJztcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi4vLi4vc2VydmVyL2RiJztcbmltcG9ydCAqIGFzIHNjaGVtYSBmcm9tICcuLi8uLi9zaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IGVxLCBhbmQgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8vIFRlc3QgdXRpbGl0aWVzXG5jb25zdCBjcmVhdGVUZXN0QXBwID0gKCkgPT4ge1xuICBjb25zdCBhcHAgPSBleHByZXNzKCk7XG4gIGFwcC51c2UoZXhwcmVzcy5qc29uKCkpO1xuICBhcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiB0cnVlIH0pKTtcbiAgXG4gIC8vIFRlc3QgYXV0aGVudGljYXRpb24gbWlkZGxld2FyZVxuICBhcHAudXNlKGFzeW5jIChyZXE6IGFueSwgcmVzLCBuZXh0KSA9PiB7XG4gICAgY29uc3QgdGVzdFVzZXJJZCA9IHJlcS5oZWFkZXJzWyd4LXRlc3QtdXNlci1pZCddO1xuICAgIGlmICh0ZXN0VXNlcklkKSB7XG4gICAgICBjb25zdCBbdXNlcl0gPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCB0ZXN0VXNlcklkKSkubGltaXQoMSk7XG4gICAgICBpZiAodXNlcikge1xuICAgICAgICByZXEuc2Vzc2lvbiA9IHsgXG4gICAgICAgICAgdXNlcklkOiB0ZXN0VXNlcklkLFxuICAgICAgICAgIGlzQXV0aGVudGljYXRlZDogdHJ1ZSxcbiAgICAgICAgICByb2xlOiB1c2VyLnJvbGVcbiAgICAgICAgfTtcbiAgICAgICAgcmVxLnVzZXIgPSB1c2VyO1xuICAgICAgfVxuICAgIH1cbiAgICBuZXh0KCk7XG4gIH0pO1xuICBcbiAgcmVnaXN0ZXJSb3V0ZXMoYXBwKTtcbiAgcmV0dXJuIGFwcDtcbn07XG5cbmRlc2NyaWJlKCdVc2VyIE1hbmFnZW1lbnQgQ29tcHJlaGVuc2l2ZSBUZXN0cycsICgpID0+IHtcbiAgbGV0IGFwcDogZXhwcmVzcy5BcHBsaWNhdGlvbjtcbiAgbGV0IGFkbWluVXNlcjogYW55O1xuICBsZXQgcmVndWxhck1hbmFnZXI6IGFueTtcbiAgbGV0IGRlbW9NYW5hZ2VyOiBhbnk7XG4gIGxldCB0ZXN0T3JnYW5pemF0aW9uOiBhbnk7XG4gIGxldCBkZW1vT3JnYW5pemF0aW9uOiBhbnk7XG4gIGxldCB0ZXN0QnVpbGRpbmc6IGFueTtcbiAgbGV0IHRlc3RSZXNpZGVuY2UxOiBhbnk7XG4gIGxldCB0ZXN0UmVzaWRlbmNlMjogYW55O1xuICBcbiAgYmVmb3JlRWFjaChhc3luYyAoKSA9PiB7XG4gICAgYXBwID0gY3JlYXRlVGVzdEFwcCgpO1xuICAgIFxuICAgIC8vIENsZWFuIHRlc3QgZGF0YVxuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlclJlc2lkZW5jZXMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEudXNlcnMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEucmVzaWRlbmNlcyk7XG4gICAgYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5idWlsZGluZ3MpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEub3JnYW5pemF0aW9ucyk7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBvcmdhbml6YXRpb25zXG4gICAgY29uc3QgW29yZzFdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgbmFtZTogJ1JlZ3VsYXIgVGVzdCBPcmdhbml6YXRpb24nLFxuICAgICAgICB0eXBlOiAnU3RhbmRhcmQnLFxuICAgICAgICBhZGRyZXNzOiAnMTIzIFRlc3QgU3QnLFxuICAgICAgICBjaXR5OiAnVGVzdCBDaXR5JyxcbiAgICAgICAgcHJvdmluY2U6ICdRQycsXG4gICAgICAgIHBvc3RhbENvZGU6ICdIMUggMUgxJyxcbiAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAxMjMnLFxuICAgICAgICBlbWFpbDogJ3Rlc3RAb3JnLmNvbScsXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuICAgIHRlc3RPcmdhbml6YXRpb24gPSBvcmcxO1xuXG4gICAgY29uc3QgW29yZzJdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgbmFtZTogJ0RlbW8gVGVzdCBPcmdhbml6YXRpb24nLFxuICAgICAgICB0eXBlOiAnZGVtbycsXG4gICAgICAgIGFkZHJlc3M6ICc0NTYgRGVtbyBTdCcsXG4gICAgICAgIGNpdHk6ICdEZW1vIENpdHknLFxuICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgcG9zdGFsQ29kZTogJ0gySCAySDInLFxuICAgICAgICBwaG9uZTogJzUxNC01NTUtMDQ1NicsXG4gICAgICAgIGVtYWlsOiAnZGVtb0BvcmcuY29tJyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgZGVtb09yZ2FuaXphdGlvbiA9IG9yZzI7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBidWlsZGluZ1xuICAgIGNvbnN0IFtidWlsZGluZ10gPSBhd2FpdCBkYlxuICAgICAgLmluc2VydChzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiB0ZXN0T3JnYW5pemF0aW9uLmlkLFxuICAgICAgICBuYW1lOiAnVGVzdCBCdWlsZGluZycsXG4gICAgICAgIGFkZHJlc3M6ICcxMjMgVGVzdCBTdCcsXG4gICAgICAgIGNpdHk6ICdUZXN0IENpdHknLFxuICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgcG9zdGFsQ29kZTogJ0gxSCAxSDEnLFxuICAgICAgICB0b3RhbFVuaXRzOiAxMCxcbiAgICAgICAgYnVpbGRpbmdUeXBlOiAnYXBhcnRtZW50JyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdEJ1aWxkaW5nID0gYnVpbGRpbmc7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCByZXNpZGVuY2VzXG4gICAgY29uc3QgW3Jlc2lkZW5jZTFdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICB1bml0TnVtYmVyOiAnMTAxJyxcbiAgICAgICAgc3F1YXJlRm9vdGFnZTogMTAwMCxcbiAgICAgICAgYmVkcm9vbXM6IDIsXG4gICAgICAgIGJhdGhyb29tczogMSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdFJlc2lkZW5jZTEgPSByZXNpZGVuY2UxO1xuXG4gICAgY29uc3QgW3Jlc2lkZW5jZTJdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgYnVpbGRpbmdJZDogdGVzdEJ1aWxkaW5nLmlkLFxuICAgICAgICB1bml0TnVtYmVyOiAnMTAyJyxcbiAgICAgICAgc3F1YXJlRm9vdGFnZTogMTIwMCxcbiAgICAgICAgYmVkcm9vbXM6IDMsXG4gICAgICAgIGJhdGhyb29tczogMixcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgdGVzdFJlc2lkZW5jZTIgPSByZXNpZGVuY2UyO1xuXG4gICAgLy8gQ3JlYXRlIGFkbWluIHVzZXJcbiAgICBjb25zdCBbYWRtaW5dID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgICB1c2VybmFtZTogJ2FkbWluJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgIGZpcnN0TmFtZTogJ0FkbWluJyxcbiAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDAxJyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgYWRtaW5Vc2VyID0gYWRtaW47XG5cbiAgICAvLyBDcmVhdGUgcmVndWxhciBtYW5hZ2VyXG4gICAgY29uc3QgW21hbmFnZXJdID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnbWFuYWdlckB0ZXN0LmNvbScsXG4gICAgICAgIHVzZXJuYW1lOiAnbWFuYWdlcicsXG4gICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzc3dvcmQxMjMnLFxuICAgICAgICBmaXJzdE5hbWU6ICdSZWd1bGFyJyxcbiAgICAgICAgbGFzdE5hbWU6ICdNYW5hZ2VyJyxcbiAgICAgICAgcm9sZTogJ21hbmFnZXInLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDInLFxuICAgICAgfSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICByZWd1bGFyTWFuYWdlciA9IG1hbmFnZXI7XG5cbiAgICAvLyBBc3NpZ24gcmVndWxhciBtYW5hZ2VyIHRvIG9yZ2FuaXphdGlvblxuICAgIGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICB1c2VySWQ6IHJlZ3VsYXJNYW5hZ2VyLmlkLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgb3JnYW5pemF0aW9uUm9sZTogJ21hbmFnZXInLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgLy8gQ3JlYXRlIGRlbW8gbWFuYWdlclxuICAgIGNvbnN0IFtkZW1vTWdyXSA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgIC52YWx1ZXMoe1xuICAgICAgICBlbWFpbDogJ2RlbW8ubWFuYWdlckB0ZXN0LmNvbScsXG4gICAgICAgIHVzZXJuYW1lOiAnZGVtb19tYW5hZ2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgIGZpcnN0TmFtZTogJ0RlbW8nLFxuICAgICAgICBsYXN0TmFtZTogJ01hbmFnZXInLFxuICAgICAgICByb2xlOiAnZGVtb19tYW5hZ2VyJyxcbiAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDAzJyxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG4gICAgZGVtb01hbmFnZXIgPSBkZW1vTWdyO1xuXG4gICAgLy8gQ3JlYXRlIGRlbW8gdXNlcnMgZm9yIHZpc2liaWxpdHkgdGVzdGluZ1xuICAgIGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgIC52YWx1ZXMoW1xuICAgICAgICB7XG4gICAgICAgICAgZW1haWw6ICdkZW1vLnRlbmFudEB0ZXN0LmNvbScsXG4gICAgICAgICAgdXNlcm5hbWU6ICdkZW1vX3RlbmFudCcsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRGVtbycsXG4gICAgICAgICAgbGFzdE5hbWU6ICdUZW5hbnQnLFxuICAgICAgICAgIHJvbGU6ICdkZW1vX3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDQnLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZW1haWw6ICdkZW1vLnJlc2lkZW50QHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2RlbW9fcmVzaWRlbnQnLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzc3dvcmQxMjMnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ0RlbW8nLFxuICAgICAgICAgIGxhc3ROYW1lOiAnUmVzaWRlbnQnLFxuICAgICAgICAgIHJvbGU6ICdkZW1vX3Jlc2lkZW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwNScsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBlbWFpbDogJ3JlZ3VsYXIudGVuYW50QHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ3JlZ3VsYXJfdGVuYW50JyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdSZWd1bGFyJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1RlbmFudCcsXG4gICAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgcGhvbmU6ICc1MTQtNTU1LTAwMDYnLFxuICAgICAgICB9XG4gICAgICBdKTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJSZXNpZGVuY2VzKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLmludml0YXRpb25zKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnVzZXJzKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnJlc2lkZW5jZXMpO1xuICAgIGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuYnVpbGRpbmdzKTtcbiAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLm9yZ2FuaXphdGlvbnMpO1xuICB9KTtcblxuICBkZXNjcmliZSgnSW52aXRhdGlvbiBPcmdhbml6YXRpb24vQnVpbGRpbmcvUmVzaWRlbmNlIEFzc2lnbm1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhc3NpZ24gY29ycmVjdCBvcmdhbml6YXRpb24gYW5kIHJlc2lkZW5jZSB3aGVuIHVzZXIgYWNjZXB0cyBpbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGludml0YXRpb24gd2l0aCBvcmdhbml6YXRpb24gYW5kIHJlc2lkZW5jZVxuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoKTtcbiAgICAgIGV4cGlyZXNBdC5zZXREYXRlKGV4cGlyZXNBdC5nZXREYXRlKCkgKyA3KTtcblxuICAgICAgY29uc3QgaW52aXRhdGlvbkRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAnbmV3dXNlckB0ZXN0LmNvbScsXG4gICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UxLmlkLFxuICAgICAgICBleHBpcmVzQXQ6IGV4cGlyZXNBdC50b0lTT1N0cmluZygpLFxuICAgICAgICBwZXJzb25hbE1lc3NhZ2U6ICdXZWxjb21lIScsXG4gICAgICB9O1xuXG4gICAgICAvLyBDcmVhdGUgaW52aXRhdGlvblxuICAgICAgY29uc3QgaW52aXRlUmVzcG9uc2UgPSBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnBvc3QoJy9hcGkvaW52aXRhdGlvbnMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLnNlbmQoaW52aXRhdGlvbkRhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gR2V0IHRoZSBpbnZpdGF0aW9uIHRva2VuXG4gICAgICBjb25zdCBbaW52aXRhdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmVtYWlsLCAnbmV3dXNlckB0ZXN0LmNvbScpKTtcblxuICAgICAgLy8gQWNjZXB0IGludml0YXRpb25cbiAgICAgIGNvbnN0IGFjY2VwdERhdGEgPSB7XG4gICAgICAgIGZpcnN0TmFtZTogJ05ldycsXG4gICAgICAgIGxhc3ROYW1lOiAnVXNlcicsXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQ6IHRydWUsXG4gICAgICAgIGFja25vd2xlZGdlZFJpZ2h0czogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucG9zdChgL2FwaS9pbnZpdGF0aW9ucy9hY2NlcHQvJHtpbnZpdGF0aW9uLnRva2VufWApXG4gICAgICAgIC5zZW5kKGFjY2VwdERhdGEpXG4gICAgICAgIC5leHBlY3QoMjAxKTtcblxuICAgICAgLy8gVmVyaWZ5IHVzZXIgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IFtuZXdVc2VyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuZW1haWwsICduZXd1c2VyQHRlc3QuY29tJykpO1xuXG4gICAgICBleHBlY3QobmV3VXNlcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChuZXdVc2VyLnJvbGUpLnRvQmUoJ3RlbmFudCcpO1xuXG4gICAgICAvLyBWZXJpZnkgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRcbiAgICAgIGNvbnN0IG9yZ0Fzc2lnbm1lbnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgbmV3VXNlci5pZCksXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIHRlc3RPcmdhbml6YXRpb24uaWQpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBleHBlY3Qob3JnQXNzaWdubWVudCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KG9yZ0Fzc2lnbm1lbnRbMF0ub3JnYW5pemF0aW9uUm9sZSkudG9CZSgndGVuYW50Jyk7XG4gICAgICBleHBlY3Qob3JnQXNzaWdubWVudFswXS5pc0FjdGl2ZSkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gVmVyaWZ5IHJlc2lkZW5jZSBhc3NpZ25tZW50XG4gICAgICBjb25zdCByZXNpZGVuY2VBc3NpZ25tZW50ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIG5ld1VzZXIuaWQpLFxuICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCB0ZXN0UmVzaWRlbmNlMS5pZClcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXNpZGVuY2VBc3NpZ25tZW50KS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzaWRlbmNlQXNzaWdubWVudFswXS5yZWxhdGlvbnNoaXBUeXBlKS50b0JlKCd0ZW5hbnQnKTtcbiAgICAgIGV4cGVjdChyZXNpZGVuY2VBc3NpZ25tZW50WzBdLmlzQWN0aXZlKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW52aXRhdGlvbiB3aXRoIG9ubHkgb3JnYW5pemF0aW9uIChubyByZXNpZGVuY2UpJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXhwaXJlc0F0ID0gbmV3IERhdGUoKTtcbiAgICAgIGV4cGlyZXNBdC5zZXREYXRlKGV4cGlyZXNBdC5nZXREYXRlKCkgKyA3KTtcblxuICAgICAgY29uc3QgaW52aXRhdGlvbkRhdGEgPSB7XG4gICAgICAgIGVtYWlsOiAnbWFuYWdlckB0ZXN0LmNvbScsXG4gICAgICAgIHJvbGU6ICdtYW5hZ2VyJyxcbiAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb24uaWQsXG4gICAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0LnRvSVNPU3RyaW5nKCksXG4gICAgICB9O1xuXG4gICAgICAvLyBDcmVhdGUgaW52aXRhdGlvblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KCcvYXBpL2ludml0YXRpb25zJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5zZW5kKGludml0YXRpb25EYXRhKVxuICAgICAgICAuZXhwZWN0KDIwMSk7XG5cbiAgICAgIGNvbnN0IFtpbnZpdGF0aW9uXSA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsICdtYW5hZ2VyQHRlc3QuY29tJykpO1xuXG4gICAgICAvLyBBY2NlcHQgaW52aXRhdGlvblxuICAgICAgY29uc3QgYWNjZXB0RGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgICAgbGFzdE5hbWU6ICdNYW5hZ2VyJyxcbiAgICAgICAgcGFzc3dvcmQ6ICdwYXNzd29yZDEyMycsXG4gICAgICAgIGRhdGFDb2xsZWN0aW9uQ29uc2VudDogdHJ1ZSxcbiAgICAgICAgYWNrbm93bGVkZ2VkUmlnaHRzOiB0cnVlLFxuICAgICAgfTtcblxuICAgICAgYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL2ludml0YXRpb25zL2FjY2VwdC8ke2ludml0YXRpb24udG9rZW59YClcbiAgICAgICAgLnNlbmQoYWNjZXB0RGF0YSlcbiAgICAgICAgLmV4cGVjdCgyMDEpO1xuXG4gICAgICBjb25zdCBbbmV3VXNlcl0gPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAnbWFuYWdlckB0ZXN0LmNvbScpKTtcblxuICAgICAgLy8gU2hvdWxkIGhhdmUgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRcbiAgICAgIGNvbnN0IG9yZ0Fzc2lnbm1lbnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgbmV3VXNlci5pZCkpO1xuXG4gICAgICBleHBlY3Qob3JnQXNzaWdubWVudCkudG9IYXZlTGVuZ3RoKDEpO1xuXG4gICAgICAvLyBTaG91bGQgTk9UIGhhdmUgcmVzaWRlbmNlIGFzc2lnbm1lbnRcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUFzc2lnbm1lbnQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgbmV3VXNlci5pZCkpO1xuXG4gICAgICBleHBlY3QocmVzaWRlbmNlQXNzaWdubWVudCkudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTXVsdGlwbGUgQnVpbGRpbmcvUmVzaWRlbmNlIEFzc2lnbm1lbnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBhc3NpZ24gbXVsdGlwbGUgcmVzaWRlbmNlcyB0byBhIHVzZXInLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSB0ZXN0IHVzZXIgZmlyc3RcbiAgICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBlbWFpbDogJ211bHRpdXNlckB0ZXN0LmNvbScsXG4gICAgICAgICAgdXNlcm5hbWU6ICdtdWx0aXVzZXInLFxuICAgICAgICAgIHBhc3N3b3JkOiAnaGFzaGVkcGFzc3dvcmQxMjMnLFxuICAgICAgICAgIGZpcnN0TmFtZTogJ011bHRpJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDA3JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBBc3NpZ24gbXVsdGlwbGUgcmVzaWRlbmNlc1xuICAgICAgY29uc3QgcmVzaWRlbmNlQXNzaWdubWVudHMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICByZXNpZGVuY2VJZDogdGVzdFJlc2lkZW5jZTEuaWQsXG4gICAgICAgICAgcmVsYXRpb25zaGlwVHlwZTogJ3RlbmFudCcsXG4gICAgICAgICAgc3RhcnREYXRlOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHJlc2lkZW5jZUlkOiB0ZXN0UmVzaWRlbmNlMi5pZCxcbiAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiAnb2NjdXBhbnQnLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3VzZXJzLyR7dXNlci5pZH0vcmVzaWRlbmNlc2ApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZCh7IHJlc2lkZW5jZUFzc2lnbm1lbnRzIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gVmVyaWZ5IG11bHRpcGxlIGFzc2lnbm1lbnRzXG4gICAgICBjb25zdCBhc3NpZ25tZW50cyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSk7XG5cbiAgICAgIGV4cGVjdChhc3NpZ25tZW50cykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KGFzc2lnbm1lbnRzLnNvbWUoYSA9PiBhLnJlc2lkZW5jZUlkID09PSB0ZXN0UmVzaWRlbmNlMS5pZCkpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoYXNzaWdubWVudHMuc29tZShhID0+IGEucmVzaWRlbmNlSWQgPT09IHRlc3RSZXNpZGVuY2UyLmlkKSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgbWFuYWdlciB0byBhc3NpZ24gcmVzaWRlbmNlcyBvbmx5IHdpdGhpbiB0aGVpciBvcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYSB0ZXN0IHVzZXJcbiAgICAgIGNvbnN0IFt1c2VyXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLnVzZXJzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBlbWFpbDogJ2xpbWl0ZWR1c2VyQHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2xpbWl0ZWR1c2VyJyxcbiAgICAgICAgICBwYXNzd29yZDogJ2hhc2hlZHBhc3N3b3JkMTIzJyxcbiAgICAgICAgICBmaXJzdE5hbWU6ICdMaW1pdGVkJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDA4JyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBNYW5hZ2VyIHRyaWVzIHRvIGFzc2lnbiByZXNpZGVuY2UgaW4gdGhlaXIgb3JnYW5pemF0aW9uIChzaG91bGQgd29yaylcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUFzc2lnbm1lbnRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UxLmlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnB1dChgL2FwaS91c2Vycy8ke3VzZXIuaWR9L3Jlc2lkZW5jZXNgKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHJlZ3VsYXJNYW5hZ2VyLmlkKVxuICAgICAgICAuc2VuZCh7IHJlc2lkZW5jZUFzc2lnbm1lbnRzIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gVmVyaWZ5IGFzc2lnbm1lbnQgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IGFzc2lnbm1lbnRzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQsIHVzZXIuaWQpKTtcblxuICAgICAgZXhwZWN0KGFzc2lnbm1lbnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoYXNzaWdubWVudHNbMF0ucmVzaWRlbmNlSWQpLnRvQmUodGVzdFJlc2lkZW5jZTEuaWQpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnTWFuYWdlciBQZXJtaXNzaW9uIFJlc3RyaWN0aW9ucycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgcmVndWxhciBtYW5hZ2VyIGZyb20gYXNzaWduaW5nIG9yZ2FuaXphdGlvbnMgdG8gdXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBbdXNlcl0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS51c2VycylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgZW1haWw6ICdyZXN0cmljdGVkdXNlckB0ZXN0LmNvbScsXG4gICAgICAgICAgdXNlcm5hbWU6ICdyZXN0cmljdGVkdXNlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnUmVzdHJpY3RlZCcsXG4gICAgICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgICAgICByb2xlOiAndGVuYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAwOScsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gTWFuYWdlciB0cmllcyB0byBhc3NpZ24gb3JnYW5pemF0aW9uIChzaG91bGQgZmFpbClcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wdXQoYC9hcGkvdXNlcnMvJHt1c2VyLmlkfS9vcmdhbml6YXRpb25zYClcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCByZWd1bGFyTWFuYWdlci5pZClcbiAgICAgICAgLnNlbmQoeyBvcmdhbml6YXRpb25JZHM6IFt0ZXN0T3JnYW5pemF0aW9uLmlkXSB9KVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQ29udGFpbignT25seSBhZG1pbmlzdHJhdG9ycyBjYW4gbW9kaWZ5IG9yZ2FuaXphdGlvbiBhc3NpZ25tZW50cycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IHJlZ3VsYXIgbWFuYWdlciBmcm9tIGNyZWF0aW5nIHVzZXJzIHdpdGggb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyB3b3VsZCBiZSB0ZXN0ZWQgaWYgdGhlcmUncyBhIHVzZXIgY3JlYXRpb24gZW5kcG9pbnQgdGhhdCBhY2NlcHRzIG9yZ2FuaXphdGlvbklkc1xuICAgICAgLy8gRm9yIG5vdywgd2UgdGVzdCB0aGF0IG1hbmFnZXJzIGNhbid0IGRpcmVjdGx5IGFzc2lnbiBvcmdhbml6YXRpb25zXG4gICAgICBjb25zdCB1c2VyRGF0YSA9IHtcbiAgICAgICAgZW1haWw6ICduZXdtYW5hZ2VkQHRlc3QuY29tJyxcbiAgICAgICAgZmlyc3ROYW1lOiAnTmV3JyxcbiAgICAgICAgbGFzdE5hbWU6ICdNYW5hZ2VkJyxcbiAgICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgICBvcmdhbml6YXRpb25JZHM6IFt0ZXN0T3JnYW5pemF0aW9uLmlkXSwgLy8gTWFuYWdlciBzaG91bGRuJ3QgYmUgYWJsZSB0byBzZXQgdGhpc1xuICAgICAgfTtcblxuICAgICAgLy8gVGhpcyB0ZXN0IGFzc3VtZXMgdGhlcmUncyB2YWxpZGF0aW9uIGluIHRoZSB1c2VyIGNyZWF0aW9uIGVuZHBvaW50XG4gICAgICAvLyBUaGUgYWN0dWFsIGltcGxlbWVudGF0aW9uIG1pZ2h0IGhhbmRsZSB0aGlzIGRpZmZlcmVudGx5XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG9ubHkgYWxsb3cgbWFuYWdlciB0byBhc3NpZ24gcmVzaWRlbmNlcyB3aXRoaW4gdGhlaXIgb3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGFub3RoZXIgb3JnYW5pemF0aW9uIGFuZCBidWlsZGluZ1xuICAgICAgY29uc3QgW290aGVyT3JnXSA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIG5hbWU6ICdPdGhlciBPcmdhbml6YXRpb24nLFxuICAgICAgICAgIHR5cGU6ICdTdGFuZGFyZCcsXG4gICAgICAgICAgYWRkcmVzczogJzc4OSBPdGhlciBTdCcsXG4gICAgICAgICAgY2l0eTogJ090aGVyIENpdHknLFxuICAgICAgICAgIHByb3ZpbmNlOiAnUUMnLFxuICAgICAgICAgIHBvc3RhbENvZGU6ICdIM0ggM0gzJyxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDc4OScsXG4gICAgICAgICAgZW1haWw6ICdvdGhlckBvcmcuY29tJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICBjb25zdCBbb3RoZXJCdWlsZGluZ10gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBvdGhlck9yZy5pZCxcbiAgICAgICAgICBuYW1lOiAnT3RoZXIgQnVpbGRpbmcnLFxuICAgICAgICAgIGFkZHJlc3M6ICc3ODkgT3RoZXIgU3QnLFxuICAgICAgICAgIGNpdHk6ICdPdGhlciBDaXR5JyxcbiAgICAgICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgICAgICBwb3N0YWxDb2RlOiAnSDNIIDNIMycsXG4gICAgICAgICAgdG90YWxVbml0czogNSxcbiAgICAgICAgICBidWlsZGluZ1R5cGU6ICdhcGFydG1lbnQnLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGNvbnN0IFtvdGhlclJlc2lkZW5jZV0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBidWlsZGluZ0lkOiBvdGhlckJ1aWxkaW5nLmlkLFxuICAgICAgICAgIHVuaXROdW1iZXI6ICczMDEnLFxuICAgICAgICAgIHNxdWFyZUZvb3RhZ2U6IDgwMCxcbiAgICAgICAgICBiZWRyb29tczogMSxcbiAgICAgICAgICBiYXRocm9vbXM6IDEsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGVtYWlsOiAnY3Jvc3Nvcmd1c2VyQHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2Nyb3Nzb3JndXNlcicsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnQ3Jvc3MnLFxuICAgICAgICAgIGxhc3ROYW1lOiAnT3JnJyxcbiAgICAgICAgICByb2xlOiAndGVuYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgICBwaG9uZTogJzUxNC01NTUtMDAxMCcsXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gTWFuYWdlciB0cmllcyB0byBhc3NpZ24gcmVzaWRlbmNlIGZyb20gZGlmZmVyZW50IG9yZ2FuaXphdGlvbiAoc2hvdWxkIGZhaWwgb3IgYmUgZmlsdGVyZWQpXG4gICAgICBjb25zdCByZXNpZGVuY2VBc3NpZ25tZW50cyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIHJlc2lkZW5jZUlkOiBvdGhlclJlc2lkZW5jZS5pZCwgLy8gVGhpcyBpcyBmcm9tIGEgZGlmZmVyZW50IG9yZ2FuaXphdGlvblxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICAvLyBUaGlzIHNob3VsZCBlaXRoZXIgZmFpbCB3aXRoIDQwMyBvciBzaWxlbnRseSBpZ25vcmUgdGhlIGludmFsaWQgYXNzaWdubWVudFxuICAgICAgLy8gZGVwZW5kaW5nIG9uIGltcGxlbWVudGF0aW9uXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3VzZXJzLyR7dXNlci5pZH0vcmVzaWRlbmNlc2ApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgcmVndWxhck1hbmFnZXIuaWQpXG4gICAgICAgIC5zZW5kKHsgcmVzaWRlbmNlQXNzaWdubWVudHMgfSk7XG5cbiAgICAgIC8vIFRoZSBleGFjdCByZXNwb25zZSBkZXBlbmRzIG9uIGltcGxlbWVudGF0aW9uLCBidXQgdGhlIGFzc2lnbm1lbnQgc2hvdWxkbid0IHN1Y2NlZWRcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMCkge1xuICAgICAgICAvLyBJZiBpdCByZXR1cm5zIDIwMCwgdmVyaWZ5IG5vIGFzc2lnbm1lbnQgd2FzIGFjdHVhbGx5IGNyZWF0ZWRcbiAgICAgICAgY29uc3QgYXNzaWdubWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCkpO1xuXG4gICAgICAgIGV4cGVjdChhc3NpZ25tZW50cykudG9IYXZlTGVuZ3RoKDApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gU2hvdWxkIHJldHVybiBhbiBlcnJvciBzdGF0dXNcbiAgICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCg0MDApO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGVtbyBNYW5hZ2VyIFVzZXIgVmlzaWJpbGl0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNob3cgb25seSBkZW1vIHVzZXJzIHRvIGRlbW8gbWFuYWdlciBpbiB1c2VyIG1hbmFnZW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3VzZXJzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBkZW1vTWFuYWdlci5pZClcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBjb25zdCB1c2VycyA9IHJlc3BvbnNlLmJvZHk7XG4gICAgICBcbiAgICAgIC8vIERlbW8gbWFuYWdlciBzaG91bGQgb25seSBzZWUgZGVtbyB1c2VycyAoZGVtb19tYW5hZ2VyLCBkZW1vX3RlbmFudCwgZGVtb19yZXNpZGVudClcbiAgICAgIGNvbnN0IHZpc2libGVSb2xlcyA9IHVzZXJzLm1hcCgodXNlcjogYW55KSA9PiB1c2VyLnJvbGUpO1xuICAgICAgXG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS50b0NvbnRhaW4oJ2RlbW9fbWFuYWdlcicpO1xuICAgICAgZXhwZWN0KHZpc2libGVSb2xlcykudG9Db250YWluKCdkZW1vX3RlbmFudCcpOyBcbiAgICAgIGV4cGVjdCh2aXNpYmxlUm9sZXMpLnRvQ29udGFpbignZGVtb19yZXNpZGVudCcpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgTk9UIHNlZSByZWd1bGFyIHJvbGVzXG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS5ub3QudG9Db250YWluKCdhZG1pbicpO1xuICAgICAgZXhwZWN0KHZpc2libGVSb2xlcykubm90LnRvQ29udGFpbignbWFuYWdlcicpO1xuICAgICAgZXhwZWN0KHZpc2libGVSb2xlcykubm90LnRvQ29udGFpbigndGVuYW50Jyk7XG4gICAgICBleHBlY3QodmlzaWJsZVJvbGVzKS5ub3QudG9Db250YWluKCdyZXNpZGVudCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyByZWd1bGFyIG1hbmFnZXIgdG8gc2VlIG5vbi1kZW1vIHVzZXJzIGluIHRoZWlyIG9yZ2FuaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFzc2lnbiB0aGUgcmVndWxhciB0ZW5hbnQgdG8gdGhlIHNhbWUgb3JnYW5pemF0aW9uIGFzIHRoZSBtYW5hZ2VyXG4gICAgICBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgdXNlcklkOiAoYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5lbWFpbCwgJ3JlZ3VsYXIudGVuYW50QHRlc3QuY29tJykpKVswXS5pZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogdGVzdE9yZ2FuaXphdGlvbi5pZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25Sb2xlOiAndGVuYW50JyxcbiAgICAgICAgICBpc0FjdGl2ZTogdHJ1ZSxcbiAgICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5nZXQoJy9hcGkvdXNlcnMnKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIHJlZ3VsYXJNYW5hZ2VyLmlkKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IHVzZXJzID0gcmVzcG9uc2UuYm9keTtcbiAgICAgIGNvbnN0IHZpc2libGVFbWFpbHMgPSB1c2Vycy5tYXAoKHVzZXI6IGFueSkgPT4gdXNlci5lbWFpbCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBzZWUgdXNlcnMgaW4gdGhlaXIgb3JnYW5pemF0aW9uXG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdyZWd1bGFyLnRlbmFudEB0ZXN0LmNvbScpO1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLnRvQ29udGFpbignbWFuYWdlckB0ZXN0LmNvbScpOyAvLyB0aGVtc2VsdmVzXG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBOT1Qgc2VlIGRlbW8gdXNlcnNcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS5ub3QudG9Db250YWluKCdkZW1vLnRlbmFudEB0ZXN0LmNvbScpO1xuICAgICAgZXhwZWN0KHZpc2libGVFbWFpbHMpLm5vdC50b0NvbnRhaW4oJ2RlbW8ucmVzaWRlbnRAdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS5ub3QudG9Db250YWluKCdkZW1vLm1hbmFnZXJAdGVzdC5jb20nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgYWRtaW4gdG8gc2VlIGFsbCB1c2VycyByZWdhcmRsZXNzIG9mIHR5cGUnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAuZ2V0KCcvYXBpL3VzZXJzJylcbiAgICAgICAgLnNldCgneC10ZXN0LXVzZXItaWQnLCBhZG1pblVzZXIuaWQpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgY29uc3QgdXNlcnMgPSByZXNwb25zZS5ib2R5O1xuICAgICAgY29uc3QgdmlzaWJsZUVtYWlscyA9IHVzZXJzLm1hcCgodXNlcjogYW55KSA9PiB1c2VyLmVtYWlsKTtcbiAgICAgIFxuICAgICAgLy8gQWRtaW4gc2hvdWxkIHNlZSBhbGwgdXNlcnNcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ2FkbWluQHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdtYW5hZ2VyQHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdkZW1vLm1hbmFnZXJAdGVzdC5jb20nKTtcbiAgICAgIGV4cGVjdCh2aXNpYmxlRW1haWxzKS50b0NvbnRhaW4oJ2RlbW8udGVuYW50QHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdkZW1vLnJlc2lkZW50QHRlc3QuY29tJyk7XG4gICAgICBleHBlY3QodmlzaWJsZUVtYWlscykudG9Db250YWluKCdyZWd1bGFyLnRlbmFudEB0ZXN0LmNvbScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRWRnZSBDYXNlcyBhbmQgVmFsaWRhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbnZpdGF0aW9uIGFjY2VwdGFuY2Ugd2hlbiByZXNpZGVuY2Ugbm8gbG9uZ2VyIGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uIHdpdGggcmVzaWRlbmNlXG4gICAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZSgpO1xuICAgICAgZXhwaXJlc0F0LnNldERhdGUoZXhwaXJlc0F0LmdldERhdGUoKSArIDcpO1xuXG4gICAgICBjb25zdCBbaW52aXRhdGlvbl0gPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgZW1haWw6ICdlZGdlY2FzZUB0ZXN0LmNvbScsXG4gICAgICAgICAgdG9rZW46ICdlZGdlLWNhc2UtdG9rZW4nLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIHN0YXR1czogJ3BlbmRpbmcnLFxuICAgICAgICAgIGludml0ZWRCeVVzZXJJZDogYWRtaW5Vc2VyLmlkLFxuICAgICAgICAgIGV4cGlyZXNBdCxcbiAgICAgICAgICB0b2tlbkhhc2g6ICdoYXNoZWQtdG9rZW4nLFxuICAgICAgICAgIHVzYWdlQ291bnQ6IDAsXG4gICAgICAgICAgbWF4VXNhZ2VDb3VudDogMSxcbiAgICAgICAgICByZXF1aXJlczJmYTogZmFsc2UsXG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHRlc3RPcmdhbml6YXRpb24uaWQsXG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UxLmlkLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIERlbGV0ZSB0aGUgcmVzaWRlbmNlXG4gICAgICBhd2FpdCBkYi5kZWxldGUoc2NoZW1hLnJlc2lkZW5jZXMpLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCB0ZXN0UmVzaWRlbmNlMS5pZCkpO1xuXG4gICAgICAvLyBBY2NlcHQgaW52aXRhdGlvbiAtIHNob3VsZCBzdGlsbCBjcmVhdGUgdXNlciBhbmQgb3JnIGFzc2lnbm1lbnQsIGJ1dCBza2lwIHJlc2lkZW5jZVxuICAgICAgY29uc3QgYWNjZXB0RGF0YSA9IHtcbiAgICAgICAgZmlyc3ROYW1lOiAnRWRnZScsXG4gICAgICAgIGxhc3ROYW1lOiAnQ2FzZScsXG4gICAgICAgIHBhc3N3b3JkOiAncGFzc3dvcmQxMjMnLFxuICAgICAgICBkYXRhQ29sbGVjdGlvbkNvbnNlbnQ6IHRydWUsXG4gICAgICAgIGFja25vd2xlZGdlZFJpZ2h0czogdHJ1ZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVxdWVzdChhcHApXG4gICAgICAgIC5wb3N0KGAvYXBpL2ludml0YXRpb25zL2FjY2VwdC8ke2ludml0YXRpb24udG9rZW59YClcbiAgICAgICAgLnNlbmQoYWNjZXB0RGF0YSk7XG5cbiAgICAgIC8vIFNob3VsZCBlaXRoZXIgc3VjY2VlZCB3aXRoIHdhcm5pbmcgb3IgaGFuZGxlIGdyYWNlZnVsbHlcbiAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDIwMSkge1xuICAgICAgICBjb25zdCBbbmV3VXNlcl0gPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmVtYWlsLCAnZWRnZWNhc2VAdGVzdC5jb20nKSk7XG5cbiAgICAgICAgLy8gU2hvdWxkIGhhdmUgb3JnYW5pemF0aW9uIGFzc2lnbm1lbnRcbiAgICAgICAgY29uc3Qgb3JnQXNzaWdubWVudCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBuZXdVc2VyLmlkKSk7XG5cbiAgICAgICAgZXhwZWN0KG9yZ0Fzc2lnbm1lbnQpLnRvSGF2ZUxlbmd0aCgxKTtcblxuICAgICAgICAvLyBTaG91bGQgTk9UIGhhdmUgcmVzaWRlbmNlIGFzc2lnbm1lbnQgKHNpbmNlIHJlc2lkZW5jZSB3YXMgZGVsZXRlZClcbiAgICAgICAgY29uc3QgcmVzaWRlbmNlQXNzaWdubWVudCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCBuZXdVc2VyLmlkKSk7XG5cbiAgICAgICAgZXhwZWN0KHJlc2lkZW5jZUFzc2lnbm1lbnQpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJldmVudCBkdXBsaWNhdGUgcmVzaWRlbmNlIGFzc2lnbm1lbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgW3VzZXJdID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEudXNlcnMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIGVtYWlsOiAnZHVwbGljYXRlQHRlc3QuY29tJyxcbiAgICAgICAgICB1c2VybmFtZTogJ2R1cGxpY2F0ZScsXG4gICAgICAgICAgcGFzc3dvcmQ6ICdoYXNoZWRwYXNzd29yZDEyMycsXG4gICAgICAgICAgZmlyc3ROYW1lOiAnRHVwbGljYXRlJyxcbiAgICAgICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIHBob25lOiAnNTE0LTU1NS0wMDExJyxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBBc3NpZ24gcmVzaWRlbmNlIG9uY2VcbiAgICAgIGNvbnN0IHJlc2lkZW5jZUFzc2lnbm1lbnRzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHRlc3RSZXNpZGVuY2UxLmlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6ICd0ZW5hbnQnLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNwbGl0KCdUJylbMF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBhd2FpdCByZXF1ZXN0KGFwcClcbiAgICAgICAgLnB1dChgL2FwaS91c2Vycy8ke3VzZXIuaWR9L3Jlc2lkZW5jZXNgKVxuICAgICAgICAuc2V0KCd4LXRlc3QtdXNlci1pZCcsIGFkbWluVXNlci5pZClcbiAgICAgICAgLnNlbmQoeyByZXNpZGVuY2VBc3NpZ25tZW50cyB9KVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIC8vIFRyeSB0byBhc3NpZ24gc2FtZSByZXNpZGVuY2UgYWdhaW5cbiAgICAgIGF3YWl0IHJlcXVlc3QoYXBwKVxuICAgICAgICAucHV0KGAvYXBpL3VzZXJzLyR7dXNlci5pZH0vcmVzaWRlbmNlc2ApXG4gICAgICAgIC5zZXQoJ3gtdGVzdC11c2VyLWlkJywgYWRtaW5Vc2VyLmlkKVxuICAgICAgICAuc2VuZCh7IHJlc2lkZW5jZUFzc2lnbm1lbnRzIH0pXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gU2hvdWxkIHN0aWxsIG9ubHkgaGF2ZSBvbmUgYXNzaWdubWVudFxuICAgICAgY29uc3QgYXNzaWdubWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBleHBlY3QoYXNzaWdubWVudHMpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=