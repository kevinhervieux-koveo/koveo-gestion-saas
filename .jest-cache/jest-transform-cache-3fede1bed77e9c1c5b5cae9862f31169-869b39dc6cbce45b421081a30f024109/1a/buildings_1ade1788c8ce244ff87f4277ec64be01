4dfdbfb269b9e22c7f3f4b391c293897
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerBuildingRoutes = registerBuildingRoutes;
const db_1 = require("../db");
const schema_1 = require("@shared/schema");
const drizzle_orm_1 = require("drizzle-orm");
const auth_1 = require("../auth");
const crypto_1 = __importDefault(require("crypto"));
/**
 * Handles creating or deleting residences when building totalUnits changes
 */
async function handleResidenceChanges(buildingId, organizationId, newTotalUnits, currentResidenceCount, totalFloors) {
    try {
        // Object storage hierarchy will be created automatically when documents are uploaded
        if (newTotalUnits > currentResidenceCount) {
            // Need to create more residences
            const residencesToCreate = newTotalUnits - currentResidenceCount;
            // Get existing residence numbers to avoid conflicts
            const existingResidences = await db_1.db
                .select({ unitNumber: schema_1.residences.unitNumber })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId));
            const existingUnitNumbers = new Set(existingResidences.map((r) => r.unitNumber));
            const floors = totalFloors || 1;
            const unitsPerFloor = Math.ceil(newTotalUnits / floors);
            const newResidences = [];
            let unitCounter = 1;
            for (let residenceIndex = 0; residenceIndex < residencesToCreate; residenceIndex++) {
                // Find next available unit number
                while (existingUnitNumbers.has(unitCounter.toString())) {
                    unitCounter++;
                }
                const floor = Math.ceil(unitCounter / unitsPerFloor);
                const unitNumber = unitCounter.toString();
                newResidences.push({
                    buildingId,
                    unitNumber,
                    floor: floor,
                    isActive: true,
                });
                existingUnitNumbers.add(unitNumber);
                unitCounter++;
            }
            // Create residences in batch
            if (newResidences.length > 0) {
                const createdResidences = await db_1.db.insert(schema_1.residences).values(newResidences).returning();
                // Create object storage hierarchy for each new residence
                for (const residence of createdResidences) {
                    try {
                        // TODO: Object storage service integration
                        // await objectStorageService.createResidenceHierarchy(
                        //   organizationId,
                        //   buildingId,
                        //   residence.id
                        // );
                    }
                    catch (storageError) {
                        console.error(`‚ö†Ô∏è Error creating storage hierarchy for residence ${residence.id}:`, storageError);
                        // Don't fail the whole operation for storage errors
                    }
                }
                console.log(`‚úÖ Created ${createdResidences.length} new residences for building ${buildingId}`);
            }
        }
        else if (newTotalUnits < currentResidenceCount) {
            // Need to delete some residences
            const residencesToDelete = currentResidenceCount - newTotalUnits;
            console.log(`üìâ Marking ${residencesToDelete} residences as inactive for building ${buildingId}`);
            // Get residences that can be safely deleted (no active user relationships)
            const deletableResidences = await db_1.db
                .select({ id: schema_1.residences.id, unitNumber: schema_1.residences.unitNumber })
                .from(schema_1.residences)
                .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userResidences.id) // No active user relationships
            ))
                .orderBy((0, drizzle_orm_1.sql) `${schema_1.residences.unitNumber}::integer DESC`) // Delete highest unit numbers first
                .limit(residencesToDelete);
            if (deletableResidences.length > 0) {
                const residenceIdsToDelete = deletableResidences.map((r) => r.id);
                // Soft delete residences (mark as inactive)
                await db_1.db
                    .update(schema_1.residences)
                    .set({
                    isActive: false,
                    updatedAt: new Date(),
                })
                    .where((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIdsToDelete));
                console.log(`‚úÖ Marked ${deletableResidences.length} residences as inactive for building ${buildingId}`);
                // Log which residences couldn't be deleted due to user relationships
                const protectedCount = residencesToDelete - deletableResidences.length;
                if (protectedCount > 0) {
                    console.log(`‚ö†Ô∏è Could not delete ${protectedCount} residences - they have active user relationships`);
                }
            }
            else {
            }
        }
        else {
            console.log(`‚úì No residence changes needed - building ${buildingId} already has ${currentResidenceCount} residences`);
        }
        // Don't throw the error to avoid breaking the building update
    }
    catch (error) {
        console.error('‚ùå Error updating residence count:', error);
        // Don't throw the error to avoid breaking the building update
    }
}
/**
 *
 * @param app
 */
/**
 * RegisterBuildingRoutes function.
 * @param app
 * @returns Function result.
 */
function registerBuildingRoutes(app) {
    /**
     * GET /api/buildings - Retrieves buildings based on user role and organization access.
     * Used by bills page and other components.
     *
     * Access Control Logic:
     * - Admin: Can see all buildings if they have global access, or buildings in their organizations
     * - Manager: Can see only buildings in their organizations
     * - Others: No access to buildings list.
     */
    app.get('/api/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            if (!user) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            // Role-based access control for buildings
            if (![
                'admin',
                'manager',
                'demo_manager',
                'demo_tenant',
                'demo_resident',
                'tenant',
                'resident',
            ].includes(user.role)) {
                return res.status(403).json({
                    message: 'Access denied. Insufficient permissions.',
                    code: 'INSUFFICIENT_PERMISSIONS',
                });
            }
            console.log('üè¢ [Buildings API] User accessing buildings:', {
                id: user.id,
                role: user.role,
                organizations: user.organizations,
                canAccessAllOrganizations: user.canAccessAllOrganizations,
            });
            let buildingsQuery;
            if (user.role === 'admin' && user.canAccessAllOrganizations) {
                // Admin with global access can see all buildings
                buildingsQuery = db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    organizationName: schema_1.organizations.name,
                })
                    .from(schema_1.buildings)
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true))
                    .orderBy(schema_1.organizations.name, schema_1.buildings.name);
            }
            else {
                // Manager or admin without global access: only buildings from their organizations
                console.log(`üîç [BUILDINGS DEBUG] Taking ELSE path - User ${user.id} organizations:`, user.organizations);
                if (!user.organizations || user.organizations.length === 0) {
                    console.log(`üîç [BUILDINGS DEBUG] User ${user.id} has no organizations, checking residence access...`);
                    // For tenant/resident roles: Get buildings through their residences
                    if (['tenant', 'resident', 'demo_tenant', 'demo_resident'].includes(user.role)) {
                        const userResidencesList = await db_1.db
                            .select({
                            buildingId: schema_1.residences.buildingId,
                        })
                            .from(schema_1.userResidences)
                            .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
                        console.log(`üîç [BUILDINGS DEBUG] Found ${userResidencesList.length} residences for user ${user.id}`);
                        if (userResidencesList.length === 0) {
                            return res.json([]); // No residences = no buildings
                        }
                        const accessibleBuildingIds = [
                            ...new Set(userResidencesList.map((ur) => ur.buildingId)),
                        ];
                        console.log(`üîç [BUILDINGS DEBUG] Accessible building IDs:`, accessibleBuildingIds);
                        buildingsQuery = db_1.db
                            .select({
                            id: schema_1.buildings.id,
                            name: schema_1.buildings.name,
                            address: schema_1.buildings.address,
                            city: schema_1.buildings.city,
                            province: schema_1.buildings.province,
                            postalCode: schema_1.buildings.postalCode,
                            buildingType: schema_1.buildings.buildingType,
                            yearBuilt: schema_1.buildings.yearBuilt,
                            totalUnits: schema_1.buildings.totalUnits,
                            totalFloors: schema_1.buildings.totalFloors,
                            parkingSpaces: schema_1.buildings.parkingSpaces,
                            storageSpaces: schema_1.buildings.storageSpaces,
                            organizationId: schema_1.buildings.organizationId,
                            isActive: schema_1.buildings.isActive,
                            createdAt: schema_1.buildings.createdAt,
                            organizationName: schema_1.organizations.name,
                        })
                            .from(schema_1.buildings)
                            .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.inArray)(schema_1.buildings.id, accessibleBuildingIds)))
                            .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                    }
                    else {
                        return res.json([]); // No organizations = no buildings for managers/admins
                    }
                }
                else {
                    // User has organizations - use organization-based access
                    buildingsQuery = db_1.db
                        .select({
                        id: schema_1.buildings.id,
                        name: schema_1.buildings.name,
                        address: schema_1.buildings.address,
                        city: schema_1.buildings.city,
                        province: schema_1.buildings.province,
                        postalCode: schema_1.buildings.postalCode,
                        buildingType: schema_1.buildings.buildingType,
                        yearBuilt: schema_1.buildings.yearBuilt,
                        totalUnits: schema_1.buildings.totalUnits,
                        totalFloors: schema_1.buildings.totalFloors,
                        parkingSpaces: schema_1.buildings.parkingSpaces,
                        storageSpaces: schema_1.buildings.storageSpaces,
                        organizationId: schema_1.buildings.organizationId,
                        isActive: schema_1.buildings.isActive,
                        createdAt: schema_1.buildings.createdAt,
                        organizationName: schema_1.organizations.name,
                    })
                        .from(schema_1.buildings)
                        .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true), (0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, user.organizations)))
                        .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                }
            }
            const result = await buildingsQuery;
            res.json(result);
        }
        catch (error) {
            console.error('‚ùå Error fetching buildings:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch buildings',
            });
        }
    });
    /**
     * GET /api/manager/buildings - Retrieves buildings based on user role and associations.
     *
     * Access Control Logic:
     * - Admin: Can see all buildings in their organization + buildings where they have residences
     * - Manager: Can see all buildings in their organization + buildings where they have residences
     * - Resident/Tenant: Can see only buildings where they have residences (role is not used, only residence links).
     */
    app.get('/api/manager/buildings', async (req, res) => {
        // Authentication check
        if (!req.session?.userId && !req.session?.user) {
            return res.status(401).json({
                message: 'Authentication required',
                code: 'AUTH_REQUIRED',
            });
        }
        try {
            // Use session data directly for now
            let currentUser = req.user || req.session?.user;
            // If we only have userId, we need to fetch the user
            if (!currentUser && req.session?.userId) {
                // Import storage from the auth route pattern
                const { storage } = await Promise.resolve().then(() => __importStar(require('../storage')));
                currentUser = await storage.getUser(req.session.userId);
            }
            if (!currentUser) {
                return res.status(401).json({
                    message: 'User not found',
                    code: 'USER_NOT_FOUND',
                });
            }
            console.log(`üìä Fetching buildings for user ${currentUser.id} with role ${currentUser.role}`);
            const accessibleBuildings = [];
            const buildingIds = new Set();
            // Check if user belongs to Koveo organization (special global access)
            const userOrgs = await db_1.db
                .select({
                organizationId: schema_1.userOrganizations.organizationId,
                organizationName: schema_1.organizations.name,
                canAccessAllOrganizations: schema_1.userOrganizations.canAccessAllOrganizations,
            })
                .from(schema_1.userOrganizations)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)));
            const hasGlobalAccess = currentUser.role === 'admin' ||
                userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
            if (hasGlobalAccess) {
                console.log(`üåü Admin user or user with global access detected - granting access to ALL buildings`);
                // Koveo users can see ALL buildings from ALL organizations
                const allBuildings = await db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    amenities: schema_1.buildings.amenities,
                    managementCompany: schema_1.buildings.managementCompany,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    updatedAt: schema_1.buildings.updatedAt,
                    organizationName: schema_1.organizations.name,
                    organizationType: schema_1.organizations.type,
                })
                    .from(schema_1.buildings)
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true))
                    .orderBy(schema_1.organizations.name, schema_1.buildings.name);
                // Add all buildings with special Koveo access type
                allBuildings.forEach((building) => {
                    if (!buildingIds.has(building.id)) {
                        buildingIds.add(building.id);
                        accessibleBuildings.push({
                            ...building,
                            accessType: 'koveo-global', // Special access type for Koveo users
                        });
                    }
                });
            }
            else {
                // Regular users: For Admin and Manager roles: Get buildings from their organizations only
                if (currentUser.role === 'admin' || currentUser.role === 'manager') {
                    if (userOrgs.length > 0) {
                        const orgIds = userOrgs.map((uo) => uo.organizationId);
                        // Get all buildings from these organizations only
                        const orgBuildings = await db_1.db
                            .select({
                            id: schema_1.buildings.id,
                            name: schema_1.buildings.name,
                            address: schema_1.buildings.address,
                            city: schema_1.buildings.city,
                            province: schema_1.buildings.province,
                            postalCode: schema_1.buildings.postalCode,
                            buildingType: schema_1.buildings.buildingType,
                            yearBuilt: schema_1.buildings.yearBuilt,
                            totalUnits: schema_1.buildings.totalUnits,
                            totalFloors: schema_1.buildings.totalFloors,
                            parkingSpaces: schema_1.buildings.parkingSpaces,
                            storageSpaces: schema_1.buildings.storageSpaces,
                            amenities: schema_1.buildings.amenities,
                            managementCompany: schema_1.buildings.managementCompany,
                            organizationId: schema_1.buildings.organizationId,
                            isActive: schema_1.buildings.isActive,
                            createdAt: schema_1.buildings.createdAt,
                            updatedAt: schema_1.buildings.updatedAt,
                            organizationName: schema_1.organizations.name,
                            organizationType: schema_1.organizations.type,
                        })
                            .from(schema_1.buildings)
                            .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)));
                        orgBuildings.forEach((building) => {
                            if (!buildingIds.has(building.id)) {
                                buildingIds.add(building.id);
                                accessibleBuildings.push({
                                    ...building,
                                    accessType: 'organization', // Track how user has access
                                });
                            }
                        });
                    }
                }
            }
            // For ALL roles (Admin, Manager, Resident, Tenant): Get buildings from their residences
            // This is the many-to-many relationship - users can have residences in different buildings
            const userResidenceRecords = await db_1.db
                .select({
                residenceId: schema_1.userResidences.residenceId,
                relationshipType: schema_1.userResidences.relationshipType,
            })
                .from(schema_1.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
            if (userResidenceRecords.length > 0) {
                const residenceIds = userResidenceRecords.map((ur) => ur.residenceId);
                // Get buildings through residences
                const residenceBuildings = await db_1.db
                    .select({
                    id: schema_1.buildings.id,
                    name: schema_1.buildings.name,
                    address: schema_1.buildings.address,
                    city: schema_1.buildings.city,
                    province: schema_1.buildings.province,
                    postalCode: schema_1.buildings.postalCode,
                    buildingType: schema_1.buildings.buildingType,
                    yearBuilt: schema_1.buildings.yearBuilt,
                    totalUnits: schema_1.buildings.totalUnits,
                    totalFloors: schema_1.buildings.totalFloors,
                    parkingSpaces: schema_1.buildings.parkingSpaces,
                    storageSpaces: schema_1.buildings.storageSpaces,
                    amenities: schema_1.buildings.amenities,
                    managementCompany: schema_1.buildings.managementCompany,
                    organizationId: schema_1.buildings.organizationId,
                    isActive: schema_1.buildings.isActive,
                    createdAt: schema_1.buildings.createdAt,
                    updatedAt: schema_1.buildings.updatedAt,
                    organizationName: schema_1.organizations.name,
                    organizationType: schema_1.organizations.type,
                    residenceId: schema_1.residences.id,
                    unitNumber: schema_1.residences.unitNumber,
                    floor: schema_1.residences.floor,
                })
                    .from(schema_1.residences)
                    .innerJoin(schema_1.buildings, (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, schema_1.buildings.id))
                    .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)));
                // Add residence-based buildings (avoid duplicates)
                residenceBuildings.forEach((building) => {
                    if (!buildingIds.has(building.id)) {
                        buildingIds.add(building.id);
                        accessibleBuildings.push({
                            id: building.id,
                            name: building.name,
                            address: building.address,
                            city: building.city,
                            province: building.province,
                            postalCode: building.postalCode,
                            buildingType: building.buildingType,
                            yearBuilt: building.yearBuilt,
                            totalUnits: building.totalUnits,
                            totalFloors: building.totalFloors,
                            parkingSpaces: building.parkingSpaces,
                            storageSpaces: building.storageSpaces,
                            amenities: building.amenities,
                            managementCompany: building.managementCompany,
                            organizationId: building.organizationId,
                            isActive: building.isActive,
                            createdAt: building.createdAt,
                            updatedAt: building.updatedAt,
                            organizationName: building.organizationName,
                            organizationType: building.organizationType,
                            accessType: 'residence', // Track how user has access
                            userResidence: {
                                residenceId: building.residenceId,
                                unitNumber: building.unitNumber,
                                floor: building.floor,
                            },
                        });
                    }
                    else {
                        // Building already exists, but we might want to add residence info
                        const existingBuilding = accessibleBuildings.find((b) => b.id === building.id);
                        if (existingBuilding && !existingBuilding.userResidence) {
                            existingBuilding.userResidence = {
                                residenceId: building.residenceId,
                                unitNumber: building.unitNumber,
                                floor: building.floor,
                            };
                            // Update access type if this is from both organization and residence
                            if (existingBuilding.accessType === 'organization') {
                                existingBuilding.accessType = 'both';
                            }
                        }
                    }
                });
            }
            // Get statistics for each building
            const buildingsWithStats = await Promise.all(accessibleBuildings.map(async (building) => {
                // Get residence count
                const residenceCount = await db_1.db
                    .select({ count: (0, drizzle_orm_1.sql) `count(*)::int` })
                    .from(schema_1.residences)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, building.id), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
                // Calculate occupancy rate
                const occupiedUnits = residenceCount[0]?.count || 0;
                const occupancyRate = building.totalUnits > 0 ? Math.round((occupiedUnits / building.totalUnits) * 100) : 0;
                return {
                    ...building,
                    statistics: {
                        totalUnits: building.totalUnits,
                        occupiedUnits,
                        occupancyRate,
                        vacantUnits: building.totalUnits - occupiedUnits,
                    },
                };
            }));
            // Sort buildings by name
            buildingsWithStats.sort((a, b) => a.name.localeCompare(b.name));
            console.log(`‚úÖ Found ${buildingsWithStats.length} accessible buildings for user ${currentUser.id}`);
            res.json({
                buildings: buildingsWithStats,
                meta: {
                    total: buildingsWithStats.length,
                    userRole: currentUser.role,
                    userId: currentUser.id,
                },
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching manager buildings:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch buildings',
            });
        }
    });
    /**
     * GET /api/manager/buildings/:id - Get a specific building with detailed information
     * Uses the same access control logic as the list endpoint.
     */
    app.get('/api/manager/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user;
            const buildingId = req.params.id;
            if (!currentUser) {
                return res.status(401).json({
                    _error: 'Unauthorized',
                    message: 'Authentication required',
                });
            }
            console.log(`üìä Fetching building ${buildingId} for user ${currentUser.id} with role ${currentUser.role}`);
            let hasAccess = false;
            let accessType = '';
            // Check if user belongs to Koveo organization (special global access)
            const userOrgs = await db_1.db
                .select({
                organizationId: schema_1.userOrganizations.organizationId,
                organizationName: schema_1.organizations.name,
                canAccessAllOrganizations: schema_1.userOrganizations.canAccessAllOrganizations,
            })
                .from(schema_1.userOrganizations)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.userOrganizations.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userOrganizations.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)));
            const hasGlobalAccess = currentUser.role === 'admin' ||
                userOrgs.some((org) => org.organizationName === 'Koveo' || org.canAccessAllOrganizations);
            if (hasGlobalAccess) {
                hasAccess = true;
                accessType = 'global';
            }
            else {
                // Check organization-based access for Admin and Manager
                if (currentUser.role === 'admin' || currentUser.role === 'manager') {
                    if (userOrgs.length > 0) {
                        const orgIds = userOrgs.map((uo) => uo.organizationId);
                        // Check if building belongs to user's organizations
                        const buildingOrg = await db_1.db
                            .select({ id: schema_1.buildings.id })
                            .from(schema_1.buildings)
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.inArray)(schema_1.buildings.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)));
                        if (buildingOrg.length > 0) {
                            hasAccess = true;
                            accessType = 'organization';
                        }
                    }
                }
            }
            // Check residence-based access for all roles
            if (!hasAccess) {
                const userResidenceAccess = await db_1.db
                    .select({ residenceId: schema_1.userResidences.residenceId })
                    .from(schema_1.userResidences)
                    .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
                if (userResidenceAccess.length > 0) {
                    hasAccess = true;
                    accessType = accessType ? 'both' : 'residence';
                }
            }
            if (!hasAccess) {
                return res.status(403).json({
                    _error: 'Forbidden',
                    message: 'You do not have access to this building',
                });
            }
            // Get building details
            const buildingData = await db_1.db
                .select({
                id: schema_1.buildings.id,
                name: schema_1.buildings.name,
                address: schema_1.buildings.address,
                city: schema_1.buildings.city,
                province: schema_1.buildings.province,
                postalCode: schema_1.buildings.postalCode,
                buildingType: schema_1.buildings.buildingType,
                yearBuilt: schema_1.buildings.yearBuilt,
                totalUnits: schema_1.buildings.totalUnits,
                totalFloors: schema_1.buildings.totalFloors,
                parkingSpaces: schema_1.buildings.parkingSpaces,
                storageSpaces: schema_1.buildings.storageSpaces,
                amenities: schema_1.buildings.amenities,
                managementCompany: schema_1.buildings.managementCompany,
                organizationId: schema_1.buildings.organizationId,
                isActive: schema_1.buildings.isActive,
                createdAt: schema_1.buildings.createdAt,
                updatedAt: schema_1.buildings.updatedAt,
                organizationName: schema_1.organizations.name,
                organizationType: schema_1.organizations.type,
                organizationAddress: schema_1.organizations.address,
                organizationCity: schema_1.organizations.city,
                organizationPhone: schema_1.organizations.phone,
                organizationEmail: schema_1.organizations.email,
            })
                .from(schema_1.buildings)
                .innerJoin(schema_1.organizations, (0, drizzle_orm_1.eq)(schema_1.buildings.organizationId, schema_1.organizations.id))
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            if (buildingData.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            const building = buildingData[0];
            // Get all residences for this building
            const buildingResidences = await db_1.db
                .select({
                id: schema_1.residences.id,
                unitNumber: schema_1.residences.unitNumber,
                floor: schema_1.residences.floor,
                squareFootage: schema_1.residences.squareFootage,
                bedrooms: schema_1.residences.bedrooms,
                bathrooms: schema_1.residences.bathrooms,
                balcony: schema_1.residences.balcony,
                parkingSpaceNumbers: schema_1.residences.parkingSpaceNumbers,
                storageSpaceNumbers: schema_1.residences.storageSpaceNumbers,
                monthlyFees: schema_1.residences.monthlyFees,
                isActive: schema_1.residences.isActive,
            })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            // Get user's residences in this building if any
            let userResidencesInBuilding = [];
            const userResidenceRecords = await db_1.db
                .select({
                residenceId: schema_1.userResidences.residenceId,
                relationshipType: schema_1.userResidences.relationshipType,
                startDate: schema_1.userResidences.startDate,
                endDate: schema_1.userResidences.endDate,
            })
                .from(schema_1.userResidences)
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.userResidences.userId, currentUser.id), (0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)));
            if (userResidenceRecords.length > 0) {
                userResidencesInBuilding = userResidenceRecords.map((ur) => {
                    const residence = buildingResidences.find((r) => r.id === ur.residenceId);
                    return {
                        ...residence,
                        relationshipType: ur.relationshipType,
                        startDate: ur.startDate,
                        endDate: ur.endDate,
                    };
                });
            }
            // Calculate statistics
            const occupiedUnits = buildingResidences.length;
            const occupancyRate = building.totalUnits > 0 ? Math.round((occupiedUnits / building.totalUnits) * 100) : 0;
            res.json({
                ...building,
                accessType,
                statistics: {
                    totalUnits: building.totalUnits,
                    occupiedUnits,
                    occupancyRate,
                    vacantUnits: building.totalUnits - occupiedUnits,
                    totalResidences: buildingResidences.length,
                },
                userResidences: userResidencesInBuilding,
                // Only include full residence list for managers/admins
                residences: currentUser.role === 'admin' || currentUser.role === 'manager'
                    ? buildingResidences
                    : undefined,
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching building details:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to fetch building details',
            });
        }
    });
    /**
     * POST /api/admin/buildings - Create a new building (Admin only).
     */
    app.post('/api/admin/buildings', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingData = req.body;
            // Validate required fields
            if (!buildingData.name || !buildingData.organizationId) {
                return res.status(400).json({
                    _error: 'Validation error',
                    message: 'Building name and organization are required',
                });
            }
            // Create building with ID
            const buildingId = crypto_1.default.randomUUID();
            const newBuilding = await db_1.db
                .insert(schema_1.buildings)
                .values({
                id: buildingId,
                name: buildingData.name,
                address: buildingData.address || '',
                city: buildingData.city || '',
                province: buildingData.province || 'QC',
                postalCode: buildingData.postalCode || '',
                buildingType: buildingData.buildingType || 'condo',
                yearBuilt: buildingData.yearBuilt,
                totalUnits: buildingData.totalUnits || 0,
                totalFloors: buildingData.totalFloors,
                parkingSpaces: buildingData.parkingSpaces,
                storageSpaces: buildingData.storageSpaces,
                amenities: buildingData.amenities ? JSON.stringify(buildingData.amenities) : null,
                managementCompany: buildingData.managementCompany,
                organizationId: buildingData.organizationId,
                isActive: true,
                createdAt: new Date(),
                updatedAt: new Date(),
            })
                .returning();
            // Building storage hierarchy will be created automatically when documents are uploaded
            console.log('Building created - storage hierarchy will be created on first document upload');
            // Auto-generate residences if totalUnits is specified and <= 300
            if (buildingData.totalUnits &&
                buildingData.totalUnits > 0 &&
                buildingData.totalUnits <= 300) {
                try {
                    const totalUnits = buildingData.totalUnits;
                    const totalFloors = buildingData.totalFloors || 1;
                    const unitsPerFloor = Math.ceil(totalUnits / totalFloors);
                    const residencesToCreate = [];
                    for (let unit = 1; unit <= totalUnits; unit++) {
                        const floor = Math.ceil(unit / unitsPerFloor);
                        const unitOnFloor = ((unit - 1) % unitsPerFloor) + 1;
                        const unitNumber = `${floor}${unitOnFloor.toString().padStart(2, '0')}`;
                        residencesToCreate.push({
                            buildingId: buildingId,
                            unitNumber,
                            floor,
                            isActive: true,
                        });
                    }
                    // Insert all residences at once
                    const createdResidences = await db_1.db
                        .insert(schema_1.residences)
                        .values(residencesToCreate)
                        .returning();
                    console.log(`‚úÖ Auto-generated ${createdResidences.length} residences for building ${buildingId}`);
                    // TODO: Object storage service integration
                    // Create object storage hierarchy for each residence
                    // for (const residence of createdResidences) {
                    //   await objectStorageService.createResidenceHierarchy(
                    //     buildingData.organizationId,
                    //     buildingId,
                    //     residence.id
                    //   );
                    // }
                }
                catch (___residenceError) {
                    console.error('‚ö†Ô∏è Error auto-generating residences:', ___residenceError);
                    // Don't fail the building creation if residence generation fails
                }
            }
            res.status(201).json({
                message: 'Building created successfully',
                building: newBuilding[0],
            });
        }
        catch (error) {
            console.error('‚ùå Error creating building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to create building',
            });
        }
    });
    /**
     * GET /api/buildings/:id/residences-for-deletion - Get list of residences that can be selected for deletion
     * Only admins can access this endpoint
     */
    app.get('/api/buildings/:id/residences-for-deletion', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const buildingId = req.params.id;
            const maxToSelect = parseInt(req.query.maxToSelect) || 10;
            if (!user) {
                return res.status(401).json({ message: 'Authentication required' });
            }
            // Only admins can delete residences
            if (user.role !== 'admin') {
                return res.status(403).json({ message: 'Only admins can access residence deletion options' });
            }
            const { getResidencesForSelection } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
            const residencesToSelect = await getResidencesForSelection(buildingId, maxToSelect);
            res.json({
                residences: residencesToSelect,
                message: `Found ${residencesToSelect.length} residences available for deletion`
            });
        }
        catch (error) {
            console.error('‚ùå Error fetching residences for deletion:', error);
            res.status(500).json({ message: 'Failed to fetch residences for deletion' });
        }
    });
    /**
     * DELETE /api/buildings/:id/residences - Delete selected residences
     * Only admins can delete residences
     */
    app.delete('/api/buildings/:id/residences', auth_1.requireAuth, async (req, res) => {
        try {
            const user = req.user;
            const buildingId = req.params.id;
            const { residenceIds } = req.body;
            if (!user) {
                return res.status(401).json({ message: 'Authentication required' });
            }
            // Only admins can delete residences
            if (user.role !== 'admin') {
                return res.status(403).json({ message: 'Only admins can delete residences' });
            }
            if (!Array.isArray(residenceIds) || residenceIds.length === 0) {
                return res.status(400).json({ message: 'residenceIds array is required' });
            }
            const { deleteSelectedResidences } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
            const result = await deleteSelectedResidences(buildingId, residenceIds, user.role);
            res.json({
                success: true,
                deletedCount: result.deletedCount,
                documentsDeleted: result.documentsDeleted,
                message: `Successfully deleted ${result.deletedCount} residences and ${result.documentsDeleted} associated documents`
            });
        }
        catch (error) {
            console.error('‚ùå Error deleting residences:', error);
            res.status(500).json({ message: error.message || 'Failed to delete residences' });
        }
    });
    /**
     * PUT /api/admin/buildings/:id - Update a building (Admin and Manager).
     */
    app.put('/api/admin/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin or manager
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin' && currentUser.role !== 'manager') {
                return res.status(403).json({
                    message: 'Admin or Manager access required',
                    code: 'ADMIN_MANAGER_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            const buildingData = req.body;
            // Validate required fields
            if (!buildingData.name || !buildingData.organizationId) {
                return res.status(400).json({
                    _error: 'Validation error',
                    message: 'Building name and organization are required',
                });
            }
            // Check if building exists
            const existingBuilding = await db_1.db
                .select()
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (existingBuilding.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Check current number of active residences
            const currentResidences = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)::int` })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            const currentResidenceCount = currentResidences[0]?.count || 0;
            const newTotalUnits = buildingData.totalUnits || 0;
            const previousTotalUnits = existingBuilding[0].totalUnits || 0;
            console.log(`üîÑ Building ${buildingId}: ${previousTotalUnits} ‚Üí ${newTotalUnits} units (currently has ${currentResidenceCount} active residences)`);
            // Update building
            const updatedBuilding = await db_1.db
                .update(schema_1.buildings)
                .set({
                name: buildingData.name,
                address: buildingData.address || '',
                city: buildingData.city || '',
                province: buildingData.province || 'QC',
                postalCode: buildingData.postalCode || '',
                buildingType: buildingData.buildingType || 'condo',
                yearBuilt: buildingData.yearBuilt,
                totalUnits: newTotalUnits,
                totalFloors: buildingData.totalFloors,
                parkingSpaces: buildingData.parkingSpaces,
                storageSpaces: buildingData.storageSpaces,
                amenities: buildingData.amenities ? JSON.stringify(buildingData.amenities) : null,
                managementCompany: buildingData.managementCompany,
                organizationId: buildingData.organizationId,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .returning();
            // Handle residence count changes with new admin-only functionality
            if (newTotalUnits !== previousTotalUnits) {
                console.log(`üè† Building units changed from ${previousTotalUnits} to ${newTotalUnits}, adjusting residences...`);
                // Only admins can adjust residence counts
                if (currentUser.role !== 'admin') {
                    return res.status(403).json({
                        message: 'Only admins can increase or decrease building residence counts',
                        code: 'ADMIN_REQUIRED_FOR_RESIDENCE_CHANGES',
                    });
                }
                const { adjustResidenceCount } = await Promise.resolve().then(() => __importStar(require('./buildings/operations')));
                const adjustmentResult = await adjustResidenceCount(buildingId, existingBuilding[0].organizationId, newTotalUnits, previousTotalUnits, buildingData.totalFloors || existingBuilding[0].totalFloors || 1);
                // If residences need to be decreased, return the selection list to user
                if (adjustmentResult.action === 'decreased' && adjustmentResult.residencesToSelect) {
                    return res.json({
                        message: 'Building updated, but residence count needs to be reduced',
                        buildingUpdated: true,
                        needsResidenceSelection: true,
                        residencesToSelect: adjustmentResult.residencesToSelect,
                        instruction: `Please select ${previousTotalUnits - newTotalUnits} residences to delete from the list provided. Use DELETE /api/buildings/${buildingId}/residences with the selected residence IDs.`
                    });
                }
            }
            res.json({
                message: 'Building updated successfully',
                building: updatedBuilding[0],
            });
        }
        catch (error) {
            console.error('‚ùå Error updating building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to update building',
            });
        }
    });
    /**
     * DELETE /api/admin/buildings/:id - Delete a building (Admin only).
     */
    app.delete('/api/admin/buildings/:id', auth_1.requireAuth, async (req, res) => {
        try {
            // Check if user is admin
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const existingBuilding = await db_1.db
                .select()
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (existingBuilding.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Soft delete by setting isActive to false
            await db_1.db
                .update(schema_1.buildings)
                .set({
                isActive: false,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            // Object storage cleanup will be handled automatically
            console.log('Building deleted - storage cleanup will be handled automatically');
            res.json({
                message: 'Building deleted successfully',
            });
        }
        catch (error) {
            console.error('‚ùå Error deleting building:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to delete building',
            });
        }
    });
    /**
     * GET /api/admin/buildings/:id/deletion-impact - Get deletion impact analysis
     * Shows what will be deleted when removing a building.
     */
    app.get('/api/admin/buildings/:id/deletion-impact', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const building = await db_1.db
                .select({ id: schema_1.buildings.id, name: schema_1.buildings.name })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Count residences in this building
            const residencesCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema_1.residences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
            // Count documents associated with this building or its residences
            const documentsCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema_1.documents)
                .where((0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId), (0, drizzle_orm_1.sql) `${schema_1.documents.residenceId} IN (SELECT id FROM residences WHERE building_id = ${buildingId})`));
            // Count users who will become orphaned (only have relationships with residences in this building)
            const potentialOrphansCount = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(distinct ${schema_1.userResidences.userId})` })
                .from(schema_1.userResidences)
                .innerJoin(schema_1.residences, (0, drizzle_orm_1.eq)(schema_1.userResidences.residenceId, schema_1.residences.id))
                .innerJoin(schema_1.users, (0, drizzle_orm_1.eq)(schema_1.userResidences.userId, schema_1.users.id))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema_1.users.isActive, true)));
            const impact = {
                building: building[0],
                residences: residencesCount[0]?.count || 0,
                documents: documentsCount[0]?.count || 0,
                potentialOrphanedUsers: potentialOrphansCount[0]?.count || 0,
            };
            res.json(impact);
        }
        catch (error) {
            console.error('‚ùå Error analyzing deletion impact:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to analyze deletion impact',
            });
        }
    });
    /**
     * DELETE /api/admin/buildings/:id/cascade - Cascade delete a building
     * Replaces the simple delete with cascading delete that removes residences and documents. Users are preserved for data safety.
     */
    app.delete('/api/admin/buildings/:id/cascade', auth_1.requireAuth, async (req, res) => {
        try {
            const currentUser = req.user || req.session?.user;
            if (!currentUser) {
                return res.status(401).json({
                    message: 'Authentication required',
                    code: 'AUTH_REQUIRED',
                });
            }
            if (currentUser.role !== 'admin') {
                return res.status(403).json({
                    message: 'Admin access required',
                    code: 'ADMIN_REQUIRED',
                });
            }
            const buildingId = req.params.id;
            // Check if building exists
            const building = await db_1.db
                .select({ id: schema_1.buildings.id, name: schema_1.buildings.name })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId), (0, drizzle_orm_1.eq)(schema_1.buildings.isActive, true)))
                .limit(1);
            if (building.length === 0) {
                return res.status(404).json({
                    _error: 'Not found',
                    message: 'Building not found',
                });
            }
            // Start transaction for cascading delete
            await db_1.db.transaction(async (tx) => {
                // 1. Get all residences in this building
                const buildingResidences = await tx
                    .select({ id: schema_1.residences.id })
                    .from(schema_1.residences)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema_1.residences.isActive, true)));
                const residenceIds = buildingResidences.map((r) => r.id);
                if (residenceIds.length > 0) {
                    // 2. Delete documents associated with building or its residences
                    await tx
                        .delete(schema_1.documents)
                        .where((0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId), (0, drizzle_orm_1.inArray)(schema_1.documents.residenceId, residenceIds)));
                    // 3. Soft delete user-residence relationships
                    await tx
                        .update(schema_1.userResidences)
                        .set({ isActive: false, updatedAt: new Date() })
                        .where((0, drizzle_orm_1.inArray)(schema_1.userResidences.residenceId, residenceIds));
                    // 4. DISABLED: User deletion prohibited for data safety
                    const orphanedUsers = await tx
                        .select({ id: schema_1.users.id })
                        .from(schema_1.users)
                        .leftJoin(schema_1.userOrganizations, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userOrganizations.userId), (0, drizzle_orm_1.eq)(schema_1.userOrganizations.isActive, true)))
                        .leftJoin(schema_1.userResidences, (0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.id, schema_1.userResidences.userId), (0, drizzle_orm_1.eq)(schema_1.userResidences.isActive, true)))
                        .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema_1.users.isActive, true), (0, drizzle_orm_1.isNull)(schema_1.userOrganizations.userId), (0, drizzle_orm_1.isNull)(schema_1.userResidences.userId)));
                    if (orphanedUsers.length > 0) {
                        const orphanedUserIds = orphanedUsers.map((u) => u.id);
                        await tx
                            .update(schema_1.users)
                            .set({ isActive: false, updatedAt: new Date() })
                            .where((0, drizzle_orm_1.inArray)(schema_1.users.id, orphanedUserIds));
                    }
                    // 5. Soft delete residences
                    await tx
                        .update(schema_1.residences)
                        .set({ isActive: false, updatedAt: new Date() })
                        .where((0, drizzle_orm_1.inArray)(schema_1.residences.id, residenceIds));
                }
                else {
                    // Still delete documents associated directly with the building
                    await tx.delete(schema_1.documents).where((0, drizzle_orm_1.eq)(schema_1.documents.buildingId, buildingId));
                }
                // 6. Finally, soft delete the building
                await tx
                    .update(schema_1.buildings)
                    .set({ isActive: false, updatedAt: new Date() })
                    .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId));
            });
            // Clean up object storage hierarchy for the deleted building
            // Get organization ID from building before deletion
            const buildingOrg = await db_1.db
                .select({ organizationId: schema_1.buildings.organizationId })
                .from(schema_1.buildings)
                .where((0, drizzle_orm_1.eq)(schema_1.buildings.id, buildingId))
                .limit(1);
            if (buildingOrg.length > 0) {
                // Object storage cleanup will be handled automatically
                console.log('Building deleted - storage cleanup will be handled automatically');
            }
            res.json({
                message: 'Building and related entities deleted successfully',
                deletedBuilding: building[0].name,
            });
        }
        catch (error) {
            console.error('‚ùå Error during cascade delete:', error);
            res.status(500).json({
                _error: 'Internal server error',
                message: 'Failed to delete building and related entities',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2J1aWxkaW5ncy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW1LQSx3REFpeENDO0FBbjdDRCw4QkFBMkI7QUFDM0IsMkNBUXdCO0FBQ3hCLDZDQUF1RTtBQUN2RSxrQ0FBc0M7QUFDdEMsb0RBQTRCO0FBRTVCOztHQUVHO0FBQ0gsS0FBSyxVQUFVLHNCQUFzQixDQUNuQyxVQUFrQixFQUNsQixjQUFzQixFQUN0QixhQUFxQixFQUNyQixxQkFBNkIsRUFDN0IsV0FBb0I7SUFFcEIsSUFBSSxDQUFDO1FBQ0gscUZBQXFGO1FBRXJGLElBQUksYUFBYSxHQUFHLHFCQUFxQixFQUFFLENBQUM7WUFDMUMsaUNBQWlDO1lBQ2pDLE1BQU0sa0JBQWtCLEdBQUcsYUFBYSxHQUFHLHFCQUFxQixDQUFDO1lBRWpFLG9EQUFvRDtZQUNwRCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sT0FBRTtpQkFDaEMsTUFBTSxDQUFDLEVBQUUsVUFBVSxFQUFFLG1CQUFVLENBQUMsVUFBVSxFQUFFLENBQUM7aUJBQzdDLElBQUksQ0FBQyxtQkFBVSxDQUFDO2lCQUNoQixLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFFaEQsTUFBTSxtQkFBbUIsR0FBRyxJQUFJLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDO1lBRWpGLE1BQU0sTUFBTSxHQUFHLFdBQVcsSUFBSSxDQUFDLENBQUM7WUFDaEMsTUFBTSxhQUFhLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEdBQUcsTUFBTSxDQUFDLENBQUM7WUFFeEQsTUFBTSxhQUFhLEdBQUcsRUFBRSxDQUFDO1lBQ3pCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztZQUVwQixLQUFLLElBQUksY0FBYyxHQUFHLENBQUMsRUFBRSxjQUFjLEdBQUcsa0JBQWtCLEVBQUUsY0FBYyxFQUFFLEVBQUUsQ0FBQztnQkFDbkYsa0NBQWtDO2dCQUNsQyxPQUFPLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxDQUFDO29CQUN2RCxXQUFXLEVBQUUsQ0FBQztnQkFDaEIsQ0FBQztnQkFFRCxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxhQUFhLENBQUMsQ0FBQztnQkFDckQsTUFBTSxVQUFVLEdBQUcsV0FBVyxDQUFDLFFBQVEsRUFBRSxDQUFDO2dCQUUxQyxhQUFhLENBQUMsSUFBSSxDQUFDO29CQUNqQixVQUFVO29CQUNWLFVBQVU7b0JBQ1YsS0FBSyxFQUFFLEtBQUs7b0JBQ1osUUFBUSxFQUFFLElBQUk7aUJBQ2YsQ0FBQyxDQUFDO2dCQUVILG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztnQkFDcEMsV0FBVyxFQUFFLENBQUM7WUFDaEIsQ0FBQztZQUVELDZCQUE2QjtZQUM3QixJQUFJLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQzdCLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxPQUFFLENBQUMsTUFBTSxDQUFDLG1CQUFVLENBQUMsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBRXhGLHlEQUF5RDtnQkFDekQsS0FBSyxNQUFNLFNBQVMsSUFBSSxpQkFBaUIsRUFBRSxDQUFDO29CQUMxQyxJQUFJLENBQUM7d0JBQ0gsMkNBQTJDO3dCQUMzQyx1REFBdUQ7d0JBQ3ZELG9CQUFvQjt3QkFDcEIsZ0JBQWdCO3dCQUNoQixpQkFBaUI7d0JBQ2pCLEtBQUs7b0JBQ1AsQ0FBQztvQkFBQyxPQUFPLFlBQVksRUFBRSxDQUFDO3dCQUN0QixPQUFPLENBQUMsS0FBSyxDQUNYLHFEQUFxRCxTQUFTLENBQUMsRUFBRSxHQUFHLEVBQ3BFLFlBQVksQ0FDYixDQUFDO3dCQUNGLG9EQUFvRDtvQkFDdEQsQ0FBQztnQkFDSCxDQUFDO2dCQUVELE9BQU8sQ0FBQyxHQUFHLENBQ1QsYUFBYSxpQkFBaUIsQ0FBQyxNQUFNLGdDQUFnQyxVQUFVLEVBQUUsQ0FDbEYsQ0FBQztZQUNKLENBQUM7UUFDSCxDQUFDO2FBQU0sSUFBSSxhQUFhLEdBQUcscUJBQXFCLEVBQUUsQ0FBQztZQUNqRCxpQ0FBaUM7WUFDakMsTUFBTSxrQkFBa0IsR0FBRyxxQkFBcUIsR0FBRyxhQUFhLENBQUM7WUFDakUsT0FBTyxDQUFDLEdBQUcsQ0FDVCxjQUFjLGtCQUFrQix3Q0FBd0MsVUFBVSxFQUFFLENBQ3JGLENBQUM7WUFFRiwyRUFBMkU7WUFDM0UsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLE9BQUU7aUJBQ2pDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxtQkFBVSxDQUFDLEVBQUUsRUFBRSxVQUFVLEVBQUUsbUJBQVUsQ0FBQyxVQUFVLEVBQUUsQ0FBQztpQkFDaEUsSUFBSSxDQUFDLG1CQUFVLENBQUM7aUJBQ2hCLFFBQVEsQ0FDUCx1QkFBYyxFQUNkLElBQUEsaUJBQUcsRUFBQyxJQUFBLGdCQUFFLEVBQUMsdUJBQWMsQ0FBQyxXQUFXLEVBQUUsbUJBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsdUJBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FDdEY7aUJBQ0EsS0FBSyxDQUNKLElBQUEsaUJBQUcsRUFDRCxJQUFBLGdCQUFFLEVBQUMsbUJBQVUsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLEVBQ3JDLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFDN0IsSUFBQSxvQkFBTSxFQUFDLHVCQUFjLENBQUMsRUFBRSxDQUFDLENBQUMsK0JBQStCO2FBQzFELENBQ0Y7aUJBQ0EsT0FBTyxDQUFDLElBQUEsaUJBQUcsRUFBQSxHQUFHLG1CQUFVLENBQUMsVUFBVSxnQkFBZ0IsQ0FBQyxDQUFDLG9DQUFvQztpQkFDekYsS0FBSyxDQUFDLGtCQUFrQixDQUFDLENBQUM7WUFFN0IsSUFBSSxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7Z0JBQ25DLE1BQU0sb0JBQW9CLEdBQUcsbUJBQW1CLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBRWxFLDRDQUE0QztnQkFDNUMsTUFBTSxPQUFFO3FCQUNMLE1BQU0sQ0FBQyxtQkFBVSxDQUFDO3FCQUNsQixHQUFHLENBQUM7b0JBQ0gsUUFBUSxFQUFFLEtBQUs7b0JBQ2YsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2lCQUN0QixDQUFDO3FCQUNELEtBQUssQ0FBQyxJQUFBLHFCQUFPLEVBQUMsbUJBQVUsQ0FBQyxFQUFFLEVBQUUsb0JBQW9CLENBQUMsQ0FBQyxDQUFDO2dCQUV2RCxPQUFPLENBQUMsR0FBRyxDQUNULFlBQVksbUJBQW1CLENBQUMsTUFBTSx3Q0FBd0MsVUFBVSxFQUFFLENBQzNGLENBQUM7Z0JBRUYscUVBQXFFO2dCQUNyRSxNQUFNLGNBQWMsR0FBRyxrQkFBa0IsR0FBRyxtQkFBbUIsQ0FBQyxNQUFNLENBQUM7Z0JBQ3ZFLElBQUksY0FBYyxHQUFHLENBQUMsRUFBRSxDQUFDO29CQUN2QixPQUFPLENBQUMsR0FBRyxDQUNULHVCQUF1QixjQUFjLG1EQUFtRCxDQUN6RixDQUFDO2dCQUNKLENBQUM7WUFDSCxDQUFDO2lCQUFNLENBQUM7WUFDUixDQUFDO1FBQ0gsQ0FBQzthQUFNLENBQUM7WUFDTixPQUFPLENBQUMsR0FBRyxDQUNULDRDQUE0QyxVQUFVLGdCQUFnQixxQkFBcUIsYUFBYSxDQUN6RyxDQUFDO1FBQ0osQ0FBQztRQUNELDhEQUE4RDtJQUNoRSxDQUFDO0lBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztRQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLG1DQUFtQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzFELDhEQUE4RDtJQUNoRSxDQUFDO0FBQ0gsQ0FBQztBQUVEOzs7R0FHRztBQUNIOzs7O0dBSUc7QUFDSCxTQUFnQixzQkFBc0IsQ0FBQyxHQUFZO0lBQ2pEOzs7Ozs7OztPQVFHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDN0QsSUFBSSxDQUFDO1lBQ0gsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUV0QixJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ1YsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLHlCQUF5QjtvQkFDbEMsSUFBSSxFQUFFLGVBQWU7aUJBQ3RCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCwwQ0FBMEM7WUFDMUMsSUFDRSxDQUFDO2dCQUNDLE9BQU87Z0JBQ1AsU0FBUztnQkFDVCxjQUFjO2dCQUNkLGFBQWE7Z0JBQ2IsZUFBZTtnQkFDZixRQUFRO2dCQUNSLFVBQVU7YUFDWCxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEVBQ3JCLENBQUM7Z0JBQ0QsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLDBDQUEwQztvQkFDbkQsSUFBSSxFQUFFLDBCQUEwQjtpQkFDakMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLEVBQUU7Z0JBQzFELEVBQUUsRUFBRSxJQUFJLENBQUMsRUFBRTtnQkFDWCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUk7Z0JBQ2YsYUFBYSxFQUFFLElBQUksQ0FBQyxhQUFhO2dCQUNqQyx5QkFBeUIsRUFBRSxJQUFJLENBQUMseUJBQXlCO2FBQzFELENBQUMsQ0FBQztZQUVILElBQUksY0FBYyxDQUFDO1lBRW5CLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxPQUFPLElBQUksSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7Z0JBQzVELGlEQUFpRDtnQkFDakQsY0FBYyxHQUFHLE9BQUU7cUJBQ2hCLE1BQU0sQ0FBQztvQkFDTixFQUFFLEVBQUUsa0JBQVMsQ0FBQyxFQUFFO29CQUNoQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJO29CQUNwQixPQUFPLEVBQUUsa0JBQVMsQ0FBQyxPQUFPO29CQUMxQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJO29CQUNwQixRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFRO29CQUM1QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVO29CQUNoQyxZQUFZLEVBQUUsa0JBQVMsQ0FBQyxZQUFZO29CQUNwQyxTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVO29CQUNoQyxXQUFXLEVBQUUsa0JBQVMsQ0FBQyxXQUFXO29CQUNsQyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhO29CQUN0QyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhO29CQUN0QyxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjO29CQUN4QyxRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFRO29CQUM1QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7aUJBQ3JDLENBQUM7cUJBQ0QsSUFBSSxDQUFDLGtCQUFTLENBQUM7cUJBQ2YsU0FBUyxDQUFDLHNCQUFhLEVBQUUsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLHNCQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3hFLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUM7cUJBQ25DLE9BQU8sQ0FBQyxzQkFBYSxDQUFDLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2pELENBQUM7aUJBQU0sQ0FBQztnQkFDTixrRkFBa0Y7Z0JBQ2xGLE9BQU8sQ0FBQyxHQUFHLENBQ1QsZ0RBQWdELElBQUksQ0FBQyxFQUFFLGlCQUFpQixFQUN4RSxJQUFJLENBQUMsYUFBYSxDQUNuQixDQUFDO2dCQUNGLElBQUksQ0FBQyxJQUFJLENBQUMsYUFBYSxJQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO29CQUMzRCxPQUFPLENBQUMsR0FBRyxDQUNULDZCQUE2QixJQUFJLENBQUMsRUFBRSxxREFBcUQsQ0FDMUYsQ0FBQztvQkFFRixvRUFBb0U7b0JBQ3BFLElBQUksQ0FBQyxRQUFRLEVBQUUsVUFBVSxFQUFFLGFBQWEsRUFBRSxlQUFlLENBQUMsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7d0JBQy9FLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxPQUFFOzZCQUNoQyxNQUFNLENBQUM7NEJBQ04sVUFBVSxFQUFFLG1CQUFVLENBQUMsVUFBVTt5QkFDbEMsQ0FBQzs2QkFDRCxJQUFJLENBQUMsdUJBQWMsQ0FBQzs2QkFDcEIsU0FBUyxDQUFDLG1CQUFVLEVBQUUsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsV0FBVyxFQUFFLG1CQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7NkJBQ3BFLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsTUFBTSxFQUFFLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsdUJBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO3dCQUVyRixPQUFPLENBQUMsR0FBRyxDQUNULDhCQUE4QixrQkFBa0IsQ0FBQyxNQUFNLHdCQUF3QixJQUFJLENBQUMsRUFBRSxFQUFFLENBQ3pGLENBQUM7d0JBRUYsSUFBSSxrQkFBa0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7NEJBQ3BDLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLCtCQUErQjt3QkFDdEQsQ0FBQzt3QkFFRCxNQUFNLHFCQUFxQixHQUFHOzRCQUM1QixHQUFHLElBQUksR0FBRyxDQUFDLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDO3lCQUMxRCxDQUFDO3dCQUNGLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0NBQStDLEVBQUUscUJBQXFCLENBQUMsQ0FBQzt3QkFFcEYsY0FBYyxHQUFHLE9BQUU7NkJBQ2hCLE1BQU0sQ0FBQzs0QkFDTixFQUFFLEVBQUUsa0JBQVMsQ0FBQyxFQUFFOzRCQUNoQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJOzRCQUNwQixPQUFPLEVBQUUsa0JBQVMsQ0FBQyxPQUFPOzRCQUMxQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJOzRCQUNwQixRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFROzRCQUM1QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVOzRCQUNoQyxZQUFZLEVBQUUsa0JBQVMsQ0FBQyxZQUFZOzRCQUNwQyxTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTOzRCQUM5QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVOzRCQUNoQyxXQUFXLEVBQUUsa0JBQVMsQ0FBQyxXQUFXOzRCQUNsQyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhOzRCQUN0QyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhOzRCQUN0QyxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjOzRCQUN4QyxRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFROzRCQUM1QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTOzRCQUM5QixnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7eUJBQ3JDLENBQUM7NkJBQ0QsSUFBSSxDQUFDLGtCQUFTLENBQUM7NkJBQ2YsU0FBUyxDQUFDLHNCQUFhLEVBQUUsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLHNCQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7NkJBQ3hFLEtBQUssQ0FDSixJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLElBQUEscUJBQU8sRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxxQkFBcUIsQ0FBQyxDQUFDLENBQ2hGOzZCQUNBLE9BQU8sQ0FBQyxzQkFBYSxDQUFDLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUksQ0FBQyxDQUFDO29CQUNqRCxDQUFDO3lCQUFNLENBQUM7d0JBQ04sT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsc0RBQXNEO29CQUM3RSxDQUFDO2dCQUNILENBQUM7cUJBQU0sQ0FBQztvQkFDTix5REFBeUQ7b0JBQ3pELGNBQWMsR0FBRyxPQUFFO3lCQUNoQixNQUFNLENBQUM7d0JBQ04sRUFBRSxFQUFFLGtCQUFTLENBQUMsRUFBRTt3QkFDaEIsSUFBSSxFQUFFLGtCQUFTLENBQUMsSUFBSTt3QkFDcEIsT0FBTyxFQUFFLGtCQUFTLENBQUMsT0FBTzt3QkFDMUIsSUFBSSxFQUFFLGtCQUFTLENBQUMsSUFBSTt3QkFDcEIsUUFBUSxFQUFFLGtCQUFTLENBQUMsUUFBUTt3QkFDNUIsVUFBVSxFQUFFLGtCQUFTLENBQUMsVUFBVTt3QkFDaEMsWUFBWSxFQUFFLGtCQUFTLENBQUMsWUFBWTt3QkFDcEMsU0FBUyxFQUFFLGtCQUFTLENBQUMsU0FBUzt3QkFDOUIsVUFBVSxFQUFFLGtCQUFTLENBQUMsVUFBVTt3QkFDaEMsV0FBVyxFQUFFLGtCQUFTLENBQUMsV0FBVzt3QkFDbEMsYUFBYSxFQUFFLGtCQUFTLENBQUMsYUFBYTt3QkFDdEMsYUFBYSxFQUFFLGtCQUFTLENBQUMsYUFBYTt3QkFDdEMsY0FBYyxFQUFFLGtCQUFTLENBQUMsY0FBYzt3QkFDeEMsUUFBUSxFQUFFLGtCQUFTLENBQUMsUUFBUTt3QkFDNUIsU0FBUyxFQUFFLGtCQUFTLENBQUMsU0FBUzt3QkFDOUIsZ0JBQWdCLEVBQUUsc0JBQWEsQ0FBQyxJQUFJO3FCQUNyQyxDQUFDO3lCQUNELElBQUksQ0FBQyxrQkFBUyxDQUFDO3lCQUNmLFNBQVMsQ0FBQyxzQkFBYSxFQUFFLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLGNBQWMsRUFBRSxzQkFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3lCQUN4RSxLQUFLLENBQ0osSUFBQSxpQkFBRyxFQUNELElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFDNUIsSUFBQSxxQkFBTyxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLElBQUksQ0FBQyxhQUFhLENBQUMsQ0FDdEQsQ0FDRjt5QkFDQSxPQUFPLENBQUMsc0JBQWEsQ0FBQyxJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDakQsQ0FBQztZQUNILENBQUM7WUFFRCxNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQztZQUVwQyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsNkJBQTZCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDcEQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSx1QkFBdUI7Z0JBQy9CLE9BQU8sRUFBRSwyQkFBMkI7YUFDckMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7Ozs7Ozs7T0FPRztJQUNILEdBQUcsQ0FBQyxHQUFHLENBQUMsd0JBQXdCLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN4RCx1QkFBdUI7UUFDdkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsTUFBTSxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUMvQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUMxQixPQUFPLEVBQUUseUJBQXlCO2dCQUNsQyxJQUFJLEVBQUUsZUFBZTthQUN0QixDQUFDLENBQUM7UUFDTCxDQUFDO1FBRUQsSUFBSSxDQUFDO1lBQ0gsb0NBQW9DO1lBQ3BDLElBQUksV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM7WUFFaEQsb0RBQW9EO1lBQ3BELElBQUksQ0FBQyxXQUFXLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRSxNQUFNLEVBQUUsQ0FBQztnQkFDeEMsNkNBQTZDO2dCQUM3QyxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsd0RBQWEsWUFBWSxHQUFDLENBQUM7Z0JBQy9DLFdBQVcsR0FBRyxNQUFNLE9BQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUMxRCxDQUFDO1lBRUQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNqQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsZ0JBQWdCO29CQUN6QixJQUFJLEVBQUUsZ0JBQWdCO2lCQUN2QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsT0FBTyxDQUFDLEdBQUcsQ0FDVCxrQ0FBa0MsV0FBVyxDQUFDLEVBQUUsY0FBYyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQ2pGLENBQUM7WUFFRixNQUFNLG1CQUFtQixHQUFVLEVBQUUsQ0FBQztZQUN0QyxNQUFNLFdBQVcsR0FBRyxJQUFJLEdBQUcsRUFBVSxDQUFDO1lBRXRDLHNFQUFzRTtZQUN0RSxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQUU7aUJBQ3RCLE1BQU0sQ0FBQztnQkFDTixjQUFjLEVBQUUsMEJBQWlCLENBQUMsY0FBYztnQkFDaEQsZ0JBQWdCLEVBQUUsc0JBQWEsQ0FBQyxJQUFJO2dCQUNwQyx5QkFBeUIsRUFBRSwwQkFBaUIsQ0FBQyx5QkFBeUI7YUFDdkUsQ0FBQztpQkFDRCxJQUFJLENBQUMsMEJBQWlCLENBQUM7aUJBQ3ZCLFNBQVMsQ0FBQyxzQkFBYSxFQUFFLElBQUEsZ0JBQUUsRUFBQywwQkFBaUIsQ0FBQyxjQUFjLEVBQUUsc0JBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDaEYsS0FBSyxDQUNKLElBQUEsaUJBQUcsRUFBQyxJQUFBLGdCQUFFLEVBQUMsMEJBQWlCLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsMEJBQWlCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQ3hGLENBQUM7WUFFSixNQUFNLGVBQWUsR0FDbkIsV0FBVyxDQUFDLElBQUksS0FBSyxPQUFPO2dCQUM1QixRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEtBQUssT0FBTyxJQUFJLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBRTVGLElBQUksZUFBZSxFQUFFLENBQUM7Z0JBQ3BCLE9BQU8sQ0FBQyxHQUFHLENBQ1Qsc0ZBQXNGLENBQ3ZGLENBQUM7Z0JBRUYsMkRBQTJEO2dCQUMzRCxNQUFNLFlBQVksR0FBRyxNQUFNLE9BQUU7cUJBQzFCLE1BQU0sQ0FBQztvQkFDTixFQUFFLEVBQUUsa0JBQVMsQ0FBQyxFQUFFO29CQUNoQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJO29CQUNwQixPQUFPLEVBQUUsa0JBQVMsQ0FBQyxPQUFPO29CQUMxQixJQUFJLEVBQUUsa0JBQVMsQ0FBQyxJQUFJO29CQUNwQixRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFRO29CQUM1QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVO29CQUNoQyxZQUFZLEVBQUUsa0JBQVMsQ0FBQyxZQUFZO29CQUNwQyxTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixVQUFVLEVBQUUsa0JBQVMsQ0FBQyxVQUFVO29CQUNoQyxXQUFXLEVBQUUsa0JBQVMsQ0FBQyxXQUFXO29CQUNsQyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhO29CQUN0QyxhQUFhLEVBQUUsa0JBQVMsQ0FBQyxhQUFhO29CQUN0QyxTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixpQkFBaUIsRUFBRSxrQkFBUyxDQUFDLGlCQUFpQjtvQkFDOUMsY0FBYyxFQUFFLGtCQUFTLENBQUMsY0FBYztvQkFDeEMsUUFBUSxFQUFFLGtCQUFTLENBQUMsUUFBUTtvQkFDNUIsU0FBUyxFQUFFLGtCQUFTLENBQUMsU0FBUztvQkFDOUIsU0FBUyxFQUFFLGtCQUFTLENBQUMsU0FBUztvQkFDOUIsZ0JBQWdCLEVBQUUsc0JBQWEsQ0FBQyxJQUFJO29CQUNwQyxnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7aUJBQ3JDLENBQUM7cUJBQ0QsSUFBSSxDQUFDLGtCQUFTLENBQUM7cUJBQ2YsU0FBUyxDQUFDLHNCQUFhLEVBQUUsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLHNCQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3hFLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUM7cUJBQ25DLE9BQU8sQ0FBQyxzQkFBYSxDQUFDLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUUvQyxtREFBbUQ7Z0JBQ25ELFlBQVksQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLEVBQUUsRUFBRTtvQkFDaEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUM7d0JBQ2xDLFdBQVcsQ0FBQyxHQUFHLENBQUMsUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3dCQUM3QixtQkFBbUIsQ0FBQyxJQUFJLENBQUM7NEJBQ3ZCLEdBQUcsUUFBUTs0QkFDWCxVQUFVLEVBQUUsY0FBYyxFQUFFLHNDQUFzQzt5QkFDbkUsQ0FBQyxDQUFDO29CQUNMLENBQUM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDO2lCQUFNLENBQUM7Z0JBQ04sMEZBQTBGO2dCQUMxRixJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssT0FBTyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7b0JBQ25FLElBQUksUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQzt3QkFDeEIsTUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxDQUFDLGNBQWMsQ0FBQyxDQUFDO3dCQUV2RCxrREFBa0Q7d0JBQ2xELE1BQU0sWUFBWSxHQUFHLE1BQU0sT0FBRTs2QkFDMUIsTUFBTSxDQUFDOzRCQUNOLEVBQUUsRUFBRSxrQkFBUyxDQUFDLEVBQUU7NEJBQ2hCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7NEJBQ3BCLE9BQU8sRUFBRSxrQkFBUyxDQUFDLE9BQU87NEJBQzFCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7NEJBQ3BCLFFBQVEsRUFBRSxrQkFBUyxDQUFDLFFBQVE7NEJBQzVCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7NEJBQ2hDLFlBQVksRUFBRSxrQkFBUyxDQUFDLFlBQVk7NEJBQ3BDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7NEJBQzlCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7NEJBQ2hDLFdBQVcsRUFBRSxrQkFBUyxDQUFDLFdBQVc7NEJBQ2xDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7NEJBQ3RDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7NEJBQ3RDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7NEJBQzlCLGlCQUFpQixFQUFFLGtCQUFTLENBQUMsaUJBQWlCOzRCQUM5QyxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjOzRCQUN4QyxRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFROzRCQUM1QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTOzRCQUM5QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTOzRCQUM5QixnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7NEJBQ3BDLGdCQUFnQixFQUFFLHNCQUFhLENBQUMsSUFBSTt5QkFDckMsQ0FBQzs2QkFDRCxJQUFJLENBQUMsa0JBQVMsQ0FBQzs2QkFDZixTQUFTLENBQUMsc0JBQWEsRUFBRSxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxjQUFjLEVBQUUsc0JBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQzs2QkFDeEUsS0FBSyxDQUFDLElBQUEsaUJBQUcsRUFBQyxJQUFBLHFCQUFPLEVBQUMsa0JBQVMsQ0FBQyxjQUFjLEVBQUUsTUFBTSxDQUFDLEVBQUUsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQzt3QkFFdkYsWUFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFOzRCQUNoQyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztnQ0FDbEMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7Z0NBQzdCLG1CQUFtQixDQUFDLElBQUksQ0FBQztvQ0FDdkIsR0FBRyxRQUFRO29DQUNYLFVBQVUsRUFBRSxjQUFjLEVBQUUsNEJBQTRCO2lDQUN6RCxDQUFDLENBQUM7NEJBQ0wsQ0FBQzt3QkFDSCxDQUFDLENBQUMsQ0FBQztvQkFDTCxDQUFDO2dCQUNILENBQUM7WUFDSCxDQUFDO1lBRUQsd0ZBQXdGO1lBQ3hGLDJGQUEyRjtZQUMzRixNQUFNLG9CQUFvQixHQUFHLE1BQU0sT0FBRTtpQkFDbEMsTUFBTSxDQUFDO2dCQUNOLFdBQVcsRUFBRSx1QkFBYyxDQUFDLFdBQVc7Z0JBQ3ZDLGdCQUFnQixFQUFFLHVCQUFjLENBQUMsZ0JBQWdCO2FBQ2xELENBQUM7aUJBQ0QsSUFBSSxDQUFDLHVCQUFjLENBQUM7aUJBQ3BCLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsdUJBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRTVGLElBQUksb0JBQW9CLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUNwQyxNQUFNLFlBQVksR0FBRyxvQkFBb0IsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxXQUFXLENBQUMsQ0FBQztnQkFFdEUsbUNBQW1DO2dCQUNuQyxNQUFNLGtCQUFrQixHQUFHLE1BQU0sT0FBRTtxQkFDaEMsTUFBTSxDQUFDO29CQUNOLEVBQUUsRUFBRSxrQkFBUyxDQUFDLEVBQUU7b0JBQ2hCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7b0JBQ3BCLE9BQU8sRUFBRSxrQkFBUyxDQUFDLE9BQU87b0JBQzFCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7b0JBQ3BCLFFBQVEsRUFBRSxrQkFBUyxDQUFDLFFBQVE7b0JBQzVCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7b0JBQ2hDLFlBQVksRUFBRSxrQkFBUyxDQUFDLFlBQVk7b0JBQ3BDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7b0JBQzlCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7b0JBQ2hDLFdBQVcsRUFBRSxrQkFBUyxDQUFDLFdBQVc7b0JBQ2xDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7b0JBQ3RDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7b0JBQ3RDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7b0JBQzlCLGlCQUFpQixFQUFFLGtCQUFTLENBQUMsaUJBQWlCO29CQUM5QyxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjO29CQUN4QyxRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFRO29CQUM1QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO29CQUM5QixnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7b0JBQ3BDLGdCQUFnQixFQUFFLHNCQUFhLENBQUMsSUFBSTtvQkFDcEMsV0FBVyxFQUFFLG1CQUFVLENBQUMsRUFBRTtvQkFDMUIsVUFBVSxFQUFFLG1CQUFVLENBQUMsVUFBVTtvQkFDakMsS0FBSyxFQUFFLG1CQUFVLENBQUMsS0FBSztpQkFDeEIsQ0FBQztxQkFDRCxJQUFJLENBQUMsbUJBQVUsQ0FBQztxQkFDaEIsU0FBUyxDQUFDLGtCQUFTLEVBQUUsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLGtCQUFTLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQzdELFNBQVMsQ0FBQyxzQkFBYSxFQUFFLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLGNBQWMsRUFBRSxzQkFBYSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3FCQUN4RSxLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFDLElBQUEscUJBQU8sRUFBQyxtQkFBVSxDQUFDLEVBQUUsRUFBRSxZQUFZLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUVsRixtREFBbUQ7Z0JBQ25ELGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsRUFBRSxFQUFFO29CQUN0QyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQzt3QkFDbEMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7d0JBQzdCLG1CQUFtQixDQUFDLElBQUksQ0FBQzs0QkFDdkIsRUFBRSxFQUFFLFFBQVEsQ0FBQyxFQUFFOzRCQUNmLElBQUksRUFBRSxRQUFRLENBQUMsSUFBSTs0QkFDbkIsT0FBTyxFQUFFLFFBQVEsQ0FBQyxPQUFPOzRCQUN6QixJQUFJLEVBQUUsUUFBUSxDQUFDLElBQUk7NEJBQ25CLFFBQVEsRUFBRSxRQUFRLENBQUMsUUFBUTs0QkFDM0IsVUFBVSxFQUFFLFFBQVEsQ0FBQyxVQUFVOzRCQUMvQixZQUFZLEVBQUUsUUFBUSxDQUFDLFlBQVk7NEJBQ25DLFNBQVMsRUFBRSxRQUFRLENBQUMsU0FBUzs0QkFDN0IsVUFBVSxFQUFFLFFBQVEsQ0FBQyxVQUFVOzRCQUMvQixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7NEJBQ2pDLGFBQWEsRUFBRSxRQUFRLENBQUMsYUFBYTs0QkFDckMsYUFBYSxFQUFFLFFBQVEsQ0FBQyxhQUFhOzRCQUNyQyxTQUFTLEVBQUUsUUFBUSxDQUFDLFNBQVM7NEJBQzdCLGlCQUFpQixFQUFFLFFBQVEsQ0FBQyxpQkFBaUI7NEJBQzdDLGNBQWMsRUFBRSxRQUFRLENBQUMsY0FBYzs0QkFDdkMsUUFBUSxFQUFFLFFBQVEsQ0FBQyxRQUFROzRCQUMzQixTQUFTLEVBQUUsUUFBUSxDQUFDLFNBQVM7NEJBQzdCLFNBQVMsRUFBRSxRQUFRLENBQUMsU0FBUzs0QkFDN0IsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLGdCQUFnQjs0QkFDM0MsZ0JBQWdCLEVBQUUsUUFBUSxDQUFDLGdCQUFnQjs0QkFDM0MsVUFBVSxFQUFFLFdBQVcsRUFBRSw0QkFBNEI7NEJBQ3JELGFBQWEsRUFBRTtnQ0FDYixXQUFXLEVBQUUsUUFBUSxDQUFDLFdBQVc7Z0NBQ2pDLFVBQVUsRUFBRSxRQUFRLENBQUMsVUFBVTtnQ0FDL0IsS0FBSyxFQUFFLFFBQVEsQ0FBQyxLQUFLOzZCQUN0Qjt5QkFDRixDQUFDLENBQUM7b0JBQ0wsQ0FBQzt5QkFBTSxDQUFDO3dCQUNOLG1FQUFtRTt3QkFDbkUsTUFBTSxnQkFBZ0IsR0FBRyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssUUFBUSxDQUFDLEVBQUUsQ0FBQyxDQUFDO3dCQUMvRSxJQUFJLGdCQUFnQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxFQUFFLENBQUM7NEJBQ3hELGdCQUFnQixDQUFDLGFBQWEsR0FBRztnQ0FDL0IsV0FBVyxFQUFFLFFBQVEsQ0FBQyxXQUFXO2dDQUNqQyxVQUFVLEVBQUUsUUFBUSxDQUFDLFVBQVU7Z0NBQy9CLEtBQUssRUFBRSxRQUFRLENBQUMsS0FBSzs2QkFDdEIsQ0FBQzs0QkFDRixxRUFBcUU7NEJBQ3JFLElBQUksZ0JBQWdCLENBQUMsVUFBVSxLQUFLLGNBQWMsRUFBRSxDQUFDO2dDQUNuRCxnQkFBZ0IsQ0FBQyxVQUFVLEdBQUcsTUFBTSxDQUFDOzRCQUN2QyxDQUFDO3dCQUNILENBQUM7b0JBQ0gsQ0FBQztnQkFDSCxDQUFDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxtQ0FBbUM7WUFDbkMsTUFBTSxrQkFBa0IsR0FBRyxNQUFNLE9BQU8sQ0FBQyxHQUFHLENBQzFDLG1CQUFtQixDQUFDLEdBQUcsQ0FBQyxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUU7Z0JBQ3pDLHNCQUFzQjtnQkFDdEIsTUFBTSxjQUFjLEdBQUcsTUFBTSxPQUFFO3FCQUM1QixNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsSUFBQSxpQkFBRyxFQUFRLGVBQWUsRUFBRSxDQUFDO3FCQUM3QyxJQUFJLENBQUMsbUJBQVUsQ0FBQztxQkFDaEIsS0FBSyxDQUFDLElBQUEsaUJBQUcsRUFBQyxJQUFBLGdCQUFFLEVBQUMsbUJBQVUsQ0FBQyxVQUFVLEVBQUUsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXJGLDJCQUEyQjtnQkFDM0IsTUFBTSxhQUFhLEdBQUcsY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDLENBQUM7Z0JBQ3BELE1BQU0sYUFBYSxHQUNqQixRQUFRLENBQUMsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLGFBQWEsR0FBRyxRQUFRLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFFeEYsT0FBTztvQkFDTCxHQUFHLFFBQVE7b0JBQ1gsVUFBVSxFQUFFO3dCQUNWLFVBQVUsRUFBRSxRQUFRLENBQUMsVUFBVTt3QkFDL0IsYUFBYTt3QkFDYixhQUFhO3dCQUNiLFdBQVcsRUFBRSxRQUFRLENBQUMsVUFBVSxHQUFHLGFBQWE7cUJBQ2pEO2lCQUNGLENBQUM7WUFDSixDQUFDLENBQUMsQ0FDSCxDQUFDO1lBRUYseUJBQXlCO1lBQ3pCLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBRWhFLE9BQU8sQ0FBQyxHQUFHLENBQ1QsV0FBVyxrQkFBa0IsQ0FBQyxNQUFNLGtDQUFrQyxXQUFXLENBQUMsRUFBRSxFQUFFLENBQ3ZGLENBQUM7WUFFRixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLFNBQVMsRUFBRSxrQkFBa0I7Z0JBQzdCLElBQUksRUFBRTtvQkFDSixLQUFLLEVBQUUsa0JBQWtCLENBQUMsTUFBTTtvQkFDaEMsUUFBUSxFQUFFLFdBQVcsQ0FBQyxJQUFJO29CQUMxQixNQUFNLEVBQUUsV0FBVyxDQUFDLEVBQUU7aUJBQ3ZCO2FBQ0YsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxxQ0FBcUMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM1RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsTUFBTSxFQUFFLHVCQUF1QjtnQkFDL0IsT0FBTyxFQUFFLDJCQUEyQjthQUNyQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLDRCQUE0QixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN6RSxJQUFJLENBQUM7WUFDSCxNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBQzdCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBRWpDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsTUFBTSxFQUFFLGNBQWM7b0JBQ3RCLE9BQU8sRUFBRSx5QkFBeUI7aUJBQ25DLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxPQUFPLENBQUMsR0FBRyxDQUNULHdCQUF3QixVQUFVLGFBQWEsV0FBVyxDQUFDLEVBQUUsY0FBYyxXQUFXLENBQUMsSUFBSSxFQUFFLENBQzlGLENBQUM7WUFFRixJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFDdEIsSUFBSSxVQUFVLEdBQUcsRUFBRSxDQUFDO1lBRXBCLHNFQUFzRTtZQUN0RSxNQUFNLFFBQVEsR0FBRyxNQUFNLE9BQUU7aUJBQ3RCLE1BQU0sQ0FBQztnQkFDTixjQUFjLEVBQUUsMEJBQWlCLENBQUMsY0FBYztnQkFDaEQsZ0JBQWdCLEVBQUUsc0JBQWEsQ0FBQyxJQUFJO2dCQUNwQyx5QkFBeUIsRUFBRSwwQkFBaUIsQ0FBQyx5QkFBeUI7YUFDdkUsQ0FBQztpQkFDRCxJQUFJLENBQUMsMEJBQWlCLENBQUM7aUJBQ3ZCLFNBQVMsQ0FBQyxzQkFBYSxFQUFFLElBQUEsZ0JBQUUsRUFBQywwQkFBaUIsQ0FBQyxjQUFjLEVBQUUsc0JBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDaEYsS0FBSyxDQUNKLElBQUEsaUJBQUcsRUFBQyxJQUFBLGdCQUFFLEVBQUMsMEJBQWlCLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsMEJBQWlCLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQ3hGLENBQUM7WUFFSixNQUFNLGVBQWUsR0FDbkIsV0FBVyxDQUFDLElBQUksS0FBSyxPQUFPO2dCQUM1QixRQUFRLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEtBQUssT0FBTyxJQUFJLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBRTVGLElBQUksZUFBZSxFQUFFLENBQUM7Z0JBQ3BCLFNBQVMsR0FBRyxJQUFJLENBQUM7Z0JBQ2pCLFVBQVUsR0FBRyxRQUFRLENBQUM7WUFDeEIsQ0FBQztpQkFBTSxDQUFDO2dCQUNOLHdEQUF3RDtnQkFDeEQsSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLFNBQVMsRUFBRSxDQUFDO29CQUNuRSxJQUFJLFFBQVEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7d0JBQ3hCLE1BQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQyxjQUFjLENBQUMsQ0FBQzt3QkFFdkQsb0RBQW9EO3dCQUNwRCxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7NkJBQ3pCLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxrQkFBUyxDQUFDLEVBQUUsRUFBRSxDQUFDOzZCQUM1QixJQUFJLENBQUMsa0JBQVMsQ0FBQzs2QkFDZixLQUFLLENBQ0osSUFBQSxpQkFBRyxFQUNELElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFDNUIsSUFBQSxxQkFBTyxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLE1BQU0sQ0FBQyxFQUN6QyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQzdCLENBQ0YsQ0FBQzt3QkFFSixJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7NEJBQzNCLFNBQVMsR0FBRyxJQUFJLENBQUM7NEJBQ2pCLFVBQVUsR0FBRyxjQUFjLENBQUM7d0JBQzlCLENBQUM7b0JBQ0gsQ0FBQztnQkFDSCxDQUFDO1lBQ0gsQ0FBQztZQUVELDZDQUE2QztZQUM3QyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUM7Z0JBQ2YsTUFBTSxtQkFBbUIsR0FBRyxNQUFNLE9BQUU7cUJBQ2pDLE1BQU0sQ0FBQyxFQUFFLFdBQVcsRUFBRSx1QkFBYyxDQUFDLFdBQVcsRUFBRSxDQUFDO3FCQUNuRCxJQUFJLENBQUMsdUJBQWMsQ0FBQztxQkFDcEIsU0FBUyxDQUFDLG1CQUFVLEVBQUUsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsV0FBVyxFQUFFLG1CQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7cUJBQ3BFLEtBQUssQ0FDSixJQUFBLGlCQUFHLEVBQ0QsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsTUFBTSxFQUFFLFdBQVcsQ0FBQyxFQUFFLENBQUMsRUFDekMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxFQUNyQyxJQUFBLGdCQUFFLEVBQUMsdUJBQWMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQ2xDLENBQ0YsQ0FBQztnQkFFSixJQUFJLG1CQUFtQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztvQkFDbkMsU0FBUyxHQUFHLElBQUksQ0FBQztvQkFDakIsVUFBVSxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUM7Z0JBQ2pELENBQUM7WUFDSCxDQUFDO1lBRUQsSUFBSSxDQUFDLFNBQVMsRUFBRSxDQUFDO2dCQUNmLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE1BQU0sRUFBRSxXQUFXO29CQUNuQixPQUFPLEVBQUUseUNBQXlDO2lCQUNuRCxDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsdUJBQXVCO1lBQ3ZCLE1BQU0sWUFBWSxHQUFHLE1BQU0sT0FBRTtpQkFDMUIsTUFBTSxDQUFDO2dCQUNOLEVBQUUsRUFBRSxrQkFBUyxDQUFDLEVBQUU7Z0JBQ2hCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7Z0JBQ3BCLE9BQU8sRUFBRSxrQkFBUyxDQUFDLE9BQU87Z0JBQzFCLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUk7Z0JBQ3BCLFFBQVEsRUFBRSxrQkFBUyxDQUFDLFFBQVE7Z0JBQzVCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7Z0JBQ2hDLFlBQVksRUFBRSxrQkFBUyxDQUFDLFlBQVk7Z0JBQ3BDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7Z0JBQzlCLFVBQVUsRUFBRSxrQkFBUyxDQUFDLFVBQVU7Z0JBQ2hDLFdBQVcsRUFBRSxrQkFBUyxDQUFDLFdBQVc7Z0JBQ2xDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7Z0JBQ3RDLGFBQWEsRUFBRSxrQkFBUyxDQUFDLGFBQWE7Z0JBQ3RDLFNBQVMsRUFBRSxrQkFBUyxDQUFDLFNBQVM7Z0JBQzlCLGlCQUFpQixFQUFFLGtCQUFTLENBQUMsaUJBQWlCO2dCQUM5QyxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjO2dCQUN4QyxRQUFRLEVBQUUsa0JBQVMsQ0FBQyxRQUFRO2dCQUM1QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO2dCQUM5QixTQUFTLEVBQUUsa0JBQVMsQ0FBQyxTQUFTO2dCQUM5QixnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7Z0JBQ3BDLGdCQUFnQixFQUFFLHNCQUFhLENBQUMsSUFBSTtnQkFDcEMsbUJBQW1CLEVBQUUsc0JBQWEsQ0FBQyxPQUFPO2dCQUMxQyxnQkFBZ0IsRUFBRSxzQkFBYSxDQUFDLElBQUk7Z0JBQ3BDLGlCQUFpQixFQUFFLHNCQUFhLENBQUMsS0FBSztnQkFDdEMsaUJBQWlCLEVBQUUsc0JBQWEsQ0FBQyxLQUFLO2FBQ3ZDLENBQUM7aUJBQ0QsSUFBSSxDQUFDLGtCQUFTLENBQUM7aUJBQ2YsU0FBUyxDQUFDLHNCQUFhLEVBQUUsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsY0FBYyxFQUFFLHNCQUFhLENBQUMsRUFBRSxDQUFDLENBQUM7aUJBQ3hFLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUV2QyxJQUFJLFlBQVksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzlCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE1BQU0sRUFBRSxXQUFXO29CQUNuQixPQUFPLEVBQUUsb0JBQW9CO2lCQUM5QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxRQUFRLEdBQUcsWUFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRWpDLHVDQUF1QztZQUN2QyxNQUFNLGtCQUFrQixHQUFHLE1BQU0sT0FBRTtpQkFDaEMsTUFBTSxDQUFDO2dCQUNOLEVBQUUsRUFBRSxtQkFBVSxDQUFDLEVBQUU7Z0JBQ2pCLFVBQVUsRUFBRSxtQkFBVSxDQUFDLFVBQVU7Z0JBQ2pDLEtBQUssRUFBRSxtQkFBVSxDQUFDLEtBQUs7Z0JBQ3ZCLGFBQWEsRUFBRSxtQkFBVSxDQUFDLGFBQWE7Z0JBQ3ZDLFFBQVEsRUFBRSxtQkFBVSxDQUFDLFFBQVE7Z0JBQzdCLFNBQVMsRUFBRSxtQkFBVSxDQUFDLFNBQVM7Z0JBQy9CLE9BQU8sRUFBRSxtQkFBVSxDQUFDLE9BQU87Z0JBQzNCLG1CQUFtQixFQUFFLG1CQUFVLENBQUMsbUJBQW1CO2dCQUNuRCxtQkFBbUIsRUFBRSxtQkFBVSxDQUFDLG1CQUFtQjtnQkFDbkQsV0FBVyxFQUFFLG1CQUFVLENBQUMsV0FBVztnQkFDbkMsUUFBUSxFQUFFLG1CQUFVLENBQUMsUUFBUTthQUM5QixDQUFDO2lCQUNELElBQUksQ0FBQyxtQkFBVSxDQUFDO2lCQUNoQixLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsbUJBQVUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXBGLGdEQUFnRDtZQUNoRCxJQUFJLHdCQUF3QixHQUFjLEVBQUUsQ0FBQztZQUM3QyxNQUFNLG9CQUFvQixHQUFHLE1BQU0sT0FBRTtpQkFDbEMsTUFBTSxDQUFDO2dCQUNOLFdBQVcsRUFBRSx1QkFBYyxDQUFDLFdBQVc7Z0JBQ3ZDLGdCQUFnQixFQUFFLHVCQUFjLENBQUMsZ0JBQWdCO2dCQUNqRCxTQUFTLEVBQUUsdUJBQWMsQ0FBQyxTQUFTO2dCQUNuQyxPQUFPLEVBQUUsdUJBQWMsQ0FBQyxPQUFPO2FBQ2hDLENBQUM7aUJBQ0QsSUFBSSxDQUFDLHVCQUFjLENBQUM7aUJBQ3BCLFNBQVMsQ0FBQyxtQkFBVSxFQUFFLElBQUEsZ0JBQUUsRUFBQyx1QkFBYyxDQUFDLFdBQVcsRUFBRSxtQkFBVSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2lCQUNwRSxLQUFLLENBQ0osSUFBQSxpQkFBRyxFQUNELElBQUEsZ0JBQUUsRUFBQyx1QkFBYyxDQUFDLE1BQU0sRUFBRSxXQUFXLENBQUMsRUFBRSxDQUFDLEVBQ3pDLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsRUFDckMsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUNsQyxDQUNGLENBQUM7WUFFSixJQUFJLG9CQUFvQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDcEMsd0JBQXdCLEdBQUcsb0JBQW9CLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUU7b0JBQ3pELE1BQU0sU0FBUyxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsV0FBVyxDQUFDLENBQUM7b0JBQzFFLE9BQU87d0JBQ0wsR0FBRyxTQUFTO3dCQUNaLGdCQUFnQixFQUFFLEVBQUUsQ0FBQyxnQkFBZ0I7d0JBQ3JDLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUzt3QkFDdkIsT0FBTyxFQUFFLEVBQUUsQ0FBQyxPQUFPO3FCQUNwQixDQUFDO2dCQUNKLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHVCQUF1QjtZQUN2QixNQUFNLGFBQWEsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7WUFDaEQsTUFBTSxhQUFhLEdBQ2pCLFFBQVEsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsYUFBYSxHQUFHLFFBQVEsQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXhGLEdBQUcsQ0FBQyxJQUFJLENBQUM7Z0JBQ1AsR0FBRyxRQUFRO2dCQUNYLFVBQVU7Z0JBQ1YsVUFBVSxFQUFFO29CQUNWLFVBQVUsRUFBRSxRQUFRLENBQUMsVUFBVTtvQkFDL0IsYUFBYTtvQkFDYixhQUFhO29CQUNiLFdBQVcsRUFBRSxRQUFRLENBQUMsVUFBVSxHQUFHLGFBQWE7b0JBQ2hELGVBQWUsRUFBRSxrQkFBa0IsQ0FBQyxNQUFNO2lCQUMzQztnQkFDRCxjQUFjLEVBQUUsd0JBQXdCO2dCQUN4Qyx1REFBdUQ7Z0JBQ3ZELFVBQVUsRUFDUixXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLFNBQVM7b0JBQzVELENBQUMsQ0FBQyxrQkFBa0I7b0JBQ3BCLENBQUMsQ0FBQyxTQUFTO2FBQ2hCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDM0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSx1QkFBdUI7Z0JBQy9CLE9BQU8sRUFBRSxrQ0FBa0M7YUFDNUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7O09BRUc7SUFDSCxHQUFHLENBQUMsSUFBSSxDQUFDLHNCQUFzQixFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUNwRSxJQUFJLENBQUM7WUFDSCx5QkFBeUI7WUFDekIsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQztZQUNsRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ2pCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSx5QkFBeUI7b0JBQ2xDLElBQUksRUFBRSxlQUFlO2lCQUN0QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUNqQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsdUJBQXVCO29CQUNoQyxJQUFJLEVBQUUsZ0JBQWdCO2lCQUN2QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxZQUFZLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUU5QiwyQkFBMkI7WUFDM0IsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxFQUFFLENBQUM7Z0JBQ3ZELE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE1BQU0sRUFBRSxrQkFBa0I7b0JBQzFCLE9BQU8sRUFBRSw2Q0FBNkM7aUJBQ3ZELENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCwwQkFBMEI7WUFDMUIsTUFBTSxVQUFVLEdBQUcsZ0JBQU0sQ0FBQyxVQUFVLEVBQUUsQ0FBQztZQUV2QyxNQUFNLFdBQVcsR0FBRyxNQUFNLE9BQUU7aUJBQ3pCLE1BQU0sQ0FBQyxrQkFBUyxDQUFDO2lCQUNqQixNQUFNLENBQUM7Z0JBQ04sRUFBRSxFQUFFLFVBQVU7Z0JBQ2QsSUFBSSxFQUFFLFlBQVksQ0FBQyxJQUFJO2dCQUN2QixPQUFPLEVBQUUsWUFBWSxDQUFDLE9BQU8sSUFBSSxFQUFFO2dCQUNuQyxJQUFJLEVBQUUsWUFBWSxDQUFDLElBQUksSUFBSSxFQUFFO2dCQUM3QixRQUFRLEVBQUUsWUFBWSxDQUFDLFFBQVEsSUFBSSxJQUFJO2dCQUN2QyxVQUFVLEVBQUUsWUFBWSxDQUFDLFVBQVUsSUFBSSxFQUFFO2dCQUN6QyxZQUFZLEVBQUUsWUFBWSxDQUFDLFlBQVksSUFBSSxPQUFPO2dCQUNsRCxTQUFTLEVBQUUsWUFBWSxDQUFDLFNBQVM7Z0JBQ2pDLFVBQVUsRUFBRSxZQUFZLENBQUMsVUFBVSxJQUFJLENBQUM7Z0JBQ3hDLFdBQVcsRUFBRSxZQUFZLENBQUMsV0FBVztnQkFDckMsYUFBYSxFQUFFLFlBQVksQ0FBQyxhQUFhO2dCQUN6QyxhQUFhLEVBQUUsWUFBWSxDQUFDLGFBQWE7Z0JBQ3pDLFNBQVMsRUFBRSxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSTtnQkFDakYsaUJBQWlCLEVBQUUsWUFBWSxDQUFDLGlCQUFpQjtnQkFDakQsY0FBYyxFQUFFLFlBQVksQ0FBQyxjQUFjO2dCQUMzQyxRQUFRLEVBQUUsSUFBSTtnQkFDZCxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ3JCLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRTthQUN0QixDQUFDO2lCQUNELFNBQVMsRUFBRSxDQUFDO1lBR2YsdUZBQXVGO1lBQ3ZGLE9BQU8sQ0FBQyxHQUFHLENBQUMsK0VBQStFLENBQUMsQ0FBQztZQUU3RixpRUFBaUU7WUFDakUsSUFDRSxZQUFZLENBQUMsVUFBVTtnQkFDdkIsWUFBWSxDQUFDLFVBQVUsR0FBRyxDQUFDO2dCQUMzQixZQUFZLENBQUMsVUFBVSxJQUFJLEdBQUcsRUFDOUIsQ0FBQztnQkFDRCxJQUFJLENBQUM7b0JBQ0gsTUFBTSxVQUFVLEdBQUcsWUFBWSxDQUFDLFVBQVUsQ0FBQztvQkFDM0MsTUFBTSxXQUFXLEdBQUcsWUFBWSxDQUFDLFdBQVcsSUFBSSxDQUFDLENBQUM7b0JBQ2xELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxDQUFDO29CQUUxRCxNQUFNLGtCQUFrQixHQUFHLEVBQUUsQ0FBQztvQkFDOUIsS0FBSyxJQUFJLElBQUksR0FBRyxDQUFDLEVBQUUsSUFBSSxJQUFJLFVBQVUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDO3dCQUM5QyxNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksR0FBRyxhQUFhLENBQUMsQ0FBQzt3QkFDOUMsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUM7d0JBQ3JELE1BQU0sVUFBVSxHQUFHLEdBQUcsS0FBSyxHQUFHLFdBQVcsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxFQUFFLENBQUM7d0JBRXhFLGtCQUFrQixDQUFDLElBQUksQ0FBQzs0QkFDdEIsVUFBVSxFQUFFLFVBQVU7NEJBQ3RCLFVBQVU7NEJBQ1YsS0FBSzs0QkFDTCxRQUFRLEVBQUUsSUFBSTt5QkFDZixDQUFDLENBQUM7b0JBQ0wsQ0FBQztvQkFFRCxnQ0FBZ0M7b0JBQ2hDLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxPQUFFO3lCQUMvQixNQUFNLENBQUMsbUJBQVUsQ0FBQzt5QkFDbEIsTUFBTSxDQUFDLGtCQUFrQixDQUFDO3lCQUMxQixTQUFTLEVBQUUsQ0FBQztvQkFFZixPQUFPLENBQUMsR0FBRyxDQUNULG9CQUFvQixpQkFBaUIsQ0FBQyxNQUFNLDRCQUE0QixVQUFVLEVBQUUsQ0FDckYsQ0FBQztvQkFFRiwyQ0FBMkM7b0JBQzNDLHFEQUFxRDtvQkFDckQsK0NBQStDO29CQUMvQyx5REFBeUQ7b0JBQ3pELG1DQUFtQztvQkFDbkMsa0JBQWtCO29CQUNsQixtQkFBbUI7b0JBQ25CLE9BQU87b0JBQ1AsSUFBSTtnQkFDTixDQUFDO2dCQUFDLE9BQU8saUJBQWlCLEVBQUUsQ0FBQztvQkFDM0IsT0FBTyxDQUFDLEtBQUssQ0FBQyxzQ0FBc0MsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO29CQUN6RSxpRUFBaUU7Z0JBQ25FLENBQUM7WUFDSCxDQUFDO1lBRUQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE9BQU8sRUFBRSwrQkFBK0I7Z0JBQ3hDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxDQUFDO2FBQ3pCLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsNEJBQTRCLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDbkQsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSx1QkFBdUI7Z0JBQy9CLE9BQU8sRUFBRSwyQkFBMkI7YUFDckMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLEdBQUcsQ0FBQyw0Q0FBNEMsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDekYsSUFBSSxDQUFDO1lBQ0gsTUFBTSxJQUFJLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQztZQUN0QixNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNqQyxNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxXQUFxQixDQUFDLElBQUksRUFBRSxDQUFDO1lBRXBFLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLHlCQUF5QixFQUFFLENBQUMsQ0FBQztZQUN0RSxDQUFDO1lBRUQsb0NBQW9DO1lBQ3BDLElBQUksSUFBSSxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUUsQ0FBQztnQkFDMUIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxtREFBbUQsRUFBRSxDQUFDLENBQUM7WUFDaEcsQ0FBQztZQUVELE1BQU0sRUFBRSx5QkFBeUIsRUFBRSxHQUFHLHdEQUFhLHdCQUF3QixHQUFDLENBQUM7WUFDN0UsTUFBTSxrQkFBa0IsR0FBRyxNQUFNLHlCQUF5QixDQUFDLFVBQVUsRUFBRSxXQUFXLENBQUMsQ0FBQztZQUVwRixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLFVBQVUsRUFBRSxrQkFBa0I7Z0JBQzlCLE9BQU8sRUFBRSxTQUFTLGtCQUFrQixDQUFDLE1BQU0sb0NBQW9DO2FBQ2hGLENBQUMsQ0FBQztRQUNMLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkNBQTJDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDbEUsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUseUNBQXlDLEVBQUUsQ0FBQyxDQUFDO1FBQy9FLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVIOzs7T0FHRztJQUNILEdBQUcsQ0FBQyxNQUFNLENBQUMsK0JBQStCLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQy9FLElBQUksQ0FBQztZQUNILE1BQU0sSUFBSSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFDdEIsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDakMsTUFBTSxFQUFFLFlBQVksRUFBRSxHQUFHLEdBQUcsQ0FBQyxJQUFJLENBQUM7WUFFbEMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO2dCQUNWLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxPQUFPLEVBQUUseUJBQXlCLEVBQUUsQ0FBQyxDQUFDO1lBQ3RFLENBQUM7WUFFRCxvQ0FBb0M7WUFDcEMsSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUMxQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLENBQUMsQ0FBQztZQUNoRixDQUFDO1lBRUQsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLElBQUksWUFBWSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUUsQ0FBQztnQkFDOUQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxnQ0FBZ0MsRUFBRSxDQUFDLENBQUM7WUFDN0UsQ0FBQztZQUVELE1BQU0sRUFBRSx3QkFBd0IsRUFBRSxHQUFHLHdEQUFhLHdCQUF3QixHQUFDLENBQUM7WUFDNUUsTUFBTSxNQUFNLEdBQUcsTUFBTSx3QkFBd0IsQ0FBQyxVQUFVLEVBQUUsWUFBWSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVuRixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSxJQUFJO2dCQUNiLFlBQVksRUFBRSxNQUFNLENBQUMsWUFBWTtnQkFDakMsZ0JBQWdCLEVBQUUsTUFBTSxDQUFDLGdCQUFnQjtnQkFDekMsT0FBTyxFQUFFLHdCQUF3QixNQUFNLENBQUMsWUFBWSxtQkFBbUIsTUFBTSxDQUFDLGdCQUFnQix1QkFBdUI7YUFDdEgsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNyRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLENBQUMsT0FBTyxJQUFJLDZCQUE2QixFQUFFLENBQUMsQ0FBQztRQUNwRixDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7T0FFRztJQUNILEdBQUcsQ0FBQyxHQUFHLENBQUMsMEJBQTBCLEVBQUUsa0JBQVcsRUFBRSxLQUFLLEVBQUUsR0FBUSxFQUFFLEdBQUcsRUFBRSxFQUFFO1FBQ3ZFLElBQUksQ0FBQztZQUNILG9DQUFvQztZQUNwQyxNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDO1lBQ2xELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLHlCQUF5QjtvQkFDbEMsSUFBSSxFQUFFLGVBQWU7aUJBQ3RCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssT0FBTyxJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssU0FBUyxFQUFFLENBQUM7Z0JBQ25FLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSxrQ0FBa0M7b0JBQzNDLElBQUksRUFBRSx3QkFBd0I7aUJBQy9CLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUNqQyxNQUFNLFlBQVksR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDO1lBRTlCLDJCQUEyQjtZQUMzQixJQUFJLENBQUMsWUFBWSxDQUFDLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxjQUFjLEVBQUUsQ0FBQztnQkFDdkQsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsTUFBTSxFQUFFLGtCQUFrQjtvQkFDMUIsT0FBTyxFQUFFLDZDQUE2QztpQkFDdkQsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDJCQUEyQjtZQUMzQixNQUFNLGdCQUFnQixHQUFHLE1BQU0sT0FBRTtpQkFDOUIsTUFBTSxFQUFFO2lCQUNSLElBQUksQ0FBQyxrQkFBUyxDQUFDO2lCQUNmLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7aUJBQ25DLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVaLElBQUksZ0JBQWdCLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNsQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixNQUFNLEVBQUUsV0FBVztvQkFDbkIsT0FBTyxFQUFFLG9CQUFvQjtpQkFDOUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDRDQUE0QztZQUM1QyxNQUFNLGlCQUFpQixHQUFHLE1BQU0sT0FBRTtpQkFDL0IsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUEsaUJBQUcsRUFBUSxlQUFlLEVBQUUsQ0FBQztpQkFDN0MsSUFBSSxDQUFDLG1CQUFVLENBQUM7aUJBQ2hCLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFcEYsTUFBTSxxQkFBcUIsR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsRUFBRSxLQUFLLElBQUksQ0FBQyxDQUFDO1lBQy9ELE1BQU0sYUFBYSxHQUFHLFlBQVksQ0FBQyxVQUFVLElBQUksQ0FBQyxDQUFDO1lBQ25ELE1BQU0sa0JBQWtCLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxJQUFJLENBQUMsQ0FBQztZQUUvRCxPQUFPLENBQUMsR0FBRyxDQUNULGVBQWUsVUFBVSxLQUFLLGtCQUFrQixNQUFNLGFBQWEseUJBQXlCLHFCQUFxQixxQkFBcUIsQ0FDdkksQ0FBQztZQUVGLGtCQUFrQjtZQUNsQixNQUFNLGVBQWUsR0FBRyxNQUFNLE9BQUU7aUJBQzdCLE1BQU0sQ0FBQyxrQkFBUyxDQUFDO2lCQUNqQixHQUFHLENBQUM7Z0JBQ0gsSUFBSSxFQUFFLFlBQVksQ0FBQyxJQUFJO2dCQUN2QixPQUFPLEVBQUUsWUFBWSxDQUFDLE9BQU8sSUFBSSxFQUFFO2dCQUNuQyxJQUFJLEVBQUUsWUFBWSxDQUFDLElBQUksSUFBSSxFQUFFO2dCQUM3QixRQUFRLEVBQUUsWUFBWSxDQUFDLFFBQVEsSUFBSSxJQUFJO2dCQUN2QyxVQUFVLEVBQUUsWUFBWSxDQUFDLFVBQVUsSUFBSSxFQUFFO2dCQUN6QyxZQUFZLEVBQUUsWUFBWSxDQUFDLFlBQVksSUFBSSxPQUFPO2dCQUNsRCxTQUFTLEVBQUUsWUFBWSxDQUFDLFNBQVM7Z0JBQ2pDLFVBQVUsRUFBRSxhQUFhO2dCQUN6QixXQUFXLEVBQUUsWUFBWSxDQUFDLFdBQVc7Z0JBQ3JDLGFBQWEsRUFBRSxZQUFZLENBQUMsYUFBYTtnQkFDekMsYUFBYSxFQUFFLFlBQVksQ0FBQyxhQUFhO2dCQUN6QyxTQUFTLEVBQUUsWUFBWSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7Z0JBQ2pGLGlCQUFpQixFQUFFLFlBQVksQ0FBQyxpQkFBaUI7Z0JBQ2pELGNBQWMsRUFBRSxZQUFZLENBQUMsY0FBYztnQkFDM0MsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCLENBQUM7aUJBQ0QsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQztpQkFDbkMsU0FBUyxFQUFFLENBQUM7WUFFZixtRUFBbUU7WUFDbkUsSUFBSSxhQUFhLEtBQUssa0JBQWtCLEVBQUUsQ0FBQztnQkFDekMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQ0FBa0Msa0JBQWtCLE9BQU8sYUFBYSwyQkFBMkIsQ0FBQyxDQUFDO2dCQUVqSCwwQ0FBMEM7Z0JBQzFDLElBQUksV0FBVyxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUUsQ0FBQztvQkFDakMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQzt3QkFDMUIsT0FBTyxFQUFFLGdFQUFnRTt3QkFDekUsSUFBSSxFQUFFLHNDQUFzQztxQkFDN0MsQ0FBQyxDQUFDO2dCQUNMLENBQUM7Z0JBRUQsTUFBTSxFQUFFLG9CQUFvQixFQUFFLEdBQUcsd0RBQWEsd0JBQXdCLEdBQUMsQ0FBQztnQkFDeEUsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLG9CQUFvQixDQUNqRCxVQUFVLEVBQ1YsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxFQUNsQyxhQUFhLEVBQ2Isa0JBQWtCLEVBQ2xCLFlBQVksQ0FBQyxXQUFXLElBQUksZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxJQUFJLENBQUMsQ0FDakUsQ0FBQztnQkFFRix3RUFBd0U7Z0JBQ3hFLElBQUksZ0JBQWdCLENBQUMsTUFBTSxLQUFLLFdBQVcsSUFBSSxnQkFBZ0IsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO29CQUNuRixPQUFPLEdBQUcsQ0FBQyxJQUFJLENBQUM7d0JBQ2QsT0FBTyxFQUFFLDJEQUEyRDt3QkFDcEUsZUFBZSxFQUFFLElBQUk7d0JBQ3JCLHVCQUF1QixFQUFFLElBQUk7d0JBQzdCLGtCQUFrQixFQUFFLGdCQUFnQixDQUFDLGtCQUFrQjt3QkFDdkQsV0FBVyxFQUFFLGlCQUFpQixrQkFBa0IsR0FBRyxhQUFhLDJFQUEyRSxVQUFVLDhDQUE4QztxQkFDcE0sQ0FBQyxDQUFDO2dCQUNMLENBQUM7WUFDSCxDQUFDO1lBR0QsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxPQUFPLEVBQUUsK0JBQStCO2dCQUN4QyxRQUFRLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQzthQUM3QixDQUFDLENBQUM7UUFDTCxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ25ELEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO2dCQUNuQixNQUFNLEVBQUUsdUJBQXVCO2dCQUMvQixPQUFPLEVBQUUsMkJBQTJCO2FBQ3JDLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVIOztPQUVHO0lBQ0gsR0FBRyxDQUFDLE1BQU0sQ0FBQywwQkFBMEIsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDMUUsSUFBSSxDQUFDO1lBQ0gseUJBQXlCO1lBQ3pCLE1BQU0sV0FBVyxHQUFHLEdBQUcsQ0FBQyxJQUFJLElBQUksR0FBRyxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUM7WUFDbEQsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUNqQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUseUJBQXlCO29CQUNsQyxJQUFJLEVBQUUsZUFBZTtpQkFDdEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELElBQUksV0FBVyxDQUFDLElBQUksS0FBSyxPQUFPLEVBQUUsQ0FBQztnQkFDakMsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLHVCQUF1QjtvQkFDaEMsSUFBSSxFQUFFLGdCQUFnQjtpQkFDdkIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBRWpDLDJCQUEyQjtZQUMzQixNQUFNLGdCQUFnQixHQUFHLE1BQU0sT0FBRTtpQkFDOUIsTUFBTSxFQUFFO2lCQUNSLElBQUksQ0FBQyxrQkFBUyxDQUFDO2lCQUNmLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUM7aUJBQ25DLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUVaLElBQUksZ0JBQWdCLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUNsQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixNQUFNLEVBQUUsV0FBVztvQkFDbkIsT0FBTyxFQUFFLG9CQUFvQjtpQkFDOUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDJDQUEyQztZQUMzQyxNQUFNLE9BQUU7aUJBQ0wsTUFBTSxDQUFDLGtCQUFTLENBQUM7aUJBQ2pCLEdBQUcsQ0FBQztnQkFDSCxRQUFRLEVBQUUsS0FBSztnQkFDZixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7YUFDdEIsQ0FBQztpQkFDRCxLQUFLLENBQUMsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFHdkMsdURBQXVEO1lBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsa0VBQWtFLENBQUMsQ0FBQztZQUVoRixHQUFHLENBQUMsSUFBSSxDQUFDO2dCQUNQLE9BQU8sRUFBRSwrQkFBK0I7YUFDekMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNuRCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsTUFBTSxFQUFFLHVCQUF1QjtnQkFDL0IsT0FBTyxFQUFFLDJCQUEyQjthQUNyQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSDs7O09BR0c7SUFDSCxHQUFHLENBQUMsR0FBRyxDQUFDLDBDQUEwQyxFQUFFLGtCQUFXLEVBQUUsS0FBSyxFQUFFLEdBQVEsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN2RixJQUFJLENBQUM7WUFDSCxNQUFNLFdBQVcsR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLEdBQUcsQ0FBQyxPQUFPLEVBQUUsSUFBSSxDQUFDO1lBQ2xELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsT0FBTyxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztvQkFDMUIsT0FBTyxFQUFFLHlCQUF5QjtvQkFDbEMsSUFBSSxFQUFFLGVBQWU7aUJBQ3RCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxJQUFJLFdBQVcsQ0FBQyxJQUFJLEtBQUssT0FBTyxFQUFFLENBQUM7Z0JBQ2pDLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSx1QkFBdUI7b0JBQ2hDLElBQUksRUFBRSxnQkFBZ0I7aUJBQ3ZCLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLFVBQVUsR0FBRyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztZQUVqQywyQkFBMkI7WUFDM0IsTUFBTSxRQUFRLEdBQUcsTUFBTSxPQUFFO2lCQUN0QixNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsa0JBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLGtCQUFTLENBQUMsSUFBSSxFQUFFLENBQUM7aUJBQ2xELElBQUksQ0FBQyxrQkFBUyxDQUFDO2lCQUNmLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLGtCQUFTLENBQUMsRUFBRSxFQUFFLFVBQVUsQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDO2lCQUN0RSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFWixJQUFJLFFBQVEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7Z0JBQzFCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE1BQU0sRUFBRSxXQUFXO29CQUNuQixPQUFPLEVBQUUsb0JBQW9CO2lCQUM5QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsb0NBQW9DO1lBQ3BDLE1BQU0sZUFBZSxHQUFHLE1BQU0sT0FBRTtpQkFDN0IsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUEsaUJBQUcsRUFBUSxVQUFVLEVBQUUsQ0FBQztpQkFDeEMsSUFBSSxDQUFDLG1CQUFVLENBQUM7aUJBQ2hCLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFFcEYsa0VBQWtFO1lBQ2xFLE1BQU0sY0FBYyxHQUFHLE1BQU0sT0FBRTtpQkFDNUIsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUEsaUJBQUcsRUFBUSxVQUFVLEVBQUUsQ0FBQztpQkFDeEMsSUFBSSxDQUFDLGtCQUFTLENBQUM7aUJBQ2YsS0FBSyxDQUNKLElBQUEsZ0JBQUUsRUFDQSxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLEVBQ3BDLElBQUEsaUJBQUcsRUFBQSxHQUFHLGtCQUFTLENBQUMsV0FBVyxzREFBc0QsVUFBVSxHQUFHLENBQy9GLENBQ0YsQ0FBQztZQUVKLGtHQUFrRztZQUNsRyxNQUFNLHFCQUFxQixHQUFHLE1BQU0sT0FBRTtpQkFDbkMsTUFBTSxDQUFDLEVBQUUsS0FBSyxFQUFFLElBQUEsaUJBQUcsRUFBUSxrQkFBa0IsdUJBQWMsQ0FBQyxNQUFNLEdBQUcsRUFBRSxDQUFDO2lCQUN4RSxJQUFJLENBQUMsdUJBQWMsQ0FBQztpQkFDcEIsU0FBUyxDQUFDLG1CQUFVLEVBQUUsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsV0FBVyxFQUFFLG1CQUFVLENBQUMsRUFBRSxDQUFDLENBQUM7aUJBQ3BFLFNBQVMsQ0FBQyxjQUFLLEVBQUUsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsTUFBTSxFQUFFLGNBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztpQkFDckQsS0FBSyxDQUNKLElBQUEsaUJBQUcsRUFDRCxJQUFBLGdCQUFFLEVBQUMsbUJBQVUsQ0FBQyxVQUFVLEVBQUUsVUFBVSxDQUFDLEVBQ3JDLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFDN0IsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUNqQyxJQUFBLGdCQUFFLEVBQUMsY0FBSyxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FDekIsQ0FDRixDQUFDO1lBRUosTUFBTSxNQUFNLEdBQUc7Z0JBQ2IsUUFBUSxFQUFFLFFBQVEsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JCLFVBQVUsRUFBRSxlQUFlLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUM7Z0JBQzFDLFNBQVMsRUFBRSxjQUFjLENBQUMsQ0FBQyxDQUFDLEVBQUUsS0FBSyxJQUFJLENBQUM7Z0JBQ3hDLHNCQUFzQixFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxFQUFFLEtBQUssSUFBSSxDQUFDO2FBQzdELENBQUM7WUFFRixHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ25CLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDM0QsR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ25CLE1BQU0sRUFBRSx1QkFBdUI7Z0JBQy9CLE9BQU8sRUFBRSxtQ0FBbUM7YUFDN0MsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUg7OztPQUdHO0lBQ0gsR0FBRyxDQUFDLE1BQU0sQ0FBQyxrQ0FBa0MsRUFBRSxrQkFBVyxFQUFFLEtBQUssRUFBRSxHQUFRLEVBQUUsR0FBRyxFQUFFLEVBQUU7UUFDbEYsSUFBSSxDQUFDO1lBQ0gsTUFBTSxXQUFXLEdBQUcsR0FBRyxDQUFDLElBQUksSUFBSSxHQUFHLENBQUMsT0FBTyxFQUFFLElBQUksQ0FBQztZQUNsRCxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ2pCLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUM7b0JBQzFCLE9BQU8sRUFBRSx5QkFBeUI7b0JBQ2xDLElBQUksRUFBRSxlQUFlO2lCQUN0QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsSUFBSSxXQUFXLENBQUMsSUFBSSxLQUFLLE9BQU8sRUFBRSxDQUFDO2dCQUNqQyxPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixPQUFPLEVBQUUsdUJBQXVCO29CQUNoQyxJQUFJLEVBQUUsZ0JBQWdCO2lCQUN2QixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsTUFBTSxVQUFVLEdBQUcsR0FBRyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFFakMsMkJBQTJCO1lBQzNCLE1BQU0sUUFBUSxHQUFHLE1BQU0sT0FBRTtpQkFDdEIsTUFBTSxDQUFDLEVBQUUsRUFBRSxFQUFFLGtCQUFTLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxrQkFBUyxDQUFDLElBQUksRUFBRSxDQUFDO2lCQUNsRCxJQUFJLENBQUMsa0JBQVMsQ0FBQztpQkFDZixLQUFLLENBQUMsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsRUFBRSxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQztpQkFDdEUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxRQUFRLENBQUMsTUFBTSxLQUFLLENBQUMsRUFBRSxDQUFDO2dCQUMxQixPQUFPLEdBQUcsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDO29CQUMxQixNQUFNLEVBQUUsV0FBVztvQkFDbkIsT0FBTyxFQUFFLG9CQUFvQjtpQkFDOUIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELHlDQUF5QztZQUN6QyxNQUFNLE9BQUUsQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFO2dCQUNoQyx5Q0FBeUM7Z0JBQ3pDLE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxFQUFFO3FCQUNoQyxNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsbUJBQVUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztxQkFDN0IsSUFBSSxDQUFDLG1CQUFVLENBQUM7cUJBQ2hCLEtBQUssQ0FBQyxJQUFBLGlCQUFHLEVBQUMsSUFBQSxnQkFBRSxFQUFDLG1CQUFVLENBQUMsVUFBVSxFQUFFLFVBQVUsQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQyxtQkFBVSxDQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXBGLE1BQU0sWUFBWSxHQUFHLGtCQUFrQixDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUV6RCxJQUFJLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQzVCLGlFQUFpRTtvQkFDakUsTUFBTSxFQUFFO3lCQUNMLE1BQU0sQ0FBQyxrQkFBUyxDQUFDO3lCQUNqQixLQUFLLENBQ0osSUFBQSxnQkFBRSxFQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsRUFBRSxJQUFBLHFCQUFPLEVBQUMsa0JBQVMsQ0FBQyxXQUFXLEVBQUUsWUFBWSxDQUFDLENBQUMsQ0FDdkYsQ0FBQztvQkFFSiw4Q0FBOEM7b0JBQzlDLE1BQU0sRUFBRTt5QkFDTCxNQUFNLENBQUMsdUJBQWMsQ0FBQzt5QkFDdEIsR0FBRyxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxDQUFDO3lCQUMvQyxLQUFLLENBQUMsSUFBQSxxQkFBTyxFQUFDLHVCQUFjLENBQUMsV0FBVyxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7b0JBRTVELHdEQUF3RDtvQkFDeEQsTUFBTSxhQUFhLEdBQUcsTUFBTSxFQUFFO3lCQUMzQixNQUFNLENBQUMsRUFBRSxFQUFFLEVBQUUsY0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDO3lCQUN4QixJQUFJLENBQUMsY0FBSyxDQUFDO3lCQUNYLFFBQVEsQ0FDUCwwQkFBaUIsRUFDakIsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxjQUFLLENBQUMsRUFBRSxFQUFFLDBCQUFpQixDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUEsZ0JBQUUsRUFBQywwQkFBaUIsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FDbEY7eUJBQ0EsUUFBUSxDQUNQLHVCQUFjLEVBQ2QsSUFBQSxpQkFBRyxFQUFDLElBQUEsZ0JBQUUsRUFBQyxjQUFLLENBQUMsRUFBRSxFQUFFLHVCQUFjLENBQUMsTUFBTSxDQUFDLEVBQUUsSUFBQSxnQkFBRSxFQUFDLHVCQUFjLENBQUMsUUFBUSxFQUFFLElBQUksQ0FBQyxDQUFDLENBQzVFO3lCQUNBLEtBQUssQ0FDSixJQUFBLGlCQUFHLEVBQ0QsSUFBQSxnQkFBRSxFQUFDLGNBQUssQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQ3hCLElBQUEsb0JBQU0sRUFBQywwQkFBaUIsQ0FBQyxNQUFNLENBQUMsRUFDaEMsSUFBQSxvQkFBTSxFQUFDLHVCQUFjLENBQUMsTUFBTSxDQUFDLENBQzlCLENBQ0YsQ0FBQztvQkFFSixJQUFJLGFBQWEsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7d0JBQzdCLE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQzt3QkFDdkQsTUFBTSxFQUFFOzZCQUNMLE1BQU0sQ0FBQyxjQUFLLENBQUM7NkJBQ2IsR0FBRyxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxDQUFDOzZCQUMvQyxLQUFLLENBQUMsSUFBQSxxQkFBTyxFQUFDLGNBQUssQ0FBQyxFQUFFLEVBQUUsZUFBZSxDQUFDLENBQUMsQ0FBQztvQkFDL0MsQ0FBQztvQkFFRCw0QkFBNEI7b0JBQzVCLE1BQU0sRUFBRTt5QkFDTCxNQUFNLENBQUMsbUJBQVUsQ0FBQzt5QkFDbEIsR0FBRyxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsRUFBRSxDQUFDO3lCQUMvQyxLQUFLLENBQUMsSUFBQSxxQkFBTyxFQUFDLG1CQUFVLENBQUMsRUFBRSxFQUFFLFlBQVksQ0FBQyxDQUFDLENBQUM7Z0JBQ2pELENBQUM7cUJBQU0sQ0FBQztvQkFDTiwrREFBK0Q7b0JBQy9ELE1BQU0sRUFBRSxDQUFDLE1BQU0sQ0FBQyxrQkFBUyxDQUFDLENBQUMsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLFVBQVUsRUFBRSxVQUFVLENBQUMsQ0FBQyxDQUFDO2dCQUN6RSxDQUFDO2dCQUVELHVDQUF1QztnQkFDdkMsTUFBTSxFQUFFO3FCQUNMLE1BQU0sQ0FBQyxrQkFBUyxDQUFDO3FCQUNqQixHQUFHLENBQUMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxJQUFJLElBQUksRUFBRSxFQUFFLENBQUM7cUJBQy9DLEtBQUssQ0FBQyxJQUFBLGdCQUFFLEVBQUMsa0JBQVMsQ0FBQyxFQUFFLEVBQUUsVUFBVSxDQUFDLENBQUMsQ0FBQztZQUN6QyxDQUFDLENBQUMsQ0FBQztZQUdILDZEQUE2RDtZQUM3RCxvREFBb0Q7WUFDcEQsTUFBTSxXQUFXLEdBQUcsTUFBTSxPQUFFO2lCQUN6QixNQUFNLENBQUMsRUFBRSxjQUFjLEVBQUUsa0JBQVMsQ0FBQyxjQUFjLEVBQUUsQ0FBQztpQkFDcEQsSUFBSSxDQUFDLGtCQUFTLENBQUM7aUJBQ2YsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxrQkFBUyxDQUFDLEVBQUUsRUFBRSxVQUFVLENBQUMsQ0FBQztpQkFDbkMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRVosSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO2dCQUMzQix1REFBdUQ7Z0JBQ3ZELE9BQU8sQ0FBQyxHQUFHLENBQUMsa0VBQWtFLENBQUMsQ0FBQztZQUNsRixDQUFDO1lBRUQsR0FBRyxDQUFDLElBQUksQ0FBQztnQkFDUCxPQUFPLEVBQUUsb0RBQW9EO2dCQUM3RCxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUk7YUFDbEMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUN2RCxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQztnQkFDbkIsTUFBTSxFQUFFLHVCQUF1QjtnQkFDL0IsT0FBTyxFQUFFLGdEQUFnRDthQUMxRCxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvc2VydmVyL2FwaS9idWlsZGluZ3MudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXhwcmVzcyB9IGZyb20gJ2V4cHJlc3MnO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQge1xuICBidWlsZGluZ3MsXG4gIG9yZ2FuaXphdGlvbnMsXG4gIHJlc2lkZW5jZXMsXG4gIHVzZXJSZXNpZGVuY2VzLFxuICB1c2VyT3JnYW5pemF0aW9ucyxcbiAgdXNlcnMsXG4gIGRvY3VtZW50cyxcbn0gZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHsgZXEsIGFuZCwgb3IsIGluQXJyYXksIHNxbCwgaXNOdWxsLCBjb3VudCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcbmltcG9ydCB7IHJlcXVpcmVBdXRoIH0gZnJvbSAnLi4vYXV0aCc7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5cbi8qKlxuICogSGFuZGxlcyBjcmVhdGluZyBvciBkZWxldGluZyByZXNpZGVuY2VzIHdoZW4gYnVpbGRpbmcgdG90YWxVbml0cyBjaGFuZ2VzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGhhbmRsZVJlc2lkZW5jZUNoYW5nZXMoXG4gIGJ1aWxkaW5nSWQ6IHN0cmluZyxcbiAgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyxcbiAgbmV3VG90YWxVbml0czogbnVtYmVyLFxuICBjdXJyZW50UmVzaWRlbmNlQ291bnQ6IG51bWJlcixcbiAgdG90YWxGbG9vcnM/OiBudW1iZXJcbik6IFByb21pc2U8dm9pZD4ge1xuICB0cnkge1xuICAgIC8vIE9iamVjdCBzdG9yYWdlIGhpZXJhcmNoeSB3aWxsIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSB3aGVuIGRvY3VtZW50cyBhcmUgdXBsb2FkZWRcblxuICAgIGlmIChuZXdUb3RhbFVuaXRzID4gY3VycmVudFJlc2lkZW5jZUNvdW50KSB7XG4gICAgICAvLyBOZWVkIHRvIGNyZWF0ZSBtb3JlIHJlc2lkZW5jZXNcbiAgICAgIGNvbnN0IHJlc2lkZW5jZXNUb0NyZWF0ZSA9IG5ld1RvdGFsVW5pdHMgLSBjdXJyZW50UmVzaWRlbmNlQ291bnQ7XG5cbiAgICAgIC8vIEdldCBleGlzdGluZyByZXNpZGVuY2UgbnVtYmVycyB0byBhdm9pZCBjb25mbGljdHNcbiAgICAgIGNvbnN0IGV4aXN0aW5nUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyB1bml0TnVtYmVyOiByZXNpZGVuY2VzLnVuaXROdW1iZXIgfSlcbiAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCkpO1xuXG4gICAgICBjb25zdCBleGlzdGluZ1VuaXROdW1iZXJzID0gbmV3IFNldChleGlzdGluZ1Jlc2lkZW5jZXMubWFwKChyKSA9PiByLnVuaXROdW1iZXIpKTtcblxuICAgICAgY29uc3QgZmxvb3JzID0gdG90YWxGbG9vcnMgfHwgMTtcbiAgICAgIGNvbnN0IHVuaXRzUGVyRmxvb3IgPSBNYXRoLmNlaWwobmV3VG90YWxVbml0cyAvIGZsb29ycyk7XG5cbiAgICAgIGNvbnN0IG5ld1Jlc2lkZW5jZXMgPSBbXTtcbiAgICAgIGxldCB1bml0Q291bnRlciA9IDE7XG5cbiAgICAgIGZvciAobGV0IHJlc2lkZW5jZUluZGV4ID0gMDsgcmVzaWRlbmNlSW5kZXggPCByZXNpZGVuY2VzVG9DcmVhdGU7IHJlc2lkZW5jZUluZGV4KyspIHtcbiAgICAgICAgLy8gRmluZCBuZXh0IGF2YWlsYWJsZSB1bml0IG51bWJlclxuICAgICAgICB3aGlsZSAoZXhpc3RpbmdVbml0TnVtYmVycy5oYXModW5pdENvdW50ZXIudG9TdHJpbmcoKSkpIHtcbiAgICAgICAgICB1bml0Q291bnRlcisrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZmxvb3IgPSBNYXRoLmNlaWwodW5pdENvdW50ZXIgLyB1bml0c1BlckZsb29yKTtcbiAgICAgICAgY29uc3QgdW5pdE51bWJlciA9IHVuaXRDb3VudGVyLnRvU3RyaW5nKCk7XG5cbiAgICAgICAgbmV3UmVzaWRlbmNlcy5wdXNoKHtcbiAgICAgICAgICBidWlsZGluZ0lkLFxuICAgICAgICAgIHVuaXROdW1iZXIsXG4gICAgICAgICAgZmxvb3I6IGZsb29yLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICB9KTtcblxuICAgICAgICBleGlzdGluZ1VuaXROdW1iZXJzLmFkZCh1bml0TnVtYmVyKTtcbiAgICAgICAgdW5pdENvdW50ZXIrKztcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHJlc2lkZW5jZXMgaW4gYmF0Y2hcbiAgICAgIGlmIChuZXdSZXNpZGVuY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgY3JlYXRlZFJlc2lkZW5jZXMgPSBhd2FpdCBkYi5pbnNlcnQocmVzaWRlbmNlcykudmFsdWVzKG5ld1Jlc2lkZW5jZXMpLnJldHVybmluZygpO1xuXG4gICAgICAgIC8vIENyZWF0ZSBvYmplY3Qgc3RvcmFnZSBoaWVyYXJjaHkgZm9yIGVhY2ggbmV3IHJlc2lkZW5jZVxuICAgICAgICBmb3IgKGNvbnN0IHJlc2lkZW5jZSBvZiBjcmVhdGVkUmVzaWRlbmNlcykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBPYmplY3Qgc3RvcmFnZSBzZXJ2aWNlIGludGVncmF0aW9uXG4gICAgICAgICAgICAvLyBhd2FpdCBvYmplY3RTdG9yYWdlU2VydmljZS5jcmVhdGVSZXNpZGVuY2VIaWVyYXJjaHkoXG4gICAgICAgICAgICAvLyAgIG9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgLy8gICBidWlsZGluZ0lkLFxuICAgICAgICAgICAgLy8gICByZXNpZGVuY2UuaWRcbiAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgfSBjYXRjaCAoc3RvcmFnZUVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFxuICAgICAgICAgICAgICBg4pqg77iPIEVycm9yIGNyZWF0aW5nIHN0b3JhZ2UgaGllcmFyY2h5IGZvciByZXNpZGVuY2UgJHtyZXNpZGVuY2UuaWR9OmAsXG4gICAgICAgICAgICAgIHN0b3JhZ2VFcnJvclxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIC8vIERvbid0IGZhaWwgdGhlIHdob2xlIG9wZXJhdGlvbiBmb3Igc3RvcmFnZSBlcnJvcnNcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg4pyFIENyZWF0ZWQgJHtjcmVhdGVkUmVzaWRlbmNlcy5sZW5ndGh9IG5ldyByZXNpZGVuY2VzIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAobmV3VG90YWxVbml0cyA8IGN1cnJlbnRSZXNpZGVuY2VDb3VudCkge1xuICAgICAgLy8gTmVlZCB0byBkZWxldGUgc29tZSByZXNpZGVuY2VzXG4gICAgICBjb25zdCByZXNpZGVuY2VzVG9EZWxldGUgPSBjdXJyZW50UmVzaWRlbmNlQ291bnQgLSBuZXdUb3RhbFVuaXRzO1xuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5OJIE1hcmtpbmcgJHtyZXNpZGVuY2VzVG9EZWxldGV9IHJlc2lkZW5jZXMgYXMgaW5hY3RpdmUgZm9yIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH1gXG4gICAgICApO1xuXG4gICAgICAvLyBHZXQgcmVzaWRlbmNlcyB0aGF0IGNhbiBiZSBzYWZlbHkgZGVsZXRlZCAobm8gYWN0aXZlIHVzZXIgcmVsYXRpb25zaGlwcylcbiAgICAgIGNvbnN0IGRlbGV0YWJsZVJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgaWQ6IHJlc2lkZW5jZXMuaWQsIHVuaXROdW1iZXI6IHJlc2lkZW5jZXMudW5pdE51bWJlciB9KVxuICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgdXNlclJlc2lkZW5jZXMsXG4gICAgICAgICAgYW5kKGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICApXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLFxuICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBpc051bGwodXNlclJlc2lkZW5jZXMuaWQpIC8vIE5vIGFjdGl2ZSB1c2VyIHJlbGF0aW9uc2hpcHNcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLm9yZGVyQnkoc3FsYCR7cmVzaWRlbmNlcy51bml0TnVtYmVyfTo6aW50ZWdlciBERVNDYCkgLy8gRGVsZXRlIGhpZ2hlc3QgdW5pdCBudW1iZXJzIGZpcnN0XG4gICAgICAgIC5saW1pdChyZXNpZGVuY2VzVG9EZWxldGUpO1xuXG4gICAgICBpZiAoZGVsZXRhYmxlUmVzaWRlbmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHJlc2lkZW5jZUlkc1RvRGVsZXRlID0gZGVsZXRhYmxlUmVzaWRlbmNlcy5tYXAoKHIpID0+IHIuaWQpO1xuXG4gICAgICAgIC8vIFNvZnQgZGVsZXRlIHJlc2lkZW5jZXMgKG1hcmsgYXMgaW5hY3RpdmUpXG4gICAgICAgIGF3YWl0IGRiXG4gICAgICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgICAgIC5zZXQoe1xuICAgICAgICAgICAgaXNBY3RpdmU6IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLndoZXJlKGluQXJyYXkocmVzaWRlbmNlcy5pZCwgcmVzaWRlbmNlSWRzVG9EZWxldGUpKTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICBg4pyFIE1hcmtlZCAke2RlbGV0YWJsZVJlc2lkZW5jZXMubGVuZ3RofSByZXNpZGVuY2VzIGFzIGluYWN0aXZlIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIExvZyB3aGljaCByZXNpZGVuY2VzIGNvdWxkbid0IGJlIGRlbGV0ZWQgZHVlIHRvIHVzZXIgcmVsYXRpb25zaGlwc1xuICAgICAgICBjb25zdCBwcm90ZWN0ZWRDb3VudCA9IHJlc2lkZW5jZXNUb0RlbGV0ZSAtIGRlbGV0YWJsZVJlc2lkZW5jZXMubGVuZ3RoO1xuICAgICAgICBpZiAocHJvdGVjdGVkQ291bnQgPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg4pqg77iPIENvdWxkIG5vdCBkZWxldGUgJHtwcm90ZWN0ZWRDb3VudH0gcmVzaWRlbmNlcyAtIHRoZXkgaGF2ZSBhY3RpdmUgdXNlciByZWxhdGlvbnNoaXBzYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg4pyTIE5vIHJlc2lkZW5jZSBjaGFuZ2VzIG5lZWRlZCAtIGJ1aWxkaW5nICR7YnVpbGRpbmdJZH0gYWxyZWFkeSBoYXMgJHtjdXJyZW50UmVzaWRlbmNlQ291bnR9IHJlc2lkZW5jZXNgXG4gICAgICApO1xuICAgIH1cbiAgICAvLyBEb24ndCB0aHJvdyB0aGUgZXJyb3IgdG8gYXZvaWQgYnJlYWtpbmcgdGhlIGJ1aWxkaW5nIHVwZGF0ZVxuICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIHJlc2lkZW5jZSBjb3VudDonLCBlcnJvcik7XG4gICAgLy8gRG9uJ3QgdGhyb3cgdGhlIGVycm9yIHRvIGF2b2lkIGJyZWFraW5nIHRoZSBidWlsZGluZyB1cGRhdGVcbiAgfVxufVxuXG4vKipcbiAqXG4gKiBAcGFyYW0gYXBwXG4gKi9cbi8qKlxuICogUmVnaXN0ZXJCdWlsZGluZ1JvdXRlcyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBhcHBcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQnVpbGRpbmdSb3V0ZXMoYXBwOiBFeHByZXNzKTogdm9pZCB7XG4gIC8qKlxuICAgKiBHRVQgL2FwaS9idWlsZGluZ3MgLSBSZXRyaWV2ZXMgYnVpbGRpbmdzIGJhc2VkIG9uIHVzZXIgcm9sZSBhbmQgb3JnYW5pemF0aW9uIGFjY2Vzcy5cbiAgICogVXNlZCBieSBiaWxscyBwYWdlIGFuZCBvdGhlciBjb21wb25lbnRzLlxuICAgKlxuICAgKiBBY2Nlc3MgQ29udHJvbCBMb2dpYzpcbiAgICogLSBBZG1pbjogQ2FuIHNlZSBhbGwgYnVpbGRpbmdzIGlmIHRoZXkgaGF2ZSBnbG9iYWwgYWNjZXNzLCBvciBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgKiAtIE1hbmFnZXI6IENhbiBzZWUgb25seSBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uc1xuICAgKiAtIE90aGVyczogTm8gYWNjZXNzIHRvIGJ1aWxkaW5ncyBsaXN0LlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9idWlsZGluZ3MnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuXG4gICAgICBpZiAoIXVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wgZm9yIGJ1aWxkaW5nc1xuICAgICAgaWYgKFxuICAgICAgICAhW1xuICAgICAgICAgICdhZG1pbicsXG4gICAgICAgICAgJ21hbmFnZXInLFxuICAgICAgICAgICdkZW1vX21hbmFnZXInLFxuICAgICAgICAgICdkZW1vX3RlbmFudCcsXG4gICAgICAgICAgJ2RlbW9fcmVzaWRlbnQnLFxuICAgICAgICAgICd0ZW5hbnQnLFxuICAgICAgICAgICdyZXNpZGVudCcsXG4gICAgICAgIF0uaW5jbHVkZXModXNlci5yb2xlKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQuIEluc3VmZmljaWVudCBwZXJtaXNzaW9ucy4nLFxuICAgICAgICAgIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/Cfj6IgW0J1aWxkaW5ncyBBUEldIFVzZXIgYWNjZXNzaW5nIGJ1aWxkaW5nczonLCB7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICByb2xlOiB1c2VyLnJvbGUsXG4gICAgICAgIG9yZ2FuaXphdGlvbnM6IHVzZXIub3JnYW5pemF0aW9ucyxcbiAgICAgICAgY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9uczogdXNlci5jYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zLFxuICAgICAgfSk7XG5cbiAgICAgIGxldCBidWlsZGluZ3NRdWVyeTtcblxuICAgICAgaWYgKHVzZXIucm9sZSA9PT0gJ2FkbWluJyAmJiB1c2VyLmNhbkFjY2Vzc0FsbE9yZ2FuaXphdGlvbnMpIHtcbiAgICAgICAgLy8gQWRtaW4gd2l0aCBnbG9iYWwgYWNjZXNzIGNhbiBzZWUgYWxsIGJ1aWxkaW5nc1xuICAgICAgICBidWlsZGluZ3NRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IGJ1aWxkaW5ncy5jaXR5LFxuICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ3MuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgIC5pbm5lckpvaW4ob3JnYW5pemF0aW9ucywgZXEoYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICAub3JkZXJCeShvcmdhbml6YXRpb25zLm5hbWUsIGJ1aWxkaW5ncy5uYW1lKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIE1hbmFnZXIgb3IgYWRtaW4gd2l0aG91dCBnbG9iYWwgYWNjZXNzOiBvbmx5IGJ1aWxkaW5ncyBmcm9tIHRoZWlyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYPCflI0gW0JVSUxESU5HUyBERUJVR10gVGFraW5nIEVMU0UgcGF0aCAtIFVzZXIgJHt1c2VyLmlkfSBvcmdhbml6YXRpb25zOmAsXG4gICAgICAgICAgdXNlci5vcmdhbml6YXRpb25zXG4gICAgICAgICk7XG4gICAgICAgIGlmICghdXNlci5vcmdhbml6YXRpb25zIHx8IHVzZXIub3JnYW5pemF0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDwn5SNIFtCVUlMRElOR1MgREVCVUddIFVzZXIgJHt1c2VyLmlkfSBoYXMgbm8gb3JnYW5pemF0aW9ucywgY2hlY2tpbmcgcmVzaWRlbmNlIGFjY2Vzcy4uLmBcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gRm9yIHRlbmFudC9yZXNpZGVudCByb2xlczogR2V0IGJ1aWxkaW5ncyB0aHJvdWdoIHRoZWlyIHJlc2lkZW5jZXNcbiAgICAgICAgICBpZiAoWyd0ZW5hbnQnLCAncmVzaWRlbnQnLCAnZGVtb190ZW5hbnQnLCAnZGVtb19yZXNpZGVudCddLmluY2x1ZGVzKHVzZXIucm9sZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VzTGlzdCA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHJlc2lkZW5jZXMuYnVpbGRpbmdJZCxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20odXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4ocmVzaWRlbmNlcywgZXEodXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoYW5kKGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCksIGVxKHVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgICAgYPCflI0gW0JVSUxESU5HUyBERUJVR10gRm91bmQgJHt1c2VyUmVzaWRlbmNlc0xpc3QubGVuZ3RofSByZXNpZGVuY2VzIGZvciB1c2VyICR7dXNlci5pZH1gXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBpZiAodXNlclJlc2lkZW5jZXNMaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICByZXR1cm4gcmVzLmpzb24oW10pOyAvLyBObyByZXNpZGVuY2VzID0gbm8gYnVpbGRpbmdzXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ0lkcyA9IFtcbiAgICAgICAgICAgICAgLi4ubmV3IFNldCh1c2VyUmVzaWRlbmNlc0xpc3QubWFwKCh1cikgPT4gdXIuYnVpbGRpbmdJZCkpLFxuICAgICAgICAgICAgXTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn5SNIFtCVUlMRElOR1MgREVCVUddIEFjY2Vzc2libGUgYnVpbGRpbmcgSURzOmAsIGFjY2Vzc2libGVCdWlsZGluZ0lkcyk7XG5cbiAgICAgICAgICAgIGJ1aWxkaW5nc1F1ZXJ5ID0gZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBidWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgICAgICBjaXR5OiBidWlsZGluZ3MuY2l0eSxcbiAgICAgICAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdzLnByb3ZpbmNlLFxuICAgICAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nVHlwZTogYnVpbGRpbmdzLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICAgICAgICB5ZWFyQnVpbHQ6IGJ1aWxkaW5ncy55ZWFyQnVpbHQsXG4gICAgICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5ncy50b3RhbEZsb29ycyxcbiAgICAgICAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ3MucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICAgIGlzQWN0aXZlOiBidWlsZGluZ3MuaXNBY3RpdmUsXG4gICAgICAgICAgICAgICAgY3JlYXRlZEF0OiBidWlsZGluZ3MuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSwgaW5BcnJheShidWlsZGluZ3MuaWQsIGFjY2Vzc2libGVCdWlsZGluZ0lkcykpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lLCBidWlsZGluZ3MubmFtZSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiByZXMuanNvbihbXSk7IC8vIE5vIG9yZ2FuaXphdGlvbnMgPSBubyBidWlsZGluZ3MgZm9yIG1hbmFnZXJzL2FkbWluc1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBVc2VyIGhhcyBvcmdhbml6YXRpb25zIC0gdXNlIG9yZ2FuaXphdGlvbi1iYXNlZCBhY2Nlc3NcbiAgICAgICAgICBidWlsZGluZ3NRdWVyeSA9IGRiXG4gICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgaWQ6IGJ1aWxkaW5ncy5pZCxcbiAgICAgICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgICAgICBjaXR5OiBidWlsZGluZ3MuY2l0eSxcbiAgICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgICAgIGJ1aWxkaW5nVHlwZTogYnVpbGRpbmdzLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ3MudG90YWxVbml0cyxcbiAgICAgICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5ncy50b3RhbEZsb29ycyxcbiAgICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgICAgICBjcmVhdGVkQXQ6IGJ1aWxkaW5ncy5jcmVhdGVkQXQsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgIGluQXJyYXkoYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLCB1c2VyLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5vcmRlckJ5KG9yZ2FuaXphdGlvbnMubmFtZSwgYnVpbGRpbmdzLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJ1aWxkaW5nc1F1ZXJ5O1xuXG4gICAgICByZXMuanNvbihyZXN1bHQpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBidWlsZGluZ3M6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGJ1aWxkaW5ncycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncyAtIFJldHJpZXZlcyBidWlsZGluZ3MgYmFzZWQgb24gdXNlciByb2xlIGFuZCBhc3NvY2lhdGlvbnMuXG4gICAqXG4gICAqIEFjY2VzcyBDb250cm9sIExvZ2ljOlxuICAgKiAtIEFkbWluOiBDYW4gc2VlIGFsbCBidWlsZGluZ3MgaW4gdGhlaXIgb3JnYW5pemF0aW9uICsgYnVpbGRpbmdzIHdoZXJlIHRoZXkgaGF2ZSByZXNpZGVuY2VzXG4gICAqIC0gTWFuYWdlcjogQ2FuIHNlZSBhbGwgYnVpbGRpbmdzIGluIHRoZWlyIG9yZ2FuaXphdGlvbiArIGJ1aWxkaW5ncyB3aGVyZSB0aGV5IGhhdmUgcmVzaWRlbmNlc1xuICAgKiAtIFJlc2lkZW50L1RlbmFudDogQ2FuIHNlZSBvbmx5IGJ1aWxkaW5ncyB3aGVyZSB0aGV5IGhhdmUgcmVzaWRlbmNlcyAocm9sZSBpcyBub3QgdXNlZCwgb25seSByZXNpZGVuY2UgbGlua3MpLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncycsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgLy8gQXV0aGVudGljYXRpb24gY2hlY2tcbiAgICBpZiAoIXJlcS5zZXNzaW9uPy51c2VySWQgJiYgIXJlcS5zZXNzaW9uPy51c2VyKSB7XG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIHNlc3Npb24gZGF0YSBkaXJlY3RseSBmb3Igbm93XG4gICAgICBsZXQgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcblxuICAgICAgLy8gSWYgd2Ugb25seSBoYXZlIHVzZXJJZCwgd2UgbmVlZCB0byBmZXRjaCB0aGUgdXNlclxuICAgICAgaWYgKCFjdXJyZW50VXNlciAmJiByZXEuc2Vzc2lvbj8udXNlcklkKSB7XG4gICAgICAgIC8vIEltcG9ydCBzdG9yYWdlIGZyb20gdGhlIGF1dGggcm91dGUgcGF0dGVyblxuICAgICAgICBjb25zdCB7IHN0b3JhZ2UgfSA9IGF3YWl0IGltcG9ydCgnLi4vc3RvcmFnZScpO1xuICAgICAgICBjdXJyZW50VXNlciA9IGF3YWl0IHN0b3JhZ2UuZ2V0VXNlcihyZXEuc2Vzc2lvbi51c2VySWQpO1xuICAgICAgfVxuXG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ1VzZXIgbm90IGZvdW5kJyxcbiAgICAgICAgICBjb2RlOiAnVVNFUl9OT1RfRk9VTkQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5OKIEZldGNoaW5nIGJ1aWxkaW5ncyBmb3IgdXNlciAke2N1cnJlbnRVc2VyLmlkfSB3aXRoIHJvbGUgJHtjdXJyZW50VXNlci5yb2xlfWBcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGFjY2Vzc2libGVCdWlsZGluZ3M6IGFueVtdID0gW107XG4gICAgICBjb25zdCBidWlsZGluZ0lkcyA9IG5ldyBTZXQ8c3RyaW5nPigpO1xuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGJlbG9uZ3MgdG8gS292ZW8gb3JnYW5pemF0aW9uIChzcGVjaWFsIGdsb2JhbCBhY2Nlc3MpXG4gICAgICBjb25zdCB1c2VyT3JncyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiB1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICBvcmdhbml6YXRpb25OYW1lOiBvcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9uczogdXNlck9yZ2FuaXphdGlvbnMuY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9ucyxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20odXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC5pbm5lckpvaW4ob3JnYW5pemF0aW9ucywgZXEodXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKGVxKHVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICk7XG5cbiAgICAgIGNvbnN0IGhhc0dsb2JhbEFjY2VzcyA9XG4gICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicgfHxcbiAgICAgICAgdXNlck9yZ3Muc29tZSgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uTmFtZSA9PT0gJ0tvdmVvJyB8fCBvcmcuY2FuQWNjZXNzQWxsT3JnYW5pemF0aW9ucyk7XG5cbiAgICAgIGlmIChoYXNHbG9iYWxBY2Nlc3MpIHtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYPCfjJ8gQWRtaW4gdXNlciBvciB1c2VyIHdpdGggZ2xvYmFsIGFjY2VzcyBkZXRlY3RlZCAtIGdyYW50aW5nIGFjY2VzcyB0byBBTEwgYnVpbGRpbmdzYFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEtvdmVvIHVzZXJzIGNhbiBzZWUgQUxMIGJ1aWxkaW5ncyBmcm9tIEFMTCBvcmdhbml6YXRpb25zXG4gICAgICAgIGNvbnN0IGFsbEJ1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IGJ1aWxkaW5ncy5jaXR5LFxuICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ3MuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdzLmFtZW5pdGllcyxcbiAgICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZ3MubWFuYWdlbWVudENvbXBhbnksXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogYnVpbGRpbmdzLnVwZGF0ZWRBdCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvblR5cGU6IG9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgLm9yZGVyQnkob3JnYW5pemF0aW9ucy5uYW1lLCBidWlsZGluZ3MubmFtZSk7XG5cbiAgICAgICAgLy8gQWRkIGFsbCBidWlsZGluZ3Mgd2l0aCBzcGVjaWFsIEtvdmVvIGFjY2VzcyB0eXBlXG4gICAgICAgIGFsbEJ1aWxkaW5ncy5mb3JFYWNoKChidWlsZGluZykgPT4ge1xuICAgICAgICAgIGlmICghYnVpbGRpbmdJZHMuaGFzKGJ1aWxkaW5nLmlkKSkge1xuICAgICAgICAgICAgYnVpbGRpbmdJZHMuYWRkKGJ1aWxkaW5nLmlkKTtcbiAgICAgICAgICAgIGFjY2Vzc2libGVCdWlsZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgIC4uLmJ1aWxkaW5nLFxuICAgICAgICAgICAgICBhY2Nlc3NUeXBlOiAna292ZW8tZ2xvYmFsJywgLy8gU3BlY2lhbCBhY2Nlc3MgdHlwZSBmb3IgS292ZW8gdXNlcnNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSZWd1bGFyIHVzZXJzOiBGb3IgQWRtaW4gYW5kIE1hbmFnZXIgcm9sZXM6IEdldCBidWlsZGluZ3MgZnJvbSB0aGVpciBvcmdhbml6YXRpb25zIG9ubHlcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicgfHwgY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInKSB7XG4gICAgICAgICAgaWYgKHVzZXJPcmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IG9yZ0lkcyA9IHVzZXJPcmdzLm1hcCgodW8pID0+IHVvLm9yZ2FuaXphdGlvbklkKTtcblxuICAgICAgICAgICAgLy8gR2V0IGFsbCBidWlsZGluZ3MgZnJvbSB0aGVzZSBvcmdhbml6YXRpb25zIG9ubHlcbiAgICAgICAgICAgIGNvbnN0IG9yZ0J1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBidWlsZGluZ3MuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgICAgYWRkcmVzczogYnVpbGRpbmdzLmFkZHJlc3MsXG4gICAgICAgICAgICAgICAgY2l0eTogYnVpbGRpbmdzLmNpdHksXG4gICAgICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZ3MucG9zdGFsQ29kZSxcbiAgICAgICAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5ncy5idWlsZGluZ1R5cGUsXG4gICAgICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5ncy50b3RhbFVuaXRzLFxuICAgICAgICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZ3MudG90YWxGbG9vcnMsXG4gICAgICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgICAgICAgc3RvcmFnZVNwYWNlczogYnVpbGRpbmdzLnN0b3JhZ2VTcGFjZXMsXG4gICAgICAgICAgICAgICAgYW1lbml0aWVzOiBidWlsZGluZ3MuYW1lbml0aWVzLFxuICAgICAgICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZ3MubWFuYWdlbWVudENvbXBhbnksXG4gICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCxcbiAgICAgICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmdzLmlzQWN0aXZlLFxuICAgICAgICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgICAgICB1cGRhdGVkQXQ6IGJ1aWxkaW5ncy51cGRhdGVkQXQsXG4gICAgICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogb3JnYW5pemF0aW9ucy5uYW1lLFxuICAgICAgICAgICAgICAgIG9yZ2FuaXphdGlvblR5cGU6IG9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShhbmQoaW5BcnJheShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ0lkcyksIGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAgICAgICAgICAgb3JnQnVpbGRpbmdzLmZvckVhY2goKGJ1aWxkaW5nKSA9PiB7XG4gICAgICAgICAgICAgIGlmICghYnVpbGRpbmdJZHMuaGFzKGJ1aWxkaW5nLmlkKSkge1xuICAgICAgICAgICAgICAgIGJ1aWxkaW5nSWRzLmFkZChidWlsZGluZy5pZCk7XG4gICAgICAgICAgICAgICAgYWNjZXNzaWJsZUJ1aWxkaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgIC4uLmJ1aWxkaW5nLFxuICAgICAgICAgICAgICAgICAgYWNjZXNzVHlwZTogJ29yZ2FuaXphdGlvbicsIC8vIFRyYWNrIGhvdyB1c2VyIGhhcyBhY2Nlc3NcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEZvciBBTEwgcm9sZXMgKEFkbWluLCBNYW5hZ2VyLCBSZXNpZGVudCwgVGVuYW50KTogR2V0IGJ1aWxkaW5ncyBmcm9tIHRoZWlyIHJlc2lkZW5jZXNcbiAgICAgIC8vIFRoaXMgaXMgdGhlIG1hbnktdG8tbWFueSByZWxhdGlvbnNoaXAgLSB1c2VycyBjYW4gaGF2ZSByZXNpZGVuY2VzIGluIGRpZmZlcmVudCBidWlsZGluZ3NcbiAgICAgIGNvbnN0IHVzZXJSZXNpZGVuY2VSZWNvcmRzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgcmVzaWRlbmNlSWQ6IHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IHVzZXJSZXNpZGVuY2VzLnJlbGF0aW9uc2hpcFR5cGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLCBlcSh1c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAgICAgaWYgKHVzZXJSZXNpZGVuY2VSZWNvcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gdXNlclJlc2lkZW5jZVJlY29yZHMubWFwKCh1cikgPT4gdXIucmVzaWRlbmNlSWQpO1xuXG4gICAgICAgIC8vIEdldCBidWlsZGluZ3MgdGhyb3VnaCByZXNpZGVuY2VzXG4gICAgICAgIGNvbnN0IHJlc2lkZW5jZUJ1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgICAgbmFtZTogYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ3MuYWRkcmVzcyxcbiAgICAgICAgICAgIGNpdHk6IGJ1aWxkaW5ncy5jaXR5LFxuICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5ncy5wcm92aW5jZSxcbiAgICAgICAgICAgIHBvc3RhbENvZGU6IGJ1aWxkaW5ncy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ3MuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ3MueWVhckJ1aWx0LFxuICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmdzLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmdzLnBhcmtpbmdTcGFjZXMsXG4gICAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ3Muc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdzLmFtZW5pdGllcyxcbiAgICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZ3MubWFuYWdlbWVudENvbXBhbnksXG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmdzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogYnVpbGRpbmdzLnVwZGF0ZWRBdCxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvblR5cGU6IG9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgIHJlc2lkZW5jZUlkOiByZXNpZGVuY2VzLmlkLFxuICAgICAgICAgICAgdW5pdE51bWJlcjogcmVzaWRlbmNlcy51bml0TnVtYmVyLFxuICAgICAgICAgICAgZmxvb3I6IHJlc2lkZW5jZXMuZmxvb3IsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAgIC5pbm5lckpvaW4oYnVpbGRpbmdzLCBlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5ncy5pZCkpXG4gICAgICAgICAgLmlubmVySm9pbihvcmdhbml6YXRpb25zLCBlcShidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgIC53aGVyZShhbmQoaW5BcnJheShyZXNpZGVuY2VzLmlkLCByZXNpZGVuY2VJZHMpLCBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKSk7XG5cbiAgICAgICAgLy8gQWRkIHJlc2lkZW5jZS1iYXNlZCBidWlsZGluZ3MgKGF2b2lkIGR1cGxpY2F0ZXMpXG4gICAgICAgIHJlc2lkZW5jZUJ1aWxkaW5ncy5mb3JFYWNoKChidWlsZGluZykgPT4ge1xuICAgICAgICAgIGlmICghYnVpbGRpbmdJZHMuaGFzKGJ1aWxkaW5nLmlkKSkge1xuICAgICAgICAgICAgYnVpbGRpbmdJZHMuYWRkKGJ1aWxkaW5nLmlkKTtcbiAgICAgICAgICAgIGFjY2Vzc2libGVCdWlsZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgIGlkOiBidWlsZGluZy5pZCxcbiAgICAgICAgICAgICAgbmFtZTogYnVpbGRpbmcubmFtZSxcbiAgICAgICAgICAgICAgYWRkcmVzczogYnVpbGRpbmcuYWRkcmVzcyxcbiAgICAgICAgICAgICAgY2l0eTogYnVpbGRpbmcuY2l0eSxcbiAgICAgICAgICAgICAgcHJvdmluY2U6IGJ1aWxkaW5nLnByb3ZpbmNlLFxuICAgICAgICAgICAgICBwb3N0YWxDb2RlOiBidWlsZGluZy5wb3N0YWxDb2RlLFxuICAgICAgICAgICAgICBidWlsZGluZ1R5cGU6IGJ1aWxkaW5nLmJ1aWxkaW5nVHlwZSxcbiAgICAgICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZy55ZWFyQnVpbHQsXG4gICAgICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5nLnRvdGFsVW5pdHMsXG4gICAgICAgICAgICAgIHRvdGFsRmxvb3JzOiBidWlsZGluZy50b3RhbEZsb29ycyxcbiAgICAgICAgICAgICAgcGFya2luZ1NwYWNlczogYnVpbGRpbmcucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICAgICAgc3RvcmFnZVNwYWNlczogYnVpbGRpbmcuc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICAgICAgYW1lbml0aWVzOiBidWlsZGluZy5hbWVuaXRpZXMsXG4gICAgICAgICAgICAgIG1hbmFnZW1lbnRDb21wYW55OiBidWlsZGluZy5tYW5hZ2VtZW50Q29tcGFueSxcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5nLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgICAgICBpc0FjdGl2ZTogYnVpbGRpbmcuaXNBY3RpdmUsXG4gICAgICAgICAgICAgIGNyZWF0ZWRBdDogYnVpbGRpbmcuY3JlYXRlZEF0LFxuICAgICAgICAgICAgICB1cGRhdGVkQXQ6IGJ1aWxkaW5nLnVwZGF0ZWRBdCxcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uTmFtZTogYnVpbGRpbmcub3JnYW5pemF0aW9uTmFtZSxcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uVHlwZTogYnVpbGRpbmcub3JnYW5pemF0aW9uVHlwZSxcbiAgICAgICAgICAgICAgYWNjZXNzVHlwZTogJ3Jlc2lkZW5jZScsIC8vIFRyYWNrIGhvdyB1c2VyIGhhcyBhY2Nlc3NcbiAgICAgICAgICAgICAgdXNlclJlc2lkZW5jZToge1xuICAgICAgICAgICAgICAgIHJlc2lkZW5jZUlkOiBidWlsZGluZy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICAgICAgICB1bml0TnVtYmVyOiBidWlsZGluZy51bml0TnVtYmVyLFxuICAgICAgICAgICAgICAgIGZsb29yOiBidWlsZGluZy5mbG9vcixcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBCdWlsZGluZyBhbHJlYWR5IGV4aXN0cywgYnV0IHdlIG1pZ2h0IHdhbnQgdG8gYWRkIHJlc2lkZW5jZSBpbmZvXG4gICAgICAgICAgICBjb25zdCBleGlzdGluZ0J1aWxkaW5nID0gYWNjZXNzaWJsZUJ1aWxkaW5ncy5maW5kKChiKSA9PiBiLmlkID09PSBidWlsZGluZy5pZCk7XG4gICAgICAgICAgICBpZiAoZXhpc3RpbmdCdWlsZGluZyAmJiAhZXhpc3RpbmdCdWlsZGluZy51c2VyUmVzaWRlbmNlKSB7XG4gICAgICAgICAgICAgIGV4aXN0aW5nQnVpbGRpbmcudXNlclJlc2lkZW5jZSA9IHtcbiAgICAgICAgICAgICAgICByZXNpZGVuY2VJZDogYnVpbGRpbmcucmVzaWRlbmNlSWQsXG4gICAgICAgICAgICAgICAgdW5pdE51bWJlcjogYnVpbGRpbmcudW5pdE51bWJlcixcbiAgICAgICAgICAgICAgICBmbG9vcjogYnVpbGRpbmcuZmxvb3IsXG4gICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgIC8vIFVwZGF0ZSBhY2Nlc3MgdHlwZSBpZiB0aGlzIGlzIGZyb20gYm90aCBvcmdhbml6YXRpb24gYW5kIHJlc2lkZW5jZVxuICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdCdWlsZGluZy5hY2Nlc3NUeXBlID09PSAnb3JnYW5pemF0aW9uJykge1xuICAgICAgICAgICAgICAgIGV4aXN0aW5nQnVpbGRpbmcuYWNjZXNzVHlwZSA9ICdib3RoJztcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBzdGF0aXN0aWNzIGZvciBlYWNoIGJ1aWxkaW5nXG4gICAgICBjb25zdCBidWlsZGluZ3NXaXRoU3RhdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgYWNjZXNzaWJsZUJ1aWxkaW5ncy5tYXAoYXN5bmMgKGJ1aWxkaW5nKSA9PiB7XG4gICAgICAgICAgLy8gR2V0IHJlc2lkZW5jZSBjb3VudFxuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZUNvdW50ID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoeyBjb3VudDogc3FsPG51bWJlcj5gY291bnQoKik6OmludGAgfSlcbiAgICAgICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgICAgICAud2hlcmUoYW5kKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmcuaWQpLCBlcShyZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICAgICAgLy8gQ2FsY3VsYXRlIG9jY3VwYW5jeSByYXRlXG4gICAgICAgICAgY29uc3Qgb2NjdXBpZWRVbml0cyA9IHJlc2lkZW5jZUNvdW50WzBdPy5jb3VudCB8fCAwO1xuICAgICAgICAgIGNvbnN0IG9jY3VwYW5jeVJhdGUgPVxuICAgICAgICAgICAgYnVpbGRpbmcudG90YWxVbml0cyA+IDAgPyBNYXRoLnJvdW5kKChvY2N1cGllZFVuaXRzIC8gYnVpbGRpbmcudG90YWxVbml0cykgKiAxMDApIDogMDtcblxuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAuLi5idWlsZGluZyxcbiAgICAgICAgICAgIHN0YXRpc3RpY3M6IHtcbiAgICAgICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmcudG90YWxVbml0cyxcbiAgICAgICAgICAgICAgb2NjdXBpZWRVbml0cyxcbiAgICAgICAgICAgICAgb2NjdXBhbmN5UmF0ZSxcbiAgICAgICAgICAgICAgdmFjYW50VW5pdHM6IGJ1aWxkaW5nLnRvdGFsVW5pdHMgLSBvY2N1cGllZFVuaXRzLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICB9O1xuICAgICAgICB9KVxuICAgICAgKTtcblxuICAgICAgLy8gU29ydCBidWlsZGluZ3MgYnkgbmFtZVxuICAgICAgYnVpbGRpbmdzV2l0aFN0YXRzLnNvcnQoKGEsIGIpID0+IGEubmFtZS5sb2NhbGVDb21wYXJlKGIubmFtZSkpO1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYOKchSBGb3VuZCAke2J1aWxkaW5nc1dpdGhTdGF0cy5sZW5ndGh9IGFjY2Vzc2libGUgYnVpbGRpbmdzIGZvciB1c2VyICR7Y3VycmVudFVzZXIuaWR9YFxuICAgICAgKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBidWlsZGluZ3M6IGJ1aWxkaW5nc1dpdGhTdGF0cyxcbiAgICAgICAgbWV0YToge1xuICAgICAgICAgIHRvdGFsOiBidWlsZGluZ3NXaXRoU3RhdHMubGVuZ3RoLFxuICAgICAgICAgIHVzZXJSb2xlOiBjdXJyZW50VXNlci5yb2xlLFxuICAgICAgICAgIHVzZXJJZDogY3VycmVudFVzZXIuaWQsXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgbWFuYWdlciBidWlsZGluZ3M6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGJ1aWxkaW5ncycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHRVQgL2FwaS9tYW5hZ2VyL2J1aWxkaW5ncy86aWQgLSBHZXQgYSBzcGVjaWZpYyBidWlsZGluZyB3aXRoIGRldGFpbGVkIGluZm9ybWF0aW9uXG4gICAqIFVzZXMgdGhlIHNhbWUgYWNjZXNzIGNvbnRyb2wgbG9naWMgYXMgdGhlIGxpc3QgZW5kcG9pbnQuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL21hbmFnZXIvYnVpbGRpbmdzLzppZCcsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XG5cbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdVbmF1dGhvcml6ZWQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYPCfk4ogRmV0Y2hpbmcgYnVpbGRpbmcgJHtidWlsZGluZ0lkfSBmb3IgdXNlciAke2N1cnJlbnRVc2VyLmlkfSB3aXRoIHJvbGUgJHtjdXJyZW50VXNlci5yb2xlfWBcbiAgICAgICk7XG5cbiAgICAgIGxldCBoYXNBY2Nlc3MgPSBmYWxzZTtcbiAgICAgIGxldCBhY2Nlc3NUeXBlID0gJyc7XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgYmVsb25ncyB0byBLb3ZlbyBvcmdhbml6YXRpb24gKHNwZWNpYWwgZ2xvYmFsIGFjY2VzcylcbiAgICAgIGNvbnN0IHVzZXJPcmdzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IHVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICBjYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zOiB1c2VyT3JnYW5pemF0aW9ucy5jYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbSh1c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgLmlubmVySm9pbihvcmdhbml6YXRpb25zLCBlcSh1c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoZXEodXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCBjdXJyZW50VXNlci5pZCksIGVxKHVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgKTtcblxuICAgICAgY29uc3QgaGFzR2xvYmFsQWNjZXNzID1cbiAgICAgICAgY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fFxuICAgICAgICB1c2VyT3Jncy5zb21lKChvcmcpID0+IG9yZy5vcmdhbml6YXRpb25OYW1lID09PSAnS292ZW8nIHx8IG9yZy5jYW5BY2Nlc3NBbGxPcmdhbml6YXRpb25zKTtcblxuICAgICAgaWYgKGhhc0dsb2JhbEFjY2Vzcykge1xuICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICBhY2Nlc3NUeXBlID0gJ2dsb2JhbCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBDaGVjayBvcmdhbml6YXRpb24tYmFzZWQgYWNjZXNzIGZvciBBZG1pbiBhbmQgTWFuYWdlclxuICAgICAgICBpZiAoY3VycmVudFVzZXIucm9sZSA9PT0gJ2FkbWluJyB8fCBjdXJyZW50VXNlci5yb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgICBpZiAodXNlck9yZ3MubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY29uc3Qgb3JnSWRzID0gdXNlck9yZ3MubWFwKCh1bykgPT4gdW8ub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgICAgICAvLyBDaGVjayBpZiBidWlsZGluZyBiZWxvbmdzIHRvIHVzZXIncyBvcmdhbml6YXRpb25zXG4gICAgICAgICAgICBjb25zdCBidWlsZGluZ09yZyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3QoeyBpZDogYnVpbGRpbmdzLmlkIH0pXG4gICAgICAgICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCksXG4gICAgICAgICAgICAgICAgICBpbkFycmF5KGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnSWRzKSxcbiAgICAgICAgICAgICAgICAgIGVxKGJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlmIChidWlsZGluZ09yZy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgIGFjY2Vzc1R5cGUgPSAnb3JnYW5pemF0aW9uJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcmVzaWRlbmNlLWJhc2VkIGFjY2VzcyBmb3IgYWxsIHJvbGVzXG4gICAgICBpZiAoIWhhc0FjY2Vzcykge1xuICAgICAgICBjb25zdCB1c2VyUmVzaWRlbmNlQWNjZXNzID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgcmVzaWRlbmNlSWQ6IHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkIH0pXG4gICAgICAgICAgLmZyb20odXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihyZXNpZGVuY2VzLCBlcSh1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlcy5pZCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcSh1c2VyUmVzaWRlbmNlcy51c2VySWQsIGN1cnJlbnRVc2VyLmlkKSxcbiAgICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSxcbiAgICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcblxuICAgICAgICBpZiAodXNlclJlc2lkZW5jZUFjY2Vzcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgaGFzQWNjZXNzID0gdHJ1ZTtcbiAgICAgICAgICBhY2Nlc3NUeXBlID0gYWNjZXNzVHlwZSA/ICdib3RoJyA6ICdyZXNpZGVuY2UnO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnRm9yYmlkZGVuJyxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGRvIG5vdCBoYXZlIGFjY2VzcyB0byB0aGlzIGJ1aWxkaW5nJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCBidWlsZGluZyBkZXRhaWxzXG4gICAgICBjb25zdCBidWlsZGluZ0RhdGEgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgIGFkZHJlc3M6IGJ1aWxkaW5ncy5hZGRyZXNzLFxuICAgICAgICAgIGNpdHk6IGJ1aWxkaW5ncy5jaXR5LFxuICAgICAgICAgIHByb3ZpbmNlOiBidWlsZGluZ3MucHJvdmluY2UsXG4gICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdzLnBvc3RhbENvZGUsXG4gICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ3MuYnVpbGRpbmdUeXBlLFxuICAgICAgICAgIHllYXJCdWlsdDogYnVpbGRpbmdzLnllYXJCdWlsdCxcbiAgICAgICAgICB0b3RhbFVuaXRzOiBidWlsZGluZ3MudG90YWxVbml0cyxcbiAgICAgICAgICB0b3RhbEZsb29yczogYnVpbGRpbmdzLnRvdGFsRmxvb3JzLFxuICAgICAgICAgIHBhcmtpbmdTcGFjZXM6IGJ1aWxkaW5ncy5wYXJraW5nU3BhY2VzLFxuICAgICAgICAgIHN0b3JhZ2VTcGFjZXM6IGJ1aWxkaW5ncy5zdG9yYWdlU3BhY2VzLFxuICAgICAgICAgIGFtZW5pdGllczogYnVpbGRpbmdzLmFtZW5pdGllcyxcbiAgICAgICAgICBtYW5hZ2VtZW50Q29tcGFueTogYnVpbGRpbmdzLm1hbmFnZW1lbnRDb21wYW55LFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgaXNBY3RpdmU6IGJ1aWxkaW5ncy5pc0FjdGl2ZSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJ1aWxkaW5ncy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBidWlsZGluZ3MudXBkYXRlZEF0LFxuICAgICAgICAgIG9yZ2FuaXphdGlvbk5hbWU6IG9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICBvcmdhbml6YXRpb25UeXBlOiBvcmdhbml6YXRpb25zLnR5cGUsXG4gICAgICAgICAgb3JnYW5pemF0aW9uQWRkcmVzczogb3JnYW5pemF0aW9ucy5hZGRyZXNzLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbkNpdHk6IG9yZ2FuaXphdGlvbnMuY2l0eSxcbiAgICAgICAgICBvcmdhbml6YXRpb25QaG9uZTogb3JnYW5pemF0aW9ucy5waG9uZSxcbiAgICAgICAgICBvcmdhbml6YXRpb25FbWFpbDogb3JnYW5pemF0aW9ucy5lbWFpbCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYnVpbGRpbmdzKVxuICAgICAgICAuaW5uZXJKb2luKG9yZ2FuaXphdGlvbnMsIGVxKGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9ucy5pZCkpXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKTtcblxuICAgICAgaWYgKGJ1aWxkaW5nRGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBfZXJyb3I6ICdOb3QgZm91bmQnLFxuICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYnVpbGRpbmcgPSBidWlsZGluZ0RhdGFbMF07XG5cbiAgICAgIC8vIEdldCBhbGwgcmVzaWRlbmNlcyBmb3IgdGhpcyBidWlsZGluZ1xuICAgICAgY29uc3QgYnVpbGRpbmdSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IHJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgdW5pdE51bWJlcjogcmVzaWRlbmNlcy51bml0TnVtYmVyLFxuICAgICAgICAgIGZsb29yOiByZXNpZGVuY2VzLmZsb29yLFxuICAgICAgICAgIHNxdWFyZUZvb3RhZ2U6IHJlc2lkZW5jZXMuc3F1YXJlRm9vdGFnZSxcbiAgICAgICAgICBiZWRyb29tczogcmVzaWRlbmNlcy5iZWRyb29tcyxcbiAgICAgICAgICBiYXRocm9vbXM6IHJlc2lkZW5jZXMuYmF0aHJvb21zLFxuICAgICAgICAgIGJhbGNvbnk6IHJlc2lkZW5jZXMuYmFsY29ueSxcbiAgICAgICAgICBwYXJraW5nU3BhY2VOdW1iZXJzOiByZXNpZGVuY2VzLnBhcmtpbmdTcGFjZU51bWJlcnMsXG4gICAgICAgICAgc3RvcmFnZVNwYWNlTnVtYmVyczogcmVzaWRlbmNlcy5zdG9yYWdlU3BhY2VOdW1iZXJzLFxuICAgICAgICAgIG1vbnRobHlGZWVzOiByZXNpZGVuY2VzLm1vbnRobHlGZWVzLFxuICAgICAgICAgIGlzQWN0aXZlOiByZXNpZGVuY2VzLmlzQWN0aXZlLFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShyZXNpZGVuY2VzKVxuICAgICAgICAud2hlcmUoYW5kKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSk7XG5cbiAgICAgIC8vIEdldCB1c2VyJ3MgcmVzaWRlbmNlcyBpbiB0aGlzIGJ1aWxkaW5nIGlmIGFueVxuICAgICAgbGV0IHVzZXJSZXNpZGVuY2VzSW5CdWlsZGluZzogdW5rbm93bltdID0gW107XG4gICAgICBjb25zdCB1c2VyUmVzaWRlbmNlUmVjb3JkcyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIHJlc2lkZW5jZUlkOiB1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICByZWxhdGlvbnNoaXBUeXBlOiB1c2VyUmVzaWRlbmNlcy5yZWxhdGlvbnNoaXBUeXBlLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogdXNlclJlc2lkZW5jZXMuc3RhcnREYXRlLFxuICAgICAgICAgIGVuZERhdGU6IHVzZXJSZXNpZGVuY2VzLmVuZERhdGUsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKHVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAuaW5uZXJKb2luKHJlc2lkZW5jZXMsIGVxKHVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgY3VycmVudFVzZXIuaWQpLFxuICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSxcbiAgICAgICAgICAgIGVxKHVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgaWYgKHVzZXJSZXNpZGVuY2VSZWNvcmRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdXNlclJlc2lkZW5jZXNJbkJ1aWxkaW5nID0gdXNlclJlc2lkZW5jZVJlY29yZHMubWFwKCh1cikgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlc2lkZW5jZSA9IGJ1aWxkaW5nUmVzaWRlbmNlcy5maW5kKChyKSA9PiByLmlkID09PSB1ci5yZXNpZGVuY2VJZCk7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIC4uLnJlc2lkZW5jZSxcbiAgICAgICAgICAgIHJlbGF0aW9uc2hpcFR5cGU6IHVyLnJlbGF0aW9uc2hpcFR5cGUsXG4gICAgICAgICAgICBzdGFydERhdGU6IHVyLnN0YXJ0RGF0ZSxcbiAgICAgICAgICAgIGVuZERhdGU6IHVyLmVuZERhdGUsXG4gICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBzdGF0aXN0aWNzXG4gICAgICBjb25zdCBvY2N1cGllZFVuaXRzID0gYnVpbGRpbmdSZXNpZGVuY2VzLmxlbmd0aDtcbiAgICAgIGNvbnN0IG9jY3VwYW5jeVJhdGUgPVxuICAgICAgICBidWlsZGluZy50b3RhbFVuaXRzID4gMCA/IE1hdGgucm91bmQoKG9jY3VwaWVkVW5pdHMgLyBidWlsZGluZy50b3RhbFVuaXRzKSAqIDEwMCkgOiAwO1xuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIC4uLmJ1aWxkaW5nLFxuICAgICAgICBhY2Nlc3NUeXBlLFxuICAgICAgICBzdGF0aXN0aWNzOiB7XG4gICAgICAgICAgdG90YWxVbml0czogYnVpbGRpbmcudG90YWxVbml0cyxcbiAgICAgICAgICBvY2N1cGllZFVuaXRzLFxuICAgICAgICAgIG9jY3VwYW5jeVJhdGUsXG4gICAgICAgICAgdmFjYW50VW5pdHM6IGJ1aWxkaW5nLnRvdGFsVW5pdHMgLSBvY2N1cGllZFVuaXRzLFxuICAgICAgICAgIHRvdGFsUmVzaWRlbmNlczogYnVpbGRpbmdSZXNpZGVuY2VzLmxlbmd0aCxcbiAgICAgICAgfSxcbiAgICAgICAgdXNlclJlc2lkZW5jZXM6IHVzZXJSZXNpZGVuY2VzSW5CdWlsZGluZyxcbiAgICAgICAgLy8gT25seSBpbmNsdWRlIGZ1bGwgcmVzaWRlbmNlIGxpc3QgZm9yIG1hbmFnZXJzL2FkbWluc1xuICAgICAgICByZXNpZGVuY2VzOlxuICAgICAgICAgIGN1cnJlbnRVc2VyLnJvbGUgPT09ICdhZG1pbicgfHwgY3VycmVudFVzZXIucm9sZSA9PT0gJ21hbmFnZXInXG4gICAgICAgICAgICA/IGJ1aWxkaW5nUmVzaWRlbmNlc1xuICAgICAgICAgICAgOiB1bmRlZmluZWQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYnVpbGRpbmcgZGV0YWlsczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIF9lcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYnVpbGRpbmcgZGV0YWlscycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBQT1NUIC9hcGkvYWRtaW4vYnVpbGRpbmdzIC0gQ3JlYXRlIGEgbmV3IGJ1aWxkaW5nIChBZG1pbiBvbmx5KS5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2FkbWluL2J1aWxkaW5ncycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlcykgPT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFkbWluXG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQWRtaW4gYWNjZXNzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQURNSU5fUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYnVpbGRpbmdEYXRhID0gcmVxLmJvZHk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlcXVpcmVkIGZpZWxkc1xuICAgICAgaWYgKCFidWlsZGluZ0RhdGEubmFtZSB8fCAhYnVpbGRpbmdEYXRhLm9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnVmFsaWRhdGlvbiBlcnJvcicsXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5hbWUgYW5kIG9yZ2FuaXphdGlvbiBhcmUgcmVxdWlyZWQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIGJ1aWxkaW5nIHdpdGggSURcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSBjcnlwdG8ucmFuZG9tVVVJRCgpO1xuXG4gICAgICBjb25zdCBuZXdCdWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoYnVpbGRpbmdzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBpZDogYnVpbGRpbmdJZCxcbiAgICAgICAgICBuYW1lOiBidWlsZGluZ0RhdGEubmFtZSxcbiAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ0RhdGEuYWRkcmVzcyB8fCAnJyxcbiAgICAgICAgICBjaXR5OiBidWlsZGluZ0RhdGEuY2l0eSB8fCAnJyxcbiAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdEYXRhLnByb3ZpbmNlIHx8ICdRQycsXG4gICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdEYXRhLnBvc3RhbENvZGUgfHwgJycsXG4gICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ0RhdGEuYnVpbGRpbmdUeXBlIHx8ICdjb25kbycsXG4gICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ0RhdGEueWVhckJ1aWx0LFxuICAgICAgICAgIHRvdGFsVW5pdHM6IGJ1aWxkaW5nRGF0YS50b3RhbFVuaXRzIHx8IDAsXG4gICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5nRGF0YS50b3RhbEZsb29ycyxcbiAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ0RhdGEucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ0RhdGEuc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICBhbWVuaXRpZXM6IGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXMgPyBKU09OLnN0cmluZ2lmeShidWlsZGluZ0RhdGEuYW1lbml0aWVzKSA6IG51bGwsXG4gICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IGJ1aWxkaW5nRGF0YS5tYW5hZ2VtZW50Q29tcGFueSxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdEYXRhLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIGlzQWN0aXZlOiB0cnVlLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuXG4gICAgICAvLyBCdWlsZGluZyBzdG9yYWdlIGhpZXJhcmNoeSB3aWxsIGJlIGNyZWF0ZWQgYXV0b21hdGljYWxseSB3aGVuIGRvY3VtZW50cyBhcmUgdXBsb2FkZWRcbiAgICAgIGNvbnNvbGUubG9nKCdCdWlsZGluZyBjcmVhdGVkIC0gc3RvcmFnZSBoaWVyYXJjaHkgd2lsbCBiZSBjcmVhdGVkIG9uIGZpcnN0IGRvY3VtZW50IHVwbG9hZCcpO1xuXG4gICAgICAvLyBBdXRvLWdlbmVyYXRlIHJlc2lkZW5jZXMgaWYgdG90YWxVbml0cyBpcyBzcGVjaWZpZWQgYW5kIDw9IDMwMFxuICAgICAgaWYgKFxuICAgICAgICBidWlsZGluZ0RhdGEudG90YWxVbml0cyAmJlxuICAgICAgICBidWlsZGluZ0RhdGEudG90YWxVbml0cyA+IDAgJiZcbiAgICAgICAgYnVpbGRpbmdEYXRhLnRvdGFsVW5pdHMgPD0gMzAwXG4gICAgICApIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB0b3RhbFVuaXRzID0gYnVpbGRpbmdEYXRhLnRvdGFsVW5pdHM7XG4gICAgICAgICAgY29uc3QgdG90YWxGbG9vcnMgPSBidWlsZGluZ0RhdGEudG90YWxGbG9vcnMgfHwgMTtcbiAgICAgICAgICBjb25zdCB1bml0c1BlckZsb29yID0gTWF0aC5jZWlsKHRvdGFsVW5pdHMgLyB0b3RhbEZsb29ycyk7XG5cbiAgICAgICAgICBjb25zdCByZXNpZGVuY2VzVG9DcmVhdGUgPSBbXTtcbiAgICAgICAgICBmb3IgKGxldCB1bml0ID0gMTsgdW5pdCA8PSB0b3RhbFVuaXRzOyB1bml0KyspIHtcbiAgICAgICAgICAgIGNvbnN0IGZsb29yID0gTWF0aC5jZWlsKHVuaXQgLyB1bml0c1BlckZsb29yKTtcbiAgICAgICAgICAgIGNvbnN0IHVuaXRPbkZsb29yID0gKCh1bml0IC0gMSkgJSB1bml0c1BlckZsb29yKSArIDE7XG4gICAgICAgICAgICBjb25zdCB1bml0TnVtYmVyID0gYCR7Zmxvb3J9JHt1bml0T25GbG9vci50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyl9YDtcblxuICAgICAgICAgICAgcmVzaWRlbmNlc1RvQ3JlYXRlLnB1c2goe1xuICAgICAgICAgICAgICBidWlsZGluZ0lkOiBidWlsZGluZ0lkLFxuICAgICAgICAgICAgICB1bml0TnVtYmVyLFxuICAgICAgICAgICAgICBmbG9vcixcbiAgICAgICAgICAgICAgaXNBY3RpdmU6IHRydWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBJbnNlcnQgYWxsIHJlc2lkZW5jZXMgYXQgb25jZVxuICAgICAgICAgIGNvbnN0IGNyZWF0ZWRSZXNpZGVuY2VzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5pbnNlcnQocmVzaWRlbmNlcylcbiAgICAgICAgICAgIC52YWx1ZXMocmVzaWRlbmNlc1RvQ3JlYXRlKVxuICAgICAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg4pyFIEF1dG8tZ2VuZXJhdGVkICR7Y3JlYXRlZFJlc2lkZW5jZXMubGVuZ3RofSByZXNpZGVuY2VzIGZvciBidWlsZGluZyAke2J1aWxkaW5nSWR9YFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBUT0RPOiBPYmplY3Qgc3RvcmFnZSBzZXJ2aWNlIGludGVncmF0aW9uXG4gICAgICAgICAgLy8gQ3JlYXRlIG9iamVjdCBzdG9yYWdlIGhpZXJhcmNoeSBmb3IgZWFjaCByZXNpZGVuY2VcbiAgICAgICAgICAvLyBmb3IgKGNvbnN0IHJlc2lkZW5jZSBvZiBjcmVhdGVkUmVzaWRlbmNlcykge1xuICAgICAgICAgIC8vICAgYXdhaXQgb2JqZWN0U3RvcmFnZVNlcnZpY2UuY3JlYXRlUmVzaWRlbmNlSGllcmFyY2h5KFxuICAgICAgICAgIC8vICAgICBidWlsZGluZ0RhdGEub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgLy8gICAgIGJ1aWxkaW5nSWQsXG4gICAgICAgICAgLy8gICAgIHJlc2lkZW5jZS5pZFxuICAgICAgICAgIC8vICAgKTtcbiAgICAgICAgICAvLyB9XG4gICAgICAgIH0gY2F0Y2ggKF9fX3Jlc2lkZW5jZUVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcign4pqg77iPIEVycm9yIGF1dG8tZ2VuZXJhdGluZyByZXNpZGVuY2VzOicsIF9fX3Jlc2lkZW5jZUVycm9yKTtcbiAgICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSBidWlsZGluZyBjcmVhdGlvbiBpZiByZXNpZGVuY2UgZ2VuZXJhdGlvbiBmYWlsc1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgYnVpbGRpbmc6IG5ld0J1aWxkaW5nWzBdLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIGJ1aWxkaW5nOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBjcmVhdGUgYnVpbGRpbmcnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvYnVpbGRpbmdzLzppZC9yZXNpZGVuY2VzLWZvci1kZWxldGlvbiAtIEdldCBsaXN0IG9mIHJlc2lkZW5jZXMgdGhhdCBjYW4gYmUgc2VsZWN0ZWQgZm9yIGRlbGV0aW9uXG4gICAqIE9ubHkgYWRtaW5zIGNhbiBhY2Nlc3MgdGhpcyBlbmRwb2ludFxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9idWlsZGluZ3MvOmlkL3Jlc2lkZW5jZXMtZm9yLWRlbGV0aW9uJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHVzZXIgPSByZXEudXNlcjtcbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSByZXEucGFyYW1zLmlkO1xuICAgICAgY29uc3QgbWF4VG9TZWxlY3QgPSBwYXJzZUludChyZXEucXVlcnkubWF4VG9TZWxlY3QgYXMgc3RyaW5nKSB8fCAxMDtcblxuICAgICAgaWYgKCF1c2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7IG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgcmVzaWRlbmNlc1xuICAgICAgaWYgKHVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oeyBtZXNzYWdlOiAnT25seSBhZG1pbnMgY2FuIGFjY2VzcyByZXNpZGVuY2UgZGVsZXRpb24gb3B0aW9ucycgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZ2V0UmVzaWRlbmNlc0ZvclNlbGVjdGlvbiB9ID0gYXdhaXQgaW1wb3J0KCcuL2J1aWxkaW5ncy9vcGVyYXRpb25zJyk7XG4gICAgICBjb25zdCByZXNpZGVuY2VzVG9TZWxlY3QgPSBhd2FpdCBnZXRSZXNpZGVuY2VzRm9yU2VsZWN0aW9uKGJ1aWxkaW5nSWQsIG1heFRvU2VsZWN0KTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICByZXNpZGVuY2VzOiByZXNpZGVuY2VzVG9TZWxlY3QsXG4gICAgICAgIG1lc3NhZ2U6IGBGb3VuZCAke3Jlc2lkZW5jZXNUb1NlbGVjdC5sZW5ndGh9IHJlc2lkZW5jZXMgYXZhaWxhYmxlIGZvciBkZWxldGlvbmBcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyByZXNpZGVuY2VzIGZvciBkZWxldGlvbjonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggcmVzaWRlbmNlcyBmb3IgZGVsZXRpb24nIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERFTEVURSAvYXBpL2J1aWxkaW5ncy86aWQvcmVzaWRlbmNlcyAtIERlbGV0ZSBzZWxlY3RlZCByZXNpZGVuY2VzXG4gICAqIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgcmVzaWRlbmNlc1xuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS9idWlsZGluZ3MvOmlkL3Jlc2lkZW5jZXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdXNlciA9IHJlcS51c2VyO1xuICAgICAgY29uc3QgYnVpbGRpbmdJZCA9IHJlcS5wYXJhbXMuaWQ7XG4gICAgICBjb25zdCB7IHJlc2lkZW5jZUlkcyB9ID0gcmVxLmJvZHk7XG5cbiAgICAgIGlmICghdXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oeyBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBPbmx5IGFkbWlucyBjYW4gZGVsZXRlIHJlc2lkZW5jZXNcbiAgICAgIGlmICh1c2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHsgbWVzc2FnZTogJ09ubHkgYWRtaW5zIGNhbiBkZWxldGUgcmVzaWRlbmNlcycgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmICghQXJyYXkuaXNBcnJheShyZXNpZGVuY2VJZHMpIHx8IHJlc2lkZW5jZUlkcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ3Jlc2lkZW5jZUlkcyBhcnJheSBpcyByZXF1aXJlZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZGVsZXRlU2VsZWN0ZWRSZXNpZGVuY2VzIH0gPSBhd2FpdCBpbXBvcnQoJy4vYnVpbGRpbmdzL29wZXJhdGlvbnMnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRlbGV0ZVNlbGVjdGVkUmVzaWRlbmNlcyhidWlsZGluZ0lkLCByZXNpZGVuY2VJZHMsIHVzZXIucm9sZSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGVsZXRlZENvdW50OiByZXN1bHQuZGVsZXRlZENvdW50LFxuICAgICAgICBkb2N1bWVudHNEZWxldGVkOiByZXN1bHQuZG9jdW1lbnRzRGVsZXRlZCxcbiAgICAgICAgbWVzc2FnZTogYFN1Y2Nlc3NmdWxseSBkZWxldGVkICR7cmVzdWx0LmRlbGV0ZWRDb3VudH0gcmVzaWRlbmNlcyBhbmQgJHtyZXN1bHQuZG9jdW1lbnRzRGVsZXRlZH0gYXNzb2NpYXRlZCBkb2N1bWVudHNgXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgcmVzaWRlbmNlczonLCBlcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBkZWxldGUgcmVzaWRlbmNlcycgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogUFVUIC9hcGkvYWRtaW4vYnVpbGRpbmdzLzppZCAtIFVwZGF0ZSBhIGJ1aWxkaW5nIChBZG1pbiBhbmQgTWFuYWdlcikuXG4gICAqL1xuICBhcHAucHV0KCcvYXBpL2FkbWluL2J1aWxkaW5ncy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhZG1pbiBvciBtYW5hZ2VyXG4gICAgICBjb25zdCBjdXJyZW50VXNlciA9IHJlcS51c2VyIHx8IHJlcS5zZXNzaW9uPy51c2VyO1xuICAgICAgaWYgKCFjdXJyZW50VXNlcikge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FVVEhfUkVRVUlSRUQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicgJiYgY3VycmVudFVzZXIucm9sZSAhPT0gJ21hbmFnZXInKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIG9yIE1hbmFnZXIgYWNjZXNzIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQURNSU5fTUFOQUdFUl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidWlsZGluZ0lkID0gcmVxLnBhcmFtcy5pZDtcbiAgICAgIGNvbnN0IGJ1aWxkaW5nRGF0YSA9IHJlcS5ib2R5O1xuXG4gICAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBmaWVsZHNcbiAgICAgIGlmICghYnVpbGRpbmdEYXRhLm5hbWUgfHwgIWJ1aWxkaW5nRGF0YS5vcmdhbml6YXRpb25JZCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ1ZhbGlkYXRpb24gZXJyb3InLFxuICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyBuYW1lIGFuZCBvcmdhbml6YXRpb24gYXJlIHJlcXVpcmVkJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGJ1aWxkaW5nIGV4aXN0c1xuICAgICAgY29uc3QgZXhpc3RpbmdCdWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChleGlzdGluZ0J1aWxkaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBjdXJyZW50IG51bWJlciBvZiBhY3RpdmUgcmVzaWRlbmNlc1xuICAgICAgY29uc3QgY3VycmVudFJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KCopOjppbnRgIH0pXG4gICAgICAgIC5mcm9tKHJlc2lkZW5jZXMpXG4gICAgICAgIC53aGVyZShhbmQoZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgZXEocmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpKTtcblxuICAgICAgY29uc3QgY3VycmVudFJlc2lkZW5jZUNvdW50ID0gY3VycmVudFJlc2lkZW5jZXNbMF0/LmNvdW50IHx8IDA7XG4gICAgICBjb25zdCBuZXdUb3RhbFVuaXRzID0gYnVpbGRpbmdEYXRhLnRvdGFsVW5pdHMgfHwgMDtcbiAgICAgIGNvbnN0IHByZXZpb3VzVG90YWxVbml0cyA9IGV4aXN0aW5nQnVpbGRpbmdbMF0udG90YWxVbml0cyB8fCAwO1xuXG4gICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgYPCflIQgQnVpbGRpbmcgJHtidWlsZGluZ0lkfTogJHtwcmV2aW91c1RvdGFsVW5pdHN9IOKGkiAke25ld1RvdGFsVW5pdHN9IHVuaXRzIChjdXJyZW50bHkgaGFzICR7Y3VycmVudFJlc2lkZW5jZUNvdW50fSBhY3RpdmUgcmVzaWRlbmNlcylgXG4gICAgICApO1xuXG4gICAgICAvLyBVcGRhdGUgYnVpbGRpbmdcbiAgICAgIGNvbnN0IHVwZGF0ZWRCdWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoYnVpbGRpbmdzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBuYW1lOiBidWlsZGluZ0RhdGEubmFtZSxcbiAgICAgICAgICBhZGRyZXNzOiBidWlsZGluZ0RhdGEuYWRkcmVzcyB8fCAnJyxcbiAgICAgICAgICBjaXR5OiBidWlsZGluZ0RhdGEuY2l0eSB8fCAnJyxcbiAgICAgICAgICBwcm92aW5jZTogYnVpbGRpbmdEYXRhLnByb3ZpbmNlIHx8ICdRQycsXG4gICAgICAgICAgcG9zdGFsQ29kZTogYnVpbGRpbmdEYXRhLnBvc3RhbENvZGUgfHwgJycsXG4gICAgICAgICAgYnVpbGRpbmdUeXBlOiBidWlsZGluZ0RhdGEuYnVpbGRpbmdUeXBlIHx8ICdjb25kbycsXG4gICAgICAgICAgeWVhckJ1aWx0OiBidWlsZGluZ0RhdGEueWVhckJ1aWx0LFxuICAgICAgICAgIHRvdGFsVW5pdHM6IG5ld1RvdGFsVW5pdHMsXG4gICAgICAgICAgdG90YWxGbG9vcnM6IGJ1aWxkaW5nRGF0YS50b3RhbEZsb29ycyxcbiAgICAgICAgICBwYXJraW5nU3BhY2VzOiBidWlsZGluZ0RhdGEucGFya2luZ1NwYWNlcyxcbiAgICAgICAgICBzdG9yYWdlU3BhY2VzOiBidWlsZGluZ0RhdGEuc3RvcmFnZVNwYWNlcyxcbiAgICAgICAgICBhbWVuaXRpZXM6IGJ1aWxkaW5nRGF0YS5hbWVuaXRpZXMgPyBKU09OLnN0cmluZ2lmeShidWlsZGluZ0RhdGEuYW1lbml0aWVzKSA6IG51bGwsXG4gICAgICAgICAgbWFuYWdlbWVudENvbXBhbnk6IGJ1aWxkaW5nRGF0YS5tYW5hZ2VtZW50Q29tcGFueSxcbiAgICAgICAgICBvcmdhbml6YXRpb25JZDogYnVpbGRpbmdEYXRhLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gSGFuZGxlIHJlc2lkZW5jZSBjb3VudCBjaGFuZ2VzIHdpdGggbmV3IGFkbWluLW9ubHkgZnVuY3Rpb25hbGl0eVxuICAgICAgaWYgKG5ld1RvdGFsVW5pdHMgIT09IHByZXZpb3VzVG90YWxVbml0cykge1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+PoCBCdWlsZGluZyB1bml0cyBjaGFuZ2VkIGZyb20gJHtwcmV2aW91c1RvdGFsVW5pdHN9IHRvICR7bmV3VG90YWxVbml0c30sIGFkanVzdGluZyByZXNpZGVuY2VzLi4uYCk7XG4gICAgICAgIFxuICAgICAgICAvLyBPbmx5IGFkbWlucyBjYW4gYWRqdXN0IHJlc2lkZW5jZSBjb3VudHNcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgICAgbWVzc2FnZTogJ09ubHkgYWRtaW5zIGNhbiBpbmNyZWFzZSBvciBkZWNyZWFzZSBidWlsZGluZyByZXNpZGVuY2UgY291bnRzJyxcbiAgICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRF9GT1JfUkVTSURFTkNFX0NIQU5HRVMnLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgeyBhZGp1c3RSZXNpZGVuY2VDb3VudCB9ID0gYXdhaXQgaW1wb3J0KCcuL2J1aWxkaW5ncy9vcGVyYXRpb25zJyk7XG4gICAgICAgIGNvbnN0IGFkanVzdG1lbnRSZXN1bHQgPSBhd2FpdCBhZGp1c3RSZXNpZGVuY2VDb3VudChcbiAgICAgICAgICBidWlsZGluZ0lkLFxuICAgICAgICAgIGV4aXN0aW5nQnVpbGRpbmdbMF0ub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgbmV3VG90YWxVbml0cyxcbiAgICAgICAgICBwcmV2aW91c1RvdGFsVW5pdHMsXG4gICAgICAgICAgYnVpbGRpbmdEYXRhLnRvdGFsRmxvb3JzIHx8IGV4aXN0aW5nQnVpbGRpbmdbMF0udG90YWxGbG9vcnMgfHwgMVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIElmIHJlc2lkZW5jZXMgbmVlZCB0byBiZSBkZWNyZWFzZWQsIHJldHVybiB0aGUgc2VsZWN0aW9uIGxpc3QgdG8gdXNlclxuICAgICAgICBpZiAoYWRqdXN0bWVudFJlc3VsdC5hY3Rpb24gPT09ICdkZWNyZWFzZWQnICYmIGFkanVzdG1lbnRSZXN1bHQucmVzaWRlbmNlc1RvU2VsZWN0KSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5qc29uKHtcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyB1cGRhdGVkLCBidXQgcmVzaWRlbmNlIGNvdW50IG5lZWRzIHRvIGJlIHJlZHVjZWQnLFxuICAgICAgICAgICAgYnVpbGRpbmdVcGRhdGVkOiB0cnVlLFxuICAgICAgICAgICAgbmVlZHNSZXNpZGVuY2VTZWxlY3Rpb246IHRydWUsXG4gICAgICAgICAgICByZXNpZGVuY2VzVG9TZWxlY3Q6IGFkanVzdG1lbnRSZXN1bHQucmVzaWRlbmNlc1RvU2VsZWN0LFxuICAgICAgICAgICAgaW5zdHJ1Y3Rpb246IGBQbGVhc2Ugc2VsZWN0ICR7cHJldmlvdXNUb3RhbFVuaXRzIC0gbmV3VG90YWxVbml0c30gcmVzaWRlbmNlcyB0byBkZWxldGUgZnJvbSB0aGUgbGlzdCBwcm92aWRlZC4gVXNlIERFTEVURSAvYXBpL2J1aWxkaW5ncy8ke2J1aWxkaW5nSWR9L3Jlc2lkZW5jZXMgd2l0aCB0aGUgc2VsZWN0ZWQgcmVzaWRlbmNlIElEcy5gXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuXG4gICAgICByZXMuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdCdWlsZGluZyB1cGRhdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGJ1aWxkaW5nOiB1cGRhdGVkQnVpbGRpbmdbMF0sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgYnVpbGRpbmc6JywgZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBfZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwZGF0ZSBidWlsZGluZycsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBERUxFVEUgL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkIC0gRGVsZXRlIGEgYnVpbGRpbmcgKEFkbWluIG9ubHkpLlxuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidWlsZGluZ0lkID0gcmVxLnBhcmFtcy5pZDtcblxuICAgICAgLy8gQ2hlY2sgaWYgYnVpbGRpbmcgZXhpc3RzXG4gICAgICBjb25zdCBleGlzdGluZ0J1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGV4aXN0aW5nQnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNvZnQgZGVsZXRlIGJ5IHNldHRpbmcgaXNBY3RpdmUgdG8gZmFsc2VcbiAgICAgIGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoYnVpbGRpbmdzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSk7XG5cblxuICAgICAgLy8gT2JqZWN0IHN0b3JhZ2UgY2xlYW51cCB3aWxsIGJlIGhhbmRsZWQgYXV0b21hdGljYWxseVxuICAgICAgY29uc29sZS5sb2coJ0J1aWxkaW5nIGRlbGV0ZWQgLSBzdG9yYWdlIGNsZWFudXAgd2lsbCBiZSBoYW5kbGVkIGF1dG9tYXRpY2FsbHknKTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlbGV0aW5nIGJ1aWxkaW5nOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgYnVpbGRpbmcnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR0VUIC9hcGkvYWRtaW4vYnVpbGRpbmdzLzppZC9kZWxldGlvbi1pbXBhY3QgLSBHZXQgZGVsZXRpb24gaW1wYWN0IGFuYWx5c2lzXG4gICAqIFNob3dzIHdoYXQgd2lsbCBiZSBkZWxldGVkIHdoZW4gcmVtb3ZpbmcgYSBidWlsZGluZy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYWRtaW4vYnVpbGRpbmdzLzppZC9kZWxldGlvbi1pbXBhY3QnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXMpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudFVzZXIgPSByZXEudXNlciB8fCByZXEuc2Vzc2lvbj8udXNlcjtcbiAgICAgIGlmICghY3VycmVudFVzZXIpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjdXJyZW50VXNlci5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FkbWluIGFjY2VzcyByZXF1aXJlZCcsXG4gICAgICAgICAgY29kZTogJ0FETUlOX1JFUVVJUkVEJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJ1aWxkaW5nSWQgPSByZXEucGFyYW1zLmlkO1xuXG4gICAgICAvLyBDaGVjayBpZiBidWlsZGluZyBleGlzdHNcbiAgICAgIGNvbnN0IGJ1aWxkaW5nID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGlkOiBidWlsZGluZ3MuaWQsIG5hbWU6IGJ1aWxkaW5ncy5uYW1lIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGFuZChlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpLCBlcShidWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgX2Vycm9yOiAnTm90IGZvdW5kJyxcbiAgICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENvdW50IHJlc2lkZW5jZXMgaW4gdGhpcyBidWlsZGluZ1xuICAgICAgY29uc3QgcmVzaWRlbmNlc0NvdW50ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBzcWw8bnVtYmVyPmBjb3VudCgqKWAgfSlcbiAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgLndoZXJlKGFuZChlcShyZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBlcShyZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSkpO1xuXG4gICAgICAvLyBDb3VudCBkb2N1bWVudHMgYXNzb2NpYXRlZCB3aXRoIHRoaXMgYnVpbGRpbmcgb3IgaXRzIHJlc2lkZW5jZXNcbiAgICAgIGNvbnN0IGRvY3VtZW50c0NvdW50ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBzcWw8bnVtYmVyPmBjb3VudCgqKWAgfSlcbiAgICAgICAgLmZyb20oZG9jdW1lbnRzKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgb3IoXG4gICAgICAgICAgICBlcShkb2N1bWVudHMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksXG4gICAgICAgICAgICBzcWxgJHtkb2N1bWVudHMucmVzaWRlbmNlSWR9IElOIChTRUxFQ1QgaWQgRlJPTSByZXNpZGVuY2VzIFdIRVJFIGJ1aWxkaW5nX2lkID0gJHtidWlsZGluZ0lkfSlgXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICAvLyBDb3VudCB1c2VycyB3aG8gd2lsbCBiZWNvbWUgb3JwaGFuZWQgKG9ubHkgaGF2ZSByZWxhdGlvbnNoaXBzIHdpdGggcmVzaWRlbmNlcyBpbiB0aGlzIGJ1aWxkaW5nKVxuICAgICAgY29uc3QgcG90ZW50aWFsT3JwaGFuc0NvdW50ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7IGNvdW50OiBzcWw8bnVtYmVyPmBjb3VudChkaXN0aW5jdCAke3VzZXJSZXNpZGVuY2VzLnVzZXJJZH0pYCB9KVxuICAgICAgICAuZnJvbSh1c2VyUmVzaWRlbmNlcylcbiAgICAgICAgLmlubmVySm9pbihyZXNpZGVuY2VzLCBlcSh1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlcy5pZCkpXG4gICAgICAgIC5pbm5lckpvaW4odXNlcnMsIGVxKHVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlcnMuaWQpKVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEocmVzaWRlbmNlcy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSxcbiAgICAgICAgICAgIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgZXEodXNlcnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuXG4gICAgICBjb25zdCBpbXBhY3QgPSB7XG4gICAgICAgIGJ1aWxkaW5nOiBidWlsZGluZ1swXSxcbiAgICAgICAgcmVzaWRlbmNlczogcmVzaWRlbmNlc0NvdW50WzBdPy5jb3VudCB8fCAwLFxuICAgICAgICBkb2N1bWVudHM6IGRvY3VtZW50c0NvdW50WzBdPy5jb3VudCB8fCAwLFxuICAgICAgICBwb3RlbnRpYWxPcnBoYW5lZFVzZXJzOiBwb3RlbnRpYWxPcnBoYW5zQ291bnRbMF0/LmNvdW50IHx8IDAsXG4gICAgICB9O1xuXG4gICAgICByZXMuanNvbihpbXBhY3QpO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBhbmFseXppbmcgZGVsZXRpb24gaW1wYWN0OicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBhbmFseXplIGRlbGV0aW9uIGltcGFjdCcsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBERUxFVEUgL2FwaS9hZG1pbi9idWlsZGluZ3MvOmlkL2Nhc2NhZGUgLSBDYXNjYWRlIGRlbGV0ZSBhIGJ1aWxkaW5nXG4gICAqIFJlcGxhY2VzIHRoZSBzaW1wbGUgZGVsZXRlIHdpdGggY2FzY2FkaW5nIGRlbGV0ZSB0aGF0IHJlbW92ZXMgcmVzaWRlbmNlcyBhbmQgZG9jdW1lbnRzLiBVc2VycyBhcmUgcHJlc2VydmVkIGZvciBkYXRhIHNhZmV0eS5cbiAgICovXG4gIGFwcC5kZWxldGUoJy9hcGkvYWRtaW4vYnVpbGRpbmdzLzppZC9jYXNjYWRlJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gcmVxLnVzZXIgfHwgcmVxLnNlc3Npb24/LnVzZXI7XG4gICAgICBpZiAoIWN1cnJlbnRVc2VyKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyxcbiAgICAgICAgICBjb2RlOiAnQVVUSF9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoY3VycmVudFVzZXIucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdBZG1pbiBhY2Nlc3MgcmVxdWlyZWQnLFxuICAgICAgICAgIGNvZGU6ICdBRE1JTl9SRVFVSVJFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBidWlsZGluZ0lkID0gcmVxLnBhcmFtcy5pZDtcblxuICAgICAgLy8gQ2hlY2sgaWYgYnVpbGRpbmcgZXhpc3RzXG4gICAgICBjb25zdCBidWlsZGluZyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyBpZDogYnVpbGRpbmdzLmlkLCBuYW1lOiBidWlsZGluZ3MubmFtZSB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShhbmQoZXEoYnVpbGRpbmdzLmlkLCBidWlsZGluZ0lkKSwgZXEoYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGJ1aWxkaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIF9lcnJvcjogJ05vdCBmb3VuZCcsXG4gICAgICAgICAgbWVzc2FnZTogJ0J1aWxkaW5nIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGFydCB0cmFuc2FjdGlvbiBmb3IgY2FzY2FkaW5nIGRlbGV0ZVxuICAgICAgYXdhaXQgZGIudHJhbnNhY3Rpb24oYXN5bmMgKHR4KSA9PiB7XG4gICAgICAgIC8vIDEuIEdldCBhbGwgcmVzaWRlbmNlcyBpbiB0aGlzIGJ1aWxkaW5nXG4gICAgICAgIGNvbnN0IGJ1aWxkaW5nUmVzaWRlbmNlcyA9IGF3YWl0IHR4XG4gICAgICAgICAgLnNlbGVjdCh7IGlkOiByZXNpZGVuY2VzLmlkIH0pXG4gICAgICAgICAgLmZyb20ocmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoYW5kKGVxKHJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksIGVxKHJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKSk7XG5cbiAgICAgICAgY29uc3QgcmVzaWRlbmNlSWRzID0gYnVpbGRpbmdSZXNpZGVuY2VzLm1hcCgocikgPT4gci5pZCk7XG5cbiAgICAgICAgaWYgKHJlc2lkZW5jZUlkcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgLy8gMi4gRGVsZXRlIGRvY3VtZW50cyBhc3NvY2lhdGVkIHdpdGggYnVpbGRpbmcgb3IgaXRzIHJlc2lkZW5jZXNcbiAgICAgICAgICBhd2FpdCB0eFxuICAgICAgICAgICAgLmRlbGV0ZShkb2N1bWVudHMpXG4gICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgIG9yKGVxKGRvY3VtZW50cy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSwgaW5BcnJheShkb2N1bWVudHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkcykpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gMy4gU29mdCBkZWxldGUgdXNlci1yZXNpZGVuY2UgcmVsYXRpb25zaGlwc1xuICAgICAgICAgIGF3YWl0IHR4XG4gICAgICAgICAgICAudXBkYXRlKHVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgICAgICAud2hlcmUoaW5BcnJheSh1c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWRzKSk7XG5cbiAgICAgICAgICAvLyA0LiBESVNBQkxFRDogVXNlciBkZWxldGlvbiBwcm9oaWJpdGVkIGZvciBkYXRhIHNhZmV0eVxuICAgICAgICAgIGNvbnN0IG9ycGhhbmVkVXNlcnMgPSBhd2FpdCB0eFxuICAgICAgICAgICAgLnNlbGVjdCh7IGlkOiB1c2Vycy5pZCB9KVxuICAgICAgICAgICAgLmZyb20odXNlcnMpXG4gICAgICAgICAgICAubGVmdEpvaW4oXG4gICAgICAgICAgICAgIHVzZXJPcmdhbml6YXRpb25zLFxuICAgICAgICAgICAgICBhbmQoZXEodXNlcnMuaWQsIHVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCksIGVxKHVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIC5sZWZ0Sm9pbihcbiAgICAgICAgICAgICAgdXNlclJlc2lkZW5jZXMsXG4gICAgICAgICAgICAgIGFuZChlcSh1c2Vycy5pZCwgdXNlclJlc2lkZW5jZXMudXNlcklkKSwgZXEodXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgZXEodXNlcnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgIGlzTnVsbCh1c2VyT3JnYW5pemF0aW9ucy51c2VySWQpLFxuICAgICAgICAgICAgICAgIGlzTnVsbCh1c2VyUmVzaWRlbmNlcy51c2VySWQpXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAob3JwaGFuZWRVc2Vycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBvcnBoYW5lZFVzZXJJZHMgPSBvcnBoYW5lZFVzZXJzLm1hcCgodSkgPT4gdS5pZCk7XG4gICAgICAgICAgICBhd2FpdCB0eFxuICAgICAgICAgICAgICAudXBkYXRlKHVzZXJzKVxuICAgICAgICAgICAgICAuc2V0KHsgaXNBY3RpdmU6IGZhbHNlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgICAgICAgLndoZXJlKGluQXJyYXkodXNlcnMuaWQsIG9ycGhhbmVkVXNlcklkcykpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIDUuIFNvZnQgZGVsZXRlIHJlc2lkZW5jZXNcbiAgICAgICAgICBhd2FpdCB0eFxuICAgICAgICAgICAgLnVwZGF0ZShyZXNpZGVuY2VzKVxuICAgICAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgICAgICAud2hlcmUoaW5BcnJheShyZXNpZGVuY2VzLmlkLCByZXNpZGVuY2VJZHMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBTdGlsbCBkZWxldGUgZG9jdW1lbnRzIGFzc29jaWF0ZWQgZGlyZWN0bHkgd2l0aCB0aGUgYnVpbGRpbmdcbiAgICAgICAgICBhd2FpdCB0eC5kZWxldGUoZG9jdW1lbnRzKS53aGVyZShlcShkb2N1bWVudHMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gNi4gRmluYWxseSwgc29mdCBkZWxldGUgdGhlIGJ1aWxkaW5nXG4gICAgICAgIGF3YWl0IHR4XG4gICAgICAgICAgLnVwZGF0ZShidWlsZGluZ3MpXG4gICAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYnVpbGRpbmdJZCkpO1xuICAgICAgfSk7XG5cblxuICAgICAgLy8gQ2xlYW4gdXAgb2JqZWN0IHN0b3JhZ2UgaGllcmFyY2h5IGZvciB0aGUgZGVsZXRlZCBidWlsZGluZ1xuICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBJRCBmcm9tIGJ1aWxkaW5nIGJlZm9yZSBkZWxldGlvblxuICAgICAgY29uc3QgYnVpbGRpbmdPcmcgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgb3JnYW5pemF0aW9uSWQ6IGJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCB9KVxuICAgICAgICAuZnJvbShidWlsZGluZ3MpXG4gICAgICAgIC53aGVyZShlcShidWlsZGluZ3MuaWQsIGJ1aWxkaW5nSWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChidWlsZGluZ09yZy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIE9iamVjdCBzdG9yYWdlIGNsZWFudXAgd2lsbCBiZSBoYW5kbGVkIGF1dG9tYXRpY2FsbHlcbiAgICAgICAgY29uc29sZS5sb2coJ0J1aWxkaW5nIGRlbGV0ZWQgLSBzdG9yYWdlIGNsZWFudXAgd2lsbCBiZSBoYW5kbGVkIGF1dG9tYXRpY2FsbHknKTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQnVpbGRpbmcgYW5kIHJlbGF0ZWQgZW50aXRpZXMgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBkZWxldGVkQnVpbGRpbmc6IGJ1aWxkaW5nWzBdLm5hbWUsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZHVyaW5nIGNhc2NhZGUgZGVsZXRlOicsIGVycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgX2Vycm9yOiAnSW50ZXJuYWwgc2VydmVyIGVycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBkZWxldGUgYnVpbGRpbmcgYW5kIHJlbGF0ZWQgZW50aXRpZXMnLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==