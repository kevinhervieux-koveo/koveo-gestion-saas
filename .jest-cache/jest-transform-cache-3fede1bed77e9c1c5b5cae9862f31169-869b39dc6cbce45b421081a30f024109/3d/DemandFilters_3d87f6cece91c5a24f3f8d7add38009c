81b3d702db47d870240248190dced0f8
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DemandFilters = DemandFilters;
exports.filterDemands = filterDemands;
const jsx_runtime_1 = require("react/jsx-runtime");
const lucide_react_1 = require("lucide-react");
const input_1 = require("@/components/ui/input");
const select_1 = require("@/components/ui/select");
const use_language_1 = require("@/hooks/use-language");
// Filter options for different user roles - now using translation keys
const getStatusOptions = (t) => [
    { value: 'all', label: t('allStatusFilter') },
    { value: 'draft', label: t('draftFilter') },
    { value: 'submitted', label: t('submittedFilter') },
    { value: 'under_review', label: t('underReviewFilter') },
    { value: 'approved', label: t('approvedFilter') },
    { value: 'in_progress', label: t('inProgressFilter') },
    { value: 'completed', label: t('completedFilter') },
    { value: 'rejected', label: t('rejectedFilter') },
    { value: 'cancelled', label: t('cancelledFilter') },
];
const getManagerStatusOptions = (t) => [
    { value: 'all', label: t('allStatusFilter') },
    { value: 'submitted', label: t('submittedFilter') },
    { value: 'under_review', label: t('underReviewFilter') },
    { value: 'approved', label: t('approvedFilter') },
    { value: 'in_progress', label: t('inProgressFilter') },
    { value: 'completed', label: t('completedFilter') },
    { value: 'rejected', label: t('rejectedFilter') },
];
const getTypeOptions = (t) => [
    { value: 'all', label: t('allTypesFilter') },
    { value: 'maintenance', label: t('maintenanceFilter') },
    { value: 'complaint', label: t('complaintFilter') },
    { value: 'information', label: t('informationFilter') },
    { value: 'other', label: t('otherFilter') },
];
/**
 * Common demand filtering component
 * Supports search, status, type, and optional building filters.
 * @param root0
 * @param root0.filters
 * @param root0.handlers
 * @param root0.userRole
 * @param root0.buildings
 * @param root0.searchPlaceholder
 * @param root0.className
 */
function DemandFilters({ filters, handlers, userRole = 'resident', buildings = [], searchPlaceholder, className = '', }) {
    const { t } = (0, use_language_1.useLanguage)();
    const statusOptions = userRole === 'manager' ? getManagerStatusOptions(t) : getStatusOptions(t);
    const typeOptions = getTypeOptions(t);
    const showBuildingFilter = userRole === 'manager' && handlers.onBuildingChange;
    const placeholder = searchPlaceholder || t('searchDemands');
    return ((0, jsx_runtime_1.jsxs)("div", { className: `flex items-center gap-4 flex-wrap ${className}`, children: [(0, jsx_runtime_1.jsxs)("div", { className: 'relative flex-1 max-w-sm', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.Search, { className: 'absolute left-3 top-3 h-4 w-4 text-muted-foreground' }), (0, jsx_runtime_1.jsx)(input_1.Input, { placeholder: placeholder, value: filters.searchTerm, onChange: (e) => handlers.onSearchChange(e.target.value), className: 'pl-10', "data-testid": 'search-demands' })] }), (0, jsx_runtime_1.jsxs)(select_1.Select, { value: filters.statusFilter, onValueChange: handlers.onStatusChange, children: [(0, jsx_runtime_1.jsx)(select_1.SelectTrigger, { className: 'w-40', "data-testid": 'filter-status', children: (0, jsx_runtime_1.jsx)(select_1.SelectValue, { placeholder: t('formStatus') }) }), (0, jsx_runtime_1.jsx)(select_1.SelectContent, { children: statusOptions.map((option) => ((0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: option.value, children: option.label }, option.value))) })] }), (0, jsx_runtime_1.jsxs)(select_1.Select, { value: filters.typeFilter, onValueChange: handlers.onTypeChange, children: [(0, jsx_runtime_1.jsx)(select_1.SelectTrigger, { className: 'w-40', "data-testid": 'filter-type', children: (0, jsx_runtime_1.jsx)(select_1.SelectValue, { placeholder: t('formType') }) }), (0, jsx_runtime_1.jsx)(select_1.SelectContent, { children: typeOptions.map((option) => ((0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: option.value, children: option.label }, option.value))) })] }), showBuildingFilter && ((0, jsx_runtime_1.jsxs)(select_1.Select, { value: filters.buildingFilter || 'all', onValueChange: handlers.onBuildingChange, children: [(0, jsx_runtime_1.jsx)(select_1.SelectTrigger, { className: 'w-40', "data-testid": 'filter-building', children: (0, jsx_runtime_1.jsx)(select_1.SelectValue, { placeholder: t('building') }) }), (0, jsx_runtime_1.jsxs)(select_1.SelectContent, { children: [(0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: 'all', children: t('allBuildings') }), buildings.map((building) => ((0, jsx_runtime_1.jsx)(select_1.SelectItem, { value: building.id, children: building.name }, building.id)))] })] }))] }));
}
// Utility function to filter demands based on filter state
/**
 *
 * @param demands
 * @param filters
 */
function filterDemands(demands, filters) {
    return demands.filter((demand) => {
        // Search filter
        const searchLower = filters.searchTerm.toLowerCase();
        const matchesSearch = !filters.searchTerm ||
            demand.description.toLowerCase().includes(searchLower) ||
            demand.type.toLowerCase().includes(searchLower) ||
            (demand.submitter &&
                (demand.submitter.firstName.toLowerCase().includes(searchLower) ||
                    demand.submitter.lastName.toLowerCase().includes(searchLower) ||
                    demand.submitter.email.toLowerCase().includes(searchLower)));
        // Status filter
        const matchesStatus = filters.statusFilter === 'all' || demand.status === filters.statusFilter;
        // Type filter
        const matchesType = filters.typeFilter === 'all' || demand.type === filters.typeFilter;
        // Building filter (optional)
        const matchesBuilding = !filters.buildingFilter ||
            filters.buildingFilter === 'all' ||
            demand.buildingId === filters.buildingFilter;
        return matchesSearch && matchesStatus && matchesType && matchesBuilding;
    });
}
exports.default = DemandFilters;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvY29tbW9uL0RlbWFuZEZpbHRlcnMudHN4IiwibWFwcGluZ3MiOiI7O0FBd0ZBLHNDQTBFQztBQVFELHNDQW1DQzs7QUE3TUQsK0NBQXNDO0FBQ3RDLGlEQUE4QztBQUM5QyxtREFNZ0M7QUFDaEMsdURBQW1EO0FBeUJuRCx1RUFBdUU7QUFDdkUsTUFBTSxnQkFBZ0IsR0FBRyxDQUFDLENBQTBCLEVBQUUsRUFBRSxDQUFDO0lBQ3ZELEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLGlCQUFpQixDQUFDLEVBQUU7SUFDN0MsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsYUFBYSxDQUFDLEVBQUU7SUFDM0MsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsaUJBQWlCLENBQUMsRUFBRTtJQUNuRCxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxtQkFBbUIsQ0FBQyxFQUFFO0lBQ3hELEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7SUFDakQsRUFBRSxLQUFLLEVBQUUsYUFBYSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsa0JBQWtCLENBQUMsRUFBRTtJQUN0RCxFQUFFLEtBQUssRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFO0lBQ25ELEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7SUFDakQsRUFBRSxLQUFLLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsaUJBQWlCLENBQUMsRUFBRTtDQUNwRCxDQUFDO0FBRUYsTUFBTSx1QkFBdUIsR0FBRyxDQUFDLENBQTBCLEVBQUUsRUFBRSxD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S0FBSyxJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssT0FBTyxDQUFDLFlBQVksQ0FBQztRQUUvRixjQUFjO1FBQ2QsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLFVBQVUsS0FBSyxLQUFLLElBQUksTUFBTSxDQUFDLElBQUksS0FBSyxPQUFPLENBQUMsVUFBVSxDQUFDO1FBRXZGLDZCQUE2QjtRQUM3QixNQUFNLGVBQWUsR0FDbkIsQ0FBQyxPQUFPLENBQUMsY0FBYztZQUN2QixPQUFPLENBQUMsY0FBYyxLQUFLLEtBQUs7WUFDaEMsTUFBTSxDQUFDLFVBQVUsS0FBSyxPQUFPLENBQUMsY0FBYyxDQUFDO1FBRS9DLE9BQU8sYUFBYSxJQUFJLGFBQWEsSUFBSSxXQUFXLElBQUksZUFBZSxDQUFDO0lBQzFFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQztBQUVELGtCQUFlLGFBQWEsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL2NsaWVudC9zcmMvY29tcG9uZW50cy9jb21tb24vRGVtYW5kRmlsdGVycy50c3giXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VhcmNoIH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnQC9jb21wb25lbnRzL3VpL2lucHV0JztcbmltcG9ydCB7XG4gIFNlbGVjdCxcbiAgU2VsZWN0Q29udGVudCxcbiAgU2VsZWN0SXRlbSxcbiAgU2VsZWN0VHJpZ2dlcixcbiAgU2VsZWN0VmFsdWUsXG59IGZyb20gJ0AvY29tcG9uZW50cy91aS9zZWxlY3QnO1xuaW1wb3J0IHsgdXNlTGFuZ3VhZ2UgfSBmcm9tICdAL2hvb2tzL3VzZS1sYW5ndWFnZSc7XG5pbXBvcnQgdHlwZSB7IEJ1aWxkaW5nIH0gZnJvbSAnLi9EZW1hbmRDYXJkJztcblxuLy8gRmlsdGVyIHN0YXRlIGludGVyZmFjZVxuLyoqXG4gKlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpbHRlclN0YXRlIHtcbiAgc2VhcmNoVGVybTogc3RyaW5nO1xuICBzdGF0dXNGaWx0ZXI6IHN0cmluZztcbiAgdHlwZUZpbHRlcjogc3RyaW5nO1xuICBidWlsZGluZ0ZpbHRlcj86IHN0cmluZztcbn1cblxuLy8gRmlsdGVyIGNoYW5nZSBoYW5kbGVyc1xuLyoqXG4gKlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEZpbHRlckhhbmRsZXJzIHtcbiAgb25TZWFyY2hDaGFuZ2U6ICh2YWx1ZTogc3RyaW5nKSA9PiB2b2lkO1xuICBvblN0YXR1c0NoYW5nZTogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIG9uVHlwZUNoYW5nZTogKHZhbHVlOiBzdHJpbmcpID0+IHZvaWQ7XG4gIG9uQnVpbGRpbmdDaGFuZ2U/OiAodmFsdWU6IHN0cmluZykgPT4gdm9pZDtcbn1cblxuLy8gRmlsdGVyIG9wdGlvbnMgZm9yIGRpZmZlcmVudCB1c2VyIHJvbGVzIC0gbm93IHVzaW5nIHRyYW5zbGF0aW9uIGtleXNcbmNvbnN0IGdldFN0YXR1c09wdGlvbnMgPSAodDogKGtleTogc3RyaW5nKSA9PiBzdHJpbmcpID0+IFtcbiAgeyB2YWx1ZTogJ2FsbCcsIGxhYmVsOiB0KCdhbGxTdGF0dXNGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnZHJhZnQnLCBsYWJlbDogdCgnZHJhZnRGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnc3VibWl0dGVkJywgbGFiZWw6IHQoJ3N1Ym1pdHRlZEZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICd1bmRlcl9yZXZpZXcnLCBsYWJlbDogdCgndW5kZXJSZXZpZXdGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnYXBwcm92ZWQnLCBsYWJlbDogdCgnYXBwcm92ZWRGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnaW5fcHJvZ3Jlc3MnLCBsYWJlbDogdCgnaW5Qcm9ncmVzc0ZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICdjb21wbGV0ZWQnLCBsYWJlbDogdCgnY29tcGxldGVkRmlsdGVyJykgfSxcbiAgeyB2YWx1ZTogJ3JlamVjdGVkJywgbGFiZWw6IHQoJ3JlamVjdGVkRmlsdGVyJykgfSxcbiAgeyB2YWx1ZTogJ2NhbmNlbGxlZCcsIGxhYmVsOiB0KCdjYW5jZWxsZWRGaWx0ZXInKSB9LFxuXTtcblxuY29uc3QgZ2V0TWFuYWdlclN0YXR1c09wdGlvbnMgPSAodDogKGtleTogc3RyaW5nKSA9PiBzdHJpbmcpID0+IFtcbiAgeyB2YWx1ZTogJ2FsbCcsIGxhYmVsOiB0KCdhbGxTdGF0dXNGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnc3VibWl0dGVkJywgbGFiZWw6IHQoJ3N1Ym1pdHRlZEZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICd1bmRlcl9yZXZpZXcnLCBsYWJlbDogdCgndW5kZXJSZXZpZXdGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnYXBwcm92ZWQnLCBsYWJlbDogdCgnYXBwcm92ZWRGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnaW5fcHJvZ3Jlc3MnLCBsYWJlbDogdCgnaW5Qcm9ncmVzc0ZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICdjb21wbGV0ZWQnLCBsYWJlbDogdCgnY29tcGxldGVkRmlsdGVyJykgfSxcbiAgeyB2YWx1ZTogJ3JlamVjdGVkJywgbGFiZWw6IHQoJ3JlamVjdGVkRmlsdGVyJykgfSxcbl07XG5cbmNvbnN0IGdldFR5cGVPcHRpb25zID0gKHQ6IChrZXk6IHN0cmluZykgPT4gc3RyaW5nKSA9PiBbXG4gIHsgdmFsdWU6ICdhbGwnLCBsYWJlbDogdCgnYWxsVHlwZXNGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnbWFpbnRlbmFuY2UnLCBsYWJlbDogdCgnbWFpbnRlbmFuY2VGaWx0ZXInKSB9LFxuICB7IHZhbHVlOiAnY29tcGxhaW50JywgbGFiZWw6IHQoJ2NvbXBsYWludEZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICdpbmZvcm1hdGlvbicsIGxhYmVsOiB0KCdpbmZvcm1hdGlvbkZpbHRlcicpIH0sXG4gIHsgdmFsdWU6ICdvdGhlcicsIGxhYmVsOiB0KCdvdGhlckZpbHRlcicpIH0sXG5dO1xuXG4vKipcbiAqXG4gKi9cbmludGVyZmFjZSBEZW1hbmRGaWx0ZXJzUHJvcHMge1xuICBmaWx0ZXJzOiBGaWx0ZXJTdGF0ZTtcbiAgaGFuZGxlcnM6IEZpbHRlckhhbmRsZXJzO1xuICB1c2VyUm9sZT86ICdtYW5hZ2VyJyB8ICdyZXNpZGVudCc7XG4gIGJ1aWxkaW5ncz86IEJ1aWxkaW5nW107XG4gIHNlYXJjaFBsYWNlaG9sZGVyPzogc3RyaW5nO1xuICBjbGFzc05hbWU/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogQ29tbW9uIGRlbWFuZCBmaWx0ZXJpbmcgY29tcG9uZW50XG4gKiBTdXBwb3J0cyBzZWFyY2gsIHN0YXR1cywgdHlwZSwgYW5kIG9wdGlvbmFsIGJ1aWxkaW5nIGZpbHRlcnMuXG4gKiBAcGFyYW0gcm9vdDBcbiAqIEBwYXJhbSByb290MC5maWx0ZXJzXG4gKiBAcGFyYW0gcm9vdDAuaGFuZGxlcnNcbiAqIEBwYXJhbSByb290MC51c2VyUm9sZVxuICogQHBhcmFtIHJvb3QwLmJ1aWxkaW5nc1xuICogQHBhcmFtIHJvb3QwLnNlYXJjaFBsYWNlaG9sZGVyXG4gKiBAcGFyYW0gcm9vdDAuY2xhc3NOYW1lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBEZW1hbmRGaWx0ZXJzKHtcbiAgZmlsdGVycyxcbiAgaGFuZGxlcnMsXG4gIHVzZXJSb2xlID0gJ3Jlc2lkZW50JyxcbiAgYnVpbGRpbmdzID0gW10sXG4gIHNlYXJjaFBsYWNlaG9sZGVyLFxuICBjbGFzc05hbWUgPSAnJyxcbn06IERlbWFuZEZpbHRlcnNQcm9wcykge1xuICBjb25zdCB7IHQgfSA9IHVzZUxhbmd1YWdlKCk7XG4gIGNvbnN0IHN0YXR1c09wdGlvbnMgPSB1c2VyUm9sZSA9PT0gJ21hbmFnZXInID8gZ2V0TWFuYWdlclN0YXR1c09wdGlvbnModCkgOiBnZXRTdGF0dXNPcHRpb25zKHQpO1xuICBjb25zdCB0eXBlT3B0aW9ucyA9IGdldFR5cGVPcHRpb25zKHQpO1xuICBjb25zdCBzaG93QnVpbGRpbmdGaWx0ZXIgPSB1c2VyUm9sZSA9PT0gJ21hbmFnZXInICYmIGhhbmRsZXJzLm9uQnVpbGRpbmdDaGFuZ2U7XG4gIGNvbnN0IHBsYWNlaG9sZGVyID0gc2VhcmNoUGxhY2Vob2xkZXIgfHwgdCgnc2VhcmNoRGVtYW5kcycpO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9e2BmbGV4IGl0ZW1zLWNlbnRlciBnYXAtNCBmbGV4LXdyYXAgJHtjbGFzc05hbWV9YH0+XG4gICAgICB7LyogU2VhcmNoIElucHV0ICovfVxuICAgICAgPGRpdiBjbGFzc05hbWU9J3JlbGF0aXZlIGZsZXgtMSBtYXgtdy1zbSc+XG4gICAgICAgIDxTZWFyY2ggY2xhc3NOYW1lPSdhYnNvbHV0ZSBsZWZ0LTMgdG9wLTMgaC00IHctNCB0ZXh0LW11dGVkLWZvcmVncm91bmQnIC8+XG4gICAgICAgIDxJbnB1dFxuICAgICAgICAgIHBsYWNlaG9sZGVyPXtwbGFjZWhvbGRlcn1cbiAgICAgICAgICB2YWx1ZT17ZmlsdGVycy5zZWFyY2hUZXJtfVxuICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gaGFuZGxlcnMub25TZWFyY2hDaGFuZ2UoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgIGNsYXNzTmFtZT0ncGwtMTAnXG4gICAgICAgICAgZGF0YS10ZXN0aWQ9J3NlYXJjaC1kZW1hbmRzJ1xuICAgICAgICAvPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIHsvKiBTdGF0dXMgRmlsdGVyICovfVxuICAgICAgPFNlbGVjdCB2YWx1ZT17ZmlsdGVycy5zdGF0dXNGaWx0ZXJ9IG9uVmFsdWVDaGFuZ2U9e2hhbmRsZXJzLm9uU3RhdHVzQ2hhbmdlfT5cbiAgICAgICAgPFNlbGVjdFRyaWdnZXIgY2xhc3NOYW1lPSd3LTQwJyBkYXRhLXRlc3RpZD0nZmlsdGVyLXN0YXR1cyc+XG4gICAgICAgICAgPFNlbGVjdFZhbHVlIHBsYWNlaG9sZGVyPXt0KCdmb3JtU3RhdHVzJyl9IC8+XG4gICAgICAgIDwvU2VsZWN0VHJpZ2dlcj5cbiAgICAgICAgPFNlbGVjdENvbnRlbnQ+XG4gICAgICAgICAge3N0YXR1c09wdGlvbnMubWFwKChvcHRpb24pID0+IChcbiAgICAgICAgICAgIDxTZWxlY3RJdGVtIGtleT17b3B0aW9uLnZhbHVlfSB2YWx1ZT17b3B0aW9uLnZhbHVlfT5cbiAgICAgICAgICAgICAge29wdGlvbi5sYWJlbH1cbiAgICAgICAgICAgIDwvU2VsZWN0SXRlbT5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9TZWxlY3RDb250ZW50PlxuICAgICAgPC9TZWxlY3Q+XG5cbiAgICAgIHsvKiBUeXBlIEZpbHRlciAqL31cbiAgICAgIDxTZWxlY3QgdmFsdWU9e2ZpbHRlcnMudHlwZUZpbHRlcn0gb25WYWx1ZUNoYW5nZT17aGFuZGxlcnMub25UeXBlQ2hhbmdlfT5cbiAgICAgICAgPFNlbGVjdFRyaWdnZXIgY2xhc3NOYW1lPSd3LTQwJyBkYXRhLXRlc3RpZD0nZmlsdGVyLXR5cGUnPlxuICAgICAgICAgIDxTZWxlY3RWYWx1ZSBwbGFjZWhvbGRlcj17dCgnZm9ybVR5cGUnKX0gLz5cbiAgICAgICAgPC9TZWxlY3RUcmlnZ2VyPlxuICAgICAgICA8U2VsZWN0Q29udGVudD5cbiAgICAgICAgICB7dHlwZU9wdGlvbnMubWFwKChvcHRpb24pID0+IChcbiAgICAgICAgICAgIDxTZWxlY3RJdGVtIGtleT17b3B0aW9uLnZhbHVlfSB2YWx1ZT17b3B0aW9uLnZhbHVlfT5cbiAgICAgICAgICAgICAge29wdGlvbi5sYWJlbH1cbiAgICAgICAgICAgIDwvU2VsZWN0SXRlbT5cbiAgICAgICAgICApKX1cbiAgICAgICAgPC9TZWxlY3RDb250ZW50PlxuICAgICAgPC9TZWxlY3Q+XG5cbiAgICAgIHsvKiBCdWlsZGluZyBGaWx0ZXIgKE1hbmFnZXIgb25seSkgKi99XG4gICAgICB7c2hvd0J1aWxkaW5nRmlsdGVyICYmIChcbiAgICAgICAgPFNlbGVjdCB2YWx1ZT17ZmlsdGVycy5idWlsZGluZ0ZpbHRlciB8fCAnYWxsJ30gb25WYWx1ZUNoYW5nZT17aGFuZGxlcnMub25CdWlsZGluZ0NoYW5nZX0+XG4gICAgICAgICAgPFNlbGVjdFRyaWdnZXIgY2xhc3NOYW1lPSd3LTQwJyBkYXRhLXRlc3RpZD0nZmlsdGVyLWJ1aWxkaW5nJz5cbiAgICAgICAgICAgIDxTZWxlY3RWYWx1ZSBwbGFjZWhvbGRlcj17dCgnYnVpbGRpbmcnKX0gLz5cbiAgICAgICAgICA8L1NlbGVjdFRyaWdnZXI+XG4gICAgICAgICAgPFNlbGVjdENvbnRlbnQ+XG4gICAgICAgICAgICA8U2VsZWN0SXRlbSB2YWx1ZT0nYWxsJz57dCgnYWxsQnVpbGRpbmdzJyl9PC9TZWxlY3RJdGVtPlxuICAgICAgICAgICAge2J1aWxkaW5ncy5tYXAoKGJ1aWxkaW5nKSA9PiAoXG4gICAgICAgICAgICAgIDxTZWxlY3RJdGVtIGtleT17YnVpbGRpbmcuaWR9IHZhbHVlPXtidWlsZGluZy5pZH0+XG4gICAgICAgICAgICAgICAge2J1aWxkaW5nLm5hbWV9XG4gICAgICAgICAgICAgIDwvU2VsZWN0SXRlbT5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgIDwvU2VsZWN0Q29udGVudD5cbiAgICAgICAgPC9TZWxlY3Q+XG4gICAgICApfVxuICAgIDwvZGl2PlxuICApO1xufVxuXG4vLyBVdGlsaXR5IGZ1bmN0aW9uIHRvIGZpbHRlciBkZW1hbmRzIGJhc2VkIG9uIGZpbHRlciBzdGF0ZVxuLyoqXG4gKlxuICogQHBhcmFtIGRlbWFuZHNcbiAqIEBwYXJhbSBmaWx0ZXJzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaWx0ZXJEZW1hbmRzPFxuICBUIGV4dGVuZHMge1xuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gICAgdHlwZTogc3RyaW5nO1xuICAgIHN0YXR1czogc3RyaW5nO1xuICAgIGJ1aWxkaW5nSWQ/OiBzdHJpbmc7XG4gICAgc3VibWl0dGVyPzogeyBmaXJzdE5hbWU6IHN0cmluZzsgbGFzdE5hbWU6IHN0cmluZzsgZW1haWw6IHN0cmluZyB9O1xuICB9LFxuPihkZW1hbmRzOiBUW10sIGZpbHRlcnM6IEZpbHRlclN0YXRlKTogVFtdIHtcbiAgcmV0dXJuIGRlbWFuZHMuZmlsdGVyKChkZW1hbmQpID0+IHtcbiAgICAvLyBTZWFyY2ggZmlsdGVyXG4gICAgY29uc3Qgc2VhcmNoTG93ZXIgPSBmaWx0ZXJzLnNlYXJjaFRlcm0udG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBtYXRjaGVzU2VhcmNoID1cbiAgICAgICFmaWx0ZXJzLnNlYXJjaFRlcm0gfHxcbiAgICAgIGRlbWFuZC5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaExvd2VyKSB8fFxuICAgICAgZGVtYW5kLnR5cGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcikgfHxcbiAgICAgIChkZW1hbmQuc3VibWl0dGVyICYmXG4gICAgICAgIChkZW1hbmQuc3VibWl0dGVyLmZpcnN0TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaExvd2VyKSB8fFxuICAgICAgICAgIGRlbWFuZC5zdWJtaXR0ZXIubGFzdE5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhzZWFyY2hMb3dlcikgfHxcbiAgICAgICAgICBkZW1hbmQuc3VibWl0dGVyLmVtYWlsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoc2VhcmNoTG93ZXIpKSk7XG5cbiAgICAvLyBTdGF0dXMgZmlsdGVyXG4gICAgY29uc3QgbWF0Y2hlc1N0YXR1cyA9IGZpbHRlcnMuc3RhdHVzRmlsdGVyID09PSAnYWxsJyB8fCBkZW1hbmQuc3RhdHVzID09PSBmaWx0ZXJzLnN0YXR1c0ZpbHRlcjtcblxuICAgIC8vIFR5cGUgZmlsdGVyXG4gICAgY29uc3QgbWF0Y2hlc1R5cGUgPSBmaWx0ZXJzLnR5cGVGaWx0ZXIgPT09ICdhbGwnIHx8IGRlbWFuZC50eXBlID09PSBmaWx0ZXJzLnR5cGVGaWx0ZXI7XG5cbiAgICAvLyBCdWlsZGluZyBmaWx0ZXIgKG9wdGlvbmFsKVxuICAgIGNvbnN0IG1hdGNoZXNCdWlsZGluZyA9XG4gICAgICAhZmlsdGVycy5idWlsZGluZ0ZpbHRlciB8fFxuICAgICAgZmlsdGVycy5idWlsZGluZ0ZpbHRlciA9PT0gJ2FsbCcgfHxcbiAgICAgIGRlbWFuZC5idWlsZGluZ0lkID09PSBmaWx0ZXJzLmJ1aWxkaW5nRmlsdGVyO1xuXG4gICAgcmV0dXJuIG1hdGNoZXNTZWFyY2ggJiYgbWF0Y2hlc1N0YXR1cyAmJiBtYXRjaGVzVHlwZSAmJiBtYXRjaGVzQnVpbGRpbmc7XG4gIH0pO1xufVxuXG5leHBvcnQgZGVmYXVsdCBEZW1hbmRGaWx0ZXJzO1xuIl0sInZlcnNpb24iOjN9