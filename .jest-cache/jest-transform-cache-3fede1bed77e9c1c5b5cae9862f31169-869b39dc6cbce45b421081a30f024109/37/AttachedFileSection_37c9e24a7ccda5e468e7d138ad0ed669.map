{"file":"/home/runner/workspace/client/src/components/common/AttachedFileSection.tsx","mappings":"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","names":[],"sources":["/home/runner/workspace/client/src/components/common/AttachedFileSection.tsx"],"sourcesContent":["import { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { FileText, Download } from 'lucide-react';\n\ninterface AttachedFileSectionProps {\n  // Entity information\n  entityType: 'document' | 'bug' | 'feature-request' | 'bill';\n  entityId: string;\n  \n  // File information\n  filePath?: string | null;\n  fileName?: string | null;\n  fileSize?: number | null;\n  \n  // Permissions\n  canView?: boolean;\n  canDownload?: boolean;\n  \n  // Optional styling\n  className?: string;\n  \n  // Optional fallback name\n  fallbackName?: string;\n}\n\nexport function AttachedFileSection({\n  entityType,\n  entityId,\n  filePath,\n  fileName,\n  fileSize,\n  canView = true,\n  canDownload = true,\n  className = '',\n  fallbackName = 'Attachment'\n}: AttachedFileSectionProps) {\n  // Don't render if no file is attached\n  if (!filePath) {\n    return null;\n  }\n\n  // Generate API endpoint based on entity type\n  const getApiEndpoint = (download = false) => {\n    const downloadParam = download ? '?download=true' : '';\n    switch (entityType) {\n      case 'document':\n        return `/api/documents/${entityId}/file${downloadParam}`;\n      case 'bug':\n        return `/api/bugs/${entityId}/file${downloadParam}`;\n      case 'feature-request':\n        return `/api/feature-requests/${entityId}/file${downloadParam}`;\n      case 'bill':\n        return `/api/bills/${entityId}/file${downloadParam}`;\n      default:\n        return '';\n    }\n  };\n\n  const handleViewFile = () => {\n    if (!canView || !filePath) return;\n    const fileUrl = getApiEndpoint(false);\n    window.open(fileUrl, '_blank');\n  };\n\n  const handleDownloadFile = () => {\n    if (!canDownload || !filePath) return;\n    const link = window.document.createElement('a');\n    link.href = getApiEndpoint(true);\n    link.download = fileName || fallbackName;\n    window.document.body.appendChild(link);\n    link.click();\n    window.document.body.removeChild(link);\n  };\n\n  const formatFileSize = (bytes?: number | null) => {\n    if (!bytes) return '';\n    const kb = bytes / 1024;\n    if (kb < 1024) return `${kb.toFixed(1)} KB`;\n    const mb = kb / 1024;\n    return `${mb.toFixed(1)} MB`;\n  };\n\n  // Fix encoding issues in filename display\n  const decodeFileName = (name: string) => {\n    if (!name) return name;\n    try {\n      // Fix common encoding issues like \"procÃ¨s\" -> \"procès\"\n      return name\n        .replace(/Ã¨/g, 'è')\n        .replace(/Ã©/g, 'é')\n        .replace(/Ã /g, 'à')\n        .replace(/Ã´/g, 'ô')\n        .replace(/Ã®/g, 'î')\n        .replace(/Ã§/g, 'ç')\n        .replace(/Ã¹/g, 'ù')\n        .replace(/Ã»/g, 'û')\n        .replace(/Ã¢/g, 'â')\n        .replace(/Ãª/g, 'ê');\n    } catch {\n      return name;\n    }\n  };\n\n  const displayName = decodeFileName(fileName) || fallbackName;\n  const sizeText = formatFileSize(fileSize);\n\n  return (\n    <div className={`border-t pt-4 ${className}`}>\n      <Label className=\"text-sm font-medium\">Attached File</Label>\n      <div className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg mt-2\">\n        <div className=\"flex items-center gap-2\">\n          <FileText className=\"w-4 h-4 text-gray-500\" />\n          <div className=\"flex flex-col\">\n            <span className=\"text-sm font-medium\">{displayName}</span>\n            {sizeText && <span className=\"text-xs text-gray-500\">{sizeText}</span>}\n          </div>\n        </div>\n        <div className=\"flex gap-2\">\n          {canView && (\n            <Button\n              type=\"button\"\n              onClick={handleViewFile}\n              disabled={!filePath}\n              data-testid=\"button-view-file\"\n            >\n              <FileText className=\"w-4 h-4 mr-2\" />\n              View\n            </Button>\n          )}\n          {canDownload && (\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={handleDownloadFile}\n              disabled={!filePath}\n              data-testid=\"button-download-file\"\n            >\n              <Download className=\"w-4 h-4 mr-2\" />\n              Download\n            </Button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}"],"version":3}