5581ac5b403b4d341cddecbf7b281b0c
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = DocumentPageWrapper;
const jsx_runtime_1 = require("react/jsx-runtime");
const react_query_1 = require("@tanstack/react-query");
const wouter_1 = require("wouter");
const queryClient_1 = require("@/lib/queryClient");
const DocumentManager_1 = __importDefault(require("@/components/common/DocumentManager"));
const button_1 = require("@/components/ui/button");
const lucide_react_1 = require("lucide-react");
const use_language_1 = require("@/hooks/use-language");
function DocumentPageWrapper({ type, userRole, backPath, backLabel, entityIdParam, }) {
    const [, navigate] = (0, wouter_1.useLocation)();
    const params = (0, wouter_1.useParams)();
    const { t } = (0, use_language_1.useLanguage)();
    // Get entityId from URL (both path param and query param)
    const urlParams = new URLSearchParams(window.location.search);
    const entityId = params[entityIdParam] || urlParams.get(entityIdParam);
    // Get current user
    const { data: user } = (0, react_query_1.useQuery)({
        queryKey: ['/api/auth/user'],
        queryFn: () => (0, queryClient_1.apiRequest)('GET', '/api/auth/user'),
    });
    // Get entity info based on type
    const entityApiPath = type === 'building' ? '/api/manager/buildings' : '/api/residences';
    const { data: entity, isError: entityError, error } = (0, react_query_1.useQuery)({
        queryKey: [entityApiPath, entityId],
        queryFn: async () => {
            if (type === 'residence') {
                const response = await fetch(`/api/residences/${entityId}`, {
                    credentials: 'include',
                });
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('ENTITY_NOT_FOUND');
                    }
                    throw new Error(`Failed to fetch ${type}`);
                }
                return response.json();
            }
            else {
                return (0, queryClient_1.apiRequest)('GET', `${entityApiPath}/${entityId}`);
            }
        },
        enabled: !!entityId,
        retry: false, // Don't retry on 404s
    });
    if (!entityId) {
        return ((0, jsx_runtime_1.jsx)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 flex items-center justify-center', children: (0, jsx_runtime_1.jsxs)("div", { className: 'text-center', children: [(0, jsx_runtime_1.jsxs)("p", { className: 'text-gray-500 mb-4', children: [type, " ID is required"] }), (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'outline', onClick: () => navigate(backPath), "data-testid": 'button-back-to-list', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: 'w-4 h-4 mr-2' }), backLabel || `Back to ${type}s`] })] }) }) }));
    }
    // Handle entity not found (specific to residence pages that had this logic)
    if (entityError && error?.message === 'ENTITY_NOT_FOUND' && type === 'residence') {
        return ((0, jsx_runtime_1.jsx)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: (0, jsx_runtime_1.jsx)("div", { className: 'flex-1 flex items-center justify-center', children: (0, jsx_runtime_1.jsxs)("div", { className: 'text-center max-w-md', children: [(0, jsx_runtime_1.jsx)("h2", { className: 'text-xl font-semibold mb-4', children: "Residence Not Found" }), (0, jsx_runtime_1.jsxs)("p", { className: 'text-gray-500 mb-4', children: ["The residence ID \"", entityId, "\" doesn't exist in the development database."] }), (0, jsx_runtime_1.jsx)("p", { className: 'text-sm text-gray-400 mb-6', children: "This might be a production database ID. Please use a valid development residence ID." }), (0, jsx_runtime_1.jsxs)("div", { className: 'space-y-2', children: [(0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'default', onClick: () => navigate(backPath), "data-testid": 'button-back-to-list', className: 'w-full', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: 'w-4 h-4 mr-2' }), backLabel || 'Back to Residences'] }), (0, jsx_runtime_1.jsx)(button_1.Button, { variant: 'outline', onClick: () => navigate('/residents/residences/e27ac924-8120-4904-a791-d1e9db544d58/documents'), "data-testid": 'button-go-to-valid-residence', className: 'w-full', children: "Go to Unit 101 (Test Residence)" })] })] }) }) }));
    }
    // Determine permissions based on user role and type
    const isUserTenant = user?.role === 'tenant';
    const isManager = user?.role === 'manager' || user?.role === 'admin';
    const permissions = userRole === 'manager'
        ? {
            allowCreate: isManager,
            allowEdit: isManager,
            allowDelete: isManager,
            showVisibilityToggle: isManager,
        }
        : {
            allowCreate: !isUserTenant,
            allowEdit: !isUserTenant,
            allowDelete: !isUserTenant,
            showVisibilityToggle: !isUserTenant,
        };
    // Generate entity name based on type
    const entityName = type === 'residence'
        ? (entity?.unitNumber || entity?.unit_number ? `Unit ${entity.unitNumber || entity.unit_number}` : 'Residence')
        : entity?.name;
    const defaultBackLabel = backLabel || (type === 'building' ? 'Back to Buildings' : t('backToResidences'));
    return ((0, jsx_runtime_1.jsxs)("div", { className: 'flex-1 flex flex-col overflow-hidden', children: [(0, jsx_runtime_1.jsx)("div", { className: 'p-6 pb-0', children: (0, jsx_runtime_1.jsxs)(button_1.Button, { variant: 'outline', onClick: () => navigate(backPath), className: 'mb-4', "data-testid": 'button-back', children: [(0, jsx_runtime_1.jsx)(lucide_react_1.ArrowLeft, { className: 'w-4 h-4 mr-2' }), defaultBackLabel] }) }), (0, jsx_runtime_1.jsx)(DocumentManager_1.default, { config: {
                    type,
                    userRole,
                    entityId,
                    entityName,
                    entityAddress: entity?.address,
                    ...permissions,
                } })] }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9jbGllbnQvc3JjL2NvbXBvbmVudHMvY29tbW9uL0RvY3VtZW50UGFnZVdyYXBwZXIudHN4IiwibWFwcGluZ3MiOiI7Ozs7O0FBZ0JBLHNDQTZKQzs7QUE3S0QsdURBQWlEO0FBQ2pELG1DQUFnRDtBQUNoRCxtREFBK0M7QUFDL0MsMEZBQWtFO0FBQ2xFLG1EQUFnRDtBQUNoRCwrQ0FBeUM7QUFDekMsdURBQW1EO0FBVW5ELFNBQXdCLG1CQUFtQixDQUFDLEVBQzFDLElBQUksRUFDSixRQUFRLEVBQ1IsUUFBUSxFQUNSLFNBQVMsRUFDVCxhQUFhLEdBQ1k7SUFDekIsTUFBTSxDQUFDLEVBQUUsUUFBUSxDQUFDLEdBQUcsSUFBQSxvQkFBVyxHQUFFLENBQUM7SUFDbkMsTUFBTSxNQUFNLEdBQUcsSUFBQSxrQkFBUyxHQUFFLENBQUM7SUFDM0IsTUFBTSxFQUFFLENBQUMsRUFBRSxHQUFHLElBQUEsMEJBQVcsR0FBRSxDQUFDO0lBRTVCLDBEQUEwRDtJQUMxRCxNQUFNLFNBQVMsR0FBRyxJQUFJLGVBQWUsQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0lBQzlELE1BQU0sUUFBUSxHQUFJLE1BQWMsQ0FBQyxhQUFhLENBQUMsSUFBSSxTQUFTLENBQUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBRWhGLG1CQUFtQjtJQUNuQixNQUFNLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxHQUFHLElBQUEsc0JBQVEsRUFBQztRQUM5QixRQUFRLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQztRQUM1QixPQUFPLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBQSx3QkFBVSxFQUFDLEtBQUssRUFBRSxnQkFBZ0IsQ0FBaUI7S0FDbkUsQ0FBQyxDQUFDO0lBRUgsZ0NBQWdDO0lBQ2hDLE1BQU0sYUFBYSxHQUFHLElBQUksS0FBSyxVQUFVLENBQUMsQ0FBQyxDQUFDLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQztJQUN6RixNQUFN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Q0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLEVBQ2pDLFNBQVMsRUFBQyxNQUFNLGlCQUNKLGFBQWEsYUFFekIsdUJBQUMsd0JBQVMsSUFBQyxTQUFTLEVBQUMsY0FBYyxHQUFHLEVBQ3JDLGdCQUFnQixJQUNWLEdBQ0wsRUFFTix1QkFBQyx5QkFBZSxJQUNkLE1BQU0sRUFBRTtvQkFDTixJQUFJO29CQUNKLFFBQVE7b0JBQ1IsUUFBUTtvQkFDUixVQUFVO29CQUNWLGFBQWEsRUFBRSxNQUFNLEVBQUUsT0FBTztvQkFDOUIsR0FBRyxXQUFXO2lCQUNmLEdBQ0QsSUFDRSxDQUNQLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvY2xpZW50L3NyYy9jb21wb25lbnRzL2NvbW1vbi9Eb2N1bWVudFBhZ2VXcmFwcGVyLnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VRdWVyeSB9IGZyb20gJ0B0YW5zdGFjay9yZWFjdC1xdWVyeSc7XG5pbXBvcnQgeyB1c2VMb2NhdGlvbiwgdXNlUGFyYW1zIH0gZnJvbSAnd291dGVyJztcbmltcG9ydCB7IGFwaVJlcXVlc3QgfSBmcm9tICdAL2xpYi9xdWVyeUNsaWVudCc7XG5pbXBvcnQgRG9jdW1lbnRNYW5hZ2VyIGZyb20gJ0AvY29tcG9uZW50cy9jb21tb24vRG9jdW1lbnRNYW5hZ2VyJztcbmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gJ0AvY29tcG9uZW50cy91aS9idXR0b24nO1xuaW1wb3J0IHsgQXJyb3dMZWZ0IH0gZnJvbSAnbHVjaWRlLXJlYWN0JztcbmltcG9ydCB7IHVzZUxhbmd1YWdlIH0gZnJvbSAnQC9ob29rcy91c2UtbGFuZ3VhZ2UnO1xuXG5pbnRlcmZhY2UgRG9jdW1lbnRQYWdlV3JhcHBlclByb3BzIHtcbiAgdHlwZTogJ2J1aWxkaW5nJyB8ICdyZXNpZGVuY2UnO1xuICB1c2VyUm9sZTogJ21hbmFnZXInIHwgJ3Jlc2lkZW50JztcbiAgYmFja1BhdGg6IHN0cmluZztcbiAgYmFja0xhYmVsPzogc3RyaW5nO1xuICBlbnRpdHlJZFBhcmFtOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIERvY3VtZW50UGFnZVdyYXBwZXIoe1xuICB0eXBlLFxuICB1c2VyUm9sZSxcbiAgYmFja1BhdGgsXG4gIGJhY2tMYWJlbCxcbiAgZW50aXR5SWRQYXJhbSxcbn06IERvY3VtZW50UGFnZVdyYXBwZXJQcm9wcykge1xuICBjb25zdCBbLCBuYXZpZ2F0ZV0gPSB1c2VMb2NhdGlvbigpO1xuICBjb25zdCBwYXJhbXMgPSB1c2VQYXJhbXMoKTtcbiAgY29uc3QgeyB0IH0gPSB1c2VMYW5ndWFnZSgpO1xuXG4gIC8vIEdldCBlbnRpdHlJZCBmcm9tIFVSTCAoYm90aCBwYXRoIHBhcmFtIGFuZCBxdWVyeSBwYXJhbSlcbiAgY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbiAgY29uc3QgZW50aXR5SWQgPSAocGFyYW1zIGFzIGFueSlbZW50aXR5SWRQYXJhbV0gfHwgdXJsUGFyYW1zLmdldChlbnRpdHlJZFBhcmFtKTtcblxuICAvLyBHZXQgY3VycmVudCB1c2VyXG4gIGNvbnN0IHsgZGF0YTogdXNlciB9ID0gdXNlUXVlcnkoe1xuICAgIHF1ZXJ5S2V5OiBbJy9hcGkvYXV0aC91c2VyJ10sXG4gICAgcXVlcnlGbjogKCkgPT4gYXBpUmVxdWVzdCgnR0VUJywgJy9hcGkvYXV0aC91c2VyJykgYXMgUHJvbWlzZTxhbnk+LFxuICB9KTtcblxuICAvLyBHZXQgZW50aXR5IGluZm8gYmFzZWQgb24gdHlwZVxuICBjb25zdCBlbnRpdHlBcGlQYXRoID0gdHlwZSA9PT0gJ2J1aWxkaW5nJyA/ICcvYXBpL21hbmFnZXIvYnVpbGRpbmdzJyA6ICcvYXBpL3Jlc2lkZW5jZXMnO1xuICBjb25zdCB7IGRhdGE6IGVudGl0eSwgaXNFcnJvcjogZW50aXR5RXJyb3IsIGVycm9yIH0gPSB1c2VRdWVyeSh7XG4gICAgcXVlcnlLZXk6IFtlbnRpdHlBcGlQYXRoLCBlbnRpdHlJZF0sXG4gICAgcXVlcnlGbjogYXN5bmMgKCkgPT4ge1xuICAgICAgaWYgKHR5cGUgPT09ICdyZXNpZGVuY2UnKSB7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYC9hcGkvcmVzaWRlbmNlcy8ke2VudGl0eUlkfWAsIHtcbiAgICAgICAgICBjcmVkZW50aWFsczogJ2luY2x1ZGUnLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT09IDQwNCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdFTlRJVFlfTk9UX0ZPVU5EJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoICR7dHlwZX1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGFwaVJlcXVlc3QoJ0dFVCcsIGAke2VudGl0eUFwaVBhdGh9LyR7ZW50aXR5SWR9YCkgYXMgUHJvbWlzZTxhbnk+O1xuICAgICAgfVxuICAgIH0sXG4gICAgZW5hYmxlZDogISFlbnRpdHlJZCxcbiAgICByZXRyeTogZmFsc2UsIC8vIERvbid0IHJldHJ5IG9uIDQwNHNcbiAgfSk7XG5cbiAgaWYgKCFlbnRpdHlJZCkge1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGNsYXNzTmFtZT0nZmxleC0xIGZsZXggZmxleC1jb2wgb3ZlcmZsb3ctaGlkZGVuJz5cbiAgICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlcic+XG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9J3RleHQtY2VudGVyJz5cbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0ndGV4dC1ncmF5LTUwMCBtYi00Jz57dHlwZX0gSUQgaXMgcmVxdWlyZWQ8L3A+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHZhcmlhbnQ9J291dGxpbmUnXG4gICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG5hdmlnYXRlKGJhY2tQYXRoKX1cbiAgICAgICAgICAgICAgZGF0YS10ZXN0aWQ9J2J1dHRvbi1iYWNrLXRvLWxpc3QnXG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxBcnJvd0xlZnQgY2xhc3NOYW1lPSd3LTQgaC00IG1yLTInIC8+XG4gICAgICAgICAgICAgIHtiYWNrTGFiZWwgfHwgYEJhY2sgdG8gJHt0eXBlfXNgfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxuXG4gIC8vIEhhbmRsZSBlbnRpdHkgbm90IGZvdW5kIChzcGVjaWZpYyB0byByZXNpZGVuY2UgcGFnZXMgdGhhdCBoYWQgdGhpcyBsb2dpYylcbiAgaWYgKGVudGl0eUVycm9yICYmIGVycm9yPy5tZXNzYWdlID09PSAnRU5USVRZX05PVF9GT1VORCcgJiYgdHlwZSA9PT0gJ3Jlc2lkZW5jZScpIHtcbiAgICByZXR1cm4gKFxuICAgICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbic+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPSdmbGV4LTEgZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXInPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSd0ZXh0LWNlbnRlciBtYXgtdy1tZCc+XG4gICAgICAgICAgICA8aDIgY2xhc3NOYW1lPSd0ZXh0LXhsIGZvbnQtc2VtaWJvbGQgbWItNCc+UmVzaWRlbmNlIE5vdCBGb3VuZDwvaDI+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtZ3JheS01MDAgbWItNCc+XG4gICAgICAgICAgICAgIFRoZSByZXNpZGVuY2UgSUQgXCJ7ZW50aXR5SWR9XCIgZG9lc24ndCBleGlzdCBpbiB0aGUgZGV2ZWxvcG1lbnQgZGF0YWJhc2UuXG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9J3RleHQtc20gdGV4dC1ncmF5LTQwMCBtYi02Jz5cbiAgICAgICAgICAgICAgVGhpcyBtaWdodCBiZSBhIHByb2R1Y3Rpb24gZGF0YWJhc2UgSUQuIFBsZWFzZSB1c2UgYSB2YWxpZCBkZXZlbG9wbWVudCByZXNpZGVuY2UgSUQuXG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0nc3BhY2UteS0yJz5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9J2RlZmF1bHQnXG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gbmF2aWdhdGUoYmFja1BhdGgpfVxuICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPSdidXR0b24tYmFjay10by1saXN0J1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ndy1mdWxsJ1xuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPEFycm93TGVmdCBjbGFzc05hbWU9J3ctNCBoLTQgbXItMicgLz5cbiAgICAgICAgICAgICAgICB7YmFja0xhYmVsIHx8ICdCYWNrIHRvIFJlc2lkZW5jZXMnfVxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIHZhcmlhbnQ9J291dGxpbmUnXG4gICAgICAgICAgICAgICAgb25DbGljaz17KCkgPT5cbiAgICAgICAgICAgICAgICAgIG5hdmlnYXRlKCcvcmVzaWRlbnRzL3Jlc2lkZW5jZXMvZTI3YWM5MjQtODEyMC00OTA0LWE3OTEtZDFlOWRiNTQ0ZDU4L2RvY3VtZW50cycpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPSdidXR0b24tZ28tdG8tdmFsaWQtcmVzaWRlbmNlJ1xuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ndy1mdWxsJ1xuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgR28gdG8gVW5pdCAxMDEgKFRlc3QgUmVzaWRlbmNlKVxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH1cblxuICAvLyBEZXRlcm1pbmUgcGVybWlzc2lvbnMgYmFzZWQgb24gdXNlciByb2xlIGFuZCB0eXBlXG4gIGNvbnN0IGlzVXNlclRlbmFudCA9IHVzZXI/LnJvbGUgPT09ICd0ZW5hbnQnO1xuICBjb25zdCBpc01hbmFnZXIgPSB1c2VyPy5yb2xlID09PSAnbWFuYWdlcicgfHwgdXNlcj8ucm9sZSA9PT0gJ2FkbWluJztcbiAgXG4gIGNvbnN0IHBlcm1pc3Npb25zID0gdXNlclJvbGUgPT09ICdtYW5hZ2VyJyBcbiAgICA/IHtcbiAgICAgICAgYWxsb3dDcmVhdGU6IGlzTWFuYWdlcixcbiAgICAgICAgYWxsb3dFZGl0OiBpc01hbmFnZXIsXG4gICAgICAgIGFsbG93RGVsZXRlOiBpc01hbmFnZXIsXG4gICAgICAgIHNob3dWaXNpYmlsaXR5VG9nZ2xlOiBpc01hbmFnZXIsXG4gICAgICB9XG4gICAgOiB7XG4gICAgICAgIGFsbG93Q3JlYXRlOiAhaXNVc2VyVGVuYW50LFxuICAgICAgICBhbGxvd0VkaXQ6ICFpc1VzZXJUZW5hbnQsXG4gICAgICAgIGFsbG93RGVsZXRlOiAhaXNVc2VyVGVuYW50LFxuICAgICAgICBzaG93VmlzaWJpbGl0eVRvZ2dsZTogIWlzVXNlclRlbmFudCxcbiAgICAgIH07XG5cbiAgLy8gR2VuZXJhdGUgZW50aXR5IG5hbWUgYmFzZWQgb24gdHlwZVxuICBjb25zdCBlbnRpdHlOYW1lID0gdHlwZSA9PT0gJ3Jlc2lkZW5jZScgXG4gICAgPyAoZW50aXR5Py51bml0TnVtYmVyIHx8IGVudGl0eT8udW5pdF9udW1iZXIgPyBgVW5pdCAke2VudGl0eS51bml0TnVtYmVyIHx8IGVudGl0eS51bml0X251bWJlcn1gIDogJ1Jlc2lkZW5jZScpXG4gICAgOiBlbnRpdHk/Lm5hbWU7XG5cbiAgY29uc3QgZGVmYXVsdEJhY2tMYWJlbCA9IGJhY2tMYWJlbCB8fCAodHlwZSA9PT0gJ2J1aWxkaW5nJyA/ICdCYWNrIHRvIEJ1aWxkaW5ncycgOiB0KCdiYWNrVG9SZXNpZGVuY2VzJykpO1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9J2ZsZXgtMSBmbGV4IGZsZXgtY29sIG92ZXJmbG93LWhpZGRlbic+XG4gICAgICB7LyogQmFjayBidXR0b24gKi99XG4gICAgICA8ZGl2IGNsYXNzTmFtZT0ncC02IHBiLTAnPlxuICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgdmFyaWFudD0nb3V0bGluZSdcbiAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBuYXZpZ2F0ZShiYWNrUGF0aCl9XG4gICAgICAgICAgY2xhc3NOYW1lPSdtYi00J1xuICAgICAgICAgIGRhdGEtdGVzdGlkPSdidXR0b24tYmFjaydcbiAgICAgICAgPlxuICAgICAgICAgIDxBcnJvd0xlZnQgY2xhc3NOYW1lPSd3LTQgaC00IG1yLTInIC8+XG4gICAgICAgICAge2RlZmF1bHRCYWNrTGFiZWx9XG4gICAgICAgIDwvQnV0dG9uPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxEb2N1bWVudE1hbmFnZXJcbiAgICAgICAgY29uZmlnPXt7XG4gICAgICAgICAgdHlwZSxcbiAgICAgICAgICB1c2VyUm9sZSxcbiAgICAgICAgICBlbnRpdHlJZCxcbiAgICAgICAgICBlbnRpdHlOYW1lLFxuICAgICAgICAgIGVudGl0eUFkZHJlc3M6IGVudGl0eT8uYWRkcmVzcyxcbiAgICAgICAgICAuLi5wZXJtaXNzaW9ucyxcbiAgICAgICAgfX1cbiAgICAgIC8+XG4gICAgPC9kaXY+XG4gICk7XG59Il0sInZlcnNpb24iOjN9