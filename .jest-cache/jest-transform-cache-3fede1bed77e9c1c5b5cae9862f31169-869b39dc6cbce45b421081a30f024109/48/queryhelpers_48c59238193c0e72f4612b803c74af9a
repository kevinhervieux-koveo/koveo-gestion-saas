df259419d6fabcb341ff73d63acc2bc7
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.buildQueries = buildQueries;
exports.getElementError = getElementError;
exports.getMultipleElementsFoundError = getMultipleElementsFoundError;
exports.makeFindQuery = makeFindQuery;
exports.makeGetAllQuery = makeGetAllQuery;
exports.makeSingleQuery = makeSingleQuery;
exports.queryAllByAttribute = queryAllByAttribute;
exports.queryByAttribute = queryByAttribute;
exports.wrapSingleQueryWithSuggestion = exports.wrapAllByQueryWithSuggestion = void 0;
var _suggestions = require("./suggestions");
var _matches = require("./matches");
var _waitFor = require("./wait-for");
var _config = require("./config");
function getElementError(message, container) {
    return (0, _config.getConfig)().getElementError(message, container);
}
function getMultipleElementsFoundError(message, container) {
    return getElementError(`${message}\n\n(If this is intentional, then use the \`*AllBy*\` variant of the query (like \`queryAllByText\`, \`getAllByText\`, or \`findAllByText\`)).`, container);
}
function queryAllByAttribute(attribute, container, text, { exact = true, collapseWhitespace, trim, normalizer } = {}) {
    const matcher = exact ? _matches.matches : _matches.fuzzyMatches;
    const matchNormalizer = (0, _matches.makeNormalizer)({
        collapseWhitespace,
        trim,
        normalizer
    });
    return Array.from(container.querySelectorAll(`[${attribute}]`)).filter(node => matcher(node.getAttribute(attribute), node, text, matchNormalizer));
}
function queryByAttribute(attribute, container, text, options) {
    const els = queryAllByAttribute(attribute, container, text, options);
    if (els.length > 1) {
        throw getMultipleElementsFoundError(`Found multiple elements by [${attribute}=${text}]`, container);
    }
    return els[0] || null;
}
// this accepts a query function and returns a function which throws an error
// if more than one elements is returned, otherwise it returns the first
// element or null
function makeSingleQuery(allQuery, getMultipleError) {
    return (container, ...args) => {
        const els = allQuery(container, ...args);
        if (els.length > 1) {
            const elementStrings = els.map(element => getElementError(null, element).message).join('\n\n');
            throw getMultipleElementsFoundError(`${getMultipleError(container, ...args)}

Here are the matching elements:

${elementStrings}`, container);
        }
        return els[0] || null;
    };
}
function getSuggestionError(suggestion, container) {
    return (0, _config.getConfig)().getElementError(`A better query is available, try this:
${suggestion.toString()}
`, container);
}
// this accepts a query function and returns a function which throws an error
// if an empty list of elements is returned
function makeGetAllQuery(allQuery, getMissingError) {
    return (container, ...args) => {
        const els = allQuery(container, ...args);
        if (!els.length) {
            throw (0, _config.getConfig)().getElementError(getMissingError(container, ...args), container);
        }
        return els;
    };
}
// this accepts a getter query function and returns a function which calls
// waitFor and passing a function which invokes the getter.
function makeFindQuery(getter) {
    return (container, text, options, waitForOptions) => {
        return (0, _waitFor.waitFor)(() => {
            return getter(container, text, options);
        }, {
            container,
            ...waitForOptions
        });
    };
}
const wrapSingleQueryWithSuggestion = (query, queryAllByName, variant) => (container, ...args) => {
    const element = query(container, ...args);
    const [{ suggest = (0, _config.getConfig)().throwSuggestions } = {}] = args.slice(-1);
    if (element && suggest) {
        const suggestion = (0, _suggestions.getSuggestedQuery)(element, variant);
        if (suggestion && !queryAllByName.endsWith(suggestion.queryName)) {
            throw getSuggestionError(suggestion.toString(), container);
        }
    }
    return element;
};
exports.wrapSingleQueryWithSuggestion = wrapSingleQueryWithSuggestion;
const wrapAllByQueryWithSuggestion = (query, queryAllByName, variant) => (container, ...args) => {
    const els = query(container, ...args);
    const [{ suggest = (0, _config.getConfig)().throwSuggestions } = {}] = args.slice(-1);
    if (els.length && suggest) {
        // get a unique list of all suggestion messages.  We are only going to make a suggestion if
        // all the suggestions are the same
        const uniqueSuggestionMessages = [...new Set(els.map(element => (0, _suggestions.getSuggestedQuery)(element, variant)?.toString()))];
        if (
        // only want to suggest if all the els have the same suggestion.
        uniqueSuggestionMessages.length === 1 && !queryAllByName.endsWith(
        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion -- TODO: Can this be null at runtime?
        (0, _suggestions.getSuggestedQuery)(els[0], variant).queryName)) {
            throw getSuggestionError(uniqueSuggestionMessages[0], container);
        }
    }
    return els;
};
// TODO: This deviates from the published declarations
// However, the implementation always required a dyadic (after `container`) not variadic `queryAllBy` considering the implementation of `makeFindQuery`
// This is at least statically true and can be verified by accepting `QueryMethod<Arguments, HTMLElement[]>`
exports.wrapAllByQueryWithSuggestion = wrapAllByQueryWithSuggestion;
function buildQueries(queryAllBy, getMultipleError, getMissingError) {
    const queryBy = wrapSingleQueryWithSuggestion(makeSingleQuery(queryAllBy, getMultipleError), queryAllBy.name, 'query');
    const getAllBy = makeGetAllQuery(queryAllBy, getMissingError);
    const getBy = makeSingleQuery(getAllBy, getMultipleError);
    const getByWithSuggestions = wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'get');
    const getAllWithSuggestions = wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name.replace('query', 'get'), 'getAll');
    const findAllBy = makeFindQuery(wrapAllByQueryWithSuggestion(getAllBy, queryAllBy.name, 'findAll'));
    const findBy = makeFindQuery(wrapSingleQueryWithSuggestion(getBy, queryAllBy.name, 'find'));
    return [queryBy, getAllWithSuggestions, getByWithSuggestions, findAllBy, findBy];
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9xdWVyeS1oZWxwZXJzLmpzIiwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQztBQUViLE1BQU0sQ0FBQyxjQUFjLENBQUMsT0FBTyxFQUFFLFlBQVksRUFBRTtJQUMzQyxLQUFLLEVBQUUsSUFBSTtDQUNaLENBQUMsQ0FBQztBQUNILE9BQU8sQ0FBQyxZQUFZLEdBQUcsWUFBWSxDQUFDO0FBQ3BDLE9BQU8sQ0FBQyxlQUFlLEdBQUcsZUFBZSxDQUFDO0FBQzFDLE9BQU8sQ0FBQyw2QkFBNkIsR0FBRyw2QkFBNkIsQ0FBQztBQUN0RSxPQUFPLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztBQUN0QyxPQUFPLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztBQUMxQyxPQUFPLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztBQUMxQyxPQUFPLENBQUMsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7QUFDbEQsT0FBTyxDQUFDLGdCQUFnQixHQUFHLGdCQUFnQixDQUFDO0FBQzVDLE9BQU8sQ0FBQyw2QkFBNkIsR0FBRyxPQUFPLENBQUMsNEJBQTRCLEdBQUcsS0FBSyxDQUFDLENBQUM7QUFDdEYsSUFBSSxZQUFZLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzVDLElBQUksUUFBUSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUNwQyxJQUFJLFFBQVEsR0FBRyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDckMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0FBQ2xDLFNBQVMsZUFBZSxDQUFDLE9BQU8sRUFBRSxTQUFTO0lBQ3pDLE9BQU8sQ0FBQyxDQUFDLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsZUFBZSxDQUFDLE9BQU8sRUFBRSxTQUFTLENBQUMsQ0FBQztBQUN0RSxDQUFDO0FBQ0QsU0FBUyw2QkFBNkIs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LFVBQVUsQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNwRyxNQUFNLE1BQU0sR0FBRyxhQUFhLENBQUMsNkJBQTZCLENBQUMsS0FBSyxFQUFFLFVBQVUsQ0FBQyxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQztJQUM1RixPQUFPLENBQUMsT0FBTyxFQUFFLHFCQUFxQixFQUFFLG9CQUFvQixFQUFFLFNBQVMsRUFBRSxNQUFNLENBQUMsQ0FBQztBQUNuRixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2Uvbm9kZV9tb2R1bGVzL0B0ZXN0aW5nLWxpYnJhcnkvZG9tL2Rpc3QvcXVlcnktaGVscGVycy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuYnVpbGRRdWVyaWVzID0gYnVpbGRRdWVyaWVzO1xuZXhwb3J0cy5nZXRFbGVtZW50RXJyb3IgPSBnZXRFbGVtZW50RXJyb3I7XG5leHBvcnRzLmdldE11bHRpcGxlRWxlbWVudHNGb3VuZEVycm9yID0gZ2V0TXVsdGlwbGVFbGVtZW50c0ZvdW5kRXJyb3I7XG5leHBvcnRzLm1ha2VGaW5kUXVlcnkgPSBtYWtlRmluZFF1ZXJ5O1xuZXhwb3J0cy5tYWtlR2V0QWxsUXVlcnkgPSBtYWtlR2V0QWxsUXVlcnk7XG5leHBvcnRzLm1ha2VTaW5nbGVRdWVyeSA9IG1ha2VTaW5nbGVRdWVyeTtcbmV4cG9ydHMucXVlcnlBbGxCeUF0dHJpYnV0ZSA9IHF1ZXJ5QWxsQnlBdHRyaWJ1dGU7XG5leHBvcnRzLnF1ZXJ5QnlBdHRyaWJ1dGUgPSBxdWVyeUJ5QXR0cmlidXRlO1xuZXhwb3J0cy53cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbiA9IGV4cG9ydHMud3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbiA9IHZvaWQgMDtcbnZhciBfc3VnZ2VzdGlvbnMgPSByZXF1aXJlKFwiLi9zdWdnZXN0aW9uc1wiKTtcbnZhciBfbWF0Y2hlcyA9IHJlcXVpcmUoXCIuL21hdGNoZXNcIik7XG52YXIgX3dhaXRGb3IgPSByZXF1aXJlKFwiLi93YWl0LWZvclwiKTtcbnZhciBfY29uZmlnID0gcmVxdWlyZShcIi4vY29uZmlnXCIpO1xuZnVuY3Rpb24gZ2V0RWxlbWVudEVycm9yKG1lc3NhZ2UsIGNvbnRhaW5lcikge1xuICByZXR1cm4gKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmdldEVsZW1lbnRFcnJvcihtZXNzYWdlLCBjb250YWluZXIpO1xufVxuZnVuY3Rpb24gZ2V0TXVsdGlwbGVFbGVtZW50c0ZvdW5kRXJyb3IobWVzc2FnZSwgY29udGFpbmVyKSB7XG4gIHJldHVybiBnZXRFbGVtZW50RXJyb3IoYCR7bWVzc2FnZX1cXG5cXG4oSWYgdGhpcyBpcyBpbnRlbnRpb25hbCwgdGhlbiB1c2UgdGhlIFxcYCpBbGxCeSpcXGAgdmFyaWFudCBvZiB0aGUgcXVlcnkgKGxpa2UgXFxgcXVlcnlBbGxCeVRleHRcXGAsIFxcYGdldEFsbEJ5VGV4dFxcYCwgb3IgXFxgZmluZEFsbEJ5VGV4dFxcYCkpLmAsIGNvbnRhaW5lcik7XG59XG5mdW5jdGlvbiBxdWVyeUFsbEJ5QXR0cmlidXRlKGF0dHJpYnV0ZSwgY29udGFpbmVyLCB0ZXh0LCB7XG4gIGV4YWN0ID0gdHJ1ZSxcbiAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICB0cmltLFxuICBub3JtYWxpemVyXG59ID0ge30pIHtcbiAgY29uc3QgbWF0Y2hlciA9IGV4YWN0ID8gX21hdGNoZXMubWF0Y2hlcyA6IF9tYXRjaGVzLmZ1enp5TWF0Y2hlcztcbiAgY29uc3QgbWF0Y2hOb3JtYWxpemVyID0gKDAsIF9tYXRjaGVzLm1ha2VOb3JtYWxpemVyKSh7XG4gICAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICAgIHRyaW0sXG4gICAgbm9ybWFsaXplclxuICB9KTtcbiAgcmV0dXJuIEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoYFske2F0dHJpYnV0ZX1dYCkpLmZpbHRlcihub2RlID0+IG1hdGNoZXIobm9kZS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSwgbm9kZSwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSk7XG59XG5mdW5jdGlvbiBxdWVyeUJ5QXR0cmlidXRlKGF0dHJpYnV0ZSwgY29udGFpbmVyLCB0ZXh0LCBvcHRpb25zKSB7XG4gIGNvbnN0IGVscyA9IHF1ZXJ5QWxsQnlBdHRyaWJ1dGUoYXR0cmlidXRlLCBjb250YWluZXIsIHRleHQsIG9wdGlvbnMpO1xuICBpZiAoZWxzLmxlbmd0aCA+IDEpIHtcbiAgICB0aHJvdyBnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvcihgRm91bmQgbXVsdGlwbGUgZWxlbWVudHMgYnkgWyR7YXR0cmlidXRlfT0ke3RleHR9XWAsIGNvbnRhaW5lcik7XG4gIH1cbiAgcmV0dXJuIGVsc1swXSB8fCBudWxsO1xufVxuXG4vLyB0aGlzIGFjY2VwdHMgYSBxdWVyeSBmdW5jdGlvbiBhbmQgcmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoIHRocm93cyBhbiBlcnJvclxuLy8gaWYgbW9yZSB0aGFuIG9uZSBlbGVtZW50cyBpcyByZXR1cm5lZCwgb3RoZXJ3aXNlIGl0IHJldHVybnMgdGhlIGZpcnN0XG4vLyBlbGVtZW50IG9yIG51bGxcbmZ1bmN0aW9uIG1ha2VTaW5nbGVRdWVyeShhbGxRdWVyeSwgZ2V0TXVsdGlwbGVFcnJvcikge1xuICByZXR1cm4gKGNvbnRhaW5lciwgLi4uYXJncykgPT4ge1xuICAgIGNvbnN0IGVscyA9IGFsbFF1ZXJ5KGNvbnRhaW5lciwgLi4uYXJncyk7XG4gICAgaWYgKGVscy5sZW5ndGggPiAxKSB7XG4gICAgICBjb25zdCBlbGVtZW50U3RyaW5ncyA9IGVscy5tYXAoZWxlbWVudCA9PiBnZXRFbGVtZW50RXJyb3IobnVsbCwgZWxlbWVudCkubWVzc2FnZSkuam9pbignXFxuXFxuJyk7XG4gICAgICB0aHJvdyBnZXRNdWx0aXBsZUVsZW1lbnRzRm91bmRFcnJvcihgJHtnZXRNdWx0aXBsZUVycm9yKGNvbnRhaW5lciwgLi4uYXJncyl9XG5cbkhlcmUgYXJlIHRoZSBtYXRjaGluZyBlbGVtZW50czpcblxuJHtlbGVtZW50U3RyaW5nc31gLCBjb250YWluZXIpO1xuICAgIH1cbiAgICByZXR1cm4gZWxzWzBdIHx8IG51bGw7XG4gIH07XG59XG5mdW5jdGlvbiBnZXRTdWdnZXN0aW9uRXJyb3Ioc3VnZ2VzdGlvbiwgY29udGFpbmVyKSB7XG4gIHJldHVybiAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkuZ2V0RWxlbWVudEVycm9yKGBBIGJldHRlciBxdWVyeSBpcyBhdmFpbGFibGUsIHRyeSB0aGlzOlxuJHtzdWdnZXN0aW9uLnRvU3RyaW5nKCl9XG5gLCBjb250YWluZXIpO1xufVxuXG4vLyB0aGlzIGFjY2VwdHMgYSBxdWVyeSBmdW5jdGlvbiBhbmQgcmV0dXJucyBhIGZ1bmN0aW9uIHdoaWNoIHRocm93cyBhbiBlcnJvclxuLy8gaWYgYW4gZW1wdHkgbGlzdCBvZiBlbGVtZW50cyBpcyByZXR1cm5lZFxuZnVuY3Rpb24gbWFrZUdldEFsbFF1ZXJ5KGFsbFF1ZXJ5LCBnZXRNaXNzaW5nRXJyb3IpIHtcbiAgcmV0dXJuIChjb250YWluZXIsIC4uLmFyZ3MpID0+IHtcbiAgICBjb25zdCBlbHMgPSBhbGxRdWVyeShjb250YWluZXIsIC4uLmFyZ3MpO1xuICAgIGlmICghZWxzLmxlbmd0aCkge1xuICAgICAgdGhyb3cgKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmdldEVsZW1lbnRFcnJvcihnZXRNaXNzaW5nRXJyb3IoY29udGFpbmVyLCAuLi5hcmdzKSwgY29udGFpbmVyKTtcbiAgICB9XG4gICAgcmV0dXJuIGVscztcbiAgfTtcbn1cblxuLy8gdGhpcyBhY2NlcHRzIGEgZ2V0dGVyIHF1ZXJ5IGZ1bmN0aW9uIGFuZCByZXR1cm5zIGEgZnVuY3Rpb24gd2hpY2ggY2FsbHNcbi8vIHdhaXRGb3IgYW5kIHBhc3NpbmcgYSBmdW5jdGlvbiB3aGljaCBpbnZva2VzIHRoZSBnZXR0ZXIuXG5mdW5jdGlvbiBtYWtlRmluZFF1ZXJ5KGdldHRlcikge1xuICByZXR1cm4gKGNvbnRhaW5lciwgdGV4dCwgb3B0aW9ucywgd2FpdEZvck9wdGlvbnMpID0+IHtcbiAgICByZXR1cm4gKDAsIF93YWl0Rm9yLndhaXRGb3IpKCgpID0+IHtcbiAgICAgIHJldHVybiBnZXR0ZXIoY29udGFpbmVyLCB0ZXh0LCBvcHRpb25zKTtcbiAgICB9LCB7XG4gICAgICBjb250YWluZXIsXG4gICAgICAuLi53YWl0Rm9yT3B0aW9uc1xuICAgIH0pO1xuICB9O1xufVxuY29uc3Qgd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24gPSAocXVlcnksIHF1ZXJ5QWxsQnlOYW1lLCB2YXJpYW50KSA9PiAoY29udGFpbmVyLCAuLi5hcmdzKSA9PiB7XG4gIGNvbnN0IGVsZW1lbnQgPSBxdWVyeShjb250YWluZXIsIC4uLmFyZ3MpO1xuICBjb25zdCBbe1xuICAgIHN1Z2dlc3QgPSAoMCwgX2NvbmZpZy5nZXRDb25maWcpKCkudGhyb3dTdWdnZXN0aW9uc1xuICB9ID0ge31dID0gYXJncy5zbGljZSgtMSk7XG4gIGlmIChlbGVtZW50ICYmIHN1Z2dlc3QpIHtcbiAgICBjb25zdCBzdWdnZXN0aW9uID0gKDAsIF9zdWdnZXN0aW9ucy5nZXRTdWdnZXN0ZWRRdWVyeSkoZWxlbWVudCwgdmFyaWFudCk7XG4gICAgaWYgKHN1Z2dlc3Rpb24gJiYgIXF1ZXJ5QWxsQnlOYW1lLmVuZHNXaXRoKHN1Z2dlc3Rpb24ucXVlcnlOYW1lKSkge1xuICAgICAgdGhyb3cgZ2V0U3VnZ2VzdGlvbkVycm9yKHN1Z2dlc3Rpb24udG9TdHJpbmcoKSwgY29udGFpbmVyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGVsZW1lbnQ7XG59O1xuZXhwb3J0cy53cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbiA9IHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uO1xuY29uc3Qgd3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbiA9IChxdWVyeSwgcXVlcnlBbGxCeU5hbWUsIHZhcmlhbnQpID0+IChjb250YWluZXIsIC4uLmFyZ3MpID0+IHtcbiAgY29uc3QgZWxzID0gcXVlcnkoY29udGFpbmVyLCAuLi5hcmdzKTtcbiAgY29uc3QgW3tcbiAgICBzdWdnZXN0ID0gKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLnRocm93U3VnZ2VzdGlvbnNcbiAgfSA9IHt9XSA9IGFyZ3Muc2xpY2UoLTEpO1xuICBpZiAoZWxzLmxlbmd0aCAmJiBzdWdnZXN0KSB7XG4gICAgLy8gZ2V0IGEgdW5pcXVlIGxpc3Qgb2YgYWxsIHN1Z2dlc3Rpb24gbWVzc2FnZXMuICBXZSBhcmUgb25seSBnb2luZyB0byBtYWtlIGEgc3VnZ2VzdGlvbiBpZlxuICAgIC8vIGFsbCB0aGUgc3VnZ2VzdGlvbnMgYXJlIHRoZSBzYW1lXG4gICAgY29uc3QgdW5pcXVlU3VnZ2VzdGlvbk1lc3NhZ2VzID0gWy4uLm5ldyBTZXQoZWxzLm1hcChlbGVtZW50ID0+ICgwLCBfc3VnZ2VzdGlvbnMuZ2V0U3VnZ2VzdGVkUXVlcnkpKGVsZW1lbnQsIHZhcmlhbnQpPy50b1N0cmluZygpKSldO1xuICAgIGlmIChcbiAgICAvLyBvbmx5IHdhbnQgdG8gc3VnZ2VzdCBpZiBhbGwgdGhlIGVscyBoYXZlIHRoZSBzYW1lIHN1Z2dlc3Rpb24uXG4gICAgdW5pcXVlU3VnZ2VzdGlvbk1lc3NhZ2VzLmxlbmd0aCA9PT0gMSAmJiAhcXVlcnlBbGxCeU5hbWUuZW5kc1dpdGgoXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1ub24tbnVsbC1hc3NlcnRpb24gLS0gVE9ETzogQ2FuIHRoaXMgYmUgbnVsbCBhdCBydW50aW1lP1xuICAgICgwLCBfc3VnZ2VzdGlvbnMuZ2V0U3VnZ2VzdGVkUXVlcnkpKGVsc1swXSwgdmFyaWFudCkucXVlcnlOYW1lKSkge1xuICAgICAgdGhyb3cgZ2V0U3VnZ2VzdGlvbkVycm9yKHVuaXF1ZVN1Z2dlc3Rpb25NZXNzYWdlc1swXSwgY29udGFpbmVyKTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGVscztcbn07XG5cbi8vIFRPRE86IFRoaXMgZGV2aWF0ZXMgZnJvbSB0aGUgcHVibGlzaGVkIGRlY2xhcmF0aW9uc1xuLy8gSG93ZXZlciwgdGhlIGltcGxlbWVudGF0aW9uIGFsd2F5cyByZXF1aXJlZCBhIGR5YWRpYyAoYWZ0ZXIgYGNvbnRhaW5lcmApIG5vdCB2YXJpYWRpYyBgcXVlcnlBbGxCeWAgY29uc2lkZXJpbmcgdGhlIGltcGxlbWVudGF0aW9uIG9mIGBtYWtlRmluZFF1ZXJ5YFxuLy8gVGhpcyBpcyBhdCBsZWFzdCBzdGF0aWNhbGx5IHRydWUgYW5kIGNhbiBiZSB2ZXJpZmllZCBieSBhY2NlcHRpbmcgYFF1ZXJ5TWV0aG9kPEFyZ3VtZW50cywgSFRNTEVsZW1lbnRbXT5gXG5leHBvcnRzLndyYXBBbGxCeVF1ZXJ5V2l0aFN1Z2dlc3Rpb24gPSB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uO1xuZnVuY3Rpb24gYnVpbGRRdWVyaWVzKHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IsIGdldE1pc3NpbmdFcnJvcikge1xuICBjb25zdCBxdWVyeUJ5ID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24obWFrZVNpbmdsZVF1ZXJ5KHF1ZXJ5QWxsQnksIGdldE11bHRpcGxlRXJyb3IpLCBxdWVyeUFsbEJ5Lm5hbWUsICdxdWVyeScpO1xuICBjb25zdCBnZXRBbGxCeSA9IG1ha2VHZXRBbGxRdWVyeShxdWVyeUFsbEJ5LCBnZXRNaXNzaW5nRXJyb3IpO1xuICBjb25zdCBnZXRCeSA9IG1ha2VTaW5nbGVRdWVyeShnZXRBbGxCeSwgZ2V0TXVsdGlwbGVFcnJvcik7XG4gIGNvbnN0IGdldEJ5V2l0aFN1Z2dlc3Rpb25zID0gd3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24oZ2V0QnksIHF1ZXJ5QWxsQnkubmFtZSwgJ2dldCcpO1xuICBjb25zdCBnZXRBbGxXaXRoU3VnZ2VzdGlvbnMgPSB3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUucmVwbGFjZSgncXVlcnknLCAnZ2V0JyksICdnZXRBbGwnKTtcbiAgY29uc3QgZmluZEFsbEJ5ID0gbWFrZUZpbmRRdWVyeSh3cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEFsbEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kQWxsJykpO1xuICBjb25zdCBmaW5kQnkgPSBtYWtlRmluZFF1ZXJ5KHdyYXBTaW5nbGVRdWVyeVdpdGhTdWdnZXN0aW9uKGdldEJ5LCBxdWVyeUFsbEJ5Lm5hbWUsICdmaW5kJykpO1xuICByZXR1cm4gW3F1ZXJ5QnksIGdldEFsbFdpdGhTdWdnZXN0aW9ucywgZ2V0QnlXaXRoU3VnZ2VzdGlvbnMsIGZpbmRBbGxCeSwgZmluZEJ5XTtcbn0iXSwidmVyc2lvbiI6M30=