0b06d18c49d230450d18ef258429f755
"use strict";
/**
 * Document Management Security Tests (Semgrep Integration)
 *
 * This test suite validates security controls using patterns that would be detected
 * by Semgrep static analysis tool. Each test represents a security vulnerability
 * category that Semgrep would flag in real code.
 *
 * Test Categories:
 * 1. SQL Injection Prevention (semgrep: sql-injection)
 * 2. Path Traversal Protection (semgrep: path-traversal)
 * 3. File Upload Security (semgrep: file-upload-security)
 * 4. Input Validation (semgrep: input-validation)
 * 5. Authentication & Authorization (semgrep: auth-security)
 *
 * Each test demonstrates both vulnerable patterns that Semgrep would flag
 * and secure implementations that pass security validation.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
(0, globals_1.describe)('Document Management Security Tests (Semgrep Patterns)', () => {
    (0, globals_1.describe)('SQL Injection Prevention (semgrep: sql-injection)', () => {
        (0, globals_1.it)('should use parameterized queries for document searches', () => {
            // This simulates secure database query patterns that Semgrep would approve
            const secureDocumentQuery = (searchTerm, userId) => {
                // Good: Parameterized query (Semgrep would approve)
                const query = 'SELECT * FROM documents WHERE title = ? AND user_id = ?';
                const params = [searchTerm, userId];
                return { query, params };
            };
            const result = secureDocumentQuery('test document', 'user123');
            (0, globals_1.expect)(result.query).toContain('?');
            (0, globals_1.expect)(result.params).toHaveLength(2);
            (0, globals_1.expect)(result.params[0]).toBe('test document');
            (0, globals_1.expect)(result.params[1]).toBe('user123');
        });
        (0, globals_1.it)('should sanitize document metadata for database operations', () => {
            const sanitizeForDB = (input) => {
                // Escape single quotes and remove null bytes
                return input
                    .replace(/'/g, "''")
                    .replace(/\0/g, '')
                    .trim();
            };
            (0, globals_1.expect)(sanitizeForDB("O'Connor Document")).toBe("O''Connor Document");
            (0, globals_1.expect)(sanitizeForDB("Test\0Document")).toBe("TestDocument");
            (0, globals_1.expect)(sanitizeForDB("  Normal Document  ")).toBe("Normal Document");
        });
    });
    (0, globals_1.describe)('Path Traversal Protection (semgrep: path-traversal)', () => {
        (0, globals_1.it)('should prevent directory traversal in document file paths', () => {
            const secureFilePath = (filename) => {
                // Remove path traversal patterns
                const cleaned = filename
                    .replace(/\.\./g, '') // Remove ..
                    .replace(/\//g, '') // Remove forward slashes
                    .replace(/\\/g, '') // Remove backslashes
                    .replace(/:/g, ''); // Remove colons (Windows drive letters)
                return `documents/${cleaned}`;
            };
            // Test various path traversal attempts
            (0, globals_1.expect)(secureFilePath('../../../etc/passwd')).toBe('documents/etcpasswd');
            (0, globals_1.expect)(secureFilePath('..\\..\\windows\\system32\\config')).toBe('documents/windowssystem32config');
            (0, globals_1.expect)(secureFilePath('normal-document.pdf')).toBe('documents/normal-document.pdf');
            (0, globals_1.expect)(secureFilePath('c:\\temp\\file.txt')).toBe('documents/ctempfile.txt');
        });
        (0, globals_1.it)('should validate document upload paths are within allowed directories', () => {
            const isValidUploadPath = (path) => {
                const allowedPaths = ['/uploads/', '/documents/', '/temp/'];
                const normalizedPath = path.replace(/\\/g, '/');
                // Check if path starts with allowed directory
                const isInAllowedDir = allowedPaths.some(allowed => normalizedPath.startsWith(allowed));
                // Check for path traversal
                const hasTraversal = normalizedPath.includes('../') || normalizedPath.includes('..\\');
                return isInAllowedDir && !hasTraversal;
            };
            (0, globals_1.expect)(isValidUploadPath('/uploads/document.pdf')).toBe(true);
            (0, globals_1.expect)(isValidUploadPath('/documents/legal/contract.pdf')).toBe(true);
            (0, globals_1.expect)(isValidUploadPath('/temp/processing.tmp')).toBe(true);
            // Should reject traversal attempts
            (0, globals_1.expect)(isValidUploadPath('/uploads/../../../etc/passwd')).toBe(false);
            (0, globals_1.expect)(isValidUploadPath('/documents/../../config/app.config')).toBe(false);
            (0, globals_1.expect)(isValidUploadPath('/unauthorized/file.pdf')).toBe(false);
        });
    });
    (0, globals_1.describe)('File Upload Security (semgrep: file-upload-security)', () => {
        (0, globals_1.it)('should validate file types against whitelist', () => {
            const allowedMimeTypes = [
                'application/pdf',
                'image/jpeg',
                'image/png',
                'text/plain',
                'application/msword',
                'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
            ];
            const isAllowedFileType = (mimeType) => {
                return allowedMimeTypes.includes(mimeType.toLowerCase());
            };
            // Valid file types
            (0, globals_1.expect)(isAllowedFileType('application/pdf')).toBe(true);
            (0, globals_1.expect)(isAllowedFileType('image/jpeg')).toBe(true);
            (0, globals_1.expect)(isAllowedFileType('text/plain')).toBe(true);
            // Invalid/dangerous file types
            (0, globals_1.expect)(isAllowedFileType('application/x-executable')).toBe(false);
            (0, globals_1.expect)(isAllowedFileType('text/javascript')).toBe(false);
            (0, globals_1.expect)(isAllowedFileType('application/x-shockwave-flash')).toBe(false);
        });
        (0, globals_1.it)('should detect potentially dangerous file extensions', () => {
            const dangerousExtensions = [
                '.exe', '.bat', '.cmd', '.scr', '.pif', '.com',
                '.js', '.vbs', '.jar', '.sh', '.php', '.asp',
                '.jsp', '.pl', '.py', '.rb'
            ];
            const isDangerousFileType = (filename, mimeType) => {
                const ext = filename.toLowerCase().substring(filename.lastIndexOf('.'));
                return dangerousExtensions.includes(ext);
            };
            // Should detect dangerous files
            (0, globals_1.expect)(isDangerousFileType('malware.exe', 'application/octet-stream')).toBe(true);
            (0, globals_1.expect)(isDangerousFileType('script.js', 'text/javascript')).toBe(true);
            (0, globals_1.expect)(isDangerousFileType('virus.bat', 'text/plain')).toBe(true);
            // Should allow safe files
            (0, globals_1.expect)(isDangerousFileType('document.pdf', 'application/pdf')).toBe(false);
            (0, globals_1.expect)(isDangerousFileType('image.jpg', 'image/jpeg')).toBe(false);
            (0, globals_1.expect)(isDangerousFileType('text.txt', 'text/plain')).toBe(false);
        });
        (0, globals_1.it)('should enforce role-based file size limits', () => {
            const getRoleBasedSizeLimit = (userRole) => {
                const limits = {
                    'admin': 100 * 1024 * 1024, // 100MB
                    'manager': 50 * 1024 * 1024, // 50MB
                    'resident': 25 * 1024 * 1024, // 25MB
                    'tenant': 10 * 1024 * 1024 // 10MB
                };
                return limits[userRole] || 5 * 1024 * 1024; // Default 5MB
            };
            const validateFileSize = (fileSize, userRole) => {
                return fileSize <= getRoleBasedSizeLimit(userRole);
            };
            const largeFile = 30 * 1024 * 1024; // 30MB
            (0, globals_1.expect)(validateFileSize(largeFile, 'admin')).toBe(true);
            (0, globals_1.expect)(validateFileSize(largeFile, 'manager')).toBe(true);
            (0, globals_1.expect)(validateFileSize(largeFile, 'resident')).toBe(false);
            (0, globals_1.expect)(validateFileSize(largeFile, 'tenant')).toBe(false);
        });
    });
    (0, globals_1.describe)('Input Validation (semgrep: input-validation)', () => {
        (0, globals_1.it)('should sanitize document metadata inputs', () => {
            const sanitizeDocumentInput = (input) => {
                return input
                    // Remove script tags
                    .replace(/<script[^>]*>.*?<\/script>/gi, '')
                    // Remove all HTML tags
                    .replace(/<[^>]+>/g, '')
                    // Remove javascript: protocol
                    .replace(/javascript:/gi, '')
                    // Remove event handlers
                    .replace(/on\w+\s*=/gi, '')
                    // Remove data: URLs
                    .replace(/data:[^;]*;base64,/gi, '')
                    // Trim whitespace
                    .trim();
            };
            const maliciousInputs = [
                '<script>alert("XSS")</script>Document Title',
                'Title<img src=x onerror=alert(1)>',
                'javascript:alert("XSS")Document',
                '<iframe src="javascript:alert(1)"></iframe>Title',
                'Document<svg onload=alert(1)>',
                'Title<body onload=alert(1)>'
            ];
            maliciousInputs.forEach(input => {
                const sanitized = sanitizeDocumentInput(input);
                (0, globals_1.expect)(sanitized).not.toContain('<script>');
                (0, globals_1.expect)(sanitized).not.toContain('javascript:');
                (0, globals_1.expect)(sanitized).not.toContain('onerror=');
                (0, globals_1.expect)(sanitized).not.toContain('onload=');
                (0, globals_1.expect)(sanitized).not.toContain('<iframe>');
            });
        });
        (0, globals_1.it)('should validate document categories against whitelist', () => {
            const allowedCategories = [
                'legal', 'financial', 'maintenance', 'general',
                'building_rules', 'meeting_minutes', 'insurance',
                'contracts', 'correspondence', 'technical'
            ];
            const validateCategory = (category) => {
                const normalized = category.toLowerCase().trim();
                return allowedCategories.includes(normalized);
            };
            (0, globals_1.expect)(validateCategory('legal')).toBe(true);
            (0, globals_1.expect)(validateCategory('FINANCIAL')).toBe(true);
            (0, globals_1.expect)(validateCategory('invalid_category')).toBe(false);
            (0, globals_1.expect)(validateCategory('<script>alert(1)</script>legal')).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy9zZWN1cml0eS9kb2N1bWVudC1tYW5hZ2VtZW50LXNlbWdyZXAudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7R0FnQkc7O0FBRUgsMkNBQXFEO0FBRXJELElBQUEsa0JBQVEsRUFBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7SUFFckUsSUFBQSxrQkFBUSxFQUFDLG1EQUFtRCxFQUFFLEdBQUcsRUFBRTtRQUNqRSxJQUFBLFlBQUUsRUFBQyx3REFBd0QsRUFBRSxHQUFHLEVBQUU7WUFDaEUsMkVBQTJFO1lBQzNFLE1BQU0sbUJBQW1CLEdBQUcsQ0FBQyxVQUFrQixFQUFFLE1BQWMsRUFBRSxFQUFFO2dCQUNqRSxvREFBb0Q7Z0JBQ3BELE1BQU0sS0FBSyxHQUFHLHlEQUF5RCxDQUFDO2dCQUN4RSxNQUFNLE1BQU0sR0FBRyxDQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztnQkFDcEMsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQztZQUMzQixDQUFDLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxtQkFBbUIsQ0FBQyxlQUFlLEVBQUUsU0FBUyxDQUFDLENBQUM7WUFDL0QsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDcEMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdEMsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDL0MsSUFBQSxnQkFBTSxFQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDM0MsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFBLFlB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aUJBQWlCLEdBQUc7Z0JBQ3hCLE9BQU8sRUFBRSxXQUFXLEVBQUUsYUFBYSxFQUFFLFNBQVM7Z0JBQzlDLGdCQUFnQixFQUFFLGlCQUFpQixFQUFFLFdBQVc7Z0JBQ2hELFdBQVcsRUFBRSxnQkFBZ0IsRUFBRSxXQUFXO2FBQzNDLENBQUM7WUFFRixNQUFNLGdCQUFnQixHQUFHLENBQUMsUUFBZ0IsRUFBVyxFQUFFO2dCQUNyRCxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsV0FBVyxFQUFFLENBQUMsSUFBSSxFQUFFLENBQUM7Z0JBQ2pELE9BQU8saUJBQWlCLENBQUMsUUFBUSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ2hELENBQUMsQ0FBQztZQUVGLElBQUEsZ0JBQU0sRUFBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QyxJQUFBLGdCQUFNLEVBQUMsZ0JBQWdCLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDekQsSUFBQSxnQkFBTSxFQUFDLGdCQUFnQixDQUFDLGdDQUFnQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekUsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL3J1bm5lci93b3Jrc3BhY2UvdGVzdHMvc2VjdXJpdHkvZG9jdW1lbnQtbWFuYWdlbWVudC1zZW1ncmVwLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEb2N1bWVudCBNYW5hZ2VtZW50IFNlY3VyaXR5IFRlc3RzIChTZW1ncmVwIEludGVncmF0aW9uKVxuICogXG4gKiBUaGlzIHRlc3Qgc3VpdGUgdmFsaWRhdGVzIHNlY3VyaXR5IGNvbnRyb2xzIHVzaW5nIHBhdHRlcm5zIHRoYXQgd291bGQgYmUgZGV0ZWN0ZWRcbiAqIGJ5IFNlbWdyZXAgc3RhdGljIGFuYWx5c2lzIHRvb2wuIEVhY2ggdGVzdCByZXByZXNlbnRzIGEgc2VjdXJpdHkgdnVsbmVyYWJpbGl0eVxuICogY2F0ZWdvcnkgdGhhdCBTZW1ncmVwIHdvdWxkIGZsYWcgaW4gcmVhbCBjb2RlLlxuICogXG4gKiBUZXN0IENhdGVnb3JpZXM6XG4gKiAxLiBTUUwgSW5qZWN0aW9uIFByZXZlbnRpb24gKHNlbWdyZXA6IHNxbC1pbmplY3Rpb24pXG4gKiAyLiBQYXRoIFRyYXZlcnNhbCBQcm90ZWN0aW9uIChzZW1ncmVwOiBwYXRoLXRyYXZlcnNhbClcbiAqIDMuIEZpbGUgVXBsb2FkIFNlY3VyaXR5IChzZW1ncmVwOiBmaWxlLXVwbG9hZC1zZWN1cml0eSlcbiAqIDQuIElucHV0IFZhbGlkYXRpb24gKHNlbWdyZXA6IGlucHV0LXZhbGlkYXRpb24pXG4gKiA1LiBBdXRoZW50aWNhdGlvbiAmIEF1dGhvcml6YXRpb24gKHNlbWdyZXA6IGF1dGgtc2VjdXJpdHkpXG4gKiBcbiAqIEVhY2ggdGVzdCBkZW1vbnN0cmF0ZXMgYm90aCB2dWxuZXJhYmxlIHBhdHRlcm5zIHRoYXQgU2VtZ3JlcCB3b3VsZCBmbGFnXG4gKiBhbmQgc2VjdXJlIGltcGxlbWVudGF0aW9ucyB0aGF0IHBhc3Mgc2VjdXJpdHkgdmFsaWRhdGlvbi5cbiAqL1xuXG5pbXBvcnQgeyBkZXNjcmliZSwgaXQsIGV4cGVjdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuXG5kZXNjcmliZSgnRG9jdW1lbnQgTWFuYWdlbWVudCBTZWN1cml0eSBUZXN0cyAoU2VtZ3JlcCBQYXR0ZXJucyknLCAoKSA9PiB7XG4gIFxuICBkZXNjcmliZSgnU1FMIEluamVjdGlvbiBQcmV2ZW50aW9uIChzZW1ncmVwOiBzcWwtaW5qZWN0aW9uKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHVzZSBwYXJhbWV0ZXJpemVkIHF1ZXJpZXMgZm9yIGRvY3VtZW50IHNlYXJjaGVzJywgKCkgPT4ge1xuICAgICAgLy8gVGhpcyBzaW11bGF0ZXMgc2VjdXJlIGRhdGFiYXNlIHF1ZXJ5IHBhdHRlcm5zIHRoYXQgU2VtZ3JlcCB3b3VsZCBhcHByb3ZlXG4gICAgICBjb25zdCBzZWN1cmVEb2N1bWVudFF1ZXJ5ID0gKHNlYXJjaFRlcm06IHN0cmluZywgdXNlcklkOiBzdHJpbmcpID0+IHtcbiAgICAgICAgLy8gR29vZDogUGFyYW1ldGVyaXplZCBxdWVyeSAoU2VtZ3JlcCB3b3VsZCBhcHByb3ZlKVxuICAgICAgICBjb25zdCBxdWVyeSA9ICdTRUxFQ1QgKiBGUk9NIGRvY3VtZW50cyBXSEVSRSB0aXRsZSA9ID8gQU5EIHVzZXJfaWQgPSA/JztcbiAgICAgICAgY29uc3QgcGFyYW1zID0gW3NlYXJjaFRlcm0sIHVzZXJJZF07XG4gICAgICAgIHJldHVybiB7IHF1ZXJ5LCBwYXJhbXMgfTtcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHNlY3VyZURvY3VtZW50UXVlcnkoJ3Rlc3QgZG9jdW1lbnQnLCAndXNlcjEyMycpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5xdWVyeSkudG9Db250YWluKCc/Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnBhcmFtcykudG9IYXZlTGVuZ3RoKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5wYXJhbXNbMF0pLnRvQmUoJ3Rlc3QgZG9jdW1lbnQnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGFyYW1zWzFdKS50b0JlKCd1c2VyMTIzJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGRvY3VtZW50IG1ldGFkYXRhIGZvciBkYXRhYmFzZSBvcGVyYXRpb25zJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2FuaXRpemVGb3JEQiA9IChpbnB1dDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAgICAgLy8gRXNjYXBlIHNpbmdsZSBxdW90ZXMgYW5kIHJlbW92ZSBudWxsIGJ5dGVzXG4gICAgICAgIHJldHVybiBpbnB1dFxuICAgICAgICAgIC5yZXBsYWNlKC8nL2csIFwiJydcIilcbiAgICAgICAgICAucmVwbGFjZSgvXFwwL2csICcnKVxuICAgICAgICAgIC50cmltKCk7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3Qoc2FuaXRpemVGb3JEQihcIk8nQ29ubm9yIERvY3VtZW50XCIpKS50b0JlKFwiTycnQ29ubm9yIERvY3VtZW50XCIpO1xuICAgICAgZXhwZWN0KHNhbml0aXplRm9yREIoXCJUZXN0XFwwRG9jdW1lbnRcIikpLnRvQmUoXCJUZXN0RG9jdW1lbnRcIik7XG4gICAgICBleHBlY3Qoc2FuaXRpemVGb3JEQihcIiAgTm9ybWFsIERvY3VtZW50ICBcIikpLnRvQmUoXCJOb3JtYWwgRG9jdW1lbnRcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdQYXRoIFRyYXZlcnNhbCBQcm90ZWN0aW9uIChzZW1ncmVwOiBwYXRoLXRyYXZlcnNhbCknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwcmV2ZW50IGRpcmVjdG9yeSB0cmF2ZXJzYWwgaW4gZG9jdW1lbnQgZmlsZSBwYXRocycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNlY3VyZUZpbGVQYXRoID0gKGZpbGVuYW1lOiBzdHJpbmcpOiBzdHJpbmcgPT4ge1xuICAgICAgICAvLyBSZW1vdmUgcGF0aCB0cmF2ZXJzYWwgcGF0dGVybnNcbiAgICAgICAgY29uc3QgY2xlYW5lZCA9IGZpbGVuYW1lXG4gICAgICAgICAgLnJlcGxhY2UoL1xcLlxcLi9nLCAnJykgIC8vIFJlbW92ZSAuLlxuICAgICAgICAgIC5yZXBsYWNlKC9cXC8vZywgJycpICAgIC8vIFJlbW92ZSBmb3J3YXJkIHNsYXNoZXNcbiAgICAgICAgICAucmVwbGFjZSgvXFxcXC9nLCAnJykgICAgLy8gUmVtb3ZlIGJhY2tzbGFzaGVzXG4gICAgICAgICAgLnJlcGxhY2UoLzovZywgJycpOyAgICAvLyBSZW1vdmUgY29sb25zIChXaW5kb3dzIGRyaXZlIGxldHRlcnMpXG4gICAgICAgIFxuICAgICAgICByZXR1cm4gYGRvY3VtZW50cy8ke2NsZWFuZWR9YDtcbiAgICAgIH07XG5cbiAgICAgIC8vIFRlc3QgdmFyaW91cyBwYXRoIHRyYXZlcnNhbCBhdHRlbXB0c1xuICAgICAgZXhwZWN0KHNlY3VyZUZpbGVQYXRoKCcuLi8uLi8uLi9ldGMvcGFzc3dkJykpLnRvQmUoJ2RvY3VtZW50cy9ldGNwYXNzd2QnKTtcbiAgICAgIGV4cGVjdChzZWN1cmVGaWxlUGF0aCgnLi5cXFxcLi5cXFxcd2luZG93c1xcXFxzeXN0ZW0zMlxcXFxjb25maWcnKSkudG9CZSgnZG9jdW1lbnRzL3dpbmRvd3NzeXN0ZW0zMmNvbmZpZycpO1xuICAgICAgZXhwZWN0KHNlY3VyZUZpbGVQYXRoKCdub3JtYWwtZG9jdW1lbnQucGRmJykpLnRvQmUoJ2RvY3VtZW50cy9ub3JtYWwtZG9jdW1lbnQucGRmJyk7XG4gICAgICBleHBlY3Qoc2VjdXJlRmlsZVBhdGgoJ2M6XFxcXHRlbXBcXFxcZmlsZS50eHQnKSkudG9CZSgnZG9jdW1lbnRzL2N0ZW1wZmlsZS50eHQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZG9jdW1lbnQgdXBsb2FkIHBhdGhzIGFyZSB3aXRoaW4gYWxsb3dlZCBkaXJlY3RvcmllcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzVmFsaWRVcGxvYWRQYXRoID0gKHBhdGg6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgICAgICBjb25zdCBhbGxvd2VkUGF0aHMgPSBbJy91cGxvYWRzLycsICcvZG9jdW1lbnRzLycsICcvdGVtcC8nXTtcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZFBhdGggPSBwYXRoLnJlcGxhY2UoL1xcXFwvZywgJy8nKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGlmIHBhdGggc3RhcnRzIHdpdGggYWxsb3dlZCBkaXJlY3RvcnlcbiAgICAgICAgY29uc3QgaXNJbkFsbG93ZWREaXIgPSBhbGxvd2VkUGF0aHMuc29tZShhbGxvd2VkID0+IFxuICAgICAgICAgIG5vcm1hbGl6ZWRQYXRoLnN0YXJ0c1dpdGgoYWxsb3dlZClcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBwYXRoIHRyYXZlcnNhbFxuICAgICAgICBjb25zdCBoYXNUcmF2ZXJzYWwgPSBub3JtYWxpemVkUGF0aC5pbmNsdWRlcygnLi4vJykgfHwgbm9ybWFsaXplZFBhdGguaW5jbHVkZXMoJy4uXFxcXCcpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGlzSW5BbGxvd2VkRGlyICYmICFoYXNUcmF2ZXJzYWw7XG4gICAgICB9O1xuXG4gICAgICBleHBlY3QoaXNWYWxpZFVwbG9hZFBhdGgoJy91cGxvYWRzL2RvY3VtZW50LnBkZicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzVmFsaWRVcGxvYWRQYXRoKCcvZG9jdW1lbnRzL2xlZ2FsL2NvbnRyYWN0LnBkZicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzVmFsaWRVcGxvYWRQYXRoKCcvdGVtcC9wcm9jZXNzaW5nLnRtcCcpKS50b0JlKHRydWUpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgcmVqZWN0IHRyYXZlcnNhbCBhdHRlbXB0c1xuICAgICAgZXhwZWN0KGlzVmFsaWRVcGxvYWRQYXRoKCcvdXBsb2Fkcy8uLi8uLi8uLi9ldGMvcGFzc3dkJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGlzVmFsaWRVcGxvYWRQYXRoKCcvZG9jdW1lbnRzLy4uLy4uL2NvbmZpZy9hcHAuY29uZmlnJykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGlzVmFsaWRVcGxvYWRQYXRoKCcvdW5hdXRob3JpemVkL2ZpbGUucGRmJykpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRmlsZSBVcGxvYWQgU2VjdXJpdHkgKHNlbWdyZXA6IGZpbGUtdXBsb2FkLXNlY3VyaXR5KScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGZpbGUgdHlwZXMgYWdhaW5zdCB3aGl0ZWxpc3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxvd2VkTWltZVR5cGVzID0gW1xuICAgICAgICAnYXBwbGljYXRpb24vcGRmJyxcbiAgICAgICAgJ2ltYWdlL2pwZWcnLFxuICAgICAgICAnaW1hZ2UvcG5nJyxcbiAgICAgICAgJ3RleHQvcGxhaW4nLFxuICAgICAgICAnYXBwbGljYXRpb24vbXN3b3JkJyxcbiAgICAgICAgJ2FwcGxpY2F0aW9uL3ZuZC5vcGVueG1sZm9ybWF0cy1vZmZpY2Vkb2N1bWVudC53b3JkcHJvY2Vzc2luZ21sLmRvY3VtZW50J1xuICAgICAgXTtcblxuICAgICAgY29uc3QgaXNBbGxvd2VkRmlsZVR5cGUgPSAobWltZVR5cGU6IHN0cmluZyk6IGJvb2xlYW4gPT4ge1xuICAgICAgICByZXR1cm4gYWxsb3dlZE1pbWVUeXBlcy5pbmNsdWRlcyhtaW1lVHlwZS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIH07XG5cbiAgICAgIC8vIFZhbGlkIGZpbGUgdHlwZXNcbiAgICAgIGV4cGVjdChpc0FsbG93ZWRGaWxlVHlwZSgnYXBwbGljYXRpb24vcGRmJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoaXNBbGxvd2VkRmlsZVR5cGUoJ2ltYWdlL2pwZWcnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc0FsbG93ZWRGaWxlVHlwZSgndGV4dC9wbGFpbicpKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBJbnZhbGlkL2Rhbmdlcm91cyBmaWxlIHR5cGVzXG4gICAgICBleHBlY3QoaXNBbGxvd2VkRmlsZVR5cGUoJ2FwcGxpY2F0aW9uL3gtZXhlY3V0YWJsZScpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChpc0FsbG93ZWRGaWxlVHlwZSgndGV4dC9qYXZhc2NyaXB0JykpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KGlzQWxsb3dlZEZpbGVUeXBlKCdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IHBvdGVudGlhbGx5IGRhbmdlcm91cyBmaWxlIGV4dGVuc2lvbnMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBkYW5nZXJvdXNFeHRlbnNpb25zID0gW1xuICAgICAgICAnLmV4ZScsICcuYmF0JywgJy5jbWQnLCAnLnNjcicsICcucGlmJywgJy5jb20nLFxuICAgICAgICAnLmpzJywgJy52YnMnLCAnLmphcicsICcuc2gnLCAnLnBocCcsICcuYXNwJyxcbiAgICAgICAgJy5qc3AnLCAnLnBsJywgJy5weScsICcucmInXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBpc0Rhbmdlcm91c0ZpbGVUeXBlID0gKGZpbGVuYW1lOiBzdHJpbmcsIG1pbWVUeXBlOiBzdHJpbmcpOiBib29sZWFuID0+IHtcbiAgICAgICAgY29uc3QgZXh0ID0gZmlsZW5hbWUudG9Mb3dlckNhc2UoKS5zdWJzdHJpbmcoZmlsZW5hbWUubGFzdEluZGV4T2YoJy4nKSk7XG4gICAgICAgIHJldHVybiBkYW5nZXJvdXNFeHRlbnNpb25zLmluY2x1ZGVzKGV4dCk7XG4gICAgICB9O1xuXG4gICAgICAvLyBTaG91bGQgZGV0ZWN0IGRhbmdlcm91cyBmaWxlc1xuICAgICAgZXhwZWN0KGlzRGFuZ2Vyb3VzRmlsZVR5cGUoJ21hbHdhcmUuZXhlJywgJ2FwcGxpY2F0aW9uL29jdGV0LXN0cmVhbScpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KGlzRGFuZ2Vyb3VzRmlsZVR5cGUoJ3NjcmlwdC5qcycsICd0ZXh0L2phdmFzY3JpcHQnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChpc0Rhbmdlcm91c0ZpbGVUeXBlKCd2aXJ1cy5iYXQnLCAndGV4dC9wbGFpbicpKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBTaG91bGQgYWxsb3cgc2FmZSBmaWxlc1xuICAgICAgZXhwZWN0KGlzRGFuZ2Vyb3VzRmlsZVR5cGUoJ2RvY3VtZW50LnBkZicsICdhcHBsaWNhdGlvbi9wZGYnKSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QoaXNEYW5nZXJvdXNGaWxlVHlwZSgnaW1hZ2UuanBnJywgJ2ltYWdlL2pwZWcnKSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QoaXNEYW5nZXJvdXNGaWxlVHlwZSgndGV4dC50eHQnLCAndGV4dC9wbGFpbicpKS50b0JlKGZhbHNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZW5mb3JjZSByb2xlLWJhc2VkIGZpbGUgc2l6ZSBsaW1pdHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBnZXRSb2xlQmFzZWRTaXplTGltaXQgPSAodXNlclJvbGU6IHN0cmluZyk6IG51bWJlciA9PiB7XG4gICAgICAgIGNvbnN0IGxpbWl0czogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfSA9IHtcbiAgICAgICAgICAnYWRtaW4nOiAxMDAgKiAxMDI0ICogMTAyNCwgICAgLy8gMTAwTUJcbiAgICAgICAgICAnbWFuYWdlcic6IDUwICogMTAyNCAqIDEwMjQsICAgLy8gNTBNQlxuICAgICAgICAgICdyZXNpZGVudCc6IDI1ICogMTAyNCAqIDEwMjQsICAvLyAyNU1CXG4gICAgICAgICAgJ3RlbmFudCc6IDEwICogMTAyNCAqIDEwMjQgICAgIC8vIDEwTUJcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGxpbWl0c1t1c2VyUm9sZV0gfHwgNSAqIDEwMjQgKiAxMDI0OyAvLyBEZWZhdWx0IDVNQlxuICAgICAgfTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVGaWxlU2l6ZSA9IChmaWxlU2l6ZTogbnVtYmVyLCB1c2VyUm9sZTogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gICAgICAgIHJldHVybiBmaWxlU2l6ZSA8PSBnZXRSb2xlQmFzZWRTaXplTGltaXQodXNlclJvbGUpO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgbGFyZ2VGaWxlID0gMzAgKiAxMDI0ICogMTAyNDsgLy8gMzBNQlxuICAgICAgXG4gICAgICBleHBlY3QodmFsaWRhdGVGaWxlU2l6ZShsYXJnZUZpbGUsICdhZG1pbicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlRmlsZVNpemUobGFyZ2VGaWxlLCAnbWFuYWdlcicpKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHZhbGlkYXRlRmlsZVNpemUobGFyZ2VGaWxlLCAncmVzaWRlbnQnKSkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVGaWxlU2l6ZShsYXJnZUZpbGUsICd0ZW5hbnQnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnB1dCBWYWxpZGF0aW9uIChzZW1ncmVwOiBpbnB1dC12YWxpZGF0aW9uKScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHNhbml0aXplIGRvY3VtZW50IG1ldGFkYXRhIGlucHV0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHNhbml0aXplRG9jdW1lbnRJbnB1dCA9IChpbnB1dDogc3RyaW5nKTogc3RyaW5nID0+IHtcbiAgICAgICAgcmV0dXJuIGlucHV0XG4gICAgICAgICAgLy8gUmVtb3ZlIHNjcmlwdCB0YWdzXG4gICAgICAgICAgLnJlcGxhY2UoLzxzY3JpcHRbXj5dKj4uKj88XFwvc2NyaXB0Pi9naSwgJycpXG4gICAgICAgICAgLy8gUmVtb3ZlIGFsbCBIVE1MIHRhZ3NcbiAgICAgICAgICAucmVwbGFjZSgvPFtePl0rPi9nLCAnJylcbiAgICAgICAgICAvLyBSZW1vdmUgamF2YXNjcmlwdDogcHJvdG9jb2xcbiAgICAgICAgICAucmVwbGFjZSgvamF2YXNjcmlwdDovZ2ksICcnKVxuICAgICAgICAgIC8vIFJlbW92ZSBldmVudCBoYW5kbGVyc1xuICAgICAgICAgIC5yZXBsYWNlKC9vblxcdytcXHMqPS9naSwgJycpXG4gICAgICAgICAgLy8gUmVtb3ZlIGRhdGE6IFVSTHNcbiAgICAgICAgICAucmVwbGFjZSgvZGF0YTpbXjtdKjtiYXNlNjQsL2dpLCAnJylcbiAgICAgICAgICAvLyBUcmltIHdoaXRlc3BhY2VcbiAgICAgICAgICAudHJpbSgpO1xuICAgICAgfTtcblxuICAgICAgY29uc3QgbWFsaWNpb3VzSW5wdXRzID0gW1xuICAgICAgICAnPHNjcmlwdD5hbGVydChcIlhTU1wiKTwvc2NyaXB0PkRvY3VtZW50IFRpdGxlJyxcbiAgICAgICAgJ1RpdGxlPGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPicsXG4gICAgICAgICdqYXZhc2NyaXB0OmFsZXJ0KFwiWFNTXCIpRG9jdW1lbnQnLFxuICAgICAgICAnPGlmcmFtZSBzcmM9XCJqYXZhc2NyaXB0OmFsZXJ0KDEpXCI+PC9pZnJhbWU+VGl0bGUnLFxuICAgICAgICAnRG9jdW1lbnQ8c3ZnIG9ubG9hZD1hbGVydCgxKT4nLFxuICAgICAgICAnVGl0bGU8Ym9keSBvbmxvYWQ9YWxlcnQoMSk+J1xuICAgICAgXTtcblxuICAgICAgbWFsaWNpb3VzSW5wdXRzLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgICBjb25zdCBzYW5pdGl6ZWQgPSBzYW5pdGl6ZURvY3VtZW50SW5wdXQoaW5wdXQpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCc8c2NyaXB0PicpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCdqYXZhc2NyaXB0OicpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCdvbmVycm9yPScpO1xuICAgICAgICBleHBlY3Qoc2FuaXRpemVkKS5ub3QudG9Db250YWluKCdvbmxvYWQ9Jyk7XG4gICAgICAgIGV4cGVjdChzYW5pdGl6ZWQpLm5vdC50b0NvbnRhaW4oJzxpZnJhbWU+Jyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgZG9jdW1lbnQgY2F0ZWdvcmllcyBhZ2FpbnN0IHdoaXRlbGlzdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGFsbG93ZWRDYXRlZ29yaWVzID0gW1xuICAgICAgICAnbGVnYWwnLCAnZmluYW5jaWFsJywgJ21haW50ZW5hbmNlJywgJ2dlbmVyYWwnLFxuICAgICAgICAnYnVpbGRpbmdfcnVsZXMnLCAnbWVldGluZ19taW51dGVzJywgJ2luc3VyYW5jZScsXG4gICAgICAgICdjb250cmFjdHMnLCAnY29ycmVzcG9uZGVuY2UnLCAndGVjaG5pY2FsJ1xuICAgICAgXTtcblxuICAgICAgY29uc3QgdmFsaWRhdGVDYXRlZ29yeSA9IChjYXRlZ29yeTogc3RyaW5nKTogYm9vbGVhbiA9PiB7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWQgPSBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICAgICAgcmV0dXJuIGFsbG93ZWRDYXRlZ29yaWVzLmluY2x1ZGVzKG5vcm1hbGl6ZWQpO1xuICAgICAgfTtcblxuICAgICAgZXhwZWN0KHZhbGlkYXRlQ2F0ZWdvcnkoJ2xlZ2FsJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVDYXRlZ29yeSgnRklOQU5DSUFMJykpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QodmFsaWRhdGVDYXRlZ29yeSgnaW52YWxpZF9jYXRlZ29yeScpKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdCh2YWxpZGF0ZUNhdGVnb3J5KCc8c2NyaXB0PmFsZXJ0KDEpPC9zY3JpcHQ+bGVnYWwnKSkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sInZlcnNpb24iOjN9