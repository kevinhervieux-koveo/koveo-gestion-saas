49de7c17c2f262eb09a3220a1ecfce04
"use strict";
/**
 * Optimized database storage with caching and performance monitoring.
 * Replaces decorators with direct implementation for better compatibility.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.OptimizedDatabaseStorage = void 0;
const drizzle_orm_1 = require("drizzle-orm");
// Use shared database connection to avoid multiple pools in production
const db_1 = require("./db");
const crypto_1 = __importDefault(require("crypto"));
const schema = __importStar(require("@shared/schema"));
const database_optimization_1 = require("./database-optimization");
const query_cache_1 = require("./query-cache");
const performance_monitoring_1 = require("./performance-monitoring");
const drizzle_orm_2 = require("drizzle-orm");
// Database connection imported from shared db.ts
/**
 * Enhanced database storage with built-in caching and performance monitoring.
 */
class OptimizedDatabaseStorage {
    /**
     *
     */
    constructor() {
        // Skip optimizations in test environment
        if (process.env.TEST_ENV !== 'integration' &&
            !process.env.DISABLE_DB_OPTIMIZATIONS &&
            process.env.NODE_ENV !== 'test' &&
            !process.env.JEST_WORKER_ID) {
            this.initializeOptimizations();
        }
    }
    /**
     * Initializes database optimizations.
     */
    async initializeOptimizations() {
        // Skip database optimization during tests
        if (process.env.NODE_ENV === 'test' ||
            process.env.JEST_WORKER_ID ||
            process.env.SKIP_DB_OPTIMIZATION) {
            // Database optimizations skipped in test environment
            return;
        }
        try {
            await database_optimization_1.QueryOptimizer.applyCoreOptimizations();
            // Database optimizations applied
        }
        catch (error) {
            console.error('âŒ Error initializing database optimizations:', error);
        }
    }
    /**
     * Wrapper for performance tracking and caching.
     * @param operation
     * @param cacheKey
     * @param cacheType
     * @param fn
     */
    async withOptimizations(operation, cacheKey, cacheType, fn) {
        // Try cache first
        if (cacheKey) {
            const cached = query_cache_1.queryCache.get(cacheType, cacheKey);
            if (cached !== undefined) {
                return cached;
            }
        }
        // Execute with performance tracking
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery(operation, fn);
        // Cache result
        if (cacheKey && result !== undefined) {
            query_cache_1.queryCache.set(cacheType, cacheKey, result);
        }
        return result;
    }
    // User operations with optimization
    /**
     * Retrieves all active users with caching and performance tracking.
     */
    async getUsers() {
        return this.withOptimizations('getUsers', 'all_users', 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .limit(100) // Always use LIMIT for large result sets
            .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt)));
    }
    /**
     * Retrieves all active users with their assignments (organizations, buildings, residences).
     */
    async getUsersWithAssignments() {
        // Clear any existing cache to ensure fresh data
        query_cache_1.queryCache.invalidate('users', 'all_users_assignments_v2');
        query_cache_1.queryCache.invalidate('users', 'all_users_assignments_v3');
        try {
            // Get all users first
            const users = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
                .limit(100)
                .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt));
            // For each user, fetch their assignments with limited concurrency to prevent connection issues
            const batchSize = 5; // Process 5 users at a time to avoid connection pool exhaustion
            const usersWithAssignments = [];
            for (let i = 0; i < users.length; i += batchSize) {
                const batch = users.slice(i, i + batchSize);
                const batchResults = await Promise.all(batch.map(async (user) => {
                    try {
                        // Get user organizations
                        const userOrgs = await db_1.db
                            .select({
                            id: schema.organizations.id,
                            name: schema.organizations.name,
                            type: schema.organizations.type,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
                        // Get user buildings (through organization relationships)
                        const userBuildings = await db_1.db
                            .select({
                            id: schema.buildings.id,
                            name: schema.buildings.name,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.buildings.organizationId))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
                        // Get user residences
                        const userResidences = await db_1.db
                            .select({
                            id: schema.residences.id,
                            unitNumber: schema.residences.unitNumber,
                            buildingId: schema.residences.buildingId,
                            buildingName: schema.buildings.name,
                        })
                            .from(schema.userResidences)
                            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                        const result = {
                            ...user,
                            organizations: userOrgs || [],
                            buildings: userBuildings || [],
                            residences: userResidences || [],
                        };
                        return result;
                    }
                    catch (error) {
                        console.error('âŒ Error getting user assignments:', error);
                        // Return user with empty assignments if there's an error
                        return {
                            ...user,
                            organizations: [],
                            buildings: [],
                            residences: [],
                        };
                    }
                }));
                usersWithAssignments.push(...batchResults);
            }
            return usersWithAssignments;
        }
        catch (error) {
            console.error('âŒ Critical error getting users with assignments:', error);
            // Return empty array on critical error
            return [];
        }
    }
    /**
     * Retrieves users from organizations that a specific user has access to.
     * @param userId
     */
    async getUsersByOrganizations(userId) {
        return this.withOptimizations('getUsersByOrganizations', `users_by_org:${userId}`, 'users', async () => {
            // First, get organization IDs that the user has access to
            const userOrgs = await db_1.db
                .select({ organizationId: schema.userOrganizations.organizationId })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            if (userOrgs.length === 0) {
                return [];
            }
            const organizationIds = userOrgs.map((org) => org.organizationId);
            // Then get all users from those organizations
            return db_1.db
                .select({
                id: schema.users.id,
                username: schema.users.username,
                email: schema.users.email,
                firstName: schema.users.firstName,
                lastName: schema.users.lastName,
                role: schema.users.role,
                isActive: schema.users.isActive,
                createdAt: schema.users.createdAt,
                updatedAt: schema.users.updatedAt,
            })
                .from(schema.users)
                .innerJoin(schema.userOrganizations, (0, drizzle_orm_1.eq)(schema.users.id, schema.userOrganizations.userId))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, organizationIds)))
                .orderBy(schema.users.firstName, schema.users.lastName);
        });
    }
    /**
     * Gets paginated users with optimized query structure.
     * @param options
     * @param _options
     */
    async getPaginatedUsers(_options) {
        database_optimization_1.PaginationHelper.validatePagination(_options);
        const cacheKey = `paginated_users:${_options.page}:${_options.pageSize}:${_options.sortBy}:${_options.sortDirection}`;
        // Try cache first
        const cached = query_cache_1.queryCache.get('users', cacheKey);
        if (cached) {
            return cached;
        }
        // Get total count using covering index
        const [{ count: total }] = await db_1.db
            .select({ count: (0, drizzle_orm_1.count)() })
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true));
        // Get paginated results with LIMIT and optimized ORDER BY
        const users = await db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .orderBy(_options.sortDirection === 'DESC' ? (0, drizzle_orm_1.desc)(schema.users.createdAt) : schema.users.createdAt)
            .limit(_options.pageSize)
            .offset((_options.page - 1) * _options.pageSize);
        const result = { users, total };
        query_cache_1.queryCache.set('users', cacheKey, result);
        return result;
    }
    /**
     * Gets buildings with residents using EXISTS instead of IN subquery.
     * @param organizationId
     * @param limit
     */
    async getBuildingsWithResidents(organizationId, limit = 50) {
        const cacheKey = `buildings_with_residents:${organizationId}:${limit}`;
        return this.withOptimizations('getBuildingsWithResidents', cacheKey, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true), (0, drizzle_orm_2.exists)(db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true))))))
            .limit(limit) // Always use LIMIT for large result sets
        );
    }
    /**
     * Searches users with optimized covering index and LIMIT.
     * @param query
     * @param limit
     */
    async searchUsers(query, limit = 20) {
        const cacheKey = `search_users:${query}:${limit}`;
        return this.withOptimizations('searchUsers', cacheKey, 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.or)((0, drizzle_orm_1.like)(schema.users.email, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.firstName, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.lastName, `%${query}%`))))
            .limit(limit) // Always limit search results
            .orderBy(schema.users.lastName, schema.users.firstName));
    }
    /**
     * Gets financial summary using materialized view for complex aggregations.
     * @param buildingId
     */
    async getFinancialSummary(buildingId) {
        const cacheKey = `financial_summary:${buildingId}`;
        return this.withOptimizations('getFinancialSummary', cacheKey, 'financial', async () => {
            // Use materialized view for complex aggregations
            const summary = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_financial_summary WHERE building_id = ${buildingId} ORDER BY month DESC LIMIT 12`);
            return summary.rows;
        });
    }
    /**
     * Gets building statistics using materialized view.
     * @param buildingId
     */
    async getBuildingStats(buildingId) {
        const cacheKey = `building_stats:${buildingId}`;
        return this.withOptimizations('getBuildingStats', cacheKey, 'buildings', async () => {
            // Use materialized view for dashboard statistics
            const stats = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_building_stats WHERE building_id = ${buildingId}`);
            return stats.rows[0];
        });
    }
    /**
     * Retrieves a specific user by ID with caching.
     * @param id
     */
    async getUser(id) {
        return this.withOptimizations('getUser', `user:${id}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, id));
            if (result.length > 0) {
                console.log(`ðŸ” Storage.getUser: Found user:`, {
                    id: result[0].id,
                    email: result[0].email,
                    role: result[0].role,
                });
            }
            else {
            }
            return result[0];
        });
    }
    /**
     * Retrieves a user by email with caching.
     * @param email
     */
    async getUserByEmail(email) {
        return this.withOptimizations('getUserByEmail', `user_email:${email}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, email));
            return result[0];
        });
    }
    /**
     * Creates a new user with cache invalidation.
     * @param insertUser
     */
    async createUser(insertUser) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createUser', async () => {
            // Automatically set demo password for demo role users
            let password = insertUser.password;
            const isDemoRole = ['demo_manager', 'demo_tenant', 'demo_resident'].includes(insertUser.role);
            if (isDemoRole) {
                // Always set the standard demo password hash for demo users, regardless of provided password
                password = '$2b$12$cOc/QjMjzlhqAQqF2b/MTOZr2QAtERbXJGd4OSa1CXMlF04FC3F02'; // demo123456
                console.log('ðŸŽ­ Setting demo password for user with role:', insertUser.role);
            }
            // Filter only the fields that exist in the database schema
            const userData = {
                username: insertUser.username,
                email: insertUser.email,
                password,
                firstName: insertUser.firstName,
                lastName: insertUser.lastName,
                phone: insertUser.phone || '',
                profileImage: insertUser.profileImage,
                language: insertUser.language || 'fr',
                role: insertUser.role,
                isActive: true, // Default value for new users
            };
            console.log('ðŸ” Creating user with data:', {
                username: userData.username,
                email: userData.email,
                firstName: userData.firstName,
                lastName: userData.lastName,
                role: userData.role,
                language: userData.language,
                hasPassword: !!userData.password,
            });
            try {
                const inserted = await db_1.db.insert(schema.users).values([userData]).returning();
                return inserted;
            }
            catch (error) {
                console.error('âŒ Error creating user:', error);
                throw error;
            }
        });
        // Invalidate related caches
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    /**
     * Updates a user with cache invalidation.
     * @param id
     * @param updates
     */
    async updateUser(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateUser', async () => {
            return db_1.db
                .update(schema.users)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.users.id, id))
                .returning();
        });
        // Invalidate specific user caches
        query_cache_1.CacheInvalidator.invalidateUserCaches(id);
        return result[0];
    }
    /**
     * Retrieves organizations for a specific user.
     * @param userId
     */
    async getUserOrganizations(userId) {
        return this.withOptimizations('getUserOrganizations', `user_orgs:${userId}`, 'users', async () => {
            const result = await db_1.db
                .select({
                organizationId: schema.userOrganizations.organizationId,
            })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            return result;
        });
    }
    /**
     * Retrieves residences for a specific user.
     * @param userId
     */
    async getUserResidences(userId) {
        return this.withOptimizations('getUserResidences', `user_residences:${userId}`, 'residences', async () => {
            const result = await db_1.db
                .select({
                residenceId: schema.userResidences.residenceId,
            })
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)));
            return result;
        });
    }
    // Organization operations with optimization
    /**
     * Retrieves all active organizations with caching.
     */
    async getOrganizations() {
        return this.withOptimizations('getOrganizations', 'all_organizations', 'organizations', () => db_1.db.select().from(schema.organizations).where((0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
    }
    /**
     * Retrieves an organization by ID with caching.
     * @param id
     */
    async getOrganization(id) {
        return this.withOptimizations('getOrganization', `organization:${id}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new organization with cache invalidation.
     * @param insertOrganization
     */
    async createOrganization(insertOrganization) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createOrganization', async () => {
            return db_1.db.insert(schema.organizations).values(insertOrganization).returning();
        });
        // Invalidate organization caches
        query_cache_1.queryCache.invalidate('organizations');
        return result[0];
    }
    // Building operations with optimization
    /**
     * Retrieves buildings by organization with caching.
     * @param organizationId
     */
    async getBuildingsByOrganization(organizationId) {
        return this.withOptimizations('getBuildingsByOrganization', `org_buildings:${organizationId}`, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true))));
    }
    /**
     * Retrieves a building by ID with caching.
     * @param id
     */
    async getBuilding(id) {
        return this.withOptimizations('getBuilding', `building:${id}`, 'buildings', async () => {
            const result = await db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new building with cache invalidation.
     * @param insertBuilding
     */
    async createBuilding(insertBuilding) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createBuilding', async () => {
            return db_1.db.insert(schema.buildings).values([insertBuilding]).returning();
        });
        // Invalidate building caches
        query_cache_1.CacheInvalidator.invalidateBuildingCaches('*');
        return result[0];
    }
    // Residence operations with optimization
    /**
     * Retrieves residences by building with caching.
     * @param buildingId
     */
    async getResidencesByBuilding(buildingId) {
        return this.withOptimizations('getResidencesByBuilding', `building_residences:${buildingId}`, 'residences', () => db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)))
            .orderBy(schema.residences.unitNumber));
    }
    /**
     * Retrieves a residence by ID with caching.
     * @param id
     */
    async getResidence(id) {
        return this.withOptimizations('getResidence', `residence:${id}`, 'residences', async () => {
            const result = await db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new residence with cache invalidation.
     * @param insertResidence
     */
    async createResidence(insertResidence) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createResidence', async () => {
            return db_1.db.insert(schema.residences).values([insertResidence]).returning();
        });
        // Invalidate residence caches
        query_cache_1.CacheInvalidator.invalidateResidenceCaches('*');
        return result[0];
    }
    // Additional optimized methods for frequently accessed data
    /**
     * Gets user residences with full details - for complex residence views.
     * @param userId
     */
    async getUserResidencesWithDetails(userId) {
        return this.withOptimizations('getUserResidencesWithDetails', `user_residences_details:${userId}`, 'residences', () => db_1.db
            .select({
            residence: schema.residences,
            building: schema.buildings,
            userResidence: schema.userResidences,
        })
            .from(schema.userResidences)
            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true))));
    }
    /**
     * Gets active bills for a residence - frequently queried.
     * @param residenceId
     */
    async getActiveBillsByResidence(residenceId) {
        return this.withOptimizations('getActiveBillsByResidence', `residence_bills:${residenceId}`, 'bills', () => db_1.db
            .select()
            .from(schema.bills)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.bills.residenceId, residenceId), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema.bills.status, 'sent'), (0, drizzle_orm_1.eq)(schema.bills.status, 'overdue'))))
            .orderBy((0, drizzle_orm_1.desc)(schema.bills.dueDate)));
    }
    /**
     * Gets maintenance requests for a residence - frequently accessed.
     * @param residenceId
     */
    async getMaintenanceRequestsByResidence(residenceId) {
        return this.withOptimizations('getMaintenanceRequestsByResidence', `residence_maintenance:${residenceId}`, 'maintenance', () => db_1.db
            .select()
            .from(schema.maintenanceRequests)
            .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.residenceId, residenceId))
            .orderBy((0, drizzle_orm_1.desc)(schema.maintenanceRequests.createdAt)));
    }
    // Missing Organization operations
    /**
     * Gets organization by name with caching.
     * @param name
     */
    async getOrganizationByName(name) {
        return this.withOptimizations('getOrganizationByName', `org_name:${name}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.name, name));
            return result[0];
        });
    }
    /**
     * Updates organization with cache invalidation.
     * @param id
     * @param updates
     */
    async updateOrganization(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateOrganization', async () => {
            return db_1.db
                .update(schema.organizations)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    // Missing Building operations
    /**
     * Gets all buildings with caching.
     */
    async getBuildings() {
        return this.withOptimizations('getBuildings', 'all_buildings', 'buildings', () => db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
    }
    /**
     * Updates building with cache invalidation.
     * @param id
     * @param updates
     */
    async updateBuilding(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result[0];
    }
    /**
     * Deletes building (soft delete).
     * @param id
     */
    async deleteBuilding(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result.length > 0;
    }
    // Missing Residence operations
    /**
     * Gets all residences with caching.
     */
    async getResidences() {
        return this.withOptimizations('getResidences', 'all_residences', 'residences', () => db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
    }
    /**
     * Updates residence with cache invalidation.
     * @param id
     * @param updates
     */
    async updateResidence(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result[0];
    }
    /**
     * Deletes residence (soft delete).
     * @param id
     */
    async deleteResidence(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result.length > 0;
    }
    // Development Pillar operations
    /**
     * Gets all development pillars.
     */
    async getPillars() {
        return this.withOptimizations('getPillars', 'all_pillars', 'pillars', () => db_1.db.select().from(schema.developmentPillars));
    }
    /**
     * Gets development pillar by ID.
     * @param id
     */
    async getPillar(id) {
        return this.withOptimizations('getPillar', `pillar:${id}`, 'pillars', async () => {
            const result = await db_1.db
                .select()
                .from(schema.developmentPillars)
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id));
            return result[0];
        });
    }
    /**
     * Creates development pillar.
     * @param pillar
     */
    async createPillar(pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createPillar', async () => {
            return db_1.db.insert(schema.developmentPillars).values(pillar).returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    /**
     * Updates development pillar.
     * @param id
     * @param pillar
     */
    async updatePillar(id, pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updatePillar', async () => {
            return db_1.db
                .update(schema.developmentPillars)
                .set({ ...pillar, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    // Workspace Status operations
    /**
     * Gets all workspace statuses.
     */
    async getWorkspaceStatuses() {
        return this.withOptimizations('getWorkspaceStatuses', 'all_workspace_statuses', 'workspace_status', () => db_1.db.select().from(schema.workspaceStatus));
    }
    /**
     * Gets workspace status by component.
     * @param component
     */
    async getWorkspaceStatus(component) {
        return this.withOptimizations('getWorkspaceStatus', `workspace_status:${component}`, 'workspace_status', async () => {
            const result = await db_1.db
                .select()
                .from(schema.workspaceStatus)
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component));
            return result[0];
        });
    }
    /**
     * Creates workspace status.
     * @param status
     */
    async createWorkspaceStatus(status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createWorkspaceStatus', async () => {
            return db_1.db.insert(schema.workspaceStatus).values(status).returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    /**
     * Updates workspace status.
     * @param component
     * @param status
     */
    async updateWorkspaceStatus(component, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateWorkspaceStatus', async () => {
            return db_1.db
                .update(schema.workspaceStatus)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component))
                .returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    // Quality Metrics operations
    /**
     * Gets all quality metrics.
     */
    async getQualityMetrics() {
        return this.withOptimizations('getQualityMetrics', 'all_quality_metrics', 'quality_metrics', () => db_1.db.select().from(schema.qualityMetrics));
    }
    /**
     * Creates quality metric.
     * @param metric
     */
    async createQualityMetric(metric) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createQualityMetric', async () => {
            return db_1.db.insert(schema.qualityMetrics).values(metric).returning();
        });
        query_cache_1.queryCache.invalidate('quality_metrics');
        return result[0];
    }
    // Framework Configuration operations
    /**
     * Gets all framework configurations.
     */
    async getFrameworkConfigs() {
        return this.withOptimizations('getFrameworkConfigs', 'all_framework_configs', 'framework_configs', () => db_1.db.select().from(schema.frameworkConfiguration));
    }
    /**
     * Gets framework config by key.
     * @param key
     * @param _key
     */
    async getFrameworkConfig(_key) {
        return this.withOptimizations('getFrameworkConfig', `framework_config:${_key}`, 'framework_configs', async () => {
            const result = await db_1.db
                .select()
                .from(schema.frameworkConfiguration)
                .where((0, drizzle_orm_1.eq)(schema.frameworkConfiguration._key, _key));
            return result[0];
        });
    }
    /**
     * Sets framework configuration.
     * @param config
     */
    async setFrameworkConfig(config) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('setFrameworkConfig', async () => {
            return db_1.db
                .insert(schema.frameworkConfiguration)
                .values(config)
                .onConflictDoUpdate({
                target: schema.frameworkConfiguration._key,
                set: { _value: config._value, updatedAt: new Date() },
            })
                .returning();
        });
        query_cache_1.queryCache.invalidate('framework_configs');
        return result[0];
    }
    // Improvement Suggestions operations
    /**
     * Gets all improvement suggestions.
     */
    async getImprovementSuggestions() {
        return this.withOptimizations('getImprovementSuggestions', 'all_improvement_suggestions', 'improvement_suggestions', () => db_1.db.select().from(schema.improvementSuggestions));
    }
    /**
     * Gets top improvement suggestions.
     * @param limit
     */
    async getTopImprovementSuggestions(limit) {
        return this.withOptimizations('getTopImprovementSuggestions', `top_suggestions:${limit}`, 'improvement_suggestions', () => db_1.db
            .select()
            .from(schema.improvementSuggestions)
            .orderBy((0, drizzle_orm_1.desc)(schema.improvementSuggestions.priority), (0, drizzle_orm_1.desc)(schema.improvementSuggestions.createdAt))
            .limit(limit));
    }
    /**
     * Creates improvement suggestion.
     * @param suggestion
     */
    async createImprovementSuggestion(suggestion) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createImprovementSuggestion', async () => {
            return db_1.db
                .insert(schema.improvementSuggestions)
                .values([
                {
                    ...suggestion,
                    category: suggestion.category,
                },
            ])
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    /**
     * Clears new suggestions.
     */
    async clearNewSuggestions() {
        await performance_monitoring_1.dbPerformanceMonitor.trackQuery('clearNewSuggestions', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status: 'Acknowledged' })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.status, 'New'));
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
    }
    /**
     * Updates suggestion status.
     * @param id
     * @param status
     */
    async updateSuggestionStatus(id, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateSuggestionStatus', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    // Features operations
    /**
     * Gets all features.
     */
    async getFeatures() {
        return this.withOptimizations('getFeatures', 'all_features', 'features', () => db_1.db.select().from(schema.features));
    }
    /**
     * Gets features by status.
     * @param status
     */
    async getFeaturesByStatus(status) {
        return this.withOptimizations('getFeaturesByStatus', `features_status:${status}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.status, status)));
    }
    /**
     * Gets features by category.
     * @param category
     */
    async getFeaturesByCategory(category) {
        return this.withOptimizations('getFeaturesByCategory', `features_category:${category}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.category, category)));
    }
    /**
     * Gets public roadmap features.
     */
    async getPublicRoadmapFeatures() {
        return this.withOptimizations('getPublicRoadmapFeatures', 'public_roadmap_features', 'features', () => db_1.db.select().from(schema.features).where((0, drizzle_orm_1.eq)(schema.features.isPublicRoadmap, true)));
    }
    /**
     * Creates feature.
     * @param feature
     */
    async createFeature(feature) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeature', async () => {
            return db_1.db.insert(schema.features).values([feature]).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Updates feature.
     * @param id
     * @param updates
     */
    async updateFeature(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeature', async () => {
            return db_1.db
                .update(schema.features)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.features.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Deletes feature.
     * @param id
     */
    async deleteFeature(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteFeature', async () => {
            return db_1.db.delete(schema.features).where((0, drizzle_orm_1.eq)(schema.features.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result.length > 0;
    }
    // Actionable Items operations
    /**
     * Gets actionable items by feature.
     * @param featureId
     */
    async getActionableItemsByFeature(featureId) {
        return this.withOptimizations('getActionableItemsByFeature', `actionable_items:${featureId}`, 'actionable_items', () => db_1.db
            .select()
            .from(schema.actionableItems)
            .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId)));
    }
    /**
     * Gets actionable item by ID.
     * @param id
     */
    async getActionableItem(id) {
        return this.withOptimizations('getActionableItem', `actionable_item:${id}`, 'actionable_items', async () => {
            const result = await db_1.db
                .select()
                .from(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id));
            return result[0];
        });
    }
    /**
     * Creates actionable item.
     * @param item
     */
    async createActionableItem(item) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItem', async () => {
            return db_1.db.insert(schema.actionableItems).values([item]).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Creates multiple actionable items.
     * @param items
     */
    async createActionableItems(items) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItems', async () => {
            return db_1.db.insert(schema.actionableItems).values(items).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result;
    }
    /**
     * Updates actionable item.
     * @param id
     * @param updates
     */
    async updateActionableItem(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateActionableItem', async () => {
            return db_1.db
                .update(schema.actionableItems)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Deletes actionable item.
     * @param id
     */
    async deleteActionableItem(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItem', async () => {
            return db_1.db.delete(schema.actionableItems).where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    /**
     * Deletes actionable items by feature.
     * @param featureId
     */
    async deleteActionableItemsByFeature(featureId) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItemsByFeature', async () => {
            return db_1.db
                .delete(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    // Invitation operations
    /**
     * Gets all invitations.
     */
    async getInvitations() {
        return this.withOptimizations('getInvitations', 'all_invitations', 'invitations', () => db_1.db.select().from(schema.invitations));
    }
    /**
     * Gets invitation by ID.
     * @param id
     */
    async getInvitation(id) {
        return this.withOptimizations('getInvitation', `invitation:${id}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id));
            return result[0];
        });
    }
    /**
     * Gets invitation by token.
     * @param token
     */
    async getInvitationByToken(token) {
        return this.withOptimizations('getInvitationByToken', `invitation_token:${token}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token));
            return result[0];
        });
    }
    /**
     * Gets invitations by email.
     * @param email
     */
    async getInvitationsByEmail(email) {
        return this.withOptimizations('getInvitationsByEmail', `invitations_email:${email}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, email)));
    }
    /**
     * Gets invitations by inviter.
     * @param userId
     */
    async getInvitationsByInviter(userId) {
        return this.withOptimizations('getInvitationsByInviter', `invitations_inviter:${userId}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, userId)));
    }
    /**
     * Gets invitations by status.
     * @param status
     */
    async getInvitationsByStatus(status) {
        return this.withOptimizations('getInvitationsByStatus', `invitations_status:${status}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.status, status)));
    }
    /**
     * Creates invitation.
     * @param invitation
     */
    async createInvitation(invitation) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitation', async () => {
            return db_1.db.insert(schema.invitations).values([invitation]).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Updates invitation.
     * @param id
     * @param updates
     */
    async updateInvitation(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Accepts invitation.
     * @param token
     * @param userData
     * @param userData.firstName
     * @param ipAddress
     * @param userData.lastName
     * @param userAgent
     * @param userData.password
     */
    async acceptInvitation(token, userData, ipAddress, userAgent) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('acceptInvitation', async () => {
            const invitation = await this.getInvitationByToken(token);
            if (!invitation || invitation.status !== 'pending') {
                return null;
            }
            // Create user with required fields
            const user = await this.createUser({
                username: invitation.email.split('@')[0], // Use email prefix as username
                email: invitation.email,
                firstName: userData.firstName,
                lastName: userData.lastName,
                password: userData.password, // This should be hashed
                language: 'en', // Default language
                role: invitation.role,
            });
            // Update invitation
            const updatedInvitation = await this.updateInvitation(invitation.id, {
                status: 'accepted',
                acceptedAt: new Date(),
            });
            return { user, invitation: updatedInvitation };
        });
    }
    /**
     * Cancels invitation.
     * @param id
     * @param cancelledBy
     */
    async cancelInvitation(id, cancelledBy) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('cancelInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({
                status: 'cancelled',
                cancelledBy,
                cancelledAt: new Date(),
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Expires old invitations.
     */
    async expireInvitations() {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('expireInvitations', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({ status: 'expired', updatedAt: new Date() })
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.status, 'pending'), (0, drizzle_orm_1.lte)(schema.invitations.expiresAt, new Date())))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length;
    }
    /**
     * Deletes invitation.
     * @param id
     */
    async deleteInvitation(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteInvitation', async () => {
            return db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length > 0;
    }
    // Invitation Audit Log operations
    /**
     * Gets invitation audit logs.
     * @param invitationId
     */
    async getInvitationAuditLogs(invitationId) {
        return this.withOptimizations('getInvitationAuditLogs', `invitation_logs:${invitationId}`, 'invitation_logs', () => db_1.db
            .select()
            .from(schema.invitationAuditLog)
            .where((0, drizzle_orm_1.eq)(schema.invitationAuditLog.invitationId, invitationId))
            .orderBy((0, drizzle_orm_1.desc)(schema.invitationAuditLog.createdAt)));
    }
    /**
     * Creates invitation audit log.
     * @param logEntry
     */
    async createInvitationAuditLog(logEntry) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitationAuditLog', async () => {
            return db_1.db.insert(schema.invitationAuditLog).values(logEntry).returning();
        });
        query_cache_1.queryCache.invalidate('invitation_logs');
        return result[0];
    }
    // Permission operations
    /**
     * Gets all permissions.
     */
    async getPermissions() {
        return this.withOptimizations('getPermissions', 'permissions:all', 'permissions', () => db_1.db
            .select()
            .from(schema.permissions)
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.permissions.resourceType, schema.permissions.action));
    }
    /**
     * Gets all role permissions.
     */
    async getRolePermissions() {
        return this.withOptimizations('getRolePermissions', 'role_permissions:all', 'role_permissions', () => db_1.db
            .select()
            .from(schema.rolePermissions)
            .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.rolePermissions.permissionId, schema.permissions.id))
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.rolePermissions.role, schema.permissions.resourceType));
    }
    /**
     * Gets all user permissions.
     */
    async getUserPermissions() {
        try {
            const results = await db_1.db
                .select()
                .from(schema.userPermissions)
                .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.userPermissions.permissionId, schema.permissions.id))
                .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
                .orderBy(schema.userPermissions.userId);
            return results || [];
        }
        catch (error) {
            console.error('âŒ Error getting user permissions:', error);
            return [];
        }
    }
    // Old building document methods removed - using unified documents table
    // Unified Document operations
    async getDocuments(filters) {
        return this.withOptimizations('getDocuments', `documents:${JSON.stringify(filters)}`, 'documents', async () => {
            let query = db_1.db.select().from(schema.documents);
            const conditions = [];
            if (filters?.buildingId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.buildingId, filters.buildingId));
            }
            if (filters?.residenceId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.residenceId, filters.residenceId));
            }
            if (filters?.documentType) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.documentType, filters.documentType));
            }
            if (conditions.length > 0) {
                query = query.where((0, drizzle_orm_1.and)(...conditions));
            }
            const result = await query.orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
            return result || [];
        });
    }
    async getDocument(id) {
        return this.withOptimizations('getDocument', `document:${id}`, 'documents', async () => {
            const result = await db_1.db
                .select()
                .from(schema.documents)
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .limit(1);
            return result[0];
        });
    }
    async createDocument(document) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('createDocument', async () => {
            const result = await db_1.db.insert(schema.documents).values(document).returning();
            // Invalidate related caches
            if (document.buildingId) {
                query_cache_1.queryCache.invalidate('documents', `*buildingId*${document.buildingId}*`);
            }
            if (document.residenceId) {
                query_cache_1.queryCache.invalidate('documents', `*residenceId*${document.residenceId}*`);
            }
            return result[0];
        });
    }
    async updateDocument(id, updates) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateDocument', async () => {
            const result = await db_1.db
                .update(schema.documents)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .returning();
            if (result[0]) {
                // Invalidate caches
                query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                query_cache_1.queryCache.invalidate('documents', '*');
            }
            return result[0];
        });
    }
    async deleteDocument(id) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteDocument', async () => {
            const result = await db_1.db
                .delete(schema.documents)
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .returning({ id: schema.documents.id });
            if (result.length > 0) {
                // Invalidate caches
                query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                query_cache_1.queryCache.invalidate('documents', '*');
                return true;
            }
            return false;
        });
    }
    // Old resident document methods removed - using unified documents table
    // Legacy Document operations (kept for migration purposes)
    /**
     * Gets legacy documents for user.
     * @param userId
     * @param userRole
     * @param organizationId
     * @param residenceIds
     */
    async getDocumentsForUser(userId, userRole, organizationId, residenceIds) {
        return this.withOptimizations('getDocumentsForUser', `legacy_docs:${userId}:${userRole}`, 'documents', async () => {
            return await db_1.db.select().from(schema.documents).orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
        });
    }
    // Password reset operations
    /**
     *
     * @param token
     */
    async createPasswordResetToken(token) {
        const result = await db_1.db.insert(schema.passwordResetTokens).values(token).returning();
        // Token created successfully
        return result[0];
    }
    /**
     *
     * @param tokenValue
     */
    async getPasswordResetToken(tokenValue) {
        return this.withOptimizations('getPasswordResetToken', `token_${tokenValue}`, 'password_reset_tokens', async () => {
            const result = await db_1.db
                .select()
                .from(schema.passwordResetTokens)
                .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.token, tokenValue))
                .limit(1);
            return result[0];
        });
    }
    /**
     *
     * @param tokenId
     */
    async markPasswordResetTokenAsUsed(tokenId) {
        const result = await db_1.db
            .update(schema.passwordResetTokens)
            .set({
            isUsed: true,
            usedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.id, tokenId))
            .returning();
        // Token marked as used
        return result[0];
    }
    /**
     *
     */
    async cleanupExpiredPasswordResetTokens() {
        const result = await db_1.db
            .delete(schema.passwordResetTokens)
            .where((0, drizzle_orm_1.lte)(schema.passwordResetTokens.expiresAt, new Date()))
            .returning();
        // Expired tokens cleaned up
        return result.length;
    }
    // Contact operations
    /**
     * Gets all contacts.
     */
    async getContacts() {
        return this.withOptimizations('getContacts', 'all_contacts', 'contacts', () => db_1.db.select().from(schema.contacts).where((0, drizzle_orm_1.eq)(schema.contacts.isActive, true)));
    }
    /**
     * Gets contacts by entity.
     * @param entityId
     * @param entity
     */
    async getContactsByEntity(entityId, entity) {
        return this.withOptimizations('getContactsByEntity', `contacts_entity:${entity}_${entityId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, entityId), (0, drizzle_orm_1.eq)(schema.contacts.entity, entity), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Gets contacts for residence with user data.
     * @param residenceId
     */
    async getContactsForResidence(residenceId) {
        return this.withOptimizations('getContactsForResidence', `contacts_residence:${residenceId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .innerJoin(schema.users, (0, drizzle_orm_1.eq)(schema.contacts.name, schema.users.email))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, residenceId), (0, drizzle_orm_1.eq)(schema.contacts.entity, 'residence'), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Creates a new contact.
     * @param contact
     */
    async createContact(contact) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createContact', async () => {
            return db_1.db.insert(schema.contacts).values(contact).returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Updates a contact.
     * @param id
     * @param updates
     */
    async updateContact(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Deletes a contact.
     * @param id
     */
    async deleteContact(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set({ isActive: false })
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result.length > 0;
    }
    /**
     * Gets demands for a user.
     * @param userId
     */
    async getDemandsForUser(userId) {
        return this.withOptimizations('getDemandsForUser', `demands_user:${userId}`, 'demands', () => db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.userId, userId)));
    }
    /**
     * Gets a specific demand.
     * @param id
     */
    async getDemand(id) {
        return this.withOptimizations('getDemand', `demand:${id}`, 'demands', async () => {
            const result = await db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.id, id));
            return result[0];
        });
    }
    // Bug operations implementation
    /**
     *
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBugsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getBugsForUser', `bugs:${userRole}:${userId}`, 'bugs', async () => {
            let results;
            if (userRole === 'admin') {
                // Admin can see all bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else if (userRole === 'manager' && organizationId) {
                // For managers, return all bugs for now (can be refined later)
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else {
                // For residents and tenants, return only their own bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .where((0, drizzle_orm_1.eq)(schema.bugs.createdBy, userId))
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            // Get attachment counts and details for each bug
            const bugsWithAttachments = await Promise.all(results.map(async (bug) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    fileName: schema.documents.fileName,
                    fileSize: schema.documents.fileSize,
                    filePath: schema.documents.filePath,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'bug'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, bug.id)));
                return {
                    ...bug,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.fileName || att.name,
                        size: parseInt(att.fileSize || '0'),
                        url: `/api/documents/${att.id}/file`,
                        type: att.fileName ? att.fileName.split('.').pop()?.toLowerCase() || 'unknown' : 'unknown'
                    }))
                };
            }));
            return bugsWithAttachments;
        });
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBug(id, userId, userRole, organizationId) {
        const key = `bug:${id}:user:${userId}:${userRole}`;
        return query_cache_1.queryCache.get(key, async () => {
            const result = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
            const bug = result[0];
            if (!bug) {
                return undefined;
            }
            if (userRole === 'admin') {
                return bug;
            }
            if (userRole === 'manager') {
                return bug; // Managers can see all bugs for now
            }
            // Residents and tenants can only see their own bugs
            return bug.createdBy === userId ? bug : undefined;
        });
    }
    /**
     *
     * @param bugData
     */
    async createBug(bugData) {
        const result = await db_1.db
            .insert(schema.bugs)
            .values({
            ...bugData,
            id: crypto_1.default.randomUUID(),
            status: 'new',
            assignedTo: null,
            resolvedAt: null,
            resolvedBy: null,
            notes: null,
            createdAt: new Date(),
            updatedAt: new Date(),
        })
            .returning();
        // Invalidate cache for this user
        query_cache_1.queryCache.invalidate('bugs');
        return result[0];
    }
    /**
     *
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateBug(id, updates, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return undefined;
        }
        // Access control: users can edit their own bugs, admins and managers can edit any bug
        const canEdit = userRole === 'admin' || userRole === 'manager' || existingBug.createdBy === userId;
        if (!canEdit) {
            return undefined;
        }
        const result = await db_1.db
            .update(schema.bugs)
            .set({
            ...updates,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.bugs.id, id))
            .returning();
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
        }
        return result[0];
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteBug(id, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return false;
        }
        // Access control: users can delete their own bugs, admins can delete any bug
        const canDelete = userRole === 'admin' || existingBug.createdBy === userId;
        if (!canDelete) {
            return false;
        }
        const result = await db_1.db.delete(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id)).returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
            return true;
        }
        return false;
    }
    // Feature Request operations with optimization
    /**
     * Retrieves feature requests for a user with role-based access control.
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequestsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequestsForUser', `feature_requests:${userRole}:${userId}`, 'feature_requests', async () => {
            const results = await db_1.db
                .select()
                .from(schema.featureRequests)
                .orderBy((0, drizzle_orm_1.desc)(schema.featureRequests.createdAt));
            // Get attachment counts and details for each feature request
            const requestsWithAttachments = await Promise.all(results.map(async (request) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    filePath: schema.documents.filePath,
                    fileSize: schema.documents.fileSize,
                    mimeType: schema.documents.mimeType,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'feature_request'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, request.id)));
                return {
                    ...request,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.name,
                        url: `/api/documents/${att.id}/file`,
                        size: att.fileSize ? parseInt(att.fileSize) : 0,
                        mimeType: att.mimeType,
                    })),
                };
            }));
            // All users can see all feature requests, but non-admins don't see who submitted
            if (userRole === 'admin') {
                return requestsWithAttachments;
            }
            // For non-admin users, hide the createdBy field
            return requestsWithAttachments.map((request) => ({
                ...request,
                createdBy: null,
            }));
        });
    }
    /**
     * Retrieves a specific feature request by ID with role-based access control.
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequest(id, userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequest', `feature_request:${id}:${userRole}`, 'feature_requests', async () => {
            const result = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id));
            const featureRequest = result[0];
            if (!featureRequest) {
                return undefined;
            }
            // All users can see any feature request
            if (userRole === 'admin') {
                return featureRequest;
            }
            // For non-admin users, hide the createdBy field
            return {
                ...featureRequest,
                createdBy: null,
            };
        });
    }
    /**
     * Creates a new feature request.
     * @param featureRequestData
     */
    async createFeatureRequest(featureRequestData) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeatureRequest', async () => {
            return db_1.db
                .insert(schema.featureRequests)
                .values({
                ...featureRequestData,
                id: crypto_1.default.randomUUID(),
                status: 'submitted',
                upvoteCount: 0,
                assignedTo: null,
                reviewedBy: null,
                reviewedAt: null,
                adminNotes: null,
                mergedIntoId: null,
                createdAt: new Date(),
                updatedAt: new Date(),
            })
                .returning();
        });
        // Invalidate cache
        query_cache_1.queryCache.invalidate('feature_requests');
        return result[0];
    }
    /**
     * Updates a feature request (admin only).
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateFeatureRequest(id, updates, userId, userRole) {
        // Only admins can update feature requests
        if (userRole !== 'admin') {
            return undefined;
        }
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeatureRequest', async () => {
            return db_1.db
                .update(schema.featureRequests)
                .set({
                ...updates,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
                .returning();
        });
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
        }
        return result[0];
    }
    /**
     * Deletes a feature request (admin only).
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteFeatureRequest(id, userId, userRole) {
        // Only admins can delete feature requests
        if (userRole !== 'admin') {
            return false;
        }
        // First delete all upvotes for this feature request
        await db_1.db
            .delete(schema.featureRequestUpvotes)
            .where((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, id));
        const result = await db_1.db
            .delete(schema.featureRequests)
            .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
            .returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return true;
        }
        return false;
    }
    /**
     * Upvotes a feature request.
     * @param upvoteData
     */
    async upvoteFeatureRequest(upvoteData) {
        const { featureRequestId, userId } = upvoteData;
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Check if user has already upvoted this feature request
            const existingUpvote = await db_1.db
                .select()
                .from(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)));
            if (existingUpvote.length > 0) {
                return {
                    success: false,
                    message: 'You have already upvoted this feature request',
                };
            }
            // Create the upvote
            const upvoteResult = await db_1.db
                .insert(schema.featureRequestUpvotes)
                .values({
                ...upvoteData,
                id: crypto_1.default.randomUUID(),
                createdAt: new Date(),
            })
                .returning();
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: sql `${schema.featureRequests.upvoteCount} + 1`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Feature request upvoted successfully',
                data: {
                    upvote: upvoteResult[0],
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('âŒ Error upvoting feature request:', error);
            return {
                success: false,
                message: 'Failed to upvote feature request',
            };
        }
    }
    /**
     * Removes an upvote from a feature request.
     * @param featureRequestId
     * @param userId
     */
    async removeFeatureRequestUpvote(featureRequestId, userId) {
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Find and remove the upvote
            const removedUpvote = await db_1.db
                .delete(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)))
                .returning();
            if (removedUpvote.length === 0) {
                return {
                    success: false,
                    message: 'You have not upvoted this feature request',
                };
            }
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: sql `GREATEST(0, ${schema.featureRequests.upvoteCount} - 1)`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Upvote removed successfully',
                data: {
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('âŒ Error removing feature request upvote:', error);
            return {
                success: false,
                message: 'Failed to remove upvote',
            };
        }
    }
}
exports.OptimizedDatabaseStorage = OptimizedDatabaseStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvb3B0aW1pemVkLWRiLXN0b3JhZ2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsNkNBQWdGO0FBQ2hGLHVFQUF1RTtBQUN2RSw2QkFBMEI7QUFDMUIsb0RBQTRCO0FBQzVCLHVEQUF5QztBQXdDekMsbUVBQW1HO0FBQ25HLCtDQUE2RDtBQUM3RCxxRUFBZ0U7QUFDaEUsNkNBQW1EO0FBRW5ELGlEQUFpRDtBQUVqRDs7R0FFRztBQUNILE1BQWEsd0JBQXdCO0lBQ25DOztPQUVHO0lBQ0g7UUFDRSx5Q0FBeUM7UUFDekMsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhO1lBQ3RDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0I7WUFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUMzQixDQUFDO1lBQ0QsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDakMsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyx1QkFBdUI7UUFDbkMsMENBQTBDO1FBQzFDLElBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWM7WUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFDaEMsQ0FBQztZQUNELHFEQUFxRDtZQUNyRCxPQUFPO1FBQ1QsQ0FBQztRQUVELElBQUksQ0FBQztZQUNILE1BQU0sc0NBQWMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQzlDLGlDQUFpQztRQUNuQyxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDhDQUE4QyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZF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LENBQUEsZUFBZSxNQUFNLENBQUMsZUFBZSxDQUFDLFdBQVcsT0FBTztnQkFDeEUsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ3RCLENBQUM7aUJBQ0QsS0FBSyxDQUFDLElBQUEsZ0JBQUUsRUFBQyxNQUFNLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRSxnQkFBZ0IsQ0FBQyxDQUFDO2lCQUN0RCxTQUFTLEVBQUUsQ0FBQztZQUVmLG1CQUFtQjtZQUNuQix3QkFBVSxDQUFDLFVBQVUsQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQzFDLHdCQUFVLENBQUMsVUFBVSxDQUFDLHlCQUF5QixDQUFDLENBQUM7WUFFakQsT0FBTztnQkFDTCxPQUFPLEVBQUUsSUFBSTtnQkFDYixPQUFPLEVBQUUsNkJBQTZCO2dCQUN0QyxJQUFJLEVBQUU7b0JBQ0osY0FBYyxFQUFFLHFCQUFxQixDQUFDLENBQUMsQ0FBQztpQkFDekM7YUFDRixDQUFDO1FBQ0osQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQywwQ0FBMEMsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNqRSxPQUFPO2dCQUNMLE9BQU8sRUFBRSxLQUFLO2dCQUNkLE9BQU8sRUFBRSx5QkFBeUI7YUFDbkMsQ0FBQztRQUNKLENBQUM7SUFDSCxDQUFDO0NBQ0Y7QUExa0ZELDREQTBrRkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvb3B0aW1pemVkLWRiLXN0b3JhZ2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBPcHRpbWl6ZWQgZGF0YWJhc2Ugc3RvcmFnZSB3aXRoIGNhY2hpbmcgYW5kIHBlcmZvcm1hbmNlIG1vbml0b3JpbmcuXG4gKiBSZXBsYWNlcyBkZWNvcmF0b3JzIHdpdGggZGlyZWN0IGltcGxlbWVudGF0aW9uIGZvciBiZXR0ZXIgY29tcGF0aWJpbGl0eS5cbiAqL1xuXG5pbXBvcnQgeyBlcSwgZGVzYywgYW5kLCBvciwgZ3RlLCBsdGUsIGNvdW50LCBsaWtlLCBpbkFycmF5IH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuLy8gVXNlIHNoYXJlZCBkYXRhYmFzZSBjb25uZWN0aW9uIHRvIGF2b2lkIG11bHRpcGxlIHBvb2xzIGluIHByb2R1Y3Rpb25cbmltcG9ydCB7IGRiIH0gZnJvbSAnLi9kYic7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHR5cGUge1xuICBVc2VyLFxuICBJbnNlcnRVc2VyLFxuICBPcmdhbml6YXRpb24sXG4gIEluc2VydE9yZ2FuaXphdGlvbixcbiAgQnVpbGRpbmcsXG4gIEluc2VydEJ1aWxkaW5nLFxuICBSZXNpZGVuY2UsXG4gIEluc2VydFJlc2lkZW5jZSxcbiAgRG9jdW1lbnQsXG4gIEluc2VydERvY3VtZW50LFxuICBJbnNlcnRQaWxsYXIsXG4gIFBpbGxhciBhcyBEZXZlbG9wbWVudFBpbGxhcixcbiAgV29ya3NwYWNlU3RhdHVzLFxuICBJbnNlcnRXb3Jrc3BhY2VTdGF0dXMsXG4gIFF1YWxpdHlNZXRyaWMsXG4gIEluc2VydFF1YWxpdHlNZXRyaWMsXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24sXG4gIEluc2VydEZyYW1ld29ya0NvbmZpZ3VyYXRpb24sXG4gIEltcHJvdmVtZW50U3VnZ2VzdGlvbixcbiAgSW5zZXJ0SW1wcm92ZW1lbnRTdWdnZXN0aW9uLFxuICBGZWF0dXJlLFxuICBJbnNlcnRGZWF0dXJlLFxuICBBY3Rpb25hYmxlSXRlbSxcbiAgSW5zZXJ0QWN0aW9uYWJsZUl0ZW0sXG4gIEludml0YXRpb24sXG4gIEluc2VydEludml0YXRpb24sXG4gIEludml0YXRpb25BdWRpdExvZyxcbiAgSW5zZXJ0SW52aXRhdGlvbkF1ZGl0TG9nLFxuICBQZXJtaXNzaW9uLFxuICBSb2xlUGVybWlzc2lvbixcbiAgVXNlclBlcm1pc3Npb24sXG4gIFBhc3N3b3JkUmVzZXRUb2tlbixcbiAgSW5zZXJ0UGFzc3dvcmRSZXNldFRva2VuLFxuICBCdWcsXG4gIEluc2VydEJ1Zyxcbn0gZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHR5cGUgeyBJU3RvcmFnZSB9IGZyb20gJy4vc3RvcmFnZSc7XG5pbXBvcnQgdHlwZSB7IFBpbGxhciB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IFF1ZXJ5T3B0aW1pemVyLCBQYWdpbmF0aW9uSGVscGVyLCB0eXBlIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi9kYXRhYmFzZS1vcHRpbWl6YXRpb24nO1xuaW1wb3J0IHsgcXVlcnlDYWNoZSwgQ2FjaGVJbnZhbGlkYXRvciB9IGZyb20gJy4vcXVlcnktY2FjaGUnO1xuaW1wb3J0IHsgZGJQZXJmb3JtYW5jZU1vbml0b3IgfSBmcm9tICcuL3BlcmZvcm1hbmNlLW1vbml0b3JpbmcnO1xuaW1wb3J0IHsgZXhpc3RzLCBzcWwgYXMgc3FsT3AgfSBmcm9tICdkcml6emxlLW9ybSc7XG5cbi8vIERhdGFiYXNlIGNvbm5lY3Rpb24gaW1wb3J0ZWQgZnJvbSBzaGFyZWQgZGIudHNcblxuLyoqXG4gKiBFbmhhbmNlZCBkYXRhYmFzZSBzdG9yYWdlIHdpdGggYnVpbHQtaW4gY2FjaGluZyBhbmQgcGVyZm9ybWFuY2UgbW9uaXRvcmluZy5cbiAqL1xuZXhwb3J0IGNsYXNzIE9wdGltaXplZERhdGFiYXNlU3RvcmFnZSBpbXBsZW1lbnRzIElTdG9yYWdlIHtcbiAgLyoqXG4gICAqXG4gICAqL1xuICBjb25zdHJ1Y3RvcigpIHtcbiAgICAvLyBTa2lwIG9wdGltaXphdGlvbnMgaW4gdGVzdCBlbnZpcm9ubWVudFxuICAgIGlmIChcbiAgICAgIHByb2Nlc3MuZW52LlRFU1RfRU5WICE9PSAnaW50ZWdyYXRpb24nICYmXG4gICAgICAhcHJvY2Vzcy5lbnYuRElTQUJMRV9EQl9PUFRJTUlaQVRJT05TICYmXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnICYmXG4gICAgICAhcHJvY2Vzcy5lbnYuSkVTVF9XT1JLRVJfSURcbiAgICApIHtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZU9wdGltaXphdGlvbnMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogSW5pdGlhbGl6ZXMgZGF0YWJhc2Ugb3B0aW1pemF0aW9ucy5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZU9wdGltaXphdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gU2tpcCBkYXRhYmFzZSBvcHRpbWl6YXRpb24gZHVyaW5nIHRlc3RzXG4gICAgaWYgKFxuICAgICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0JyB8fFxuICAgICAgcHJvY2Vzcy5lbnYuSkVTVF9XT1JLRVJfSUQgfHxcbiAgICAgIHByb2Nlc3MuZW52LlNLSVBfREJfT1BUSU1JWkFUSU9OXG4gICAgKSB7XG4gICAgICAvLyBEYXRhYmFzZSBvcHRpbWl6YXRpb25zIHNraXBwZWQgaW4gdGVzdCBlbnZpcm9ubWVudFxuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBRdWVyeU9wdGltaXplci5hcHBseUNvcmVPcHRpbWl6YXRpb25zKCk7XG4gICAgICAvLyBEYXRhYmFzZSBvcHRpbWl6YXRpb25zIGFwcGxpZWRcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgaW5pdGlhbGl6aW5nIGRhdGFiYXNlIG9wdGltaXphdGlvbnM6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXcmFwcGVyIGZvciBwZXJmb3JtYW5jZSB0cmFja2luZyBhbmQgY2FjaGluZy5cbiAgICogQHBhcmFtIG9wZXJhdGlvblxuICAgKiBAcGFyYW0gY2FjaGVLZXlcbiAgICogQHBhcmFtIGNhY2hlVHlwZVxuICAgKiBAcGFyYW0gZm5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgd2l0aE9wdGltaXphdGlvbnM8VD4oXG4gICAgb3BlcmF0aW9uOiBzdHJpbmcsXG4gICAgY2FjaGVLZXk6IHN0cmluZyB8IG51bGwsXG4gICAgY2FjaGVUeXBlOiBzdHJpbmcsXG4gICAgZm46ICgpID0+IFByb21pc2U8VD5cbiAgKTogUHJvbWlzZTxUPiB7XG4gICAgLy8gVHJ5IGNhY2hlIGZpcnN0XG4gICAgaWYgKGNhY2hlS2V5KSB7XG4gICAgICBjb25zdCBjYWNoZWQgPSBxdWVyeUNhY2hlLmdldDxUPihjYWNoZVR5cGUsIGNhY2hlS2V5KTtcbiAgICAgIGlmIChjYWNoZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm4gY2FjaGVkO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEV4ZWN1dGUgd2l0aCBwZXJmb3JtYW5jZSB0cmFja2luZ1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkob3BlcmF0aW9uLCBmbik7XG5cbiAgICAvLyBDYWNoZSByZXN1bHRcbiAgICBpZiAoY2FjaGVLZXkgJiYgcmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHF1ZXJ5Q2FjaGUuc2V0KGNhY2hlVHlwZSwgY2FjaGVLZXksIHJlc3VsdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8vIFVzZXIgb3BlcmF0aW9ucyB3aXRoIG9wdGltaXphdGlvblxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYWxsIGFjdGl2ZSB1c2VycyB3aXRoIGNhY2hpbmcgYW5kIHBlcmZvcm1hbmNlIHRyYWNraW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlcnMoKTogUHJvbWlzZTxVc2VyW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0VXNlcnMnLCAnYWxsX3VzZXJzJywgJ3VzZXJzJywgKCkgPT5cbiAgICAgIGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAubGltaXQoMTAwKSAvLyBBbHdheXMgdXNlIExJTUlUIGZvciBsYXJnZSByZXN1bHQgc2V0c1xuICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS51c2Vycy5jcmVhdGVkQXQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFsbCBhY3RpdmUgdXNlcnMgd2l0aCB0aGVpciBhc3NpZ25tZW50cyAob3JnYW5pemF0aW9ucywgYnVpbGRpbmdzLCByZXNpZGVuY2VzKS5cbiAgICovXG4gIGFzeW5jIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzKCk6IFByb21pc2U8QXJyYXk8VXNlciAmIHsgb3JnYW5pemF0aW9uczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmc7IHR5cGU6IHN0cmluZyB9PjsgYnVpbGRpbmdzOiBBcnJheTx7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZyB9PjsgcmVzaWRlbmNlczogQXJyYXk8eyBpZDogc3RyaW5nOyB1bml0TnVtYmVyOiBzdHJpbmc7IGJ1aWxkaW5nSWQ6IHN0cmluZzsgYnVpbGRpbmdOYW1lOiBzdHJpbmcgfT4gfT4+IHtcbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgY2FjaGUgdG8gZW5zdXJlIGZyZXNoIGRhdGFcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3VzZXJzJywgJ2FsbF91c2Vyc19hc3NpZ25tZW50c192MicpO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzX2Fzc2lnbm1lbnRzX3YzJyk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBhbGwgdXNlcnMgZmlyc3RcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIC5saW1pdCgxMDApXG4gICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkpO1xuXG5cbiAgICAgIC8vIEZvciBlYWNoIHVzZXIsIGZldGNoIHRoZWlyIGFzc2lnbm1lbnRzIHdpdGggbGltaXRlZCBjb25jdXJyZW5jeSB0byBwcmV2ZW50IGNvbm5lY3Rpb24gaXNzdWVzXG4gICAgICBjb25zdCBiYXRjaFNpemUgPSA1OyAvLyBQcm9jZXNzIDUgdXNlcnMgYXQgYSB0aW1lIHRvIGF2b2lkIGNvbm5lY3Rpb24gcG9vbCBleGhhdXN0aW9uXG4gICAgICBjb25zdCB1c2Vyc1dpdGhBc3NpZ25tZW50cyA9IFtdO1xuICAgICAgXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHVzZXJzLmxlbmd0aDsgaSArPSBiYXRjaFNpemUpIHtcbiAgICAgICAgY29uc3QgYmF0Y2ggPSB1c2Vycy5zbGljZShpLCBpICsgYmF0Y2hTaXplKTtcbiAgICAgICAgY29uc3QgYmF0Y2hSZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgYmF0Y2gubWFwKGFzeW5jICh1c2VyKSA9PiB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEdldCB1c2VyIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICAgIGNvbnN0IHVzZXJPcmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5vcmdhbml6YXRpb25zLm5hbWUsXG4gICAgICAgICAgICAgICAgdHlwZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMudHlwZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5vcmdhbml6YXRpb25zLCBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIHNjaGVtYS5vcmdhbml6YXRpb25zLmlkKSlcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gR2V0IHVzZXIgYnVpbGRpbmdzICh0aHJvdWdoIG9yZ2FuaXphdGlvbiByZWxhdGlvbnNoaXBzKVxuICAgICAgICAgICAgY29uc3QgdXNlckJ1aWxkaW5ncyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEuYnVpbGRpbmdzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5idWlsZGluZ3MubmFtZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5idWlsZGluZ3MsIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgLy8gR2V0IHVzZXIgcmVzaWRlbmNlc1xuICAgICAgICAgICAgY29uc3QgdXNlclJlc2lkZW5jZXMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLnJlc2lkZW5jZXMuaWQsXG4gICAgICAgICAgICAgICAgdW5pdE51bWJlcjogc2NoZW1hLnJlc2lkZW5jZXMudW5pdE51bWJlcixcbiAgICAgICAgICAgICAgICBidWlsZGluZ0lkOiBzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLFxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nTmFtZTogc2NoZW1hLmJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnJlc2lkZW5jZXMsIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCwgc2NoZW1hLnJlc2lkZW5jZXMuaWQpKVxuICAgICAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5idWlsZGluZ3MsIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIHNjaGVtYS5idWlsZGluZ3MuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB7XG4gICAgICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbnM6IHVzZXJPcmdzIHx8IFtdLFxuICAgICAgICAgICAgICBidWlsZGluZ3M6IHVzZXJCdWlsZGluZ3MgfHwgW10sXG4gICAgICAgICAgICAgIHJlc2lkZW5jZXM6IHVzZXJSZXNpZGVuY2VzIHx8IFtdLFxuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgICAgICAgLy8gUmV0dXJuIHVzZXIgd2l0aCBlbXB0eSBhc3NpZ25tZW50cyBpZiB0aGVyZSdzIGFuIGVycm9yXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi51c2VyLFxuICAgICAgICAgICAgICBvcmdhbml6YXRpb25zOiBbXSxcbiAgICAgICAgICAgICAgYnVpbGRpbmdzOiBbXSxcbiAgICAgICAgICAgICAgcmVzaWRlbmNlczogW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgfSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIHVzZXJzV2l0aEFzc2lnbm1lbnRzLnB1c2goLi4uYmF0Y2hSZXN1bHRzKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHVzZXJzV2l0aEFzc2lnbm1lbnRzO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBDcml0aWNhbCBlcnJvciBnZXR0aW5nIHVzZXJzIHdpdGggYXNzaWdubWVudHM6JywgZXJyb3IpO1xuICAgICAgLy8gUmV0dXJuIGVtcHR5IGFycmF5IG9uIGNyaXRpY2FsIGVycm9yXG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB1c2VycyBmcm9tIG9yZ2FuaXphdGlvbnMgdGhhdCBhIHNwZWNpZmljIHVzZXIgaGFzIGFjY2VzcyB0by5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlcnNCeU9yZ2FuaXphdGlvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFVzZXJzQnlPcmdhbml6YXRpb25zJyxcbiAgICAgIGB1c2Vyc19ieV9vcmc6JHt1c2VySWR9YCxcbiAgICAgICd1c2VycycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEZpcnN0LCBnZXQgb3JnYW5pemF0aW9uIElEcyB0aGF0IHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG9cbiAgICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgaWYgKHVzZXJPcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkcyA9IHVzZXJPcmdzLm1hcCgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgIC8vIFRoZW4gZ2V0IGFsbCB1c2VycyBmcm9tIHRob3NlIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgcmV0dXJuIGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NoZW1hLnVzZXJzLmlkLFxuICAgICAgICAgICAgdXNlcm5hbWU6IHNjaGVtYS51c2Vycy51c2VybmFtZSxcbiAgICAgICAgICAgIGVtYWlsOiBzY2hlbWEudXNlcnMuZW1haWwsXG4gICAgICAgICAgICBmaXJzdE5hbWU6IHNjaGVtYS51c2Vycy5maXJzdE5hbWUsXG4gICAgICAgICAgICBsYXN0TmFtZTogc2NoZW1hLnVzZXJzLmxhc3ROYW1lLFxuICAgICAgICAgICAgcm9sZTogc2NoZW1hLnVzZXJzLnJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJzLmlzQWN0aXZlLFxuICAgICAgICAgICAgY3JlYXRlZEF0OiBzY2hlbWEudXNlcnMuY3JlYXRlZEF0LFxuICAgICAgICAgICAgdXBkYXRlZEF0OiBzY2hlbWEudXNlcnMudXBkYXRlZEF0LFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLCBlcShzY2hlbWEudXNlcnMuaWQsIHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgaW5BcnJheShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkcylcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnVzZXJzLmZpcnN0TmFtZSwgc2NoZW1hLnVzZXJzLmxhc3ROYW1lKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgcGFnaW5hdGVkIHVzZXJzIHdpdGggb3B0aW1pemVkIHF1ZXJ5IHN0cnVjdHVyZS5cbiAgICogQHBhcmFtIG9wdGlvbnNcbiAgICogQHBhcmFtIF9vcHRpb25zXG4gICAqL1xuICBhc3luYyBnZXRQYWdpbmF0ZWRVc2Vycyhfb3B0aW9uczogUGFnaW5hdGlvbk9wdGlvbnMpOiBQcm9taXNlPHsgdXNlcnM6IFVzZXJbXTsgdG90YWw6IG51bWJlciB9PiB7XG4gICAgUGFnaW5hdGlvbkhlbHBlci52YWxpZGF0ZVBhZ2luYXRpb24oX29wdGlvbnMpO1xuXG4gICAgY29uc3QgY2FjaGVLZXkgPSBgcGFnaW5hdGVkX3VzZXJzOiR7X29wdGlvbnMucGFnZX06JHtfb3B0aW9ucy5wYWdlU2l6ZX06JHtfb3B0aW9ucy5zb3J0Qnl9OiR7X29wdGlvbnMuc29ydERpcmVjdGlvbn1gO1xuXG4gICAgLy8gVHJ5IGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gcXVlcnlDYWNoZS5nZXQ8eyB1c2VyczogVXNlcltdOyB0b3RhbDogbnVtYmVyIH0+KCd1c2VycycsIGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4gY2FjaGVkO1xuICAgIH1cblxuICAgIC8vIEdldCB0b3RhbCBjb3VudCB1c2luZyBjb3ZlcmluZyBpbmRleFxuICAgIGNvbnN0IFt7IGNvdW50OiB0b3RhbCB9XSA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KHsgY291bnQ6IGNvdW50KCkgfSlcbiAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKTtcblxuICAgIC8vIEdldCBwYWdpbmF0ZWQgcmVzdWx0cyB3aXRoIExJTUlUIGFuZCBvcHRpbWl6ZWQgT1JERVIgQllcbiAgICBjb25zdCB1c2VycyA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgLm9yZGVyQnkoXG4gICAgICAgIF9vcHRpb25zLnNvcnREaXJlY3Rpb24gPT09ICdERVNDJyA/IGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkgOiBzY2hlbWEudXNlcnMuY3JlYXRlZEF0XG4gICAgICApXG4gICAgICAubGltaXQoX29wdGlvbnMucGFnZVNpemUpXG4gICAgICAub2Zmc2V0KChfb3B0aW9ucy5wYWdlIC0gMSkgKiBfb3B0aW9ucy5wYWdlU2l6ZSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSB7IHVzZXJzLCB0b3RhbCB9O1xuICAgIHF1ZXJ5Q2FjaGUuc2V0KCd1c2VycycsIGNhY2hlS2V5LCByZXN1bHQpO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGJ1aWxkaW5ncyB3aXRoIHJlc2lkZW50cyB1c2luZyBFWElTVFMgaW5zdGVhZCBvZiBJTiBzdWJxdWVyeS5cbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqIEBwYXJhbSBsaW1pdFxuICAgKi9cbiAgYXN5bmMgZ2V0QnVpbGRpbmdzV2l0aFJlc2lkZW50cyhvcmdhbml6YXRpb25JZDogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gNTApOiBQcm9taXNlPEJ1aWxkaW5nW10+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBidWlsZGluZ3Nfd2l0aF9yZXNpZGVudHM6JHtvcmdhbml6YXRpb25JZH06JHtsaW1pdH1gO1xuXG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QnVpbGRpbmdzV2l0aFJlc2lkZW50cycsXG4gICAgICBjYWNoZUtleSxcbiAgICAgICdidWlsZGluZ3MnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgZXhpc3RzKFxuICAgICAgICAgICAgICAgIGRiXG4gICAgICAgICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKVxuICAgICAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCksXG4gICAgICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAubGltaXQobGltaXQpIC8vIEFsd2F5cyB1c2UgTElNSVQgZm9yIGxhcmdlIHJlc3VsdCBzZXRzXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZWFyY2hlcyB1c2VycyB3aXRoIG9wdGltaXplZCBjb3ZlcmluZyBpbmRleCBhbmQgTElNSVQuXG4gICAqIEBwYXJhbSBxdWVyeVxuICAgKiBAcGFyYW0gbGltaXRcbiAgICovXG4gIGFzeW5jIHNlYXJjaFVzZXJzKHF1ZXJ5OiBzdHJpbmcsIGxpbWl0OiBudW1iZXIgPSAyMCk6IFByb21pc2U8VXNlcltdPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgc2VhcmNoX3VzZXJzOiR7cXVlcnl9OiR7bGltaXR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdzZWFyY2hVc2VycycsIGNhY2hlS2V5LCAndXNlcnMnLCAoKSA9PlxuICAgICAgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICBvcihcbiAgICAgICAgICAgICAgbGlrZShzY2hlbWEudXNlcnMuZW1haWwsIGAlJHtxdWVyeX0lYCksXG4gICAgICAgICAgICAgIGxpa2Uoc2NoZW1hLnVzZXJzLmZpcnN0TmFtZSwgYCUke3F1ZXJ5fSVgKSxcbiAgICAgICAgICAgICAgbGlrZShzY2hlbWEudXNlcnMubGFzdE5hbWUsIGAlJHtxdWVyeX0lYClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLmxpbWl0KGxpbWl0KSAvLyBBbHdheXMgbGltaXQgc2VhcmNoIHJlc3VsdHNcbiAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnVzZXJzLmxhc3ROYW1lLCBzY2hlbWEudXNlcnMuZmlyc3ROYW1lKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBmaW5hbmNpYWwgc3VtbWFyeSB1c2luZyBtYXRlcmlhbGl6ZWQgdmlldyBmb3IgY29tcGxleCBhZ2dyZWdhdGlvbnMuXG4gICAqIEBwYXJhbSBidWlsZGluZ0lkXG4gICAqL1xuICBhc3luYyBnZXRGaW5hbmNpYWxTdW1tYXJ5KGJ1aWxkaW5nSWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBmaW5hbmNpYWxfc3VtbWFyeToke2J1aWxkaW5nSWR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRGaW5hbmNpYWxTdW1tYXJ5JywgY2FjaGVLZXksICdmaW5hbmNpYWwnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2UgbWF0ZXJpYWxpemVkIHZpZXcgZm9yIGNvbXBsZXggYWdncmVnYXRpb25zXG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZGIuZXhlY3V0ZShcbiAgICAgICAgc3FsT3BgU0VMRUNUICogRlJPTSBtdl9maW5hbmNpYWxfc3VtbWFyeSBXSEVSRSBidWlsZGluZ19pZCA9ICR7YnVpbGRpbmdJZH0gT1JERVIgQlkgbW9udGggREVTQyBMSU1JVCAxMmBcbiAgICAgICk7XG4gICAgICByZXR1cm4gc3VtbWFyeS5yb3dzO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYnVpbGRpbmcgc3RhdGlzdGljcyB1c2luZyBtYXRlcmlhbGl6ZWQgdmlldy5cbiAgICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5nU3RhdHMoYnVpbGRpbmdJZDogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBidWlsZGluZ19zdGF0czoke2J1aWxkaW5nSWR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRCdWlsZGluZ1N0YXRzJywgY2FjaGVLZXksICdidWlsZGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBVc2UgbWF0ZXJpYWxpemVkIHZpZXcgZm9yIGRhc2hib2FyZCBzdGF0aXN0aWNzXG4gICAgICBjb25zdCBzdGF0cyA9IGF3YWl0IGRiLmV4ZWN1dGUoXG4gICAgICAgIHNxbE9wYFNFTEVDVCAqIEZST00gbXZfYnVpbGRpbmdfc3RhdHMgV0hFUkUgYnVpbGRpbmdfaWQgPSAke2J1aWxkaW5nSWR9YFxuICAgICAgKTtcbiAgICAgIHJldHVybiBzdGF0cy5yb3dzWzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIHNwZWNpZmljIHVzZXIgYnkgSUQgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldFVzZXIoaWQ6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRVc2VyJywgYHVzZXI6JHtpZH1gLCAndXNlcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnVzZXJzKS53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIGlkKSk7XG4gICAgICBcbiAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+UjSBTdG9yYWdlLmdldFVzZXI6IEZvdW5kIHVzZXI6YCwge1xuICAgICAgICAgIGlkOiByZXN1bHRbMF0uaWQsXG4gICAgICAgICAgZW1haWw6IHJlc3VsdFswXS5lbWFpbCxcbiAgICAgICAgICByb2xlOiByZXN1bHRbMF0ucm9sZSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBcbiAgICAgIH1cbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGEgdXNlciBieSBlbWFpbCB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBlbWFpbFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRVc2VyQnlFbWFpbCcsIGB1c2VyX2VtYWlsOiR7ZW1haWx9YCwgJ3VzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5lbWFpbCwgZW1haWwpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyB1c2VyIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaW5zZXJ0VXNlclxuICAgKi9cbiAgYXN5bmMgY3JlYXRlVXNlcihpbnNlcnRVc2VyOiBJbnNlcnRVc2VyKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlVXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEF1dG9tYXRpY2FsbHkgc2V0IGRlbW8gcGFzc3dvcmQgZm9yIGRlbW8gcm9sZSB1c2Vyc1xuICAgICAgbGV0IHBhc3N3b3JkID0gaW5zZXJ0VXNlci5wYXNzd29yZDtcbiAgICAgIGNvbnN0IGlzRGVtb1JvbGUgPSBbJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J10uaW5jbHVkZXMoaW5zZXJ0VXNlci5yb2xlKTtcbiAgICAgIFxuICAgICAgaWYgKGlzRGVtb1JvbGUpIHtcbiAgICAgICAgLy8gQWx3YXlzIHNldCB0aGUgc3RhbmRhcmQgZGVtbyBwYXNzd29yZCBoYXNoIGZvciBkZW1vIHVzZXJzLCByZWdhcmRsZXNzIG9mIHByb3ZpZGVkIHBhc3N3b3JkXG4gICAgICAgIHBhc3N3b3JkID0gJyQyYiQxMiRjT2MvUWpNanpsaHFBUXFGMmIvTVRPWnIyUUF0RVJiWEpHZDRPU2ExQ1hNbEYwNEZDM0YwMic7IC8vIGRlbW8xMjM0NTZcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfjq0gU2V0dGluZyBkZW1vIHBhc3N3b3JkIGZvciB1c2VyIHdpdGggcm9sZTonLCBpbnNlcnRVc2VyLnJvbGUpO1xuICAgICAgfVxuXG4gICAgICAvLyBGaWx0ZXIgb25seSB0aGUgZmllbGRzIHRoYXQgZXhpc3QgaW4gdGhlIGRhdGFiYXNlIHNjaGVtYVxuICAgICAgY29uc3QgdXNlckRhdGEgPSB7XG4gICAgICAgIHVzZXJuYW1lOiBpbnNlcnRVc2VyLnVzZXJuYW1lLFxuICAgICAgICBlbWFpbDogaW5zZXJ0VXNlci5lbWFpbCxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIGZpcnN0TmFtZTogaW5zZXJ0VXNlci5maXJzdE5hbWUsXG4gICAgICAgIGxhc3ROYW1lOiBpbnNlcnRVc2VyLmxhc3ROYW1lLFxuICAgICAgICBwaG9uZTogaW5zZXJ0VXNlci5waG9uZSB8fCAnJyxcbiAgICAgICAgcHJvZmlsZUltYWdlOiBpbnNlcnRVc2VyLnByb2ZpbGVJbWFnZSxcbiAgICAgICAgbGFuZ3VhZ2U6IGluc2VydFVzZXIubGFuZ3VhZ2UgfHwgJ2ZyJyxcbiAgICAgICAgcm9sZTogaW5zZXJ0VXNlci5yb2xlLFxuICAgICAgICBpc0FjdGl2ZTogdHJ1ZSwgLy8gRGVmYXVsdCB2YWx1ZSBmb3IgbmV3IHVzZXJzXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBDcmVhdGluZyB1c2VyIHdpdGggZGF0YTonLCB7XG4gICAgICAgIHVzZXJuYW1lOiB1c2VyRGF0YS51c2VybmFtZSxcbiAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6IHVzZXJEYXRhLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXJEYXRhLmxhc3ROYW1lLFxuICAgICAgICByb2xlOiB1c2VyRGF0YS5yb2xlLFxuICAgICAgICBsYW5ndWFnZTogdXNlckRhdGEubGFuZ3VhZ2UsXG4gICAgICAgIGhhc1Bhc3N3b3JkOiAhIXVzZXJEYXRhLnBhc3N3b3JkLFxuICAgICAgfSk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGluc2VydGVkID0gYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS51c2VycykudmFsdWVzKFt1c2VyRGF0YV0pLnJldHVybmluZygpO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIGluc2VydGVkO1xuICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY3JlYXRpbmcgdXNlcjonLCBlcnJvcik7XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlc1xuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVVzZXJDYWNoZXMoJyonKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBhIHVzZXIgd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlVXNlcihpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPFVzZXI+KTogUHJvbWlzZTxVc2VyIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlVXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS51c2VycylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgc3BlY2lmaWMgdXNlciBjYWNoZXNcbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVVc2VyQ2FjaGVzKGlkKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIG9yZ2FuaXphdGlvbnMgZm9yIGEgc3BlY2lmaWMgdXNlci5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlck9yZ2FuaXphdGlvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PHsgb3JnYW5pemF0aW9uSWQ6IHN0cmluZyB9Pj4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFVzZXJPcmdhbml6YXRpb25zJyxcbiAgICAgIGB1c2VyX29yZ3M6JHt1c2VySWR9YCxcbiAgICAgICd1c2VycycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcmVzaWRlbmNlcyBmb3IgYSBzcGVjaWZpYyB1c2VyLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXRVc2VyUmVzaWRlbmNlcyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8eyByZXNpZGVuY2VJZDogc3RyaW5nIH0+PiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlclJlc2lkZW5jZXMnLFxuICAgICAgYHVzZXJfcmVzaWRlbmNlczoke3VzZXJJZH1gLFxuICAgICAgJ3Jlc2lkZW5jZXMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgcmVzaWRlbmNlSWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy5yZXNpZGVuY2VJZCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlcklkKSwgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICApO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvLyBPcmdhbml6YXRpb24gb3BlcmF0aW9ucyB3aXRoIG9wdGltaXphdGlvblxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYWxsIGFjdGl2ZSBvcmdhbml6YXRpb25zIHdpdGggY2FjaGluZy5cbiAgICovXG4gIGFzeW5jIGdldE9yZ2FuaXphdGlvbnMoKTogUHJvbWlzZTxPcmdhbml6YXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRPcmdhbml6YXRpb25zJywgJ2FsbF9vcmdhbml6YXRpb25zJywgJ29yZ2FuaXphdGlvbnMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucykud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGFuIG9yZ2FuaXphdGlvbiBieSBJRCB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0T3JnYW5pemF0aW9uKGlkOiBzdHJpbmcpOiBQcm9taXNlPE9yZ2FuaXphdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldE9yZ2FuaXphdGlvbicsXG4gICAgICBgb3JnYW5pemF0aW9uOiR7aWR9YCxcbiAgICAgICdvcmdhbml6YXRpb25zJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsIGlkKSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IG9yZ2FuaXphdGlvbiB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGluc2VydE9yZ2FuaXphdGlvblxuICAgKi9cbiAgYXN5bmMgY3JlYXRlT3JnYW5pemF0aW9uKGluc2VydE9yZ2FuaXphdGlvbjogSW5zZXJ0T3JnYW5pemF0aW9uKTogUHJvbWlzZTxPcmdhbml6YXRpb24+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVPcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5vcmdhbml6YXRpb25zKS52YWx1ZXMoaW5zZXJ0T3JnYW5pemF0aW9uKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgb3JnYW5pemF0aW9uIGNhY2hlc1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnb3JnYW5pemF0aW9ucycpO1xuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIEJ1aWxkaW5nIG9wZXJhdGlvbnMgd2l0aCBvcHRpbWl6YXRpb25cblxuICAvKipcbiAgICogUmV0cmlldmVzIGJ1aWxkaW5ncyBieSBvcmdhbml6YXRpb24gd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5nc0J5T3JnYW5pemF0aW9uKG9yZ2FuaXphdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPEJ1aWxkaW5nW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRCdWlsZGluZ3NCeU9yZ2FuaXphdGlvbicsXG4gICAgICBgb3JnX2J1aWxkaW5nczoke29yZ2FuaXphdGlvbklkfWAsXG4gICAgICAnYnVpbGRpbmdzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSBidWlsZGluZyBieSBJRCB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0QnVpbGRpbmcoaWQ6IHN0cmluZyk6IFByb21pc2U8QnVpbGRpbmcgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0QnVpbGRpbmcnLCBgYnVpbGRpbmc6JHtpZH1gLCAnYnVpbGRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVpbGRpbmdzKS53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IGJ1aWxkaW5nIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaW5zZXJ0QnVpbGRpbmdcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUJ1aWxkaW5nKGluc2VydEJ1aWxkaW5nOiBJbnNlcnRCdWlsZGluZyk6IFByb21pc2U8QnVpbGRpbmc+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVCdWlsZGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmJ1aWxkaW5ncykudmFsdWVzKFtpbnNlcnRCdWlsZGluZ10pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBidWlsZGluZyBjYWNoZXNcbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVCdWlsZGluZ0NhY2hlcygnKicpO1xuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIFJlc2lkZW5jZSBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyByZXNpZGVuY2VzIGJ5IGJ1aWxkaW5nIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAgICovXG4gIGFzeW5jIGdldFJlc2lkZW5jZXNCeUJ1aWxkaW5nKGJ1aWxkaW5nSWQ6IHN0cmluZyk6IFByb21pc2U8UmVzaWRlbmNlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRSZXNpZGVuY2VzQnlCdWlsZGluZycsXG4gICAgICBgYnVpbGRpbmdfcmVzaWRlbmNlczoke2J1aWxkaW5nSWR9YCxcbiAgICAgICdyZXNpZGVuY2VzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIGJ1aWxkaW5nSWQpLCBlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vcmRlckJ5KHNjaGVtYS5yZXNpZGVuY2VzLnVuaXROdW1iZXIpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSByZXNpZGVuY2UgYnkgSUQgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldFJlc2lkZW5jZShpZDogc3RyaW5nKTogUHJvbWlzZTxSZXNpZGVuY2UgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0UmVzaWRlbmNlJywgYHJlc2lkZW5jZToke2lkfWAsICdyZXNpZGVuY2VzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEucmVzaWRlbmNlcykud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIGlkKSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgcmVzaWRlbmNlIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaW5zZXJ0UmVzaWRlbmNlXG4gICAqL1xuICBhc3luYyBjcmVhdGVSZXNpZGVuY2UoaW5zZXJ0UmVzaWRlbmNlOiBJbnNlcnRSZXNpZGVuY2UpOiBQcm9taXNlPFJlc2lkZW5jZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZVJlc2lkZW5jZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLnJlc2lkZW5jZXMpLnZhbHVlcyhbaW5zZXJ0UmVzaWRlbmNlXSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIHJlc2lkZW5jZSBjYWNoZXNcbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVSZXNpZGVuY2VDYWNoZXMoJyonKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBBZGRpdGlvbmFsIG9wdGltaXplZCBtZXRob2RzIGZvciBmcmVxdWVudGx5IGFjY2Vzc2VkIGRhdGFcblxuICAvKipcbiAgICogR2V0cyB1c2VyIHJlc2lkZW5jZXMgd2l0aCBmdWxsIGRldGFpbHMgLSBmb3IgY29tcGxleCByZXNpZGVuY2Ugdmlld3MuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldFVzZXJSZXNpZGVuY2VzV2l0aERldGFpbHModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlclJlc2lkZW5jZXNXaXRoRGV0YWlscycsXG4gICAgICBgdXNlcl9yZXNpZGVuY2VzX2RldGFpbHM6JHt1c2VySWR9YCxcbiAgICAgICdyZXNpZGVuY2VzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICByZXNpZGVuY2U6IHNjaGVtYS5yZXNpZGVuY2VzLFxuICAgICAgICAgICAgYnVpbGRpbmc6IHNjaGVtYS5idWlsZGluZ3MsXG4gICAgICAgICAgICB1c2VyUmVzaWRlbmNlOiBzY2hlbWEudXNlclJlc2lkZW5jZXMsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLmlubmVySm9pbihzY2hlbWEucmVzaWRlbmNlcywgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCBzY2hlbWEucmVzaWRlbmNlcy5pZCkpXG4gICAgICAgICAgLmlubmVySm9pbihzY2hlbWEuYnVpbGRpbmdzLCBlcShzY2hlbWEucmVzaWRlbmNlcy5idWlsZGluZ0lkLCBzY2hlbWEuYnVpbGRpbmdzLmlkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnVzZXJJZCwgdXNlcklkKSwgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFjdGl2ZSBiaWxscyBmb3IgYSByZXNpZGVuY2UgLSBmcmVxdWVudGx5IHF1ZXJpZWQuXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZFxuICAgKi9cbiAgYXN5bmMgZ2V0QWN0aXZlQmlsbHNCeVJlc2lkZW5jZShyZXNpZGVuY2VJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEFjdGl2ZUJpbGxzQnlSZXNpZGVuY2UnLFxuICAgICAgYHJlc2lkZW5jZV9iaWxsczoke3Jlc2lkZW5jZUlkfWAsXG4gICAgICAnYmlsbHMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYmlsbHMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYmlsbHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkKSxcbiAgICAgICAgICAgICAgb3IoZXEoc2NoZW1hLmJpbGxzLnN0YXR1cywgJ3NlbnQnKSwgZXEoc2NoZW1hLmJpbGxzLnN0YXR1cywgJ292ZXJkdWUnKSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuYmlsbHMuZHVlRGF0ZSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIG1haW50ZW5hbmNlIHJlcXVlc3RzIGZvciBhIHJlc2lkZW5jZSAtIGZyZXF1ZW50bHkgYWNjZXNzZWQuXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZFxuICAgKi9cbiAgYXN5bmMgZ2V0TWFpbnRlbmFuY2VSZXF1ZXN0c0J5UmVzaWRlbmNlKHJlc2lkZW5jZUlkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0TWFpbnRlbmFuY2VSZXF1ZXN0c0J5UmVzaWRlbmNlJyxcbiAgICAgIGByZXNpZGVuY2VfbWFpbnRlbmFuY2U6JHtyZXNpZGVuY2VJZH1gLFxuICAgICAgJ21haW50ZW5hbmNlJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzLnJlc2lkZW5jZUlkLCByZXNpZGVuY2VJZCkpXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cy5jcmVhdGVkQXQpKVxuICAgICk7XG4gIH1cblxuICAvLyBNaXNzaW5nIE9yZ2FuaXphdGlvbiBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgb3JnYW5pemF0aW9uIGJ5IG5hbWUgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gbmFtZVxuICAgKi9cbiAgYXN5bmMgZ2V0T3JnYW5pemF0aW9uQnlOYW1lKG5hbWU6IHN0cmluZyk6IFByb21pc2U8T3JnYW5pemF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0T3JnYW5pemF0aW9uQnlOYW1lJyxcbiAgICAgIGBvcmdfbmFtZToke25hbWV9YCxcbiAgICAgICdvcmdhbml6YXRpb25zJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSwgbmFtZSkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBvcmdhbml6YXRpb24gd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlT3JnYW5pemF0aW9uKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxPcmdhbml6YXRpb24+XG4gICk6IFByb21pc2U8T3JnYW5pemF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlT3JnYW5pemF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLm9yZ2FuaXphdGlvbnMpXG4gICAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5vcmdhbml6YXRpb25zLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVVzZXJDYWNoZXMoJyonKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gTWlzc2luZyBCdWlsZGluZyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGJ1aWxkaW5ncyB3aXRoIGNhY2hpbmcuXG4gICAqL1xuICBhc3luYyBnZXRCdWlsZGluZ3MoKTogUHJvbWlzZTxCdWlsZGluZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldEJ1aWxkaW5ncycsICdhbGxfYnVpbGRpbmdzJywgJ2J1aWxkaW5ncycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5idWlsZGluZ3MpLndoZXJlKGVxKHNjaGVtYS5idWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBidWlsZGluZyB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVCdWlsZGluZyhpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPEJ1aWxkaW5nPik6IFByb21pc2U8QnVpbGRpbmcgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVCdWlsZGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWlsZGluZ3MuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlQnVpbGRpbmdDYWNoZXMoaWQpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBidWlsZGluZyAoc29mdCBkZWxldGUpLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUJ1aWxkaW5nKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdkZWxldGVCdWlsZGluZycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5idWlsZGluZ3MpXG4gICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1aWxkaW5ncy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVCdWlsZGluZ0NhY2hlcyhpZCk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gTWlzc2luZyBSZXNpZGVuY2Ugb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCByZXNpZGVuY2VzIHdpdGggY2FjaGluZy5cbiAgICovXG4gIGFzeW5jIGdldFJlc2lkZW5jZXMoKTogUHJvbWlzZTxSZXNpZGVuY2VbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRSZXNpZGVuY2VzJywgJ2FsbF9yZXNpZGVuY2VzJywgJ3Jlc2lkZW5jZXMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEucmVzaWRlbmNlcykud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyByZXNpZGVuY2Ugd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlUmVzaWRlbmNlKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8UmVzaWRlbmNlPik6IFByb21pc2U8UmVzaWRlbmNlIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlUmVzaWRlbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVJlc2lkZW5jZUNhY2hlcyhpZCk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIHJlc2lkZW5jZSAoc29mdCBkZWxldGUpLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZVJlc2lkZW5jZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlUmVzaWRlbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLnJlc2lkZW5jZXMpXG4gICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlUmVzaWRlbmNlQ2FjaGVzKGlkKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvLyBEZXZlbG9wbWVudCBQaWxsYXIgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBkZXZlbG9wbWVudCBwaWxsYXJzLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGlsbGFycygpOiBQcm9taXNlPERldmVsb3BtZW50UGlsbGFyW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0UGlsbGFycycsICdhbGxfcGlsbGFycycsICdwaWxsYXJzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZGV2ZWxvcG1lbnQgcGlsbGFyIGJ5IElELlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldFBpbGxhcihpZDogc3RyaW5nKTogUHJvbWlzZTxEZXZlbG9wbWVudFBpbGxhciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRQaWxsYXInLCBgcGlsbGFyOiR7aWR9YCwgJ3BpbGxhcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMuaWQsIGlkKSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgZGV2ZWxvcG1lbnQgcGlsbGFyLlxuICAgKiBAcGFyYW0gcGlsbGFyXG4gICAqL1xuICBhc3luYyBjcmVhdGVQaWxsYXIocGlsbGFyOiBJbnNlcnRQaWxsYXIpOiBQcm9taXNlPERldmVsb3BtZW50UGlsbGFyPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlUGlsbGFyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzKS52YWx1ZXMocGlsbGFyKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncGlsbGFycycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBkZXZlbG9wbWVudCBwaWxsYXIuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gcGlsbGFyXG4gICAqL1xuICBhc3luYyB1cGRhdGVQaWxsYXIoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwaWxsYXI6IFBhcnRpYWw8RGV2ZWxvcG1lbnRQaWxsYXI+XG4gICk6IFByb21pc2U8RGV2ZWxvcG1lbnRQaWxsYXIgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVQaWxsYXInLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzKVxuICAgICAgICAuc2V0KHsgLi4ucGlsbGFyLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdwaWxsYXJzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIFdvcmtzcGFjZSBTdGF0dXMgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCB3b3Jrc3BhY2Ugc3RhdHVzZXMuXG4gICAqL1xuICBhc3luYyBnZXRXb3Jrc3BhY2VTdGF0dXNlcygpOiBQcm9taXNlPFdvcmtzcGFjZVN0YXR1c1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0V29ya3NwYWNlU3RhdHVzZXMnLFxuICAgICAgJ2FsbF93b3Jrc3BhY2Vfc3RhdHVzZXMnLFxuICAgICAgJ3dvcmtzcGFjZV9zdGF0dXMnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEud29ya3NwYWNlU3RhdHVzKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB3b3Jrc3BhY2Ugc3RhdHVzIGJ5IGNvbXBvbmVudC5cbiAgICogQHBhcmFtIGNvbXBvbmVudFxuICAgKi9cbiAgYXN5bmMgZ2V0V29ya3NwYWNlU3RhdHVzKGNvbXBvbmVudDogc3RyaW5nKTogUHJvbWlzZTxXb3Jrc3BhY2VTdGF0dXMgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRXb3Jrc3BhY2VTdGF0dXMnLFxuICAgICAgYHdvcmtzcGFjZV9zdGF0dXM6JHtjb21wb25lbnR9YCxcbiAgICAgICd3b3Jrc3BhY2Vfc3RhdHVzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEud29ya3NwYWNlU3RhdHVzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEud29ya3NwYWNlU3RhdHVzLmNvbXBvbmVudCwgY29tcG9uZW50KSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHdvcmtzcGFjZSBzdGF0dXMuXG4gICAqIEBwYXJhbSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVdvcmtzcGFjZVN0YXR1cyhzdGF0dXM6IEluc2VydFdvcmtzcGFjZVN0YXR1cyk6IFByb21pc2U8V29ya3NwYWNlU3RhdHVzPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlV29ya3NwYWNlU3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEud29ya3NwYWNlU3RhdHVzKS52YWx1ZXMoc3RhdHVzKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnd29ya3NwYWNlX3N0YXR1cycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB3b3Jrc3BhY2Ugc3RhdHVzLlxuICAgKiBAcGFyYW0gY29tcG9uZW50XG4gICAqIEBwYXJhbSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVdvcmtzcGFjZVN0YXR1cyhcbiAgICBjb21wb25lbnQ6IHN0cmluZyxcbiAgICBzdGF0dXM6IHN0cmluZ1xuICApOiBQcm9taXNlPFdvcmtzcGFjZVN0YXR1cyB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZVdvcmtzcGFjZVN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMpXG4gICAgICAgIC5zZXQoeyBzdGF0dXMgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMuY29tcG9uZW50LCBjb21wb25lbnQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3dvcmtzcGFjZV9zdGF0dXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gUXVhbGl0eSBNZXRyaWNzIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgcXVhbGl0eSBtZXRyaWNzLlxuICAgKi9cbiAgYXN5bmMgZ2V0UXVhbGl0eU1ldHJpY3MoKTogUHJvbWlzZTxRdWFsaXR5TWV0cmljW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRRdWFsaXR5TWV0cmljcycsXG4gICAgICAnYWxsX3F1YWxpdHlfbWV0cmljcycsXG4gICAgICAncXVhbGl0eV9tZXRyaWNzJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLnF1YWxpdHlNZXRyaWNzKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBxdWFsaXR5IG1ldHJpYy5cbiAgICogQHBhcmFtIG1ldHJpY1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlUXVhbGl0eU1ldHJpYyhtZXRyaWM6IEluc2VydFF1YWxpdHlNZXRyaWMpOiBQcm9taXNlPFF1YWxpdHlNZXRyaWM+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVRdWFsaXR5TWV0cmljJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEucXVhbGl0eU1ldHJpY3MpLnZhbHVlcyhtZXRyaWMpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdxdWFsaXR5X21ldHJpY3MnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gRnJhbWV3b3JrIENvbmZpZ3VyYXRpb24gb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBmcmFtZXdvcmsgY29uZmlndXJhdGlvbnMuXG4gICAqL1xuICBhc3luYyBnZXRGcmFtZXdvcmtDb25maWdzKCk6IFByb21pc2U8RnJhbWV3b3JrQ29uZmlndXJhdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RnJhbWV3b3JrQ29uZmlncycsXG4gICAgICAnYWxsX2ZyYW1ld29ya19jb25maWdzJyxcbiAgICAgICdmcmFtZXdvcmtfY29uZmlncycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5mcmFtZXdvcmtDb25maWd1cmF0aW9uKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBmcmFtZXdvcmsgY29uZmlnIGJ5IGtleS5cbiAgICogQHBhcmFtIGtleVxuICAgKiBAcGFyYW0gX2tleVxuICAgKi9cbiAgYXN5bmMgZ2V0RnJhbWV3b3JrQ29uZmlnKF9rZXk6IHN0cmluZyk6IFByb21pc2U8RnJhbWV3b3JrQ29uZmlndXJhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZyYW1ld29ya0NvbmZpZycsXG4gICAgICBgZnJhbWV3b3JrX2NvbmZpZzoke19rZXl9YCxcbiAgICAgICdmcmFtZXdvcmtfY29uZmlncycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmZyYW1ld29ya0NvbmZpZ3VyYXRpb24pXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mcmFtZXdvcmtDb25maWd1cmF0aW9uLl9rZXksIF9rZXkpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldHMgZnJhbWV3b3JrIGNvbmZpZ3VyYXRpb24uXG4gICAqIEBwYXJhbSBjb25maWdcbiAgICovXG4gIGFzeW5jIHNldEZyYW1ld29ya0NvbmZpZyhjb25maWc6IEluc2VydEZyYW1ld29ya0NvbmZpZ3VyYXRpb24pOiBQcm9taXNlPEZyYW1ld29ya0NvbmZpZ3VyYXRpb24+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdzZXRGcmFtZXdvcmtDb25maWcnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuZnJhbWV3b3JrQ29uZmlndXJhdGlvbilcbiAgICAgICAgLnZhbHVlcyhjb25maWcpXG4gICAgICAgIC5vbkNvbmZsaWN0RG9VcGRhdGUoe1xuICAgICAgICAgIHRhcmdldDogc2NoZW1hLmZyYW1ld29ya0NvbmZpZ3VyYXRpb24uX2tleSxcbiAgICAgICAgICBzZXQ6IHsgX3ZhbHVlOiBjb25maWcuX3ZhbHVlLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmcmFtZXdvcmtfY29uZmlncycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBJbXByb3ZlbWVudCBTdWdnZXN0aW9ucyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGltcHJvdmVtZW50IHN1Z2dlc3Rpb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0SW1wcm92ZW1lbnRTdWdnZXN0aW9ucygpOiBQcm9taXNlPEltcHJvdmVtZW50U3VnZ2VzdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW1wcm92ZW1lbnRTdWdnZXN0aW9ucycsXG4gICAgICAnYWxsX2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyxcbiAgICAgICdpbXByb3ZlbWVudF9zdWdnZXN0aW9ucycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0b3AgaW1wcm92ZW1lbnQgc3VnZ2VzdGlvbnMuXG4gICAqIEBwYXJhbSBsaW1pdFxuICAgKi9cbiAgYXN5bmMgZ2V0VG9wSW1wcm92ZW1lbnRTdWdnZXN0aW9ucyhsaW1pdDogbnVtYmVyKTogUHJvbWlzZTxJbXByb3ZlbWVudFN1Z2dlc3Rpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFRvcEltcHJvdmVtZW50U3VnZ2VzdGlvbnMnLFxuICAgICAgYHRvcF9zdWdnZXN0aW9uczoke2xpbWl0fWAsXG4gICAgICAnaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucylcbiAgICAgICAgICAub3JkZXJCeShcbiAgICAgICAgICAgIGRlc2Moc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMucHJpb3JpdHkpLFxuICAgICAgICAgICAgZGVzYyhzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucy5jcmVhdGVkQXQpXG4gICAgICAgICAgKVxuICAgICAgICAgIC5saW1pdChsaW1pdClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgaW1wcm92ZW1lbnQgc3VnZ2VzdGlvbi5cbiAgICogQHBhcmFtIHN1Z2dlc3Rpb25cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUltcHJvdmVtZW50U3VnZ2VzdGlvbihcbiAgICBzdWdnZXN0aW9uOiBJbnNlcnRJbXByb3ZlbWVudFN1Z2dlc3Rpb25cbiAgKTogUHJvbWlzZTxJbXByb3ZlbWVudFN1Z2dlc3Rpb24+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KFxuICAgICAgJ2NyZWF0ZUltcHJvdmVtZW50U3VnZ2VzdGlvbicsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBkYlxuICAgICAgICAgIC5pbnNlcnQoc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMpXG4gICAgICAgICAgLnZhbHVlcyhbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIC4uLnN1Z2dlc3Rpb24sXG4gICAgICAgICAgICAgIGNhdGVnb3J5OiBzdWdnZXN0aW9uLmNhdGVnb3J5IGFzXG4gICAgICAgICAgICAgICAgfCAnQ29kZSBRdWFsaXR5J1xuICAgICAgICAgICAgICAgIHwgJ1NlY3VyaXR5J1xuICAgICAgICAgICAgICAgIHwgJ1Rlc3RpbmcnXG4gICAgICAgICAgICAgICAgfCAnRG9jdW1lbnRhdGlvbidcbiAgICAgICAgICAgICAgICB8ICdQZXJmb3JtYW5jZSdcbiAgICAgICAgICAgICAgICB8ICdDb250aW51b3VzIEltcHJvdmVtZW50J1xuICAgICAgICAgICAgICAgIHwgJ1JlcGxpdCBBSSBBZ2VudCBNb25pdG9yaW5nJ1xuICAgICAgICAgICAgICAgIHwgJ1JlcGxpdCBBcHAnLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdKVxuICAgICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbXByb3ZlbWVudF9zdWdnZXN0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXJzIG5ldyBzdWdnZXN0aW9ucy5cbiAgICovXG4gIGFzeW5jIGNsZWFyTmV3U3VnZ2VzdGlvbnMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY2xlYXJOZXdTdWdnZXN0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zKVxuICAgICAgICAuc2V0KHsgc3RhdHVzOiAnQWNrbm93bGVkZ2VkJyB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMuc3RhdHVzLCAnTmV3JykpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbXByb3ZlbWVudF9zdWdnZXN0aW9ucycpO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgc3VnZ2VzdGlvbiBzdGF0dXMuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gc3RhdHVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVTdWdnZXN0aW9uU3RhdHVzKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgc3RhdHVzOiAnTmV3JyB8ICdBY2tub3dsZWRnZWQnIHwgJ0RvbmUnXG4gICk6IFByb21pc2U8SW1wcm92ZW1lbnRTdWdnZXN0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlU3VnZ2VzdGlvblN0YXR1cycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zKVxuICAgICAgICAuc2V0KHsgc3RhdHVzIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIEZlYXR1cmVzIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgZmVhdHVyZXMuXG4gICAqL1xuICBhc3luYyBnZXRGZWF0dXJlcygpOiBQcm9taXNlPEZlYXR1cmVbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRGZWF0dXJlcycsICdhbGxfZmVhdHVyZXMnLCAnZmVhdHVyZXMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZmVhdHVyZXMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGZlYXR1cmVzIGJ5IHN0YXR1cy5cbiAgICogQHBhcmFtIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgZ2V0RmVhdHVyZXNCeVN0YXR1cyhcbiAgICBzdGF0dXM6ICdjb21wbGV0ZWQnIHwgJ2luLXByb2dyZXNzJyB8ICdwbGFubmVkJyB8ICdjYW5jZWxsZWQnIHwgJ3JlcXVlc3RlZCdcbiAgKTogUHJvbWlzZTxGZWF0dXJlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGZWF0dXJlc0J5U3RhdHVzJyxcbiAgICAgIGBmZWF0dXJlc19zdGF0dXM6JHtzdGF0dXN9YCxcbiAgICAgICdmZWF0dXJlcycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVzLnN0YXR1cywgc3RhdHVzIGFzIGFueSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGZlYXR1cmVzIGJ5IGNhdGVnb3J5LlxuICAgKiBAcGFyYW0gY2F0ZWdvcnlcbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVzQnlDYXRlZ29yeShjYXRlZ29yeTogc3RyaW5nKTogUHJvbWlzZTxGZWF0dXJlW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGZWF0dXJlc0J5Q2F0ZWdvcnknLFxuICAgICAgYGZlYXR1cmVzX2NhdGVnb3J5OiR7Y2F0ZWdvcnl9YCxcbiAgICAgICdmZWF0dXJlcycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVzLmNhdGVnb3J5LCBjYXRlZ29yeSBhcyBhbnkpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBwdWJsaWMgcm9hZG1hcCBmZWF0dXJlcy5cbiAgICovXG4gIGFzeW5jIGdldFB1YmxpY1JvYWRtYXBGZWF0dXJlcygpOiBQcm9taXNlPEZlYXR1cmVbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFB1YmxpY1JvYWRtYXBGZWF0dXJlcycsXG4gICAgICAncHVibGljX3JvYWRtYXBfZmVhdHVyZXMnLFxuICAgICAgJ2ZlYXR1cmVzJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmZlYXR1cmVzKS53aGVyZShlcShzY2hlbWEuZmVhdHVyZXMuaXNQdWJsaWNSb2FkbWFwLCB0cnVlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgZmVhdHVyZS5cbiAgICogQHBhcmFtIGZlYXR1cmVcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUZlYXR1cmUoZmVhdHVyZTogSW5zZXJ0RmVhdHVyZSk6IFByb21pc2U8RmVhdHVyZT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUZlYXR1cmUnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5mZWF0dXJlcykudmFsdWVzKFtmZWF0dXJlXSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGZlYXR1cmUuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlRmVhdHVyZShpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPEluc2VydEZlYXR1cmU+KTogUHJvbWlzZTxGZWF0dXJlIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlRmVhdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5mZWF0dXJlcylcbiAgICAgICAgLnNldCh1cGRhdGVzIGFzIGFueSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGZlYXR1cmUuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlRmVhdHVyZShpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlRmVhdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5kZWxldGUoc2NoZW1hLmZlYXR1cmVzKS53aGVyZShlcShzY2hlbWEuZmVhdHVyZXMuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVzJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gQWN0aW9uYWJsZSBJdGVtcyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWN0aW9uYWJsZSBpdGVtcyBieSBmZWF0dXJlLlxuICAgKiBAcGFyYW0gZmVhdHVyZUlkXG4gICAqL1xuICBhc3luYyBnZXRBY3Rpb25hYmxlSXRlbXNCeUZlYXR1cmUoZmVhdHVyZUlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGlvbmFibGVJdGVtW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRBY3Rpb25hYmxlSXRlbXNCeUZlYXR1cmUnLFxuICAgICAgYGFjdGlvbmFibGVfaXRlbXM6JHtmZWF0dXJlSWR9YCxcbiAgICAgICdhY3Rpb25hYmxlX2l0ZW1zJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmFjdGlvbmFibGVJdGVtcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmFjdGlvbmFibGVJdGVtcy5mZWF0dXJlSWQsIGZlYXR1cmVJZCkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFjdGlvbmFibGUgaXRlbSBieSBJRC5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRBY3Rpb25hYmxlSXRlbShpZDogc3RyaW5nKTogUHJvbWlzZTxBY3Rpb25hYmxlSXRlbSB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEFjdGlvbmFibGVJdGVtJyxcbiAgICAgIGBhY3Rpb25hYmxlX2l0ZW06JHtpZH1gLFxuICAgICAgJ2FjdGlvbmFibGVfaXRlbXMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMuaWQsIGlkKSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFjdGlvbmFibGUgaXRlbS5cbiAgICogQHBhcmFtIGl0ZW1cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUFjdGlvbmFibGVJdGVtKGl0ZW06IEluc2VydEFjdGlvbmFibGVJdGVtKTogUHJvbWlzZTxBY3Rpb25hYmxlSXRlbT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUFjdGlvbmFibGVJdGVtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKS52YWx1ZXMoW2l0ZW1dKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYWN0aW9uYWJsZV9pdGVtcycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBtdWx0aXBsZSBhY3Rpb25hYmxlIGl0ZW1zLlxuICAgKiBAcGFyYW0gaXRlbXNcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUFjdGlvbmFibGVJdGVtcyhpdGVtczogSW5zZXJ0QWN0aW9uYWJsZUl0ZW1bXSk6IFByb21pc2U8QWN0aW9uYWJsZUl0ZW1bXT4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUFjdGlvbmFibGVJdGVtcycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmFjdGlvbmFibGVJdGVtcykudmFsdWVzKGl0ZW1zKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYWN0aW9uYWJsZV9pdGVtcycpO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBhY3Rpb25hYmxlIGl0ZW0uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlQWN0aW9uYWJsZUl0ZW0oXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEFjdGlvbmFibGVJdGVtPlxuICApOiBQcm9taXNlPEFjdGlvbmFibGVJdGVtIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlQWN0aW9uYWJsZUl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKVxuICAgICAgICAuc2V0KHVwZGF0ZXMgYXMgYW55KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmFjdGlvbmFibGVJdGVtcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2FjdGlvbmFibGVfaXRlbXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgYWN0aW9uYWJsZSBpdGVtLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUFjdGlvbmFibGVJdGVtKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdkZWxldGVBY3Rpb25hYmxlSXRlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5kZWxldGUoc2NoZW1hLmFjdGlvbmFibGVJdGVtcykud2hlcmUoZXEoc2NoZW1hLmFjdGlvbmFibGVJdGVtcy5pZCwgaWQpKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYWN0aW9uYWJsZV9pdGVtcycpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGFjdGlvbmFibGUgaXRlbXMgYnkgZmVhdHVyZS5cbiAgICogQHBhcmFtIGZlYXR1cmVJZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQWN0aW9uYWJsZUl0ZW1zQnlGZWF0dXJlKGZlYXR1cmVJZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeShcbiAgICAgICdkZWxldGVBY3Rpb25hYmxlSXRlbXNCeUZlYXR1cmUnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gZGJcbiAgICAgICAgICAuZGVsZXRlKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMuZmVhdHVyZUlkLCBmZWF0dXJlSWQpKVxuICAgICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgIH1cbiAgICApO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdhY3Rpb25hYmxlX2l0ZW1zJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLy8gSW52aXRhdGlvbiBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGludml0YXRpb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbnMoKTogUHJvbWlzZTxJbnZpdGF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0SW52aXRhdGlvbnMnLCAnYWxsX2ludml0YXRpb25zJywgJ2ludml0YXRpb25zJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9uIGJ5IElELlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb24oaWQ6IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRJbnZpdGF0aW9uJywgYGludml0YXRpb246JHtpZH1gLCAnaW52aXRhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb24gYnkgdG9rZW4uXG4gICAqIEBwYXJhbSB0b2tlblxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbkJ5VG9rZW4odG9rZW46IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEludml0YXRpb25CeVRva2VuJyxcbiAgICAgIGBpbnZpdGF0aW9uX3Rva2VuOiR7dG9rZW59YCxcbiAgICAgICdpbnZpdGF0aW9ucycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMudG9rZW4sIHRva2VuKSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb25zIGJ5IGVtYWlsLlxuICAgKiBAcGFyYW0gZW1haWxcbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25zQnlFbWFpbChlbWFpbDogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbnZpdGF0aW9uc0J5RW1haWwnLFxuICAgICAgYGludml0YXRpb25zX2VtYWlsOiR7ZW1haWx9YCxcbiAgICAgICdpbnZpdGF0aW9ucycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmVtYWlsLCBlbWFpbCkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb25zIGJ5IGludml0ZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25zQnlJbnZpdGVyKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbnZpdGF0aW9uc0J5SW52aXRlcicsXG4gICAgICBgaW52aXRhdGlvbnNfaW52aXRlcjoke3VzZXJJZH1gLFxuICAgICAgJ2ludml0YXRpb25zJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaW52aXRlZEJ5VXNlcklkLCB1c2VySWQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9ucyBieSBzdGF0dXMuXG4gICAqIEBwYXJhbSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25zQnlTdGF0dXMoXG4gICAgc3RhdHVzOiAncGVuZGluZycgfCAnYWNjZXB0ZWQnIHwgJ2V4cGlyZWQnIHwgJ2NhbmNlbGxlZCdcbiAgKTogUHJvbWlzZTxJbnZpdGF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbnZpdGF0aW9uc0J5U3RhdHVzJyxcbiAgICAgIGBpbnZpdGF0aW9uc19zdGF0dXM6JHtzdGF0dXN9YCxcbiAgICAgICdpbnZpdGF0aW9ucycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLnN0YXR1cywgc3RhdHVzKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgaW52aXRhdGlvbi5cbiAgICogQHBhcmFtIGludml0YXRpb25cbiAgICovXG4gIGFzeW5jIGNyZWF0ZUludml0YXRpb24oaW52aXRhdGlvbjogSW5zZXJ0SW52aXRhdGlvbik6IFByb21pc2U8SW52aXRhdGlvbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5pbnZpdGF0aW9ucykudmFsdWVzKFtpbnZpdGF0aW9uXSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGludml0YXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlSW52aXRhdGlvbihcbiAgICBpZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IFBhcnRpYWw8SW52aXRhdGlvbj5cbiAgKTogUHJvbWlzZTxJbnZpdGF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlSW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnNldCh1cGRhdGVzIGFzIGFueSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBY2NlcHRzIGludml0YXRpb24uXG4gICAqIEBwYXJhbSB0b2tlblxuICAgKiBAcGFyYW0gdXNlckRhdGFcbiAgICogQHBhcmFtIHVzZXJEYXRhLmZpcnN0TmFtZVxuICAgKiBAcGFyYW0gaXBBZGRyZXNzXG4gICAqIEBwYXJhbSB1c2VyRGF0YS5sYXN0TmFtZVxuICAgKiBAcGFyYW0gdXNlckFnZW50XG4gICAqIEBwYXJhbSB1c2VyRGF0YS5wYXNzd29yZFxuICAgKi9cbiAgYXN5bmMgYWNjZXB0SW52aXRhdGlvbihcbiAgICB0b2tlbjogc3RyaW5nLFxuICAgIHVzZXJEYXRhOiB7IGZpcnN0TmFtZTogc3RyaW5nOyBsYXN0TmFtZTogc3RyaW5nOyBwYXNzd29yZDogc3RyaW5nIH0sXG4gICAgaXBBZGRyZXNzPzogc3RyaW5nLFxuICAgIHVzZXJBZ2VudD86IHN0cmluZ1xuICApOiBQcm9taXNlPHsgdXNlcjogVXNlcjsgaW52aXRhdGlvbjogSW52aXRhdGlvbiB9IHwgbnVsbD4ge1xuICAgIHJldHVybiBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdhY2NlcHRJbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgaW52aXRhdGlvbiA9IGF3YWl0IHRoaXMuZ2V0SW52aXRhdGlvbkJ5VG9rZW4odG9rZW4pO1xuICAgICAgaWYgKCFpbnZpdGF0aW9uIHx8IGludml0YXRpb24uc3RhdHVzICE9PSAncGVuZGluZycpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSB1c2VyIHdpdGggcmVxdWlyZWQgZmllbGRzXG4gICAgICBjb25zdCB1c2VyID0gYXdhaXQgdGhpcy5jcmVhdGVVc2VyKHtcbiAgICAgICAgdXNlcm5hbWU6IGludml0YXRpb24uZW1haWwuc3BsaXQoJ0AnKVswXSwgLy8gVXNlIGVtYWlsIHByZWZpeCBhcyB1c2VybmFtZVxuICAgICAgICBlbWFpbDogaW52aXRhdGlvbi5lbWFpbCxcbiAgICAgICAgZmlyc3ROYW1lOiB1c2VyRGF0YS5maXJzdE5hbWUsXG4gICAgICAgIGxhc3ROYW1lOiB1c2VyRGF0YS5sYXN0TmFtZSxcbiAgICAgICAgcGFzc3dvcmQ6IHVzZXJEYXRhLnBhc3N3b3JkLCAvLyBUaGlzIHNob3VsZCBiZSBoYXNoZWRcbiAgICAgICAgbGFuZ3VhZ2U6ICdlbicsIC8vIERlZmF1bHQgbGFuZ3VhZ2VcbiAgICAgICAgcm9sZTogaW52aXRhdGlvbi5yb2xlLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBpbnZpdGF0aW9uXG4gICAgICBjb25zdCB1cGRhdGVkSW52aXRhdGlvbiA9IGF3YWl0IHRoaXMudXBkYXRlSW52aXRhdGlvbihpbnZpdGF0aW9uLmlkLCB7XG4gICAgICAgIHN0YXR1czogJ2FjY2VwdGVkJyxcbiAgICAgICAgYWNjZXB0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4geyB1c2VyLCBpbnZpdGF0aW9uOiB1cGRhdGVkSW52aXRhdGlvbiEgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYW5jZWxzIGludml0YXRpb24uXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gY2FuY2VsbGVkQnlcbiAgICovXG4gIGFzeW5jIGNhbmNlbEludml0YXRpb24oaWQ6IHN0cmluZywgY2FuY2VsbGVkQnk6IHN0cmluZyk6IFByb21pc2U8SW52aXRhdGlvbiB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NhbmNlbEludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIHN0YXR1czogJ2NhbmNlbGxlZCcsXG4gICAgICAgICAgY2FuY2VsbGVkQnksXG4gICAgICAgICAgY2FuY2VsbGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cGlyZXMgb2xkIGludml0YXRpb25zLlxuICAgKi9cbiAgYXN5bmMgZXhwaXJlSW52aXRhdGlvbnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdleHBpcmVJbnZpdGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnNldCh7IHN0YXR1czogJ2V4cGlyZWQnLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5zdGF0dXMsICdwZW5kaW5nJyksXG4gICAgICAgICAgICBsdGUoc2NoZW1hLmludml0YXRpb25zLmV4cGlyZXNBdCwgbmV3IERhdGUoKSlcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgaW52aXRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBkZWxldGVJbnZpdGF0aW9uKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdkZWxldGVJbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmRlbGV0ZShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pZCwgaWQpKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvLyBJbnZpdGF0aW9uIEF1ZGl0IExvZyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbiBhdWRpdCBsb2dzLlxuICAgKiBAcGFyYW0gaW52aXRhdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uQXVkaXRMb2dzKGludml0YXRpb25JZDogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uQXVkaXRMb2dbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEludml0YXRpb25BdWRpdExvZ3MnLFxuICAgICAgYGludml0YXRpb25fbG9nczoke2ludml0YXRpb25JZH1gLFxuICAgICAgJ2ludml0YXRpb25fbG9ncycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbnZpdGF0aW9uQXVkaXRMb2cpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9uQXVkaXRMb2cuaW52aXRhdGlvbklkLCBpbnZpdGF0aW9uSWQpKVxuICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLmludml0YXRpb25BdWRpdExvZy5jcmVhdGVkQXQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBpbnZpdGF0aW9uIGF1ZGl0IGxvZy5cbiAgICogQHBhcmFtIGxvZ0VudHJ5XG4gICAqL1xuICBhc3luYyBjcmVhdGVJbnZpdGF0aW9uQXVkaXRMb2cobG9nRW50cnk6IEluc2VydEludml0YXRpb25BdWRpdExvZyk6IFByb21pc2U8SW52aXRhdGlvbkF1ZGl0TG9nPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlSW52aXRhdGlvbkF1ZGl0TG9nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuaW52aXRhdGlvbkF1ZGl0TG9nKS52YWx1ZXMobG9nRW50cnkpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9uX2xvZ3MnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gUGVybWlzc2lvbiBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0UGVybWlzc2lvbnMoKTogUHJvbWlzZTxQZXJtaXNzaW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0UGVybWlzc2lvbnMnLCAncGVybWlzc2lvbnM6YWxsJywgJ3Blcm1pc3Npb25zJywgKCkgPT5cbiAgICAgIGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEucGVybWlzc2lvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEucGVybWlzc2lvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAub3JkZXJCeShzY2hlbWEucGVybWlzc2lvbnMucmVzb3VyY2VUeXBlLCBzY2hlbWEucGVybWlzc2lvbnMuYWN0aW9uKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbGwgcm9sZSBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFJvbGVQZXJtaXNzaW9ucygpOiBQcm9taXNlPFJvbGVQZXJtaXNzaW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRSb2xlUGVybWlzc2lvbnMnLFxuICAgICAgJ3JvbGVfcGVybWlzc2lvbnM6YWxsJyxcbiAgICAgICdyb2xlX3Blcm1pc3Npb25zJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnJvbGVQZXJtaXNzaW9ucylcbiAgICAgICAgICAuaW5uZXJKb2luKFxuICAgICAgICAgICAgc2NoZW1hLnBlcm1pc3Npb25zLFxuICAgICAgICAgICAgZXEoc2NoZW1hLnJvbGVQZXJtaXNzaW9ucy5wZXJtaXNzaW9uSWQsIHNjaGVtYS5wZXJtaXNzaW9ucy5pZClcbiAgICAgICAgICApXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5wZXJtaXNzaW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnJvbGVQZXJtaXNzaW9ucy5yb2xlLCBzY2hlbWEucGVybWlzc2lvbnMucmVzb3VyY2VUeXBlKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhbGwgdXNlciBwZXJtaXNzaW9ucy5cbiAgICovXG4gIGFzeW5jIGdldFVzZXJQZXJtaXNzaW9ucygpOiBQcm9taXNlPFVzZXJQZXJtaXNzaW9uW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlclBlcm1pc3Npb25zKVxuICAgICAgICAuaW5uZXJKb2luKFxuICAgICAgICAgIHNjaGVtYS5wZXJtaXNzaW9ucyxcbiAgICAgICAgICBlcShzY2hlbWEudXNlclBlcm1pc3Npb25zLnBlcm1pc3Npb25JZCwgc2NoZW1hLnBlcm1pc3Npb25zLmlkKVxuICAgICAgICApXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEucGVybWlzc2lvbnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAub3JkZXJCeShzY2hlbWEudXNlclBlcm1pc3Npb25zLnVzZXJJZCk7XG5cbiAgICAgIHJldHVybiByZXN1bHRzIHx8IFtdO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXIgcGVybWlzc2lvbnM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8vIE9sZCBidWlsZGluZyBkb2N1bWVudCBtZXRob2RzIHJlbW92ZWQgLSB1c2luZyB1bmlmaWVkIGRvY3VtZW50cyB0YWJsZVxuXG4gIC8vIFVuaWZpZWQgRG9jdW1lbnQgb3BlcmF0aW9uc1xuICBhc3luYyBnZXREb2N1bWVudHMoZmlsdGVycz86IHtcbiAgICBidWlsZGluZ0lkPzogc3RyaW5nO1xuICAgIHJlc2lkZW5jZUlkPzogc3RyaW5nO1xuICAgIGRvY3VtZW50VHlwZT86IHN0cmluZztcbiAgICB1c2VySWQ/OiBzdHJpbmc7XG4gICAgdXNlclJvbGU/OiBzdHJpbmc7XG4gIH0pOiBQcm9taXNlPERvY3VtZW50W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXREb2N1bWVudHMnLFxuICAgICAgYGRvY3VtZW50czoke0pTT04uc3RyaW5naWZ5KGZpbHRlcnMpfWAsXG4gICAgICAnZG9jdW1lbnRzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHF1ZXJ5ID0gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZG9jdW1lbnRzKTtcblxuICAgICAgICBjb25zdCBjb25kaXRpb25zID0gW107XG4gICAgICAgIGlmIChmaWx0ZXJzPy5idWlsZGluZ0lkKSB7XG4gICAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS5kb2N1bWVudHMuYnVpbGRpbmdJZCwgZmlsdGVycy5idWlsZGluZ0lkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnM/LnJlc2lkZW5jZUlkKSB7XG4gICAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS5kb2N1bWVudHMucmVzaWRlbmNlSWQsIGZpbHRlcnMucmVzaWRlbmNlSWQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycz8uZG9jdW1lbnRUeXBlKSB7XG4gICAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS5kb2N1bWVudHMuZG9jdW1lbnRUeXBlLCBmaWx0ZXJzLmRvY3VtZW50VHlwZSkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGNvbmRpdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIHF1ZXJ5ID0gcXVlcnkud2hlcmUoYW5kKC4uLmNvbmRpdGlvbnMpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHF1ZXJ5Lm9yZGVyQnkoZGVzYyhzY2hlbWEuZG9jdW1lbnRzLmNyZWF0ZWRBdCkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0IHx8IFtdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICBhc3luYyBnZXREb2N1bWVudChpZDogc3RyaW5nKTogUHJvbWlzZTxEb2N1bWVudCB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXREb2N1bWVudCcsIGBkb2N1bWVudDoke2lkfWAsICdkb2N1bWVudHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMuaWQsIGlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNyZWF0ZURvY3VtZW50KGRvY3VtZW50OiBJbnNlcnREb2N1bWVudCk6IFByb21pc2U8RG9jdW1lbnQ+IHtcbiAgICByZXR1cm4gZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlRG9jdW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmluc2VydChzY2hlbWEuZG9jdW1lbnRzKS52YWx1ZXMoZG9jdW1lbnQpLnJldHVybmluZygpO1xuICAgICAgXG5cbiAgICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZXNcbiAgICAgIGlmIChkb2N1bWVudC5idWlsZGluZ0lkKSB7XG4gICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYCpidWlsZGluZ0lkKiR7ZG9jdW1lbnQuYnVpbGRpbmdJZH0qYCk7XG4gICAgICB9XG4gICAgICBpZiAoZG9jdW1lbnQucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCBgKnJlc2lkZW5jZUlkKiR7ZG9jdW1lbnQucmVzaWRlbmNlSWR9KmApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgdXBkYXRlRG9jdW1lbnQoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxEb2N1bWVudD4pOiBQcm9taXNlPERvY3VtZW50IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZURvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZG9jdW1lbnRzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgaWYgKHJlc3VsdFswXSkge1xuICAgICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlc1xuICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGBkb2N1bWVudDoke2lkfWApO1xuICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsICcqJyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVEb2N1bWVudChpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZURvY3VtZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmRlbGV0ZShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRvY3VtZW50cy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKHsgaWQ6IHNjaGVtYS5kb2N1bWVudHMuaWQgfSk7XG5cbiAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlc1xuICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGBkb2N1bWVudDoke2lkfWApO1xuICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsICcqJyk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH1cblxuICAvLyBPbGQgcmVzaWRlbnQgZG9jdW1lbnQgbWV0aG9kcyByZW1vdmVkIC0gdXNpbmcgdW5pZmllZCBkb2N1bWVudHMgdGFibGVcblxuICAvLyBMZWdhY3kgRG9jdW1lbnQgb3BlcmF0aW9ucyAoa2VwdCBmb3IgbWlncmF0aW9uIHB1cnBvc2VzKVxuXG4gIC8qKlxuICAgKiBHZXRzIGxlZ2FjeSBkb2N1bWVudHMgZm9yIHVzZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqIEBwYXJhbSBvcmdhbml6YXRpb25JZFxuICAgKiBAcGFyYW0gcmVzaWRlbmNlSWRzXG4gICAqL1xuICBhc3luYyBnZXREb2N1bWVudHNGb3JVc2VyKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJSb2xlOiBzdHJpbmcsXG4gICAgb3JnYW5pemF0aW9uSWQ/OiBzdHJpbmcsXG4gICAgcmVzaWRlbmNlSWRzPzogc3RyaW5nW11cbiAgKTogUHJvbWlzZTxEb2N1bWVudFtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RG9jdW1lbnRzRm9yVXNlcicsXG4gICAgICBgbGVnYWN5X2RvY3M6JHt1c2VySWR9OiR7dXNlclJvbGV9YCxcbiAgICAgICdkb2N1bWVudHMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZG9jdW1lbnRzKS5vcmRlckJ5KGRlc2Moc2NoZW1hLmRvY3VtZW50cy5jcmVhdGVkQXQpKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLy8gUGFzc3dvcmQgcmVzZXQgb3BlcmF0aW9uc1xuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHRva2VuXG4gICAqL1xuICBhc3luYyBjcmVhdGVQYXNzd29yZFJlc2V0VG9rZW4odG9rZW46IEluc2VydFBhc3N3b3JkUmVzZXRUb2tlbik6IFByb21pc2U8UGFzc3dvcmRSZXNldFRva2VuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zKS52YWx1ZXModG9rZW4pLnJldHVybmluZygpO1xuXG4gICAgLy8gVG9rZW4gY3JlYXRlZCBzdWNjZXNzZnVsbHlcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHRva2VuVmFsdWVcbiAgICovXG4gIGFzeW5jIGdldFBhc3N3b3JkUmVzZXRUb2tlbih0b2tlblZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPFBhc3N3b3JkUmVzZXRUb2tlbiB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFBhc3N3b3JkUmVzZXRUb2tlbicsXG4gICAgICBgdG9rZW5fJHt0b2tlblZhbHVlfWAsXG4gICAgICAncGFzc3dvcmRfcmVzZXRfdG9rZW5zJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEucGFzc3dvcmRSZXNldFRva2VucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMudG9rZW4sIHRva2VuVmFsdWUpKVxuICAgICAgICAgIC5saW1pdCgxKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSB0b2tlbklkXG4gICAqL1xuICBhc3luYyBtYXJrUGFzc3dvcmRSZXNldFRva2VuQXNVc2VkKHRva2VuSWQ6IHN0cmluZyk6IFByb21pc2U8UGFzc3dvcmRSZXNldFRva2VuIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC51cGRhdGUoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMpXG4gICAgICAuc2V0KHtcbiAgICAgICAgaXNVc2VkOiB0cnVlLFxuICAgICAgICB1c2VkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLndoZXJlKGVxKHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zLmlkLCB0b2tlbklkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIC8vIFRva2VuIG1hcmtlZCBhcyB1c2VkXG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqL1xuICBhc3luYyBjbGVhbnVwRXhwaXJlZFBhc3N3b3JkUmVzZXRUb2tlbnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLmRlbGV0ZShzY2hlbWEucGFzc3dvcmRSZXNldFRva2VucylcbiAgICAgIC53aGVyZShsdGUoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMuZXhwaXJlc0F0LCBuZXcgRGF0ZSgpKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIC8vIEV4cGlyZWQgdG9rZW5zIGNsZWFuZWQgdXBcblxuICAgIHJldHVybiByZXN1bHQubGVuZ3RoO1xuICB9XG5cbiAgLy8gQ29udGFjdCBvcGVyYXRpb25zXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBjb250YWN0cy5cbiAgICovXG4gIGFzeW5jIGdldENvbnRhY3RzKCk6IFByb21pc2U8Q29udGFjdFtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldENvbnRhY3RzJywgJ2FsbF9jb250YWN0cycsICdjb250YWN0cycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5jb250YWN0cykud2hlcmUoZXEoc2NoZW1hLmNvbnRhY3RzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY29udGFjdHMgYnkgZW50aXR5LlxuICAgKiBAcGFyYW0gZW50aXR5SWRcbiAgICogQHBhcmFtIGVudGl0eVxuICAgKi9cbiAgYXN5bmMgZ2V0Q29udGFjdHNCeUVudGl0eShcbiAgICBlbnRpdHlJZDogc3RyaW5nLFxuICAgIGVudGl0eTogJ29yZ2FuaXphdGlvbicgfCAnYnVpbGRpbmcnIHwgJ3Jlc2lkZW5jZSdcbiAgKTogUHJvbWlzZTxDb250YWN0W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRDb250YWN0c0J5RW50aXR5JyxcbiAgICAgIGBjb250YWN0c19lbnRpdHk6JHtlbnRpdHl9XyR7ZW50aXR5SWR9YCxcbiAgICAgICdjb250YWN0cycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5jb250YWN0cylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5lbnRpdHlJZCwgZW50aXR5SWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuZW50aXR5LCBlbnRpdHkpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBjb250YWN0cyBmb3IgcmVzaWRlbmNlIHdpdGggdXNlciBkYXRhLlxuICAgKiBAcGFyYW0gcmVzaWRlbmNlSWRcbiAgICovXG4gIGFzeW5jIGdldENvbnRhY3RzRm9yUmVzaWRlbmNlKHJlc2lkZW5jZUlkOiBzdHJpbmcpOiBQcm9taXNlPEFycmF5PENvbnRhY3QgJiB7IHVzZXI6IFVzZXIgfT4+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRDb250YWN0c0ZvclJlc2lkZW5jZScsXG4gICAgICBgY29udGFjdHNfcmVzaWRlbmNlOiR7cmVzaWRlbmNlSWR9YCxcbiAgICAgICdjb250YWN0cycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5jb250YWN0cylcbiAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS51c2VycywgZXEoc2NoZW1hLmNvbnRhY3RzLm5hbWUsIHNjaGVtYS51c2Vycy5lbWFpbCkpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuZW50aXR5SWQsIHJlc2lkZW5jZUlkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmNvbnRhY3RzLmVudGl0eSwgJ3Jlc2lkZW5jZScpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBjb250YWN0LlxuICAgKiBAcGFyYW0gY29udGFjdFxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ29udGFjdChjb250YWN0OiBJbnNlcnRDb250YWN0KTogUHJvbWlzZTxDb250YWN0PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlQ29udGFjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmNvbnRhY3RzKS52YWx1ZXMoY29udGFjdCkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2NvbnRhY3RzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGEgY29udGFjdC5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVDb250YWN0KGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8Q29udGFjdD4pOiBQcm9taXNlPENvbnRhY3QgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVDb250YWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmNvbnRhY3RzKVxuICAgICAgICAuc2V0KHVwZGF0ZXMgYXMgYW55KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmNvbnRhY3RzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnY29udGFjdHMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgYSBjb250YWN0LlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUNvbnRhY3QoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZUNvbnRhY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuY29udGFjdHMpXG4gICAgICAgIC5zZXQoeyBpc0FjdGl2ZTogZmFsc2UgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5jb250YWN0cy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2NvbnRhY3RzJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZGVtYW5kcyBmb3IgYSB1c2VyLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXREZW1hbmRzRm9yVXNlcih1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0RGVtYW5kc0ZvclVzZXInLCBgZGVtYW5kc191c2VyOiR7dXNlcklkfWAsICdkZW1hbmRzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmRlbWFuZHMpLndoZXJlKGVxKHNjaGVtYS5kZW1hbmRzLnVzZXJJZCwgdXNlcklkKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYSBzcGVjaWZpYyBkZW1hbmQuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0RGVtYW5kKGlkOiBzdHJpbmcpOiBQcm9taXNlPGFueSB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXREZW1hbmQnLCBgZGVtYW5kOiR7aWR9YCwgJ2RlbWFuZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kZW1hbmRzKS53aGVyZShlcShzY2hlbWEuZGVtYW5kcy5pZCwgaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvLyBCdWcgb3BlcmF0aW9ucyBpbXBsZW1lbnRhdGlvblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRCdWdzRm9yVXNlcih1c2VySWQ6IHN0cmluZywgdXNlclJvbGU6IHN0cmluZywgb3JnYW5pemF0aW9uSWQ/OiBzdHJpbmcpOiBQcm9taXNlPEJ1Z1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QnVnc0ZvclVzZXInLFxuICAgICAgYGJ1Z3M6JHt1c2VyUm9sZX06JHt1c2VySWR9YCxcbiAgICAgICdidWdzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgbGV0IHJlc3VsdHM7XG4gICAgICAgIFxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICAvLyBBZG1pbiBjYW4gc2VlIGFsbCBidWdzXG4gICAgICAgICAgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWdzKVxuICAgICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuYnVncy5jcmVhdGVkQXQpKTtcbiAgICAgICAgfSBlbHNlIGlmICh1c2VyUm9sZSA9PT0gJ21hbmFnZXInICYmIG9yZ2FuaXphdGlvbklkKSB7XG4gICAgICAgICAgLy8gRm9yIG1hbmFnZXJzLCByZXR1cm4gYWxsIGJ1Z3MgZm9yIG5vdyAoY2FuIGJlIHJlZmluZWQgbGF0ZXIpXG4gICAgICAgICAgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWdzKVxuICAgICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuYnVncy5jcmVhdGVkQXQpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGb3IgcmVzaWRlbnRzIGFuZCB0ZW5hbnRzLCByZXR1cm4gb25seSB0aGVpciBvd24gYnVnc1xuICAgICAgICAgIHJlc3VsdHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAuZnJvbShzY2hlbWEuYnVncylcbiAgICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuYnVncy5jcmVhdGVkQnksIHVzZXJJZCkpXG4gICAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5idWdzLmNyZWF0ZWRBdCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2V0IGF0dGFjaG1lbnQgY291bnRzIGFuZCBkZXRhaWxzIGZvciBlYWNoIGJ1Z1xuICAgICAgICBjb25zdCBidWdzV2l0aEF0dGFjaG1lbnRzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgICAgcmVzdWx0cy5tYXAoYXN5bmMgKGJ1ZykgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLmRvY3VtZW50cy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEuZG9jdW1lbnRzLm5hbWUsXG4gICAgICAgICAgICAgICAgZmlsZU5hbWU6IHNjaGVtYS5kb2N1bWVudHMuZmlsZU5hbWUsXG4gICAgICAgICAgICAgICAgZmlsZVNpemU6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVNpemUsXG4gICAgICAgICAgICAgICAgZmlsZVBhdGg6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVBhdGgsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9UeXBlLCAnYnVnJyksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9JZCwgYnVnLmlkKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4uYnVnLFxuICAgICAgICAgICAgICBhdHRhY2htZW50Q291bnQ6IGF0dGFjaG1lbnRzLmxlbmd0aCxcbiAgICAgICAgICAgICAgYXR0YWNobWVudHM6IGF0dGFjaG1lbnRzLm1hcChhdHQgPT4gKHtcbiAgICAgICAgICAgICAgICBpZDogYXR0LmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGF0dC5maWxlTmFtZSB8fCBhdHQubmFtZSxcbiAgICAgICAgICAgICAgICBzaXplOiBwYXJzZUludChhdHQuZmlsZVNpemUgfHwgJzAnKSxcbiAgICAgICAgICAgICAgICB1cmw6IGAvYXBpL2RvY3VtZW50cy8ke2F0dC5pZH0vZmlsZWAsXG4gICAgICAgICAgICAgICAgdHlwZTogYXR0LmZpbGVOYW1lID8gYXR0LmZpbGVOYW1lLnNwbGl0KCcuJykucG9wKCk/LnRvTG93ZXJDYXNlKCkgfHwgJ3Vua25vd24nIDogJ3Vua25vd24nXG4gICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIHJldHVybiBidWdzV2l0aEF0dGFjaG1lbnRzO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqIEBwYXJhbSBvcmdhbml6YXRpb25JZFxuICAgKi9cbiAgYXN5bmMgZ2V0QnVnKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZ1xuICApOiBQcm9taXNlPEJ1ZyB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IGtleSA9IGBidWc6JHtpZH06dXNlcjoke3VzZXJJZH06JHt1c2VyUm9sZX1gO1xuXG4gICAgcmV0dXJuIHF1ZXJ5Q2FjaGUuZ2V0KGtleSwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICAgIGNvbnN0IGJ1ZyA9IHJlc3VsdFswXTtcbiAgICAgIGlmICghYnVnKSB7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICB9XG5cbiAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICByZXR1cm4gYnVnO1xuICAgICAgfVxuXG4gICAgICBpZiAodXNlclJvbGUgPT09ICdtYW5hZ2VyJykge1xuICAgICAgICByZXR1cm4gYnVnOyAvLyBNYW5hZ2VycyBjYW4gc2VlIGFsbCBidWdzIGZvciBub3dcbiAgICAgIH1cblxuICAgICAgLy8gUmVzaWRlbnRzIGFuZCB0ZW5hbnRzIGNhbiBvbmx5IHNlZSB0aGVpciBvd24gYnVnc1xuICAgICAgcmV0dXJuIGJ1Zy5jcmVhdGVkQnkgPT09IHVzZXJJZCA/IGJ1ZyA6IHVuZGVmaW5lZDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gYnVnRGF0YVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQnVnKGJ1Z0RhdGE6IEluc2VydEJ1Zyk6IFByb21pc2U8QnVnPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC5pbnNlcnQoc2NoZW1hLmJ1Z3MpXG4gICAgICAudmFsdWVzKHtcbiAgICAgICAgLi4uYnVnRGF0YSxcbiAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgIHN0YXR1czogJ25ldycsXG4gICAgICAgIGFzc2lnbmVkVG86IG51bGwsXG4gICAgICAgIHJlc29sdmVkQXQ6IG51bGwsXG4gICAgICAgIHJlc29sdmVkQnk6IG51bGwsXG4gICAgICAgIG5vdGVzOiBudWxsLFxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIGNhY2hlIGZvciB0aGlzIHVzZXJcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1Z3MnKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqL1xuICBhc3luYyB1cGRhdGVCdWcoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEJ1Zz4sXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZ1xuICApOiBQcm9taXNlPEJ1ZyB8IHVuZGVmaW5lZD4ge1xuICAgIC8vIEZpcnN0IGNoZWNrIGlmIHRoZSBidWcgZXhpc3RzIGFuZCBnZXQgaXRzIGN1cnJlbnQgZGF0YVxuICAgIGNvbnN0IFtleGlzdGluZ0J1Z10gPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5idWdzKS53aGVyZShlcShzY2hlbWEuYnVncy5pZCwgaWQpKTtcblxuICAgIGlmICghZXhpc3RpbmdCdWcpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgLy8gQWNjZXNzIGNvbnRyb2w6IHVzZXJzIGNhbiBlZGl0IHRoZWlyIG93biBidWdzLCBhZG1pbnMgYW5kIG1hbmFnZXJzIGNhbiBlZGl0IGFueSBidWdcbiAgICBjb25zdCBjYW5FZGl0ID1cbiAgICAgIHVzZXJSb2xlID09PSAnYWRtaW4nIHx8IHVzZXJSb2xlID09PSAnbWFuYWdlcicgfHwgZXhpc3RpbmdCdWcuY3JlYXRlZEJ5ID09PSB1c2VySWQ7XG5cbiAgICBpZiAoIWNhbkVkaXQpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgIC51cGRhdGUoc2NoZW1hLmJ1Z3MpXG4gICAgICAuc2V0KHtcbiAgICAgICAgLi4udXBkYXRlcyxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSlcbiAgICAgIC53aGVyZShlcShzY2hlbWEuYnVncy5pZCwgaWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgaWYgKHJlc3VsdFswXSkge1xuICAgICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlIGVudHJpZXNcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYnVncycpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqL1xuICBhc3luYyBkZWxldGVCdWcoaWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIHVzZXJSb2xlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBGaXJzdCBjaGVjayBpZiB0aGUgYnVnIGV4aXN0cyBhbmQgZ2V0IGl0cyBjdXJyZW50IGRhdGFcbiAgICBjb25zdCBbZXhpc3RpbmdCdWddID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nQnVnKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gQWNjZXNzIGNvbnRyb2w6IHVzZXJzIGNhbiBkZWxldGUgdGhlaXIgb3duIGJ1Z3MsIGFkbWlucyBjYW4gZGVsZXRlIGFueSBidWdcbiAgICBjb25zdCBjYW5EZWxldGUgPSB1c2VyUm9sZSA9PT0gJ2FkbWluJyB8fCBleGlzdGluZ0J1Zy5jcmVhdGVkQnkgPT09IHVzZXJJZDtcblxuICAgIGlmICghY2FuRGVsZXRlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZGVsZXRlKHNjaGVtYS5idWdzKS53aGVyZShlcShzY2hlbWEuYnVncy5pZCwgaWQpKS5yZXR1cm5pbmcoKTtcblxuICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlIGVudHJpZXNcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYnVncycpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLy8gRmVhdHVyZSBSZXF1ZXN0IG9wZXJhdGlvbnMgd2l0aCBvcHRpbWl6YXRpb25cblxuICAvKipcbiAgICogUmV0cmlldmVzIGZlYXR1cmUgcmVxdWVzdHMgZm9yIGEgdXNlciB3aXRoIHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqIEBwYXJhbSBvcmdhbml6YXRpb25JZFxuICAgKi9cbiAgYXN5bmMgZ2V0RmVhdHVyZVJlcXVlc3RzRm9yVXNlcihcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nLFxuICAgIG9yZ2FuaXphdGlvbklkPzogc3RyaW5nXG4gICk6IFByb21pc2U8RmVhdHVyZVJlcXVlc3RbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZlYXR1cmVSZXF1ZXN0c0ZvclVzZXInLFxuICAgICAgYGZlYXR1cmVfcmVxdWVzdHM6JHt1c2VyUm9sZX06JHt1c2VySWR9YCxcbiAgICAgICdmZWF0dXJlX3JlcXVlc3RzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuY3JlYXRlZEF0KSk7XG5cbiAgICAgICAgLy8gR2V0IGF0dGFjaG1lbnQgY291bnRzIGFuZCBkZXRhaWxzIGZvciBlYWNoIGZlYXR1cmUgcmVxdWVzdFxuICAgICAgICBjb25zdCByZXF1ZXN0c1dpdGhBdHRhY2htZW50cyA9IGF3YWl0IFByb21pc2UuYWxsKFxuICAgICAgICAgIHJlc3VsdHMubWFwKGFzeW5jIChyZXF1ZXN0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdHRhY2htZW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEuZG9jdW1lbnRzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5kb2N1bWVudHMubmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlUGF0aDogc2NoZW1hLmRvY3VtZW50cy5maWxlUGF0aCxcbiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogc2NoZW1hLmRvY3VtZW50cy5maWxlU2l6ZSxcbiAgICAgICAgICAgICAgICBtaW1lVHlwZTogc2NoZW1hLmRvY3VtZW50cy5taW1lVHlwZSxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb1R5cGUsICdmZWF0dXJlX3JlcXVlc3QnKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb0lkLCByZXF1ZXN0LmlkKVxuICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4ucmVxdWVzdCxcbiAgICAgICAgICAgICAgYXR0YWNobWVudENvdW50OiBhdHRhY2htZW50cy5sZW5ndGgsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRzOiBhdHRhY2htZW50cy5tYXAoYXR0ID0+ICh7XG4gICAgICAgICAgICAgICAgaWQ6IGF0dC5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBhdHQubmFtZSxcbiAgICAgICAgICAgICAgICB1cmw6IGAvYXBpL2RvY3VtZW50cy8ke2F0dC5pZH0vZmlsZWAsXG4gICAgICAgICAgICAgICAgc2l6ZTogYXR0LmZpbGVTaXplID8gcGFyc2VJbnQoYXR0LmZpbGVTaXplKSA6IDAsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IGF0dC5taW1lVHlwZSxcbiAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9KVxuICAgICAgICApO1xuXG4gICAgICAgIC8vIEFsbCB1c2VycyBjYW4gc2VlIGFsbCBmZWF0dXJlIHJlcXVlc3RzLCBidXQgbm9uLWFkbWlucyBkb24ndCBzZWUgd2hvIHN1Ym1pdHRlZFxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gcmVxdWVzdHNXaXRoQXR0YWNobWVudHM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3Igbm9uLWFkbWluIHVzZXJzLCBoaWRlIHRoZSBjcmVhdGVkQnkgZmllbGRcbiAgICAgICAgcmV0dXJuIHJlcXVlc3RzV2l0aEF0dGFjaG1lbnRzLm1hcCgocmVxdWVzdCkgPT4gKHtcbiAgICAgICAgICAuLi5yZXF1ZXN0LFxuICAgICAgICAgIGNyZWF0ZWRCeTogbnVsbCBhcyBhbnksXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIHNwZWNpZmljIGZlYXR1cmUgcmVxdWVzdCBieSBJRCB3aXRoIHJvbGUtYmFzZWQgYWNjZXNzIGNvbnRyb2wuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVSZXF1ZXN0KFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZ1xuICApOiBQcm9taXNlPEZlYXR1cmVSZXF1ZXN0IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RmVhdHVyZVJlcXVlc3QnLFxuICAgICAgYGZlYXR1cmVfcmVxdWVzdDoke2lkfToke3VzZXJSb2xlfWAsXG4gICAgICAnZmVhdHVyZV9yZXF1ZXN0cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKTtcblxuICAgICAgICBjb25zdCBmZWF0dXJlUmVxdWVzdCA9IHJlc3VsdFswXTtcbiAgICAgICAgaWYgKCFmZWF0dXJlUmVxdWVzdCkge1xuICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBBbGwgdXNlcnMgY2FuIHNlZSBhbnkgZmVhdHVyZSByZXF1ZXN0XG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAgIHJldHVybiBmZWF0dXJlUmVxdWVzdDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZvciBub24tYWRtaW4gdXNlcnMsIGhpZGUgdGhlIGNyZWF0ZWRCeSBmaWVsZFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIC4uLmZlYXR1cmVSZXF1ZXN0LFxuICAgICAgICAgIGNyZWF0ZWRCeTogbnVsbCBhcyBhbnksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IGZlYXR1cmUgcmVxdWVzdC5cbiAgICogQHBhcmFtIGZlYXR1cmVSZXF1ZXN0RGF0YVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRmVhdHVyZVJlcXVlc3QoZmVhdHVyZVJlcXVlc3REYXRhOiBJbnNlcnRGZWF0dXJlUmVxdWVzdCk6IFByb21pc2U8RmVhdHVyZVJlcXVlc3Q+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVGZWF0dXJlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIC4uLmZlYXR1cmVSZXF1ZXN0RGF0YSxcbiAgICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICBzdGF0dXM6ICdzdWJtaXR0ZWQnLFxuICAgICAgICAgIHVwdm90ZUNvdW50OiAwLFxuICAgICAgICAgIGFzc2lnbmVkVG86IG51bGwsXG4gICAgICAgICAgcmV2aWV3ZWRCeTogbnVsbCxcbiAgICAgICAgICByZXZpZXdlZEF0OiBudWxsLFxuICAgICAgICAgIGFkbWluTm90ZXM6IG51bGwsXG4gICAgICAgICAgbWVyZ2VkSW50b0lkOiBudWxsLFxuICAgICAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgY2FjaGVcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdHMnKTtcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBhIGZlYXR1cmUgcmVxdWVzdCAoYWRtaW4gb25seSkuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlRmVhdHVyZVJlcXVlc3QoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEZlYXR1cmVSZXF1ZXN0PixcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nXG4gICk6IFByb21pc2U8RmVhdHVyZVJlcXVlc3QgfCB1bmRlZmluZWQ+IHtcbiAgICAvLyBPbmx5IGFkbWlucyBjYW4gdXBkYXRlIGZlYXR1cmUgcmVxdWVzdHNcbiAgICBpZiAodXNlclJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlRmVhdHVyZVJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICAuLi51cGRhdGVzLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgaWYgKHJlc3VsdFswXSkge1xuICAgICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlIGVudHJpZXNcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0cycpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIGZlYXR1cmUgcmVxdWVzdCAoYWRtaW4gb25seSkuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlRmVhdHVyZVJlcXVlc3QoaWQ6IHN0cmluZywgdXNlcklkOiBzdHJpbmcsIHVzZXJSb2xlOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBPbmx5IGFkbWlucyBjYW4gZGVsZXRlIGZlYXR1cmUgcmVxdWVzdHNcbiAgICBpZiAodXNlclJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBGaXJzdCBkZWxldGUgYWxsIHVwdm90ZXMgZm9yIHRoaXMgZmVhdHVyZSByZXF1ZXN0XG4gICAgYXdhaXQgZGJcbiAgICAgIC5kZWxldGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLmZlYXR1cmVSZXF1ZXN0SWQsIGlkKSk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLmRlbGV0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGlkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlIGVudHJpZXNcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0cycpO1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RfdXB2b3RlcycpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwdm90ZXMgYSBmZWF0dXJlIHJlcXVlc3QuXG4gICAqIEBwYXJhbSB1cHZvdGVEYXRhXG4gICAqL1xuICBhc3luYyB1cHZvdGVGZWF0dXJlUmVxdWVzdChcbiAgICB1cHZvdGVEYXRhOiBJbnNlcnRGZWF0dXJlUmVxdWVzdFVwdm90ZVxuICApOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nOyBkYXRhPzogYW55IH0+IHtcbiAgICBjb25zdCB7IGZlYXR1cmVSZXF1ZXN0SWQsIHVzZXJJZCB9ID0gdXB2b3RlRGF0YTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBmZWF0dXJlIHJlcXVlc3QgZXhpc3RzXG4gICAgICBjb25zdCBmZWF0dXJlUmVxdWVzdFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RJZCkpO1xuXG4gICAgICBpZiAoZmVhdHVyZVJlcXVlc3RSZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZlYXR1cmUgcmVxdWVzdCBub3QgZm91bmQnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiB1c2VyIGhhcyBhbHJlYWR5IHVwdm90ZWQgdGhpcyBmZWF0dXJlIHJlcXVlc3RcbiAgICAgIGNvbnN0IGV4aXN0aW5nVXB2b3RlID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLmZlYXR1cmVSZXF1ZXN0SWQsIGZlYXR1cmVSZXF1ZXN0SWQpLFxuICAgICAgICAgICAgZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3Rlcy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgICApXG4gICAgICAgICk7XG5cbiAgICAgIGlmIChleGlzdGluZ1Vwdm90ZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ1lvdSBoYXZlIGFscmVhZHkgdXB2b3RlZCB0aGlzIGZlYXR1cmUgcmVxdWVzdCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENyZWF0ZSB0aGUgdXB2b3RlXG4gICAgICBjb25zdCB1cHZvdGVSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMpXG4gICAgICAgIC52YWx1ZXMoe1xuICAgICAgICAgIC4uLnVwdm90ZURhdGEsXG4gICAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgdXB2b3RlIGNvdW50IG9uIHRoZSBmZWF0dXJlIHJlcXVlc3RcbiAgICAgIGNvbnN0IHVwZGF0ZWRGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgdXB2b3RlQ291bnQ6IHNxbGAke3NjaGVtYS5mZWF0dXJlUmVxdWVzdHMudXB2b3RlQ291bnR9ICsgMWAsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RJZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gSW52YWxpZGF0ZSBjYWNoZVxuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdF91cHZvdGVzJyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdGZWF0dXJlIHJlcXVlc3QgdXB2b3RlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgdXB2b3RlOiB1cHZvdGVSZXN1bHRbMF0sXG4gICAgICAgICAgZmVhdHVyZVJlcXVlc3Q6IHVwZGF0ZWRGZWF0dXJlUmVxdWVzdFswXSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwdm90aW5nIGZlYXR1cmUgcmVxdWVzdDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cHZvdGUgZmVhdHVyZSByZXF1ZXN0JyxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlbW92ZXMgYW4gdXB2b3RlIGZyb20gYSBmZWF0dXJlIHJlcXVlc3QuXG4gICAqIEBwYXJhbSBmZWF0dXJlUmVxdWVzdElkXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIHJlbW92ZUZlYXR1cmVSZXF1ZXN0VXB2b3RlKFxuICAgIGZlYXR1cmVSZXF1ZXN0SWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZ1xuICApOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgbWVzc2FnZTogc3RyaW5nOyBkYXRhPzogYW55IH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgaWYgZmVhdHVyZSByZXF1ZXN0IGV4aXN0c1xuICAgICAgY29uc3QgZmVhdHVyZVJlcXVlc3RSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGZlYXR1cmVSZXF1ZXN0SWQpKTtcblxuICAgICAgaWYgKGZlYXR1cmVSZXF1ZXN0UmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdGZWF0dXJlIHJlcXVlc3Qgbm90IGZvdW5kJyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gRmluZCBhbmQgcmVtb3ZlIHRoZSB1cHZvdGVcbiAgICAgIGNvbnN0IHJlbW92ZWRVcHZvdGUgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLmZlYXR1cmVSZXF1ZXN0SWQsIGZlYXR1cmVSZXF1ZXN0SWQpLFxuICAgICAgICAgICAgZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3Rlcy51c2VySWQsIHVzZXJJZClcbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICBpZiAocmVtb3ZlZFVwdm90ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGhhdmUgbm90IHVwdm90ZWQgdGhpcyBmZWF0dXJlIHJlcXVlc3QnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgdGhlIHVwdm90ZSBjb3VudCBvbiB0aGUgZmVhdHVyZSByZXF1ZXN0XG4gICAgICBjb25zdCB1cGRhdGVkRmVhdHVyZVJlcXVlc3QgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIHVwdm90ZUNvdW50OiBzcWxgR1JFQVRFU1QoMCwgJHtzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLnVwdm90ZUNvdW50fSAtIDEpYCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmlkLCBmZWF0dXJlUmVxdWVzdElkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdHMnKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0X3Vwdm90ZXMnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ1Vwdm90ZSByZW1vdmVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBmZWF0dXJlUmVxdWVzdDogdXBkYXRlZEZlYXR1cmVSZXF1ZXN0WzBdLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgcmVtb3ZpbmcgZmVhdHVyZSByZXF1ZXN0IHVwdm90ZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byByZW1vdmUgdXB2b3RlJyxcbiAgICAgIH07XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=