167c4040708ed16d2481bab248e16611
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.registerBillRoutes = registerBillRoutes;
const drizzle_orm_1 = require("drizzle-orm");
const db_1 = require("../db");
const auth_1 = require("../auth");
const storage_1 = require("../storage");
const zod_1 = require("zod");
const bill_generation_service_1 = require("../services/bill-generation-service");
const delayed_update_service_1 = require("../services/delayed-update-service");
const gemini_bill_analyzer_1 = require("../services/gemini-bill-analyzer");
const multer_1 = __importDefault(require("multer"));
const fs_1 = __importDefault(require("fs"));
const schema = __importStar(require("@shared/schema"));
const { buildings, bills } = schema;
// Database-driven bills - no more mock data
// Validation schemas
const billFilterSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
    category: zod_1.z.string().optional(),
    year: zod_1.z.string().optional(),
    status: zod_1.z.enum(['all', 'draft', 'sent', 'overdue', 'paid', 'cancelled']).optional(),
    months: zod_1.z.string().optional(), // Comma-separated month numbers (e.g., "1,3,6,12")
});
const createBillSchema = zod_1.z.object({
    buildingId: zod_1.z.string().uuid(),
    title: zod_1.z.string().min(1),
    description: zod_1.z.string().optional(),
    category: zod_1.z.enum([
        'insurance',
        'maintenance',
        'salary',
        'utilities',
        'cleaning',
        'security',
        'landscaping',
        'professional_services',
        'administration',
        'repairs',
        'supplies',
        'taxes',
        'technology',
        'reserves',
        'other',
    ]),
    vendor: zod_1.z.string().optional(),
    paymentType: zod_1.z.enum(['unique', 'recurrent']),
    schedulePayment: zod_1.z.enum(['weekly', 'monthly', 'quarterly', 'yearly', 'custom']).optional(),
    scheduleCustom: zod_1.z.array(zod_1.z.string()).optional(),
    costs: zod_1.z.array(zod_1.z.string()),
    totalAmount: zod_1.z.string(),
    startDate: zod_1.z.string(),
    endDate: zod_1.z.string().optional(),
    status: zod_1.z.enum(['draft', 'sent', 'overdue', 'paid', 'cancelled']),
    notes: zod_1.z.string().optional(),
});
const updateBillSchema = createBillSchema.partial();
// Configure multer for file uploads
const upload = (0, multer_1.default)({
    dest: '/tmp/uploads/',
    fileFilter: (req, file, cb) => {
        const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
        if (allowedTypes.includes(file.mimetype)) {
            cb(null, true);
        }
        else {
            cb(new Error('Only image and PDF files are allowed'));
        }
    },
    limits: {
        fileSize: 10 * 1024 * 1024, // 10MB limit
    },
});
/**
 *
 * @param app
 */
/**
 * RegisterBillRoutes function.
 * @param app
 * @returns Function result.
 */
function registerBillRoutes(app) {
    /**
     * Get all bills with optional filtering
     * GET /api/bills?buildingId=uuid&category=insurance&year=2024&status=draft&months=1,3,6.
     */
    app.get('/api/bills', auth_1.requireAuth, async (req, res) => {
        try {
            const { buildingId, category, year, status = 'all', months } = req.query;
            // Build the WHERE conditions
            const conditions = [];
            if (buildingId && buildingId !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.buildingId, buildingId));
            }
            if (category && category !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.category, category));
            }
            if (year) {
                conditions.push((0, drizzle_orm_1.sql) `EXTRACT(YEAR FROM ${bills.startDate}) = ${year}`);
            }
            if (status && status !== 'all') {
                conditions.push((0, drizzle_orm_1.eq)(bills.status, status));
            }
            if (months) {
                const monthNumbers = months.split(',').map((m) => parseInt(m.trim()));
                const monthConditions = monthNumbers.map((month) => (0, drizzle_orm_1.sql) `EXTRACT(MONTH FROM ${bills.startDate}) = ${month}`);
                conditions.push((0, drizzle_orm_1.sql) `(${drizzle_orm_1.sql.join(monthConditions, (0, drizzle_orm_1.sql) ` OR `)})`);
            }
            const whereClause = conditions.length > 0 ? (0, drizzle_orm_1.and)(...conditions) : undefined;
            const billsList = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where(whereClause)
                .orderBy((0, drizzle_orm_1.desc)(bills.startDate));
            res.json(billsList);
        }
        catch (_error) {
            console.error('❌ Error fetching bills:', _error);
            res.status(500).json({
                message: 'Failed to fetch bills',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get a specific bill by ID
     * GET /api/bills/:id.
     */
    app.get('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json(bill[0]);
        }
        catch (_error) {
            console.error('❌ Error fetching bill:', _error);
            res.status(500).json({
                message: 'Failed to fetch bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Create a new bill
     * POST /api/bills.
     */
    app.post('/api/bills', auth_1.requireAuth, async (req, res) => {
        try {
            const validation = createBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const newBill = await db_1.db
                .insert(bills)
                .values({
                buildingId: billData.buildingId,
                billNumber: `BILL-${Date.now()}`,
                title: billData.title,
                description: billData.description,
                category: billData.category,
                vendor: billData.vendor,
                paymentType: billData.paymentType,
                schedulePayment: billData.schedulePayment,
                scheduleCustom: billData.scheduleCustom,
                costs: billData.costs.map((cost) => parseFloat(cost)),
                totalAmount: parseFloat(billData.totalAmount),
                startDate: billData.startDate,
                endDate: billData.endDate || null,
                status: billData.status,
                notes: billData.notes,
                createdBy: req.user.id,
            })
                .returning();
            // Schedule delayed money flow and budget update for the new bill
            try {
                delayed_update_service_1.delayedUpdateService.scheduleBillUpdate(newBill[0].id);
            }
            catch (schedulingError) {
                console.warn('⚠️ Failed to schedule bill update:', schedulingError);
                // Don't fail the bill creation if scheduling fails
            }
            res.status(201).json(newBill[0]);
        }
        catch (_error) {
            console.error('❌ Error creating bill:', _error);
            res.status(500).json({
                message: 'Failed to create bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Update a bill (PATCH)
     * PATCH /api/bills/:id.
     */
    app.patch('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const validation = updateBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const updateData = {};
            if (billData.title) {
                updateData.title = billData.title;
            }
            if (billData.description) {
                updateData.description = billData.description;
            }
            if (billData.category) {
                updateData.category = billData.category;
            }
            if (billData.vendor) {
                updateData.vendor = billData.vendor;
            }
            if (billData.paymentType) {
                updateData.paymentType = billData.paymentType;
            }
            if (billData.costs) {
                updateData.costs = billData.costs.map((cost) => parseFloat(cost));
            }
            if (billData.totalAmount) {
                updateData.totalAmount = parseFloat(billData.totalAmount);
            }
            if (billData.startDate) {
                updateData.startDate = billData.startDate;
            }
            if (billData.endDate) {
                updateData.endDate = billData.endDate;
            }
            if (billData.status) {
                updateData.status = billData.status;
            }
            if (billData.notes) {
                updateData.notes = billData.notes;
            }
            updateData.updatedAt = new Date();
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            if (updatedBill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json(updatedBill[0]);
        }
        catch (_error) {
            console.error('❌ Error updating bill (PATCH):', _error);
            res.status(500).json({
                message: 'Failed to update bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Update a bill (PUT)
     * PUT /api/bills/:id.
     */
    app.put('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const validation = updateBillSchema.safeParse(req.body);
            if (!validation.success) {
                return res.status(400).json({
                    message: 'Invalid bill data',
                    errors: validation.error.issues,
                });
            }
            const billData = validation.data;
            const updateData = {};
            if (billData.title) {
                updateData.title = billData.title;
            }
            if (billData.description) {
                updateData.description = billData.description;
            }
            if (billData.category) {
                updateData.category = billData.category;
            }
            if (billData.vendor) {
                updateData.vendor = billData.vendor;
            }
            if (billData.paymentType) {
                updateData.paymentType = billData.paymentType;
            }
            if (billData.costs) {
                updateData.costs = billData.costs.map((cost) => parseFloat(cost));
            }
            if (billData.totalAmount) {
                updateData.totalAmount = parseFloat(billData.totalAmount);
            }
            if (billData.startDate) {
                updateData.startDate = billData.startDate;
            }
            if (billData.status) {
                updateData.status = billData.status;
            }
            if (billData.notes) {
                updateData.notes = billData.notes;
            }
            updateData.updatedAt = new Date();
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            if (updatedBill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Schedule delayed money flow and budget update for the updated bill
            try {
                delayed_update_service_1.delayedUpdateService.scheduleBillUpdate(id);
            }
            catch (schedulingError) {
                console.warn('⚠️ Failed to schedule bill update:', schedulingError);
                // Don't fail the bill update if scheduling fails
            }
            res.json(updatedBill[0]);
        }
        catch (_error) {
            console.error('❌ Error updating bill (PUT):', _error);
            res.status(500).json({
                message: 'Failed to update bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Delete a bill
     * DELETE /api/bills/:id.
     */
    app.delete('/api/bills/:id', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const deletedBill = await db_1.db.delete(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).returning();
            if (!deletedBill || (Array.isArray(deletedBill) && deletedBill.length === 0)) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            res.json({
                message: 'Bill deleted successfully',
                bill: deletedBill[0],
            });
        }
        catch (_error) {
            console.error('❌ Error deleting bill:', _error);
            res.status(500).json({
                message: 'Failed to delete bill',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Upload and analyze bill document with Gemini AI
     * POST /api/bills/:id/upload-document.
     */
    app.post('/api/bills/:id/upload-document', auth_1.requireAuth, upload.single('document'), async (req, res) => {
        try {
            const { id } = req.params;
            if (!req.file) {
                return res.status(400).json({ message: 'No file uploaded' });
            }
            // Get organization ID for document organization
            const organizations = await storage_1.storage.getUserOrganizations(req.user.id);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : 'default';
            // Note: File upload to external storage removed
            // Create document path in the expected format
            const documentPath = `prod_org_${organizationId}/${req.file.originalname}`;
            // Analyze document with Gemini AI (images and PDFs)
            let analysisResult = null;
            if (req.file.mimetype.startsWith('image/') || req.file.mimetype === 'application/pdf') {
                try {
                    analysisResult = await gemini_bill_analyzer_1.geminiBillAnalyzer.analyzeBillDocument(req.file.path, req.file.mimetype);
                }
                catch (aiError) {
                    console.warn('AI analysis failed, continuing without analysis:', aiError);
                    // Continue without AI analysis
                }
            }
            // Update bill with document info and AI analysis
            const updateData = {
                documentPath,
                documentName: req.file.originalname,
                isAiAnalyzed: !!analysisResult,
                aiAnalysisData: analysisResult,
                updatedAt: new Date(),
            };
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            // Clean up temporary file
            fs_1.default.unlinkSync(req.file.path);
            res.json({
                message: 'Document uploaded and analyzed successfully',
                bill: updatedBill[0],
                analysisResult,
            });
        }
        catch (_error) {
            console.error('❌ Error uploading document:', _error);
            // Clean up temporary file if it exists
            if (req.file?.path) {
                try {
                    fs_1.default.unlinkSync(req.file.path);
                }
                catch (___cleanupError) {
                    console.error('Error cleaning up temp file:', ___cleanupError);
                }
            }
            res.status(500).json({
                message: 'Failed to upload document',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Download bill document using secure signed URL
     * GET /api/bills/:id/download-document.
     */
    app.get('/api/bills/:id/download-document', auth_1.requireAuth, async (req, res) => {
        try {
            console.log('📱 [SERVER DEBUG] Document download requested for bill ID:', req.params.id);
            const { id } = req.params;
            // Get the bill to check if it has a document
            const bill = await db_1.db.select().from(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).limit(1);
            if (bill.length === 0) {
                console.error('❌ [SERVER DEBUG] Bill not found for document download:', id);
                return res.status(404).json({ message: 'Bill not found' });
            }
            const billData = bill[0];
            console.log('📄 [SERVER DEBUG] Bill found for document download:', {
                id: billData.id,
                documentPath: billData.documentPath,
                documentName: billData.documentName,
                hasDocument: !!(billData.documentPath && billData.documentName)
            });
            if (!billData.documentPath || !billData.documentName) {
                console.error('❌ [SERVER DEBUG] No document associated with this bill:', id);
                return res.status(404).json({ message: 'No document associated with this bill' });
            }
            // Get organization ID for document access
            const organizations = await storage_1.storage.getUserOrganizations(req.user.id);
            const organizationId = organizations.length > 0 ? organizations[0].organizationId : 'default';
            // Document download functionality removed (no external storage)
            res.status(404).json({
                message: 'Document download functionality has been disabled',
            });
        }
        catch (_error) {
            console.error('❌ Error downloading document:', _error);
            res.status(500).json({
                message: 'Failed to generate document download URL',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Apply AI analysis to bill form data
     * POST /api/bills/:id/apply-ai-analysis.
     */
    app.post('/api/bills/:id/apply-ai-analysis', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            // Get the bill with AI analysis data
            const bill = await db_1.db.select().from(bills).where((0, drizzle_orm_1.eq)(bills.id, id)).limit(1);
            if (bill.length === 0) {
                return res.status(404).json({ message: 'Bill not found' });
            }
            const billData = bill[0];
            if (!billData.isAiAnalyzed || !billData.aiAnalysisData) {
                return res.status(400).json({ message: 'No AI analysis data available for this bill' });
            }
            const analysis = billData.aiAnalysisData;
            // Get payment schedule suggestion
            const scheduleSignestion = await gemini_bill_analyzer_1.geminiBillAnalyzer.suggestPaymentSchedule(analysis.category, parseFloat(analysis.totalAmount));
            // Update bill with AI-extracted data
            const updateData = {
                title: analysis.title,
                vendor: analysis.vendor,
                totalAmount: parseFloat(analysis.totalAmount),
                category: analysis.category,
                description: analysis.description,
                paymentType: scheduleSignestion.paymentType,
                schedulePayment: scheduleSignestion.schedulePayment,
                costs: [parseFloat(analysis.totalAmount)],
                startDate: analysis.issueDate || analysis.dueDate || billData.startDate,
                notes: `AI-analyzed document. Original bill number: ${analysis.billNumber || 'N/A'}. Confidence: ${(analysis.confidence * 100).toFixed(1)}%. ${scheduleSignestion.reasoning}`,
                updatedAt: new Date(),
            };
            const updatedBill = await db_1.db
                .update(bills)
                .set(updateData)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .returning();
            res.json({
                message: 'AI analysis applied successfully',
                bill: updatedBill[0],
                analysis,
                scheduleSignestion,
            });
        }
        catch (_error) {
            console.error('❌ Error applying AI analysis:', _error);
            res.status(500).json({
                message: 'Failed to apply AI analysis',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Generate future bill instances for a recurrent bill
     * POST /api/bills/:id/generate-future.
     */
    app.post('/api/bills/:id/generate-future', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Check if user has access to this bill's building
            const building = await db_1.db
                .select({
                id: buildings.id,
                name: buildings.name,
                organizationId: buildings.organizationId,
            })
                .from(buildings)
                .where((0, drizzle_orm_1.eq)(buildings.id, bill[0].buildingId))
                .limit(1);
            if (building.length === 0) {
                return res.status(403).json({
                    message: 'Access denied to generate future bills',
                    code: 'ACCESS_DENIED',
                });
            }
            if (bill[0].paymentType !== 'recurrent') {
                return res.status(400).json({
                    message: 'Only recurrent bills can generate future instances',
                });
            }
            // Generate future bills
            const result = await bill_generation_service_1.billGenerationService.generateFutureBillInstances(bill[0]);
            res.json({
                message: 'Future bills generated successfully',
                billsCreated: result.billsCreated,
                generatedUntil: result.generatedUntil,
            });
        }
        catch (_error) {
            console.error('❌ Error generating future bills:', _error);
            res.status(500).json({
                message: 'Failed to generate future bills',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get bill categories for filter dropdown
     * GET /api/bills/categories.
     */
    app.get('/api/bills/categories', auth_1.requireAuth, async (req, res) => {
        try {
            const categories = [
                'insurance',
                'maintenance',
                'salary',
                'utilities',
                'cleaning',
                'security',
                'landscaping',
                'professional_services',
                'administration',
                'repairs',
                'supplies',
                'taxes',
                'technology',
                'reserves',
                'other',
            ];
            res.json(categories);
        }
        catch (_error) {
            console.error('❌ Error fetching bill categories:', _error);
            res.status(500).json({
                message: 'Failed to fetch bill categories',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Get statistics for auto-generated bills from a parent bill
     * GET /api/bills/:id/generated-stats.
     */
    app.get('/api/bills/:id/generated-stats', auth_1.requireAuth, async (req, res) => {
        try {
            const { id } = req.params;
            const bill = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.eq)(bills.id, id))
                .limit(1);
            if (bill.length === 0) {
                return res.status(404).json({
                    message: 'Bill not found',
                });
            }
            // Find all bills generated from this parent bill (look for auto-generated bills)
            const generatedBills = await db_1.db
                .select({
                id: bills.id,
                buildingId: bills.buildingId,
                billNumber: bills.billNumber,
                title: bills.title,
                description: bills.description,
                category: bills.category,
                vendor: bills.vendor,
                paymentType: bills.paymentType,
                costs: bills.costs,
                totalAmount: bills.totalAmount,
                startDate: bills.startDate,
                status: bills.status,
                notes: bills.notes,
                createdBy: bills.createdBy,
                createdAt: bills.createdAt,
                updatedAt: bills.updatedAt,
            })
                .from(bills)
                .where((0, drizzle_orm_1.sql) `bills.notes LIKE '%Auto-generated from:%'`)
                .orderBy(bills.startDate);
            const stats = generatedBills.map((genBill) => ({
                id: genBill.id,
                title: genBill.title,
                amount: genBill.totalAmount,
                startDate: genBill.startDate,
                status: genBill.status,
                billNumber: genBill.billNumber,
            }));
            res.json({
                parentBill: bill[0],
                generatedBills: stats,
            });
        }
        catch (_error) {
            console.error('❌ Error getting generated bills statistics:', _error);
            res.status(500).json({
                message: 'Failed to get generated bills statistics',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
    /**
     * Analyze document without creating a bill
     * POST /api/bills/analyze-document
     */
    app.post('/api/bills/analyze-document', auth_1.requireAuth, upload.single('document'), async (req, res) => {
        try {
            if (!req.file) {
                return res.status(400).json({
                    message: 'No document file provided',
                });
            }
            const analysis = await gemini_bill_analyzer_1.geminiBillAnalyzer.analyzeBillDocument(req.file.path);
            res.json(analysis);
        }
        catch (_error) {
            console.error('Error analyzing document:', _error);
            res.status(500).json({
                message: 'Failed to analyze document',
                _error: _error instanceof Error ? _error.message : 'Unknown error',
            });
        }
    });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDLENBQUMsQ0FBQyxlQUFlO2FBQ25FLENBQUMsQ0FBQztRQUNMLENBQUM7SUFDSCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvYXBpL2JpbGxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0eXBlIHsgRXhwcmVzcywgUmVxdWVzdCwgUmVzcG9uc2UgfSBmcm9tICdleHByZXNzJztcbmltcG9ydCB7IGVxLCBkZXNjLCBhbmQsIHNxbCwgaXNOdWxsIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IHsgZGIgfSBmcm9tICcuLi9kYic7XG5pbXBvcnQgeyByZXF1aXJlQXV0aCB9IGZyb20gJy4uL2F1dGgnO1xuaW1wb3J0IHsgc3RvcmFnZSB9IGZyb20gJy4uL3N0b3JhZ2UnO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgeyBtb25leUZsb3dKb2IgfSBmcm9tICcuLi9qb2JzL21vbmV5X2Zsb3dfam9iJztcbmltcG9ydCB7IGJpbGxHZW5lcmF0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlcnZpY2VzL2JpbGwtZ2VuZXJhdGlvbi1zZXJ2aWNlJztcbmltcG9ydCB7IGRlbGF5ZWRVcGRhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvZGVsYXllZC11cGRhdGUtc2VydmljZSc7XG5pbXBvcnQgeyBnZW1pbmlCaWxsQW5hbHl6ZXIgfSBmcm9tICcuLi9zZXJ2aWNlcy9nZW1pbmktYmlsbC1hbmFseXplcic7XG5pbXBvcnQgbXVsdGVyIGZyb20gJ211bHRlcic7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuXG5jb25zdCB7IGJ1aWxkaW5ncywgYmlsbHMgfSA9IHNjaGVtYTtcblxuLy8gRGF0YWJhc2UtZHJpdmVuIGJpbGxzIC0gbm8gbW9yZSBtb2NrIGRhdGFcblxuLy8gVmFsaWRhdGlvbiBzY2hlbWFzXG5jb25zdCBiaWxsRmlsdGVyU2NoZW1hID0gei5vYmplY3Qoe1xuICBidWlsZGluZ0lkOiB6LnN0cmluZygpLnV1aWQoKSxcbiAgY2F0ZWdvcnk6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgeWVhcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBzdGF0dXM6IHouZW51bShbJ2FsbCcsICdkcmFmdCcsICdzZW50JywgJ292ZXJkdWUnLCAncGFpZCcsICdjYW5jZWxsZWQnXSkub3B0aW9uYWwoKSxcbiAgbW9udGhzOiB6LnN0cmluZygpLm9wdGlvbmFsKCksIC8vIENvbW1hLXNlcGFyYXRlZCBtb250aCBudW1iZXJzIChlLmcuLCBcIjEsMyw2LDEyXCIpXG59KTtcblxuY29uc3QgY3JlYXRlQmlsbFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgYnVpbGRpbmdJZDogei5zdHJpbmcoKS51dWlkKCksXG4gIHRpdGxlOiB6LnN0cmluZygpLm1pbigxKSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgY2F0ZWdvcnk6IHouZW51bShbXG4gICAgJ2luc3VyYW5jZScsXG4gICAgJ21haW50ZW5hbmNlJyxcbiAgICAnc2FsYXJ5JyxcbiAgICAndXRpbGl0aWVzJyxcbiAgICAnY2xlYW5pbmcnLFxuICAgICdzZWN1cml0eScsXG4gICAgJ2xhbmRzY2FwaW5nJyxcbiAgICAncHJvZmVzc2lvbmFsX3NlcnZpY2VzJyxcbiAgICAnYWRtaW5pc3RyYXRpb24nLFxuICAgICdyZXBhaXJzJyxcbiAgICAnc3VwcGxpZXMnLFxuICAgICd0YXhlcycsXG4gICAgJ3RlY2hub2xvZ3knLFxuICAgICdyZXNlcnZlcycsXG4gICAgJ290aGVyJyxcbiAgXSksXG4gIHZlbmRvcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBwYXltZW50VHlwZTogei5lbnVtKFsndW5pcXVlJywgJ3JlY3VycmVudCddKSxcbiAgc2NoZWR1bGVQYXltZW50OiB6LmVudW0oWyd3ZWVrbHknLCAnbW9udGhseScsICdxdWFydGVybHknLCAneWVhcmx5JywgJ2N1c3RvbSddKS5vcHRpb25hbCgpLFxuICBzY2hlZHVsZUN1c3RvbTogei5hcnJheSh6LnN0cmluZygpKS5vcHRpb25hbCgpLFxuICBjb3N0czogei5hcnJheSh6LnN0cmluZygpKSxcbiAgdG90YWxBbW91bnQ6IHouc3RyaW5nKCksXG4gIHN0YXJ0RGF0ZTogei5zdHJpbmcoKSxcbiAgZW5kRGF0ZTogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICBzdGF0dXM6IHouZW51bShbJ2RyYWZ0JywgJ3NlbnQnLCAnb3ZlcmR1ZScsICdwYWlkJywgJ2NhbmNlbGxlZCddKSxcbiAgbm90ZXM6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbn0pO1xuXG5jb25zdCB1cGRhdGVCaWxsU2NoZW1hID0gY3JlYXRlQmlsbFNjaGVtYS5wYXJ0aWFsKCk7XG5cbi8vIENvbmZpZ3VyZSBtdWx0ZXIgZm9yIGZpbGUgdXBsb2Fkc1xuY29uc3QgdXBsb2FkID0gbXVsdGVyKHtcbiAgZGVzdDogJy90bXAvdXBsb2Fkcy8nLFxuICBmaWxlRmlsdGVyOiAocmVxLCBmaWxlLCBjYikgPT4ge1xuICAgIGNvbnN0IGFsbG93ZWRUeXBlcyA9IFsnaW1hZ2UvanBlZycsICdpbWFnZS9wbmcnLCAnaW1hZ2UvZ2lmJywgJ2FwcGxpY2F0aW9uL3BkZiddO1xuICAgIGlmIChhbGxvd2VkVHlwZXMuaW5jbHVkZXMoZmlsZS5taW1ldHlwZSkpIHtcbiAgICAgIGNiKG51bGwsIHRydWUpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYihuZXcgRXJyb3IoJ09ubHkgaW1hZ2UgYW5kIFBERiBmaWxlcyBhcmUgYWxsb3dlZCcpKTtcbiAgICB9XG4gIH0sXG4gIGxpbWl0czoge1xuICAgIGZpbGVTaXplOiAxMCAqIDEwMjQgKiAxMDI0LCAvLyAxME1CIGxpbWl0XG4gIH0sXG59KTtcblxuLyoqXG4gKlxuICogQHBhcmFtIGFwcFxuICovXG4vKipcbiAqIFJlZ2lzdGVyQmlsbFJvdXRlcyBmdW5jdGlvbi5cbiAqIEBwYXJhbSBhcHBcbiAqIEByZXR1cm5zIEZ1bmN0aW9uIHJlc3VsdC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlZ2lzdGVyQmlsbFJvdXRlcyhhcHA6IEV4cHJlc3MpIHtcbiAgLyoqXG4gICAqIEdldCBhbGwgYmlsbHMgd2l0aCBvcHRpb25hbCBmaWx0ZXJpbmdcbiAgICogR0VUIC9hcGkvYmlsbHM/YnVpbGRpbmdJZD11dWlkJmNhdGVnb3J5PWluc3VyYW5jZSZ5ZWFyPTIwMjQmc3RhdHVzPWRyYWZ0Jm1vbnRocz0xLDMsNi5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYmlsbHMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGJ1aWxkaW5nSWQsIGNhdGVnb3J5LCB5ZWFyLCBzdGF0dXMgPSAnYWxsJywgbW9udGhzIH0gPSByZXEucXVlcnk7XG5cbiAgICAgIC8vIEJ1aWxkIHRoZSBXSEVSRSBjb25kaXRpb25zXG4gICAgICBjb25zdCBjb25kaXRpb25zID0gW107XG5cbiAgICAgIGlmIChidWlsZGluZ0lkICYmIGJ1aWxkaW5nSWQgIT09ICdhbGwnKSB7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShiaWxscy5idWlsZGluZ0lkLCBidWlsZGluZ0lkKSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChjYXRlZ29yeSAmJiBjYXRlZ29yeSAhPT0gJ2FsbCcpIHtcbiAgICAgICAgY29uZGl0aW9ucy5wdXNoKGVxKGJpbGxzLmNhdGVnb3J5LCBjYXRlZ29yeSkpO1xuICAgICAgfVxuXG4gICAgICBpZiAoeWVhcikge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goc3FsYEVYVFJBQ1QoWUVBUiBGUk9NICR7YmlsbHMuc3RhcnREYXRlfSkgPSAke3llYXJ9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzdGF0dXMgJiYgc3RhdHVzICE9PSAnYWxsJykge1xuICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoYmlsbHMuc3RhdHVzLCBzdGF0dXMpKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG1vbnRocykge1xuICAgICAgICBjb25zdCBtb250aE51bWJlcnMgPSBtb250aHMuc3BsaXQoJywnKS5tYXAoKG06IHN0cmluZykgPT4gcGFyc2VJbnQobS50cmltKCkpKTtcbiAgICAgICAgY29uc3QgbW9udGhDb25kaXRpb25zID0gbW9udGhOdW1iZXJzLm1hcChcbiAgICAgICAgICAobW9udGg6IG51bWJlcikgPT4gc3FsYEVYVFJBQ1QoTU9OVEggRlJPTSAke2JpbGxzLnN0YXJ0RGF0ZX0pID0gJHttb250aH1gXG4gICAgICAgICk7XG4gICAgICAgIGNvbmRpdGlvbnMucHVzaChzcWxgKCR7c3FsLmpvaW4obW9udGhDb25kaXRpb25zLCBzcWxgIE9SIGApfSlgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgd2hlcmVDbGF1c2UgPSBjb25kaXRpb25zLmxlbmd0aCA+IDAgPyBhbmQoLi4uY29uZGl0aW9ucykgOiB1bmRlZmluZWQ7XG5cbiAgICAgIGNvbnN0IGJpbGxzTGlzdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBiaWxscy5pZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxscy5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGJpbGxzLmJpbGxOdW1iZXIsXG4gICAgICAgICAgdGl0bGU6IGJpbGxzLnRpdGxlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBiaWxscy5kZXNjcmlwdGlvbixcbiAgICAgICAgICBjYXRlZ29yeTogYmlsbHMuY2F0ZWdvcnksXG4gICAgICAgICAgdmVuZG9yOiBiaWxscy52ZW5kb3IsXG4gICAgICAgICAgcGF5bWVudFR5cGU6IGJpbGxzLnBheW1lbnRUeXBlLFxuICAgICAgICAgIGNvc3RzOiBiaWxscy5jb3N0cyxcbiAgICAgICAgICB0b3RhbEFtb3VudDogYmlsbHMudG90YWxBbW91bnQsXG4gICAgICAgICAgc3RhcnREYXRlOiBiaWxscy5zdGFydERhdGUsXG4gICAgICAgICAgc3RhdHVzOiBiaWxscy5zdGF0dXMsXG4gICAgICAgICAgbm90ZXM6IGJpbGxzLm5vdGVzLFxuICAgICAgICAgIGNyZWF0ZWRCeTogYmlsbHMuY3JlYXRlZEJ5LFxuICAgICAgICAgIGNyZWF0ZWRBdDogYmlsbHMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogYmlsbHMudXBkYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKHdoZXJlQ2xhdXNlKVxuICAgICAgICAub3JkZXJCeShkZXNjKGJpbGxzLnN0YXJ0RGF0ZSkpO1xuXG4gICAgICByZXMuanNvbihiaWxsc0xpc3QpO1xuICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgYmlsbHM6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byBmZXRjaCBiaWxscycsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdldCBhIHNwZWNpZmljIGJpbGwgYnkgSURcbiAgICogR0VUIC9hcGkvYmlsbHMvOmlkLlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9iaWxscy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBjb25zdCBiaWxsID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJpbGxzLmlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJpbGxzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgYmlsbE51bWJlcjogYmlsbHMuYmlsbE51bWJlcixcbiAgICAgICAgICB0aXRsZTogYmlsbHMudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGJpbGxzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGNhdGVnb3J5OiBiaWxscy5jYXRlZ29yeSxcbiAgICAgICAgICB2ZW5kb3I6IGJpbGxzLnZlbmRvcixcbiAgICAgICAgICBwYXltZW50VHlwZTogYmlsbHMucGF5bWVudFR5cGUsXG4gICAgICAgICAgY29zdHM6IGJpbGxzLmNvc3RzLFxuICAgICAgICAgIHRvdGFsQW1vdW50OiBiaWxscy50b3RhbEFtb3VudCxcbiAgICAgICAgICBzdGFydERhdGU6IGJpbGxzLnN0YXJ0RGF0ZSxcbiAgICAgICAgICBzdGF0dXM6IGJpbGxzLnN0YXR1cyxcbiAgICAgICAgICBub3RlczogYmlsbHMubm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEJ5OiBiaWxscy5jcmVhdGVkQnksXG4gICAgICAgICAgY3JlYXRlZEF0OiBiaWxscy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBiaWxscy51cGRhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoZXEoYmlsbHMuaWQsIGlkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYmlsbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oYmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZmV0Y2ggYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBiaWxsXG4gICAqIFBPU1QgL2FwaS9iaWxscy5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2JpbGxzJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGNyZWF0ZUJpbGxTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBiaWxsIGRhdGEnLFxuICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiaWxsRGF0YSA9IHZhbGlkYXRpb24uZGF0YTtcbiAgICAgIGNvbnN0IG5ld0JpbGwgPSBhd2FpdCBkYlxuICAgICAgICAuaW5zZXJ0KGJpbGxzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxsRGF0YS5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGBCSUxMLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIHRpdGxlOiBiaWxsRGF0YS50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYmlsbERhdGEuZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnk6IGJpbGxEYXRhLmNhdGVnb3J5LFxuICAgICAgICAgIHZlbmRvcjogYmlsbERhdGEudmVuZG9yLFxuICAgICAgICAgIHBheW1lbnRUeXBlOiBiaWxsRGF0YS5wYXltZW50VHlwZSxcbiAgICAgICAgICBzY2hlZHVsZVBheW1lbnQ6IGJpbGxEYXRhLnNjaGVkdWxlUGF5bWVudCxcbiAgICAgICAgICBzY2hlZHVsZUN1c3RvbTogYmlsbERhdGEuc2NoZWR1bGVDdXN0b20sXG4gICAgICAgICAgY29zdHM6IGJpbGxEYXRhLmNvc3RzLm1hcCgoY29zdCkgPT4gcGFyc2VGbG9hdChjb3N0KSksXG4gICAgICAgICAgdG90YWxBbW91bnQ6IHBhcnNlRmxvYXQoYmlsbERhdGEudG90YWxBbW91bnQpLFxuICAgICAgICAgIHN0YXJ0RGF0ZTogYmlsbERhdGEuc3RhcnREYXRlLFxuICAgICAgICAgIGVuZERhdGU6IGJpbGxEYXRhLmVuZERhdGUgfHwgbnVsbCxcbiAgICAgICAgICBzdGF0dXM6IGJpbGxEYXRhLnN0YXR1cyxcbiAgICAgICAgICBub3RlczogYmlsbERhdGEubm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEJ5OiByZXEudXNlci5pZCxcbiAgICAgICAgfSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBTY2hlZHVsZSBkZWxheWVkIG1vbmV5IGZsb3cgYW5kIGJ1ZGdldCB1cGRhdGUgZm9yIHRoZSBuZXcgYmlsbFxuICAgICAgdHJ5IHtcbiAgICAgICAgZGVsYXllZFVwZGF0ZVNlcnZpY2Uuc2NoZWR1bGVCaWxsVXBkYXRlKG5ld0JpbGxbMF0uaWQpO1xuICAgICAgfSBjYXRjaCAoc2NoZWR1bGluZ0Vycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBzY2hlZHVsZSBiaWxsIHVwZGF0ZTonLCBzY2hlZHVsaW5nRXJyb3IpO1xuICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSBiaWxsIGNyZWF0aW9uIGlmIHNjaGVkdWxpbmcgZmFpbHNcbiAgICAgIH1cblxuICAgICAgcmVzLnN0YXR1cygyMDEpLmpzb24obmV3QmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gY3JlYXRlIGJpbGwnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGRhdGUgYSBiaWxsIChQQVRDSClcbiAgICogUEFUQ0ggL2FwaS9iaWxscy86aWQuXG4gICAqL1xuICBhcHAucGF0Y2goJy9hcGkvYmlsbHMvOmlkJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcbiAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSB1cGRhdGVCaWxsU2NoZW1hLnNhZmVQYXJzZShyZXEuYm9keSk7XG5cbiAgICAgIGlmICghdmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0ludmFsaWQgYmlsbCBkYXRhJyxcbiAgICAgICAgICBlcnJvcnM6IHZhbGlkYXRpb24uZXJyb3IuaXNzdWVzLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYmlsbERhdGEgPSB2YWxpZGF0aW9uLmRhdGE7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IGFueSA9IHt9O1xuICAgICAgaWYgKGJpbGxEYXRhLnRpdGxlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEudGl0bGUgPSBiaWxsRGF0YS50aXRsZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5kZXNjcmlwdGlvbikge1xuICAgICAgICB1cGRhdGVEYXRhLmRlc2NyaXB0aW9uID0gYmlsbERhdGEuZGVzY3JpcHRpb247XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuY2F0ZWdvcnkpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5jYXRlZ29yeSA9IGJpbGxEYXRhLmNhdGVnb3J5O1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnZlbmRvcikge1xuICAgICAgICB1cGRhdGVEYXRhLnZlbmRvciA9IGJpbGxEYXRhLnZlbmRvcjtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5wYXltZW50VHlwZSkge1xuICAgICAgICB1cGRhdGVEYXRhLnBheW1lbnRUeXBlID0gYmlsbERhdGEucGF5bWVudFR5cGU7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuY29zdHMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5jb3N0cyA9IGJpbGxEYXRhLmNvc3RzLm1hcCgoY29zdDogc3RyaW5nKSA9PiBwYXJzZUZsb2F0KGNvc3QpKTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS50b3RhbEFtb3VudCkge1xuICAgICAgICB1cGRhdGVEYXRhLnRvdGFsQW1vdW50ID0gcGFyc2VGbG9hdChiaWxsRGF0YS50b3RhbEFtb3VudCk7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuc3RhcnREYXRlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuc3RhcnREYXRlID0gYmlsbERhdGEuc3RhcnREYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLmVuZERhdGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5lbmREYXRlID0gYmlsbERhdGEuZW5kRGF0ZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5zdGF0dXMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5zdGF0dXMgPSBiaWxsRGF0YS5zdGF0dXM7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEubm90ZXMpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5ub3RlcyA9IGJpbGxEYXRhLm5vdGVzO1xuICAgICAgfVxuICAgICAgdXBkYXRlRGF0YS51cGRhdGVkQXQgPSBuZXcgRGF0ZSgpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkQmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoYmlsbHMpXG4gICAgICAgIC5zZXQodXBkYXRlRGF0YSlcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgaWYgKHVwZGF0ZWRCaWxsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdCaWxsIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXMuanNvbih1cGRhdGVkQmlsbFswXSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBiaWxsIChQQVRDSCk6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBhIGJpbGwgKFBVVClcbiAgICogUFVUIC9hcGkvYmlsbHMvOmlkLlxuICAgKi9cbiAgYXBwLnB1dCgnL2FwaS9iaWxscy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHVwZGF0ZUJpbGxTY2hlbWEuc2FmZVBhcnNlKHJlcS5ib2R5KTtcblxuICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnSW52YWxpZCBiaWxsIGRhdGEnLFxuICAgICAgICAgIGVycm9yczogdmFsaWRhdGlvbi5lcnJvci5pc3N1ZXMsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiaWxsRGF0YSA9IHZhbGlkYXRpb24uZGF0YTtcblxuICAgICAgY29uc3QgdXBkYXRlRGF0YTogYW55ID0ge307XG4gICAgICBpZiAoYmlsbERhdGEudGl0bGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS50aXRsZSA9IGJpbGxEYXRhLnRpdGxlO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLmRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuZGVzY3JpcHRpb24gPSBiaWxsRGF0YS5kZXNjcmlwdGlvbjtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5jYXRlZ29yeSkge1xuICAgICAgICB1cGRhdGVEYXRhLmNhdGVnb3J5ID0gYmlsbERhdGEuY2F0ZWdvcnk7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEudmVuZG9yKSB7XG4gICAgICAgIHVwZGF0ZURhdGEudmVuZG9yID0gYmlsbERhdGEudmVuZG9yO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnBheW1lbnRUeXBlKSB7XG4gICAgICAgIHVwZGF0ZURhdGEucGF5bWVudFR5cGUgPSBiaWxsRGF0YS5wYXltZW50VHlwZTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5jb3N0cykge1xuICAgICAgICB1cGRhdGVEYXRhLmNvc3RzID0gYmlsbERhdGEuY29zdHMubWFwKChjb3N0OiBzdHJpbmcpID0+IHBhcnNlRmxvYXQoY29zdCkpO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLnRvdGFsQW1vdW50KSB7XG4gICAgICAgIHVwZGF0ZURhdGEudG90YWxBbW91bnQgPSBwYXJzZUZsb2F0KGJpbGxEYXRhLnRvdGFsQW1vdW50KTtcbiAgICAgIH1cbiAgICAgIGlmIChiaWxsRGF0YS5zdGFydERhdGUpIHtcbiAgICAgICAgdXBkYXRlRGF0YS5zdGFydERhdGUgPSBiaWxsRGF0YS5zdGFydERhdGU7XG4gICAgICB9XG4gICAgICBpZiAoYmlsbERhdGEuc3RhdHVzKSB7XG4gICAgICAgIHVwZGF0ZURhdGEuc3RhdHVzID0gYmlsbERhdGEuc3RhdHVzO1xuICAgICAgfVxuICAgICAgaWYgKGJpbGxEYXRhLm5vdGVzKSB7XG4gICAgICAgIHVwZGF0ZURhdGEubm90ZXMgPSBiaWxsRGF0YS5ub3RlcztcbiAgICAgIH1cbiAgICAgIHVwZGF0ZURhdGEudXBkYXRlZEF0ID0gbmV3IERhdGUoKTtcblxuICAgICAgY29uc3QgdXBkYXRlZEJpbGwgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKGJpbGxzKVxuICAgICAgICAuc2V0KHVwZGF0ZURhdGEpXG4gICAgICAgIC53aGVyZShlcShiaWxscy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmICh1cGRhdGVkQmlsbC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gU2NoZWR1bGUgZGVsYXllZCBtb25leSBmbG93IGFuZCBidWRnZXQgdXBkYXRlIGZvciB0aGUgdXBkYXRlZCBiaWxsXG4gICAgICB0cnkge1xuICAgICAgICBkZWxheWVkVXBkYXRlU2VydmljZS5zY2hlZHVsZUJpbGxVcGRhdGUoaWQpO1xuICAgICAgfSBjYXRjaCAoc2NoZWR1bGluZ0Vycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIEZhaWxlZCB0byBzY2hlZHVsZSBiaWxsIHVwZGF0ZTonLCBzY2hlZHVsaW5nRXJyb3IpO1xuICAgICAgICAvLyBEb24ndCBmYWlsIHRoZSBiaWxsIHVwZGF0ZSBpZiBzY2hlZHVsaW5nIGZhaWxzXG4gICAgICB9XG5cbiAgICAgIHJlcy5qc29uKHVwZGF0ZWRCaWxsWzBdKTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIHVwZGF0aW5nIGJpbGwgKFBVVCk6JywgX2Vycm9yKTtcbiAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0ZhaWxlZCB0byB1cGRhdGUgYmlsbCcsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIERlbGV0ZSBhIGJpbGxcbiAgICogREVMRVRFIC9hcGkvYmlsbHMvOmlkLlxuICAgKi9cbiAgYXBwLmRlbGV0ZSgnL2FwaS9iaWxscy86aWQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICBjb25zdCBkZWxldGVkQmlsbCA9IGF3YWl0IGRiLmRlbGV0ZShiaWxscykud2hlcmUoZXEoYmlsbHMuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmICghZGVsZXRlZEJpbGwgfHwgKEFycmF5LmlzQXJyYXkoZGVsZXRlZEJpbGwpICYmIGRlbGV0ZWRCaWxsLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnQmlsbCBkZWxldGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGJpbGw6IGRlbGV0ZWRCaWxsWzBdLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWxldGluZyBiaWxsOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZGVsZXRlIGJpbGwnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBVcGxvYWQgYW5kIGFuYWx5emUgYmlsbCBkb2N1bWVudCB3aXRoIEdlbWluaSBBSVxuICAgKiBQT1NUIC9hcGkvYmlsbHMvOmlkL3VwbG9hZC1kb2N1bWVudC5cbiAgICovXG4gIGFwcC5wb3N0KFxuICAgICcvYXBpL2JpbGxzLzppZC91cGxvYWQtZG9jdW1lbnQnLFxuICAgIHJlcXVpcmVBdXRoLFxuICAgIHVwbG9hZC5zaW5nbGUoJ2RvY3VtZW50JyksXG4gICAgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgICBpZiAoIXJlcS5maWxlKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgbWVzc2FnZTogJ05vIGZpbGUgdXBsb2FkZWQnIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2V0IG9yZ2FuaXphdGlvbiBJRCBmb3IgZG9jdW1lbnQgb3JnYW5pemF0aW9uXG4gICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHJlcS51c2VyLmlkKTtcbiAgICAgICAgY29uc3Qgb3JnYW5pemF0aW9uSWQgPVxuICAgICAgICAgIG9yZ2FuaXphdGlvbnMubGVuZ3RoID4gMCA/IG9yZ2FuaXphdGlvbnNbMF0ub3JnYW5pemF0aW9uSWQgOiAnZGVmYXVsdCc7XG5cbiAgICAgICAgLy8gTm90ZTogRmlsZSB1cGxvYWQgdG8gZXh0ZXJuYWwgc3RvcmFnZSByZW1vdmVkXG5cbiAgICAgICAgLy8gQ3JlYXRlIGRvY3VtZW50IHBhdGggaW4gdGhlIGV4cGVjdGVkIGZvcm1hdFxuICAgICAgICBjb25zdCBkb2N1bWVudFBhdGggPSBgcHJvZF9vcmdfJHtvcmdhbml6YXRpb25JZH0vJHtyZXEuZmlsZS5vcmlnaW5hbG5hbWV9YDtcblxuICAgICAgICAvLyBBbmFseXplIGRvY3VtZW50IHdpdGggR2VtaW5pIEFJIChpbWFnZXMgYW5kIFBERnMpXG4gICAgICAgIGxldCBhbmFseXNpc1Jlc3VsdCA9IG51bGw7XG4gICAgICAgIGlmIChyZXEuZmlsZS5taW1ldHlwZS5zdGFydHNXaXRoKCdpbWFnZS8nKSB8fCByZXEuZmlsZS5taW1ldHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3BkZicpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgYW5hbHlzaXNSZXN1bHQgPSBhd2FpdCBnZW1pbmlCaWxsQW5hbHl6ZXIuYW5hbHl6ZUJpbGxEb2N1bWVudChyZXEuZmlsZS5wYXRoLCByZXEuZmlsZS5taW1ldHlwZSk7XG4gICAgICAgICAgfSBjYXRjaCAoYWlFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdBSSBhbmFseXNpcyBmYWlsZWQsIGNvbnRpbnVpbmcgd2l0aG91dCBhbmFseXNpczonLCBhaUVycm9yKTtcbiAgICAgICAgICAgIC8vIENvbnRpbnVlIHdpdGhvdXQgQUkgYW5hbHlzaXNcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBVcGRhdGUgYmlsbCB3aXRoIGRvY3VtZW50IGluZm8gYW5kIEFJIGFuYWx5c2lzXG4gICAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IHVua25vd24gPSB7XG4gICAgICAgICAgZG9jdW1lbnRQYXRoLFxuICAgICAgICAgIGRvY3VtZW50TmFtZTogcmVxLmZpbGUub3JpZ2luYWxuYW1lLFxuICAgICAgICAgIGlzQWlBbmFseXplZDogISFhbmFseXNpc1Jlc3VsdCxcbiAgICAgICAgICBhaUFuYWx5c2lzRGF0YTogYW5hbHlzaXNSZXN1bHQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9O1xuXG4gICAgICAgIGNvbnN0IHVwZGF0ZWRCaWxsID0gYXdhaXQgZGJcbiAgICAgICAgICAudXBkYXRlKGJpbGxzKVxuICAgICAgICAgIC5zZXQodXBkYXRlRGF0YSlcbiAgICAgICAgICAud2hlcmUoZXEoYmlsbHMuaWQsIGlkKSlcbiAgICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgICAgLy8gQ2xlYW4gdXAgdGVtcG9yYXJ5IGZpbGVcbiAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcblxuICAgICAgICByZXMuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0RvY3VtZW50IHVwbG9hZGVkIGFuZCBhbmFseXplZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICAgIGJpbGw6IHVwZGF0ZWRCaWxsWzBdLFxuICAgICAgICAgIGFuYWx5c2lzUmVzdWx0LFxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKF9lcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGxvYWRpbmcgZG9jdW1lbnQ6JywgX2Vycm9yKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSBmaWxlIGlmIGl0IGV4aXN0c1xuICAgICAgICBpZiAocmVxLmZpbGU/LnBhdGgpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgZnMudW5saW5rU3luYyhyZXEuZmlsZS5wYXRoKTtcbiAgICAgICAgICB9IGNhdGNoIChfX19jbGVhbnVwRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNsZWFuaW5nIHVwIHRlbXAgZmlsZTonLCBfX19jbGVhbnVwRXJyb3IpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwbG9hZCBkb2N1bWVudCcsXG4gICAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG4gICk7XG5cbiAgLyoqXG4gICAqIERvd25sb2FkIGJpbGwgZG9jdW1lbnQgdXNpbmcgc2VjdXJlIHNpZ25lZCBVUkxcbiAgICogR0VUIC9hcGkvYmlsbHMvOmlkL2Rvd25sb2FkLWRvY3VtZW50LlxuICAgKi9cbiAgYXBwLmdldCgnL2FwaS9iaWxscy86aWQvZG93bmxvYWQtZG9jdW1lbnQnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+TsSBbU0VSVkVSIERFQlVHXSBEb2N1bWVudCBkb3dubG9hZCByZXF1ZXN0ZWQgZm9yIGJpbGwgSUQ6JywgcmVxLnBhcmFtcy5pZCk7XG4gICAgICBjb25zdCB7IGlkIH0gPSByZXEucGFyYW1zO1xuXG4gICAgICAvLyBHZXQgdGhlIGJpbGwgdG8gY2hlY2sgaWYgaXQgaGFzIGEgZG9jdW1lbnRcbiAgICAgIGNvbnN0IGJpbGwgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKGJpbGxzKS53aGVyZShlcShiaWxscy5pZCwgaWQpKS5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbU0VSVkVSIERFQlVHXSBCaWxsIG5vdCBmb3VuZCBmb3IgZG9jdW1lbnQgZG93bmxvYWQ6JywgaWQpO1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnQmlsbCBub3QgZm91bmQnIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBiaWxsRGF0YSA9IGJpbGxbMF07XG4gICAgICBjb25zb2xlLmxvZygn8J+ThCBbU0VSVkVSIERFQlVHXSBCaWxsIGZvdW5kIGZvciBkb2N1bWVudCBkb3dubG9hZDonLCB7XG4gICAgICAgIGlkOiBiaWxsRGF0YS5pZCxcbiAgICAgICAgZG9jdW1lbnRQYXRoOiBiaWxsRGF0YS5kb2N1bWVudFBhdGgsXG4gICAgICAgIGRvY3VtZW50TmFtZTogYmlsbERhdGEuZG9jdW1lbnROYW1lLFxuICAgICAgICBoYXNEb2N1bWVudDogISEoYmlsbERhdGEuZG9jdW1lbnRQYXRoICYmIGJpbGxEYXRhLmRvY3VtZW50TmFtZSlcbiAgICAgIH0pO1xuXG4gICAgICBpZiAoIWJpbGxEYXRhLmRvY3VtZW50UGF0aCB8fCAhYmlsbERhdGEuZG9jdW1lbnROYW1lKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbU0VSVkVSIERFQlVHXSBObyBkb2N1bWVudCBhc3NvY2lhdGVkIHdpdGggdGhpcyBiaWxsOicsIGlkKTtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ05vIGRvY3VtZW50IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGJpbGwnIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBHZXQgb3JnYW5pemF0aW9uIElEIGZvciBkb2N1bWVudCBhY2Nlc3NcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbnMgPSBhd2FpdCBzdG9yYWdlLmdldFVzZXJPcmdhbml6YXRpb25zKHJlcS51c2VyLmlkKTtcbiAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkID0gb3JnYW5pemF0aW9ucy5sZW5ndGggPiAwID8gb3JnYW5pemF0aW9uc1swXS5vcmdhbml6YXRpb25JZCA6ICdkZWZhdWx0JztcblxuICAgICAgLy8gRG9jdW1lbnQgZG93bmxvYWQgZnVuY3Rpb25hbGl0eSByZW1vdmVkIChubyBleHRlcm5hbCBzdG9yYWdlKVxuICAgICAgcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRG9jdW1lbnQgZG93bmxvYWQgZnVuY3Rpb25hbGl0eSBoYXMgYmVlbiBkaXNhYmxlZCcsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRvd25sb2FkaW5nIGRvY3VtZW50OicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2VuZXJhdGUgZG9jdW1lbnQgZG93bmxvYWQgVVJMJyxcbiAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogQXBwbHkgQUkgYW5hbHlzaXMgdG8gYmlsbCBmb3JtIGRhdGFcbiAgICogUE9TVCAvYXBpL2JpbGxzLzppZC9hcHBseS1haS1hbmFseXNpcy5cbiAgICovXG4gIGFwcC5wb3N0KCcvYXBpL2JpbGxzLzppZC9hcHBseS1haS1hbmFseXNpcycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIC8vIEdldCB0aGUgYmlsbCB3aXRoIEFJIGFuYWx5c2lzIGRhdGFcbiAgICAgIGNvbnN0IGJpbGwgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKGJpbGxzKS53aGVyZShlcShiaWxscy5pZCwgaWQpKS5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IG1lc3NhZ2U6ICdCaWxsIG5vdCBmb3VuZCcgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJpbGxEYXRhID0gYmlsbFswXTtcblxuICAgICAgaWYgKCFiaWxsRGF0YS5pc0FpQW5hbHl6ZWQgfHwgIWJpbGxEYXRhLmFpQW5hbHlzaXNEYXRhKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IG1lc3NhZ2U6ICdObyBBSSBhbmFseXNpcyBkYXRhIGF2YWlsYWJsZSBmb3IgdGhpcyBiaWxsJyB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYW5hbHlzaXMgPSBiaWxsRGF0YS5haUFuYWx5c2lzRGF0YSBhcyBhbnk7XG5cbiAgICAgIC8vIEdldCBwYXltZW50IHNjaGVkdWxlIHN1Z2dlc3Rpb25cbiAgICAgIGNvbnN0IHNjaGVkdWxlU2lnbmVzdGlvbiA9IGF3YWl0IGdlbWluaUJpbGxBbmFseXplci5zdWdnZXN0UGF5bWVudFNjaGVkdWxlKFxuICAgICAgICBhbmFseXNpcy5jYXRlZ29yeSxcbiAgICAgICAgcGFyc2VGbG9hdChhbmFseXNpcy50b3RhbEFtb3VudClcbiAgICAgICk7XG5cbiAgICAgIC8vIFVwZGF0ZSBiaWxsIHdpdGggQUktZXh0cmFjdGVkIGRhdGFcbiAgICAgIGNvbnN0IHVwZGF0ZURhdGE6IHVua25vd24gPSB7XG4gICAgICAgIHRpdGxlOiBhbmFseXNpcy50aXRsZSxcbiAgICAgICAgdmVuZG9yOiBhbmFseXNpcy52ZW5kb3IsXG4gICAgICAgIHRvdGFsQW1vdW50OiBwYXJzZUZsb2F0KGFuYWx5c2lzLnRvdGFsQW1vdW50KSxcbiAgICAgICAgY2F0ZWdvcnk6IGFuYWx5c2lzLmNhdGVnb3J5LFxuICAgICAgICBkZXNjcmlwdGlvbjogYW5hbHlzaXMuZGVzY3JpcHRpb24sXG4gICAgICAgIHBheW1lbnRUeXBlOiBzY2hlZHVsZVNpZ25lc3Rpb24ucGF5bWVudFR5cGUsXG4gICAgICAgIHNjaGVkdWxlUGF5bWVudDogc2NoZWR1bGVTaWduZXN0aW9uLnNjaGVkdWxlUGF5bWVudCxcbiAgICAgICAgY29zdHM6IFtwYXJzZUZsb2F0KGFuYWx5c2lzLnRvdGFsQW1vdW50KV0sXG4gICAgICAgIHN0YXJ0RGF0ZTogYW5hbHlzaXMuaXNzdWVEYXRlIHx8IGFuYWx5c2lzLmR1ZURhdGUgfHwgYmlsbERhdGEuc3RhcnREYXRlLFxuICAgICAgICBub3RlczogYEFJLWFuYWx5emVkIGRvY3VtZW50LiBPcmlnaW5hbCBiaWxsIG51bWJlcjogJHthbmFseXNpcy5iaWxsTnVtYmVyIHx8ICdOL0EnfS4gQ29uZmlkZW5jZTogJHsoYW5hbHlzaXMuY29uZmlkZW5jZSAqIDEwMCkudG9GaXhlZCgxKX0lLiAke3NjaGVkdWxlU2lnbmVzdGlvbi5yZWFzb25pbmd9YCxcbiAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdXBkYXRlZEJpbGwgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKGJpbGxzKVxuICAgICAgICAuc2V0KHVwZGF0ZURhdGEpXG4gICAgICAgIC53aGVyZShlcShiaWxscy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgbWVzc2FnZTogJ0FJIGFuYWx5c2lzIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgYmlsbDogdXBkYXRlZEJpbGxbMF0sXG4gICAgICAgIGFuYWx5c2lzLFxuICAgICAgICBzY2hlZHVsZVNpZ25lc3Rpb24sXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGFwcGx5aW5nIEFJIGFuYWx5c2lzOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gYXBwbHkgQUkgYW5hbHlzaXMnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBmdXR1cmUgYmlsbCBpbnN0YW5jZXMgZm9yIGEgcmVjdXJyZW50IGJpbGxcbiAgICogUE9TVCAvYXBpL2JpbGxzLzppZC9nZW5lcmF0ZS1mdXR1cmUuXG4gICAqL1xuICBhcHAucG9zdCgnL2FwaS9iaWxscy86aWQvZ2VuZXJhdGUtZnV0dXJlJywgcmVxdWlyZUF1dGgsIGFzeW5jIChyZXE6IGFueSwgcmVzOiBhbnkpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBpZCB9ID0gcmVxLnBhcmFtcztcblxuICAgICAgY29uc3QgYmlsbCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgIGlkOiBiaWxscy5pZCxcbiAgICAgICAgICBidWlsZGluZ0lkOiBiaWxscy5idWlsZGluZ0lkLFxuICAgICAgICAgIGJpbGxOdW1iZXI6IGJpbGxzLmJpbGxOdW1iZXIsXG4gICAgICAgICAgdGl0bGU6IGJpbGxzLnRpdGxlLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiBiaWxscy5kZXNjcmlwdGlvbixcbiAgICAgICAgICBjYXRlZ29yeTogYmlsbHMuY2F0ZWdvcnksXG4gICAgICAgICAgdmVuZG9yOiBiaWxscy52ZW5kb3IsXG4gICAgICAgICAgcGF5bWVudFR5cGU6IGJpbGxzLnBheW1lbnRUeXBlLFxuICAgICAgICAgIGNvc3RzOiBiaWxscy5jb3N0cyxcbiAgICAgICAgICB0b3RhbEFtb3VudDogYmlsbHMudG90YWxBbW91bnQsXG4gICAgICAgICAgc3RhcnREYXRlOiBiaWxscy5zdGFydERhdGUsXG4gICAgICAgICAgc3RhdHVzOiBiaWxscy5zdGF0dXMsXG4gICAgICAgICAgbm90ZXM6IGJpbGxzLm5vdGVzLFxuICAgICAgICAgIGNyZWF0ZWRCeTogYmlsbHMuY3JlYXRlZEJ5LFxuICAgICAgICAgIGNyZWF0ZWRBdDogYmlsbHMuY3JlYXRlZEF0LFxuICAgICAgICAgIHVwZGF0ZWRBdDogYmlsbHMudXBkYXRlZEF0LFxuICAgICAgICB9KVxuICAgICAgICAuZnJvbShiaWxscylcbiAgICAgICAgLndoZXJlKGVxKGJpbGxzLmlkLCBpZCkpXG4gICAgICAgIC5saW1pdCgxKTtcblxuICAgICAgaWYgKGJpbGwubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0JpbGwgbm90IGZvdW5kJyxcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGFjY2VzcyB0byB0aGlzIGJpbGwncyBidWlsZGluZ1xuICAgICAgY29uc3QgYnVpbGRpbmcgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYnVpbGRpbmdzLmlkLFxuICAgICAgICAgIG5hbWU6IGJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBidWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJ1aWxkaW5ncylcbiAgICAgICAgLndoZXJlKGVxKGJ1aWxkaW5ncy5pZCwgYmlsbFswXS5idWlsZGluZ0lkKSlcbiAgICAgICAgLmxpbWl0KDEpO1xuXG4gICAgICBpZiAoYnVpbGRpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XG4gICAgICAgICAgbWVzc2FnZTogJ0FjY2VzcyBkZW5pZWQgdG8gZ2VuZXJhdGUgZnV0dXJlIGJpbGxzJyxcbiAgICAgICAgICBjb2RlOiAnQUNDRVNTX0RFTklFRCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoYmlsbFswXS5wYXltZW50VHlwZSAhPT0gJ3JlY3VycmVudCcpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnT25seSByZWN1cnJlbnQgYmlsbHMgY2FuIGdlbmVyYXRlIGZ1dHVyZSBpbnN0YW5jZXMnLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gR2VuZXJhdGUgZnV0dXJlIGJpbGxzXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBiaWxsR2VuZXJhdGlvblNlcnZpY2UuZ2VuZXJhdGVGdXR1cmVCaWxsSW5zdGFuY2VzKGJpbGxbMF0gYXMgYW55KTtcblxuICAgICAgcmVzLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRnV0dXJlIGJpbGxzIGdlbmVyYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgICAgICBiaWxsc0NyZWF0ZWQ6IHJlc3VsdC5iaWxsc0NyZWF0ZWQsXG4gICAgICAgIGdlbmVyYXRlZFVudGlsOiByZXN1bHQuZ2VuZXJhdGVkVW50aWwsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdlbmVyYXRpbmcgZnV0dXJlIGJpbGxzOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2VuZXJhdGUgZnV0dXJlIGJpbGxzJyxcbiAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogR2V0IGJpbGwgY2F0ZWdvcmllcyBmb3IgZmlsdGVyIGRyb3Bkb3duXG4gICAqIEdFVCAvYXBpL2JpbGxzL2NhdGVnb3JpZXMuXG4gICAqL1xuICBhcHAuZ2V0KCcvYXBpL2JpbGxzL2NhdGVnb3JpZXMnLCByZXF1aXJlQXV0aCwgYXN5bmMgKHJlcTogYW55LCByZXM6IGFueSkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjYXRlZ29yaWVzID0gW1xuICAgICAgICAnaW5zdXJhbmNlJyxcbiAgICAgICAgJ21haW50ZW5hbmNlJyxcbiAgICAgICAgJ3NhbGFyeScsXG4gICAgICAgICd1dGlsaXRpZXMnLFxuICAgICAgICAnY2xlYW5pbmcnLFxuICAgICAgICAnc2VjdXJpdHknLFxuICAgICAgICAnbGFuZHNjYXBpbmcnLFxuICAgICAgICAncHJvZmVzc2lvbmFsX3NlcnZpY2VzJyxcbiAgICAgICAgJ2FkbWluaXN0cmF0aW9uJyxcbiAgICAgICAgJ3JlcGFpcnMnLFxuICAgICAgICAnc3VwcGxpZXMnLFxuICAgICAgICAndGF4ZXMnLFxuICAgICAgICAndGVjaG5vbG9neScsXG4gICAgICAgICdyZXNlcnZlcycsXG4gICAgICAgICdvdGhlcicsXG4gICAgICBdO1xuXG4gICAgICByZXMuanNvbihjYXRlZ29yaWVzKTtcbiAgICB9IGNhdGNoIChfZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGJpbGwgY2F0ZWdvcmllczonLCBfZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGZldGNoIGJpbGwgY2F0ZWdvcmllcycsXG4gICAgICAgIF9lcnJvcjogX2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBfZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG5cbiAgLyoqXG4gICAqIEdldCBzdGF0aXN0aWNzIGZvciBhdXRvLWdlbmVyYXRlZCBiaWxscyBmcm9tIGEgcGFyZW50IGJpbGxcbiAgICogR0VUIC9hcGkvYmlsbHMvOmlkL2dlbmVyYXRlZC1zdGF0cy5cbiAgICovXG4gIGFwcC5nZXQoJy9hcGkvYmlsbHMvOmlkL2dlbmVyYXRlZC1zdGF0cycsIHJlcXVpcmVBdXRoLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgaWQgfSA9IHJlcS5wYXJhbXM7XG5cbiAgICAgIGNvbnN0IGJpbGwgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICBpZDogYmlsbHMuaWQsXG4gICAgICAgICAgYnVpbGRpbmdJZDogYmlsbHMuYnVpbGRpbmdJZCxcbiAgICAgICAgICBiaWxsTnVtYmVyOiBiaWxscy5iaWxsTnVtYmVyLFxuICAgICAgICAgIHRpdGxlOiBiaWxscy50aXRsZSxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYmlsbHMuZGVzY3JpcHRpb24sXG4gICAgICAgICAgY2F0ZWdvcnk6IGJpbGxzLmNhdGVnb3J5LFxuICAgICAgICAgIHZlbmRvcjogYmlsbHMudmVuZG9yLFxuICAgICAgICAgIHBheW1lbnRUeXBlOiBiaWxscy5wYXltZW50VHlwZSxcbiAgICAgICAgICBjb3N0czogYmlsbHMuY29zdHMsXG4gICAgICAgICAgdG90YWxBbW91bnQ6IGJpbGxzLnRvdGFsQW1vdW50LFxuICAgICAgICAgIHN0YXJ0RGF0ZTogYmlsbHMuc3RhcnREYXRlLFxuICAgICAgICAgIHN0YXR1czogYmlsbHMuc3RhdHVzLFxuICAgICAgICAgIG5vdGVzOiBiaWxscy5ub3RlcyxcbiAgICAgICAgICBjcmVhdGVkQnk6IGJpbGxzLmNyZWF0ZWRCeSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IGJpbGxzLmNyZWF0ZWRBdCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGJpbGxzLnVwZGF0ZWRBdCxcbiAgICAgICAgfSlcbiAgICAgICAgLmZyb20oYmlsbHMpXG4gICAgICAgIC53aGVyZShlcShiaWxscy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIGlmIChiaWxsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xuICAgICAgICAgIG1lc3NhZ2U6ICdCaWxsIG5vdCBmb3VuZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5kIGFsbCBiaWxscyBnZW5lcmF0ZWQgZnJvbSB0aGlzIHBhcmVudCBiaWxsIChsb29rIGZvciBhdXRvLWdlbmVyYXRlZCBiaWxscylcbiAgICAgIGNvbnN0IGdlbmVyYXRlZEJpbGxzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgaWQ6IGJpbGxzLmlkLFxuICAgICAgICAgIGJ1aWxkaW5nSWQ6IGJpbGxzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgYmlsbE51bWJlcjogYmlsbHMuYmlsbE51bWJlcixcbiAgICAgICAgICB0aXRsZTogYmlsbHMudGl0bGUsXG4gICAgICAgICAgZGVzY3JpcHRpb246IGJpbGxzLmRlc2NyaXB0aW9uLFxuICAgICAgICAgIGNhdGVnb3J5OiBiaWxscy5jYXRlZ29yeSxcbiAgICAgICAgICB2ZW5kb3I6IGJpbGxzLnZlbmRvcixcbiAgICAgICAgICBwYXltZW50VHlwZTogYmlsbHMucGF5bWVudFR5cGUsXG4gICAgICAgICAgY29zdHM6IGJpbGxzLmNvc3RzLFxuICAgICAgICAgIHRvdGFsQW1vdW50OiBiaWxscy50b3RhbEFtb3VudCxcbiAgICAgICAgICBzdGFydERhdGU6IGJpbGxzLnN0YXJ0RGF0ZSxcbiAgICAgICAgICBzdGF0dXM6IGJpbGxzLnN0YXR1cyxcbiAgICAgICAgICBub3RlczogYmlsbHMubm90ZXMsXG4gICAgICAgICAgY3JlYXRlZEJ5OiBiaWxscy5jcmVhdGVkQnksXG4gICAgICAgICAgY3JlYXRlZEF0OiBiaWxscy5jcmVhdGVkQXQsXG4gICAgICAgICAgdXBkYXRlZEF0OiBiaWxscy51cGRhdGVkQXQsXG4gICAgICAgIH0pXG4gICAgICAgIC5mcm9tKGJpbGxzKVxuICAgICAgICAud2hlcmUoc3FsYGJpbGxzLm5vdGVzIExJS0UgJyVBdXRvLWdlbmVyYXRlZCBmcm9tOiUnYClcbiAgICAgICAgLm9yZGVyQnkoYmlsbHMuc3RhcnREYXRlKTtcblxuICAgICAgY29uc3Qgc3RhdHMgPSBnZW5lcmF0ZWRCaWxscy5tYXAoKGdlbkJpbGwpID0+ICh7XG4gICAgICAgIGlkOiBnZW5CaWxsLmlkLFxuICAgICAgICB0aXRsZTogZ2VuQmlsbC50aXRsZSxcbiAgICAgICAgYW1vdW50OiBnZW5CaWxsLnRvdGFsQW1vdW50LFxuICAgICAgICBzdGFydERhdGU6IGdlbkJpbGwuc3RhcnREYXRlLFxuICAgICAgICBzdGF0dXM6IGdlbkJpbGwuc3RhdHVzLFxuICAgICAgICBiaWxsTnVtYmVyOiBnZW5CaWxsLmJpbGxOdW1iZXIsXG4gICAgICB9KSk7XG5cbiAgICAgIHJlcy5qc29uKHtcbiAgICAgICAgcGFyZW50QmlsbDogYmlsbFswXSxcbiAgICAgICAgZ2VuZXJhdGVkQmlsbHM6IHN0YXRzLFxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIGdlbmVyYXRlZCBiaWxscyBzdGF0aXN0aWNzOicsIF9lcnJvcik7XG4gICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gZ2V0IGdlbmVyYXRlZCBiaWxscyBzdGF0aXN0aWNzJyxcbiAgICAgICAgX2Vycm9yOiBfZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IF9lcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvKipcbiAgICogQW5hbHl6ZSBkb2N1bWVudCB3aXRob3V0IGNyZWF0aW5nIGEgYmlsbFxuICAgKiBQT1NUIC9hcGkvYmlsbHMvYW5hbHl6ZS1kb2N1bWVudFxuICAgKi9cbiAgYXBwLnBvc3QoJy9hcGkvYmlsbHMvYW5hbHl6ZS1kb2N1bWVudCcsIHJlcXVpcmVBdXRoLCB1cGxvYWQuc2luZ2xlKCdkb2N1bWVudCcpLCBhc3luYyAocmVxOiBhbnksIHJlczogYW55KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghcmVxLmZpbGUpIHtcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICBtZXNzYWdlOiAnTm8gZG9jdW1lbnQgZmlsZSBwcm92aWRlZCcsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IGdlbWluaUJpbGxBbmFseXplci5hbmFseXplQmlsbERvY3VtZW50KHJlcS5maWxlLnBhdGgpO1xuICAgICAgXG4gICAgICByZXMuanNvbihhbmFseXNpcyk7XG4gICAgfSBjYXRjaCAoX2Vycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGFuYWx5emluZyBkb2N1bWVudDonLCBfZXJyb3IpO1xuICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGFuYWx5emUgZG9jdW1lbnQnLFxuICAgICAgICBfZXJyb3I6IF9lcnJvciBpbnN0YW5jZW9mIEVycm9yID8gX2Vycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sInZlcnNpb24iOjN9