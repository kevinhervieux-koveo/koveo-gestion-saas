{"file":"/home/runner/workspace/client/src/components/invoice-management/InvoiceCard.tsx","mappings":"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","names":[],"sources":["/home/runner/workspace/client/src/components/invoice-management/InvoiceCard.tsx"],"sourcesContent":["import React, { useState } from 'react';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { Button } from '@/components/ui/button';\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from '@/components/ui/dialog';\nimport { \n  MoreHorizontal, \n  Edit2, \n  Trash2, \n  FileText, \n  Calendar,\n  DollarSign,\n  Building,\n  Eye\n} from 'lucide-react';\nimport { format } from 'date-fns';\nimport { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useToast } from '@/hooks/use-toast';\nimport { apiRequest } from '@/lib/queryClient';\nimport type { Invoice } from '@shared/schemas/invoices';\nimport { InvoiceForm } from './InvoiceForm';\nimport { DocumentCard } from '@/components/document-management/DocumentCard';\n\ninterface InvoiceCardProps {\n  invoice: Invoice;\n  onUpdate?: () => void;\n}\n\nexport function InvoiceCard({ invoice, onUpdate }: InvoiceCardProps) {\n  const [showEditDialog, setShowEditDialog] = useState(false);\n  const [showViewDialog, setShowViewDialog] = useState(false);\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest('DELETE', `/api/invoices/${invoice.id}`);\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || 'Failed to delete invoice');\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: 'Success',\n        description: 'Invoice deleted successfully',\n      });\n      queryClient.invalidateQueries({ queryKey: ['/api/invoices'] });\n      onUpdate?.();\n    },\n    onError: (error: Error) => {\n      toast({\n        title: 'Error',\n        description: error.message,\n        variant: 'destructive',\n      });\n    },\n  });\n\n  const handleDelete = () => {\n    if (window.confirm('Are you sure you want to delete this invoice? This action cannot be undone.')) {\n      deleteMutation.mutate();\n    }\n  };\n\n  const handleEditSuccess = () => {\n    setShowEditDialog(false);\n    onUpdate?.();\n  };\n\n  const getPaymentTypeVariant = (paymentType: string) => {\n    return paymentType === 'recurring' ? 'default' : 'secondary';\n  };\n\n  return (\n    <>\n      <Card className=\"hover:shadow-md transition-shadow\" data-testid={`invoice-card-${invoice.id}`}>\n        <CardHeader className=\"pb-3\">\n          <div className=\"flex items-start justify-between\">\n            <div className=\"space-y-1\">\n              <CardTitle className=\"text-lg font-semibold\">\n                {invoice.vendorName}\n              </CardTitle>\n              <p className=\"text-sm text-muted-foreground\">\n                #{invoice.invoiceNumber}\n              </p>\n            </div>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button \n                  variant=\"ghost\" \n                  size=\"sm\"\n                  data-testid={`button-actions-${invoice.id}`}\n                >\n                  <MoreHorizontal className=\"w-4 h-4\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent align=\"end\">\n                <DropdownMenuItem onClick={() => setShowViewDialog(true)}>\n                  <Eye className=\"w-4 h-4 mr-2\" />\n                  View Details\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => setShowEditDialog(true)}>\n                  <Edit2 className=\"w-4 h-4 mr-2\" />\n                  Edit\n                </DropdownMenuItem>\n                <DropdownMenuItem \n                  onClick={handleDelete}\n                  className=\"text-destructive focus:text-destructive\"\n                  disabled={deleteMutation.isPending}\n                >\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                  Delete\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </CardHeader>\n\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-2\">\n              <DollarSign className=\"w-4 h-4 text-muted-foreground\" />\n              <span className=\"font-semibold text-lg\">\n                ${parseFloat(invoice.totalAmount.toString()).toFixed(2)}\n              </span>\n            </div>\n            <Badge variant={getPaymentTypeVariant(invoice.paymentType)}>\n              {invoice.paymentType === 'recurring' ? 'Recurring' : 'One-time'}\n            </Badge>\n          </div>\n\n          <div className=\"space-y-2 text-sm\">\n            <div className=\"flex items-center gap-2\">\n              <Calendar className=\"w-4 h-4 text-muted-foreground\" />\n              <span>Due: {format(new Date(invoice.dueDate), 'MMM dd, yyyy')}</span>\n            </div>\n            \n            {invoice.frequency && (\n              <div className=\"flex items-center gap-2\">\n                <span className=\"w-4 h-4\" />\n                <span className=\"text-muted-foreground\">\n                  {invoice.frequency.charAt(0).toUpperCase() + invoice.frequency.slice(1)}\n                </span>\n              </div>\n            )}\n\n            {invoice.buildingId && (\n              <div className=\"flex items-center gap-2\">\n                <Building className=\"w-4 h-4 text-muted-foreground\" />\n                <span className=\"text-muted-foreground truncate\">\n                  Building ID: {invoice.buildingId.slice(0, 8)}...\n                </span>\n              </div>\n            )}\n          </div>\n\n          {invoice.documentId && (\n            <div className=\"pt-2 border-t\">\n              <div className=\"flex items-center gap-2 text-sm text-muted-foreground\">\n                <FileText className=\"w-4 h-4\" />\n                <span>Document attached</span>\n                {invoice.isAiExtracted && (\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    AI Processed\n                  </Badge>\n                )}\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Edit Dialog */}\n      <Dialog open={showEditDialog} onOpenChange={setShowEditDialog}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Edit Invoice</DialogTitle>\n          </DialogHeader>\n          <InvoiceForm\n            mode=\"edit\"\n            invoice={invoice}\n            onSuccess={handleEditSuccess}\n            onCancel={() => setShowEditDialog(false)}\n          />\n        </DialogContent>\n      </Dialog>\n\n      {/* View Dialog */}\n      <Dialog open={showViewDialog} onOpenChange={setShowViewDialog}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle>Invoice Details</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-6\">\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div>\n                <h4 className=\"font-medium mb-2\">Vendor Information</h4>\n                <p className=\"text-sm text-muted-foreground\">Vendor: {invoice.vendorName}</p>\n                <p className=\"text-sm text-muted-foreground\">Invoice #: {invoice.invoiceNumber}</p>\n              </div>\n              <div>\n                <h4 className=\"font-medium mb-2\">Payment Information</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Amount: ${parseFloat(invoice.totalAmount.toString()).toFixed(2)}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Due: {format(new Date(invoice.dueDate), 'PPP')}\n                </p>\n                <p className=\"text-sm text-muted-foreground\">\n                  Type: {invoice.paymentType}\n                </p>\n                {invoice.frequency && (\n                  <p className=\"text-sm text-muted-foreground\">\n                    Frequency: {invoice.frequency}\n                  </p>\n                )}\n              </div>\n            </div>\n\n            {invoice.documentId && (\n              <div>\n                <h4 className=\"font-medium mb-4\">Attached Document</h4>\n                <DocumentCard\n                  documentId={invoice.documentId}\n                  showRemove={false}\n                />\n              </div>\n            )}\n\n            {invoice.isAiExtracted && invoice.extractionConfidence && (\n              <div className=\"bg-muted/50 p-4 rounded-lg\">\n                <h4 className=\"font-medium mb-2\">AI Extraction Info</h4>\n                <p className=\"text-sm text-muted-foreground\">\n                  Confidence: {(parseFloat(invoice.extractionConfidence.toString()) * 100).toFixed(1)}%\n                </p>\n              </div>\n            )}\n\n            <div className=\"text-xs text-muted-foreground\">\n              <p>Created: {format(new Date(invoice.createdAt), 'PPP pp')}</p>\n              <p>Updated: {format(new Date(invoice.updatedAt), 'PPP pp')}</p>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n    </>\n  );\n}"],"version":3}