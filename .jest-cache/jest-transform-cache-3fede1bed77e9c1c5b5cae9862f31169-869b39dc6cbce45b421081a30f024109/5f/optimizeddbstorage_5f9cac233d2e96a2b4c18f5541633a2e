debc4b65069338b253c25a73aabc0ec8
"use strict";
/**
 * Optimized database storage with caching and performance monitoring.
 * Replaces decorators with direct implementation for better compatibility.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.OptimizedDatabaseStorage = void 0;
const drizzle_orm_1 = require("drizzle-orm");
// Use shared database connection to avoid multiple pools in production
const db_1 = require("./db");
const crypto_1 = __importDefault(require("crypto"));
const schema = __importStar(require("@shared/schema"));
const database_optimization_1 = require("./database-optimization");
const query_cache_1 = require("./query-cache");
const performance_monitoring_1 = require("./performance-monitoring");
const drizzle_orm_2 = require("drizzle-orm");
// Database connection imported from shared db.ts
/**
 * Enhanced database storage with built-in caching and performance monitoring.
 */
class OptimizedDatabaseStorage {
    /**
     *
     */
    constructor() {
        // Skip optimizations in test environment
        if (process.env.TEST_ENV !== 'integration' &&
            !process.env.DISABLE_DB_OPTIMIZATIONS &&
            process.env.NODE_ENV !== 'test' &&
            !process.env.JEST_WORKER_ID) {
            this.initializeOptimizations();
        }
    }
    /**
     * Initializes database optimizations.
     */
    async initializeOptimizations() {
        // Skip database optimization during tests
        if (process.env.NODE_ENV === 'test' ||
            process.env.JEST_WORKER_ID ||
            process.env.SKIP_DB_OPTIMIZATION) {
            // Database optimizations skipped in test environment
            return;
        }
        try {
            await database_optimization_1.QueryOptimizer.applyCoreOptimizations();
            // Database optimizations applied
        }
        catch (error) {
            console.error('‚ùå Error initializing database optimizations:', error);
        }
    }
    /**
     * Wrapper for performance tracking and caching.
     * @param operation
     * @param cacheKey
     * @param cacheType
     * @param fn
     */
    async withOptimizations(operation, cacheKey, cacheType, fn) {
        // Try cache first
        if (cacheKey) {
            const cached = query_cache_1.queryCache.get(cacheType, cacheKey);
            if (cached !== undefined) {
                return cached;
            }
        }
        // Execute with performance tracking
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery(operation, fn);
        // Cache result
        if (cacheKey && result !== undefined) {
            query_cache_1.queryCache.set(cacheType, cacheKey, result);
        }
        return result;
    }
    // User operations with optimization
    /**
     * Retrieves all active users with caching and performance tracking.
     */
    async getUsers() {
        return this.withOptimizations('getUsers', 'all_users', 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .limit(100) // Always use LIMIT for large result sets
            .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt)));
    }
    /**
     * Retrieves all active users with their assignments (organizations, buildings, residences).
     * OPTIMIZED: Uses single query with JOINs and aggregation instead of N+1 queries.
     */
    async getUsersWithAssignments() {
        return this.withOptimizations('getUsersWithAssignments', 'all_users_assignments_optimized_v4', 'users', async () => {
            try {
                // Single optimized query using CTEs and aggregation
                const result = await db_1.db.execute((0, drizzle_orm_1.sql) `
            WITH user_orgs AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', o.id,
                      'name', o.name,
                      'type', o.type
                    )
                  ) FILTER (WHERE o.id IS NOT NULL),
                  '[]'::json
                ) as organizations
              FROM user_organizations uo
              INNER JOIN organizations o ON uo.organization_id = o.id
              WHERE uo.is_active = true AND o.is_active = true
              GROUP BY uo.user_id
            ),
            user_buildings AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', buildings_distinct.id,
                      'name', buildings_distinct.name
                    )
                  ),
                  '[]'::json
                ) as buildings
              FROM user_organizations uo
              INNER JOIN (
                SELECT DISTINCT uo2.user_id, b.id, b.name
                FROM user_organizations uo2
                INNER JOIN buildings b ON uo2.organization_id = b.organization_id
                WHERE uo2.is_active = true AND b.is_active = true
              ) buildings_distinct ON uo.user_id = buildings_distinct.user_id
              WHERE uo.is_active = true
              GROUP BY uo.user_id
            ),
            user_residences AS (
              SELECT 
                ur.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', r.id,
                      'unitNumber', r.unit_number,
                      'buildingId', r.building_id,
                      'buildingName', b.name
                    )
                  ) FILTER (WHERE r.id IS NOT NULL),
                  '[]'::json
                ) as residences
              FROM user_residences ur
              INNER JOIN residences r ON ur.residence_id = r.id
              INNER JOIN buildings b ON r.building_id = b.id
              WHERE ur.is_active = true AND r.is_active = true
              GROUP BY ur.user_id
            )
            SELECT 
              u.*,
              COALESCE(uo.organizations, '[]'::json) as organizations,
              COALESCE(ub.buildings, '[]'::json) as buildings,
              COALESCE(ur.residences, '[]'::json) as residences
            FROM users u
            LEFT JOIN user_orgs uo ON u.id = uo.user_id
            LEFT JOIN user_buildings ub ON u.id = ub.user_id
            LEFT JOIN user_residences ur ON u.id = ur.user_id
            WHERE u.is_active = true
            ORDER BY u.created_at DESC
            LIMIT 100
          `);
                // Transform the raw SQL result to match the expected TypeScript types
                return result.rows.map((row) => ({
                    id: row.id,
                    username: row.username,
                    password: row.password,
                    email: row.email,
                    firstName: row.first_name,
                    lastName: row.last_name,
                    phone: row.phone,
                    profileImage: row.profile_image,
                    language: row.language,
                    role: row.role,
                    isActive: row.is_active,
                    lastLoginAt: row.last_login_at,
                    createdAt: row.created_at,
                    updatedAt: row.updated_at,
                    organizations: typeof row.organizations === 'string'
                        ? JSON.parse(row.organizations)
                        : row.organizations || [],
                    buildings: typeof row.buildings === 'string'
                        ? JSON.parse(row.buildings)
                        : row.buildings || [],
                    residences: typeof row.residences === 'string'
                        ? JSON.parse(row.residences)
                        : row.residences || []
                }));
            }
            catch (error) {
                console.error('‚ùå Error in optimized getUsersWithAssignments:', error);
                // Fallback to the original implementation if optimized query fails
                console.log('üîÑ Falling back to original implementation...');
                return this.getUsersWithAssignmentsFallback();
            }
        });
    }
    /**
     * Retrieves paginated active users with their assignments (organizations, buildings, residences).
     * OPTIMIZED: Uses single query with JOINs, aggregation, and LIMIT/OFFSET for pagination.
     */
    async getUsersWithAssignmentsPaginated(offset = 0, limit = 10, filters = {}) {
        return this.withOptimizations('getUsersWithAssignmentsPaginated', `paginated_users_${offset}_${limit}_${JSON.stringify(filters)}_v4`, 'users', async () => {
            try {
                console.log('üîç [DB FILTER] Input filters:', JSON.stringify(filters, null, 2));
                // Build WHERE conditions for filtering
                let whereConditions = [];
                let countWhereConditions = [];
                if (filters.role) {
                    if (filters.role === 'null') {
                        whereConditions.push('u.role IS NULL');
                        countWhereConditions.push('role IS NULL');
                    }
                    else {
                        whereConditions.push(`u.role = '${filters.role}'`);
                        countWhereConditions.push(`role = '${filters.role}'`);
                    }
                }
                if (filters.status) {
                    if (filters.status === 'null') {
                        whereConditions.push('u.is_active IS NULL');
                        countWhereConditions.push('is_active IS NULL');
                    }
                    else {
                        const isActive = filters.status === 'true';
                        whereConditions.push(`u.is_active = ${isActive}`);
                        countWhereConditions.push(`is_active = ${isActive}`);
                    }
                }
                else {
                    // Default: only show active users if no status filter is applied
                    whereConditions.push('u.is_active = true');
                    countWhereConditions.push('is_active = true');
                }
                // Demo-only filter for demo users
                if (filters.demoOnly === 'true') {
                    whereConditions.push("(u.role LIKE 'demo_%')");
                    countWhereConditions.push("(role LIKE 'demo_%')");
                }
                // Search filter for name/email
                if (filters.search && filters.search.trim()) {
                    const searchTerm = filters.search.trim().toLowerCase();
                    whereConditions.push(`(
              LOWER(u.first_name || ' ' || u.last_name) LIKE '%${searchTerm}%' OR 
              LOWER(u.email) LIKE '%${searchTerm}%' OR 
              LOWER(u.username) LIKE '%${searchTerm}%'
            )`);
                    countWhereConditions.push(`(
              LOWER(first_name || ' ' || last_name) LIKE '%${searchTerm}%' OR 
              LOWER(email) LIKE '%${searchTerm}%' OR 
              LOWER(username) LIKE '%${searchTerm}%'
            )`);
                    console.log('üîç [SEARCH FILTER] Applied search for:', searchTerm);
                }
                // Manager organizations filter - only show users from specific organizations
                if (filters.managerOrganizations && filters.managerOrganizations.trim()) {
                    const orgIds = filters.managerOrganizations.split(',').map(id => `'${id.trim()}'`).join(',');
                    whereConditions.push(`EXISTS (
              SELECT 1 FROM user_organizations uo_mgr 
              WHERE uo_mgr.user_id = u.id 
              AND uo_mgr.organization_id IN (${orgIds})
              AND uo_mgr.is_active = true
            )`);
                    countWhereConditions.push(`EXISTS (
              SELECT 1 FROM user_organizations uo_mgr 
              WHERE uo_mgr.user_id = users.id 
              AND uo_mgr.organization_id IN (${orgIds})
              AND uo_mgr.is_active = true
            )`);
                    console.log('üëî [MANAGER FILTER] Applied organization filter for:', orgIds);
                }
                // First get total count for pagination metadata with filters
                const countQuery = `
            SELECT COUNT(*) as total 
            FROM users 
            WHERE ${countWhereConditions.length > 0 ? countWhereConditions.join(' AND ') : '1=1'}
            ${filters.organization && filters.organization.trim() ? `AND EXISTS (
              SELECT 1 FROM user_organizations uo_filter 
              WHERE uo_filter.user_id = users.id 
              AND uo_filter.organization_id = '${filters.organization.trim()}'
              AND uo_filter.is_active = true
            )` : ''}
            ${!filters.organization && filters.orphan === 'true' ? `AND NOT EXISTS (
              SELECT 1 FROM user_organizations uo_count_orphan 
              WHERE uo_count_orphan.user_id = users.id AND uo_count_orphan.is_active = true
            ) AND NOT EXISTS (
              SELECT 1 FROM user_residences ur_count_orphan 
              WHERE ur_count_orphan.user_id = users.id AND ur_count_orphan.is_active = true
            )` : ''}
            ${!filters.organization && filters.orphan === 'false' ? `AND (EXISTS (
              SELECT 1 FROM user_organizations uo_count_assigned 
              WHERE uo_count_assigned.user_id = users.id AND uo_count_assigned.is_active = true
            ) OR EXISTS (
              SELECT 1 FROM user_residences ur_count_assigned 
              WHERE ur_count_assigned.user_id = users.id AND ur_count_assigned.is_active = true
            ))` : ''}
            ${filters.search && filters.search.trim() ? `AND (
              LOWER(first_name || ' ' || last_name) LIKE '%${filters.search.trim().toLowerCase()}%' OR 
              LOWER(email) LIKE '%${filters.search.trim().toLowerCase()}%' OR 
              LOWER(username) LIKE '%${filters.search.trim().toLowerCase()}%'
            )` : ''}
          `;
                console.log('üìä [COUNT SQL]:', countQuery);
                const countResult = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
                const total = parseInt(countResult.rows[0]?.total || '0');
                console.log('üìä [COUNT RESULT]:', total);
                // Single optimized query using CTEs and aggregation with pagination and filters
                const mainQuery = `
            WITH user_orgs AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', o.id,
                      'name', o.name,
                      'type', o.type
                    )
                  ) FILTER (WHERE o.id IS NOT NULL),
                  '[]'::json
                ) as organizations
              FROM user_organizations uo
              INNER JOIN organizations o ON uo.organization_id = o.id
              WHERE uo.is_active = true AND o.is_active = true
              GROUP BY uo.user_id
            ),
            user_buildings AS (
              SELECT 
                uo.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', buildings_distinct.id,
                      'name', buildings_distinct.name
                    )
                  ),
                  '[]'::json
                ) as buildings
              FROM user_organizations uo
              INNER JOIN (
                SELECT DISTINCT uo2.user_id, b.id, b.name
                FROM user_organizations uo2
                INNER JOIN buildings b ON uo2.organization_id = b.organization_id
                WHERE uo2.is_active = true AND b.is_active = true
              ) buildings_distinct ON uo.user_id = buildings_distinct.user_id
              WHERE uo.is_active = true
              GROUP BY uo.user_id
            ),
            user_residences AS (
              SELECT 
                ur.user_id,
                COALESCE(
                  json_agg(
                    json_build_object(
                      'id', r.id,
                      'unitNumber', r.unit_number,
                      'buildingId', r.building_id,
                      'buildingName', b.name
                    )
                  ) FILTER (WHERE r.id IS NOT NULL),
                  '[]'::json
                ) as residences
              FROM user_residences ur
              INNER JOIN residences r ON ur.residence_id = r.id
              INNER JOIN buildings b ON r.building_id = b.id
              WHERE ur.is_active = true AND r.is_active = true
              GROUP BY ur.user_id
            )
            SELECT 
              u.*,
              COALESCE(uo.organizations, '[]'::json) as organizations,
              COALESCE(ub.buildings, '[]'::json) as buildings,
              COALESCE(ur.residences, '[]'::json) as residences
            FROM users u
            LEFT JOIN user_orgs uo ON u.id = uo.user_id
            LEFT JOIN user_buildings ub ON u.id = ub.user_id
            LEFT JOIN user_residences ur ON u.id = ur.user_id
            WHERE ${whereConditions.length > 0 ? whereConditions.join(' AND ') : '1=1'}
            ${filters.organization && filters.organization.trim() ? (() => {
                    console.log('üè¢ [ORG FILTER] Applying organization filter:', filters.organization.trim());
                    return `AND EXISTS (
                SELECT 1 FROM user_organizations uo_filter 
                WHERE uo_filter.user_id = u.id 
                AND uo_filter.organization_id = '${filters.organization.trim()}'
                AND uo_filter.is_active = true
              )`;
                })() : (() => {
                    console.log('üè¢ [ORG FILTER] No organization filter applied (empty or undefined)');
                    return '';
                })()}
            ${!filters.organization && filters.orphan === 'true' ? (() => {
                    console.log('üëª [ORPHAN FILTER] Applying orphan filter: true (users with no assignments)');
                    return `AND NOT EXISTS (
                SELECT 1 FROM user_organizations uo_filter_orphan 
                WHERE uo_filter_orphan.user_id = u.id AND uo_filter_orphan.is_active = true
              ) AND NOT EXISTS (
                SELECT 1 FROM user_residences ur_filter_orphan 
                WHERE ur_filter_orphan.user_id = u.id AND ur_filter_orphan.is_active = true
              )`;
                })() : !filters.organization && filters.orphan === 'false' ? (() => {
                    console.log('üëª [ORPHAN FILTER] Applying orphan filter: false (users with assignments)');
                    return `AND (EXISTS (
                SELECT 1 FROM user_organizations uo_filter_assigned 
                WHERE uo_filter_assigned.user_id = u.id AND uo_filter_assigned.is_active = true
              ) OR EXISTS (
                SELECT 1 FROM user_residences ur_filter_assigned 
                WHERE ur_filter_assigned.user_id = u.id AND ur_filter_assigned.is_active = true
              ))`;
                })() : filters.organization && filters.orphan ? (() => {
                    console.log('üëª [ORPHAN FILTER] Ignoring orphan filter - conflicts with organization filter');
                    return '';
                })() : (() => {
                    console.log('üëª [ORPHAN FILTER] No orphan filter applied (empty or undefined)');
                    return '';
                })()}
            ORDER BY u.created_at DESC
            LIMIT ${limit} OFFSET ${offset}
          `;
                console.log('üìä [MAIN SQL]:', mainQuery);
                const result = await db_1.db.execute(drizzle_orm_1.sql.raw(mainQuery));
                console.log('üìä [MAIN RESULT]:', result.rows.length, 'users found');
                // Transform the raw SQL result to match the expected TypeScript types
                const users = result.rows.map((row) => ({
                    id: row.id,
                    username: row.username,
                    password: row.password,
                    email: row.email,
                    firstName: row.first_name,
                    lastName: row.last_name,
                    phone: row.phone,
                    profileImage: row.profile_image,
                    language: row.language,
                    role: row.role,
                    isActive: row.is_active,
                    lastLoginAt: row.last_login_at,
                    createdAt: row.created_at,
                    updatedAt: row.updated_at,
                    organizations: typeof row.organizations === 'string'
                        ? JSON.parse(row.organizations)
                        : row.organizations || [],
                    buildings: typeof row.buildings === 'string'
                        ? JSON.parse(row.buildings)
                        : row.buildings || [],
                    residences: typeof row.residences === 'string'
                        ? JSON.parse(row.residences)
                        : row.residences || []
                }));
                return { users, total };
            }
            catch (error) {
                console.error('‚ùå Error in optimized getUsersWithAssignmentsPaginated:', error);
                // Fallback to paginated version of the original implementation if optimized query fails
                console.log('üîÑ Falling back to paginated original implementation...');
                return this.getUsersWithAssignmentsPaginatedFallback(offset, limit, filters);
            }
        });
    }
    /**
     * Fallback implementation for getUsersWithAssignments if optimized version fails.
     * This is the original N+1 query implementation kept for reliability.
     */
    async getUsersWithAssignmentsFallback() {
        try {
            // Get all users first
            const users = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
                .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt));
            // For each user, fetch their assignments with limited concurrency to prevent connection issues
            const batchSize = 5; // Process 5 users at a time to avoid connection pool exhaustion
            const usersWithAssignments = [];
            for (let i = 0; i < users.length; i += batchSize) {
                const batch = users.slice(i, i + batchSize);
                const batchResults = await Promise.all(batch.map(async (user) => {
                    try {
                        // Get user organizations
                        const userOrgs = await db_1.db
                            .select({
                            id: schema.organizations.id,
                            name: schema.organizations.name,
                            type: schema.organizations.type,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
                        // Get user buildings (through organization relationships)
                        const userBuildings = await db_1.db
                            .select({
                            id: schema.buildings.id,
                            name: schema.buildings.name,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.buildings.organizationId))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
                        // Get user residences
                        const userResidences = await db_1.db
                            .select({
                            id: schema.residences.id,
                            unitNumber: schema.residences.unitNumber,
                            buildingId: schema.residences.buildingId,
                            buildingName: schema.buildings.name,
                        })
                            .from(schema.userResidences)
                            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                        return {
                            ...user,
                            organizations: userOrgs || [],
                            buildings: userBuildings || [],
                            residences: userResidences || [],
                        };
                    }
                    catch (error) {
                        console.error('‚ùå Error getting user assignments:', error);
                        // Return user with empty assignments if there's an error
                        return {
                            ...user,
                            organizations: [],
                            buildings: [],
                            residences: [],
                        };
                    }
                }));
                usersWithAssignments.push(...batchResults);
            }
            return usersWithAssignments;
        }
        catch (error) {
            console.error('‚ùå Critical error getting users with assignments:', error);
            // Return empty array on critical error
            return [];
        }
    }
    /**
     * Paginated fallback implementation for getUsersWithAssignmentsPaginated if optimized version fails.
     * This is the original N+1 query implementation with pagination support.
     */
    async getUsersWithAssignmentsPaginatedFallback(offset = 0, limit = 10, filters = {}) {
        try {
            // Build WHERE conditions for filtering
            let whereConditions = [];
            if (filters.role) {
                if (filters.role === 'null') {
                    whereConditions.push((0, drizzle_orm_1.isNull)(schema.users.role));
                }
                else {
                    whereConditions.push((0, drizzle_orm_1.eq)(schema.users.role, filters.role));
                }
            }
            if (filters.status) {
                if (filters.status === 'null') {
                    whereConditions.push((0, drizzle_orm_1.isNull)(schema.users.isActive));
                }
                else {
                    const isActive = filters.status === 'true';
                    whereConditions.push((0, drizzle_orm_1.eq)(schema.users.isActive, isActive));
                }
            }
            else {
                // Default: only show active users if no status filter is applied
                whereConditions.push((0, drizzle_orm_1.eq)(schema.users.isActive, true));
            }
            // Demo-only filter for demo users
            if (filters.demoOnly === 'true') {
                whereConditions.push((0, drizzle_orm_1.sql) `${schema.users.role} LIKE 'demo_%'`);
            }
            // Search filter for name/email
            if (filters.search && filters.search.trim()) {
                const searchTerm = `%${filters.search.trim().toLowerCase()}%`;
                whereConditions.push((0, drizzle_orm_1.or)((0, drizzle_orm_1.sql) `LOWER(${schema.users.firstName} || ' ' || ${schema.users.lastName}) LIKE ${searchTerm}`, (0, drizzle_orm_1.sql) `LOWER(${schema.users.email}) LIKE ${searchTerm}`, (0, drizzle_orm_1.sql) `LOWER(${schema.users.username}) LIKE ${searchTerm}`));
                console.log('üîç [SEARCH FILTER FALLBACK] Applied search for:', filters.search.trim());
            }
            // Manager organizations filter
            if (filters.managerOrganizations) {
                const orgIds = filters.managerOrganizations.split(',');
                const orgFilterQuery = db_1.db
                    .select({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, orgIds), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
                whereConditions.push((0, drizzle_orm_1.inArray)(schema.users.id, orgFilterQuery));
            }
            // Orphan filter implementation for fallback
            if (filters.orphan === 'true') {
                // Users with no organization AND no residence assignments
                console.log('üëª [FALLBACK] Applying orphan filter: true (users with no assignments)');
                const usersWithOrgs = db_1.db
                    .selectDistinct({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
                const usersWithResidences = db_1.db
                    .selectDistinct({ userId: schema.userResidences.userId })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
                // Users who are NOT in either of these subqueries
                whereConditions.push((0, drizzle_orm_1.and)((0, drizzle_orm_1.notInArray)(schema.users.id, usersWithOrgs), (0, drizzle_orm_1.notInArray)(schema.users.id, usersWithResidences)));
            }
            else if (filters.orphan === 'false') {
                // Users with at least one organization OR residence assignment
                console.log('üëª [FALLBACK] Applying orphan filter: false (users with assignments)');
                const usersWithOrgs = db_1.db
                    .selectDistinct({ userId: schema.userOrganizations.userId })
                    .from(schema.userOrganizations)
                    .where((0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true));
                const usersWithResidences = db_1.db
                    .selectDistinct({ userId: schema.userResidences.userId })
                    .from(schema.userResidences)
                    .where((0, drizzle_orm_1.eq)(schema.userResidences.isActive, true));
                // Users who are in at least one of these subqueries
                whereConditions.push((0, drizzle_orm_1.or)((0, drizzle_orm_1.inArray)(schema.users.id, usersWithOrgs), (0, drizzle_orm_1.inArray)(schema.users.id, usersWithResidences)));
            }
            // First get total count with filters
            const totalResult = await db_1.db
                .select({ count: (0, drizzle_orm_1.sql) `count(*)` })
                .from(schema.users)
                .where((0, drizzle_orm_1.and)(...whereConditions));
            const total = Number(totalResult[0]?.count || 0);
            // Get paginated users with filters
            const users = await db_1.db
                .select()
                .from(schema.users)
                .where((0, drizzle_orm_1.and)(...whereConditions))
                .orderBy((0, drizzle_orm_1.desc)(schema.users.createdAt))
                .limit(limit)
                .offset(offset);
            // For each user, fetch their assignments with limited concurrency to prevent connection issues
            const batchSize = 5; // Process 5 users at a time to avoid connection pool exhaustion
            const usersWithAssignments = [];
            for (let i = 0; i < users.length; i += batchSize) {
                const batch = users.slice(i, i + batchSize);
                const batchResults = await Promise.all(batch.map(async (user) => {
                    try {
                        // Get user organizations
                        const userOrgs = await db_1.db
                            .select({
                            id: schema.organizations.id,
                            name: schema.organizations.name,
                            type: schema.organizations.type,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.organizations, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.organizations.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
                        // Get user buildings (through organization relationships)
                        const userBuildings = await db_1.db
                            .select({
                            id: schema.buildings.id,
                            name: schema.buildings.name,
                        })
                            .from(schema.userOrganizations)
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.userOrganizations.organizationId, schema.buildings.organizationId))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, user.id), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
                        // Get user residences
                        const userResidences = await db_1.db
                            .select({
                            id: schema.residences.id,
                            unitNumber: schema.residences.unitNumber,
                            buildingId: schema.residences.buildingId,
                            buildingName: schema.buildings.name,
                        })
                            .from(schema.userResidences)
                            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
                            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
                            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, user.id), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
                        return {
                            ...user,
                            organizations: userOrgs || [],
                            buildings: userBuildings || [],
                            residences: userResidences || [],
                        };
                    }
                    catch (error) {
                        console.error('‚ùå Error getting user assignments:', error);
                        // Return user with empty assignments if there's an error
                        return {
                            ...user,
                            organizations: [],
                            buildings: [],
                            residences: [],
                        };
                    }
                }));
                usersWithAssignments.push(...batchResults);
            }
            return { users: usersWithAssignments, total };
        }
        catch (error) {
            console.error('‚ùå Critical error getting paginated users with assignments:', error);
            // Return empty result on critical error
            return { users: [], total: 0 };
        }
    }
    /**
     * Retrieves users from organizations that a specific user has access to.
     * @param userId
     */
    async getUsersByOrganizations(userId) {
        return this.withOptimizations('getUsersByOrganizations', `users_by_org:${userId}`, 'users', async () => {
            // First, get organization IDs that the user has access to
            const userOrgs = await db_1.db
                .select({ organizationId: schema.userOrganizations.organizationId })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            if (userOrgs.length === 0) {
                return [];
            }
            const organizationIds = userOrgs.map((org) => org.organizationId);
            // Then get all users from those organizations
            return db_1.db
                .select({
                id: schema.users.id,
                username: schema.users.username,
                password: schema.users.password,
                email: schema.users.email,
                firstName: schema.users.firstName,
                lastName: schema.users.lastName,
                phone: schema.users.phone,
                profileImage: schema.users.profileImage,
                language: schema.users.language,
                role: schema.users.role,
                isActive: schema.users.isActive,
                lastLoginAt: schema.users.lastLoginAt,
                createdAt: schema.users.createdAt,
                updatedAt: schema.users.updatedAt,
            })
                .from(schema.users)
                .innerJoin(schema.userOrganizations, (0, drizzle_orm_1.eq)(schema.users.id, schema.userOrganizations.userId))
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true), (0, drizzle_orm_1.inArray)(schema.userOrganizations.organizationId, organizationIds)))
                .orderBy(schema.users.firstName, schema.users.lastName);
        });
    }
    /**
     * Gets paginated users with optimized query structure.
     * @param options
     * @param _options
     */
    async getPaginatedUsers(_options) {
        database_optimization_1.PaginationHelper.validatePagination(_options);
        const cacheKey = `paginated_users:${_options.page}:${_options.pageSize}:${_options.sortBy}:${_options.sortDirection}`;
        // Try cache first
        const cached = query_cache_1.queryCache.get('users', cacheKey);
        if (cached) {
            return cached;
        }
        // Get total count using covering index
        const [{ count: total }] = await db_1.db
            .select({ count: (0, drizzle_orm_1.count)() })
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true));
        // Get paginated results with LIMIT and optimized ORDER BY
        const users = await db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.eq)(schema.users.isActive, true))
            .orderBy(_options.sortDirection === 'DESC' ? (0, drizzle_orm_1.desc)(schema.users.createdAt) : schema.users.createdAt)
            .limit(_options.pageSize)
            .offset((_options.page - 1) * _options.pageSize);
        const result = { users, total };
        query_cache_1.queryCache.set('users', cacheKey, result);
        return result;
    }
    /**
     * Gets buildings with residents using EXISTS instead of IN subquery.
     * @param organizationId
     * @param limit
     */
    async getBuildingsWithResidents(organizationId, limit = 50) {
        const cacheKey = `buildings_with_residents:${organizationId}:${limit}`;
        return this.withOptimizations('getBuildingsWithResidents', cacheKey, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true), (0, drizzle_orm_2.exists)(db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id), (0, drizzle_orm_1.eq)(schema.residences.isActive, true))))))
            .limit(limit) // Always use LIMIT for large result sets
        );
    }
    /**
     * Searches users with optimized covering index and LIMIT.
     * @param query
     * @param limit
     */
    async searchUsers(query, limit = 20) {
        const cacheKey = `search_users:${query}:${limit}`;
        return this.withOptimizations('searchUsers', cacheKey, 'users', () => db_1.db
            .select()
            .from(schema.users)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.users.isActive, true), (0, drizzle_orm_1.or)((0, drizzle_orm_1.like)(schema.users.email, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.firstName, `%${query}%`), (0, drizzle_orm_1.like)(schema.users.lastName, `%${query}%`))))
            .limit(limit) // Always limit search results
            .orderBy(schema.users.lastName, schema.users.firstName));
    }
    /**
     * Gets financial summary using materialized view for complex aggregations.
     * @param buildingId
     */
    async getFinancialSummary(buildingId) {
        const cacheKey = `financial_summary:${buildingId}`;
        return this.withOptimizations('getFinancialSummary', cacheKey, 'financial', async () => {
            // Use materialized view for complex aggregations
            const summary = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_financial_summary WHERE building_id = ${buildingId} ORDER BY month DESC LIMIT 12`);
            return summary.rows;
        });
    }
    /**
     * Gets building statistics using materialized view.
     * @param buildingId
     */
    async getBuildingStats(buildingId) {
        const cacheKey = `building_stats:${buildingId}`;
        return this.withOptimizations('getBuildingStats', cacheKey, 'buildings', async () => {
            // Use materialized view for dashboard statistics
            const stats = await db_1.db.execute((0, drizzle_orm_2.sql) `SELECT * FROM mv_building_stats WHERE building_id = ${buildingId}`);
            return stats.rows[0];
        });
    }
    /**
     * Retrieves a specific user by ID with caching.
     * @param id
     */
    async getUser(id) {
        return this.withOptimizations('getUser', `user:${id}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.id, id));
            // User lookup completed
            return result[0];
        });
    }
    /**
     * Retrieves a user by email with caching.
     * @param email
     */
    async getUserByEmail(email) {
        return this.withOptimizations('getUserByEmail', `user_email:${email}`, 'users', async () => {
            const result = await db_1.db.select().from(schema.users).where((0, drizzle_orm_1.eq)(schema.users.email, email));
            return result[0];
        });
    }
    /**
     * Creates a new user with cache invalidation.
     * @param insertUser
     */
    async createUser(insertUser) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createUser', async () => {
            // Automatically set demo password for demo role users
            let password = insertUser.password;
            const isDemoRole = ['demo_manager', 'demo_tenant', 'demo_resident'].includes(insertUser.role);
            if (isDemoRole) {
                // Always set the standard demo password hash for demo users, regardless of provided password
                password = '$2b$12$cOc/QjMjzlhqAQqF2b/MTOZr2QAtERbXJGd4OSa1CXMlF04FC3F02'; // demo123456
                console.log('üé≠ Setting demo password for user with role:', insertUser.role);
            }
            // Ensure username uniqueness with random numbers if collision occurs
            let uniqueUsername = insertUser.username;
            let attempts = 0;
            const maxAttempts = 10;
            // Check for username collision
            let existingUser = await db_1.db
                .select({ username: schema.users.username })
                .from(schema.users)
                .where((0, drizzle_orm_1.eq)(schema.users.username, uniqueUsername))
                .limit(1);
            while (existingUser.length > 0 && attempts < maxAttempts) {
                // Generate random 4-digit suffix
                const randomSuffix = Math.floor(1000 + Math.random() * 9000);
                uniqueUsername = `${insertUser.username}${randomSuffix}`;
                attempts++;
                existingUser = await db_1.db
                    .select({ username: schema.users.username })
                    .from(schema.users)
                    .where((0, drizzle_orm_1.eq)(schema.users.username, uniqueUsername))
                    .limit(1);
            }
            if (attempts >= maxAttempts && existingUser.length > 0) {
                throw new Error('Unable to generate unique username after maximum attempts');
            }
            // Filter only the fields that exist in the database schema
            const userData = {
                username: uniqueUsername,
                email: insertUser.email,
                password,
                firstName: insertUser.firstName,
                lastName: insertUser.lastName,
                phone: insertUser.phone || '',
                profileImage: insertUser.profileImage,
                language: insertUser.language || 'fr',
                role: insertUser.role,
                isActive: true, // Default value for new users
            };
            try {
                const inserted = await db_1.db.insert(schema.users).values([userData]).returning();
                return inserted;
            }
            catch (error) {
                console.error('‚ùå Error creating user:', error);
                throw error;
            }
        });
        // Invalidate related caches
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    /**
     * Updates a user with cache invalidation.
     * @param id
     * @param updates
     */
    async updateUser(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateUser', async () => {
            return db_1.db
                .update(schema.users)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.users.id, id))
                .returning();
        });
        // Invalidate specific user caches
        query_cache_1.CacheInvalidator.invalidateUserCaches(id);
        return result[0];
    }
    /**
     * Retrieves organizations for a specific user.
     * @param userId
     */
    async getUserOrganizations(userId) {
        return this.withOptimizations('getUserOrganizations', `user_orgs:${userId}`, 'users', async () => {
            const result = await db_1.db
                .select({
                organizationId: schema.userOrganizations.organizationId,
            })
                .from(schema.userOrganizations)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userOrganizations.userId, userId), (0, drizzle_orm_1.eq)(schema.userOrganizations.isActive, true)));
            return result;
        });
    }
    /**
     * Retrieves residences for a specific user.
     * @param userId
     */
    async getUserResidences(userId) {
        return this.withOptimizations('getUserResidences', `user_residences:${userId}`, 'residences', async () => {
            const result = await db_1.db
                .select({
                residenceId: schema.userResidences.residenceId,
            })
                .from(schema.userResidences)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true)));
            return result;
        });
    }
    // Organization operations with optimization
    /**
     * Retrieves all active organizations with caching.
     */
    async getOrganizations() {
        return this.withOptimizations('getOrganizations', 'all_organizations', 'organizations', () => db_1.db.select().from(schema.organizations).where((0, drizzle_orm_1.eq)(schema.organizations.isActive, true)));
    }
    /**
     * Retrieves an organization by ID with caching.
     * @param id
     */
    async getOrganization(id) {
        return this.withOptimizations('getOrganization', `organization:${id}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new organization with cache invalidation.
     * @param insertOrganization
     */
    async createOrganization(insertOrganization) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createOrganization', async () => {
            return db_1.db.insert(schema.organizations).values(insertOrganization).returning();
        });
        // Invalidate organization caches
        query_cache_1.queryCache.invalidate('organizations');
        return result[0];
    }
    // Building operations with optimization
    /**
     * Retrieves buildings by organization with caching.
     * @param organizationId
     */
    async getBuildingsByOrganization(organizationId) {
        return this.withOptimizations('getBuildingsByOrganization', `org_buildings:${organizationId}`, 'buildings', () => db_1.db
            .select()
            .from(schema.buildings)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.buildings.organizationId, organizationId), (0, drizzle_orm_1.eq)(schema.buildings.isActive, true))));
    }
    /**
     * Retrieves a building by ID with caching.
     * @param id
     */
    async getBuilding(id) {
        return this.withOptimizations('getBuilding', `building:${id}`, 'buildings', async () => {
            const result = await db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new building with cache invalidation.
     * @param insertBuilding
     */
    async createBuilding(insertBuilding) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createBuilding', async () => {
            return db_1.db.insert(schema.buildings).values([insertBuilding]).returning();
        });
        // Invalidate building caches
        query_cache_1.CacheInvalidator.invalidateBuildingCaches('*');
        return result[0];
    }
    // Residence operations with optimization
    /**
     * Retrieves residences by building with caching.
     * @param buildingId
     */
    async getResidencesByBuilding(buildingId) {
        return this.withOptimizations('getResidencesByBuilding', `building_residences:${buildingId}`, 'residences', () => db_1.db
            .select()
            .from(schema.residences)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.residences.buildingId, buildingId), (0, drizzle_orm_1.eq)(schema.residences.isActive, true)))
            .orderBy(schema.residences.unitNumber));
    }
    /**
     * Retrieves a residence by ID with caching.
     * @param id
     */
    async getResidence(id) {
        return this.withOptimizations('getResidence', `residence:${id}`, 'residences', async () => {
            const result = await db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.id, id));
            return result[0];
        });
    }
    /**
     * Creates a new residence with cache invalidation.
     * @param insertResidence
     */
    async createResidence(insertResidence) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createResidence', async () => {
            return db_1.db.insert(schema.residences).values([insertResidence]).returning();
        });
        // Invalidate residence caches
        query_cache_1.CacheInvalidator.invalidateResidenceCaches('*');
        return result[0];
    }
    // Additional optimized methods for frequently accessed data
    /**
     * Gets user residences with full details - for complex residence views.
     * @param userId
     */
    async getUserResidencesWithDetails(userId) {
        return this.withOptimizations('getUserResidencesWithDetails', `user_residences_details:${userId}`, 'residences', () => db_1.db
            .select({
            residence: schema.residences,
            building: schema.buildings,
            userResidence: schema.userResidences,
        })
            .from(schema.userResidences)
            .innerJoin(schema.residences, (0, drizzle_orm_1.eq)(schema.userResidences.residenceId, schema.residences.id))
            .innerJoin(schema.buildings, (0, drizzle_orm_1.eq)(schema.residences.buildingId, schema.buildings.id))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.userResidences.userId, userId), (0, drizzle_orm_1.eq)(schema.userResidences.isActive, true))));
    }
    /**
     * Gets active bills for a residence - frequently queried.
     * @param residenceId
     */
    async getActiveBillsByResidence(residenceId) {
        return this.withOptimizations('getActiveBillsByResidence', `residence_bills:${residenceId}`, 'bills', () => db_1.db
            .select()
            .from(schema.bills)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.bills.residenceId, residenceId), (0, drizzle_orm_1.or)((0, drizzle_orm_1.eq)(schema.bills.status, 'sent'), (0, drizzle_orm_1.eq)(schema.bills.status, 'overdue'))))
            .orderBy((0, drizzle_orm_1.desc)(schema.bills.dueDate)));
    }
    /**
     * Gets maintenance requests for a residence - frequently accessed.
     * @param residenceId
     */
    async getMaintenanceRequestsByResidence(residenceId) {
        return this.withOptimizations('getMaintenanceRequestsByResidence', `residence_maintenance:${residenceId}`, 'maintenance', () => db_1.db
            .select()
            .from(schema.maintenanceRequests)
            .where((0, drizzle_orm_1.eq)(schema.maintenanceRequests.residenceId, residenceId))
            .orderBy((0, drizzle_orm_1.desc)(schema.maintenanceRequests.createdAt)));
    }
    // Missing Organization operations
    /**
     * Gets organization by name with caching.
     * @param name
     */
    async getOrganizationByName(name) {
        return this.withOptimizations('getOrganizationByName', `org_name:${name}`, 'organizations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.organizations)
                .where((0, drizzle_orm_1.eq)(schema.organizations.name, name));
            return result[0];
        });
    }
    /**
     * Updates organization with cache invalidation.
     * @param id
     * @param updates
     */
    async updateOrganization(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateOrganization', async () => {
            return db_1.db
                .update(schema.organizations)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.organizations.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateUserCaches('*');
        return result[0];
    }
    // Missing Building operations
    /**
     * Gets all buildings with caching.
     */
    async getBuildings() {
        return this.withOptimizations('getBuildings', 'all_buildings', 'buildings', () => db_1.db.select().from(schema.buildings).where((0, drizzle_orm_1.eq)(schema.buildings.isActive, true)));
    }
    /**
     * Updates building with cache invalidation.
     * @param id
     * @param updates
     */
    async updateBuilding(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result[0];
    }
    /**
     * Deletes building (soft delete).
     * @param id
     */
    async deleteBuilding(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteBuilding', async () => {
            return db_1.db
                .update(schema.buildings)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.buildings.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateBuildingCaches(id);
        return result.length > 0;
    }
    // Missing Residence operations
    /**
     * Gets all residences with caching.
     */
    async getResidences() {
        return this.withOptimizations('getResidences', 'all_residences', 'residences', () => db_1.db.select().from(schema.residences).where((0, drizzle_orm_1.eq)(schema.residences.isActive, true)));
    }
    /**
     * Updates residence with cache invalidation.
     * @param id
     * @param updates
     */
    async updateResidence(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result[0];
    }
    /**
     * Deletes residence (soft delete).
     * @param id
     */
    async deleteResidence(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteResidence', async () => {
            return db_1.db
                .update(schema.residences)
                .set({ isActive: false, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.residences.id, id))
                .returning();
        });
        query_cache_1.CacheInvalidator.invalidateResidenceCaches(id);
        return result.length > 0;
    }
    // Development Pillar operations
    /**
     * Gets all development pillars.
     */
    async getPillars() {
        return this.withOptimizations('getPillars', 'all_pillars', 'pillars', () => db_1.db.select().from(schema.developmentPillars));
    }
    /**
     * Gets development pillar by ID.
     * @param id
     */
    async getPillar(id) {
        return this.withOptimizations('getPillar', `pillar:${id}`, 'pillars', async () => {
            const result = await db_1.db
                .select()
                .from(schema.developmentPillars)
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id));
            return result[0];
        });
    }
    /**
     * Creates development pillar.
     * @param pillar
     */
    async createPillar(pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createPillar', async () => {
            return db_1.db.insert(schema.developmentPillars).values(pillar).returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    /**
     * Updates development pillar.
     * @param id
     * @param pillar
     */
    async updatePillar(id, pillar) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updatePillar', async () => {
            return db_1.db
                .update(schema.developmentPillars)
                .set({ ...pillar, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.developmentPillars.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('pillars');
        return result[0];
    }
    // Workspace Status operations
    /**
     * Gets all workspace statuses.
     */
    async getWorkspaceStatuses() {
        return this.withOptimizations('getWorkspaceStatuses', 'all_workspace_statuses', 'workspace_status', () => db_1.db.select().from(schema.workspaceStatus));
    }
    /**
     * Gets workspace status by component.
     * @param component
     */
    async getWorkspaceStatus(component) {
        return this.withOptimizations('getWorkspaceStatus', `workspace_status:${component}`, 'workspace_status', async () => {
            const result = await db_1.db
                .select()
                .from(schema.workspaceStatus)
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component));
            return result[0];
        });
    }
    /**
     * Creates workspace status.
     * @param status
     */
    async createWorkspaceStatus(status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createWorkspaceStatus', async () => {
            return db_1.db.insert(schema.workspaceStatus).values(status).returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    /**
     * Updates workspace status.
     * @param component
     * @param status
     */
    async updateWorkspaceStatus(component, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateWorkspaceStatus', async () => {
            return db_1.db
                .update(schema.workspaceStatus)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.workspaceStatus.component, component))
                .returning();
        });
        query_cache_1.queryCache.invalidate('workspace_status');
        return result[0];
    }
    // Quality Metrics operations
    /**
     * Gets all quality metrics.
     */
    async getQualityMetrics() {
        return this.withOptimizations('getQualityMetrics', 'all_quality_metrics', 'quality_metrics', () => db_1.db.select().from(schema.qualityMetrics));
    }
    /**
     * Creates quality metric.
     * @param metric
     */
    async createQualityMetric(metric) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createQualityMetric', async () => {
            return db_1.db.insert(schema.qualityMetrics).values(metric).returning();
        });
        query_cache_1.queryCache.invalidate('quality_metrics');
        return result[0];
    }
    // Framework Configuration operations
    /**
     * Gets all framework configurations.
     */
    async getFrameworkConfigs() {
        return this.withOptimizations('getFrameworkConfigs', 'all_framework_configs', 'framework_configs', () => db_1.db.select().from(schema.frameworkConfiguration));
    }
    /**
     * Gets framework config by key.
     * @param key
     * @param _key
     */
    async getFrameworkConfig(_key) {
        return this.withOptimizations('getFrameworkConfig', `framework_config:${_key}`, 'framework_configs', async () => {
            const result = await db_1.db
                .select()
                .from(schema.frameworkConfiguration)
                .where((0, drizzle_orm_1.eq)(schema.frameworkConfiguration._key, _key));
            return result[0];
        });
    }
    /**
     * Sets framework configuration.
     * @param config
     */
    async setFrameworkConfig(config) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('setFrameworkConfig', async () => {
            return db_1.db
                .insert(schema.frameworkConfiguration)
                .values(config)
                .onConflictDoUpdate({
                target: schema.frameworkConfiguration._key,
                set: { _value: config._value, updatedAt: new Date() },
            })
                .returning();
        });
        query_cache_1.queryCache.invalidate('framework_configs');
        return result[0];
    }
    // Improvement Suggestions operations
    /**
     * Gets all improvement suggestions.
     */
    async getImprovementSuggestions() {
        return this.withOptimizations('getImprovementSuggestions', 'all_improvement_suggestions', 'improvement_suggestions', () => db_1.db.select().from(schema.improvementSuggestions));
    }
    /**
     * Gets top improvement suggestions.
     * @param limit
     */
    async getTopImprovementSuggestions(limit) {
        return this.withOptimizations('getTopImprovementSuggestions', `top_suggestions:${limit}`, 'improvement_suggestions', () => db_1.db
            .select()
            .from(schema.improvementSuggestions)
            .orderBy((0, drizzle_orm_1.desc)(schema.improvementSuggestions.priority), (0, drizzle_orm_1.desc)(schema.improvementSuggestions.createdAt))
            .limit(limit));
    }
    /**
     * Creates improvement suggestion.
     * @param suggestion
     */
    async createImprovementSuggestion(suggestion) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createImprovementSuggestion', async () => {
            return db_1.db
                .insert(schema.improvementSuggestions)
                .values([
                {
                    ...suggestion,
                    category: suggestion.category,
                },
            ])
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    /**
     * Clears new suggestions.
     */
    async clearNewSuggestions() {
        await performance_monitoring_1.dbPerformanceMonitor.trackQuery('clearNewSuggestions', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status: 'Acknowledged' })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.status, 'New'));
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
    }
    /**
     * Updates suggestion status.
     * @param id
     * @param status
     */
    async updateSuggestionStatus(id, status) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateSuggestionStatus', async () => {
            return db_1.db
                .update(schema.improvementSuggestions)
                .set({ status })
                .where((0, drizzle_orm_1.eq)(schema.improvementSuggestions.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('improvement_suggestions');
        return result[0];
    }
    // Features operations
    /**
     * Gets all features.
     */
    async getFeatures() {
        return this.withOptimizations('getFeatures', 'all_features', 'features', () => db_1.db.select().from(schema.features));
    }
    /**
     * Gets features by status.
     * @param status
     */
    async getFeaturesByStatus(status) {
        return this.withOptimizations('getFeaturesByStatus', `features_status:${status}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.status, status)));
    }
    /**
     * Gets features by category.
     * @param category
     */
    async getFeaturesByCategory(category) {
        return this.withOptimizations('getFeaturesByCategory', `features_category:${category}`, 'features', () => db_1.db
            .select()
            .from(schema.features)
            .where((0, drizzle_orm_1.eq)(schema.features.category, category)));
    }
    /**
     * Gets public roadmap features.
     */
    async getPublicRoadmapFeatures() {
        return this.withOptimizations('getPublicRoadmapFeatures', 'public_roadmap_features', 'features', () => db_1.db.select().from(schema.features).where((0, drizzle_orm_1.eq)(schema.features.isPublicRoadmap, true)));
    }
    /**
     * Creates feature.
     * @param feature
     */
    async createFeature(feature) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeature', async () => {
            return db_1.db.insert(schema.features).values([feature]).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Updates feature.
     * @param id
     * @param updates
     */
    async updateFeature(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeature', async () => {
            return db_1.db
                .update(schema.features)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.features.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result[0];
    }
    /**
     * Deletes feature.
     * @param id
     */
    async deleteFeature(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteFeature', async () => {
            return db_1.db.delete(schema.features).where((0, drizzle_orm_1.eq)(schema.features.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('features');
        return result.length > 0;
    }
    // Actionable Items operations
    /**
     * Gets actionable items by feature.
     * @param featureId
     */
    async getActionableItemsByFeature(featureId) {
        return this.withOptimizations('getActionableItemsByFeature', `actionable_items:${featureId}`, 'actionable_items', () => db_1.db
            .select()
            .from(schema.actionableItems)
            .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId)));
    }
    /**
     * Gets actionable item by ID.
     * @param id
     */
    async getActionableItem(id) {
        return this.withOptimizations('getActionableItem', `actionable_item:${id}`, 'actionable_items', async () => {
            const result = await db_1.db
                .select()
                .from(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id));
            return result[0];
        });
    }
    /**
     * Creates actionable item.
     * @param item
     */
    async createActionableItem(item) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItem', async () => {
            return db_1.db.insert(schema.actionableItems).values([item]).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Creates multiple actionable items.
     * @param items
     */
    async createActionableItems(items) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createActionableItems', async () => {
            return db_1.db.insert(schema.actionableItems).values(items).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result;
    }
    /**
     * Updates actionable item.
     * @param id
     * @param updates
     */
    async updateActionableItem(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateActionableItem', async () => {
            return db_1.db
                .update(schema.actionableItems)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result[0];
    }
    /**
     * Deletes actionable item.
     * @param id
     */
    async deleteActionableItem(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItem', async () => {
            return db_1.db.delete(schema.actionableItems).where((0, drizzle_orm_1.eq)(schema.actionableItems.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    /**
     * Deletes actionable items by feature.
     * @param featureId
     */
    async deleteActionableItemsByFeature(featureId) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteActionableItemsByFeature', async () => {
            return db_1.db
                .delete(schema.actionableItems)
                .where((0, drizzle_orm_1.eq)(schema.actionableItems.featureId, featureId))
                .returning();
        });
        query_cache_1.queryCache.invalidate('actionable_items');
        return result.length > 0;
    }
    // Invitation operations
    /**
     * Gets all invitations.
     */
    async getInvitations() {
        return this.withOptimizations('getInvitations', 'all_invitations', 'invitations', () => db_1.db.select().from(schema.invitations));
    }
    /**
     * Gets invitation by ID.
     * @param id
     */
    async getInvitation(id) {
        return this.withOptimizations('getInvitation', `invitation:${id}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id));
            return result[0];
        });
    }
    /**
     * Gets invitation by token.
     * @param token
     */
    async getInvitationByToken(token) {
        return this.withOptimizations('getInvitationByToken', `invitation_token:${token}`, 'invitations', async () => {
            const result = await db_1.db
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.token, token));
            return result[0];
        });
    }
    /**
     * Gets invitations by email.
     * @param email
     */
    async getInvitationsByEmail(email) {
        return this.withOptimizations('getInvitationsByEmail', `invitations_email:${email}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.email, email)));
    }
    /**
     * Gets invitations by inviter.
     * @param userId
     */
    async getInvitationsByInviter(userId) {
        return this.withOptimizations('getInvitationsByInviter', `invitations_inviter:${userId}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.invitedByUserId, userId)));
    }
    /**
     * Gets invitations by status.
     * @param status
     */
    async getInvitationsByStatus(status) {
        return this.withOptimizations('getInvitationsByStatus', `invitations_status:${status}`, 'invitations', () => db_1.db.select().from(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.status, status)));
    }
    /**
     * Creates invitation.
     * @param invitation
     */
    async createInvitation(invitation) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitation', async () => {
            return db_1.db.insert(schema.invitations).values([invitation]).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Updates invitation.
     * @param id
     * @param updates
     */
    async updateInvitation(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Accepts invitation.
     * @param token
     * @param userData
     * @param userData.firstName
     * @param ipAddress
     * @param userData.lastName
     * @param userAgent
     * @param userData.password
     */
    async acceptInvitation(token, userData, ipAddress, userAgent) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('acceptInvitation', async () => {
            const invitation = await this.getInvitationByToken(token);
            if (!invitation || invitation.status !== 'pending') {
                return null;
            }
            // Create user with required fields
            const user = await this.createUser({
                username: invitation.email.split('@')[0], // Use email prefix as username
                email: invitation.email,
                firstName: userData.firstName,
                lastName: userData.lastName,
                password: userData.password, // This should be hashed
                language: 'en', // Default language
                role: invitation.role,
            });
            // Update invitation
            const updatedInvitation = await this.updateInvitation(invitation.id, {
                status: 'accepted',
                acceptedAt: new Date(),
            });
            return { user, invitation: updatedInvitation };
        });
    }
    /**
     * Cancels invitation.
     * @param id
     * @param cancelledBy
     */
    async cancelInvitation(id, cancelledBy) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('cancelInvitation', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({
                status: 'cancelled',
                cancelledBy,
                cancelledAt: new Date(),
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result[0];
    }
    /**
     * Expires old invitations.
     */
    async expireInvitations() {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('expireInvitations', async () => {
            return db_1.db
                .update(schema.invitations)
                .set({ status: 'expired', updatedAt: new Date() })
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.invitations.status, 'pending'), (0, drizzle_orm_1.lte)(schema.invitations.expiresAt, new Date())))
                .returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length;
    }
    /**
     * Deletes invitation.
     * @param id
     */
    async deleteInvitation(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteInvitation', async () => {
            return db_1.db.delete(schema.invitations).where((0, drizzle_orm_1.eq)(schema.invitations.id, id)).returning();
        });
        query_cache_1.queryCache.invalidate('invitations');
        return result.length > 0;
    }
    // Invitation Audit Log operations
    /**
     * Gets invitation audit logs.
     * @param invitationId
     */
    async getInvitationAuditLogs(invitationId) {
        return this.withOptimizations('getInvitationAuditLogs', `invitation_logs:${invitationId}`, 'invitation_logs', () => db_1.db
            .select()
            .from(schema.invitationAuditLog)
            .where((0, drizzle_orm_1.eq)(schema.invitationAuditLog.invitationId, invitationId))
            .orderBy((0, drizzle_orm_1.desc)(schema.invitationAuditLog.createdAt)));
    }
    /**
     * Creates invitation audit log.
     * @param logEntry
     */
    async createInvitationAuditLog(logEntry) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createInvitationAuditLog', async () => {
            return db_1.db.insert(schema.invitationAuditLog).values(logEntry).returning();
        });
        query_cache_1.queryCache.invalidate('invitation_logs');
        return result[0];
    }
    // Permission operations
    /**
     * Gets all permissions.
     */
    async getPermissions() {
        return this.withOptimizations('getPermissions', 'permissions:all', 'permissions', () => db_1.db
            .select()
            .from(schema.permissions)
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.permissions.resourceType, schema.permissions.action));
    }
    /**
     * Gets all role permissions.
     */
    async getRolePermissions() {
        return this.withOptimizations('getRolePermissions', 'role_permissions:all', 'role_permissions', () => db_1.db
            .select()
            .from(schema.rolePermissions)
            .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.rolePermissions.permissionId, schema.permissions.id))
            .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
            .orderBy(schema.rolePermissions.role, schema.permissions.resourceType));
    }
    /**
     * Gets all user permissions.
     */
    async getUserPermissions() {
        try {
            const results = await db_1.db
                .select()
                .from(schema.userPermissions)
                .innerJoin(schema.permissions, (0, drizzle_orm_1.eq)(schema.userPermissions.permissionId, schema.permissions.id))
                .where((0, drizzle_orm_1.eq)(schema.permissions.isActive, true))
                .orderBy(schema.userPermissions.userId);
            return results || [];
        }
        catch (error) {
            console.error('‚ùå Error getting user permissions:', error);
            return [];
        }
    }
    // Old building document methods removed - using unified documents table
    // Unified Document operations
    async getDocuments(filters) {
        return this.withOptimizations('getDocuments', `documents:${JSON.stringify(filters)}`, 'documents', async () => {
            let query = db_1.db.select().from(schema.documents);
            const conditions = [];
            if (filters?.buildingId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.buildingId, filters.buildingId));
            }
            if (filters?.residenceId) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.residenceId, filters.residenceId));
            }
            if (filters?.documentType) {
                conditions.push((0, drizzle_orm_1.eq)(schema.documents.documentType, filters.documentType));
            }
            if (conditions.length > 0) {
                query = query.where((0, drizzle_orm_1.and)(...conditions));
            }
            const result = await query.orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
            return result || [];
        });
    }
    async getDocument(id) {
        return this.withOptimizations('getDocument', `document:${id}`, 'documents', async () => {
            const result = await db_1.db
                .select()
                .from(schema.documents)
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .limit(1);
            return result[0];
        });
    }
    async createDocument(document) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('createDocument', async () => {
            const result = await db_1.db.insert(schema.documents).values(document).returning();
            // Invalidate related caches
            if (document.buildingId) {
                query_cache_1.queryCache.invalidate('documents', `*buildingId*${document.buildingId}*`);
            }
            if (document.residenceId) {
                query_cache_1.queryCache.invalidate('documents', `*residenceId*${document.residenceId}*`);
            }
            return result[0];
        });
    }
    async updateDocument(id, updates) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateDocument', async () => {
            const result = await db_1.db
                .update(schema.documents)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .returning();
            if (result[0]) {
                // Invalidate caches
                query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                query_cache_1.queryCache.invalidate('documents', '*');
            }
            return result[0];
        });
    }
    async deleteDocument(id) {
        return performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteDocument', async () => {
            const result = await db_1.db
                .delete(schema.documents)
                .where((0, drizzle_orm_1.eq)(schema.documents.id, id))
                .returning({ id: schema.documents.id });
            if (result.length > 0) {
                // Invalidate caches
                query_cache_1.queryCache.invalidate('documents', `document:${id}`);
                query_cache_1.queryCache.invalidate('documents', '*');
                return true;
            }
            return false;
        });
    }
    // Old resident document methods removed - using unified documents table
    // Legacy Document operations (kept for migration purposes)
    /**
     * Gets legacy documents for user.
     * @param userId
     * @param userRole
     * @param organizationId
     * @param residenceIds
     */
    async getDocumentsForUser(userId, userRole, organizationId, residenceIds) {
        return this.withOptimizations('getDocumentsForUser', `legacy_docs:${userId}:${userRole}`, 'documents', async () => {
            return await db_1.db.select().from(schema.documents).orderBy((0, drizzle_orm_1.desc)(schema.documents.createdAt));
        });
    }
    // Password reset operations
    /**
     *
     * @param token
     */
    async createPasswordResetToken(token) {
        const result = await db_1.db.insert(schema.passwordResetTokens).values(token).returning();
        // Token created successfully
        return result[0];
    }
    /**
     *
     * @param tokenValue
     */
    async getPasswordResetToken(tokenValue) {
        return this.withOptimizations('getPasswordResetToken', `token_${tokenValue}`, 'password_reset_tokens', async () => {
            const result = await db_1.db
                .select()
                .from(schema.passwordResetTokens)
                .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.token, tokenValue))
                .limit(1);
            return result[0];
        });
    }
    /**
     *
     * @param tokenId
     */
    async markPasswordResetTokenAsUsed(tokenId) {
        const result = await db_1.db
            .update(schema.passwordResetTokens)
            .set({
            isUsed: true,
            usedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.passwordResetTokens.id, tokenId))
            .returning();
        // Token marked as used
        return result[0];
    }
    /**
     *
     */
    async cleanupExpiredPasswordResetTokens() {
        const result = await db_1.db
            .delete(schema.passwordResetTokens)
            .where((0, drizzle_orm_1.lte)(schema.passwordResetTokens.expiresAt, new Date()))
            .returning();
        // Expired tokens cleaned up
        return result.length;
    }
    // Contact operations
    /**
     * Gets all contacts.
     */
    async getContacts() {
        return this.withOptimizations('getContacts', 'all_contacts', 'contacts', () => db_1.db.select().from(schema.contacts).where((0, drizzle_orm_1.eq)(schema.contacts.isActive, true)));
    }
    /**
     * Gets contacts by entity.
     * @param entityId
     * @param entity
     */
    async getContactsByEntity(entityId, entity) {
        return this.withOptimizations('getContactsByEntity', `contacts_entity:${entity}_${entityId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, entityId), (0, drizzle_orm_1.eq)(schema.contacts.entity, entity), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Gets contacts for residence with user data.
     * @param residenceId
     */
    async getContactsForResidence(residenceId) {
        return this.withOptimizations('getContactsForResidence', `contacts_residence:${residenceId}`, 'contacts', () => db_1.db
            .select()
            .from(schema.contacts)
            .innerJoin(schema.users, (0, drizzle_orm_1.eq)(schema.contacts.name, schema.users.email))
            .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.contacts.entityId, residenceId), (0, drizzle_orm_1.eq)(schema.contacts.entity, 'residence'), (0, drizzle_orm_1.eq)(schema.contacts.isActive, true))));
    }
    /**
     * Creates a new contact.
     * @param contact
     */
    async createContact(contact) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createContact', async () => {
            return db_1.db.insert(schema.contacts).values(contact).returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Updates a contact.
     * @param id
     * @param updates
     */
    async updateContact(id, updates) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set(updates)
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result[0];
    }
    /**
     * Deletes a contact.
     * @param id
     */
    async deleteContact(id) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('deleteContact', async () => {
            return db_1.db
                .update(schema.contacts)
                .set({ isActive: false })
                .where((0, drizzle_orm_1.eq)(schema.contacts.id, id))
                .returning();
        });
        query_cache_1.queryCache.invalidate('contacts');
        return result.length > 0;
    }
    /**
     * Gets demands for a user.
     * @param userId
     */
    async getDemandsForUser(userId) {
        return this.withOptimizations('getDemandsForUser', `demands_user:${userId}`, 'demands', () => db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.userId, userId)));
    }
    /**
     * Gets a specific demand.
     * @param id
     */
    async getDemand(id) {
        return this.withOptimizations('getDemand', `demand:${id}`, 'demands', async () => {
            const result = await db_1.db.select().from(schema.demands).where((0, drizzle_orm_1.eq)(schema.demands.id, id));
            return result[0];
        });
    }
    // Bug operations implementation
    /**
     *
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBugsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getBugsForUser', `bugs:${userRole}:${userId}`, 'bugs', async () => {
            let results;
            if (userRole === 'admin') {
                // Admin can see all bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else if (userRole === 'manager' && organizationId) {
                // For managers, return all bugs for now (can be refined later)
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            else {
                // For residents and tenants, return only their own bugs
                results = await db_1.db
                    .select()
                    .from(schema.bugs)
                    .where((0, drizzle_orm_1.eq)(schema.bugs.createdBy, userId))
                    .orderBy((0, drizzle_orm_1.desc)(schema.bugs.createdAt));
            }
            // Get attachment counts and details for each bug
            const bugsWithAttachments = await Promise.all(results.map(async (bug) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    fileName: schema.documents.fileName,
                    fileSize: schema.documents.fileSize,
                    filePath: schema.documents.filePath,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'bug'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, bug.id)));
                return {
                    ...bug,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.fileName || att.name,
                        size: parseInt(att.fileSize || '0'),
                        url: `/api/documents/${att.id}/file`,
                        type: att.fileName ? att.fileName.split('.').pop()?.toLowerCase() || 'unknown' : 'unknown'
                    }))
                };
            }));
            return bugsWithAttachments;
        });
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getBug(id, userId, userRole, organizationId) {
        const key = `bug:${id}:user:${userId}:${userRole}`;
        console.log(`üîç getBug called with key: ${key}`);
        return (0, query_cache_1.withCache)('bug', key, async () => {
            console.log(`üìä Cache miss for ${key}, querying database...`);
            const result = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
            const bug = result[0];
            console.log(`üìã Database query result:`, bug ? { id: bug.id, title: bug.title, filePath: bug.filePath, file_path: bug.file_path } : 'undefined');
            if (!bug) {
                return undefined;
            }
            if (userRole === 'admin') {
                return bug;
            }
            if (userRole === 'manager') {
                return bug; // Managers can see all bugs for now
            }
            // Residents and tenants can only see their own bugs
            return bug.createdBy === userId ? bug : undefined;
        });
    }
    /**
     *
     * @param bugData
     */
    async createBug(bugData) {
        const result = await db_1.db
            .insert(schema.bugs)
            .values({
            ...bugData,
            id: crypto_1.default.randomUUID(),
            status: 'new',
            assignedTo: null,
            resolvedAt: null,
            resolvedBy: null,
            notes: null,
            createdAt: new Date(),
            updatedAt: new Date(),
        })
            .returning();
        // Invalidate cache for this user and specific bug queries  
        query_cache_1.queryCache.invalidate('bugs');
        query_cache_1.queryCache.invalidate('bug', `bug:${result[0].id}:*`);
        return result[0];
    }
    /**
     *
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateBug(id, updates, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return undefined;
        }
        // Access control: users can edit their own bugs, admins and managers can edit any bug
        const canEdit = userRole === 'admin' || userRole === 'manager' || existingBug.createdBy === userId;
        if (!canEdit) {
            return undefined;
        }
        const result = await db_1.db
            .update(schema.bugs)
            .set({
            ...updates,
            updatedAt: new Date(),
        })
            .where((0, drizzle_orm_1.eq)(schema.bugs.id, id))
            .returning();
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
        }
        return result[0];
    }
    /**
     *
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteBug(id, userId, userRole) {
        // First check if the bug exists and get its current data
        const [existingBug] = await db_1.db.select().from(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id));
        if (!existingBug) {
            return false;
        }
        // Access control: users can delete their own bugs, admins can delete any bug
        const canDelete = userRole === 'admin' || existingBug.createdBy === userId;
        if (!canDelete) {
            return false;
        }
        const result = await db_1.db.delete(schema.bugs).where((0, drizzle_orm_1.eq)(schema.bugs.id, id)).returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('bugs');
            return true;
        }
        return false;
    }
    // Feature Request operations with optimization
    /**
     * Retrieves feature requests for a user with role-based access control.
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequestsForUser(userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequestsForUser', `feature_requests:${userRole}:${userId}`, 'feature_requests', async () => {
            const results = await db_1.db
                .select()
                .from(schema.featureRequests)
                .orderBy((0, drizzle_orm_1.desc)(schema.featureRequests.createdAt));
            // Get attachment counts and details for each feature request
            const requestsWithAttachments = await Promise.all(results.map(async (request) => {
                const attachments = await db_1.db
                    .select({
                    id: schema.documents.id,
                    name: schema.documents.name,
                    filePath: schema.documents.filePath,
                    fileSize: schema.documents.fileSize,
                    mimeType: schema.documents.mimeType,
                })
                    .from(schema.documents)
                    .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.documents.attachedToType, 'feature_request'), (0, drizzle_orm_1.eq)(schema.documents.attachedToId, request.id)));
                return {
                    ...request,
                    attachmentCount: attachments.length,
                    attachments: attachments.map(att => ({
                        id: att.id,
                        name: att.name,
                        url: `/api/documents/${att.id}/file`,
                        size: att.fileSize ? parseInt(att.fileSize) : 0,
                        mimeType: att.mimeType,
                    })),
                };
            }));
            // All users can see all feature requests, but non-admins don't see who submitted
            if (userRole === 'admin') {
                return requestsWithAttachments;
            }
            // For non-admin users, hide the createdBy field
            return requestsWithAttachments.map((request) => ({
                ...request,
                createdBy: null,
            }));
        });
    }
    /**
     * Retrieves a specific feature request by ID with role-based access control.
     * @param id
     * @param userId
     * @param userRole
     * @param organizationId
     */
    async getFeatureRequest(id, userId, userRole, organizationId) {
        return this.withOptimizations('getFeatureRequest', `feature_request:${id}:${userRole}`, 'feature_requests', async () => {
            const result = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id));
            const featureRequest = result[0];
            if (!featureRequest) {
                return undefined;
            }
            // All users can see any feature request
            if (userRole === 'admin') {
                return featureRequest;
            }
            // For non-admin users, hide the createdBy field
            return {
                ...featureRequest,
                createdBy: null,
            };
        });
    }
    /**
     * Creates a new feature request.
     * @param featureRequestData
     */
    async createFeatureRequest(featureRequestData) {
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('createFeatureRequest', async () => {
            return db_1.db
                .insert(schema.featureRequests)
                .values({
                ...featureRequestData,
                id: crypto_1.default.randomUUID(),
                status: 'submitted',
                upvoteCount: 0,
                assignedTo: null,
                reviewedBy: null,
                reviewedAt: null,
                adminNotes: null,
                mergedIntoId: null,
                createdAt: new Date(),
                updatedAt: new Date(),
            })
                .returning();
        });
        // Invalidate cache
        query_cache_1.queryCache.invalidate('feature_requests');
        return result[0];
    }
    /**
     * Updates a feature request with role-based permissions.
     * Users can edit their own, managers can edit within org, admins can edit all.
     * @param id
     * @param updates
     * @param userId
     * @param userRole
     */
    async updateFeatureRequest(id, updates, userId, userRole) {
        // Get existing feature request to check permissions
        const existingFeatureRequest = await db_1.db
            .select()
            .from(schema.featureRequests)
            .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
            .limit(1);
        if (!existingFeatureRequest[0]) {
            return undefined;
        }
        // Check permissions: users can edit their own, admins can edit all
        const canEdit = userRole === 'admin' || existingFeatureRequest[0].createdBy === userId;
        if (!canEdit) {
            return undefined;
        }
        const result = await performance_monitoring_1.dbPerformanceMonitor.trackQuery('updateFeatureRequest', async () => {
            return db_1.db
                .update(schema.featureRequests)
                .set({
                ...updates,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
                .returning();
        });
        if (result[0]) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
        }
        return result[0];
    }
    /**
     * Deletes a feature request (admin only).
     * @param id
     * @param userId
     * @param userRole
     */
    async deleteFeatureRequest(id, userId, userRole) {
        // Only admins can delete feature requests
        if (userRole !== 'admin') {
            return false;
        }
        // First delete all upvotes for this feature request
        await db_1.db
            .delete(schema.featureRequestUpvotes)
            .where((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, id));
        const result = await db_1.db
            .delete(schema.featureRequests)
            .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, id))
            .returning();
        if (result.length > 0) {
            // Invalidate related cache entries
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return true;
        }
        return false;
    }
    /**
     * Upvotes a feature request.
     * @param upvoteData
     */
    async upvoteFeatureRequest(upvoteData) {
        const { featureRequestId, userId } = upvoteData;
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Check if user has already upvoted this feature request
            const existingUpvote = await db_1.db
                .select()
                .from(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)));
            if (existingUpvote.length > 0) {
                return {
                    success: false,
                    message: 'You have already upvoted this feature request',
                };
            }
            // Create the upvote
            const upvoteResult = await db_1.db
                .insert(schema.featureRequestUpvotes)
                .values({
                ...upvoteData,
                id: crypto_1.default.randomUUID(),
                createdAt: new Date(),
            })
                .returning();
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: (0, drizzle_orm_1.sql) `${schema.featureRequests.upvoteCount} + 1`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Feature request upvoted successfully',
                data: {
                    upvote: upvoteResult[0],
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('‚ùå Error upvoting feature request:', error);
            return {
                success: false,
                message: 'Failed to upvote feature request',
            };
        }
    }
    /**
     * Removes an upvote from a feature request.
     * @param featureRequestId
     * @param userId
     */
    async removeFeatureRequestUpvote(featureRequestId, userId) {
        try {
            // Check if feature request exists
            const featureRequestResult = await db_1.db
                .select()
                .from(schema.featureRequests)
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId));
            if (featureRequestResult.length === 0) {
                return {
                    success: false,
                    message: 'Feature request not found',
                };
            }
            // Find and remove the upvote
            const removedUpvote = await db_1.db
                .delete(schema.featureRequestUpvotes)
                .where((0, drizzle_orm_1.and)((0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.featureRequestId, featureRequestId), (0, drizzle_orm_1.eq)(schema.featureRequestUpvotes.userId, userId)))
                .returning();
            if (removedUpvote.length === 0) {
                return {
                    success: false,
                    message: 'You have not upvoted this feature request',
                };
            }
            // Update the upvote count on the feature request
            const updatedFeatureRequest = await db_1.db
                .update(schema.featureRequests)
                .set({
                upvoteCount: (0, drizzle_orm_1.sql) `GREATEST(0, ${schema.featureRequests.upvoteCount} - 1)`,
                updatedAt: new Date(),
            })
                .where((0, drizzle_orm_1.eq)(schema.featureRequests.id, featureRequestId))
                .returning();
            // Invalidate cache
            query_cache_1.queryCache.invalidate('feature_requests');
            query_cache_1.queryCache.invalidate('feature_request_upvotes');
            return {
                success: true,
                message: 'Upvote removed successfully',
                data: {
                    featureRequest: updatedFeatureRequest[0],
                },
            };
        }
        catch (error) {
            console.error('‚ùå Error removing feature request upvote:', error);
            return {
                success: false,
                message: 'Failed to remove upvote',
            };
        }
    }
    // Invoice operations
    async getInvoices(filters) {
        try {
            let query = db_1.db.select().from(schema.invoices);
            const conditions = [];
            if (filters) {
                if (filters.buildingId) {
                    conditions.push((0, drizzle_orm_1.eq)(schema.invoices.buildingId, filters.buildingId));
                }
                if (filters.residenceId) {
                    conditions.push((0, drizzle_orm_1.eq)(schema.invoices.residenceId, filters.residenceId));
                }
                if (filters.userId && filters.userRole) {
                    // Apply role-based filtering
                    if (filters.userRole === 'tenant' || filters.userRole === 'resident') {
                        conditions.push((0, drizzle_orm_1.eq)(schema.invoices.createdBy, filters.userId));
                    }
                    // Admin and manager can see all invoices (already filtered by building/residence above)
                }
            }
            if (conditions.length > 0) {
                query = query.where((0, drizzle_orm_1.and)(...conditions));
            }
            const invoices = await query.orderBy((0, drizzle_orm_1.desc)(schema.invoices.createdAt));
            return invoices;
        }
        catch (error) {
            console.error('‚ùå Error fetching invoices:', error);
            return [];
        }
    }
    async getInvoice(id) {
        try {
            const result = await db_1.db
                .select()
                .from(schema.invoices)
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .limit(1);
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error fetching invoice:', error);
            return undefined;
        }
    }
    async createInvoice(invoice) {
        try {
            const result = await db_1.db
                .insert(schema.invoices)
                .values(invoice)
                .returning();
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error creating invoice:', error);
            throw error;
        }
    }
    async updateInvoice(id, updates) {
        try {
            const result = await db_1.db
                .update(schema.invoices)
                .set({ ...updates, updatedAt: new Date() })
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .returning();
            return result[0];
        }
        catch (error) {
            console.error('‚ùå Error updating invoice:', error);
            return undefined;
        }
    }
    async deleteInvoice(id) {
        try {
            const result = await db_1.db
                .delete(schema.invoices)
                .where((0, drizzle_orm_1.eq)(schema.invoices.id, id))
                .returning();
            return result.length > 0;
        }
        catch (error) {
            console.error('‚ùå Error deleting invoice:', error);
            return false;
        }
    }
    // Admin-only method to count orphan users
    async countOrphanUsers() {
        console.log('üìä [STORAGE - COUNT] ===== COUNT ORPHAN USERS STARTED =====');
        console.log('‚è∞ [STORAGE - COUNT] Timestamp:', new Date().toISOString());
        try {
            const countQuery = `
        SELECT COUNT(*) as total 
        FROM users u
        WHERE u.is_active = true
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )
      `;
            console.log('üîç [STORAGE - COUNT] Executing SQL query:', countQuery.trim());
            console.log('‚è±Ô∏è [STORAGE - COUNT] Starting database execution...');
            const startTime = Date.now();
            const result = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
            const endTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - COUNT] Database query completed in:', (endTime - startTime), 'ms');
            console.log('üìà [STORAGE - COUNT] Raw database result:', result.rows);
            const count = parseInt(result.rows[0]?.total || '0');
            console.log('üî¢ [STORAGE - COUNT] Parsed orphan count:', count);
            console.log('üìä [STORAGE - COUNT] ===== COUNT ORPHAN USERS COMPLETED =====');
            return count;
        }
        catch (error) {
            console.error('üí• [STORAGE - COUNT] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - COUNT] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - COUNT] ===== END CRITICAL ERROR =====');
            return 0;
        }
    }
    // Admin-only method to count all users except specified admin
    async countAllUsersExcept(excludeUserId) {
        console.log('üìä [STORAGE - COUNT ALL] ===== COUNT ALL USERS EXCEPT ADMIN STARTED =====');
        console.log('‚è∞ [STORAGE - COUNT ALL] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - COUNT ALL] Excluding admin user ID:', excludeUserId);
        try {
            const countQuery = `
        SELECT COUNT(*) as total 
        FROM users u
        WHERE u.is_active = true
        AND u.id != '${excludeUserId}'
      `;
            console.log('üîç [STORAGE - COUNT ALL] Executing SQL query:', countQuery.trim());
            console.log('‚è±Ô∏è [STORAGE - COUNT ALL] Starting database execution...');
            const startTime = Date.now();
            const result = await db_1.db.execute(drizzle_orm_1.sql.raw(countQuery));
            const endTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - COUNT ALL] Database query completed in:', (endTime - startTime), 'ms');
            console.log('üìà [STORAGE - COUNT ALL] Raw database result:', result.rows);
            const count = parseInt(result.rows[0]?.total || '0');
            console.log('üî¢ [STORAGE - COUNT ALL] Parsed user count:', count);
            console.log('üìä [STORAGE - COUNT ALL] ===== COUNT ALL USERS EXCEPT ADMIN COMPLETED =====');
            return count;
        }
        catch (error) {
            console.error('üí• [STORAGE - COUNT ALL] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - COUNT ALL] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - COUNT ALL] ===== END CRITICAL ERROR =====');
            return 0;
        }
    }
    // Admin-only method to delete all users except specified admin
    async deleteAllUsersExcept(excludeUserId) {
        console.log('üóëÔ∏è [STORAGE - DELETE ALL] ===== DELETE ALL USERS EXCEPT ADMIN STARTED =====');
        console.log('‚è∞ [STORAGE - DELETE ALL] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - DELETE ALL] Excluding admin user ID:', excludeUserId);
        try {
            // First, let's get the list of users that will be affected for debugging
            const previewQuery = (0, drizzle_orm_1.sql) `SELECT u.id, u.email, u.first_name, u.last_name, u.role
        FROM users u
        WHERE u.is_active = true
          AND u.id != ${excludeUserId}`;
            console.log('üîç [STORAGE - DELETE ALL] Getting preview of users to be deleted...');
            const previewResult = await db_1.db.execute(previewQuery);
            console.log('üë• [STORAGE - DELETE ALL] Users to be deleted:', previewResult.rows);
            // Mark all other users as inactive
            const updateQuery = (0, drizzle_orm_1.sql) `UPDATE users 
        SET is_active = false,
            updated_at = CURRENT_TIMESTAMP
        WHERE is_active = true
          AND id != ${excludeUserId}`;
            console.log('üîß [STORAGE - DELETE ALL] Executing UPDATE query to mark users as inactive...');
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Starting update operation...');
            const startTime = Date.now();
            const result = await db_1.db.execute(updateQuery);
            const updateTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Update operation completed in:', (updateTime - startTime), 'ms');
            console.log('üìä [STORAGE - DELETE ALL] Update result:', result);
            // Count the affected rows
            const countQuery = (0, drizzle_orm_1.sql) `SELECT COUNT(*) as deleted_count
        FROM users u
        WHERE u.is_active = false
          AND u.id != ${excludeUserId}
          AND u.updated_at >= CURRENT_TIMESTAMP - INTERVAL '1 minute'`;
            console.log('üîç [STORAGE - DELETE ALL] Executing count query to verify deletion...');
            const countStartTime = Date.now();
            const countResult = await db_1.db.execute(countQuery);
            const countEndTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Count query completed in:', (countEndTime - countStartTime), 'ms');
            console.log('üìà [STORAGE - DELETE ALL] Raw count result:', countResult.rows);
            const deletedCount = parseInt(countResult.rows[0]?.deleted_count || '0');
            console.log('üî¢ [STORAGE - DELETE ALL] Final deleted count:', deletedCount);
            console.log('‚è±Ô∏è [STORAGE - DELETE ALL] Total operation time:', (countEndTime - startTime), 'ms');
            console.log('üóëÔ∏è [STORAGE - DELETE ALL] ===== DELETE ALL USERS EXCEPT ADMIN COMPLETED =====');
            return deletedCount;
        }
        catch (error) {
            console.error('üí• [STORAGE - DELETE ALL] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - DELETE ALL] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                excludeUserId: excludeUserId,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - DELETE ALL] ===== END CRITICAL ERROR =====');
            throw error;
        }
    }
    // Admin-only method to delete orphan users (excluding specified admin user)
    async deleteOrphanUsers(excludeUserId) {
        console.log('üóëÔ∏è [STORAGE - DELETE] ===== DELETE ORPHAN USERS STARTED =====');
        console.log('‚è∞ [STORAGE - DELETE] Timestamp:', new Date().toISOString());
        console.log('üîí [STORAGE - DELETE] Excluding admin user ID:', excludeUserId);
        try {
            // First, let's get the list of users that will be affected for debugging
            const previewQuery = (0, drizzle_orm_1.sql) `SELECT u.id, u.email, u.first_name, u.last_name, u.role
        FROM users u
        WHERE u.is_active = true
          AND u.id != ${excludeUserId}
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )`;
            console.log('üîç [STORAGE - DELETE] Getting preview of users to be deleted...');
            const previewResult = await db_1.db.execute(previewQuery);
            console.log('üë• [STORAGE - DELETE] Users to be deleted:', previewResult.rows);
            // Mark orphan users as inactive to avoid foreign key issues
            const updateQuery = (0, drizzle_orm_1.sql) `UPDATE users 
        SET is_active = false,
            updated_at = CURRENT_TIMESTAMP
        WHERE is_active = true
          AND id != ${excludeUserId}
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = id AND ur.is_active = true
          )`;
            console.log('üîß [STORAGE - DELETE] Executing UPDATE query to mark users as inactive...');
            console.log('‚è±Ô∏è [STORAGE - DELETE] Starting update operation...');
            const startTime = Date.now();
            const result = await db_1.db.execute(updateQuery);
            const updateTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE] Update operation completed in:', (updateTime - startTime), 'ms');
            console.log('üìä [STORAGE - DELETE] Update result:', result);
            // Count the affected rows
            const countQuery = (0, drizzle_orm_1.sql) `SELECT COUNT(*) as deleted_count
        FROM users u
        WHERE u.is_active = false
          AND u.id != ${excludeUserId}
          AND u.updated_at >= CURRENT_TIMESTAMP - INTERVAL '1 minute'
          AND NOT EXISTS (
            SELECT 1 FROM user_organizations uo 
            WHERE uo.user_id = u.id AND uo.is_active = true
          )
          AND NOT EXISTS (
            SELECT 1 FROM user_residences ur 
            WHERE ur.user_id = u.id AND ur.is_active = true
          )`;
            console.log('üîç [STORAGE - DELETE] Executing count query to verify deletion...');
            const countStartTime = Date.now();
            const countResult = await db_1.db.execute(countQuery);
            const countEndTime = Date.now();
            console.log('‚è±Ô∏è [STORAGE - DELETE] Count query completed in:', (countEndTime - countStartTime), 'ms');
            console.log('üìà [STORAGE - DELETE] Raw count result:', countResult.rows);
            const deletedCount = parseInt(countResult.rows[0]?.deleted_count || '0');
            console.log('üî¢ [STORAGE - DELETE] Final deleted count:', deletedCount);
            console.log('‚è±Ô∏è [STORAGE - DELETE] Total operation time:', (countEndTime - startTime), 'ms');
            console.log('üóëÔ∏è [STORAGE - DELETE] ===== DELETE ORPHAN USERS COMPLETED =====');
            return deletedCount;
        }
        catch (error) {
            console.error('üí• [STORAGE - DELETE] ===== CRITICAL ERROR =====');
            console.error('‚ùå [STORAGE - DELETE] Error details:', {
                message: error.message,
                stack: error.stack,
                name: error.name,
                code: error.code,
                excludeUserId: excludeUserId,
                timestamp: new Date().toISOString()
            });
            console.error('üí• [STORAGE - DELETE] ===== END CRITICAL ERROR =====');
            throw error;
        }
    }
}
exports.OptimizedDatabaseStorage = OptimizedDatabaseStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvb3B0aW1pemVkLWRiLXN0b3JhZ2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsNkNBQXlHO0FBQ3pHLHVFQUF1RTtBQUN2RSw2QkFBMEI7QUFDMUIsb0RBQTRCO0FBQzVCLHVEQUF5QztBQTBDekMsbUVBQW1HO0FBQ25HLCtDQUF3RTtBQUN4RSxxRUFBZ0U7QUFDaEUsNkNBQW1EO0FBRW5ELGlEQUFpRDtBQUVqRDs7R0FFRztBQUNILE1BQWEsd0JBQXdCO0lBQ25DOztPQUVHO0lBQ0g7UUFDRSx5Q0FBeUM7UUFDekMsSUFDRSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsS0FBSyxhQUFhO1lBQ3RDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3QkFBd0I7WUFDckMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUMzQixDQUFDO1lBQ0QsSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7UUFDakMsQ0FBQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyx1QkFBdUI7UUFDbkMsMENBQTBDO1FBQzFDLElBQ0UsT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTTtZQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWM7WUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFDaEMsQ0FBQztZQUNELHFEQUFxRDtZQUNyRCxPQUFPO1FBQ1QsQ0FBQztRQUVELElBQUksQ0FBQztZQUNILE1BQU0sc0NBQWMsQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1lBQzlDLGlDQUFpQztRQUNuQyxDQUFDO1FBQUMsT0FBTyxLQUFVLEVBQUUsQ0FBQztZQUNwQixPQUFPLENBQUMsS0FBSyxDQUFDLDhDQUE4QyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3ZF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WSxHQUFHLGNBQWMsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDO1lBQ3RHLE9BQU8sQ0FBQyxHQUFHLENBQUMseUNBQXlDLEVBQUUsV0FBVyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBRXpFLE1BQU0sWUFBWSxHQUFHLFFBQVEsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLGFBQWEsSUFBSSxHQUFHLENBQUMsQ0FBQztZQUN6RSxPQUFPLENBQUMsR0FBRyxDQUFDLDRDQUE0QyxFQUFFLFlBQVksQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTZDLEVBQUUsQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUM7WUFDN0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrRUFBa0UsQ0FBQyxDQUFDO1lBRWhGLE9BQU8sWUFBWSxDQUFDO1FBQ3RCLENBQUM7UUFBQyxPQUFPLEtBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sQ0FBQyxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQztZQUNsRSxPQUFPLENBQUMsS0FBSyxDQUFDLHFDQUFxQyxFQUFFO2dCQUNuRCxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87Z0JBQ3RCLEtBQUssRUFBRSxLQUFLLENBQUMsS0FBSztnQkFDbEIsSUFBSSxFQUFFLEtBQUssQ0FBQyxJQUFJO2dCQUNoQixJQUFJLEVBQUUsS0FBSyxDQUFDLElBQUk7Z0JBQ2hCLGFBQWEsRUFBRSxhQUFhO2dCQUM1QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxXQUFXLEVBQUU7YUFDcEMsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxDQUFDLEtBQUssQ0FBQyxzREFBc0QsQ0FBQyxDQUFDO1lBQ3RFLE1BQU0sS0FBSyxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7Q0FDRjtBQTdqSEQsNERBNmpIQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL3NlcnZlci9vcHRpbWl6ZWQtZGItc3RvcmFnZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE9wdGltaXplZCBkYXRhYmFzZSBzdG9yYWdlIHdpdGggY2FjaGluZyBhbmQgcGVyZm9ybWFuY2UgbW9uaXRvcmluZy5cbiAqIFJlcGxhY2VzIGRlY29yYXRvcnMgd2l0aCBkaXJlY3QgaW1wbGVtZW50YXRpb24gZm9yIGJldHRlciBjb21wYXRpYmlsaXR5LlxuICovXG5cbmltcG9ydCB7IGVxLCBkZXNjLCBhbmQsIG9yLCBndGUsIGx0ZSwgY291bnQsIGxpa2UsIGluQXJyYXksIGlzTnVsbCwgc3FsLCBub3RJbkFycmF5IH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuLy8gVXNlIHNoYXJlZCBkYXRhYmFzZSBjb25uZWN0aW9uIHRvIGF2b2lkIG11bHRpcGxlIHBvb2xzIGluIHByb2R1Y3Rpb25cbmltcG9ydCB7IGRiIH0gZnJvbSAnLi9kYic7XG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHR5cGUge1xuICBVc2VyLFxuICBJbnNlcnRVc2VyLFxuICBPcmdhbml6YXRpb24sXG4gIEluc2VydE9yZ2FuaXphdGlvbixcbiAgQnVpbGRpbmcsXG4gIEluc2VydEJ1aWxkaW5nLFxuICBSZXNpZGVuY2UsXG4gIEluc2VydFJlc2lkZW5jZSxcbiAgRG9jdW1lbnQsXG4gIEluc2VydERvY3VtZW50LFxuICBJbnNlcnRQaWxsYXIsXG4gIFBpbGxhciBhcyBEZXZlbG9wbWVudFBpbGxhcixcbiAgV29ya3NwYWNlU3RhdHVzLFxuICBJbnNlcnRXb3Jrc3BhY2VTdGF0dXMsXG4gIFF1YWxpdHlNZXRyaWMsXG4gIEluc2VydFF1YWxpdHlNZXRyaWMsXG4gIEZyYW1ld29ya0NvbmZpZ3VyYXRpb24sXG4gIEluc2VydEZyYW1ld29ya0NvbmZpZ3VyYXRpb24sXG4gIEltcHJvdmVtZW50U3VnZ2VzdGlvbixcbiAgSW5zZXJ0SW1wcm92ZW1lbnRTdWdnZXN0aW9uLFxuICBGZWF0dXJlLFxuICBJbnNlcnRGZWF0dXJlLFxuICBBY3Rpb25hYmxlSXRlbSxcbiAgSW5zZXJ0QWN0aW9uYWJsZUl0ZW0sXG4gIEludml0YXRpb24sXG4gIEluc2VydEludml0YXRpb24sXG4gIEludml0YXRpb25BdWRpdExvZyxcbiAgSW5zZXJ0SW52aXRhdGlvbkF1ZGl0TG9nLFxuICBQZXJtaXNzaW9uLFxuICBSb2xlUGVybWlzc2lvbixcbiAgVXNlclBlcm1pc3Npb24sXG4gIFBhc3N3b3JkUmVzZXRUb2tlbixcbiAgSW5zZXJ0UGFzc3dvcmRSZXNldFRva2VuLFxuICBCdWcsXG4gIEluc2VydEJ1ZyxcbiAgSW52b2ljZSxcbiAgSW5zZXJ0SW52b2ljZSxcbn0gZnJvbSAnQHNoYXJlZC9zY2hlbWEnO1xuaW1wb3J0IHR5cGUgeyBJU3RvcmFnZSB9IGZyb20gJy4vc3RvcmFnZSc7XG5pbXBvcnQgdHlwZSB7IFBpbGxhciB9IGZyb20gJ0BzaGFyZWQvc2NoZW1hJztcbmltcG9ydCB7IFF1ZXJ5T3B0aW1pemVyLCBQYWdpbmF0aW9uSGVscGVyLCB0eXBlIFBhZ2luYXRpb25PcHRpb25zIH0gZnJvbSAnLi9kYXRhYmFzZS1vcHRpbWl6YXRpb24nO1xuaW1wb3J0IHsgcXVlcnlDYWNoZSwgQ2FjaGVJbnZhbGlkYXRvciwgd2l0aENhY2hlIH0gZnJvbSAnLi9xdWVyeS1jYWNoZSc7XG5pbXBvcnQgeyBkYlBlcmZvcm1hbmNlTW9uaXRvciB9IGZyb20gJy4vcGVyZm9ybWFuY2UtbW9uaXRvcmluZyc7XG5pbXBvcnQgeyBleGlzdHMsIHNxbCBhcyBzcWxPcCB9IGZyb20gJ2RyaXp6bGUtb3JtJztcblxuLy8gRGF0YWJhc2UgY29ubmVjdGlvbiBpbXBvcnRlZCBmcm9tIHNoYXJlZCBkYi50c1xuXG4vKipcbiAqIEVuaGFuY2VkIGRhdGFiYXNlIHN0b3JhZ2Ugd2l0aCBidWlsdC1pbiBjYWNoaW5nIGFuZCBwZXJmb3JtYW5jZSBtb25pdG9yaW5nLlxuICovXG5leHBvcnQgY2xhc3MgT3B0aW1pemVkRGF0YWJhc2VTdG9yYWdlIGltcGxlbWVudHMgSVN0b3JhZ2Uge1xuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIFNraXAgb3B0aW1pemF0aW9ucyBpbiB0ZXN0IGVudmlyb25tZW50XG4gICAgaWYgKFxuICAgICAgcHJvY2Vzcy5lbnYuVEVTVF9FTlYgIT09ICdpbnRlZ3JhdGlvbicgJiZcbiAgICAgICFwcm9jZXNzLmVudi5ESVNBQkxFX0RCX09QVElNSVpBVElPTlMgJiZcbiAgICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAndGVzdCcgJiZcbiAgICAgICFwcm9jZXNzLmVudi5KRVNUX1dPUktFUl9JRFxuICAgICkge1xuICAgICAgdGhpcy5pbml0aWFsaXplT3B0aW1pemF0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplcyBkYXRhYmFzZSBvcHRpbWl6YXRpb25zLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBpbml0aWFsaXplT3B0aW1pemF0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBTa2lwIGRhdGFiYXNlIG9wdGltaXphdGlvbiBkdXJpbmcgdGVzdHNcbiAgICBpZiAoXG4gICAgICBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Rlc3QnIHx8XG4gICAgICBwcm9jZXNzLmVudi5KRVNUX1dPUktFUl9JRCB8fFxuICAgICAgcHJvY2Vzcy5lbnYuU0tJUF9EQl9PUFRJTUlaQVRJT05cbiAgICApIHtcbiAgICAgIC8vIERhdGFiYXNlIG9wdGltaXphdGlvbnMgc2tpcHBlZCBpbiB0ZXN0IGVudmlyb25tZW50XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IFF1ZXJ5T3B0aW1pemVyLmFwcGx5Q29yZU9wdGltaXphdGlvbnMoKTtcbiAgICAgIC8vIERhdGFiYXNlIG9wdGltaXphdGlvbnMgYXBwbGllZFxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbml0aWFsaXppbmcgZGF0YWJhc2Ugb3B0aW1pemF0aW9uczonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFdyYXBwZXIgZm9yIHBlcmZvcm1hbmNlIHRyYWNraW5nIGFuZCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gb3BlcmF0aW9uXG4gICAqIEBwYXJhbSBjYWNoZUtleVxuICAgKiBAcGFyYW0gY2FjaGVUeXBlXG4gICAqIEBwYXJhbSBmblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB3aXRoT3B0aW1pemF0aW9uczxUPihcbiAgICBvcGVyYXRpb246IHN0cmluZyxcbiAgICBjYWNoZUtleTogc3RyaW5nIHwgbnVsbCxcbiAgICBjYWNoZVR5cGU6IHN0cmluZyxcbiAgICBmbjogKCkgPT4gUHJvbWlzZTxUPlxuICApOiBQcm9taXNlPFQ+IHtcbiAgICAvLyBUcnkgY2FjaGUgZmlyc3RcbiAgICBpZiAoY2FjaGVLZXkpIHtcbiAgICAgIGNvbnN0IGNhY2hlZCA9IHF1ZXJ5Q2FjaGUuZ2V0PFQ+KGNhY2hlVHlwZSwgY2FjaGVLZXkpO1xuICAgICAgaWYgKGNhY2hlZCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gRXhlY3V0ZSB3aXRoIHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeShvcGVyYXRpb24sIGZuKTtcblxuICAgIC8vIENhY2hlIHJlc3VsdFxuICAgIGlmIChjYWNoZUtleSAmJiByZXN1bHQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVlcnlDYWNoZS5zZXQoY2FjaGVUeXBlLCBjYWNoZUtleSwgcmVzdWx0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLy8gVXNlciBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbGwgYWN0aXZlIHVzZXJzIHdpdGggY2FjaGluZyBhbmQgcGVyZm9ybWFuY2UgdHJhY2tpbmcuXG4gICAqL1xuICBhc3luYyBnZXRVc2VycygpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRVc2VycycsICdhbGxfdXNlcnMnLCAndXNlcnMnLCAoKSA9PlxuICAgICAgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIC5saW1pdCgxMDApIC8vIEFsd2F5cyB1c2UgTElNSVQgZm9yIGxhcmdlIHJlc3VsdCBzZXRzXG4gICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYWxsIGFjdGl2ZSB1c2VycyB3aXRoIHRoZWlyIGFzc2lnbm1lbnRzIChvcmdhbml6YXRpb25zLCBidWlsZGluZ3MsIHJlc2lkZW5jZXMpLlxuICAgKiBPUFRJTUlaRUQ6IFVzZXMgc2luZ2xlIHF1ZXJ5IHdpdGggSk9JTnMgYW5kIGFnZ3JlZ2F0aW9uIGluc3RlYWQgb2YgTisxIHF1ZXJpZXMuXG4gICAqL1xuICBhc3luYyBnZXRVc2Vyc1dpdGhBc3NpZ25tZW50cygpOiBQcm9taXNlPEFycmF5PFVzZXIgJiB7IG9yZ2FuaXphdGlvbnM6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nOyB0eXBlOiBzdHJpbmcgfT47IGJ1aWxkaW5nczogQXJyYXk8eyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfT47IHJlc2lkZW5jZXM6IEFycmF5PHsgaWQ6IHN0cmluZzsgdW5pdE51bWJlcjogc3RyaW5nOyBidWlsZGluZ0lkOiBzdHJpbmc7IGJ1aWxkaW5nTmFtZTogc3RyaW5nIH0+IH0+PiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlcnNXaXRoQXNzaWdubWVudHMnLFxuICAgICAgJ2FsbF91c2Vyc19hc3NpZ25tZW50c19vcHRpbWl6ZWRfdjQnLFxuICAgICAgJ3VzZXJzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAvLyBTaW5nbGUgb3B0aW1pemVkIHF1ZXJ5IHVzaW5nIENURXMgYW5kIGFnZ3JlZ2F0aW9uXG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWxgXG4gICAgICAgICAgICBXSVRIIHVzZXJfb3JncyBBUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgICB1by51c2VyX2lkLFxuICAgICAgICAgICAgICAgIENPQUxFU0NFKFxuICAgICAgICAgICAgICAgICAganNvbl9hZ2coXG4gICAgICAgICAgICAgICAgICAgIGpzb25fYnVpbGRfb2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICAgICdpZCcsIG8uaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ25hbWUnLCBvLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnLCBvLnR5cGVcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIG8uaWQgSVMgTk9UIE5VTEwpLFxuICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICkgYXMgb3JnYW5pemF0aW9uc1xuICAgICAgICAgICAgICBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b1xuICAgICAgICAgICAgICBJTk5FUiBKT0lOIG9yZ2FuaXphdGlvbnMgbyBPTiB1by5vcmdhbml6YXRpb25faWQgPSBvLmlkXG4gICAgICAgICAgICAgIFdIRVJFIHVvLmlzX2FjdGl2ZSA9IHRydWUgQU5EIG8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICBHUk9VUCBCWSB1by51c2VyX2lkXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdXNlcl9idWlsZGluZ3MgQVMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgdW8udXNlcl9pZCxcbiAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAnaWQnLCBidWlsZGluZ3NfZGlzdGluY3QuaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ25hbWUnLCBidWlsZGluZ3NfZGlzdGluY3QubmFtZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICkgYXMgYnVpbGRpbmdzXG4gICAgICAgICAgICAgIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gKFxuICAgICAgICAgICAgICAgIFNFTEVDVCBESVNUSU5DVCB1bzIudXNlcl9pZCwgYi5pZCwgYi5uYW1lXG4gICAgICAgICAgICAgICAgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW8yXG4gICAgICAgICAgICAgICAgSU5ORVIgSk9JTiBidWlsZGluZ3MgYiBPTiB1bzIub3JnYW5pemF0aW9uX2lkID0gYi5vcmdhbml6YXRpb25faWRcbiAgICAgICAgICAgICAgICBXSEVSRSB1bzIuaXNfYWN0aXZlID0gdHJ1ZSBBTkQgYi5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgICkgYnVpbGRpbmdzX2Rpc3RpbmN0IE9OIHVvLnVzZXJfaWQgPSBidWlsZGluZ3NfZGlzdGluY3QudXNlcl9pZFxuICAgICAgICAgICAgICBXSEVSRSB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgIEdST1VQIEJZIHVvLnVzZXJfaWRcbiAgICAgICAgICAgICksXG4gICAgICAgICAgICB1c2VyX3Jlc2lkZW5jZXMgQVMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgdXIudXNlcl9pZCxcbiAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAnaWQnLCByLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICd1bml0TnVtYmVyJywgci51bml0X251bWJlcixcbiAgICAgICAgICAgICAgICAgICAgICAnYnVpbGRpbmdJZCcsIHIuYnVpbGRpbmdfaWQsXG4gICAgICAgICAgICAgICAgICAgICAgJ2J1aWxkaW5nTmFtZScsIGIubmFtZVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApIEZJTFRFUiAoV0hFUkUgci5pZCBJUyBOT1QgTlVMTCksXG4gICAgICAgICAgICAgICAgICAnW10nOjpqc29uXG4gICAgICAgICAgICAgICAgKSBhcyByZXNpZGVuY2VzXG4gICAgICAgICAgICAgIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gcmVzaWRlbmNlcyByIE9OIHVyLnJlc2lkZW5jZV9pZCA9IHIuaWRcbiAgICAgICAgICAgICAgSU5ORVIgSk9JTiBidWlsZGluZ3MgYiBPTiByLmJ1aWxkaW5nX2lkID0gYi5pZFxuICAgICAgICAgICAgICBXSEVSRSB1ci5pc19hY3RpdmUgPSB0cnVlIEFORCByLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgR1JPVVAgQlkgdXIudXNlcl9pZFxuICAgICAgICAgICAgKVxuICAgICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgICB1LiosXG4gICAgICAgICAgICAgIENPQUxFU0NFKHVvLm9yZ2FuaXphdGlvbnMsICdbXSc6Ompzb24pIGFzIG9yZ2FuaXphdGlvbnMsXG4gICAgICAgICAgICAgIENPQUxFU0NFKHViLmJ1aWxkaW5ncywgJ1tdJzo6anNvbikgYXMgYnVpbGRpbmdzLFxuICAgICAgICAgICAgICBDT0FMRVNDRSh1ci5yZXNpZGVuY2VzLCAnW10nOjpqc29uKSBhcyByZXNpZGVuY2VzXG4gICAgICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgICAgIExFRlQgSk9JTiB1c2VyX29yZ3MgdW8gT04gdS5pZCA9IHVvLnVzZXJfaWRcbiAgICAgICAgICAgIExFRlQgSk9JTiB1c2VyX2J1aWxkaW5ncyB1YiBPTiB1LmlkID0gdWIudXNlcl9pZFxuICAgICAgICAgICAgTEVGVCBKT0lOIHVzZXJfcmVzaWRlbmNlcyB1ciBPTiB1LmlkID0gdXIudXNlcl9pZFxuICAgICAgICAgICAgV0hFUkUgdS5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICBPUkRFUiBCWSB1LmNyZWF0ZWRfYXQgREVTQ1xuICAgICAgICAgICAgTElNSVQgMTAwXG4gICAgICAgICAgYCk7XG5cbiAgICAgICAgICAvLyBUcmFuc2Zvcm0gdGhlIHJhdyBTUUwgcmVzdWx0IHRvIG1hdGNoIHRoZSBleHBlY3RlZCBUeXBlU2NyaXB0IHR5cGVzXG4gICAgICAgICAgcmV0dXJuIHJlc3VsdC5yb3dzLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgICAgICAgICBpZDogcm93LmlkLFxuICAgICAgICAgICAgdXNlcm5hbWU6IHJvdy51c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiByb3cucGFzc3dvcmQsXG4gICAgICAgICAgICBlbWFpbDogcm93LmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiByb3cuZmlyc3RfbmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiByb3cubGFzdF9uYW1lLFxuICAgICAgICAgICAgcGhvbmU6IHJvdy5waG9uZSxcbiAgICAgICAgICAgIHByb2ZpbGVJbWFnZTogcm93LnByb2ZpbGVfaW1hZ2UsXG4gICAgICAgICAgICBsYW5ndWFnZTogcm93Lmxhbmd1YWdlLFxuICAgICAgICAgICAgcm9sZTogcm93LnJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogcm93LmlzX2FjdGl2ZSxcbiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiByb3cubGFzdF9sb2dpbl9hdCxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uczogdHlwZW9mIHJvdy5vcmdhbml6YXRpb25zID09PSAnc3RyaW5nJyBcbiAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKHJvdy5vcmdhbml6YXRpb25zKSBcbiAgICAgICAgICAgICAgOiByb3cub3JnYW5pemF0aW9ucyB8fCBbXSxcbiAgICAgICAgICAgIGJ1aWxkaW5nczogdHlwZW9mIHJvdy5idWlsZGluZ3MgPT09ICdzdHJpbmcnIFxuICAgICAgICAgICAgICA/IEpTT04ucGFyc2Uocm93LmJ1aWxkaW5ncykgXG4gICAgICAgICAgICAgIDogcm93LmJ1aWxkaW5ncyB8fCBbXSxcbiAgICAgICAgICAgIHJlc2lkZW5jZXM6IHR5cGVvZiByb3cucmVzaWRlbmNlcyA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gSlNPTi5wYXJzZShyb3cucmVzaWRlbmNlcykgXG4gICAgICAgICAgICAgIDogcm93LnJlc2lkZW5jZXMgfHwgW11cbiAgICAgICAgICB9KSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgaW4gb3B0aW1pemVkIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBGYWxsYmFjayB0byB0aGUgb3JpZ2luYWwgaW1wbGVtZW50YXRpb24gaWYgb3B0aW1pemVkIHF1ZXJ5IGZhaWxzXG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflIQgRmFsbGluZyBiYWNrIHRvIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uLi4uJyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNGYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgcGFnaW5hdGVkIGFjdGl2ZSB1c2VycyB3aXRoIHRoZWlyIGFzc2lnbm1lbnRzIChvcmdhbml6YXRpb25zLCBidWlsZGluZ3MsIHJlc2lkZW5jZXMpLlxuICAgKiBPUFRJTUlaRUQ6IFVzZXMgc2luZ2xlIHF1ZXJ5IHdpdGggSk9JTnMsIGFnZ3JlZ2F0aW9uLCBhbmQgTElNSVQvT0ZGU0VUIGZvciBwYWdpbmF0aW9uLlxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWQoXG4gICAgb2Zmc2V0OiBudW1iZXIgPSAwLCBcbiAgICBsaW1pdDogbnVtYmVyID0gMTAsIFxuICAgIGZpbHRlcnM6IHsgcm9sZT86IHN0cmluZzsgc3RhdHVzPzogc3RyaW5nOyBvcmdhbml6YXRpb24/OiBzdHJpbmc7IG9ycGhhbj86IHN0cmluZzsgZGVtb09ubHk/OiBzdHJpbmc7IG1hbmFnZXJPcmdhbml6YXRpb25zPzogc3RyaW5nOyBzZWFyY2g/OiBzdHJpbmcgfSA9IHt9XG4gICk6IFByb21pc2U8e1xuICAgIHVzZXJzOiBBcnJheTxVc2VyICYgeyBvcmdhbml6YXRpb25zOiBBcnJheTx7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgdHlwZTogc3RyaW5nIH0+OyBidWlsZGluZ3M6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nIH0+OyByZXNpZGVuY2VzOiBBcnJheTx7IGlkOiBzdHJpbmc7IHVuaXROdW1iZXI6IHN0cmluZzsgYnVpbGRpbmdJZDogc3RyaW5nOyBidWlsZGluZ05hbWU6IHN0cmluZyB9PiB9PjtcbiAgICB0b3RhbDogbnVtYmVyO1xuICB9PiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWQnLFxuICAgICAgYHBhZ2luYXRlZF91c2Vyc18ke29mZnNldH1fJHtsaW1pdH1fJHtKU09OLnN0cmluZ2lmeShmaWx0ZXJzKX1fdjRgLFxuICAgICAgJ3VzZXJzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBbREIgRklMVEVSXSBJbnB1dCBmaWx0ZXJzOicsIEpTT04uc3RyaW5naWZ5KGZpbHRlcnMsIG51bGwsIDIpKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBCdWlsZCBXSEVSRSBjb25kaXRpb25zIGZvciBmaWx0ZXJpbmdcbiAgICAgICAgICBsZXQgd2hlcmVDb25kaXRpb25zID0gW107XG4gICAgICAgICAgbGV0IGNvdW50V2hlcmVDb25kaXRpb25zID0gW107XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGZpbHRlcnMucm9sZSkge1xuICAgICAgICAgICAgaWYgKGZpbHRlcnMucm9sZSA9PT0gJ251bGwnKSB7XG4gICAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKCd1LnJvbGUgSVMgTlVMTCcpO1xuICAgICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKCdyb2xlIElTIE5VTEwnKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGB1LnJvbGUgPSAnJHtmaWx0ZXJzLnJvbGV9J2ApO1xuICAgICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKGByb2xlID0gJyR7ZmlsdGVycy5yb2xlfSdgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKGZpbHRlcnMuc3RhdHVzKSB7XG4gICAgICAgICAgICBpZiAoZmlsdGVycy5zdGF0dXMgPT09ICdudWxsJykge1xuICAgICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaCgndS5pc19hY3RpdmUgSVMgTlVMTCcpO1xuICAgICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKCdpc19hY3RpdmUgSVMgTlVMTCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc3QgaXNBY3RpdmUgPSBmaWx0ZXJzLnN0YXR1cyA9PT0gJ3RydWUnO1xuICAgICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChgdS5pc19hY3RpdmUgPSAke2lzQWN0aXZlfWApO1xuICAgICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKGBpc19hY3RpdmUgPSAke2lzQWN0aXZlfWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBEZWZhdWx0OiBvbmx5IHNob3cgYWN0aXZlIHVzZXJzIGlmIG5vIHN0YXR1cyBmaWx0ZXIgaXMgYXBwbGllZFxuICAgICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goJ3UuaXNfYWN0aXZlID0gdHJ1ZScpO1xuICAgICAgICAgICAgY291bnRXaGVyZUNvbmRpdGlvbnMucHVzaCgnaXNfYWN0aXZlID0gdHJ1ZScpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIERlbW8tb25seSBmaWx0ZXIgZm9yIGRlbW8gdXNlcnNcbiAgICAgICAgICBpZiAoZmlsdGVycy5kZW1vT25seSA9PT0gJ3RydWUnKSB7XG4gICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChcIih1LnJvbGUgTElLRSAnZGVtb18lJylcIik7XG4gICAgICAgICAgICBjb3VudFdoZXJlQ29uZGl0aW9ucy5wdXNoKFwiKHJvbGUgTElLRSAnZGVtb18lJylcIik7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gU2VhcmNoIGZpbHRlciBmb3IgbmFtZS9lbWFpbFxuICAgICAgICAgIGlmIChmaWx0ZXJzLnNlYXJjaCAmJiBmaWx0ZXJzLnNlYXJjaC50cmltKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlYXJjaFRlcm0gPSBmaWx0ZXJzLnNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGAoXG4gICAgICAgICAgICAgIExPV0VSKHUuZmlyc3RfbmFtZSB8fCAnICcgfHwgdS5sYXN0X25hbWUpIExJS0UgJyUke3NlYXJjaFRlcm19JScgT1IgXG4gICAgICAgICAgICAgIExPV0VSKHUuZW1haWwpIExJS0UgJyUke3NlYXJjaFRlcm19JScgT1IgXG4gICAgICAgICAgICAgIExPV0VSKHUudXNlcm5hbWUpIExJS0UgJyUke3NlYXJjaFRlcm19JSdcbiAgICAgICAgICAgIClgKTtcbiAgICAgICAgICAgIGNvdW50V2hlcmVDb25kaXRpb25zLnB1c2goYChcbiAgICAgICAgICAgICAgTE9XRVIoZmlyc3RfbmFtZSB8fCAnICcgfHwgbGFzdF9uYW1lKSBMSUtFICclJHtzZWFyY2hUZXJtfSUnIE9SIFxuICAgICAgICAgICAgICBMT1dFUihlbWFpbCkgTElLRSAnJSR7c2VhcmNoVGVybX0lJyBPUiBcbiAgICAgICAgICAgICAgTE9XRVIodXNlcm5hbWUpIExJS0UgJyUke3NlYXJjaFRlcm19JSdcbiAgICAgICAgICAgIClgKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTRUFSQ0ggRklMVEVSXSBBcHBsaWVkIHNlYXJjaCBmb3I6Jywgc2VhcmNoVGVybSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gTWFuYWdlciBvcmdhbml6YXRpb25zIGZpbHRlciAtIG9ubHkgc2hvdyB1c2VycyBmcm9tIHNwZWNpZmljIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICBpZiAoZmlsdGVycy5tYW5hZ2VyT3JnYW5pemF0aW9ucyAmJiBmaWx0ZXJzLm1hbmFnZXJPcmdhbml6YXRpb25zLnRyaW0oKSkge1xuICAgICAgICAgICAgY29uc3Qgb3JnSWRzID0gZmlsdGVycy5tYW5hZ2VyT3JnYW5pemF0aW9ucy5zcGxpdCgnLCcpLm1hcChpZCA9PiBgJyR7aWQudHJpbSgpfSdgKS5qb2luKCcsJyk7XG4gICAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChgRVhJU1RTIChcbiAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9fbWdyIFxuICAgICAgICAgICAgICBXSEVSRSB1b19tZ3IudXNlcl9pZCA9IHUuaWQgXG4gICAgICAgICAgICAgIEFORCB1b19tZ3Iub3JnYW5pemF0aW9uX2lkIElOICgke29yZ0lkc30pXG4gICAgICAgICAgICAgIEFORCB1b19tZ3IuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgKWApO1xuICAgICAgICAgICAgY291bnRXaGVyZUNvbmRpdGlvbnMucHVzaChgRVhJU1RTIChcbiAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9fbWdyIFxuICAgICAgICAgICAgICBXSEVSRSB1b19tZ3IudXNlcl9pZCA9IHVzZXJzLmlkIFxuICAgICAgICAgICAgICBBTkQgdW9fbWdyLm9yZ2FuaXphdGlvbl9pZCBJTiAoJHtvcmdJZHN9KVxuICAgICAgICAgICAgICBBTkQgdW9fbWdyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgIClgKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5GUIFtNQU5BR0VSIEZJTFRFUl0gQXBwbGllZCBvcmdhbml6YXRpb24gZmlsdGVyIGZvcjonLCBvcmdJZHMpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIEZpcnN0IGdldCB0b3RhbCBjb3VudCBmb3IgcGFnaW5hdGlvbiBtZXRhZGF0YSB3aXRoIGZpbHRlcnNcbiAgICAgICAgICBjb25zdCBjb3VudFF1ZXJ5ID0gYFxuICAgICAgICAgICAgU0VMRUNUIENPVU5UKCopIGFzIHRvdGFsIFxuICAgICAgICAgICAgRlJPTSB1c2VycyBcbiAgICAgICAgICAgIFdIRVJFICR7Y291bnRXaGVyZUNvbmRpdGlvbnMubGVuZ3RoID4gMCA/IGNvdW50V2hlcmVDb25kaXRpb25zLmpvaW4oJyBBTkQgJykgOiAnMT0xJ31cbiAgICAgICAgICAgICR7ZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcmdhbml6YXRpb24udHJpbSgpID8gYEFORCBFWElTVFMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19maWx0ZXIgXG4gICAgICAgICAgICAgIFdIRVJFIHVvX2ZpbHRlci51c2VyX2lkID0gdXNlcnMuaWQgXG4gICAgICAgICAgICAgIEFORCB1b19maWx0ZXIub3JnYW5pemF0aW9uX2lkID0gJyR7ZmlsdGVycy5vcmdhbml6YXRpb24udHJpbSgpfSdcbiAgICAgICAgICAgICAgQU5EIHVvX2ZpbHRlci5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICApYCA6ICcnfVxuICAgICAgICAgICAgJHshZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcnBoYW4gPT09ICd0cnVlJyA/IGBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvX2NvdW50X29ycGhhbiBcbiAgICAgICAgICAgICAgV0hFUkUgdW9fY291bnRfb3JwaGFuLnVzZXJfaWQgPSB1c2Vycy5pZCBBTkQgdW9fY291bnRfb3JwaGFuLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICkgQU5EIE5PVCBFWElTVFMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1cl9jb3VudF9vcnBoYW4gXG4gICAgICAgICAgICAgIFdIRVJFIHVyX2NvdW50X29ycGhhbi51c2VyX2lkID0gdXNlcnMuaWQgQU5EIHVyX2NvdW50X29ycGhhbi5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICApYCA6ICcnfVxuICAgICAgICAgICAgJHshZmlsdGVycy5vcmdhbml6YXRpb24gJiYgZmlsdGVycy5vcnBoYW4gPT09ICdmYWxzZScgPyBgQU5EIChFWElTVFMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19jb3VudF9hc3NpZ25lZCBcbiAgICAgICAgICAgICAgV0hFUkUgdW9fY291bnRfYXNzaWduZWQudXNlcl9pZCA9IHVzZXJzLmlkIEFORCB1b19jb3VudF9hc3NpZ25lZC5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICApIE9SIEVYSVNUUyAoXG4gICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyX2NvdW50X2Fzc2lnbmVkIFxuICAgICAgICAgICAgICBXSEVSRSB1cl9jb3VudF9hc3NpZ25lZC51c2VyX2lkID0gdXNlcnMuaWQgQU5EIHVyX2NvdW50X2Fzc2lnbmVkLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICkpYCA6ICcnfVxuICAgICAgICAgICAgJHtmaWx0ZXJzLnNlYXJjaCAmJiBmaWx0ZXJzLnNlYXJjaC50cmltKCkgPyBgQU5EIChcbiAgICAgICAgICAgICAgTE9XRVIoZmlyc3RfbmFtZSB8fCAnICcgfHwgbGFzdF9uYW1lKSBMSUtFICclJHtmaWx0ZXJzLnNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKX0lJyBPUiBcbiAgICAgICAgICAgICAgTE9XRVIoZW1haWwpIExJS0UgJyUke2ZpbHRlcnMuc2VhcmNoLnRyaW0oKS50b0xvd2VyQ2FzZSgpfSUnIE9SIFxuICAgICAgICAgICAgICBMT1dFUih1c2VybmFtZSkgTElLRSAnJSR7ZmlsdGVycy5zZWFyY2gudHJpbSgpLnRvTG93ZXJDYXNlKCl9JSdcbiAgICAgICAgICAgIClgIDogJyd9XG4gICAgICAgICAgYDtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBbQ09VTlQgU1FMXTonLCBjb3VudFF1ZXJ5KTtcbiAgICAgICAgICBjb25zdCBjb3VudFJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjb3VudFF1ZXJ5KSk7XG4gICAgICAgICAgY29uc3QgdG90YWwgPSBwYXJzZUludChjb3VudFJlc3VsdC5yb3dzWzBdPy50b3RhbCB8fCAnMCcpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OKIFtDT1VOVCBSRVNVTFRdOicsIHRvdGFsKTtcblxuICAgICAgICAgIC8vIFNpbmdsZSBvcHRpbWl6ZWQgcXVlcnkgdXNpbmcgQ1RFcyBhbmQgYWdncmVnYXRpb24gd2l0aCBwYWdpbmF0aW9uIGFuZCBmaWx0ZXJzXG4gICAgICAgICAgY29uc3QgbWFpblF1ZXJ5ID0gYFxuICAgICAgICAgICAgV0lUSCB1c2VyX29yZ3MgQVMgKFxuICAgICAgICAgICAgICBTRUxFQ1QgXG4gICAgICAgICAgICAgICAgdW8udXNlcl9pZCxcbiAgICAgICAgICAgICAgICBDT0FMRVNDRShcbiAgICAgICAgICAgICAgICAgIGpzb25fYWdnKFxuICAgICAgICAgICAgICAgICAgICBqc29uX2J1aWxkX29iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAnaWQnLCBvLmlkLFxuICAgICAgICAgICAgICAgICAgICAgICduYW1lJywgby5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICd0eXBlJywgby50eXBlXG4gICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICkgRklMVEVSIChXSEVSRSBvLmlkIElTIE5PVCBOVUxMKSxcbiAgICAgICAgICAgICAgICAgICdbXSc6Ompzb25cbiAgICAgICAgICAgICAgICApIGFzIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgICAgICAgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9cbiAgICAgICAgICAgICAgSU5ORVIgSk9JTiBvcmdhbml6YXRpb25zIG8gT04gdW8ub3JnYW5pemF0aW9uX2lkID0gby5pZFxuICAgICAgICAgICAgICBXSEVSRSB1by5pc19hY3RpdmUgPSB0cnVlIEFORCBvLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgR1JPVVAgQlkgdW8udXNlcl9pZFxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHVzZXJfYnVpbGRpbmdzIEFTIChcbiAgICAgICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgICAgIHVvLnVzZXJfaWQsXG4gICAgICAgICAgICAgICAgQ09BTEVTQ0UoXG4gICAgICAgICAgICAgICAgICBqc29uX2FnZyhcbiAgICAgICAgICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgJ2lkJywgYnVpbGRpbmdzX2Rpc3RpbmN0LmlkLFxuICAgICAgICAgICAgICAgICAgICAgICduYW1lJywgYnVpbGRpbmdzX2Rpc3RpbmN0Lm5hbWVcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgICdbXSc6Ompzb25cbiAgICAgICAgICAgICAgICApIGFzIGJ1aWxkaW5nc1xuICAgICAgICAgICAgICBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b1xuICAgICAgICAgICAgICBJTk5FUiBKT0lOIChcbiAgICAgICAgICAgICAgICBTRUxFQ1QgRElTVElOQ1QgdW8yLnVzZXJfaWQsIGIuaWQsIGIubmFtZVxuICAgICAgICAgICAgICAgIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvMlxuICAgICAgICAgICAgICAgIElOTkVSIEpPSU4gYnVpbGRpbmdzIGIgT04gdW8yLm9yZ2FuaXphdGlvbl9pZCA9IGIub3JnYW5pemF0aW9uX2lkXG4gICAgICAgICAgICAgICAgV0hFUkUgdW8yLmlzX2FjdGl2ZSA9IHRydWUgQU5EIGIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApIGJ1aWxkaW5nc19kaXN0aW5jdCBPTiB1by51c2VyX2lkID0gYnVpbGRpbmdzX2Rpc3RpbmN0LnVzZXJfaWRcbiAgICAgICAgICAgICAgV0hFUkUgdW8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICBHUk9VUCBCWSB1by51c2VyX2lkXG4gICAgICAgICAgICApLFxuICAgICAgICAgICAgdXNlcl9yZXNpZGVuY2VzIEFTIChcbiAgICAgICAgICAgICAgU0VMRUNUIFxuICAgICAgICAgICAgICAgIHVyLnVzZXJfaWQsXG4gICAgICAgICAgICAgICAgQ09BTEVTQ0UoXG4gICAgICAgICAgICAgICAgICBqc29uX2FnZyhcbiAgICAgICAgICAgICAgICAgICAganNvbl9idWlsZF9vYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgJ2lkJywgci5pZCxcbiAgICAgICAgICAgICAgICAgICAgICAndW5pdE51bWJlcicsIHIudW5pdF9udW1iZXIsXG4gICAgICAgICAgICAgICAgICAgICAgJ2J1aWxkaW5nSWQnLCByLmJ1aWxkaW5nX2lkLFxuICAgICAgICAgICAgICAgICAgICAgICdidWlsZGluZ05hbWUnLCBiLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKSBGSUxURVIgKFdIRVJFIHIuaWQgSVMgTk9UIE5VTEwpLFxuICAgICAgICAgICAgICAgICAgJ1tdJzo6anNvblxuICAgICAgICAgICAgICAgICkgYXMgcmVzaWRlbmNlc1xuICAgICAgICAgICAgICBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1clxuICAgICAgICAgICAgICBJTk5FUiBKT0lOIHJlc2lkZW5jZXMgciBPTiB1ci5yZXNpZGVuY2VfaWQgPSByLmlkXG4gICAgICAgICAgICAgIElOTkVSIEpPSU4gYnVpbGRpbmdzIGIgT04gci5idWlsZGluZ19pZCA9IGIuaWRcbiAgICAgICAgICAgICAgV0hFUkUgdXIuaXNfYWN0aXZlID0gdHJ1ZSBBTkQgci5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgICAgIEdST1VQIEJZIHVyLnVzZXJfaWRcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgICAgdS4qLFxuICAgICAgICAgICAgICBDT0FMRVNDRSh1by5vcmdhbml6YXRpb25zLCAnW10nOjpqc29uKSBhcyBvcmdhbml6YXRpb25zLFxuICAgICAgICAgICAgICBDT0FMRVNDRSh1Yi5idWlsZGluZ3MsICdbXSc6Ompzb24pIGFzIGJ1aWxkaW5ncyxcbiAgICAgICAgICAgICAgQ09BTEVTQ0UodXIucmVzaWRlbmNlcywgJ1tdJzo6anNvbikgYXMgcmVzaWRlbmNlc1xuICAgICAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgICAgICBMRUZUIEpPSU4gdXNlcl9vcmdzIHVvIE9OIHUuaWQgPSB1by51c2VyX2lkXG4gICAgICAgICAgICBMRUZUIEpPSU4gdXNlcl9idWlsZGluZ3MgdWIgT04gdS5pZCA9IHViLnVzZXJfaWRcbiAgICAgICAgICAgIExFRlQgSk9JTiB1c2VyX3Jlc2lkZW5jZXMgdXIgT04gdS5pZCA9IHVyLnVzZXJfaWRcbiAgICAgICAgICAgIFdIRVJFICR7d2hlcmVDb25kaXRpb25zLmxlbmd0aCA+IDAgPyB3aGVyZUNvbmRpdGlvbnMuam9pbignIEFORCAnKSA6ICcxPTEnfVxuICAgICAgICAgICAgJHtmaWx0ZXJzLm9yZ2FuaXphdGlvbiAmJiBmaWx0ZXJzLm9yZ2FuaXphdGlvbi50cmltKCkgPyAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+PoiBbT1JHIEZJTFRFUl0gQXBwbHlpbmcgb3JnYW5pemF0aW9uIGZpbHRlcjonLCBmaWx0ZXJzLm9yZ2FuaXphdGlvbi50cmltKCkpO1xuICAgICAgICAgICAgICByZXR1cm4gYEFORCBFWElTVFMgKFxuICAgICAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvX2ZpbHRlciBcbiAgICAgICAgICAgICAgICBXSEVSRSB1b19maWx0ZXIudXNlcl9pZCA9IHUuaWQgXG4gICAgICAgICAgICAgICAgQU5EIHVvX2ZpbHRlci5vcmdhbml6YXRpb25faWQgPSAnJHtmaWx0ZXJzLm9yZ2FuaXphdGlvbi50cmltKCl9J1xuICAgICAgICAgICAgICAgIEFORCB1b19maWx0ZXIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApYDtcbiAgICAgICAgICAgIH0pKCkgOiAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+PoiBbT1JHIEZJTFRFUl0gTm8gb3JnYW5pemF0aW9uIGZpbHRlciBhcHBsaWVkIChlbXB0eSBvciB1bmRlZmluZWQpJyk7XG4gICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0pKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICR7IWZpbHRlcnMub3JnYW5pemF0aW9uICYmIGZpbHRlcnMub3JwaGFuID09PSAndHJ1ZScgPyAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+RuyBbT1JQSEFOIEZJTFRFUl0gQXBwbHlpbmcgb3JwaGFuIGZpbHRlcjogdHJ1ZSAodXNlcnMgd2l0aCBubyBhc3NpZ25tZW50cyknKTtcbiAgICAgICAgICAgICAgcmV0dXJuIGBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX29yZ2FuaXphdGlvbnMgdW9fZmlsdGVyX29ycGhhbiBcbiAgICAgICAgICAgICAgICBXSEVSRSB1b19maWx0ZXJfb3JwaGFuLnVzZXJfaWQgPSB1LmlkIEFORCB1b19maWx0ZXJfb3JwaGFuLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgKSBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXJfZmlsdGVyX29ycGhhbiBcbiAgICAgICAgICAgICAgICBXSEVSRSB1cl9maWx0ZXJfb3JwaGFuLnVzZXJfaWQgPSB1LmlkIEFORCB1cl9maWx0ZXJfb3JwaGFuLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgKWA7XG4gICAgICAgICAgICB9KSgpIDogIWZpbHRlcnMub3JnYW5pemF0aW9uICYmIGZpbHRlcnMub3JwaGFuID09PSAnZmFsc2UnID8gKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfkbsgW09SUEhBTiBGSUxURVJdIEFwcGx5aW5nIG9ycGhhbiBmaWx0ZXI6IGZhbHNlICh1c2VycyB3aXRoIGFzc2lnbm1lbnRzKScpO1xuICAgICAgICAgICAgICByZXR1cm4gYEFORCAoRVhJU1RTIChcbiAgICAgICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1b19maWx0ZXJfYXNzaWduZWQgXG4gICAgICAgICAgICAgICAgV0hFUkUgdW9fZmlsdGVyX2Fzc2lnbmVkLnVzZXJfaWQgPSB1LmlkIEFORCB1b19maWx0ZXJfYXNzaWduZWQuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgICAgICApIE9SIEVYSVNUUyAoXG4gICAgICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXJfZmlsdGVyX2Fzc2lnbmVkIFxuICAgICAgICAgICAgICAgIFdIRVJFIHVyX2ZpbHRlcl9hc3NpZ25lZC51c2VyX2lkID0gdS5pZCBBTkQgdXJfZmlsdGVyX2Fzc2lnbmVkLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICAgICAgKSlgO1xuICAgICAgICAgICAgfSkoKSA6IGZpbHRlcnMub3JnYW5pemF0aW9uICYmIGZpbHRlcnMub3JwaGFuID8gKCgpID0+IHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ/CfkbsgW09SUEhBTiBGSUxURVJdIElnbm9yaW5nIG9ycGhhbiBmaWx0ZXIgLSBjb25mbGljdHMgd2l0aCBvcmdhbml6YXRpb24gZmlsdGVyJyk7XG4gICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0pKCkgOiAoKCkgPT4ge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn8J+RuyBbT1JQSEFOIEZJTFRFUl0gTm8gb3JwaGFuIGZpbHRlciBhcHBsaWVkIChlbXB0eSBvciB1bmRlZmluZWQpJyk7XG4gICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH0pKClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIE9SREVSIEJZIHUuY3JlYXRlZF9hdCBERVNDXG4gICAgICAgICAgICBMSU1JVCAke2xpbWl0fSBPRkZTRVQgJHtvZmZzZXR9XG4gICAgICAgICAgYDtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+TiiBbTUFJTiBTUUxdOicsIG1haW5RdWVyeSk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShzcWwucmF3KG1haW5RdWVyeSkpO1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5OKIFtNQUlOIFJFU1VMVF06JywgcmVzdWx0LnJvd3MubGVuZ3RoLCAndXNlcnMgZm91bmQnKTtcblxuICAgICAgICAgIC8vIFRyYW5zZm9ybSB0aGUgcmF3IFNRTCByZXN1bHQgdG8gbWF0Y2ggdGhlIGV4cGVjdGVkIFR5cGVTY3JpcHQgdHlwZXNcbiAgICAgICAgICBjb25zdCB1c2VycyA9IHJlc3VsdC5yb3dzLm1hcCgocm93OiBhbnkpID0+ICh7XG4gICAgICAgICAgICBpZDogcm93LmlkLFxuICAgICAgICAgICAgdXNlcm5hbWU6IHJvdy51c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiByb3cucGFzc3dvcmQsXG4gICAgICAgICAgICBlbWFpbDogcm93LmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiByb3cuZmlyc3RfbmFtZSxcbiAgICAgICAgICAgIGxhc3ROYW1lOiByb3cubGFzdF9uYW1lLFxuICAgICAgICAgICAgcGhvbmU6IHJvdy5waG9uZSxcbiAgICAgICAgICAgIHByb2ZpbGVJbWFnZTogcm93LnByb2ZpbGVfaW1hZ2UsXG4gICAgICAgICAgICBsYW5ndWFnZTogcm93Lmxhbmd1YWdlLFxuICAgICAgICAgICAgcm9sZTogcm93LnJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogcm93LmlzX2FjdGl2ZSxcbiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiByb3cubGFzdF9sb2dpbl9hdCxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogcm93LmNyZWF0ZWRfYXQsXG4gICAgICAgICAgICB1cGRhdGVkQXQ6IHJvdy51cGRhdGVkX2F0LFxuICAgICAgICAgICAgb3JnYW5pemF0aW9uczogdHlwZW9mIHJvdy5vcmdhbml6YXRpb25zID09PSAnc3RyaW5nJyBcbiAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKHJvdy5vcmdhbml6YXRpb25zKSBcbiAgICAgICAgICAgICAgOiByb3cub3JnYW5pemF0aW9ucyB8fCBbXSxcbiAgICAgICAgICAgIGJ1aWxkaW5nczogdHlwZW9mIHJvdy5idWlsZGluZ3MgPT09ICdzdHJpbmcnIFxuICAgICAgICAgICAgICA/IEpTT04ucGFyc2Uocm93LmJ1aWxkaW5ncykgXG4gICAgICAgICAgICAgIDogcm93LmJ1aWxkaW5ncyB8fCBbXSxcbiAgICAgICAgICAgIHJlc2lkZW5jZXM6IHR5cGVvZiByb3cucmVzaWRlbmNlcyA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gSlNPTi5wYXJzZShyb3cucmVzaWRlbmNlcykgXG4gICAgICAgICAgICAgIDogcm93LnJlc2lkZW5jZXMgfHwgW11cbiAgICAgICAgICB9KSk7XG5cbiAgICAgICAgICByZXR1cm4geyB1c2VycywgdG90YWwgfTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBpbiBvcHRpbWl6ZWQgZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWQ6JywgZXJyb3IpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHBhZ2luYXRlZCB2ZXJzaW9uIG9mIHRoZSBvcmlnaW5hbCBpbXBsZW1lbnRhdGlvbiBpZiBvcHRpbWl6ZWQgcXVlcnkgZmFpbHNcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UhCBGYWxsaW5nIGJhY2sgdG8gcGFnaW5hdGVkIG9yaWdpbmFsIGltcGxlbWVudGF0aW9uLi4uJyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VXNlcnNXaXRoQXNzaWdubWVudHNQYWdpbmF0ZWRGYWxsYmFjayhvZmZzZXQsIGxpbWl0LCBmaWx0ZXJzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRmFsbGJhY2sgaW1wbGVtZW50YXRpb24gZm9yIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzIGlmIG9wdGltaXplZCB2ZXJzaW9uIGZhaWxzLlxuICAgKiBUaGlzIGlzIHRoZSBvcmlnaW5hbCBOKzEgcXVlcnkgaW1wbGVtZW50YXRpb24ga2VwdCBmb3IgcmVsaWFiaWxpdHkuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzRmFsbGJhY2soKTogUHJvbWlzZTxBcnJheTxVc2VyICYgeyBvcmdhbml6YXRpb25zOiBBcnJheTx7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgdHlwZTogc3RyaW5nIH0+OyBidWlsZGluZ3M6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nIH0+OyByZXNpZGVuY2VzOiBBcnJheTx7IGlkOiBzdHJpbmc7IHVuaXROdW1iZXI6IHN0cmluZzsgYnVpbGRpbmdJZDogc3RyaW5nOyBidWlsZGluZ05hbWU6IHN0cmluZyB9PiB9Pj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgYWxsIHVzZXJzIGZpcnN0XG4gICAgICBjb25zdCB1c2VycyA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS51c2Vycy5jcmVhdGVkQXQpKTtcblxuICAgICAgLy8gRm9yIGVhY2ggdXNlciwgZmV0Y2ggdGhlaXIgYXNzaWdubWVudHMgd2l0aCBsaW1pdGVkIGNvbmN1cnJlbmN5IHRvIHByZXZlbnQgY29ubmVjdGlvbiBpc3N1ZXNcbiAgICAgIGNvbnN0IGJhdGNoU2l6ZSA9IDU7IC8vIFByb2Nlc3MgNSB1c2VycyBhdCBhIHRpbWUgdG8gYXZvaWQgY29ubmVjdGlvbiBwb29sIGV4aGF1c3Rpb25cbiAgICAgIGNvbnN0IHVzZXJzV2l0aEFzc2lnbm1lbnRzID0gW107XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcnMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xuICAgICAgICBjb25zdCBiYXRjaCA9IHVzZXJzLnNsaWNlKGksIGkgKyBiYXRjaFNpemUpO1xuICAgICAgICBjb25zdCBiYXRjaFJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICBiYXRjaC5tYXAoYXN5bmMgKHVzZXIpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gR2V0IHVzZXIgb3JnYW5pemF0aW9uc1xuICAgICAgICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBzY2hlbWEub3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLm9yZ2FuaXphdGlvbnMsIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBHZXQgdXNlciBidWlsZGluZ3MgKHRocm91Z2ggb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHMpXG4gICAgICAgICAgICBjb25zdCB1c2VyQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHNjaGVtYS5idWlsZGluZ3MuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogc2NoZW1hLmJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEuYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkKSlcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBHZXQgdXNlciByZXNpZGVuY2VzXG4gICAgICAgICAgICBjb25zdCB1c2VyUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEucmVzaWRlbmNlcy5pZCxcbiAgICAgICAgICAgICAgICB1bml0TnVtYmVyOiBzY2hlbWEucmVzaWRlbmNlcy51bml0TnVtYmVyLFxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdOYW1lOiBzY2hlbWEuYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEucmVzaWRlbmNlcywgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCBzY2hlbWEucmVzaWRlbmNlcy5pZCkpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbnM6IHVzZXJPcmdzIHx8IFtdLFxuICAgICAgICAgICAgICBidWlsZGluZ3M6IHVzZXJCdWlsZGluZ3MgfHwgW10sXG4gICAgICAgICAgICAgIHJlc2lkZW5jZXM6IHVzZXJSZXNpZGVuY2VzIHx8IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgICAgICAgIC8vIFJldHVybiB1c2VyIHdpdGggZW1wdHkgYXNzaWdubWVudHMgaWYgdGhlcmUncyBhbiBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uczogW10sXG4gICAgICAgICAgICAgIGJ1aWxkaW5nczogW10sXG4gICAgICAgICAgICAgIHJlc2lkZW5jZXM6IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgXG4gICAgICB1c2Vyc1dpdGhBc3NpZ25tZW50cy5wdXNoKC4uLmJhdGNoUmVzdWx0cyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB1c2Vyc1dpdGhBc3NpZ25tZW50cztcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgQ3JpdGljYWwgZXJyb3IgZ2V0dGluZyB1c2VycyB3aXRoIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBlbXB0eSBhcnJheSBvbiBjcml0aWNhbCBlcnJvclxuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYWdpbmF0ZWQgZmFsbGJhY2sgaW1wbGVtZW50YXRpb24gZm9yIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzUGFnaW5hdGVkIGlmIG9wdGltaXplZCB2ZXJzaW9uIGZhaWxzLlxuICAgKiBUaGlzIGlzIHRoZSBvcmlnaW5hbCBOKzEgcXVlcnkgaW1wbGVtZW50YXRpb24gd2l0aCBwYWdpbmF0aW9uIHN1cHBvcnQuXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldFVzZXJzV2l0aEFzc2lnbm1lbnRzUGFnaW5hdGVkRmFsbGJhY2soXG4gICAgb2Zmc2V0OiBudW1iZXIgPSAwLCBcbiAgICBsaW1pdDogbnVtYmVyID0gMTAsIFxuICAgIGZpbHRlcnM6IHsgcm9sZT86IHN0cmluZzsgc3RhdHVzPzogc3RyaW5nOyBvcmdhbml6YXRpb24/OiBzdHJpbmc7IG9ycGhhbj86IHN0cmluZzsgZGVtb09ubHk/OiBzdHJpbmc7IG1hbmFnZXJPcmdhbml6YXRpb25zPzogc3RyaW5nOyBzZWFyY2g/OiBzdHJpbmcgfSA9IHt9XG4gICk6IFByb21pc2U8e1xuICAgIHVzZXJzOiBBcnJheTxVc2VyICYgeyBvcmdhbml6YXRpb25zOiBBcnJheTx7IGlkOiBzdHJpbmc7IG5hbWU6IHN0cmluZzsgdHlwZTogc3RyaW5nIH0+OyBidWlsZGluZ3M6IEFycmF5PHsgaWQ6IHN0cmluZzsgbmFtZTogc3RyaW5nIH0+OyByZXNpZGVuY2VzOiBBcnJheTx7IGlkOiBzdHJpbmc7IHVuaXROdW1iZXI6IHN0cmluZzsgYnVpbGRpbmdJZDogc3RyaW5nOyBidWlsZGluZ05hbWU6IHN0cmluZyB9PiB9PjtcbiAgICB0b3RhbDogbnVtYmVyO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEJ1aWxkIFdIRVJFIGNvbmRpdGlvbnMgZm9yIGZpbHRlcmluZ1xuICAgICAgbGV0IHdoZXJlQ29uZGl0aW9ucyA9IFtdO1xuICAgICAgXG4gICAgICBpZiAoZmlsdGVycy5yb2xlKSB7XG4gICAgICAgIGlmIChmaWx0ZXJzLnJvbGUgPT09ICdudWxsJykge1xuICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGlzTnVsbChzY2hlbWEudXNlcnMucm9sZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS51c2Vycy5yb2xlLCBmaWx0ZXJzLnJvbGUgYXMgYW55KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKGZpbHRlcnMuc3RhdHVzKSB7XG4gICAgICAgIGlmIChmaWx0ZXJzLnN0YXR1cyA9PT0gJ251bGwnKSB7XG4gICAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goaXNOdWxsKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnN0IGlzQWN0aXZlID0gZmlsdGVycy5zdGF0dXMgPT09ICd0cnVlJztcbiAgICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIGlzQWN0aXZlKSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIERlZmF1bHQ6IG9ubHkgc2hvdyBhY3RpdmUgdXNlcnMgaWYgbm8gc3RhdHVzIGZpbHRlciBpcyBhcHBsaWVkXG4gICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgICAgfVxuXG4gICAgICAvLyBEZW1vLW9ubHkgZmlsdGVyIGZvciBkZW1vIHVzZXJzXG4gICAgICBpZiAoZmlsdGVycy5kZW1vT25seSA9PT0gJ3RydWUnKSB7XG4gICAgICAgIHdoZXJlQ29uZGl0aW9ucy5wdXNoKHNxbGAke3NjaGVtYS51c2Vycy5yb2xlfSBMSUtFICdkZW1vXyUnYCk7XG4gICAgICB9XG5cbiAgICAgIC8vIFNlYXJjaCBmaWx0ZXIgZm9yIG5hbWUvZW1haWxcbiAgICAgIGlmIChmaWx0ZXJzLnNlYXJjaCAmJiBmaWx0ZXJzLnNlYXJjaC50cmltKCkpIHtcbiAgICAgICAgY29uc3Qgc2VhcmNoVGVybSA9IGAlJHtmaWx0ZXJzLnNlYXJjaC50cmltKCkudG9Mb3dlckNhc2UoKX0lYDtcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goXG4gICAgICAgICAgb3IoXG4gICAgICAgICAgICBzcWxgTE9XRVIoJHtzY2hlbWEudXNlcnMuZmlyc3ROYW1lfSB8fCAnICcgfHwgJHtzY2hlbWEudXNlcnMubGFzdE5hbWV9KSBMSUtFICR7c2VhcmNoVGVybX1gLFxuICAgICAgICAgICAgc3FsYExPV0VSKCR7c2NoZW1hLnVzZXJzLmVtYWlsfSkgTElLRSAke3NlYXJjaFRlcm19YCxcbiAgICAgICAgICAgIHNxbGBMT1dFUigke3NjaGVtYS51c2Vycy51c2VybmFtZX0pIExJS0UgJHtzZWFyY2hUZXJtfWBcbiAgICAgICAgICApXG4gICAgICAgICk7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTRUFSQ0ggRklMVEVSIEZBTExCQUNLXSBBcHBsaWVkIHNlYXJjaCBmb3I6JywgZmlsdGVycy5zZWFyY2gudHJpbSgpKTtcbiAgICAgIH1cblxuICAgICAgLy8gTWFuYWdlciBvcmdhbml6YXRpb25zIGZpbHRlclxuICAgICAgaWYgKGZpbHRlcnMubWFuYWdlck9yZ2FuaXphdGlvbnMpIHtcbiAgICAgICAgY29uc3Qgb3JnSWRzID0gZmlsdGVycy5tYW5hZ2VyT3JnYW5pemF0aW9ucy5zcGxpdCgnLCcpO1xuICAgICAgICBjb25zdCBvcmdGaWx0ZXJRdWVyeSA9IGRiXG4gICAgICAgICAgLnNlbGVjdCh7IHVzZXJJZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdJZHMpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goaW5BcnJheShzY2hlbWEudXNlcnMuaWQsIG9yZ0ZpbHRlclF1ZXJ5KSk7XG4gICAgICB9XG5cbiAgICAgIC8vIE9ycGhhbiBmaWx0ZXIgaW1wbGVtZW50YXRpb24gZm9yIGZhbGxiYWNrXG4gICAgICBpZiAoZmlsdGVycy5vcnBoYW4gPT09ICd0cnVlJykge1xuICAgICAgICAvLyBVc2VycyB3aXRoIG5vIG9yZ2FuaXphdGlvbiBBTkQgbm8gcmVzaWRlbmNlIGFzc2lnbm1lbnRzXG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5G7IFtGQUxMQkFDS10gQXBwbHlpbmcgb3JwaGFuIGZpbHRlcjogdHJ1ZSAodXNlcnMgd2l0aCBubyBhc3NpZ25tZW50cyknKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVzZXJzV2l0aE9yZ3MgPSBkYlxuICAgICAgICAgIC5zZWxlY3REaXN0aW5jdCh7IHVzZXJJZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1c2Vyc1dpdGhSZXNpZGVuY2VzID0gZGJcbiAgICAgICAgICAuc2VsZWN0RGlzdGluY3QoeyB1c2VySWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXNlcnMgd2hvIGFyZSBOT1QgaW4gZWl0aGVyIG9mIHRoZXNlIHN1YnF1ZXJpZXNcbiAgICAgICAgd2hlcmVDb25kaXRpb25zLnB1c2goXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgbm90SW5BcnJheShzY2hlbWEudXNlcnMuaWQsIHVzZXJzV2l0aE9yZ3MpLFxuICAgICAgICAgICAgbm90SW5BcnJheShzY2hlbWEudXNlcnMuaWQsIHVzZXJzV2l0aFJlc2lkZW5jZXMpXG4gICAgICAgICAgKVxuICAgICAgICApO1xuICAgICAgfSBlbHNlIGlmIChmaWx0ZXJzLm9ycGhhbiA9PT0gJ2ZhbHNlJykge1xuICAgICAgICAvLyBVc2VycyB3aXRoIGF0IGxlYXN0IG9uZSBvcmdhbml6YXRpb24gT1IgcmVzaWRlbmNlIGFzc2lnbm1lbnRcbiAgICAgICAgY29uc29sZS5sb2coJ/CfkbsgW0ZBTExCQUNLXSBBcHBseWluZyBvcnBoYW4gZmlsdGVyOiBmYWxzZSAodXNlcnMgd2l0aCBhc3NpZ25tZW50cyknKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVzZXJzV2l0aE9yZ3MgPSBkYlxuICAgICAgICAgIC5zZWxlY3REaXN0aW5jdCh7IHVzZXJJZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSk7XG4gICAgICAgIFxuICAgICAgICBjb25zdCB1c2Vyc1dpdGhSZXNpZGVuY2VzID0gZGJcbiAgICAgICAgICAuc2VsZWN0RGlzdGluY3QoeyB1c2VySWQ6IHNjaGVtYS51c2VyUmVzaWRlbmNlcy51c2VySWQgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlclJlc2lkZW5jZXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpO1xuICAgICAgICBcbiAgICAgICAgLy8gVXNlcnMgd2hvIGFyZSBpbiBhdCBsZWFzdCBvbmUgb2YgdGhlc2Ugc3VicXVlcmllc1xuICAgICAgICB3aGVyZUNvbmRpdGlvbnMucHVzaChcbiAgICAgICAgICBvcihcbiAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLnVzZXJzLmlkLCB1c2Vyc1dpdGhPcmdzKSxcbiAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLnVzZXJzLmlkLCB1c2Vyc1dpdGhSZXNpZGVuY2VzKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgLy8gRmlyc3QgZ2V0IHRvdGFsIGNvdW50IHdpdGggZmlsdGVyc1xuICAgICAgY29uc3QgdG90YWxSZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KHsgY291bnQ6IHNxbDxudW1iZXI+YGNvdW50KCopYCB9KVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShhbmQoLi4ud2hlcmVDb25kaXRpb25zKSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHRvdGFsID0gTnVtYmVyKHRvdGFsUmVzdWx0WzBdPy5jb3VudCB8fCAwKTtcblxuICAgICAgLy8gR2V0IHBhZ2luYXRlZCB1c2VycyB3aXRoIGZpbHRlcnNcbiAgICAgIGNvbnN0IHVzZXJzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGFuZCguLi53aGVyZUNvbmRpdGlvbnMpKVxuICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS51c2Vycy5jcmVhdGVkQXQpKVxuICAgICAgICAubGltaXQobGltaXQpXG4gICAgICAgIC5vZmZzZXQob2Zmc2V0KTtcblxuICAgICAgLy8gRm9yIGVhY2ggdXNlciwgZmV0Y2ggdGhlaXIgYXNzaWdubWVudHMgd2l0aCBsaW1pdGVkIGNvbmN1cnJlbmN5IHRvIHByZXZlbnQgY29ubmVjdGlvbiBpc3N1ZXNcbiAgICAgIGNvbnN0IGJhdGNoU2l6ZSA9IDU7IC8vIFByb2Nlc3MgNSB1c2VycyBhdCBhIHRpbWUgdG8gYXZvaWQgY29ubmVjdGlvbiBwb29sIGV4aGF1c3Rpb25cbiAgICAgIGNvbnN0IHVzZXJzV2l0aEFzc2lnbm1lbnRzID0gW107XG4gICAgICBcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlcnMubGVuZ3RoOyBpICs9IGJhdGNoU2l6ZSkge1xuICAgICAgICBjb25zdCBiYXRjaCA9IHVzZXJzLnNsaWNlKGksIGkgKyBiYXRjaFNpemUpO1xuICAgICAgICBjb25zdCBiYXRjaFJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICBiYXRjaC5tYXAoYXN5bmMgKHVzZXIpID0+IHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gR2V0IHVzZXIgb3JnYW5pemF0aW9uc1xuICAgICAgICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogc2NoZW1hLm9yZ2FuaXphdGlvbnMubmFtZSxcbiAgICAgICAgICAgICAgICB0eXBlOiBzY2hlbWEub3JnYW5pemF0aW9ucy50eXBlLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLm9yZ2FuaXphdGlvbnMsIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5vcmdhbml6YXRpb25JZCwgc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQpKVxuICAgICAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlci5pZCksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBHZXQgdXNlciBidWlsZGluZ3MgKHRocm91Z2ggb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcHMpXG4gICAgICAgICAgICBjb25zdCB1c2VyQnVpbGRpbmdzID0gYXdhaXQgZGJcbiAgICAgICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICAgICAgaWQ6IHNjaGVtYS5idWlsZGluZ3MuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogc2NoZW1hLmJ1aWxkaW5ncy5uYW1lLFxuICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBzY2hlbWEuYnVpbGRpbmdzLm9yZ2FuaXphdGlvbklkKSlcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy51c2VySWQsIHVzZXIuaWQpLFxuICAgICAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3MuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBHZXQgdXNlciByZXNpZGVuY2VzXG4gICAgICAgICAgICBjb25zdCB1c2VyUmVzaWRlbmNlcyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEucmVzaWRlbmNlcy5pZCxcbiAgICAgICAgICAgICAgICB1bml0TnVtYmVyOiBzY2hlbWEucmVzaWRlbmNlcy51bml0TnVtYmVyLFxuICAgICAgICAgICAgICAgIGJ1aWxkaW5nSWQ6IHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsXG4gICAgICAgICAgICAgICAgYnVpbGRpbmdOYW1lOiBzY2hlbWEuYnVpbGRpbmdzLm5hbWUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAgICAgLmlubmVySm9pbihzY2hlbWEucmVzaWRlbmNlcywgZXEoc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLCBzY2hlbWEucmVzaWRlbmNlcy5pZCkpXG4gICAgICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLmJ1aWxkaW5ncywgZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgc2NoZW1hLmJ1aWxkaW5ncy5pZCkpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VyLmlkKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyUmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnVzZXIsXG4gICAgICAgICAgICAgIG9yZ2FuaXphdGlvbnM6IHVzZXJPcmdzIHx8IFtdLFxuICAgICAgICAgICAgICBidWlsZGluZ3M6IHVzZXJCdWlsZGluZ3MgfHwgW10sXG4gICAgICAgICAgICAgIHJlc2lkZW5jZXM6IHVzZXJSZXNpZGVuY2VzIHx8IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZ2V0dGluZyB1c2VyIGFzc2lnbm1lbnRzOicsIGVycm9yKTtcbiAgICAgICAgICAgIC8vIFJldHVybiB1c2VyIHdpdGggZW1wdHkgYXNzaWdubWVudHMgaWYgdGhlcmUncyBhbiBlcnJvclxuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgLi4udXNlcixcbiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uczogW10sXG4gICAgICAgICAgICAgIGJ1aWxkaW5nczogW10sXG4gICAgICAgICAgICAgIHJlc2lkZW5jZXM6IFtdLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgXG4gICAgICB1c2Vyc1dpdGhBc3NpZ25tZW50cy5wdXNoKC4uLmJhdGNoUmVzdWx0cyk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHVzZXJzOiB1c2Vyc1dpdGhBc3NpZ25tZW50cywgdG90YWwgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgQ3JpdGljYWwgZXJyb3IgZ2V0dGluZyBwYWdpbmF0ZWQgdXNlcnMgd2l0aCBhc3NpZ25tZW50czonLCBlcnJvcik7XG4gICAgICAvLyBSZXR1cm4gZW1wdHkgcmVzdWx0IG9uIGNyaXRpY2FsIGVycm9yXG4gICAgICByZXR1cm4geyB1c2VyczogW10sIHRvdGFsOiAwIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyB1c2VycyBmcm9tIG9yZ2FuaXphdGlvbnMgdGhhdCBhIHNwZWNpZmljIHVzZXIgaGFzIGFjY2VzcyB0by5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlcnNCeU9yZ2FuaXphdGlvbnModXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFVzZXJzQnlPcmdhbml6YXRpb25zJyxcbiAgICAgIGB1c2Vyc19ieV9vcmc6JHt1c2VySWR9YCxcbiAgICAgICd1c2VycycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIEZpcnN0LCBnZXQgb3JnYW5pemF0aW9uIElEcyB0aGF0IHRoZSB1c2VyIGhhcyBhY2Nlc3MgdG9cbiAgICAgICAgY29uc3QgdXNlck9yZ3MgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoeyBvcmdhbml6YXRpb25JZDogc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLnVzZXJJZCwgdXNlcklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgaWYgKHVzZXJPcmdzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IG9yZ2FuaXphdGlvbklkcyA9IHVzZXJPcmdzLm1hcCgob3JnKSA9PiBvcmcub3JnYW5pemF0aW9uSWQpO1xuXG4gICAgICAgIC8vIFRoZW4gZ2V0IGFsbCB1c2VycyBmcm9tIHRob3NlIG9yZ2FuaXphdGlvbnNcbiAgICAgICAgcmV0dXJuIGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICBpZDogc2NoZW1hLnVzZXJzLmlkLFxuICAgICAgICAgICAgdXNlcm5hbWU6IHNjaGVtYS51c2Vycy51c2VybmFtZSxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBzY2hlbWEudXNlcnMucGFzc3dvcmQsXG4gICAgICAgICAgICBlbWFpbDogc2NoZW1hLnVzZXJzLmVtYWlsLFxuICAgICAgICAgICAgZmlyc3ROYW1lOiBzY2hlbWEudXNlcnMuZmlyc3ROYW1lLFxuICAgICAgICAgICAgbGFzdE5hbWU6IHNjaGVtYS51c2Vycy5sYXN0TmFtZSxcbiAgICAgICAgICAgIHBob25lOiBzY2hlbWEudXNlcnMucGhvbmUsXG4gICAgICAgICAgICBwcm9maWxlSW1hZ2U6IHNjaGVtYS51c2Vycy5wcm9maWxlSW1hZ2UsXG4gICAgICAgICAgICBsYW5ndWFnZTogc2NoZW1hLnVzZXJzLmxhbmd1YWdlLFxuICAgICAgICAgICAgcm9sZTogc2NoZW1hLnVzZXJzLnJvbGUsXG4gICAgICAgICAgICBpc0FjdGl2ZTogc2NoZW1hLnVzZXJzLmlzQWN0aXZlLFxuICAgICAgICAgICAgbGFzdExvZ2luQXQ6IHNjaGVtYS51c2Vycy5sYXN0TG9naW5BdCxcbiAgICAgICAgICAgIGNyZWF0ZWRBdDogc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIHVwZGF0ZWRBdDogc2NoZW1hLnVzZXJzLnVwZGF0ZWRBdCxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucywgZXEoc2NoZW1hLnVzZXJzLmlkLCBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2Vycy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS51c2VyT3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgIGluQXJyYXkoc2NoZW1hLnVzZXJPcmdhbml6YXRpb25zLm9yZ2FuaXphdGlvbklkLCBvcmdhbml6YXRpb25JZHMpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICAgIC5vcmRlckJ5KHNjaGVtYS51c2Vycy5maXJzdE5hbWUsIHNjaGVtYS51c2Vycy5sYXN0TmFtZSk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHBhZ2luYXRlZCB1c2VycyB3aXRoIG9wdGltaXplZCBxdWVyeSBzdHJ1Y3R1cmUuXG4gICAqIEBwYXJhbSBvcHRpb25zXG4gICAqIEBwYXJhbSBfb3B0aW9uc1xuICAgKi9cbiAgYXN5bmMgZ2V0UGFnaW5hdGVkVXNlcnMoX29wdGlvbnM6IFBhZ2luYXRpb25PcHRpb25zKTogUHJvbWlzZTx7IHVzZXJzOiBVc2VyW107IHRvdGFsOiBudW1iZXIgfT4ge1xuICAgIFBhZ2luYXRpb25IZWxwZXIudmFsaWRhdGVQYWdpbmF0aW9uKF9vcHRpb25zKTtcblxuICAgIGNvbnN0IGNhY2hlS2V5ID0gYHBhZ2luYXRlZF91c2Vyczoke19vcHRpb25zLnBhZ2V9OiR7X29wdGlvbnMucGFnZVNpemV9OiR7X29wdGlvbnMuc29ydEJ5fToke19vcHRpb25zLnNvcnREaXJlY3Rpb259YDtcblxuICAgIC8vIFRyeSBjYWNoZSBmaXJzdFxuICAgIGNvbnN0IGNhY2hlZCA9IHF1ZXJ5Q2FjaGUuZ2V0PHsgdXNlcnM6IFVzZXJbXTsgdG90YWw6IG51bWJlciB9PigndXNlcnMnLCBjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIGNhY2hlZDtcbiAgICB9XG5cbiAgICAvLyBHZXQgdG90YWwgY291bnQgdXNpbmcgY292ZXJpbmcgaW5kZXhcbiAgICBjb25zdCBbeyBjb3VudDogdG90YWwgfV0gPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCh7IGNvdW50OiBjb3VudCgpIH0pXG4gICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSk7XG5cbiAgICAvLyBHZXQgcGFnaW5hdGVkIHJlc3VsdHMgd2l0aCBMSU1JVCBhbmQgb3B0aW1pemVkIE9SREVSIEJZXG4gICAgY29uc3QgdXNlcnMgPSBhd2FpdCBkYlxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgIC5vcmRlckJ5KFxuICAgICAgICBfb3B0aW9ucy5zb3J0RGlyZWN0aW9uID09PSAnREVTQycgPyBkZXNjKHNjaGVtYS51c2Vycy5jcmVhdGVkQXQpIDogc2NoZW1hLnVzZXJzLmNyZWF0ZWRBdFxuICAgICAgKVxuICAgICAgLmxpbWl0KF9vcHRpb25zLnBhZ2VTaXplKVxuICAgICAgLm9mZnNldCgoX29wdGlvbnMucGFnZSAtIDEpICogX29wdGlvbnMucGFnZVNpemUpO1xuXG4gICAgY29uc3QgcmVzdWx0ID0geyB1c2VycywgdG90YWwgfTtcbiAgICBxdWVyeUNhY2hlLnNldCgndXNlcnMnLCBjYWNoZUtleSwgcmVzdWx0KTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBidWlsZGluZ3Mgd2l0aCByZXNpZGVudHMgdXNpbmcgRVhJU1RTIGluc3RlYWQgb2YgSU4gc3VicXVlcnkuXG4gICAqIEBwYXJhbSBvcmdhbml6YXRpb25JZFxuICAgKiBAcGFyYW0gbGltaXRcbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5nc1dpdGhSZXNpZGVudHMob3JnYW5pemF0aW9uSWQ6IHN0cmluZywgbGltaXQ6IG51bWJlciA9IDUwKTogUHJvbWlzZTxCdWlsZGluZ1tdPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgYnVpbGRpbmdzX3dpdGhfcmVzaWRlbnRzOiR7b3JnYW5pemF0aW9uSWR9OiR7bGltaXR9YDtcblxuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEJ1aWxkaW5nc1dpdGhSZXNpZGVudHMnLFxuICAgICAgY2FjaGVLZXksXG4gICAgICAnYnVpbGRpbmdzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5idWlsZGluZ3Mub3JnYW5pemF0aW9uSWQsIG9yZ2FuaXphdGlvbklkKSxcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSksXG4gICAgICAgICAgICAgIGV4aXN0cyhcbiAgICAgICAgICAgICAgICBkYlxuICAgICAgICAgICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIHNjaGVtYS5idWlsZGluZ3MuaWQpLFxuICAgICAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgICAgICAgLmxpbWl0KGxpbWl0KSAvLyBBbHdheXMgdXNlIExJTUlUIGZvciBsYXJnZSByZXN1bHQgc2V0c1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2VhcmNoZXMgdXNlcnMgd2l0aCBvcHRpbWl6ZWQgY292ZXJpbmcgaW5kZXggYW5kIExJTUlULlxuICAgKiBAcGFyYW0gcXVlcnlcbiAgICogQHBhcmFtIGxpbWl0XG4gICAqL1xuICBhc3luYyBzZWFyY2hVc2VycyhxdWVyeTogc3RyaW5nLCBsaW1pdDogbnVtYmVyID0gMjApOiBQcm9taXNlPFVzZXJbXT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYHNlYXJjaF91c2Vyczoke3F1ZXJ5fToke2xpbWl0fWA7XG5cbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnc2VhcmNoVXNlcnMnLCBjYWNoZUtleSwgJ3VzZXJzJywgKCkgPT5cbiAgICAgIGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEudXNlcnMpXG4gICAgICAgIC53aGVyZShcbiAgICAgICAgICBhbmQoXG4gICAgICAgICAgICBlcShzY2hlbWEudXNlcnMuaXNBY3RpdmUsIHRydWUpLFxuICAgICAgICAgICAgb3IoXG4gICAgICAgICAgICAgIGxpa2Uoc2NoZW1hLnVzZXJzLmVtYWlsLCBgJSR7cXVlcnl9JWApLFxuICAgICAgICAgICAgICBsaWtlKHNjaGVtYS51c2Vycy5maXJzdE5hbWUsIGAlJHtxdWVyeX0lYCksXG4gICAgICAgICAgICAgIGxpa2Uoc2NoZW1hLnVzZXJzLmxhc3ROYW1lLCBgJSR7cXVlcnl9JWApXG4gICAgICAgICAgICApXG4gICAgICAgICAgKVxuICAgICAgICApXG4gICAgICAgIC5saW1pdChsaW1pdCkgLy8gQWx3YXlzIGxpbWl0IHNlYXJjaCByZXN1bHRzXG4gICAgICAgIC5vcmRlckJ5KHNjaGVtYS51c2Vycy5sYXN0TmFtZSwgc2NoZW1hLnVzZXJzLmZpcnN0TmFtZSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZmluYW5jaWFsIHN1bW1hcnkgdXNpbmcgbWF0ZXJpYWxpemVkIHZpZXcgZm9yIGNvbXBsZXggYWdncmVnYXRpb25zLlxuICAgKiBAcGFyYW0gYnVpbGRpbmdJZFxuICAgKi9cbiAgYXN5bmMgZ2V0RmluYW5jaWFsU3VtbWFyeShidWlsZGluZ0lkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgZmluYW5jaWFsX3N1bW1hcnk6JHtidWlsZGluZ0lkfWA7XG5cbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0RmluYW5jaWFsU3VtbWFyeScsIGNhY2hlS2V5LCAnZmluYW5jaWFsJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVXNlIG1hdGVyaWFsaXplZCB2aWV3IGZvciBjb21wbGV4IGFnZ3JlZ2F0aW9uc1xuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IGRiLmV4ZWN1dGUoXG4gICAgICAgIHNxbE9wYFNFTEVDVCAqIEZST00gbXZfZmluYW5jaWFsX3N1bW1hcnkgV0hFUkUgYnVpbGRpbmdfaWQgPSAke2J1aWxkaW5nSWR9IE9SREVSIEJZIG1vbnRoIERFU0MgTElNSVQgMTJgXG4gICAgICApO1xuICAgICAgcmV0dXJuIHN1bW1hcnkucm93cztcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGJ1aWxkaW5nIHN0YXRpc3RpY3MgdXNpbmcgbWF0ZXJpYWxpemVkIHZpZXcuXG4gICAqIEBwYXJhbSBidWlsZGluZ0lkXG4gICAqL1xuICBhc3luYyBnZXRCdWlsZGluZ1N0YXRzKGJ1aWxkaW5nSWQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgYnVpbGRpbmdfc3RhdHM6JHtidWlsZGluZ0lkfWA7XG5cbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0QnVpbGRpbmdTdGF0cycsIGNhY2hlS2V5LCAnYnVpbGRpbmdzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVXNlIG1hdGVyaWFsaXplZCB2aWV3IGZvciBkYXNoYm9hcmQgc3RhdGlzdGljc1xuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBkYi5leGVjdXRlKFxuICAgICAgICBzcWxPcGBTRUxFQ1QgKiBGUk9NIG12X2J1aWxkaW5nX3N0YXRzIFdIRVJFIGJ1aWxkaW5nX2lkID0gJHtidWlsZGluZ0lkfWBcbiAgICAgICk7XG4gICAgICByZXR1cm4gc3RhdHMucm93c1swXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSBzcGVjaWZpYyB1c2VyIGJ5IElEIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRVc2VyKGlkOiBzdHJpbmcpOiBQcm9taXNlPFVzZXIgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0VXNlcicsIGB1c2VyOiR7aWR9YCwgJ3VzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS51c2Vycykud2hlcmUoZXEoc2NoZW1hLnVzZXJzLmlkLCBpZCkpO1xuICAgICAgXG4gICAgICAvLyBVc2VyIGxvb2t1cCBjb21wbGV0ZWRcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmV0cmlldmVzIGEgdXNlciBieSBlbWFpbCB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBlbWFpbFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlckJ5RW1haWwoZW1haWw6IHN0cmluZyk6IFByb21pc2U8VXNlciB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRVc2VyQnlFbWFpbCcsIGB1c2VyX2VtYWlsOiR7ZW1haWx9YCwgJ3VzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEudXNlcnMpLndoZXJlKGVxKHNjaGVtYS51c2Vycy5lbWFpbCwgZW1haWwpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyB1c2VyIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaW5zZXJ0VXNlclxuICAgKi9cbiAgYXN5bmMgY3JlYXRlVXNlcihpbnNlcnRVc2VyOiBJbnNlcnRVc2VyKTogUHJvbWlzZTxVc2VyPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlVXNlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEF1dG9tYXRpY2FsbHkgc2V0IGRlbW8gcGFzc3dvcmQgZm9yIGRlbW8gcm9sZSB1c2Vyc1xuICAgICAgbGV0IHBhc3N3b3JkID0gaW5zZXJ0VXNlci5wYXNzd29yZDtcbiAgICAgIGNvbnN0IGlzRGVtb1JvbGUgPSBbJ2RlbW9fbWFuYWdlcicsICdkZW1vX3RlbmFudCcsICdkZW1vX3Jlc2lkZW50J10uaW5jbHVkZXMoaW5zZXJ0VXNlci5yb2xlKTtcbiAgICAgIFxuICAgICAgaWYgKGlzRGVtb1JvbGUpIHtcbiAgICAgICAgLy8gQWx3YXlzIHNldCB0aGUgc3RhbmRhcmQgZGVtbyBwYXNzd29yZCBoYXNoIGZvciBkZW1vIHVzZXJzLCByZWdhcmRsZXNzIG9mIHByb3ZpZGVkIHBhc3N3b3JkXG4gICAgICAgIHBhc3N3b3JkID0gJyQyYiQxMiRjT2MvUWpNanpsaHFBUXFGMmIvTVRPWnIyUUF0RVJiWEpHZDRPU2ExQ1hNbEYwNEZDM0YwMic7IC8vIGRlbW8xMjM0NTZcbiAgICAgICAgY29uc29sZS5sb2coJ/Cfjq0gU2V0dGluZyBkZW1vIHBhc3N3b3JkIGZvciB1c2VyIHdpdGggcm9sZTonLCBpbnNlcnRVc2VyLnJvbGUpO1xuICAgICAgfVxuXG4gICAgICAvLyBFbnN1cmUgdXNlcm5hbWUgdW5pcXVlbmVzcyB3aXRoIHJhbmRvbSBudW1iZXJzIGlmIGNvbGxpc2lvbiBvY2N1cnNcbiAgICAgIGxldCB1bmlxdWVVc2VybmFtZSA9IGluc2VydFVzZXIudXNlcm5hbWU7XG4gICAgICBsZXQgYXR0ZW1wdHMgPSAwO1xuICAgICAgY29uc3QgbWF4QXR0ZW1wdHMgPSAxMDtcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIHVzZXJuYW1lIGNvbGxpc2lvblxuICAgICAgbGV0IGV4aXN0aW5nVXNlciA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoeyB1c2VybmFtZTogc2NoZW1hLnVzZXJzLnVzZXJuYW1lIH0pXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS51c2Vycy51c2VybmFtZSwgdW5pcXVlVXNlcm5hbWUpKVxuICAgICAgICAubGltaXQoMSk7XG5cbiAgICAgIHdoaWxlIChleGlzdGluZ1VzZXIubGVuZ3RoID4gMCAmJiBhdHRlbXB0cyA8IG1heEF0dGVtcHRzKSB7XG4gICAgICAgIC8vIEdlbmVyYXRlIHJhbmRvbSA0LWRpZ2l0IHN1ZmZpeFxuICAgICAgICBjb25zdCByYW5kb21TdWZmaXggPSBNYXRoLmZsb29yKDEwMDAgKyBNYXRoLnJhbmRvbSgpICogOTAwMCk7XG4gICAgICAgIHVuaXF1ZVVzZXJuYW1lID0gYCR7aW5zZXJ0VXNlci51c2VybmFtZX0ke3JhbmRvbVN1ZmZpeH1gO1xuICAgICAgICBhdHRlbXB0cysrO1xuICAgICAgICBcbiAgICAgICAgZXhpc3RpbmdVc2VyID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHsgdXNlcm5hbWU6IHNjaGVtYS51c2Vycy51c2VybmFtZSB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VycylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnVzZXJzLnVzZXJuYW1lLCB1bmlxdWVVc2VybmFtZSkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuICAgICAgfVxuXG4gICAgICBpZiAoYXR0ZW1wdHMgPj0gbWF4QXR0ZW1wdHMgJiYgZXhpc3RpbmdVc2VyLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gZ2VuZXJhdGUgdW5pcXVlIHVzZXJuYW1lIGFmdGVyIG1heGltdW0gYXR0ZW1wdHMnKTtcbiAgICAgIH1cblxuICAgICAgLy8gRmlsdGVyIG9ubHkgdGhlIGZpZWxkcyB0aGF0IGV4aXN0IGluIHRoZSBkYXRhYmFzZSBzY2hlbWFcbiAgICAgIGNvbnN0IHVzZXJEYXRhID0ge1xuICAgICAgICB1c2VybmFtZTogdW5pcXVlVXNlcm5hbWUsXG4gICAgICAgIGVtYWlsOiBpbnNlcnRVc2VyLmVtYWlsLFxuICAgICAgICBwYXNzd29yZCxcbiAgICAgICAgZmlyc3ROYW1lOiBpbnNlcnRVc2VyLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IGluc2VydFVzZXIubGFzdE5hbWUsXG4gICAgICAgIHBob25lOiBpbnNlcnRVc2VyLnBob25lIHx8ICcnLFxuICAgICAgICBwcm9maWxlSW1hZ2U6IGluc2VydFVzZXIucHJvZmlsZUltYWdlLFxuICAgICAgICBsYW5ndWFnZTogaW5zZXJ0VXNlci5sYW5ndWFnZSB8fCAnZnInLFxuICAgICAgICByb2xlOiBpbnNlcnRVc2VyLnJvbGUsXG4gICAgICAgIGlzQWN0aXZlOiB0cnVlLCAvLyBEZWZhdWx0IHZhbHVlIGZvciBuZXcgdXNlcnNcbiAgICAgIH07XG5cblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW5zZXJ0ZWQgPSBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLnVzZXJzKS52YWx1ZXMoW3VzZXJEYXRhXSkucmV0dXJuaW5nKCk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gaW5zZXJ0ZWQ7XG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyB1c2VyOicsIGVycm9yKTtcbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGVzXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlVXNlckNhY2hlcygnKicpO1xuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGEgdXNlciB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVVc2VyKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8VXNlcj4pOiBQcm9taXNlPFVzZXIgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVVc2VyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLnVzZXJzKVxuICAgICAgICAuc2V0KHsgLi4udXBkYXRlcywgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEudXNlcnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBzcGVjaWZpYyB1c2VyIGNhY2hlc1xuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVVzZXJDYWNoZXMoaWQpO1xuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgb3JnYW5pemF0aW9ucyBmb3IgYSBzcGVjaWZpYyB1c2VyLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqL1xuICBhc3luYyBnZXRVc2VyT3JnYW5pemF0aW9ucyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8eyBvcmdhbml6YXRpb25JZDogc3RyaW5nIH0+PiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VXNlck9yZ2FuaXphdGlvbnMnLFxuICAgICAgYHVzZXJfb3Jnczoke3VzZXJJZH1gLFxuICAgICAgJ3VzZXJzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIG9yZ2FuaXphdGlvbklkOiBzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMub3JnYW5pemF0aW9uSWQsXG4gICAgICAgICAgfSlcbiAgICAgICAgICAuZnJvbShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMpXG4gICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgYW5kKFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMudXNlcklkLCB1c2VySWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEudXNlck9yZ2FuaXphdGlvbnMuaXNBY3RpdmUsIHRydWUpXG4gICAgICAgICAgICApXG4gICAgICAgICAgKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyByZXNpZGVuY2VzIGZvciBhIHNwZWNpZmljIHVzZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldFVzZXJSZXNpZGVuY2VzKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxBcnJheTx7IHJlc2lkZW5jZUlkOiBzdHJpbmcgfT4+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRVc2VyUmVzaWRlbmNlcycsXG4gICAgICBgdXNlcl9yZXNpZGVuY2VzOiR7dXNlcklkfWAsXG4gICAgICAncmVzaWRlbmNlcycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCh7XG4gICAgICAgICAgICByZXNpZGVuY2VJZDogc2NoZW1hLnVzZXJSZXNpZGVuY2VzLnJlc2lkZW5jZUlkLFxuICAgICAgICAgIH0pXG4gICAgICAgICAgLmZyb20oc2NoZW1hLnVzZXJSZXNpZGVuY2VzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VySWQpLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgICk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8vIE9yZ2FuaXphdGlvbiBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhbGwgYWN0aXZlIG9yZ2FuaXphdGlvbnMgd2l0aCBjYWNoaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0T3JnYW5pemF0aW9ucygpOiBQcm9taXNlPE9yZ2FuaXphdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldE9yZ2FuaXphdGlvbnMnLCAnYWxsX29yZ2FuaXphdGlvbnMnLCAnb3JnYW5pemF0aW9ucycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKS53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYW4gb3JnYW5pemF0aW9uIGJ5IElEIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRPcmdhbml6YXRpb24oaWQ6IHN0cmluZyk6IFByb21pc2U8T3JnYW5pemF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0T3JnYW5pemF0aW9uJyxcbiAgICAgIGBvcmdhbml6YXRpb246JHtpZH1gLFxuICAgICAgJ29yZ2FuaXphdGlvbnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5pZCwgaWQpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgb3JnYW5pemF0aW9uIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaW5zZXJ0T3JnYW5pemF0aW9uXG4gICAqL1xuICBhc3luYyBjcmVhdGVPcmdhbml6YXRpb24oaW5zZXJ0T3JnYW5pemF0aW9uOiBJbnNlcnRPcmdhbml6YXRpb24pOiBQcm9taXNlPE9yZ2FuaXphdGlvbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZU9yZ2FuaXphdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLm9yZ2FuaXphdGlvbnMpLnZhbHVlcyhpbnNlcnRPcmdhbml6YXRpb24pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBvcmdhbml6YXRpb24gY2FjaGVzXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdvcmdhbml6YXRpb25zJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gQnVpbGRpbmcgb3BlcmF0aW9ucyB3aXRoIG9wdGltaXphdGlvblxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYnVpbGRpbmdzIGJ5IG9yZ2FuaXphdGlvbiB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBvcmdhbml6YXRpb25JZFxuICAgKi9cbiAgYXN5bmMgZ2V0QnVpbGRpbmdzQnlPcmdhbml6YXRpb24ob3JnYW5pemF0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8QnVpbGRpbmdbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEJ1aWxkaW5nc0J5T3JnYW5pemF0aW9uJyxcbiAgICAgIGBvcmdfYnVpbGRpbmdzOiR7b3JnYW5pemF0aW9uSWR9YCxcbiAgICAgICdidWlsZGluZ3MnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYnVpbGRpbmdzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmJ1aWxkaW5ncy5vcmdhbml6YXRpb25JZCwgb3JnYW5pemF0aW9uSWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuYnVpbGRpbmdzLmlzQWN0aXZlLCB0cnVlKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIGJ1aWxkaW5nIGJ5IElEIHdpdGggY2FjaGluZy5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXRCdWlsZGluZyhpZDogc3RyaW5nKTogUHJvbWlzZTxCdWlsZGluZyB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRCdWlsZGluZycsIGBidWlsZGluZzoke2lkfWAsICdidWlsZGluZ3MnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5idWlsZGluZ3MpLndoZXJlKGVxKHNjaGVtYS5idWlsZGluZ3MuaWQsIGlkKSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBuZXcgYnVpbGRpbmcgd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpbnNlcnRCdWlsZGluZ1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlQnVpbGRpbmcoaW5zZXJ0QnVpbGRpbmc6IEluc2VydEJ1aWxkaW5nKTogUHJvbWlzZTxCdWlsZGluZz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZUJ1aWxkaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuYnVpbGRpbmdzKS52YWx1ZXMoW2luc2VydEJ1aWxkaW5nXSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIGJ1aWxkaW5nIGNhY2hlc1xuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZUJ1aWxkaW5nQ2FjaGVzKCcqJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gUmVzaWRlbmNlIG9wZXJhdGlvbnMgd2l0aCBvcHRpbWl6YXRpb25cblxuICAvKipcbiAgICogUmV0cmlldmVzIHJlc2lkZW5jZXMgYnkgYnVpbGRpbmcgd2l0aCBjYWNoaW5nLlxuICAgKiBAcGFyYW0gYnVpbGRpbmdJZFxuICAgKi9cbiAgYXN5bmMgZ2V0UmVzaWRlbmNlc0J5QnVpbGRpbmcoYnVpbGRpbmdJZDogc3RyaW5nKTogUHJvbWlzZTxSZXNpZGVuY2VbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFJlc2lkZW5jZXNCeUJ1aWxkaW5nJyxcbiAgICAgIGBidWlsZGluZ19yZXNpZGVuY2VzOiR7YnVpbGRpbmdJZH1gLFxuICAgICAgJ3Jlc2lkZW5jZXMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoZXEoc2NoZW1hLnJlc2lkZW5jZXMuYnVpbGRpbmdJZCwgYnVpbGRpbmdJZCksIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICApXG4gICAgICAgICAgLm9yZGVyQnkoc2NoZW1hLnJlc2lkZW5jZXMudW5pdE51bWJlcilcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBhIHJlc2lkZW5jZSBieSBJRCB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0UmVzaWRlbmNlKGlkOiBzdHJpbmcpOiBQcm9taXNlPFJlc2lkZW5jZSB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRSZXNpZGVuY2UnLCBgcmVzaWRlbmNlOiR7aWR9YCwgJ3Jlc2lkZW5jZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKS53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pZCwgaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyByZXNpZGVuY2Ugd2l0aCBjYWNoZSBpbnZhbGlkYXRpb24uXG4gICAqIEBwYXJhbSBpbnNlcnRSZXNpZGVuY2VcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVJlc2lkZW5jZShpbnNlcnRSZXNpZGVuY2U6IEluc2VydFJlc2lkZW5jZSk6IFByb21pc2U8UmVzaWRlbmNlPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlUmVzaWRlbmNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEucmVzaWRlbmNlcykudmFsdWVzKFtpbnNlcnRSZXNpZGVuY2VdKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIC8vIEludmFsaWRhdGUgcmVzaWRlbmNlIGNhY2hlc1xuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZVJlc2lkZW5jZUNhY2hlcygnKicpO1xuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIEFkZGl0aW9uYWwgb3B0aW1pemVkIG1ldGhvZHMgZm9yIGZyZXF1ZW50bHkgYWNjZXNzZWQgZGF0YVxuXG4gIC8qKlxuICAgKiBHZXRzIHVzZXIgcmVzaWRlbmNlcyB3aXRoIGZ1bGwgZGV0YWlscyAtIGZvciBjb21wbGV4IHJlc2lkZW5jZSB2aWV3cy5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlclJlc2lkZW5jZXNXaXRoRGV0YWlscyh1c2VySWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRVc2VyUmVzaWRlbmNlc1dpdGhEZXRhaWxzJyxcbiAgICAgIGB1c2VyX3Jlc2lkZW5jZXNfZGV0YWlsczoke3VzZXJJZH1gLFxuICAgICAgJ3Jlc2lkZW5jZXMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgIHJlc2lkZW5jZTogc2NoZW1hLnJlc2lkZW5jZXMsXG4gICAgICAgICAgICBidWlsZGluZzogc2NoZW1hLmJ1aWxkaW5ncyxcbiAgICAgICAgICAgIHVzZXJSZXNpZGVuY2U6IHNjaGVtYS51c2VyUmVzaWRlbmNlcyxcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUmVzaWRlbmNlcylcbiAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5yZXNpZGVuY2VzLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMucmVzaWRlbmNlSWQsIHNjaGVtYS5yZXNpZGVuY2VzLmlkKSlcbiAgICAgICAgICAuaW5uZXJKb2luKHNjaGVtYS5idWlsZGluZ3MsIGVxKHNjaGVtYS5yZXNpZGVuY2VzLmJ1aWxkaW5nSWQsIHNjaGVtYS5idWlsZGluZ3MuaWQpKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChlcShzY2hlbWEudXNlclJlc2lkZW5jZXMudXNlcklkLCB1c2VySWQpLCBlcShzY2hlbWEudXNlclJlc2lkZW5jZXMuaXNBY3RpdmUsIHRydWUpKVxuICAgICAgICAgIClcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWN0aXZlIGJpbGxzIGZvciBhIHJlc2lkZW5jZSAtIGZyZXF1ZW50bHkgcXVlcmllZC5cbiAgICogQHBhcmFtIHJlc2lkZW5jZUlkXG4gICAqL1xuICBhc3luYyBnZXRBY3RpdmVCaWxsc0J5UmVzaWRlbmNlKHJlc2lkZW5jZUlkOiBzdHJpbmcpOiBQcm9taXNlPGFueVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QWN0aXZlQmlsbHNCeVJlc2lkZW5jZScsXG4gICAgICBgcmVzaWRlbmNlX2JpbGxzOiR7cmVzaWRlbmNlSWR9YCxcbiAgICAgICdiaWxscycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5iaWxscylcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5iaWxscy5yZXNpZGVuY2VJZCwgcmVzaWRlbmNlSWQpLFxuICAgICAgICAgICAgICBvcihlcShzY2hlbWEuYmlsbHMuc3RhdHVzLCAnc2VudCcpLCBlcShzY2hlbWEuYmlsbHMuc3RhdHVzLCAnb3ZlcmR1ZScpKVxuICAgICAgICAgICAgKVxuICAgICAgICAgIClcbiAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5iaWxscy5kdWVEYXRlKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgbWFpbnRlbmFuY2UgcmVxdWVzdHMgZm9yIGEgcmVzaWRlbmNlIC0gZnJlcXVlbnRseSBhY2Nlc3NlZC5cbiAgICogQHBhcmFtIHJlc2lkZW5jZUlkXG4gICAqL1xuICBhc3luYyBnZXRNYWludGVuYW5jZVJlcXVlc3RzQnlSZXNpZGVuY2UocmVzaWRlbmNlSWQ6IHN0cmluZyk6IFByb21pc2U8YW55W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRNYWludGVuYW5jZVJlcXVlc3RzQnlSZXNpZGVuY2UnLFxuICAgICAgYHJlc2lkZW5jZV9tYWludGVuYW5jZToke3Jlc2lkZW5jZUlkfWAsXG4gICAgICAnbWFpbnRlbmFuY2UnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEubWFpbnRlbmFuY2VSZXF1ZXN0cylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm1haW50ZW5hbmNlUmVxdWVzdHMucmVzaWRlbmNlSWQsIHJlc2lkZW5jZUlkKSlcbiAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5tYWludGVuYW5jZVJlcXVlc3RzLmNyZWF0ZWRBdCkpXG4gICAgKTtcbiAgfVxuXG4gIC8vIE1pc3NpbmcgT3JnYW5pemF0aW9uIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBvcmdhbml6YXRpb24gYnkgbmFtZSB3aXRoIGNhY2hpbmcuXG4gICAqIEBwYXJhbSBuYW1lXG4gICAqL1xuICBhc3luYyBnZXRPcmdhbml6YXRpb25CeU5hbWUobmFtZTogc3RyaW5nKTogUHJvbWlzZTxPcmdhbml6YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRPcmdhbml6YXRpb25CeU5hbWUnLFxuICAgICAgYG9yZ19uYW1lOiR7bmFtZX1gLFxuICAgICAgJ29yZ2FuaXphdGlvbnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5vcmdhbml6YXRpb25zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEub3JnYW5pemF0aW9ucy5uYW1lLCBuYW1lKSk7XG4gICAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIG9yZ2FuaXphdGlvbiB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVPcmdhbml6YXRpb24oXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPE9yZ2FuaXphdGlvbj5cbiAgKTogUHJvbWlzZTxPcmdhbml6YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVPcmdhbml6YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEub3JnYW5pemF0aW9ucylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLm9yZ2FuaXphdGlvbnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlVXNlckNhY2hlcygnKicpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBNaXNzaW5nIEJ1aWxkaW5nIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgYnVpbGRpbmdzIHdpdGggY2FjaGluZy5cbiAgICovXG4gIGFzeW5jIGdldEJ1aWxkaW5ncygpOiBQcm9taXNlPEJ1aWxkaW5nW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0QnVpbGRpbmdzJywgJ2FsbF9idWlsZGluZ3MnLCAnYnVpbGRpbmdzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmJ1aWxkaW5ncykud2hlcmUoZXEoc2NoZW1hLmJ1aWxkaW5ncy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGJ1aWxkaW5nIHdpdGggY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUJ1aWxkaW5nKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8QnVpbGRpbmc+KTogUHJvbWlzZTxCdWlsZGluZyB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUJ1aWxkaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1aWxkaW5ncy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVCdWlsZGluZ0NhY2hlcyhpZCk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGJ1aWxkaW5nIChzb2Z0IGRlbGV0ZSkuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQnVpbGRpbmcoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZUJ1aWxkaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmJ1aWxkaW5ncylcbiAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuYnVpbGRpbmdzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIENhY2hlSW52YWxpZGF0b3IuaW52YWxpZGF0ZUJ1aWxkaW5nQ2FjaGVzKGlkKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvLyBNaXNzaW5nIFJlc2lkZW5jZSBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHJlc2lkZW5jZXMgd2l0aCBjYWNoaW5nLlxuICAgKi9cbiAgYXN5bmMgZ2V0UmVzaWRlbmNlcygpOiBQcm9taXNlPFJlc2lkZW5jZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFJlc2lkZW5jZXMnLCAnYWxsX3Jlc2lkZW5jZXMnLCAncmVzaWRlbmNlcycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5yZXNpZGVuY2VzKS53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHJlc2lkZW5jZSB3aXRoIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVSZXNpZGVuY2UoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxSZXNpZGVuY2U+KTogUHJvbWlzZTxSZXNpZGVuY2UgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVSZXNpZGVuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnJlc2lkZW5jZXMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgQ2FjaGVJbnZhbGlkYXRvci5pbnZhbGlkYXRlUmVzaWRlbmNlQ2FjaGVzKGlkKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgcmVzaWRlbmNlIChzb2Z0IGRlbGV0ZSkuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlUmVzaWRlbmNlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdkZWxldGVSZXNpZGVuY2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEucmVzaWRlbmNlcylcbiAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSwgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEucmVzaWRlbmNlcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBDYWNoZUludmFsaWRhdG9yLmludmFsaWRhdGVSZXNpZGVuY2VDYWNoZXMoaWQpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vIERldmVsb3BtZW50IFBpbGxhciBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGRldmVsb3BtZW50IHBpbGxhcnMuXG4gICAqL1xuICBhc3luYyBnZXRQaWxsYXJzKCk6IFByb21pc2U8RGV2ZWxvcG1lbnRQaWxsYXJbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRQaWxsYXJzJywgJ2FsbF9waWxsYXJzJywgJ3BpbGxhcnMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBkZXZlbG9wbWVudCBwaWxsYXIgYnkgSUQuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0UGlsbGFyKGlkOiBzdHJpbmcpOiBQcm9taXNlPERldmVsb3BtZW50UGlsbGFyIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldFBpbGxhcicsIGBwaWxsYXI6JHtpZH1gLCAncGlsbGFycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZGV2ZWxvcG1lbnRQaWxsYXJzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycy5pZCwgaWQpKTtcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBkZXZlbG9wbWVudCBwaWxsYXIuXG4gICAqIEBwYXJhbSBwaWxsYXJcbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBpbGxhcihwaWxsYXI6IEluc2VydFBpbGxhcik6IFByb21pc2U8RGV2ZWxvcG1lbnRQaWxsYXI+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVQaWxsYXInLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMpLnZhbHVlcyhwaWxsYXIpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdwaWxsYXJzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGRldmVsb3BtZW50IHBpbGxhci5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSBwaWxsYXJcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVBpbGxhcihcbiAgICBpZDogc3RyaW5nLFxuICAgIHBpbGxhcjogUGFydGlhbDxEZXZlbG9wbWVudFBpbGxhcj5cbiAgKTogUHJvbWlzZTxEZXZlbG9wbWVudFBpbGxhciB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZVBpbGxhcicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5kZXZlbG9wbWVudFBpbGxhcnMpXG4gICAgICAgIC5zZXQoeyAuLi5waWxsYXIsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRldmVsb3BtZW50UGlsbGFycy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3BpbGxhcnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gV29ya3NwYWNlIFN0YXR1cyBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIHdvcmtzcGFjZSBzdGF0dXNlcy5cbiAgICovXG4gIGFzeW5jIGdldFdvcmtzcGFjZVN0YXR1c2VzKCk6IFByb21pc2U8V29ya3NwYWNlU3RhdHVzW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRXb3Jrc3BhY2VTdGF0dXNlcycsXG4gICAgICAnYWxsX3dvcmtzcGFjZV9zdGF0dXNlcycsXG4gICAgICAnd29ya3NwYWNlX3N0YXR1cycsXG4gICAgICAoKSA9PiBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHdvcmtzcGFjZSBzdGF0dXMgYnkgY29tcG9uZW50LlxuICAgKiBAcGFyYW0gY29tcG9uZW50XG4gICAqL1xuICBhc3luYyBnZXRXb3Jrc3BhY2VTdGF0dXMoY29tcG9uZW50OiBzdHJpbmcpOiBQcm9taXNlPFdvcmtzcGFjZVN0YXR1cyB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFdvcmtzcGFjZVN0YXR1cycsXG4gICAgICBgd29ya3NwYWNlX3N0YXR1czoke2NvbXBvbmVudH1gLFxuICAgICAgJ3dvcmtzcGFjZV9zdGF0dXMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMuY29tcG9uZW50LCBjb21wb25lbnQpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgd29ya3NwYWNlIHN0YXR1cy5cbiAgICogQHBhcmFtIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlV29ya3NwYWNlU3RhdHVzKHN0YXR1czogSW5zZXJ0V29ya3NwYWNlU3RhdHVzKTogUHJvbWlzZTxXb3Jrc3BhY2VTdGF0dXM+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVXb3Jrc3BhY2VTdGF0dXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS53b3Jrc3BhY2VTdGF0dXMpLnZhbHVlcyhzdGF0dXMpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd3b3Jrc3BhY2Vfc3RhdHVzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIHdvcmtzcGFjZSBzdGF0dXMuXG4gICAqIEBwYXJhbSBjb21wb25lbnRcbiAgICogQHBhcmFtIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlV29ya3NwYWNlU3RhdHVzKFxuICAgIGNvbXBvbmVudDogc3RyaW5nLFxuICAgIHN0YXR1czogc3RyaW5nXG4gICk6IFByb21pc2U8V29ya3NwYWNlU3RhdHVzIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlV29ya3NwYWNlU3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLndvcmtzcGFjZVN0YXR1cylcbiAgICAgICAgLnNldCh7IHN0YXR1cyB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLndvcmtzcGFjZVN0YXR1cy5jb21wb25lbnQsIGNvbXBvbmVudCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnd29ya3NwYWNlX3N0YXR1cycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBRdWFsaXR5IE1ldHJpY3Mgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBxdWFsaXR5IG1ldHJpY3MuXG4gICAqL1xuICBhc3luYyBnZXRRdWFsaXR5TWV0cmljcygpOiBQcm9taXNlPFF1YWxpdHlNZXRyaWNbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFF1YWxpdHlNZXRyaWNzJyxcbiAgICAgICdhbGxfcXVhbGl0eV9tZXRyaWNzJyxcbiAgICAgICdxdWFsaXR5X21ldHJpY3MnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEucXVhbGl0eU1ldHJpY3MpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIHF1YWxpdHkgbWV0cmljLlxuICAgKiBAcGFyYW0gbWV0cmljXG4gICAqL1xuICBhc3luYyBjcmVhdGVRdWFsaXR5TWV0cmljKG1ldHJpYzogSW5zZXJ0UXVhbGl0eU1ldHJpYyk6IFByb21pc2U8UXVhbGl0eU1ldHJpYz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2NyZWF0ZVF1YWxpdHlNZXRyaWMnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5xdWFsaXR5TWV0cmljcykudmFsdWVzKG1ldHJpYykucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3F1YWxpdHlfbWV0cmljcycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBGcmFtZXdvcmsgQ29uZmlndXJhdGlvbiBvcGVyYXRpb25zXG5cbiAgLyoqXG4gICAqIEdldHMgYWxsIGZyYW1ld29yayBjb25maWd1cmF0aW9ucy5cbiAgICovXG4gIGFzeW5jIGdldEZyYW1ld29ya0NvbmZpZ3MoKTogUHJvbWlzZTxGcmFtZXdvcmtDb25maWd1cmF0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGcmFtZXdvcmtDb25maWdzJyxcbiAgICAgICdhbGxfZnJhbWV3b3JrX2NvbmZpZ3MnLFxuICAgICAgJ2ZyYW1ld29ya19jb25maWdzJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmZyYW1ld29ya0NvbmZpZ3VyYXRpb24pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGZyYW1ld29yayBjb25maWcgYnkga2V5LlxuICAgKiBAcGFyYW0ga2V5XG4gICAqIEBwYXJhbSBfa2V5XG4gICAqL1xuICBhc3luYyBnZXRGcmFtZXdvcmtDb25maWcoX2tleTogc3RyaW5nKTogUHJvbWlzZTxGcmFtZXdvcmtDb25maWd1cmF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0RnJhbWV3b3JrQ29uZmlnJyxcbiAgICAgIGBmcmFtZXdvcmtfY29uZmlnOiR7X2tleX1gLFxuICAgICAgJ2ZyYW1ld29ya19jb25maWdzJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuZnJhbWV3b3JrQ29uZmlndXJhdGlvbilcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZyYW1ld29ya0NvbmZpZ3VyYXRpb24uX2tleSwgX2tleSkpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogU2V0cyBmcmFtZXdvcmsgY29uZmlndXJhdGlvbi5cbiAgICogQHBhcmFtIGNvbmZpZ1xuICAgKi9cbiAgYXN5bmMgc2V0RnJhbWV3b3JrQ29uZmlnKGNvbmZpZzogSW5zZXJ0RnJhbWV3b3JrQ29uZmlndXJhdGlvbik6IFByb21pc2U8RnJhbWV3b3JrQ29uZmlndXJhdGlvbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3NldEZyYW1ld29ya0NvbmZpZycsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAuaW5zZXJ0KHNjaGVtYS5mcmFtZXdvcmtDb25maWd1cmF0aW9uKVxuICAgICAgICAudmFsdWVzKGNvbmZpZylcbiAgICAgICAgLm9uQ29uZmxpY3REb1VwZGF0ZSh7XG4gICAgICAgICAgdGFyZ2V0OiBzY2hlbWEuZnJhbWV3b3JrQ29uZmlndXJhdGlvbi5fa2V5LFxuICAgICAgICAgIHNldDogeyBfdmFsdWU6IGNvbmZpZy5fdmFsdWUsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9LFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZyYW1ld29ya19jb25maWdzJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8vIEltcHJvdmVtZW50IFN1Z2dlc3Rpb25zIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgaW1wcm92ZW1lbnQgc3VnZ2VzdGlvbnMuXG4gICAqL1xuICBhc3luYyBnZXRJbXByb3ZlbWVudFN1Z2dlc3Rpb25zKCk6IFByb21pc2U8SW1wcm92ZW1lbnRTdWdnZXN0aW9uW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRJbXByb3ZlbWVudFN1Z2dlc3Rpb25zJyxcbiAgICAgICdhbGxfaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnLFxuICAgICAgJ2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRvcCBpbXByb3ZlbWVudCBzdWdnZXN0aW9ucy5cbiAgICogQHBhcmFtIGxpbWl0XG4gICAqL1xuICBhc3luYyBnZXRUb3BJbXByb3ZlbWVudFN1Z2dlc3Rpb25zKGxpbWl0OiBudW1iZXIpOiBQcm9taXNlPEltcHJvdmVtZW50U3VnZ2VzdGlvbltdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0VG9wSW1wcm92ZW1lbnRTdWdnZXN0aW9ucycsXG4gICAgICBgdG9wX3N1Z2dlc3Rpb25zOiR7bGltaXR9YCxcbiAgICAgICdpbXByb3ZlbWVudF9zdWdnZXN0aW9ucycsXG4gICAgICAoKSA9PlxuICAgICAgICBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zKVxuICAgICAgICAgIC5vcmRlckJ5KFxuICAgICAgICAgICAgZGVzYyhzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucy5wcmlvcml0eSksXG4gICAgICAgICAgICBkZXNjKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zLmNyZWF0ZWRBdClcbiAgICAgICAgICApXG4gICAgICAgICAgLmxpbWl0KGxpbWl0KVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBpbXByb3ZlbWVudCBzdWdnZXN0aW9uLlxuICAgKiBAcGFyYW0gc3VnZ2VzdGlvblxuICAgKi9cbiAgYXN5bmMgY3JlYXRlSW1wcm92ZW1lbnRTdWdnZXN0aW9uKFxuICAgIHN1Z2dlc3Rpb246IEluc2VydEltcHJvdmVtZW50U3VnZ2VzdGlvblxuICApOiBQcm9taXNlPEltcHJvdmVtZW50U3VnZ2VzdGlvbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoXG4gICAgICAnY3JlYXRlSW1wcm92ZW1lbnRTdWdnZXN0aW9uJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgcmV0dXJuIGRiXG4gICAgICAgICAgLmluc2VydChzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucylcbiAgICAgICAgICAudmFsdWVzKFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLi4uc3VnZ2VzdGlvbixcbiAgICAgICAgICAgICAgY2F0ZWdvcnk6IHN1Z2dlc3Rpb24uY2F0ZWdvcnkgYXNcbiAgICAgICAgICAgICAgICB8ICdDb2RlIFF1YWxpdHknXG4gICAgICAgICAgICAgICAgfCAnU2VjdXJpdHknXG4gICAgICAgICAgICAgICAgfCAnVGVzdGluZydcbiAgICAgICAgICAgICAgICB8ICdEb2N1bWVudGF0aW9uJ1xuICAgICAgICAgICAgICAgIHwgJ1BlcmZvcm1hbmNlJ1xuICAgICAgICAgICAgICAgIHwgJ0NvbnRpbnVvdXMgSW1wcm92ZW1lbnQnXG4gICAgICAgICAgICAgICAgfCAnUmVwbGl0IEFJIEFnZW50IE1vbml0b3JpbmcnXG4gICAgICAgICAgICAgICAgfCAnUmVwbGl0IEFwcCcsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0pXG4gICAgICAgICAgLnJldHVybmluZygpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhcnMgbmV3IHN1Z2dlc3Rpb25zLlxuICAgKi9cbiAgYXN5bmMgY2xlYXJOZXdTdWdnZXN0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjbGVhck5ld1N1Z2dlc3Rpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMpXG4gICAgICAgIC5zZXQoeyBzdGF0dXM6ICdBY2tub3dsZWRnZWQnIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW1wcm92ZW1lbnRTdWdnZXN0aW9ucy5zdGF0dXMsICdOZXcnKSk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ltcHJvdmVtZW50X3N1Z2dlc3Rpb25zJyk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyBzdWdnZXN0aW9uIHN0YXR1cy5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSBzdGF0dXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZVN1Z2dlc3Rpb25TdGF0dXMoXG4gICAgaWQ6IHN0cmluZyxcbiAgICBzdGF0dXM6ICdOZXcnIHwgJ0Fja25vd2xlZGdlZCcgfCAnRG9uZSdcbiAgKTogUHJvbWlzZTxJbXByb3ZlbWVudFN1Z2dlc3Rpb24gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVTdWdnZXN0aW9uU3RhdHVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmltcHJvdmVtZW50U3VnZ2VzdGlvbnMpXG4gICAgICAgIC5zZXQoeyBzdGF0dXMgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbXByb3ZlbWVudFN1Z2dlc3Rpb25zLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW1wcm92ZW1lbnRfc3VnZ2VzdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLy8gRmVhdHVyZXMgb3BlcmF0aW9uc1xuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCBmZWF0dXJlcy5cbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVzKCk6IFByb21pc2U8RmVhdHVyZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldEZlYXR1cmVzJywgJ2FsbF9mZWF0dXJlcycsICdmZWF0dXJlcycsICgpID0+XG4gICAgICBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5mZWF0dXJlcylcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZmVhdHVyZXMgYnkgc3RhdHVzLlxuICAgKiBAcGFyYW0gc3RhdHVzXG4gICAqL1xuICBhc3luYyBnZXRGZWF0dXJlc0J5U3RhdHVzKFxuICAgIHN0YXR1czogJ2NvbXBsZXRlZCcgfCAnaW4tcHJvZ3Jlc3MnIHwgJ3BsYW5uZWQnIHwgJ2NhbmNlbGxlZCcgfCAncmVxdWVzdGVkJ1xuICApOiBQcm9taXNlPEZlYXR1cmVbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZlYXR1cmVzQnlTdGF0dXMnLFxuICAgICAgYGZlYXR1cmVzX3N0YXR1czoke3N0YXR1c31gLFxuICAgICAgJ2ZlYXR1cmVzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZXMuc3RhdHVzLCBzdGF0dXMgYXMgYW55KSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgZmVhdHVyZXMgYnkgY2F0ZWdvcnkuXG4gICAqIEBwYXJhbSBjYXRlZ29yeVxuICAgKi9cbiAgYXN5bmMgZ2V0RmVhdHVyZXNCeUNhdGVnb3J5KGNhdGVnb3J5OiBzdHJpbmcpOiBQcm9taXNlPEZlYXR1cmVbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZlYXR1cmVzQnlDYXRlZ29yeScsXG4gICAgICBgZmVhdHVyZXNfY2F0ZWdvcnk6JHtjYXRlZ29yeX1gLFxuICAgICAgJ2ZlYXR1cmVzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVzKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZXMuY2F0ZWdvcnksIGNhdGVnb3J5IGFzIGFueSkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHB1YmxpYyByb2FkbWFwIGZlYXR1cmVzLlxuICAgKi9cbiAgYXN5bmMgZ2V0UHVibGljUm9hZG1hcEZlYXR1cmVzKCk6IFByb21pc2U8RmVhdHVyZVtdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0UHVibGljUm9hZG1hcEZlYXR1cmVzJyxcbiAgICAgICdwdWJsaWNfcm9hZG1hcF9mZWF0dXJlcycsXG4gICAgICAnZmVhdHVyZXMnLFxuICAgICAgKCkgPT4gZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZmVhdHVyZXMpLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlcy5pc1B1YmxpY1JvYWRtYXAsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBmZWF0dXJlLlxuICAgKiBAcGFyYW0gZmVhdHVyZVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlRmVhdHVyZShmZWF0dXJlOiBJbnNlcnRGZWF0dXJlKTogUHJvbWlzZTxGZWF0dXJlPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlRmVhdHVyZScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmZlYXR1cmVzKS52YWx1ZXMoW2ZlYXR1cmVdKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgZmVhdHVyZS5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVGZWF0dXJlKGlkOiBzdHJpbmcsIHVwZGF0ZXM6IFBhcnRpYWw8SW5zZXJ0RmVhdHVyZT4pOiBQcm9taXNlPEZlYXR1cmUgfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVGZWF0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmZlYXR1cmVzKVxuICAgICAgICAuc2V0KHVwZGF0ZXMgYXMgYW55KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZXMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgZmVhdHVyZS5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBkZWxldGVGZWF0dXJlKGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdkZWxldGVGZWF0dXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmRlbGV0ZShzY2hlbWEuZmVhdHVyZXMpLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlcy5pZCwgaWQpKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZXMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvLyBBY3Rpb25hYmxlIEl0ZW1zIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhY3Rpb25hYmxlIGl0ZW1zIGJ5IGZlYXR1cmUuXG4gICAqIEBwYXJhbSBmZWF0dXJlSWRcbiAgICovXG4gIGFzeW5jIGdldEFjdGlvbmFibGVJdGVtc0J5RmVhdHVyZShmZWF0dXJlSWQ6IHN0cmluZyk6IFByb21pc2U8QWN0aW9uYWJsZUl0ZW1bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEFjdGlvbmFibGVJdGVtc0J5RmVhdHVyZScsXG4gICAgICBgYWN0aW9uYWJsZV9pdGVtczoke2ZlYXR1cmVJZH1gLFxuICAgICAgJ2FjdGlvbmFibGVfaXRlbXMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zLmZlYXR1cmVJZCwgZmVhdHVyZUlkKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgYWN0aW9uYWJsZSBpdGVtIGJ5IElELlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGdldEFjdGlvbmFibGVJdGVtKGlkOiBzdHJpbmcpOiBQcm9taXNlPEFjdGlvbmFibGVJdGVtIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0QWN0aW9uYWJsZUl0ZW0nLFxuICAgICAgYGFjdGlvbmFibGVfaXRlbToke2lkfWAsXG4gICAgICAnYWN0aW9uYWJsZV9pdGVtcycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmFjdGlvbmFibGVJdGVtcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmFjdGlvbmFibGVJdGVtcy5pZCwgaWQpKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZXMgYWN0aW9uYWJsZSBpdGVtLlxuICAgKiBAcGFyYW0gaXRlbVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQWN0aW9uYWJsZUl0ZW0oaXRlbTogSW5zZXJ0QWN0aW9uYWJsZUl0ZW0pOiBQcm9taXNlPEFjdGlvbmFibGVJdGVtPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlQWN0aW9uYWJsZUl0ZW0nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpLnZhbHVlcyhbaXRlbV0pLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdhY3Rpb25hYmxlX2l0ZW1zJyk7XG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIG11bHRpcGxlIGFjdGlvbmFibGUgaXRlbXMuXG4gICAqIEBwYXJhbSBpdGVtc1xuICAgKi9cbiAgYXN5bmMgY3JlYXRlQWN0aW9uYWJsZUl0ZW1zKGl0ZW1zOiBJbnNlcnRBY3Rpb25hYmxlSXRlbVtdKTogUHJvbWlzZTxBY3Rpb25hYmxlSXRlbVtdPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlQWN0aW9uYWJsZUl0ZW1zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKS52YWx1ZXMoaXRlbXMpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdhY3Rpb25hYmxlX2l0ZW1zJyk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGVzIGFjdGlvbmFibGUgaXRlbS5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVBY3Rpb25hYmxlSXRlbShcbiAgICBpZDogc3RyaW5nLFxuICAgIHVwZGF0ZXM6IFBhcnRpYWw8QWN0aW9uYWJsZUl0ZW0+XG4gICk6IFByb21pc2U8QWN0aW9uYWJsZUl0ZW0gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVBY3Rpb25hYmxlSXRlbScsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5hY3Rpb25hYmxlSXRlbXMpXG4gICAgICAgIC5zZXQodXBkYXRlcyBhcyBhbnkpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYWN0aW9uYWJsZV9pdGVtcycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhY3Rpb25hYmxlIGl0ZW0uXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQWN0aW9uYWJsZUl0ZW0oaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZUFjdGlvbmFibGVJdGVtJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmRlbGV0ZShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zKS53aGVyZShlcShzY2hlbWEuYWN0aW9uYWJsZUl0ZW1zLmlkLCBpZCkpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdhY3Rpb25hYmxlX2l0ZW1zJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGggPiAwO1xuICB9XG5cbiAgLyoqXG4gICAqIERlbGV0ZXMgYWN0aW9uYWJsZSBpdGVtcyBieSBmZWF0dXJlLlxuICAgKiBAcGFyYW0gZmVhdHVyZUlkXG4gICAqL1xuICBhc3luYyBkZWxldGVBY3Rpb25hYmxlSXRlbXNCeUZlYXR1cmUoZmVhdHVyZUlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KFxuICAgICAgJ2RlbGV0ZUFjdGlvbmFibGVJdGVtc0J5RmVhdHVyZScsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBkYlxuICAgICAgICAgIC5kZWxldGUoc2NoZW1hLmFjdGlvbmFibGVJdGVtcylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmFjdGlvbmFibGVJdGVtcy5mZWF0dXJlSWQsIGZlYXR1cmVJZCkpXG4gICAgICAgICAgLnJldHVybmluZygpO1xuICAgICAgfVxuICAgICk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2FjdGlvbmFibGVfaXRlbXMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvLyBJbnZpdGF0aW9uIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgaW52aXRhdGlvbnMuXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9ucygpOiBQcm9taXNlPEludml0YXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRJbnZpdGF0aW9ucycsICdhbGxfaW52aXRhdGlvbnMnLCAnaW52aXRhdGlvbnMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb24gYnkgSUQuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbihpZDogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldEludml0YXRpb24nLCBgaW52aXRhdGlvbjoke2lkfWAsICdpbnZpdGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIGlkKSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbiBieSB0b2tlbi5cbiAgICogQHBhcmFtIHRva2VuXG4gICAqL1xuICBhc3luYyBnZXRJbnZpdGF0aW9uQnlUb2tlbih0b2tlbjogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW52aXRhdGlvbkJ5VG9rZW4nLFxuICAgICAgYGludml0YXRpb25fdG9rZW46JHt0b2tlbn1gLFxuICAgICAgJ2ludml0YXRpb25zJyxcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy50b2tlbiwgdG9rZW4pKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbnMgYnkgZW1haWwuXG4gICAqIEBwYXJhbSBlbWFpbFxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbnNCeUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEludml0YXRpb25zQnlFbWFpbCcsXG4gICAgICBgaW52aXRhdGlvbnNfZW1haWw6JHtlbWFpbH1gLFxuICAgICAgJ2ludml0YXRpb25zJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuZW1haWwsIGVtYWlsKSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgaW52aXRhdGlvbnMgYnkgaW52aXRlci5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbnNCeUludml0ZXIodXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEludml0YXRpb25zQnlJbnZpdGVyJyxcbiAgICAgIGBpbnZpdGF0aW9uc19pbnZpdGVyOiR7dXNlcklkfWAsXG4gICAgICAnaW52aXRhdGlvbnMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpLndoZXJlKGVxKHNjaGVtYS5pbnZpdGF0aW9ucy5pbnZpdGVkQnlVc2VySWQsIHVzZXJJZCkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGludml0YXRpb25zIGJ5IHN0YXR1cy5cbiAgICogQHBhcmFtIHN0YXR1c1xuICAgKi9cbiAgYXN5bmMgZ2V0SW52aXRhdGlvbnNCeVN0YXR1cyhcbiAgICBzdGF0dXM6ICdwZW5kaW5nJyB8ICdhY2NlcHRlZCcgfCAnZXhwaXJlZCcgfCAnY2FuY2VsbGVkJ1xuICApOiBQcm9taXNlPEludml0YXRpb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEludml0YXRpb25zQnlTdGF0dXMnLFxuICAgICAgYGludml0YXRpb25zX3N0YXR1czoke3N0YXR1c31gLFxuICAgICAgJ2ludml0YXRpb25zJyxcbiAgICAgICgpID0+IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludml0YXRpb25zKS53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuc3RhdHVzLCBzdGF0dXMpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBpbnZpdGF0aW9uLlxuICAgKiBAcGFyYW0gaW52aXRhdGlvblxuICAgKi9cbiAgYXN5bmMgY3JlYXRlSW52aXRhdGlvbihpbnZpdGF0aW9uOiBJbnNlcnRJbnZpdGF0aW9uKTogUHJvbWlzZTxJbnZpdGF0aW9uPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlSW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYi5pbnNlcnQoc2NoZW1hLmludml0YXRpb25zKS52YWx1ZXMoW2ludml0YXRpb25dKS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgaW52aXRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1cGRhdGVzXG4gICAqL1xuICBhc3luYyB1cGRhdGVJbnZpdGF0aW9uKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxJbnZpdGF0aW9uPlxuICApOiBQcm9taXNlPEludml0YXRpb24gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVJbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAuc2V0KHVwZGF0ZXMgYXMgYW55KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnaW52aXRhdGlvbnMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIEFjY2VwdHMgaW52aXRhdGlvbi5cbiAgICogQHBhcmFtIHRva2VuXG4gICAqIEBwYXJhbSB1c2VyRGF0YVxuICAgKiBAcGFyYW0gdXNlckRhdGEuZmlyc3ROYW1lXG4gICAqIEBwYXJhbSBpcEFkZHJlc3NcbiAgICogQHBhcmFtIHVzZXJEYXRhLmxhc3ROYW1lXG4gICAqIEBwYXJhbSB1c2VyQWdlbnRcbiAgICogQHBhcmFtIHVzZXJEYXRhLnBhc3N3b3JkXG4gICAqL1xuICBhc3luYyBhY2NlcHRJbnZpdGF0aW9uKFxuICAgIHRva2VuOiBzdHJpbmcsXG4gICAgdXNlckRhdGE6IHsgZmlyc3ROYW1lOiBzdHJpbmc7IGxhc3ROYW1lOiBzdHJpbmc7IHBhc3N3b3JkOiBzdHJpbmcgfSxcbiAgICBpcEFkZHJlc3M/OiBzdHJpbmcsXG4gICAgdXNlckFnZW50Pzogc3RyaW5nXG4gICk6IFByb21pc2U8eyB1c2VyOiBVc2VyOyBpbnZpdGF0aW9uOiBJbnZpdGF0aW9uIH0gfCBudWxsPiB7XG4gICAgcmV0dXJuIGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2FjY2VwdEludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBpbnZpdGF0aW9uID0gYXdhaXQgdGhpcy5nZXRJbnZpdGF0aW9uQnlUb2tlbih0b2tlbik7XG4gICAgICBpZiAoIWludml0YXRpb24gfHwgaW52aXRhdGlvbi5zdGF0dXMgIT09ICdwZW5kaW5nJykge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHVzZXIgd2l0aCByZXF1aXJlZCBmaWVsZHNcbiAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB0aGlzLmNyZWF0ZVVzZXIoe1xuICAgICAgICB1c2VybmFtZTogaW52aXRhdGlvbi5lbWFpbC5zcGxpdCgnQCcpWzBdLCAvLyBVc2UgZW1haWwgcHJlZml4IGFzIHVzZXJuYW1lXG4gICAgICAgIGVtYWlsOiBpbnZpdGF0aW9uLmVtYWlsLFxuICAgICAgICBmaXJzdE5hbWU6IHVzZXJEYXRhLmZpcnN0TmFtZSxcbiAgICAgICAgbGFzdE5hbWU6IHVzZXJEYXRhLmxhc3ROYW1lLFxuICAgICAgICBwYXNzd29yZDogdXNlckRhdGEucGFzc3dvcmQsIC8vIFRoaXMgc2hvdWxkIGJlIGhhc2hlZFxuICAgICAgICBsYW5ndWFnZTogJ2VuJywgLy8gRGVmYXVsdCBsYW5ndWFnZVxuICAgICAgICByb2xlOiBpbnZpdGF0aW9uLnJvbGUsXG4gICAgICB9KTtcblxuICAgICAgLy8gVXBkYXRlIGludml0YXRpb25cbiAgICAgIGNvbnN0IHVwZGF0ZWRJbnZpdGF0aW9uID0gYXdhaXQgdGhpcy51cGRhdGVJbnZpdGF0aW9uKGludml0YXRpb24uaWQsIHtcbiAgICAgICAgc3RhdHVzOiAnYWNjZXB0ZWQnLFxuICAgICAgICBhY2NlcHRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB7IHVzZXIsIGludml0YXRpb246IHVwZGF0ZWRJbnZpdGF0aW9uISB9O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbmNlbHMgaW52aXRhdGlvbi5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSBjYW5jZWxsZWRCeVxuICAgKi9cbiAgYXN5bmMgY2FuY2VsSW52aXRhdGlvbihpZDogc3RyaW5nLCBjYW5jZWxsZWRCeTogc3RyaW5nKTogUHJvbWlzZTxJbnZpdGF0aW9uIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY2FuY2VsSW52aXRhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZpdGF0aW9ucylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgc3RhdHVzOiAnY2FuY2VsbGVkJyxcbiAgICAgICAgICBjYW5jZWxsZWRCeSxcbiAgICAgICAgICBjYW5jZWxsZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRXhwaXJlcyBvbGQgaW52aXRhdGlvbnMuXG4gICAqL1xuICBhc3luYyBleHBpcmVJbnZpdGF0aW9ucygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2V4cGlyZUludml0YXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAuc2V0KHsgc3RhdHVzOiAnZXhwaXJlZCcsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoXG4gICAgICAgICAgYW5kKFxuICAgICAgICAgICAgZXEoc2NoZW1hLmludml0YXRpb25zLnN0YXR1cywgJ3BlbmRpbmcnKSxcbiAgICAgICAgICAgIGx0ZShzY2hlbWEuaW52aXRhdGlvbnMuZXhwaXJlc0F0LCBuZXcgRGF0ZSgpKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25zJyk7XG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGg7XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBpbnZpdGF0aW9uLlxuICAgKiBAcGFyYW0gaWRcbiAgICovXG4gIGFzeW5jIGRlbGV0ZUludml0YXRpb24oaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ2RlbGV0ZUludml0YXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuZGVsZXRlKHNjaGVtYS5pbnZpdGF0aW9ucykud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCBpZCkpLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdpbnZpdGF0aW9ucycpO1xuICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgfVxuXG4gIC8vIEludml0YXRpb24gQXVkaXQgTG9nIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBpbnZpdGF0aW9uIGF1ZGl0IGxvZ3MuXG4gICAqIEBwYXJhbSBpbnZpdGF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEludml0YXRpb25BdWRpdExvZ3MoaW52aXRhdGlvbklkOiBzdHJpbmcpOiBQcm9taXNlPEludml0YXRpb25BdWRpdExvZ1tdPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0SW52aXRhdGlvbkF1ZGl0TG9ncycsXG4gICAgICBgaW52aXRhdGlvbl9sb2dzOiR7aW52aXRhdGlvbklkfWAsXG4gICAgICAnaW52aXRhdGlvbl9sb2dzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25BdWRpdExvZylcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25BdWRpdExvZy5pbnZpdGF0aW9uSWQsIGludml0YXRpb25JZCkpXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuaW52aXRhdGlvbkF1ZGl0TG9nLmNyZWF0ZWRBdCkpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGludml0YXRpb24gYXVkaXQgbG9nLlxuICAgKiBAcGFyYW0gbG9nRW50cnlcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUludml0YXRpb25BdWRpdExvZyhsb2dFbnRyeTogSW5zZXJ0SW52aXRhdGlvbkF1ZGl0TG9nKTogUHJvbWlzZTxJbnZpdGF0aW9uQXVkaXRMb2c+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVJbnZpdGF0aW9uQXVkaXRMb2cnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGIuaW5zZXJ0KHNjaGVtYS5pbnZpdGF0aW9uQXVkaXRMb2cpLnZhbHVlcyhsb2dFbnRyeSkucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ludml0YXRpb25fbG9ncycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvLyBQZXJtaXNzaW9uIG9wZXJhdGlvbnNcblxuICAvKipcbiAgICogR2V0cyBhbGwgcGVybWlzc2lvbnMuXG4gICAqL1xuICBhc3luYyBnZXRQZXJtaXNzaW9ucygpOiBQcm9taXNlPFBlcm1pc3Npb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXRQZXJtaXNzaW9ucycsICdwZXJtaXNzaW9uczphbGwnLCAncGVybWlzc2lvbnMnLCAoKSA9PlxuICAgICAgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5wZXJtaXNzaW9ucylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5wZXJtaXNzaW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIC5vcmRlckJ5KHNjaGVtYS5wZXJtaXNzaW9ucy5yZXNvdXJjZVR5cGUsIHNjaGVtYS5wZXJtaXNzaW9ucy5hY3Rpb24pXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCByb2xlIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0Um9sZVBlcm1pc3Npb25zKCk6IFByb21pc2U8Um9sZVBlcm1pc3Npb25bXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldFJvbGVQZXJtaXNzaW9ucycsXG4gICAgICAncm9sZV9wZXJtaXNzaW9uczphbGwnLFxuICAgICAgJ3JvbGVfcGVybWlzc2lvbnMnLFxuICAgICAgKCkgPT5cbiAgICAgICAgZGJcbiAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAuZnJvbShzY2hlbWEucm9sZVBlcm1pc3Npb25zKVxuICAgICAgICAgIC5pbm5lckpvaW4oXG4gICAgICAgICAgICBzY2hlbWEucGVybWlzc2lvbnMsXG4gICAgICAgICAgICBlcShzY2hlbWEucm9sZVBlcm1pc3Npb25zLnBlcm1pc3Npb25JZCwgc2NoZW1hLnBlcm1pc3Npb25zLmlkKVxuICAgICAgICAgIClcbiAgICAgICAgICAud2hlcmUoZXEoc2NoZW1hLnBlcm1pc3Npb25zLmlzQWN0aXZlLCB0cnVlKSlcbiAgICAgICAgICAub3JkZXJCeShzY2hlbWEucm9sZVBlcm1pc3Npb25zLnJvbGUsIHNjaGVtYS5wZXJtaXNzaW9ucy5yZXNvdXJjZVR5cGUpXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGFsbCB1c2VyIHBlcm1pc3Npb25zLlxuICAgKi9cbiAgYXN5bmMgZ2V0VXNlclBlcm1pc3Npb25zKCk6IFByb21pc2U8VXNlclBlcm1pc3Npb25bXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS51c2VyUGVybWlzc2lvbnMpXG4gICAgICAgIC5pbm5lckpvaW4oXG4gICAgICAgICAgc2NoZW1hLnBlcm1pc3Npb25zLFxuICAgICAgICAgIGVxKHNjaGVtYS51c2VyUGVybWlzc2lvbnMucGVybWlzc2lvbklkLCBzY2hlbWEucGVybWlzc2lvbnMuaWQpXG4gICAgICAgIClcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5wZXJtaXNzaW9ucy5pc0FjdGl2ZSwgdHJ1ZSkpXG4gICAgICAgIC5vcmRlckJ5KHNjaGVtYS51c2VyUGVybWlzc2lvbnMudXNlcklkKTtcblxuICAgICAgcmV0dXJuIHJlc3VsdHMgfHwgW107XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGdldHRpbmcgdXNlciBwZXJtaXNzaW9uczonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLy8gT2xkIGJ1aWxkaW5nIGRvY3VtZW50IG1ldGhvZHMgcmVtb3ZlZCAtIHVzaW5nIHVuaWZpZWQgZG9jdW1lbnRzIHRhYmxlXG5cbiAgLy8gVW5pZmllZCBEb2N1bWVudCBvcGVyYXRpb25zXG4gIGFzeW5jIGdldERvY3VtZW50cyhmaWx0ZXJzPzoge1xuICAgIGJ1aWxkaW5nSWQ/OiBzdHJpbmc7XG4gICAgcmVzaWRlbmNlSWQ/OiBzdHJpbmc7XG4gICAgZG9jdW1lbnRUeXBlPzogc3RyaW5nO1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICB1c2VyUm9sZT86IHN0cmluZztcbiAgfSk6IFByb21pc2U8RG9jdW1lbnRbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldERvY3VtZW50cycsXG4gICAgICBgZG9jdW1lbnRzOiR7SlNPTi5zdHJpbmdpZnkoZmlsdGVycyl9YCxcbiAgICAgICdkb2N1bWVudHMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcXVlcnkgPSBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kb2N1bWVudHMpO1xuXG4gICAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcbiAgICAgICAgaWYgKGZpbHRlcnM/LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmRvY3VtZW50cy5idWlsZGluZ0lkLCBmaWx0ZXJzLmJ1aWxkaW5nSWQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZmlsdGVycz8ucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmRvY3VtZW50cy5yZXNpZGVuY2VJZCwgZmlsdGVycy5yZXNpZGVuY2VJZCkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWx0ZXJzPy5kb2N1bWVudFR5cGUpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmRvY3VtZW50cy5kb2N1bWVudFR5cGUsIGZpbHRlcnMuZG9jdW1lbnRUeXBlKSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoY29uZGl0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcXVlcnkub3JkZXJCeShkZXNjKHNjaGVtYS5kb2N1bWVudHMuY3JlYXRlZEF0KSk7XG4gICAgICAgIHJldHVybiByZXN1bHQgfHwgW107XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGFzeW5jIGdldERvY3VtZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPERvY3VtZW50IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldERvY3VtZW50JywgYGRvY3VtZW50OiR7aWR9YCwgJ2RvY3VtZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZG9jdW1lbnRzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmRvY3VtZW50cy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgY3JlYXRlRG9jdW1lbnQoZG9jdW1lbnQ6IEluc2VydERvY3VtZW50KTogUHJvbWlzZTxEb2N1bWVudD4ge1xuICAgIHJldHVybiBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVEb2N1bWVudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuaW5zZXJ0KHNjaGVtYS5kb2N1bWVudHMpLnZhbHVlcyhkb2N1bWVudCkucmV0dXJuaW5nKCk7XG4gICAgICBcblxuICAgICAgLy8gSW52YWxpZGF0ZSByZWxhdGVkIGNhY2hlc1xuICAgICAgaWYgKGRvY3VtZW50LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCBgKmJ1aWxkaW5nSWQqJHtkb2N1bWVudC5idWlsZGluZ0lkfSpgKTtcbiAgICAgIH1cbiAgICAgIGlmIChkb2N1bWVudC5yZXNpZGVuY2VJZCkge1xuICAgICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGAqcmVzaWRlbmNlSWQqJHtkb2N1bWVudC5yZXNpZGVuY2VJZH0qYCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyB1cGRhdGVEb2N1bWVudChpZDogc3RyaW5nLCB1cGRhdGVzOiBQYXJ0aWFsPERvY3VtZW50Pik6IFByb21pc2U8RG9jdW1lbnQgfCB1bmRlZmluZWQ+IHtcbiAgICByZXR1cm4gZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgndXBkYXRlRG9jdW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgIC5zZXQoeyAuLi51cGRhdGVzLCB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5kb2N1bWVudHMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICBpZiAocmVzdWx0WzBdKSB7XG4gICAgICAgIC8vIEludmFsaWRhdGUgY2FjaGVzXG4gICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYGRvY3VtZW50OiR7aWR9YCk7XG4gICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgJyonKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZURvY3VtZW50KGlkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlRG9jdW1lbnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZG9jdW1lbnRzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoeyBpZDogc2NoZW1hLmRvY3VtZW50cy5pZCB9KTtcblxuICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIEludmFsaWRhdGUgY2FjaGVzXG4gICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYGRvY3VtZW50OiR7aWR9YCk7XG4gICAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgJyonKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIE9sZCByZXNpZGVudCBkb2N1bWVudCBtZXRob2RzIHJlbW92ZWQgLSB1c2luZyB1bmlmaWVkIGRvY3VtZW50cyB0YWJsZVxuXG4gIC8vIExlZ2FjeSBEb2N1bWVudCBvcGVyYXRpb25zIChrZXB0IGZvciBtaWdyYXRpb24gcHVycG9zZXMpXG5cbiAgLyoqXG4gICAqIEdldHMgbGVnYWN5IGRvY3VtZW50cyBmb3IgdXNlci5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZHNcbiAgICovXG4gIGFzeW5jIGdldERvY3VtZW50c0ZvclVzZXIoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZyxcbiAgICByZXNpZGVuY2VJZHM/OiBzdHJpbmdbXVxuICApOiBQcm9taXNlPERvY3VtZW50W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXREb2N1bWVudHNGb3JVc2VyJyxcbiAgICAgIGBsZWdhY3lfZG9jczoke3VzZXJJZH06JHt1c2VyUm9sZX1gLFxuICAgICAgJ2RvY3VtZW50cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHJldHVybiBhd2FpdCBkYi5zZWxlY3QoKS5mcm9tKHNjaGVtYS5kb2N1bWVudHMpLm9yZGVyQnkoZGVzYyhzY2hlbWEuZG9jdW1lbnRzLmNyZWF0ZWRBdCkpO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvLyBQYXNzd29yZCByZXNldCBvcGVyYXRpb25zXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdG9rZW5cbiAgICovXG4gIGFzeW5jIGNyZWF0ZVBhc3N3b3JkUmVzZXRUb2tlbih0b2tlbjogSW5zZXJ0UGFzc3dvcmRSZXNldFRva2VuKTogUHJvbWlzZTxQYXNzd29yZFJlc2V0VG9rZW4+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5pbnNlcnQoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMpLnZhbHVlcyh0b2tlbikucmV0dXJuaW5nKCk7XG5cbiAgICAvLyBUb2tlbiBjcmVhdGVkIHN1Y2Nlc3NmdWxseVxuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdG9rZW5WYWx1ZVxuICAgKi9cbiAgYXN5bmMgZ2V0UGFzc3dvcmRSZXNldFRva2VuKHRva2VuVmFsdWU6IHN0cmluZyk6IFByb21pc2U8UGFzc3dvcmRSZXNldFRva2VuIHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoXG4gICAgICAnZ2V0UGFzc3dvcmRSZXNldFRva2VuJyxcbiAgICAgIGB0b2tlbl8ke3Rva2VuVmFsdWV9YCxcbiAgICAgICdwYXNzd29yZF9yZXNldF90b2tlbnMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zKVxuICAgICAgICAgIC53aGVyZShlcShzY2hlbWEucGFzc3dvcmRSZXNldFRva2Vucy50b2tlbiwgdG9rZW5WYWx1ZSkpXG4gICAgICAgICAgLmxpbWl0KDEpO1xuICAgICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHRva2VuSWRcbiAgICovXG4gIGFzeW5jIG1hcmtQYXNzd29yZFJlc2V0VG9rZW5Bc1VzZWQodG9rZW5JZDogc3RyaW5nKTogUHJvbWlzZTxQYXNzd29yZFJlc2V0VG9rZW4gfCB1bmRlZmluZWQ+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgLnVwZGF0ZShzY2hlbWEucGFzc3dvcmRSZXNldFRva2VucylcbiAgICAgIC5zZXQoe1xuICAgICAgICBpc1VzZWQ6IHRydWUsXG4gICAgICAgIHVzZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLnBhc3N3b3JkUmVzZXRUb2tlbnMuaWQsIHRva2VuSWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gVG9rZW4gbWFya2VkIGFzIHVzZWRcblxuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICpcbiAgICovXG4gIGFzeW5jIGNsZWFudXBFeHBpcmVkUGFzc3dvcmRSZXNldFRva2VucygpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuZGVsZXRlKHNjaGVtYS5wYXNzd29yZFJlc2V0VG9rZW5zKVxuICAgICAgLndoZXJlKGx0ZShzY2hlbWEucGFzc3dvcmRSZXNldFRva2Vucy5leHBpcmVzQXQsIG5ldyBEYXRlKCkpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gRXhwaXJlZCB0b2tlbnMgY2xlYW5lZCB1cFxuXG4gICAgcmV0dXJuIHJlc3VsdC5sZW5ndGg7XG4gIH1cblxuICAvLyBDb250YWN0IG9wZXJhdGlvbnNcbiAgLyoqXG4gICAqIEdldHMgYWxsIGNvbnRhY3RzLlxuICAgKi9cbiAgYXN5bmMgZ2V0Q29udGFjdHMoKTogUHJvbWlzZTxDb250YWN0W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucygnZ2V0Q29udGFjdHMnLCAnYWxsX2NvbnRhY3RzJywgJ2NvbnRhY3RzJywgKCkgPT5cbiAgICAgIGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmNvbnRhY3RzKS53aGVyZShlcShzY2hlbWEuY29udGFjdHMuaXNBY3RpdmUsIHRydWUpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBjb250YWN0cyBieSBlbnRpdHkuXG4gICAqIEBwYXJhbSBlbnRpdHlJZFxuICAgKiBAcGFyYW0gZW50aXR5XG4gICAqL1xuICBhc3luYyBnZXRDb250YWN0c0J5RW50aXR5KFxuICAgIGVudGl0eUlkOiBzdHJpbmcsXG4gICAgZW50aXR5OiAnb3JnYW5pemF0aW9uJyB8ICdidWlsZGluZycgfCAncmVzaWRlbmNlJ1xuICApOiBQcm9taXNlPENvbnRhY3RbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldENvbnRhY3RzQnlFbnRpdHknLFxuICAgICAgYGNvbnRhY3RzX2VudGl0eToke2VudGl0eX1fJHtlbnRpdHlJZH1gLFxuICAgICAgJ2NvbnRhY3RzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmNvbnRhY3RzKVxuICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgZXEoc2NoZW1hLmNvbnRhY3RzLmVudGl0eUlkLCBlbnRpdHlJZCksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5lbnRpdHksIGVudGl0eSksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNvbnRhY3RzIGZvciByZXNpZGVuY2Ugd2l0aCB1c2VyIGRhdGEuXG4gICAqIEBwYXJhbSByZXNpZGVuY2VJZFxuICAgKi9cbiAgYXN5bmMgZ2V0Q29udGFjdHNGb3JSZXNpZGVuY2UocmVzaWRlbmNlSWQ6IHN0cmluZyk6IFByb21pc2U8QXJyYXk8Q29udGFjdCAmIHsgdXNlcjogVXNlciB9Pj4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldENvbnRhY3RzRm9yUmVzaWRlbmNlJyxcbiAgICAgIGBjb250YWN0c19yZXNpZGVuY2U6JHtyZXNpZGVuY2VJZH1gLFxuICAgICAgJ2NvbnRhY3RzJyxcbiAgICAgICgpID0+XG4gICAgICAgIGRiXG4gICAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgICAgLmZyb20oc2NoZW1hLmNvbnRhY3RzKVxuICAgICAgICAgIC5pbm5lckpvaW4oc2NoZW1hLnVzZXJzLCBlcShzY2hlbWEuY29udGFjdHMubmFtZSwgc2NoZW1hLnVzZXJzLmVtYWlsKSlcbiAgICAgICAgICAud2hlcmUoXG4gICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5lbnRpdHlJZCwgcmVzaWRlbmNlSWQpLFxuICAgICAgICAgICAgICBlcShzY2hlbWEuY29udGFjdHMuZW50aXR5LCAncmVzaWRlbmNlJyksXG4gICAgICAgICAgICAgIGVxKHNjaGVtYS5jb250YWN0cy5pc0FjdGl2ZSwgdHJ1ZSlcbiAgICAgICAgICAgIClcbiAgICAgICAgICApXG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgbmV3IGNvbnRhY3QuXG4gICAqIEBwYXJhbSBjb250YWN0XG4gICAqL1xuICBhc3luYyBjcmVhdGVDb250YWN0KGNvbnRhY3Q6IEluc2VydENvbnRhY3QpOiBQcm9taXNlPENvbnRhY3Q+IHtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCdjcmVhdGVDb250YWN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgcmV0dXJuIGRiLmluc2VydChzY2hlbWEuY29udGFjdHMpLnZhbHVlcyhjb250YWN0KS5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnY29udGFjdHMnKTtcbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSBjb250YWN0LlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIHVwZGF0ZUNvbnRhY3QoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxDb250YWN0Pik6IFByb21pc2U8Q29udGFjdCB8IHVuZGVmaW5lZD4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiUGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrUXVlcnkoJ3VwZGF0ZUNvbnRhY3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuY29udGFjdHMpXG4gICAgICAgIC5zZXQodXBkYXRlcyBhcyBhbnkpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuY29udGFjdHMuaWQsIGlkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgIH0pO1xuXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdjb250YWN0cycpO1xuICAgIHJldHVybiByZXN1bHRbMF07XG4gIH1cblxuICAvKipcbiAgICogRGVsZXRlcyBhIGNvbnRhY3QuXG4gICAqIEBwYXJhbSBpZFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQ29udGFjdChpZDogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnZGVsZXRlQ29udGFjdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5jb250YWN0cylcbiAgICAgICAgLnNldCh7IGlzQWN0aXZlOiBmYWxzZSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmNvbnRhY3RzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICB9KTtcblxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnY29udGFjdHMnKTtcbiAgICByZXR1cm4gcmVzdWx0Lmxlbmd0aCA+IDA7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBkZW1hbmRzIGZvciBhIHVzZXIuXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICovXG4gIGFzeW5jIGdldERlbWFuZHNGb3JVc2VyKHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxhbnlbXT4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKCdnZXREZW1hbmRzRm9yVXNlcicsIGBkZW1hbmRzX3VzZXI6JHt1c2VySWR9YCwgJ2RlbWFuZHMnLCAoKSA9PlxuICAgICAgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuZGVtYW5kcykud2hlcmUoZXEoc2NoZW1hLmRlbWFuZHMudXNlcklkLCB1c2VySWQpKVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyBhIHNwZWNpZmljIGRlbWFuZC5cbiAgICogQHBhcmFtIGlkXG4gICAqL1xuICBhc3luYyBnZXREZW1hbmQoaWQ6IHN0cmluZyk6IFByb21pc2U8YW55IHwgdW5kZWZpbmVkPiB7XG4gICAgcmV0dXJuIHRoaXMud2l0aE9wdGltaXphdGlvbnMoJ2dldERlbWFuZCcsIGBkZW1hbmQ6JHtpZH1gLCAnZGVtYW5kcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmRlbWFuZHMpLndoZXJlKGVxKHNjaGVtYS5kZW1hbmRzLmlkLCBpZCkpO1xuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9KTtcbiAgfVxuXG4gIC8vIEJ1ZyBvcGVyYXRpb25zIGltcGxlbWVudGF0aW9uXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEJ1Z3NGb3JVc2VyKHVzZXJJZDogc3RyaW5nLCB1c2VyUm9sZTogc3RyaW5nLCBvcmdhbml6YXRpb25JZD86IHN0cmluZyk6IFByb21pc2U8QnVnW10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRCdWdzRm9yVXNlcicsXG4gICAgICBgYnVnczoke3VzZXJSb2xlfToke3VzZXJJZH1gLFxuICAgICAgJ2J1Z3MnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBsZXQgcmVzdWx0cztcbiAgICAgICAgXG4gICAgICAgIGlmICh1c2VyUm9sZSA9PT0gJ2FkbWluJykge1xuICAgICAgICAgIC8vIEFkbWluIGNhbiBzZWUgYWxsIGJ1Z3NcbiAgICAgICAgICByZXN1bHRzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJ1Z3MpXG4gICAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5idWdzLmNyZWF0ZWRBdCkpO1xuICAgICAgICB9IGVsc2UgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicgJiYgb3JnYW5pemF0aW9uSWQpIHtcbiAgICAgICAgICAvLyBGb3IgbWFuYWdlcnMsIHJldHVybiBhbGwgYnVncyBmb3Igbm93IChjYW4gYmUgcmVmaW5lZCBsYXRlcilcbiAgICAgICAgICByZXN1bHRzID0gYXdhaXQgZGJcbiAgICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgICAgLmZyb20oc2NoZW1hLmJ1Z3MpXG4gICAgICAgICAgICAub3JkZXJCeShkZXNjKHNjaGVtYS5idWdzLmNyZWF0ZWRBdCkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZvciByZXNpZGVudHMgYW5kIHRlbmFudHMsIHJldHVybiBvbmx5IHRoZWlyIG93biBidWdzXG4gICAgICAgICAgcmVzdWx0cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5idWdzKVxuICAgICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5idWdzLmNyZWF0ZWRCeSwgdXNlcklkKSlcbiAgICAgICAgICAgIC5vcmRlckJ5KGRlc2Moc2NoZW1hLmJ1Z3MuY3JlYXRlZEF0KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBHZXQgYXR0YWNobWVudCBjb3VudHMgYW5kIGRldGFpbHMgZm9yIGVhY2ggYnVnXG4gICAgICAgIGNvbnN0IGJ1Z3NXaXRoQXR0YWNobWVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICByZXN1bHRzLm1hcChhc3luYyAoYnVnKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhdHRhY2htZW50cyA9IGF3YWl0IGRiXG4gICAgICAgICAgICAgIC5zZWxlY3Qoe1xuICAgICAgICAgICAgICAgIGlkOiBzY2hlbWEuZG9jdW1lbnRzLmlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IHNjaGVtYS5kb2N1bWVudHMubmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlTmFtZTogc2NoZW1hLmRvY3VtZW50cy5maWxlTmFtZSxcbiAgICAgICAgICAgICAgICBmaWxlU2l6ZTogc2NoZW1hLmRvY3VtZW50cy5maWxlU2l6ZSxcbiAgICAgICAgICAgICAgICBmaWxlUGF0aDogc2NoZW1hLmRvY3VtZW50cy5maWxlUGF0aCxcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgLmZyb20oc2NoZW1hLmRvY3VtZW50cylcbiAgICAgICAgICAgICAgLndoZXJlKFxuICAgICAgICAgICAgICAgIGFuZChcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb1R5cGUsICdidWcnKSxcbiAgICAgICAgICAgICAgICAgIGVxKHNjaGVtYS5kb2N1bWVudHMuYXR0YWNoZWRUb0lkLCBidWcuaWQpXG4gICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAuLi5idWcsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRDb3VudDogYXR0YWNobWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgICBhdHRhY2htZW50czogYXR0YWNobWVudHMubWFwKGF0dCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBhdHQuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogYXR0LmZpbGVOYW1lIHx8IGF0dC5uYW1lLFxuICAgICAgICAgICAgICAgIHNpemU6IHBhcnNlSW50KGF0dC5maWxlU2l6ZSB8fCAnMCcpLFxuICAgICAgICAgICAgICAgIHVybDogYC9hcGkvZG9jdW1lbnRzLyR7YXR0LmlkfS9maWxlYCxcbiAgICAgICAgICAgICAgICB0eXBlOiBhdHQuZmlsZU5hbWUgPyBhdHQuZmlsZU5hbWUuc3BsaXQoJy4nKS5wb3AoKT8udG9Mb3dlckNhc2UoKSB8fCAndW5rbm93bicgOiAndW5rbm93bidcbiAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pXG4gICAgICAgICk7XG5cbiAgICAgICAgcmV0dXJuIGJ1Z3NXaXRoQXR0YWNobWVudHM7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRCdWcoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nLFxuICAgIG9yZ2FuaXphdGlvbklkPzogc3RyaW5nXG4gICk6IFByb21pc2U8QnVnIHwgdW5kZWZpbmVkPiB7XG4gICAgY29uc3Qga2V5ID0gYGJ1Zzoke2lkfTp1c2VyOiR7dXNlcklkfToke3VzZXJSb2xlfWA7XG5cbiAgICBjb25zb2xlLmxvZyhg8J+UjSBnZXRCdWcgY2FsbGVkIHdpdGgga2V5OiAke2tleX1gKTtcblxuICAgIHJldHVybiB3aXRoQ2FjaGUoJ2J1ZycsIGtleSwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogQ2FjaGUgbWlzcyBmb3IgJHtrZXl9LCBxdWVyeWluZyBkYXRhYmFzZS4uLmApO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICAgIGNvbnN0IGJ1ZyA9IHJlc3VsdFswXTtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OLIERhdGFiYXNlIHF1ZXJ5IHJlc3VsdDpgLCBidWcgPyB7IGlkOiBidWcuaWQsIHRpdGxlOiBidWcudGl0bGUsIGZpbGVQYXRoOiBidWcuZmlsZVBhdGgsIGZpbGVfcGF0aDogKGJ1ZyBhcyBhbnkpLmZpbGVfcGF0aCB9IDogJ3VuZGVmaW5lZCcpO1xuXG4gICAgICBpZiAoIWJ1Zykge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuXG4gICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZztcbiAgICAgIH1cblxuICAgICAgaWYgKHVzZXJSb2xlID09PSAnbWFuYWdlcicpIHtcbiAgICAgICAgcmV0dXJuIGJ1ZzsgLy8gTWFuYWdlcnMgY2FuIHNlZSBhbGwgYnVncyBmb3Igbm93XG4gICAgICB9XG5cbiAgICAgIC8vIFJlc2lkZW50cyBhbmQgdGVuYW50cyBjYW4gb25seSBzZWUgdGhlaXIgb3duIGJ1Z3NcbiAgICAgIHJldHVybiBidWcuY3JlYXRlZEJ5ID09PSB1c2VySWQgPyBidWcgOiB1bmRlZmluZWQ7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIGJ1Z0RhdGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUJ1ZyhidWdEYXRhOiBJbnNlcnRCdWcpOiBQcm9taXNlPEJ1Zz4ge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuaW5zZXJ0KHNjaGVtYS5idWdzKVxuICAgICAgLnZhbHVlcyh7XG4gICAgICAgIC4uLmJ1Z0RhdGEsXG4gICAgICAgIGlkOiBjcnlwdG8ucmFuZG9tVVVJRCgpLFxuICAgICAgICBzdGF0dXM6ICduZXcnLFxuICAgICAgICBhc3NpZ25lZFRvOiBudWxsLFxuICAgICAgICByZXNvbHZlZEF0OiBudWxsLFxuICAgICAgICByZXNvbHZlZEJ5OiBudWxsLFxuICAgICAgICBub3RlczogbnVsbCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICB9KVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgLy8gSW52YWxpZGF0ZSBjYWNoZSBmb3IgdGhpcyB1c2VyIGFuZCBzcGVjaWZpYyBidWcgcXVlcmllcyAgXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWdzJyk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWcnLCBgYnVnOiR7cmVzdWx0WzBdLmlkfToqYCk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlQnVnKFxuICAgIGlkOiBzdHJpbmcsXG4gICAgdXBkYXRlczogUGFydGlhbDxCdWc+LFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJSb2xlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxCdWcgfCB1bmRlZmluZWQ+IHtcbiAgICAvLyBGaXJzdCBjaGVjayBpZiB0aGUgYnVnIGV4aXN0cyBhbmQgZ2V0IGl0cyBjdXJyZW50IGRhdGFcbiAgICBjb25zdCBbZXhpc3RpbmdCdWddID0gYXdhaXQgZGIuc2VsZWN0KCkuZnJvbShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSk7XG5cbiAgICBpZiAoIWV4aXN0aW5nQnVnKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIEFjY2VzcyBjb250cm9sOiB1c2VycyBjYW4gZWRpdCB0aGVpciBvd24gYnVncywgYWRtaW5zIGFuZCBtYW5hZ2VycyBjYW4gZWRpdCBhbnkgYnVnXG4gICAgY29uc3QgY2FuRWRpdCA9XG4gICAgICB1c2VyUm9sZSA9PT0gJ2FkbWluJyB8fCB1c2VyUm9sZSA9PT0gJ21hbmFnZXInIHx8IGV4aXN0aW5nQnVnLmNyZWF0ZWRCeSA9PT0gdXNlcklkO1xuXG4gICAgaWYgKCFjYW5FZGl0KSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAudXBkYXRlKHNjaGVtYS5idWdzKVxuICAgICAgLnNldCh7XG4gICAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgIH0pXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSlcbiAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgIGlmIChyZXN1bHRbMF0pIHtcbiAgICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1Z3MnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgZGVsZXRlQnVnKGlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nLCB1c2VyUm9sZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gRmlyc3QgY2hlY2sgaWYgdGhlIGJ1ZyBleGlzdHMgYW5kIGdldCBpdHMgY3VycmVudCBkYXRhXG4gICAgY29uc3QgW2V4aXN0aW5nQnVnXSA9IGF3YWl0IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmJ1Z3MpLndoZXJlKGVxKHNjaGVtYS5idWdzLmlkLCBpZCkpO1xuXG4gICAgaWYgKCFleGlzdGluZ0J1Zykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFjY2VzcyBjb250cm9sOiB1c2VycyBjYW4gZGVsZXRlIHRoZWlyIG93biBidWdzLCBhZG1pbnMgY2FuIGRlbGV0ZSBhbnkgYnVnXG4gICAgY29uc3QgY2FuRGVsZXRlID0gdXNlclJvbGUgPT09ICdhZG1pbicgfHwgZXhpc3RpbmdCdWcuY3JlYXRlZEJ5ID09PSB1c2VySWQ7XG5cbiAgICBpZiAoIWNhbkRlbGV0ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmRlbGV0ZShzY2hlbWEuYnVncykud2hlcmUoZXEoc2NoZW1hLmJ1Z3MuaWQsIGlkKSkucmV0dXJuaW5nKCk7XG5cbiAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIEludmFsaWRhdGUgcmVsYXRlZCBjYWNoZSBlbnRyaWVzXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1Z3MnKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIEZlYXR1cmUgUmVxdWVzdCBvcGVyYXRpb25zIHdpdGggb3B0aW1pemF0aW9uXG5cbiAgLyoqXG4gICAqIFJldHJpZXZlcyBmZWF0dXJlIHJlcXVlc3RzIGZvciBhIHVzZXIgd2l0aCByb2xlLWJhc2VkIGFjY2VzcyBjb250cm9sLlxuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKiBAcGFyYW0gb3JnYW5pemF0aW9uSWRcbiAgICovXG4gIGFzeW5jIGdldEZlYXR1cmVSZXF1ZXN0c0ZvclVzZXIoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgdXNlclJvbGU6IHN0cmluZyxcbiAgICBvcmdhbml6YXRpb25JZD86IHN0cmluZ1xuICApOiBQcm9taXNlPEZlYXR1cmVSZXF1ZXN0W10+IHtcbiAgICByZXR1cm4gdGhpcy53aXRoT3B0aW1pemF0aW9ucyhcbiAgICAgICdnZXRGZWF0dXJlUmVxdWVzdHNGb3JVc2VyJyxcbiAgICAgIGBmZWF0dXJlX3JlcXVlc3RzOiR7dXNlclJvbGV9OiR7dXNlcklkfWAsXG4gICAgICAnZmVhdHVyZV9yZXF1ZXN0cycsXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgICAgLm9yZGVyQnkoZGVzYyhzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmNyZWF0ZWRBdCkpO1xuXG4gICAgICAgIC8vIEdldCBhdHRhY2htZW50IGNvdW50cyBhbmQgZGV0YWlscyBmb3IgZWFjaCBmZWF0dXJlIHJlcXVlc3RcbiAgICAgICAgY29uc3QgcmVxdWVzdHNXaXRoQXR0YWNobWVudHMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgICAgICByZXN1bHRzLm1hcChhc3luYyAocmVxdWVzdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYXR0YWNobWVudHMgPSBhd2FpdCBkYlxuICAgICAgICAgICAgICAuc2VsZWN0KHtcbiAgICAgICAgICAgICAgICBpZDogc2NoZW1hLmRvY3VtZW50cy5pZCxcbiAgICAgICAgICAgICAgICBuYW1lOiBzY2hlbWEuZG9jdW1lbnRzLm5hbWUsXG4gICAgICAgICAgICAgICAgZmlsZVBhdGg6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVBhdGgsXG4gICAgICAgICAgICAgICAgZmlsZVNpemU6IHNjaGVtYS5kb2N1bWVudHMuZmlsZVNpemUsXG4gICAgICAgICAgICAgICAgbWltZVR5cGU6IHNjaGVtYS5kb2N1bWVudHMubWltZVR5cGUsXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5mcm9tKHNjaGVtYS5kb2N1bWVudHMpXG4gICAgICAgICAgICAgIC53aGVyZShcbiAgICAgICAgICAgICAgICBhbmQoXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9UeXBlLCAnZmVhdHVyZV9yZXF1ZXN0JyksXG4gICAgICAgICAgICAgICAgICBlcShzY2hlbWEuZG9jdW1lbnRzLmF0dGFjaGVkVG9JZCwgcmVxdWVzdC5pZClcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgIC4uLnJlcXVlc3QsXG4gICAgICAgICAgICAgIGF0dGFjaG1lbnRDb3VudDogYXR0YWNobWVudHMubGVuZ3RoLFxuICAgICAgICAgICAgICBhdHRhY2htZW50czogYXR0YWNobWVudHMubWFwKGF0dCA9PiAoe1xuICAgICAgICAgICAgICAgIGlkOiBhdHQuaWQsXG4gICAgICAgICAgICAgICAgbmFtZTogYXR0Lm5hbWUsXG4gICAgICAgICAgICAgICAgdXJsOiBgL2FwaS9kb2N1bWVudHMvJHthdHQuaWR9L2ZpbGVgLFxuICAgICAgICAgICAgICAgIHNpemU6IGF0dC5maWxlU2l6ZSA/IHBhcnNlSW50KGF0dC5maWxlU2l6ZSkgOiAwLFxuICAgICAgICAgICAgICAgIG1pbWVUeXBlOiBhdHQubWltZVR5cGUsXG4gICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcblxuICAgICAgICAvLyBBbGwgdXNlcnMgY2FuIHNlZSBhbGwgZmVhdHVyZSByZXF1ZXN0cywgYnV0IG5vbi1hZG1pbnMgZG9uJ3Qgc2VlIHdobyBzdWJtaXR0ZWRcbiAgICAgICAgaWYgKHVzZXJSb2xlID09PSAnYWRtaW4nKSB7XG4gICAgICAgICAgcmV0dXJuIHJlcXVlc3RzV2l0aEF0dGFjaG1lbnRzO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRm9yIG5vbi1hZG1pbiB1c2VycywgaGlkZSB0aGUgY3JlYXRlZEJ5IGZpZWxkXG4gICAgICAgIHJldHVybiByZXF1ZXN0c1dpdGhBdHRhY2htZW50cy5tYXAoKHJlcXVlc3QpID0+ICh7XG4gICAgICAgICAgLi4ucmVxdWVzdCxcbiAgICAgICAgICBjcmVhdGVkQnk6IG51bGwgYXMgYW55LFxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXRyaWV2ZXMgYSBzcGVjaWZpYyBmZWF0dXJlIHJlcXVlc3QgYnkgSUQgd2l0aCByb2xlLWJhc2VkIGFjY2VzcyBjb250cm9sLlxuICAgKiBAcGFyYW0gaWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKiBAcGFyYW0gdXNlclJvbGVcbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBhc3luYyBnZXRGZWF0dXJlUmVxdWVzdChcbiAgICBpZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIHVzZXJSb2xlOiBzdHJpbmcsXG4gICAgb3JnYW5pemF0aW9uSWQ/OiBzdHJpbmdcbiAgKTogUHJvbWlzZTxGZWF0dXJlUmVxdWVzdCB8IHVuZGVmaW5lZD4ge1xuICAgIHJldHVybiB0aGlzLndpdGhPcHRpbWl6YXRpb25zKFxuICAgICAgJ2dldEZlYXR1cmVSZXF1ZXN0JyxcbiAgICAgIGBmZWF0dXJlX3JlcXVlc3Q6JHtpZH06JHt1c2VyUm9sZX1gLFxuICAgICAgJ2ZlYXR1cmVfcmVxdWVzdHMnLFxuICAgICAgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGlkKSk7XG5cbiAgICAgICAgY29uc3QgZmVhdHVyZVJlcXVlc3QgPSByZXN1bHRbMF07XG4gICAgICAgIGlmICghZmVhdHVyZVJlcXVlc3QpIHtcbiAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQWxsIHVzZXJzIGNhbiBzZWUgYW55IGZlYXR1cmUgcmVxdWVzdFxuICAgICAgICBpZiAodXNlclJvbGUgPT09ICdhZG1pbicpIHtcbiAgICAgICAgICByZXR1cm4gZmVhdHVyZVJlcXVlc3Q7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBGb3Igbm9uLWFkbWluIHVzZXJzLCBoaWRlIHRoZSBjcmVhdGVkQnkgZmllbGRcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAuLi5mZWF0dXJlUmVxdWVzdCxcbiAgICAgICAgICBjcmVhdGVkQnk6IG51bGwgYXMgYW55LFxuICAgICAgICB9O1xuICAgICAgfVxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlcyBhIG5ldyBmZWF0dXJlIHJlcXVlc3QuXG4gICAqIEBwYXJhbSBmZWF0dXJlUmVxdWVzdERhdGFcbiAgICovXG4gIGFzeW5jIGNyZWF0ZUZlYXR1cmVSZXF1ZXN0KGZlYXR1cmVSZXF1ZXN0RGF0YTogSW5zZXJ0RmVhdHVyZVJlcXVlc3QpOiBQcm9taXNlPEZlYXR1cmVSZXF1ZXN0PiB7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJQZXJmb3JtYW5jZU1vbml0b3IudHJhY2tRdWVyeSgnY3JlYXRlRmVhdHVyZVJlcXVlc3QnLCBhc3luYyAoKSA9PiB7XG4gICAgICByZXR1cm4gZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAudmFsdWVzKHtcbiAgICAgICAgICAuLi5mZWF0dXJlUmVxdWVzdERhdGEsXG4gICAgICAgICAgaWQ6IGNyeXB0by5yYW5kb21VVUlEKCksXG4gICAgICAgICAgc3RhdHVzOiAnc3VibWl0dGVkJyxcbiAgICAgICAgICB1cHZvdGVDb3VudDogMCxcbiAgICAgICAgICBhc3NpZ25lZFRvOiBudWxsLFxuICAgICAgICAgIHJldmlld2VkQnk6IG51bGwsXG4gICAgICAgICAgcmV2aWV3ZWRBdDogbnVsbCxcbiAgICAgICAgICBhZG1pbk5vdGVzOiBudWxsLFxuICAgICAgICAgIG1lcmdlZEludG9JZDogbnVsbCxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG5cbiAgICByZXR1cm4gcmVzdWx0WzBdO1xuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZXMgYSBmZWF0dXJlIHJlcXVlc3Qgd2l0aCByb2xlLWJhc2VkIHBlcm1pc3Npb25zLlxuICAgKiBVc2VycyBjYW4gZWRpdCB0aGVpciBvd24sIG1hbmFnZXJzIGNhbiBlZGl0IHdpdGhpbiBvcmcsIGFkbWlucyBjYW4gZWRpdCBhbGwuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcGFyYW0gdXBkYXRlc1xuICAgKiBAcGFyYW0gdXNlcklkXG4gICAqIEBwYXJhbSB1c2VyUm9sZVxuICAgKi9cbiAgYXN5bmMgdXBkYXRlRmVhdHVyZVJlcXVlc3QoXG4gICAgaWQ6IHN0cmluZyxcbiAgICB1cGRhdGVzOiBQYXJ0aWFsPEZlYXR1cmVSZXF1ZXN0PixcbiAgICB1c2VySWQ6IHN0cmluZyxcbiAgICB1c2VyUm9sZTogc3RyaW5nXG4gICk6IFByb21pc2U8RmVhdHVyZVJlcXVlc3QgfCB1bmRlZmluZWQ+IHtcbiAgICAvLyBHZXQgZXhpc3RpbmcgZmVhdHVyZSByZXF1ZXN0IHRvIGNoZWNrIHBlcm1pc3Npb25zXG4gICAgY29uc3QgZXhpc3RpbmdGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAuc2VsZWN0KClcbiAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgLmxpbWl0KDEpO1xuXG4gICAgaWYgKCFleGlzdGluZ0ZlYXR1cmVSZXF1ZXN0WzBdKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIC8vIENoZWNrIHBlcm1pc3Npb25zOiB1c2VycyBjYW4gZWRpdCB0aGVpciBvd24sIGFkbWlucyBjYW4gZWRpdCBhbGxcbiAgICBjb25zdCBjYW5FZGl0ID0gdXNlclJvbGUgPT09ICdhZG1pbicgfHwgZXhpc3RpbmdGZWF0dXJlUmVxdWVzdFswXS5jcmVhdGVkQnkgPT09IHVzZXJJZDtcblxuICAgIGlmICghY2FuRWRpdCkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlBlcmZvcm1hbmNlTW9uaXRvci50cmFja1F1ZXJ5KCd1cGRhdGVGZWF0dXJlUmVxdWVzdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIHJldHVybiBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC5zZXQoe1xuICAgICAgICAgIC4uLnVwZGF0ZXMsXG4gICAgICAgICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgICB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgfSk7XG5cbiAgICBpZiAocmVzdWx0WzBdKSB7XG4gICAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGUgZW50cmllc1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGVzIGEgZmVhdHVyZSByZXF1ZXN0IChhZG1pbiBvbmx5KS5cbiAgICogQHBhcmFtIGlkXG4gICAqIEBwYXJhbSB1c2VySWRcbiAgICogQHBhcmFtIHVzZXJSb2xlXG4gICAqL1xuICBhc3luYyBkZWxldGVGZWF0dXJlUmVxdWVzdChpZDogc3RyaW5nLCB1c2VySWQ6IHN0cmluZywgdXNlclJvbGU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIE9ubHkgYWRtaW5zIGNhbiBkZWxldGUgZmVhdHVyZSByZXF1ZXN0c1xuICAgIGlmICh1c2VyUm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEZpcnN0IGRlbGV0ZSBhbGwgdXB2b3RlcyBmb3IgdGhpcyBmZWF0dXJlIHJlcXVlc3RcbiAgICBhd2FpdCBkYlxuICAgICAgLmRlbGV0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzKVxuICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgaWQpKTtcblxuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAuZGVsZXRlKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgaWQpKVxuICAgICAgLnJldHVybmluZygpO1xuXG4gICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwKSB7XG4gICAgICAvLyBJbnZhbGlkYXRlIHJlbGF0ZWQgY2FjaGUgZW50cmllc1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RzJyk7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdF91cHZvdGVzJyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogVXB2b3RlcyBhIGZlYXR1cmUgcmVxdWVzdC5cbiAgICogQHBhcmFtIHVwdm90ZURhdGFcbiAgICovXG4gIGFzeW5jIHVwdm90ZUZlYXR1cmVSZXF1ZXN0KFxuICAgIHVwdm90ZURhdGE6IEluc2VydEZlYXR1cmVSZXF1ZXN0VXB2b3RlXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IGRhdGE/OiBhbnkgfT4ge1xuICAgIGNvbnN0IHsgZmVhdHVyZVJlcXVlc3RJZCwgdXNlcklkIH0gPSB1cHZvdGVEYXRhO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIGZlYXR1cmUgcmVxdWVzdCBleGlzdHNcbiAgICAgIGNvbnN0IGZlYXR1cmVSZXF1ZXN0UmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmlkLCBmZWF0dXJlUmVxdWVzdElkKSk7XG5cbiAgICAgIGlmIChmZWF0dXJlUmVxdWVzdFJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnRmVhdHVyZSByZXF1ZXN0IG5vdCBmb3VuZCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGFscmVhZHkgdXB2b3RlZCB0aGlzIGZlYXR1cmUgcmVxdWVzdFxuICAgICAgY29uc3QgZXhpc3RpbmdVcHZvdGUgPSBhd2FpdCBkYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgZmVhdHVyZVJlcXVlc3RJZCksXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICAgIClcbiAgICAgICAgKTtcblxuICAgICAgaWYgKGV4aXN0aW5nVXB2b3RlLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnWW91IGhhdmUgYWxyZWFkeSB1cHZvdGVkIHRoaXMgZmVhdHVyZSByZXF1ZXN0JyxcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIHRoZSB1cHZvdGVcbiAgICAgIGNvbnN0IHVwdm90ZVJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5pbnNlcnQoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLnZhbHVlcyh7XG4gICAgICAgICAgLi4udXB2b3RlRGF0YSxcbiAgICAgICAgICBpZDogY3J5cHRvLnJhbmRvbVVVSUQoKSxcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcblxuICAgICAgLy8gVXBkYXRlIHRoZSB1cHZvdGUgY291bnQgb24gdGhlIGZlYXR1cmUgcmVxdWVzdFxuICAgICAgY29uc3QgdXBkYXRlZEZlYXR1cmVSZXF1ZXN0ID0gYXdhaXQgZGJcbiAgICAgICAgLnVwZGF0ZShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAuc2V0KHtcbiAgICAgICAgICB1cHZvdGVDb3VudDogc3FsYCR7c2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy51cHZvdGVDb3VudH0gKyAxYCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCksXG4gICAgICAgIH0pXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzLmlkLCBmZWF0dXJlUmVxdWVzdElkKSlcbiAgICAgICAgLnJldHVybmluZygpO1xuXG4gICAgICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2ZlYXR1cmVfcmVxdWVzdHMnKTtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0X3Vwdm90ZXMnKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0ZlYXR1cmUgcmVxdWVzdCB1cHZvdGVkIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICB1cHZvdGU6IHVwdm90ZVJlc3VsdFswXSxcbiAgICAgICAgICBmZWF0dXJlUmVxdWVzdDogdXBkYXRlZEZlYXR1cmVSZXF1ZXN0WzBdLFxuICAgICAgICB9LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXB2b3RpbmcgZmVhdHVyZSByZXF1ZXN0OicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHVwdm90ZSBmZWF0dXJlIHJlcXVlc3QnLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbiB1cHZvdGUgZnJvbSBhIGZlYXR1cmUgcmVxdWVzdC5cbiAgICogQHBhcmFtIGZlYXR1cmVSZXF1ZXN0SWRcbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgYXN5bmMgcmVtb3ZlRmVhdHVyZVJlcXVlc3RVcHZvdGUoXG4gICAgZmVhdHVyZVJlcXVlc3RJZDogc3RyaW5nLFxuICAgIHVzZXJJZDogc3RyaW5nXG4gICk6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBtZXNzYWdlOiBzdHJpbmc7IGRhdGE/OiBhbnkgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBmZWF0dXJlIHJlcXVlc3QgZXhpc3RzXG4gICAgICBjb25zdCBmZWF0dXJlUmVxdWVzdFJlc3VsdCA9IGF3YWl0IGRiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuZmVhdHVyZVJlcXVlc3RzKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cy5pZCwgZmVhdHVyZVJlcXVlc3RJZCkpO1xuXG4gICAgICBpZiAoZmVhdHVyZVJlcXVlc3RSZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgbWVzc2FnZTogJ0ZlYXR1cmUgcmVxdWVzdCBub3QgZm91bmQnLFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICAvLyBGaW5kIGFuZCByZW1vdmUgdGhlIHVwdm90ZVxuICAgICAgY29uc3QgcmVtb3ZlZFVwdm90ZSA9IGF3YWl0IGRiXG4gICAgICAgIC5kZWxldGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0VXB2b3RlcylcbiAgICAgICAgLndoZXJlKFxuICAgICAgICAgIGFuZChcbiAgICAgICAgICAgIGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdFVwdm90ZXMuZmVhdHVyZVJlcXVlc3RJZCwgZmVhdHVyZVJlcXVlc3RJZCksXG4gICAgICAgICAgICBlcShzY2hlbWEuZmVhdHVyZVJlcXVlc3RVcHZvdGVzLnVzZXJJZCwgdXNlcklkKVxuICAgICAgICAgIClcbiAgICAgICAgKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIGlmIChyZW1vdmVkVXB2b3RlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICAgIG1lc3NhZ2U6ICdZb3UgaGF2ZSBub3QgdXB2b3RlZCB0aGlzIGZlYXR1cmUgcmVxdWVzdCcsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgdXB2b3RlIGNvdW50IG9uIHRoZSBmZWF0dXJlIHJlcXVlc3RcbiAgICAgIGNvbnN0IHVwZGF0ZWRGZWF0dXJlUmVxdWVzdCA9IGF3YWl0IGRiXG4gICAgICAgIC51cGRhdGUoc2NoZW1hLmZlYXR1cmVSZXF1ZXN0cylcbiAgICAgICAgLnNldCh7XG4gICAgICAgICAgdXB2b3RlQ291bnQ6IHNxbGBHUkVBVEVTVCgwLCAke3NjaGVtYS5mZWF0dXJlUmVxdWVzdHMudXB2b3RlQ291bnR9IC0gMSlgLFxuICAgICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICAgICAgfSlcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5mZWF0dXJlUmVxdWVzdHMuaWQsIGZlYXR1cmVSZXF1ZXN0SWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG5cbiAgICAgIC8vIEludmFsaWRhdGUgY2FjaGVcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmVhdHVyZV9yZXF1ZXN0cycpO1xuICAgICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdmZWF0dXJlX3JlcXVlc3RfdXB2b3RlcycpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnVXB2b3RlIHJlbW92ZWQgc3VjY2Vzc2Z1bGx5JyxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZlYXR1cmVSZXF1ZXN0OiB1cGRhdGVkRmVhdHVyZVJlcXVlc3RbMF0sXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciByZW1vdmluZyBmZWF0dXJlIHJlcXVlc3QgdXB2b3RlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIHJlbW92ZSB1cHZvdGUnLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvLyBJbnZvaWNlIG9wZXJhdGlvbnNcbiAgYXN5bmMgZ2V0SW52b2ljZXMoZmlsdGVycz86IHtcbiAgICBidWlsZGluZ0lkPzogc3RyaW5nO1xuICAgIHJlc2lkZW5jZUlkPzogc3RyaW5nO1xuICAgIHVzZXJJZD86IHN0cmluZztcbiAgICB1c2VyUm9sZT86IHN0cmluZztcbiAgfSk6IFByb21pc2U8SW52b2ljZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxldCBxdWVyeSA9IGRiLnNlbGVjdCgpLmZyb20oc2NoZW1hLmludm9pY2VzKTtcbiAgICAgIGNvbnN0IGNvbmRpdGlvbnMgPSBbXTtcblxuICAgICAgaWYgKGZpbHRlcnMpIHtcbiAgICAgICAgaWYgKGZpbHRlcnMuYnVpbGRpbmdJZCkge1xuICAgICAgICAgIGNvbmRpdGlvbnMucHVzaChlcShzY2hlbWEuaW52b2ljZXMuYnVpbGRpbmdJZCwgZmlsdGVycy5idWlsZGluZ0lkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMucmVzaWRlbmNlSWQpIHtcbiAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmludm9pY2VzLnJlc2lkZW5jZUlkLCBmaWx0ZXJzLnJlc2lkZW5jZUlkKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpbHRlcnMudXNlcklkICYmIGZpbHRlcnMudXNlclJvbGUpIHtcbiAgICAgICAgICAvLyBBcHBseSByb2xlLWJhc2VkIGZpbHRlcmluZ1xuICAgICAgICAgIGlmIChmaWx0ZXJzLnVzZXJSb2xlID09PSAndGVuYW50JyB8fCBmaWx0ZXJzLnVzZXJSb2xlID09PSAncmVzaWRlbnQnKSB7XG4gICAgICAgICAgICBjb25kaXRpb25zLnB1c2goZXEoc2NoZW1hLmludm9pY2VzLmNyZWF0ZWRCeSwgZmlsdGVycy51c2VySWQpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gQWRtaW4gYW5kIG1hbmFnZXIgY2FuIHNlZSBhbGwgaW52b2ljZXMgKGFscmVhZHkgZmlsdGVyZWQgYnkgYnVpbGRpbmcvcmVzaWRlbmNlIGFib3ZlKVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGlmIChjb25kaXRpb25zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcXVlcnkgPSBxdWVyeS53aGVyZShhbmQoLi4uY29uZGl0aW9ucykpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBpbnZvaWNlcyA9IGF3YWl0IHF1ZXJ5Lm9yZGVyQnkoZGVzYyhzY2hlbWEuaW52b2ljZXMuY3JlYXRlZEF0KSk7XG4gICAgICByZXR1cm4gaW52b2ljZXM7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGludm9pY2VzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRJbnZvaWNlKGlkOiBzdHJpbmcpOiBQcm9taXNlPEludm9pY2UgfCB1bmRlZmluZWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5mcm9tKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZvaWNlcy5pZCwgaWQpKVxuICAgICAgICAubGltaXQoMSk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHRbMF07XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIGludm9pY2U6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBjcmVhdGVJbnZvaWNlKGludm9pY2U6IEluc2VydEludm9pY2UpOiBQcm9taXNlPEludm9pY2U+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGJcbiAgICAgICAgLmluc2VydChzY2hlbWEuaW52b2ljZXMpXG4gICAgICAgIC52YWx1ZXMoaW52b2ljZSlcbiAgICAgICAgLnJldHVybmluZygpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0WzBdO1xuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyBpbnZvaWNlOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUludm9pY2UoaWQ6IHN0cmluZywgdXBkYXRlczogUGFydGlhbDxJbnZvaWNlPik6IFByb21pc2U8SW52b2ljZSB8IHVuZGVmaW5lZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAudXBkYXRlKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLnNldCh7IC4uLnVwZGF0ZXMsIHVwZGF0ZWRBdDogbmV3IERhdGUoKSB9KVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludm9pY2VzLmlkLCBpZCkpXG4gICAgICAgIC5yZXR1cm5pbmcoKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdFswXTtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgdXBkYXRpbmcgaW52b2ljZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZUludm9pY2UoaWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYlxuICAgICAgICAuZGVsZXRlKHNjaGVtYS5pbnZvaWNlcylcbiAgICAgICAgLndoZXJlKGVxKHNjaGVtYS5pbnZvaWNlcy5pZCwgaWQpKVxuICAgICAgICAucmV0dXJuaW5nKCk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQubGVuZ3RoID4gMDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZGVsZXRpbmcgaW52b2ljZTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLy8gQWRtaW4tb25seSBtZXRob2QgdG8gY291bnQgb3JwaGFuIHVzZXJzXG4gIGFzeW5jIGNvdW50T3JwaGFuVXNlcnMoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBDT1VOVCBPUlBIQU4gVVNFUlMgU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBDT1VOVF0gVGltZXN0YW1wOicsIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBgXG4gICAgICAgIFNFTEVDVCBDT1VOVCgqKSBhcyB0b3RhbCBcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9vcmdhbml6YXRpb25zIHVvIFxuICAgICAgICAgICAgV0hFUkUgdW8udXNlcl9pZCA9IHUuaWQgQU5EIHVvLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApXG4gICAgICAgICAgQU5EIE5PVCBFWElTVFMgKFxuICAgICAgICAgICAgU0VMRUNUIDEgRlJPTSB1c2VyX3Jlc2lkZW5jZXMgdXIgXG4gICAgICAgICAgICBXSEVSRSB1ci51c2VyX2lkID0gdS5pZCBBTkQgdXIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClcbiAgICAgIGA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTVE9SQUdFIC0gQ09VTlRdIEV4ZWN1dGluZyBTUUwgcXVlcnk6JywgY291bnRRdWVyeS50cmltKCkpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UXSBTdGFydGluZyBkYXRhYmFzZSBleGVjdXRpb24uLi4nKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjb3VudFF1ZXJ5KSk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UXSBEYXRhYmFzZSBxdWVyeSBjb21wbGV0ZWQgaW46JywgKGVuZFRpbWUgLSBzdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OIIFtTVE9SQUdFIC0gQ09VTlRdIFJhdyBkYXRhYmFzZSByZXN1bHQ6JywgcmVzdWx0LnJvd3MpO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KHJlc3VsdC5yb3dzWzBdPy50b3RhbCB8fCAnMCcpO1xuICAgICAgY29uc29sZS5sb2coJ/CflKIgW1NUT1JBR0UgLSBDT1VOVF0gUGFyc2VkIG9ycGhhbiBjb3VudDonLCBjb3VudCk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBDT1VOVCBPUlBIQU4gVVNFUlMgQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBjb3VudDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlRdID09PT09IENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW1NUT1JBR0UgLSBDT1VOVF0gRXJyb3IgZGV0YWlsczonLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIENPVU5UXSA9PT09PSBFTkQgQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkbWluLW9ubHkgbWV0aG9kIHRvIGNvdW50IGFsbCB1c2VycyBleGNlcHQgc3BlY2lmaWVkIGFkbWluXG4gIGFzeW5jIGNvdW50QWxsVXNlcnNFeGNlcHQoZXhjbHVkZVVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIENPVU5UIEFMTF0gPT09PT0gQ09VTlQgQUxMIFVTRVJTIEVYQ0VQVCBBRE1JTiBTVEFSVEVEID09PT09Jyk7XG4gICAgY29uc29sZS5sb2coJ+KPsCBbU1RPUkFHRSAtIENPVU5UIEFMTF0gVGltZXN0YW1wOicsIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSk7XG4gICAgY29uc29sZS5sb2coJ/CflJIgW1NUT1JBR0UgLSBDT1VOVCBBTExdIEV4Y2x1ZGluZyBhZG1pbiB1c2VyIElEOicsIGV4Y2x1ZGVVc2VySWQpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb3VudFF1ZXJ5ID0gYFxuICAgICAgICBTRUxFQ1QgQ09VTlQoKikgYXMgdG90YWwgXG4gICAgICAgIEZST00gdXNlcnMgdVxuICAgICAgICBXSEVSRSB1LmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgQU5EIHUuaWQgIT0gJyR7ZXhjbHVkZVVzZXJJZH0nXG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbU1RPUkFHRSAtIENPVU5UIEFMTF0gRXhlY3V0aW5nIFNRTCBxdWVyeTonLCBjb3VudFF1ZXJ5LnRyaW0oKSk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSBTdGFydGluZyBkYXRhYmFzZSBleGVjdXRpb24uLi4nKTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGRiLmV4ZWN1dGUoc3FsLnJhdyhjb3VudFF1ZXJ5KSk7XG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIENPVU5UIEFMTF0gRGF0YWJhc2UgcXVlcnkgY29tcGxldGVkIGluOicsIChlbmRUaW1lIC0gc3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiCBbU1RPUkFHRSAtIENPVU5UIEFMTF0gUmF3IGRhdGFiYXNlIHJlc3VsdDonLCByZXN1bHQucm93cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvdW50ID0gcGFyc2VJbnQocmVzdWx0LnJvd3NbMF0/LnRvdGFsIHx8ICcwJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+UoiBbU1RPUkFHRSAtIENPVU5UIEFMTF0gUGFyc2VkIHVzZXIgY291bnQ6JywgY291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW1NUT1JBR0UgLSBDT1VOVCBBTExdID09PT09IENPVU5UIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBjb3VudDtcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSA9PT09PSBDUklUSUNBTCBFUlJPUiA9PT09PScpO1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSBFcnJvciBkZXRhaWxzOicsIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gQ09VTlQgQUxMXSA9PT09PSBFTkQgQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkbWluLW9ubHkgbWV0aG9kIHRvIGRlbGV0ZSBhbGwgdXNlcnMgZXhjZXB0IHNwZWNpZmllZCBhZG1pblxuICBhc3luYyBkZWxldGVBbGxVc2Vyc0V4Y2VwdChleGNsdWRlVXNlcklkOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5eR77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gREVMRVRFIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBUaW1lc3RhbXA6JywgbmV3IERhdGUoKS50b0lTT1N0cmluZygpKTtcbiAgICBjb25zb2xlLmxvZygn8J+UkiBbU1RPUkFHRSAtIERFTEVURSBBTExdIEV4Y2x1ZGluZyBhZG1pbiB1c2VyIElEOicsIGV4Y2x1ZGVVc2VySWQpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBGaXJzdCwgbGV0J3MgZ2V0IHRoZSBsaXN0IG9mIHVzZXJzIHRoYXQgd2lsbCBiZSBhZmZlY3RlZCBmb3IgZGVidWdnaW5nXG4gICAgICBjb25zdCBwcmV2aWV3UXVlcnkgPSBzcWxgU0VMRUNUIHUuaWQsIHUuZW1haWwsIHUuZmlyc3RfbmFtZSwgdS5sYXN0X25hbWUsIHUucm9sZVxuICAgICAgICBGUk9NIHVzZXJzIHVcbiAgICAgICAgV0hFUkUgdS5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgQU5EIHUuaWQgIT0gJHtleGNsdWRlVXNlcklkfWA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gR2V0dGluZyBwcmV2aWV3IG9mIHVzZXJzIHRvIGJlIGRlbGV0ZWQuLi4nKTtcbiAgICAgIGNvbnN0IHByZXZpZXdSZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHByZXZpZXdRdWVyeSk7XG4gICAgICBjb25zb2xlLmxvZygn8J+RpSBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVzZXJzIHRvIGJlIGRlbGV0ZWQ6JywgcHJldmlld1Jlc3VsdC5yb3dzKTtcbiAgICAgIFxuICAgICAgLy8gTWFyayBhbGwgb3RoZXIgdXNlcnMgYXMgaW5hY3RpdmVcbiAgICAgIGNvbnN0IHVwZGF0ZVF1ZXJ5ID0gc3FsYFVQREFURSB1c2VycyBcbiAgICAgICAgU0VUIGlzX2FjdGl2ZSA9IGZhbHNlLFxuICAgICAgICAgICAgdXBkYXRlZF9hdCA9IENVUlJFTlRfVElNRVNUQU1QXG4gICAgICAgIFdIRVJFIGlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICBBTkQgaWQgIT0gJHtleGNsdWRlVXNlcklkfWA7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SnIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gRXhlY3V0aW5nIFVQREFURSBxdWVyeSB0byBtYXJrIHVzZXJzIGFzIGluYWN0aXZlLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gU3RhcnRpbmcgdXBkYXRlIG9wZXJhdGlvbi4uLicpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZSh1cGRhdGVRdWVyeSk7XG4gICAgICBjb25zdCB1cGRhdGVUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVwZGF0ZSBvcGVyYXRpb24gY29tcGxldGVkIGluOicsICh1cGRhdGVUaW1lIC0gc3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBbU1RPUkFHRSAtIERFTEVURSBBTExdIFVwZGF0ZSByZXN1bHQ6JywgcmVzdWx0KTtcbiAgICAgIFxuICAgICAgLy8gQ291bnQgdGhlIGFmZmVjdGVkIHJvd3NcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBzcWxgU0VMRUNUIENPVU5UKCopIGFzIGRlbGV0ZWRfY291bnRcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICBBTkQgdS5pZCAhPSAke2V4Y2x1ZGVVc2VySWR9XG4gICAgICAgICAgQU5EIHUudXBkYXRlZF9hdCA+PSBDVVJSRU5UX1RJTUVTVEFNUCAtIElOVEVSVkFMICcxIG1pbnV0ZSdgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UjSBbU1RPUkFHRSAtIERFTEVURSBBTExdIEV4ZWN1dGluZyBjb3VudCBxdWVyeSB0byB2ZXJpZnkgZGVsZXRpb24uLi4nKTtcbiAgICAgIGNvbnN0IGNvdW50U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShjb3VudFF1ZXJ5KTtcbiAgICAgIGNvbnN0IGNvdW50RW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfij7HvuI8gW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBDb3VudCBxdWVyeSBjb21wbGV0ZWQgaW46JywgKGNvdW50RW5kVGltZSAtIGNvdW50U3RhcnRUaW1lKSwgJ21zJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiCBbU1RPUkFHRSAtIERFTEVURSBBTExdIFJhdyBjb3VudCByZXN1bHQ6JywgY291bnRSZXN1bHQucm93cyk7XG4gICAgICBcbiAgICAgIGNvbnN0IGRlbGV0ZWRDb3VudCA9IHBhcnNlSW50KGNvdW50UmVzdWx0LnJvd3NbMF0/LmRlbGV0ZWRfY291bnQgfHwgJzAnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SiIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gRmluYWwgZGVsZXRlZCBjb3VudDonLCBkZWxldGVkQ291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURSBBTExdIFRvdGFsIG9wZXJhdGlvbiB0aW1lOicsIChjb3VudEVuZFRpbWUgLSBzdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5eR77iPIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gREVMRVRFIEFMTCBVU0VSUyBFWENFUFQgQURNSU4gQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURSBBTExdID09PT09IENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgW1NUT1JBR0UgLSBERUxFVEUgQUxMXSBFcnJvciBkZXRhaWxzOicsIHtcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgc3RhY2s6IGVycm9yLnN0YWNrLFxuICAgICAgICBuYW1lOiBlcnJvci5uYW1lLFxuICAgICAgICBjb2RlOiBlcnJvci5jb2RlLFxuICAgICAgICBleGNsdWRlVXNlcklkOiBleGNsdWRlVXNlcklkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmVycm9yKCfwn5KlIFtTVE9SQUdFIC0gREVMRVRFIEFMTF0gPT09PT0gRU5EIENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvLyBBZG1pbi1vbmx5IG1ldGhvZCB0byBkZWxldGUgb3JwaGFuIHVzZXJzIChleGNsdWRpbmcgc3BlY2lmaWVkIGFkbWluIHVzZXIpXG4gIGFzeW5jIGRlbGV0ZU9ycGhhblVzZXJzKGV4Y2x1ZGVVc2VySWQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc29sZS5sb2coJ/Cfl5HvuI8gW1NUT1JBR0UgLSBERUxFVEVdID09PT09IERFTEVURSBPUlBIQU4gVVNFUlMgU1RBUlRFRCA9PT09PScpO1xuICAgIGNvbnNvbGUubG9nKCfij7AgW1NUT1JBR0UgLSBERUxFVEVdIFRpbWVzdGFtcDonLCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkpO1xuICAgIGNvbnNvbGUubG9nKCfwn5SSIFtTVE9SQUdFIC0gREVMRVRFXSBFeGNsdWRpbmcgYWRtaW4gdXNlciBJRDonLCBleGNsdWRlVXNlcklkKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gRmlyc3QsIGxldCdzIGdldCB0aGUgbGlzdCBvZiB1c2VycyB0aGF0IHdpbGwgYmUgYWZmZWN0ZWQgZm9yIGRlYnVnZ2luZ1xuICAgICAgY29uc3QgcHJldmlld1F1ZXJ5ID0gc3FsYFNFTEVDVCB1LmlkLCB1LmVtYWlsLCB1LmZpcnN0X25hbWUsIHUubGFzdF9uYW1lLCB1LnJvbGVcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIEFORCB1LmlkICE9ICR7ZXhjbHVkZVVzZXJJZH1cbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSB1LmlkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgKVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyIFxuICAgICAgICAgICAgV0hFUkUgdXIudXNlcl9pZCA9IHUuaWQgQU5EIHVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApYDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NUT1JBR0UgLSBERUxFVEVdIEdldHRpbmcgcHJldmlldyBvZiB1c2VycyB0byBiZSBkZWxldGVkLi4uJyk7XG4gICAgICBjb25zdCBwcmV2aWV3UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShwcmV2aWV3UXVlcnkpO1xuICAgICAgY29uc29sZS5sb2coJ/CfkaUgW1NUT1JBR0UgLSBERUxFVEVdIFVzZXJzIHRvIGJlIGRlbGV0ZWQ6JywgcHJldmlld1Jlc3VsdC5yb3dzKTtcbiAgICAgIFxuICAgICAgLy8gTWFyayBvcnBoYW4gdXNlcnMgYXMgaW5hY3RpdmUgdG8gYXZvaWQgZm9yZWlnbiBrZXkgaXNzdWVzXG4gICAgICBjb25zdCB1cGRhdGVRdWVyeSA9IHNxbGBVUERBVEUgdXNlcnMgXG4gICAgICAgIFNFVCBpc19hY3RpdmUgPSBmYWxzZSxcbiAgICAgICAgICAgIHVwZGF0ZWRfYXQgPSBDVVJSRU5UX1RJTUVTVEFNUFxuICAgICAgICBXSEVSRSBpc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgQU5EIGlkICE9ICR7ZXhjbHVkZVVzZXJJZH1cbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSBpZCBBTkQgdW8uaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClcbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfcmVzaWRlbmNlcyB1ciBcbiAgICAgICAgICAgIFdIRVJFIHVyLnVzZXJfaWQgPSBpZCBBTkQgdXIuaXNfYWN0aXZlID0gdHJ1ZVxuICAgICAgICAgIClgO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn8J+UpyBbU1RPUkFHRSAtIERFTEVURV0gRXhlY3V0aW5nIFVQREFURSBxdWVyeSB0byBtYXJrIHVzZXJzIGFzIGluYWN0aXZlLi4uJyk7XG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFXSBTdGFydGluZyB1cGRhdGUgb3BlcmF0aW9uLi4uJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBkYi5leGVjdXRlKHVwZGF0ZVF1ZXJ5KTtcbiAgICAgIGNvbnN0IHVwZGF0ZVRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICBjb25zb2xlLmxvZygn4o+x77iPIFtTVE9SQUdFIC0gREVMRVRFXSBVcGRhdGUgb3BlcmF0aW9uIGNvbXBsZXRlZCBpbjonLCAodXBkYXRlVGltZSAtIHN0YXJ0VGltZSksICdtcycpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogW1NUT1JBR0UgLSBERUxFVEVdIFVwZGF0ZSByZXN1bHQ6JywgcmVzdWx0KTtcbiAgICAgIFxuICAgICAgLy8gQ291bnQgdGhlIGFmZmVjdGVkIHJvd3NcbiAgICAgIGNvbnN0IGNvdW50UXVlcnkgPSBzcWxgU0VMRUNUIENPVU5UKCopIGFzIGRlbGV0ZWRfY291bnRcbiAgICAgICAgRlJPTSB1c2VycyB1XG4gICAgICAgIFdIRVJFIHUuaXNfYWN0aXZlID0gZmFsc2VcbiAgICAgICAgICBBTkQgdS5pZCAhPSAke2V4Y2x1ZGVVc2VySWR9XG4gICAgICAgICAgQU5EIHUudXBkYXRlZF9hdCA+PSBDVVJSRU5UX1RJTUVTVEFNUCAtIElOVEVSVkFMICcxIG1pbnV0ZSdcbiAgICAgICAgICBBTkQgTk9UIEVYSVNUUyAoXG4gICAgICAgICAgICBTRUxFQ1QgMSBGUk9NIHVzZXJfb3JnYW5pemF0aW9ucyB1byBcbiAgICAgICAgICAgIFdIRVJFIHVvLnVzZXJfaWQgPSB1LmlkIEFORCB1by5pc19hY3RpdmUgPSB0cnVlXG4gICAgICAgICAgKVxuICAgICAgICAgIEFORCBOT1QgRVhJU1RTIChcbiAgICAgICAgICAgIFNFTEVDVCAxIEZST00gdXNlcl9yZXNpZGVuY2VzIHVyIFxuICAgICAgICAgICAgV0hFUkUgdXIudXNlcl9pZCA9IHUuaWQgQU5EIHVyLmlzX2FjdGl2ZSA9IHRydWVcbiAgICAgICAgICApYDtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/CflI0gW1NUT1JBR0UgLSBERUxFVEVdIEV4ZWN1dGluZyBjb3VudCBxdWVyeSB0byB2ZXJpZnkgZGVsZXRpb24uLi4nKTtcbiAgICAgIGNvbnN0IGNvdW50U3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGNvdW50UmVzdWx0ID0gYXdhaXQgZGIuZXhlY3V0ZShjb3VudFF1ZXJ5KTtcbiAgICAgIGNvbnN0IGNvdW50RW5kVGltZSA9IERhdGUubm93KCk7XG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfij7HvuI8gW1NUT1JBR0UgLSBERUxFVEVdIENvdW50IHF1ZXJ5IGNvbXBsZXRlZCBpbjonLCAoY291bnRFbmRUaW1lIC0gY291bnRTdGFydFRpbWUpLCAnbXMnKTtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OIIFtTVE9SQUdFIC0gREVMRVRFXSBSYXcgY291bnQgcmVzdWx0OicsIGNvdW50UmVzdWx0LnJvd3MpO1xuICAgICAgXG4gICAgICBjb25zdCBkZWxldGVkQ291bnQgPSBwYXJzZUludChjb3VudFJlc3VsdC5yb3dzWzBdPy5kZWxldGVkX2NvdW50IHx8ICcwJyk7XG4gICAgICBjb25zb2xlLmxvZygn8J+UoiBbU1RPUkFHRSAtIERFTEVURV0gRmluYWwgZGVsZXRlZCBjb3VudDonLCBkZWxldGVkQ291bnQpO1xuICAgICAgY29uc29sZS5sb2coJ+KPse+4jyBbU1RPUkFHRSAtIERFTEVURV0gVG90YWwgb3BlcmF0aW9uIHRpbWU6JywgKGNvdW50RW5kVGltZSAtIHN0YXJ0VGltZSksICdtcycpO1xuICAgICAgY29uc29sZS5sb2coJ/Cfl5HvuI8gW1NUT1JBR0UgLSBERUxFVEVdID09PT09IERFTEVURSBPUlBIQU4gVVNFUlMgQ09NUExFVEVEID09PT09Jyk7XG4gICAgICBcbiAgICAgIHJldHVybiBkZWxldGVkQ291bnQ7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURV0gPT09PT0gQ1JJVElDQUwgRVJST1IgPT09PT0nKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBbU1RPUkFHRSAtIERFTEVURV0gRXJyb3IgZGV0YWlsczonLCB7XG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UsXG4gICAgICAgIHN0YWNrOiBlcnJvci5zdGFjayxcbiAgICAgICAgbmFtZTogZXJyb3IubmFtZSxcbiAgICAgICAgY29kZTogZXJyb3IuY29kZSxcbiAgICAgICAgZXhjbHVkZVVzZXJJZDogZXhjbHVkZVVzZXJJZCxcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICAgIH0pO1xuICAgICAgY29uc29sZS5lcnJvcign8J+SpSBbU1RPUkFHRSAtIERFTEVURV0gPT09PT0gRU5EIENSSVRJQ0FMIEVSUk9SID09PT09Jyk7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==