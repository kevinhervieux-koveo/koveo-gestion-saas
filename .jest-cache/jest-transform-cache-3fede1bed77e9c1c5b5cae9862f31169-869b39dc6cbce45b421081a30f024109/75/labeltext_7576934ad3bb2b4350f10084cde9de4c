2374dd53f6a96b013c0454d979f171ed
"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.queryByLabelText = exports.queryAllByLabelText = exports.getByLabelText = exports.getAllByLabelText = exports.findByLabelText = exports.findAllByLabelText = void 0;
var _config = require("../config");
var _helpers = require("../helpers");
var _labelHelpers = require("../label-helpers");
var _allUtils = require("./all-utils");
function queryAllLabels(container) {
    return Array.from(container.querySelectorAll('label,input')).map(node => {
        return {
            node,
            textToMatch: (0, _labelHelpers.getLabelContent)(node)
        };
    }).filter(({ textToMatch }) => textToMatch !== null);
}
const queryAllLabelsByText = (container, text, { exact = true, trim, collapseWhitespace, normalizer } = {}) => {
    const matcher = exact ? _allUtils.matches : _allUtils.fuzzyMatches;
    const matchNormalizer = (0, _allUtils.makeNormalizer)({
        collapseWhitespace,
        trim,
        normalizer
    });
    const textToMatchByLabels = queryAllLabels(container);
    return textToMatchByLabels.filter(({ node, textToMatch }) => matcher(textToMatch, node, text, matchNormalizer)).map(({ node }) => node);
};
const queryAllByLabelText = (container, text, { selector = '*', exact = true, collapseWhitespace, trim, normalizer } = {}) => {
    (0, _helpers.checkContainerType)(container);
    const matcher = exact ? _allUtils.matches : _allUtils.fuzzyMatches;
    const matchNormalizer = (0, _allUtils.makeNormalizer)({
        collapseWhitespace,
        trim,
        normalizer
    });
    const matchingLabelledElements = Array.from(container.querySelectorAll('*')).filter(element => {
        return (0, _labelHelpers.getRealLabels)(element).length || element.hasAttribute('aria-labelledby');
    }).reduce((labelledElements, labelledElement) => {
        const labelList = (0, _labelHelpers.getLabels)(container, labelledElement, {
            selector
        });
        labelList.filter(label => Boolean(label.formControl)).forEach(label => {
            if (matcher(label.content, label.formControl, text, matchNormalizer) && label.formControl) {
                labelledElements.push(label.formControl);
            }
        });
        const labelsValue = labelList.filter(label => Boolean(label.content)).map(label => label.content);
        if (matcher(labelsValue.join(' '), labelledElement, text, matchNormalizer)) {
            labelledElements.push(labelledElement);
        }
        if (labelsValue.length > 1) {
            labelsValue.forEach((labelValue, index) => {
                if (matcher(labelValue, labelledElement, text, matchNormalizer)) {
                    labelledElements.push(labelledElement);
                }
                const labelsFiltered = [...labelsValue];
                labelsFiltered.splice(index, 1);
                if (labelsFiltered.length > 1) {
                    if (matcher(labelsFiltered.join(' '), labelledElement, text, matchNormalizer)) {
                        labelledElements.push(labelledElement);
                    }
                }
            });
        }
        return labelledElements;
    }, []).concat((0, _allUtils.queryAllByAttribute)('aria-label', container, text, {
        exact,
        normalizer: matchNormalizer
    }));
    return Array.from(new Set(matchingLabelledElements)).filter(element => element.matches(selector));
};
// the getAll* query would normally look like this:
// const getAllByLabelText = makeGetAllQuery(
//   queryAllByLabelText,
//   (c, text) => `Unable to find a label with the text of: ${text}`,
// )
// however, we can give a more helpful error message than the generic one,
// so we're writing this one out by hand.
const getAllByLabelText = (container, text, ...rest) => {
    const els = queryAllByLabelText(container, text, ...rest);
    if (!els.length) {
        const labels = queryAllLabelsByText(container, text, ...rest);
        if (labels.length) {
            const tagNames = labels.map(label => getTagNameOfElementAssociatedWithLabelViaFor(container, label)).filter(tagName => !!tagName);
            if (tagNames.length) {
                throw (0, _config.getConfig)().getElementError(tagNames.map(tagName => `Found a label with the text of: ${text}, however the element associated with this label (<${tagName} />) is non-labellable [https://html.spec.whatwg.org/multipage/forms.html#category-label]. If you really need to label a <${tagName} />, you can use aria-label or aria-labelledby instead.`).join('\n\n'), container);
            }
            else {
                throw (0, _config.getConfig)().getElementError(`Found a label with the text of: ${text}, however no form control was found associated to that label. Make sure you're using the "for" attribute or "aria-labelledby" attribute correctly.`, container);
            }
        }
        else {
            throw (0, _config.getConfig)().getElementError(`Unable to find a label with the text of: ${text}`, container);
        }
    }
    return els;
};
function getTagNameOfElementAssociatedWithLabelViaFor(container, label) {
    const htmlFor = label.getAttribute('for');
    if (!htmlFor) {
        return null;
    }
    const element = container.querySelector(`[id="${htmlFor}"]`);
    return element ? element.tagName.toLowerCase() : null;
}
// the reason mentioned above is the same reason we're not using buildQueries
const getMultipleError = (c, text) => `Found multiple elements with the text of: ${text}`;
const queryByLabelText = exports.queryByLabelText = (0, _allUtils.wrapSingleQueryWithSuggestion)((0, _allUtils.makeSingleQuery)(queryAllByLabelText, getMultipleError), queryAllByLabelText.name, 'query');
const getByLabelText = (0, _allUtils.makeSingleQuery)(getAllByLabelText, getMultipleError);
const findAllByLabelText = exports.findAllByLabelText = (0, _allUtils.makeFindQuery)((0, _allUtils.wrapAllByQueryWithSuggestion)(getAllByLabelText, getAllByLabelText.name, 'findAll'));
const findByLabelText = exports.findByLabelText = (0, _allUtils.makeFindQuery)((0, _allUtils.wrapSingleQueryWithSuggestion)(getByLabelText, getAllByLabelText.name, 'find'));
const getAllByLabelTextWithSuggestions = exports.getAllByLabelText = (0, _allUtils.wrapAllByQueryWithSuggestion)(getAllByLabelText, getAllByLabelText.name, 'getAll');
const getByLabelTextWithSuggestions = exports.getByLabelText = (0, _allUtils.wrapSingleQueryWithSuggestion)(getByLabelText, getAllByLabelText.name, 'get');
const queryAllByLabelTextWithSuggestions = exports.queryAllByLabelText = (0, _allUtils.wrapAllByQueryWithSuggestion)(queryAllByLabelText, queryAllByLabelText.name, 'queryAll');
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9ub2RlX21vZHVsZXMvQHRlc3RpbmctbGlicmFyeS9kb20vZGlzdC9xdWVyaWVzL2xhYmVsLXRleHQuanMiLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FBRWIsTUFBTSxDQUFDLGNBQWMsQ0FBQyxPQUFPLEVBQUUsWUFBWSxFQUFFO0lBQzNDLEtBQUssRUFBRSxJQUFJO0NBQ1osQ0FBQyxDQUFDO0FBQ0gsT0FBTyxDQUFDLGdCQUFnQixHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsR0FBRyxPQUFPLENBQUMsY0FBYyxHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsR0FBRyxPQUFPLENBQUMsZUFBZSxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUM1SyxJQUFJLE9BQU8sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDbkMsSUFBSSxRQUFRLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO0FBQ3JDLElBQUksYUFBYSxHQUFHLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQ2hELElBQUksU0FBUyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztBQUN2QyxTQUFTLGNBQWMsQ0FBQyxTQUFTO0lBQy9CLE9BQU8sS0FBSyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUU7UUFDdEUsT0FBTztZQUNMLElBQUk7WUFDSixXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLGVBQWUsQ0FBQyxDQUFDLElBQUksQ0FBQztTQUN0RCxDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsRUFDVCxXQUFXLEVBQ1osRUFBRSxFQUFFLENBQUMsV0FBVyxLQUFLLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUM7QUFDRCxNQUFNLG9CQUFvQixHQUFHLENBQUMsU0FBUyxFQUFFLElBQUks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Q0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvaG9tZS9ydW5uZXIvd29ya3NwYWNlL25vZGVfbW9kdWxlcy9AdGVzdGluZy1saWJyYXJ5L2RvbS9kaXN0L3F1ZXJpZXMvbGFiZWwtdGV4dC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMucXVlcnlCeUxhYmVsVGV4dCA9IGV4cG9ydHMucXVlcnlBbGxCeUxhYmVsVGV4dCA9IGV4cG9ydHMuZ2V0QnlMYWJlbFRleHQgPSBleHBvcnRzLmdldEFsbEJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5maW5kQnlMYWJlbFRleHQgPSBleHBvcnRzLmZpbmRBbGxCeUxhYmVsVGV4dCA9IHZvaWQgMDtcbnZhciBfY29uZmlnID0gcmVxdWlyZShcIi4uL2NvbmZpZ1wiKTtcbnZhciBfaGVscGVycyA9IHJlcXVpcmUoXCIuLi9oZWxwZXJzXCIpO1xudmFyIF9sYWJlbEhlbHBlcnMgPSByZXF1aXJlKFwiLi4vbGFiZWwtaGVscGVyc1wiKTtcbnZhciBfYWxsVXRpbHMgPSByZXF1aXJlKFwiLi9hbGwtdXRpbHNcIik7XG5mdW5jdGlvbiBxdWVyeUFsbExhYmVscyhjb250YWluZXIpIHtcbiAgcmV0dXJuIEFycmF5LmZyb20oY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xhYmVsLGlucHV0JykpLm1hcChub2RlID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbm9kZSxcbiAgICAgIHRleHRUb01hdGNoOiAoMCwgX2xhYmVsSGVscGVycy5nZXRMYWJlbENvbnRlbnQpKG5vZGUpXG4gICAgfTtcbiAgfSkuZmlsdGVyKCh7XG4gICAgdGV4dFRvTWF0Y2hcbiAgfSkgPT4gdGV4dFRvTWF0Y2ggIT09IG51bGwpO1xufVxuY29uc3QgcXVlcnlBbGxMYWJlbHNCeVRleHQgPSAoY29udGFpbmVyLCB0ZXh0LCB7XG4gIGV4YWN0ID0gdHJ1ZSxcbiAgdHJpbSxcbiAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICBub3JtYWxpemVyXG59ID0ge30pID0+IHtcbiAgY29uc3QgbWF0Y2hlciA9IGV4YWN0ID8gX2FsbFV0aWxzLm1hdGNoZXMgOiBfYWxsVXRpbHMuZnV6enlNYXRjaGVzO1xuICBjb25zdCBtYXRjaE5vcm1hbGl6ZXIgPSAoMCwgX2FsbFV0aWxzLm1ha2VOb3JtYWxpemVyKSh7XG4gICAgY29sbGFwc2VXaGl0ZXNwYWNlLFxuICAgIHRyaW0sXG4gICAgbm9ybWFsaXplclxuICB9KTtcbiAgY29uc3QgdGV4dFRvTWF0Y2hCeUxhYmVscyA9IHF1ZXJ5QWxsTGFiZWxzKGNvbnRhaW5lcik7XG4gIHJldHVybiB0ZXh0VG9NYXRjaEJ5TGFiZWxzLmZpbHRlcigoe1xuICAgIG5vZGUsXG4gICAgdGV4dFRvTWF0Y2hcbiAgfSkgPT4gbWF0Y2hlcih0ZXh0VG9NYXRjaCwgbm9kZSwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSkubWFwKCh7XG4gICAgbm9kZVxuICB9KSA9PiBub2RlKTtcbn07XG5jb25zdCBxdWVyeUFsbEJ5TGFiZWxUZXh0ID0gKGNvbnRhaW5lciwgdGV4dCwge1xuICBzZWxlY3RvciA9ICcqJyxcbiAgZXhhY3QgPSB0cnVlLFxuICBjb2xsYXBzZVdoaXRlc3BhY2UsXG4gIHRyaW0sXG4gIG5vcm1hbGl6ZXJcbn0gPSB7fSkgPT4ge1xuICAoMCwgX2hlbHBlcnMuY2hlY2tDb250YWluZXJUeXBlKShjb250YWluZXIpO1xuICBjb25zdCBtYXRjaGVyID0gZXhhY3QgPyBfYWxsVXRpbHMubWF0Y2hlcyA6IF9hbGxVdGlscy5mdXp6eU1hdGNoZXM7XG4gIGNvbnN0IG1hdGNoTm9ybWFsaXplciA9ICgwLCBfYWxsVXRpbHMubWFrZU5vcm1hbGl6ZXIpKHtcbiAgICBjb2xsYXBzZVdoaXRlc3BhY2UsXG4gICAgdHJpbSxcbiAgICBub3JtYWxpemVyXG4gIH0pO1xuICBjb25zdCBtYXRjaGluZ0xhYmVsbGVkRWxlbWVudHMgPSBBcnJheS5mcm9tKGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yQWxsKCcqJykpLmZpbHRlcihlbGVtZW50ID0+IHtcbiAgICByZXR1cm4gKDAsIF9sYWJlbEhlbHBlcnMuZ2V0UmVhbExhYmVscykoZWxlbWVudCkubGVuZ3RoIHx8IGVsZW1lbnQuaGFzQXR0cmlidXRlKCdhcmlhLWxhYmVsbGVkYnknKTtcbiAgfSkucmVkdWNlKChsYWJlbGxlZEVsZW1lbnRzLCBsYWJlbGxlZEVsZW1lbnQpID0+IHtcbiAgICBjb25zdCBsYWJlbExpc3QgPSAoMCwgX2xhYmVsSGVscGVycy5nZXRMYWJlbHMpKGNvbnRhaW5lciwgbGFiZWxsZWRFbGVtZW50LCB7XG4gICAgICBzZWxlY3RvclxuICAgIH0pO1xuICAgIGxhYmVsTGlzdC5maWx0ZXIobGFiZWwgPT4gQm9vbGVhbihsYWJlbC5mb3JtQ29udHJvbCkpLmZvckVhY2gobGFiZWwgPT4ge1xuICAgICAgaWYgKG1hdGNoZXIobGFiZWwuY29udGVudCwgbGFiZWwuZm9ybUNvbnRyb2wsIHRleHQsIG1hdGNoTm9ybWFsaXplcikgJiYgbGFiZWwuZm9ybUNvbnRyb2wpIHtcbiAgICAgICAgbGFiZWxsZWRFbGVtZW50cy5wdXNoKGxhYmVsLmZvcm1Db250cm9sKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBjb25zdCBsYWJlbHNWYWx1ZSA9IGxhYmVsTGlzdC5maWx0ZXIobGFiZWwgPT4gQm9vbGVhbihsYWJlbC5jb250ZW50KSkubWFwKGxhYmVsID0+IGxhYmVsLmNvbnRlbnQpO1xuICAgIGlmIChtYXRjaGVyKGxhYmVsc1ZhbHVlLmpvaW4oJyAnKSwgbGFiZWxsZWRFbGVtZW50LCB0ZXh0LCBtYXRjaE5vcm1hbGl6ZXIpKSB7XG4gICAgICBsYWJlbGxlZEVsZW1lbnRzLnB1c2gobGFiZWxsZWRFbGVtZW50KTtcbiAgICB9XG4gICAgaWYgKGxhYmVsc1ZhbHVlLmxlbmd0aCA+IDEpIHtcbiAgICAgIGxhYmVsc1ZhbHVlLmZvckVhY2goKGxhYmVsVmFsdWUsIGluZGV4KSA9PiB7XG4gICAgICAgIGlmIChtYXRjaGVyKGxhYmVsVmFsdWUsIGxhYmVsbGVkRWxlbWVudCwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSkge1xuICAgICAgICAgIGxhYmVsbGVkRWxlbWVudHMucHVzaChsYWJlbGxlZEVsZW1lbnQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGxhYmVsc0ZpbHRlcmVkID0gWy4uLmxhYmVsc1ZhbHVlXTtcbiAgICAgICAgbGFiZWxzRmlsdGVyZWQuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgaWYgKGxhYmVsc0ZpbHRlcmVkLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBpZiAobWF0Y2hlcihsYWJlbHNGaWx0ZXJlZC5qb2luKCcgJyksIGxhYmVsbGVkRWxlbWVudCwgdGV4dCwgbWF0Y2hOb3JtYWxpemVyKSkge1xuICAgICAgICAgICAgbGFiZWxsZWRFbGVtZW50cy5wdXNoKGxhYmVsbGVkRWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGxhYmVsbGVkRWxlbWVudHM7XG4gIH0sIFtdKS5jb25jYXQoKDAsIF9hbGxVdGlscy5xdWVyeUFsbEJ5QXR0cmlidXRlKSgnYXJpYS1sYWJlbCcsIGNvbnRhaW5lciwgdGV4dCwge1xuICAgIGV4YWN0LFxuICAgIG5vcm1hbGl6ZXI6IG1hdGNoTm9ybWFsaXplclxuICB9KSk7XG4gIHJldHVybiBBcnJheS5mcm9tKG5ldyBTZXQobWF0Y2hpbmdMYWJlbGxlZEVsZW1lbnRzKSkuZmlsdGVyKGVsZW1lbnQgPT4gZWxlbWVudC5tYXRjaGVzKHNlbGVjdG9yKSk7XG59O1xuXG4vLyB0aGUgZ2V0QWxsKiBxdWVyeSB3b3VsZCBub3JtYWxseSBsb29rIGxpa2UgdGhpczpcbi8vIGNvbnN0IGdldEFsbEJ5TGFiZWxUZXh0ID0gbWFrZUdldEFsbFF1ZXJ5KFxuLy8gICBxdWVyeUFsbEJ5TGFiZWxUZXh0LFxuLy8gICAoYywgdGV4dCkgPT4gYFVuYWJsZSB0byBmaW5kIGEgbGFiZWwgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fWAsXG4vLyApXG4vLyBob3dldmVyLCB3ZSBjYW4gZ2l2ZSBhIG1vcmUgaGVscGZ1bCBlcnJvciBtZXNzYWdlIHRoYW4gdGhlIGdlbmVyaWMgb25lLFxuLy8gc28gd2UncmUgd3JpdGluZyB0aGlzIG9uZSBvdXQgYnkgaGFuZC5cbmNvbnN0IGdldEFsbEJ5TGFiZWxUZXh0ID0gKGNvbnRhaW5lciwgdGV4dCwgLi4ucmVzdCkgPT4ge1xuICBjb25zdCBlbHMgPSBxdWVyeUFsbEJ5TGFiZWxUZXh0KGNvbnRhaW5lciwgdGV4dCwgLi4ucmVzdCk7XG4gIGlmICghZWxzLmxlbmd0aCkge1xuICAgIGNvbnN0IGxhYmVscyA9IHF1ZXJ5QWxsTGFiZWxzQnlUZXh0KGNvbnRhaW5lciwgdGV4dCwgLi4ucmVzdCk7XG4gICAgaWYgKGxhYmVscy5sZW5ndGgpIHtcbiAgICAgIGNvbnN0IHRhZ05hbWVzID0gbGFiZWxzLm1hcChsYWJlbCA9PiBnZXRUYWdOYW1lT2ZFbGVtZW50QXNzb2NpYXRlZFdpdGhMYWJlbFZpYUZvcihjb250YWluZXIsIGxhYmVsKSkuZmlsdGVyKHRhZ05hbWUgPT4gISF0YWdOYW1lKTtcbiAgICAgIGlmICh0YWdOYW1lcy5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgKDAsIF9jb25maWcuZ2V0Q29uZmlnKSgpLmdldEVsZW1lbnRFcnJvcih0YWdOYW1lcy5tYXAodGFnTmFtZSA9PiBgRm91bmQgYSBsYWJlbCB3aXRoIHRoZSB0ZXh0IG9mOiAke3RleHR9LCBob3dldmVyIHRoZSBlbGVtZW50IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGxhYmVsICg8JHt0YWdOYW1lfSAvPikgaXMgbm9uLWxhYmVsbGFibGUgW2h0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvbXVsdGlwYWdlL2Zvcm1zLmh0bWwjY2F0ZWdvcnktbGFiZWxdLiBJZiB5b3UgcmVhbGx5IG5lZWQgdG8gbGFiZWwgYSA8JHt0YWdOYW1lfSAvPiwgeW91IGNhbiB1c2UgYXJpYS1sYWJlbCBvciBhcmlhLWxhYmVsbGVkYnkgaW5zdGVhZC5gKS5qb2luKCdcXG5cXG4nKSwgY29udGFpbmVyKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93ICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYEZvdW5kIGEgbGFiZWwgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fSwgaG93ZXZlciBubyBmb3JtIGNvbnRyb2wgd2FzIGZvdW5kIGFzc29jaWF0ZWQgdG8gdGhhdCBsYWJlbC4gTWFrZSBzdXJlIHlvdSdyZSB1c2luZyB0aGUgXCJmb3JcIiBhdHRyaWJ1dGUgb3IgXCJhcmlhLWxhYmVsbGVkYnlcIiBhdHRyaWJ1dGUgY29ycmVjdGx5LmAsIGNvbnRhaW5lcik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93ICgwLCBfY29uZmlnLmdldENvbmZpZykoKS5nZXRFbGVtZW50RXJyb3IoYFVuYWJsZSB0byBmaW5kIGEgbGFiZWwgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fWAsIGNvbnRhaW5lcik7XG4gICAgfVxuICB9XG4gIHJldHVybiBlbHM7XG59O1xuZnVuY3Rpb24gZ2V0VGFnTmFtZU9mRWxlbWVudEFzc29jaWF0ZWRXaXRoTGFiZWxWaWFGb3IoY29udGFpbmVyLCBsYWJlbCkge1xuICBjb25zdCBodG1sRm9yID0gbGFiZWwuZ2V0QXR0cmlidXRlKCdmb3InKTtcbiAgaWYgKCFodG1sRm9yKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgY29uc3QgZWxlbWVudCA9IGNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKGBbaWQ9XCIke2h0bWxGb3J9XCJdYCk7XG4gIHJldHVybiBlbGVtZW50ID8gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgOiBudWxsO1xufVxuXG4vLyB0aGUgcmVhc29uIG1lbnRpb25lZCBhYm92ZSBpcyB0aGUgc2FtZSByZWFzb24gd2UncmUgbm90IHVzaW5nIGJ1aWxkUXVlcmllc1xuY29uc3QgZ2V0TXVsdGlwbGVFcnJvciA9IChjLCB0ZXh0KSA9PiBgRm91bmQgbXVsdGlwbGUgZWxlbWVudHMgd2l0aCB0aGUgdGV4dCBvZjogJHt0ZXh0fWA7XG5jb25zdCBxdWVyeUJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5xdWVyeUJ5TGFiZWxUZXh0ID0gKDAsIF9hbGxVdGlscy53cmFwU2luZ2xlUXVlcnlXaXRoU3VnZ2VzdGlvbikoKDAsIF9hbGxVdGlscy5tYWtlU2luZ2xlUXVlcnkpKHF1ZXJ5QWxsQnlMYWJlbFRleHQsIGdldE11bHRpcGxlRXJyb3IpLCBxdWVyeUFsbEJ5TGFiZWxUZXh0Lm5hbWUsICdxdWVyeScpO1xuY29uc3QgZ2V0QnlMYWJlbFRleHQgPSAoMCwgX2FsbFV0aWxzLm1ha2VTaW5nbGVRdWVyeSkoZ2V0QWxsQnlMYWJlbFRleHQsIGdldE11bHRpcGxlRXJyb3IpO1xuY29uc3QgZmluZEFsbEJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5maW5kQWxsQnlMYWJlbFRleHQgPSAoMCwgX2FsbFV0aWxzLm1ha2VGaW5kUXVlcnkpKCgwLCBfYWxsVXRpbHMud3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbikoZ2V0QWxsQnlMYWJlbFRleHQsIGdldEFsbEJ5TGFiZWxUZXh0Lm5hbWUsICdmaW5kQWxsJykpO1xuY29uc3QgZmluZEJ5TGFiZWxUZXh0ID0gZXhwb3J0cy5maW5kQnlMYWJlbFRleHQgPSAoMCwgX2FsbFV0aWxzLm1ha2VGaW5kUXVlcnkpKCgwLCBfYWxsVXRpbHMud3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24pKGdldEJ5TGFiZWxUZXh0LCBnZXRBbGxCeUxhYmVsVGV4dC5uYW1lLCAnZmluZCcpKTtcbmNvbnN0IGdldEFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zID0gZXhwb3J0cy5nZXRBbGxCeUxhYmVsVGV4dCA9ICgwLCBfYWxsVXRpbHMud3JhcEFsbEJ5UXVlcnlXaXRoU3VnZ2VzdGlvbikoZ2V0QWxsQnlMYWJlbFRleHQsIGdldEFsbEJ5TGFiZWxUZXh0Lm5hbWUsICdnZXRBbGwnKTtcbmNvbnN0IGdldEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zID0gZXhwb3J0cy5nZXRCeUxhYmVsVGV4dCA9ICgwLCBfYWxsVXRpbHMud3JhcFNpbmdsZVF1ZXJ5V2l0aFN1Z2dlc3Rpb24pKGdldEJ5TGFiZWxUZXh0LCBnZXRBbGxCeUxhYmVsVGV4dC5uYW1lLCAnZ2V0Jyk7XG5jb25zdCBxdWVyeUFsbEJ5TGFiZWxUZXh0V2l0aFN1Z2dlc3Rpb25zID0gZXhwb3J0cy5xdWVyeUFsbEJ5TGFiZWxUZXh0ID0gKDAsIF9hbGxVdGlscy53cmFwQWxsQnlRdWVyeVdpdGhTdWdnZXN0aW9uKShxdWVyeUFsbEJ5TGFiZWxUZXh0LCBxdWVyeUFsbEJ5TGFiZWxUZXh0Lm5hbWUsICdxdWVyeUFsbCcpOyJdLCJ2ZXJzaW9uIjozfQ==