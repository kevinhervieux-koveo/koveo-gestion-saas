c0152caad1ddd848b812bf1796416f61
"use strict";
/**
 * Query caching system for Quebec property management SaaS.
 * Implements intelligent caching to reduce 132ms average query time.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CACHE_CONFIGS = exports.QueryCacheManager = exports.default = exports.CacheWarmer = exports.CacheMonitor = exports.CacheInvalidator = exports.queryCache = void 0;
exports.withCache = withCache;
const lru_cache_1 = require("lru-cache");
/**
 * Cache configurations optimized for property management workloads.
 */
const CACHE_CONFIGS = {
    // User data - frequently accessed, moderate changes
    // OPTIMIZED: Longer TTL for complex user assignments query
    users: { maxSize: 1500, ttl: 8 * 60 * 1000 }, // 8 minutes (was 5)
    // Organization data - stable, infrequent changes
    organizations: { maxSize: 200, ttl: 45 * 60 * 1000 }, // 45 minutes (was 30)
    // Building data - relatively stable
    // OPTIMIZED: Increased cache size and TTL for building queries
    buildings: { maxSize: 1000, ttl: 20 * 60 * 1000 }, // 20 minutes (was 15)
    // Residence data - stable structure, occasional updates
    // OPTIMIZED: Increased cache size for residence queries
    residences: { maxSize: 3000, ttl: 12 * 60 * 1000 }, // 12 minutes (was 10)
    // Documents - frequently accessed, moderate updates
    // OPTIMIZED: New cache category for document queries
    documents: { maxSize: 2000, ttl: 10 * 60 * 1000 }, // 10 minutes
    // Bills - time-sensitive, frequent updates
    bills: { maxSize: 1500, ttl: 3 * 60 * 1000 }, // 3 minutes (was 2)
    // Maintenance requests - dynamic, frequent status changes
    maintenance: { maxSize: 750, ttl: 90 * 1000 }, // 90 seconds (was 60)
    // Notifications - real-time, short cache
    notifications: { maxSize: 1000, ttl: 45 * 1000 }, // 45 seconds (was 30)
    // Quality metrics - stable for periods
    metrics: { maxSize: 300, ttl: 8 * 60 * 1000 }, // 8 minutes (was 5)
    // Features and roadmap - moderately stable
    features: { maxSize: 500, ttl: 5 * 60 * 1000 }, // 5 minutes (was 3)
    // Framework configuration - very stable
    config: { maxSize: 150, ttl: 90 * 60 * 1000 }, // 1.5 hours (was 1)
    // Bug reports - moderate changes, user-specific
    bugs: { maxSize: 750, ttl: 4 * 60 * 1000 }, // 4 minutes (was 2)
    // Financial data - moderate changes, important for dashboard
    financial: { maxSize: 500, ttl: 5 * 60 * 1000 }, // 5 minutes
    // Search results - temporary but frequently accessed
    search: { maxSize: 1000, ttl: 2 * 60 * 1000 }, // 2 minutes
    // Statistics and aggregations - expensive to compute
    stats: { maxSize: 300, ttl: 10 * 60 * 1000 }, // 10 minutes
};
exports.CACHE_CONFIGS = CACHE_CONFIGS;
/**
 * Cache instances for different data types.
 */
class QueryCacheManager {
    /**
     *
     */
    constructor() {
        this.caches = new Map();
        this.hitCounts = new Map();
        this.missCounts = new Map();
        // Initialize caches for each data type
        Object.entries(CACHE_CONFIGS).forEach(([type, config]) => {
            this.caches.set(type, new lru_cache_1.LRUCache({
                max: config.maxSize,
                ttl: config.ttl,
                updateAgeOnGet: true,
                updateAgeOnHas: true,
            }));
            this.hitCounts.set(type, 0);
            this.missCounts.set(type, 0);
        });
    }
    /**
     * Gets cached data if available.
     * @param cacheType Type of cache (users, buildings, etc.).
     * @param key Cache key.
     * @param _key
     * @returns Cached data or undefined.
     */
    get(cacheType, _key) {
        const cache = this.caches.get(cacheType);
        if (!cache) {
            return undefined;
        }
        const result = cache.get(_key);
        if (result !== undefined) {
            this.hitCounts.set(cacheType, (this.hitCounts.get(cacheType) || 0) + 1);
            return result;
        }
        this.missCounts.set(cacheType, (this.missCounts.get(cacheType) || 0) + 1);
        return undefined;
    }
    /**
     * Stores data in cache.
     * @param cacheType Type of cache.
     * @param key Cache key.
     * @param data Data to cache.
     * @param _key
     * @param _data
     */
    set(cacheType, _key, _data) {
        const cache = this.caches.get(cacheType);
        if (!cache) {
            return;
        }
        cache.set(_key, _data);
    }
    /**
     * Invalidates cache entries by pattern.
     * @param cacheType Type of cache.
     * @param pattern Key pattern to invalidate (supports wildcards).
     */
    invalidate(cacheType, pattern) {
        const cache = this.caches.get(cacheType);
        if (!cache) {
            return;
        }
        if (pattern) {
            // Remove entries matching pattern
            for (const key of cache.keys()) {
                if (this.matchesPattern(key, pattern)) {
                    cache.delete(key);
                }
            }
        }
        else {
            // Clear entire cache
            cache.clear();
        }
    }
    /**
     * Gets cache performance statistics.
     */
    getStats() {
        const stats = {};
        for (const [_type, cache] of this.caches) {
            const hits = this.hitCounts.get(_type) || 0;
            const misses = this.missCounts.get(_type) || 0;
            const total = hits + misses;
            const hitRate = total > 0 ? ((hits / total) * 100).toFixed(2) : '0.00';
            stats[_type] = {
                size: cache.size,
                maxSize: cache.max,
                hits,
                misses,
                hitRate: `${hitRate}%`,
                memoryUsage: this.estimateMemoryUsage(cache),
            };
        }
        return stats;
    }
    /**
     * Clears all caches.
     */
    clearAll() {
        for (const [_type, cache] of this.caches) {
            cache.clear();
            this.hitCounts.set(_type, 0);
            this.missCounts.set(_type, 0);
        }
    }
    /**
     * Pattern matching for cache key invalidation.
     * @param key
     * @param _key
     * @param pattern
     */
    matchesPattern(_key, pattern) {
        const regex = new RegExp(pattern.replace(/\*/g, '.*'));
        return regex.test(_key);
    }
    /**
     * Estimates memory usage of a cache.
     * @param cache
     */
    estimateMemoryUsage(cache) {
        let totalSize = 0;
        for (const value of cache.values()) {
            totalSize += JSON.stringify(value).length * 2; // Rough estimate
        }
        return `${(totalSize / 1024).toFixed(2)} KB`;
    }
}
exports.QueryCacheManager = QueryCacheManager;
/**
 * Global cache manager instance.
 */
exports.queryCache = new QueryCacheManager();
exports.default = exports.queryCache;
/**
 * Cached query helper function for database operations.
 * Replaces decorator approach for better compatibility.
 * @param cacheType
 * @param cacheKey
 * @param operation
 */
/**
 * WithCache function.
 * @param cacheType
 * @param cacheKey
 * @param operation
 * @returns Function result.
 */
function withCache(cacheType, cacheKey, operation) {
    return new Promise(async (resolve, reject) => {
        try {
            // Try to get from cache first
            const cached = exports.queryCache.get(cacheType, cacheKey);
            if (cached !== undefined) {
                resolve(cached);
                return;
            }
            // Execute operation
            const result = await operation();
            // Cache the result
            exports.queryCache.set(cacheType, cacheKey, result);
            resolve(result);
        }
        catch (error) {
            reject(error);
        }
    });
}
/**
 * Cache invalidation utilities for specific operations.
 * OPTIMIZED: Added smarter invalidation patterns and cascade invalidation.
 */
class CacheInvalidator {
    /**
     * Invalidates user-related caches when user data changes.
     * OPTIMIZED: More comprehensive user cache invalidation.
     * @param userId
     */
    static invalidateUserCaches(userId) {
        // Individual user caches
        exports.queryCache.invalidate('users', `user:${userId}*`);
        exports.queryCache.invalidate('users', `users_by_org:${userId}*`);
        exports.queryCache.invalidate('residences', `user_residences:${userId}*`);
        exports.queryCache.invalidate('residences', `user_residences_details:${userId}*`);
        exports.queryCache.invalidate('documents', `legacy_docs:${userId}*`);
        exports.queryCache.invalidate('notifications', `user_notifications:${userId}*`);
        // Invalidate aggregated user queries that include this user
        exports.queryCache.invalidate('users', 'all_users');
        exports.queryCache.invalidate('users', 'all_users_assignments*');
    }
    /**
     * Invalidates building-related caches when building data changes.
     * OPTIMIZED: Cascade invalidation for building dependencies.
     * @param buildingId
     */
    static invalidateBuildingCaches(buildingId) {
        // Building-specific caches
        exports.queryCache.invalidate('buildings', `building:${buildingId}*`);
        exports.queryCache.invalidate('residences', `building_residences:${buildingId}*`);
        exports.queryCache.invalidate('documents', `building_documents:${buildingId}*`);
        exports.queryCache.invalidate('financial', `building_budgets:${buildingId}*`);
        exports.queryCache.invalidate('stats', `building_stats:${buildingId}*`);
        // Invalidate aggregated building queries
        exports.queryCache.invalidate('buildings', 'all_buildings');
        exports.queryCache.invalidate('buildings', 'buildings_with_residents*');
        // Cascade invalidation - building changes affect user assignments
        exports.queryCache.invalidate('users', 'all_users_assignments*');
    }
    /**
     * Invalidates residence-related caches when residence data changes.
     * OPTIMIZED: Comprehensive residence cache invalidation.
     * @param residenceId
     */
    static invalidateResidenceCaches(residenceId) {
        // Residence-specific caches
        exports.queryCache.invalidate('residences', `residence:${residenceId}*`);
        exports.queryCache.invalidate('documents', `residence_documents:${residenceId}*`);
        exports.queryCache.invalidate('bills', `residence_bills:${residenceId}*`);
        exports.queryCache.invalidate('maintenance', `residence_maintenance:${residenceId}*`);
        // Invalidate aggregated queries that include this residence
        exports.queryCache.invalidate('residences', 'all_residences');
        exports.queryCache.invalidate('users', 'all_users_assignments*');
    }
    /**
     * Invalidates organization-related caches when organization data changes.
     * OPTIMIZED: New method for organization cache invalidation.
     * @param organizationId
     */
    static invalidateOrganizationCaches(organizationId) {
        // Organization-specific caches
        exports.queryCache.invalidate('organizations', `organization:${organizationId}*`);
        exports.queryCache.invalidate('buildings', `org_buildings:${organizationId}*`);
        exports.queryCache.invalidate('stats', `organization_overview:${organizationId}*`);
        // Invalidate aggregated queries
        exports.queryCache.invalidate('organizations', 'all_organizations');
        exports.queryCache.invalidate('users', 'all_users_assignments*');
    }
    /**
     * Invalidates document-related caches when document data changes.
     * OPTIMIZED: New method for document cache invalidation.
     * @param documentId
     * @param buildingId
     * @param residenceId
     */
    static invalidateDocumentCaches(documentId, buildingId, residenceId) {
        if (documentId) {
            exports.queryCache.invalidate('documents', `document:${documentId}*`);
        }
        if (buildingId) {
            exports.queryCache.invalidate('documents', `building_documents:${buildingId}*`);
        }
        if (residenceId) {
            exports.queryCache.invalidate('documents', `residence_documents:${residenceId}*`);
        }
        // Invalidate general document queries
        exports.queryCache.invalidate('documents', 'documents:*');
    }
    /**
     * Smart invalidation based on operation type.
     * OPTIMIZED: Intelligent cache invalidation based on operation context.
     * @param operation
     * @param entityType
     * @param entityId
     * @param additionalContext
     */
    static smartInvalidate(operation, entityType, entityId, additionalContext) {
        switch (entityType) {
            case 'user':
                this.invalidateUserCaches(entityId);
                break;
            case 'building':
                this.invalidateBuildingCaches(entityId);
                break;
            case 'residence':
                this.invalidateResidenceCaches(entityId);
                // Cascade to building if provided
                if (additionalContext?.buildingId) {
                    this.invalidateBuildingCaches(additionalContext.buildingId);
                }
                break;
            case 'organization':
                this.invalidateOrganizationCaches(entityId);
                break;
            case 'document':
                this.invalidateDocumentCaches(entityId, additionalContext?.buildingId, additionalContext?.residenceId);
                break;
        }
        // For delete operations, be more aggressive with cache clearing
        if (operation === 'delete') {
            // Clear search caches as deleted items should not appear
            exports.queryCache.invalidate('search');
        }
    }
    /**
     * Invalidates all caches (use sparingly).
     */
    static invalidateAll() {
        exports.queryCache.clearAll();
    }
}
exports.CacheInvalidator = CacheInvalidator;
/**
 * Performance monitoring for cache effectiveness.
 */
class CacheMonitor {
    /**
     * Logs cache performance statistics.
     */
    static logPerformanceStats() {
        const stats = exports.queryCache.getStats();
        console.table(stats);
    }
    /**
     * Monitors cache hit rates and suggests optimizations.
     */
    static analyzePerformance() {
        const stats = exports.queryCache.getStats();
        const suggestions = [];
        Object.entries(stats).forEach(([cacheType, stat]) => {
            const hitRate = parseFloat(stat.hitRate.replace('%', ''));
            if (hitRate < 50) {
                suggestions.push(`Low hit rate for ${cacheType} cache (${stat.hitRate}). Consider increasing TTL or cache size.`);
            }
            if (stat.size === stat.maxSize) {
                suggestions.push(`${cacheType} cache is at maximum capacity. Consider increasing max size.`);
            }
        });
        return suggestions;
    }
    /**
     * Gets memory usage summary for all caches.
     */
    static getMemoryUsage() {
        const stats = exports.queryCache.getStats();
        let totalMemory = 0;
        Object.values(stats).forEach((stat) => {
            totalMemory += parseFloat(stat.memoryUsage.replace(' KB', ''));
        });
        return `${totalMemory.toFixed(2)} KB`;
    }
}
exports.CacheMonitor = CacheMonitor;
/**
 * Automatic cache warming for frequently accessed data.
 */
class CacheWarmer {
    /**
     * Warms up caches with frequently accessed data.
     */
    static async warmCaches() {
        try {
            // This would be implemented with actual database calls
            // Example: Pre-load active users, organizations, etc.
        }
        catch (error) {
            console.error('❌ Error warming caches:', error);
        }
    }
}
exports.CacheWarmer = CacheWarmer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LE1BQU0sS0FBSyxHQUFHLGtCQUFVLENBQUMsUUFBUSxFQUFFLENBQUM7UUFDcEMsSUFBSSxXQUFXLEdBQUcsQ0FBQyxDQUFDO1FBRXBCLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBUyxFQUFFLEVBQUU7WUFDekMsV0FBVyxJQUFJLFVBQVUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNqRSxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7SUFDeEMsQ0FBQztDQUNGO0FBaERELG9DQWdEQztBQUVEOztHQUVHO0FBQ0gsTUFBYSxXQUFXO0lBQ3RCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxVQUFVO1FBRXJCLElBQUksQ0FBQztZQUNILHVEQUF1RDtZQUN2RCxzREFBc0Q7UUFDeEQsQ0FBQztRQUFDLE9BQU8sS0FBVSxFQUFFLENBQUM7WUFDcEIsT0FBTyxDQUFDLEtBQUssQ0FBQyx5QkFBeUIsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNsRCxDQUFDO0lBQ0gsQ0FBQztDQUNGO0FBYkQsa0NBYUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS9zZXJ2ZXIvcXVlcnktY2FjaGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBRdWVyeSBjYWNoaW5nIHN5c3RlbSBmb3IgUXVlYmVjIHByb3BlcnR5IG1hbmFnZW1lbnQgU2FhUy5cbiAqIEltcGxlbWVudHMgaW50ZWxsaWdlbnQgY2FjaGluZyB0byByZWR1Y2UgMTMybXMgYXZlcmFnZSBxdWVyeSB0aW1lLlxuICovXG5cbmltcG9ydCB7IExSVUNhY2hlIH0gZnJvbSAnbHJ1LWNhY2hlJztcblxuLyoqXG4gKiBDYWNoZSBjb25maWd1cmF0aW9uIGZvciBkaWZmZXJlbnQgdHlwZXMgb2YgcXVlcmllcy5cbiAqL1xuaW50ZXJmYWNlIENhY2hlQ29uZmlnIHtcbiAgbWF4U2l6ZTogbnVtYmVyO1xuICB0dGw6IG51bWJlcjsgLy8gVGltZSB0byBsaXZlIGluIG1pbGxpc2Vjb25kc1xufVxuXG4vKipcbiAqIENhY2hlIGNvbmZpZ3VyYXRpb25zIG9wdGltaXplZCBmb3IgcHJvcGVydHkgbWFuYWdlbWVudCB3b3JrbG9hZHMuXG4gKi9cbmNvbnN0IENBQ0hFX0NPTkZJR1M6IFJlY29yZDxzdHJpbmcsIENhY2hlQ29uZmlnPiA9IHtcbiAgLy8gVXNlciBkYXRhIC0gZnJlcXVlbnRseSBhY2Nlc3NlZCwgbW9kZXJhdGUgY2hhbmdlc1xuICAvLyBPUFRJTUlaRUQ6IExvbmdlciBUVEwgZm9yIGNvbXBsZXggdXNlciBhc3NpZ25tZW50cyBxdWVyeVxuICB1c2VyczogeyBtYXhTaXplOiAxNTAwLCB0dGw6IDggKiA2MCAqIDEwMDAgfSwgLy8gOCBtaW51dGVzICh3YXMgNSlcblxuICAvLyBPcmdhbml6YXRpb24gZGF0YSAtIHN0YWJsZSwgaW5mcmVxdWVudCBjaGFuZ2VzXG4gIG9yZ2FuaXphdGlvbnM6IHsgbWF4U2l6ZTogMjAwLCB0dGw6IDQ1ICogNjAgKiAxMDAwIH0sIC8vIDQ1IG1pbnV0ZXMgKHdhcyAzMClcblxuICAvLyBCdWlsZGluZyBkYXRhIC0gcmVsYXRpdmVseSBzdGFibGVcbiAgLy8gT1BUSU1JWkVEOiBJbmNyZWFzZWQgY2FjaGUgc2l6ZSBhbmQgVFRMIGZvciBidWlsZGluZyBxdWVyaWVzXG4gIGJ1aWxkaW5nczogeyBtYXhTaXplOiAxMDAwLCB0dGw6IDIwICogNjAgKiAxMDAwIH0sIC8vIDIwIG1pbnV0ZXMgKHdhcyAxNSlcblxuICAvLyBSZXNpZGVuY2UgZGF0YSAtIHN0YWJsZSBzdHJ1Y3R1cmUsIG9jY2FzaW9uYWwgdXBkYXRlc1xuICAvLyBPUFRJTUlaRUQ6IEluY3JlYXNlZCBjYWNoZSBzaXplIGZvciByZXNpZGVuY2UgcXVlcmllc1xuICByZXNpZGVuY2VzOiB7IG1heFNpemU6IDMwMDAsIHR0bDogMTIgKiA2MCAqIDEwMDAgfSwgLy8gMTIgbWludXRlcyAod2FzIDEwKVxuXG4gIC8vIERvY3VtZW50cyAtIGZyZXF1ZW50bHkgYWNjZXNzZWQsIG1vZGVyYXRlIHVwZGF0ZXNcbiAgLy8gT1BUSU1JWkVEOiBOZXcgY2FjaGUgY2F0ZWdvcnkgZm9yIGRvY3VtZW50IHF1ZXJpZXNcbiAgZG9jdW1lbnRzOiB7IG1heFNpemU6IDIwMDAsIHR0bDogMTAgKiA2MCAqIDEwMDAgfSwgLy8gMTAgbWludXRlc1xuXG4gIC8vIEJpbGxzIC0gdGltZS1zZW5zaXRpdmUsIGZyZXF1ZW50IHVwZGF0ZXNcbiAgYmlsbHM6IHsgbWF4U2l6ZTogMTUwMCwgdHRsOiAzICogNjAgKiAxMDAwIH0sIC8vIDMgbWludXRlcyAod2FzIDIpXG5cbiAgLy8gTWFpbnRlbmFuY2UgcmVxdWVzdHMgLSBkeW5hbWljLCBmcmVxdWVudCBzdGF0dXMgY2hhbmdlc1xuICBtYWludGVuYW5jZTogeyBtYXhTaXplOiA3NTAsIHR0bDogOTAgKiAxMDAwIH0sIC8vIDkwIHNlY29uZHMgKHdhcyA2MClcblxuICAvLyBOb3RpZmljYXRpb25zIC0gcmVhbC10aW1lLCBzaG9ydCBjYWNoZVxuICBub3RpZmljYXRpb25zOiB7IG1heFNpemU6IDEwMDAsIHR0bDogNDUgKiAxMDAwIH0sIC8vIDQ1IHNlY29uZHMgKHdhcyAzMClcblxuICAvLyBRdWFsaXR5IG1ldHJpY3MgLSBzdGFibGUgZm9yIHBlcmlvZHNcbiAgbWV0cmljczogeyBtYXhTaXplOiAzMDAsIHR0bDogOCAqIDYwICogMTAwMCB9LCAvLyA4IG1pbnV0ZXMgKHdhcyA1KVxuXG4gIC8vIEZlYXR1cmVzIGFuZCByb2FkbWFwIC0gbW9kZXJhdGVseSBzdGFibGVcbiAgZmVhdHVyZXM6IHsgbWF4U2l6ZTogNTAwLCB0dGw6IDUgKiA2MCAqIDEwMDAgfSwgLy8gNSBtaW51dGVzICh3YXMgMylcblxuICAvLyBGcmFtZXdvcmsgY29uZmlndXJhdGlvbiAtIHZlcnkgc3RhYmxlXG4gIGNvbmZpZzogeyBtYXhTaXplOiAxNTAsIHR0bDogOTAgKiA2MCAqIDEwMDAgfSwgLy8gMS41IGhvdXJzICh3YXMgMSlcblxuICAvLyBCdWcgcmVwb3J0cyAtIG1vZGVyYXRlIGNoYW5nZXMsIHVzZXItc3BlY2lmaWNcbiAgYnVnczogeyBtYXhTaXplOiA3NTAsIHR0bDogNCAqIDYwICogMTAwMCB9LCAvLyA0IG1pbnV0ZXMgKHdhcyAyKVxuXG4gIC8vIEZpbmFuY2lhbCBkYXRhIC0gbW9kZXJhdGUgY2hhbmdlcywgaW1wb3J0YW50IGZvciBkYXNoYm9hcmRcbiAgZmluYW5jaWFsOiB7IG1heFNpemU6IDUwMCwgdHRsOiA1ICogNjAgKiAxMDAwIH0sIC8vIDUgbWludXRlc1xuXG4gIC8vIFNlYXJjaCByZXN1bHRzIC0gdGVtcG9yYXJ5IGJ1dCBmcmVxdWVudGx5IGFjY2Vzc2VkXG4gIHNlYXJjaDogeyBtYXhTaXplOiAxMDAwLCB0dGw6IDIgKiA2MCAqIDEwMDAgfSwgLy8gMiBtaW51dGVzXG5cbiAgLy8gU3RhdGlzdGljcyBhbmQgYWdncmVnYXRpb25zIC0gZXhwZW5zaXZlIHRvIGNvbXB1dGVcbiAgc3RhdHM6IHsgbWF4U2l6ZTogMzAwLCB0dGw6IDEwICogNjAgKiAxMDAwIH0sIC8vIDEwIG1pbnV0ZXNcbn07XG5cbi8qKlxuICogQ2FjaGUgaW5zdGFuY2VzIGZvciBkaWZmZXJlbnQgZGF0YSB0eXBlcy5cbiAqL1xuY2xhc3MgUXVlcnlDYWNoZU1hbmFnZXIge1xuICBwcml2YXRlIGNhY2hlczogTWFwPHN0cmluZywgTFJVQ2FjaGU8c3RyaW5nLCBhbnk+PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBoaXRDb3VudHM6IE1hcDxzdHJpbmcsIG51bWJlcj4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgbWlzc0NvdW50czogTWFwPHN0cmluZywgbnVtYmVyPiA9IG5ldyBNYXAoKTtcblxuICAvKipcbiAgICpcbiAgICovXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIEluaXRpYWxpemUgY2FjaGVzIGZvciBlYWNoIGRhdGEgdHlwZVxuICAgIE9iamVjdC5lbnRyaWVzKENBQ0hFX0NPTkZJR1MpLmZvckVhY2goKFt0eXBlLCBjb25maWddKSA9PiB7XG4gICAgICB0aGlzLmNhY2hlcy5zZXQoXG4gICAgICAgIHR5cGUsXG4gICAgICAgIG5ldyBMUlVDYWNoZSh7XG4gICAgICAgICAgbWF4OiBjb25maWcubWF4U2l6ZSxcbiAgICAgICAgICB0dGw6IGNvbmZpZy50dGwsXG4gICAgICAgICAgdXBkYXRlQWdlT25HZXQ6IHRydWUsXG4gICAgICAgICAgdXBkYXRlQWdlT25IYXM6IHRydWUsXG4gICAgICAgIH0pXG4gICAgICApO1xuICAgICAgdGhpcy5oaXRDb3VudHMuc2V0KHR5cGUsIDApO1xuICAgICAgdGhpcy5taXNzQ291bnRzLnNldCh0eXBlLCAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIGNhY2hlZCBkYXRhIGlmIGF2YWlsYWJsZS5cbiAgICogQHBhcmFtIGNhY2hlVHlwZSBUeXBlIG9mIGNhY2hlICh1c2VycywgYnVpbGRpbmdzLCBldGMuKS5cbiAgICogQHBhcmFtIGtleSBDYWNoZSBrZXkuXG4gICAqIEBwYXJhbSBfa2V5XG4gICAqIEByZXR1cm5zIENhY2hlZCBkYXRhIG9yIHVuZGVmaW5lZC5cbiAgICovXG4gIGdldDxUPihjYWNoZVR5cGU6IHN0cmluZywgX2tleTogc3RyaW5nKTogVCB8IHVuZGVmaW5lZCB7XG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlcy5nZXQoY2FjaGVUeXBlKTtcbiAgICBpZiAoIWNhY2hlKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdCA9IGNhY2hlLmdldChfa2V5KTtcbiAgICBpZiAocmVzdWx0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHRoaXMuaGl0Q291bnRzLnNldChjYWNoZVR5cGUsICh0aGlzLmhpdENvdW50cy5nZXQoY2FjaGVUeXBlKSB8fCAwKSArIDEpO1xuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG5cbiAgICB0aGlzLm1pc3NDb3VudHMuc2V0KGNhY2hlVHlwZSwgKHRoaXMubWlzc0NvdW50cy5nZXQoY2FjaGVUeXBlKSB8fCAwKSArIDEpO1xuICAgIHJldHVybiB1bmRlZmluZWQ7XG4gIH1cblxuICAvKipcbiAgICogU3RvcmVzIGRhdGEgaW4gY2FjaGUuXG4gICAqIEBwYXJhbSBjYWNoZVR5cGUgVHlwZSBvZiBjYWNoZS5cbiAgICogQHBhcmFtIGtleSBDYWNoZSBrZXkuXG4gICAqIEBwYXJhbSBkYXRhIERhdGEgdG8gY2FjaGUuXG4gICAqIEBwYXJhbSBfa2V5XG4gICAqIEBwYXJhbSBfZGF0YVxuICAgKi9cbiAgc2V0PFQ+KGNhY2hlVHlwZTogc3RyaW5nLCBfa2V5OiBzdHJpbmcsIF9kYXRhOiBUKTogdm9pZCB7XG4gICAgY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlcy5nZXQoY2FjaGVUeXBlKTtcbiAgICBpZiAoIWNhY2hlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY2FjaGUuc2V0KF9rZXksIF9kYXRhKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbnZhbGlkYXRlcyBjYWNoZSBlbnRyaWVzIGJ5IHBhdHRlcm4uXG4gICAqIEBwYXJhbSBjYWNoZVR5cGUgVHlwZSBvZiBjYWNoZS5cbiAgICogQHBhcmFtIHBhdHRlcm4gS2V5IHBhdHRlcm4gdG8gaW52YWxpZGF0ZSAoc3VwcG9ydHMgd2lsZGNhcmRzKS5cbiAgICovXG4gIGludmFsaWRhdGUoY2FjaGVUeXBlOiBzdHJpbmcsIHBhdHRlcm4/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBjYWNoZSA9IHRoaXMuY2FjaGVzLmdldChjYWNoZVR5cGUpO1xuICAgIGlmICghY2FjaGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAocGF0dGVybikge1xuICAgICAgLy8gUmVtb3ZlIGVudHJpZXMgbWF0Y2hpbmcgcGF0dGVyblxuICAgICAgZm9yIChjb25zdCBrZXkgb2YgY2FjaGUua2V5cygpKSB7XG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXNQYXR0ZXJuKGtleSwgcGF0dGVybikpIHtcbiAgICAgICAgICBjYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDbGVhciBlbnRpcmUgY2FjaGVcbiAgICAgIGNhY2hlLmNsZWFyKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgY2FjaGUgcGVyZm9ybWFuY2Ugc3RhdGlzdGljcy5cbiAgICovXG4gIGdldFN0YXRzKCk6IFJlY29yZDxzdHJpbmcsIGFueT4ge1xuICAgIGNvbnN0IHN0YXRzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG5cbiAgICBmb3IgKGNvbnN0IFtfdHlwZSwgY2FjaGVdIG9mIHRoaXMuY2FjaGVzKSB7XG4gICAgICBjb25zdCBoaXRzID0gdGhpcy5oaXRDb3VudHMuZ2V0KF90eXBlKSB8fCAwO1xuICAgICAgY29uc3QgbWlzc2VzID0gdGhpcy5taXNzQ291bnRzLmdldChfdHlwZSkgfHwgMDtcbiAgICAgIGNvbnN0IHRvdGFsID0gaGl0cyArIG1pc3NlcztcbiAgICAgIGNvbnN0IGhpdFJhdGUgPSB0b3RhbCA+IDAgPyAoKGhpdHMgLyB0b3RhbCkgKiAxMDApLnRvRml4ZWQoMikgOiAnMC4wMCc7XG5cbiAgICAgIHN0YXRzW190eXBlXSA9IHtcbiAgICAgICAgc2l6ZTogY2FjaGUuc2l6ZSxcbiAgICAgICAgbWF4U2l6ZTogY2FjaGUubWF4LFxuICAgICAgICBoaXRzLFxuICAgICAgICBtaXNzZXMsXG4gICAgICAgIGhpdFJhdGU6IGAke2hpdFJhdGV9JWAsXG4gICAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLmVzdGltYXRlTWVtb3J5VXNhZ2UoY2FjaGUpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4gc3RhdHM7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXJzIGFsbCBjYWNoZXMuXG4gICAqL1xuICBjbGVhckFsbCgpOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IFtfdHlwZSwgY2FjaGVdIG9mIHRoaXMuY2FjaGVzKSB7XG4gICAgICBjYWNoZS5jbGVhcigpO1xuICAgICAgdGhpcy5oaXRDb3VudHMuc2V0KF90eXBlLCAwKTtcbiAgICAgIHRoaXMubWlzc0NvdW50cy5zZXQoX3R5cGUsIDApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQYXR0ZXJuIG1hdGNoaW5nIGZvciBjYWNoZSBrZXkgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0ga2V5XG4gICAqIEBwYXJhbSBfa2V5XG4gICAqIEBwYXJhbSBwYXR0ZXJuXG4gICAqL1xuICBwcml2YXRlIG1hdGNoZXNQYXR0ZXJuKF9rZXk6IHN0cmluZywgcGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgvXFwqL2csICcuKicpKTtcbiAgICByZXR1cm4gcmVnZXgudGVzdChfa2V5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFc3RpbWF0ZXMgbWVtb3J5IHVzYWdlIG9mIGEgY2FjaGUuXG4gICAqIEBwYXJhbSBjYWNoZVxuICAgKi9cbiAgcHJpdmF0ZSBlc3RpbWF0ZU1lbW9yeVVzYWdlKGNhY2hlOiBMUlVDYWNoZTxzdHJpbmcsIGFueT4pOiBzdHJpbmcge1xuICAgIGxldCB0b3RhbFNpemUgPSAwO1xuICAgIGZvciAoY29uc3QgdmFsdWUgb2YgY2FjaGUudmFsdWVzKCkpIHtcbiAgICAgIHRvdGFsU2l6ZSArPSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkubGVuZ3RoICogMjsgLy8gUm91Z2ggZXN0aW1hdGVcbiAgICB9XG4gICAgcmV0dXJuIGAkeyh0b3RhbFNpemUgLyAxMDI0KS50b0ZpeGVkKDIpfSBLQmA7XG4gIH1cbn1cblxuLyoqXG4gKiBHbG9iYWwgY2FjaGUgbWFuYWdlciBpbnN0YW5jZS5cbiAqL1xuZXhwb3J0IGNvbnN0IHF1ZXJ5Q2FjaGUgPSBuZXcgUXVlcnlDYWNoZU1hbmFnZXIoKTtcblxuLyoqXG4gKiBDYWNoZWQgcXVlcnkgaGVscGVyIGZ1bmN0aW9uIGZvciBkYXRhYmFzZSBvcGVyYXRpb25zLlxuICogUmVwbGFjZXMgZGVjb3JhdG9yIGFwcHJvYWNoIGZvciBiZXR0ZXIgY29tcGF0aWJpbGl0eS5cbiAqIEBwYXJhbSBjYWNoZVR5cGVcbiAqIEBwYXJhbSBjYWNoZUtleVxuICogQHBhcmFtIG9wZXJhdGlvblxuICovXG4vKipcbiAqIFdpdGhDYWNoZSBmdW5jdGlvbi5cbiAqIEBwYXJhbSBjYWNoZVR5cGVcbiAqIEBwYXJhbSBjYWNoZUtleVxuICogQHBhcmFtIG9wZXJhdGlvblxuICogQHJldHVybnMgRnVuY3Rpb24gcmVzdWx0LlxuICovXG5leHBvcnQgZnVuY3Rpb24gd2l0aENhY2hlPFQ+KFxuICBjYWNoZVR5cGU6IHN0cmluZyxcbiAgY2FjaGVLZXk6IHN0cmluZyxcbiAgb3BlcmF0aW9uOiAoKSA9PiBQcm9taXNlPFQ+XG4pOiBQcm9taXNlPFQ+IHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVHJ5IHRvIGdldCBmcm9tIGNhY2hlIGZpcnN0XG4gICAgICBjb25zdCBjYWNoZWQgPSBxdWVyeUNhY2hlLmdldDxUPihjYWNoZVR5cGUsIGNhY2hlS2V5KTtcbiAgICAgIGlmIChjYWNoZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXNvbHZlKGNhY2hlZCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gRXhlY3V0ZSBvcGVyYXRpb25cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IG9wZXJhdGlvbigpO1xuXG4gICAgICAvLyBDYWNoZSB0aGUgcmVzdWx0XG4gICAgICBxdWVyeUNhY2hlLnNldChjYWNoZVR5cGUsIGNhY2hlS2V5LCByZXN1bHQpO1xuXG4gICAgICByZXNvbHZlKHJlc3VsdCk7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIENhY2hlIGludmFsaWRhdGlvbiB1dGlsaXRpZXMgZm9yIHNwZWNpZmljIG9wZXJhdGlvbnMuXG4gKiBPUFRJTUlaRUQ6IEFkZGVkIHNtYXJ0ZXIgaW52YWxpZGF0aW9uIHBhdHRlcm5zIGFuZCBjYXNjYWRlIGludmFsaWRhdGlvbi5cbiAqL1xuZXhwb3J0IGNsYXNzIENhY2hlSW52YWxpZGF0b3Ige1xuICAvKipcbiAgICogSW52YWxpZGF0ZXMgdXNlci1yZWxhdGVkIGNhY2hlcyB3aGVuIHVzZXIgZGF0YSBjaGFuZ2VzLlxuICAgKiBPUFRJTUlaRUQ6IE1vcmUgY29tcHJlaGVuc2l2ZSB1c2VyIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIHVzZXJJZFxuICAgKi9cbiAgc3RhdGljIGludmFsaWRhdGVVc2VyQ2FjaGVzKHVzZXJJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gSW5kaXZpZHVhbCB1c2VyIGNhY2hlc1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCBgdXNlcjoke3VzZXJJZH0qYCk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd1c2VycycsIGB1c2Vyc19ieV9vcmc6JHt1c2VySWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncmVzaWRlbmNlcycsIGB1c2VyX3Jlc2lkZW5jZXM6JHt1c2VySWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncmVzaWRlbmNlcycsIGB1c2VyX3Jlc2lkZW5jZXNfZGV0YWlsczoke3VzZXJJZH0qYCk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdkb2N1bWVudHMnLCBgbGVnYWN5X2RvY3M6JHt1c2VySWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnbm90aWZpY2F0aW9ucycsIGB1c2VyX25vdGlmaWNhdGlvbnM6JHt1c2VySWR9KmApO1xuICAgIFxuICAgIC8vIEludmFsaWRhdGUgYWdncmVnYXRlZCB1c2VyIHF1ZXJpZXMgdGhhdCBpbmNsdWRlIHRoaXMgdXNlclxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzJyk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCd1c2VycycsICdhbGxfdXNlcnNfYXNzaWdubWVudHMqJyk7XG4gIH1cblxuICAvKipcbiAgICogSW52YWxpZGF0ZXMgYnVpbGRpbmctcmVsYXRlZCBjYWNoZXMgd2hlbiBidWlsZGluZyBkYXRhIGNoYW5nZXMuXG4gICAqIE9QVElNSVpFRDogQ2FzY2FkZSBpbnZhbGlkYXRpb24gZm9yIGJ1aWxkaW5nIGRlcGVuZGVuY2llcy5cbiAgICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAgICovXG4gIHN0YXRpYyBpbnZhbGlkYXRlQnVpbGRpbmdDYWNoZXMoYnVpbGRpbmdJZDogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gQnVpbGRpbmctc3BlY2lmaWMgY2FjaGVzXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWlsZGluZ3MnLCBgYnVpbGRpbmc6JHtidWlsZGluZ0lkfSpgKTtcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3Jlc2lkZW5jZXMnLCBgYnVpbGRpbmdfcmVzaWRlbmNlczoke2J1aWxkaW5nSWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYGJ1aWxkaW5nX2RvY3VtZW50czoke2J1aWxkaW5nSWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZmluYW5jaWFsJywgYGJ1aWxkaW5nX2J1ZGdldHM6JHtidWlsZGluZ0lkfSpgKTtcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3N0YXRzJywgYGJ1aWxkaW5nX3N0YXRzOiR7YnVpbGRpbmdJZH0qYCk7XG4gICAgXG4gICAgLy8gSW52YWxpZGF0ZSBhZ2dyZWdhdGVkIGJ1aWxkaW5nIHF1ZXJpZXNcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2J1aWxkaW5ncycsICdhbGxfYnVpbGRpbmdzJyk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWlsZGluZ3MnLCAnYnVpbGRpbmdzX3dpdGhfcmVzaWRlbnRzKicpO1xuICAgIFxuICAgIC8vIENhc2NhZGUgaW52YWxpZGF0aW9uIC0gYnVpbGRpbmcgY2hhbmdlcyBhZmZlY3QgdXNlciBhc3NpZ25tZW50c1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzX2Fzc2lnbm1lbnRzKicpO1xuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGVzIHJlc2lkZW5jZS1yZWxhdGVkIGNhY2hlcyB3aGVuIHJlc2lkZW5jZSBkYXRhIGNoYW5nZXMuXG4gICAqIE9QVElNSVpFRDogQ29tcHJlaGVuc2l2ZSByZXNpZGVuY2UgY2FjaGUgaW52YWxpZGF0aW9uLlxuICAgKiBAcGFyYW0gcmVzaWRlbmNlSWRcbiAgICovXG4gIHN0YXRpYyBpbnZhbGlkYXRlUmVzaWRlbmNlQ2FjaGVzKHJlc2lkZW5jZUlkOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBSZXNpZGVuY2Utc3BlY2lmaWMgY2FjaGVzXG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdyZXNpZGVuY2VzJywgYHJlc2lkZW5jZToke3Jlc2lkZW5jZUlkfSpgKTtcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGByZXNpZGVuY2VfZG9jdW1lbnRzOiR7cmVzaWRlbmNlSWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnYmlsbHMnLCBgcmVzaWRlbmNlX2JpbGxzOiR7cmVzaWRlbmNlSWR9KmApO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnbWFpbnRlbmFuY2UnLCBgcmVzaWRlbmNlX21haW50ZW5hbmNlOiR7cmVzaWRlbmNlSWR9KmApO1xuICAgIFxuICAgIC8vIEludmFsaWRhdGUgYWdncmVnYXRlZCBxdWVyaWVzIHRoYXQgaW5jbHVkZSB0aGlzIHJlc2lkZW5jZVxuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgncmVzaWRlbmNlcycsICdhbGxfcmVzaWRlbmNlcycpO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzX2Fzc2lnbm1lbnRzKicpO1xuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGVzIG9yZ2FuaXphdGlvbi1yZWxhdGVkIGNhY2hlcyB3aGVuIG9yZ2FuaXphdGlvbiBkYXRhIGNoYW5nZXMuXG4gICAqIE9QVElNSVpFRDogTmV3IG1ldGhvZCBmb3Igb3JnYW5pemF0aW9uIGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIG9yZ2FuaXphdGlvbklkXG4gICAqL1xuICBzdGF0aWMgaW52YWxpZGF0ZU9yZ2FuaXphdGlvbkNhY2hlcyhvcmdhbml6YXRpb25JZDogc3RyaW5nKTogdm9pZCB7XG4gICAgLy8gT3JnYW5pemF0aW9uLXNwZWNpZmljIGNhY2hlc1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnb3JnYW5pemF0aW9ucycsIGBvcmdhbml6YXRpb246JHtvcmdhbml6YXRpb25JZH0qYCk7XG4gICAgcXVlcnlDYWNoZS5pbnZhbGlkYXRlKCdidWlsZGluZ3MnLCBgb3JnX2J1aWxkaW5nczoke29yZ2FuaXphdGlvbklkfSpgKTtcbiAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ3N0YXRzJywgYG9yZ2FuaXphdGlvbl9vdmVydmlldzoke29yZ2FuaXphdGlvbklkfSpgKTtcbiAgICBcbiAgICAvLyBJbnZhbGlkYXRlIGFnZ3JlZ2F0ZWQgcXVlcmllc1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnb3JnYW5pemF0aW9ucycsICdhbGxfb3JnYW5pemF0aW9ucycpO1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgndXNlcnMnLCAnYWxsX3VzZXJzX2Fzc2lnbm1lbnRzKicpO1xuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGVzIGRvY3VtZW50LXJlbGF0ZWQgY2FjaGVzIHdoZW4gZG9jdW1lbnQgZGF0YSBjaGFuZ2VzLlxuICAgKiBPUFRJTUlaRUQ6IE5ldyBtZXRob2QgZm9yIGRvY3VtZW50IGNhY2hlIGludmFsaWRhdGlvbi5cbiAgICogQHBhcmFtIGRvY3VtZW50SWRcbiAgICogQHBhcmFtIGJ1aWxkaW5nSWRcbiAgICogQHBhcmFtIHJlc2lkZW5jZUlkXG4gICAqL1xuICBzdGF0aWMgaW52YWxpZGF0ZURvY3VtZW50Q2FjaGVzKGRvY3VtZW50SWQ/OiBzdHJpbmcsIGJ1aWxkaW5nSWQ/OiBzdHJpbmcsIHJlc2lkZW5jZUlkPzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKGRvY3VtZW50SWQpIHtcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgYGRvY3VtZW50OiR7ZG9jdW1lbnRJZH0qYCk7XG4gICAgfVxuICAgIFxuICAgIGlmIChidWlsZGluZ0lkKSB7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGBidWlsZGluZ19kb2N1bWVudHM6JHtidWlsZGluZ0lkfSpgKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHJlc2lkZW5jZUlkKSB7XG4gICAgICBxdWVyeUNhY2hlLmludmFsaWRhdGUoJ2RvY3VtZW50cycsIGByZXNpZGVuY2VfZG9jdW1lbnRzOiR7cmVzaWRlbmNlSWR9KmApO1xuICAgIH1cbiAgICBcbiAgICAvLyBJbnZhbGlkYXRlIGdlbmVyYWwgZG9jdW1lbnQgcXVlcmllc1xuICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnZG9jdW1lbnRzJywgJ2RvY3VtZW50czoqJyk7XG4gIH1cblxuICAvKipcbiAgICogU21hcnQgaW52YWxpZGF0aW9uIGJhc2VkIG9uIG9wZXJhdGlvbiB0eXBlLlxuICAgKiBPUFRJTUlaRUQ6IEludGVsbGlnZW50IGNhY2hlIGludmFsaWRhdGlvbiBiYXNlZCBvbiBvcGVyYXRpb24gY29udGV4dC5cbiAgICogQHBhcmFtIG9wZXJhdGlvblxuICAgKiBAcGFyYW0gZW50aXR5VHlwZVxuICAgKiBAcGFyYW0gZW50aXR5SWRcbiAgICogQHBhcmFtIGFkZGl0aW9uYWxDb250ZXh0XG4gICAqL1xuICBzdGF0aWMgc21hcnRJbnZhbGlkYXRlKFxuICAgIG9wZXJhdGlvbjogJ2NyZWF0ZScgfCAndXBkYXRlJyB8ICdkZWxldGUnLFxuICAgIGVudGl0eVR5cGU6ICd1c2VyJyB8ICdidWlsZGluZycgfCAncmVzaWRlbmNlJyB8ICdvcmdhbml6YXRpb24nIHwgJ2RvY3VtZW50JyxcbiAgICBlbnRpdHlJZDogc3RyaW5nLFxuICAgIGFkZGl0aW9uYWxDb250ZXh0PzogeyBidWlsZGluZ0lkPzogc3RyaW5nOyByZXNpZGVuY2VJZD86IHN0cmluZzsgdXNlcklkPzogc3RyaW5nIH1cbiAgKTogdm9pZCB7XG4gICAgc3dpdGNoIChlbnRpdHlUeXBlKSB7XG4gICAgICBjYXNlICd1c2VyJzpcbiAgICAgICAgdGhpcy5pbnZhbGlkYXRlVXNlckNhY2hlcyhlbnRpdHlJZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnYnVpbGRpbmcnOlxuICAgICAgICB0aGlzLmludmFsaWRhdGVCdWlsZGluZ0NhY2hlcyhlbnRpdHlJZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAncmVzaWRlbmNlJzpcbiAgICAgICAgdGhpcy5pbnZhbGlkYXRlUmVzaWRlbmNlQ2FjaGVzKGVudGl0eUlkKTtcbiAgICAgICAgLy8gQ2FzY2FkZSB0byBidWlsZGluZyBpZiBwcm92aWRlZFxuICAgICAgICBpZiAoYWRkaXRpb25hbENvbnRleHQ/LmJ1aWxkaW5nSWQpIHtcbiAgICAgICAgICB0aGlzLmludmFsaWRhdGVCdWlsZGluZ0NhY2hlcyhhZGRpdGlvbmFsQ29udGV4dC5idWlsZGluZ0lkKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ29yZ2FuaXphdGlvbic6XG4gICAgICAgIHRoaXMuaW52YWxpZGF0ZU9yZ2FuaXphdGlvbkNhY2hlcyhlbnRpdHlJZCk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZG9jdW1lbnQnOlxuICAgICAgICB0aGlzLmludmFsaWRhdGVEb2N1bWVudENhY2hlcyhcbiAgICAgICAgICBlbnRpdHlJZCxcbiAgICAgICAgICBhZGRpdGlvbmFsQ29udGV4dD8uYnVpbGRpbmdJZCxcbiAgICAgICAgICBhZGRpdGlvbmFsQ29udGV4dD8ucmVzaWRlbmNlSWRcbiAgICAgICAgKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuXG4gICAgLy8gRm9yIGRlbGV0ZSBvcGVyYXRpb25zLCBiZSBtb3JlIGFnZ3Jlc3NpdmUgd2l0aCBjYWNoZSBjbGVhcmluZ1xuICAgIGlmIChvcGVyYXRpb24gPT09ICdkZWxldGUnKSB7XG4gICAgICAvLyBDbGVhciBzZWFyY2ggY2FjaGVzIGFzIGRlbGV0ZWQgaXRlbXMgc2hvdWxkIG5vdCBhcHBlYXJcbiAgICAgIHF1ZXJ5Q2FjaGUuaW52YWxpZGF0ZSgnc2VhcmNoJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEludmFsaWRhdGVzIGFsbCBjYWNoZXMgKHVzZSBzcGFyaW5nbHkpLlxuICAgKi9cbiAgc3RhdGljIGludmFsaWRhdGVBbGwoKTogdm9pZCB7XG4gICAgcXVlcnlDYWNoZS5jbGVhckFsbCgpO1xuICB9XG59XG5cbi8qKlxuICogUGVyZm9ybWFuY2UgbW9uaXRvcmluZyBmb3IgY2FjaGUgZWZmZWN0aXZlbmVzcy5cbiAqL1xuZXhwb3J0IGNsYXNzIENhY2hlTW9uaXRvciB7XG4gIC8qKlxuICAgKiBMb2dzIGNhY2hlIHBlcmZvcm1hbmNlIHN0YXRpc3RpY3MuXG4gICAqL1xuICBzdGF0aWMgbG9nUGVyZm9ybWFuY2VTdGF0cygpOiB2b2lkIHtcbiAgICBjb25zdCBzdGF0cyA9IHF1ZXJ5Q2FjaGUuZ2V0U3RhdHMoKTtcbiAgICBjb25zb2xlLnRhYmxlKHN0YXRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb25pdG9ycyBjYWNoZSBoaXQgcmF0ZXMgYW5kIHN1Z2dlc3RzIG9wdGltaXphdGlvbnMuXG4gICAqL1xuICBzdGF0aWMgYW5hbHl6ZVBlcmZvcm1hbmNlKCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBzdGF0cyA9IHF1ZXJ5Q2FjaGUuZ2V0U3RhdHMoKTtcbiAgICBjb25zdCBzdWdnZXN0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIE9iamVjdC5lbnRyaWVzKHN0YXRzKS5mb3JFYWNoKChbY2FjaGVUeXBlLCBzdGF0XSkgPT4ge1xuICAgICAgY29uc3QgaGl0UmF0ZSA9IHBhcnNlRmxvYXQoc3RhdC5oaXRSYXRlLnJlcGxhY2UoJyUnLCAnJykpO1xuXG4gICAgICBpZiAoaGl0UmF0ZSA8IDUwKSB7XG4gICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goXG4gICAgICAgICAgYExvdyBoaXQgcmF0ZSBmb3IgJHtjYWNoZVR5cGV9IGNhY2hlICgke3N0YXQuaGl0UmF0ZX0pLiBDb25zaWRlciBpbmNyZWFzaW5nIFRUTCBvciBjYWNoZSBzaXplLmBcbiAgICAgICAgKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHN0YXQuc2l6ZSA9PT0gc3RhdC5tYXhTaXplKSB7XG4gICAgICAgIHN1Z2dlc3Rpb25zLnB1c2goXG4gICAgICAgICAgYCR7Y2FjaGVUeXBlfSBjYWNoZSBpcyBhdCBtYXhpbXVtIGNhcGFjaXR5LiBDb25zaWRlciBpbmNyZWFzaW5nIG1heCBzaXplLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBzdWdnZXN0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIG1lbW9yeSB1c2FnZSBzdW1tYXJ5IGZvciBhbGwgY2FjaGVzLlxuICAgKi9cbiAgc3RhdGljIGdldE1lbW9yeVVzYWdlKCk6IHN0cmluZyB7XG4gICAgY29uc3Qgc3RhdHMgPSBxdWVyeUNhY2hlLmdldFN0YXRzKCk7XG4gICAgbGV0IHRvdGFsTWVtb3J5ID0gMDtcblxuICAgIE9iamVjdC52YWx1ZXMoc3RhdHMpLmZvckVhY2goKHN0YXQ6IGFueSkgPT4ge1xuICAgICAgdG90YWxNZW1vcnkgKz0gcGFyc2VGbG9hdChzdGF0Lm1lbW9yeVVzYWdlLnJlcGxhY2UoJyBLQicsICcnKSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gYCR7dG90YWxNZW1vcnkudG9GaXhlZCgyKX0gS0JgO1xuICB9XG59XG5cbi8qKlxuICogQXV0b21hdGljIGNhY2hlIHdhcm1pbmcgZm9yIGZyZXF1ZW50bHkgYWNjZXNzZWQgZGF0YS5cbiAqL1xuZXhwb3J0IGNsYXNzIENhY2hlV2FybWVyIHtcbiAgLyoqXG4gICAqIFdhcm1zIHVwIGNhY2hlcyB3aXRoIGZyZXF1ZW50bHkgYWNjZXNzZWQgZGF0YS5cbiAgICovXG4gIHN0YXRpYyBhc3luYyB3YXJtQ2FjaGVzKCk6IFByb21pc2U8dm9pZD4ge1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRoaXMgd291bGQgYmUgaW1wbGVtZW50ZWQgd2l0aCBhY3R1YWwgZGF0YWJhc2UgY2FsbHNcbiAgICAgIC8vIEV4YW1wbGU6IFByZS1sb2FkIGFjdGl2ZSB1c2Vycywgb3JnYW5pemF0aW9ucywgZXRjLlxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB3YXJtaW5nIGNhY2hlczonLCBlcnJvcik7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRXhwb3J0IGNhY2hlIHV0aWxpdGllcyBmb3IgZWFzeSBhY2Nlc3MuXG4gKi9cbmV4cG9ydCB7IHF1ZXJ5Q2FjaGUgYXMgZGVmYXVsdCwgUXVlcnlDYWNoZU1hbmFnZXIsIENBQ0hFX0NPTkZJR1MgfTtcbiJdLCJ2ZXJzaW9uIjozfQ==