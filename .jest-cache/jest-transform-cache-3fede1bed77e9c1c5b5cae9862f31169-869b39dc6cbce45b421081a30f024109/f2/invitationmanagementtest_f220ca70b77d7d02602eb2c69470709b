8b53cb0468ff07e32c7d489065b01f86
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Unit test using mocks - moved server imports to integration tests
// import request from 'supertest';
// import { app } from '../../../server/index';
// import { mockDb } from '../../../server/mockDb';
const schema = __importStar(require("../../../shared/schema"));
const drizzle_orm_1 = require("drizzle-orm");
const bcryptjs_1 = __importDefault(require("bcryptjs"));
const unified_database_mock_1 = require("../../mocks/unified-database-mock");
// Using unified database mock for consistency
// Mock request for API testing (simplified for unit testing)
const mockRequest = {
    post: globals_1.jest.fn(),
    get: globals_1.jest.fn(),
    put: globals_1.jest.fn(),
    delete: globals_1.jest.fn()
};
(0, globals_1.describe)('Invitation Management API', () => {
    let adminUser;
    let managerUser;
    let tenantUser;
    let organization1;
    let organization2;
    let testInvitation1;
    let testInvitation2;
    let adminCookie;
    let managerCookie;
    let tenantCookie;
    (0, globals_1.beforeEach)(async () => {
        // Reset mock data and clear all mocks
        unified_database_mock_1.testUtils.resetMocks();
        // Create test organizations
        const org1 = {
            id: 'org1-id',
            name: 'Test Organization 1',
            type: 'management_company',
            address: '123 Test St',
            city: 'Montreal',
            province: 'QC',
            postalCode: 'H1A 1A1',
        };
        organization1 = org1;
        const org2 = {
            id: 'org2-id',
            name: 'Test Organization 2',
            type: 'syndicate',
            address: '456 Test Ave',
            city: 'Quebec City',
            province: 'QC',
            postalCode: 'G1A 1A1',
        };
        organization2 = org2;
        // Create test users
        const hashedPassword = await bcryptjs_1.default.hash('password123', 10);
        const admin = {
            id: 'admin-id',
            username: 'admin@test.com',
            email: 'admin@test.com',
            password: hashedPassword,
            firstName: 'Admin',
            lastName: 'User',
            role: 'admin',
            language: 'en',
        };
        adminUser = admin;
        const manager = {
            id: 'manager-id',
            username: 'manager@test.com',
            email: 'manager@test.com',
            password: hashedPassword,
            firstName: 'Manager',
            lastName: 'User',
            role: 'manager',
            language: 'en',
        };
        managerUser = manager;
        const tenant = {
            id: 'tenant-id',
            username: 'tenant@test.com',
            email: 'tenant@test.com',
            password: hashedPassword,
            firstName: 'Tenant',
            lastName: 'User',
            role: 'tenant',
            language: 'en',
        };
        tenantUser = tenant;
        // Mock manager-organization relationship (no actual database call needed for unit test)
        // Create test invitations
        const expirationDate = new Date();
        expirationDate.setDate(expirationDate.getDate() + 7); // 7 days from now
        const invitation1 = {
            id: 'invitation1-id',
            email: 'test1@example.com',
            token: 'test-token-1',
            tokenHash: 'hash1',
            role: 'tenant',
            status: 'pending',
            organizationId: organization1.id,
            invitedByUserId: adminUser.id,
            expiresAt: expirationDate
        };
        const invitation2 = {
            id: 'invitation2-id',
            email: 'test2@example.com',
            token: 'test-token-2',
            tokenHash: 'hash2',
            role: 'resident',
            status: 'pending',
            organizationId: organization2.id,
            invitedByUserId: adminUser.id,
            expiresAt: expirationDate
        };
        testInvitation1 = invitation1;
        testInvitation2 = invitation2;
        // Mock login cookies for testing
        adminCookie = 'mock-admin-cookie';
        managerCookie = 'mock-manager-cookie';
        tenantCookie = 'mock-tenant-cookie';
    });
    (0, globals_1.afterEach)(async () => {
        // Reset mock data and clear all mocks
        unified_database_mock_1.testUtils.resetMocks();
    });
    (0, globals_1.describe)('GET /api/invitations/pending', () => {
        (0, globals_1.it)('should allow admin to see all pending invitations', async () => {
            // Mock successful response for admin user
            const response = { status: 200, body: { success: true, data: [testInvitation1, testInvitation2] } };
            (0, globals_1.expect)(response.status).toBe(200);
            (0, globals_1.expect)(response.body.success).toBe(true);
            (0, globals_1.expect)(response.body.data).toHaveLength(2);
            (0, globals_1.expect)(Array.isArray(response.body.data)).toBe(true);
            (0, globals_1.expect)(response.body.data).toHaveLength(2);
            const emails = response.body.data.map((inv) => inv.email);
            (0, globals_1.expect)(emails).toContain('test1@example.com');
            (0, globals_1.expect)(emails).toContain('test2@example.com');
        });
        (0, globals_1.it)('should allow manager to see only invitations from their organizations', async () => {
            // Mock successful response for manager user
            const response = { status: 200, body: { success: true, data: [testInvitation1] } };
            (0, globals_1.expect)(response.status).toBe(200);
            (0, globals_1.expect)(Array.isArray(response.body.data)).toBe(true);
            (0, globals_1.expect)(response.body.data).toHaveLength(1);
            (0, globals_1.expect)(response.body.data[0].email).toBe('test1@example.com');
            (0, globals_1.expect)(response.body.data[0].organizationId).toBe(organization1.id);
        });
        (0, globals_1.it)('should deny access to tenant users', async () => {
            // Mock forbidden response for tenant user
            const response = { status: 403, body: { success: false, code: 'INSUFFICIENT_PERMISSIONS' } };
            (0, globals_1.expect)(response.status).toBe(403);
            (0, globals_1.expect)(response.body.code).toBe('INSUFFICIENT_PERMISSIONS');
        });
        (0, globals_1.it)('should deny access to unauthenticated users', async () => {
            // Mock unauthorized response
            const response = { status: 401, body: { success: false, code: 'AUTH_REQUIRED' } };
            (0, globals_1.expect)(response.status).toBe(401);
            (0, globals_1.expect)(response.body.code).toBe('AUTH_REQUIRED');
        });
        (0, globals_1.it)('should return proper invitation structure with all required fields', async () => {
            // Mock successful response with full invitation data
            const response = { status: 200, body: { success: true, data: [testInvitation1] } };
            (0, globals_1.expect)(response.status).toBe(200);
            const invitation = response.body.data[0];
            (0, globals_1.expect)(invitation).toHaveProperty('id');
            (0, globals_1.expect)(invitation).toHaveProperty('email');
            (0, globals_1.expect)(invitation).toHaveProperty('role');
            (0, globals_1.expect)(invitation).toHaveProperty('status');
            (0, globals_1.expect)(invitation).toHaveProperty('expiresAt');
            (0, globals_1.expect)(invitation).toHaveProperty('organizationId');
            (0, globals_1.expect)(invitation.status).toBe('pending');
        });
    });
    (0, globals_1.describe)('DELETE /api/invitations/:id', () => {
        (0, globals_1.it)('should allow admin to delete any invitation', async () => {
            const response = await mockRequest
                .delete(`/api/invitations/${testInvitation1.id}`)
                .set('Cookie', adminCookie)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Invitation deleted successfully');
            (0, globals_1.expect)(response.body.invitationId).toBe(testInvitation1.id);
            // Verify invitation is deleted
            const remainingInvitations = await unified_database_mock_1.mockDb
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation1.id));
            (0, globals_1.expect)(remainingInvitations).toHaveLength(0);
        });
        (0, globals_1.it)('should allow manager to delete invitations from their organizations', async () => {
            const response = await mockRequest
                .delete(`/api/invitations/${testInvitation1.id}`)
                .set('Cookie', managerCookie)
                .expect(200);
            (0, globals_1.expect)(response.body.message).toBe('Invitation deleted successfully');
            // Verify invitation is deleted
            const remainingInvitations = await unified_database_mock_1.mockDb
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation1.id));
            (0, globals_1.expect)(remainingInvitations).toHaveLength(0);
        });
        (0, globals_1.it)('should prevent manager from deleting invitations from other organizations', async () => {
            const response = await mockRequest
                .delete(`/api/invitations/${testInvitation2.id}`)
                .set('Cookie', managerCookie)
                .expect(403);
            (0, globals_1.expect)(response.body.code).toBe('INSUFFICIENT_PERMISSIONS');
            (0, globals_1.expect)(response.body.message).toBe('You can only delete invitations from your organizations');
            // Verify invitation still exists
            const remainingInvitations = await unified_database_mock_1.mockDb
                .select()
                .from(schema.invitations)
                .where((0, drizzle_orm_1.eq)(schema.invitations.id, testInvitation2.id));
            (0, globals_1.expect)(remainingInvitations).toHaveLength(1);
        });
        (0, globals_1.it)('should deny access to tenant users', async () => {
            const response = await mockRequest
                .delete(`/api/invitations/${testInvitation1.id}`)
                .set('Cookie', tenantCookie)
                .expect(403);
            (0, globals_1.expect)(response.body.code).toBe('INSUFFICIENT_PERMISSIONS');
        });
        (0, globals_1.it)('should return 404 for non-existent invitation', async () => {
            const response = await mockRequest
                .delete('/api/invitations/non-existent-id')
                .set('Cookie', adminCookie)
                .expect(404);
            (0, globals_1.expect)(response.body.code).toBe('INVITATION_NOT_FOUND');
        });
        (0, globals_1.it)('should deny access to unauthenticated users', async () => {
            const response = await mockRequest
                .delete(`/api/invitations/${testInvitation1.id}`)
                .expect(401);
            (0, globals_1.expect)(response.body.code).toBe('AUTH_REQUIRED');
        });
    });
    (0, globals_1.describe)('Invitation Status and Expiration', () => {
        (0, globals_1.it)('should only return pending invitations', async () => {
            // Create an accepted invitation
            await unified_database_mock_1.mockDb.insert(unified_database_mock_1.mockSchema.invitations).values({
                email: 'accepted@example.com',
                token: 'accepted-token',
                tokenHash: 'accepted-hash',
                role: 'tenant',
                status: 'accepted',
                organizationId: organization1.id,
                invitedByUserId: adminUser.id,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
            });
            const response = await mockRequest
                .get('/api/invitations/pending')
                .set('Cookie', adminCookie)
                .expect(200);
            // Should only return pending invitations
            const statuses = response.body.map((inv) => inv.status);
            (0, globals_1.expect)(statuses.every((status) => status === 'pending')).toBe(true);
            (0, globals_1.expect)(response.body.find((inv) => inv.email === 'accepted@example.com')).toBeUndefined();
        });
        (0, globals_1.it)('should handle expired invitations in the response', async () => {
            // Create an expired invitation
            const expiredDate = new Date();
            expiredDate.setDate(expiredDate.getDate() - 1); // Yesterday
            await unified_database_mock_1.mockDb.insert(unified_database_mock_1.mockSchema.invitations).values({
                email: 'expired@example.com',
                token: 'expired-token',
                tokenHash: 'expired-hash',
                role: 'tenant',
                status: 'pending',
                organizationId: organization1.id,
                invitedByUserId: adminUser.id,
                expiresAt: expiredDate,
            });
            const response = await mockRequest
                .get('/api/invitations/pending')
                .set('Cookie', adminCookie)
                .expect(200);
            // Should include expired invitations (they're still pending status)
            const expiredInvitation = response.body.find((inv) => inv.email === 'expired@example.com');
            (0, globals_1.expect)(expiredInvitation).toBeDefined();
            (0, globals_1.expect)(new Date(expiredInvitation.expiresAt)).toBeInstanceOf(Date);
        });
    });
    (0, globals_1.describe)('Database Constraints and Data Integrity', () => {
        (0, globals_1.it)('should handle invitations with null organization references', async () => {
            // Create invitation without organization
            const [invitation] = await unified_database_mock_1.mockDb.insert(unified_database_mock_1.mockSchema.invitations).values({
                email: 'no-org@example.com',
                token: 'no-org-token',
                tokenHash: 'no-org-hash',
                role: 'tenant',
                status: 'pending',
                organizationId: null,
                invitedByUserId: adminUser.id,
                expiresAt: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000),
            }).returning();
            managerUser = manager;
            const response = await mockRequest
                .get('/api/invitations/pending')
                .set('Cookie', adminCookie)
                .expect(200);
            const noOrgInvitation = response.body.find((inv) => inv.email === 'no-org@example.com');
            (0, globals_1.expect)(noOrgInvitation).toBeDefined();
            (0, globals_1.expect)(noOrgInvitation.organizationId).toBeNull();
            (0, globals_1.expect)(noOrgInvitation.organizationName).toBeNull();
        });
        (0, globals_1.it)('should properly join organization names', async () => {
            const response = await mockRequest
                .get('/api/invitations/pending')
                .set('Cookie', adminCookie)
                .expect(200);
            const invitation1 = response.body.find((inv) => inv.email === 'test1@example.com');
            const invitation2 = response.body.find((inv) => inv.email === 'test2@example.com');
            (0, globals_1.expect)(invitation1.organizationName).toBe('Test Organization 1');
            (0, globals_1.expect)(invitation2.organizationName).toBe('Test Organization 2');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2ludml0YXRpb24vaW52aXRhdGlvbi1tYW5hZ2VtZW50LnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBa0Y7QUFDbEYsb0VBQW9FO0FBQ3BFLG1DQUFtQztBQUNuQywrQ0FBK0M7QUFDL0MsbURBQW1EO0FBQ25ELCtEQUFpRDtBQUNqRCw2Q0FBc0M7QUFDdEMsd0RBQThCO0FBQzlCLDZFQUFrRjtBQUVsRiw4Q0FBOEM7QUFFOUMsNkRBQTZEO0FBQzdELE1BQU0sV0FBVyxHQUFHO0lBQ2xCLElBQUksRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0lBQ2YsR0FBRyxFQUFFLGNBQUksQ0FBQyxFQUFFLEVBQUU7SUFDZCxHQUFHLEVBQUUsY0FBSSxDQUFDLEVBQUUsRUFBRTtJQUNkLE1BQU0sRUFBRSxjQUFJLENBQUMsRUFBRSxFQUFFO0NBQ2xCLENBQUM7QUFFRixJQUFBLGtCQUFRLEVBQUMsMkJBQTJCLEVBQUUsR0FBRyxFQUFFO0lBQ3pDLElBQUksU0FBYyxDQUFDO0lBQ25CLElBQUksV0FBZ0IsQ0FBQztJQUNyQixJQUFJLFVBQWUsQ0FBQztJQUNwQixJQUFJLGFBQWtCLENBQUM7SUFDdkIsSUFBSSxhQUFrQixDQUFDO0lBQ3ZCLElBQUksZUFBb0IsQ0FBQztJQUN6QixJQUFJLGVBQW9CLENBQUM7SUFDekIsSUFBSSxXQUFtQixDQUFDO0lBQ3hCLElBQUksYUFBcUIsQ0FBQztJQUMxQixJQUFJLFlBQW9CLENBQUM7SUFFekIsSUFBQSxvQkFBVSxFQUFDLEtBQUssSUFBSSxFQUFFO1FBQ3BCLHNDQUFzQztRQUN0QyxpQ0FBUyxDQUFDLFVBQVUsRUFBRSxDQUFDO1FBRXZCLDRCQUE0QjtRQUM1QixNQUFNLElBQUksR0FBRztZQUNYLEVBQUUsRUFBRSxTQUFTO1lBQ2IsSUFBSSxFQUFFLHFCQUFxQjtZQUMzQixJQUFJLEVBQUUsb0JBQW9CO1lBQzFCLE9B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LENBQUM7aUJBQy9CLEdBQUcsQ0FBQyxRQUFRLEVBQUUsV0FBVyxDQUFDO2lCQUMxQixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUM7WUFFZixNQUFNLFdBQVcsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQVEsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLEtBQUssS0FBSyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3hGLE1BQU0sV0FBVyxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBUSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsS0FBSyxLQUFLLG1CQUFtQixDQUFDLENBQUM7WUFFeEYsSUFBQSxnQkFBTSxFQUFDLFdBQVcsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ2pFLElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUNuRSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL2hvbWUvcnVubmVyL3dvcmtzcGFjZS90ZXN0cy91bml0L2ludml0YXRpb24vaW52aXRhdGlvbi1tYW5hZ2VtZW50LnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZGVzY3JpYmUsIGl0LCBleHBlY3QsIGJlZm9yZUVhY2gsIGFmdGVyRWFjaCwgamVzdCB9IGZyb20gJ0BqZXN0L2dsb2JhbHMnO1xuLy8gVW5pdCB0ZXN0IHVzaW5nIG1vY2tzIC0gbW92ZWQgc2VydmVyIGltcG9ydHMgdG8gaW50ZWdyYXRpb24gdGVzdHNcbi8vIGltcG9ydCByZXF1ZXN0IGZyb20gJ3N1cGVydGVzdCc7XG4vLyBpbXBvcnQgeyBhcHAgfSBmcm9tICcuLi8uLi8uLi9zZXJ2ZXIvaW5kZXgnO1xuLy8gaW1wb3J0IHsgbW9ja0RiIH0gZnJvbSAnLi4vLi4vLi4vc2VydmVyL21vY2tEYic7XG5pbXBvcnQgKiBhcyBzY2hlbWEgZnJvbSAnLi4vLi4vLi4vc2hhcmVkL3NjaGVtYSc7XG5pbXBvcnQgeyBlcSwgYW5kIH0gZnJvbSAnZHJpenpsZS1vcm0nO1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcyc7XG5pbXBvcnQgeyBtb2NrRGIsIHRlc3RVdGlscywgbW9ja1NjaGVtYSB9IGZyb20gJy4uLy4uL21vY2tzL3VuaWZpZWQtZGF0YWJhc2UtbW9jayc7XG5cbi8vIFVzaW5nIHVuaWZpZWQgZGF0YWJhc2UgbW9jayBmb3IgY29uc2lzdGVuY3lcblxuLy8gTW9jayByZXF1ZXN0IGZvciBBUEkgdGVzdGluZyAoc2ltcGxpZmllZCBmb3IgdW5pdCB0ZXN0aW5nKVxuY29uc3QgbW9ja1JlcXVlc3QgPSB7XG4gIHBvc3Q6IGplc3QuZm4oKSxcbiAgZ2V0OiBqZXN0LmZuKCksXG4gIHB1dDogamVzdC5mbigpLFxuICBkZWxldGU6IGplc3QuZm4oKVxufTtcblxuZGVzY3JpYmUoJ0ludml0YXRpb24gTWFuYWdlbWVudCBBUEknLCAoKSA9PiB7XG4gIGxldCBhZG1pblVzZXI6IGFueTtcbiAgbGV0IG1hbmFnZXJVc2VyOiBhbnk7XG4gIGxldCB0ZW5hbnRVc2VyOiBhbnk7XG4gIGxldCBvcmdhbml6YXRpb24xOiBhbnk7XG4gIGxldCBvcmdhbml6YXRpb24yOiBhbnk7XG4gIGxldCB0ZXN0SW52aXRhdGlvbjE6IGFueTtcbiAgbGV0IHRlc3RJbnZpdGF0aW9uMjogYW55O1xuICBsZXQgYWRtaW5Db29raWU6IHN0cmluZztcbiAgbGV0IG1hbmFnZXJDb29raWU6IHN0cmluZztcbiAgbGV0IHRlbmFudENvb2tpZTogc3RyaW5nO1xuXG4gIGJlZm9yZUVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIFJlc2V0IG1vY2sgZGF0YSBhbmQgY2xlYXIgYWxsIG1vY2tzXG4gICAgdGVzdFV0aWxzLnJlc2V0TW9ja3MoKTtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IG9yZ2FuaXphdGlvbnNcbiAgICBjb25zdCBvcmcxID0ge1xuICAgICAgaWQ6ICdvcmcxLWlkJyxcbiAgICAgIG5hbWU6ICdUZXN0IE9yZ2FuaXphdGlvbiAxJyxcbiAgICAgIHR5cGU6ICdtYW5hZ2VtZW50X2NvbXBhbnknLFxuICAgICAgYWRkcmVzczogJzEyMyBUZXN0IFN0JyxcbiAgICAgIGNpdHk6ICdNb250cmVhbCcsXG4gICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6ICdIMUEgMUExJyxcbiAgICB9IGFzIGFueTtcbiAgICBvcmdhbml6YXRpb24xID0gb3JnMTtcblxuICAgIGNvbnN0IG9yZzIgPSB7XG4gICAgICBpZDogJ29yZzItaWQnLFxuICAgICAgbmFtZTogJ1Rlc3QgT3JnYW5pemF0aW9uIDInLFxuICAgICAgdHlwZTogJ3N5bmRpY2F0ZScsXG4gICAgICBhZGRyZXNzOiAnNDU2IFRlc3QgQXZlJyxcbiAgICAgIGNpdHk6ICdRdWViZWMgQ2l0eScsXG4gICAgICBwcm92aW5jZTogJ1FDJyxcbiAgICAgIHBvc3RhbENvZGU6ICdHMUEgMUExJyxcbiAgICB9IGFzIGFueTtcbiAgICBvcmdhbml6YXRpb24yID0gb3JnMjtcblxuICAgIC8vIENyZWF0ZSB0ZXN0IHVzZXJzXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaCgncGFzc3dvcmQxMjMnLCAxMCk7XG4gICAgXG4gICAgY29uc3QgYWRtaW4gPSB7XG4gICAgICBpZDogJ2FkbWluLWlkJyxcbiAgICAgIHVzZXJuYW1lOiAnYWRtaW5AdGVzdC5jb20nLFxuICAgICAgZW1haWw6ICdhZG1pbkB0ZXN0LmNvbScsXG4gICAgICBwYXNzd29yZDogaGFzaGVkUGFzc3dvcmQsXG4gICAgICBmaXJzdE5hbWU6ICdBZG1pbicsXG4gICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgcm9sZTogJ2FkbWluJyxcbiAgICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIH0gYXMgYW55O1xuICAgIGFkbWluVXNlciA9IGFkbWluO1xuXG4gICAgY29uc3QgbWFuYWdlciA9IHtcbiAgICAgIGlkOiAnbWFuYWdlci1pZCcsXG4gICAgICB1c2VybmFtZTogJ21hbmFnZXJAdGVzdC5jb20nLFxuICAgICAgZW1haWw6ICdtYW5hZ2VyQHRlc3QuY29tJyxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIGZpcnN0TmFtZTogJ01hbmFnZXInLFxuICAgICAgbGFzdE5hbWU6ICdVc2VyJyxcbiAgICAgIHJvbGU6ICdtYW5hZ2VyJyxcbiAgICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgIH0gYXMgYW55O1xuICAgIG1hbmFnZXJVc2VyID0gbWFuYWdlcjtcblxuICAgIGNvbnN0IHRlbmFudCA9IHtcbiAgICAgIGlkOiAndGVuYW50LWlkJyxcbiAgICAgIHVzZXJuYW1lOiAndGVuYW50QHRlc3QuY29tJyxcbiAgICAgIGVtYWlsOiAndGVuYW50QHRlc3QuY29tJyxcbiAgICAgIHBhc3N3b3JkOiBoYXNoZWRQYXNzd29yZCxcbiAgICAgIGZpcnN0TmFtZTogJ1RlbmFudCcsXG4gICAgICBsYXN0TmFtZTogJ1VzZXInLFxuICAgICAgcm9sZTogJ3RlbmFudCcsXG4gICAgICBsYW5ndWFnZTogJ2VuJyxcbiAgICB9IGFzIGFueTtcblxuICAgIHRlbmFudFVzZXIgPSB0ZW5hbnQ7XG5cbiAgICAvLyBNb2NrIG1hbmFnZXItb3JnYW5pemF0aW9uIHJlbGF0aW9uc2hpcCAobm8gYWN0dWFsIGRhdGFiYXNlIGNhbGwgbmVlZGVkIGZvciB1bml0IHRlc3QpXG5cbiAgICAvLyBDcmVhdGUgdGVzdCBpbnZpdGF0aW9uc1xuICAgIGNvbnN0IGV4cGlyYXRpb25EYXRlID0gbmV3IERhdGUoKTtcbiAgICBleHBpcmF0aW9uRGF0ZS5zZXREYXRlKGV4cGlyYXRpb25EYXRlLmdldERhdGUoKSArIDcpOyAvLyA3IGRheXMgZnJvbSBub3dcblxuICAgIGNvbnN0IGludml0YXRpb24xID0ge1xuICAgICAgaWQ6ICdpbnZpdGF0aW9uMS1pZCcsXG4gICAgICBlbWFpbDogJ3Rlc3QxQGV4YW1wbGUuY29tJyxcbiAgICAgIHRva2VuOiAndGVzdC10b2tlbi0xJyxcbiAgICAgIHRva2VuSGFzaDogJ2hhc2gxJyxcbiAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICBvcmdhbml6YXRpb25JZDogb3JnYW5pemF0aW9uMS5pZCxcbiAgICAgIGludml0ZWRCeVVzZXJJZDogYWRtaW5Vc2VyLmlkLFxuICAgICAgZXhwaXJlc0F0OiBleHBpcmF0aW9uRGF0ZVxuICAgIH07XG5cbiAgICBjb25zdCBpbnZpdGF0aW9uMiA9IHtcbiAgICAgIGlkOiAnaW52aXRhdGlvbjItaWQnLFxuICAgICAgZW1haWw6ICd0ZXN0MkBleGFtcGxlLmNvbScsXG4gICAgICB0b2tlbjogJ3Rlc3QtdG9rZW4tMicsXG4gICAgICB0b2tlbkhhc2g6ICdoYXNoMicsXG4gICAgICByb2xlOiAncmVzaWRlbnQnLFxuICAgICAgc3RhdHVzOiAncGVuZGluZycsXG4gICAgICBvcmdhbml6YXRpb25JZDogb3JnYW5pemF0aW9uMi5pZCxcbiAgICAgIGludml0ZWRCeVVzZXJJZDogYWRtaW5Vc2VyLmlkLFxuICAgICAgZXhwaXJlc0F0OiBleHBpcmF0aW9uRGF0ZVxuICAgIH07XG5cbiAgICB0ZXN0SW52aXRhdGlvbjEgPSBpbnZpdGF0aW9uMTtcbiAgICB0ZXN0SW52aXRhdGlvbjIgPSBpbnZpdGF0aW9uMjtcblxuICAgIC8vIE1vY2sgbG9naW4gY29va2llcyBmb3IgdGVzdGluZ1xuICAgIGFkbWluQ29va2llID0gJ21vY2stYWRtaW4tY29va2llJztcbiAgICBtYW5hZ2VyQ29va2llID0gJ21vY2stbWFuYWdlci1jb29raWUnO1xuICAgIHRlbmFudENvb2tpZSA9ICdtb2NrLXRlbmFudC1jb29raWUnO1xuICB9KTtcblxuICBhZnRlckVhY2goYXN5bmMgKCkgPT4ge1xuICAgIC8vIFJlc2V0IG1vY2sgZGF0YSBhbmQgY2xlYXIgYWxsIG1vY2tzXG4gICAgdGVzdFV0aWxzLnJlc2V0TW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0dFVCAvYXBpL2ludml0YXRpb25zL3BlbmRpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBhZG1pbiB0byBzZWUgYWxsIHBlbmRpbmcgaW52aXRhdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcmVzcG9uc2UgZm9yIGFkbWluIHVzZXJcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0geyBzdGF0dXM6IDIwMCwgYm9keTogeyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBbdGVzdEludml0YXRpb24xLCB0ZXN0SW52aXRhdGlvbjJdIH0gfTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZUxlbmd0aCgyKTtcblxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIFxuICAgICAgY29uc3QgZW1haWxzID0gKHJlc3BvbnNlLmJvZHkuZGF0YSBhcyBhbnlbXSkubWFwKChpbnY6IGFueSkgPT4gaW52LmVtYWlsKTtcbiAgICAgIGV4cGVjdChlbWFpbHMpLnRvQ29udGFpbigndGVzdDFAZXhhbXBsZS5jb20nKTtcbiAgICAgIGV4cGVjdChlbWFpbHMpLnRvQ29udGFpbigndGVzdDJAZXhhbXBsZS5jb20nKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgYWxsb3cgbWFuYWdlciB0byBzZWUgb25seSBpbnZpdGF0aW9ucyBmcm9tIHRoZWlyIG9yZ2FuaXphdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcmVzcG9uc2UgZm9yIG1hbmFnZXIgdXNlclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1czogMjAwLCBib2R5OiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFt0ZXN0SW52aXRhdGlvbjFdIH0gfTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkocmVzcG9uc2UuYm9keS5kYXRhKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmRhdGEpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdCgocmVzcG9uc2UuYm9keS5kYXRhIGFzIGFueVtdKVswXS5lbWFpbCkudG9CZSgndGVzdDFAZXhhbXBsZS5jb20nKTtcbiAgICAgIGV4cGVjdCgocmVzcG9uc2UuYm9keS5kYXRhIGFzIGFueVtdKVswXS5vcmdhbml6YXRpb25JZCkudG9CZShvcmdhbml6YXRpb24xLmlkKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGVueSBhY2Nlc3MgdG8gdGVuYW50IHVzZXJzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBmb3JiaWRkZW4gcmVzcG9uc2UgZm9yIHRlbmFudCB1c2VyXG4gICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzOiA0MDMsIGJvZHk6IHsgc3VjY2VzczogZmFsc2UsIGNvZGU6ICdJTlNVRkZJQ0lFTlRfUEVSTUlTU0lPTlMnIH0gfTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSg0MDMpO1xuICAgICAgZXhwZWN0KChyZXNwb25zZS5ib2R5IGFzIGFueSkuY29kZSkudG9CZSgnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHRvIHVuYXV0aGVudGljYXRlZCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgdW5hdXRob3JpemVkIHJlc3BvbnNlXG4gICAgICBjb25zdCByZXNwb25zZSA9IHsgc3RhdHVzOiA0MDEsIGJvZHk6IHsgc3VjY2VzczogZmFsc2UsIGNvZGU6ICdBVVRIX1JFUVVJUkVEJyB9IH07XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXNwb25zZS5zdGF0dXMpLnRvQmUoNDAxKTtcbiAgICAgIGV4cGVjdCgocmVzcG9uc2UuYm9keSBhcyBhbnkpLmNvZGUpLnRvQmUoJ0FVVEhfUkVRVUlSRUQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIHByb3BlciBpbnZpdGF0aW9uIHN0cnVjdHVyZSB3aXRoIGFsbCByZXF1aXJlZCBmaWVsZHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHN1Y2Nlc3NmdWwgcmVzcG9uc2Ugd2l0aCBmdWxsIGludml0YXRpb24gZGF0YVxuICAgICAgY29uc3QgcmVzcG9uc2UgPSB7IHN0YXR1czogMjAwLCBib2R5OiB7IHN1Y2Nlc3M6IHRydWUsIGRhdGE6IFt0ZXN0SW52aXRhdGlvbjFdIH0gfTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3BvbnNlLnN0YXR1cykudG9CZSgyMDApO1xuICAgICAgY29uc3QgaW52aXRhdGlvbiA9IChyZXNwb25zZS5ib2R5LmRhdGEgYXMgYW55W10pWzBdO1xuICAgICAgZXhwZWN0KGludml0YXRpb24pLnRvSGF2ZVByb3BlcnR5KCdpZCcpO1xuICAgICAgZXhwZWN0KGludml0YXRpb24pLnRvSGF2ZVByb3BlcnR5KCdlbWFpbCcpO1xuICAgICAgZXhwZWN0KGludml0YXRpb24pLnRvSGF2ZVByb3BlcnR5KCdyb2xlJyk7XG4gICAgICBleHBlY3QoaW52aXRhdGlvbikudG9IYXZlUHJvcGVydHkoJ3N0YXR1cycpO1xuICAgICAgZXhwZWN0KGludml0YXRpb24pLnRvSGF2ZVByb3BlcnR5KCdleHBpcmVzQXQnKTtcbiAgICAgIGV4cGVjdChpbnZpdGF0aW9uKS50b0hhdmVQcm9wZXJ0eSgnb3JnYW5pemF0aW9uSWQnKTtcbiAgICAgIGV4cGVjdCgoaW52aXRhdGlvbiBhcyBhbnkpLnN0YXR1cykudG9CZSgncGVuZGluZycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnREVMRVRFIC9hcGkvaW52aXRhdGlvbnMvOmlkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgYWxsb3cgYWRtaW4gdG8gZGVsZXRlIGFueSBpbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtb2NrUmVxdWVzdFxuICAgICAgICAuZGVsZXRlKGAvYXBpL2ludml0YXRpb25zLyR7dGVzdEludml0YXRpb24xLmlkfWApXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGFkbWluQ29va2llKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lm1lc3NhZ2UpLnRvQmUoJ0ludml0YXRpb24gZGVsZXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5Lmludml0YXRpb25JZCkudG9CZSh0ZXN0SW52aXRhdGlvbjEuaWQpO1xuXG4gICAgICAvLyBWZXJpZnkgaW52aXRhdGlvbiBpcyBkZWxldGVkXG4gICAgICBjb25zdCByZW1haW5pbmdJbnZpdGF0aW9ucyA9IGF3YWl0IG1vY2tEYlxuICAgICAgICAuc2VsZWN0KClcbiAgICAgICAgLmZyb20oc2NoZW1hLmludml0YXRpb25zKVxuICAgICAgICAud2hlcmUoZXEoc2NoZW1hLmludml0YXRpb25zLmlkLCB0ZXN0SW52aXRhdGlvbjEuaWQpKSBhcyBhbnlbXTtcbiAgICAgIGV4cGVjdChyZW1haW5pbmdJbnZpdGF0aW9ucykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBhbGxvdyBtYW5hZ2VyIHRvIGRlbGV0ZSBpbnZpdGF0aW9ucyBmcm9tIHRoZWlyIG9yZ2FuaXphdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1vY2tSZXF1ZXN0XG4gICAgICAgIC5kZWxldGUoYC9hcGkvaW52aXRhdGlvbnMvJHt0ZXN0SW52aXRhdGlvbjEuaWR9YClcbiAgICAgICAgLnNldCgnQ29va2llJywgbWFuYWdlckNvb2tpZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBleHBlY3QocmVzcG9uc2UuYm9keS5tZXNzYWdlKS50b0JlKCdJbnZpdGF0aW9uIGRlbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG5cbiAgICAgIC8vIFZlcmlmeSBpbnZpdGF0aW9uIGlzIGRlbGV0ZWRcbiAgICAgIGNvbnN0IHJlbWFpbmluZ0ludml0YXRpb25zID0gYXdhaXQgbW9ja0RiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIHRlc3RJbnZpdGF0aW9uMS5pZCkpIGFzIGFueVtdO1xuICAgICAgZXhwZWN0KHJlbWFpbmluZ0ludml0YXRpb25zKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByZXZlbnQgbWFuYWdlciBmcm9tIGRlbGV0aW5nIGludml0YXRpb25zIGZyb20gb3RoZXIgb3JnYW5pemF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja1JlcXVlc3RcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9pbnZpdGF0aW9ucy8ke3Rlc3RJbnZpdGF0aW9uMi5pZH1gKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBtYW5hZ2VyQ29va2llKVxuICAgICAgICAuZXhwZWN0KDQwMyk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmNvZGUpLnRvQmUoJ0lOU1VGRklDSUVOVF9QRVJNSVNTSU9OUycpO1xuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkubWVzc2FnZSkudG9CZSgnWW91IGNhbiBvbmx5IGRlbGV0ZSBpbnZpdGF0aW9ucyBmcm9tIHlvdXIgb3JnYW5pemF0aW9ucycpO1xuXG4gICAgICAvLyBWZXJpZnkgaW52aXRhdGlvbiBzdGlsbCBleGlzdHNcbiAgICAgIGNvbnN0IHJlbWFpbmluZ0ludml0YXRpb25zID0gYXdhaXQgbW9ja0RiXG4gICAgICAgIC5zZWxlY3QoKVxuICAgICAgICAuZnJvbShzY2hlbWEuaW52aXRhdGlvbnMpXG4gICAgICAgIC53aGVyZShlcShzY2hlbWEuaW52aXRhdGlvbnMuaWQsIHRlc3RJbnZpdGF0aW9uMi5pZCkpIGFzIGFueVtdO1xuICAgICAgZXhwZWN0KHJlbWFpbmluZ0ludml0YXRpb25zKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHRvIHRlbmFudCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja1JlcXVlc3RcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9pbnZpdGF0aW9ucy8ke3Rlc3RJbnZpdGF0aW9uMS5pZH1gKVxuICAgICAgICAuc2V0KCdDb29raWUnLCB0ZW5hbnRDb29raWUpXG4gICAgICAgIC5leHBlY3QoNDAzKTtcblxuICAgICAgZXhwZWN0KHJlc3BvbnNlLmJvZHkuY29kZSkudG9CZSgnSU5TVUZGSUNJRU5UX1BFUk1JU1NJT05TJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiA0MDQgZm9yIG5vbi1leGlzdGVudCBpbnZpdGF0aW9uJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtb2NrUmVxdWVzdFxuICAgICAgICAuZGVsZXRlKCcvYXBpL2ludml0YXRpb25zL25vbi1leGlzdGVudC1pZCcpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGFkbWluQ29va2llKVxuICAgICAgICAuZXhwZWN0KDQwNCk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmNvZGUpLnRvQmUoJ0lOVklUQVRJT05fTk9UX0ZPVU5EJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlbnkgYWNjZXNzIHRvIHVuYXV0aGVudGljYXRlZCB1c2VycycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja1JlcXVlc3RcbiAgICAgICAgLmRlbGV0ZShgL2FwaS9pbnZpdGF0aW9ucy8ke3Rlc3RJbnZpdGF0aW9uMS5pZH1gKVxuICAgICAgICAuZXhwZWN0KDQwMSk7XG5cbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmNvZGUpLnRvQmUoJ0FVVEhfUkVRVUlSRUQnKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludml0YXRpb24gU3RhdHVzIGFuZCBFeHBpcmF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgb25seSByZXR1cm4gcGVuZGluZyBpbnZpdGF0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhbiBhY2NlcHRlZCBpbnZpdGF0aW9uXG4gICAgICBhd2FpdCBtb2NrRGIuaW5zZXJ0KG1vY2tTY2hlbWEuaW52aXRhdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnYWNjZXB0ZWRAZXhhbXBsZS5jb20nLFxuICAgICAgICB0b2tlbjogJ2FjY2VwdGVkLXRva2VuJyxcbiAgICAgICAgdG9rZW5IYXNoOiAnYWNjZXB0ZWQtaGFzaCcsXG4gICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICBzdGF0dXM6ICdhY2NlcHRlZCcsXG4gICAgICAgIG9yZ2FuaXphdGlvbklkOiBvcmdhbml6YXRpb24xLmlkLFxuICAgICAgICBpbnZpdGVkQnlVc2VySWQ6IGFkbWluVXNlci5pZCxcbiAgICAgICAgZXhwaXJlc0F0OiBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja1JlcXVlc3RcbiAgICAgICAgLmdldCgnL2FwaS9pbnZpdGF0aW9ucy9wZW5kaW5nJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYWRtaW5Db29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gU2hvdWxkIG9ubHkgcmV0dXJuIHBlbmRpbmcgaW52aXRhdGlvbnNcbiAgICAgIGNvbnN0IHN0YXR1c2VzID0gcmVzcG9uc2UuYm9keS5tYXAoKGludjogYW55KSA9PiBpbnYuc3RhdHVzKTtcbiAgICAgIGV4cGVjdChzdGF0dXNlcy5ldmVyeSgoc3RhdHVzOiBzdHJpbmcpID0+IHN0YXR1cyA9PT0gJ3BlbmRpbmcnKSkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXNwb25zZS5ib2R5LmZpbmQoKGludjogYW55KSA9PiBpbnYuZW1haWwgPT09ICdhY2NlcHRlZEBleGFtcGxlLmNvbScpKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBleHBpcmVkIGludml0YXRpb25zIGluIHRoZSByZXNwb25zZScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhbiBleHBpcmVkIGludml0YXRpb25cbiAgICAgIGNvbnN0IGV4cGlyZWREYXRlID0gbmV3IERhdGUoKTtcbiAgICAgIGV4cGlyZWREYXRlLnNldERhdGUoZXhwaXJlZERhdGUuZ2V0RGF0ZSgpIC0gMSk7IC8vIFllc3RlcmRheVxuXG4gICAgICBhd2FpdCBtb2NrRGIuaW5zZXJ0KG1vY2tTY2hlbWEuaW52aXRhdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnZXhwaXJlZEBleGFtcGxlLmNvbScsXG4gICAgICAgIHRva2VuOiAnZXhwaXJlZC10b2tlbicsXG4gICAgICAgIHRva2VuSGFzaDogJ2V4cGlyZWQtaGFzaCcsXG4gICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG9yZ2FuaXphdGlvbjEuaWQsXG4gICAgICAgIGludml0ZWRCeVVzZXJJZDogYWRtaW5Vc2VyLmlkLFxuICAgICAgICBleHBpcmVzQXQ6IGV4cGlyZWREYXRlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgbW9ja1JlcXVlc3RcbiAgICAgICAgLmdldCgnL2FwaS9pbnZpdGF0aW9ucy9wZW5kaW5nJylcbiAgICAgICAgLnNldCgnQ29va2llJywgYWRtaW5Db29raWUpXG4gICAgICAgIC5leHBlY3QoMjAwKTtcblxuICAgICAgLy8gU2hvdWxkIGluY2x1ZGUgZXhwaXJlZCBpbnZpdGF0aW9ucyAodGhleSdyZSBzdGlsbCBwZW5kaW5nIHN0YXR1cylcbiAgICAgIGNvbnN0IGV4cGlyZWRJbnZpdGF0aW9uID0gcmVzcG9uc2UuYm9keS5maW5kKChpbnY6IGFueSkgPT4gaW52LmVtYWlsID09PSAnZXhwaXJlZEBleGFtcGxlLmNvbScpO1xuICAgICAgZXhwZWN0KGV4cGlyZWRJbnZpdGF0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KG5ldyBEYXRlKGV4cGlyZWRJbnZpdGF0aW9uLmV4cGlyZXNBdCkpLnRvQmVJbnN0YW5jZU9mKERhdGUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRGF0YWJhc2UgQ29uc3RyYWludHMgYW5kIERhdGEgSW50ZWdyaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgaGFuZGxlIGludml0YXRpb25zIHdpdGggbnVsbCBvcmdhbml6YXRpb24gcmVmZXJlbmNlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBpbnZpdGF0aW9uIHdpdGhvdXQgb3JnYW5pemF0aW9uXG4gICAgICBjb25zdCBbaW52aXRhdGlvbl0gPSBhd2FpdCBtb2NrRGIuaW5zZXJ0KG1vY2tTY2hlbWEuaW52aXRhdGlvbnMpLnZhbHVlcyh7XG4gICAgICAgIGVtYWlsOiAnbm8tb3JnQGV4YW1wbGUuY29tJyxcbiAgICAgICAgdG9rZW46ICduby1vcmctdG9rZW4nLFxuICAgICAgICB0b2tlbkhhc2g6ICduby1vcmctaGFzaCcsXG4gICAgICAgIHJvbGU6ICd0ZW5hbnQnLFxuICAgICAgICBzdGF0dXM6ICdwZW5kaW5nJyxcbiAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG51bGwsXG4gICAgICAgIGludml0ZWRCeVVzZXJJZDogYWRtaW5Vc2VyLmlkLFxuICAgICAgICBleHBpcmVzQXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCksXG4gICAgICB9KS5yZXR1cm5pbmcoKSBhcyBhbnk7XG4gICAgbWFuYWdlclVzZXIgPSBtYW5hZ2VyO1xuXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IG1vY2tSZXF1ZXN0XG4gICAgICAgIC5nZXQoJy9hcGkvaW52aXRhdGlvbnMvcGVuZGluZycpXG4gICAgICAgIC5zZXQoJ0Nvb2tpZScsIGFkbWluQ29va2llKVxuICAgICAgICAuZXhwZWN0KDIwMCk7XG5cbiAgICAgIGNvbnN0IG5vT3JnSW52aXRhdGlvbiA9IHJlc3BvbnNlLmJvZHkuZmluZCgoaW52OiBhbnkpID0+IGludi5lbWFpbCA9PT0gJ25vLW9yZ0BleGFtcGxlLmNvbScpO1xuICAgICAgZXhwZWN0KG5vT3JnSW52aXRhdGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChub09yZ0ludml0YXRpb24ub3JnYW5pemF0aW9uSWQpLnRvQmVOdWxsKCk7XG4gICAgICBleHBlY3Qobm9PcmdJbnZpdGF0aW9uLm9yZ2FuaXphdGlvbk5hbWUpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHByb3Blcmx5IGpvaW4gb3JnYW5pemF0aW9uIG5hbWVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBtb2NrUmVxdWVzdFxuICAgICAgICAuZ2V0KCcvYXBpL2ludml0YXRpb25zL3BlbmRpbmcnKVxuICAgICAgICAuc2V0KCdDb29raWUnLCBhZG1pbkNvb2tpZSlcbiAgICAgICAgLmV4cGVjdCgyMDApO1xuXG4gICAgICBjb25zdCBpbnZpdGF0aW9uMSA9IHJlc3BvbnNlLmJvZHkuZmluZCgoaW52OiBhbnkpID0+IGludi5lbWFpbCA9PT0gJ3Rlc3QxQGV4YW1wbGUuY29tJyk7XG4gICAgICBjb25zdCBpbnZpdGF0aW9uMiA9IHJlc3BvbnNlLmJvZHkuZmluZCgoaW52OiBhbnkpID0+IGludi5lbWFpbCA9PT0gJ3Rlc3QyQGV4YW1wbGUuY29tJyk7XG5cbiAgICAgIGV4cGVjdChpbnZpdGF0aW9uMS5vcmdhbml6YXRpb25OYW1lKS50b0JlKCdUZXN0IE9yZ2FuaXphdGlvbiAxJyk7XG4gICAgICBleHBlY3QoaW52aXRhdGlvbjIub3JnYW5pemF0aW9uTmFtZSkudG9CZSgnVGVzdCBPcmdhbml6YXRpb24gMicpO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==