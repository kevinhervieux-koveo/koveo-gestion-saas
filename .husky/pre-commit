#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "🔍 Running pre-commit validation checks..."

# Apply JSDoc templates to new/modified files
echo "📝 Applying JSDoc templates..."
npx tsx scripts/apply-jsdoc-templates.ts || true

# Run auto-fix for linting issues
echo "🧹 Running lint fixes..."
npm run lint:fix || true

# Run the pre-commit validation script
echo "📋 Checking code formatting, linting, and types..."
npm run validate:pre-commit

# Stage any JSDoc changes that were applied
git add -A

if [ $? -ne 0 ]; then
    echo "❌ Pre-commit validation failed!"
    echo "Fix the issues above before committing."
    echo "You can run the following commands to fix most issues:"
    echo "  npm run format:write  # Fix formatting"
    echo "  npm run lint:fix      # Fix linting issues" 
    echo "  npm run typecheck     # Check types"
    exit 1
fi

echo "✅ All pre-commit checks passed! Proceeding with commit..."
