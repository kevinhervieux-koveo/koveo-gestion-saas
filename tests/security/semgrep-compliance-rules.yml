# Advanced Compliance Rules for Koveo Gestion
rules:
  # Quebec Law 25 Advanced Rules
  - id: koveo.law25.advanced-consent-tracking
    pattern-either:
      - pattern: |
          const consent = { ..., dataProcessing: $VALUE, ... }
      - pattern: |
          user.consent.marketing = $BOOL
      - pattern: |
          consentForm.submit($DATA)
    message: 'Consent tracking detected - ensure Law 25 compliance with granular consent options'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: privacy
      law25: advanced-consent

  - id: koveo.law25.data-subject-rights-impl
    pattern-either:
      - pattern: |
          router.get("/api/user/data-export", ...)
      - pattern: |
          router.delete("/api/user/delete-account", ...)
      - pattern: |
          router.put("/api/user/data-correction", ...)
    message: 'Data subject rights endpoint - ensure full Law 25 compliance implementation'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: privacy
      law25: data-subject-rights

  - id: koveo.law25.privacy-impact-assessment
    pattern-either:
      - pattern: |
          collectPersonalData($DATA)
      - pattern: |
          processSensitiveInformation($INFO)
      - pattern: |
          shareDataWithThirdParty($PARTY, $DATA)
    message: 'High-risk data processing may require privacy impact assessment under Law 25'
    languages: [typescript, javascript]
    severity: WARNING
    metadata:
      category: privacy
      law25: pia-required

  - id: koveo.law25.quebec-language-compliance
    pattern-either:
      - pattern: |
          "Terms of Service"
      - pattern: |
          "Privacy Policy"
      - pattern: |
          "Data Processing Agreement"
    message: 'Legal documents must be available in French per Quebec Law 25'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: compliance
      law25: quebec-language

  - id: koveo.law25.breach-notification-compliance
    pattern-either:
      - pattern: |
          logger.error("Security breach", $DATA)
      - pattern: |
          notifySecurityIncident($INCIDENT)
      - pattern: |
          reportDataBreach($DETAILS)
    message: 'Security incident logging - ensure Law 25 breach notification procedures'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: security
      law25: breach-notification

  # Property Management Domain Rules
  - id: koveo.property.tenant-privacy-protection
    pattern-either:
      - pattern: |
          tenant.personalInfo
      - pattern: |
          resident.privateData
      - pattern: |
          tenantProfile.sensitiveData
    message: 'Tenant privacy data access - ensure proper authorization and Law 25 compliance'
    languages: [typescript, javascript]
    severity: WARNING
    metadata:
      category: property-privacy
      domain: tenant-protection

  - id: koveo.property.building-security-compliance
    pattern-either:
      - pattern: |
          building.accessCodes
      - pattern: |
          securitySystem.credentials
      - pattern: |
          buildingAccess.keyManagement
    message: 'Building security data handling requires strict access controls'
    languages: [typescript, javascript]
    severity: ERROR
    metadata:
      category: property-security
      domain: building-protection

  - id: koveo.property.maintenance-data-confidentiality
    pattern-either:
      - pattern: |
          maintenanceRequest.tenantDetails
      - pattern: |
          workOrder.accessInformation
      - pattern: |
          serviceCall.privateNotes
    message: 'Maintenance data may contain private tenant information'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: property-privacy
      domain: maintenance-privacy

  - id: koveo.property.financial-document-security
    pattern-either:
      - pattern: |
          financialDocument.upload($FILE)
      - pattern: |
          billDocument.generate($DATA)
      - pattern: |
          paymentRecord.store($TRANSACTION)
    message: 'Financial documents require encryption and access controls'
    languages: [typescript, javascript]
    severity: WARNING
    metadata:
      category: financial-security
      domain: document-protection

  # Code Quality Rules
  - id: koveo.quality.typescript-strict-mode
    pattern-either:
      - pattern: |
          // @ts-ignore
      - pattern: |
          // @ts-nocheck
      - pattern: |
          any
    message: 'Avoid TypeScript strict mode bypasses for better type safety'
    languages: [typescript]
    severity: INFO
    metadata:
      category: code-quality
      domain: type-safety

  - id: koveo.quality.error-handling-patterns
    pattern-either:
      - pattern: |
          catch ($ERROR) {
            console.warn($ERROR)
          }
      - pattern: |
          catch ($ERROR) {
            // TODO: handle error
          }
      - pattern: |
          .catch(() => {})
    message: 'Improve error handling with proper error reporting and user feedback'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: code-quality
      domain: error-handling

  - id: koveo.quality.api-documentation
    pattern: |
      router.$METHOD("$PATH", async (req, res) => {
        ...
      })
    pattern-not: |
      /**
       * ...
       */
      router.$METHOD("$PATH", async (req, res) => {
        ...
      })
    message: 'API endpoints should have JSDoc documentation'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: code-quality
      domain: documentation

  - id: koveo.quality.logging-standards
    pattern-either:
      - pattern: |
          console.warn($MSG)
      - pattern: |
          console.error($MSG)
    pattern-not: |
      logger.$LEVEL($MSG)
    message: 'Use structured logging instead of console.log for better monitoring'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: code-quality
      domain: logging

  # Enterprise Security Rules
  - id: koveo.security.rbac-implementation
    pattern-either:
      - pattern: |
          checkUserRole($USER, $ROLE)
      - pattern: |
          hasPermission($USER, $PERMISSION)
      - pattern: |
          authorizeAccess($USER, $RESOURCE)
    message: 'RBAC implementation detected - ensure comprehensive permission checking'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: enterprise-security
      domain: rbac

  - id: koveo.security.session-management
    pattern-either:
      - pattern: |
          session.save($DATA)
      - pattern: |
          req.session.$PROPERTY = $VALUE
      - pattern: |
          sessionStore.set($ID, $DATA)
    message: 'Session management operation - ensure secure session handling'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: enterprise-security
      domain: session-management

  - id: koveo.security.audit-trail
    pattern-either:
      - pattern: |
          auditLog.record($ACTION, $USER)
      - pattern: |
          createAuditEntry($EVENT)
      - pattern: |
          logUserAction($ACTION, $DETAILS)
    message: 'Audit trail implementation - ensure comprehensive activity logging'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: enterprise-security
      domain: audit-trail

  # Internationalization Rules
  - id: koveo.i18n.quebec-french-completeness
    pattern-either:
      - pattern: |
          t("$KEY")
      - pattern: |
          useLanguage()
      - pattern: |
          translations.fr[$KEY]
    message: 'Translation usage detected - verify Quebec French completeness'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: i18n
      domain: quebec-completeness

  - id: koveo.i18n.cultural-adaptation
    pattern-either:
      - pattern: |
          dateFormat($DATE)
      - pattern: |
          currencyFormat($AMOUNT)
      - pattern: |
          addressFormat($ADDRESS)
    message: 'Cultural adaptation point - ensure Quebec cultural preferences'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: i18n
      domain: cultural-adaptation

  - id: koveo.i18n.quebec-address-formats
    pattern-either:
      - pattern: |
          postalCode
      - pattern: |
          zipCode
      - pattern: |
          "postal_code"
      - pattern: |
          addressLine1
    message: 'Address formatting - ensure Quebec postal code format (A1A 1A1)'
    languages: [typescript, javascript]
    severity: INFO
    metadata:
      category: i18n
      domain: quebec-formats
